
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wikipedia - Documentación Técnica</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Libre+Baskerville:wght@400;700&family=Noto+Sans:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            background-color: #f6f6f6;
            font-family: 'Noto Sans', sans-serif;
            color: #202122;
            margin: 0;
            padding: 0;
        }
        .mw-body {
            background-color: #ffffff;
            border: 1px solid #a7d7f9;
            border-right-width: 0;
            margin-left: 11rem;
            padding: 1.25rem 1.5rem 1.5rem 1.5rem;
            min-height: 100vh;
        }
        .mw-header {
            font-family: 'Libre Baskerville', serif;
            border-bottom: 1px solid #a2a9b1;
            margin-bottom: 0.25em;
            padding-top: 0.5em;
            font-size: 1.8em;
            font-weight: normal;
        }
        .mw-sidebar {
            width: 11rem;
            position: absolute;
            left: 0;
            top: 0;
            padding: 1rem 0.5rem;
        }
        .sidebar-logo {
            text-align: center;
            margin-bottom: 1.5rem;
        }
        .sidebar-logo span {
            font-family: 'Libre Baskerville', serif;
            font-size: 1.2rem;
            display: block;
        }
        .sidebar-logo small {
            font-size: 0.7rem;
            color: #54595d;
            text-transform: uppercase;
        }
        .nav-link {
            color: #0645ad;
            font-size: 0.85rem;
            display: block;
            padding: 0.2rem 0.5rem;
            text-decoration: none;
        }
        .nav-link:hover {
            text-decoration: underline;
        }
        .nav-link.active {
            color: #202122;
            font-weight: bold;
            border-left: 2px solid #3366cc;
            background: #f8f9fa;
        }
        
        /* Markdown Content Styling */
        #markdownBody h1 { font-family: 'Libre Baskerville', serif; font-size: 1.8em; border-bottom: 1px solid #a2a9b1; margin: 1em 0 0.25em; font-weight: normal; }
        #markdownBody h2 { font-family: 'Libre Baskerville', serif; font-size: 1.5em; border-bottom: 1px solid #a2a9b1; margin: 1.5em 0 0.25em; font-weight: normal; }
        #markdownBody h3 { font-size: 1.2em; font-weight: bold; margin: 1.2em 0 0.25em; }
        #markdownBody p { margin: 0.5em 0 1em; line-height: 1.6; font-size: 0.95rem; }
        #markdownBody ul { list-style-type: disc; margin-left: 2rem; margin-bottom: 1rem; }
        #markdownBody li { margin-bottom: 0.3em; font-size: 0.95rem; }
        #markdownBody a { color: #0645ad; text-decoration: none; }
        #markdownBody a:hover { text-decoration: underline; }
        #markdownBody code { background-color: #f8f9fa; border: 1px solid #eaecf0; padding: 0.1em 0.3em; border-radius: 2px; font-family: monospace; font-size: 0.9em; }
        #markdownBody pre { background-color: #f8f9fa; border: 1px solid #eaecf0; padding: 1em; margin: 1em 0; overflow-x: auto; border-radius: 2px; }
        #markdownBody blockquote { border-left: 4px solid #eaecf0; padding-left: 1em; color: #54595d; font-style: italic; margin: 1em 0; }
        
        .toc {
            background-color: #f8f9fa;
            border: 1px solid #a2a9b1;
            padding: 0.5rem;
            display: inline-block;
            min-width: 200px;
            margin-bottom: 1.5rem;
            font-size: 0.85rem;
        }
        .toc-title {
            text-align: center;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }
    </style>
</head>
<body>

    <aside class="mw-sidebar">
        <div class="sidebar-logo">
            <span>Enciclopedia</span>
            <small>Libre de Desarrollo</small>
        </div>
        
        <div class="mb-4">
            <h4 class="text-[0.75rem] font-bold text-[#54595d] px-2 mb-1 border-b border-[#eaecf0] uppercase tracking-tighter">Navegación</h4>
            <nav id="sidebarNav">
                <!-- Nav items here -->
            </nav>
        </div>
        
        <div class="mt-8 px-2">
            <input id="searchInput" type="text" placeholder="Buscar en Docs..." class="w-full text-xs border border-[#a2a9b1] p-1 outline-none focus:border-[#3366cc]">
        </div>
    </aside>

    <main class="mw-body">
        <div class="flex justify-between items-start mb-4">
            <h1 id="mainTitle" class="mw-header">Cargando...</h1>
            <div class="text-[0.8rem] space-x-2">
                <button onclick="window.print()" class="text-[#0645ad] hover:underline">Imprimir</button>
            </div>
        </div>

        <div id="contentArea">
            <div id="markdownBody">
                <!-- Body content here -->
            </div>
        </div>
        
        <footer class="mt-12 pt-4 border-t border-[#a2a9b1] text-[0.75rem] text-[#54595d]">
            <p>Esta página fue editada por última vez por Antigravity (IA) el 26/01/2026.</p>
            <p>El texto está disponible bajo la Licencia Creative Commons Atribución Compartir Igual 3.0.</p>
        </footer>
    </main>

    <script>
        const docs = {"00_Reglas_Strictas_Proyecto.md": "# Reglas Estrictas de Desarrollo: Chronos Atlas\n\nEste documento establece los principios innegociables para el desarrollo y mantenimiento de **WorldbuildingApp (Chronos Atlas)**. Estas reglas han sido definidas para garantizar la integridad de los datos y la transparencia del sistema.\n\n---\n\n## 1. Prohibici\u00f3n de \"Self-Healing\" (Auto-Recuperaci\u00f3n Silenciosa)\n\nNo se permite que el sistema \"cure\" o \"maquille\" inconsistencias de datos de forma autom\u00e1tica y silenciosa.\n\n* **Regla**: Si falta un registro de metadatos (`Cuaderno`), una carpeta ra\u00edz o un contexto de proyecto, el sistema **DEBE** fallar y reportar el error.\n* **Prohibido**: Crear registros \"gen\u00e9ricos\" o temporales en segundo plano para evitar que la UI falle.\n* **Justificaci\u00f3n**: El self-healing oculta bugs de persistencia y crea inconsistencias a largo plazo.\n\n## 2. Gesti\u00f3n Centralizada de Errores\n\nTodos los fallos del backend deben ser procesados por un controlador de excepciones global.\n\n* **Regla**: Las excepciones de Java deben ser capturadas por `GlobalExceptionHandler.java`.\n* **Formato**: Los errores devueltos al frontend deben ser JSON limpios: `{ \"error\": \"Mensaje legible\", \"type\": \"TipoDeExcepcion\" }`.\n* **Limpieza**: Se debe eliminar el ruido t\u00e9cnico (timestamps excesivos, l\u00edneas divisoras `---`, stack traces crudos) de las respuestas enviadas al cliente.\n\n## 3. Jerarqu\u00eda Plana de la Biblia\n\nLa organizaci\u00f3n de lore debe seguir una estructura simple y predecible.\n\n* **Estructura**: `Root` -> `Carpeta` -> `Entidad`.\n* **Restricci\u00f3n**: No se permite la creaci\u00f3n de subcarpetas redundantes dentro del explorador de la Biblia para evitar la fragmentaci\u00f3n del lore.\n* **CRUD**: La creaci\u00f3n de entidades (Personajes, Mapas, etc.) se realiza directamente dentro de la carpeta contenedora.\n\n## 4. Gesti\u00f3n Estricta de Tenant (Contexto de Proyecto)\n\nEl aislamiento de datos es primordial.\n\n* **Regla**: Todo acceso a los repositorios debe estar precedido por la validaci\u00f3n del `proyectoActivo` en la sesi\u00f3n y la configuraci\u00f3n del `TenantContext`.\n* **Prohibido**: Uso de valores por defecto hardcoded (ej: \"Prime World\") si el contexto es nulo.\n* **Seguridad**: Si no hay un proyecto seleccionado expl\u00edcitamente, la API debe devolver `401 Unauthorized` o `404 Not Found`.\n\n## 5. Persistencia y Sincronizaci\u00f3n\n\n* **Flyway**: Todas las modificaciones del esquema deben pasar por migraciones versionadas.\n* **Integridad**: Antes de guardar cualquier entidad, el controlador debe verificar que el `Cuaderno` padre existe y es v\u00e1lido.\n\n## 6. Directiva de Idioma y Comunicaci\u00f3n\n\nLa comunicaci\u00f3n con el usuario y la documentaci\u00f3n principal deben ser claras y en su idioma nativo.\n\n* **Regla**: Toda respuesta, plan de implementaci\u00f3n, explicaci\u00f3n y artefacto dirigido al usuario debe estar redactado en **ESPA\u00d1OL**.\n* **Excepci\u00f3n**: El c\u00f3digo fuente, nombres de variables y mensajes de log t\u00e9cnicos deben mantenerse en ingl\u00e9s puros para preservar est\u00e1ndares de la industria, a menos que el usuario indique lo contrario para textos visibles en UI.\n\n---\n\n## 7. Est\u00e1ndares de Frontend (Rutas y Dise\u00f1o)\n\nPara garantizar portabilidad y dise\u00f1o responsive coherente:\n\n* **Rutas**: Se DEBEN usar rutas relativas siempre que sea posible (ej: `./assets/img.png`, `../components/Header`). Evitar rutas absolutas hardcoded que dependan del dominio ra\u00edz.\n* **CSS**: Se DEBEN usar unidades relativas (`rem`, `em`, `%`) para espaciados, fuentes y tama\u00f1os. Evitar `px` salvo para bordes finos o casos estrictamente necesarios.\n\n---\n\n## 8. Seguridad de Lazy Loading (Hibernate)\n\n* **Problema**: La serializaci\u00f3n de objetos con relaciones `Lazy` fuera de una transacci\u00f3n causa errores 500 (`LazyInitializationException`).\n* **Regla**: **PROHIBIDO** devolver entidades JPA crudas directamente desde el Controlador si tienen relaciones Lazy no inicializadas.\n* **Soluci\u00f3n**: Usar siempre un helper de hidrataci\u00f3n (ej: `hydrateEntity`) dentro del Servicio `@Transactional` para inicializar expl\u00edcitamente (`Hibernate.initialize()`) todas las relaciones necesarias antes de retornar el objeto.\n\n---\n\n## 9. Especializaci\u00f3n de Agentes (Meta-Regla)\n\n* **Principio**: Divide y Vencer\u00e1s.\n* **Regla**: El sistema NO debe actuar como un generalista monol\u00edtico. Debe invocar o simular \"Agentes Especializados\" seg\u00fan la naturaleza de la tarea o la regla a aplicar (ej: \"Agente de Persistencia\" para fixes de BBDD, \"Agente de UI\" para dise\u00f1o, \"Auditor de Reglas\" para verificaci\u00f3n).\n* **Justificaci\u00f3n**: Aumenta la precisi\u00f3n y reduce el riesgo de alucinaciones o mezclas de contexto.\n\n---\n\n*\u00daltima actualizaci\u00f3n: 2026-01-26 (A\u00f1adido Especializaci\u00f3n de Agentes)*\n", "01_Estrategia_y_Roadmap.md": "# Manifiesto del Proyecto: Chronos Atlas (WorldbuildingApp)\n\n## 1. Visi\u00f3n y Prop\u00f3sito\n\n**Chronos Atlas \"Next\"** es un entorno modular de construcci\u00f3n de mundos profesional. Abandonamos las categor\u00edas r\u00edgidas por un sistema de **Bible Bible Din\u00e1mica** basada en carpetas y un **Entity Builder Universal** que permite a los autores definir cada detalle de su mundo con flexibilidad total.\n\n---\n\n## 2. Estrategia T\u00e9cnica\n\n* **Core:** Java Spring Boot (v2 Refactor).\n* **Frontend:** HTML5, CSS3 (Vanilla + Tailwind CSS), JavaScript. Est\u00e9tica **Dark Glassmorphism**.\n* **Base de Datos:** SQLite local. Portabilidad total mediante archivo `.db`.\n* **Arquitectura:** Modular y desacoplada, preparada para expansi\u00f3n a sincronizaci\u00f3n en la nube (PostgreSQL/Supabase).\n\n---\n\n## 3. Sistema de Dise\u00f1o (UI Kit: \"Arcane Void\")\n\nEl dise\u00f1o busca un equilibrio entre la claridad de un IDE moderno y la m\u00edstica de un antiguo estudio de alquimia.\n\n* **Paleta de Colores:**\n  * **Void Dark:** `#09090b` (Fondo profundo).\n  * **Glass Border:** `rgba(255, 255, 255, 0.05)`.\n  * **Accent Indigo:** `#6366f1` (Primario).\n  * **Accent Emerald:** `#10b981` (Secundario).\n  * **Parchment White:** `#fafafa` (Texto).\n* **Tipograf\u00eda:**\n  * **UI/Sistemas:** `Outfit` / `Inter` (Sans-serif limpia).\n  * **Lectura/Escritura:** `Cormorant Garamond` / `Playfair Display` (Serif elegante para inmersi\u00f3n profunda).\n\n---\n\n## 4. Mapa de Funcionalidades (Roadmap & Status)\n\n### A. Entorno Modular [COMPLETADO]\n\n* **3-Panel Layout**: Explorador jer\u00e1rquico, Lienzo Central y Caja de Atributos.\n* **Navigation Dock**: Barra flotante inferior con desenfoque.\n\n### B. Biblia del Mundo Din\u00e1mica [COMPLETADO]\n\n* **Carpetas Hier\u00e1rquicas**: Organizaci\u00f3n libre de lore.\n* **Attribute Inheritance**: Las carpetas definen la estructura de las entidades hijas.\n\n### C. Entity Builder [COMPLETADO]\n\n* **Drag & Drop**: Construcci\u00f3n de fichas mediante bloques de atributos.\n* **Pesta\u00f1as Contextuales**: Mapas y Cronolog\u00edas integradas directamente en las fichas.\n\n---\n\n## 5. Filosof\u00eda de Desarrollo\n\n1. **Cero Distracci\u00f3n:** El autor no debe abandonar el teclado. Los comandos y atajos de teclado son prioridad.\n2. **Contexto es Rey:** La informaci\u00f3n del mundo debe fluir hacia el texto, no al rev\u00e9s.\n3. **Local-First:** Tus datos son tuyos. La sincronizaci\u00f3n es una opci\u00f3n, no un requisito.\n\n## 6. Mandamientos de Desarrollo (Strict Rules)\n\nEstas reglas son absolutas y deben ser seguidas por cualquier IA o desarrollador en el proyecto. Ver detalle en [00_Reglas_Strictas_Proyecto.md](file:///c:/Users/rober/Desktop/Proyectos propios/WorldbuildingApp/Docs/00_Reglas_Strictas_Proyecto.md).\n\n1. **Exposici\u00f3n Total de Errores**: Prohibido el \"Self-Healing\" que oculte fallos de datos.\n2. **Jerarqu\u00eda Plana**: Root -> Carpeta -> Entidad. Sin anidamiento excesivo.\n3. **Contexto Expl\u00edcito**: Prohibidos los fallbacks hardcoded; el proyecto debe estar activo en sesi\u00f3n.\n4. **Backend Limpio**: Errores centralizados y respuestas libres de ruido t\u00e9cnico.\n\n## Estado Actual (2026-01-07)\n\n* [x] **Fase de Estabilidad Core**: Completada. Persistencia de datos asegurada y esquema multi-tenant funcional.\n\n* [x] **Seguridad**: Configurada para desarrollo fluido (PermitAll) sin comprometer la activaci\u00f3n de sesiones de proyecto.\n* [x] **UI/UX Biblia**: Entity Builder optimizado con controles en cabecera y visualizaci\u00f3n corregida.\n\n## Estado Actual (2026-01-26)\n\n* [x] **Estabilidad Cr\u00edtica Backend**: Solucionado el problema de `LazyInitializationException` mediante hidrataci\u00f3n profunda en `WorldBibleService`.\n* [x] **Robustez Navegaci\u00f3n**: El `EntityBuilder` ahora maneja correctamente la redirecci\u00f3n post-guardado incluso si se pierde el contexto de la URL (fallback a `entity.carpeta`).\n* [x] **UX Edici\u00f3n**: Implementado flujo \"Guardar y Continuar\" y \"Guardar y Salir\" sin errores 500.\n\n# Plan Maestro de Migraci\u00f3n de Stack Tecnol\u00f3gico (Worldbuilding)\n\nEste documento define la evoluci\u00f3n tecnol\u00f3gica de **WorldbuildingApp** para convertirse en un ecosistema profesional, escalable y flexible, adaptado a la arquitectura existente.\n\n---\n\n## 01. Estabilidad de Datos (Base de Datos)\n\n**Decisi\u00f3n:** **Flyway** (Migraciones Versionadas).\n\n* **Problema Cr\u00edtico**:\n    1. `ddl-auto=create` borra los datos.\n    2. La configuraci\u00f3n autom\u00e1tica de Spring Boot solo migra la DB principal, ignorando los proyectos de usuario (`Users/ProjectA.db`).\n* **Soluci\u00f3n**: Flyway Orquestado (Multi-Tenant).\n  * **Implementaci\u00f3n**: Bean personalizado `DatabaseMigration.java`.\n  * **L\u00f3gica**: Al inicio, escanea *todos* los archivos `.db` en la carpeta de datos.\n  * **Resiliencia**: Ejecuta `flyway.repair()` antes de `migrate()` para auto-corregir checksums en desarrollo.\n  * **Configuraci\u00f3n**: `spring.flyway.enabled=false` (para evitar conflictos con el automigrador).\n  * **Beneficio**: Historial exacto y soporte total para N bases de datos din\u00e1micas.\n\n---\n\n## 02. Arquitectura de Datos: Evoluci\u00f3n H\u00edbrida (JSON)\n\n**Decisi\u00f3n:** Integrar Columna JSON en la Entidad Existente.\n\n* **Situaci\u00f3n Actual**: Tienes `EntidadGenerica` conectada a `AtributoValor` (tabla separada). Esto es r\u00edgido y costoso (muchos JOINs).\n* **Estrategia de Adaptaci\u00f3n**:\n  * **No borrar lo existente**: Mantener `EntidadGenerica` como base.\n  * **Evoluci\u00f3n**: A\u00f1adir columna `attributes` (JSON) a `EntidadGenerica`.\n\n    ```java\n    // En EntidadGenerica.java\n    @JdbcTypeCode(SqlTypes.JSON)\n    @Column(name = \"json_attributes\", columnDefinition = \"JSON\")\n    private Map<String, Object> attributes = new HashMap<>();\n    ```\n\n  * **Resultado**: Las nuevas funcionalidades (ej: \"Da\u00f1o de Fuego\", \"Clima\") se guardar\u00e1n en este JSON. Lo antiguo (`AtributoValor`) puede coexistir o migrarse gradualmente, sin romper la app hoy.\n\n---\n\n## 03. Motor de Visualizaci\u00f3n (Grafos)\n\n**Decisi\u00f3n:** **Cytoscape.js**.\n\n* **Objetivo**: Visualizar miles de nodos (`EntidadGenerica` convertida a Nodos de Grafo) con alto rendimiento.\n* **Implementaci\u00f3n**: Componente React `GraphCanvas` que consume el JSON de entidades.\n\n---\n\n## 04. Editor de \"Hojas\" (Rich Text & Lore)\n\n**Decisi\u00f3n:** **TipTap** (Headless Editor).\n\n* **Funcionalidad**: Sistema de menciones (`[[`) que busca en la tabla `entidad_generica` por ID/Slug, permitiendo renombres autom\u00e1ticos sin romper enlaces.\n\n---\n\n## 05. UI y Layout\n\n**Decisi\u00f3n:** **Tailwind CSS** + **Shadcn/ui** + **React-Resizable-Panels**.\n\n* Para acomodar Mapa, Editor y Ficha en una sola vista flexible.\n\n---\n\n## 06. Gesti\u00f3n de Estado\n\n* **TanStack Query**: Cach\u00e9 inteligente para los datos de `EntidadGenerica`.\n* **Zustand**: Gesti\u00f3n de filtros globales de UI.\n\n---\n\n## 07. Despliegue (Desktop)\n\n* **Electron**: Empaquetar Spring Boot (`.jar`) + React en un ejecutable \u00fanico (`.exe`) con JRE embebido.\n\n---\n\n## Pr\u00f3ximos Pasos\n\n\ud83d\udd34 **EN ESPERA DE ORDEN \"YA\"**\n\n1. Configurar Flyway (Prioridad de Seguridad).\n2. A\u00f1adir columna JSON a `EntidadGenerica`.\n3. Comenzar migraci\u00f3n Frontend (Cytoscape).\n\n# Chronos Atlas: El IDE del Escritor (Redise\u00f1o \"Next\")\n\nChronos Atlas evoluciona hacia un entorno de trabajo a\u00fan m\u00e1s potente y flexible, donde la narrativa y el lore se integran de forma fluida a trav\u00e9s de un dise\u00f1o **Glassmorphism Oscuro** de alta fidelidad. El nuevo paradigma se basa en un espacio de trabajo modular de tres paneles flanqueado por una navegaci\u00f3n tipo dock.\n\n## 1. Biblia del Mundo (Panel Lateral Izquierdo)\n\n### Estructura de Carpetas Personalizable\n\n* **Prop\u00f3sito**: Sustituir las categor\u00edas fijas por una estructura de carpetas completamente personalizable, permitiendo una organizaci\u00f3n jer\u00e1rquica y tem\u00e1tica de tu lore.\n\n* **Qu\u00e9 puedes hacer**:\n  * **Crear Carpetas y Subcarpetas**: Un bot\u00f3n o un men\u00fa contextual (clic derecho) permite crear nuevas carpetas. Se pueden anidar para construir una estructura tan compleja como necesites (ej. \"Personajes de Eldoria\" dentro de \"Eldoria\").\n  * **Nombrar Carpetas**: Asigna nombres descriptivos (\"Lugares Importantes\", \"Deidades Antiguas\").\n  * **Arrastrar y Soltar**: Mueve libremente entidades y carpetas para reorganizar tu mundo.\n  * **Atributos Globales**: Los atributos ahora se gestionan de forma global para todo el proyecto desde el `TemplateManager`, permitiendo reutilizar plantillas (ej. \"Rango\", \"Clima\") en cualquier entidad sin depender de su carpeta.\n  * **Visualizaci\u00f3n**: Cada carpeta muestra iconos claros con acentos Indigo-500 al seleccionar.\n* **Dise\u00f1o**: Barra lateral transl\u00facida con \u00e1rbol de navegaci\u00f3n expandible y men\u00fas contextuales para Renombrar, Eliminar o A\u00f1adir Atributos.\n\n## 2. Constructor Universal de Fichas (\u00c1rea Central)\n\n### Lienzo Flexible y Arrastrar y Soltar Atributos\n\n* **Prop\u00f3sito**: El \u00e1rea central se transforma en un lienzo din\u00e1mico para construir fichas de entidad \u00fanicas, adapt\u00e1ndose a las necesidades de cada elemento de tu mundo.\n\n* **Qu\u00e9 puedes hacer**:\n  * **Campos por Defecto**: Al crear una entidad, el lienzo se precarga autom\u00e1ticamente con los atributos definidos en la carpeta padre.\n  * **Caja de Herramientas de Atributos**: El panel lateral derecho se transforma en una biblioteca de \"cajas\" de atributos arrastrables cuando el constructor est\u00e1 activo.\n  * **Tipos de Atributos**:\n    * **Texto Libre**: Para biograf\u00edas descripciones extensas.\n    * **Texto Corto**: Para nombres o t\u00edtulos.\n    * **N\u00famero**: Para edad, poblaci\u00f3n, tama\u00f1o.\n    * **Fecha/Hora**: Para eventos cronol\u00f3gicos precisos.\n    * **Selector (Dropdown)**: Para listas predefinidas (ej. \"Estado: Vivo/Muerto\").\n    * **Enlace a Entidad**: Para vincular personajes, lugares u objetos entre s\u00ed.\n    * **Imagen/Multimedia**: Para retratos o arte conceptual.\n    * **Booleano (S\u00ed/No)**: Para propiedades simples.\n    * **Tabla**: Para estad\u00edsticas, inventarios o datos estructurados.\n    * **Mapa Embedido**: Vincula una secci\u00f3n del atlas directamente a la ficha.\n    * **L\u00ednea de Tiempo Embedida**: Muestra una mini-cronolog\u00eda espec\u00edfica del elemento.\n* **Configuraci\u00f3n**: Cada caja de atributo permite renombrar etiquetas, establecer valores por defecto, marcarlos como obligatorios o a\u00f1adir descripciones de ayuda.\n\n## 3. Entidades Especializadas y Pesta\u00f1as de Funci\u00f3n\n\n### Flujo en Dos Pasos (Post-Guardado)\n\n* **Paso 1: Atributos B\u00e1sicos**: Se definen los atributos generales y se cataloga la entidad (Personaje, Lugar, etc., o tipos especiales como **L\u00ednea de Tiempo**, **Zona/Mapa** o **Lenguaje**).\n\n* **Paso 2: Pesta\u00f1as de Funciones Especiales**: Al detectar un tipo especializado, el \u00e1rea central habilita pesta\u00f1as superiores con herramientas espec\u00edficas:\n  * **Pesta\u00f1a \"Cronolog\u00eda\"**: Cargar\u00e1 el interfaz del M\u00f3dulo Cronol\u00f3gico Interconectado (para entidades tipo L\u00ednea de Tiempo).\n  * **Pesta\u00f1a \"Cartograf\u00eda\"**: Cargar\u00e1 el Editor de Mapas y Herramientas de Dibujo (para para entidades tipo Zona/Mapa).\n  * **Pesta\u00f1a \"Taller Ling\u00fc\u00edstico\"**: Cargar\u00e1 las herramientas de Conlangs (L\u00e9xico, Gram\u00e1tica, Editor de Glifos) para entidades tipo Lenguaje.\n* **Coherencia**: Siempre se puede volver a la pesta\u00f1a **\"Atributos\"** para modificar la ficha base. El dise\u00f1o mantiene el Glassmorphism con pesta\u00f1as resaltadas en Indigo-500.\n\n## 4. Unificaci\u00f3n del Espacio de Trabajo\n\nEl nuevo paradigma unifica todas las pantallas clave bajo la estructura de tres paneles:\n\n* **Explorador (Biblia)** a la izquierda.\n* **Lienzo de Trabajo (Vistas Centrales)**:\n  * **Ficha de Entidad**: Visualizaci\u00f3n y edici\u00f3n de atributos y contenido anidado.\n  * **Editor Gr\u00e1fico Vers\u00e1til**: Lienzo vectorial para s\u00edmbolos y logogramas.\n  * **Gesti\u00f3n de Territorios**: Listado y gesti\u00f3n geopol\u00edtica de biomas y asentamientos.\n  * **Mapa Interactivo**: Navegaci\u00f3n y colocaci\u00f3n de pines sobre el atlas.\n  * **Visualizaci\u00f3n de Grafo**: Lienzo din\u00e1mico de relaciones entre entidades.\n* **Contexto (Escritura/Atributos)** a la derecha.\n\n---\n\n### 5. Pantalla de Bienvenida a Nuevo Cuaderno\n\n* **Prop\u00f3sito**: Guiar al usuario en la configuraci\u00f3n inicial y ofrecer acceso r\u00e1pido a acciones clave.\n\n* **Dise\u00f1o**:\n  * **Central/Horizontal**: T\u00edtulo de bienvenida, mensajes motivadores y tarjetas de acci\u00f3n destacadas (\"A\u00f1adir Primera Entidad\", \"Crear Primer Mapa\", \"Empezar a Escribir\", \"Ver Ideas R\u00e1pidas\").\n  * **Visualizaci\u00f3n**: Ocupa el \u00e1rea central manteniendo visibles los paneles laterales y la navegaci\u00f3n superior. Estilo Glassmorphism Oscuro.\n\n### 6. Creaci\u00f3n y Edici\u00f3n de Mapas (Implementado)\n\n* **Editor de Mapas (`MapEditor.jsx`)**:\n  * **Panel Derecho Global**: Integrado con dise\u00f1o de Acorde\u00f3n de 3 secciones:\n        1. **Identidad**: Nombre, Tipo (Regional, Mundo, etc.).\n        2. **Sistema de Rejilla**: Toggle On/Off y Slider de tama\u00f1o (px).\n        3. **Lienzo**: Dimensiones (Ancho/Alto) y Subida de Imagen de Fondo.\n  * **Sincronizaci\u00f3n**: Los cambios en el panel derecho se reflejan instant\u00e1neamente en el lienzo central.\n  * **Flujo de Guardado**: Al guardar cambios, el sistema redirige autom\u00e1ticamente a la carpeta contenedora para facilitar el flujo de trabajo.\n\n---\n\n### Flujo de Ejemplo\n\n1. El usuario crea una carpeta \"Cronolog\u00edas Importantes\".\n2. Define como atributo por defecto de la carpeta el selector \"Tipo de Era\".\n3. Crea la entidad \"La Ca\u00edda del Imperio de Eldoria\" de tipo **L\u00ednea de Tiempo**.\n4. Al guardar, el \u00e1rea central habilita la pesta\u00f1a **\"Cronolog\u00eda\"**.\n5. Al cambiar a ella, el usuario empieza a a\u00f1adir eventos hist\u00f3ricos directamente sobre la ficha de la entidad.\n\nEste redise\u00f1o garantiza una flexibilidad total, permitiendo que cada autor estructure su mundo exactamente como su narrativa lo requiera.\n\n# Tareas Pendientes y Roadmap (Gu\u00eda para IA)\n\nEste documento resume el estado actual del proyecto y las tareas cr\u00edticas que deben abordarse en las pr\u00f3ximas sesiones de desarrollo.\n\n## Estado Actual\n\n* **Editor de Mapas**: Funcional en estructura (Panel Derecho de Ajustes, Guardado) pero falta la interactividad real del Canvas.\n\n* **Biblia**: Navegaci\u00f3n por carpetas funcional, creaci\u00f3n de entidades y mapas operativa.\n* **Interfaz**: Migrada a un dise\u00f1o de 3 paneles (Explorer, Canvas, Contexto).\n\n## 1. Prioridad Alta: Editor de Mapas\n\nEl esqueleto est\u00e1 listo, pero falta el motor gr\u00e1fico.\n\n* [x] **Re-integrar Konva/Canvas**:\n  * Actualmente `MapEditor.jsx` usa un `CanvasPlaceholder` (Corregido: ahora usa `Stage` y `Layer`).\n  * Hay que descomentar y adaptar la l\u00f3gica de `react-konva` (Stage, Layers, Transformers) que est\u00e1 comentada o fue simplificada.\n  * Sincronizar el Canvas real con el `gridSize` y `bgImage` del panel derecho.\n* [x] **Herramientas de Dibujo**:\n  * Implementar l\u00f3gica para las herramientas de la barra izquierda (Pincel, Figuras, Texto).\n  * Conectar estas herramientas con el estado de Konva.\n\n## 2. Refactorizaci\u00f3n del Constructor de Entidades (`EntityBuilder`)\n\nEl constructor actual es funcional pero necesita alinearse con el nuevo dise\u00f1o de \"Panel Derecho Global\".\n    - [x] Migrar Tabs al Panel Derecho (Completado).\n\n* [x] **Mejoras en Identidad**:\n  * [x] A\u00f1adir campo \"Apariencia\" (Texto rico o imagen).\n  * [x] Permitir subir icono personalizado (Local Image) para la entidad.\n\n## 3. Mejoras de \"Calidad de Vida\" (UX)\n\n* [x] **Renombrar en Sidebar**: A\u00f1adir opci\u00f3n \"Rename\" al men\u00fa contextual del \u00e1rbol lateral (Hecho).\n\n* [x] **Breadcrumbs**: Implementar migas de pan en la vista de carpetas para mejorar la navegaci\u00f3n profunda.\n* [ ] **Favoritos**: Secci\u00f3n en el sidebar para acceso r\u00e1pido a entidades frecuentes.\n\n## 4. Refactorizaci\u00f3n T\u00e9cnica y Backend (Desde TODOs) [COMPLETADO ESTA SESI\u00d3N]\n\nTareas extra\u00eddas de `WorldBibleController.java`:\n\n* [x] **Restaurar Explorador Lateral**: Limpiar el sidebar para mostrar solo estructura de carpetas relevante.\n* [x] **Rutas de Creaci\u00f3n Directa**: Implementar rutas como `/new/:type` para acceso r\u00e1pido.\n* [x] **Guardado Diferido (Post-draft)**: Permitir crear entidades en memoria y solo persistir al guardar (evitar basura en DB).\n* [x] **Refactorizaci\u00f3n Flujo de Creaci\u00f3n (Sin Prompts)**: Reemplazado todos los `window.prompt` por `InputModal` o edici\u00f3n en l\u00ednea.\n* [x] **Breadcrumbs**: Implementado en Backend (`FolderDetail`) y Frontend (`Breadcrumbs.jsx`).\n* [x] **Herencia de Plantillas**: Completado mediante la implementaci\u00f3n de **Atributos Globales**.\n\n## 5. Implementaci\u00f3n del Editor de Texto \"Zen\" (Nueva Fase)\n\nObjetivo: Crear una zona de escritura limpia, minimalista y personalizada.\n\n* [x] **Setup Inicial**: Se ha optado por **React-Quill** en lugar de Tiptap debido a estabilidad.\n* [x] **Dise\u00f1o \"Zen\" UI**: Implementado mediante CSS personalizado en `ZenEditor.jsx` (Dark Mode, bordes ocultos).\n* [x] **Sistema de Menciones (@)**: Implementado en `ZenEditor.jsx` usando `quill-mention` y API de entidades.\n* [x] **Toolbar**: Integrada toolbar estilo Google Docs (Snow theme) con overrides oscuros.\n\n## Tareas Completadas Recientemente\n\n* [x] **Gesti\u00f3n de Plantillas Globales, UX EntityBuilder, Consistencia UI**.\n\n* [x] **Correcci\u00f3n de Errores Cr\u00edticos (Persistencia y Visualizaci\u00f3n)**.\n\n# Gu\u00eda de Pruebas para Agentes de IA (Worldbuilding App)\n\nEsta gu\u00eda est\u00e1 dise\u00f1ada para que un modelo de IA pueda navegar, probar y entender la estructura actual de la aplicaci\u00f3n **Chronos Atlas**.\n\n## URL Base\n\n* **Frontend**: `http://localhost:5173`\n\n* **Backend**: `http://localhost:8080` (API REST)\n\n## 1. Navegaci\u00f3n Principal\n\nLa aplicaci\u00f3n utiliza un layout principal (`ArchitectLayout`) con una barra lateral izquierda colapsable.\n\n* **Rutas Clave**:\n  * `/` o `/:user/:project`: Dashboard Principal.\n  * `.../bible`: **Biblia del Mundo** (Gestor de Carpetas y Entidades).\n  * `.../map`: **Atlas** (Visor de Mapas - *En desarrollo*).\n  * `.../map-editor/edit/:id`: **Editor de Mapas** (Pantalla completa).\n\n## 2. Flujo de Trabajo: Biblia del Mundo (`/bible`)\n\nEste es el n\u00facleo de la organizaci\u00f3n.\n\n1. **Crear Carpeta**:\n    * En la ra\u00edz o dentro de otra carpeta, usa el bot\u00f3n \"Nueva Carpeta\" o Clic Derecho -> \"Nueva Carpeta\".\n    * Esto organiza tu lore jer\u00e1rquicamente.\n2. **Men\u00fa Contextual (Clic Derecho)**:\n    * Sobre una Carpeta: `Nueva Entidad`, `Nuevo Mapa`, `Nueva Timeline`, `Renombrar`, `Eliminar`.\n    * Sobre un Archivo: `Renombrar`, `Eliminar`.\n\n## 3. Flujo de Trabajo: Creaci\u00f3n y Edici\u00f3n de Mapas\n\nEl sistema de mapas es una caracter\u00edstica destacada y compleja.\n\n### A. Crear un Mapa\n\n1. Navega a una carpeta en la `/bible`.\n2. Haz **Clic Derecho** en la carpeta -> Selecciona **\"Nuevo Mapa\"**.\n3. **Wizard de Creaci\u00f3n**:\n    * Se abrir\u00e1 una pantalla de configuraci\u00f3n por pasos.\n    * Completa Nombre, Descripci\u00f3n, Tipo (Mundo/Regional) y selecciona una fuente (Imagen o Blanco).\n    * Clic en \"Create Map\".\n\n### B. Editor de Mapas (`MapEditor`)\n\nTras crear, ser\u00e1s redirigido al editor.\n\n* **Panel Central (Lienzo)**: Muestra el mapa/imagen y la rejilla.\n* **Panel Derecho (Ajustes)**:\n  * **Identidad**: Cambia el nombre o tipo.\n  * **Grid System**: Activa/Desactiva la rejilla y ajusta su tama\u00f1o con el slider.\n  * **Canvas**: Ajusta las dimensiones (WxH) o sube una nueva imagen de fondo.\n    *Nota: Este panel usa un dise\u00f1o de Acorde\u00f3n.*\n* **Guardado**:\n  * Bot\u00f3n \"Save Changes\" (arriba derecha).\n  * **Importante**: Al guardar, el sistema te redirigir\u00e1 autom\u00e1ticamente a la carpeta de la Biblia donde est\u00e1 el mapa.\n\n## 4. Estructura T\u00e9cnica Relevante\n\n* **Backend (Spring Boot)**:\n  * Entidades se guardan en `EntidadGenerica`.\n  * Mapas son entidades con `tipoEspecial = 'map'`.\n  * Los datos del mapa (grid, imagen, capas) se serializan en JSON dentro del campo `descripcion`.\n\n* **Frontend (React/Vite)**:\n  * `MapEditor.jsx`: Componente monol\u00edtico para la edici\u00f3n. Usa `useOutletContext` para comunicarse con el `ArchitectLayout` (Panel Derecho).\n\n## 5. Pruebas Recomendadas\n\nSi eres una IA probando la app, intenta:\n\n1. Crear una estructura de carpetas anidada (ej. `Reino -> Capital -> Castillo`).\n2. Crear un Mapa dentro de \"Castillo\".\n3. En el editor, sube una imagen de prueba y ajusta la rejilla para que coincida con la escala de la imagen.\n4. Guarda y verifica que vuelves a la carpeta \"Castillo\".\n5. Vuelve a entrar al mapa y confirma que la rejilla y la imagen se mantienen.\n\n# Investigaci\u00f3n: Librer\u00edas de Editores de Texto (React)\n\n## Objetivo\n\nIdentificar la mejor librer\u00eda para crear una \"Zona de Escritura\" limpia, minimalista y altamente customizable (\"Headless\"), con soporte robusto para menciones (`@Personaje`).\n\n---\n\n## 1. Recomendaci\u00f3n Principal: Tiptap\n\n**Veredicto: LA MEJOR OPCI\u00d3N**\nEs un wrapper \"headless\" sobre ProseMirror. No trae estilos por defecto, lo que nos da control total sobre la UI (\"Pixel Perfect\").\n\n* **Ventajas:**\n  * **Headless:** Eres due\u00f1o del HTML y CSS. Ideal para el dise\u00f1o \"Zen\" solicitado.\n  * **Extensi\u00f3n de Menciones:** Tiene una extensi\u00f3n oficial (`@tiptap/extension-mention`) muy potente y f\u00e1cil de conectar con datos as\u00edncronos (nuestra BBDD).\n  * **Contexto de React:** Renderiza los nodos como componentes de React, permitiendo interactividad real dentro del texto.\n* **Desventajas:**\n  * Requiere m\u00e1s trabajo inicial de CSS (tailwind) porque viene \"desnudo\".\n\n---\n\n## 2. Alternativas Analizadas\n\n### A. Slate.js\n\n**Veredicto: Potente pero compleja**\nEs un framework de bajo nivel. Te da total libertad, pero tienes que construir *todo* desde cero, incluso el comportamiento b\u00e1sico del cursor a veces.\n\n* **Pros:** Flexibilidad infinita.\n* **Contras:** Curva de aprendizaje muy alta. Implementar menciones requiere mucho c\u00f3digo boilerplate manual.\n\n### B. Lexical (Meta/Facebook)\n\n**Veredicto: Prometedora pero verde**\nEl sucesor de Draft.js. Muy r\u00e1pido y ligero.\n\n* **Pros:** Rendimiento excelente, accesibilidad.\n* **Contras:** Ecosistema m\u00e1s joven que Tiptap/Slate. La documentaci\u00f3n a veces es fragmentada.\n\n### C. Quill / TinyMCE / CKEditor\n\n**Veredicto: DESCARTADAS**\nSon editores \"con pilas incluidas\". Vienen con barras de herramientas cl\u00e1sicas estilo Word y estilos dif\u00edciles de sobrescribir.\n\n* **Raz\u00f3n de descarte:** Van en contra del principio de \"limpieza visual\" y personalizaci\u00f3n total que buscas.\n\n---\n\n## Plan de Acci\u00f3n (Basado en Tiptap)\n\n1. Instalar `@tiptap/react` y `@tiptap/starter-kit`.\n2. Instalar `@tiptap/extension-mention` para las menciones.\n3. Usar `tippy.js` (o soluci\u00f3n propia) para el men\u00fa flotante de sugerencias.\n4. Estilar todo con **Tailwind CSS** para integrarlo en el *Glassmorphism* de la app.\n", "02_Bitacora_Desarrollo.md": "# Bit\u00e1cora de Desarrollo (Log Prompts)\n\n---\n\n### Prompt ID: 22 (Redise\u00c3\u00b1o \"Chronos Atlas Next\")\n\n**Prompt:** \"LAS FUNCIONALIDADES (capturas que te pase) sobreescribelas en ese archivo funcionalidades.md. Con esto YA\"\n**Resultados:**\n\n- [DOCS] Transcripci\u00c3\u00b3n total de 10 im\u00c3\u00a1genes detallando el nuevo paradigma modular.\n- [PLAN] Creaci\u00c3\u00b3n del plan de implementaci\u00c3\u00b3n para el esquema din\u00c3\u00a1mico (Folders/Templates).\n- [ARCH] Reestructuraci\u00c3\u00b3n visual hacia 3 paneles + Bottom Dock.\n\n---\n\n### Prompt ID: 0 (Setup Inicial)\n>\n> Analizame la app WorldbuildingApp y todas sus versiones... serverless pero con funcionamiento en el explorador...\n**Resultados:**\n\n- [AN\u00c3\u0192\u00ef\u00bf\u00bdLISIS] Determinada estructura (v1/v2 Java, v3 Next.js).\n- [ESTRATEGIA] Migraci\u00c3\u0192\u00c2\u00b3n exitosa a Java Spring Boot + H2 (standalone).\n\n---\n\n### Prompt ID: 3 (Estructura de Cuadernos)\n>\n> ...cuaderno/libro... plantillas/hojas... numerando las hojas...\n\n- [BUG FIX] Corregido error en `DynamicDataSourceConfig`: el inicializador SQL ignoraba bloques que empezaban con comentarios, omitiendo la creaci\u00c3\u0192\u00c2\u00b3n de tablas.\n- [COMPATIBILIDAD] Cambiado `MEDIUMTEXT` por `CLOB` en todas las entidades para asegurar compatibilidad total con H2.\n- [VERIFICACI\u00c3\u0192\u00e2\u20ac\u0153N] Verificado flujo completo en un nuevo proyecto \"Mundo_Arreglado\".\n\n### Prompt ID: 6 (Navegaci\u00c3\u0192\u00c2\u00b3n y Arquitectura)\n>\n> Elimina la sidebar, pon un men\u00c3\u0192\u00c2\u00ba radial arriba y prepara el backend para multi-usuario...\n**Resultados:**\n\n- [UX] Implementado men\u00c3\u0192\u00c2\u00ba radial Top-Center (Glassmorphism). Refactorizados todos los HTMLs.\n- [BACKEND] Creada entidad Usuario y repositorio JPA. Configurado redirecci\u00c3\u0192\u00c2\u00b3n a Login.\n\n---\n\n### Prompt ID: 7 (Migraci\u00c3\u00b3n a SQLite)\n>\n> Migrate to SQLite Database\n**Resultados:**\n\n- [DATABASE] Migraci\u00c3\u00b3n completa de H2 a SQLite (data/worldbuilding.db).\n- [CLEANUP] Eliminado c\u00c3\u00b3digo legacy H2 (DynamicDataSourceConfig, H2Functions).\n- [REFACTOR] Reescritura de ProyectoController y BDController para JPA est\u00c3\u00a1ndar.\n\n### Prompt ID: 8 (Multi-tenancy & Real Login)\n>\n> Aislamiento de datos por usuario y registro funcional.\n**Resultados:**\n\n- [SECURITY] Implementado `ProjectSessionInterceptor` para proteger APIs.\n- [AUTH] Completado `AuthController` con registro, login y logout real.\n- [DATA] Modificados modelos (`Proyecto`) y repositorios para filtrar por `Usuario`.\n- [FIX] Resuelto conflicto de puerto 8080.\n\n---\n\n### Prompt ID: 9 (Refinamiento UI & Librer\u00c3\u00ada)\n>\n> Refinamiento est\u00c3\u00a9tico, Biblia de Entidades y M\u00c3\u00b3dulo de Librer\u00c3\u00ada.\n**Resultados:**\n\n- [UX] Men\u00c3\u00ba Radial optimizado (m\u00c3\u00a1s amplio) y Perfil unificado (Dashboard style).\n- [BIBLIA] Redise\u00c3\u00b1o total con filtros superiores, conteo din\u00c3\u00a1mico en tiempo real y nuevos tipos (Magia, Zonas, Efectos).\n- [DASHBOARD] A\u00c3\u00b1adidos campos de g\u00c3\u00a9nero, tipo e imagen al crear proyectos.\n- [LIBRER\u00c3A] Creado m\u00c3\u00b3dulo de gesti\u00c3\u00b3n de hojas (`libreria.html`) con navegaci\u00c3\u00b3n avanzada.\n\n---\n\n### [2026-01-25] Sesi\u00f3n: Estabilidad, Fixes de UI y Multi-tenencia Estricta\n\n**Prompt:** Soluci\u00f3n a \"Hojas en blanco\", error de carpetas faltantes y limpieza de multi-tenencia (nada por defecto).\n**Resultados:**\n\n- [FIX] **Hojas en Blanco**: `EscrituraController` ahora inicializa p\u00c3\u00a1ginas con `<p></p>` para evitar fallos de renderizado en Tiptap/Quill.\n- [FIX] **Timeline NPE**: Corregido NullPointerException en `BDController.listarPorTipo` cuando `lineaTiempoRepo.findAll()` devolv\u00c3\u00ada elementos nulos.\n- [REFACTOR] **Multi-Tenencia Estricta**:\n  - Eliminadas todas las redirecciones autom\u00c3\u00a1ticas a \"Prime World\".\n  - `Default World` ahora se usa como un cuaderno est\u00c3\u00a1ndar con su propio archivo `.db`.\n  - Limpieza de `DataInitializer`: No se inyectan datos globales al arrancar; cada proyecto es aut\u00c3\u00b3nomo.\n- [LOGS] Creado `Docs/log_prompts.md` y actualizado `Docs/log_errores.md`.\n- [FIX] **Permisos SQLite**: Redirigida la carpeta temporal de SQLite a `./target/sqlite-tmp` para evitar `AccessDeniedException` en entornos Windows restringidos.\n- [CLEANUP] Saneamiento de `DataInitializer.java` eliminando m\u00c3\u00a9todos de inicializaci\u00c3\u00b3n hardcoded.\n- [FIX] **Panel Derecho**: Corregido error de compresi\u00c3\u00b3n mediante `shrink-0` y a\u00c3\u00b1adidos iconos representativos para todos los modos cuando el panel est\u00c3\u00a1 colapsado.\n- [UX] **Estabilidad Visual**: Optimizada la carga inicial de `TimelineView.jsx` para evitar parpadeos y asegurar la selecci\u00c3\u00b3n del proyecto correcto.\n- [FIX] **Jerarqu\u00eda Biblia**: Implementada jerarqu\u00eda plana (Root -> Carpetas -> Entidades). Eliminada la creaci\u00f3n de subcarpetas redundantes.\n- [UX] **Sistema CRUD Biblia**: A\u00f1adido men\u00fa de creaci\u00f3n r\u00e1pida dentro de las carpetas para todos los tipos de entidad (Personajes, Mapas, Lore, etc.).\n- [CLEANUP] **Eliminaci\u00f3n de Self-Healing**: Eliminada toda l\u00f3gica de auto-recuperaci\u00f3n silenciosa en controladores para exponer errores de contexto reales.\n- [FIX] **Gesti\u00f3n Global de Errores**: Implementado `GlobalExceptionHandler.java` para interceptar y limpiar excepciones de Java, devolviendo errores legibles al frontend.\n- [DOCS] **Formalizaci\u00f3n de Reglas**: Creado [00_Reglas_Strictas_Proyecto.md](file:///c:/Users/rober/Desktop/Proyectos propios/WorldbuildingApp/Docs/00_Reglas_Strictas_Proyecto.md) consolidando prohibici\u00f3n de self-healing, jerarqu\u00eda plana y gesti\u00f3n estricta de errores como est\u00e1ndares definitivos del proyecto.\n\n### [2026-01-25] Sesi\u00f3n: Estabilizaci\u00f3n de Biblia (Guardado, Edici\u00f3n y Navegaci\u00f3n)\n\n**Prompt:** Fix urgente de guardado (Error 500) y navegaci\u00f3n rota tras edici\u00f3n.\n**Resultados:**\n\n- [FIX] **LazyInitializationException**: Solucionado error cr\u00edtico 500 al guardar/editar entidades. Implementado helper `hydrateEntity` en `WorldBibleService` para inicializar profundamente (`valores`, `plantilla`, `carpeta`) antes de devolver la respuesta JSON.\n- [FIX] **Navegaci\u00f3n**: Corregida la redirecci\u00f3n tras guardar. Ahora el frontend usa la `carpeta` devuelta por el servidor (ya hidratada) para saber a d\u00f3nde volver, solucionando el bug donde la interfaz de edici\u00f3n no se cerraba si se acced\u00eda desde favoritos/b\u00fasqueda.\n- [UX] **Renombrado**: Corregido evento `Enter` en `FolderItem` para evitar recargas de p\u00e1gina al cambiar nombres de carpeta.\n- [DOCS] Actualizada documentaci\u00f3n t\u00e9cnica con estas soluciones.\n", "03_Hotfix_Logs.md": "# Registro de Hotfixes y Estabilizaci\u00f3n\n\n## Sesi\u00f3n de Estabilizaci\u00f3n Cr\u00edtica (Resoluci\u00f3n de Bugs Multi-Tenant)\n\n### Contexto\n\nSe reportaron errores cr\u00edticos en la gesti\u00f3n de nuevos proyectos: datos que desaparec\u00edan (\"P\u00e9rdida de Carpetas\") y t\u00edtulos que nunca cargaban (\"Cargando... Infinito\").\n\n### Diagn\u00f3stico T\u00e9cnico\n\n1. **Split-Brain Identity (Cruce de Datos)**:\n    * La aplicaci\u00f3n utiliza SQLite Multi-Tenant (`{proyecto}.db`).\n    * `ProjectDiscoveryService` inicializa el DB correctamente (ID 1).\n    * Sin embargo, `EscrituraController` a veces creaba registros duplicados (ID 2, 3...) vac\u00edos.\n    * Los controladores utilizaban `findFirst()` sin orden espec\u00edfico. A veces cargaban el ID 1 (con datos), a veces el ID 2 (vac\u00edo), dando la ilusi\u00f3n de p\u00e9rdida de datos.\n\n2. **Context Switching Fail**:\n    * La conmutaci\u00f3n de bases de datos depend\u00eda impl\u00edcitamente de un Interceptor. En ciertos flujos, este fallaba, escribiendo datos en el DB por defecto (\"Prime World\") en lugar del proyecto seleccionado.\n\n3. **Null Pointer Exception (NPE)**:\n    * Como resultado del Split-Brain, quedaron registros corruptos en la BBDD con `ID = NULL`.\n    * El comparador de ordenaci\u00f3n `Comparator.comparing(Cuaderno::getId)` lanzaba una excepci\u00f3n 500 al encontrar estos nulos, bloqueando el dashboard.\n\n### Soluciones Implementadas\n\n1. **Determinismo en Controladores**:\n    * Se modific\u00f3 `WorldBibleController` y `ProyectoController` para buscar usando `.sorted(Comparator.comparing(Cuaderno::getId))`. Esto prioriza siempre el registro Ra\u00edz (ID 1).\n\n2. **Null Safety**:\n    * Se a\u00f1adi\u00f3 un filtro `.filter(c -> c.getId() != null)` antes de ordenar, inmunizando al servidor contra datos corruptos antiguos.\n\n3. **Sincronizaci\u00f3n Expl\u00edcita**:\n    * Se forz\u00f3 `TenantContext.setCurrentTenant()` en cada operaci\u00f3n cr\u00edtica de escritura, eliminando la dependencia ciega del Interceptor.\n\n### Estado Actual\n\nEl sistema ahora soporta robustamente la creaci\u00f3n y cambio entre m\u00faltiples proyectos/mundos.\n\n## Sesi\u00f3n de Estabilizaci\u00f3n de Persistencia (Lazy Loading y Navegaci\u00f3n)\n\n### Contexto\n\nEl usuario report\u00f3 errores 500 al guardar entidades y fallos de navegaci\u00f3n (\"Interface no se quita\") al editar.\n\n### Diagn\u00f3stico T\u00e9cnico\n\n1. **LazyInitializationException**:\n    * Hibernate devolv\u00eda proxies no inicializados de `Carpeta` y `AtributoPlantilla`.\n    * Al serializar a JSON, Jackson intentaba acceder a ellos fuera de la transacci\u00f3n, lanzando excepci\u00f3n.\n2. **Navigation Breakdown**:\n    * El frontend depend\u00eda de la URL para saber a qu\u00e9 carpeta volver.\n    * Si se acced\u00eda desde \"Favoritos\" o b\u00fasqueda, la URL no ten\u00eda slug de carpeta, rompiendo la redirecci\u00f3n.\n\n### Soluciones Implementadas\n\n1. **Hydration Helper (`hydrateEntity`)**:\n    * M\u00e9todo centralizado en `WorldBibleService` que fuerza `Hibernate.initialize()` en todas las relaciones cr\u00edticas (`valores`, `plantilla`, `carpeta`) antes de cerrar la transacci\u00f3n.\n2. **Server-Side Context**:\n    * El frontend ahora ignora la URL y usa `entity.carpeta` (provista por el servidor) para determinar la redirecci\u00f3n segura.\n\n### Estado Actual\n\nGuardado, Edici\u00f3n, Continuar Editando y Renombrado son totalmente estables.\n", "arquitectura_workspaces.md": "# Arquitectura de Gesti\u00f3n de Proyectos (Workspaces)\n\nEste documento describe la arquitectura t\u00e9cnica para la gesti\u00f3n de m\u00faltiples proyectos (\"Universos\") en la aplicaci\u00f3n, su estado actual y el plan de refactorizaci\u00f3n para eliminar datos simulados (mocks).\n\n## Visi\u00f3n General\n\nLa aplicaci\u00f3n funciona bajo un modelo **Multi-Tenant de Archivo \u00danico**. Cada proyecto es un archivo SQLite independiente (`Proyecto.db`) en la carpeta `src/main/resources/data/`.\n\n### Flujo de Datos Actual (Con Mock Data)\n\n1. **Frontend (`WorkspaceSelector.jsx`)**:\n    * Llama a `GET /api/workspaces`.\n    * Recibe una lista de strings: `[\"Default World\", \"Proyecto X\"]`.\n    * **PROBLEMA**: Genera metadatos falsos (Imagen, T\u00edtulo visual, G\u00e9nero, Tiempo) usando `getMockData(name)` basado en el hash del nombre. Los cambios reales en DB no se ven.\n\n2. **Backend (`WorkspaceController.java`)**:\n    * Endpoint `listWorkspaces()` llama al servicio.\n    * Devuelve `List<String>`.\n\n3. **Servicio (`ProjectDiscoveryService.java`)**:\n    * Escanea la carpeta de datos.\n    * Devuelve nombres de archivos `.db`.\n    * **LIMITACI\u00d3N**: No abre los archivos para leer sus metadatos reales.\n\n## Arquitectura Objetivo (Refactorizada)\n\nEl objetivo es que el frontend sea \"tonto\" y solo renderice lo que el backend le dice.\n\n### 1. Modelo de Datos (DTO)\n\nNueva clase `ProjectMetadataDTO`:\n\n```java\npublic class ProjectMetadataDTO {\n    String filename;   // ID t\u00e9cnico (nombre archivo)\n    String title;      // T\u00edtulo real (ej: \"Las Cr\u00f3nicas de Narnia\")\n    String genre;\n    String imageUrl;\n    String lastModified; // \"Hace 2h\" (Calculado o real)\n    String initials;     // \"LC\"\n}\n```\n\n### 2. Servicio Mejorado (`ProjectDiscoveryService`)\n\n* **M\u00e9todo `listProjectsDetailed()`**:\n  * Itera sobre cada archivo `.db`.\n  * **Conexi\u00f3n JDBC Ef\u00edmera**: Abre una conexi\u00f3n r\u00e1pida a cada BD.\n  * Ejecuta `SELECT titulo, genero, imagen_url, fecha_modificacion FROM cuaderno LIMIT 1`.\n  * Mapea los resultados al DTO.\n  * Menciona: Si falla la lectura, devuelve un DTO con datos por defecto (\"Archivo Corrupto\").\n\n### 3. Limpieza (C\u00f3digo a Eliminar)\n\n* [Frontend] Funci\u00f3n `getMockData()` en `WorkspaceSelector.jsx`.\n* [Frontend] Arrays hardcoded de im\u00e1genes aleatorias.\n* [Frontend] L\u00f3gica de generaci\u00f3n de colores/tags basada en hash.\n\n## Diagrama de Flujo\n\n```mermaid\nsequenceDiagram\n    participant UI as WorkspaceSelector (React)\n    participant API as WorkspaceController\n    participant Service as ProjectDiscoveryService\n    participant FS as FileSystem\n    participant DBs as SQLite Files\n\n    UI->>API: GET /api/workspaces\n    API->>Service: listProjectsDetailed()\n    Service->>FS: List *.db files\n    FS-->>Service: [A.db, B.db]\n    \n    loop Para cada archivo\n        Service->>DBs: Connect to A.db\n        DBs-->>Service: {titulo: \"Alpha\", img: \"url...\"}\n    end\n\n    Service-->>API: List<ProjectMetadataDTO>\n    API-->>UI: JSON Array\n    UI->>UI: Renderizar Lista Real\n```\n\n## Plan de Ejecuci\u00f3n\n\n1. **Backend**: Crear `ProjectMetadataDTO`.\n2. **Backend**: Actualizar `ProjectDiscoveryService` para leer SQLite masivamente.\n3. **Backend**: Actualizar `WorkspaceController` para devolver la lista compleja.\n4. **Frontend**: Eliminar `getMockData` y adaptar `WorkspaceSelector` para usar props reales.\n", "Informe_Tecnico_Inicializacion.md": "# Informe T\u00e9cnico: Discrepancia en Inicializaci\u00f3n de Proyectos\n\n**Fecha:** 25/01/2026\n**Estado:** Resuelto\n**Contexto:** Error cr\u00edtico en la persistencia y recuperaci\u00f3n de datos iniciales (Biblia y Cronolog\u00eda) en nuevos proyectos.\n\n## 1. La Discrepancia Observada\n\nEl sistema mostraba un comportamiento contradictorio:\n\n1. **Logs de Escritura (Service):** Confirmaban una inserci\u00f3n exitosa de datos (`INSERT INTO cuaderno... executed`, `Rows: 1`).\n2. **Logs de Lectura (API/Controller):** Devolv\u00edan listas vac\u00edas o estado 404 inmediatamente despu\u00e9s de la creaci\u00f3n.\n3. **Logs de Base de Datos:** `MultiTenantDataSource` indicaba que se estaba conectando a la base de datos correcta.\n\n## 2. Diagn\u00f3stico y Causas Ra\u00edz\n\n### A. Desalineaci\u00f3n Esquema-Entidad (Causa Principal)\n\nSe identific\u00f3 una ruptura en la consistencia entre el modelo de datos f\u00edsico (SQL) y el modelo l\u00f3gico (Java/Hibernate):\n\n* **SQL (Flyway V1):** Las tablas `carpeta` y `linea_tiempo` inclu\u00edan las columnas `deleted` (BOOLEAN) y `deleted_date` (DATETIME) como parte de la estrategia de borrado l\u00f3gico.\n* **Java (JPA):** Las entidades `Carpeta.java` y `LineaTiempo.java` carec\u00edan de los campos correspondientes y, m\u00e1s cr\u00edticamente, de la anotaci\u00f3n `@SQLRestriction(\"deleted = 0\")`.\n\n**Efecto:** Aunque los datos se insertaban (con SQL nativo en `ProjectDiscoveryService`), Hibernate no gestionaba correctamente el ciclo de vida de estos registros en consultas subsiguientes, y exist\u00eda el riesgo latente de recuperar datos \"borrados\" o fallar en operaciones que esperaban la columna.\n\n### B. Conflicto de Rutas y Migraciones (Flyway)\n\n* **Problema:** Flyway estaba configurado para leer migraciones desde `classpath:db/migration`, lo que provocaba que leyera versiones cacheadas o incompletas de los scripts SQL en lugar de los archivos fuente editados en tiempo real.\n* **Efecto:** En algunos intentos, la base de datos se creaba sin las columnas `deleted`, provocando fallos silenciosos en inserciones o lecturas inconsistentes.\n* **Soluci\u00f3n:** Se forz\u00f3 el uso de `filesystem:src/main/resources/db/migration` y se consolid\u00f3 el esquema en un \u00fanico archivo `V1__Initial_Schema.sql`.\n\n### C. Silenciamiento de Logs\n\n* **Problema:** El uso de `System.out.println` no garantizaba la aparici\u00f3n de trazas en el log del servidor gestionado por Spring Boot/Tomcat.\n* **Soluci\u00f3n:** Se migr\u00f3 a `SLF4J` (Logger) en `ProjectDiscoveryService` y `MultiTenantDataSource`, revelando la ruta exacta de los archivos `.db` y confirmando la unificaci\u00f3n de contextos.\n\n## 3. Conclusiones y Soluci\u00f3n Final\n\nLa discrepancia no era un fallo \u00fanico, sino una cadena de fallos de configuraci\u00f3n e integridad:\n\n1. **Consistencia SQL/Java:** Es imperativo que cualquier cambio en scripts de Flyway se refleje inmediatamente en las Entidades JPA. Se a\u00f1adieron los campos `deleted` y las anotaciones `@SQLDelete` y `@SQLRestriction`.\n2. **Atomicidad de Migraciones:** Para desarrollo local, es m\u00e1s seguro consolidar migraciones en un archivo maestro (V1) que manejar m\u00faltiples deltas peque\u00f1os que pueden desincronizarse.\n3. **Gesti\u00f3n de Rutas:** La resoluci\u00f3n de la ruta de la base de datos SQLite debe ser id\u00e9ntica para el servicio de creaci\u00f3n y el DataSource din\u00e1mico. Se verific\u00f3 que l\u00f3gica coincida.\n\n## 4. Estado Actual\n\nEl sistema ahora crea proyectos (\"Genesis\", \"PathFinal2\") con toda su estructura de carpetas y l\u00edneas de tiempo iniciales correctamente persistidas y accesibles v\u00eda API.\n", "log_errores.md": "# ERROR REPORT (Global Window Error)\n\n**Timestamp:** 2026-01-25T21:27:58.345882300\n**Message:** Uncaught TypeError: handleCreateEntity is not a function\n\n## Stack Trace\n\n```\nTypeError: handleCreateEntity is not a function\n    at onClick (http://localhost:3000/jsx/pages/ProjectView.jsx:124:54)\n    at HTMLUnknownElement.callCallback2 (http://localhost:3000/@fs/C:/Users/rober/Desktop/Proyectos%20propios/WorldbuildingApp/node_modules/.vite/deps/chunk-WAQW2HX5.js?v=87508fa8:3215:22)\n    at Object.invokeGuardedCallbackDev (http://localhost:3000/@fs/C:/Users/rober/Desktop/Proyectos%20propios/WorldbuildingApp/node_modules/.vite/deps/chunk-WAQW2HX5.js?v=87508fa8:3240:24)\n    at invokeGuardedCallback (http://localhost:3000/@fs/C:/Users/rober/Desktop/Proyectos%20propios/WorldbuildingApp/node_modules/.vite/deps/chunk-WAQW2HX5.js?v=87508fa8:3274:39)\n    at invokeGuardedCallbackAndCatchFirstError (http://localhost:3000/@fs/C:/Users/rober/Desktop/Proyectos%20propios/WorldbuildingApp/node_modules/.vite/deps/chunk-WAQW2HX5.js?v=87508fa8:3277:33)\n    at executeDispatch (http://localhost:3000/@fs/C:/Users/rober/Desktop/Proyectos%20propios/WorldbuildingApp/node_modules/.vite/deps/chunk-WAQW2HX5.js?v=87508fa8:6557:11)\n    at processDispatchQueueItemsInOrder (http://localhost:3000/@fs/C:/Users/rober/Desktop/Proyectos%20propios/WorldbuildingApp/node_modules/.vite/deps/chunk-WAQW2HX5.js?v=87508fa8:6577:15)\n    at processDispatchQueue (http://localhost:3000/@fs/C:/Users/rober/Desktop/Proyectos%20propios/WorldbuildingApp/node_modules/.vite/deps/chunk-WAQW2HX5.js?v=87508fa8:6586:13)\n    at dispatchEventsForPlugins (http://localhost:3000/@fs/C:/Users/rober/Desktop/Proyectos%20propios/WorldbuildingApp/node_modules/.vite/deps/chunk-WAQW2HX5.js?v=87508fa8:6594:11)\n    at http://localhost:3000/@fs/C:/Users/rober/Desktop/Proyectos%20propios/WorldbuildingApp/node_modules/.vite/deps/chunk-WAQW2HX5.js?v=87508fa8:6718:20\n```\n\n# ERROR REPORT (LazyLoading + Schema Mismatch)\n\n**Timestamp:** 2026-01-25T21:24:51.520+01:00\n**Message:** SQL error or missing database (no such column: ap1_0.descripcion)\n**Context:** Favorites Implementation / Template Inheritance\n\n## Details\n\n1. **LazyInitializationException**: `getAllInheritedTemplates` failed because `Carpeta` was accessed outside transaction when loading templates recursively.\n   - **Fix**: Added `@Transactional(readOnly = true)` and an overload accepting `folderId` to ensure a connected session.\n2. **Schema Mismatch**: `AtributoPlantilla` entity had `private String descripcion;` but `V1__Initial_Schema.sql` did not have the column.\n   - **Fix**: Added `descripcion TEXT` to `V1__Initial_Schema.sql` and forced project recreation (reset via API script).\n   - **LazyInit Context**: `@JsonIgnore` caused data loss (user reported unsaved data).\n   - **LazyInit Fix (List)**: Created `getEntitiesInFolder` with transaction.\n   - **LazyInit Fix (Single)**: Created `getEntity(idOrSlug)` with transaction to fix `GET /entities/{slug}` returning 500, which caused \"undefined\" IDs in Frontend and failed saves.\n\n## Frontend Resolution\n\n- **Msg**: `TypeError: handleCreateEntity is not a function`. (Fixed in Frontend).\n- **Msg**: `LazyInitializationException` on `Entity.carpeta` / `Entity.plantilla`.\n- **Fix**: Created `WorldBibleService.hydrateEntity` to force partial graph loading inside transaction.\n- **Msg**: Navigation failure after Save (Stuck in editor).\n- **Fix**: Frontend now uses `entity.carpeta` from server response to determine redirect target, handling \"Search/Favorite\" context loss.\n\n```\norg.hibernate.exception.GenericJDBCException: could not prepare statement [[SQLITE_ERROR] SQL error or missing database (no such column: ap1_0.descripcion)]\n    at org.hibernate.exception.internal.StandardSQLExceptionConverter.convert(StandardSQLExceptionConverter.java:63)\n    ...\n```\n", "log_prompts.md": "# LOG PROMPTS\n\n## [2026-01-25] Strict Multi-Tenancy Cleanup\n\n- **Goal**: Remove all hardcoded fallbacks to \"Prime World\" or special treatment for \"Default World\".\n- **Action**:\n  - Modified `WorldBibleController.java` to strictly follow session.\n  - Modified `EscrituraController.java` to remove `Default World` redirection.\n  - Modified `TimelineController.java` to remove auto-creation of `Prime World` metadata.\n  - Modified `DataInitializer.java` to stop context forcing on startup.\n- **Status**: Completed. Projects are now isolated in their own SQLite files based on session name.\n\n## [2026-01-25] Project Conditions Formalization\n\n- **Goal**: Document strict development rules (No self-healing, Global error control, Flat Hierarchy).\n- **Action**: Created `04_Reglas_Strictas_Proyecto.md` and updated `01_Estrategia_y_Roadmap.md`.\n- **Status**: Completed. Strict rules enforced across the codebase.\n\n## [2026-01-25] Ultra-minimal Error Reporting\n\n- **Goal**: Simplify error messages to show only numbers (status codes) and routes/actions, reducing terminal noise.\n- **Action**:\n  - Refactored `GlobalExceptionHandler.java` to return `{ \"status\": X, \"path\": \"METHOD /uri\" }`.\n  - Created `UnauthorizedException` and `ResourceNotFoundException`.\n  - Refactored `ProjectSessionInterceptor.java` and Controllers to remove verbose logs and throw typed exceptions.\n- **Status**: Completed. Terminal now shows clean entries like `!!! [ERR] 401 GET /api/world-bible/folders`.\n\n## [2026-01-25] Notebook Hover CRUD System\n\n- **Goal**: Implement Edit/Delete actions for notebooks visible on hover.\n- **Action**:\n  - **Backend**: Added `PUT /api/escritura/cuaderno/{id}` to `EscrituraController`.\n  - **Frontend**: Updated `NotebookGrid` to show actions on hover and handle interactions.\n  - **Frontend**: Connected logic in `WritingView` to handle updates via API.\n- **Status**: Completed. Users can now rename and delete notebooks directly from the dashboard card.\n\n## [2026-01-25] Visual Bug Fixes (Timeline & Writing)\n\n- **Goal**: Fix right panel auto-expanding in Timeline and Index persistence in Writing view.\n- **Action**:\n  - **TimelineView**: Removed `setRightOpen(true)` on mount to respect user preference.\n  - **ArchitectLayout**: Refactored Right Panel Portal to persist in DOM (hidden) when collapsed, preventing Writing Index desync.\n\n## [2026-01-25] Timeline & Project Atomic Fixes\n\n- **Goal**: Resolve \"Project p 404\" (Empty DB) and \"Timeline CRUD Failed\" (SQL Column Mismatch).\n- **Action**:\n  - **Security/Strictness**: Reverted \"Auto-Repair\" in `ProyectoController` to comply with No-Self-Healing rule.\n  - **Project Creation**: Refactored `ProjectDiscoveryService` to ensure ATOMIC creation. If seeding fails, the `.db` file is deleted (preventing zombie empty projects).\n  - **Timeline CRUD**: Diagnosis showed `no such column: u1_0.cuaderno_id`. Fixed `Universo.java` mapping to use `proyecto_id` instead of `cuaderno_id` to match Flyway V1 schema.\n- **Status**: Completed. Timeline creation verified after compilation. Zombie projects prevented by new atomic logic.\n\n## [2026-01-25] Multiverse System & UI Polish\n\n- **Goal**: Implement \"Multiverse\" hierarchy (Universe -> Timelines) and fix navigation context.\n- **Action**:\n  - **Backend**: Verified `UniversoController` and `LineaTiempo` entity mapping.\n  - **Migration**: Added `V2__Add_Relacion.sql` to fix missing table usage.\n  - **Frontend**: integrated `TimelineView` with Multiverse API. Created unified \"3-Tab\" layout (`Eventos`, `Anexos`, `Universo`).\n  - **UI**: Added Dynamic Header Subtitle (\"L\u00cdNEA DE TIEMPO\" + Name) and unified navigation logic to prevent context loss.\n- **Status**: Completed. Verified via Stress Test V3 (Browser). Creation, Deletion and Navigation fully functional.\n\n## [2026-01-25] Favorites Implementation\n\n- **Goal**: Add \"Favorites\" section to Sidebar and allow toggling favorites in Context Menu.\n- **Action**:\n  - **Backend**: Added `favorite` boolean to Entity schema. Fixed `LazyInitializationException` by adding Transactional Service method.\n  - **Backend Fix**: Fixed `SQLITE_ERROR` (missing `descripcion` column) by updating `V1__Initial_Schema.sql`.\n  - **Frontend**: Integrated Favorites list in `WorldBibleView` and Context Menu action.\n- **Status**: Completed. Verified via `verify_favorites.ps1` (API Test).\n\n## [2026-01-26] Stabilization Phase (Entity Persistence & UX)\n\n- **Goal**: Resolve critical 500 Errors during Save/Edit and fix broken navigation in Editor.\n- **Action**:\n  - **Backend**: Implemented `hydrateEntity` in Service to fix `LazyInitializationException` by deep-loading relationships (`valores`, `plantilla`, `carpeta`) before serialization.\n  - **Frontend**: Updated `EntityBuilder.jsx` to use server-provided `carpeta` data for redirection fallback, enabling \"Save and Continue\" and \"Save and Exit\" to work reliably from any context (Search/Favorites).\n  - **Frontend**: Fixed `Enter` key in `FolderItem` (Renaming) to prevent page reload.\n- **Status**: Completed. Verified via Manual Testing (Create, Edit, Rename, Save & Continue).\n", "Migracion_Hibernate_Where.md": "# Registro de Refactorizaci\u00f3n: Migraci\u00f3n Hibernate @Where\n\n**Fecha:** 25/01/2026\n**Tipo de Cambio:** Refactorizaci\u00f3n T\u00e9cnica / Eliminaci\u00f3n de Deuda T\u00e9cnica\n**Estado:** Completado\n\n## Contexto\n\nHibernate 6.3 marc\u00f3 como obsoleta (deprecated) la anotaci\u00f3n `@Where`, recomendando el uso de `@SQLRestriction` para definir filtros SQL a nivel de entidad.\n\n## Cambio Implementado\n\nSe ha reemplazado sistem\u00e1ticamente la anotaci\u00f3n:\n\n```java\n@Where(clause = \"deleted = false\")\n```\n\nPor la nueva sintaxis est\u00e1ndar:\n\n```java\n@SQLRestriction(\"deleted = 0\")\n```\n\n**Nota sobre la sintaxis:** Se utiliza expl\u00edcitamente `deleted = 0` en lugar de `false` para garantizar la compatibilidad total con el dialecto de SQLite, que almacena los valores booleanos como enteros (`0`/`1`).\n\n## Archivos Afectados\n\nLa migraci\u00f3n se aplic\u00f3 a las siguientes entitades del paquete `com.worldbuilding.app.model`:\n\n1. `Zona.java`\n2. `NotaRapida.java`\n3. `Interaccion.java`\n4. `Hoja.java`\n5. `EntidadIndividual.java`\n6. `EntidadGenerica.java`\n7. `EntidadColectiva.java`\n8. `Efectos.java`\n9. `Construccion.java`\n\n*Nota: `Carpeta.java` y `Cuaderno.java` ya contaban con la configuraci\u00f3n correcta previamente.*\n\n## Verificaci\u00f3n\n\n* Se realiz\u00f3 una b\u00fasqueda global (`grep`) para asegurar que no quedaban referencias a `@Where`.\n* El proyecto compila correctamente (`mvn compile`), confirmando que las nuevas anotaciones son v\u00e1lidas y reconocidas.\n"};
        const sidebarNav = document.getElementById('sidebarNav');
        const markdownBody = document.getElementById('markdownBody');
        const mainTitle = document.getElementById('mainTitle');
        const searchInput = document.getElementById('searchInput');

        function renderFile(name) {
            const content = docs[name];
            mainTitle.innerText = name.replace('.md', '').replaceAll('_', ' ');
            
            markdownBody.innerHTML = marked.parse(content);

            document.querySelectorAll('.nav-link').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.name === name);
            });
            
            window.scrollTo(0, 0);
        }

        function init() {
            const files = Object.keys(docs).sort();
            
            files.forEach(name => {
                const a = document.createElement('a');
                a.className = 'nav-link';
                a.href = '#';
                a.dataset.name = name;
                a.innerText = name.replace('.md', '').replaceAll('_', ' ');
                a.onclick = (e) => {
                    e.preventDefault();
                    renderFile(name);
                };
                sidebarNav.appendChild(a);
            });

            if (files.length > 0) {
                const priority = files.find(f => f.includes('manifiesto')) || files.find(f => f.includes('log_prompts')) || files[0];
                renderFile(priority);
            }
            
            searchInput.oninput = (e) => {
                const term = e.target.value.toLowerCase();
                document.querySelectorAll('.nav-link').forEach(link => {
                    const text = link.innerText.toLowerCase();
                    link.style.display = text.includes(term) ? 'block' : 'none';
                });
            };
        }

        init();
    </script>
</body>
</html>
