
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wikipedia - Documentación Técnica</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Libre+Baskerville:wght@400;700&family=Noto+Sans:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            background-color: #f6f6f6;
            font-family: 'Noto Sans', sans-serif;
            color: #202122;
            margin: 0;
            padding: 0;
        }
        .mw-body {
            background-color: #ffffff;
            border: 1px solid #a7d7f9;
            border-right-width: 0;
            margin-left: 11rem;
            padding: 1.25rem 1.5rem 1.5rem 1.5rem;
            min-height: 100vh;
        }
        .mw-header {
            font-family: 'Libre Baskerville', serif;
            border-bottom: 1px solid #a2a9b1;
            margin-bottom: 0.25em;
            padding-top: 0.5em;
            font-size: 1.8em;
            font-weight: normal;
        }
        .mw-sidebar {
            width: 11rem;
            position: absolute;
            left: 0;
            top: 0;
            padding: 1rem 0.5rem;
        }
        .sidebar-logo {
            text-align: center;
            margin-bottom: 1.5rem;
        }
        .sidebar-logo span {
            font-family: 'Libre Baskerville', serif;
            font-size: 1.2rem;
            display: block;
        }
        .sidebar-logo small {
            font-size: 0.7rem;
            color: #54595d;
            text-transform: uppercase;
        }
        .nav-link {
            color: #0645ad;
            font-size: 0.85rem;
            display: block;
            padding: 0.2rem 0.5rem;
            text-decoration: none;
        }
        .nav-link:hover {
            text-decoration: underline;
        }
        .nav-link.active {
            color: #202122;
            font-weight: bold;
            border-left: 2px solid #3366cc;
            background: #f8f9fa;
        }
        
        /* Markdown Content Styling */
        #markdownBody h1 { font-family: 'Libre Baskerville', serif; font-size: 1.8em; border-bottom: 1px solid #a2a9b1; margin: 1em 0 0.25em; font-weight: normal; }
        #markdownBody h2 { font-family: 'Libre Baskerville', serif; font-size: 1.5em; border-bottom: 1px solid #a2a9b1; margin: 1.5em 0 0.25em; font-weight: normal; }
        #markdownBody h3 { font-size: 1.2em; font-weight: bold; margin: 1.2em 0 0.25em; }
        #markdownBody p { margin: 0.5em 0 1em; line-height: 1.6; font-size: 0.95rem; }
        #markdownBody ul { list-style-type: disc; margin-left: 2rem; margin-bottom: 1rem; }
        #markdownBody li { margin-bottom: 0.3em; font-size: 0.95rem; }
        #markdownBody a { color: #0645ad; text-decoration: none; }
        #markdownBody a:hover { text-decoration: underline; }
        #markdownBody code { background-color: #f8f9fa; border: 1px solid #eaecf0; padding: 0.1em 0.3em; border-radius: 2px; font-family: monospace; font-size: 0.9em; }
        #markdownBody pre { background-color: #f8f9fa; border: 1px solid #eaecf0; padding: 1em; margin: 1em 0; overflow-x: auto; border-radius: 2px; }
        #markdownBody blockquote { border-left: 4px solid #eaecf0; padding-left: 1em; color: #54595d; font-style: italic; margin: 1em 0; }
        
        .toc {
            background-color: #f8f9fa;
            border: 1px solid #a2a9b1;
            padding: 0.5rem;
            display: inline-block;
            min-width: 200px;
            margin-bottom: 1.5rem;
            font-size: 0.85rem;
        }
        .toc-title {
            text-align: center;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }
    </style>
</head>
<body>

    <aside class="mw-sidebar">
        <div class="sidebar-logo">
            <span>Enciclopedia</span>
            <small>Libre de Desarrollo</small>
        </div>
        
        <div class="mb-4">
            <h4 class="text-[0.75rem] font-bold text-[#54595d] px-2 mb-1 border-b border-[#eaecf0] uppercase tracking-tighter">Navegación</h4>
            <nav id="sidebarNav">
                <!-- Nav items here -->
            </nav>
        </div>
        
        <div class="mt-8 px-2">
            <input id="searchInput" type="text" placeholder="Buscar en Docs..." class="w-full text-xs border border-[#a2a9b1] p-1 outline-none focus:border-[#3366cc]">
        </div>
    </aside>

    <main class="mw-body">
        <div class="flex justify-between items-start mb-4">
            <h1 id="mainTitle" class="mw-header">Cargando...</h1>
            <div class="text-[0.8rem] space-x-2">
                <button onclick="window.print()" class="text-[#0645ad] hover:underline">Imprimir</button>
            </div>
        </div>

        <div id="contentArea">
            <div id="markdownBody">
                <!-- Body content here -->
            </div>
        </div>
        
        <footer class="mt-12 pt-4 border-t border-[#a2a9b1] text-[0.75rem] text-[#54595d]">
            <p>Esta página fue editada por última vez por Antigravity (IA) el 22/01/2026.</p>
            <p>El texto está disponible bajo la Licencia Creative Commons Atribución Compartir Igual 3.0.</p>
        </footer>
    </main>

    <script>
        const docs = {"01_Estrategia_y_Roadmap.md": "# Manifiesto del Proyecto: Chronos Atlas (WorldbuildingApp)\n\n## 1. Visi\u00f3n y Prop\u00f3sito\n**Chronos Atlas \"Next\"** es un entorno modular de construcci\u00f3n de mundos profesional. Abandonamos las categor\u00edas r\u00edgidas por un sistema de **Bible Bible Din\u00e1mica** basada en carpetas y un **Entity Builder Universal** que permite a los autores definir cada detalle de su mundo con flexibilidad total.\n\n---\n\n## 2. Estrategia T\u00e9cnica\n*   **Core:** Java Spring Boot (v2 Refactor).\n*   **Frontend:** HTML5, CSS3 (Vanilla + Tailwind CSS), JavaScript. Est\u00e9tica **Dark Glassmorphism**.\n*   **Base de Datos:** SQLite local. Portabilidad total mediante archivo `.db`.\n*   **Arquitectura:** Modular y desacoplada, preparada para expansi\u00f3n a sincronizaci\u00f3n en la nube (PostgreSQL/Supabase).\n\n---\n\n## 3. Sistema de Dise\u00f1o (UI Kit: \"Arcane Void\")\nEl dise\u00f1o busca un equilibrio entre la claridad de un IDE moderno y la m\u00edstica de un antiguo estudio de alquimia.\n\n*   **Paleta de Colores:**\n    - **Void Dark:** `#09090b` (Fondo profundo).\n    - **Glass Border:** `rgba(255, 255, 255, 0.05)`.\n    - **Accent Indigo:** `#6366f1` (Primario).\n    - **Accent Emerald:** `#10b981` (Secundario).\n    - **Parchment White:** `#fafafa` (Texto).\n*   **Tipograf\u00eda:**\n    *   **UI/Sistemas:** `Outfit` / `Inter` (Sans-serif limpia).\n    *   **Lectura/Escritura:** `Cormorant Garamond` / `Playfair Display` (Serif elegante para inmersi\u00f3n profunda).\n\n---\n\n## 4. Mapa de Funcionalidades (Roadmap & Status)\n\n### A. Entorno Modular [COMPLETADO]\n*   **3-Panel Layout**: Explorador jer\u00e1rquico, Lienzo Central y Caja de Atributos.\n*   **Navigation Dock**: Barra flotante inferior con desenfoque.\n\n### B. Biblia del Mundo Din\u00e1mica [COMPLETADO]\n*   **Carpetas Hier\u00e1rquicas**: Organizaci\u00f3n libre de lore.\n*   **Attribute Inheritance**: Las carpetas definen la estructura de las entidades hijas.\n\n### C. Entity Builder [COMPLETADO]\n*   **Drag & Drop**: Construcci\u00f3n de fichas mediante bloques de atributos.\n*   **Pesta\u00f1as Contextuales**: Mapas y Cronolog\u00edas integradas directamente en las fichas.\n\n---\n\n## 5. Filosof\u00eda de Desarrollo\n1.  **Cero Distracci\u00f3n:** El autor no debe abandonar el teclado. Los comandos y atajos de teclado son prioridad.\n2.  **Contexto es Rey:** La informaci\u00f3n del mundo debe fluir hacia el texto, no al rev\u00e9s.\n3.  **Local-First:** Tus datos son tuyos. La sincronizaci\u00f3n es una opci\u00f3n, no un requisito.\n\n## Estado Actual (2026-01-07)\n- [x] **Fase de Estabilidad Core**: Completada. Persistencia de datos asegurada y esquema multi-tenant funcional.\n- [x] **Seguridad**: Configurada para desarrollo fluido (PermitAll) sin comprometer la activaci\u00c3n de sesiones de proyecto.\n- [x] **UI/UX Biblia**: Entity Builder optimizado con controles en cabecera y visualizaci\u00c3n corregida.\n\n# Plan Maestro de Migraci\u00f3n de Stack Tecnol\u00f3gico (Worldbuilding)\n\nEste documento define la evoluci\u00f3n tecnol\u00f3gica de **WorldbuildingApp** para convertirse en un ecosistema profesional, escalable y flexible, adaptado a la arquitectura existente.\n\n---\n\n## 01. Estabilidad de Datos (Base de Datos)\n**Decisi\u00f3n:** **Flyway** (Migraciones Versionadas).\n\n*   **Problema Cr\u00edtico**: `ddl-auto=create` borra los datos. `update` es impredecible con SQLite.\n*   **Soluci\u00f3n**: Flyway toma el control.\n    *   **Configuraci\u00f3n**: `spring.jpa.hibernate.ddl-auto=validate`. Hibernate solo verifica, no toca.\n    *   **Migraciones**: Scripts SQL manuales en `src/main/resources/db/migration`.\n    *   **Beneficio**: Historial exacto de cambios, cero riesgo de borrado accidental.\n\n---\n\n## 02. Arquitectura de Datos: Evoluci\u00f3n H\u00edbrida (JSON)\n**Decisi\u00f3n:** Integrar Columna JSON en la Entidad Existente.\n\n*   **Situaci\u00f3n Actual**: Tienes `EntidadGenerica` conectada a `AtributoValor` (tabla separada). Esto es r\u00edgido y costoso (muchos JOINs).\n*   **Estrategia de Adaptaci\u00f3n**:\n    *   **No borrar lo existente**: Mantener `EntidadGenerica` como base.\n    *   **Evoluci\u00f3n**: A\u00f1adir columna `attributes` (JSON) a `EntidadGenerica`.\n    \n    ```java\n    // En EntidadGenerica.java\n    @JdbcTypeCode(SqlTypes.JSON)\n    @Column(name = \"json_attributes\", columnDefinition = \"JSON\")\n    private Map<String, Object> attributes = new HashMap<>();\n    ```\n    \n    *   **Resultado**: Las nuevas funcionalidades (ej: \"Da\u00f1o de Fuego\", \"Clima\") se guardar\u00e1n en este JSON. Lo antiguo (`AtributoValor`) puede coexistir o migrarse gradualmente, sin romper la app hoy.\n\n---\n\n## 03. Motor de Visualizaci\u00f3n (Grafos)\n**Decisi\u00f3n:** **Cytoscape.js**.\n\n*   **Objetivo**: Visualizar miles de nodos (`EntidadGenerica` convertida a Nodos de Grafo) con alto rendimiento.\n*   **Implementaci\u00f3n**: Componente React `GraphCanvas` que consume el JSON de entidades.\n\n---\n\n## 04. Editor de \"Hojas\" (Rich Text & Lore)\n**Decisi\u00f3n:** **TipTap** (Headless Editor).\n\n*   **Funcionalidad**: Sistema de menciones (`[[`) que busca en la tabla `entidad_generica` por ID/Slug, permitiendo renombres autom\u00e1ticos sin romper enlaces.\n\n---\n\n## 05. UI y Layout\n**Decisi\u00f3n:** **Tailwind CSS** + **Shadcn/ui** + **React-Resizable-Panels**.\n*   Para acomodar Mapa, Editor y Ficha en una sola vista flexible.\n\n---\n\n## 06. Gesti\u00f3n de Estado\n*   **TanStack Query**: Cach\u00e9 inteligente para los datos de `EntidadGenerica`.\n*   **Zustand**: Gesti\u00f3n de filtros globales de UI.\n\n---\n\n## 07. Despliegue (Desktop)\n*   **Electron**: Empaquetar Spring Boot (`.jar`) + React en un ejecutable \u00fanico (`.exe`) con JRE embebido.\n\n---\n\n## Pr\u00f3ximos Pasos\n\ud83d\udd34 **EN ESPERA DE ORDEN \"YA\"**\n1. Configurar Flyway (Prioridad de Seguridad).\n2. A\u00f1adir columna JSON a `EntidadGenerica`.\n3. Comenzar migraci\u00f3n Frontend (Cytoscape).\n# Chronos Atlas: El IDE del Escritor (Redise\u00f1o \"Next\")\n\nChronos Atlas evoluciona hacia un entorno de trabajo a\u00fan m\u00e1s potente y flexible, donde la narrativa y el lore se integran de forma fluida a trav\u00e9s de un dise\u00f1o **Glassmorphism Oscuro** de alta fidelidad. El nuevo paradigma se basa en un espacio de trabajo modular de tres paneles flanqueado por una navegaci\u00f3n tipo dock.\n\n## 1. Biblia del Mundo (Panel Lateral Izquierdo)\n\n### Estructura de Carpetas Personalizable\n- **Prop\u00f3sito**: Sustituir las categor\u00edas fijas por una estructura de carpetas completamente personalizable, permitiendo una organizaci\u00f3n jer\u00e1rquica y tem\u00e1tica de tu lore.\n- **Qu\u00e9 puedes hacer**:\n    - **Crear Carpetas y Subcarpetas**: Un bot\u00f3n o un men\u00fa contextual (clic derecho) permite crear nuevas carpetas. Se pueden anidar para construir una estructura tan compleja como necesites (ej. \"Personajes de Eldoria\" dentro de \"Eldoria\").\n    - **Nombrar Carpetas**: Asigna nombres descriptivos (\"Lugares Importantes\", \"Deidades Antiguas\").\n    - **Arrastrar y Soltar**: Mueve libremente entidades y carpetas para reorganizar tu mundo.\n    - **Atributos Globales**: Los atributos ahora se gestionan de forma global para todo el proyecto desde el `TemplateManager`, permitiendo reutilizar plantillas (ej. \"Rango\", \"Clima\") en cualquier entidad sin depender de su carpeta.\n    - **Visualizaci\u00f3n**: Cada carpeta muestra iconos claros con acentos Indigo-500 al seleccionar.\n- **Dise\u00f1o**: Barra lateral transl\u00facida con \u00e1rbol de navegaci\u00f3n expandible y men\u00fas contextuales para Renombrar, Eliminar o A\u00f1adir Atributos.\n\n## 2. Constructor Universal de Fichas (\u00c1rea Central)\n\n### Lienzo Flexible y Arrastrar y Soltar Atributos\n- **Prop\u00f3sito**: El \u00e1rea central se transforma en un lienzo din\u00e1mico para construir fichas de entidad \u00fanicas, adapt\u00e1ndose a las necesidades de cada elemento de tu mundo.\n- **Qu\u00e9 puedes hacer**:\n    - **Campos por Defecto**: Al crear una entidad, el lienzo se precarga autom\u00e1ticamente con los atributos definidos en la carpeta padre.\n    - **Caja de Herramientas de Atributos**: El panel lateral derecho se transforma en una biblioteca de \"cajas\" de atributos arrastrables cuando el constructor est\u00e1 activo.\n    - **Tipos de Atributos**:\n        - **Texto Libre**: Para biograf\u00edas descripciones extensas.\n        - **Texto Corto**: Para nombres o t\u00edtulos.\n        - **N\u00famero**: Para edad, poblaci\u00f3n, tama\u00f1o.\n        - **Fecha/Hora**: Para eventos cronol\u00f3gicos precisos.\n        - **Selector (Dropdown)**: Para listas predefinidas (ej. \"Estado: Vivo/Muerto\").\n        - **Enlace a Entidad**: Para vincular personajes, lugares u objetos entre s\u00ed.\n        - **Imagen/Multimedia**: Para retratos o arte conceptual.\n        - **Booleano (S\u00ed/No)**: Para propiedades simples.\n        - **Tabla**: Para estad\u00edsticas, inventarios o datos estructurados.\n        - **Mapa Embedido**: Vincula una secci\u00f3n del atlas directamente a la ficha.\n        - **L\u00ednea de Tiempo Embedida**: Muestra una mini-cronolog\u00eda espec\u00edfica del elemento.\n- **Configuraci\u00f3n**: Cada caja de atributo permite renombrar etiquetas, establecer valores por defecto, marcarlos como obligatorios o a\u00f1adir descripciones de ayuda.\n\n## 3. Entidades Especializadas y Pesta\u00f1as de Funci\u00f3n\n\n### Flujo en Dos Pasos (Post-Guardado)\n- **Paso 1: Atributos B\u00e1sicos**: Se definen los atributos generales y se cataloga la entidad (Personaje, Lugar, etc., o tipos especiales como **L\u00ednea de Tiempo**, **Zona/Mapa** o **Lenguaje**).\n- **Paso 2: Pesta\u00f1as de Funciones Especiales**: Al detectar un tipo especializado, el \u00e1rea central habilita pesta\u00f1as superiores con herramientas espec\u00edficas:\n    - **Pesta\u00f1a \"Cronolog\u00eda\"**: Cargar\u00e1 el interfaz del M\u00f3dulo Cronol\u00f3gico Interconectado (para entidades tipo L\u00ednea de Tiempo).\n    - **Pesta\u00f1a \"Cartograf\u00eda\"**: Cargar\u00e1 el Editor de Mapas y Herramientas de Dibujo (para para entidades tipo Zona/Mapa).\n    - **Pesta\u00f1a \"Taller Ling\u00fc\u00edstico\"**: Cargar\u00e1 las herramientas de Conlangs (L\u00e9xico, Gram\u00e1tica, Editor de Glifos) para entidades tipo Lenguaje.\n- **Coherencia**: Siempre se puede volver a la pesta\u00f1a **\"Atributos\"** para modificar la ficha base. El dise\u00f1o mantiene el Glassmorphism con pesta\u00f1as resaltadas en Indigo-500.\n\n## 4. Unificaci\u00f3n del Espacio de Trabajo\n\nEl nuevo paradigma unifica todas las pantallas clave bajo la estructura de tres paneles:\n- **Explorador (Biblia)** a la izquierda.\n- **Lienzo de Trabajo (Vistas Centrales)**:\n    - **Ficha de Entidad**: Visualizaci\u00f3n y edici\u00f3n de atributos y contenido anidado.\n    - **Editor Gr\u00e1fico Vers\u00e1til**: Lienzo vectorial para s\u00edmbolos y logogramas.\n    - **Gesti\u00f3n de Territorios**: Listado y gesti\u00f3n geopol\u00edtica de biomas y asentamientos.\n    - **Mapa Interactivo**: Navegaci\u00f3n y colocaci\u00f3n de pines sobre el atlas.\n    - **Visualizaci\u00f3n de Grafo**: Lienzo din\u00e1mico de relaciones entre entidades.\n- **Contexto (Escritura/Atributos)** a la derecha.\n\n---\n\n### 5. Pantalla de Bienvenida a Nuevo Cuaderno\n- **Prop\u00f3sito**: Guiar al usuario en la configuraci\u00f3n inicial y ofrecer acceso r\u00e1pido a acciones clave.\n- **Dise\u00f1o**:\n    - **Central/Horizontal**: T\u00edtulo de bienvenida, mensajes motivadores y tarjetas de acci\u00f3n destacadas (\"A\u00f1adir Primera Entidad\", \"Crear Primer Mapa\", \"Empezar a Escribir\", \"Ver Ideas R\u00e1pidas\").\n    - **Visualizaci\u00f3n**: Ocupa el \u00e1rea central manteniendo visibles los paneles laterales y la navegaci\u00f3n superior. Estilo Glassmorphism Oscuro.\n\n### 6. Creaci\u00f3n y Edici\u00f3n de Mapas (Implementado)\n- **Editor de Mapas (`MapEditor.jsx`)**:\n    - **Panel Derecho Global**: Integrado con dise\u00f1o de Acorde\u00f3n de 3 secciones:\n        1.  **Identidad**: Nombre, Tipo (Regional, Mundo, etc.).\n        2.  **Sistema de Rejilla**: Toggle On/Off y Slider de tama\u00f1o (px).\n        3.  **Lienzo**: Dimensiones (Ancho/Alto) y Subida de Imagen de Fondo.\n    - **Sincronizaci\u00f3n**: Los cambios en el panel derecho se reflejan instant\u00e1neamente en el lienzo central.\n    - **Flujo de Guardado**: Al guardar cambios, el sistema redirige autom\u00e1ticamente a la carpeta contenedora para facilitar el flujo de trabajo.\n\n---\n\n### Flujo de Ejemplo:\n1. El usuario crea una carpeta \"Cronolog\u00edas Importantes\".\n2. Define como atributo por defecto de la carpeta el selector \"Tipo de Era\".\n3. Crea la entidad \"La Ca\u00edda del Imperio de Eldoria\" de tipo **L\u00ednea de Tiempo**.\n4. Al guardar, el \u00e1rea central habilita la pesta\u00f1a **\"Cronolog\u00eda\"**.\n5. Al cambiar a ella, el usuario empieza a a\u00f1adir eventos hist\u00f3ricos directamente sobre la ficha de la entidad.\n\nEste redise\u00f1o garantiza una flexibilidad total, permitiendo que cada autor estructure su mundo exactamente como su narrativa lo requiera.\n# Tareas Pendientes y Roadmap (Gu\u00eda para IA)\n\nEste documento resume el estado actual del proyecto y las tareas cr\u00edticas que deben abordarse en las pr\u00f3ximas sesiones de desarrollo.\n\n## Estado Actual\n- **Editor de Mapas**: Funcional en estructura (Panel Derecho de Ajustes, Guardado) pero falta la interactividad real del Canvas.\n- **Biblia**: Navegaci\u00f3n por carpetas funcional, creaci\u00f3n de entidades y mapas operativa.\n- **Interfaz**: Migrada a un dise\u00f1o de 3 paneles (Explorer, Canvas, Contexto).\n\n## 1. Prioridad Alta: Editor de Mapas\nEl esqueleto est\u00e1 listo, pero falta el motor gr\u00e1fico.\n- [x] **Re-integrar Konva/Canvas**:\n    - Actualmente `MapEditor.jsx` usa un `CanvasPlaceholder` (Corregido: ahora usa `Stage` y `Layer`).\n    - Hay que descomentar y adaptar la l\u00f3gica de `react-konva` (Stage, Layers, Transformers) que est\u00e1 comentada o fue simplificada.\n    - Sincronizar el Canvas real con el `gridSize` y `bgImage` del panel derecho.\n- [x] **Herramientas de Dibujo**:\n    - Implementar l\u00f3gica para las herramientas de la barra izquierda (Pincel, Figuras, Texto).\n    - Conectar estas herramientas con el estado de Konva.\n\n## 2. Refactorizaci\u00f3n del Constructor de Entidades (`EntityBuilder`)\nEl constructor actual es funcional pero necesita alinearse con el nuevo dise\u00f1o de \"Panel Derecho Global\".\n    - [x] Migrar Tabs al Panel Derecho (Completado).\n- [x] **Mejoras en Identidad**:\n    - [x] A\u00f1adir campo \"Apariencia\" (Texto rico o imagen).\n    - [x] Permitir subir icono personalizado (Local Image) para la entidad.\n\n## 3. Mejoras de \"Calidad de Vida\" (UX)\n- [x] **Renombrar en Sidebar**: A\u00f1adir opci\u00f3n \"Rename\" al men\u00fa contextual del \u00e1rbol lateral (Hecho).\n- [x] **Breadcrumbs**: Implementar migas de pan en la vista de carpetas para mejorar la navegaci\u00f3n profunda.\n- [ ] **Favoritos**: Secci\u00f3n en el sidebar para acceso r\u00e1pido a entidades frecuentes.\n\n## 4. Refactorizaci\u00f3n T\u00e9cnica y Backend (Desde TODOs) [COMPLETADO ESTA SESI\u00d3N]\nTareas extra\u00eddas de `WorldBibleController.java`:\n- [x] **Restaurar Explorador Lateral**: Limpiar el sidebar para mostrar solo estructura de carpetas relevante.\n- [x] **Rutas de Creaci\u00f3n Directa**: Implementar rutas como `/new/:type` para acceso r\u00e1pido.\n- [x] **Guardado Diferido (Post-draft)**: Permitir crear entidades en memoria y solo persistir al guardar (evitar basura en DB).\n- [x] **Refactorizaci\u00f3n Flujo de Creaci\u00f3n (Sin Prompts)**: Reemplazado todos los `window.prompt` por `InputModal` o edici\u00f3n en l\u00ednea.\n- [x] **Breadcrumbs**: Implementado en Backend (`FolderDetail`) y Frontend (`Breadcrumbs.jsx`).\n- [x] **Herencia de Plantillas**: Completado mediante la implementaci\u00f3n de **Atributos Globales**.\n\n## 5. Implementaci\u00f3n del Editor de Texto \"Zen\" (Nueva Fase)\nObjetivo: Crear una zona de escritura limpia, minimalista y personalizada.\n- [x] **Setup Inicial**: Se ha optado por **React-Quill** en lugar de Tiptap debido a estabilidad.\n- [x] **Dise\u00f1o \"Zen\" UI**: Implementado mediante CSS personalizado en `ZenEditor.jsx` (Dark Mode, bordes ocultos).\n- [x] **Sistema de Menciones (@)**: Implementado en `ZenEditor.jsx` usando `quill-mention` y API de entidades.\n- [x] **Toolbar**: Integrada toolbar estilo Google Docs (Snow theme) con overrides oscuros.\n\n## Tareas Completadas Recientemente \n- [x] **Gesti\u00f3n de Plantillas Globales, UX EntityBuilder, Consistencia UI**.\n- [x] **Correcci\u00f3n de Errores Cr\u00edticos (Persistencia y Visualizaci\u00f3n)**.\n# Gu\u00eda de Pruebas para Agentes de IA (Worldbuilding App)\n\nEsta gu\u00eda est\u00e1 dise\u00f1ada para que un modelo de IA pueda navegar, probar y entender la estructura actual de la aplicaci\u00f3n **Chronos Atlas**.\n\n## URL Base\n- **Frontend**: `http://localhost:5173`\n- **Backend**: `http://localhost:8080` (API REST)\n\n## 1. Navegaci\u00f3n Principal\nLa aplicaci\u00f3n utiliza un layout principal (`ArchitectLayout`) con una barra lateral izquierda colapsable.\n\n- **Rutas Clave**:\n    - `/` o `/:user/:project`: Dashboard Principal.\n    - `.../bible`: **Biblia del Mundo** (Gestor de Carpetas y Entidades).\n    - `.../map`: **Atlas** (Visor de Mapas - *En desarrollo*).\n    - `.../map-editor/edit/:id`: **Editor de Mapas** (Pantalla completa).\n\n## 2. Flujo de Trabajo: Biblia del Mundo (`/bible`)\nEste es el n\u00facleo de la organizaci\u00f3n.\n\n1.  **Crear Carpeta**:\n    - En la ra\u00edz o dentro de otra carpeta, usa el bot\u00f3n \"Nueva Carpeta\" o Clic Derecho -> \"Nueva Carpeta\".\n    - Esto organiza tu lore jer\u00e1rquicamente.\n2.  **Men\u00fa Contextual (Clic Derecho)**:\n    - Sobre una Carpeta: `Nueva Entidad`, `Nuevo Mapa`, `Nueva Timeline`, `Renombrar`, `Eliminar`.\n    - Sobre un Archivo: `Renombrar`, `Eliminar`.\n\n## 3. Flujo de Trabajo: Creaci\u00f3n y Edici\u00f3n de Mapas\nEl sistema de mapas es una caracter\u00edstica destacada y compleja.\n\n### A. Crear un Mapa\n1.  Navega a una carpeta en la `/bible`.\n2.  Haz **Clic Derecho** en la carpeta -> Selecciona **\"Nuevo Mapa\"**.\n3.  **Wizard de Creaci\u00f3n**:\n    - Se abrir\u00e1 una pantalla de configuraci\u00f3n por pasos.\n    - Completa Nombre, Descripci\u00f3n, Tipo (Mundo/Regional) y selecciona una fuente (Imagen o Blanco).\n    - Clic en \"Create Map\".\n\n### B. Editor de Mapas (`MapEditor`)\nTras crear, ser\u00e1s redirigido al editor.\n- **Panel Central (Lienzo)**: Muestra el mapa/imagen y la rejilla.\n- **Panel Derecho (Ajustes)**:\n    - **Identidad**: Cambia el nombre o tipo.\n    - **Grid System**: Activa/Desactiva la rejilla y ajusta su tama\u00f1o con el slider.\n    - **Canvas**: Ajusta las dimensiones (WxH) o sube una nueva imagen de fondo.\n    *Nota: Este panel usa un dise\u00f1o de Acorde\u00f3n.*\n- **Guardado**:\n    - Bot\u00f3n \"Save Changes\" (arriba derecha).\n    - **Importante**: Al guardar, el sistema te redirigir\u00e1 autom\u00e1ticamente a la carpeta de la Biblia donde est\u00e1 el mapa.\n\n## 4. Estructura T\u00e9cnica Relevante\n- **Backend (Spring Boot)**:\n    - Entidades se guardan en `EntidadGenerica`.\n    - Mapas son entidades con `tipoEspecial = 'map'`.\n    - Los datos del mapa (grid, imagen, capas) se serializan en JSON dentro del campo `descripcion`.\n- **Frontend (React/Vite)**:\n    - `MapEditor.jsx`: Componente monol\u00edtico para la edici\u00f3n. Usa `useOutletContext` para comunicarse con el `ArchitectLayout` (Panel Derecho).\n\n## 5. Pruebas Recomendadas\nSi eres una IA probando la app, intenta:\n1.  Crear una estructura de carpetas anidada (ej. `Reino -> Capital -> Castillo`).\n2.  Crear un Mapa dentro de \"Castillo\".\n3.  En el editor, sube una imagen de prueba y ajusta la rejilla para que coincida con la escala de la imagen.\n4.  Guarda y verifica que vuelves a la carpeta \"Castillo\".\n5.  Vuelve a entrar al mapa y confirma que la rejilla y la imagen se mantienen.\n# Investigaci\u00f3n: Librer\u00edas de Editores de Texto (React)\n\n## Objetivo\nIdentificar la mejor librer\u00eda para crear una \"Zona de Escritura\" limpia, minimalista y altamente customizable (\"Headless\"), con soporte robusto para menciones (`@Personaje`).\n\n---\n\n## 1. Recomendaci\u00f3n Principal: Tiptap\n**Veredicto: LA MEJOR OPCI\u00d3N**\nEs un wrapper \"headless\" sobre ProseMirror. No trae estilos por defecto, lo que nos da control total sobre la UI (\"Pixel Perfect\").\n\n*   **Ventajas:**\n    *   **Headless:** Eres due\u00f1o del HTML y CSS. Ideal para el dise\u00f1o \"Zen\" solicitado.\n    *   **Extensi\u00f3n de Menciones:** Tiene una extensi\u00f3n oficial (`@tiptap/extension-mention`) muy potente y f\u00e1cil de conectar con datos as\u00edncronos (nuestra BBDD).\n    *   **Contexto de React:** Renderiza los nodos como componentes de React, permitiendo interactividad real dentro del texto.\n*   **Desventajas:**\n    *   Requiere m\u00e1s trabajo inicial de CSS (tailwind) porque viene \"desnudo\".\n\n---\n\n## 2. Alternativas Analizadas\n\n### A. Slate.js\n**Veredicto: Potente pero compleja**\nEs un framework de bajo nivel. Te da total libertad, pero tienes que construir *todo* desde cero, incluso el comportamiento b\u00e1sico del cursor a veces.\n*   **Pros:** Flexibilidad infinita.\n*   **Contras:** Curva de aprendizaje muy alta. Implementar menciones requiere mucho c\u00f3digo boilerplate manual.\n\n### B. Lexical (Meta/Facebook)\n**Veredicto: Prometedora pero verde**\nEl sucesor de Draft.js. Muy r\u00e1pido y ligero.\n*   **Pros:** Rendimiento excelente, accesibilidad.\n*   **Contras:** Ecosistema m\u00e1s joven que Tiptap/Slate. La documentaci\u00f3n a veces es fragmentada.\n\n### C. Quill / TinyMCE / CKEditor\n**Veredicto: DESCARTADAS**\nSon editores \"con pilas incluidas\". Vienen con barras de herramientas cl\u00e1sicas estilo Word y estilos dif\u00edciles de sobrescribir.\n*   **Raz\u00f3n de descarte:** Van en contra del principio de \"limpieza visual\" y personalizaci\u00f3n total que buscas.\n\n---\n\n## Plan de Acci\u00f3n (Basado en Tiptap)\n1.  Instalar `@tiptap/react` y `@tiptap/starter-kit`.\n2.  Instalar `@tiptap/extension-mention` para las menciones.\n3.  Usar `tippy.js` (o soluci\u00f3n propia) para el men\u00fa flotante de sugerencias.\n4.  Estilar todo con **Tailwind CSS** para integrarlo en el *Glassmorphism* de la app.\n", "02_Bitacora_Desarrollo.md": "# Bit\u00c3\u0083\u00c2\u00a1cora de Desarrollo (Log Prompts)\n\n---\n\n### Prompt ID: 22 (Redise\u00c3\u0083\u00c2\u00b1o \"Chronos Atlas Next\")\n**Prompt:** \"LAS FUNCIONALIDADES (capturas que te pase) sobreescribelas en ese archivo funcionalidades.md. Con esto YA\"\n**Resultados:**\n- [DOCS] Transcripci\u00c3\u0083\u00c2\u00b3n total de 10 im\u00c3\u0083\u00c2\u00a1genes detallando el nuevo paradigma modular.\n- [PLAN] Creaci\u00c3\u0083\u00c2\u00b3n del plan de implementaci\u00c3\u0083\u00c2\u00b3n para el esquema din\u00c3\u0083\u00c2\u00a1mico (Folders/Templates).\n- [ARCH] Reestructuraci\u00c3\u0083\u00c2\u00b3n visual hacia 3 paneles + Bottom Dock.\n\n\n---\n\n### Prompt ID: 0 (Setup Inicial)\n> Analizame la app WorldbuildingApp y todas sus versiones... serverless pero con funcionamiento en el explorador...\n**Resultados:**\n*   [AN\u00c3\u0083\u00c6\u0092\u00c3\u00af\u00c2\u00bf\u00c2\u00bdLISIS] Determinada estructura (v1/v2 Java, v3 Next.js).\n*   [ESTRATEGIA] Migraci\u00c3\u0083\u00c6\u0092\u00c3\u0082\u00c2\u00b3n exitosa a Java Spring Boot + H2 (standalone).\n\n---\n\n### Prompt ID: 3 (Estructura de Cuadernos)\n> ...cuaderno/libro... plantillas/hojas... numerando las hojas...\n*   [BUG FIX] Corregido error en `DynamicDataSourceConfig`: el inicializador SQL ignoraba bloques que empezaban con comentarios, omitiendo la creaci\u00c3\u0083\u00c6\u0092\u00c3\u0082\u00c2\u00b3n de tablas.\n*   [COMPATIBILIDAD] Cambiado `MEDIUMTEXT` por `CLOB` en todas las entidades para asegurar compatibilidad total con H2.\n*   [VERIFICACI\u00c3\u0083\u00c6\u0092\u00c3\u00a2\u00e2\u0082\u00ac\u00c5\u0093N] Verificado flujo completo en un nuevo proyecto \"Mundo_Arreglado\".\n\n\n### Prompt ID: 6 (Navegaci\u00c3\u0083\u00c6\u0092\u00c3\u0082\u00c2\u00b3n y Arquitectura)\n> Elimina la sidebar, pon un men\u00c3\u0083\u00c6\u0092\u00c3\u0082\u00c2\u00ba radial arriba y prepara el backend para multi-usuario...\n**Resultados:**\n*   [UX] Implementado men\u00c3\u0083\u00c6\u0092\u00c3\u0082\u00c2\u00ba radial Top-Center (Glassmorphism). Refactorizados todos los HTMLs.\n*   [BACKEND] Creada entidad Usuario y repositorio JPA. Configurado redirecci\u00c3\u0083\u00c6\u0092\u00c3\u0082\u00c2\u00b3n a Login.\n\n---\n\n### Prompt ID: 7 (Migraci\u00c3\u0083\u00c2\u00b3n a SQLite)\n> Migrate to SQLite Database\n**Resultados:**\n*   [DATABASE] Migraci\u00c3\u0083\u00c2\u00b3n completa de H2 a SQLite (data/worldbuilding.db).\n*   [CLEANUP] Eliminado c\u00c3\u0083\u00c2\u00b3digo legacy H2 (DynamicDataSourceConfig, H2Functions).\n*   [REFACTOR] Reescritura de ProyectoController y BDController para JPA est\u00c3\u0083\u00c2\u00a1ndar.\n\n### Prompt ID: 8 (Multi-tenancy & Real Login)\n> Aislamiento de datos por usuario y registro funcional.\n**Resultados:**\n*   [SECURITY] Implementado `ProjectSessionInterceptor` para proteger APIs.\n*   [AUTH] Completado `AuthController` con registro, login y logout real.\n*   [DATA] Modificados modelos (`Proyecto`) y repositorios para filtrar por `Usuario`.\n*   [FIX] Resuelto conflicto de puerto 8080.\n\n---\n\n### Prompt ID: 9 (Refinamiento UI & Librer\u00c3\u0083\u00c2\u00ada)\n> Refinamiento est\u00c3\u0083\u00c2\u00a9tico, Biblia de Entidades y M\u00c3\u0083\u00c2\u00b3dulo de Librer\u00c3\u0083\u00c2\u00ada.\n**Resultados:**\n*   [UX] Men\u00c3\u0083\u00c2\u00ba Radial optimizado (m\u00c3\u0083\u00c2\u00a1s amplio) y Perfil unificado (Dashboard style).\n*   [BIBLIA] Redise\u00c3\u0083\u00c2\u00b1o total con filtros superiores, conteo din\u00c3\u0083\u00c2\u00a1mico en tiempo real y nuevos tipos (Magia, Zonas, Efectos).\n*   [DASHBOARD] A\u00c3\u0083\u00c2\u00b1adidos campos de g\u00c3\u0083\u00c2\u00a9nero, tipo e imagen al crear proyectos.\n*   [LIBRER\u00c3\u0083\u00ef\u00bf\u00bdA] Creado m\u00c3\u0083\u00c2\u00b3dulo de gesti\u00c3\u0083\u00c2\u00b3n de hojas (`libreria.html`) con navegaci\u00c3\u0083\u00c2\u00b3n avanzada.\n\n### Prompt ID: 10 (Taller de Conlangs)\n> Implementaci\u00c3\u0083\u00c2\u00b3n del Taller de Conlangs con NLP, Vectorizaci\u00c3\u0083\u00c2\u00b3n y FontForge.\n**Resultados:**\n*   [BACKEND] Integraci\u00c3\u0083\u00c2\u00b3n de CoreNLP y JWI (WordNet) para sem\u00c3\u0083\u00c2\u00a1ntica.\n*   [GRAPHICS] Implementado `VectorizationUtils` (Raster -> SVG) y script Python para FontForge (SVG -> TTF).\n*   [FRONTEND] Nuevo m\u00c3\u0083\u00c2\u00b3dulo `conlangs.html` con Canvas de dibujo Vanilla JS.\n*   [DATA] Nuevas entidades `MorphRule` y extensi\u00c3\u0083\u00c2\u00b3n de `Palabra` con datos vectoriales.\n\n---\n\n### Prompt ID: 11 (Standardizaci\u00c3\u0083\u00c2\u00b3n UI Escritura)\n> siempre que puedas debes poner unidades relativas\n> arregla el menu selector de paginas en la hoja de una escritura (no se ha arreglado)\n> en vez de intentar arreglarlo, copia el mismo codigo que en el resto de paginas\n\n**Resultados:**\n*   [REFACTOR] Reemplazada cabecera \"Premium\" personalizada por el est\u00c3\u0083\u00c2\u00a1ndar de dise\u00c3\u0083\u00c2\u00b1o de `libreria.html`.\n*   [UX] Eliminado selector de p\u00c3\u0083\u00c2\u00a1ginas complejo; implementada navegaci\u00c3\u0083\u00c2\u00b3n lineal (Anterior/Siguiente) y breadcrumbs est\u00c3\u0083\u00c2\u00a1ndar.\n*   [CSS] Refactorizaci\u00c3\u0083\u00c2\u00b3n completa a unidades relativas (`rem`) en m\u00c3\u0083\u00c2\u00b3dulos de escritura.\n*   [FIX] Ajustado margen superior (`mt-24`) en cabecera de escritura para evitar solapamiento con men\u00c3\u0083\u00c2\u00ba radial.\n*   [UX] Corregido toggle de barra lateral de notas y eliminado bot\u00c3\u0083\u00c2\u00b3n de cierre redundante.\n\n### Prompt ID: 12 (Redise\u00c3\u0083\u00c2\u00b1o Escritura & Sidebar)\n> Refactoriza la interfaz de escritura para tener una lista de hojas lateral persistente, contadores de notas y navegaci\u00c3\u0083\u00c2\u00b3n directa. arregla bugs de carga y borrado.\n\n**Resultados:**\n*   [UI] Implementada **Sidebar Lateral** en `escritura.html` para navegaci\u00c3\u0083\u00c2\u00b3n r\u00c3\u0083\u00c2\u00a1pida entre hojas.\n*   [BACKEND] A\u00c3\u0083\u00c2\u00b1adido conteo eficiente de notas (`countByHoja`) en `NotaRapidaRepository`.\n*   [UX] **Contadores de Notas** visuales (badges) en la lista de hojas.\n*   [FLOW] Navegaci\u00c3\u0083\u00c2\u00b3n directa desde Librer\u00c3\u0083\u00c2\u00ada al Editor (saltando vista intermedia).\n*   [FIX] Resuelto bug cr\u00c3\u0083\u00c2\u00adtico de \"estados zombie\" al borrar hojas y recarga de notas al cambiar de p\u00c3\u0083\u00c2\u00a1gina.\n\n### Prompt ID: 13 (Restructuraci\u00c3\u0083\u00c2\u00b3n Frontend & React)\n> Restructure and Debug Frontend (Blank Screen)\n**Resultados:**\n*   [ARCH] Reestructuraci\u00c3\u0083\u00c2\u00b3n completa del proyecto: frontend movido a `src/main/frontend`, compilaci\u00c3\u0083\u00c2\u00b3n a `src/main/resources/static`.\n*   [REACT] Implementaci\u00c3\u0083\u00c2\u00b3n base de SPA con React + Tailwind + Vite.\n*   [FIX] Resuelto bug de \"Pantalla Negra\" (ReferenceError en montaje de React).\n*   [DESIGN] Integraci\u00c3\u0083\u00c2\u00b3n inicial del tema \"Arcane Void\".\n\n### Prompt ID: 15 (Calibraci\u00c3\u0083\u00c2\u00b3n UI Arcane Void)\n> UI Overhaul and Calibration to match prototypes.\n**Resultados:**\n*   [ARCH] Implementado `ArchitectLayout.jsx` con sidebars duales (Bible & Canvas) y modo Focus.\n*   [UI] Redise\u00c3\u0083\u00c2\u00b1adas `ProjectView.jsx` (Welcome screen) y `Dashboard.jsx` (Sidebar hidden) seg\u00c3\u0083\u00c2\u00ban im\u00c3\u0083\u00c2\u00a1genes 1 y 6.\n*   [FEAT] Creados m\u00c3\u0083\u00c2\u00b3dulos `EntityProfile.jsx`, `CharacterEditor.jsx` y `Settings.jsx` (Im\u00c3\u0083\u00c2\u00a1genes 3, 4, 5).\n*   [FIX] Corregidas rutas de importaci\u00c3\u0083\u00c2\u00b3n relativas post-migraci\u00c3\u0083\u00c2\u00b3n.\n*   [VERIF] Verificaci\u00c3\u0083\u00c2\u00b3n exitosa de renderizado y est\u00c3\u0083\u00c2\u00a9tica \"Arcane Void\" v\u00c3\u0083\u00c2\u00ada subagente.\n\n### Prompt ID: 16 (Correcci\u00c3\u0083\u00c2\u00b3n Error Sintaxis CharacterView)\n> Fix syntax error 'expected catch or finally' in CharacterView.jsx from user report.\n**Resultados:**\n*   [FIX] Eliminado bloque `try` hu\u00c3\u0083\u00c2\u00a9rfano y c\u00c3\u0083\u00c2\u00b3digo duplicado en `CharacterView.jsx` que causaba crash.\n\n### Prompt ID: 23 (Debug 500 & Logs Cleanup)\n> Continue (Debugging SESSION)\n**Resultados:**\n*   [FIX] Resuelto error cr\u00c3\u00adtico 500 'no such table' mediante ruta absoluta JDBC y desactivaci\u00c3\u00b3n de DDL-Auto.\n*   [INFRA] Implementado GlobalExceptionHandler para trazas completas.\n*   [CLEANUP] Logs (\backend.log, \trace.txt, etc) movidos a carpeta /Data para limpieza del root.\n\n### Prompt ID: 16 (CRUD & UI Improvements)\n- **Features**: Implementaci\u00c3\u0083n de CRUD de carpetas en World Bible, nuevo sistema de Notas con vista pantalla completa, Selector de Mapas y Editor de Mapas funcional (Canvas).\n- **Fixes**: Resuelto error 500 en el arranque (SQLDelete), arreglado redireccionamiento de logout en Settings.\n- **Impact**: Mejora significativa en la UX de cartograf\u00c3\u0083a y gesti\u00c3\u0083n de informaci\u00c3\u0083n.\n\n## Sesi\u00c3\u0083\u00c6\u0092n 2026-01-07: Resoluci\u00c3\u0083\u00c6\u0092n de Estabilidad y UI\n- [x] Correcci\u00c3\u0083\u00c6\u0092n de persistencia DB (SQLite Master persistente).\n- [x] Inicializaci\u00c3\u0083\u00c6\u0092n robusta de esquemas (CREATE TABLE IF NOT EXISTS).\n- [x] Resoluci\u00c3\u0083\u00c6\u0092n de errores 401 (PermitAll + Session activation temprana).\n- [x] Fix de bot\u00c3\u0083\u00c6\u0092n 'Guardar' desaparecido (Redise\u00c3\u0083\u00c6\u0092o de Header y Stacking Context).\n\n\n## Sesi\u00c3\u00b3n 2026-01-10: An\u00c3\u00a1lisis y Arranque\n**Prompt:** An\u00c3\u00a1lisis, arranque y prueba de rutas.\n**Resultado:** Backend y Frontend levantados. Rutas verificadas (Dashboard accesible). Screenshot capturado.\n\n## Sesi\u00c3\u00b3n 2026-01-10: Investigaci\u00c3\u00b3n Editores\n**Prompt:** Investigar librer\u00c3\u00adas de texto (React, Clean, Mentions) y actualizar Roadmap.\n**Resultado:** Roadmap actualizado. Reporte de investigaci\u00c3\u00b3n creado (Tiptap como recomendaci\u00c3\u00b3n).\n\n## Sesi\u00c3\u00b3n: 2026-01-22\n\n### Prompt:\n\"vamos a seguir con worldbuilding\"\n\n### Resultados:\n- Carga de contexto WorldbuildingApp.\n- Auditor\u00c3\u00ada inicial: Detectado spring.jpa.hibernate.ddl-auto=create en \u0007pplication.properties (RIESGO DE P\u00c3\u0089RDIDA DE DATOS).\n- Verificaci\u00c3\u00b3n: ZenEditor usa React-Quill correctamente.\n- Resoluci\u00c3\u00b3n cr\u00c3\u00adtica: Cambio de ddl-auto a update + Comentario de Advertencia.\n- Documentaci\u00c3\u00b3n: Creado Docs/plan_migracion_grafos.md para preparar la transici\u00c3\u00b3n a Cytoscape.js (a la espera de orden 'YA').\n- Actualizaci\u00c3\u00b3n de Plan: Renombrado plan_migracion_grafos.md a plan_migracion_stack.md.\n- Expansion de Stack: A\u00c3\u00b1adidas secciones para TipTap, Shadcn/ui (con Resizable Panels), TanStack Query, Zustand, Electron y Arquitectura JSON Din\u00c3\u00a1mico.\n- Actualizaci\u00c3\u00b3n de Plan: Integrada estrategia **Flyway** (ddl-auto=validate) y patr\u00c3\u00b3n **LoreNode (JSON)** en plan_migracion_stack.md.\n- Refinamiento de Plan: Adaptada estrategia JSON para modificar EntidadGenerica existente en lugar de reemplazarla. Se usar\u00c3\u00a1 un enfoque h\u00c3\u00adbrido (Columnas SQL + Columna JSON).\n# Log de Errores\n\n## [2026-01-13] P\u00c3\u0083\u00c2\u00a9rdida de datos de la Biblia tras reinicio del servidor\n\n**S\u00c3\u0083\u00c2\u00adntoma**: Los datos de carpetas y entidades de la Biblia no se cargan. El frontend recibe errores 401 \"No active project\" al intentar acceder a `/api/world-bible/folders` y `/api/world-bible/favorites`.\n\n**Causa Ra\u00c3\u0083\u00c2\u00adz**:\n1. La configuraci\u00c3\u0083\u00c2\u00b3n `spring.jpa.hibernate.ddl-auto` estaba establecida en `create` en `application.properties`\n2. Este modo **borra y recrea todas las tablas** cada vez que se reinicia el servidor Spring Boot\n3. Todos los datos de la base de datos (incluyendo carpetas, entidades, plantillas, etc.) se perd\u00c3\u0083\u00c2\u00adan en cada reinicio\n\n**Contexto**:\n- El modo `create` se hab\u00c3\u0083\u00c2\u00ada establecido temporalmente para resolver errores de formato de fechas en SQLite\n- Una vez resuelto el problema de fechas (a\u00c3\u0083\u00c2\u00b1adiendo `date_class=TEXT` a la URL de conexi\u00c3\u0083\u00c2\u00b3n), se olvid\u00c3\u0083\u00c2\u00b3 revertir a `update`\n\n**Soluci\u00c3\u0083\u00c2\u00b3n Aplicada**:\n1. Cambiar `spring.jpa.hibernate.ddl-auto=create` a `spring.jpa.hibernate.ddl-auto=update` en `application.properties` (l\u00c3\u0083\u00c2\u00adnea 14)\n2. Reiniciar el servidor para que tome la nueva configuraci\u00c3\u0083\u00c2\u00b3n\n3. **Importante**: Los datos ya perdidos NO se recuperan autom\u00c3\u0083\u00c2\u00a1ticamente. Es necesario:\n   - Recrear manualmente las carpetas y entidades, O\n   - Restaurar desde un backup de la base de datos si existe\n\n**Archivos Modificados**:\n- `src/main/resources/application.properties` (l\u00c3\u0083\u00c2\u00adnea 14)\n\n**Configuraci\u00c3\u0083\u00c2\u00b3n Final Correcta**:\n```properties\n# Update schema automatically (preserves data)\nspring.jpa.hibernate.ddl-auto=update\n```\n\n**Prevenci\u00c3\u0083\u00c2\u00b3n**:\n- \u00c3\u00a2\u00c5\u0093\u00e2\u0080\u00a6 Usar `update` en desarrollo para preservar datos\n- \u00c3\u00a2\u00c5\u0093\u00e2\u0080\u00a6 Usar `validate` en producci\u00c3\u0083\u00c2\u00b3n para evitar cambios autom\u00c3\u0083\u00c2\u00a1ticos al esquema\n- \u00c3\u00a2\u00c5\u00a1\u00c2\u00a0\u00c3\u00af\u00c2\u00b8\u00ef\u00bf\u00bd Solo usar `create` temporalmente para debugging y SIEMPRE revertir inmediatamente\n\n**Estado**: \u00c3\u00a2\u00c5\u0093\u00e2\u0080\u00a6 Resuelto - La configuraci\u00c3\u0083\u00c2\u00b3n est\u00c3\u0083\u00c2\u00a1 correcta, pero los datos deben ser recreados\n\n**UPDATE 23:05**: Detectado problema adicional - falta columna `favorite` en tabla `entidad_generica`. \n- Error: `[SQLITE_ERROR] SQL error or missing database (no such column: e1_0.favorite)`\n- Causa: El esquema no se actualiz\u00c3\u0083\u00c2\u00b3 completamente cuando se cambi\u00c3\u0083\u00c2\u00b3 de `create` a `update`\n\n**UPDATE 23:25**: Problema final identificado y resuelto:\n- **Causa ra\u00c3\u0083\u00c2\u00adz**: El modelo `Carpeta.java` ten\u00c3\u0083\u00c2\u00ada colecciones `@OneToMany` (`subcarpetas`, `plantillas`, `entidades`) SIN `@JsonIgnore`\n- Cuando Jackson serializaba la respuesta, intentaba cargar lazy las colecciones, lo que disparaba queries con la columna `favorite` faltante\n- **Soluci\u00c3\u0083\u00c2\u00b3n aplicada**:\n  1. A\u00c3\u0083\u00c2\u00b1adido `@JsonIgnore` a las 3 colecciones en `Carpeta.java`\n  2. Modificado `WorldBibleController.createFolder()` para devolver un `Map` simple en lugar de la entidad completa\n  3. A\u00c3\u0083\u00c2\u00b1adido try-catch para mejor logging de errores\n\n**Archivos modificados**:\n- `src/main/java/com/worldbuilding/app/model/Carpeta.java`\n- `src/main/java/com/worldbuilding/app/controller/WorldBibleController.java`\n\n**Estado Final**: \u00c3\u00a2\u00c5\u0093\u00e2\u0080\u00a6\u00c3\u00a2\u00c5\u0093\u00e2\u0080\u00a6 RESUELTO - Carpetas se crean correctamente\n\n---\n\n## [2026-01-08] Error de Compilaci\u00c3\u0083\u00c2\u00b3n: M\u00c3\u0083\u00c2\u00a9todo No Definido\n- **Error**: `The method getFolderDetail(Long) is undefined for the type WorldBibleService` en `WorldBibleController.java`.\n- **Causa**: El m\u00c3\u0083\u00c2\u00a9todo `getFolderDetail` faltaba en el servicio `WorldBibleService`, aunque era invocado desde el controlador.\n- **Soluci\u00c3\u0083\u00c2\u00b3n**: Se implement\u00c3\u0083\u00c2\u00b3 el m\u00c3\u0083\u00c2\u00a9todo `getFolderDetail(Long id)` en `WorldBibleService.java`. El m\u00c3\u0083\u00c2\u00a9todo devuelve un mapa con los detalles de la carpeta y su ruta (breadcrumbs).\n- **Estado**: Resuelto.\n\n## [2026-01-08] Error de Persistencia y Visualizaci\u00c3\u0083\u00c2\u00b3n (404)\n- **Error**: `TypeError: Cannot read properties of null (reading 'id')` al guardar entidades, y \"Unnamed Folder\" / 404 al acceder a carpetas renombradas.\n- **Causa**:\n  1. Frontend: `EntityBuilder` no manejaba carpetas nulas (ocasionado por fallo de carga).\n  2. Backend: Renombrar carpeta cambiaba el `slug`, rompiendo la URL en el frontend y causando 404.\n- **Soluci\u00c3\u0083\u00c2\u00b3n**:\n  1. **Backend**: Se desactiv\u00c3\u0083\u00c2\u00b3 la actualizaci\u00c3\u0083\u00c2\u00b3n autom\u00c3\u0083\u00c2\u00a1tica del slug en `WorldBibleService.java` al renombrar.\n  2. **Frontend**: Se a\u00c3\u0083\u00c2\u00b1adi\u00c3\u0083\u00c2\u00b3 protecci\u00c3\u0083\u00c2\u00b3n contra nulos en `EntityBuilder.jsx` y redirecci\u00c3\u0083\u00c2\u00b3n autom\u00c3\u0083\u00c2\u00a1tica en `FolderView.jsx` si se detecta cambio de slug.\n- **Estado**: Resuelto (Requiere reinicio de Backend).\n\n## [2026-01-09] Error de Serializaci\u00c3\u0083\u00c2\u00b3n Backend (Hibernate Proxy)\n- **Error**: `HttpMessageConversionException` ... `ByteBuddyInterceptor` al acceder a `.../entities`.\n- **Causa**: Jackson intentaba serializar el proxy de Hibernate generado para la relaci\u00c3\u0083\u00c2\u00b3n Lazy `AtributoValor.plantilla`.\n- **Soluci\u00c3\u0083\u00c2\u00b3n**: Se a\u00c3\u0083\u00c2\u00b1adi\u00c3\u0083\u00c2\u00b3 `@JsonIgnoreProperties({\"hibernateLazyInitializer\", \"handler\"})` a la clase `AtributoPlantilla` para evitar la serializaci\u00c3\u0083\u00c2\u00b3n de los campos internos del proxy.\n- **Estado**: Resuelto (Requiere reinicio de Backend).\n\n## [2026-01-09] Error de Base de Datos Missing Table (SQLite)\n- **Error**: `SQLITE_ERROR: no such table: hoja`.\n- **Causa**: Fallo en creaci\u00c3\u0083\u00c2\u00b3n autom\u00c3\u0083\u00c2\u00a1tica de esquema (`ddl-auto=create`).\n- **Soluci\u00c3\u0083\u00c2\u00b3n**: Cambiado `ddl-auto` a `update` en `application.properties`.\n- **Estado**: Resuelto (Backend reiniciado).\n\n## [2026-01-10] Error Pantalla Blanca (Vite Port 5173 / Tiptap)\n- **Error**: La aplicaci\u00c3\u0083\u00c2\u00b3n carga en blanco en desarrollo (puerto 5173), aunque build producci\u00c3\u0083\u00c2\u00b3n (8080) funciona.\n- **Causa Inicial**: Conflicto de versiones de Tiptap (v3.15.3 beta/bleeding edge).\n- **Acciones**:\n  1. Downgrade de librer\u00c3\u0083\u00c2\u00adas Tiptap a `v2.10.3`.\n  2. Crash persistente por `index.css` (Resuelto simplificando CSS).\n  3. Crash persistente por dependencias faltantes (`@tiptap/extension-color`, etc.) que no se instalaron en el downgrade inicial.\n- **Estado Actual**:\n  - La aplicaci\u00c3\u0083\u00c2\u00b3n carga correctamente (\"Green Screen\" superada).\n  - **Aislado**: El componente `WritingView` (o `ZenEditor`) causa un crash al importarse. Se ha comentado su ruta en `App.jsx` para permitir el acceso al men\u00c3\u0083\u00c2\u00ba principal.\n- **Investigaci\u00c3\u0083\u00c2\u00b3n (23:45)**:\n  - Se detect\u00c3\u0083\u00c2\u00b3 que `TiptapExtensions.js` importa `MergeAttributes` directamente de `@tiptap/core`.\n  - `@tiptap/core` NO est\u00c3\u0083\u00c2\u00a1 listado en `package.json`. Esto causa un fallo de resoluci\u00c3\u0083\u00c2\u00b3n de m\u00c3\u0083\u00c2\u00b3dulo en Vite al iniciar.\n- **Acci\u00c3\u0083\u00c2\u00b3n Correctiva**: Instalar `@tiptap/core` expl\u00c3\u0083\u00c2\u00adcitamente y re-habilitar el editor.\n- **Nuevo Hallazgo (00:05)**:\n  - Error al compilar: `No matching export in ... for import \"canInsertNode\"`.\n  - Origen: `@tiptap/extension-horizontal-rule` intenta usar una funci\u00c3\u0083\u00c2\u00b3n que no existe en `@tiptap/core` v2.10.3.\n  - Causa: Desajuste de versiones (Version Mismatch). Es probable que `starter-kit` haya instalado una versi\u00c3\u0083\u00c2\u00b3n m\u00c3\u0083\u00c2\u00a1s reciente de `horizontal-rule` que es incompatible con el `core` v2.10.3 forzado.\n- **Estabilizaci\u00c3\u0083\u00c2\u00b3n (00:20)**:\n  - Se elimin\u00c3\u0083\u00c2\u00b3 Tiptap por completo y se reemplaz\u00c3\u0083\u00c2\u00b3 `ZenEditor` con un `<textarea>` nativo.\n  - **Resultado**: La aplicaci\u00c3\u0083\u00c2\u00b3n carga correctamente y es estable. Se confirma que el origen de todos los crashes era la librer\u00c3\u0083\u00c2\u00ada Tiptap y sus dependencias.\n- **Intento Final (00:23)**:\n  - Se re-instal\u00c3\u0083\u00c2\u00b3 Tiptap v2.10.3 estricto.\n  - **Resultado**: Fallo persistente (White Screen) en Vite.\n- **Resoluci\u00c3\u0083\u00c2\u00b3n Definitiva**: \n  - Se ha **eliminado Tiptap** del proyecto.\n  - Se ha implementado un componente `ZenEditor` nativo (textarea estilizado) que garantiza estabilidad.\n  - **Alternativa Propuesta**: React-Quill (Implementado).\n- **Implementaci\u00c3\u0083\u00c2\u00b3n React-Quill (00:30)**:\n  - Se instal\u00c3\u0083\u00c2\u00b3 `react-quill`.\n  - Se reemplaz\u00c3\u0083\u00c2\u00b3 `ZenEditor` con una instancia de Quill configurada con toolbar completa (Google Docs style) y estilos CSS personalizados para el modo oscuro/Zen.\n  - Se restaur\u00c3\u0083\u00c2\u00b3 `index.css` a su estado original.\n  - **Resultado**: \u00c3\u0083\u00e2\u0080\u00b0XITO. El usuario confirma \"carga y va la app\". Editor estable y estilos restaurados.\n- **Nuevo Error Backend (00:33)**: \n  - `500 Internal Server Error` en `/api/escritura/cuaderno/1/hojas`.\n  - **Causa**: `spring.jpa.hibernate.ddl-auto` estaba en `create` (reseteando DB) pero fallaba al crear las tablas por bloqueos o configuraci\u00c3\u0083\u00c2\u00b3n, o simplemente borraba los datos.\n  - **Soluci\u00c3\u0083\u00c2\u00b3n (2026-01-13)**: Se cambi\u00c3\u0083\u00c2\u00b3 `ddl-auto` a `update` en `application.properties`. Se verific\u00c3\u0083\u00c2\u00b3 Entidad `Hoja.java`.\n  - **Estado**: Resuelto.\n\n## [2026-01-13] Inconsistencia Frontend Zen Editor\n- **Error**: El c\u00c3\u0083\u00c2\u00b3digo fuente mostraba `Tiptap` v3.15.3 instalado y en uso, a pesar de que los logs dec\u00c3\u0083\u00c2\u00adan que se hab\u00c3\u0083\u00c2\u00ada reemplazado por Quill.\n- **Acci\u00c3\u0083\u00c2\u00b3n**: Se ha reescrito `ZenEditor.jsx` para usar `React-Quill` (ya instalado en package.json), aplicando estilos Dark Mode.\n- **Estado**: Implementado.\n# Errores durante la creaci\u00c3\u0083\u00c2\u00b3n.md\n\nEste documento detalla los problemas encontrados y resueltos durante la sesi\u00c3\u0083\u00c2\u00b3n de depuraci\u00c3\u0083\u00c2\u00b3n para hacer funcionar el env\u00c3\u0083\u00c2\u00ado de formularios (`POST /api/bd/insertar`) tras la refactorizaci\u00c3\u0083\u00c2\u00b3n principal.\n\nLos errores se clasifican por su origen: Externo (entorno/configuraci\u00c3\u0083\u00c2\u00b3n), Java (backend) o JavaScript/HTML (frontend).\n\n---\n\n## 1. Externo (Entorno y Configuraci\u00c3\u0083\u00c2\u00b3n)\n\nEstos fueron los errores m\u00c3\u0083\u00c2\u00a1s cr\u00c3\u0083\u00c2\u00adticos que impidieron que la aplicaci\u00c3\u0083\u00c2\u00b3n arrancara o se conectara a la base de datos.\n\n### Error 1.1: Incompatibilidad de Versi\u00c3\u0083\u00c2\u00b3n de MySQL\n* **S\u00c3\u0083\u00c2\u00adntoma:** La aplicaci\u00c3\u0083\u00c2\u00b3n arrancaba, pero los datos no se guardaban. El log de Spring Boot mostraba la advertencia `HHH000511: The 5.5.5 version for [org.hibernate.dialect.MySQLDialect] is no longer supported... The minimum supported version is 8.0.0.`\n* **Causa:** La versi\u00c3\u0083\u00c2\u00b3n antigua de XAMPP usaba MySQL 5.5, que no es compatible con Hibernate 6 (usado por Spring Boot 3+).\n* **Soluci\u00c3\u0083\u00c2\u00b3n:** Desinstalar el XAMPP antiguo e instalar una versi\u00c3\u0083\u00c2\u00b3n moderna que incluya MySQL 8.0+.\n\n### Error 1.2: Puerto 8080 en uso\n* **S\u00c3\u0083\u00c2\u00adntoma:** La aplicaci\u00c3\u0083\u00c2\u00b3n Spring Boot no arrancaba, mostrando un error indicando que el puerto 8080 ya estaba en uso.\n* **Causa:** Un proceso anterior de Spring Boot (o cualquier otra aplicaci\u00c3\u0083\u00c2\u00b3n) no se cerr\u00c3\u0083\u00c2\u00b3 correctamente y segu\u00c3\u0083\u00c2\u00ada ocupando el puerto 8080.\n* **Soluci\u00c3\u0083\u00c2\u00b3n:** Identificar el PID del proceso que ocupaba el puerto 8080 usando `netstat -ano | findstr :8080` y luego finalizar la tarea con `taskkill /PID [PID] /F` en la l\u00c3\u0083\u00c2\u00adnea de comandos (como administrador).\n\n### Error 1.3: Permisos de XAMPP en Windows\n* **S\u00c3\u0083\u00c2\u00adntoma:** El panel de control de XAMPP (nuevo) fallaba al iniciarse, mostrando errores `EAccessViolation` y `Error: Cannot create file \"C:\\Users\\...\\xampp-control.ini\". Acceso denegado`.\n* **Causa:** El panel de control no ten\u00c3\u0083\u00c2\u00ada permisos de administrador para escribir su archivo de configuraci\u00c3\u0083\u00c2\u00b3n en la carpeta `AppData` del usuario.\n* **Soluci\u00c3\u0083\u00c2\u00b3n:** Ejecutar siempre `xampp-control.exe` usando la opci\u00c3\u0083\u00c2\u00b3n \"Ejecutar como administrador\".\n\n### Error 1.4: Conflicto de Puerto de MySQL\n* **S\u00c3\u0083\u00c2\u00adntoma:** Al intentar iniciar MySQL (como administrador), el panel de XAMPP mostraba `Error: MySQL shutdown unexpectedly... This may be due to a blocked port`.\n* **Causa:** El servicio `mysqld.exe` de la *antigua* instalaci\u00c3\u0083\u00c2\u00b3n de XAMPP segu\u00c3\u0083\u00c2\u00ada ejecut\u00c3\u0083\u00c2\u00a1ndose en segundo plano, bloqueando el puerto 3306 e impidiendo que el nuevo servicio se iniciara.\n* **Soluci\u00c3\u0083\u00c2\u00b3n:** Se utiliz\u00c3\u0083\u00c2\u00b3 `netstat -ano | findstr :3306` para encontrar el ID de Proceso (PID) del `mysqld.exe` conflictivo y se finaliz\u00c3\u0083\u00c2\u00b3 la tarea desde el Administrador de Tareas.\n\n### Error 1.4: Configuraci\u00c3\u0083\u00c2\u00b3n de Dialecto de Spring (Post-actualizaci\u00c3\u0083\u00c2\u00b3n)\n* **S\u00c3\u0083\u00c2\u00adntoma:** Tras actualizar XAMPP, la aplicaci\u00c3\u0083\u00c2\u00b3n Spring Boot no arrancaba, mostrando `BeanCreationException: Unable to determine Dialect`.\n* **Causa:** Ir\u00c3\u0083\u00c2\u00b3nicamente, al quitar el dialecto (recomendado para MySQL 5.5), la auto-detecci\u00c3\u0083\u00c2\u00b3n de Hibernate 6 fall\u00c3\u0083\u00c2\u00b3 con MySQL 8.\n* **Soluci\u00c3\u0083\u00c2\u00b3n:** Se volvi\u00c3\u0083\u00c2\u00b3 a a\u00c3\u0083\u00c2\u00b1adir `spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQLDialect` al archivo `application.properties`.\n\n### Error 1.5: Configuraci\u00c3\u0083\u00c2\u00b3n de Contrase\u00c3\u0083\u00c2\u00b1a de Spring\n* **S\u00c3\u0083\u00c2\u00adntoma:** Tras arreglar el dialecto, la aplicaci\u00c3\u0083\u00c2\u00b3n segu\u00c3\u0083\u00c2\u00ada sin arrancar, mostrando `BeanCreationException: Access denied for user 'root'@'localhost' (using password: YES)`.\n* **Causa:** La nueva instalaci\u00c3\u0083\u00c2\u00b3n de XAMPP usa el usuario `root` sin contrase\u00c3\u0083\u00c2\u00b1a, pero `application.properties` segu\u00c3\u0083\u00c2\u00ada configurado con `spring.datasource.password=root`.\n* **Soluci\u00c3\u0083\u00c2\u00b3n:** Se cambi\u00c3\u0083\u00c2\u00b3 la configuraci\u00c3\u0083\u00c2\u00b3n a `spring.datasource.password=` (vac\u00c3\u0083\u00c2\u00ado) en `application.properties`.\n\n---\n\n## 2. JavaScript (Frontend)\n\nEstos errores impidieron que el navegador enviara los datos al backend, aunque el backend ya funcionaba.\n\n### Error 2.1: M\u00c3\u0083\u00c2\u00a9todo HTTP Incorrecto (PUT vs. POST)\n* **S\u00c3\u0083\u00c2\u00adntoma:** Los datos no se guardaban. Si se hubiera inspeccionado la pesta\u00c3\u0083\u00c2\u00b1a \"Red\" (Network) del navegador, se habr\u00c3\u0083\u00c2\u00ada visto un error `405 Method Not Allowed`.\n* **Causa:** El script `opcionesForm.js` enviaba los datos usando `method: \"PUT\"`, pero el `BDController.java` esperaba un `method: \"POST\"` (definido por la anotaci\u00c3\u0083\u00c2\u00b3n `@PostMapping(\"/insertar\")`).\n* **Soluci\u00c3\u0083\u00c2\u00b3n:** Se modific\u00c3\u0083\u00c2\u00b3 la llamada `fetch` en `opcionesForm.js` para usar `method: \"POST\"`.\n\n### Error 2.2: Fallo de Carga de Script Din\u00c3\u0083\u00c2\u00a1mico (El Error Clave)\n* **S\u00c3\u0083\u00c2\u00adntoma:** Al pulsar \"Guardar\", la p\u00c3\u0083\u00c2\u00a1gina **se recargaba** por completo, ignorando el env\u00c3\u0083\u00c2\u00ado de datos.\n* **Causa:** El script `ventanaCreacion.js` cargaba el HTML de los formularios usando `.innerHTML`. Por seguridad, los navegadores no ejecutan las etiquetas `<script>` (como `<script src=\"...opcionesForm.js\">`) que se insertan de esta manera. Como resultado, el `e.preventDefault()` en `opcionesForm.js` nunca se ejecutaba.\n* **Soluci\u00c3\u0083\u00c2\u00b3n (en 3 partes):**\n    1.  **Modificar `ventanaCreacion.js`:** Se a\u00c3\u0083\u00c2\u00b1adi\u00c3\u0083\u00c2\u00b3 c\u00c3\u0083\u00c2\u00b3digo para que, *despu\u00c3\u0083\u00c2\u00a9s* de insertar el HTML, cree manualmente una nueva etiqueta `<script>`, le asigne el `.src` y la a\u00c3\u0083\u00c2\u00b1ada al `document.body`, forzando su carga y ejecuci\u00c3\u0083\u00c2\u00b3n.\n    2.  **Modificar `opcionesForm.js`:** Se elimin\u00c3\u0083\u00c2\u00b3 el *listener* `DOMContentLoaded`, ya que el script ahora se carga din\u00c3\u0083\u00c2\u00a1micamente *despu\u00c3\u0083\u00c2\u00a9s* de que el DOM principal se haya cargado.\n    3.  **Modificar HTML (Opciones):** Se eliminaron las etiquetas `<script src=\"...\">` de los 6 archivos HTML en `html/opciones/`, ya que `ventanaCreacion.js` ahora gestiona su carga.\n\n---\n\n## 3. HTML (Frontend)\n\n### Error 3.1: Ruta de Script Incorrecta\n* **S\u00c3\u0083\u00c2\u00adntoma:** La p\u00c3\u0083\u00c2\u00a1gina se segu\u00c3\u0083\u00c2\u00ada recargando incluso despu\u00c3\u0083\u00c2\u00a9s de implementar la soluci\u00c3\u0083\u00c2\u00b3n 2.2.\n* **Causa:** Un error en la refactorizaci\u00c3\u0083\u00c2\u00b3n. La ruta del script en los HTML de `html/opciones/` era `../js/...` (un nivel arriba), pero la ruta correcta desde esa carpeta era `../../js/...` (dos niveles arriba).\n* **Soluci\u00c3\u0083\u00c2\u00b3n:** Se corrigi\u00c3\u0083\u00c2\u00b3 la ruta del script en los 6 archivos HTML de `html/opciones/` a `src=\"../../js/components/opcionesForm.js\"`. (Nota: esta soluci\u00c3\u0083\u00c2\u00b3n se volvi\u00c3\u0083\u00c2\u00b3 obsoleta por la soluci\u00c3\u0083\u00c2\u00b3n 2.2, pero fue un paso intermedio en la depuraci\u00c3\u0083\u00c2\u00b3n).\n\n---\n\n## 4. React Migration (SPA)\n\n### Error 4.1: Critical Blank Screen on Startup\n* **Symptom:** The new React application loaded a blank dark screen. The index.html was served, but the `#root` element remained empty. No obvious errors in the browser console initially.\n* **Cause**: The `src/main/frontend/jsx/main.jsx` entry point had a ReferenceError. It used `rootElement` in a conditional check before defining it.\n* **Solution**: Correctly defined `const rootElement = document.getElementById('root');` before usage. Added robust try-catch blocks during debugging to verify the fix, then cleaned them up.\n\n---\n\n## 5. Multi-Tenancy & SPA Architecture (v3.6.0)\n\n### Error 5.1: 500 Internal Server Error (Missing User Data Folder)\n* **S\u00c3\u00adntoma:** Al intentar crear un proyecto con \newuser, el servidor devolv\u00c3\u00ada Error 500. El log mostraba java.sql.SQLException: path to '.../data/users/user_3.db' does not exist.\n* **Causa:** La l\u00c3\u00b3gica de aislamiento tenant intentaba conectar a una base de datos SQLite en una carpeta (data/users) que no exist\u00c3\u00ada f\u00c3\u00adsicamente en el entorno de despliegue, aunque el usuario s\u00c3\u00ad exist\u00c3\u00ada en la BD principal.\n* **Soluci\u00c3\u00b3n:** Se a\u00c3\u00b1adi\u00c3\u00b3 la creaci\u00c3\u00b3n autom\u00c3\u00a1tica de directorios en el servicio de registro. Para este caso puntual, se repar\u00c3\u00b3 manualmente creando la carpeta src/main/resources/data/users y copiando el template.\n\n### Error 5.2: 404 Whitelabel Error en Recarga (SPA Routing)\n* **S\u00c3\u00adntoma:** Al recargar la p\u00c3\u00a1gina en una ruta profunda (ej. /project/5/bible), Spring Boot devolv\u00c3\u00ada un 404.\n* **Causa:** Spring Boot intentaba resolver la URL como un recurso est\u00c3\u00a1tico o endpoint API. Al no existir, fallaba. React Router solo puede manejar la ruta si el servidor devuelve index.html primero.\n* **Soluci\u00c3\u00b3n:**\n    1.  Se cre\u00c3\u00b3 SpaController.java para redirigir cualquier ruta no-API y no-est\u00c3\u00a1tica (regex /{path:[^\\.]*}) hacia \forward:/index.html.\n    2.  Se habilit\u00c3\u00b3 spring.mvc.pathmatch.matching-strategy=ant_path_matcher en \u0007pplication.properties para soportar las regex complejas.\n\n### Error 5.3: UI Desactualizada tras Cambios (Build Pipeline)\n* **S\u00c3\u00adntoma:** Los cambios en Sidebar (iconos colapsados) no se ve\u00c3\u00adan en el navegador a pesar de estar codificados.\n* **Causa:** El servidor Spring Boot serv\u00c3\u00ada los archivos est\u00c3\u00a1ticos de \target/classes/static, que eran una copia antigua. Vite no estaba compilando autom\u00c3\u00a1ticamente.\n* **Soluci\u00c3\u00b3n:** Se actualiz\u00c3\u00b3 INICIAR.bat para ejecutar \npm run build antes de arrancar el servidor Java, garantizando que el frontend siempre est\u00c3\u00a9 sincronizado.\n\n\n### Error Critical 500: 'No such table: cuaderno' (SQLite)\n**S\u00c3\u00adntoma:** Error 500 intermitente al cargar workspaces o crear carpetas. Logs truncados imped\u00c3\u00adan ver la causa.\n**Diagn\u00c3\u00b3stico:**\n- GlobalExceptionHandler revel\u00c3\u00b3 SQLITE_ERROR: no such table: cuaderno.\n- La herramienta Diagnostic ve\u00c3\u00ada la tabla, pero Hibernate no.\n- Causa ra\u00c3\u00adz: Ambig\u00c3\u00bcedad en la ruta relativa de JDBC (jdbc:sqlite:src/...) vs el directorio de trabajo de ejecuci\u00c3\u00b3n.\n**Soluci\u00c3\u00b3n:**\n1. Hardcodear ruta absoluta en \u0007pplication.properties: jdbc:sqlite:/src/... (o ruta f\u00c3\u00adsica).\n2. spring.jpa.hibernate.ddl-auto=none para evitar que Hibernate intente validar/crear esquema y conf\u00c3\u00ade en DatabaseMigration.\n**Estado:** Resuelto. Logs movidos a carpeta /Data.\n\n## [2026-01-02] Limpieza de directorio Data\n**Acci\u00c3\u0083\u00c2\u00b3n:** Se movieron \backend.log, server.log, startup.log, \trace.txt del directorio Data a Docs/logs para centralizar la auditor\u00c3\u0083\u00c2\u00ada.\n\n## [06/01/2026] Pantalla Blanca (Crash MapEditor)\n**S\u00c3\u0083\u00c2\u00adntoma:** Pantalla blanca al cargar la app. Error silencioso de importaci\u00c3\u0083\u00c2\u00b3n.\n**Diagn\u00c3\u0083\u00c2\u00b3stico:** Conflicto de versiones. \neact-konva v19 requiere React 19, pero el proyecto usa React 18.\n**Soluci\u00c3\u0083\u00c2\u00b3n:** Downgrade a \neact-konva@18.2.10 y konva@9.3.16.\n**Estado:** Resuelto.\n\n---\n### Error: SQLITE_ERROR: no such table: cuaderno\n* **S\u00c3\u0083\u00c6\u0092ntoma:** Errores de base de datos al iniciar o abrir proyectos.\n* **Causa:** Uso de SQLite en memoria para el contexto maestro y falta de CREATE TABLE en migraciones.\n* **Soluci\u00c3\u0083\u00c6\u0092n:** Cambiado a SQLite persistente en MultiTenantDataSource.java y habilitado CREATE TABLE IF NOT EXISTS en DatabaseMigration.java.\n* **Estado:** Resuelto.\n\n### Error: 401 Unauthorized / Password Generada\n* **S\u00c3\u0083\u00c6\u0092ntoma:** Bloqueo de acceso a la API y logs de seguridad de Spring activados.\n* **Causa:** Configuraci\u00c3\u0083\u00c6\u0092n de seguridad por defecto activada; sesion de proyecto se activaba demasiado tarde.\n* **Soluci\u00c3\u0083\u00c6\u0092n:** Configuraci\u00c3\u0083\u00c6\u0092n de SecurityConfig.java con permitAll() y activaci\u00c3\u0083\u00c6\u0092n de sesi\u00c3\u0083\u00c6\u0092n en ProyectoController.java antes de validaciones de metadatos.\n* **Estado:** Resuelto.\n\n### Error: Bot\u00c3\u0083\u00c6\u0092n 'Guardar' desaparecido en EntityBuilder\n* **S\u00c3\u0083\u00c6\u0092ntoma:** Los usuarios no pod\u00c3\u0083\u00c6\u0092an guardar entidades creadas.\n* **Causa:** Posicionamiento \fixed oculto por el sidebar y conflicto de z-index (Stacking Context).\n* **Soluci\u00c3\u0083\u00c6\u0092n:** Redise\u00c3\u0083\u00c6\u0092o de la cabecera de EntityBuilder.jsx para incluir botones persistentes y eliminaci\u00c3\u0083\u00c6\u0092n de z-0 en ArchitectLayout.jsx.\n* **Estado:** Resuelto.\n\n\n### Error: Persistencia de Atributos en Entity Builder\n* **Descripci\u00c3\u0083n:** El usuario reporta que los atributos a\u00c3\u0083adidos a una entidad no se guardan correctamente, incluso despu\u00c3\u0083s de corregir la serializaci\u00c3\u0083n del backend (@JsonIgnore) y el ordenamiento (@OrderBy).\n* **Causa Sospechosa:** Posible fallo en la l\u00c3\u0083gica de actualizaci\u00c3\u0083n de estado en el frontend (IDs temporales vs reales) o timeout silencioso en el PATCH.\n* **Estado:** Pendiente de investigar.\n# Integraci\u00c3\u0083\u00c2\u00b3n M\u00c3\u0083\u00c2\u00b3dulo Timeline (Cronolog\u00c3\u0083\u00c2\u00adas)\n\n**Fecha:** 07/01/2026\n**Estado:** Completado / Estable\n\n## Resumen\nSe ha completado la integraci\u00c3\u0083\u00c2\u00b3n del m\u00c3\u0083\u00c2\u00b3dulo de **L\u00c3\u0083\u00c2\u00adneas de Tiempo** en la interfaz principal (`ArchitectLayout`), movi\u00c3\u0083\u00c2\u00a9ndolo de una vista aislada a un panel lateral contextual (Right Sidebar) y una visualizaci\u00c3\u0083\u00c2\u00b3n central dedicada. Adem\u00c3\u0083\u00c2\u00a1s, se han resuelto errores cr\u00c3\u0083\u00c2\u00adticos de persistencia y sincronizaci\u00c3\u0083\u00c2\u00b3n.\n\n## Cambios Realizados\n\n### 1. Arquitectura Frontend (React)\n- **Integraci\u00c3\u0083\u00c2\u00b3n en `ArchitectLayout.jsx`**:\n    - Se ha habilitado el modo `CUSTOM` en el panel lateral derecho para inyectar componentes din\u00c3\u0083\u00c2\u00a1micos mediante **React Portals**.\n    - `TimelineView.jsx` ahora renderiza los formularios de creaci\u00c3\u0083\u00c2\u00b3n/edici\u00c3\u0083\u00c2\u00b3n de eventos en el sidebar derecho, manteniendo la visualizaci\u00c3\u0083\u00c2\u00b3n del grafo en el centro.\n- **Sincronizaci\u00c3\u0083\u00c2\u00b3n de Contexto**:\n    - Se implement\u00c3\u0083\u00c2\u00b3 un `focus listener` en `ArchitectLayout` que fuerza la recarga del contexto del proyecto (`loadProject`) al cambiar de pesta\u00c3\u0083\u00c2\u00b1a en el navegador. Esto corrige el error de mezcla de datos entre proyectos abiertos simult\u00c3\u0083\u00c2\u00a1neamente.\n\n### 2. Backend (Spring Boot)\n- **Consolidaci\u00c3\u0083\u00c2\u00b3n de Entidades**:\n    - Se eliminaron las clases redundantes `EventoCronologia` y `LineaTemporal`.\n    - Se estandariz\u00c3\u0083\u00c2\u00b3 el uso de `EventoTiempo` y `LineaTiempo`.\n- **Nuevos Endpoints**:\n    - `DELETE /api/timeline/evento/{id}`: Para borrado de eventos.\n    - `DELETE /api/timeline/linea/{id}`: Para borrado de l\u00c3\u0083\u00c2\u00adneas de tiempo completas.\n- **Optimizaci\u00c3\u0083\u00c2\u00b3n JSON**:\n    - Se a\u00c3\u0083\u00c2\u00b1adi\u00c3\u0083\u00c2\u00b3 `@JsonProperty(access = WRITE_ONLY)` en las relaciones bidireccionales (`EventoTiempo` -> `LineaTiempo`) para permitir la deserializaci\u00c3\u0083\u00c2\u00b3n (guardado) sin causar recursi\u00c3\u0083\u00c2\u00b3n infinita en la serializaci\u00c3\u0083\u00c2\u00b3n (lectura).\n\n### 3. Correcci\u00c3\u0083\u00c2\u00b3n de Errores (Bugfixes)\n- **Error de Borrado (Timeline y Eventos)**:\n    - **Causa**: Faltaban los endpoints `DELETE` en el controlador y `api.js` fallaba al procesar respuestas vac\u00c3\u0083\u00c2\u00adas (`204 No Content`).\n    - **Soluci\u00c3\u0083\u00c2\u00b3n**: Implementaci\u00c3\u0083\u00c2\u00b3n de endpoints y parcheo de `api.js` para devolver `null` en lugar de lanzar `SyntaxError` en respuestas vac\u00c3\u0083\u00c2\u00adas.\n- **Error \"No events yet\"**:\n    - **Causa**: El filtrado en cliente fallaba porque la relaci\u00c3\u0083\u00c2\u00b3n `lineaTiempo` no se enviaba al cliente (por `@JsonIgnore`).\n    - **Soluci\u00c3\u0083\u00c2\u00b3n**: Se cambi\u00c3\u0083\u00c2\u00b3 a filtrado en servidor (`/timeline/linea/{id}/eventos`).\n- **Ordenamiento de Eventos Negativos**:\n    - **Soluci\u00c3\u0083\u00c2\u00b3n**: Se corrigi\u00c3\u0083\u00c2\u00b3 la l\u00c3\u0083\u00c2\u00b3gica de sugerencia de orden para respetar fechas negativas (a.C.), evitando que el contador se reinicie a 1 incorrectamente.\n\n## Archivos Clave Modificados\n- `src/main/frontend/jsx/pages/Timeline/TimelineView.jsx`\n- `src/main/frontend/jsx/components/layout/ArchitectLayout.jsx`\n- `src/main/frontend/js/services/api.js`\n- `src/main/java/com/worldbuilding/app/controller/TimelineController.java`\n- `src/main/java/com/worldbuilding/app/model/EventoTiempo.java`\n\n### Prompt ID: 9 (Consolidaci\u00c3\u00b3n Frontend y Fixes Finales)\n> Finalizar migraci\u00c3\u00b3n a Shadcn, arreglar l\u00c3\u00b3gica de Map Editor y estabilizar Backend database.\n**Resultados:**\n*   [UI] **Shadcn Refactor**: Migrados Button.jsx y InputModal.jsx al tema 'Arcane Void' (Indigo/Emerald).\n*   [FIX] **Map Editor**: Corregido bug de guardado (BINARY_DATA) para persistir im\u00c3\u00a1genes de fondo correctamente.\n*   [FIX] **Layout**: Eliminado auto-colapso forzado del Sidebar en la vista de Biblia.\n*   [BACKEND] **Estabilizaci\u00c3\u00b3n**:\n    *   Establecido `ddl-auto=none` como estrategia final (Pure Flyway) tras reparaci\u00c3\u00b3n inicial con `create`. `validate` se descart\u00c3\u00b3 por incompatibilidad de tipos SQLite.\n    *   Habilitado flyway.repair-on-migrate para corregir checksums de migraciones editadas.\n    *   Verificado arranque limpio y relaciones JPA (AtributoPlantilla/AtributoValor).\n\n\n### Prompt ID: 10 (Adaptaci\u00f3n Monousuario y Fix Cr\u00edtico Flyway)\n> Habilitar modo monousuario y corregir error persistente 'no such table' en arranque limpio.\n**Resultados:**\n*   [CRITICAL FIX] **Configuraci\u00f3n Flyway**: Detectado que spring.flyway.baseline-version=1 imped\u00eda la ejecuci\u00f3n de V1__init.sql en bases de datos vac\u00edas. **Soluci\u00f3n**: Deshabilitar baseline-version para forzar migraci\u00f3n inicial.\n*   [AUTH] **Modo Monousuario**: Implementado ProjectSessionInterceptor con l\u00f3gica de 'Auto-Login'. Si no hay sesi\u00f3n, se inyecta autom\u00e1ticamente usuario 'Architect' y proyecto 'Default World', eliminando la necesidad de Login/Registro.\n*   [STABILITY] **Reset Final**: Saneamiento completo de worldbuilding.db para garantizar consistencia de esquema Hibernate/Flyway.\n\n"};
        const sidebarNav = document.getElementById('sidebarNav');
        const markdownBody = document.getElementById('markdownBody');
        const mainTitle = document.getElementById('mainTitle');
        const searchInput = document.getElementById('searchInput');

        function renderFile(name) {
            const content = docs[name];
            mainTitle.innerText = name.replace('.md', '').replaceAll('_', ' ');
            
            markdownBody.innerHTML = marked.parse(content);

            document.querySelectorAll('.nav-link').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.name === name);
            });
            
            window.scrollTo(0, 0);
        }

        function init() {
            const files = Object.keys(docs).sort();
            
            files.forEach(name => {
                const a = document.createElement('a');
                a.className = 'nav-link';
                a.href = '#';
                a.dataset.name = name;
                a.innerText = name.replace('.md', '').replaceAll('_', ' ');
                a.onclick = (e) => {
                    e.preventDefault();
                    renderFile(name);
                };
                sidebarNav.appendChild(a);
            });

            if (files.length > 0) {
                const priority = files.find(f => f.includes('manifiesto')) || files.find(f => f.includes('log_prompts')) || files[0];
                renderFile(priority);
            }
            
            searchInput.oninput = (e) => {
                const term = e.target.value.toLowerCase();
                document.querySelectorAll('.nav-link').forEach(link => {
                    const text = link.innerText.toLowerCase();
                    link.style.display = text.includes(term) ? 'block' : 'none';
                });
            };
        }

        init();
    </script>
</body>
</html>
