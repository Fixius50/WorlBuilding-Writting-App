<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../css/ventanaProyectos.css">
    <title>Ventana Proyectos</title>
</head>
<body>
    <div class="panel0">
        <!-- Aquí entra el menú con opciones, 
         de las cuales te llevan a ventanas de distintas cosas. -->
        <div class="top">
            <div class="menu-desplegable">   
                <b>MENÚ</b>
                <div class="content">
                    <!-- Hacer que la letra se esconda hasta que se pase el ratón por encima.
                    Luego hacer que se quede el último recuadro del cual se haya puesto el ratón y no se vaya--> 
                    <button class="option" id="bt1" onclick="abrirVentanaCreacion()">Generar objetos&sc;</button>
                    <!--
                    <button class="option" id="bt1" onclick="">Importar (no disponible) &sc;</button>
                    <button class="option" id="bt1" onclick="">Exportar (no disponible) &sc;</button>
                    <button class="option" id="bt1" onclick="">Wiki (no disponible) &sc;</button>
                    <button class="option" id="bt1" onclick="">Apuntes (no disponible) &sc;</button> 
                    -->
                    <button class="option" id="bt1" onclick="abrirVentanaAjustes()">Ajustes del proyecto&sc;</button>
                    <button class="option" id="bt1" onclick="abrirVentanaMenuInicial()">Página de inicio &sc;</button>
                    <b>&dArr;</b>
                </div>
            </div>
            <!-- Aquí entra algo que ya veré que hacer. A lo mejor un gif animado o
             la autoría con el nombre del proyecto. Más tarde se editará para mejorarlo.-->
            <div class="infoTop">
                <header class="header-top"><!-- Aquí va el nombre del proyecto y el tipo -->
                    <b id="nombre-proyecto" oninput="mostarInfoProyecto()"></b>
                </header>
                
                <nav class="navTop">
                    <!-- Esto son pestañas que se despliegan. Los nombres indican cosas generales.
                     Ej: la pestaña "Construcción" agrega dentro opciones relacionadas a la puesta
                     de las cosas/fichas (personajes/objetos/lugares, etc...), como las subopciones:
                     - Agregar
                     - Editar
                     - Eliminar -->
                    <header class="construccion">Construcción</header>
                    <header class="estado">Estado</header>
                    <header class="nv">Eliminar</header>
                    <header class="nv">Construcción</header>
                    <header class="nv">Algo</header>
                    <header class="nv">Estado</header>
                </nav>
            </div>
        </div>
        <div class="area-central">
            <section class="objects">
                <p>Aquí van como "bolsas" que agrupan contenido general</p>
            </section>
            <section class="ground">
                <b>Aquí va un script para los mapas</b>
                <p>Los elementos de "objects" se arrastran para colocarlos aquí.</p>
                <!-- Aquí se despliegan las opciones de "nav-top" según lo que sean -->
            </section>
        </div>
    </div>
</body>
<script>
    let nombreProyectoGlobal = null;

    function abrirVentanaCreacion() {
        if (!nombreProyectoGlobal) {
            alert("No hay proyecto activo");
            return;
        }
        window.location.href = `../html/ventanaCreacion.html?proyecto=${encodeURIComponent(nombreProyectoGlobal)}`;
    }

    function abrirVentanaAjustes() {
        if (!nombreProyectoGlobal) {
            alert("No hay proyecto activo");
            return;
        }
        window.location.href = `../html/ventanaAjustes.html?proyecto=${encodeURIComponent(nombreProyectoGlobal)}`;
    }

    function abrirVentanaMenuInicial() {
        if (!nombreProyectoGlobal) {
            alert("No hay proyecto activo");
            return;
        }
        window.location.href = `../menuInicialLog.html`;
    }

    document.addEventListener('DOMContentLoaded', () => {
        fetch('/api/proyectos/activo')
        .then(res => {
            if (!res.ok) throw new Error("No hay proyecto activo");
            return res.text(); // <-- Cambia a .text()
        })
        .then(texto => {
            // Extrae nombre y enfoque del string recibido
            // Ejemplo: "Proyecto activo: MiProyecto - Enfoque: Fantasía"
            let nombre = "";
            let enfoque = "";
            const match = texto.match(/^Proyecto activo: (.+) - Enfoque: (.+)$/);
            if (match) {
                nombre = match[1];
                enfoque = match[2];
            }
            // Ahora puedes usar nombre y enfoque como antes
            nombreProyectoGlobal = nombre;
            document.getElementById("nombre-proyecto").textContent = nombre + " (" + enfoque + ")";
        })
        .catch(err => {
            document.getElementById("nombre-proyecto").textContent = "Sin proyecto activo";
        });
        let dataFolder = null;

        fetch('/api/config')
            .then(res => res.json())
            .then(config => {
                dataFolder = config.dataFolder;
                // Ahora puedes usar dataFolder en tu JS
                console.log("Ruta dataFolder:", dataFolder);
            });
    });
</script>
</html>