<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cuaderno - Escritura Inmersiva</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600&family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="../css/glass_theme.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap"
        rel="stylesheet" />
    <link rel="stylesheet" href="../css/escritura.css">
    <style>
        .notebook-title {
            font-family: 'Playfair Display', serif;
        }
    </style>
</head>

<body class="bg-slate-950 text-slate-200 font-display min-h-screen flex flex-col hidden-scrollbar overflow-hidden">

    <!-- Top Radial Menu -->
    <div class="nav-trigger-container" id="nav-container">
        <div class="nav-trigger" id="nav-trigger">
            <span class="material-symbols-outlined text-indigo-400 text-2xl">keyboard_arrow_down</span>
        </div>
        <div class="radial-menu-container" id="radial-menu">
            <div class="radial-menu-bg"></div>
            <a href="dashboard.html" class="nav-item" title="Dashboard"><span
                    class="material-symbols-outlined">dashboard</span><span class="tooltip">Dashboard</span></a>
            <a href="libreria.html" class="nav-item" title="Librer√≠a">
                <span class="material-symbols-outlined">library_books</span>
                <span class="tooltip">Librer√≠a</span>
            </a>
            <a href="biblia.html" class="nav-item" title="Biblia">
                <span class="material-symbols-outlined">menu_book</span>
                <span class="tooltip">Biblia</span>
            </a>
            <a href="timeline.html" class="nav-item" title="Cronolog√≠a">
                <span class="material-symbols-outlined">schedule</span>
                <span class="tooltip">Cronolog√≠a</span>
            </a>
            <a href="atlas.html" class="nav-item" title="Atlas">
                <span class="material-symbols-outlined">map</span>
                <span class="tooltip">Atlas</span>
            </a>
            <a href="conlang.html" class="nav-item" title="Ling√º√≠stica">
                <span class="material-symbols-outlined">translate</span>
                <span class="tooltip">Ling√º√≠stica</span>
            </a>
            <a href="settings.html" class="nav-item" title="Ajustes">
                <span class="material-symbols-outlined">settings</span>
                <span class="tooltip">Ajustes</span>
            </a>
        </div>
    </div>
    <div class="bg-overlay" id="menu-overlay" style="z-index: 9998;"></div>

    <!-- Main Content Housing -->
    <div class="flex flex-1 overflow-hidden relative">

        <!-- Sidebar (Lista de Hojas) -->
        <aside id="sheet-sidebar" class="w-80 bg-slate-900 border-r border-white/5 flex flex-col z-10 shrink-0">
            <!-- Sidebar Header -->
            <div class="p-4 border-b border-white/5 flex items-center justify-between">
                <h2 class="text-xs font-bold uppercase tracking-wider text-slate-400">Hojas</h2>
                <button type="button" onclick="a√±adirNuevaHoja()"
                    class="p-1.5 rounded-lg bg-indigo-500/20 text-indigo-400 hover:bg-indigo-500 hover:text-white transition-all">
                    <span class="material-symbols-outlined text-sm">add</span>
                </button>
            </div>

            <!-- List -->
            <div id="hojas-list" class="flex-1 overflow-y-auto custom-scrollbar p-2 space-y-1">
                <!-- Items generated by JS -->
            </div>
        </aside>

        <!-- Main Canvas -->
        <main class="flex-1 overflow-y-auto relative scroll-smooth bg-slate-950 flex flex-col items-center py-6 px-4"
            id="main-scroll">

            <!-- Premium Header -->
            <!-- Standard Header (Librer√≠a Style) -->
            <div class="w-full max-w-[900px] mb-8 mt-24">
                <nav class="flex items-center gap-2 text-xs text-slate-500 mb-2">
                    <a href="dashboard.html" class="hover:text-indigo-400">Dashboard</a>
                    <span class="material-symbols-outlined text-[14px]">chevron_right</span>
                    <a href="libreria.html" class="hover:text-indigo-400" id="project-breadcrumb-link">Proyecto</a>
                    <span class="material-symbols-outlined text-[14px]">chevron_right</span>
                    <span class="text-white font-bold" id="chapter-breadcrumb">Cap√≠tulo</span>
                </nav>
                <div
                    class="flex items-end justify-between p-4 bg-slate-900/50 rounded-2xl border border-white/5 backdrop-blur-sm">
                    <div class="flex items-center gap-6">
                        <div>
                            <h1 class="text-3xl font-black text-white tracking-tight leading-tight"
                                id="project-breadcrumb">
                                T√≠tulo del Cuaderno
                            </h1>
                            <p class="text-sm text-slate-400 mt-1 flex items-center gap-2">
                                <span class="text-emerald-500 font-bold" id="save-status">Guardado</span>
                            </p>
                        </div>
                    </div>

                    <div class="flex items-center gap-4">
                        <div class="text-right mr-4 hidden sm:block">
                            <p class="text-[10px] font-bold uppercase tracking-tighter opacity-50 text-slate-400">
                                Palabras</p>
                            <p class="text-sm font-mono text-slate-200" id="word-count">0</p>
                        </div>

                        <!-- Actions Group (Moved here) -->
                        <div class="flex items-center gap-1 bg-slate-800 rounded-xl p-1 border border-white/5 mr-2">
                            <button type="button" onclick="a√±adirNuevaHoja()"
                                class="p-2 hover:bg-white/10 rounded-lg text-indigo-400 hover:text-white transition-colors"
                                title="Nueva Hoja">
                                <span class="material-symbols-outlined text-sm">add</span>
                            </button>
                            <div class="w-px h-4 bg-white/5"></div>
                            <button type="button" onclick="eliminarHojaActual()"
                                class="p-2 hover:bg-white/10 rounded-lg text-red-400 hover:text-white transition-colors"
                                title="Eliminar Hoja">
                                <span class="material-symbols-outlined text-sm">delete</span>
                            </button>
                        </div>


                        <button id="btn-toggle-notes" title="Ver Notas R√°pidas"
                            class="size-10 rounded-xl bg-slate-800 hover:bg-slate-700 flex items-center justify-center text-slate-400 hover:text-white border border-white/5 transition-all shadow-lg">
                            <span class="material-symbols-outlined">vertical_split</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Page Container -->
            <div id="paper-container"
                class="group relative w-full max-w-[850px] min-h-[500px] bg-[#1a1f2e]/40 backdrop-blur-xl rounded-lg p-20 shadow-2xl transition-all duration-500 border border-white/5 mb-32 h-auto">
                <!-- Page Marker -->
                <div class="absolute right-10 top-10 text-slate-700 text-xs font-mono font-bold opacity-40 select-none">
                    @3</div>

                <!-- Editable Area -->
                <div id="editor"
                    class="text-xl leading-[1.8] text-slate-300 font-serif outline-none min-h-[500px] h-auto transition-all pr-4"
                    contenteditable="true" spellcheck="false" placeholder="La tormenta soplaba fuerte...">
                    <!-- Content will be loaded here -->
                </div>
            </div>

            <!-- Floating Toolbar (Now outside of container to work with fixed positioning) -->
            <div
                class="fixed bottom-12 left-1/2 -translate-x-1/2 bg-[#0f172a]/90 backdrop-blur-xl px-6 py-3 rounded-full border border-white/10 shadow-2xl flex items-center gap-6 z-50 animate-slide-up">
                <div class="flex items-center gap-4">
                    <button class="text-slate-400 hover:text-white transition-colors" title="Negrita"><b>B</b></button>
                    <button class="text-slate-400 hover:text-white transition-colors" title="It√°lica"><i>I</i></button>
                </div>
                <div class="w-px h-6 bg-white/10"></div>
                <div class="flex items-center gap-4">
                    <button class="text-slate-400 hover:text-white transition-colors font-bold text-xs">H1</button>
                    <button class="text-slate-400 hover:text-white transition-colors font-bold text-xs">H2</button>
                    <button class="text-slate-400 hover:text-white transition-colors"><span
                            class="material-symbols-outlined">format_quote</span></button>
                </div>
                <div class="w-px h-6 bg-white/10"></div>
                <button id="btn-mention-trigger"
                    class="size-8 rounded-full bg-indigo-500/20 flex items-center justify-center text-emerald-400 border border-indigo-500/30 hover:bg-indigo-500 hover:text-white transition-all shadow-lg shadow-indigo-500/20">
                    <span class="material-symbols-outlined text-lg">alternate_email</span>
                </button>
            </div>

        </main>

        <!-- Right Sidebar (Notas R√°pidas) -->
        <aside id="notes-sidebar"
            class="hidden w-80 flex flex-col border-l border-white/5 bg-slate-950/50 backdrop-blur-md z-20 transition-all duration-300">
            <div class="p-6 border-b border-white/5 flex items-center justify-between">
                <h3 class="text-[10px] font-black uppercase tracking-[2px] text-slate-500">Notas R√°pidas</h3>
            </div>

            <!-- Quick Note Creation (Inline) -->
            <div class="p-5 border-b border-white/5 bg-indigo-500/5">
                <form id="form-nota-rapida" onsubmit="guardarNotaRapida(event)" class="space-y-3">
                    <textarea id="note-input"
                        class="w-full bg-slate-900/50 border border-white/5 rounded-xl px-4 py-3 text-xs text-white placeholder-slate-600 focus:outline-none focus:border-indigo-500/50 transition-all resize-none"
                        rows="3" placeholder="A√±adir nota en l√≠nea actual..."></textarea>
                    <button type="submit"
                        class="w-full py-2 bg-indigo-600 hover:bg-indigo-500 text-white rounded-lg text-[10px] font-black uppercase tracking-widest transition-all flex items-center justify-center gap-2">
                        <span class="material-symbols-outlined text-xs">add</span>
                        Guardar Nota
                    </button>
                </form>
            </div>

            <!-- Quick Notes List -->
            <div class="flex-1 overflow-y-auto p-6 space-y-6" id="quick-notes-list">
                <!-- Example Note 1 -->
                <div class="space-y-3 animate-fade-in">
                    <div class="flex justify-between items-center">
                        <span
                            class="px-2 py-0.5 rounded bg-indigo-500/20 text-indigo-300 text-[9px] font-bold uppercase tracking-wider border border-indigo-500/20">Lore</span>
                        <span class="text-[9px] text-slate-600 font-bold uppercase tracking-tighter">Hace 5
                            min</span>
                    </div>
                    <p
                        class="text-xs text-slate-400 leading-relaxed bg-[#1e293b]/30 p-4 rounded-xl border border-white/5">
                        Recordar que los Guardianes del Norte son ciegos a la magia de ilusi√≥n, pero huelen el
                        miedo.
                    </p>
                    <div class="flex gap-2">
                        <span
                            class="text-[9px] text-slate-600 font-bold hover:text-indigo-400 cursor-pointer">#Magia</span>
                        <span
                            class="text-[9px] text-slate-600 font-bold hover:text-indigo-400 cursor-pointer">#Enemigos</span>
                    </div>
                </div>

                <!-- Example Note 2 -->
                <div class="space-y-3 animate-fade-in" style="animation-delay: 100ms">
                    <div class="flex justify-between items-center">
                        <span
                            class="px-2 py-0.5 rounded bg-emerald-500/20 text-emerald-300 text-[9px] font-bold uppercase tracking-wider border border-emerald-500/20">Idea</span>
                        <span class="text-[9px] text-slate-600 font-bold uppercase tracking-tighter">Ayer</span>
                    </div>
                    <p
                        class="text-xs text-slate-400 leading-relaxed bg-[#1e293b]/30 p-4 rounded-xl border border-white/5">
                        ¬øY si Kael ya estuvo aqu√≠ antes pero le borraron la memoria?
                    </p>
                </div>
            </div>

    </div>
    </aside>
    </div>

    <!-- Dropdown & Modals -->
    <div id="mention-dropdown"
        class="absolute hidden flex-col glass-panel rounded-xl shadow-2xl overflow-hidden z-50 border border-indigo-500/30 min-w-[250px] animate-fade-in-up">
    </div>

    <div id="modal-crear"
        class="fixed inset-0 bg-slate-950/80 backdrop-blur-sm z-50 hidden flex-col items-center justify-center p-4">
        <div class="glass-panel w-full max-w-md rounded-2xl p-6 shadow-2xl border border-white/10 relative">
            <button onclick="cerrarModalCrear()" class="absolute top-4 right-4 text-slate-500 hover:text-white">
                <span class="material-symbols-outlined">close</span>
            </button>
            <h2 class="text-xl font-bold text-white mb-6 flex items-center gap-2">
                <span class="material-symbols-outlined text-emerald-400">add_circle</span>
                Nueva Entidad
            </h2>
            <form id="form-crear-rapida" onsubmit="guardarEntidadRapida(event)" class="space-y-4">
                <div>
                    <label class="text-xs text-slate-400 uppercase font-bold mb-1 block">Tipo de Entidad</label>
                    <select id="entidad-tipo-select" class="glass-input">
                        <option value="entidadindividual">üë§ Personaje</option>
                        <option value="entidadcolectiva">üë• Grupo / Facci√≥n</option>
                        <option value="zona">üó∫Ô∏è Lugar</option>
                        <option value="construccion">üèõÔ∏è Construcci√≥n</option>
                        <option value="efectos">‚ú® Objeto / Magia</option>
                    </select>
                </div>
                <div>
                    <label class="text-xs text-slate-400 uppercase font-bold mb-1 block">Nombre</label>
                    <input type="text" id="entidad-nombre" class="glass-input" required placeholder="Ej. Aragorn">
                </div>
                <div>
                    <label class="text-xs text-slate-400 uppercase font-bold mb-1 block">Breve Descripci√≥n</label>
                    <textarea id="entidad-descripcion" class="glass-input resize-none" rows="3"
                        placeholder="Heredero de Isildur..."></textarea>
                </div>
                <div class="flex justify-end gap-3 mt-6 pt-4 border-t border-white/5">
                    <button type="button"
                        class="px-4 py-2 text-sm font-bold text-slate-400 hover:text-white transition-colors"
                        onclick="cerrarModalCrear()">Cancelar</button>
                    <button type="submit"
                        class="glass-button bg-emerald-600 hover:bg-emerald-500 border-emerald-500/50">Crear
                        Entidad</button>
                </div>
            </form>
        </div>
    </div>

    <script src="../js/api.js"></script>
    <script src="../js/editor.js"></script>
    <script src="../js/navigation.js"></script>
</body>

</html>