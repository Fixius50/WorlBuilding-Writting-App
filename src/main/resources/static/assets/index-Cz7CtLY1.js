var KD=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var aae=KD(Je=>{function ZD(t,e){for(var r=0;r<e.length;r++){const n=e[r];if(typeof n!="string"&&!Array.isArray(n)){for(const i in n)if(i!=="default"&&!(i in t)){const a=Object.getOwnPropertyDescriptor(n,i);a&&Object.defineProperty(t,i,a.get?a:{enumerable:!0,get:()=>n[i]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function r(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(i){if(i.ep)return;i.ep=!0;const a=r(i);fetch(i.href,a)}})();var hE=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Th(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Bb={exports:{}},Bm={},zb={exports:{}},Ar={};var pE;function YD(){if(pE)return Ar;pE=1;var t=Symbol.for("react.element"),e=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),a=Symbol.for("react.provider"),s=Symbol.for("react.context"),o=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),c=Symbol.for("react.lazy"),f=Symbol.iterator;function p(X){return X===null||typeof X!="object"?null:(X=f&&X[f]||X["@@iterator"],typeof X=="function"?X:null)}var g={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},y=Object.assign,S={};function w(X,re,fe){this.props=X,this.context=re,this.refs=S,this.updater=fe||g}w.prototype.isReactComponent={},w.prototype.setState=function(X,re){if(typeof X!="object"&&typeof X!="function"&&X!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,X,re,"setState")},w.prototype.forceUpdate=function(X){this.updater.enqueueForceUpdate(this,X,"forceUpdate")};function C(){}C.prototype=w.prototype;function _(X,re,fe){this.props=X,this.context=re,this.refs=S,this.updater=fe||g}var T=_.prototype=new C;T.constructor=_,y(T,w.prototype),T.isPureReactComponent=!0;var N=Array.isArray,R=Object.prototype.hasOwnProperty,D={current:null},j={key:!0,ref:!0,__self:!0,__source:!0};function O(X,re,fe){var oe,se={},he=null,ae=null;if(re!=null)for(oe in re.ref!==void 0&&(ae=re.ref),re.key!==void 0&&(he=""+re.key),re)R.call(re,oe)&&!j.hasOwnProperty(oe)&&(se[oe]=re[oe]);var pe=arguments.length-2;if(pe===1)se.children=fe;else if(1<pe){for(var ye=Array(pe),ve=0;ve<pe;ve++)ye[ve]=arguments[ve+2];se.children=ye}if(X&&X.defaultProps)for(oe in pe=X.defaultProps,pe)se[oe]===void 0&&(se[oe]=pe[oe]);return{$$typeof:t,type:X,key:he,ref:ae,props:se,_owner:D.current}}function F(X,re){return{$$typeof:t,type:X.type,key:re,ref:X.ref,props:X.props,_owner:X._owner}}function z(X){return typeof X=="object"&&X!==null&&X.$$typeof===t}function G(X){var re={"=":"=0",":":"=2"};return"$"+X.replace(/[=:]/g,function(fe){return re[fe]})}var Z=/\/+/g;function I(X,re){return typeof X=="object"&&X!==null&&X.key!=null?G(""+X.key):re.toString(36)}function W(X,re,fe,oe,se){var he=typeof X;(he==="undefined"||he==="boolean")&&(X=null);var ae=!1;if(X===null)ae=!0;else switch(he){case"string":case"number":ae=!0;break;case"object":switch(X.$$typeof){case t:case e:ae=!0}}if(ae)return ae=X,se=se(ae),X=oe===""?"."+I(ae,0):oe,N(se)?(fe="",X!=null&&(fe=X.replace(Z,"$&/")+"/"),W(se,re,fe,"",function(ve){return ve})):se!=null&&(z(se)&&(se=F(se,fe+(!se.key||ae&&ae.key===se.key?"":(""+se.key).replace(Z,"$&/")+"/")+X)),re.push(se)),1;if(ae=0,oe=oe===""?".":oe+":",N(X))for(var pe=0;pe<X.length;pe++){he=X[pe];var ye=oe+I(he,pe);ae+=W(he,re,fe,ye,se)}else if(ye=p(X),typeof ye=="function")for(X=ye.call(X),pe=0;!(he=X.next()).done;)he=he.value,ye=oe+I(he,pe++),ae+=W(he,re,fe,ye,se);else if(he==="object")throw re=String(X),Error("Objects are not valid as a React child (found: "+(re==="[object Object]"?"object with keys {"+Object.keys(X).join(", ")+"}":re)+"). If you meant to render a collection of children, use an array instead.");return ae}function U(X,re,fe){if(X==null)return X;var oe=[],se=0;return W(X,oe,"","",function(he){return re.call(fe,he,se++)}),oe}function K(X){if(X._status===-1){var re=X._result;re=re(),re.then(function(fe){(X._status===0||X._status===-1)&&(X._status=1,X._result=fe)},function(fe){(X._status===0||X._status===-1)&&(X._status=2,X._result=fe)}),X._status===-1&&(X._status=0,X._result=re)}if(X._status===1)return X._result.default;throw X._result}var $={current:null},Q={transition:null},ie={ReactCurrentDispatcher:$,ReactCurrentBatchConfig:Q,ReactCurrentOwner:D};function te(){throw Error("act(...) is not supported in production builds of React.")}return Ar.Children={map:U,forEach:function(X,re,fe){U(X,function(){re.apply(this,arguments)},fe)},count:function(X){var re=0;return U(X,function(){re++}),re},toArray:function(X){return U(X,function(re){return re})||[]},only:function(X){if(!z(X))throw Error("React.Children.only expected to receive a single React element child.");return X}},Ar.Component=w,Ar.Fragment=r,Ar.Profiler=i,Ar.PureComponent=_,Ar.StrictMode=n,Ar.Suspense=l,Ar.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ie,Ar.act=te,Ar.cloneElement=function(X,re,fe){if(X==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+X+".");var oe=y({},X.props),se=X.key,he=X.ref,ae=X._owner;if(re!=null){if(re.ref!==void 0&&(he=re.ref,ae=D.current),re.key!==void 0&&(se=""+re.key),X.type&&X.type.defaultProps)var pe=X.type.defaultProps;for(ye in re)R.call(re,ye)&&!j.hasOwnProperty(ye)&&(oe[ye]=re[ye]===void 0&&pe!==void 0?pe[ye]:re[ye])}var ye=arguments.length-2;if(ye===1)oe.children=fe;else if(1<ye){pe=Array(ye);for(var ve=0;ve<ye;ve++)pe[ve]=arguments[ve+2];oe.children=pe}return{$$typeof:t,type:X.type,key:se,ref:he,props:oe,_owner:ae}},Ar.createContext=function(X){return X={$$typeof:s,_currentValue:X,_currentValue2:X,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},X.Provider={$$typeof:a,_context:X},X.Consumer=X},Ar.createElement=O,Ar.createFactory=function(X){var re=O.bind(null,X);return re.type=X,re},Ar.createRef=function(){return{current:null}},Ar.forwardRef=function(X){return{$$typeof:o,render:X}},Ar.isValidElement=z,Ar.lazy=function(X){return{$$typeof:c,_payload:{_status:-1,_result:X},_init:K}},Ar.memo=function(X,re){return{$$typeof:u,type:X,compare:re===void 0?null:re}},Ar.startTransition=function(X){var re=Q.transition;Q.transition={};try{X()}finally{Q.transition=re}},Ar.unstable_act=te,Ar.useCallback=function(X,re){return $.current.useCallback(X,re)},Ar.useContext=function(X){return $.current.useContext(X)},Ar.useDebugValue=function(){},Ar.useDeferredValue=function(X){return $.current.useDeferredValue(X)},Ar.useEffect=function(X,re){return $.current.useEffect(X,re)},Ar.useId=function(){return $.current.useId()},Ar.useImperativeHandle=function(X,re,fe){return $.current.useImperativeHandle(X,re,fe)},Ar.useInsertionEffect=function(X,re){return $.current.useInsertionEffect(X,re)},Ar.useLayoutEffect=function(X,re){return $.current.useLayoutEffect(X,re)},Ar.useMemo=function(X,re){return $.current.useMemo(X,re)},Ar.useReducer=function(X,re,fe){return $.current.useReducer(X,re,fe)},Ar.useRef=function(X){return $.current.useRef(X)},Ar.useState=function(X){return $.current.useState(X)},Ar.useSyncExternalStore=function(X,re,fe){return $.current.useSyncExternalStore(X,re,fe)},Ar.useTransition=function(){return $.current.useTransition()},Ar.version="18.3.1",Ar}var mE;function am(){return mE||(mE=1,zb.exports=YD()),zb.exports}var gE;function XD(){if(gE)return Bm;gE=1;var t=am(),e=Symbol.for("react.element"),r=Symbol.for("react.fragment"),n=Object.prototype.hasOwnProperty,i=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,a={key:!0,ref:!0,__self:!0,__source:!0};function s(o,l,u){var c,f={},p=null,g=null;u!==void 0&&(p=""+u),l.key!==void 0&&(p=""+l.key),l.ref!==void 0&&(g=l.ref);for(c in l)n.call(l,c)&&!a.hasOwnProperty(c)&&(f[c]=l[c]);if(o&&o.defaultProps)for(c in l=o.defaultProps,l)f[c]===void 0&&(f[c]=l[c]);return{$$typeof:e,type:o,key:p,ref:g,props:f,_owner:i.current}}return Bm.Fragment=r,Bm.jsx=s,Bm.jsxs=s,Bm}var vE;function QD(){return vE||(vE=1,Bb.exports=XD()),Bb.exports}var m=QD(),ne=am();const Qt=Th(ne),JD=ZD({__proto__:null,default:Qt},[ne]);var Q0={},Ub={exports:{}},Ws={},Gb={exports:{}},Vb={};var yE;function e8(){return yE||(yE=1,(function(t){function e(Q,ie){var te=Q.length;Q.push(ie);e:for(;0<te;){var X=te-1>>>1,re=Q[X];if(0<i(re,ie))Q[X]=ie,Q[te]=re,te=X;else break e}}function r(Q){return Q.length===0?null:Q[0]}function n(Q){if(Q.length===0)return null;var ie=Q[0],te=Q.pop();if(te!==ie){Q[0]=te;e:for(var X=0,re=Q.length,fe=re>>>1;X<fe;){var oe=2*(X+1)-1,se=Q[oe],he=oe+1,ae=Q[he];if(0>i(se,te))he<re&&0>i(ae,se)?(Q[X]=ae,Q[he]=te,X=he):(Q[X]=se,Q[oe]=te,X=oe);else if(he<re&&0>i(ae,te))Q[X]=ae,Q[he]=te,X=he;else break e}}return ie}function i(Q,ie){var te=Q.sortIndex-ie.sortIndex;return te!==0?te:Q.id-ie.id}if(typeof performance=="object"&&typeof performance.now=="function"){var a=performance;t.unstable_now=function(){return a.now()}}else{var s=Date,o=s.now();t.unstable_now=function(){return s.now()-o}}var l=[],u=[],c=1,f=null,p=3,g=!1,y=!1,S=!1,w=typeof setTimeout=="function"?setTimeout:null,C=typeof clearTimeout=="function"?clearTimeout:null,_=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function T(Q){for(var ie=r(u);ie!==null;){if(ie.callback===null)n(u);else if(ie.startTime<=Q)n(u),ie.sortIndex=ie.expirationTime,e(l,ie);else break;ie=r(u)}}function N(Q){if(S=!1,T(Q),!y)if(r(l)!==null)y=!0,K(R);else{var ie=r(u);ie!==null&&$(N,ie.startTime-Q)}}function R(Q,ie){y=!1,S&&(S=!1,C(O),O=-1),g=!0;var te=p;try{for(T(ie),f=r(l);f!==null&&(!(f.expirationTime>ie)||Q&&!G());){var X=f.callback;if(typeof X=="function"){f.callback=null,p=f.priorityLevel;var re=X(f.expirationTime<=ie);ie=t.unstable_now(),typeof re=="function"?f.callback=re:f===r(l)&&n(l),T(ie)}else n(l);f=r(l)}if(f!==null)var fe=!0;else{var oe=r(u);oe!==null&&$(N,oe.startTime-ie),fe=!1}return fe}finally{f=null,p=te,g=!1}}var D=!1,j=null,O=-1,F=5,z=-1;function G(){return!(t.unstable_now()-z<F)}function Z(){if(j!==null){var Q=t.unstable_now();z=Q;var ie=!0;try{ie=j(!0,Q)}finally{ie?I():(D=!1,j=null)}}else D=!1}var I;if(typeof _=="function")I=function(){_(Z)};else if(typeof MessageChannel<"u"){var W=new MessageChannel,U=W.port2;W.port1.onmessage=Z,I=function(){U.postMessage(null)}}else I=function(){w(Z,0)};function K(Q){j=Q,D||(D=!0,I())}function $(Q,ie){O=w(function(){Q(t.unstable_now())},ie)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(Q){Q.callback=null},t.unstable_continueExecution=function(){y||g||(y=!0,K(R))},t.unstable_forceFrameRate=function(Q){0>Q||125<Q?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):F=0<Q?Math.floor(1e3/Q):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_getFirstCallbackNode=function(){return r(l)},t.unstable_next=function(Q){switch(p){case 1:case 2:case 3:var ie=3;break;default:ie=p}var te=p;p=ie;try{return Q()}finally{p=te}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(Q,ie){switch(Q){case 1:case 2:case 3:case 4:case 5:break;default:Q=3}var te=p;p=Q;try{return ie()}finally{p=te}},t.unstable_scheduleCallback=function(Q,ie,te){var X=t.unstable_now();switch(typeof te=="object"&&te!==null?(te=te.delay,te=typeof te=="number"&&0<te?X+te:X):te=X,Q){case 1:var re=-1;break;case 2:re=250;break;case 5:re=1073741823;break;case 4:re=1e4;break;default:re=5e3}return re=te+re,Q={id:c++,callback:ie,priorityLevel:Q,startTime:te,expirationTime:re,sortIndex:-1},te>X?(Q.sortIndex=te,e(u,Q),r(l)===null&&Q===r(u)&&(S?(C(O),O=-1):S=!0,$(N,te-X))):(Q.sortIndex=re,e(l,Q),y||g||(y=!0,K(R))),Q},t.unstable_shouldYield=G,t.unstable_wrapCallback=function(Q){var ie=p;return function(){var te=p;p=ie;try{return Q.apply(this,arguments)}finally{p=te}}}})(Vb)),Vb}var xE;function Yk(){return xE||(xE=1,Gb.exports=e8()),Gb.exports}var bE;function t8(){if(bE)return Ws;bE=1;var t=am(),e=Yk();function r(d){for(var v="https://reactjs.org/docs/error-decoder.html?invariant="+d,E=1;E<arguments.length;E++)v+="&args[]="+encodeURIComponent(arguments[E]);return"Minified React error #"+d+"; visit "+v+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var n=new Set,i={};function a(d,v){s(d,v),s(d+"Capture",v)}function s(d,v){for(i[d]=v,d=0;d<v.length;d++)n.add(v[d])}var o=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),l=Object.prototype.hasOwnProperty,u=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,c={},f={};function p(d){return l.call(f,d)?!0:l.call(c,d)?!1:u.test(d)?f[d]=!0:(c[d]=!0,!1)}function g(d,v,E,A){if(E!==null&&E.type===0)return!1;switch(typeof v){case"function":case"symbol":return!0;case"boolean":return A?!1:E!==null?!E.acceptsBooleans:(d=d.toLowerCase().slice(0,5),d!=="data-"&&d!=="aria-");default:return!1}}function y(d,v,E,A){if(v===null||typeof v>"u"||g(d,v,E,A))return!0;if(A)return!1;if(E!==null)switch(E.type){case 3:return!v;case 4:return v===!1;case 5:return isNaN(v);case 6:return isNaN(v)||1>v}return!1}function S(d,v,E,A,H,Y,le){this.acceptsBooleans=v===2||v===3||v===4,this.attributeName=A,this.attributeNamespace=H,this.mustUseProperty=E,this.propertyName=d,this.type=v,this.sanitizeURL=Y,this.removeEmptyString=le}var w={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(d){w[d]=new S(d,0,!1,d,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(d){var v=d[0];w[v]=new S(v,1,!1,d[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(d){w[d]=new S(d,2,!1,d.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(d){w[d]=new S(d,2,!1,d,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(d){w[d]=new S(d,3,!1,d.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(d){w[d]=new S(d,3,!0,d,null,!1,!1)}),["capture","download"].forEach(function(d){w[d]=new S(d,4,!1,d,null,!1,!1)}),["cols","rows","size","span"].forEach(function(d){w[d]=new S(d,6,!1,d,null,!1,!1)}),["rowSpan","start"].forEach(function(d){w[d]=new S(d,5,!1,d.toLowerCase(),null,!1,!1)});var C=/[\-:]([a-z])/g;function _(d){return d[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(d){var v=d.replace(C,_);w[v]=new S(v,1,!1,d,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(d){var v=d.replace(C,_);w[v]=new S(v,1,!1,d,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(d){var v=d.replace(C,_);w[v]=new S(v,1,!1,d,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(d){w[d]=new S(d,1,!1,d.toLowerCase(),null,!1,!1)}),w.xlinkHref=new S("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(d){w[d]=new S(d,1,!1,d.toLowerCase(),null,!0,!0)});function T(d,v,E,A){var H=w.hasOwnProperty(v)?w[v]:null;(H!==null?H.type!==0:A||!(2<v.length)||v[0]!=="o"&&v[0]!=="O"||v[1]!=="n"&&v[1]!=="N")&&(y(v,E,H,A)&&(E=null),A||H===null?p(v)&&(E===null?d.removeAttribute(v):d.setAttribute(v,""+E)):H.mustUseProperty?d[H.propertyName]=E===null?H.type===3?!1:"":E:(v=H.attributeName,A=H.attributeNamespace,E===null?d.removeAttribute(v):(H=H.type,E=H===3||H===4&&E===!0?"":""+E,A?d.setAttributeNS(A,v,E):d.setAttribute(v,E))))}var N=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,R=Symbol.for("react.element"),D=Symbol.for("react.portal"),j=Symbol.for("react.fragment"),O=Symbol.for("react.strict_mode"),F=Symbol.for("react.profiler"),z=Symbol.for("react.provider"),G=Symbol.for("react.context"),Z=Symbol.for("react.forward_ref"),I=Symbol.for("react.suspense"),W=Symbol.for("react.suspense_list"),U=Symbol.for("react.memo"),K=Symbol.for("react.lazy"),$=Symbol.for("react.offscreen"),Q=Symbol.iterator;function ie(d){return d===null||typeof d!="object"?null:(d=Q&&d[Q]||d["@@iterator"],typeof d=="function"?d:null)}var te=Object.assign,X;function re(d){if(X===void 0)try{throw Error()}catch(E){var v=E.stack.trim().match(/\n( *(at )?)/);X=v&&v[1]||""}return`
`+X+d}var fe=!1;function oe(d,v){if(!d||fe)return"";fe=!0;var E=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(v)if(v=function(){throw Error()},Object.defineProperty(v.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(v,[])}catch(Be){var A=Be}Reflect.construct(d,[],v)}else{try{v.call()}catch(Be){A=Be}d.call(v.prototype)}else{try{throw Error()}catch(Be){A=Be}d()}}catch(Be){if(Be&&A&&typeof Be.stack=="string"){for(var H=Be.stack.split(`
`),Y=A.stack.split(`
`),le=H.length-1,be=Y.length-1;1<=le&&0<=be&&H[le]!==Y[be];)be--;for(;1<=le&&0<=be;le--,be--)if(H[le]!==Y[be]){if(le!==1||be!==1)do if(le--,be--,0>be||H[le]!==Y[be]){var _e=`
`+H[le].replace(" at new "," at ");return d.displayName&&_e.includes("<anonymous>")&&(_e=_e.replace("<anonymous>",d.displayName)),_e}while(1<=le&&0<=be);break}}}finally{fe=!1,Error.prepareStackTrace=E}return(d=d?d.displayName||d.name:"")?re(d):""}function se(d){switch(d.tag){case 5:return re(d.type);case 16:return re("Lazy");case 13:return re("Suspense");case 19:return re("SuspenseList");case 0:case 2:case 15:return d=oe(d.type,!1),d;case 11:return d=oe(d.type.render,!1),d;case 1:return d=oe(d.type,!0),d;default:return""}}function he(d){if(d==null)return null;if(typeof d=="function")return d.displayName||d.name||null;if(typeof d=="string")return d;switch(d){case j:return"Fragment";case D:return"Portal";case F:return"Profiler";case O:return"StrictMode";case I:return"Suspense";case W:return"SuspenseList"}if(typeof d=="object")switch(d.$$typeof){case G:return(d.displayName||"Context")+".Consumer";case z:return(d._context.displayName||"Context")+".Provider";case Z:var v=d.render;return d=d.displayName,d||(d=v.displayName||v.name||"",d=d!==""?"ForwardRef("+d+")":"ForwardRef"),d;case U:return v=d.displayName||null,v!==null?v:he(d.type)||"Memo";case K:v=d._payload,d=d._init;try{return he(d(v))}catch{}}return null}function ae(d){var v=d.type;switch(d.tag){case 24:return"Cache";case 9:return(v.displayName||"Context")+".Consumer";case 10:return(v._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return d=v.render,d=d.displayName||d.name||"",v.displayName||(d!==""?"ForwardRef("+d+")":"ForwardRef");case 7:return"Fragment";case 5:return v;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return he(v);case 8:return v===O?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof v=="function")return v.displayName||v.name||null;if(typeof v=="string")return v}return null}function pe(d){switch(typeof d){case"boolean":case"number":case"string":case"undefined":return d;case"object":return d;default:return""}}function ye(d){var v=d.type;return(d=d.nodeName)&&d.toLowerCase()==="input"&&(v==="checkbox"||v==="radio")}function ve(d){var v=ye(d)?"checked":"value",E=Object.getOwnPropertyDescriptor(d.constructor.prototype,v),A=""+d[v];if(!d.hasOwnProperty(v)&&typeof E<"u"&&typeof E.get=="function"&&typeof E.set=="function"){var H=E.get,Y=E.set;return Object.defineProperty(d,v,{configurable:!0,get:function(){return H.call(this)},set:function(le){A=""+le,Y.call(this,le)}}),Object.defineProperty(d,v,{enumerable:E.enumerable}),{getValue:function(){return A},setValue:function(le){A=""+le},stopTracking:function(){d._valueTracker=null,delete d[v]}}}}function ue(d){d._valueTracker||(d._valueTracker=ve(d))}function xe(d){if(!d)return!1;var v=d._valueTracker;if(!v)return!0;var E=v.getValue(),A="";return d&&(A=ye(d)?d.checked?"true":"false":d.value),d=A,d!==E?(v.setValue(d),!0):!1}function Se(d){if(d=d||(typeof document<"u"?document:void 0),typeof d>"u")return null;try{return d.activeElement||d.body}catch{return d.body}}function Ae(d,v){var E=v.checked;return te({},v,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:E??d._wrapperState.initialChecked})}function Me(d,v){var E=v.defaultValue==null?"":v.defaultValue,A=v.checked!=null?v.checked:v.defaultChecked;E=pe(v.value!=null?v.value:E),d._wrapperState={initialChecked:A,initialValue:E,controlled:v.type==="checkbox"||v.type==="radio"?v.checked!=null:v.value!=null}}function st(d,v){v=v.checked,v!=null&&T(d,"checked",v,!1)}function rt(d,v){st(d,v);var E=pe(v.value),A=v.type;if(E!=null)A==="number"?(E===0&&d.value===""||d.value!=E)&&(d.value=""+E):d.value!==""+E&&(d.value=""+E);else if(A==="submit"||A==="reset"){d.removeAttribute("value");return}v.hasOwnProperty("value")?Ct(d,v.type,E):v.hasOwnProperty("defaultValue")&&Ct(d,v.type,pe(v.defaultValue)),v.checked==null&&v.defaultChecked!=null&&(d.defaultChecked=!!v.defaultChecked)}function dt(d,v,E){if(v.hasOwnProperty("value")||v.hasOwnProperty("defaultValue")){var A=v.type;if(!(A!=="submit"&&A!=="reset"||v.value!==void 0&&v.value!==null))return;v=""+d._wrapperState.initialValue,E||v===d.value||(d.value=v),d.defaultValue=v}E=d.name,E!==""&&(d.name=""),d.defaultChecked=!!d._wrapperState.initialChecked,E!==""&&(d.name=E)}function Ct(d,v,E){(v!=="number"||Se(d.ownerDocument)!==d)&&(E==null?d.defaultValue=""+d._wrapperState.initialValue:d.defaultValue!==""+E&&(d.defaultValue=""+E))}var Ke=Array.isArray;function ut(d,v,E,A){if(d=d.options,v){v={};for(var H=0;H<E.length;H++)v["$"+E[H]]=!0;for(E=0;E<d.length;E++)H=v.hasOwnProperty("$"+d[E].value),d[E].selected!==H&&(d[E].selected=H),H&&A&&(d[E].defaultSelected=!0)}else{for(E=""+pe(E),v=null,H=0;H<d.length;H++){if(d[H].value===E){d[H].selected=!0,A&&(d[H].defaultSelected=!0);return}v!==null||d[H].disabled||(v=d[H])}v!==null&&(v.selected=!0)}}function ct(d,v){if(v.dangerouslySetInnerHTML!=null)throw Error(r(91));return te({},v,{value:void 0,defaultValue:void 0,children:""+d._wrapperState.initialValue})}function xt(d,v){var E=v.value;if(E==null){if(E=v.children,v=v.defaultValue,E!=null){if(v!=null)throw Error(r(92));if(Ke(E)){if(1<E.length)throw Error(r(93));E=E[0]}v=E}v==null&&(v=""),E=v}d._wrapperState={initialValue:pe(E)}}function ot(d,v){var E=pe(v.value),A=pe(v.defaultValue);E!=null&&(E=""+E,E!==d.value&&(d.value=E),v.defaultValue==null&&d.defaultValue!==E&&(d.defaultValue=E)),A!=null&&(d.defaultValue=""+A)}function Lt(d){var v=d.textContent;v===d._wrapperState.initialValue&&v!==""&&v!==null&&(d.value=v)}function Bt(d){switch(d){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Ne(d,v){return d==null||d==="http://www.w3.org/1999/xhtml"?Bt(v):d==="http://www.w3.org/2000/svg"&&v==="foreignObject"?"http://www.w3.org/1999/xhtml":d}var qe,St=(function(d){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(v,E,A,H){MSApp.execUnsafeLocalFunction(function(){return d(v,E,A,H)})}:d})(function(d,v){if(d.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in d)d.innerHTML=v;else{for(qe=qe||document.createElement("div"),qe.innerHTML="<svg>"+v.valueOf().toString()+"</svg>",v=qe.firstChild;d.firstChild;)d.removeChild(d.firstChild);for(;v.firstChild;)d.appendChild(v.firstChild)}});function it(d,v){if(v){var E=d.firstChild;if(E&&E===d.lastChild&&E.nodeType===3){E.nodeValue=v;return}}d.textContent=v}var lt={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Ie=["Webkit","ms","Moz","O"];Object.keys(lt).forEach(function(d){Ie.forEach(function(v){v=v+d.charAt(0).toUpperCase()+d.substring(1),lt[v]=lt[d]})});function de(d,v,E){return v==null||typeof v=="boolean"||v===""?"":E||typeof v!="number"||v===0||lt.hasOwnProperty(d)&&lt[d]?(""+v).trim():v+"px"}function ge(d,v){d=d.style;for(var E in v)if(v.hasOwnProperty(E)){var A=E.indexOf("--")===0,H=de(E,v[E],A);E==="float"&&(E="cssFloat"),A?d.setProperty(E,H):d[E]=H}}var ke=te({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Ee(d,v){if(v){if(ke[d]&&(v.children!=null||v.dangerouslySetInnerHTML!=null))throw Error(r(137,d));if(v.dangerouslySetInnerHTML!=null){if(v.children!=null)throw Error(r(60));if(typeof v.dangerouslySetInnerHTML!="object"||!("__html"in v.dangerouslySetInnerHTML))throw Error(r(61))}if(v.style!=null&&typeof v.style!="object")throw Error(r(62))}}function Re(d,v){if(d.indexOf("-")===-1)return typeof v.is=="string";switch(d){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Qe=null;function Ge(d){return d=d.target||d.srcElement||window,d.correspondingUseElement&&(d=d.correspondingUseElement),d.nodeType===3?d.parentNode:d}var wt=null,bt=null,pt=null;function Kt(d){if(d=wl(d)){if(typeof wt!="function")throw Error(r(280));var v=d.stateNode;v&&(v=si(v),wt(d.stateNode,d.type,v))}}function Wt(d){bt?pt?pt.push(d):pt=[d]:bt=d}function Ve(){if(bt){var d=bt,v=pt;if(pt=bt=null,Kt(d),v)for(d=0;d<v.length;d++)Kt(v[d])}}function vt(d,v){return d(v)}function Et(){}var er=!1;function gr(d,v,E){if(er)return d(v,E);er=!0;try{return vt(d,v,E)}finally{er=!1,(bt!==null||pt!==null)&&(Et(),Ve())}}function Ir(d,v){var E=d.stateNode;if(E===null)return null;var A=si(E);if(A===null)return null;E=A[v];e:switch(v){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(A=!A.disabled)||(d=d.type,A=!(d==="button"||d==="input"||d==="select"||d==="textarea")),d=!A;break e;default:d=!1}if(d)return null;if(E&&typeof E!="function")throw Error(r(231,v,typeof E));return E}var zr=!1;if(o)try{var Cr={};Object.defineProperty(Cr,"passive",{get:function(){zr=!0}}),window.addEventListener("test",Cr,Cr),window.removeEventListener("test",Cr,Cr)}catch{zr=!1}function fn(d,v,E,A,H,Y,le,be,_e){var Be=Array.prototype.slice.call(arguments,3);try{v.apply(E,Be)}catch(nt){this.onError(nt)}}var xr=!1,Tt=null,Ur=!1,Qn=null,Zi={onError:function(d){xr=!0,Tt=d}};function ds(d,v,E,A,H,Y,le,be,_e){xr=!1,Tt=null,fn.apply(Zi,arguments)}function As(d,v,E,A,H,Y,le,be,_e){if(ds.apply(this,arguments),xr){if(xr){var Be=Tt;xr=!1,Tt=null}else throw Error(r(198));Ur||(Ur=!0,Qn=Be)}}function ni(d){var v=d,E=d;if(d.alternate)for(;v.return;)v=v.return;else{d=v;do v=d,(v.flags&4098)!==0&&(E=v.return),d=v.return;while(d)}return v.tag===3?E:null}function sn(d){if(d.tag===13){var v=d.memoizedState;if(v===null&&(d=d.alternate,d!==null&&(v=d.memoizedState)),v!==null)return v.dehydrated}return null}function kn(d){if(ni(d)!==d)throw Error(r(188))}function In(d){var v=d.alternate;if(!v){if(v=ni(d),v===null)throw Error(r(188));return v!==d?null:d}for(var E=d,A=v;;){var H=E.return;if(H===null)break;var Y=H.alternate;if(Y===null){if(A=H.return,A!==null){E=A;continue}break}if(H.child===Y.child){for(Y=H.child;Y;){if(Y===E)return kn(H),d;if(Y===A)return kn(H),v;Y=Y.sibling}throw Error(r(188))}if(E.return!==A.return)E=H,A=Y;else{for(var le=!1,be=H.child;be;){if(be===E){le=!0,E=H,A=Y;break}if(be===A){le=!0,A=H,E=Y;break}be=be.sibling}if(!le){for(be=Y.child;be;){if(be===E){le=!0,E=Y,A=H;break}if(be===A){le=!0,A=Y,E=H;break}be=be.sibling}if(!le)throw Error(r(189))}}if(E.alternate!==A)throw Error(r(190))}if(E.tag!==3)throw Error(r(188));return E.stateNode.current===E?d:v}function Ls(d){return d=In(d),d!==null?gi(d):null}function gi(d){if(d.tag===5||d.tag===6)return d;for(d=d.child;d!==null;){var v=gi(d);if(v!==null)return v;d=d.sibling}return null}var ko=e.unstable_scheduleCallback,qa=e.unstable_cancelCallback,Ou=e.unstable_shouldYield,_o=e.unstable_requestPaint,on=e.unstable_now,Co=e.unstable_getCurrentPriorityLevel,fs=e.unstable_ImmediatePriority,ro=e.unstable_UserBlockingPriority,Yi=e.unstable_NormalPriority,no=e.unstable_LowPriority,Ue=e.unstable_IdlePriority,Ye=null,et=null;function ht(d){if(et&&typeof et.onCommitFiberRoot=="function")try{et.onCommitFiberRoot(Ye,d,void 0,(d.current.flags&128)===128)}catch{}}var Ze=Math.clz32?Math.clz32:Mr,Dt=Math.log,Pr=Math.LN2;function Mr(d){return d>>>=0,d===0?32:31-(Dt(d)/Pr|0)|0}var Br=64,vi=4194304;function zt(d){switch(d&-d){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return d&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return d&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return d}}function jr(d,v){var E=d.pendingLanes;if(E===0)return 0;var A=0,H=d.suspendedLanes,Y=d.pingedLanes,le=E&268435455;if(le!==0){var be=le&~H;be!==0?A=zt(be):(Y&=le,Y!==0&&(A=zt(Y)))}else le=E&~H,le!==0?A=zt(le):Y!==0&&(A=zt(Y));if(A===0)return 0;if(v!==0&&v!==A&&(v&H)===0&&(H=A&-A,Y=v&-v,H>=Y||H===16&&(Y&4194240)!==0))return v;if((A&4)!==0&&(A|=E&16),v=d.entangledLanes,v!==0)for(d=d.entanglements,v&=A;0<v;)E=31-Ze(v),H=1<<E,A|=d[E],v&=~H;return A}function al(d,v){switch(d){case 1:case 2:case 4:return v+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return v+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function tr(d,v){for(var E=d.suspendedLanes,A=d.pingedLanes,H=d.expirationTimes,Y=d.pendingLanes;0<Y;){var le=31-Ze(Y),be=1<<le,_e=H[le];_e===-1?((be&E)===0||(be&A)!==0)&&(H[le]=al(be,v)):_e<=v&&(d.expiredLanes|=be),Y&=~be}}function nr(d){return d=d.pendingLanes&-1073741825,d!==0?d:d&1073741824?1073741824:0}function Rr(){var d=Br;return Br<<=1,(Br&4194240)===0&&(Br=64),d}function rr(d){for(var v=[],E=0;31>E;E++)v.push(d);return v}function en(d,v,E){d.pendingLanes|=v,v!==536870912&&(d.suspendedLanes=0,d.pingedLanes=0),d=d.eventTimes,v=31-Ze(v),d[v]=E}function yn(d,v){var E=d.pendingLanes&~v;d.pendingLanes=v,d.suspendedLanes=0,d.pingedLanes=0,d.expiredLanes&=v,d.mutableReadLanes&=v,d.entangledLanes&=v,v=d.entanglements;var A=d.eventTimes;for(d=d.expirationTimes;0<E;){var H=31-Ze(E),Y=1<<H;v[H]=0,A[H]=-1,d[H]=-1,E&=~Y}}function io(d,v){var E=d.entangledLanes|=v;for(d=d.entanglements;E;){var A=31-Ze(E),H=1<<A;H&v|d[A]&v&&(d[A]|=v),E&=~H}}var wr=0;function ao(d){return d&=-d,1<d?4<d?(d&268435455)!==0?16:536870912:4:1}var Eo,Rs,Ec,Tc,sl,Vl=!1,To=[],Fi=null,so=null,$a=null,Sr=new Map,or=new Map,Jn=[],Zr="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function vf(d,v){switch(d){case"focusin":case"focusout":Fi=null;break;case"dragenter":case"dragleave":so=null;break;case"mouseover":case"mouseout":$a=null;break;case"pointerover":case"pointerout":Sr.delete(v.pointerId);break;case"gotpointercapture":case"lostpointercapture":or.delete(v.pointerId)}}function ol(d,v,E,A,H,Y){return d===null||d.nativeEvent!==Y?(d={blockedOn:v,domEventName:E,eventSystemFlags:A,nativeEvent:Y,targetContainers:[H]},v!==null&&(v=wl(v),v!==null&&Rs(v)),d):(d.eventSystemFlags|=A,v=d.targetContainers,H!==null&&v.indexOf(H)===-1&&v.push(H),d)}function jn(d,v,E,A,H){switch(v){case"focusin":return Fi=ol(Fi,d,v,E,A,H),!0;case"dragenter":return so=ol(so,d,v,E,A,H),!0;case"mouseover":return $a=ol($a,d,v,E,A,H),!0;case"pointerover":var Y=H.pointerId;return Sr.set(Y,ol(Sr.get(Y)||null,d,v,E,A,H)),!0;case"gotpointercapture":return Y=H.pointerId,or.set(Y,ol(or.get(Y)||null,d,v,E,A,H)),!0}return!1}function Hl(d){var v=Do(d.target);if(v!==null){var E=ni(v);if(E!==null){if(v=E.tag,v===13){if(v=sn(E),v!==null){d.blockedOn=v,sl(d.priority,function(){Ec(E)});return}}else if(v===3&&E.stateNode.current.memoizedState.isDehydrated){d.blockedOn=E.tag===3?E.stateNode.containerInfo:null;return}}}d.blockedOn=null}function Os(d){if(d.blockedOn!==null)return!1;for(var v=d.targetContainers;0<v.length;){var E=ju(d.domEventName,d.eventSystemFlags,v[0],d.nativeEvent);if(E===null){E=d.nativeEvent;var A=new E.constructor(E.type,E);Qe=A,E.target.dispatchEvent(A),Qe=null}else return v=wl(E),v!==null&&Rs(v),d.blockedOn=E,!1;v.shift()}return!0}function Wl(d,v,E){Os(d)&&E.delete(v)}function Du(){Vl=!1,Fi!==null&&Os(Fi)&&(Fi=null),so!==null&&Os(so)&&(so=null),$a!==null&&Os($a)&&($a=null),Sr.forEach(Wl),or.forEach(Wl)}function hn(d,v){d.blockedOn===v&&(d.blockedOn=null,Vl||(Vl=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,Du)))}function Fn(d){function v(H){return hn(H,d)}if(0<To.length){hn(To[0],d);for(var E=1;E<To.length;E++){var A=To[E];A.blockedOn===d&&(A.blockedOn=null)}}for(Fi!==null&&hn(Fi,d),so!==null&&hn(so,d),$a!==null&&hn($a,d),Sr.forEach(v),or.forEach(v),E=0;E<Jn.length;E++)A=Jn[E],A.blockedOn===d&&(A.blockedOn=null);for(;0<Jn.length&&(E=Jn[0],E.blockedOn===null);)Hl(E),E.blockedOn===null&&Jn.shift()}var ll=N.ReactCurrentBatchConfig,Iu=!0;function hs(d,v,E,A){var H=wr,Y=ll.transition;ll.transition=null;try{wr=1,No(d,v,E,A)}finally{wr=H,ll.transition=Y}}function Ds(d,v,E,A){var H=wr,Y=ll.transition;ll.transition=null;try{wr=4,No(d,v,E,A)}finally{wr=H,ll.transition=Y}}function No(d,v,E,A){if(Iu){var H=ju(d,v,E,A);if(H===null)h(d,v,A,ql,E),vf(d,A);else if(jn(H,d,v,E,A))A.stopPropagation();else if(vf(d,A),v&4&&-1<Zr.indexOf(d)){for(;H!==null;){var Y=wl(H);if(Y!==null&&Eo(Y),Y=ju(d,v,E,A),Y===null&&h(d,v,A,ql,E),Y===H)break;H=Y}H!==null&&A.stopPropagation()}else h(d,v,A,null,E)}}var ql=null;function ju(d,v,E,A){if(ql=null,d=Ge(A),d=Do(d),d!==null)if(v=ni(d),v===null)d=null;else if(E=v.tag,E===13){if(d=sn(v),d!==null)return d;d=null}else if(E===3){if(v.stateNode.current.memoizedState.isDehydrated)return v.tag===3?v.stateNode.containerInfo:null;d=null}else v!==d&&(d=null);return ql=d,null}function Er(d){switch(d){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Co()){case fs:return 1;case ro:return 4;case Yi:case no:return 16;case Ue:return 536870912;default:return 16}default:return 16}}var yi=null,ii=null,ba=null;function $l(){if(ba)return ba;var d,v=ii,E=v.length,A,H="value"in yi?yi.value:yi.textContent,Y=H.length;for(d=0;d<E&&v[d]===H[d];d++);var le=E-d;for(A=1;A<=le&&v[E-A]===H[Y-A];A++);return ba=H.slice(d,1<A?1-A:void 0)}function ul(d){var v=d.keyCode;return"charCode"in d?(d=d.charCode,d===0&&v===13&&(d=13)):d=v,d===10&&(d=13),32<=d||d===13?d:0}function xi(){return!0}function wa(){return!1}function Bn(d){function v(E,A,H,Y,le){this._reactName=E,this._targetInst=H,this.type=A,this.nativeEvent=Y,this.target=le,this.currentTarget=null;for(var be in d)d.hasOwnProperty(be)&&(E=d[be],this[be]=E?E(Y):Y[be]);return this.isDefaultPrevented=(Y.defaultPrevented!=null?Y.defaultPrevented:Y.returnValue===!1)?xi:wa,this.isPropagationStopped=wa,this}return te(v.prototype,{preventDefault:function(){this.defaultPrevented=!0;var E=this.nativeEvent;E&&(E.preventDefault?E.preventDefault():typeof E.returnValue!="unknown"&&(E.returnValue=!1),this.isDefaultPrevented=xi)},stopPropagation:function(){var E=this.nativeEvent;E&&(E.stopPropagation?E.stopPropagation():typeof E.cancelBubble!="unknown"&&(E.cancelBubble=!0),this.isPropagationStopped=xi)},persist:function(){},isPersistent:xi}),v}var Xi={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(d){return d.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ps=Bn(Xi),Sa=te({},Xi,{view:0,detail:0}),Rh=Bn(Sa),Qi,Fu,ai,_n=te({},Sa,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ms,button:0,buttons:0,relatedTarget:function(d){return d.relatedTarget===void 0?d.fromElement===d.srcElement?d.toElement:d.fromElement:d.relatedTarget},movementX:function(d){return"movementX"in d?d.movementX:(d!==ai&&(ai&&d.type==="mousemove"?(Qi=d.screenX-ai.screenX,Fu=d.screenY-ai.screenY):Fu=Qi=0,ai=d),Qi)},movementY:function(d){return"movementY"in d?d.movementY:Fu}}),tn=Bn(_n),Kl=te({},_n,{dataTransfer:0}),ka=Bn(Kl),Oh=te({},Sa,{relatedTarget:0}),Bu=Bn(Oh),Nc=te({},Xi,{animationName:0,elapsedTime:0,pseudoElement:0}),yf=Bn(Nc),Dh=te({},Xi,{clipboardData:function(d){return"clipboardData"in d?d.clipboardData:window.clipboardData}}),Zl=Bn(Dh),Ih=te({},Xi,{data:0}),Po=Bn(Ih),Pc={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Mc={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Is={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function xm(d){var v=this.nativeEvent;return v.getModifierState?v.getModifierState(d):(d=Is[d])?!!v[d]:!1}function ms(){return xm}var Bi=te({},Sa,{key:function(d){if(d.key){var v=Pc[d.key]||d.key;if(v!=="Unidentified")return v}return d.type==="keypress"?(d=ul(d),d===13?"Enter":String.fromCharCode(d)):d.type==="keydown"||d.type==="keyup"?Mc[d.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ms,charCode:function(d){return d.type==="keypress"?ul(d):0},keyCode:function(d){return d.type==="keydown"||d.type==="keyup"?d.keyCode:0},which:function(d){return d.type==="keypress"?ul(d):d.type==="keydown"||d.type==="keyup"?d.keyCode:0}}),xf=Bn(Bi),bf=te({},_n,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),cl=Bn(bf),Ac=te({},Sa,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ms}),Yl=Bn(Ac),Lc=te({},Xi,{propertyName:0,elapsedTime:0,pseudoElement:0}),Xl=Bn(Lc),Rc=te({},_n,{deltaX:function(d){return"deltaX"in d?d.deltaX:"wheelDeltaX"in d?-d.wheelDeltaX:0},deltaY:function(d){return"deltaY"in d?d.deltaY:"wheelDeltaY"in d?-d.wheelDeltaY:"wheelDelta"in d?-d.wheelDelta:0},deltaZ:0,deltaMode:0}),wf=Bn(Rc),Ka=[9,13,27,32],js=o&&"CompositionEvent"in window,dl=null;o&&"documentMode"in document&&(dl=document.documentMode);var Ji=o&&"TextEvent"in window&&!dl,_a=o&&(!js||dl&&8<dl&&11>=dl),Ca=" ",Oc=!1;function fl(d,v){switch(d){case"keyup":return Ka.indexOf(v.keyCode)!==-1;case"keydown":return v.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Za(d){return d=d.detail,typeof d=="object"&&"data"in d?d.data:null}var Pi=!1;function Sf(d,v){switch(d){case"compositionend":return Za(v);case"keypress":return v.which!==32?null:(Oc=!0,Ca);case"textInput":return d=v.data,d===Ca&&Oc?null:d;default:return null}}function oo(d,v){if(Pi)return d==="compositionend"||!js&&fl(d,v)?(d=$l(),ba=ii=yi=null,Pi=!1,d):null;switch(d){case"paste":return null;case"keypress":if(!(v.ctrlKey||v.altKey||v.metaKey)||v.ctrlKey&&v.altKey){if(v.char&&1<v.char.length)return v.char;if(v.which)return String.fromCharCode(v.which)}return null;case"compositionend":return _a&&v.locale!=="ko"?null:v.data;default:return null}}var Ya={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function lo(d){var v=d&&d.nodeName&&d.nodeName.toLowerCase();return v==="input"?!!Ya[d.type]:v==="textarea"}function hl(d,v,E,A){Wt(A),v=P(v,"onChange"),0<v.length&&(E=new ps("onChange","change",null,E,A),d.push({event:E,listeners:v}))}var Ql=null,Mi=null;function jh(d){zc(d,0)}function Ea(d){var v=Vn(d);if(xe(v))return d}function Xa(d,v){if(d==="change")return v}var ea=!1;if(o){var gs;if(o){var Ta="oninput"in document;if(!Ta){var Jl=document.createElement("div");Jl.setAttribute("oninput","return;"),Ta=typeof Jl.oninput=="function"}gs=Ta}else gs=!1;ea=gs&&(!document.documentMode||9<document.documentMode)}function Fs(){Ql&&(Ql.detachEvent("onpropertychange",zu),Mi=Ql=null)}function zu(d){if(d.propertyName==="value"&&Ea(Mi)){var v=[];hl(v,Mi,d,Ge(d)),gr(jh,v)}}function eu(d,v,E){d==="focusin"?(Fs(),Ql=v,Mi=E,Ql.attachEvent("onpropertychange",zu)):d==="focusout"&&Fs()}function qr(d){if(d==="selectionchange"||d==="keyup"||d==="keydown")return Ea(Mi)}function pl(d,v){if(d==="click")return Ea(v)}function Uu(d,v){if(d==="input"||d==="change")return Ea(v)}function Dc(d,v){return d===v&&(d!==0||1/d===1/v)||d!==d&&v!==v}var ta=typeof Object.is=="function"?Object.is:Dc;function Bs(d,v){if(ta(d,v))return!0;if(typeof d!="object"||d===null||typeof v!="object"||v===null)return!1;var E=Object.keys(d),A=Object.keys(v);if(E.length!==A.length)return!1;for(A=0;A<E.length;A++){var H=E[A];if(!l.call(v,H)||!ta(d[H],v[H]))return!1}return!0}function Mo(d){for(;d&&d.firstChild;)d=d.firstChild;return d}function ln(d,v){var E=Mo(d);d=0;for(var A;E;){if(E.nodeType===3){if(A=d+E.textContent.length,d<=v&&A>=v)return{node:E,offset:v-d};d=A}e:{for(;E;){if(E.nextSibling){E=E.nextSibling;break e}E=E.parentNode}E=void 0}E=Mo(E)}}function zn(d,v){return d&&v?d===v?!0:d&&d.nodeType===3?!1:v&&v.nodeType===3?zn(d,v.parentNode):"contains"in d?d.contains(v):d.compareDocumentPosition?!!(d.compareDocumentPosition(v)&16):!1:!1}function Un(){for(var d=window,v=Se();v instanceof d.HTMLIFrameElement;){try{var E=typeof v.contentWindow.location.href=="string"}catch{E=!1}if(E)d=v.contentWindow;else break;v=Se(d.document)}return v}function tu(d){var v=d&&d.nodeName&&d.nodeName.toLowerCase();return v&&(v==="input"&&(d.type==="text"||d.type==="search"||d.type==="tel"||d.type==="url"||d.type==="password")||v==="textarea"||d.contentEditable==="true")}function ra(d){var v=Un(),E=d.focusedElem,A=d.selectionRange;if(v!==E&&E&&E.ownerDocument&&zn(E.ownerDocument.documentElement,E)){if(A!==null&&tu(E)){if(v=A.start,d=A.end,d===void 0&&(d=v),"selectionStart"in E)E.selectionStart=v,E.selectionEnd=Math.min(d,E.value.length);else if(d=(v=E.ownerDocument||document)&&v.defaultView||window,d.getSelection){d=d.getSelection();var H=E.textContent.length,Y=Math.min(A.start,H);A=A.end===void 0?Y:Math.min(A.end,H),!d.extend&&Y>A&&(H=A,A=Y,Y=H),H=ln(E,Y);var le=ln(E,A);H&&le&&(d.rangeCount!==1||d.anchorNode!==H.node||d.anchorOffset!==H.offset||d.focusNode!==le.node||d.focusOffset!==le.offset)&&(v=v.createRange(),v.setStart(H.node,H.offset),d.removeAllRanges(),Y>A?(d.addRange(v),d.extend(le.node,le.offset)):(v.setEnd(le.node,le.offset),d.addRange(v)))}}for(v=[],d=E;d=d.parentNode;)d.nodeType===1&&v.push({element:d,left:d.scrollLeft,top:d.scrollTop});for(typeof E.focus=="function"&&E.focus(),E=0;E<v.length;E++)d=v[E],d.element.scrollLeft=d.left,d.element.scrollTop=d.top}}var Ao=o&&"documentMode"in document&&11>=document.documentMode,ru=null,Ln=null,ml=null,nu=!1;function Ic(d,v,E){var A=E.window===E?E.document:E.nodeType===9?E:E.ownerDocument;nu||ru==null||ru!==Se(A)||(A=ru,"selectionStart"in A&&tu(A)?A={start:A.selectionStart,end:A.selectionEnd}:(A=(A.ownerDocument&&A.ownerDocument.defaultView||window).getSelection(),A={anchorNode:A.anchorNode,anchorOffset:A.anchorOffset,focusNode:A.focusNode,focusOffset:A.focusOffset}),ml&&Bs(ml,A)||(ml=A,A=P(Ln,"onSelect"),0<A.length&&(v=new ps("onSelect","select",null,v,E),d.push({event:v,listeners:A}),v.target=ru)))}function bi(d,v){var E={};return E[d.toLowerCase()]=v.toLowerCase(),E["Webkit"+d]="webkit"+v,E["Moz"+d]="moz"+v,E}var wi={animationend:bi("Animation","AnimationEnd"),animationiteration:bi("Animation","AnimationIteration"),animationstart:bi("Animation","AnimationStart"),transitionend:bi("Transition","TransitionEnd")},Qa={},Gu={};o&&(Gu=document.createElement("div").style,"AnimationEvent"in window||(delete wi.animationend.animation,delete wi.animationiteration.animation,delete wi.animationstart.animation),"TransitionEvent"in window||delete wi.transitionend.transition);function gl(d){if(Qa[d])return Qa[d];if(!wi[d])return d;var v=wi[d],E;for(E in v)if(v.hasOwnProperty(E)&&E in Gu)return Qa[d]=v[E];return d}var kf=gl("animationend"),vs=gl("animationiteration"),jc=gl("animationstart"),Fc=gl("transitionend"),vl=new Map,_f="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ja(d,v){vl.set(d,v),a(v,[d])}for(var Lo=0;Lo<_f.length;Lo++){var Ro=_f[Lo],Cf=Ro.toLowerCase(),Bc=Ro[0].toUpperCase()+Ro.slice(1);Ja(Cf,"on"+Bc)}Ja(kf,"onAnimationEnd"),Ja(vs,"onAnimationIteration"),Ja(jc,"onAnimationStart"),Ja("dblclick","onDoubleClick"),Ja("focusin","onFocus"),Ja("focusout","onBlur"),Ja(Fc,"onTransitionEnd"),s("onMouseEnter",["mouseout","mouseover"]),s("onMouseLeave",["mouseout","mouseover"]),s("onPointerEnter",["pointerout","pointerover"]),s("onPointerLeave",["pointerout","pointerover"]),a("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),a("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),a("onBeforeInput",["compositionend","keypress","textInput","paste"]),a("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),a("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),a("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var uo="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Ef=new Set("cancel close invalid load scroll toggle".split(" ").concat(uo));function Vu(d,v,E){var A=d.type||"unknown-event";d.currentTarget=E,As(A,v,void 0,d),d.currentTarget=null}function zc(d,v){v=(v&4)!==0;for(var E=0;E<d.length;E++){var A=d[E],H=A.event;A=A.listeners;e:{var Y=void 0;if(v)for(var le=A.length-1;0<=le;le--){var be=A[le],_e=be.instance,Be=be.currentTarget;if(be=be.listener,_e!==Y&&H.isPropagationStopped())break e;Vu(H,be,Be),Y=_e}else for(le=0;le<A.length;le++){if(be=A[le],_e=be.instance,Be=be.currentTarget,be=be.listener,_e!==Y&&H.isPropagationStopped())break e;Vu(H,be,Be),Y=_e}}}if(Ur)throw d=Qn,Ur=!1,Qn=null,d}function Yr(d,v){var E=v[bl];E===void 0&&(E=v[bl]=new Set);var A=d+"__bubble";E.has(A)||(Tf(v,d,2,!1),E.add(A))}function Uc(d,v,E){var A=0;v&&(A|=4),Tf(E,d,A,v)}var iu="_reactListening"+Math.random().toString(36).slice(2);function Oo(d){if(!d[iu]){d[iu]=!0,n.forEach(function(E){E!=="selectionchange"&&(Ef.has(E)||Uc(E,!1,d),Uc(E,!0,d))});var v=d.nodeType===9?d:d.ownerDocument;v===null||v[iu]||(v[iu]=!0,Uc("selectionchange",!1,v))}}function Tf(d,v,E,A){switch(Er(v)){case 1:var H=hs;break;case 4:H=Ds;break;default:H=No}E=H.bind(null,v,E,d),H=void 0,!zr||v!=="touchstart"&&v!=="touchmove"&&v!=="wheel"||(H=!0),A?H!==void 0?d.addEventListener(v,E,{capture:!0,passive:H}):d.addEventListener(v,E,!0):H!==void 0?d.addEventListener(v,E,{passive:H}):d.addEventListener(v,E,!1)}function h(d,v,E,A,H){var Y=A;if((v&1)===0&&(v&2)===0&&A!==null)e:for(;;){if(A===null)return;var le=A.tag;if(le===3||le===4){var be=A.stateNode.containerInfo;if(be===H||be.nodeType===8&&be.parentNode===H)break;if(le===4)for(le=A.return;le!==null;){var _e=le.tag;if((_e===3||_e===4)&&(_e=le.stateNode.containerInfo,_e===H||_e.nodeType===8&&_e.parentNode===H))return;le=le.return}for(;be!==null;){if(le=Do(be),le===null)return;if(_e=le.tag,_e===5||_e===6){A=Y=le;continue e}be=be.parentNode}}A=A.return}gr(function(){var Be=Y,nt=Ge(E),ft=[];e:{var tt=vl.get(d);if(tt!==void 0){var Rt=ps,Ut=d;switch(d){case"keypress":if(ul(E)===0)break e;case"keydown":case"keyup":Rt=xf;break;case"focusin":Ut="focus",Rt=Bu;break;case"focusout":Ut="blur",Rt=Bu;break;case"beforeblur":case"afterblur":Rt=Bu;break;case"click":if(E.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Rt=tn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Rt=ka;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Rt=Yl;break;case kf:case vs:case jc:Rt=yf;break;case Fc:Rt=Xl;break;case"scroll":Rt=Rh;break;case"wheel":Rt=wf;break;case"copy":case"cut":case"paste":Rt=Zl;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Rt=cl}var Ht=(v&4)!==0,Ci=!Ht&&d==="scroll",Oe=Ht?tt!==null?tt+"Capture":null:tt;Ht=[];for(var Ce=Be,De;Ce!==null;){De=Ce;var yt=De.stateNode;if(De.tag===5&&yt!==null&&(De=yt,Oe!==null&&(yt=Ir(Ce,Oe),yt!=null&&Ht.push(k(Ce,yt,De)))),Ci)break;Ce=Ce.return}0<Ht.length&&(tt=new Rt(tt,Ut,null,E,nt),ft.push({event:tt,listeners:Ht}))}}if((v&7)===0){e:{if(tt=d==="mouseover"||d==="pointerover",Rt=d==="mouseout"||d==="pointerout",tt&&E!==Qe&&(Ut=E.relatedTarget||E.fromElement)&&(Do(Ut)||Ut[Gr]))break e;if((Rt||tt)&&(tt=nt.window===nt?nt:(tt=nt.ownerDocument)?tt.defaultView||tt.parentWindow:window,Rt?(Ut=E.relatedTarget||E.toElement,Rt=Be,Ut=Ut?Do(Ut):null,Ut!==null&&(Ci=ni(Ut),Ut!==Ci||Ut.tag!==5&&Ut.tag!==6)&&(Ut=null)):(Rt=null,Ut=Be),Rt!==Ut)){if(Ht=tn,yt="onMouseLeave",Oe="onMouseEnter",Ce="mouse",(d==="pointerout"||d==="pointerover")&&(Ht=cl,yt="onPointerLeave",Oe="onPointerEnter",Ce="pointer"),Ci=Rt==null?tt:Vn(Rt),De=Ut==null?tt:Vn(Ut),tt=new Ht(yt,Ce+"leave",Rt,E,nt),tt.target=Ci,tt.relatedTarget=De,yt=null,Do(nt)===Be&&(Ht=new Ht(Oe,Ce+"enter",Ut,E,nt),Ht.target=De,Ht.relatedTarget=Ci,yt=Ht),Ci=yt,Rt&&Ut)t:{for(Ht=Rt,Oe=Ut,Ce=0,De=Ht;De;De=V(De))Ce++;for(De=0,yt=Oe;yt;yt=V(yt))De++;for(;0<Ce-De;)Ht=V(Ht),Ce--;for(;0<De-Ce;)Oe=V(Oe),De--;for(;Ce--;){if(Ht===Oe||Oe!==null&&Ht===Oe.alternate)break t;Ht=V(Ht),Oe=V(Oe)}Ht=null}else Ht=null;Rt!==null&&J(ft,tt,Rt,Ht,!1),Ut!==null&&Ci!==null&&J(ft,Ci,Ut,Ht,!0)}}e:{if(tt=Be?Vn(Be):window,Rt=tt.nodeName&&tt.nodeName.toLowerCase(),Rt==="select"||Rt==="input"&&tt.type==="file")var qt=Xa;else if(lo(tt))if(ea)qt=Uu;else{qt=qr;var ir=eu}else(Rt=tt.nodeName)&&Rt.toLowerCase()==="input"&&(tt.type==="checkbox"||tt.type==="radio")&&(qt=pl);if(qt&&(qt=qt(d,Be))){hl(ft,qt,E,nt);break e}ir&&ir(d,tt,Be),d==="focusout"&&(ir=tt._wrapperState)&&ir.controlled&&tt.type==="number"&&Ct(tt,"number",tt.value)}switch(ir=Be?Vn(Be):window,d){case"focusin":(lo(ir)||ir.contentEditable==="true")&&(ru=ir,Ln=Be,ml=null);break;case"focusout":ml=Ln=ru=null;break;case"mousedown":nu=!0;break;case"contextmenu":case"mouseup":case"dragend":nu=!1,Ic(ft,E,nt);break;case"selectionchange":if(Ao)break;case"keydown":case"keyup":Ic(ft,E,nt)}var ar;if(js)e:{switch(d){case"compositionstart":var lr="onCompositionStart";break e;case"compositionend":lr="onCompositionEnd";break e;case"compositionupdate":lr="onCompositionUpdate";break e}lr=void 0}else Pi?fl(d,E)&&(lr="onCompositionEnd"):d==="keydown"&&E.keyCode===229&&(lr="onCompositionStart");lr&&(_a&&E.locale!=="ko"&&(Pi||lr!=="onCompositionStart"?lr==="onCompositionEnd"&&Pi&&(ar=$l()):(yi=nt,ii="value"in yi?yi.value:yi.textContent,Pi=!0)),ir=P(Be,lr),0<ir.length&&(lr=new Po(lr,d,null,E,nt),ft.push({event:lr,listeners:ir}),ar?lr.data=ar:(ar=Za(E),ar!==null&&(lr.data=ar)))),(ar=Ji?Sf(d,E):oo(d,E))&&(Be=P(Be,"onBeforeInput"),0<Be.length&&(nt=new Po("onBeforeInput","beforeinput",null,E,nt),ft.push({event:nt,listeners:Be}),nt.data=ar))}zc(ft,v)})}function k(d,v,E){return{instance:d,listener:v,currentTarget:E}}function P(d,v){for(var E=v+"Capture",A=[];d!==null;){var H=d,Y=H.stateNode;H.tag===5&&Y!==null&&(H=Y,Y=Ir(d,E),Y!=null&&A.unshift(k(d,Y,H)),Y=Ir(d,v),Y!=null&&A.push(k(d,Y,H))),d=d.return}return A}function V(d){if(d===null)return null;do d=d.return;while(d&&d.tag!==5);return d||null}function J(d,v,E,A,H){for(var Y=v._reactName,le=[];E!==null&&E!==A;){var be=E,_e=be.alternate,Be=be.stateNode;if(_e!==null&&_e===A)break;be.tag===5&&Be!==null&&(be=Be,H?(_e=Ir(E,Y),_e!=null&&le.unshift(k(E,_e,be))):H||(_e=Ir(E,Y),_e!=null&&le.push(k(E,_e,be)))),E=E.return}le.length!==0&&d.push({event:v,listeners:le})}var ce=/\r\n?/g,we=/\u0000|\uFFFD/g;function Le(d){return(typeof d=="string"?d:""+d).replace(ce,`
`).replace(we,"")}function je(d,v,E){if(v=Le(v),Le(d)!==v&&E)throw Error(r(425))}function Xe(){}var Nt=null,Xt=null;function hr(d,v){return d==="textarea"||d==="noscript"||typeof v.children=="string"||typeof v.children=="number"||typeof v.dangerouslySetInnerHTML=="object"&&v.dangerouslySetInnerHTML!==null&&v.dangerouslySetInnerHTML.__html!=null}var Xr=typeof setTimeout=="function"?setTimeout:void 0,Gn=typeof clearTimeout=="function"?clearTimeout:void 0,Ai=typeof Promise=="function"?Promise:void 0,zi=typeof queueMicrotask=="function"?queueMicrotask:typeof Ai<"u"?function(d){return Ai.resolve(null).then(d).catch(yl)}:Xr;function yl(d){setTimeout(function(){throw d})}function Gc(d,v){var E=v,A=0;do{var H=E.nextSibling;if(d.removeChild(E),H&&H.nodeType===8)if(E=H.data,E==="/$"){if(A===0){d.removeChild(H),Fn(v);return}A--}else E!=="$"&&E!=="$?"&&E!=="$!"||A++;E=H}while(E);Fn(v)}function zs(d){for(;d!=null;d=d.nextSibling){var v=d.nodeType;if(v===1||v===3)break;if(v===8){if(v=d.data,v==="$"||v==="$!"||v==="$?")break;if(v==="/$")return null}}return d}function xl(d){d=d.previousSibling;for(var v=0;d;){if(d.nodeType===8){var E=d.data;if(E==="$"||E==="$!"||E==="$?"){if(v===0)return d;v--}else E==="/$"&&v++}d=d.previousSibling}return null}var co=Math.random().toString(36).slice(2),es="__reactFiber$"+co,au="__reactProps$"+co,Gr="__reactContainer$"+co,bl="__reactEvents$"+co,Fh="__reactListeners$"+co,Bh="__reactHandles$"+co;function Do(d){var v=d[es];if(v)return v;for(var E=d.parentNode;E;){if(v=E[Gr]||E[es]){if(E=v.alternate,v.child!==null||E!==null&&E.child!==null)for(d=xl(d);d!==null;){if(E=d[es])return E;d=xl(d)}return v}d=E,E=d.parentNode}return null}function wl(d){return d=d[es]||d[Gr],!d||d.tag!==5&&d.tag!==6&&d.tag!==13&&d.tag!==3?null:d}function Vn(d){if(d.tag===5||d.tag===6)return d.stateNode;throw Error(r(33))}function si(d){return d[au]||null}var zh=[],Hu=-1;function Sl(d){return{current:d}}function pn(d){0>Hu||(d.current=zh[Hu],zh[Hu]=null,Hu--)}function un(d,v){Hu++,zh[Hu]=d.current,d.current=v}var Io={},Ui=Sl(Io),na=Sl(!1),su=Io;function Wu(d,v){var E=d.type.contextTypes;if(!E)return Io;var A=d.stateNode;if(A&&A.__reactInternalMemoizedUnmaskedChildContext===v)return A.__reactInternalMemoizedMaskedChildContext;var H={},Y;for(Y in E)H[Y]=v[Y];return A&&(d=d.stateNode,d.__reactInternalMemoizedUnmaskedChildContext=v,d.__reactInternalMemoizedMaskedChildContext=H),H}function ia(d){return d=d.childContextTypes,d!=null}function Vc(){pn(na),pn(Ui)}function bm(d,v,E){if(Ui.current!==Io)throw Error(r(168));un(Ui,v),un(na,E)}function Uh(d,v,E){var A=d.stateNode;if(v=v.childContextTypes,typeof A.getChildContext!="function")return E;A=A.getChildContext();for(var H in A)if(!(H in v))throw Error(r(108,ae(d)||"Unknown",H));return te({},E,A)}function qu(d){return d=(d=d.stateNode)&&d.__reactInternalMemoizedMergedChildContext||Io,su=Ui.current,un(Ui,d),un(na,na.current),!0}function w0(d,v,E){var A=d.stateNode;if(!A)throw Error(r(169));E?(d=Uh(d,v,su),A.__reactInternalMemoizedMergedChildContext=d,pn(na),pn(Ui),un(Ui,d)):pn(na),un(na,E)}var jo=null,Hc=!1,Gh=!1;function Nf(d){jo===null?jo=[d]:jo.push(d)}function kl(d){Hc=!0,Nf(d)}function ou(){if(!Gh&&jo!==null){Gh=!0;var d=0,v=wr;try{var E=jo;for(wr=1;d<E.length;d++){var A=E[d];do A=A(!0);while(A!==null)}jo=null,Hc=!1}catch(H){throw jo!==null&&(jo=jo.slice(d+1)),ko(fs,ou),H}finally{wr=v,Gh=!1}}return null}var Na=[],$u=0,lu=null,uu=0,Pa=[],Ma=0,cu=null,ys=1,Cn="";function Ku(d,v){Na[$u++]=uu,Na[$u++]=lu,lu=d,uu=v}function S0(d,v,E){Pa[Ma++]=ys,Pa[Ma++]=Cn,Pa[Ma++]=cu,cu=d;var A=ys;d=Cn;var H=32-Ze(A)-1;A&=~(1<<H),E+=1;var Y=32-Ze(v)+H;if(30<Y){var le=H-H%5;Y=(A&(1<<le)-1).toString(32),A>>=le,H-=le,ys=1<<32-Ze(v)+H|E<<H|A,Cn=Y+d}else ys=1<<Y|E<<H|A,Cn=d}function Wc(d){d.return!==null&&(Ku(d,1),S0(d,1,0))}function Li(d){for(;d===lu;)lu=Na[--$u],Na[$u]=null,uu=Na[--$u],Na[$u]=null;for(;d===cu;)cu=Pa[--Ma],Pa[Ma]=null,Cn=Pa[--Ma],Pa[Ma]=null,ys=Pa[--Ma],Pa[Ma]=null}var xs=null,kt=null,Qr=!1,bs=null;function wm(d,v){var E=Ho(5,null,null,0);E.elementType="DELETED",E.stateNode=v,E.return=d,v=d.deletions,v===null?(d.deletions=[E],d.flags|=16):v.push(E)}function k0(d,v){switch(d.tag){case 5:var E=d.type;return v=v.nodeType!==1||E.toLowerCase()!==v.nodeName.toLowerCase()?null:v,v!==null?(d.stateNode=v,xs=d,kt=zs(v.firstChild),!0):!1;case 6:return v=d.pendingProps===""||v.nodeType!==3?null:v,v!==null?(d.stateNode=v,xs=d,kt=null,!0):!1;case 13:return v=v.nodeType!==8?null:v,v!==null?(E=cu!==null?{id:ys,overflow:Cn}:null,d.memoizedState={dehydrated:v,treeContext:E,retryLane:1073741824},E=Ho(18,null,null,0),E.stateNode=v,E.return=d,d.child=E,xs=d,kt=null,!0):!1;default:return!1}}function Zu(d){return(d.mode&1)!==0&&(d.flags&128)===0}function qc(d){if(Qr){var v=kt;if(v){var E=v;if(!k0(d,v)){if(Zu(d))throw Error(r(418));v=zs(E.nextSibling);var A=xs;v&&k0(d,v)?wm(A,E):(d.flags=d.flags&-4097|2,Qr=!1,xs=d)}}else{if(Zu(d))throw Error(r(418));d.flags=d.flags&-4097|2,Qr=!1,xs=d}}}function Vh(d){for(d=d.return;d!==null&&d.tag!==5&&d.tag!==3&&d.tag!==13;)d=d.return;xs=d}function Pf(d){if(d!==xs)return!1;if(!Qr)return Vh(d),Qr=!0,!1;var v;if((v=d.tag!==3)&&!(v=d.tag!==5)&&(v=d.type,v=v!=="head"&&v!=="body"&&!hr(d.type,d.memoizedProps)),v&&(v=kt)){if(Zu(d))throw Sm(),Error(r(418));for(;v;)wm(d,v),v=zs(v.nextSibling)}if(Vh(d),d.tag===13){if(d=d.memoizedState,d=d!==null?d.dehydrated:null,!d)throw Error(r(317));e:{for(d=d.nextSibling,v=0;d;){if(d.nodeType===8){var E=d.data;if(E==="/$"){if(v===0){kt=zs(d.nextSibling);break e}v--}else E!=="$"&&E!=="$!"&&E!=="$?"||v++}d=d.nextSibling}kt=null}}else kt=xs?zs(d.stateNode.nextSibling):null;return!0}function Sm(){for(var d=kt;d;)d=zs(d.nextSibling)}function Yu(){kt=xs=null,Qr=!1}function Mf(d){bs===null?bs=[d]:bs.push(d)}var km=N.ReactCurrentBatchConfig;function ei(d,v,E){if(d=E.ref,d!==null&&typeof d!="function"&&typeof d!="object"){if(E._owner){if(E=E._owner,E){if(E.tag!==1)throw Error(r(309));var A=E.stateNode}if(!A)throw Error(r(147,d));var H=A,Y=""+d;return v!==null&&v.ref!==null&&typeof v.ref=="function"&&v.ref._stringRef===Y?v.ref:(v=function(le){var be=H.refs;le===null?delete be[Y]:be[Y]=le},v._stringRef=Y,v)}if(typeof d!="string")throw Error(r(284));if(!E._owner)throw Error(r(290,d))}return d}function ts(d,v){throw d=Object.prototype.toString.call(v),Error(r(31,d==="[object Object]"?"object with keys {"+Object.keys(v).join(", ")+"}":d))}function fo(d){var v=d._init;return v(d._payload)}function Hh(d){function v(Oe,Ce){if(d){var De=Oe.deletions;De===null?(Oe.deletions=[Ce],Oe.flags|=16):De.push(Ce)}}function E(Oe,Ce){if(!d)return null;for(;Ce!==null;)v(Oe,Ce),Ce=Ce.sibling;return null}function A(Oe,Ce){for(Oe=new Map;Ce!==null;)Ce.key!==null?Oe.set(Ce.key,Ce):Oe.set(Ce.index,Ce),Ce=Ce.sibling;return Oe}function H(Oe,Ce){return Oe=hd(Oe,Ce),Oe.index=0,Oe.sibling=null,Oe}function Y(Oe,Ce,De){return Oe.index=De,d?(De=Oe.alternate,De!==null?(De=De.index,De<Ce?(Oe.flags|=2,Ce):De):(Oe.flags|=2,Ce)):(Oe.flags|=1048576,Ce)}function le(Oe){return d&&Oe.alternate===null&&(Oe.flags|=2),Oe}function be(Oe,Ce,De,yt){return Ce===null||Ce.tag!==6?(Ce=Rb(De,Oe.mode,yt),Ce.return=Oe,Ce):(Ce=H(Ce,De),Ce.return=Oe,Ce)}function _e(Oe,Ce,De,yt){var qt=De.type;return qt===j?nt(Oe,Ce,De.props.children,yt,De.key):Ce!==null&&(Ce.elementType===qt||typeof qt=="object"&&qt!==null&&qt.$$typeof===K&&fo(qt)===Ce.type)?(yt=H(Ce,De.props),yt.ref=ei(Oe,Ce,De),yt.return=Oe,yt):(yt=H0(De.type,De.key,De.props,null,Oe.mode,yt),yt.ref=ei(Oe,Ce,De),yt.return=Oe,yt)}function Be(Oe,Ce,De,yt){return Ce===null||Ce.tag!==4||Ce.stateNode.containerInfo!==De.containerInfo||Ce.stateNode.implementation!==De.implementation?(Ce=Ob(De,Oe.mode,yt),Ce.return=Oe,Ce):(Ce=H(Ce,De.children||[]),Ce.return=Oe,Ce)}function nt(Oe,Ce,De,yt,qt){return Ce===null||Ce.tag!==7?(Ce=Uf(De,Oe.mode,yt,qt),Ce.return=Oe,Ce):(Ce=H(Ce,De),Ce.return=Oe,Ce)}function ft(Oe,Ce,De){if(typeof Ce=="string"&&Ce!==""||typeof Ce=="number")return Ce=Rb(""+Ce,Oe.mode,De),Ce.return=Oe,Ce;if(typeof Ce=="object"&&Ce!==null){switch(Ce.$$typeof){case R:return De=H0(Ce.type,Ce.key,Ce.props,null,Oe.mode,De),De.ref=ei(Oe,null,Ce),De.return=Oe,De;case D:return Ce=Ob(Ce,Oe.mode,De),Ce.return=Oe,Ce;case K:var yt=Ce._init;return ft(Oe,yt(Ce._payload),De)}if(Ke(Ce)||ie(Ce))return Ce=Uf(Ce,Oe.mode,De,null),Ce.return=Oe,Ce;ts(Oe,Ce)}return null}function tt(Oe,Ce,De,yt){var qt=Ce!==null?Ce.key:null;if(typeof De=="string"&&De!==""||typeof De=="number")return qt!==null?null:be(Oe,Ce,""+De,yt);if(typeof De=="object"&&De!==null){switch(De.$$typeof){case R:return De.key===qt?_e(Oe,Ce,De,yt):null;case D:return De.key===qt?Be(Oe,Ce,De,yt):null;case K:return qt=De._init,tt(Oe,Ce,qt(De._payload),yt)}if(Ke(De)||ie(De))return qt!==null?null:nt(Oe,Ce,De,yt,null);ts(Oe,De)}return null}function Rt(Oe,Ce,De,yt,qt){if(typeof yt=="string"&&yt!==""||typeof yt=="number")return Oe=Oe.get(De)||null,be(Ce,Oe,""+yt,qt);if(typeof yt=="object"&&yt!==null){switch(yt.$$typeof){case R:return Oe=Oe.get(yt.key===null?De:yt.key)||null,_e(Ce,Oe,yt,qt);case D:return Oe=Oe.get(yt.key===null?De:yt.key)||null,Be(Ce,Oe,yt,qt);case K:var ir=yt._init;return Rt(Oe,Ce,De,ir(yt._payload),qt)}if(Ke(yt)||ie(yt))return Oe=Oe.get(De)||null,nt(Ce,Oe,yt,qt,null);ts(Ce,yt)}return null}function Ut(Oe,Ce,De,yt){for(var qt=null,ir=null,ar=Ce,lr=Ce=0,ca=null;ar!==null&&lr<De.length;lr++){ar.index>lr?(ca=ar,ar=null):ca=ar.sibling;var $r=tt(Oe,ar,De[lr],yt);if($r===null){ar===null&&(ar=ca);break}d&&ar&&$r.alternate===null&&v(Oe,ar),Ce=Y($r,Ce,lr),ir===null?qt=$r:ir.sibling=$r,ir=$r,ar=ca}if(lr===De.length)return E(Oe,ar),Qr&&Ku(Oe,lr),qt;if(ar===null){for(;lr<De.length;lr++)ar=ft(Oe,De[lr],yt),ar!==null&&(Ce=Y(ar,Ce,lr),ir===null?qt=ar:ir.sibling=ar,ir=ar);return Qr&&Ku(Oe,lr),qt}for(ar=A(Oe,ar);lr<De.length;lr++)ca=Rt(ar,Oe,lr,De[lr],yt),ca!==null&&(d&&ca.alternate!==null&&ar.delete(ca.key===null?lr:ca.key),Ce=Y(ca,Ce,lr),ir===null?qt=ca:ir.sibling=ca,ir=ca);return d&&ar.forEach(function(pd){return v(Oe,pd)}),Qr&&Ku(Oe,lr),qt}function Ht(Oe,Ce,De,yt){var qt=ie(De);if(typeof qt!="function")throw Error(r(150));if(De=qt.call(De),De==null)throw Error(r(151));for(var ir=qt=null,ar=Ce,lr=Ce=0,ca=null,$r=De.next();ar!==null&&!$r.done;lr++,$r=De.next()){ar.index>lr?(ca=ar,ar=null):ca=ar.sibling;var pd=tt(Oe,ar,$r.value,yt);if(pd===null){ar===null&&(ar=ca);break}d&&ar&&pd.alternate===null&&v(Oe,ar),Ce=Y(pd,Ce,lr),ir===null?qt=pd:ir.sibling=pd,ir=pd,ar=ca}if($r.done)return E(Oe,ar),Qr&&Ku(Oe,lr),qt;if(ar===null){for(;!$r.done;lr++,$r=De.next())$r=ft(Oe,$r.value,yt),$r!==null&&(Ce=Y($r,Ce,lr),ir===null?qt=$r:ir.sibling=$r,ir=$r);return Qr&&Ku(Oe,lr),qt}for(ar=A(Oe,ar);!$r.done;lr++,$r=De.next())$r=Rt(ar,Oe,lr,$r.value,yt),$r!==null&&(d&&$r.alternate!==null&&ar.delete($r.key===null?lr:$r.key),Ce=Y($r,Ce,lr),ir===null?qt=$r:ir.sibling=$r,ir=$r);return d&&ar.forEach(function($D){return v(Oe,$D)}),Qr&&Ku(Oe,lr),qt}function Ci(Oe,Ce,De,yt){if(typeof De=="object"&&De!==null&&De.type===j&&De.key===null&&(De=De.props.children),typeof De=="object"&&De!==null){switch(De.$$typeof){case R:e:{for(var qt=De.key,ir=Ce;ir!==null;){if(ir.key===qt){if(qt=De.type,qt===j){if(ir.tag===7){E(Oe,ir.sibling),Ce=H(ir,De.props.children),Ce.return=Oe,Oe=Ce;break e}}else if(ir.elementType===qt||typeof qt=="object"&&qt!==null&&qt.$$typeof===K&&fo(qt)===ir.type){E(Oe,ir.sibling),Ce=H(ir,De.props),Ce.ref=ei(Oe,ir,De),Ce.return=Oe,Oe=Ce;break e}E(Oe,ir);break}else v(Oe,ir);ir=ir.sibling}De.type===j?(Ce=Uf(De.props.children,Oe.mode,yt,De.key),Ce.return=Oe,Oe=Ce):(yt=H0(De.type,De.key,De.props,null,Oe.mode,yt),yt.ref=ei(Oe,Ce,De),yt.return=Oe,Oe=yt)}return le(Oe);case D:e:{for(ir=De.key;Ce!==null;){if(Ce.key===ir)if(Ce.tag===4&&Ce.stateNode.containerInfo===De.containerInfo&&Ce.stateNode.implementation===De.implementation){E(Oe,Ce.sibling),Ce=H(Ce,De.children||[]),Ce.return=Oe,Oe=Ce;break e}else{E(Oe,Ce);break}else v(Oe,Ce);Ce=Ce.sibling}Ce=Ob(De,Oe.mode,yt),Ce.return=Oe,Oe=Ce}return le(Oe);case K:return ir=De._init,Ci(Oe,Ce,ir(De._payload),yt)}if(Ke(De))return Ut(Oe,Ce,De,yt);if(ie(De))return Ht(Oe,Ce,De,yt);ts(Oe,De)}return typeof De=="string"&&De!==""||typeof De=="number"?(De=""+De,Ce!==null&&Ce.tag===6?(E(Oe,Ce.sibling),Ce=H(Ce,De),Ce.return=Oe,Oe=Ce):(E(Oe,Ce),Ce=Rb(De,Oe.mode,yt),Ce.return=Oe,Oe=Ce),le(Oe)):E(Oe,Ce)}return Ci}var Xu=Hh(!0),Us=Hh(!1),Af=Sl(null),ws=null,$c=null,Wh=null;function qh(){Wh=$c=ws=null}function $h(d){var v=Af.current;pn(Af),d._currentValue=v}function Kh(d,v,E){for(;d!==null;){var A=d.alternate;if((d.childLanes&v)!==v?(d.childLanes|=v,A!==null&&(A.childLanes|=v)):A!==null&&(A.childLanes&v)!==v&&(A.childLanes|=v),d===E)break;d=d.return}}function _l(d,v){ws=d,Wh=$c=null,d=d.dependencies,d!==null&&d.firstContext!==null&&((d.lanes&v)!==0&&(ee=!0),d.firstContext=null)}function Aa(d){var v=d._currentValue;if(Wh!==d)if(d={context:d,memoizedValue:v,next:null},$c===null){if(ws===null)throw Error(r(308));$c=d,ws.dependencies={lanes:0,firstContext:d}}else $c=$c.next=d;return v}var Fo=null;function Kc(d){Fo===null?Fo=[d]:Fo.push(d)}function Lf(d,v,E,A){var H=v.interleaved;return H===null?(E.next=E,Kc(v)):(E.next=H.next,H.next=E),v.interleaved=E,Ss(d,A)}function Ss(d,v){d.lanes|=v;var E=d.alternate;for(E!==null&&(E.lanes|=v),E=d,d=d.return;d!==null;)d.childLanes|=v,E=d.alternate,E!==null&&(E.childLanes|=v),E=d,d=d.return;return E.tag===3?E.stateNode:null}var Bo=!1;function Rf(d){d.updateQueue={baseState:d.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Zh(d,v){d=d.updateQueue,v.updateQueue===d&&(v.updateQueue={baseState:d.baseState,firstBaseUpdate:d.firstBaseUpdate,lastBaseUpdate:d.lastBaseUpdate,shared:d.shared,effects:d.effects})}function zo(d,v){return{eventTime:d,lane:v,tag:0,payload:null,callback:null,next:null}}function Uo(d,v,E){var A=d.updateQueue;if(A===null)return null;if(A=A.shared,(Vr&2)!==0){var H=A.pending;return H===null?v.next=v:(v.next=H.next,H.next=v),A.pending=v,Ss(d,E)}return H=A.interleaved,H===null?(v.next=v,Kc(A)):(v.next=H.next,H.next=v),A.interleaved=v,Ss(d,E)}function Yh(d,v,E){if(v=v.updateQueue,v!==null&&(v=v.shared,(E&4194240)!==0)){var A=v.lanes;A&=d.pendingLanes,E|=A,v.lanes=E,io(d,E)}}function Of(d,v){var E=d.updateQueue,A=d.alternate;if(A!==null&&(A=A.updateQueue,E===A)){var H=null,Y=null;if(E=E.firstBaseUpdate,E!==null){do{var le={eventTime:E.eventTime,lane:E.lane,tag:E.tag,payload:E.payload,callback:E.callback,next:null};Y===null?H=Y=le:Y=Y.next=le,E=E.next}while(E!==null);Y===null?H=Y=v:Y=Y.next=v}else H=Y=v;E={baseState:A.baseState,firstBaseUpdate:H,lastBaseUpdate:Y,shared:A.shared,effects:A.effects},d.updateQueue=E;return}d=E.lastBaseUpdate,d===null?E.firstBaseUpdate=v:d.next=v,E.lastBaseUpdate=v}function Zc(d,v,E,A){var H=d.updateQueue;Bo=!1;var Y=H.firstBaseUpdate,le=H.lastBaseUpdate,be=H.shared.pending;if(be!==null){H.shared.pending=null;var _e=be,Be=_e.next;_e.next=null,le===null?Y=Be:le.next=Be,le=_e;var nt=d.alternate;nt!==null&&(nt=nt.updateQueue,be=nt.lastBaseUpdate,be!==le&&(be===null?nt.firstBaseUpdate=Be:be.next=Be,nt.lastBaseUpdate=_e))}if(Y!==null){var ft=H.baseState;le=0,nt=Be=_e=null,be=Y;do{var tt=be.lane,Rt=be.eventTime;if((A&tt)===tt){nt!==null&&(nt=nt.next={eventTime:Rt,lane:0,tag:be.tag,payload:be.payload,callback:be.callback,next:null});e:{var Ut=d,Ht=be;switch(tt=v,Rt=E,Ht.tag){case 1:if(Ut=Ht.payload,typeof Ut=="function"){ft=Ut.call(Rt,ft,tt);break e}ft=Ut;break e;case 3:Ut.flags=Ut.flags&-65537|128;case 0:if(Ut=Ht.payload,tt=typeof Ut=="function"?Ut.call(Rt,ft,tt):Ut,tt==null)break e;ft=te({},ft,tt);break e;case 2:Bo=!0}}be.callback!==null&&be.lane!==0&&(d.flags|=64,tt=H.effects,tt===null?H.effects=[be]:tt.push(be))}else Rt={eventTime:Rt,lane:tt,tag:be.tag,payload:be.payload,callback:be.callback,next:null},nt===null?(Be=nt=Rt,_e=ft):nt=nt.next=Rt,le|=tt;if(be=be.next,be===null){if(be=H.shared.pending,be===null)break;tt=be,be=tt.next,tt.next=null,H.lastBaseUpdate=tt,H.shared.pending=null}}while(!0);if(nt===null&&(_e=ft),H.baseState=_e,H.firstBaseUpdate=Be,H.lastBaseUpdate=nt,v=H.shared.interleaved,v!==null){H=v;do le|=H.lane,H=H.next;while(H!==v)}else Y===null&&(H.shared.lanes=0);jf|=le,d.lanes=le,d.memoizedState=ft}}function Hn(d,v,E){if(d=v.effects,v.effects=null,d!==null)for(v=0;v<d.length;v++){var A=d[v],H=A.callback;if(H!==null){if(A.callback=null,A=E,typeof H!="function")throw Error(r(191,H));H.call(A)}}}var pr={},cn=Sl(pr),En=Sl(pr),ti=Sl(pr);function Si(d){if(d===pr)throw Error(r(174));return d}function du(d,v){switch(un(ti,v),un(En,d),un(cn,pr),d=v.nodeType,d){case 9:case 11:v=(v=v.documentElement)?v.namespaceURI:Ne(null,"");break;default:d=d===8?v.parentNode:v,v=d.namespaceURI||null,d=d.tagName,v=Ne(v,d)}pn(cn),un(cn,v)}function Tn(){pn(cn),pn(En),pn(ti)}function Yc(d){Si(ti.current);var v=Si(cn.current),E=Ne(v,d.type);v!==E&&(un(En,d),un(cn,E))}function Cl(d){En.current===d&&(pn(cn),pn(En))}var mn=Sl(0);function Xc(d){for(var v=d;v!==null;){if(v.tag===13){var E=v.memoizedState;if(E!==null&&(E=E.dehydrated,E===null||E.data==="$?"||E.data==="$!"))return v}else if(v.tag===19&&v.memoizedProps.revealOrder!==void 0){if((v.flags&128)!==0)return v}else if(v.child!==null){v.child.return=v,v=v.child;continue}if(v===d)break;for(;v.sibling===null;){if(v.return===null||v.return===d)return null;v=v.return}v.sibling.return=v.return,v=v.sibling}return null}var Qu=[];function aa(){for(var d=0;d<Qu.length;d++)Qu[d]._workInProgressVersionPrimary=null;Qu.length=0}var Qc=N.ReactCurrentDispatcher,Df=N.ReactCurrentBatchConfig,La=0,rn=null,Wn=null,oi=null,ho=!1,fu=!1,Gs=0,Xh=0;function li(){throw Error(r(321))}function If(d,v){if(v===null)return!1;for(var E=0;E<v.length&&E<d.length;E++)if(!ta(d[E],v[E]))return!1;return!0}function Jc(d,v,E,A,H,Y){if(La=Y,rn=v,v.memoizedState=null,v.updateQueue=null,v.lanes=0,Qc.current=d===null||d.memoizedState===null?pb:mu,d=E(A,H),fu){Y=0;do{if(fu=!1,Gs=0,25<=Y)throw Error(r(301));Y+=1,oi=Wn=null,v.updateQueue=null,Qc.current=rp,d=E(A,H)}while(fu)}if(Qc.current=nd,v=Wn!==null&&Wn.next!==null,La=0,oi=Wn=rn=null,ho=!1,v)throw Error(r(300));return d}function ed(){var d=Gs!==0;return Gs=0,d}function xn(){var d={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return oi===null?rn.memoizedState=oi=d:oi=oi.next=d,oi}function ki(){if(Wn===null){var d=rn.alternate;d=d!==null?d.memoizedState:null}else d=Wn.next;var v=oi===null?rn.memoizedState:oi.next;if(v!==null)oi=v,Wn=d;else{if(d===null)throw Error(r(310));Wn=d,d={memoizedState:Wn.memoizedState,baseState:Wn.baseState,baseQueue:Wn.baseQueue,queue:Wn.queue,next:null},oi===null?rn.memoizedState=oi=d:oi=oi.next=d}return oi}function sa(d,v){return typeof v=="function"?v(d):v}function oa(d){var v=ki(),E=v.queue;if(E===null)throw Error(r(311));E.lastRenderedReducer=d;var A=Wn,H=A.baseQueue,Y=E.pending;if(Y!==null){if(H!==null){var le=H.next;H.next=Y.next,Y.next=le}A.baseQueue=H=Y,E.pending=null}if(H!==null){Y=H.next,A=A.baseState;var be=le=null,_e=null,Be=Y;do{var nt=Be.lane;if((La&nt)===nt)_e!==null&&(_e=_e.next={lane:0,action:Be.action,hasEagerState:Be.hasEagerState,eagerState:Be.eagerState,next:null}),A=Be.hasEagerState?Be.eagerState:d(A,Be.action);else{var ft={lane:nt,action:Be.action,hasEagerState:Be.hasEagerState,eagerState:Be.eagerState,next:null};_e===null?(be=_e=ft,le=A):_e=_e.next=ft,rn.lanes|=nt,jf|=nt}Be=Be.next}while(Be!==null&&Be!==Y);_e===null?le=A:_e.next=be,ta(A,v.memoizedState)||(ee=!0),v.memoizedState=A,v.baseState=le,v.baseQueue=_e,E.lastRenderedState=A}if(d=E.interleaved,d!==null){H=d;do Y=H.lane,rn.lanes|=Y,jf|=Y,H=H.next;while(H!==d)}else H===null&&(E.lanes=0);return[v.memoizedState,E.dispatch]}function Qh(d){var v=ki(),E=v.queue;if(E===null)throw Error(r(311));E.lastRenderedReducer=d;var A=E.dispatch,H=E.pending,Y=v.memoizedState;if(H!==null){E.pending=null;var le=H=H.next;do Y=d(Y,le.action),le=le.next;while(le!==H);ta(Y,v.memoizedState)||(ee=!0),v.memoizedState=Y,v.baseQueue===null&&(v.baseState=Y),E.lastRenderedState=Y}return[Y,A]}function Jh(){}function ep(d,v){var E=rn,A=ki(),H=v(),Y=!ta(A.memoizedState,H);if(Y&&(A.memoizedState=H,ee=!0),A=A.queue,Tm(_m.bind(null,E,A,d),[d]),A.getSnapshot!==v||Y||oi!==null&&oi.memoizedState.tag&1){if(E.flags|=2048,td(9,El.bind(null,E,A,H,v),void 0,null),ua===null)throw Error(r(349));(La&30)!==0||_0(E,v,H)}return H}function _0(d,v,E){d.flags|=16384,d={getSnapshot:v,value:E},v=rn.updateQueue,v===null?(v={lastEffect:null,stores:null},rn.updateQueue=v,v.stores=[d]):(E=v.stores,E===null?v.stores=[d]:E.push(d))}function El(d,v,E,A){v.value=E,v.getSnapshot=A,Cm(v)&&tp(d)}function _m(d,v,E){return E(function(){Cm(v)&&tp(d)})}function Cm(d){var v=d.getSnapshot;d=d.value;try{var E=v();return!ta(d,E)}catch{return!0}}function tp(d){var v=Ss(d,1);v!==null&&Ml(v,d,1,-1)}function hu(d){var v=xn();return typeof d=="function"&&(d=d()),v.memoizedState=v.baseState=d,d={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:sa,lastRenderedState:d},v.queue=d,d=d.dispatch=M0.bind(null,rn,d),[v.memoizedState,d]}function td(d,v,E,A){return d={tag:d,create:v,destroy:E,deps:A,next:null},v=rn.updateQueue,v===null?(v={lastEffect:null,stores:null},rn.updateQueue=v,v.lastEffect=d.next=d):(E=v.lastEffect,E===null?v.lastEffect=d.next=d:(A=E.next,E.next=d,d.next=A,v.lastEffect=d)),d}function Em(){return ki().memoizedState}function rd(d,v,E,A){var H=xn();rn.flags|=d,H.memoizedState=td(1|v,E,void 0,A===void 0?null:A)}function Ju(d,v,E,A){var H=ki();A=A===void 0?null:A;var Y=void 0;if(Wn!==null){var le=Wn.memoizedState;if(Y=le.destroy,A!==null&&If(A,le.deps)){H.memoizedState=td(v,E,Y,A);return}}rn.flags|=d,H.memoizedState=td(1|v,E,Y,A)}function C0(d,v){return rd(8390656,8,d,v)}function Tm(d,v){return Ju(2048,8,d,v)}function Nm(d,v){return Ju(4,2,d,v)}function Pm(d,v){return Ju(4,4,d,v)}function pu(d,v){if(typeof v=="function")return d=d(),v(d),function(){v(null)};if(v!=null)return d=d(),v.current=d,function(){v.current=null}}function E0(d,v,E){return E=E!=null?E.concat([d]):null,Ju(4,4,pu.bind(null,v,d),E)}function Tl(){}function Mm(d,v){var E=ki();v=v===void 0?null:v;var A=E.memoizedState;return A!==null&&v!==null&&If(v,A[1])?A[0]:(E.memoizedState=[d,v],d)}function bn(d,v){var E=ki();v=v===void 0?null:v;var A=E.memoizedState;return A!==null&&v!==null&&If(v,A[1])?A[0]:(d=d(),E.memoizedState=[d,v],d)}function T0(d,v,E){return(La&21)===0?(d.baseState&&(d.baseState=!1,ee=!0),d.memoizedState=E):(ta(E,v)||(E=Rr(),rn.lanes|=E,jf|=E,d.baseState=!0),v)}function N0(d,v){var E=wr;wr=E!==0&&4>E?E:4,d(!0);var A=Df.transition;Df.transition={};try{d(!1),v()}finally{wr=E,Df.transition=A}}function P0(){return ki().memoizedState}function hb(d,v,E){var A=dd(d);if(E={lane:A,action:E,hasEagerState:!1,eagerState:null,next:null},Am(d))A0(v,E);else if(E=Lf(d,v,E,A),E!==null){var H=_s();Ml(E,d,A,H),ks(E,v,A)}}function M0(d,v,E){var A=dd(d),H={lane:A,action:E,hasEagerState:!1,eagerState:null,next:null};if(Am(d))A0(v,H);else{var Y=d.alternate;if(d.lanes===0&&(Y===null||Y.lanes===0)&&(Y=v.lastRenderedReducer,Y!==null))try{var le=v.lastRenderedState,be=Y(le,E);if(H.hasEagerState=!0,H.eagerState=be,ta(be,le)){var _e=v.interleaved;_e===null?(H.next=H,Kc(v)):(H.next=_e.next,_e.next=H),v.interleaved=H;return}}catch{}E=Lf(d,v,H,A),E!==null&&(H=_s(),Ml(E,d,A,H),ks(E,v,A))}}function Am(d){var v=d.alternate;return d===rn||v!==null&&v===rn}function A0(d,v){fu=ho=!0;var E=d.pending;E===null?v.next=v:(v.next=E.next,E.next=v),d.pending=v}function ks(d,v,E){if((E&4194240)!==0){var A=v.lanes;A&=d.pendingLanes,E|=A,v.lanes=E,io(d,E)}}var nd={readContext:Aa,useCallback:li,useContext:li,useEffect:li,useImperativeHandle:li,useInsertionEffect:li,useLayoutEffect:li,useMemo:li,useReducer:li,useRef:li,useState:li,useDebugValue:li,useDeferredValue:li,useTransition:li,useMutableSource:li,useSyncExternalStore:li,useId:li,unstable_isNewReconciler:!1},pb={readContext:Aa,useCallback:function(d,v){return xn().memoizedState=[d,v===void 0?null:v],d},useContext:Aa,useEffect:C0,useImperativeHandle:function(d,v,E){return E=E!=null?E.concat([d]):null,rd(4194308,4,pu.bind(null,v,d),E)},useLayoutEffect:function(d,v){return rd(4194308,4,d,v)},useInsertionEffect:function(d,v){return rd(4,2,d,v)},useMemo:function(d,v){var E=xn();return v=v===void 0?null:v,d=d(),E.memoizedState=[d,v],d},useReducer:function(d,v,E){var A=xn();return v=E!==void 0?E(v):v,A.memoizedState=A.baseState=v,d={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:d,lastRenderedState:v},A.queue=d,d=d.dispatch=hb.bind(null,rn,d),[A.memoizedState,d]},useRef:function(d){var v=xn();return d={current:d},v.memoizedState=d},useState:hu,useDebugValue:Tl,useDeferredValue:function(d){return xn().memoizedState=d},useTransition:function(){var d=hu(!1),v=d[0];return d=N0.bind(null,d[1]),xn().memoizedState=d,[v,d]},useMutableSource:function(){},useSyncExternalStore:function(d,v,E){var A=rn,H=xn();if(Qr){if(E===void 0)throw Error(r(407));E=E()}else{if(E=v(),ua===null)throw Error(r(349));(La&30)!==0||_0(A,v,E)}H.memoizedState=E;var Y={value:E,getSnapshot:v};return H.queue=Y,C0(_m.bind(null,A,Y,d),[d]),A.flags|=2048,td(9,El.bind(null,A,Y,E,v),void 0,null),E},useId:function(){var d=xn(),v=ua.identifierPrefix;if(Qr){var E=Cn,A=ys;E=(A&~(1<<32-Ze(A)-1)).toString(32)+E,v=":"+v+"R"+E,E=Gs++,0<E&&(v+="H"+E.toString(32)),v+=":"}else E=Xh++,v=":"+v+"r"+E.toString(32)+":";return d.memoizedState=v},unstable_isNewReconciler:!1},mu={readContext:Aa,useCallback:Mm,useContext:Aa,useEffect:Tm,useImperativeHandle:E0,useInsertionEffect:Nm,useLayoutEffect:Pm,useMemo:bn,useReducer:oa,useRef:Em,useState:function(){return oa(sa)},useDebugValue:Tl,useDeferredValue:function(d){var v=ki();return T0(v,Wn.memoizedState,d)},useTransition:function(){var d=oa(sa)[0],v=ki().memoizedState;return[d,v]},useMutableSource:Jh,useSyncExternalStore:ep,useId:P0,unstable_isNewReconciler:!1},rp={readContext:Aa,useCallback:Mm,useContext:Aa,useEffect:Tm,useImperativeHandle:E0,useInsertionEffect:Nm,useLayoutEffect:Pm,useMemo:bn,useReducer:Qh,useRef:Em,useState:function(){return Qh(sa)},useDebugValue:Tl,useDeferredValue:function(d){var v=ki();return Wn===null?v.memoizedState=d:T0(v,Wn.memoizedState,d)},useTransition:function(){var d=Qh(sa)[0],v=ki().memoizedState;return[d,v]},useMutableSource:Jh,useSyncExternalStore:ep,useId:P0,unstable_isNewReconciler:!1};function Gi(d,v){if(d&&d.defaultProps){v=te({},v),d=d.defaultProps;for(var E in d)v[E]===void 0&&(v[E]=d[E]);return v}return v}function ad(d,v,E,A){v=d.memoizedState,E=E(A,v),E=E==null?v:te({},v,E),d.memoizedState=E,d.lanes===0&&(d.updateQueue.baseState=E)}var sd={isMounted:function(d){return(d=d._reactInternals)?ni(d)===d:!1},enqueueSetState:function(d,v,E){d=d._reactInternals;var A=_s(),H=dd(d),Y=zo(A,H);Y.payload=v,E!=null&&(Y.callback=E),v=Uo(d,Y,H),v!==null&&(Ml(v,d,H,A),Yh(v,d,H))},enqueueReplaceState:function(d,v,E){d=d._reactInternals;var A=_s(),H=dd(d),Y=zo(A,H);Y.tag=1,Y.payload=v,E!=null&&(Y.callback=E),v=Uo(d,Y,H),v!==null&&(Ml(v,d,H,A),Yh(v,d,H))},enqueueForceUpdate:function(d,v){d=d._reactInternals;var E=_s(),A=dd(d),H=zo(E,A);H.tag=2,v!=null&&(H.callback=v),v=Uo(d,H,A),v!==null&&(Ml(v,d,A,E),Yh(v,d,A))}};function np(d,v,E,A,H,Y,le){return d=d.stateNode,typeof d.shouldComponentUpdate=="function"?d.shouldComponentUpdate(A,Y,le):v.prototype&&v.prototype.isPureReactComponent?!Bs(E,A)||!Bs(H,Y):!0}function L0(d,v,E){var A=!1,H=Io,Y=v.contextType;return typeof Y=="object"&&Y!==null?Y=Aa(Y):(H=ia(v)?su:Ui.current,A=v.contextTypes,Y=(A=A!=null)?Wu(d,H):Io),v=new v(E,Y),d.memoizedState=v.state!==null&&v.state!==void 0?v.state:null,v.updater=sd,d.stateNode=v,v._reactInternals=d,A&&(d=d.stateNode,d.__reactInternalMemoizedUnmaskedChildContext=H,d.__reactInternalMemoizedMaskedChildContext=Y),v}function Lm(d,v,E,A){d=v.state,typeof v.componentWillReceiveProps=="function"&&v.componentWillReceiveProps(E,A),typeof v.UNSAFE_componentWillReceiveProps=="function"&&v.UNSAFE_componentWillReceiveProps(E,A),v.state!==d&&sd.enqueueReplaceState(v,v.state,null)}function ip(d,v,E,A){var H=d.stateNode;H.props=E,H.state=d.memoizedState,H.refs={},Rf(d);var Y=v.contextType;typeof Y=="object"&&Y!==null?H.context=Aa(Y):(Y=ia(v)?su:Ui.current,H.context=Wu(d,Y)),H.state=d.memoizedState,Y=v.getDerivedStateFromProps,typeof Y=="function"&&(ad(d,v,Y,E),H.state=d.memoizedState),typeof v.getDerivedStateFromProps=="function"||typeof H.getSnapshotBeforeUpdate=="function"||typeof H.UNSAFE_componentWillMount!="function"&&typeof H.componentWillMount!="function"||(v=H.state,typeof H.componentWillMount=="function"&&H.componentWillMount(),typeof H.UNSAFE_componentWillMount=="function"&&H.UNSAFE_componentWillMount(),v!==H.state&&sd.enqueueReplaceState(H,H.state,null),Zc(d,E,H,A),H.state=d.memoizedState),typeof H.componentDidMount=="function"&&(d.flags|=4194308)}function ec(d,v){try{var E="",A=v;do E+=se(A),A=A.return;while(A);var H=E}catch(Y){H=`
Error generating stack: `+Y.message+`
`+Y.stack}return{value:d,source:v,stack:H,digest:null}}function ap(d,v,E){return{value:d,source:null,stack:E??null,digest:v??null}}function od(d,v){try{console.error(v.value)}catch(E){setTimeout(function(){throw E})}}var mb=typeof WeakMap=="function"?WeakMap:Map;function R0(d,v,E){E=zo(-1,E),E.tag=3,E.payload={element:null};var A=v.value;return E.callback=function(){F0||(F0=!0,Cb=A),od(d,v)},E}function x(d,v,E){E=zo(-1,E),E.tag=3;var A=d.type.getDerivedStateFromError;if(typeof A=="function"){var H=v.value;E.payload=function(){return A(H)},E.callback=function(){od(d,v)}}var Y=d.stateNode;return Y!==null&&typeof Y.componentDidCatch=="function"&&(E.callback=function(){od(d,v),typeof A!="function"&&(ud===null?ud=new Set([this]):ud.add(this));var le=v.stack;this.componentDidCatch(v.value,{componentStack:le!==null?le:""})}),E}function b(d,v,E){var A=d.pingCache;if(A===null){A=d.pingCache=new mb;var H=new Set;A.set(v,H)}else H=A.get(v),H===void 0&&(H=new Set,A.set(v,H));H.has(E)||(H.add(E),d=ID.bind(null,d,v,E),v.then(d,d))}function M(d){do{var v;if((v=d.tag===13)&&(v=d.memoizedState,v=v!==null?v.dehydrated!==null:!0),v)return d;d=d.return}while(d!==null);return null}function B(d,v,E,A,H){return(d.mode&1)===0?(d===v?d.flags|=65536:(d.flags|=128,E.flags|=131072,E.flags&=-52805,E.tag===1&&(E.alternate===null?E.tag=17:(v=zo(-1,1),v.tag=2,Uo(E,v,1))),E.lanes|=1),d):(d.flags|=65536,d.lanes=H,d)}var q=N.ReactCurrentOwner,ee=!1;function me(d,v,E,A){v.child=d===null?Us(v,null,E,A):Xu(v,d.child,E,A)}function Te(d,v,E,A,H){E=E.render;var Y=v.ref;return _l(v,H),A=Jc(d,v,E,A,Y,H),E=ed(),d!==null&&!ee?(v.updateQueue=d.updateQueue,v.flags&=-2053,d.lanes&=~H,la(d,v,H)):(Qr&&E&&Wc(v),v.flags|=1,me(d,v,A,H),v.child)}function ze(d,v,E,A,H){if(d===null){var Y=E.type;return typeof Y=="function"&&!Lb(Y)&&Y.defaultProps===void 0&&E.compare===null&&E.defaultProps===void 0?(v.tag=15,v.type=Y,gt(d,v,Y,A,H)):(d=H0(E.type,null,A,v,v.mode,H),d.ref=v.ref,d.return=v,v.child=d)}if(Y=d.child,(d.lanes&H)===0){var le=Y.memoizedProps;if(E=E.compare,E=E!==null?E:Bs,E(le,A)&&d.ref===v.ref)return la(d,v,H)}return v.flags|=1,d=hd(Y,A),d.ref=v.ref,d.return=v,v.child=d}function gt(d,v,E,A,H){if(d!==null){var Y=d.memoizedProps;if(Bs(Y,A)&&d.ref===v.ref)if(ee=!1,v.pendingProps=A=Y,(d.lanes&H)!==0)(d.flags&131072)!==0&&(ee=!0);else return v.lanes=d.lanes,la(d,v,H)}return Mt(d,v,E,A,H)}function It(d,v,E){var A=v.pendingProps,H=A.children,Y=d!==null?d.memoizedState:null;if(A.mode==="hidden")if((v.mode&1)===0)v.memoizedState={baseLanes:0,cachePool:null,transitions:null},un(op,po),po|=E;else{if((E&1073741824)===0)return d=Y!==null?Y.baseLanes|E:E,v.lanes=v.childLanes=1073741824,v.memoizedState={baseLanes:d,cachePool:null,transitions:null},v.updateQueue=null,un(op,po),po|=d,null;v.memoizedState={baseLanes:0,cachePool:null,transitions:null},A=Y!==null?Y.baseLanes:E,un(op,po),po|=A}else Y!==null?(A=Y.baseLanes|E,v.memoizedState=null):A=E,un(op,po),po|=A;return me(d,v,H,E),v.child}function cr(d,v){var E=v.ref;(d===null&&E!==null||d!==null&&d.ref!==E)&&(v.flags|=512,v.flags|=2097152)}function Mt(d,v,E,A,H){var Y=ia(E)?su:Ui.current;return Y=Wu(v,Y),_l(v,H),E=Jc(d,v,E,A,Y,H),A=ed(),d!==null&&!ee?(v.updateQueue=d.updateQueue,v.flags&=-2053,d.lanes&=~H,la(d,v,H)):(Qr&&A&&Wc(v),v.flags|=1,me(d,v,E,H),v.child)}function gn(d,v,E,A,H){if(ia(E)){var Y=!0;qu(v)}else Y=!1;if(_l(v,H),v.stateNode===null)Or(d,v),L0(v,E,A),ip(v,E,A,H),A=!0;else if(d===null){var le=v.stateNode,be=v.memoizedProps;le.props=be;var _e=le.context,Be=E.contextType;typeof Be=="object"&&Be!==null?Be=Aa(Be):(Be=ia(E)?su:Ui.current,Be=Wu(v,Be));var nt=E.getDerivedStateFromProps,ft=typeof nt=="function"||typeof le.getSnapshotBeforeUpdate=="function";ft||typeof le.UNSAFE_componentWillReceiveProps!="function"&&typeof le.componentWillReceiveProps!="function"||(be!==A||_e!==Be)&&Lm(v,le,A,Be),Bo=!1;var tt=v.memoizedState;le.state=tt,Zc(v,A,le,H),_e=v.memoizedState,be!==A||tt!==_e||na.current||Bo?(typeof nt=="function"&&(ad(v,E,nt,A),_e=v.memoizedState),(be=Bo||np(v,E,be,A,tt,_e,Be))?(ft||typeof le.UNSAFE_componentWillMount!="function"&&typeof le.componentWillMount!="function"||(typeof le.componentWillMount=="function"&&le.componentWillMount(),typeof le.UNSAFE_componentWillMount=="function"&&le.UNSAFE_componentWillMount()),typeof le.componentDidMount=="function"&&(v.flags|=4194308)):(typeof le.componentDidMount=="function"&&(v.flags|=4194308),v.memoizedProps=A,v.memoizedState=_e),le.props=A,le.state=_e,le.context=Be,A=be):(typeof le.componentDidMount=="function"&&(v.flags|=4194308),A=!1)}else{le=v.stateNode,Zh(d,v),be=v.memoizedProps,Be=v.type===v.elementType?be:Gi(v.type,be),le.props=Be,ft=v.pendingProps,tt=le.context,_e=E.contextType,typeof _e=="object"&&_e!==null?_e=Aa(_e):(_e=ia(E)?su:Ui.current,_e=Wu(v,_e));var Rt=E.getDerivedStateFromProps;(nt=typeof Rt=="function"||typeof le.getSnapshotBeforeUpdate=="function")||typeof le.UNSAFE_componentWillReceiveProps!="function"&&typeof le.componentWillReceiveProps!="function"||(be!==ft||tt!==_e)&&Lm(v,le,A,_e),Bo=!1,tt=v.memoizedState,le.state=tt,Zc(v,A,le,H);var Ut=v.memoizedState;be!==ft||tt!==Ut||na.current||Bo?(typeof Rt=="function"&&(ad(v,E,Rt,A),Ut=v.memoizedState),(Be=Bo||np(v,E,Be,A,tt,Ut,_e)||!1)?(nt||typeof le.UNSAFE_componentWillUpdate!="function"&&typeof le.componentWillUpdate!="function"||(typeof le.componentWillUpdate=="function"&&le.componentWillUpdate(A,Ut,_e),typeof le.UNSAFE_componentWillUpdate=="function"&&le.UNSAFE_componentWillUpdate(A,Ut,_e)),typeof le.componentDidUpdate=="function"&&(v.flags|=4),typeof le.getSnapshotBeforeUpdate=="function"&&(v.flags|=1024)):(typeof le.componentDidUpdate!="function"||be===d.memoizedProps&&tt===d.memoizedState||(v.flags|=4),typeof le.getSnapshotBeforeUpdate!="function"||be===d.memoizedProps&&tt===d.memoizedState||(v.flags|=1024),v.memoizedProps=A,v.memoizedState=Ut),le.props=A,le.state=Ut,le.context=_e,A=Be):(typeof le.componentDidUpdate!="function"||be===d.memoizedProps&&tt===d.memoizedState||(v.flags|=4),typeof le.getSnapshotBeforeUpdate!="function"||be===d.memoizedProps&&tt===d.memoizedState||(v.flags|=1024),A=!1)}return Jr(d,v,E,A,Y,H)}function Jr(d,v,E,A,H,Y){cr(d,v);var le=(v.flags&128)!==0;if(!A&&!le)return H&&w0(v,E,!1),la(d,v,Y);A=v.stateNode,q.current=v;var be=le&&typeof E.getDerivedStateFromError!="function"?null:A.render();return v.flags|=1,d!==null&&le?(v.child=Xu(v,d.child,null,Y),v.child=Xu(v,null,be,Y)):me(d,v,be,Y),v.memoizedState=A.state,H&&w0(v,E,!0),v.child}function Ra(d){var v=d.stateNode;v.pendingContext?bm(d,v.pendingContext,v.pendingContext!==v.context):v.context&&bm(d,v.context,!1),du(d,v.containerInfo)}function Go(d,v,E,A,H){return Yu(),Mf(H),v.flags|=256,me(d,v,E,A),v.child}var Fe={dehydrated:null,treeContext:null,retryLane:0};function Pe(d){return{baseLanes:d,cachePool:null,transitions:null}}function He(d,v,E){var A=v.pendingProps,H=mn.current,Y=!1,le=(v.flags&128)!==0,be;if((be=le)||(be=d!==null&&d.memoizedState===null?!1:(H&2)!==0),be?(Y=!0,v.flags&=-129):(d===null||d.memoizedState!==null)&&(H|=1),un(mn,H&1),d===null)return qc(v),d=v.memoizedState,d!==null&&(d=d.dehydrated,d!==null)?((v.mode&1)===0?v.lanes=1:d.data==="$!"?v.lanes=8:v.lanes=1073741824,null):(le=A.children,d=A.fallback,Y?(A=v.mode,Y=v.child,le={mode:"hidden",children:le},(A&1)===0&&Y!==null?(Y.childLanes=0,Y.pendingProps=le):Y=W0(le,A,0,null),d=Uf(d,A,E,null),Y.return=v,d.return=v,Y.sibling=d,v.child=Y,v.child.memoizedState=Pe(E),v.memoizedState=Fe,d):At(v,le));if(H=d.memoizedState,H!==null&&(be=H.dehydrated,be!==null))return vr(d,v,le,A,be,H,E);if(Y){Y=A.fallback,le=v.mode,H=d.child,be=H.sibling;var _e={mode:"hidden",children:A.children};return(le&1)===0&&v.child!==H?(A=v.child,A.childLanes=0,A.pendingProps=_e,v.deletions=null):(A=hd(H,_e),A.subtreeFlags=H.subtreeFlags&14680064),be!==null?Y=hd(be,Y):(Y=Uf(Y,le,E,null),Y.flags|=2),Y.return=v,A.return=v,A.sibling=Y,v.child=A,A=Y,Y=v.child,le=d.child.memoizedState,le=le===null?Pe(E):{baseLanes:le.baseLanes|E,cachePool:null,transitions:le.transitions},Y.memoizedState=le,Y.childLanes=d.childLanes&~E,v.memoizedState=Fe,A}return Y=d.child,d=Y.sibling,A=hd(Y,{mode:"visible",children:A.children}),(v.mode&1)===0&&(A.lanes=E),A.return=v,A.sibling=null,d!==null&&(E=v.deletions,E===null?(v.deletions=[d],v.flags|=16):E.push(d)),v.child=A,v.memoizedState=null,A}function At(d,v){return v=W0({mode:"visible",children:v},d.mode,0,null),v.return=d,d.child=v}function $t(d,v,E,A){return A!==null&&Mf(A),Xu(v,d.child,null,E),d=At(v,v.pendingProps.children),d.flags|=2,v.memoizedState=null,d}function vr(d,v,E,A,H,Y,le){if(E)return v.flags&256?(v.flags&=-257,A=ap(Error(r(422))),$t(d,v,le,A)):v.memoizedState!==null?(v.child=d.child,v.flags|=128,null):(Y=A.fallback,H=v.mode,A=W0({mode:"visible",children:A.children},H,0,null),Y=Uf(Y,H,le,null),Y.flags|=2,A.return=v,Y.return=v,A.sibling=Y,v.child=A,(v.mode&1)!==0&&Xu(v,d.child,null,le),v.child.memoizedState=Pe(le),v.memoizedState=Fe,Y);if((v.mode&1)===0)return $t(d,v,le,null);if(H.data==="$!"){if(A=H.nextSibling&&H.nextSibling.dataset,A)var be=A.dgst;return A=be,Y=Error(r(419)),A=ap(Y,A,void 0),$t(d,v,le,A)}if(be=(le&d.childLanes)!==0,ee||be){if(A=ua,A!==null){switch(le&-le){case 4:H=2;break;case 16:H=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:H=32;break;case 536870912:H=268435456;break;default:H=0}H=(H&(A.suspendedLanes|le))!==0?0:H,H!==0&&H!==Y.retryLane&&(Y.retryLane=H,Ss(d,H),Ml(A,d,H,-1))}return Ab(),A=ap(Error(r(421))),$t(d,v,le,A)}return H.data==="$?"?(v.flags|=128,v.child=d.child,v=jD.bind(null,d),H._reactRetry=v,null):(d=Y.treeContext,kt=zs(H.nextSibling),xs=v,Qr=!0,bs=null,d!==null&&(Pa[Ma++]=ys,Pa[Ma++]=Cn,Pa[Ma++]=cu,ys=d.id,Cn=d.overflow,cu=v),v=At(v,A.children),v.flags|=4096,v)}function dr(d,v,E){d.lanes|=v;var A=d.alternate;A!==null&&(A.lanes|=v),Kh(d.return,v,E)}function Fr(d,v,E,A,H){var Y=d.memoizedState;Y===null?d.memoizedState={isBackwards:v,rendering:null,renderingStartTime:0,last:A,tail:E,tailMode:H}:(Y.isBackwards=v,Y.rendering=null,Y.renderingStartTime=0,Y.last=A,Y.tail=E,Y.tailMode=H)}function _i(d,v,E){var A=v.pendingProps,H=A.revealOrder,Y=A.tail;if(me(d,v,A.children,E),A=mn.current,(A&2)!==0)A=A&1|2,v.flags|=128;else{if(d!==null&&(d.flags&128)!==0)e:for(d=v.child;d!==null;){if(d.tag===13)d.memoizedState!==null&&dr(d,E,v);else if(d.tag===19)dr(d,E,v);else if(d.child!==null){d.child.return=d,d=d.child;continue}if(d===v)break e;for(;d.sibling===null;){if(d.return===null||d.return===v)break e;d=d.return}d.sibling.return=d.return,d=d.sibling}A&=1}if(un(mn,A),(v.mode&1)===0)v.memoizedState=null;else switch(H){case"forwards":for(E=v.child,H=null;E!==null;)d=E.alternate,d!==null&&Xc(d)===null&&(H=E),E=E.sibling;E=H,E===null?(H=v.child,v.child=null):(H=E.sibling,E.sibling=null),Fr(v,!1,H,E,Y);break;case"backwards":for(E=null,H=v.child,v.child=null;H!==null;){if(d=H.alternate,d!==null&&Xc(d)===null){v.child=H;break}d=H.sibling,H.sibling=E,E=H,H=d}Fr(v,!0,E,null,Y);break;case"together":Fr(v,!1,null,null,void 0);break;default:v.memoizedState=null}return v.child}function Or(d,v){(v.mode&1)===0&&d!==null&&(d.alternate=null,v.alternate=null,v.flags|=2)}function la(d,v,E){if(d!==null&&(v.dependencies=d.dependencies),jf|=v.lanes,(E&v.childLanes)===0)return null;if(d!==null&&v.child!==d.child)throw Error(r(153));if(v.child!==null){for(d=v.child,E=hd(d,d.pendingProps),v.child=E,E.return=v;d.sibling!==null;)d=d.sibling,E=E.sibling=hd(d,d.pendingProps),E.return=v;E.sibling=null}return v.child}function gb(d,v,E){switch(v.tag){case 3:Ra(v),Yu();break;case 5:Yc(v);break;case 1:ia(v.type)&&qu(v);break;case 4:du(v,v.stateNode.containerInfo);break;case 10:var A=v.type._context,H=v.memoizedProps.value;un(Af,A._currentValue),A._currentValue=H;break;case 13:if(A=v.memoizedState,A!==null)return A.dehydrated!==null?(un(mn,mn.current&1),v.flags|=128,null):(E&v.child.childLanes)!==0?He(d,v,E):(un(mn,mn.current&1),d=la(d,v,E),d!==null?d.sibling:null);un(mn,mn.current&1);break;case 19:if(A=(E&v.childLanes)!==0,(d.flags&128)!==0){if(A)return _i(d,v,E);v.flags|=128}if(H=v.memoizedState,H!==null&&(H.rendering=null,H.tail=null,H.lastEffect=null),un(mn,mn.current),A)break;return null;case 22:case 23:return v.lanes=0,It(d,v,E)}return la(d,v,E)}var FC,vb,BC,zC;FC=function(d,v){for(var E=v.child;E!==null;){if(E.tag===5||E.tag===6)d.appendChild(E.stateNode);else if(E.tag!==4&&E.child!==null){E.child.return=E,E=E.child;continue}if(E===v)break;for(;E.sibling===null;){if(E.return===null||E.return===v)return;E=E.return}E.sibling.return=E.return,E=E.sibling}},vb=function(){},BC=function(d,v,E,A){var H=d.memoizedProps;if(H!==A){d=v.stateNode,Si(cn.current);var Y=null;switch(E){case"input":H=Ae(d,H),A=Ae(d,A),Y=[];break;case"select":H=te({},H,{value:void 0}),A=te({},A,{value:void 0}),Y=[];break;case"textarea":H=ct(d,H),A=ct(d,A),Y=[];break;default:typeof H.onClick!="function"&&typeof A.onClick=="function"&&(d.onclick=Xe)}Ee(E,A);var le;E=null;for(Be in H)if(!A.hasOwnProperty(Be)&&H.hasOwnProperty(Be)&&H[Be]!=null)if(Be==="style"){var be=H[Be];for(le in be)be.hasOwnProperty(le)&&(E||(E={}),E[le]="")}else Be!=="dangerouslySetInnerHTML"&&Be!=="children"&&Be!=="suppressContentEditableWarning"&&Be!=="suppressHydrationWarning"&&Be!=="autoFocus"&&(i.hasOwnProperty(Be)?Y||(Y=[]):(Y=Y||[]).push(Be,null));for(Be in A){var _e=A[Be];if(be=H?.[Be],A.hasOwnProperty(Be)&&_e!==be&&(_e!=null||be!=null))if(Be==="style")if(be){for(le in be)!be.hasOwnProperty(le)||_e&&_e.hasOwnProperty(le)||(E||(E={}),E[le]="");for(le in _e)_e.hasOwnProperty(le)&&be[le]!==_e[le]&&(E||(E={}),E[le]=_e[le])}else E||(Y||(Y=[]),Y.push(Be,E)),E=_e;else Be==="dangerouslySetInnerHTML"?(_e=_e?_e.__html:void 0,be=be?be.__html:void 0,_e!=null&&be!==_e&&(Y=Y||[]).push(Be,_e)):Be==="children"?typeof _e!="string"&&typeof _e!="number"||(Y=Y||[]).push(Be,""+_e):Be!=="suppressContentEditableWarning"&&Be!=="suppressHydrationWarning"&&(i.hasOwnProperty(Be)?(_e!=null&&Be==="onScroll"&&Yr("scroll",d),Y||be===_e||(Y=[])):(Y=Y||[]).push(Be,_e))}E&&(Y=Y||[]).push("style",E);var Be=Y;(v.updateQueue=Be)&&(v.flags|=4)}},zC=function(d,v,E,A){E!==A&&(v.flags|=4)};function Rm(d,v){if(!Qr)switch(d.tailMode){case"hidden":v=d.tail;for(var E=null;v!==null;)v.alternate!==null&&(E=v),v=v.sibling;E===null?d.tail=null:E.sibling=null;break;case"collapsed":E=d.tail;for(var A=null;E!==null;)E.alternate!==null&&(A=E),E=E.sibling;A===null?v||d.tail===null?d.tail=null:d.tail.sibling=null:A.sibling=null}}function rs(d){var v=d.alternate!==null&&d.alternate.child===d.child,E=0,A=0;if(v)for(var H=d.child;H!==null;)E|=H.lanes|H.childLanes,A|=H.subtreeFlags&14680064,A|=H.flags&14680064,H.return=d,H=H.sibling;else for(H=d.child;H!==null;)E|=H.lanes|H.childLanes,A|=H.subtreeFlags,A|=H.flags,H.return=d,H=H.sibling;return d.subtreeFlags|=A,d.childLanes=E,v}function ED(d,v,E){var A=v.pendingProps;switch(Li(v),v.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return rs(v),null;case 1:return ia(v.type)&&Vc(),rs(v),null;case 3:return A=v.stateNode,Tn(),pn(na),pn(Ui),aa(),A.pendingContext&&(A.context=A.pendingContext,A.pendingContext=null),(d===null||d.child===null)&&(Pf(v)?v.flags|=4:d===null||d.memoizedState.isDehydrated&&(v.flags&256)===0||(v.flags|=1024,bs!==null&&(Nb(bs),bs=null))),vb(d,v),rs(v),null;case 5:Cl(v);var H=Si(ti.current);if(E=v.type,d!==null&&v.stateNode!=null)BC(d,v,E,A,H),d.ref!==v.ref&&(v.flags|=512,v.flags|=2097152);else{if(!A){if(v.stateNode===null)throw Error(r(166));return rs(v),null}if(d=Si(cn.current),Pf(v)){A=v.stateNode,E=v.type;var Y=v.memoizedProps;switch(A[es]=v,A[au]=Y,d=(v.mode&1)!==0,E){case"dialog":Yr("cancel",A),Yr("close",A);break;case"iframe":case"object":case"embed":Yr("load",A);break;case"video":case"audio":for(H=0;H<uo.length;H++)Yr(uo[H],A);break;case"source":Yr("error",A);break;case"img":case"image":case"link":Yr("error",A),Yr("load",A);break;case"details":Yr("toggle",A);break;case"input":Me(A,Y),Yr("invalid",A);break;case"select":A._wrapperState={wasMultiple:!!Y.multiple},Yr("invalid",A);break;case"textarea":xt(A,Y),Yr("invalid",A)}Ee(E,Y),H=null;for(var le in Y)if(Y.hasOwnProperty(le)){var be=Y[le];le==="children"?typeof be=="string"?A.textContent!==be&&(Y.suppressHydrationWarning!==!0&&je(A.textContent,be,d),H=["children",be]):typeof be=="number"&&A.textContent!==""+be&&(Y.suppressHydrationWarning!==!0&&je(A.textContent,be,d),H=["children",""+be]):i.hasOwnProperty(le)&&be!=null&&le==="onScroll"&&Yr("scroll",A)}switch(E){case"input":ue(A),dt(A,Y,!0);break;case"textarea":ue(A),Lt(A);break;case"select":case"option":break;default:typeof Y.onClick=="function"&&(A.onclick=Xe)}A=H,v.updateQueue=A,A!==null&&(v.flags|=4)}else{le=H.nodeType===9?H:H.ownerDocument,d==="http://www.w3.org/1999/xhtml"&&(d=Bt(E)),d==="http://www.w3.org/1999/xhtml"?E==="script"?(d=le.createElement("div"),d.innerHTML="<script><\/script>",d=d.removeChild(d.firstChild)):typeof A.is=="string"?d=le.createElement(E,{is:A.is}):(d=le.createElement(E),E==="select"&&(le=d,A.multiple?le.multiple=!0:A.size&&(le.size=A.size))):d=le.createElementNS(d,E),d[es]=v,d[au]=A,FC(d,v,!1,!1),v.stateNode=d;e:{switch(le=Re(E,A),E){case"dialog":Yr("cancel",d),Yr("close",d),H=A;break;case"iframe":case"object":case"embed":Yr("load",d),H=A;break;case"video":case"audio":for(H=0;H<uo.length;H++)Yr(uo[H],d);H=A;break;case"source":Yr("error",d),H=A;break;case"img":case"image":case"link":Yr("error",d),Yr("load",d),H=A;break;case"details":Yr("toggle",d),H=A;break;case"input":Me(d,A),H=Ae(d,A),Yr("invalid",d);break;case"option":H=A;break;case"select":d._wrapperState={wasMultiple:!!A.multiple},H=te({},A,{value:void 0}),Yr("invalid",d);break;case"textarea":xt(d,A),H=ct(d,A),Yr("invalid",d);break;default:H=A}Ee(E,H),be=H;for(Y in be)if(be.hasOwnProperty(Y)){var _e=be[Y];Y==="style"?ge(d,_e):Y==="dangerouslySetInnerHTML"?(_e=_e?_e.__html:void 0,_e!=null&&St(d,_e)):Y==="children"?typeof _e=="string"?(E!=="textarea"||_e!=="")&&it(d,_e):typeof _e=="number"&&it(d,""+_e):Y!=="suppressContentEditableWarning"&&Y!=="suppressHydrationWarning"&&Y!=="autoFocus"&&(i.hasOwnProperty(Y)?_e!=null&&Y==="onScroll"&&Yr("scroll",d):_e!=null&&T(d,Y,_e,le))}switch(E){case"input":ue(d),dt(d,A,!1);break;case"textarea":ue(d),Lt(d);break;case"option":A.value!=null&&d.setAttribute("value",""+pe(A.value));break;case"select":d.multiple=!!A.multiple,Y=A.value,Y!=null?ut(d,!!A.multiple,Y,!1):A.defaultValue!=null&&ut(d,!!A.multiple,A.defaultValue,!0);break;default:typeof H.onClick=="function"&&(d.onclick=Xe)}switch(E){case"button":case"input":case"select":case"textarea":A=!!A.autoFocus;break e;case"img":A=!0;break e;default:A=!1}}A&&(v.flags|=4)}v.ref!==null&&(v.flags|=512,v.flags|=2097152)}return rs(v),null;case 6:if(d&&v.stateNode!=null)zC(d,v,d.memoizedProps,A);else{if(typeof A!="string"&&v.stateNode===null)throw Error(r(166));if(E=Si(ti.current),Si(cn.current),Pf(v)){if(A=v.stateNode,E=v.memoizedProps,A[es]=v,(Y=A.nodeValue!==E)&&(d=xs,d!==null))switch(d.tag){case 3:je(A.nodeValue,E,(d.mode&1)!==0);break;case 5:d.memoizedProps.suppressHydrationWarning!==!0&&je(A.nodeValue,E,(d.mode&1)!==0)}Y&&(v.flags|=4)}else A=(E.nodeType===9?E:E.ownerDocument).createTextNode(A),A[es]=v,v.stateNode=A}return rs(v),null;case 13:if(pn(mn),A=v.memoizedState,d===null||d.memoizedState!==null&&d.memoizedState.dehydrated!==null){if(Qr&&kt!==null&&(v.mode&1)!==0&&(v.flags&128)===0)Sm(),Yu(),v.flags|=98560,Y=!1;else if(Y=Pf(v),A!==null&&A.dehydrated!==null){if(d===null){if(!Y)throw Error(r(318));if(Y=v.memoizedState,Y=Y!==null?Y.dehydrated:null,!Y)throw Error(r(317));Y[es]=v}else Yu(),(v.flags&128)===0&&(v.memoizedState=null),v.flags|=4;rs(v),Y=!1}else bs!==null&&(Nb(bs),bs=null),Y=!0;if(!Y)return v.flags&65536?v:null}return(v.flags&128)!==0?(v.lanes=E,v):(A=A!==null,A!==(d!==null&&d.memoizedState!==null)&&A&&(v.child.flags|=8192,(v.mode&1)!==0&&(d===null||(mn.current&1)!==0?Vi===0&&(Vi=3):Ab())),v.updateQueue!==null&&(v.flags|=4),rs(v),null);case 4:return Tn(),vb(d,v),d===null&&Oo(v.stateNode.containerInfo),rs(v),null;case 10:return $h(v.type._context),rs(v),null;case 17:return ia(v.type)&&Vc(),rs(v),null;case 19:if(pn(mn),Y=v.memoizedState,Y===null)return rs(v),null;if(A=(v.flags&128)!==0,le=Y.rendering,le===null)if(A)Rm(Y,!1);else{if(Vi!==0||d!==null&&(d.flags&128)!==0)for(d=v.child;d!==null;){if(le=Xc(d),le!==null){for(v.flags|=128,Rm(Y,!1),A=le.updateQueue,A!==null&&(v.updateQueue=A,v.flags|=4),v.subtreeFlags=0,A=E,E=v.child;E!==null;)Y=E,d=A,Y.flags&=14680066,le=Y.alternate,le===null?(Y.childLanes=0,Y.lanes=d,Y.child=null,Y.subtreeFlags=0,Y.memoizedProps=null,Y.memoizedState=null,Y.updateQueue=null,Y.dependencies=null,Y.stateNode=null):(Y.childLanes=le.childLanes,Y.lanes=le.lanes,Y.child=le.child,Y.subtreeFlags=0,Y.deletions=null,Y.memoizedProps=le.memoizedProps,Y.memoizedState=le.memoizedState,Y.updateQueue=le.updateQueue,Y.type=le.type,d=le.dependencies,Y.dependencies=d===null?null:{lanes:d.lanes,firstContext:d.firstContext}),E=E.sibling;return un(mn,mn.current&1|2),v.child}d=d.sibling}Y.tail!==null&&on()>lp&&(v.flags|=128,A=!0,Rm(Y,!1),v.lanes=4194304)}else{if(!A)if(d=Xc(le),d!==null){if(v.flags|=128,A=!0,E=d.updateQueue,E!==null&&(v.updateQueue=E,v.flags|=4),Rm(Y,!0),Y.tail===null&&Y.tailMode==="hidden"&&!le.alternate&&!Qr)return rs(v),null}else 2*on()-Y.renderingStartTime>lp&&E!==1073741824&&(v.flags|=128,A=!0,Rm(Y,!1),v.lanes=4194304);Y.isBackwards?(le.sibling=v.child,v.child=le):(E=Y.last,E!==null?E.sibling=le:v.child=le,Y.last=le)}return Y.tail!==null?(v=Y.tail,Y.rendering=v,Y.tail=v.sibling,Y.renderingStartTime=on(),v.sibling=null,E=mn.current,un(mn,A?E&1|2:E&1),v):(rs(v),null);case 22:case 23:return Mb(),A=v.memoizedState!==null,d!==null&&d.memoizedState!==null!==A&&(v.flags|=8192),A&&(v.mode&1)!==0?(po&1073741824)!==0&&(rs(v),v.subtreeFlags&6&&(v.flags|=8192)):rs(v),null;case 24:return null;case 25:return null}throw Error(r(156,v.tag))}function TD(d,v){switch(Li(v),v.tag){case 1:return ia(v.type)&&Vc(),d=v.flags,d&65536?(v.flags=d&-65537|128,v):null;case 3:return Tn(),pn(na),pn(Ui),aa(),d=v.flags,(d&65536)!==0&&(d&128)===0?(v.flags=d&-65537|128,v):null;case 5:return Cl(v),null;case 13:if(pn(mn),d=v.memoizedState,d!==null&&d.dehydrated!==null){if(v.alternate===null)throw Error(r(340));Yu()}return d=v.flags,d&65536?(v.flags=d&-65537|128,v):null;case 19:return pn(mn),null;case 4:return Tn(),null;case 10:return $h(v.type._context),null;case 22:case 23:return Mb(),null;case 24:return null;default:return null}}var O0=!1,ns=!1,ND=typeof WeakSet=="function"?WeakSet:Set,jt=null;function sp(d,v){var E=d.ref;if(E!==null)if(typeof E=="function")try{E(null)}catch(A){ui(d,v,A)}else E.current=null}function yb(d,v,E){try{E()}catch(A){ui(d,v,A)}}var UC=!1;function PD(d,v){if(Nt=Iu,d=Un(),tu(d)){if("selectionStart"in d)var E={start:d.selectionStart,end:d.selectionEnd};else e:{E=(E=d.ownerDocument)&&E.defaultView||window;var A=E.getSelection&&E.getSelection();if(A&&A.rangeCount!==0){E=A.anchorNode;var H=A.anchorOffset,Y=A.focusNode;A=A.focusOffset;try{E.nodeType,Y.nodeType}catch{E=null;break e}var le=0,be=-1,_e=-1,Be=0,nt=0,ft=d,tt=null;t:for(;;){for(var Rt;ft!==E||H!==0&&ft.nodeType!==3||(be=le+H),ft!==Y||A!==0&&ft.nodeType!==3||(_e=le+A),ft.nodeType===3&&(le+=ft.nodeValue.length),(Rt=ft.firstChild)!==null;)tt=ft,ft=Rt;for(;;){if(ft===d)break t;if(tt===E&&++Be===H&&(be=le),tt===Y&&++nt===A&&(_e=le),(Rt=ft.nextSibling)!==null)break;ft=tt,tt=ft.parentNode}ft=Rt}E=be===-1||_e===-1?null:{start:be,end:_e}}else E=null}E=E||{start:0,end:0}}else E=null;for(Xt={focusedElem:d,selectionRange:E},Iu=!1,jt=v;jt!==null;)if(v=jt,d=v.child,(v.subtreeFlags&1028)!==0&&d!==null)d.return=v,jt=d;else for(;jt!==null;){v=jt;try{var Ut=v.alternate;if((v.flags&1024)!==0)switch(v.tag){case 0:case 11:case 15:break;case 1:if(Ut!==null){var Ht=Ut.memoizedProps,Ci=Ut.memoizedState,Oe=v.stateNode,Ce=Oe.getSnapshotBeforeUpdate(v.elementType===v.type?Ht:Gi(v.type,Ht),Ci);Oe.__reactInternalSnapshotBeforeUpdate=Ce}break;case 3:var De=v.stateNode.containerInfo;De.nodeType===1?De.textContent="":De.nodeType===9&&De.documentElement&&De.removeChild(De.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(r(163))}}catch(yt){ui(v,v.return,yt)}if(d=v.sibling,d!==null){d.return=v.return,jt=d;break}jt=v.return}return Ut=UC,UC=!1,Ut}function Om(d,v,E){var A=v.updateQueue;if(A=A!==null?A.lastEffect:null,A!==null){var H=A=A.next;do{if((H.tag&d)===d){var Y=H.destroy;H.destroy=void 0,Y!==void 0&&yb(v,E,Y)}H=H.next}while(H!==A)}}function D0(d,v){if(v=v.updateQueue,v=v!==null?v.lastEffect:null,v!==null){var E=v=v.next;do{if((E.tag&d)===d){var A=E.create;E.destroy=A()}E=E.next}while(E!==v)}}function xb(d){var v=d.ref;if(v!==null){var E=d.stateNode;d.tag,d=E,typeof v=="function"?v(d):v.current=d}}function GC(d){var v=d.alternate;v!==null&&(d.alternate=null,GC(v)),d.child=null,d.deletions=null,d.sibling=null,d.tag===5&&(v=d.stateNode,v!==null&&(delete v[es],delete v[au],delete v[bl],delete v[Fh],delete v[Bh])),d.stateNode=null,d.return=null,d.dependencies=null,d.memoizedProps=null,d.memoizedState=null,d.pendingProps=null,d.stateNode=null,d.updateQueue=null}function VC(d){return d.tag===5||d.tag===3||d.tag===4}function HC(d){e:for(;;){for(;d.sibling===null;){if(d.return===null||VC(d.return))return null;d=d.return}for(d.sibling.return=d.return,d=d.sibling;d.tag!==5&&d.tag!==6&&d.tag!==18;){if(d.flags&2||d.child===null||d.tag===4)continue e;d.child.return=d,d=d.child}if(!(d.flags&2))return d.stateNode}}function bb(d,v,E){var A=d.tag;if(A===5||A===6)d=d.stateNode,v?E.nodeType===8?E.parentNode.insertBefore(d,v):E.insertBefore(d,v):(E.nodeType===8?(v=E.parentNode,v.insertBefore(d,E)):(v=E,v.appendChild(d)),E=E._reactRootContainer,E!=null||v.onclick!==null||(v.onclick=Xe));else if(A!==4&&(d=d.child,d!==null))for(bb(d,v,E),d=d.sibling;d!==null;)bb(d,v,E),d=d.sibling}function wb(d,v,E){var A=d.tag;if(A===5||A===6)d=d.stateNode,v?E.insertBefore(d,v):E.appendChild(d);else if(A!==4&&(d=d.child,d!==null))for(wb(d,v,E),d=d.sibling;d!==null;)wb(d,v,E),d=d.sibling}var Oa=null,Nl=!1;function ld(d,v,E){for(E=E.child;E!==null;)WC(d,v,E),E=E.sibling}function WC(d,v,E){if(et&&typeof et.onCommitFiberUnmount=="function")try{et.onCommitFiberUnmount(Ye,E)}catch{}switch(E.tag){case 5:ns||sp(E,v);case 6:var A=Oa,H=Nl;Oa=null,ld(d,v,E),Oa=A,Nl=H,Oa!==null&&(Nl?(d=Oa,E=E.stateNode,d.nodeType===8?d.parentNode.removeChild(E):d.removeChild(E)):Oa.removeChild(E.stateNode));break;case 18:Oa!==null&&(Nl?(d=Oa,E=E.stateNode,d.nodeType===8?Gc(d.parentNode,E):d.nodeType===1&&Gc(d,E),Fn(d)):Gc(Oa,E.stateNode));break;case 4:A=Oa,H=Nl,Oa=E.stateNode.containerInfo,Nl=!0,ld(d,v,E),Oa=A,Nl=H;break;case 0:case 11:case 14:case 15:if(!ns&&(A=E.updateQueue,A!==null&&(A=A.lastEffect,A!==null))){H=A=A.next;do{var Y=H,le=Y.destroy;Y=Y.tag,le!==void 0&&((Y&2)!==0||(Y&4)!==0)&&yb(E,v,le),H=H.next}while(H!==A)}ld(d,v,E);break;case 1:if(!ns&&(sp(E,v),A=E.stateNode,typeof A.componentWillUnmount=="function"))try{A.props=E.memoizedProps,A.state=E.memoizedState,A.componentWillUnmount()}catch(be){ui(E,v,be)}ld(d,v,E);break;case 21:ld(d,v,E);break;case 22:E.mode&1?(ns=(A=ns)||E.memoizedState!==null,ld(d,v,E),ns=A):ld(d,v,E);break;default:ld(d,v,E)}}function qC(d){var v=d.updateQueue;if(v!==null){d.updateQueue=null;var E=d.stateNode;E===null&&(E=d.stateNode=new ND),v.forEach(function(A){var H=FD.bind(null,d,A);E.has(A)||(E.add(A),A.then(H,H))})}}function Pl(d,v){var E=v.deletions;if(E!==null)for(var A=0;A<E.length;A++){var H=E[A];try{var Y=d,le=v,be=le;e:for(;be!==null;){switch(be.tag){case 5:Oa=be.stateNode,Nl=!1;break e;case 3:Oa=be.stateNode.containerInfo,Nl=!0;break e;case 4:Oa=be.stateNode.containerInfo,Nl=!0;break e}be=be.return}if(Oa===null)throw Error(r(160));WC(Y,le,H),Oa=null,Nl=!1;var _e=H.alternate;_e!==null&&(_e.return=null),H.return=null}catch(Be){ui(H,v,Be)}}if(v.subtreeFlags&12854)for(v=v.child;v!==null;)$C(v,d),v=v.sibling}function $C(d,v){var E=d.alternate,A=d.flags;switch(d.tag){case 0:case 11:case 14:case 15:if(Pl(v,d),gu(d),A&4){try{Om(3,d,d.return),D0(3,d)}catch(Ht){ui(d,d.return,Ht)}try{Om(5,d,d.return)}catch(Ht){ui(d,d.return,Ht)}}break;case 1:Pl(v,d),gu(d),A&512&&E!==null&&sp(E,E.return);break;case 5:if(Pl(v,d),gu(d),A&512&&E!==null&&sp(E,E.return),d.flags&32){var H=d.stateNode;try{it(H,"")}catch(Ht){ui(d,d.return,Ht)}}if(A&4&&(H=d.stateNode,H!=null)){var Y=d.memoizedProps,le=E!==null?E.memoizedProps:Y,be=d.type,_e=d.updateQueue;if(d.updateQueue=null,_e!==null)try{be==="input"&&Y.type==="radio"&&Y.name!=null&&st(H,Y),Re(be,le);var Be=Re(be,Y);for(le=0;le<_e.length;le+=2){var nt=_e[le],ft=_e[le+1];nt==="style"?ge(H,ft):nt==="dangerouslySetInnerHTML"?St(H,ft):nt==="children"?it(H,ft):T(H,nt,ft,Be)}switch(be){case"input":rt(H,Y);break;case"textarea":ot(H,Y);break;case"select":var tt=H._wrapperState.wasMultiple;H._wrapperState.wasMultiple=!!Y.multiple;var Rt=Y.value;Rt!=null?ut(H,!!Y.multiple,Rt,!1):tt!==!!Y.multiple&&(Y.defaultValue!=null?ut(H,!!Y.multiple,Y.defaultValue,!0):ut(H,!!Y.multiple,Y.multiple?[]:"",!1))}H[au]=Y}catch(Ht){ui(d,d.return,Ht)}}break;case 6:if(Pl(v,d),gu(d),A&4){if(d.stateNode===null)throw Error(r(162));H=d.stateNode,Y=d.memoizedProps;try{H.nodeValue=Y}catch(Ht){ui(d,d.return,Ht)}}break;case 3:if(Pl(v,d),gu(d),A&4&&E!==null&&E.memoizedState.isDehydrated)try{Fn(v.containerInfo)}catch(Ht){ui(d,d.return,Ht)}break;case 4:Pl(v,d),gu(d);break;case 13:Pl(v,d),gu(d),H=d.child,H.flags&8192&&(Y=H.memoizedState!==null,H.stateNode.isHidden=Y,!Y||H.alternate!==null&&H.alternate.memoizedState!==null||(_b=on())),A&4&&qC(d);break;case 22:if(nt=E!==null&&E.memoizedState!==null,d.mode&1?(ns=(Be=ns)||nt,Pl(v,d),ns=Be):Pl(v,d),gu(d),A&8192){if(Be=d.memoizedState!==null,(d.stateNode.isHidden=Be)&&!nt&&(d.mode&1)!==0)for(jt=d,nt=d.child;nt!==null;){for(ft=jt=nt;jt!==null;){switch(tt=jt,Rt=tt.child,tt.tag){case 0:case 11:case 14:case 15:Om(4,tt,tt.return);break;case 1:sp(tt,tt.return);var Ut=tt.stateNode;if(typeof Ut.componentWillUnmount=="function"){A=tt,E=tt.return;try{v=A,Ut.props=v.memoizedProps,Ut.state=v.memoizedState,Ut.componentWillUnmount()}catch(Ht){ui(A,E,Ht)}}break;case 5:sp(tt,tt.return);break;case 22:if(tt.memoizedState!==null){YC(ft);continue}}Rt!==null?(Rt.return=tt,jt=Rt):YC(ft)}nt=nt.sibling}e:for(nt=null,ft=d;;){if(ft.tag===5){if(nt===null){nt=ft;try{H=ft.stateNode,Be?(Y=H.style,typeof Y.setProperty=="function"?Y.setProperty("display","none","important"):Y.display="none"):(be=ft.stateNode,_e=ft.memoizedProps.style,le=_e!=null&&_e.hasOwnProperty("display")?_e.display:null,be.style.display=de("display",le))}catch(Ht){ui(d,d.return,Ht)}}}else if(ft.tag===6){if(nt===null)try{ft.stateNode.nodeValue=Be?"":ft.memoizedProps}catch(Ht){ui(d,d.return,Ht)}}else if((ft.tag!==22&&ft.tag!==23||ft.memoizedState===null||ft===d)&&ft.child!==null){ft.child.return=ft,ft=ft.child;continue}if(ft===d)break e;for(;ft.sibling===null;){if(ft.return===null||ft.return===d)break e;nt===ft&&(nt=null),ft=ft.return}nt===ft&&(nt=null),ft.sibling.return=ft.return,ft=ft.sibling}}break;case 19:Pl(v,d),gu(d),A&4&&qC(d);break;case 21:break;default:Pl(v,d),gu(d)}}function gu(d){var v=d.flags;if(v&2){try{e:{for(var E=d.return;E!==null;){if(VC(E)){var A=E;break e}E=E.return}throw Error(r(160))}switch(A.tag){case 5:var H=A.stateNode;A.flags&32&&(it(H,""),A.flags&=-33);var Y=HC(d);wb(d,Y,H);break;case 3:case 4:var le=A.stateNode.containerInfo,be=HC(d);bb(d,be,le);break;default:throw Error(r(161))}}catch(_e){ui(d,d.return,_e)}d.flags&=-3}v&4096&&(d.flags&=-4097)}function MD(d,v,E){jt=d,KC(d)}function KC(d,v,E){for(var A=(d.mode&1)!==0;jt!==null;){var H=jt,Y=H.child;if(H.tag===22&&A){var le=H.memoizedState!==null||O0;if(!le){var be=H.alternate,_e=be!==null&&be.memoizedState!==null||ns;be=O0;var Be=ns;if(O0=le,(ns=_e)&&!Be)for(jt=H;jt!==null;)le=jt,_e=le.child,le.tag===22&&le.memoizedState!==null?XC(H):_e!==null?(_e.return=le,jt=_e):XC(H);for(;Y!==null;)jt=Y,KC(Y),Y=Y.sibling;jt=H,O0=be,ns=Be}ZC(d)}else(H.subtreeFlags&8772)!==0&&Y!==null?(Y.return=H,jt=Y):ZC(d)}}function ZC(d){for(;jt!==null;){var v=jt;if((v.flags&8772)!==0){var E=v.alternate;try{if((v.flags&8772)!==0)switch(v.tag){case 0:case 11:case 15:ns||D0(5,v);break;case 1:var A=v.stateNode;if(v.flags&4&&!ns)if(E===null)A.componentDidMount();else{var H=v.elementType===v.type?E.memoizedProps:Gi(v.type,E.memoizedProps);A.componentDidUpdate(H,E.memoizedState,A.__reactInternalSnapshotBeforeUpdate)}var Y=v.updateQueue;Y!==null&&Hn(v,Y,A);break;case 3:var le=v.updateQueue;if(le!==null){if(E=null,v.child!==null)switch(v.child.tag){case 5:E=v.child.stateNode;break;case 1:E=v.child.stateNode}Hn(v,le,E)}break;case 5:var be=v.stateNode;if(E===null&&v.flags&4){E=be;var _e=v.memoizedProps;switch(v.type){case"button":case"input":case"select":case"textarea":_e.autoFocus&&E.focus();break;case"img":_e.src&&(E.src=_e.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(v.memoizedState===null){var Be=v.alternate;if(Be!==null){var nt=Be.memoizedState;if(nt!==null){var ft=nt.dehydrated;ft!==null&&Fn(ft)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(r(163))}ns||v.flags&512&&xb(v)}catch(tt){ui(v,v.return,tt)}}if(v===d){jt=null;break}if(E=v.sibling,E!==null){E.return=v.return,jt=E;break}jt=v.return}}function YC(d){for(;jt!==null;){var v=jt;if(v===d){jt=null;break}var E=v.sibling;if(E!==null){E.return=v.return,jt=E;break}jt=v.return}}function XC(d){for(;jt!==null;){var v=jt;try{switch(v.tag){case 0:case 11:case 15:var E=v.return;try{D0(4,v)}catch(_e){ui(v,E,_e)}break;case 1:var A=v.stateNode;if(typeof A.componentDidMount=="function"){var H=v.return;try{A.componentDidMount()}catch(_e){ui(v,H,_e)}}var Y=v.return;try{xb(v)}catch(_e){ui(v,Y,_e)}break;case 5:var le=v.return;try{xb(v)}catch(_e){ui(v,le,_e)}}}catch(_e){ui(v,v.return,_e)}if(v===d){jt=null;break}var be=v.sibling;if(be!==null){be.return=v.return,jt=be;break}jt=v.return}}var AD=Math.ceil,I0=N.ReactCurrentDispatcher,Sb=N.ReactCurrentOwner,Vo=N.ReactCurrentBatchConfig,Vr=0,ua=null,Ri=null,Da=0,po=0,op=Sl(0),Vi=0,Dm=null,jf=0,j0=0,kb=0,Im=null,Vs=null,_b=0,lp=1/0,tc=null,F0=!1,Cb=null,ud=null,B0=!1,cd=null,z0=0,jm=0,Eb=null,U0=-1,G0=0;function _s(){return(Vr&6)!==0?on():U0!==-1?U0:U0=on()}function dd(d){return(d.mode&1)===0?1:(Vr&2)!==0&&Da!==0?Da&-Da:km.transition!==null?(G0===0&&(G0=Rr()),G0):(d=wr,d!==0||(d=window.event,d=d===void 0?16:Er(d.type)),d)}function Ml(d,v,E,A){if(50<jm)throw jm=0,Eb=null,Error(r(185));en(d,E,A),((Vr&2)===0||d!==ua)&&(d===ua&&((Vr&2)===0&&(j0|=E),Vi===4&&fd(d,Da)),Hs(d,A),E===1&&Vr===0&&(v.mode&1)===0&&(lp=on()+500,Hc&&ou()))}function Hs(d,v){var E=d.callbackNode;tr(d,v);var A=jr(d,d===ua?Da:0);if(A===0)E!==null&&qa(E),d.callbackNode=null,d.callbackPriority=0;else if(v=A&-A,d.callbackPriority!==v){if(E!=null&&qa(E),v===1)d.tag===0?kl(JC.bind(null,d)):Nf(JC.bind(null,d)),zi(function(){(Vr&6)===0&&ou()}),E=null;else{switch(ao(A)){case 1:E=fs;break;case 4:E=ro;break;case 16:E=Yi;break;case 536870912:E=Ue;break;default:E=Yi}E=oE(E,QC.bind(null,d))}d.callbackPriority=v,d.callbackNode=E}}function QC(d,v){if(U0=-1,G0=0,(Vr&6)!==0)throw Error(r(327));var E=d.callbackNode;if(up()&&d.callbackNode!==E)return null;var A=jr(d,d===ua?Da:0);if(A===0)return null;if((A&30)!==0||(A&d.expiredLanes)!==0||v)v=V0(d,A);else{v=A;var H=Vr;Vr|=2;var Y=tE();(ua!==d||Da!==v)&&(tc=null,lp=on()+500,Bf(d,v));do try{OD();break}catch(be){eE(d,be)}while(!0);qh(),I0.current=Y,Vr=H,Ri!==null?v=0:(ua=null,Da=0,v=Vi)}if(v!==0){if(v===2&&(H=nr(d),H!==0&&(A=H,v=Tb(d,H))),v===1)throw E=Dm,Bf(d,0),fd(d,A),Hs(d,on()),E;if(v===6)fd(d,A);else{if(H=d.current.alternate,(A&30)===0&&!LD(H)&&(v=V0(d,A),v===2&&(Y=nr(d),Y!==0&&(A=Y,v=Tb(d,Y))),v===1))throw E=Dm,Bf(d,0),fd(d,A),Hs(d,on()),E;switch(d.finishedWork=H,d.finishedLanes=A,v){case 0:case 1:throw Error(r(345));case 2:zf(d,Vs,tc);break;case 3:if(fd(d,A),(A&130023424)===A&&(v=_b+500-on(),10<v)){if(jr(d,0)!==0)break;if(H=d.suspendedLanes,(H&A)!==A){_s(),d.pingedLanes|=d.suspendedLanes&H;break}d.timeoutHandle=Xr(zf.bind(null,d,Vs,tc),v);break}zf(d,Vs,tc);break;case 4:if(fd(d,A),(A&4194240)===A)break;for(v=d.eventTimes,H=-1;0<A;){var le=31-Ze(A);Y=1<<le,le=v[le],le>H&&(H=le),A&=~Y}if(A=H,A=on()-A,A=(120>A?120:480>A?480:1080>A?1080:1920>A?1920:3e3>A?3e3:4320>A?4320:1960*AD(A/1960))-A,10<A){d.timeoutHandle=Xr(zf.bind(null,d,Vs,tc),A);break}zf(d,Vs,tc);break;case 5:zf(d,Vs,tc);break;default:throw Error(r(329))}}}return Hs(d,on()),d.callbackNode===E?QC.bind(null,d):null}function Tb(d,v){var E=Im;return d.current.memoizedState.isDehydrated&&(Bf(d,v).flags|=256),d=V0(d,v),d!==2&&(v=Vs,Vs=E,v!==null&&Nb(v)),d}function Nb(d){Vs===null?Vs=d:Vs.push.apply(Vs,d)}function LD(d){for(var v=d;;){if(v.flags&16384){var E=v.updateQueue;if(E!==null&&(E=E.stores,E!==null))for(var A=0;A<E.length;A++){var H=E[A],Y=H.getSnapshot;H=H.value;try{if(!ta(Y(),H))return!1}catch{return!1}}}if(E=v.child,v.subtreeFlags&16384&&E!==null)E.return=v,v=E;else{if(v===d)break;for(;v.sibling===null;){if(v.return===null||v.return===d)return!0;v=v.return}v.sibling.return=v.return,v=v.sibling}}return!0}function fd(d,v){for(v&=~kb,v&=~j0,d.suspendedLanes|=v,d.pingedLanes&=~v,d=d.expirationTimes;0<v;){var E=31-Ze(v),A=1<<E;d[E]=-1,v&=~A}}function JC(d){if((Vr&6)!==0)throw Error(r(327));up();var v=jr(d,0);if((v&1)===0)return Hs(d,on()),null;var E=V0(d,v);if(d.tag!==0&&E===2){var A=nr(d);A!==0&&(v=A,E=Tb(d,A))}if(E===1)throw E=Dm,Bf(d,0),fd(d,v),Hs(d,on()),E;if(E===6)throw Error(r(345));return d.finishedWork=d.current.alternate,d.finishedLanes=v,zf(d,Vs,tc),Hs(d,on()),null}function Pb(d,v){var E=Vr;Vr|=1;try{return d(v)}finally{Vr=E,Vr===0&&(lp=on()+500,Hc&&ou())}}function Ff(d){cd!==null&&cd.tag===0&&(Vr&6)===0&&up();var v=Vr;Vr|=1;var E=Vo.transition,A=wr;try{if(Vo.transition=null,wr=1,d)return d()}finally{wr=A,Vo.transition=E,Vr=v,(Vr&6)===0&&ou()}}function Mb(){po=op.current,pn(op)}function Bf(d,v){d.finishedWork=null,d.finishedLanes=0;var E=d.timeoutHandle;if(E!==-1&&(d.timeoutHandle=-1,Gn(E)),Ri!==null)for(E=Ri.return;E!==null;){var A=E;switch(Li(A),A.tag){case 1:A=A.type.childContextTypes,A!=null&&Vc();break;case 3:Tn(),pn(na),pn(Ui),aa();break;case 5:Cl(A);break;case 4:Tn();break;case 13:pn(mn);break;case 19:pn(mn);break;case 10:$h(A.type._context);break;case 22:case 23:Mb()}E=E.return}if(ua=d,Ri=d=hd(d.current,null),Da=po=v,Vi=0,Dm=null,kb=j0=jf=0,Vs=Im=null,Fo!==null){for(v=0;v<Fo.length;v++)if(E=Fo[v],A=E.interleaved,A!==null){E.interleaved=null;var H=A.next,Y=E.pending;if(Y!==null){var le=Y.next;Y.next=H,A.next=le}E.pending=A}Fo=null}return d}function eE(d,v){do{var E=Ri;try{if(qh(),Qc.current=nd,ho){for(var A=rn.memoizedState;A!==null;){var H=A.queue;H!==null&&(H.pending=null),A=A.next}ho=!1}if(La=0,oi=Wn=rn=null,fu=!1,Gs=0,Sb.current=null,E===null||E.return===null){Vi=1,Dm=v,Ri=null;break}e:{var Y=d,le=E.return,be=E,_e=v;if(v=Da,be.flags|=32768,_e!==null&&typeof _e=="object"&&typeof _e.then=="function"){var Be=_e,nt=be,ft=nt.tag;if((nt.mode&1)===0&&(ft===0||ft===11||ft===15)){var tt=nt.alternate;tt?(nt.updateQueue=tt.updateQueue,nt.memoizedState=tt.memoizedState,nt.lanes=tt.lanes):(nt.updateQueue=null,nt.memoizedState=null)}var Rt=M(le);if(Rt!==null){Rt.flags&=-257,B(Rt,le,be,Y,v),Rt.mode&1&&b(Y,Be,v),v=Rt,_e=Be;var Ut=v.updateQueue;if(Ut===null){var Ht=new Set;Ht.add(_e),v.updateQueue=Ht}else Ut.add(_e);break e}else{if((v&1)===0){b(Y,Be,v),Ab();break e}_e=Error(r(426))}}else if(Qr&&be.mode&1){var Ci=M(le);if(Ci!==null){(Ci.flags&65536)===0&&(Ci.flags|=256),B(Ci,le,be,Y,v),Mf(ec(_e,be));break e}}Y=_e=ec(_e,be),Vi!==4&&(Vi=2),Im===null?Im=[Y]:Im.push(Y),Y=le;do{switch(Y.tag){case 3:Y.flags|=65536,v&=-v,Y.lanes|=v;var Oe=R0(Y,_e,v);Of(Y,Oe);break e;case 1:be=_e;var Ce=Y.type,De=Y.stateNode;if((Y.flags&128)===0&&(typeof Ce.getDerivedStateFromError=="function"||De!==null&&typeof De.componentDidCatch=="function"&&(ud===null||!ud.has(De)))){Y.flags|=65536,v&=-v,Y.lanes|=v;var yt=x(Y,be,v);Of(Y,yt);break e}}Y=Y.return}while(Y!==null)}nE(E)}catch(qt){v=qt,Ri===E&&E!==null&&(Ri=E=E.return);continue}break}while(!0)}function tE(){var d=I0.current;return I0.current=nd,d===null?nd:d}function Ab(){(Vi===0||Vi===3||Vi===2)&&(Vi=4),ua===null||(jf&268435455)===0&&(j0&268435455)===0||fd(ua,Da)}function V0(d,v){var E=Vr;Vr|=2;var A=tE();(ua!==d||Da!==v)&&(tc=null,Bf(d,v));do try{RD();break}catch(H){eE(d,H)}while(!0);if(qh(),Vr=E,I0.current=A,Ri!==null)throw Error(r(261));return ua=null,Da=0,Vi}function RD(){for(;Ri!==null;)rE(Ri)}function OD(){for(;Ri!==null&&!Ou();)rE(Ri)}function rE(d){var v=sE(d.alternate,d,po);d.memoizedProps=d.pendingProps,v===null?nE(d):Ri=v,Sb.current=null}function nE(d){var v=d;do{var E=v.alternate;if(d=v.return,(v.flags&32768)===0){if(E=ED(E,v,po),E!==null){Ri=E;return}}else{if(E=TD(E,v),E!==null){E.flags&=32767,Ri=E;return}if(d!==null)d.flags|=32768,d.subtreeFlags=0,d.deletions=null;else{Vi=6,Ri=null;return}}if(v=v.sibling,v!==null){Ri=v;return}Ri=v=d}while(v!==null);Vi===0&&(Vi=5)}function zf(d,v,E){var A=wr,H=Vo.transition;try{Vo.transition=null,wr=1,DD(d,v,E,A)}finally{Vo.transition=H,wr=A}return null}function DD(d,v,E,A){do up();while(cd!==null);if((Vr&6)!==0)throw Error(r(327));E=d.finishedWork;var H=d.finishedLanes;if(E===null)return null;if(d.finishedWork=null,d.finishedLanes=0,E===d.current)throw Error(r(177));d.callbackNode=null,d.callbackPriority=0;var Y=E.lanes|E.childLanes;if(yn(d,Y),d===ua&&(Ri=ua=null,Da=0),(E.subtreeFlags&2064)===0&&(E.flags&2064)===0||B0||(B0=!0,oE(Yi,function(){return up(),null})),Y=(E.flags&15990)!==0,(E.subtreeFlags&15990)!==0||Y){Y=Vo.transition,Vo.transition=null;var le=wr;wr=1;var be=Vr;Vr|=4,Sb.current=null,PD(d,E),$C(E,d),ra(Xt),Iu=!!Nt,Xt=Nt=null,d.current=E,MD(E),_o(),Vr=be,wr=le,Vo.transition=Y}else d.current=E;if(B0&&(B0=!1,cd=d,z0=H),Y=d.pendingLanes,Y===0&&(ud=null),ht(E.stateNode),Hs(d,on()),v!==null)for(A=d.onRecoverableError,E=0;E<v.length;E++)H=v[E],A(H.value,{componentStack:H.stack,digest:H.digest});if(F0)throw F0=!1,d=Cb,Cb=null,d;return(z0&1)!==0&&d.tag!==0&&up(),Y=d.pendingLanes,(Y&1)!==0?d===Eb?jm++:(jm=0,Eb=d):jm=0,ou(),null}function up(){if(cd!==null){var d=ao(z0),v=Vo.transition,E=wr;try{if(Vo.transition=null,wr=16>d?16:d,cd===null)var A=!1;else{if(d=cd,cd=null,z0=0,(Vr&6)!==0)throw Error(r(331));var H=Vr;for(Vr|=4,jt=d.current;jt!==null;){var Y=jt,le=Y.child;if((jt.flags&16)!==0){var be=Y.deletions;if(be!==null){for(var _e=0;_e<be.length;_e++){var Be=be[_e];for(jt=Be;jt!==null;){var nt=jt;switch(nt.tag){case 0:case 11:case 15:Om(8,nt,Y)}var ft=nt.child;if(ft!==null)ft.return=nt,jt=ft;else for(;jt!==null;){nt=jt;var tt=nt.sibling,Rt=nt.return;if(GC(nt),nt===Be){jt=null;break}if(tt!==null){tt.return=Rt,jt=tt;break}jt=Rt}}}var Ut=Y.alternate;if(Ut!==null){var Ht=Ut.child;if(Ht!==null){Ut.child=null;do{var Ci=Ht.sibling;Ht.sibling=null,Ht=Ci}while(Ht!==null)}}jt=Y}}if((Y.subtreeFlags&2064)!==0&&le!==null)le.return=Y,jt=le;else e:for(;jt!==null;){if(Y=jt,(Y.flags&2048)!==0)switch(Y.tag){case 0:case 11:case 15:Om(9,Y,Y.return)}var Oe=Y.sibling;if(Oe!==null){Oe.return=Y.return,jt=Oe;break e}jt=Y.return}}var Ce=d.current;for(jt=Ce;jt!==null;){le=jt;var De=le.child;if((le.subtreeFlags&2064)!==0&&De!==null)De.return=le,jt=De;else e:for(le=Ce;jt!==null;){if(be=jt,(be.flags&2048)!==0)try{switch(be.tag){case 0:case 11:case 15:D0(9,be)}}catch(qt){ui(be,be.return,qt)}if(be===le){jt=null;break e}var yt=be.sibling;if(yt!==null){yt.return=be.return,jt=yt;break e}jt=be.return}}if(Vr=H,ou(),et&&typeof et.onPostCommitFiberRoot=="function")try{et.onPostCommitFiberRoot(Ye,d)}catch{}A=!0}return A}finally{wr=E,Vo.transition=v}}return!1}function iE(d,v,E){v=ec(E,v),v=R0(d,v,1),d=Uo(d,v,1),v=_s(),d!==null&&(en(d,1,v),Hs(d,v))}function ui(d,v,E){if(d.tag===3)iE(d,d,E);else for(;v!==null;){if(v.tag===3){iE(v,d,E);break}else if(v.tag===1){var A=v.stateNode;if(typeof v.type.getDerivedStateFromError=="function"||typeof A.componentDidCatch=="function"&&(ud===null||!ud.has(A))){d=ec(E,d),d=x(v,d,1),v=Uo(v,d,1),d=_s(),v!==null&&(en(v,1,d),Hs(v,d));break}}v=v.return}}function ID(d,v,E){var A=d.pingCache;A!==null&&A.delete(v),v=_s(),d.pingedLanes|=d.suspendedLanes&E,ua===d&&(Da&E)===E&&(Vi===4||Vi===3&&(Da&130023424)===Da&&500>on()-_b?Bf(d,0):kb|=E),Hs(d,v)}function aE(d,v){v===0&&((d.mode&1)===0?v=1:(v=vi,vi<<=1,(vi&130023424)===0&&(vi=4194304)));var E=_s();d=Ss(d,v),d!==null&&(en(d,v,E),Hs(d,E))}function jD(d){var v=d.memoizedState,E=0;v!==null&&(E=v.retryLane),aE(d,E)}function FD(d,v){var E=0;switch(d.tag){case 13:var A=d.stateNode,H=d.memoizedState;H!==null&&(E=H.retryLane);break;case 19:A=d.stateNode;break;default:throw Error(r(314))}A!==null&&A.delete(v),aE(d,E)}var sE;sE=function(d,v,E){if(d!==null)if(d.memoizedProps!==v.pendingProps||na.current)ee=!0;else{if((d.lanes&E)===0&&(v.flags&128)===0)return ee=!1,gb(d,v,E);ee=(d.flags&131072)!==0}else ee=!1,Qr&&(v.flags&1048576)!==0&&S0(v,uu,v.index);switch(v.lanes=0,v.tag){case 2:var A=v.type;Or(d,v),d=v.pendingProps;var H=Wu(v,Ui.current);_l(v,E),H=Jc(null,v,A,d,H,E);var Y=ed();return v.flags|=1,typeof H=="object"&&H!==null&&typeof H.render=="function"&&H.$$typeof===void 0?(v.tag=1,v.memoizedState=null,v.updateQueue=null,ia(A)?(Y=!0,qu(v)):Y=!1,v.memoizedState=H.state!==null&&H.state!==void 0?H.state:null,Rf(v),H.updater=sd,v.stateNode=H,H._reactInternals=v,ip(v,A,d,E),v=Jr(null,v,A,!0,Y,E)):(v.tag=0,Qr&&Y&&Wc(v),me(null,v,H,E),v=v.child),v;case 16:A=v.elementType;e:{switch(Or(d,v),d=v.pendingProps,H=A._init,A=H(A._payload),v.type=A,H=v.tag=zD(A),d=Gi(A,d),H){case 0:v=Mt(null,v,A,d,E);break e;case 1:v=gn(null,v,A,d,E);break e;case 11:v=Te(null,v,A,d,E);break e;case 14:v=ze(null,v,A,Gi(A.type,d),E);break e}throw Error(r(306,A,""))}return v;case 0:return A=v.type,H=v.pendingProps,H=v.elementType===A?H:Gi(A,H),Mt(d,v,A,H,E);case 1:return A=v.type,H=v.pendingProps,H=v.elementType===A?H:Gi(A,H),gn(d,v,A,H,E);case 3:e:{if(Ra(v),d===null)throw Error(r(387));A=v.pendingProps,Y=v.memoizedState,H=Y.element,Zh(d,v),Zc(v,A,null,E);var le=v.memoizedState;if(A=le.element,Y.isDehydrated)if(Y={element:A,isDehydrated:!1,cache:le.cache,pendingSuspenseBoundaries:le.pendingSuspenseBoundaries,transitions:le.transitions},v.updateQueue.baseState=Y,v.memoizedState=Y,v.flags&256){H=ec(Error(r(423)),v),v=Go(d,v,A,E,H);break e}else if(A!==H){H=ec(Error(r(424)),v),v=Go(d,v,A,E,H);break e}else for(kt=zs(v.stateNode.containerInfo.firstChild),xs=v,Qr=!0,bs=null,E=Us(v,null,A,E),v.child=E;E;)E.flags=E.flags&-3|4096,E=E.sibling;else{if(Yu(),A===H){v=la(d,v,E);break e}me(d,v,A,E)}v=v.child}return v;case 5:return Yc(v),d===null&&qc(v),A=v.type,H=v.pendingProps,Y=d!==null?d.memoizedProps:null,le=H.children,hr(A,H)?le=null:Y!==null&&hr(A,Y)&&(v.flags|=32),cr(d,v),me(d,v,le,E),v.child;case 6:return d===null&&qc(v),null;case 13:return He(d,v,E);case 4:return du(v,v.stateNode.containerInfo),A=v.pendingProps,d===null?v.child=Xu(v,null,A,E):me(d,v,A,E),v.child;case 11:return A=v.type,H=v.pendingProps,H=v.elementType===A?H:Gi(A,H),Te(d,v,A,H,E);case 7:return me(d,v,v.pendingProps,E),v.child;case 8:return me(d,v,v.pendingProps.children,E),v.child;case 12:return me(d,v,v.pendingProps.children,E),v.child;case 10:e:{if(A=v.type._context,H=v.pendingProps,Y=v.memoizedProps,le=H.value,un(Af,A._currentValue),A._currentValue=le,Y!==null)if(ta(Y.value,le)){if(Y.children===H.children&&!na.current){v=la(d,v,E);break e}}else for(Y=v.child,Y!==null&&(Y.return=v);Y!==null;){var be=Y.dependencies;if(be!==null){le=Y.child;for(var _e=be.firstContext;_e!==null;){if(_e.context===A){if(Y.tag===1){_e=zo(-1,E&-E),_e.tag=2;var Be=Y.updateQueue;if(Be!==null){Be=Be.shared;var nt=Be.pending;nt===null?_e.next=_e:(_e.next=nt.next,nt.next=_e),Be.pending=_e}}Y.lanes|=E,_e=Y.alternate,_e!==null&&(_e.lanes|=E),Kh(Y.return,E,v),be.lanes|=E;break}_e=_e.next}}else if(Y.tag===10)le=Y.type===v.type?null:Y.child;else if(Y.tag===18){if(le=Y.return,le===null)throw Error(r(341));le.lanes|=E,be=le.alternate,be!==null&&(be.lanes|=E),Kh(le,E,v),le=Y.sibling}else le=Y.child;if(le!==null)le.return=Y;else for(le=Y;le!==null;){if(le===v){le=null;break}if(Y=le.sibling,Y!==null){Y.return=le.return,le=Y;break}le=le.return}Y=le}me(d,v,H.children,E),v=v.child}return v;case 9:return H=v.type,A=v.pendingProps.children,_l(v,E),H=Aa(H),A=A(H),v.flags|=1,me(d,v,A,E),v.child;case 14:return A=v.type,H=Gi(A,v.pendingProps),H=Gi(A.type,H),ze(d,v,A,H,E);case 15:return gt(d,v,v.type,v.pendingProps,E);case 17:return A=v.type,H=v.pendingProps,H=v.elementType===A?H:Gi(A,H),Or(d,v),v.tag=1,ia(A)?(d=!0,qu(v)):d=!1,_l(v,E),L0(v,A,H),ip(v,A,H,E),Jr(null,v,A,!0,d,E);case 19:return _i(d,v,E);case 22:return It(d,v,E)}throw Error(r(156,v.tag))};function oE(d,v){return ko(d,v)}function BD(d,v,E,A){this.tag=d,this.key=E,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=v,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=A,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ho(d,v,E,A){return new BD(d,v,E,A)}function Lb(d){return d=d.prototype,!(!d||!d.isReactComponent)}function zD(d){if(typeof d=="function")return Lb(d)?1:0;if(d!=null){if(d=d.$$typeof,d===Z)return 11;if(d===U)return 14}return 2}function hd(d,v){var E=d.alternate;return E===null?(E=Ho(d.tag,v,d.key,d.mode),E.elementType=d.elementType,E.type=d.type,E.stateNode=d.stateNode,E.alternate=d,d.alternate=E):(E.pendingProps=v,E.type=d.type,E.flags=0,E.subtreeFlags=0,E.deletions=null),E.flags=d.flags&14680064,E.childLanes=d.childLanes,E.lanes=d.lanes,E.child=d.child,E.memoizedProps=d.memoizedProps,E.memoizedState=d.memoizedState,E.updateQueue=d.updateQueue,v=d.dependencies,E.dependencies=v===null?null:{lanes:v.lanes,firstContext:v.firstContext},E.sibling=d.sibling,E.index=d.index,E.ref=d.ref,E}function H0(d,v,E,A,H,Y){var le=2;if(A=d,typeof d=="function")Lb(d)&&(le=1);else if(typeof d=="string")le=5;else e:switch(d){case j:return Uf(E.children,H,Y,v);case O:le=8,H|=8;break;case F:return d=Ho(12,E,v,H|2),d.elementType=F,d.lanes=Y,d;case I:return d=Ho(13,E,v,H),d.elementType=I,d.lanes=Y,d;case W:return d=Ho(19,E,v,H),d.elementType=W,d.lanes=Y,d;case $:return W0(E,H,Y,v);default:if(typeof d=="object"&&d!==null)switch(d.$$typeof){case z:le=10;break e;case G:le=9;break e;case Z:le=11;break e;case U:le=14;break e;case K:le=16,A=null;break e}throw Error(r(130,d==null?d:typeof d,""))}return v=Ho(le,E,v,H),v.elementType=d,v.type=A,v.lanes=Y,v}function Uf(d,v,E,A){return d=Ho(7,d,A,v),d.lanes=E,d}function W0(d,v,E,A){return d=Ho(22,d,A,v),d.elementType=$,d.lanes=E,d.stateNode={isHidden:!1},d}function Rb(d,v,E){return d=Ho(6,d,null,v),d.lanes=E,d}function Ob(d,v,E){return v=Ho(4,d.children!==null?d.children:[],d.key,v),v.lanes=E,v.stateNode={containerInfo:d.containerInfo,pendingChildren:null,implementation:d.implementation},v}function UD(d,v,E,A,H){this.tag=v,this.containerInfo=d,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=rr(0),this.expirationTimes=rr(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=rr(0),this.identifierPrefix=A,this.onRecoverableError=H,this.mutableSourceEagerHydrationData=null}function Db(d,v,E,A,H,Y,le,be,_e){return d=new UD(d,v,E,be,_e),v===1?(v=1,Y===!0&&(v|=8)):v=0,Y=Ho(3,null,null,v),d.current=Y,Y.stateNode=d,Y.memoizedState={element:A,isDehydrated:E,cache:null,transitions:null,pendingSuspenseBoundaries:null},Rf(Y),d}function GD(d,v,E){var A=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:D,key:A==null?null:""+A,children:d,containerInfo:v,implementation:E}}function lE(d){if(!d)return Io;d=d._reactInternals;e:{if(ni(d)!==d||d.tag!==1)throw Error(r(170));var v=d;do{switch(v.tag){case 3:v=v.stateNode.context;break e;case 1:if(ia(v.type)){v=v.stateNode.__reactInternalMemoizedMergedChildContext;break e}}v=v.return}while(v!==null);throw Error(r(171))}if(d.tag===1){var E=d.type;if(ia(E))return Uh(d,E,v)}return v}function uE(d,v,E,A,H,Y,le,be,_e){return d=Db(E,A,!0,d,H,Y,le,be,_e),d.context=lE(null),E=d.current,A=_s(),H=dd(E),Y=zo(A,H),Y.callback=v??null,Uo(E,Y,H),d.current.lanes=H,en(d,H,A),Hs(d,A),d}function q0(d,v,E,A){var H=v.current,Y=_s(),le=dd(H);return E=lE(E),v.context===null?v.context=E:v.pendingContext=E,v=zo(Y,le),v.payload={element:d},A=A===void 0?null:A,A!==null&&(v.callback=A),d=Uo(H,v,le),d!==null&&(Ml(d,H,le,Y),Yh(d,H,le)),le}function $0(d){return d=d.current,d.child?(d.child.tag===5,d.child.stateNode):null}function cE(d,v){if(d=d.memoizedState,d!==null&&d.dehydrated!==null){var E=d.retryLane;d.retryLane=E!==0&&E<v?E:v}}function Ib(d,v){cE(d,v),(d=d.alternate)&&cE(d,v)}function VD(){return null}var dE=typeof reportError=="function"?reportError:function(d){console.error(d)};function jb(d){this._internalRoot=d}K0.prototype.render=jb.prototype.render=function(d){var v=this._internalRoot;if(v===null)throw Error(r(409));q0(d,v,null,null)},K0.prototype.unmount=jb.prototype.unmount=function(){var d=this._internalRoot;if(d!==null){this._internalRoot=null;var v=d.containerInfo;Ff(function(){q0(null,d,null,null)}),v[Gr]=null}};function K0(d){this._internalRoot=d}K0.prototype.unstable_scheduleHydration=function(d){if(d){var v=Tc();d={blockedOn:null,target:d,priority:v};for(var E=0;E<Jn.length&&v!==0&&v<Jn[E].priority;E++);Jn.splice(E,0,d),E===0&&Hl(d)}};function Fb(d){return!(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11)}function Z0(d){return!(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11&&(d.nodeType!==8||d.nodeValue!==" react-mount-point-unstable "))}function fE(){}function HD(d,v,E,A,H){if(H){if(typeof A=="function"){var Y=A;A=function(){var Be=$0(le);Y.call(Be)}}var le=uE(v,A,d,0,null,!1,!1,"",fE);return d._reactRootContainer=le,d[Gr]=le.current,Oo(d.nodeType===8?d.parentNode:d),Ff(),le}for(;H=d.lastChild;)d.removeChild(H);if(typeof A=="function"){var be=A;A=function(){var Be=$0(_e);be.call(Be)}}var _e=Db(d,0,!1,null,null,!1,!1,"",fE);return d._reactRootContainer=_e,d[Gr]=_e.current,Oo(d.nodeType===8?d.parentNode:d),Ff(function(){q0(v,_e,E,A)}),_e}function Y0(d,v,E,A,H){var Y=E._reactRootContainer;if(Y){var le=Y;if(typeof H=="function"){var be=H;H=function(){var _e=$0(le);be.call(_e)}}q0(v,le,d,H)}else le=HD(E,v,d,H,A);return $0(le)}Eo=function(d){switch(d.tag){case 3:var v=d.stateNode;if(v.current.memoizedState.isDehydrated){var E=zt(v.pendingLanes);E!==0&&(io(v,E|1),Hs(v,on()),(Vr&6)===0&&(lp=on()+500,ou()))}break;case 13:Ff(function(){var A=Ss(d,1);if(A!==null){var H=_s();Ml(A,d,1,H)}}),Ib(d,1)}},Rs=function(d){if(d.tag===13){var v=Ss(d,134217728);if(v!==null){var E=_s();Ml(v,d,134217728,E)}Ib(d,134217728)}},Ec=function(d){if(d.tag===13){var v=dd(d),E=Ss(d,v);if(E!==null){var A=_s();Ml(E,d,v,A)}Ib(d,v)}},Tc=function(){return wr},sl=function(d,v){var E=wr;try{return wr=d,v()}finally{wr=E}},wt=function(d,v,E){switch(v){case"input":if(rt(d,E),v=E.name,E.type==="radio"&&v!=null){for(E=d;E.parentNode;)E=E.parentNode;for(E=E.querySelectorAll("input[name="+JSON.stringify(""+v)+'][type="radio"]'),v=0;v<E.length;v++){var A=E[v];if(A!==d&&A.form===d.form){var H=si(A);if(!H)throw Error(r(90));xe(A),rt(A,H)}}}break;case"textarea":ot(d,E);break;case"select":v=E.value,v!=null&&ut(d,!!E.multiple,v,!1)}},vt=Pb,Et=Ff;var WD={usingClientEntryPoint:!1,Events:[wl,Vn,si,Wt,Ve,Pb]},Fm={findFiberByHostInstance:Do,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},qD={bundleType:Fm.bundleType,version:Fm.version,rendererPackageName:Fm.rendererPackageName,rendererConfig:Fm.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:N.ReactCurrentDispatcher,findHostInstanceByFiber:function(d){return d=Ls(d),d===null?null:d.stateNode},findFiberByHostInstance:Fm.findFiberByHostInstance||VD,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var X0=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!X0.isDisabled&&X0.supportsFiber)try{Ye=X0.inject(qD),et=X0}catch{}}return Ws.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=WD,Ws.createPortal=function(d,v){var E=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Fb(v))throw Error(r(200));return GD(d,v,null,E)},Ws.createRoot=function(d,v){if(!Fb(d))throw Error(r(299));var E=!1,A="",H=dE;return v!=null&&(v.unstable_strictMode===!0&&(E=!0),v.identifierPrefix!==void 0&&(A=v.identifierPrefix),v.onRecoverableError!==void 0&&(H=v.onRecoverableError)),v=Db(d,1,!1,null,null,E,!1,A,H),d[Gr]=v.current,Oo(d.nodeType===8?d.parentNode:d),new jb(v)},Ws.findDOMNode=function(d){if(d==null)return null;if(d.nodeType===1)return d;var v=d._reactInternals;if(v===void 0)throw typeof d.render=="function"?Error(r(188)):(d=Object.keys(d).join(","),Error(r(268,d)));return d=Ls(v),d=d===null?null:d.stateNode,d},Ws.flushSync=function(d){return Ff(d)},Ws.hydrate=function(d,v,E){if(!Z0(v))throw Error(r(200));return Y0(null,d,v,!0,E)},Ws.hydrateRoot=function(d,v,E){if(!Fb(d))throw Error(r(405));var A=E!=null&&E.hydratedSources||null,H=!1,Y="",le=dE;if(E!=null&&(E.unstable_strictMode===!0&&(H=!0),E.identifierPrefix!==void 0&&(Y=E.identifierPrefix),E.onRecoverableError!==void 0&&(le=E.onRecoverableError)),v=uE(v,null,d,1,E??null,H,!1,Y,le),d[Gr]=v.current,Oo(d),A)for(d=0;d<A.length;d++)E=A[d],H=E._getVersion,H=H(E._source),v.mutableSourceEagerHydrationData==null?v.mutableSourceEagerHydrationData=[E,H]:v.mutableSourceEagerHydrationData.push(E,H);return new K0(v)},Ws.render=function(d,v,E){if(!Z0(v))throw Error(r(200));return Y0(null,d,v,!1,E)},Ws.unmountComponentAtNode=function(d){if(!Z0(d))throw Error(r(40));return d._reactRootContainer?(Ff(function(){Y0(null,null,d,!1,function(){d._reactRootContainer=null,d[Gr]=null})}),!0):!1},Ws.unstable_batchedUpdates=Pb,Ws.unstable_renderSubtreeIntoContainer=function(d,v,E,A){if(!Z0(E))throw Error(r(200));if(d==null||d._reactInternals===void 0)throw Error(r(38));return Y0(d,v,E,!1,A)},Ws.version="18.3.1-next-f1338f8080-20240426",Ws}var wE;function mM(){if(wE)return Ub.exports;wE=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),Ub.exports=t8(),Ub.exports}var SE;function r8(){if(SE)return Q0;SE=1;var t=mM();return Q0.createRoot=t.createRoot,Q0.hydrateRoot=t.hydrateRoot,Q0}var n8=r8();const i8=Th(n8);var eo=mM();const a8=Th(eo);function xv(){return xv=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},xv.apply(this,arguments)}var Ld;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(Ld||(Ld={}));const kE="popstate";function s8(t){t===void 0&&(t={});function e(n,i){let{pathname:a,search:s,hash:o}=n.location;return RS("",{pathname:a,search:s,hash:o},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function r(n,i){return typeof i=="string"?i:ax(i)}return l8(e,r,null,t)}function fi(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function Xk(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function o8(){return Math.random().toString(36).substr(2,8)}function _E(t,e){return{usr:t.state,key:t.key,idx:e}}function RS(t,e,r,n){return r===void 0&&(r=null),xv({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof e=="string"?sm(e):e,{state:r,key:e&&e.key||n||o8()})}function ax(t){let{pathname:e="/",search:r="",hash:n=""}=t;return r&&r!=="?"&&(e+=r.charAt(0)==="?"?r:"?"+r),n&&n!=="#"&&(e+=n.charAt(0)==="#"?n:"#"+n),e}function sm(t){let e={};if(t){let r=t.indexOf("#");r>=0&&(e.hash=t.substr(r),t=t.substr(0,r));let n=t.indexOf("?");n>=0&&(e.search=t.substr(n),t=t.substr(0,n)),t&&(e.pathname=t)}return e}function l8(t,e,r,n){n===void 0&&(n={});let{window:i=document.defaultView,v5Compat:a=!1}=n,s=i.history,o=Ld.Pop,l=null,u=c();u==null&&(u=0,s.replaceState(xv({},s.state,{idx:u}),""));function c(){return(s.state||{idx:null}).idx}function f(){o=Ld.Pop;let w=c(),C=w==null?null:w-u;u=w,l&&l({action:o,location:S.location,delta:C})}function p(w,C){o=Ld.Push;let _=RS(S.location,w,C);u=c()+1;let T=_E(_,u),N=S.createHref(_);try{s.pushState(T,"",N)}catch(R){if(R instanceof DOMException&&R.name==="DataCloneError")throw R;i.location.assign(N)}a&&l&&l({action:o,location:S.location,delta:1})}function g(w,C){o=Ld.Replace;let _=RS(S.location,w,C);u=c();let T=_E(_,u),N=S.createHref(_);s.replaceState(T,"",N),a&&l&&l({action:o,location:S.location,delta:0})}function y(w){let C=i.location.origin!=="null"?i.location.origin:i.location.href,_=typeof w=="string"?w:ax(w);return _=_.replace(/ $/,"%20"),fi(C,"No window.location.(origin|href) available to create URL for href: "+_),new URL(_,C)}let S={get action(){return o},get location(){return t(i,s)},listen(w){if(l)throw new Error("A history only accepts one active listener");return i.addEventListener(kE,f),l=w,()=>{i.removeEventListener(kE,f),l=null}},createHref(w){return e(i,w)},createURL:y,encodeLocation(w){let C=y(w);return{pathname:C.pathname,search:C.search,hash:C.hash}},push:p,replace:g,go(w){return s.go(w)}};return S}var CE;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(CE||(CE={}));function u8(t,e,r){return r===void 0&&(r="/"),c8(t,e,r)}function c8(t,e,r,n){let i=typeof e=="string"?sm(e):e,a=Vp(i.pathname||"/",r);if(a==null)return null;let s=gM(t);d8(s);let o=null;for(let l=0;o==null&&l<s.length;++l){let u=S8(a);o=b8(s[l],u)}return o}function gM(t,e,r,n){e===void 0&&(e=[]),r===void 0&&(r=[]),n===void 0&&(n="");let i=(a,s,o)=>{let l={relativePath:o===void 0?a.path||"":o,caseSensitive:a.caseSensitive===!0,childrenIndex:s,route:a};l.relativePath.startsWith("/")&&(fi(l.relativePath.startsWith(n),'Absolute route path "'+l.relativePath+'" nested under path '+('"'+n+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),l.relativePath=l.relativePath.slice(n.length));let u=zd([n,l.relativePath]),c=r.concat(l);a.children&&a.children.length>0&&(fi(a.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+u+'".')),gM(a.children,e,c,u)),!(a.path==null&&!a.index)&&e.push({path:u,score:y8(u,a.index),routesMeta:c})};return t.forEach((a,s)=>{var o;if(a.path===""||!((o=a.path)!=null&&o.includes("?")))i(a,s);else for(let l of vM(a.path))i(a,s,l)}),e}function vM(t){let e=t.split("/");if(e.length===0)return[];let[r,...n]=e,i=r.endsWith("?"),a=r.replace(/\?$/,"");if(n.length===0)return i?[a,""]:[a];let s=vM(n.join("/")),o=[];return o.push(...s.map(l=>l===""?a:[a,l].join("/"))),i&&o.push(...s),o.map(l=>t.startsWith("/")&&l===""?"/":l)}function d8(t){t.sort((e,r)=>e.score!==r.score?r.score-e.score:x8(e.routesMeta.map(n=>n.childrenIndex),r.routesMeta.map(n=>n.childrenIndex)))}const f8=/^:[\w-]+$/,h8=3,p8=2,m8=1,g8=10,v8=-2,EE=t=>t==="*";function y8(t,e){let r=t.split("/"),n=r.length;return r.some(EE)&&(n+=v8),e&&(n+=p8),r.filter(i=>!EE(i)).reduce((i,a)=>i+(f8.test(a)?h8:a===""?m8:g8),n)}function x8(t,e){return t.length===e.length&&t.slice(0,-1).every((n,i)=>n===e[i])?t[t.length-1]-e[e.length-1]:0}function b8(t,e,r){let{routesMeta:n}=t,i={},a="/",s=[];for(let o=0;o<n.length;++o){let l=n[o],u=o===n.length-1,c=a==="/"?e:e.slice(a.length)||"/",f=OS({path:l.relativePath,caseSensitive:l.caseSensitive,end:u},c),p=l.route;if(!f)return null;Object.assign(i,f.params),s.push({params:i,pathname:zd([a,f.pathname]),pathnameBase:T8(zd([a,f.pathnameBase])),route:p}),f.pathnameBase!=="/"&&(a=zd([a,f.pathnameBase]))}return s}function OS(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[r,n]=w8(t.path,t.caseSensitive,t.end),i=e.match(r);if(!i)return null;let a=i[0],s=a.replace(/(.)\/+$/,"$1"),o=i.slice(1);return{params:n.reduce((u,c,f)=>{let{paramName:p,isOptional:g}=c;if(p==="*"){let S=o[f]||"";s=a.slice(0,a.length-S.length).replace(/(.)\/+$/,"$1")}const y=o[f];return g&&!y?u[p]=void 0:u[p]=(y||"").replace(/%2F/g,"/"),u},{}),pathname:a,pathnameBase:s,pattern:t}}function w8(t,e,r){e===void 0&&(e=!1),r===void 0&&(r=!0),Xk(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let n=[],i="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(s,o,l)=>(n.push({paramName:o,isOptional:l!=null}),l?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(n.push({paramName:"*"}),i+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):r?i+="\\/*$":t!==""&&t!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,e?void 0:"i"),n]}function S8(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Xk(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),t}}function Vp(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let r=e.endsWith("/")?e.length-1:e.length,n=t.charAt(r);return n&&n!=="/"?null:t.slice(r)||"/"}const k8=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,_8=t=>k8.test(t);function C8(t,e){e===void 0&&(e="/");let{pathname:r,search:n="",hash:i=""}=typeof t=="string"?sm(t):t,a;if(r)if(_8(r))a=r;else{if(r.includes("//")){let s=r;r=r.replace(/\/\/+/g,"/"),Xk(!1,"Pathnames cannot have embedded double slashes - normalizing "+(s+" -> "+r))}r.startsWith("/")?a=TE(r.substring(1),"/"):a=TE(r,e)}else a=e;return{pathname:a,search:N8(n),hash:P8(i)}}function TE(t,e){let r=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(i=>{i===".."?r.length>1&&r.pop():i!=="."&&r.push(i)}),r.length>1?r.join("/"):"/"}function Hb(t,e,r,n){return"Cannot include a '"+t+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(n)+"].  Please separate it out to the ")+("`to."+r+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function E8(t){return t.filter((e,r)=>r===0||e.route.path&&e.route.path.length>0)}function yM(t,e){let r=E8(t);return e?r.map((n,i)=>i===r.length-1?n.pathname:n.pathnameBase):r.map(n=>n.pathnameBase)}function xM(t,e,r,n){n===void 0&&(n=!1);let i;typeof t=="string"?i=sm(t):(i=xv({},t),fi(!i.pathname||!i.pathname.includes("?"),Hb("?","pathname","search",i)),fi(!i.pathname||!i.pathname.includes("#"),Hb("#","pathname","hash",i)),fi(!i.search||!i.search.includes("#"),Hb("#","search","hash",i)));let a=t===""||i.pathname==="",s=a?"/":i.pathname,o;if(s==null)o=r;else{let f=e.length-1;if(!n&&s.startsWith("..")){let p=s.split("/");for(;p[0]==="..";)p.shift(),f-=1;i.pathname=p.join("/")}o=f>=0?e[f]:"/"}let l=C8(i,o),u=s&&s!=="/"&&s.endsWith("/"),c=(a||s===".")&&r.endsWith("/");return!l.pathname.endsWith("/")&&(u||c)&&(l.pathname+="/"),l}const zd=t=>t.join("/").replace(/\/\/+/g,"/"),T8=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),N8=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,P8=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function M8(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}const bM=["post","put","patch","delete"];new Set(bM);const A8=["get",...bM];new Set(A8);function bv(){return bv=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},bv.apply(this,arguments)}const S1=ne.createContext(null),wM=ne.createContext(null),nf=ne.createContext(null),k1=ne.createContext(null),wc=ne.createContext({outlet:null,matches:[],isDataRoute:!1}),SM=ne.createContext(null);function L8(t,e){let{relative:r}=e===void 0?{}:e;Kv()||fi(!1);let{basename:n,navigator:i}=ne.useContext(nf),{hash:a,pathname:s,search:o}=_1(t,{relative:r}),l=s;return n!=="/"&&(l=s==="/"?n:zd([n,s])),i.createHref({pathname:l,search:o,hash:a})}function Kv(){return ne.useContext(k1)!=null}function af(){return Kv()||fi(!1),ne.useContext(k1).location}function kM(t){ne.useContext(nf).static||ne.useLayoutEffect(t)}function Ga(){let{isDataRoute:t}=ne.useContext(wc);return t?q8():R8()}function R8(){Kv()||fi(!1);let t=ne.useContext(S1),{basename:e,future:r,navigator:n}=ne.useContext(nf),{matches:i}=ne.useContext(wc),{pathname:a}=af(),s=JSON.stringify(yM(i,r.v7_relativeSplatPath)),o=ne.useRef(!1);return kM(()=>{o.current=!0}),ne.useCallback(function(u,c){if(c===void 0&&(c={}),!o.current)return;if(typeof u=="number"){n.go(u);return}let f=xM(u,JSON.parse(s),a,c.relative==="path");t==null&&e!=="/"&&(f.pathname=f.pathname==="/"?e:zd([e,f.pathname])),(c.replace?n.replace:n.push)(f,c.state,c)},[e,n,s,a,t])}const _M=ne.createContext(null);function bo(){return ne.useContext(_M)}function O8(t){let e=ne.useContext(wc).outlet;return e&&ne.createElement(_M.Provider,{value:t},e)}function Va(){let{matches:t}=ne.useContext(wc),e=t[t.length-1];return e?e.params:{}}function _1(t,e){let{relative:r}=e===void 0?{}:e,{future:n}=ne.useContext(nf),{matches:i}=ne.useContext(wc),{pathname:a}=af(),s=JSON.stringify(yM(i,n.v7_relativeSplatPath));return ne.useMemo(()=>xM(t,JSON.parse(s),a,r==="path"),[t,s,a,r])}function D8(t,e){return I8(t,e)}function I8(t,e,r,n){Kv()||fi(!1);let{navigator:i}=ne.useContext(nf),{matches:a}=ne.useContext(wc),s=a[a.length-1],o=s?s.params:{};s&&s.pathname;let l=s?s.pathnameBase:"/";s&&s.route;let u=af(),c;if(e){var f;let w=typeof e=="string"?sm(e):e;l==="/"||(f=w.pathname)!=null&&f.startsWith(l)||fi(!1),c=w}else c=u;let p=c.pathname||"/",g=p;if(l!=="/"){let w=l.replace(/^\//,"").split("/");g="/"+p.replace(/^\//,"").split("/").slice(w.length).join("/")}let y=u8(t,{pathname:g}),S=U8(y&&y.map(w=>Object.assign({},w,{params:Object.assign({},o,w.params),pathname:zd([l,i.encodeLocation?i.encodeLocation(w.pathname).pathname:w.pathname]),pathnameBase:w.pathnameBase==="/"?l:zd([l,i.encodeLocation?i.encodeLocation(w.pathnameBase).pathname:w.pathnameBase])})),a,r,n);return e&&S?ne.createElement(k1.Provider,{value:{location:bv({pathname:"/",search:"",hash:"",state:null,key:"default"},c),navigationType:Ld.Pop}},S):S}function j8(){let t=W8(),e=M8(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),r=t instanceof Error?t.stack:null,i={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return ne.createElement(ne.Fragment,null,ne.createElement("h2",null,"Unexpected Application Error!"),ne.createElement("h3",{style:{fontStyle:"italic"}},e),r?ne.createElement("pre",{style:i},r):null,null)}const F8=ne.createElement(j8,null);class B8 extends ne.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,r){return r.location!==e.location||r.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:r.error,location:r.location,revalidation:e.revalidation||r.revalidation}}componentDidCatch(e,r){console.error("React Router caught the following error during render",e,r)}render(){return this.state.error!==void 0?ne.createElement(wc.Provider,{value:this.props.routeContext},ne.createElement(SM.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function z8(t){let{routeContext:e,match:r,children:n}=t,i=ne.useContext(S1);return i&&i.static&&i.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=r.route.id),ne.createElement(wc.Provider,{value:e},n)}function U8(t,e,r,n){var i;if(e===void 0&&(e=[]),r===void 0&&(r=null),n===void 0&&(n=null),t==null){var a;if(!r)return null;if(r.errors)t=r.matches;else if((a=n)!=null&&a.v7_partialHydration&&e.length===0&&!r.initialized&&r.matches.length>0)t=r.matches;else return null}let s=t,o=(i=r)==null?void 0:i.errors;if(o!=null){let c=s.findIndex(f=>f.route.id&&o?.[f.route.id]!==void 0);c>=0||fi(!1),s=s.slice(0,Math.min(s.length,c+1))}let l=!1,u=-1;if(r&&n&&n.v7_partialHydration)for(let c=0;c<s.length;c++){let f=s[c];if((f.route.HydrateFallback||f.route.hydrateFallbackElement)&&(u=c),f.route.id){let{loaderData:p,errors:g}=r,y=f.route.loader&&p[f.route.id]===void 0&&(!g||g[f.route.id]===void 0);if(f.route.lazy||y){l=!0,u>=0?s=s.slice(0,u+1):s=[s[0]];break}}}return s.reduceRight((c,f,p)=>{let g,y=!1,S=null,w=null;r&&(g=o&&f.route.id?o[f.route.id]:void 0,S=f.route.errorElement||F8,l&&(u<0&&p===0?($8("route-fallback"),y=!0,w=null):u===p&&(y=!0,w=f.route.hydrateFallbackElement||null)));let C=e.concat(s.slice(0,p+1)),_=()=>{let T;return g?T=S:y?T=w:f.route.Component?T=ne.createElement(f.route.Component,null):f.route.element?T=f.route.element:T=c,ne.createElement(z8,{match:f,routeContext:{outlet:c,matches:C,isDataRoute:r!=null},children:T})};return r&&(f.route.ErrorBoundary||f.route.errorElement||p===0)?ne.createElement(B8,{location:r.location,revalidation:r.revalidation,component:S,error:g,children:_(),routeContext:{outlet:null,matches:C,isDataRoute:!0}}):_()},null)}var CM=(function(t){return t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t})(CM||{}),EM=(function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t})(EM||{});function G8(t){let e=ne.useContext(S1);return e||fi(!1),e}function V8(t){let e=ne.useContext(wM);return e||fi(!1),e}function H8(t){let e=ne.useContext(wc);return e||fi(!1),e}function TM(t){let e=H8(),r=e.matches[e.matches.length-1];return r.route.id||fi(!1),r.route.id}function W8(){var t;let e=ne.useContext(SM),r=V8(),n=TM();return e!==void 0?e:(t=r.errors)==null?void 0:t[n]}function q8(){let{router:t}=G8(CM.UseNavigateStable),e=TM(EM.UseNavigateStable),r=ne.useRef(!1);return kM(()=>{r.current=!0}),ne.useCallback(function(i,a){a===void 0&&(a={}),r.current&&(typeof i=="number"?t.navigate(i):t.navigate(i,bv({fromRouteId:e},a)))},[t,e])}const NE={};function $8(t,e,r){NE[t]||(NE[t]=!0)}function K8(t,e){t?.v7_startTransition,t?.v7_relativeSplatPath}function sx(t){return O8(t.context)}function qn(t){fi(!1)}function Z8(t){let{basename:e="/",children:r=null,location:n,navigationType:i=Ld.Pop,navigator:a,static:s=!1,future:o}=t;Kv()&&fi(!1);let l=e.replace(/^\/*/,"/"),u=ne.useMemo(()=>({basename:l,navigator:a,static:s,future:bv({v7_relativeSplatPath:!1},o)}),[l,o,a,s]);typeof n=="string"&&(n=sm(n));let{pathname:c="/",search:f="",hash:p="",state:g=null,key:y="default"}=n,S=ne.useMemo(()=>{let w=Vp(c,l);return w==null?null:{location:{pathname:w,search:f,hash:p,state:g,key:y},navigationType:i}},[l,c,f,p,g,y,i]);return S==null?null:ne.createElement(nf.Provider,{value:u},ne.createElement(k1.Provider,{children:r,value:S}))}function Y8(t){let{children:e,location:r}=t;return D8(DS(e),r)}new Promise(()=>{});function DS(t,e){e===void 0&&(e=[]);let r=[];return ne.Children.forEach(t,(n,i)=>{if(!ne.isValidElement(n))return;let a=[...e,i];if(n.type===ne.Fragment){r.push.apply(r,DS(n.props.children,a));return}n.type!==qn&&fi(!1),!n.props.index||!n.props.children||fi(!1);let s={id:n.props.id||a.join("-"),caseSensitive:n.props.caseSensitive,element:n.props.element,Component:n.props.Component,index:n.props.index,path:n.props.path,loader:n.props.loader,action:n.props.action,errorElement:n.props.errorElement,ErrorBoundary:n.props.ErrorBoundary,hasErrorBoundary:n.props.ErrorBoundary!=null||n.props.errorElement!=null,shouldRevalidate:n.props.shouldRevalidate,handle:n.props.handle,lazy:n.props.lazy};n.props.children&&(s.children=DS(n.props.children,a)),r.push(s)}),r}function ox(){return ox=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},ox.apply(this,arguments)}function NM(t,e){if(t==null)return{};var r={},n=Object.keys(t),i,a;for(a=0;a<n.length;a++)i=n[a],!(e.indexOf(i)>=0)&&(r[i]=t[i]);return r}function X8(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function Q8(t,e){return t.button===0&&(!e||e==="_self")&&!X8(t)}function IS(t){return t===void 0&&(t=""),new URLSearchParams(typeof t=="string"||Array.isArray(t)||t instanceof URLSearchParams?t:Object.keys(t).reduce((e,r)=>{let n=t[r];return e.concat(Array.isArray(n)?n.map(i=>[r,i]):[[r,n]])},[]))}function J8(t,e){let r=IS(t);return e&&e.forEach((n,i)=>{r.has(i)||e.getAll(i).forEach(a=>{r.append(i,a)})}),r}const eI=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],tI=["aria-current","caseSensitive","className","end","style","to","viewTransition","children"],rI="6";try{window.__reactRouterVersion=rI}catch{}const nI=ne.createContext({isTransitioning:!1}),iI="startTransition",PE=JD[iI];function aI(t){let{basename:e,children:r,future:n,window:i}=t,a=ne.useRef();a.current==null&&(a.current=s8({window:i,v5Compat:!0}));let s=a.current,[o,l]=ne.useState({action:s.action,location:s.location}),{v7_startTransition:u}=n||{},c=ne.useCallback(f=>{u&&PE?PE(()=>l(f)):l(f)},[l,u]);return ne.useLayoutEffect(()=>s.listen(c),[s,c]),ne.useEffect(()=>K8(n),[n]),ne.createElement(Z8,{basename:e,children:r,location:o.location,navigationType:o.action,navigator:s,future:n})}const sI=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",oI=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,hh=ne.forwardRef(function(e,r){let{onClick:n,relative:i,reloadDocument:a,replace:s,state:o,target:l,to:u,preventScrollReset:c,viewTransition:f}=e,p=NM(e,eI),{basename:g}=ne.useContext(nf),y,S=!1;if(typeof u=="string"&&oI.test(u)&&(y=u,sI))try{let T=new URL(window.location.href),N=u.startsWith("//")?new URL(T.protocol+u):new URL(u),R=Vp(N.pathname,g);N.origin===T.origin&&R!=null?u=R+N.search+N.hash:S=!0}catch{}let w=L8(u,{relative:i}),C=cI(u,{replace:s,state:o,target:l,preventScrollReset:c,relative:i,viewTransition:f});function _(T){n&&n(T),T.defaultPrevented||C(T)}return ne.createElement("a",ox({},p,{href:y||w,onClick:S||a?n:_,ref:r,target:l}))}),lI=ne.forwardRef(function(e,r){let{"aria-current":n="page",caseSensitive:i=!1,className:a="",end:s=!1,style:o,to:l,viewTransition:u,children:c}=e,f=NM(e,tI),p=_1(l,{relative:f.relative}),g=af(),y=ne.useContext(wM),{navigator:S,basename:w}=ne.useContext(nf),C=y!=null&&fI(p)&&u===!0,_=S.encodeLocation?S.encodeLocation(p).pathname:p.pathname,T=g.pathname,N=y&&y.navigation&&y.navigation.location?y.navigation.location.pathname:null;i||(T=T.toLowerCase(),N=N?N.toLowerCase():null,_=_.toLowerCase()),N&&w&&(N=Vp(N,w)||N);const R=_!=="/"&&_.endsWith("/")?_.length-1:_.length;let D=T===_||!s&&T.startsWith(_)&&T.charAt(R)==="/",j=N!=null&&(N===_||!s&&N.startsWith(_)&&N.charAt(_.length)==="/"),O={isActive:D,isPending:j,isTransitioning:C},F=D?n:void 0,z;typeof a=="function"?z=a(O):z=[a,D?"active":null,j?"pending":null,C?"transitioning":null].filter(Boolean).join(" ");let G=typeof o=="function"?o(O):o;return ne.createElement(hh,ox({},f,{"aria-current":F,className:z,ref:r,style:G,to:l,viewTransition:u}),typeof c=="function"?c(O):c)});var jS;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher",t.useViewTransitionState="useViewTransitionState"})(jS||(jS={}));var ME;(function(t){t.UseFetcher="useFetcher",t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(ME||(ME={}));function uI(t){let e=ne.useContext(S1);return e||fi(!1),e}function cI(t,e){let{target:r,replace:n,state:i,preventScrollReset:a,relative:s,viewTransition:o}=e===void 0?{}:e,l=Ga(),u=af(),c=_1(t,{relative:s});return ne.useCallback(f=>{if(Q8(f,r)){f.preventDefault();let p=n!==void 0?n:ax(u)===ax(c);l(t,{replace:p,state:i,preventScrollReset:a,relative:s,viewTransition:o})}},[u,l,c,n,i,r,t,a,s,o])}function dI(t){let e=ne.useRef(IS(t)),r=ne.useRef(!1),n=af(),i=ne.useMemo(()=>J8(n.search,r.current?null:e.current),[n.search]),a=Ga(),s=ne.useCallback((o,l)=>{const u=IS(typeof o=="function"?o(i):o);r.current=!0,a("?"+u,l)},[a,i]);return[i,s]}function fI(t,e){e===void 0&&(e={});let r=ne.useContext(nI);r==null&&fi(!1);let{basename:n}=uI(jS.useViewTransitionState),i=_1(t,{relative:e.relative});if(!r.isTransitioning)return!1;let a=Vp(r.currentLocation.pathname,n)||r.currentLocation.pathname,s=Vp(r.nextLocation.pathname,n)||r.nextLocation.pathname;return OS(i.pathname,s)!=null||OS(i.pathname,a)!=null}const Qk="-",hI=t=>{const e=mI(t),{conflictingClassGroups:r,conflictingClassGroupModifiers:n}=t;return{getClassGroupId:s=>{const o=s.split(Qk);return o[0]===""&&o.length!==1&&o.shift(),PM(o,e)||pI(s)},getConflictingClassGroupIds:(s,o)=>{const l=r[s]||[];return o&&n[s]?[...l,...n[s]]:l}}},PM=(t,e)=>{if(t.length===0)return e.classGroupId;const r=t[0],n=e.nextPart.get(r),i=n?PM(t.slice(1),n):void 0;if(i)return i;if(e.validators.length===0)return;const a=t.join(Qk);return e.validators.find(({validator:s})=>s(a))?.classGroupId},AE=/^\[(.+)\]$/,pI=t=>{if(AE.test(t)){const e=AE.exec(t)[1],r=e?.substring(0,e.indexOf(":"));if(r)return"arbitrary.."+r}},mI=t=>{const{theme:e,prefix:r}=t,n={nextPart:new Map,validators:[]};return vI(Object.entries(t.classGroups),r).forEach(([a,s])=>{FS(s,n,a,e)}),n},FS=(t,e,r,n)=>{t.forEach(i=>{if(typeof i=="string"){const a=i===""?e:LE(e,i);a.classGroupId=r;return}if(typeof i=="function"){if(gI(i)){FS(i(n),e,r,n);return}e.validators.push({validator:i,classGroupId:r});return}Object.entries(i).forEach(([a,s])=>{FS(s,LE(e,a),r,n)})})},LE=(t,e)=>{let r=t;return e.split(Qk).forEach(n=>{r.nextPart.has(n)||r.nextPart.set(n,{nextPart:new Map,validators:[]}),r=r.nextPart.get(n)}),r},gI=t=>t.isThemeGetter,vI=(t,e)=>e?t.map(([r,n])=>{const i=n.map(a=>typeof a=="string"?e+a:typeof a=="object"?Object.fromEntries(Object.entries(a).map(([s,o])=>[e+s,o])):a);return[r,i]}):t,yI=t=>{if(t<1)return{get:()=>{},set:()=>{}};let e=0,r=new Map,n=new Map;const i=(a,s)=>{r.set(a,s),e++,e>t&&(e=0,n=r,r=new Map)};return{get(a){let s=r.get(a);if(s!==void 0)return s;if((s=n.get(a))!==void 0)return i(a,s),s},set(a,s){r.has(a)?r.set(a,s):i(a,s)}}},MM="!",xI=t=>{const{separator:e,experimentalParseClassName:r}=t,n=e.length===1,i=e[0],a=e.length,s=o=>{const l=[];let u=0,c=0,f;for(let w=0;w<o.length;w++){let C=o[w];if(u===0){if(C===i&&(n||o.slice(w,w+a)===e)){l.push(o.slice(c,w)),c=w+a;continue}if(C==="/"){f=w;continue}}C==="["?u++:C==="]"&&u--}const p=l.length===0?o:o.substring(c),g=p.startsWith(MM),y=g?p.substring(1):p,S=f&&f>c?f-c:void 0;return{modifiers:l,hasImportantModifier:g,baseClassName:y,maybePostfixModifierPosition:S}};return r?o=>r({className:o,parseClassName:s}):s},bI=t=>{if(t.length<=1)return t;const e=[];let r=[];return t.forEach(n=>{n[0]==="["?(e.push(...r.sort(),n),r=[]):r.push(n)}),e.push(...r.sort()),e},wI=t=>({cache:yI(t.cacheSize),parseClassName:xI(t),...hI(t)}),SI=/\s+/,kI=(t,e)=>{const{parseClassName:r,getClassGroupId:n,getConflictingClassGroupIds:i}=e,a=[],s=t.trim().split(SI);let o="";for(let l=s.length-1;l>=0;l-=1){const u=s[l],{modifiers:c,hasImportantModifier:f,baseClassName:p,maybePostfixModifierPosition:g}=r(u);let y=!!g,S=n(y?p.substring(0,g):p);if(!S){if(!y){o=u+(o.length>0?" "+o:o);continue}if(S=n(p),!S){o=u+(o.length>0?" "+o:o);continue}y=!1}const w=bI(c).join(":"),C=f?w+MM:w,_=C+S;if(a.includes(_))continue;a.push(_);const T=i(S,y);for(let N=0;N<T.length;++N){const R=T[N];a.push(C+R)}o=u+(o.length>0?" "+o:o)}return o};function _I(){let t=0,e,r,n="";for(;t<arguments.length;)(e=arguments[t++])&&(r=AM(e))&&(n&&(n+=" "),n+=r);return n}const AM=t=>{if(typeof t=="string")return t;let e,r="";for(let n=0;n<t.length;n++)t[n]&&(e=AM(t[n]))&&(r&&(r+=" "),r+=e);return r};function CI(t,...e){let r,n,i,a=s;function s(l){const u=e.reduce((c,f)=>f(c),t());return r=wI(u),n=r.cache.get,i=r.cache.set,a=o,o(l)}function o(l){const u=n(l);if(u)return u;const c=kI(l,r);return i(l,c),c}return function(){return a(_I.apply(null,arguments))}}const Rn=t=>{const e=r=>r[t]||[];return e.isThemeGetter=!0,e},LM=/^\[(?:([a-z-]+):)?(.+)\]$/i,EI=/^\d+\/\d+$/,TI=new Set(["px","full","screen"]),NI=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,PI=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,MI=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,AI=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,LI=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,rc=t=>Dp(t)||TI.has(t)||EI.test(t),md=t=>om(t,"length",zI),Dp=t=>!!t&&!Number.isNaN(Number(t)),Wb=t=>om(t,"number",Dp),zm=t=>!!t&&Number.isInteger(Number(t)),RI=t=>t.endsWith("%")&&Dp(t.slice(0,-1)),br=t=>LM.test(t),gd=t=>NI.test(t),OI=new Set(["length","size","percentage"]),DI=t=>om(t,OI,RM),II=t=>om(t,"position",RM),jI=new Set(["image","url"]),FI=t=>om(t,jI,GI),BI=t=>om(t,"",UI),Um=()=>!0,om=(t,e,r)=>{const n=LM.exec(t);return n?n[1]?typeof e=="string"?n[1]===e:e.has(n[1]):r(n[2]):!1},zI=t=>PI.test(t)&&!MI.test(t),RM=()=>!1,UI=t=>AI.test(t),GI=t=>LI.test(t),VI=()=>{const t=Rn("colors"),e=Rn("spacing"),r=Rn("blur"),n=Rn("brightness"),i=Rn("borderColor"),a=Rn("borderRadius"),s=Rn("borderSpacing"),o=Rn("borderWidth"),l=Rn("contrast"),u=Rn("grayscale"),c=Rn("hueRotate"),f=Rn("invert"),p=Rn("gap"),g=Rn("gradientColorStops"),y=Rn("gradientColorStopPositions"),S=Rn("inset"),w=Rn("margin"),C=Rn("opacity"),_=Rn("padding"),T=Rn("saturate"),N=Rn("scale"),R=Rn("sepia"),D=Rn("skew"),j=Rn("space"),O=Rn("translate"),F=()=>["auto","contain","none"],z=()=>["auto","hidden","clip","visible","scroll"],G=()=>["auto",br,e],Z=()=>[br,e],I=()=>["",rc,md],W=()=>["auto",Dp,br],U=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],K=()=>["solid","dashed","dotted","double","none"],$=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],Q=()=>["start","end","center","between","around","evenly","stretch"],ie=()=>["","0",br],te=()=>["auto","avoid","all","avoid-page","page","left","right","column"],X=()=>[Dp,br];return{cacheSize:500,separator:":",theme:{colors:[Um],spacing:[rc,md],blur:["none","",gd,br],brightness:X(),borderColor:[t],borderRadius:["none","","full",gd,br],borderSpacing:Z(),borderWidth:I(),contrast:X(),grayscale:ie(),hueRotate:X(),invert:ie(),gap:Z(),gradientColorStops:[t],gradientColorStopPositions:[RI,md],inset:G(),margin:G(),opacity:X(),padding:Z(),saturate:X(),scale:X(),sepia:ie(),skew:X(),space:Z(),translate:Z()},classGroups:{aspect:[{aspect:["auto","square","video",br]}],container:["container"],columns:[{columns:[gd]}],"break-after":[{"break-after":te()}],"break-before":[{"break-before":te()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...U(),br]}],overflow:[{overflow:z()}],"overflow-x":[{"overflow-x":z()}],"overflow-y":[{"overflow-y":z()}],overscroll:[{overscroll:F()}],"overscroll-x":[{"overscroll-x":F()}],"overscroll-y":[{"overscroll-y":F()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[S]}],"inset-x":[{"inset-x":[S]}],"inset-y":[{"inset-y":[S]}],start:[{start:[S]}],end:[{end:[S]}],top:[{top:[S]}],right:[{right:[S]}],bottom:[{bottom:[S]}],left:[{left:[S]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",zm,br]}],basis:[{basis:G()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",br]}],grow:[{grow:ie()}],shrink:[{shrink:ie()}],order:[{order:["first","last","none",zm,br]}],"grid-cols":[{"grid-cols":[Um]}],"col-start-end":[{col:["auto",{span:["full",zm,br]},br]}],"col-start":[{"col-start":W()}],"col-end":[{"col-end":W()}],"grid-rows":[{"grid-rows":[Um]}],"row-start-end":[{row:["auto",{span:[zm,br]},br]}],"row-start":[{"row-start":W()}],"row-end":[{"row-end":W()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",br]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",br]}],gap:[{gap:[p]}],"gap-x":[{"gap-x":[p]}],"gap-y":[{"gap-y":[p]}],"justify-content":[{justify:["normal",...Q()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...Q(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...Q(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[_]}],px:[{px:[_]}],py:[{py:[_]}],ps:[{ps:[_]}],pe:[{pe:[_]}],pt:[{pt:[_]}],pr:[{pr:[_]}],pb:[{pb:[_]}],pl:[{pl:[_]}],m:[{m:[w]}],mx:[{mx:[w]}],my:[{my:[w]}],ms:[{ms:[w]}],me:[{me:[w]}],mt:[{mt:[w]}],mr:[{mr:[w]}],mb:[{mb:[w]}],ml:[{ml:[w]}],"space-x":[{"space-x":[j]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[j]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",br,e]}],"min-w":[{"min-w":[br,e,"min","max","fit"]}],"max-w":[{"max-w":[br,e,"none","full","min","max","fit","prose",{screen:[gd]},gd]}],h:[{h:[br,e,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[br,e,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[br,e,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[br,e,"auto","min","max","fit"]}],"font-size":[{text:["base",gd,md]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",Wb]}],"font-family":[{font:[Um]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",br]}],"line-clamp":[{"line-clamp":["none",Dp,Wb]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",rc,br]}],"list-image":[{"list-image":["none",br]}],"list-style-type":[{list:["none","disc","decimal",br]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[t]}],"placeholder-opacity":[{"placeholder-opacity":[C]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[t]}],"text-opacity":[{"text-opacity":[C]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...K(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",rc,md]}],"underline-offset":[{"underline-offset":["auto",rc,br]}],"text-decoration-color":[{decoration:[t]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:Z()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",br]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",br]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[C]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...U(),II]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",DI]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},FI]}],"bg-color":[{bg:[t]}],"gradient-from-pos":[{from:[y]}],"gradient-via-pos":[{via:[y]}],"gradient-to-pos":[{to:[y]}],"gradient-from":[{from:[g]}],"gradient-via":[{via:[g]}],"gradient-to":[{to:[g]}],rounded:[{rounded:[a]}],"rounded-s":[{"rounded-s":[a]}],"rounded-e":[{"rounded-e":[a]}],"rounded-t":[{"rounded-t":[a]}],"rounded-r":[{"rounded-r":[a]}],"rounded-b":[{"rounded-b":[a]}],"rounded-l":[{"rounded-l":[a]}],"rounded-ss":[{"rounded-ss":[a]}],"rounded-se":[{"rounded-se":[a]}],"rounded-ee":[{"rounded-ee":[a]}],"rounded-es":[{"rounded-es":[a]}],"rounded-tl":[{"rounded-tl":[a]}],"rounded-tr":[{"rounded-tr":[a]}],"rounded-br":[{"rounded-br":[a]}],"rounded-bl":[{"rounded-bl":[a]}],"border-w":[{border:[o]}],"border-w-x":[{"border-x":[o]}],"border-w-y":[{"border-y":[o]}],"border-w-s":[{"border-s":[o]}],"border-w-e":[{"border-e":[o]}],"border-w-t":[{"border-t":[o]}],"border-w-r":[{"border-r":[o]}],"border-w-b":[{"border-b":[o]}],"border-w-l":[{"border-l":[o]}],"border-opacity":[{"border-opacity":[C]}],"border-style":[{border:[...K(),"hidden"]}],"divide-x":[{"divide-x":[o]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[o]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[C]}],"divide-style":[{divide:K()}],"border-color":[{border:[i]}],"border-color-x":[{"border-x":[i]}],"border-color-y":[{"border-y":[i]}],"border-color-s":[{"border-s":[i]}],"border-color-e":[{"border-e":[i]}],"border-color-t":[{"border-t":[i]}],"border-color-r":[{"border-r":[i]}],"border-color-b":[{"border-b":[i]}],"border-color-l":[{"border-l":[i]}],"divide-color":[{divide:[i]}],"outline-style":[{outline:["",...K()]}],"outline-offset":[{"outline-offset":[rc,br]}],"outline-w":[{outline:[rc,md]}],"outline-color":[{outline:[t]}],"ring-w":[{ring:I()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[t]}],"ring-opacity":[{"ring-opacity":[C]}],"ring-offset-w":[{"ring-offset":[rc,md]}],"ring-offset-color":[{"ring-offset":[t]}],shadow:[{shadow:["","inner","none",gd,BI]}],"shadow-color":[{shadow:[Um]}],opacity:[{opacity:[C]}],"mix-blend":[{"mix-blend":[...$(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":$()}],filter:[{filter:["","none"]}],blur:[{blur:[r]}],brightness:[{brightness:[n]}],contrast:[{contrast:[l]}],"drop-shadow":[{"drop-shadow":["","none",gd,br]}],grayscale:[{grayscale:[u]}],"hue-rotate":[{"hue-rotate":[c]}],invert:[{invert:[f]}],saturate:[{saturate:[T]}],sepia:[{sepia:[R]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[r]}],"backdrop-brightness":[{"backdrop-brightness":[n]}],"backdrop-contrast":[{"backdrop-contrast":[l]}],"backdrop-grayscale":[{"backdrop-grayscale":[u]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[c]}],"backdrop-invert":[{"backdrop-invert":[f]}],"backdrop-opacity":[{"backdrop-opacity":[C]}],"backdrop-saturate":[{"backdrop-saturate":[T]}],"backdrop-sepia":[{"backdrop-sepia":[R]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[s]}],"border-spacing-x":[{"border-spacing-x":[s]}],"border-spacing-y":[{"border-spacing-y":[s]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",br]}],duration:[{duration:X()}],ease:[{ease:["linear","in","out","in-out",br]}],delay:[{delay:X()}],animate:[{animate:["none","spin","ping","pulse","bounce",br]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[N]}],"scale-x":[{"scale-x":[N]}],"scale-y":[{"scale-y":[N]}],rotate:[{rotate:[zm,br]}],"translate-x":[{"translate-x":[O]}],"translate-y":[{"translate-y":[O]}],"skew-x":[{"skew-x":[D]}],"skew-y":[{"skew-y":[D]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",br]}],accent:[{accent:["auto",t]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",br]}],"caret-color":[{caret:[t]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":Z()}],"scroll-mx":[{"scroll-mx":Z()}],"scroll-my":[{"scroll-my":Z()}],"scroll-ms":[{"scroll-ms":Z()}],"scroll-me":[{"scroll-me":Z()}],"scroll-mt":[{"scroll-mt":Z()}],"scroll-mr":[{"scroll-mr":Z()}],"scroll-mb":[{"scroll-mb":Z()}],"scroll-ml":[{"scroll-ml":Z()}],"scroll-p":[{"scroll-p":Z()}],"scroll-px":[{"scroll-px":Z()}],"scroll-py":[{"scroll-py":Z()}],"scroll-ps":[{"scroll-ps":Z()}],"scroll-pe":[{"scroll-pe":Z()}],"scroll-pt":[{"scroll-pt":Z()}],"scroll-pr":[{"scroll-pr":Z()}],"scroll-pb":[{"scroll-pb":Z()}],"scroll-pl":[{"scroll-pl":Z()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",br]}],fill:[{fill:[t,"none"]}],"stroke-w":[{stroke:[rc,md,Wb]}],stroke:[{stroke:[t,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},Jk=CI(VI),Kn=({children:t,className:e,...r})=>m.jsx("div",{className:Jk("bg-glass backdrop-blur-xl border border-glass-border rounded-xl",e),...r,children:t}),e_=({url:t,name:e,alt:r="User",size:n="md",className:i})=>{const a={sm:"size-8 text-xs",md:"size-10 text-sm",lg:"size-16 text-lg",xl:"size-32 text-2xl"},s=e?e.charAt(0).toUpperCase():r?r.charAt(0).toUpperCase():"?";return m.jsx("div",{className:Jk("rounded-full bg-surface-light border border-white/10 flex items-center justify-center overflow-hidden shrink-0 text-slate-400 font-bold select-none",a[n],i),children:t?m.jsx("img",{src:t,alt:e||r,className:"w-full h-full object-cover"}):m.jsx("span",{children:s})})},HI=()=>m.jsx("div",{className:"flex h-screen w-full overflow-hidden bg-background-dark relative",children:m.jsx("main",{className:"flex-1 min-w-0 relative overflow-hidden flex flex-col",children:m.jsx(sx,{})})}),WI="/api",$e={async request(t,e={}){const r=`${WI}${t}`,n=e.body instanceof FormData;let i={};const a=window.location.pathname.split("/");if(a.length>=3){const l=a[2];l&&l!=="settings"&&l!=="workspaces"&&(i["X-Project-ID"]=l)}const s={...n?{}:{"Content-Type":"application/json"},...i,...e.headers},o=await fetch(r,{...e,headers:s,credentials:"include"});if(!o.ok){if(o.status===401)return console.warn("Session expired or unauthorized. Redirecting to project selection."),window.location.href="/",null;const l=await o.json().catch(()=>({}));throw new Error(l.error||`HTTP error! status: ${o.status}`)}return o.status===204||o.headers.get("content-length")==="0"?null:o.json()},get(t,e={}){return this.request(t,{method:"GET",headers:e})},post(t,e,r={}){return this.request(t,{method:"POST",body:e instanceof FormData?e:JSON.stringify(e),headers:r})},put(t,e,r={}){return this.request(t,{method:"PUT",body:e instanceof FormData?e:JSON.stringify(e),headers:r})},patch(t,e,r={}){return this.request(t,{method:"PATCH",body:e instanceof FormData?e:JSON.stringify(e),headers:r})},delete(t,e={}){return this.request(t,{method:"DELETE",headers:e})}},Gm={list:()=>$e.get("/workspaces"),create:(t,e,r,n)=>$e.post("/workspaces",{name:t,title:e,genre:r,imageUrl:n}),delete:t=>$e.delete("/workspaces/"+t),update:(t,e)=>$e.put("/workspaces/"+t,e),select:t=>$e.post("/workspaces/select",{projectName:t})},qI=["FANTASA","SCI-FI","HORROR","LORE","MISTERIO","HISTRICO","CYBERPUNK","STEAMPUNK"],$I=({isOpen:t,onClose:e,onCreate:r})=>{if(!t)return null;const[n,i]=ne.useState(!1),[a,s]=ne.useState({name:"",title:"",genre:"FANTASA",imageUrl:"https://images.unsplash.com/photo-1518709268805-4e9042af9f23?auto=format&fit=crop&q=80&w=800"}),o=u=>{const{name:c,value:f}=u.target;s(p=>({...p,[c]:f}))},l=u=>{u.preventDefault();let c=a.name;if(!c&&a.title&&(c=a.title.toLowerCase().replace(/[^a-z0-9]/g,"-")),!c){alert("Project ID/Name is required");return}r({...a,name:c}),e(),s({name:"",title:"",genre:"FANTASA",imageUrl:"https://images.unsplash.com/photo-1518709268805-4e9042af9f23?auto=format&fit=crop&q=80&w=800"})};return eo.createPortal(m.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[m.jsx("div",{className:"absolute inset-0 bg-black/80 backdrop-blur-sm animate-in fade-in duration-200",onClick:e}),m.jsxs("div",{className:"relative w-full max-w-2xl bg-[#0a0a0c] border border-white/10 rounded-3xl shadow-2xl overflow-hidden flex animate-in zoom-in-95 duration-200",children:[m.jsxs("div",{className:"w-1/3 bg-black relative hidden sm:block",children:[m.jsx("img",{src:a.imageUrl,onError:()=>i(!0),className:`absolute inset-0 w-full h-full object-cover opacity-60 transition-opacity duration-500 ${n?"hidden":""}`,alt:"Preview"}),m.jsxs("div",{className:"absolute inset-x-0 bottom-0 p-6 bg-gradient-to-t from-black to-transparent",children:[m.jsx("h4",{className:"text-white font-black text-xl leading-none",children:a.title||"Untitled"}),m.jsx("span",{className:"text-[10px] font-bold text-primary uppercase tracking-widest mt-2 block",children:a.genre})]})]}),m.jsxs("div",{className:"flex-1 p-8",children:[m.jsx("h2",{className:"text-2xl font-black text-white mb-6",children:"Nuevo Cuaderno"}),m.jsxs("form",{onSubmit:l,className:"space-y-5",children:[m.jsxs("div",{className:"space-y-1.5",children:[m.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-text-muted",children:"Ttulo del Proyecto"}),m.jsx("input",{type:"text",name:"title",value:a.title,onChange:o,placeholder:"e.g. Las Crnicas de Etheria",className:"w-full bg-[#13141f] border border-white/10 rounded-xl px-4 py-3 text-white text-sm focus:border-primary/50 focus:ring-1 focus:ring-primary/50 outline-none transition-all",autoFocus:!0})]}),m.jsxs("div",{className:"space-y-1.5",children:[m.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-text-muted",children:"ID de Archivo (Slug)"}),m.jsx("input",{type:"text",name:"name",value:a.name,onChange:o,placeholder:"e.g. etheria-v1",className:"w-full bg-[#13141f] border border-white/10 rounded-xl px-4 py-3 text-white font-mono text-xs focus:border-primary/50 focus:ring-1 focus:ring-primary/50 outline-none transition-all placeholder:text-white/10"}),m.jsx("p",{className:"text-[10px] text-white/20",children:"Se usar como nombre del archivo .db"})]}),m.jsxs("div",{className:"space-y-1.5",children:[m.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-text-muted",children:"Gnero"}),m.jsx("div",{className:"grid grid-cols-2 gap-2",children:qI.slice(0,4).map(u=>m.jsx("button",{type:"button",onClick:()=>s(c=>({...c,genre:u})),className:`px-3 py-2 rounded-lg text-[10px] font-bold border transition-all ${a.genre===u?"bg-primary text-white border-primary":"bg-[#13141f] border-white/10 text-text-muted hover:border-white/20"}`,children:u},u))})]}),m.jsxs("div",{className:"space-y-1.5",children:[m.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-text-muted",children:"Imagen de Portada (URL)"}),m.jsx("input",{type:"text",name:"imageUrl",value:a.imageUrl,onChange:u=>{s(c=>({...c,imageUrl:u.target.value})),i(!1)},className:"w-full bg-[#13141f] border border-white/10 rounded-xl px-4 py-3 text-white text-xs focus:border-primary/50 focus:ring-1 focus:ring-primary/50 outline-none transition-all truncate"})]}),m.jsxs("div",{className:"pt-4 flex gap-3",children:[m.jsx("button",{type:"button",onClick:e,className:"flex-1 px-4 py-3 bg-[#13141f] hover:bg-white/5 border border-white/10 rounded-xl text-xs font-bold text-text-muted transition-all",children:"Cancelar"}),m.jsxs("button",{type:"submit",className:"flex-1 px-4 py-3 bg-primary hover:bg-primary-light text-white rounded-xl text-xs font-bold transition-all shadow-lg shadow-primary/20 flex items-center justify-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"rocket_launch"}),"Crear Universo"]})]})]})]})]})]}),document.body)},KI=["FANTASA","SCI-FI","HORROR","LORE","MISTERIO","HISTRICO","CYBERPUNK","STEAMPUNK"],ZI=({isOpen:t,onClose:e,onUpdate:r,project:n})=>{if(!t||!n)return null;const[i,a]=ne.useState(!1),[s,o]=ne.useState({name:n,title:n,genre:"FANTASA",imageUrl:"https://images.unsplash.com/photo-1518709268805-4e9042af9f23?auto=format&fit=crop&q=80&w=800"});ne.useEffect(()=>{n&&o(u=>({...u,name:n,title:n}))},[n]);const l=u=>{u.preventDefault(),r(s.name,{title:s.title,genre:s.genre,imageUrl:s.imageUrl}),e()};return eo.createPortal(m.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[m.jsx("div",{className:"absolute inset-0 bg-black/80 backdrop-blur-sm animate-in fade-in duration-200",onClick:e}),m.jsxs("div",{className:"relative w-full max-w-2xl bg-[#0a0a0c] border border-white/10 rounded-3xl shadow-2xl overflow-hidden flex animate-in zoom-in-95 duration-200",children:[m.jsxs("div",{className:"w-1/3 bg-black relative hidden sm:block",children:[m.jsx("img",{src:s.imageUrl,onError:()=>a(!0),className:`absolute inset-0 w-full h-full object-cover opacity-60 transition-opacity duration-500 ${i?"hidden":""}`,alt:"Preview"}),m.jsxs("div",{className:"absolute inset-x-0 bottom-0 p-6 bg-gradient-to-t from-black to-transparent",children:[m.jsx("h4",{className:"text-white font-black text-xl leading-none",children:s.title||"Untitled"}),m.jsx("span",{className:"text-[10px] font-bold text-primary uppercase tracking-widest mt-2 block",children:s.genre})]})]}),m.jsxs("div",{className:"flex-1 p-8",children:[m.jsx("h2",{className:"text-2xl font-black text-white mb-6",children:"Editar Cuaderno"}),m.jsxs("form",{onSubmit:l,className:"space-y-5",children:[m.jsxs("div",{className:"space-y-1.5",children:[m.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-text-muted",children:"Ttulo del Proyecto"}),m.jsx("input",{type:"text",name:"title",value:s.title,onChange:u=>o(c=>({...c,title:u.target.value})),className:"w-full bg-[#13141f] border border-white/10 rounded-xl px-4 py-3 text-white text-sm focus:border-primary/50 focus:ring-1 focus:ring-primary/50 outline-none transition-all",autoFocus:!0})]}),m.jsxs("div",{className:"space-y-1.5 opacity-50",children:[m.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-text-muted",children:"ID de Archivo (Inmutable)"}),m.jsx("input",{type:"text",value:s.name,readOnly:!0,className:"w-full bg-[#0a0a0c] border border-white/5 rounded-xl px-4 py-3 text-white/50 font-mono text-xs outline-none cursor-not-allowed"})]}),m.jsxs("div",{className:"space-y-1.5",children:[m.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-text-muted",children:"Gnero"}),m.jsx("div",{className:"grid grid-cols-2 gap-2",children:KI.slice(0,4).map(u=>m.jsx("button",{type:"button",onClick:()=>o(c=>({...c,genre:u})),className:`px-3 py-2 rounded-lg text-[10px] font-bold border transition-all ${s.genre===u?"bg-primary text-white border-primary":"bg-[#13141f] border-white/10 text-text-muted hover:border-white/20"}`,children:u},u))})]}),m.jsxs("div",{className:"space-y-1.5",children:[m.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-text-muted",children:"Imagen de Portada (URL)"}),m.jsx("input",{type:"text",value:s.imageUrl,onChange:u=>{o(c=>({...c,imageUrl:u.target.value})),a(!1)},className:"w-full bg-[#13141f] border border-white/10 rounded-xl px-4 py-3 text-white text-xs focus:border-primary/50 focus:ring-1 focus:ring-primary/50 outline-none transition-all truncate"})]}),m.jsxs("div",{className:"pt-4 flex gap-3",children:[m.jsx("button",{type:"button",onClick:e,className:"flex-1 px-4 py-3 bg-[#13141f] hover:bg-white/5 border border-white/10 rounded-xl text-xs font-bold text-text-muted transition-all",children:"Cancelar"}),m.jsxs("button",{type:"submit",className:"flex-1 px-4 py-3 bg-primary hover:bg-primary-light text-white rounded-xl text-xs font-bold transition-all shadow-lg shadow-primary/20 flex items-center justify-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"save"}),"Guardar Cambios"]})]})]})]})]})]}),document.body)},Pn=ne.forwardRef(({children:t,variant:e="primary",size:r="md",className:n,icon:i,isLoading:a,...s},o)=>{const l="inline-flex items-center justify-center rounded-lg font-medium transition-all focus:outline-none disabled:opacity-50 disabled:cursor-not-allowed active:scale-95",u={primary:"bg-primary text-white shadow-lg shadow-primary/25 hover:bg-primary-light hover:shadow-primary/40 border border-transparent",secondary:"bg-surface-light text-slate-200 border border-white/10 hover:bg-white/5 hover:text-white hover:border-white/20",ghost:"bg-transparent text-slate-400 hover:text-white hover:bg-white/5",danger:"bg-red-500/10 text-red-500 border border-red-500/20 hover:bg-red-500/20 hover:border-red-500/50 hover:shadow-lg hover:shadow-red-500/10",outline:"bg-transparent border border-primary/50 text-primary hover:bg-primary/10"},c={xs:"px-2.5 py-1 text-xs gap-1.5",sm:"px-3 py-1.5 text-xs gap-1.5",md:"px-4 py-2 text-sm gap-2",lg:"px-6 py-3 text-base gap-3",icon:"size-9 p-0"};return m.jsxs("button",{ref:o,className:Jk(l,u[e],c[r],n),disabled:a,...s,children:[a?m.jsx("span",{className:"material-symbols-outlined animate-spin text-[18px]",children:"progress_activity"}):i?m.jsx("span",{className:"material-symbols-outlined text-[18px]",children:i}):null,t]})});Pn.displayName="Button";const t_=({isOpen:t,onClose:e,onConfirm:r,title:n,message:i,confirmText:a="Confirm",cancelText:s="Cancel",isDestructive:o=!0})=>t?m.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[m.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm animate-in fade-in duration-300",onClick:e}),m.jsx("div",{className:"relative z-10 w-full max-w-md animate-in zoom-in-95 duration-300",children:m.jsxs(Kn,{className:"p-6 border-red-500/20 shadow-2xl shadow-black/50",children:[m.jsxs("div",{className:"flex items-start gap-4 mb-6",children:[m.jsx("div",{className:`
                            size-12 rounded-xl flex items-center justify-center shrink-0
                            ${o?"bg-red-500/10 text-red-500":"bg-primary/10 text-primary"}
                        `,children:m.jsx("span",{className:"material-symbols-outlined text-2xl",children:o?"warning":"help"})}),m.jsxs("div",{children:[m.jsx("h3",{className:"text-lg font-black text-white mb-2 leading-tight",children:n}),m.jsx("p",{className:"text-sm text-slate-400 leading-relaxed",children:i})]})]}),m.jsxs("div",{className:"flex items-center justify-end gap-3",children:[m.jsx(Pn,{variant:"ghost",onClick:e,children:s}),m.jsx(Pn,{variant:o?"danger":"primary",onClick:()=>{r(),e()},icon:o?"delete":"check",children:a})]})]})})]}):null,YI=()=>{const t=Ga(),[e,r]=ne.useState([]),[n,i]=ne.useState(!0),[a,s]=ne.useState(null),[o,l]=ne.useState(""),[u,c]=ne.useState(!1),[f,p]=ne.useState(null),[g,y]=ne.useState(null);ne.useEffect(()=>{S()},[]);const S=async()=>{try{i(!0);const D=await Gm.list();r(D)}catch(D){console.error("Failed to load workspaces",D),s("Error al cargar cuadernos. Est el servidor encendido?")}finally{i(!1)}},w=async D=>{try{i(!0);const j=await Gm.select(D);j.success&&j.redirect&&(localStorage.setItem("user",JSON.stringify({username:"local",success:!0})),t(j.redirect))}catch(j){s(j.message||"Fallo al entrar al cuaderno"),i(!1)}},C=async D=>{try{i(!0),(await Gm.create(D.name,D.title,D.genre,D.imageUrl)).success&&await w(D.name)}catch{s("Error al crear cuaderno"),i(!1)}},_=async()=>{if(f)try{i(!0),await Gm.delete(f),await S(),p(null)}catch{s("Error al borrar el cuaderno"),i(!1)}},T=async(D,j)=>{try{i(!0),await Gm.update(D,j),await S(),y(null)}catch{s("Error al actualizar cuaderno"),i(!1)}},N=()=>{window.location.href="/api/backup/download"},R=e.filter(D=>(D.title||D.filename||"").toLowerCase().includes(o.toLowerCase()));return m.jsxs("div",{className:"h-screen w-full bg-[#0a0b14] text-white flex flex-col items-center font-sans selection:bg-indigo-500/30 overflow-hidden",children:[m.jsxs("div",{className:"w-full max-w-6xl flex-1 flex flex-col overflow-y-auto custom-scrollbar p-8",children:[m.jsxs("header",{className:"w-full mt-24 mb-12 flex flex-col lg:flex-row lg:items-end justify-between gap-8 flex-shrink-0",children:[m.jsx("div",{className:"space-y-4",children:m.jsx("div",{className:"flex items-center gap-4",children:m.jsxs("h1",{className:"text-6xl font-black tracking-tighter leading-none",children:[m.jsx("span",{className:"block text-indigo-400",children:"Mis"}),m.jsx("span",{className:"block text-white",children:"Cuadernos"})]})})}),m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsxs("button",{onClick:()=>t("/settings"),className:"flex items-center gap-2 px-5 py-3 bg-white/5 hover:bg-white/10 border border-white/10 rounded-2xl transition-all text-xs font-bold text-slate-400 hover:text-white group",title:"Configuracin Global",children:[m.jsx("span",{className:"material-symbols-outlined text-lg group-hover:rotate-90 transition-transform duration-500",children:"settings"}),m.jsx("span",{className:"hidden sm:inline",children:"Ajustes"})]}),m.jsxs("button",{onClick:N,className:"flex items-center gap-2 px-5 py-3 bg-white/5 hover:bg-white/10 border border-white/10 rounded-2xl transition-all text-xs font-bold text-slate-400 hover:text-white group",title:"Descargar copia de seguridad de todos los universos",children:[m.jsx("span",{className:"material-symbols-outlined text-lg group-hover:scale-110 transition-transform",children:"cloud_download"}),m.jsx("span",{className:"hidden sm:inline",children:"Backup Global"})]}),m.jsxs("a",{href:"/manual/Guia_Usuario.html",target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 px-5 py-3 bg-indigo-500/10 hover:bg-indigo-500/20 border border-indigo-500/20 rounded-2xl transition-all text-xs font-bold text-indigo-400 hover:text-indigo-300 group no-underline",title:"Abrir Manual de Usuario",children:[m.jsx("span",{className:"material-symbols-outlined text-lg group-hover:scale-110 transition-transform",children:"menu_book"}),m.jsx("span",{className:"hidden sm:inline",children:"Gua de Usuario"})]}),m.jsxs("div",{className:"relative group min-w-[300px]",children:[m.jsx("span",{className:"material-symbols-outlined absolute left-4 top-1/2 -translate-y-1/2 text-white/20 text-xl group-focus-within:text-indigo-400 transition-colors pointer-events-none",children:"search"}),m.jsx("input",{type:"text",placeholder:"Buscar...",value:o,onChange:D=>l(D.target.value),className:"w-full bg-[#13141f] border border-white/5 rounded-2xl py-3 pl-12 pr-4 text-sm text-white focus:outline-none focus:border-indigo-500/50 transition-all placeholder:text-white/10"})]})]})]}),m.jsx("section",{className:"w-full max-w-6xl",children:n?m.jsxs("div",{className:"flex flex-col items-center gap-6 py-20 opacity-20",children:[m.jsx("div",{className:"w-12 h-12 border-4 border-indigo-500 border-t-transparent rounded-full animate-spin"}),m.jsx("p",{className:"text-[10px] font-black uppercase tracking-[0.3em]",children:"Accediendo al Sector Local..."})]}):m.jsxs("div",{className:"flex flex-wrap gap-6 justify-start pb-20",children:[m.jsxs("div",{onClick:()=>c(!0),className:"group relative h-[380px] rounded-[2.5rem] border-2 border-dashed border-white/5 flex flex-col items-center justify-center gap-6 hover:bg-white/5 hover:border-indigo-500/30 transition-all cursor-pointer overflow-hidden animate-in fade-in duration-700 w-full md:w-[calc(50%-0.75rem)] lg:w-[calc(33.333%-1rem)]",children:[m.jsx("div",{className:"w-20 h-20 rounded-full bg-[#13141f] border border-white/5 flex items-center justify-center text-4xl text-white/20 group-hover:scale-110 group-hover:text-indigo-400 transition-all",children:m.jsx("span",{className:"material-symbols-outlined text-4xl",children:"add"})}),m.jsxs("div",{className:"text-center",children:[m.jsx("h3",{className:"text-xl font-black tracking-tight text-white/50 group-hover:text-white transition-colors",children:"Nuevo Cuaderno"}),m.jsx("p",{className:"text-[10px] font-bold text-white/20 uppercase tracking-widest mt-2 group-hover:text-white/40",children:"Inicia un nuevo universo"})]})]}),R.map(D=>{const j=D.imageUrl||"https://images.unsplash.com/photo-1451187580459-43490279c0fa?auto=format&fit=crop&q=80&w=800";return m.jsxs("div",{onClick:()=>w(D.filename),className:"group relative h-[380px] rounded-[2.5rem] bg-[#13141f] border border-white/5 overflow-hidden transition-all hover:-translate-y-2 hover:shadow-2xl hover:shadow-indigo-500/10 cursor-pointer animate-in fade-in slide-in-from-bottom-4 w-full md:w-[calc(50%-0.75rem)] lg:w-[calc(33.333%-1rem)]",children:[m.jsxs("div",{className:"absolute inset-x-0 top-0 h-2/3",children:[m.jsx("img",{src:j,className:"w-full h-full object-cover opacity-40 group-hover:opacity-60 transition-opacity",alt:""}),m.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-[#13141f] via-transparent to-transparent"})]}),m.jsxs("div",{className:"absolute top-6 right-6 flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity duration-300 z-20",children:[m.jsx("button",{onClick:O=>{O.stopPropagation(),y(D.filename)},className:"w-10 h-10 rounded-full bg-black/50 backdrop-blur-md border border-white/10 flex items-center justify-center text-white/70 hover:text-white hover:bg-indigo-500 hover:border-indigo-400 transition-all",title:"Editar",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"edit"})}),m.jsx("button",{onClick:O=>{O.stopPropagation(),p(D.filename)},className:"w-10 h-10 rounded-full bg-black/50 backdrop-blur-md border border-white/10 flex items-center justify-center text-white/70 hover:text-white hover:bg-red-500 hover:border-red-400 transition-all",title:"Eliminar",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})})]}),m.jsx("div",{className:"absolute inset-0 flex flex-col justify-end p-8",children:m.jsxs("div",{className:"mt-auto space-y-3",children:[m.jsx("span",{className:"inline-block px-3 py-1 bg-red-500/20 border border-red-500/30 text-[9px] font-black text-red-100 rounded-lg tracking-widest uppercase",children:D.tag}),m.jsx("h3",{className:"text-3xl font-black text-white tracking-tighter leading-tight group-hover:text-indigo-400 transition-colors",children:D.title}),D.title!==D.filename&&m.jsx("p",{className:"text-[10px] text-white/30 font-mono mb-1",children:D.filename}),m.jsx("p",{className:"text-xs text-white/40 line-clamp-2 leading-relaxed",children:"Una tierra dividida por la magia y la tecnologa antigua..."}),m.jsxs("div",{className:"flex items-center justify-between pt-6 border-t border-white/5 mt-4",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-emerald-500 shadow-[0_0_8px_rgba(16,185,129,0.5)]"}),m.jsxs("span",{className:"text-[9px] font-black uppercase tracking-widest text-white/20",children:["ltima edicin: ",m.jsx("span",{className:"text-white/40",children:D.lastModified})]})]}),m.jsx("div",{className:"w-8 h-8 rounded-full bg-white/5 border border-white/10 flex items-center justify-center text-[10px] font-black text-indigo-300",children:D.initials})]})]})})]},D.filename)})]})})]}),a&&m.jsx("div",{className:"fixed bottom-8 left-1/2 -translate-x-1/2 px-6 py-3 bg-red-500/20 border border-red-500/30 text-red-200 rounded-2xl text-xs font-bold shadow-2xl animate-bounce",children:a}),m.jsx($I,{isOpen:u,onClose:()=>c(!1),onCreate:C}),m.jsx(ZI,{isOpen:!!g,onClose:()=>y(null),project:g,onUpdate:T}),m.jsx(t_,{isOpen:!!f,onClose:()=>p(null),onConfirm:_,title:"Eliminar Proyecto?",message:`Ests a punto de borrar "${f}" y todo su contenido permanentemente. Esta accin no se puede deshacer.`,confirmText:"Eliminar Universo",isDestructive:!0})]})},XI={save:"Guardar",saved:"Guardado",saving:"Guardando...",cancel:"Cancelar",delete:"Borrar",edit:"Editar",create:"Crear",back:"Volver",loading:"Cargando...",search:"Buscar...",no_results:"Sin resultados",confirm_delete:"Eliminar",are_you_sure:"Ests seguro de que quieres eliminar este elemento? Esta accin no se puede deshacer.",architect:"Arquitecto",confirm_delete_btn:"S, borrar",view_all:"Ver todos",rename:"Renombrar",error_delete:"Error al eliminar el elemento"},QI={dashboard:"Panel de Control",bible:"Biblia del Mundo",atlas:"Atlas",writing:"Escritura",settings:"Ajustes",logout:"Salir al Hub",chronology:"Cronologa",graph:"Grafo",languages:"Lingstica"},JI={title:"Ajustes",general:"General",appearance:"Apariencia",language:"Idioma",theme:"Tema",font:"Tipografa",font_size:"Tamao del Texto",unauthorized:"No autorizado",sync:"Sincronizacin",backup:"Respaldo",edit_template:"Editar Plantilla",available_templates:"Plantillas Disponibles",no_templates:"Sin Plantillas",is_global:"Es Global?",name:"Nombre",type:"Tipo"},ej={title:"Escritura",library:"Biblioteca del Arquitecto",library_desc:"Gestiona tus Archivadores y Crnicas",new_notebook:"Nuevo Archivador",new_page:"Nueva Hoja",index:"ndice",notes:"Notas",format:"Formato",empty:"Pgina vaca...",active_notebook:"Archivador Activo",open_archivador:"Abrir Archivador",book_title:"Ttulo del Libro",placeholder_title:"Las Crnicas del Vaco...",create_and_open:"Crear y Abrir",expansion:"Expansin de la Biblioteca",delete_confirm:"Seguro que quieres borrar este archivador? Se perdern todas sus hojas.",chapter:"Captulo",page:"Pgina",of:"de",new_archivador_title:"Nuevo Archivador",library_expansion:"Expansin de la Biblioteca",book_title_label:"Ttulo del Libro",create_and_open_btn:"Crear y Abrir",cancel_btn:"Cancelar"},tj={grid_system:"Sistema de Rejilla",size:"Tamao",canvas_data:"Datos del Lienzo",width:"Ancho (px)",height:"Alto (px)",background_image:"Imagen de Fondo",upload_image:"Subir Nueva Imagen",remove_image:"Eliminar Imagen",explorer:"Explorador de Mundo",not_found:"Imagen del Mapa no Encontrada",upload_desc:"Sube una imagen del mapa en el editor para comenzar",fullscreen:"Pantalla Completa",share:"Compartir",inhabitants:"Habitantes Clave",related_events:"Eventos Relacionados",open_bible:"Abrir en la Biblia",place:"Lugar",capital:"Capital",new_map:"Nuevo Mapa"},rj={explore:"Explorar",explorer:"Explorador",templates:"Plantillas",drag_attributes:"Arrastrar Atributos",search_entity:"Buscar entidad...",filter_type:"Filtrar por Tipo",all:"Todos",entities:"Entidades",maps:"Mapas",timelines:"Lneas de Tiempo",new_folder:"Nueva Carpeta",new_timeline:"Nueva Lnea de Tiempo",delete_folder:"Borrar Carpeta",delete_folder_msg:"Seguro que quieres borrar esta carpeta y todo su contenido?",delete_entity:"Borrar Entidad",delete_entity_msg:"Seguro que quieres borrar esta entidad de la Biblia?",no_favorites:"Sin favoritos an",favorites:"Favoritos",root_index:"ndice Raz",central_archive:"Archivo central de todas las entidades, cronologas y registros geogrficos del mundo.",empty_archive:"Archivo Vaco",empty_archive_desc:"Comienza creando tu primera carpeta o lnea de tiempo para organizar el conocimiento."},nj={title:"Lnea de Tiempo",add_event:"Aadir Evento",add_line:"Nueva Lnea de Tiempo",edit_event:"Editar Evento",edit_line:"Editar Lnea de Tiempo",delete_event:"Eliminar Evento",delete_line:"Eliminar Lnea de Tiempo",events_tab:"Eventos",annexes_tab:"Anexos",linked_timelines:"Lneas de Tiempo Vinculadas",available_timelines:"Lneas de Tiempo Disponibles",multiverse:"Multiverso",new_universe:"Nuevo Universo",universe_settings:"Ajustes del Universo",delete_universe_confirm:"Eliminar este universo y TODAS sus lneas de tiempo? Esta accin no se puede deshacer.",select_timeline:"Seleccionar Lnea",no_events:"Sin eventos an. Usa el panel derecho para aadir uno.",event_name:"Nombre del Evento",date_label:"Etiqueta de Fecha",order:"Orden (Sorteo)",description:"Descripcin",save_changes:"Guardar Cambios",create_event:"Crear Evento",delete_event_btn:"Eliminar Evento",annexed_desc:"Vincula otras lneas de tiempo localizadas a esta para verificar la consistencia cronolgica.",no_linked:"Sin lneas vinculadas.",available_to_link:"Disponibles para Vincular",no_available:"No hay otras lneas disponibles.",universe_name:"Nombre del Universo",universe_desc:"Contexto para este universo...",add_timeline_here:"Aadir Lnea de Tiempo aqu",no_timelines:"No hay lneas aqu"},ij={title:"Lingstica",lexicon:"Lxico",grammar:"Reglas de Gramtica",writing_system:"Sistema de Escritura",phonology:"Fonologa",translator:"Traductor",new_word:"Aadir Nueva Palabra",new_rule:"Definir Nueva Regla",open_editor:"Abrir Editor",auto_saved:"Auto-guardado",desc:"Una lengua perteneciente a {{projectName}}. Gestiona su lxico, reglas gramaticales y sistemas de escritura aqu.",stats:{words:"Palabras",rules:"Reglas",glyphs:"Glifos"},search_lexicon:"Buscar palabra o significado...",manage:"Gestionar",moon_script:"Escritura Lunar",inventory:"Inventario de Vocales",vectors:"Smbolos Vectoriales",upload_svg:"Subir SVG",live_stream:"Flujo Logogrfico en Vivo",rendered_output:"Salida Renderizada",source_text:"Texto de origen aqu..."},aj={dashboard_desc:"Panel de Control del Proyecto",welcome:"Bienvenido,",welcome_desc:"Tu mundo est esperando ser esculpido. Utiliza el Codex para documentar entidades, el Atlas para trazar geografas o las Crnicas para escribir su historia.",codex_title:"Codex",codex_desc:"Biblia del Mundo y Base de Datos de Entidades",atlas_title:"Atlas",atlas_desc:"Cartografa y Geografa Interactiva",chronicles_title:"Crnicas",chronicles_desc:"Escritura Narrativa y Gestin de Cuadernos",graph_title:"Grafo",graph_desc:"Visualizacin de Conexiones y Relaciones",timeline_title:"Cronologa",timeline_desc:"Lneas de Tiempo y Eventos Histricos",linguistics_title:"Lingstica",linguistics_desc:"Creacin de Lenguas y Glifos",explore_tool:"Explorar Herramienta"},sj={common:XI,nav:QI,settings:JI,writing:ej,atlas:tj,bible:rj,timeline:nj,linguistics:ij,project:aj},oj={save:"Save",saved:"Saved",saving:"Saving...",cancel:"Cancel",delete:"Delete",edit:"Edit",create:"Create",back:"Back",loading:"Loading...",search:"Search...",no_results:"No results",confirm_delete:"Delete",are_you_sure:"Are you sure you want to delete this item? This action cannot be undone.",architect:"Architect",confirm_delete_btn:"Yes, delete",view_all:"View All",rename:"Rename",error_delete:"Error deleting item"},lj={dashboard:"Dashboard",bible:"World Bible",atlas:"Atlas",writing:"Writing",settings:"Settings",logout:"Exit to Hub",chronology:"Chronology",graph:"Graph",languages:"Linguistics"},uj={title:"Settings",general:"General",appearance:"Appearance",language:"Language",theme:"Theme",font:"Typography",font_size:"Font Size",unauthorized:"Unauthorized",sync:"Synchronization",backup:"Backup",edit_template:"Edit Template",available_templates:"Available Templates",no_templates:"No Templates",is_global:"Is Global?",name:"Name",type:"Type"},cj={title:"Writing",library:"Architect's Library",library_desc:"Manage your Archives and Chronicles",new_notebook:"New Archivador",new_page:"New Page",index:"Index",notes:"Notes",format:"Format",empty:"Empty page...",active_notebook:"Active Archivador",open_archivador:"Open Archivador",book_title:"Book Title",placeholder_title:"The Chronicles of the Void...",create_and_open:"Create and Open",expansion:"Library Expansion",delete_confirm:"Are you sure you want to delete this archivador? All its pages will be lost.",chapter:"Chapter",page:"Page",of:"of"},dj={grid_system:"Grid System",size:"Size",canvas_data:"Canvas Data",width:"Width (px)",height:"Height (px)",background_image:"Background Image",upload_image:"Upload New Image",remove_image:"Remove Image",explorer:"World Explorer",not_found:"Map Image Not Found",upload_desc:"Upload a map image in the editor to get started",fullscreen:"Fullscreen",share:"Share",inhabitants:"Key Inhabitants",related_events:"Related Events",open_bible:"Open in Bible",place:"Place",capital:"Capital",new_map:"New Map"},fj={explore:"Explore",explorer:"Explorer",templates:"Templates",drag_attributes:"Drag Attributes",search_entity:"Search entity...",filter_type:"Filter by Type",all:"All",entities:"Entities",maps:"Maps",timelines:"Timelines",new_folder:"New Folder",new_timeline:"New Timeline",delete_folder:"Delete Folder",delete_folder_msg:"Are you sure you want to delete this folder and all its contents?",delete_entity:"Delete Entity",delete_entity_msg:"Are you sure you want to delete this entity from the Bible?",no_favorites:"No favorites yet",favorites:"Favorites",root_index:"Root Index",central_archive:"Central archive of all entities, timelines, and world geographical records.",empty_archive:"Empty Archive",empty_archive_desc:"Start by creating your first folder or timeline to organize knowledge."},hj={title:"Timeline",add_event:"Add Event",add_line:"New Timeline",edit_event:"Edit Event",edit_line:"Edit Timeline",delete_event:"Delete Event",delete_line:"Delete Timeline",events_tab:"Events",annexes_tab:"Annexes",linked_timelines:"Linked Timelines",available_timelines:"Available Timelines",multiverse:"Multiverse",new_universe:"New Universe",universe_settings:"Universe Settings",delete_universe_confirm:"Delete this universe and ALL its timelines? This cannot be undone.",select_timeline:"Select Timeline",no_events:"No events yet. Use the right panel to add one.",event_name:"Event Name",date_label:"Date Label",order:"Order (Sort)",description:"Description",save_changes:"Save Changes",create_event:"Create Event",delete_event_btn:"Delete Event",annexed_desc:"Link other localized timelines to this one to verify chronological consistency.",no_linked:"No linked timelines.",available_to_link:"Available to Link",no_available:"No other timelines available.",universe_name:"Universe Name",universe_desc:"Context for this universe...",add_timeline_here:"Add Timeline here",no_timelines:"No timelines here"},pj={title:"Linguistics",lexicon:"Lexicon",grammar:"Grammar Rules",writing_system:"Writing System",phonology:"Phonology",translator:"Translator",new_word:"Add New Word",new_rule:"Define New Rule",open_editor:"Open Editor",auto_saved:"Auto-Saved",desc:"A conlang belonging to {{projectName}}. Manage its lexicon, grammar rules, and writing systems here.",stats:{words:"Words",rules:"Rules",glyphs:"Glyphs"},search_lexicon:"Search word or meaning...",manage:"Manage",moon_script:"Moon Script",inventory:"Vowel Inventory",vectors:"Vector Symbols",upload_svg:"Upload SVG",live_stream:"Live Logographic Stream",rendered_output:"Rendered Output",source_text:"Source text here..."},mj={dashboard_desc:"Project Dashboard",welcome:"Welcome,",welcome_desc:"Your world is waiting to be shaped. Use the Codex to document entities, the Atlas to map out geographies, or the Chronicles to write its history.",codex_title:"Codex",codex_desc:"World Bible and Entity Database",atlas_title:"Atlas",atlas_desc:"Interactive Cartography and Geography",chronicles_title:"Chronicles",chronicles_desc:"Narrative Writing and Notebook Management",graph_title:"Graph",graph_desc:"Visualization of Connections and Relations",timeline_title:"Chronology",timeline_desc:"Timelines and Historical Events",linguistics_title:"Linguistics",linguistics_desc:"Conlang Creation and Glyphs",explore_tool:"Explore Tool"},gj={common:oj,nav:lj,settings:uj,writing:cj,atlas:dj,bible:fj,timeline:hj,linguistics:pj,project:mj},OM=ne.createContext(),vj={es:sj,en:gj},yj=({children:t})=>{const[e,r]=ne.useState(()=>{const a=localStorage.getItem("app_settings");if(a)try{return JSON.parse(a).language||"es"}catch{return"es"}return"es"}),n=a=>{const s=a.split(".");let o=vj[e];for(const l of s)if(o&&o[l])o=o[l];else return a;return o},i=a=>{r(a);const s=localStorage.getItem("app_settings");let o={};if(s)try{o=JSON.parse(s)}catch{}localStorage.setItem("app_settings",JSON.stringify({...o,language:a}))};return m.jsx(OM.Provider,{value:{language:e,t:n,changeLanguage:i},children:t})},Ps=()=>{const t=ne.useContext(OM);if(!t)throw new Error("useLanguage must be used within a LanguageProvider");return t},cp=({icon:t,title:e,desc:r,color:n,onClick:i,t:a})=>m.jsxs("div",{onClick:i,className:"group relative p-8 rounded-[32px] bg-surface-dark border border-white/5 hover:border-white/10 transition-all cursor-pointer flex flex-col h-full gap-6 hover:shadow-2xl hover:shadow-black/40",children:[m.jsx("div",{className:`size-14 rounded-2xl ${n} flex items-center justify-center text-white shadow-lg group-hover:scale-110 transition-all duration-500`,children:m.jsx("span",{className:"material-symbols-outlined text-3xl",children:t})}),m.jsxs("div",{className:"space-y-4",children:[m.jsx("h3",{className:"text-2xl font-bold text-white tracking-tight",children:e}),m.jsx("p",{className:"text-slate-500 text-sm leading-relaxed",children:r})]}),m.jsxs("div",{className:"mt-auto pt-6 border-t border-white/5 flex items-center justify-between text-[10px] font-black uppercase tracking-widest text-slate-500 group-hover:text-white transition-colors",children:[m.jsx("span",{children:a("project.explore_tool")}),m.jsx("span",{className:"material-symbols-outlined text-sm group-hover:translate-x-1 transition-transform",children:"arrow_forward"})]})]}),xj=()=>{const{projectName:t}=bo(),e=Ga(),{username:r}=Va(),{t:n}=Ps(),i=`/${r}/${t}`,[a,s]=Qt.useState(null);return Qt.useEffect(()=>{const o=localStorage.getItem("user");o&&o!=="undefined"&&s(JSON.parse(o))},[]),m.jsxs("div",{className:"flex-1 flex flex-col h-screen overflow-hidden bg-background-dark",children:[m.jsxs("div",{className:"h-20 border-b border-white/5 flex items-center justify-between px-12 bg-surface-dark/20 backdrop-blur-xl shrink-0",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("div",{className:"size-10 rounded-xl bg-primary/20 flex items-center justify-center text-primary shadow-lg shadow-primary/10",children:m.jsx("span",{className:"material-symbols-outlined",children:"auto_stories"})}),m.jsxs("div",{children:[m.jsx("h1",{className:"text-xl font-black text-white tracking-tight uppercase",children:t}),m.jsx("p",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:n("project.dashboard_desc")})]})]}),m.jsx("div",{className:"flex items-center gap-4",children:m.jsx("div",{className:"flex -space-x-2",children:m.jsx("div",{className:"size-8 rounded-full border-2 border-surface-dark bg-indigo-500 overflow-hidden flex items-center justify-center text-[10px] font-black text-white shadow-lg",children:a?.avatarUrl?m.jsx("img",{src:a.avatarUrl,alt:"Me",className:"w-full h-full object-cover"}):m.jsx("span",{children:(a?.displayName||r)?.substring(0,2).toUpperCase()})})})})]}),m.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar",children:m.jsxs("div",{className:"max-w-7xl mx-auto p-12 space-y-16 animate-in fade-in slide-in-from-bottom-8 duration-700",children:[m.jsxs("div",{className:"space-y-4 max-w-2xl",children:[m.jsxs("h2",{className:"text-4xl font-black text-white tracking-tighter leading-tight",children:[n("project.welcome")," ",m.jsx("span",{className:"text-indigo-400",children:a?.displayName||n("common.architect")}),"."]}),m.jsx("p",{className:"text-slate-400 text-lg font-serif italic leading-relaxed opacity-80",children:n("project.welcome_desc")})]}),m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:[m.jsx(cp,{icon:"menu_book",title:n("project.codex_title"),desc:n("project.codex_desc"),color:"bg-indigo-600 shadow-indigo-500/20",onClick:()=>e(`${i}/bible`),t:n}),m.jsx(cp,{icon:"map",title:n("project.atlas_title"),desc:n("project.atlas_desc"),color:"bg-emerald-600 shadow-emerald-500/20",onClick:()=>e(`${i}/map`),t:n}),m.jsx(cp,{icon:"edit_note",title:n("project.chronicles_title"),desc:n("project.chronicles_desc"),color:"bg-amber-600 shadow-amber-500/20",onClick:()=>e(`${i}/writing`),t:n}),m.jsx(cp,{icon:"hub",title:n("project.graph_title"),desc:n("project.graph_desc"),color:"bg-purple-600 shadow-purple-500/20",onClick:()=>e(`${i}/graph`),t:n}),m.jsx(cp,{icon:"calendar_month",title:n("project.timeline_title"),desc:n("project.timeline_desc"),color:"bg-rose-600 shadow-rose-500/20",onClick:()=>e(`${i}/timeline`),t:n}),m.jsx(cp,{icon:"translate",title:n("project.linguistics_title"),desc:n("project.linguistics_desc"),color:"bg-blue-600 shadow-blue-500/20",onClick:()=>e(`${i}/linguistics`),t:n})]})]})})]})},bj=()=>{const t=Ga(),[e,r]=ne.useState(null),[n,i]=ne.useState([]),[a,s]=ne.useState([]),[o,l]=ne.useState("general"),[u,c]=ne.useState([]),[f,p]=ne.useState({theme:"deep_space",font:"Outfit",fontSize:16});ne.useEffect(()=>{try{const O=localStorage.getItem("user");O&&O!=="undefined"&&r(JSON.parse(O));const F=localStorage.getItem("app_settings");F&&p(JSON.parse(F));const z=localStorage.getItem("sync_projects");z&&s(JSON.parse(z)),g()}catch(O){console.error("Failed to parse user settings",O)}},[]);const g=async()=>{try{const O=await $e.get("/workspaces");O&&i(O)}catch(O){console.error("Error loading projects for sync",O)}},y=(O,F="success")=>{const z=Date.now();c(G=>[...G,{id:z,message:O,type:F}]),setTimeout(()=>{c(G=>G.filter(Z=>Z.id!==z))},3e3)},S=(O,F)=>{const z={...f,[O]:F};p(z),localStorage.setItem("app_settings",JSON.stringify(z)),window.dispatchEvent(new Event("storage_update")),y(`Ajuste actualizado: ${O}`)},w=O=>{const F=a.includes(O),z=F?a.filter(G=>G!==O):[...a,O];s(z),localStorage.setItem("sync_projects",JSON.stringify(z)),y(F?"Universo desmarcado de sincronizacin":"Universo incluido en sincronizacin")},C=()=>{y("Iniciando descarga de backup...","info");const O=document.createElement("a"),F="/api/backup/download",z=a.length>0?`?projects=${a.join(",")}`:"";O.href=F+z,O.setAttribute("download",`worldbuilding_backup_${Date.now()}.zip`),document.body.appendChild(O),O.click(),document.body.removeChild(O)},_=Qt.useRef(null),T=async O=>{const F=O.target.files[0];if(!F)return;if(!F.name.endsWith(".db")){y("Solo se permiten archivos .db","error");return}const z=new FormData;z.append("file",F),y("Importando universo...","info");try{const G=await $e.post("/import/database",z);y(G.message||"Universo importado con xito"),g()}catch(G){console.error("Import error",G);const Z=G.response?.data?.error||"Error al importar el archivo";y(Z,"error")}_.current&&(_.current.value="")},N=O=>{const F=O.target.files[0];if(!F)return;if(F.size>1024*1024){y("Imagen demasiado grande (mx 1MB)","error");return}const z=new FileReader;z.onload=G=>{const Z=G.target.result,I={...e||{},avatarUrl:Z};r(I);try{localStorage.setItem("user",JSON.stringify(I)),y("Foto de perfil actualizada","success")}catch(W){y("Error al guardar imagen (memoria llena)","error"),console.error("Storage error",W)}},z.readAsDataURL(F)},R=(O,F)=>{const z={...e||{},[O]:F};r(z),localStorage.setItem("user",JSON.stringify(z)),window.dispatchEvent(new Event("storage_update"))},D=[{id:"general",label:"General / Sincro",icon:"person"},{id:"appearance",label:"Apariencia y Editor",icon:"palette"}],j=[{id:"deep_space",label:"Deep Space",color:"#0f172a"},{id:"nebula",label:"Nebula",color:"#312e81"},{id:"high_contrast",label:"High Contrast",color:"#000000"}];return m.jsxs("div",{className:"flex flex-col w-full h-full bg-[#050508] text-white font-sans overflow-hidden relative",children:[m.jsxs("div",{className:"absolute inset-0 pointer-events-none overflow-hidden opacity-50",children:[m.jsx("div",{className:"absolute -top-[10%] -left-[10%] size-[40%] bg-indigo-500/10 blur-[120px] rounded-full animate-pulse"}),m.jsx("div",{className:"absolute -bottom-[10%] -right-[10%] size-[40%] bg-purple-500/5 blur-[120px] rounded-full animate-pulse",style:{animationDelay:"1s"}})]}),m.jsx("div",{className:"fixed top-24 right-8 z-[100] flex flex-col gap-3",children:u.map(O=>m.jsxs("div",{className:"flex items-center gap-3 px-6 py-4 bg-surface-dark border border-white/10 rounded-2xl shadow-2xl animate-slide-in-right",children:[m.jsx("span",{className:`material-symbols-outlined ${O.type==="success"?"text-green-400":"text-indigo-400"}`,children:O.type==="success"?"check_circle":"info"}),m.jsx("span",{className:"text-sm font-bold",children:O.message})]},O.id))}),m.jsxs("header",{className:"h-20 flex-none flex items-center justify-between px-12 border-b border-white/5 bg-[#0a0a0e] z-30",children:[m.jsxs("div",{className:"flex items-center gap-8",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("div",{className:"size-10 rounded-xl bg-indigo-500 flex items-center justify-center text-white shadow-lg shadow-indigo-500/20",children:m.jsx("span",{className:"material-symbols-outlined text-2xl",children:"settings"})}),m.jsx("h1",{className:"text-xl font-bold tracking-tight hidden sm:block",children:"Ajustes"})]}),m.jsx("nav",{className:"flex items-center gap-2 p-1 bg-white/5 rounded-2xl",children:D.map(O=>m.jsxs("button",{onClick:()=>l(O.id),className:`flex items-center gap-2 px-5 py-2.5 rounded-xl text-xs font-bold transition-all ${o===O.id?"bg-indigo-500 text-white shadow-lg shadow-indigo-500/20":"text-slate-400 hover:text-white hover:bg-white/5"}`,children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:O.icon}),O.label]},O.id))})]}),m.jsxs("button",{onClick:()=>t(-1),className:"flex items-center gap-2 px-6 py-2.5 bg-white/5 hover:bg-white/10 border border-white/10 rounded-2xl transition-all text-xs font-bold text-slate-400 hover:text-white",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"arrow_back"}),m.jsx("span",{children:"Volver"})]})]}),m.jsx("main",{className:"flex-1 overflow-y-auto p-12 custom-scrollbar",children:m.jsxs("div",{className:"max-w-3xl mx-auto pb-24 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[o==="general"&&m.jsxs("div",{className:"space-y-6",children:[m.jsxs("section",{className:"bg-[#0f0f13] border border-white/5 rounded-3xl p-8",children:[m.jsxs("h3",{className:"text-lg font-bold mb-6 flex items-center gap-2 text-indigo-400",children:[m.jsx("span",{className:"material-symbols-outlined",children:"person"}),"Perfil de Arquitecto"]}),m.jsxs("div",{className:"flex items-center gap-6 p-6 bg-white/5 rounded-3xl border border-white/5 group relative overflow-hidden",children:[m.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-indigo-500/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none"}),m.jsxs("div",{className:"relative",children:[m.jsx("div",{className:"size-20 rounded-full bg-indigo-500 flex items-center justify-center text-white text-3xl font-black shadow-2xl border-4 border-white/10 overflow-hidden",children:e?.avatarUrl?m.jsx("img",{src:e.avatarUrl,alt:"Profile",className:"w-full h-full object-cover"}):e?.displayName?.substring(0,2).toUpperCase()||e?.username?.substring(0,2).toUpperCase()||"AR"}),m.jsxs("label",{className:"absolute -bottom-1 -right-1 size-8 bg-indigo-500 rounded-full flex items-center justify-center text-white cursor-pointer hover:scale-110 transition-all border-4 border-[#0f0f13] shadow-lg",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"photo_camera"}),m.jsx("input",{type:"file",accept:"image/*",onChange:N,className:"hidden"})]})]}),m.jsxs("div",{className:"flex-1 space-y-2",children:[m.jsx("input",{type:"text",value:e?.displayName??"",onChange:O=>R("displayName",O.target.value),placeholder:e?.username||"Tu nombre de arquitecto...",className:"bg-transparent border-none text-2xl font-black text-white outline-none focus:ring-0 w-full p-0 placeholder-white/20"}),m.jsx("p",{className:"text-[10px] font-black uppercase tracking-widest text-indigo-400",children:"Architect Rank  Local Session"})]})]})]}),m.jsxs("section",{className:"bg-[#0f0f13] border border-white/5 rounded-3xl p-8 space-y-6",children:[m.jsxs("div",{className:"flex justify-between items-center",children:[m.jsxs("h3",{className:"text-lg font-bold flex items-center gap-2 text-indigo-400",children:[m.jsx("span",{className:"material-symbols-outlined",children:"sync_lock"}),"Sincronizacin y Respaldo"]}),m.jsxs("div",{className:"flex gap-3",children:[m.jsx("input",{type:"file",ref:_,onChange:T,accept:".db",className:"hidden"}),m.jsxs("button",{onClick:()=>_.current?.click(),className:"flex items-center gap-2 px-6 py-3 border border-white/5 bg-white/5 hover:bg-white/10 text-white rounded-2xl text-xs font-black uppercase tracking-widest transition-all",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"upload_file"}),"Importar Universo"]}),m.jsxs("button",{onClick:C,className:"flex items-center gap-2 px-6 py-3 bg-indigo-500 hover:bg-indigo-600 text-white rounded-2xl text-xs font-black uppercase tracking-widest transition-all shadow-lg shadow-indigo-500/30",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"cloud_download"}),"Descargar Backup ZIP"]})]})]}),m.jsxs("div",{className:"space-y-4",children:[m.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-slate-500 block",children:"Universos para sincronizacin"}),m.jsx("div",{className:"grid grid-cols-2 gap-3",children:n.length>0?n.map(O=>m.jsxs("button",{onClick:()=>w(O.filename),className:`flex items-center gap-3 p-4 rounded-2xl border transition-all text-left ${a.includes(O.filename)?"border-indigo-500 bg-indigo-500/10 text-white":"border-white/5 bg-black/20 text-slate-400 hover:border-white/10"}`,children:[m.jsx("span",{className:"material-symbols-outlined text-lg",children:a.includes(O.filename)?"check_circle":"circle"}),m.jsx("div",{className:"truncate",children:m.jsx("p",{className:"text-xs font-bold truncate",children:O.title})})]},O.filename)):m.jsx("div",{className:"col-span-2 p-8 border border-dashed border-white/5 rounded-2xl text-center text-slate-600 text-xs italic text-glass-muted",children:"No hay universos detectados..."})})]})]})]}),o==="appearance"&&m.jsxs("div",{className:"space-y-6",children:[m.jsxs("section",{className:"bg-[#0f0f13] border border-white/5 rounded-3xl p-8",children:[m.jsxs("h3",{className:"text-lg font-bold mb-6 flex items-center gap-2 text-indigo-400",children:[m.jsx("span",{className:"material-symbols-outlined",children:"palette"}),"Esttica del Sistema"]}),m.jsx("div",{className:"grid grid-cols-3 gap-6",children:j.map(O=>m.jsxs("button",{onClick:()=>S("theme",O.id),className:`relative flex flex-col gap-3 group text-left transition-all p-3 rounded-2xl border ${f.theme===O.id?"border-indigo-500 bg-indigo-500/5 ring-1 ring-indigo-500/50":"border-white/5 bg-black/20 hover:border-white/20"}`,children:[m.jsx("div",{className:"h-24 rounded-xl flex items-center justify-center overflow-hidden",style:{backgroundColor:O.color},children:m.jsx("div",{className:"size-10 rounded-full bg-white/10 backdrop-blur-xl border border-white/10"})}),m.jsx("span",{className:"text-xs font-bold text-center",children:O.label})]},O.id))})]}),m.jsxs("section",{className:"bg-[#0f0f13] border border-white/5 rounded-3xl p-8",children:[m.jsxs("h3",{className:"text-lg font-bold mb-6 flex items-center gap-2 text-indigo-400",children:[m.jsx("span",{className:"material-symbols-outlined",children:"text_fields"}),"Tipografa y Lectura"]}),m.jsxs("div",{className:"grid grid-cols-2 gap-12",children:[m.jsxs("div",{className:"space-y-4",children:[m.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-slate-500",children:"Fuente del Codex"}),m.jsxs("div",{className:"relative",children:[m.jsxs("select",{value:f.font,onChange:O=>S("font",O.target.value),className:"w-full bg-[#0f0f13] border border-white/10 rounded-xl px-5 py-3.5 text-sm text-white appearance-none outline-none focus:border-indigo-500 transition-all",style:{fontFamily:f.font},children:[m.jsx("option",{value:"Lexend",className:"bg-[#0f0f13] text-white",children:"Lexend (UI Moderna)"}),m.jsx("option",{value:"Outfit",className:"bg-[#0f0f13] text-white",children:"Outfit (Sleek)"}),m.jsx("option",{value:"Cormorant Garamond",className:"bg-[#0f0f13] text-white",children:"Cormorant (Legendaria)"}),m.jsx("option",{value:"Playfair Display",className:"bg-[#0f0f13] text-white",children:"Playfair (Elegante)"}),m.jsx("option",{value:"JetBrains Mono",className:"bg-[#0f0f13] text-white",children:"JetBrains Mono (Codex)"})]}),m.jsx("span",{className:"material-symbols-outlined absolute right-4 top-1/2 -translate-y-1/2 pointer-events-none text-slate-500",children:"expand_more"})]})]}),m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{className:"flex justify-between items-center",children:[m.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-slate-500",children:"Tamao del Texto"}),m.jsxs("span",{className:"text-xs font-bold text-indigo-400",children:[f.fontSize,"px"]})]}),m.jsx("div",{className:"flex items-center gap-4 py-3",children:m.jsx("input",{type:"range",min:"12",max:"24",value:f.fontSize,onChange:O=>S("fontSize",parseInt(O.target.value)),className:"flex-1 accent-indigo-500 h-1 bg-white/10 rounded-full appearance-none cursor-pointer"})})]})]}),m.jsxs("div",{className:"mt-12 space-y-4 border-t border-white/5 pt-8",children:[m.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-slate-500",children:"Preferencia de Idioma / Language"}),m.jsxs("div",{className:"flex gap-4",children:[m.jsxs("button",{onClick:()=>S("language","es"),className:`flex-1 py-4 rounded-2xl border transition-all flex items-center justify-center gap-3 font-bold text-xs ${f.language==="es"||!f.language?"border-primary bg-primary/10 text-white shadow-lg":"border-white/5 bg-black/20 text-slate-400"}`,children:[m.jsx("span",{className:"text-xl",children:""}),"Castellano"]}),m.jsxs("button",{onClick:()=>S("language","en"),className:`flex-1 py-4 rounded-2xl border transition-all flex items-center justify-center gap-3 font-bold text-xs ${f.language==="en"?"border-primary bg-primary/10 text-white shadow-lg":"border-white/5 bg-black/20 text-slate-400"}`,children:[m.jsx("span",{className:"text-xl",children:""}),"English"]})]})]}),m.jsx("div",{className:"mt-8 p-6 bg-black/40 rounded-2xl border border-white/5 text-center shadow-inner",children:m.jsx("p",{style:{fontFamily:f.font,fontSize:`${f.fontSize}px`},className:"text-slate-200 transition-all duration-300",children:'"El universo es un libro escrito en el lenguaje de las historias."'})})]})]})]})})]})},Zv=({isOpen:t,onClose:e,onConfirm:r,title:n,message:i,confirmText:a="Confirmar",cancelText:s="Cancelar",type:o="danger"})=>t?eo.createPortal(m.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[m.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",onClick:e}),m.jsxs("div",{className:"relative w-full max-w-md bg-[#0a0a0c] border border-white/10 rounded-3xl shadow-2xl p-6 animate-in zoom-in-95 duration-200 overflow-hidden",children:[m.jsx("div",{className:"absolute top-0 left-0 right-0 h-32 bg-gradient-to-b from-white/5 to-transparent pointer-events-none"}),m.jsxs("div",{className:"relative z-10 text-center",children:[m.jsx("div",{className:`mx-auto mb-4 size-16 rounded-2xl flex items-center justify-center ${o==="danger"?"bg-red-500/10 text-red-500":"bg-yellow-500/10 text-yellow-500"}`,children:m.jsx("span",{className:"material-symbols-outlined text-3xl",children:o==="danger"?"delete_forever":"warning"})}),m.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:n}),m.jsx("p",{className:"text-text-muted text-sm mb-8 leading-relaxed",children:i}),m.jsxs("div",{className:"flex gap-3",children:[m.jsx("button",{onClick:e,className:"flex-1 px-4 py-3 rounded-xl bg-surface-light hover:bg-white/10 text-text-muted hover:text-white text-xs font-bold transition-all border border-white/5",children:s}),m.jsx("button",{onClick:()=>{r(),e()},className:`flex-1 px-4 py-3 rounded-xl text-white text-xs font-bold transition-all shadow-lg flex items-center justify-center gap-2
                                ${o==="danger"?"bg-red-500 hover:bg-red-600 shadow-red-500/20":"bg-primary hover:bg-primary-light shadow-primary/20"}`,children:m.jsx("span",{children:a})})]})]})]})]}),document.body):null,wj=t=>{const e=`notebooks_v2_${t}`,[r,n]=ne.useState(()=>{const a=localStorage.getItem(e);return a?JSON.parse(a):[]});return[r,a=>{n(a),localStorage.setItem(e,JSON.stringify(a))}]},Sj=({projectId:t})=>{const{t:e}=Ps(),[r,n]=wj(t||"global"),[i,a]=ne.useState(null),[s,o]=ne.useState(null),[l,u]=ne.useState(null),c=()=>{const g={id:Date.now().toString(),title:"Nuevo Cuaderno",content:"",updatedAt:new Date().toISOString()};n([g,...r]),o(g.id)},f=(g,y,S)=>{const w=r.map(C=>C.id===g?{...C,[y]:S,updatedAt:new Date().toISOString()}:C);n(w),i&&i.id===g&&a({...i,[y]:S})},p=()=>{l&&(n(r.filter(g=>g.id!==l)),i&&i.id===l&&a(null),u(null))};return i?m.jsxs("div",{className:"flex flex-col h-full bg-surface-dark/50 animate-in slide-in-from-right-4 duration-300",children:[m.jsxs("div",{className:"flex items-center gap-2 p-3 border-b border-white/5 bg-white/[0.02]",children:[m.jsx("button",{onClick:()=>a(null),className:"p-1.5 rounded-lg hover:bg-primary/10 text-slate-400 hover:text-primary transition-colors",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"arrow_back"})}),m.jsx("input",{className:"bg-transparent border-none outline-none font-bold text-white text-sm w-full placeholder-slate-600",value:i.title,onChange:g=>f(i.id,"title",g.target.value),placeholder:"Ttulo del Cuaderno..."})]}),m.jsx("textarea",{className:"flex-1 w-full bg-transparent p-4 text-sm text-slate-300 outline-none resize-none custom-scrollbar leading-relaxed",placeholder:"Escribe aqu tus ideas...",value:i.content||"",onChange:g=>f(i.id,"content",g.target.value),autoFocus:!0}),m.jsx("div",{className:"p-2 text-[10px] text-slate-600 text-right border-t border-white/5",children:i.updatedAt?`Guardado: ${new Date(i.updatedAt).toLocaleTimeString()}`:"Sin guardar"})]}):m.jsxs("div",{className:"flex flex-col h-full bg-surface-dark/50",children:[m.jsxs("div",{className:"flex items-center justify-between p-3 border-b border-white/5 bg-white/[0.02]",children:[m.jsx("h3",{className:"text-xs font-black uppercase tracking-widest text-slate-400",children:"Tus Cuadernos"}),m.jsxs("button",{onClick:c,className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-primary/20 text-primary hover:bg-primary/30 transition-all text-[10px] font-bold uppercase tracking-wide border border-primary/20",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"add"}),"Nuevo"]})]}),m.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-3 space-y-2",children:r.length===0?m.jsxs("div",{className:"flex flex-col items-center justify-center py-10 text-slate-600 space-y-2 opacity-60",children:[m.jsx("span",{className:"material-symbols-outlined text-3xl",children:"library_books"}),m.jsx("p",{className:"text-xs",children:"No hay cuadernos"})]}):r.map(g=>m.jsxs("div",{onClick:()=>a(g),className:"group relative bg-white/5 hover:bg-white/10 border border-white/5 hover:border-primary/30 rounded-xl p-3 cursor-pointer transition-all hover:translate-x-1",children:[m.jsxs("div",{className:"flex justify-between items-start mb-2",children:[s===g.id?m.jsx("input",{className:"bg-black/50 border border-primary/50 text-white text-xs font-bold rounded px-1 outline-none w-full mr-6",value:g.title,onChange:y=>f(g.id,"title",y.target.value),onBlur:()=>o(null),onKeyDown:y=>y.key==="Enter"&&o(null),autoFocus:!0,onClick:y=>y.stopPropagation()}):m.jsx("h4",{className:"text-xs font-bold text-white truncate pr-6 group-hover:text-primary transition-colors",children:g.title}),m.jsx("button",{onClick:y=>{y.stopPropagation(),u(g.id)},className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 p-1 hover:text-red-400 text-slate-500 transition-all bg-surface-dark rounded-md shadow-lg shadow-black/40",children:m.jsx("span",{className:"material-symbols-outlined text-[14px]",children:"delete"})})]}),m.jsx("p",{className:"text-[10px] text-slate-500 line-clamp-2",children:g.content||"Sin contenido..."})]},g.id))}),m.jsx(Zv,{isOpen:!!l,onClose:()=>u(null),onConfirm:p,title:"Eliminar Cuaderno",message:"Ests seguro? Esta accin no se puede deshacer.",confirmText:"Eliminar",type:"danger"})]})},th={UNIVERSE:{id:"UNIVERSE",label:"Universo / Multiverso",description:"Contenedor supremo de realidades.",icon:"public",color:"text-purple-400",bgColor:"bg-purple-900/20"},GALAXY:{id:"GALAXY",label:"Galaxia",description:"Agrupacin masiva de sistemas estelares.",icon:"auto_awesome",color:"text-indigo-400",bgColor:"bg-indigo-900/20"},SYSTEM:{id:"SYSTEM",label:"Sistema Solar",description:"Estrella central y sus cuerpos orbitales.",icon:"wb_sunny",color:"text-yellow-400",bgColor:"bg-yellow-900/20"},PLANET:{id:"PLANET",label:"Planeta / Mundo",description:"Cuerpo celeste o plano de existencia principal.",icon:"public",color:"text-emerald-400",bgColor:"bg-emerald-900/20"},GEOGRAPHY:{id:"GEOGRAPHY",label:"Geografa",icon:"map",color:"text-green-300"},ENTITIES:{id:"ENTITIES",label:"Entidades",icon:"groups",color:"text-blue-300"},MAGIC:{id:"MAGIC",label:"Magia",icon:"auto_fix_high",color:"text-pink-300"},TIMELINE:{id:"TIMELINE",label:"Cronologa",icon:"history",color:"text-orange-300"},FACTIONS:{id:"FACTIONS",label:"Facciones",icon:"security",color:"text-red-300"},ITEMS:{id:"ITEMS",label:"Objetos",icon:"inventory_2",color:"text-gray-300"},FOLDER:{id:"FOLDER",label:"Carpeta",icon:"folder",color:"text-gray-400"}},BS=t=>th[t]||th.FOLDER,kj=t=>{switch(t?.toLowerCase()){case"text":return"notes";case"short_text":return"short_text";case"number":return"pin";case"date":return"calendar_today";case"select":return"list";case"boolean":return"check_box";case"map":return"map";case"timeline":return"timeline";case"character":case"entidadindividual":return"person";case"location":case"zona":case"construccion":return"location_on";case"culture":case"entidadcolectiva":return"groups";case"universe":case"galaxy":case"system":case"planet":return"public";case"entity_link":return"link";default:return"description"}},_j=(t,e,r,n)=>{const i=r.slug||r.id;return`/${t}/${e}/bible/folder/${n||"root"}/entity/${i}`},DM=({folder:t,onCreateSubfolder:e,onRename:r,onDeleteFolder:n,onDeleteEntity:i,onCreateTemplate:a,onMoveEntity:s,onDuplicateEntity:o,onCreateEntity:l,onConfirmCreate:u,searchTerm:c,filterType:f,className:p})=>{const{username:g,projectName:y}=Va(),S=Ga(),[w,C]=ne.useState(!1),[_,T]=ne.useState({folders:[],entities:[]}),[N,R]=ne.useState(!1),[D,j]=ne.useState(null),[O,F]=ne.useState(t.nombre),[z,G]=ne.useState(!1),[Z,I]=ne.useState(null);ne.useEffect(()=>{F(t.nombre)},[t.nombre]),ne.useEffect(()=>{c&&!w&&_.entities.some(se=>se.nombre.toLowerCase().includes(c.toLowerCase())&&(f==="ALL"||se.tipoEspecial===f))&&C(!0)},[c,_.entities]),ne.useEffect(()=>{const oe=se=>{const{folderId:he,optimisticType:ae,confirmedType:pe,removeId:ye,item:ve,oldId:ue,expand:xe,type:Se}=se.detail||{};if(he===t.id){if(xe&&(C(!0),N||W()),N)if(ae){const Ae=ae==="folder"?"folders":"entities";T(Me=>({...Me,[Ae]:[...Me[Ae].filter(st=>st.id!==ve.id),ve]}))}else if(pe){const Ae=pe==="folder"?"folders":"entities";T(Me=>({...Me,[Ae]:Me[Ae].map(st=>st.id===ue?ve:st)}))}else if(ye){const Ae=Se==="folder"?"folders":"entities";T(Me=>({...Me,[Ae]:Me[Ae].filter(st=>st.id!==ye)}))}else!ae&&!pe&&!ye&&W()}else se.detail?.targetFolderId===t.id&&se.detail?.type==="move-in"?N&&W():se.detail?.sourceFolderId===t.id&&se.detail?.type==="move-out"&&N&&T(Ae=>({...Ae,entities:Ae.entities.filter(Me=>Me.id!==Me.detail.entityId)}))};return window.addEventListener("folder-update",oe),()=>window.removeEventListener("folder-update",oe)},[t.id,N]);const W=async()=>{try{console.log("Loading content for folder:",t.id,"Slug:",t.slug);const[oe,se]=await Promise.all([$e.get(`/world-bible/folders/${t.id}/subfolders`),$e.get(`/world-bible/folders/${t.id}/entities`)]);T({folders:oe,entities:se}),R(!0)}catch(oe){console.error("Error reloading folder content:",oe),oe.message&&oe.message.includes("404")&&console.error(`404 for folder ${t.id} (${t.nombre})`)}},U=oe=>{oe.stopPropagation(),C(!w),!N&&!w&&W()},K=()=>S(`/${g}/${y}/bible/folder/${t.slug||t.id}`),$=(oe,se,he,ae)=>{oe.preventDefault(),oe.stopPropagation(),j({x:oe.clientX,y:oe.clientY,type:se,id:he,name:ae})},Q=()=>j(null);ne.useEffect(()=>{if(D)return window.addEventListener("click",Q),()=>window.removeEventListener("click",Q)},[D]);const ie=oe=>{if(oe.key==="Enter"){oe.preventDefault();const se=oe.target.value.trim();se?u(t.id,se,"folder",t.parentId,t.tipoEspecial):t.isNew&&i(t.id,t.parentId)}};if(t.isNew)return m.jsx("div",{className:"px-3 py-1 animate-in fade-in zoom-in-95 duration-200",children:m.jsx("input",{autoFocus:!0,type:"text",className:"w-full bg-surface-light border border-primary/50 rounded px-2 py-1 text-xs text-white outline-none",placeholder:"Folder Name...",onKeyDown:ie,onBlur:oe=>{const se=oe.target.value.trim();se?u(t.id,se,"folder",t.parentId):i(t.id,t.parentId)}})});const te=({item:oe,type:se})=>m.jsx("div",{className:"px-3 py-1 animate-in fade-in zoom-in-95 duration-200",children:m.jsx("input",{autoFocus:!0,type:"text",defaultValue:oe.nombre||"",className:"w-full bg-surface-light border border-primary/50 rounded px-2 py-1 text-xs text-white outline-none",placeholder:"Name...",onKeyDown:he=>{if(he.key==="Enter"){he.preventDefault();const ae=he.target.value.trim();ae?u(oe.id,ae,se,t.id,oe.tipoEspecial):oe.isNew&&i(oe.id,t.id),I(null)}else he.key==="Escape"&&(I(null),oe.isNew&&i(oe.id,t.id))},onBlur:he=>{const ae=he.target.value.trim();ae?u(oe.id,ae,se,t.id,oe.tipoEspecial):oe.isNew&&i(oe.id,t.id),I(null)}})}),X=oe=>{oe.preventDefault(),oe.stopPropagation(),oe.currentTarget.classList.add("bg-primary/20")},re=oe=>{oe.preventDefault(),oe.stopPropagation(),oe.currentTarget.classList.remove("bg-primary/20")},fe=oe=>{oe.preventDefault(),oe.stopPropagation(),oe.currentTarget.classList.remove("bg-primary/20");const se=oe.dataTransfer.getData("entityId"),he=oe.dataTransfer.getData("sourceFolderId");se&&he&&he!==String(t.id)&&s(se,t.id,he)};return m.jsxs("div",{className:`space-y-1 select-none ${p||""}`,children:[m.jsxs("div",{className:"flex items-center gap-3 px-3 py-2 rounded-xl text-xs font-bold text-text-muted hover:text-primary hover:bg-primary/5 cursor-pointer transition-all group relative",onClick:K,onContextMenu:oe=>$(oe,"folder",t.id,t.nombre),onDragOver:X,onDragLeave:re,onDrop:fe,children:[m.jsx("span",{onClick:U,className:`material-symbols-outlined text-lg transition-transform hover:text-primary ${w?"rotate-90 text-primary":"opacity-50"}`,children:"chevron_right"}),m.jsx("span",{className:`material-symbols-outlined text-lg ${BS(t.tipo).color}`,children:BS(t.tipo).icon}),z?m.jsx("input",{autoFocus:!0,className:"bg-surface-light border border-primary/50 rounded px-2 py-0.5 text-xs text-white outline-none flex-1 min-w-0",defaultValue:O,onKeyDown:async oe=>{if(oe.key==="Enter"){oe.preventDefault(),oe.stopPropagation();const se=oe.target.value.trim();if(se&&se!==O)try{await r(t.id,se),F(se)}catch(he){console.error("Rename failed",he)}G(!1)}else oe.key==="Escape"&&(oe.preventDefault(),oe.stopPropagation(),G(!1))},onBlur:()=>G(!1),onClick:oe=>oe.stopPropagation()}):m.jsx("span",{className:"truncate flex-1",children:O})]}),D&&m.jsxs("div",{className:"fixed bg-surface-dark border border-glass-border shadow-2xl rounded-xl py-2 z-50 w-48 text-xs font-medium flex flex-col",style:{top:D.y,left:D.x},onClick:oe=>oe.stopPropagation(),children:[m.jsx("div",{className:"px-4 py-2 border-b border-white/5 font-bold text-text-muted truncate",children:D.name}),D.type==="folder"?m.jsxs(m.Fragment,{children:[m.jsxs("button",{className:"px-4 py-2 hover:bg-white/5 text-left flex items-center gap-2",onClick:()=>{l(t.id,"entidadindividual"),Q()},children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"person"})," Add Character"]}),m.jsxs("button",{className:"px-4 py-2 hover:bg-white/5 text-left flex items-center gap-2",onClick:()=>{S(`/${g}/${y}/map-editor/create/${t.id}`),Q()},children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"map"})," Add Map"]}),m.jsx("div",{className:"h-px bg-white/5 my-1"}),m.jsxs("button",{className:"px-4 py-2 hover:bg-white/5 text-left flex items-center gap-2",onClick:()=>{G(!0),Q()},children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"edit"})," Rename Folder"]}),m.jsxs("button",{className:"px-4 py-2 hover:bg-red-500/10 text-red-400 text-left flex items-center gap-2",onClick:()=>{n(t.id,t.parentId),Q()},children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})," Delete Folder"]})]}):m.jsxs(m.Fragment,{children:[m.jsxs("button",{className:"px-4 py-2 hover:bg-white/5 text-left flex items-center gap-2 cursor-pointer",onClick:()=>{I(D.id),Q()},children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"edit"})," Rename"]}),m.jsxs("button",{className:"px-4 py-2 hover:bg-white/5 text-left flex items-center gap-2 cursor-pointer",onClick:()=>{o(D.id,t.id),Q()},children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"content_copy"})," Duplicar"]}),m.jsxs("button",{className:"px-4 py-2 hover:bg-red-500/10 text-red-400 text-left flex items-center gap-2",onClick:()=>{i(D.id,t.id),Q()},children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})," Delete Entity"]})]})]}),w&&m.jsxs("div",{className:"ml-6 pl-4 border-l border-glass-border space-y-1 animate-slide-in",children:[_.folders.map(oe=>m.jsx(DM,{folder:oe,onCreateSubfolder:e,onRename:r,onDeleteFolder:n,onDeleteEntity:i,onCreateTemplate:a,onDuplicateEntity:o,onCreateEntity:l,onConfirmCreate:u,searchTerm:c,filterType:f},oe.id)),_.entities.filter(oe=>{if(!c)return!0;const se=oe.nombre.toLowerCase().includes(c.toLowerCase()),he=f==="ALL"||oe.tipoEspecial===f;return se&&he}).map(oe=>oe.isNew||oe.id===Z?m.jsx(te,{item:oe,type:"entity"},oe.id):m.jsxs(hh,{to:_j(g,y,oe,t.slug||t.id),onContextMenu:se=>$(se,"entity",oe.id,oe.nombre),className:`flex items-center gap-3 px-3 py-2 rounded-xl text-[11px] font-medium text-text-muted hover:text-blue-400 hover:bg-blue-400/5 transition-all group cursor-grab active:cursor-grabbing ${oe.pending?"opacity-50 pointer-events-none":""}`,draggable:!oe.pending,onDragStart:se=>{se.dataTransfer.setData("entityId",oe.id),se.dataTransfer.setData("sourceFolderId",t.id)},children:[m.jsx("span",{className:"material-symbols-outlined text-sm opacity-70 group-hover:text-primary transition-colors",children:kj(oe.tipoEspecial)}),m.jsx("span",{className:"truncate flex-1",children:oe.nombre}),oe.favorite&&m.jsx("span",{className:"material-symbols-outlined text-[10px] text-yellow-500",title:"Favorito",children:"star"})]},oe.id)),N&&_.folders.length===0&&_.entities.length===0&&m.jsx("div",{className:"px-3 py-2 text-[10px] text-text-muted/30 uppercase font-black italic tracking-tighter",children:"Empty Sector"})]})]})},Cj=({isOpen:t,onClose:e,onToggle:r,contextContent:n,projectId:i,activeTab:a,setActiveTab:s,title:o,onClearContext:l,folders:u,searchTerm:c,setSearchTerm:f,filterType:p,setFilterType:g,handleCreateSimpleFolder:y,handleRenameFolder:S,handleDeleteFolder:w,handleMoveEntity:C,handleDuplicateEntity:_,handleCreateEntity:T,handleConfirmCreate:N})=>{const{t:R}=Ps();return Qt.useEffect(()=>{console.log("[GlobalRightPanel] contextContent changed:",!!n,"activeTab:",a),n&&a!=="EXPLORER"&&a!=="NOTEBOOKS"&&(console.log("[GlobalRightPanel] Auto-switching to CONTEXT tab"),s("CONTEXT"))},[n,a]),m.jsxs("aside",{className:`
                fixed top-0 right-0 h-full bg-surface-dark border-l border-glass-border shadow-2xl z-40 transition-all duration-500 ease-in-out flex flex-col
                ${t?"w-96 translate-x-0":"w-96 translate-x-full"}
            `,children:[m.jsxs("button",{onClick:r,className:`
                    absolute top-1/2 -translate-y-1/2 -left-10 w-10 h-24 
                    bg-surface-dark border border-glass-border border-r-0
                    rounded-l-2xl flex flex-col items-center justify-center gap-1
                    transition-all duration-300 group
                    hover:bg-primary/10 hover:border-primary/30
                    ${t?"text-primary shadow-[-4px_0_15px_-5px_rgba(var(--primary-rgb),0.3)]":"text-slate-500"}
                `,title:t?"Cerrar Panel":"Abrir Panel",children:[m.jsx("div",{className:`w-1 h-3 rounded-full bg-current opacity-20 transition-all duration-500 ${t?"h-6 opacity-40":""}`}),m.jsx("span",{className:`material-symbols-outlined text-lg transition-transform duration-500 ${t?"rotate-180":""}`,children:"side_navigation"}),m.jsx("div",{className:`w-1 h-3 rounded-full bg-current opacity-20 transition-all duration-500 ${t?"h-6 opacity-40":""}`}),m.jsx("div",{className:"absolute inset-0 rounded-l-2xl bg-primary/5 opacity-0 group-hover:opacity-100 transition-opacity"})]}),m.jsxs("div",{className:"flex items-center border-b border-glass-border bg-white/[0.02]",children:[m.jsxs("button",{onClick:()=>s("CONTEXT"),className:`flex-1 py-4 flex items-center justify-center gap-2 text-xs font-black uppercase tracking-widest transition-colors relative ${a==="CONTEXT"?"text-primary":"text-slate-500 hover:text-primary"}`,children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"view_sidebar"}),"Contexto",a==="CONTEXT"&&m.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-primary"})]}),m.jsxs("button",{onClick:()=>{l&&l(),s("NOTEBOOKS")},className:`flex-1 py-4 flex items-center justify-center gap-2 text-xs font-black uppercase tracking-widest transition-colors relative ${a==="NOTEBOOKS"?"text-primary":"text-slate-500 hover:text-primary"}`,children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"book"}),"Apuntes",a==="NOTEBOOKS"&&m.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-primary"})]}),m.jsxs("button",{onClick:()=>{l&&l(),s("EXPLORER")},className:`flex-1 py-4 flex items-center justify-center gap-2 text-xs font-black uppercase tracking-widest transition-colors relative ${a==="EXPLORER"?"text-primary":"text-slate-500 hover:text-primary"}`,children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"folder_open"}),"Explorador",a==="EXPLORER"&&m.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-primary"})]})]}),o&&a==="CONTEXT"&&m.jsx("div",{className:"px-6 py-3 border-b border-glass-border bg-white/[0.01]",children:m.jsx("div",{className:"text-sm font-bold text-white tracking-tight",children:o})}),m.jsxs("div",{className:"flex-1 overflow-hidden relative bg-black/20",children:[m.jsx("div",{className:`absolute inset-0 transition-opacity duration-300 flex flex-col ${a==="CONTEXT"?"opacity-100 z-10":"opacity-0 z-0 pointer-events-none"}`,children:n||m.jsx("div",{id:"global-right-panel-portal",className:"h-full flex flex-col relative overflow-y-auto custom-scrollbar"})}),m.jsx("div",{className:`absolute inset-0 transition-opacity duration-300 flex flex-col ${a==="NOTEBOOKS"?"opacity-100 z-10":"opacity-0 z-0 pointer-events-none"}`,children:m.jsx(Sj,{projectId:i})}),m.jsxs("div",{className:`absolute inset-0 transition-opacity duration-300 flex flex-col ${a==="EXPLORER"?"opacity-100 z-10":"opacity-0 z-0 pointer-events-none"}`,children:[m.jsxs("div",{className:"p-4 border-b border-glass-border",children:[m.jsxs("div",{className:"relative group mb-3",children:[m.jsx("span",{className:"material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-text-muted text-sm group-focus-within:text-primary transition-colors",children:"search"}),m.jsx("input",{type:"text",placeholder:R("bible.search_entity"),value:c,onChange:D=>f&&f(D.target.value),className:"w-full bg-surface-light/50 border border-glass-border rounded-xl py-2 pl-9 pr-3 text-xs focus:border-primary/50 outline-none transition-all text-white placeholder:text-text-muted/50"})]}),m.jsx("div",{className:"flex items-center gap-2",children:m.jsxs("div",{className:"relative flex-1",children:[m.jsxs("select",{value:p,onChange:D=>g&&g(D.target.value),className:"appearance-none bg-surface-dark border border-glass-border rounded-xl px-4 py-2 pr-10 text-xs font-bold text-white transition-all hover:bg-slate-800/50 focus:border-primary outline-none inline-flex items-center w-full",children:[m.jsx("option",{value:"ALL",children:" TODO"}),m.jsx("option",{value:"individual",children:" PERSONAJES"}),m.jsx("option",{value:"location",children:" LUGARES"}),m.jsx("option",{value:"culture",children:" CULTURAS"}),m.jsx("option",{value:"map",children:" MAPAS"}),m.jsx("option",{value:"timeline",children:" TIMELINES"})]}),m.jsx("span",{className:"material-symbols-outlined absolute right-3 top-1/2 -translate-y-1/2 text-xs text-text-muted pointer-events-none",children:"expand_more"})]})})]}),m.jsx("div",{className:"p-4 border-b border-glass-border pt-0",children:m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsx("h2",{className:"text-[10px] font-black uppercase tracking-widest text-text-muted",children:R("bible.explorer")}),m.jsx("div",{className:"relative",children:m.jsx("button",{className:"transition-colors hover:text-white text-primary",onClick:()=>y&&y(null),title:R("bible.new_folder"),children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"create_new_folder"})})})]})}),m.jsx("div",{className:"flex-1 overflow-y-auto no-scrollbar p-2 space-y-0.5",children:u&&u.length===0?m.jsxs("div",{className:"p-8 text-center opacity-30",children:[m.jsx("span",{className:"material-symbols-outlined text-3xl mb-2",children:"folder_off"}),m.jsx("p",{className:"text-[10px] uppercase font-bold",children:R("bible.empty_archive")})]}):u&&u.map(D=>m.jsx(DM,{folder:D,onCreateSubfolder:()=>{},onRename:S,onDeleteFolder:w,onDeleteEntity:w,onCreateTemplate:()=>{},onMoveEntity:C,onDuplicateEntity:_,onCreateEntity:T,onConfirmCreate:N,searchTerm:c,filterType:p},D.uiKey||D.id))})]})]})]})};var qb={exports:{}},$b,RE;function Ej(){if(RE)return $b;RE=1;var t="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return $b=t,$b}var Kb,OE;function Tj(){if(OE)return Kb;OE=1;var t=Ej();function e(){}function r(){}return r.resetWarningCache=e,Kb=function(){function n(s,o,l,u,c,f){if(f!==t){var p=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw p.name="Invariant Violation",p}}n.isRequired=n;function i(){return n}var a={array:n,bigint:n,bool:n,func:n,number:n,object:n,string:n,symbol:n,any:n,arrayOf:i,element:n,elementType:n,instanceOf:i,node:n,objectOf:i,oneOf:i,oneOfType:i,shape:i,exact:i,checkPropTypes:r,resetWarningCache:e};return a.PropTypes=a,a},Kb}var DE;function Nj(){return DE||(DE=1,qb.exports=Tj()()),qb.exports}var Pj=Nj();const Mj=Th(Pj);function zS(t,e){(e==null||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function Aj(t){if(Array.isArray(t))return t}function Lj(t){if(Array.isArray(t))return zS(t)}function sf(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Rj(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,jM(n.key),n)}}function of(t,e,r){return e&&Rj(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function Ys(t,e){var r=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=r_(t))||e){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a,s=!0,o=!1;return{s:function(){r=r.call(t)},n:function(){var l=r.next();return s=l.done,l},e:function(l){o=!0,a=l},f:function(){try{s||r.return==null||r.return()}finally{if(o)throw a}}}}function IM(t,e,r){return(e=jM(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Oj(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function Dj(t,e){var r=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(r!=null){var n,i,a,s,o=[],l=!0,u=!1;try{if(a=(r=r.call(t)).next,e===0){if(Object(r)!==r)return;l=!1}else for(;!(l=(n=a.call(r)).done)&&(o.push(n.value),o.length!==e);l=!0);}catch(c){u=!0,i=c}finally{try{if(!l&&r.return!=null&&(s=r.return(),Object(s)!==s))return}finally{if(u)throw i}}return o}}function Ij(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function jj(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Di(t,e){return Aj(t)||Dj(t,e)||r_(t,e)||Ij()}function lx(t){return Lj(t)||Oj(t)||r_(t)||jj()}function Fj(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}function jM(t){var e=Fj(t,"string");return typeof e=="symbol"?e:e+""}function qi(t){"@babel/helpers - typeof";return qi=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},qi(t)}function r_(t,e){if(t){if(typeof t=="string")return zS(t,e);var r={}.toString.call(t).slice(8,-1);return r==="Object"&&t.constructor&&(r=t.constructor.name),r==="Map"||r==="Set"?Array.from(t):r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?zS(t,e):void 0}}var Hi=typeof window>"u"?null:window,IE=Hi?Hi.navigator:null;Hi&&Hi.document;var Bj=qi(""),FM=qi({}),zj=qi(function(){}),Uj=typeof HTMLElement>"u"?"undefined":qi(HTMLElement),Yv=function(e){return e&&e.instanceString&&ri(e.instanceString)?e.instanceString():null},Yt=function(e){return e!=null&&qi(e)==Bj},ri=function(e){return e!=null&&qi(e)===zj},Sn=function(e){return!vo(e)&&(Array.isArray?Array.isArray(e):e!=null&&e instanceof Array)},Wr=function(e){return e!=null&&qi(e)===FM&&!Sn(e)&&e.constructor===Object},Gj=function(e){return e!=null&&qi(e)===FM},_t=function(e){return e!=null&&qi(e)===qi(1)&&!isNaN(e)},Vj=function(e){return _t(e)&&Math.floor(e)===e},ux=function(e){if(Uj!=="undefined")return e!=null&&e instanceof HTMLElement},vo=function(e){return Xv(e)||BM(e)},Xv=function(e){return Yv(e)==="collection"&&e._private.single},BM=function(e){return Yv(e)==="collection"&&!e._private.single},n_=function(e){return Yv(e)==="core"},zM=function(e){return Yv(e)==="stylesheet"},Hj=function(e){return Yv(e)==="event"},Kd=function(e){return e==null?!0:!!(e===""||e.match(/^\s+$/))},Wj=function(e){return typeof HTMLElement>"u"?!1:e instanceof HTMLElement},qj=function(e){return Wr(e)&&_t(e.x1)&&_t(e.x2)&&_t(e.y1)&&_t(e.y2)},$j=function(e){return Gj(e)&&ri(e.then)},Kj=function(){return IE&&IE.userAgent.match(/msie|trident|edge/i)},Hp=function(e,r){r||(r=function(){if(arguments.length===1)return arguments[0];if(arguments.length===0)return"undefined";for(var a=[],s=0;s<arguments.length;s++)a.push(arguments[s]);return a.join("$")});var n=function(){var a=this,s=arguments,o,l=r.apply(a,s),u=n.cache;return(o=u[l])||(o=u[l]=e.apply(a,s)),o};return n.cache={},n},i_=Hp(function(t){return t.replace(/([A-Z])/g,function(e){return"-"+e.toLowerCase()})}),C1=Hp(function(t){return t.replace(/(-\w)/g,function(e){return e[1].toUpperCase()})}),UM=Hp(function(t,e){return t+e[0].toUpperCase()+e.substring(1)},function(t,e){return t+"$"+e}),jE=function(e){return Kd(e)?e:e.charAt(0).toUpperCase()+e.substring(1)},Rd=function(e,r){return e.slice(-1*r.length)===r},Wi="(?:[-+]?(?:(?:\\d+|\\d*\\.\\d+)(?:[Ee][+-]?\\d+)?))",Zj="rgb[a]?\\(("+Wi+"[%]?)\\s*,\\s*("+Wi+"[%]?)\\s*,\\s*("+Wi+"[%]?)(?:\\s*,\\s*("+Wi+"))?\\)",Yj="rgb[a]?\\((?:"+Wi+"[%]?)\\s*,\\s*(?:"+Wi+"[%]?)\\s*,\\s*(?:"+Wi+"[%]?)(?:\\s*,\\s*(?:"+Wi+"))?\\)",Xj="hsl[a]?\\(("+Wi+")\\s*,\\s*("+Wi+"[%])\\s*,\\s*("+Wi+"[%])(?:\\s*,\\s*("+Wi+"))?\\)",Qj="hsl[a]?\\((?:"+Wi+")\\s*,\\s*(?:"+Wi+"[%])\\s*,\\s*(?:"+Wi+"[%])(?:\\s*,\\s*(?:"+Wi+"))?\\)",Jj="\\#[0-9a-fA-F]{3}",e9="\\#[0-9a-fA-F]{6}",GM=function(e,r){return e<r?-1:e>r?1:0},t9=function(e,r){return-1*GM(e,r)},sr=Object.assign!=null?Object.assign.bind(Object):function(t){for(var e=arguments,r=1;r<e.length;r++){var n=e[r];if(n!=null)for(var i=Object.keys(n),a=0;a<i.length;a++){var s=i[a];t[s]=n[s]}}return t},r9=function(e){if(!(!(e.length===4||e.length===7)||e[0]!=="#")){var r=e.length===4,n,i,a,s=16;return r?(n=parseInt(e[1]+e[1],s),i=parseInt(e[2]+e[2],s),a=parseInt(e[3]+e[3],s)):(n=parseInt(e[1]+e[2],s),i=parseInt(e[3]+e[4],s),a=parseInt(e[5]+e[6],s)),[n,i,a]}},n9=function(e){var r,n,i,a,s,o,l,u;function c(y,S,w){return w<0&&(w+=1),w>1&&(w-=1),w<1/6?y+(S-y)*6*w:w<1/2?S:w<2/3?y+(S-y)*(2/3-w)*6:y}var f=new RegExp("^"+Xj+"$").exec(e);if(f){if(n=parseInt(f[1]),n<0?n=(360- -1*n%360)%360:n>360&&(n=n%360),n/=360,i=parseFloat(f[2]),i<0||i>100||(i=i/100,a=parseFloat(f[3]),a<0||a>100)||(a=a/100,s=f[4],s!==void 0&&(s=parseFloat(s),s<0||s>1)))return;if(i===0)o=l=u=Math.round(a*255);else{var p=a<.5?a*(1+i):a+i-a*i,g=2*a-p;o=Math.round(255*c(g,p,n+1/3)),l=Math.round(255*c(g,p,n)),u=Math.round(255*c(g,p,n-1/3))}r=[o,l,u,s]}return r},i9=function(e){var r,n=new RegExp("^"+Zj+"$").exec(e);if(n){r=[];for(var i=[],a=1;a<=3;a++){var s=n[a];if(s[s.length-1]==="%"&&(i[a]=!0),s=parseFloat(s),i[a]&&(s=s/100*255),s<0||s>255)return;r.push(Math.floor(s))}var o=i[1]||i[2]||i[3],l=i[1]&&i[2]&&i[3];if(o&&!l)return;var u=n[4];if(u!==void 0){if(u=parseFloat(u),u<0||u>1)return;r.push(u)}}return r},a9=function(e){return s9[e.toLowerCase()]},VM=function(e){return(Sn(e)?e:null)||a9(e)||r9(e)||i9(e)||n9(e)},s9={transparent:[0,0,0,0],aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],grey:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},HM=function(e){for(var r=e.map,n=e.keys,i=n.length,a=0;a<i;a++){var s=n[a];if(Wr(s))throw Error("Tried to set map with object key");a<n.length-1?(r[s]==null&&(r[s]={}),r=r[s]):r[s]=e.value}},WM=function(e){for(var r=e.map,n=e.keys,i=n.length,a=0;a<i;a++){var s=n[a];if(Wr(s))throw Error("Tried to get map with object key");if(r=r[s],r==null)return r}return r},J0=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Qv(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Zb,FE;function Jv(){if(FE)return Zb;FE=1;function t(e){var r=typeof e;return e!=null&&(r=="object"||r=="function")}return Zb=t,Zb}var Yb,BE;function o9(){if(BE)return Yb;BE=1;var t=typeof J0=="object"&&J0&&J0.Object===Object&&J0;return Yb=t,Yb}var Xb,zE;function E1(){if(zE)return Xb;zE=1;var t=o9(),e=typeof self=="object"&&self&&self.Object===Object&&self,r=t||e||Function("return this")();return Xb=r,Xb}var Qb,UE;function l9(){if(UE)return Qb;UE=1;var t=E1(),e=function(){return t.Date.now()};return Qb=e,Qb}var Jb,GE;function u9(){if(GE)return Jb;GE=1;var t=/\s/;function e(r){for(var n=r.length;n--&&t.test(r.charAt(n)););return n}return Jb=e,Jb}var ew,VE;function c9(){if(VE)return ew;VE=1;var t=u9(),e=/^\s+/;function r(n){return n&&n.slice(0,t(n)+1).replace(e,"")}return ew=r,ew}var tw,HE;function a_(){if(HE)return tw;HE=1;var t=E1(),e=t.Symbol;return tw=e,tw}var rw,WE;function d9(){if(WE)return rw;WE=1;var t=a_(),e=Object.prototype,r=e.hasOwnProperty,n=e.toString,i=t?t.toStringTag:void 0;function a(s){var o=r.call(s,i),l=s[i];try{s[i]=void 0;var u=!0}catch{}var c=n.call(s);return u&&(o?s[i]=l:delete s[i]),c}return rw=a,rw}var nw,qE;function f9(){if(qE)return nw;qE=1;var t=Object.prototype,e=t.toString;function r(n){return e.call(n)}return nw=r,nw}var iw,$E;function qM(){if($E)return iw;$E=1;var t=a_(),e=d9(),r=f9(),n="[object Null]",i="[object Undefined]",a=t?t.toStringTag:void 0;function s(o){return o==null?o===void 0?i:n:a&&a in Object(o)?e(o):r(o)}return iw=s,iw}var aw,KE;function h9(){if(KE)return aw;KE=1;function t(e){return e!=null&&typeof e=="object"}return aw=t,aw}var sw,ZE;function e0(){if(ZE)return sw;ZE=1;var t=qM(),e=h9(),r="[object Symbol]";function n(i){return typeof i=="symbol"||e(i)&&t(i)==r}return sw=n,sw}var ow,YE;function p9(){if(YE)return ow;YE=1;var t=c9(),e=Jv(),r=e0(),n=NaN,i=/^[-+]0x[0-9a-f]+$/i,a=/^0b[01]+$/i,s=/^0o[0-7]+$/i,o=parseInt;function l(u){if(typeof u=="number")return u;if(r(u))return n;if(e(u)){var c=typeof u.valueOf=="function"?u.valueOf():u;u=e(c)?c+"":c}if(typeof u!="string")return u===0?u:+u;u=t(u);var f=a.test(u);return f||s.test(u)?o(u.slice(2),f?2:8):i.test(u)?n:+u}return ow=l,ow}var lw,XE;function m9(){if(XE)return lw;XE=1;var t=Jv(),e=l9(),r=p9(),n="Expected a function",i=Math.max,a=Math.min;function s(o,l,u){var c,f,p,g,y,S,w=0,C=!1,_=!1,T=!0;if(typeof o!="function")throw new TypeError(n);l=r(l)||0,t(u)&&(C=!!u.leading,_="maxWait"in u,p=_?i(r(u.maxWait)||0,l):p,T="trailing"in u?!!u.trailing:T);function N(I){var W=c,U=f;return c=f=void 0,w=I,g=o.apply(U,W),g}function R(I){return w=I,y=setTimeout(O,l),C?N(I):g}function D(I){var W=I-S,U=I-w,K=l-W;return _?a(K,p-U):K}function j(I){var W=I-S,U=I-w;return S===void 0||W>=l||W<0||_&&U>=p}function O(){var I=e();if(j(I))return F(I);y=setTimeout(O,D(I))}function F(I){return y=void 0,T&&c?N(I):(c=f=void 0,g)}function z(){y!==void 0&&clearTimeout(y),w=0,c=S=f=y=void 0}function G(){return y===void 0?g:F(e())}function Z(){var I=e(),W=j(I);if(c=arguments,f=this,S=I,W){if(y===void 0)return R(S);if(_)return clearTimeout(y),y=setTimeout(O,l),N(S)}return y===void 0&&(y=setTimeout(O,l)),g}return Z.cancel=z,Z.flush=G,Z}return lw=s,lw}var g9=m9(),t0=Qv(g9),uw=Hi?Hi.performance:null,$M=uw&&uw.now?function(){return uw.now()}:function(){return Date.now()},v9=(function(){if(Hi){if(Hi.requestAnimationFrame)return function(t){Hi.requestAnimationFrame(t)};if(Hi.mozRequestAnimationFrame)return function(t){Hi.mozRequestAnimationFrame(t)};if(Hi.webkitRequestAnimationFrame)return function(t){Hi.webkitRequestAnimationFrame(t)};if(Hi.msRequestAnimationFrame)return function(t){Hi.msRequestAnimationFrame(t)}}return function(t){t&&setTimeout(function(){t($M())},1e3/60)}})(),cx=function(e){return v9(e)},yc=$M,Xf=9261,KM=65599,_p=5381,ZM=function(e){for(var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Xf,n=r,i;i=e.next(),!i.done;)n=n*KM+i.value|0;return n},wv=function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Xf;return r*KM+e|0},Sv=function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:_p;return(r<<5)+r+e|0},y9=function(e,r){return e*2097152+r},vd=function(e){return e[0]*2097152+e[1]},ey=function(e,r){return[wv(e[0],r[0]),Sv(e[1],r[1])]},QE=function(e,r){var n={value:0,done:!1},i=0,a=e.length,s={next:function(){return i<a?n.value=e[i++]:n.done=!0,n}};return ZM(s,r)},ph=function(e,r){var n={value:0,done:!1},i=0,a=e.length,s={next:function(){return i<a?n.value=e.charCodeAt(i++):n.done=!0,n}};return ZM(s,r)},YM=function(){return x9(arguments)},x9=function(e){for(var r,n=0;n<e.length;n++){var i=e[n];n===0?r=ph(i):r=ph(i,r)}return r};function b9(t,e,r,n,i){var a=i*Math.PI/180,s=Math.cos(a)*(t-r)-Math.sin(a)*(e-n)+r,o=Math.sin(a)*(t-r)+Math.cos(a)*(e-n)+n;return{x:s,y:o}}var w9=function(e,r,n,i,a,s){return{x:(e-n)*a+n,y:(r-i)*s+i}};function S9(t,e,r){if(r===0)return t;var n=(e.x1+e.x2)/2,i=(e.y1+e.y2)/2,a=e.w/e.h,s=1/a,o=b9(t.x,t.y,n,i,r),l=w9(o.x,o.y,n,i,a,s);return{x:l.x,y:l.y}}var JE=!0,k9=console.warn!=null,_9=console.trace!=null,s_=Number.MAX_SAFE_INTEGER||9007199254740991,XM=function(){return!0},dx=function(){return!1},eT=function(){return 0},o_=function(){},Zn=function(e){throw new Error(e)},QM=function(e){if(e!==void 0)JE=!!e;else return JE},an=function(e){QM()&&(k9?console.warn(e):(console.log(e),_9&&console.trace()))},C9=function(e){return sr({},e)},_u=function(e){return e==null?e:Sn(e)?e.slice():Wr(e)?C9(e):e},E9=function(e){return e.slice()},JM=function(e,r){for(r=e="";e++<36;r+=e*51&52?(e^15?8^Math.random()*(e^20?16:4):4).toString(16):"-");return r},T9={},eA=function(){return T9},Ha=function(e){var r=Object.keys(e);return function(n){for(var i={},a=0;a<r.length;a++){var s=r[a],o=n?.[s];i[s]=o===void 0?e[s]:o}return i}},Zd=function(e,r,n){for(var i=e.length-1;i>=0;i--)e[i]===r&&e.splice(i,1)},l_=function(e){e.splice(0,e.length)},N9=function(e,r){for(var n=0;n<r.length;n++){var i=r[n];e.push(i)}},$s=function(e,r,n){return n&&(r=UM(n,r)),e[r]},dc=function(e,r,n,i){n&&(r=UM(n,r)),e[r]=i},P9=(function(){function t(){sf(this,t),this._obj={}}return of(t,[{key:"set",value:function(r,n){return this._obj[r]=n,this}},{key:"delete",value:function(r){return this._obj[r]=void 0,this}},{key:"clear",value:function(){this._obj={}}},{key:"has",value:function(r){return this._obj[r]!==void 0}},{key:"get",value:function(r){return this._obj[r]}}])})(),fc=typeof Map<"u"?Map:P9,M9="undefined",A9=(function(){function t(e){if(sf(this,t),this._obj=Object.create(null),this.size=0,e!=null){var r;e.instanceString!=null&&e.instanceString()===this.instanceString()?r=e.toArray():r=e;for(var n=0;n<r.length;n++)this.add(r[n])}}return of(t,[{key:"instanceString",value:function(){return"set"}},{key:"add",value:function(r){var n=this._obj;n[r]!==1&&(n[r]=1,this.size++)}},{key:"delete",value:function(r){var n=this._obj;n[r]===1&&(n[r]=0,this.size--)}},{key:"clear",value:function(){this._obj=Object.create(null)}},{key:"has",value:function(r){return this._obj[r]===1}},{key:"toArray",value:function(){var r=this;return Object.keys(this._obj).filter(function(n){return r.has(n)})}},{key:"forEach",value:function(r,n){return this.toArray().forEach(r,n)}}])})(),lm=(typeof Set>"u"?"undefined":qi(Set))!==M9?Set:A9,T1=function(e,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(e===void 0||r===void 0||!n_(e)){Zn("An element must have a core reference and parameters set");return}var i=r.group;if(i==null&&(r.data&&r.data.source!=null&&r.data.target!=null?i="edges":i="nodes"),i!=="nodes"&&i!=="edges"){Zn("An element must be of type `nodes` or `edges`; you specified `"+i+"`");return}this.length=1,this[0]=this;var a=this._private={cy:e,single:!0,data:r.data||{},position:r.position||{x:0,y:0},autoWidth:void 0,autoHeight:void 0,autoPadding:void 0,compoundBoundsClean:!1,listeners:[],group:i,style:{},rstyle:{},styleCxts:[],styleKeys:{},removed:!0,selected:!!r.selected,selectable:r.selectable===void 0?!0:!!r.selectable,locked:!!r.locked,grabbed:!1,grabbable:r.grabbable===void 0?!0:!!r.grabbable,pannable:r.pannable===void 0?i==="edges":!!r.pannable,active:!1,classes:new lm,animation:{current:[],queue:[]},rscratch:{},scratch:r.scratch||{},edges:[],children:[],parent:r.parent&&r.parent.isNode()?r.parent:null,traversalCache:{},backgrounding:!1,bbCache:null,bbCacheShift:{x:0,y:0},bodyBounds:null,overlayBounds:null,labelBounds:{all:null,source:null,target:null,main:null},arrowBounds:{source:null,target:null,"mid-source":null,"mid-target":null}};if(a.position.x==null&&(a.position.x=0),a.position.y==null&&(a.position.y=0),r.renderedPosition){var s=r.renderedPosition,o=e.pan(),l=e.zoom();a.position={x:(s.x-o.x)/l,y:(s.y-o.y)/l}}var u=[];Sn(r.classes)?u=r.classes:Yt(r.classes)&&(u=r.classes.split(/\s+/));for(var c=0,f=u.length;c<f;c++){var p=u[c];!p||p===""||a.classes.add(p)}this.createEmitter(),(n===void 0||n)&&this.restore();var g=r.style||r.css;g&&(an("Setting a `style` bypass at element creation should be done only when absolutely necessary.  Try to use the stylesheet instead."),this.style(g))},tT=function(e){return e={bfs:e.bfs||!e.dfs,dfs:e.dfs||!e.bfs},function(n,i,a){var s;Wr(n)&&!vo(n)&&(s=n,n=s.roots||s.root,i=s.visit,a=s.directed),a=arguments.length===2&&!ri(i)?i:a,i=ri(i)?i:function(){};for(var o=this._private.cy,l=n=Yt(n)?this.filter(n):n,u=[],c=[],f={},p={},g={},y=0,S,w=this.byGroup(),C=w.nodes,_=w.edges,T=0;T<l.length;T++){var N=l[T],R=N.id();N.isNode()&&(u.unshift(N),e.bfs&&(g[R]=!0,c.push(N)),p[R]=0)}for(var D=function(){var I=e.bfs?u.shift():u.pop(),W=I.id();if(e.dfs){if(g[W])return 0;g[W]=!0,c.push(I)}var U=p[W],K=f[W],$=K!=null?K.source():null,Q=K!=null?K.target():null,ie=K==null?void 0:I.same($)?Q[0]:$[0],te;if(te=i(I,K,ie,y++,U),te===!0)return S=I,1;if(te===!1)return 1;for(var X=I.connectedEdges().filter(function(he){return(!a||he.source().same(I))&&_.has(he)}),re=0;re<X.length;re++){var fe=X[re],oe=fe.connectedNodes().filter(function(he){return!he.same(I)&&C.has(he)}),se=oe.id();oe.length!==0&&!g[se]&&(oe=oe[0],u.push(oe),e.bfs&&(g[se]=!0,c.push(oe)),f[se]=fe,p[se]=p[W]+1)}},j;u.length!==0&&(j=D(),!(j!==0&&j===1)););for(var O=o.collection(),F=0;F<c.length;F++){var z=c[F],G=f[z.id()];G!=null&&O.push(G),O.push(z)}return{path:o.collection(O),found:o.collection(S)}}},kv={breadthFirstSearch:tT({bfs:!0}),depthFirstSearch:tT({dfs:!0})};kv.bfs=kv.breadthFirstSearch;kv.dfs=kv.depthFirstSearch;var Fy={exports:{}},L9=Fy.exports,rT;function R9(){return rT||(rT=1,(function(t,e){(function(){var r,n,i,a,s,o,l,u,c,f,p,g,y,S,w;i=Math.floor,f=Math.min,n=function(C,_){return C<_?-1:C>_?1:0},c=function(C,_,T,N,R){var D;if(T==null&&(T=0),R==null&&(R=n),T<0)throw new Error("lo must be non-negative");for(N==null&&(N=C.length);T<N;)D=i((T+N)/2),R(_,C[D])<0?N=D:T=D+1;return[].splice.apply(C,[T,T-T].concat(_)),_},o=function(C,_,T){return T==null&&(T=n),C.push(_),S(C,0,C.length-1,T)},s=function(C,_){var T,N;return _==null&&(_=n),T=C.pop(),C.length?(N=C[0],C[0]=T,w(C,0,_)):N=T,N},u=function(C,_,T){var N;return T==null&&(T=n),N=C[0],C[0]=_,w(C,0,T),N},l=function(C,_,T){var N;return T==null&&(T=n),C.length&&T(C[0],_)<0&&(N=[C[0],_],_=N[0],C[0]=N[1],w(C,0,T)),_},a=function(C,_){var T,N,R,D,j,O;for(_==null&&(_=n),D=(function(){O=[];for(var F=0,z=i(C.length/2);0<=z?F<z:F>z;0<=z?F++:F--)O.push(F);return O}).apply(this).reverse(),j=[],N=0,R=D.length;N<R;N++)T=D[N],j.push(w(C,T,_));return j},y=function(C,_,T){var N;if(T==null&&(T=n),N=C.indexOf(_),N!==-1)return S(C,0,N,T),w(C,N,T)},p=function(C,_,T){var N,R,D,j,O;if(T==null&&(T=n),R=C.slice(0,_),!R.length)return R;for(a(R,T),O=C.slice(_),D=0,j=O.length;D<j;D++)N=O[D],l(R,N,T);return R.sort(T).reverse()},g=function(C,_,T){var N,R,D,j,O,F,z,G,Z;if(T==null&&(T=n),_*10<=C.length){if(D=C.slice(0,_).sort(T),!D.length)return D;for(R=D[D.length-1],z=C.slice(_),j=0,F=z.length;j<F;j++)N=z[j],T(N,R)<0&&(c(D,N,0,null,T),D.pop(),R=D[D.length-1]);return D}for(a(C,T),Z=[],O=0,G=f(_,C.length);0<=G?O<G:O>G;0<=G?++O:--O)Z.push(s(C,T));return Z},S=function(C,_,T,N){var R,D,j;for(N==null&&(N=n),R=C[T];T>_;){if(j=T-1>>1,D=C[j],N(R,D)<0){C[T]=D,T=j;continue}break}return C[T]=R},w=function(C,_,T){var N,R,D,j,O;for(T==null&&(T=n),R=C.length,O=_,D=C[_],N=2*_+1;N<R;)j=N+1,j<R&&!(T(C[N],C[j])<0)&&(N=j),C[_]=C[N],_=N,N=2*_+1;return C[_]=D,S(C,O,_,T)},r=(function(){C.push=o,C.pop=s,C.replace=u,C.pushpop=l,C.heapify=a,C.updateItem=y,C.nlargest=p,C.nsmallest=g;function C(_){this.cmp=_??n,this.nodes=[]}return C.prototype.push=function(_){return o(this.nodes,_,this.cmp)},C.prototype.pop=function(){return s(this.nodes,this.cmp)},C.prototype.peek=function(){return this.nodes[0]},C.prototype.contains=function(_){return this.nodes.indexOf(_)!==-1},C.prototype.replace=function(_){return u(this.nodes,_,this.cmp)},C.prototype.pushpop=function(_){return l(this.nodes,_,this.cmp)},C.prototype.heapify=function(){return a(this.nodes,this.cmp)},C.prototype.updateItem=function(_){return y(this.nodes,_,this.cmp)},C.prototype.clear=function(){return this.nodes=[]},C.prototype.empty=function(){return this.nodes.length===0},C.prototype.size=function(){return this.nodes.length},C.prototype.clone=function(){var _;return _=new C,_.nodes=this.nodes.slice(0),_},C.prototype.toArray=function(){return this.nodes.slice(0)},C.prototype.insert=C.prototype.push,C.prototype.top=C.prototype.peek,C.prototype.front=C.prototype.peek,C.prototype.has=C.prototype.contains,C.prototype.copy=C.prototype.clone,C})(),(function(C,_){return t.exports=_()})(this,function(){return r})}).call(L9)})(Fy)),Fy.exports}var cw,nT;function O9(){return nT||(nT=1,cw=R9()),cw}var D9=O9(),r0=Qv(D9),I9=Ha({root:null,weight:function(e){return 1},directed:!1}),j9={dijkstra:function(e){if(!Wr(e)){var r=arguments;e={root:r[0],weight:r[1],directed:r[2]}}var n=I9(e),i=n.root,a=n.weight,s=n.directed,o=this,l=a,u=Yt(i)?this.filter(i)[0]:i[0],c={},f={},p={},g=this.byGroup(),y=g.nodes,S=g.edges;S.unmergeBy(function(U){return U.isLoop()});for(var w=function(K){return c[K.id()]},C=function(K,$){c[K.id()]=$,_.updateItem(K)},_=new r0(function(U,K){return w(U)-w(K)}),T=0;T<y.length;T++){var N=y[T];c[N.id()]=N.same(u)?0:1/0,_.push(N)}for(var R=function(K,$){for(var Q=(s?K.edgesTo($):K.edgesWith($)).intersect(S),ie=1/0,te,X=0;X<Q.length;X++){var re=Q[X],fe=l(re);(fe<ie||!te)&&(ie=fe,te=re)}return{edge:te,dist:ie}};_.size()>0;){var D=_.pop(),j=w(D),O=D.id();if(p[O]=j,j!==1/0)for(var F=D.neighborhood().intersect(y),z=0;z<F.length;z++){var G=F[z],Z=G.id(),I=R(D,G),W=j+I.dist;W<w(G)&&(C(G,W),f[Z]={node:D,edge:I.edge})}}return{distanceTo:function(K){var $=Yt(K)?y.filter(K)[0]:K[0];return p[$.id()]},pathTo:function(K){var $=Yt(K)?y.filter(K)[0]:K[0],Q=[],ie=$,te=ie.id();if($.length>0)for(Q.unshift($);f[te];){var X=f[te];Q.unshift(X.edge),Q.unshift(X.node),ie=X.node,te=ie.id()}return o.spawn(Q)}}}},F9={kruskal:function(e){e=e||function(T){return 1};for(var r=this.byGroup(),n=r.nodes,i=r.edges,a=n.length,s=new Array(a),o=n,l=function(N){for(var R=0;R<s.length;R++){var D=s[R];if(D.has(N))return R}},u=0;u<a;u++)s[u]=this.spawn(n[u]);for(var c=i.sort(function(T,N){return e(T)-e(N)}),f=0;f<c.length;f++){var p=c[f],g=p.source()[0],y=p.target()[0],S=l(g),w=l(y),C=s[S],_=s[w];S!==w&&(o.merge(p),C.merge(_),s.splice(w,1))}return o}},B9=Ha({root:null,goal:null,weight:function(e){return 1},heuristic:function(e){return 0},directed:!1}),z9={aStar:function(e){var r=this.cy(),n=B9(e),i=n.root,a=n.goal,s=n.heuristic,o=n.directed,l=n.weight;i=r.collection(i)[0],a=r.collection(a)[0];var u=i.id(),c=a.id(),f={},p={},g={},y=new r0(function(te,X){return p[te.id()]-p[X.id()]}),S=new lm,w={},C={},_=function(X,re){y.push(X),S.add(re)},T,N,R=function(){T=y.pop(),N=T.id(),S.delete(N)},D=function(X){return S.has(X)};_(i,u),f[u]=0,p[u]=s(i);for(var j=0;y.size()>0;){if(R(),j++,N===c){for(var O=[],F=a,z=c,G=C[z];O.unshift(F),G!=null&&O.unshift(G),F=w[z],F!=null;)z=F.id(),G=C[z];return{found:!0,distance:f[N],path:this.spawn(O),steps:j}}g[N]=!0;for(var Z=T._private.edges,I=0;I<Z.length;I++){var W=Z[I];if(this.hasElementWithId(W.id())&&!(o&&W.data("source")!==N)){var U=W.source(),K=W.target(),$=U.id()!==N?U:K,Q=$.id();if(this.hasElementWithId(Q)&&!g[Q]){var ie=f[N]+l(W);if(!D(Q)){f[Q]=ie,p[Q]=ie+s($),_($,Q),w[Q]=T,C[Q]=W;continue}ie<f[Q]&&(f[Q]=ie,p[Q]=ie+s($),w[Q]=T,C[Q]=W)}}}}return{found:!1,distance:void 0,path:void 0,steps:j}}},U9=Ha({weight:function(e){return 1},directed:!1}),G9={floydWarshall:function(e){for(var r=this.cy(),n=U9(e),i=n.weight,a=n.directed,s=i,o=this.byGroup(),l=o.nodes,u=o.edges,c=l.length,f=c*c,p=function(fe){return l.indexOf(fe)},g=function(fe){return l[fe]},y=new Array(f),S=0;S<f;S++){var w=S%c,C=(S-w)/c;C===w?y[S]=0:y[S]=1/0}for(var _=new Array(f),T=new Array(f),N=0;N<u.length;N++){var R=u[N],D=R.source()[0],j=R.target()[0];if(D!==j){var O=p(D),F=p(j),z=O*c+F,G=s(R);if(y[z]>G&&(y[z]=G,_[z]=F,T[z]=R),!a){var Z=F*c+O;!a&&y[Z]>G&&(y[Z]=G,_[Z]=O,T[Z]=R)}}}for(var I=0;I<c;I++)for(var W=0;W<c;W++)for(var U=W*c+I,K=0;K<c;K++){var $=W*c+K,Q=I*c+K;y[U]+y[Q]<y[$]&&(y[$]=y[U]+y[Q],_[$]=_[U])}var ie=function(fe){return(Yt(fe)?r.filter(fe):fe)[0]},te=function(fe){return p(ie(fe))},X={distance:function(fe,oe){var se=te(fe),he=te(oe);return y[se*c+he]},path:function(fe,oe){var se=te(fe),he=te(oe),ae=g(se);if(se===he)return ae.collection();if(_[se*c+he]==null)return r.collection();var pe=r.collection(),ye=se,ve;for(pe.merge(ae);se!==he;)ye=se,se=_[se*c+he],ve=T[ye*c+se],pe.merge(ve),pe.merge(g(se));return pe}};return X}},V9=Ha({weight:function(e){return 1},directed:!1,root:null}),H9={bellmanFord:function(e){var r=this,n=V9(e),i=n.weight,a=n.directed,s=n.root,o=i,l=this,u=this.cy(),c=this.byGroup(),f=c.edges,p=c.nodes,g=p.length,y=new fc,S=!1,w=[];s=u.collection(s)[0],f.unmergeBy(function(rt){return rt.isLoop()});for(var C=f.length,_=function(dt){var Ct=y.get(dt.id());return Ct||(Ct={},y.set(dt.id(),Ct)),Ct},T=function(dt){return(Yt(dt)?u.$(dt):dt)[0]},N=function(dt){return _(T(dt)).dist},R=function(dt){for(var Ct=arguments.length>1&&arguments[1]!==void 0?arguments[1]:s,Ke=T(dt),ut=[],ct=Ke;;){if(ct==null)return r.spawn();var xt=_(ct),ot=xt.edge,Lt=xt.pred;if(ut.unshift(ct[0]),ct.same(Ct)&&ut.length>0)break;ot!=null&&ut.unshift(ot),ct=Lt}return l.spawn(ut)},D=0;D<g;D++){var j=p[D],O=_(j);j.same(s)?O.dist=0:O.dist=1/0,O.pred=null,O.edge=null}for(var F=!1,z=function(dt,Ct,Ke,ut,ct,xt){var ot=ut.dist+xt;ot<ct.dist&&!Ke.same(ut.edge)&&(ct.dist=ot,ct.pred=dt,ct.edge=Ke,F=!0)},G=1;G<g;G++){F=!1;for(var Z=0;Z<C;Z++){var I=f[Z],W=I.source(),U=I.target(),K=o(I),$=_(W),Q=_(U);z(W,U,I,$,Q,K),a||z(U,W,I,Q,$,K)}if(!F)break}if(F)for(var ie=[],te=0;te<C;te++){var X=f[te],re=X.source(),fe=X.target(),oe=o(X),se=_(re).dist,he=_(fe).dist;if(se+oe<he||!a&&he+oe<se)if(S||(an("Graph contains a negative weight cycle for Bellman-Ford"),S=!0),e.findNegativeWeightCycles!==!1){var ae=[];se+oe<he&&ae.push(re),!a&&he+oe<se&&ae.push(fe);for(var pe=ae.length,ye=0;ye<pe;ye++){var ve=ae[ye],ue=[ve];ue.push(_(ve).edge);for(var xe=_(ve).pred;ue.indexOf(xe)===-1;)ue.push(xe),ue.push(_(xe).edge),xe=_(xe).pred;ue=ue.slice(ue.indexOf(xe));for(var Se=ue[0].id(),Ae=0,Me=2;Me<ue.length;Me+=2)ue[Me].id()<Se&&(Se=ue[Me].id(),Ae=Me);ue=ue.slice(Ae).concat(ue.slice(0,Ae)),ue.push(ue[0]);var st=ue.map(function(rt){return rt.id()}).join(",");ie.indexOf(st)===-1&&(w.push(l.spawn(ue)),ie.push(st))}}else break}return{distanceTo:N,pathTo:R,hasNegativeWeightCycle:S,negativeWeightCycles:w}}},W9=Math.sqrt(2),q9=function(e,r,n){n.length===0&&Zn("Karger-Stein must be run on a connected (sub)graph");for(var i=n[e],a=i[1],s=i[2],o=r[a],l=r[s],u=n,c=u.length-1;c>=0;c--){var f=u[c],p=f[1],g=f[2];(r[p]===o&&r[g]===l||r[p]===l&&r[g]===o)&&u.splice(c,1)}for(var y=0;y<u.length;y++){var S=u[y];S[1]===l?(u[y]=S.slice(),u[y][1]=o):S[2]===l&&(u[y]=S.slice(),u[y][2]=o)}for(var w=0;w<r.length;w++)r[w]===l&&(r[w]=o);return u},dw=function(e,r,n,i){for(;n>i;){var a=Math.floor(Math.random()*r.length);r=q9(a,e,r),n--}return r},$9={kargerStein:function(){var e=this,r=this.byGroup(),n=r.nodes,i=r.edges;i.unmergeBy(function(Q){return Q.isLoop()});var a=n.length,s=i.length,o=Math.ceil(Math.pow(Math.log(a)/Math.LN2,2)),l=Math.floor(a/W9);if(a<2){Zn("At least 2 nodes are required for Karger-Stein algorithm");return}for(var u=[],c=0;c<s;c++){var f=i[c];u.push([c,n.indexOf(f.source()),n.indexOf(f.target())])}for(var p=1/0,g=[],y=new Array(a),S=new Array(a),w=new Array(a),C=function(ie,te){for(var X=0;X<a;X++)te[X]=ie[X]},_=0;_<=o;_++){for(var T=0;T<a;T++)S[T]=T;var N=dw(S,u.slice(),a,l),R=N.slice();C(S,w);var D=dw(S,N,l,2),j=dw(w,R,l,2);D.length<=j.length&&D.length<p?(p=D.length,g=D,C(S,y)):j.length<=D.length&&j.length<p&&(p=j.length,g=j,C(w,y))}for(var O=this.spawn(g.map(function(Q){return i[Q[0]]})),F=this.spawn(),z=this.spawn(),G=y[0],Z=0;Z<y.length;Z++){var I=y[Z],W=n[Z];I===G?F.merge(W):z.merge(W)}var U=function(ie){var te=e.spawn();return ie.forEach(function(X){te.merge(X),X.connectedEdges().forEach(function(re){e.contains(re)&&!O.contains(re)&&te.merge(re)})}),te},K=[U(F),U(z)],$={cut:O,components:K,partition1:F,partition2:z};return $}},fw,K9=function(e){return{x:e.x,y:e.y}},N1=function(e,r,n){return{x:e.x*r+n.x,y:e.y*r+n.y}},tA=function(e,r,n){return{x:(e.x-n.x)/r,y:(e.y-n.y)/r}},Ap=function(e){return{x:e[0],y:e[1]}},Z9=function(e){for(var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:e.length,i=1/0,a=r;a<n;a++){var s=e[a];isFinite(s)&&(i=Math.min(s,i))}return i},Y9=function(e){for(var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:e.length,i=-1/0,a=r;a<n;a++){var s=e[a];isFinite(s)&&(i=Math.max(s,i))}return i},X9=function(e){for(var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:e.length,i=0,a=0,s=r;s<n;s++){var o=e[s];isFinite(o)&&(i+=o,a++)}return i/a},Q9=function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:e.length,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0,a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!0;i?e=e.slice(r,n):(n<e.length&&e.splice(n,e.length-n),r>0&&e.splice(0,r));for(var o=0,l=e.length-1;l>=0;l--){var u=e[l];s?isFinite(u)||(e[l]=-1/0,o++):e.splice(l,1)}a&&e.sort(function(p,g){return p-g});var c=e.length,f=Math.floor(c/2);return c%2!==0?e[f+1+o]:(e[f-1+o]+e[f+o])/2},J9=function(e){return Math.PI*e/180},ty=function(e,r){return Math.atan2(r,e)-Math.PI/2},u_=Math.log2||function(t){return Math.log(t)/Math.log(2)},c_=function(e){return e>0?1:e<0?-1:0},mh=function(e,r){return Math.sqrt(Kf(e,r))},Kf=function(e,r){var n=r.x-e.x,i=r.y-e.y;return n*n+i*i},eF=function(e){for(var r=e.length,n=0,i=0;i<r;i++)n+=e[i];for(var a=0;a<r;a++)e[a]=e[a]/n;return e},da=function(e,r,n,i){return(1-i)*(1-i)*e+2*(1-i)*i*r+i*i*n},Ip=function(e,r,n,i){return{x:da(e.x,r.x,n.x,i),y:da(e.y,r.y,n.y,i)}},tF=function(e,r,n,i){var a={x:r.x-e.x,y:r.y-e.y},s=mh(e,r),o={x:a.x/s,y:a.y/s};return n=n??0,i=i??n*s,{x:e.x+o.x*i,y:e.y+o.y*i}},_v=function(e,r,n){return Math.max(e,Math.min(n,r))},Es=function(e){if(e==null)return{x1:1/0,y1:1/0,x2:-1/0,y2:-1/0,w:0,h:0};if(e.x1!=null&&e.y1!=null){if(e.x2!=null&&e.y2!=null&&e.x2>=e.x1&&e.y2>=e.y1)return{x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,w:e.x2-e.x1,h:e.y2-e.y1};if(e.w!=null&&e.h!=null&&e.w>=0&&e.h>=0)return{x1:e.x1,y1:e.y1,x2:e.x1+e.w,y2:e.y1+e.h,w:e.w,h:e.h}}},rF=function(e){return{x1:e.x1,x2:e.x2,w:e.w,y1:e.y1,y2:e.y2,h:e.h}},nF=function(e){e.x1=1/0,e.y1=1/0,e.x2=-1/0,e.y2=-1/0,e.w=0,e.h=0},iF=function(e,r){e.x1=Math.min(e.x1,r.x1),e.x2=Math.max(e.x2,r.x2),e.w=e.x2-e.x1,e.y1=Math.min(e.y1,r.y1),e.y2=Math.max(e.y2,r.y2),e.h=e.y2-e.y1},rA=function(e,r,n){e.x1=Math.min(e.x1,r),e.x2=Math.max(e.x2,r),e.w=e.x2-e.x1,e.y1=Math.min(e.y1,n),e.y2=Math.max(e.y2,n),e.h=e.y2-e.y1},By=function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return e.x1-=r,e.x2+=r,e.y1-=r,e.y2+=r,e.w=e.x2-e.x1,e.h=e.y2-e.y1,e},zy=function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0],n,i,a,s;if(r.length===1)n=i=a=s=r[0];else if(r.length===2)n=a=r[0],s=i=r[1];else if(r.length===4){var o=Di(r,4);n=o[0],i=o[1],a=o[2],s=o[3]}return e.x1-=s,e.x2+=i,e.y1-=n,e.y2+=a,e.w=e.x2-e.x1,e.h=e.y2-e.y1,e},iT=function(e,r){e.x1=r.x1,e.y1=r.y1,e.x2=r.x2,e.y2=r.y2,e.w=e.x2-e.x1,e.h=e.y2-e.y1},d_=function(e,r){return!(e.x1>r.x2||r.x1>e.x2||e.x2<r.x1||r.x2<e.x1||e.y2<r.y1||r.y2<e.y1||e.y1>r.y2||r.y1>e.y2)},Od=function(e,r,n){return e.x1<=r&&r<=e.x2&&e.y1<=n&&n<=e.y2},aT=function(e,r){return Od(e,r.x,r.y)},nA=function(e,r){return Od(e,r.x1,r.y1)&&Od(e,r.x2,r.y2)},aF=(fw=Math.hypot)!==null&&fw!==void 0?fw:function(t,e){return Math.sqrt(t*t+e*e)};function sF(t,e){if(t.length<3)throw new Error("Need at least 3 vertices");var r=function(O,F){return{x:O.x+F.x,y:O.y+F.y}},n=function(O,F){return{x:O.x-F.x,y:O.y-F.y}},i=function(O,F){return{x:O.x*F,y:O.y*F}},a=function(O,F){return O.x*F.y-O.y*F.x},s=function(O){var F=aF(O.x,O.y);return F===0?{x:0,y:0}:{x:O.x/F,y:O.y/F}},o=function(O){for(var F=0,z=0;z<O.length;z++){var G=O[z],Z=O[(z+1)%O.length];F+=G.x*Z.y-Z.x*G.y}return F/2},l=function(O,F,z,G){var Z=n(F,O),I=n(G,z),W=a(Z,I);if(Math.abs(W)<1e-9)return r(O,i(Z,.5));var U=a(n(z,O),I)/W;return r(O,i(Z,U))},u=t.map(function(j){return{x:j.x,y:j.y}});o(u)<0&&u.reverse();for(var c=u.length,f=[],p=0;p<c;p++){var g=u[p],y=u[(p+1)%c],S=n(y,g),w=s({x:S.y,y:-S.x});f.push(w)}for(var C=f.map(function(j,O){var F=r(u[O],i(j,e)),z=r(u[(O+1)%c],i(j,e));return{p1:F,p2:z}}),_=[],T=0;T<c;T++){var N=C[(T-1+c)%c],R=C[T],D=l(N.p1,N.p2,R.p1,R.p2);_.push(D)}return _}function oF(t,e,r,n,i,a){var s=gF(t,e,r,n,i),o=sF(s,a),l=Es();return o.forEach(function(u){return rA(l,u.x,u.y)}),l}var iA=function(e,r,n,i,a,s,o){var l=arguments.length>7&&arguments[7]!==void 0?arguments[7]:"auto",u=l==="auto"?Yd(a,s):l,c=a/2,f=s/2;u=Math.min(u,c,f);var p=u!==c,g=u!==f,y;if(p){var S=n-c+u-o,w=i-f-o,C=n+c-u+o,_=w;if(y=Dd(e,r,n,i,S,w,C,_,!1),y.length>0)return y}if(g){var T=n+c+o,N=i-f+u-o,R=T,D=i+f-u+o;if(y=Dd(e,r,n,i,T,N,R,D,!1),y.length>0)return y}if(p){var j=n-c+u-o,O=i+f+o,F=n+c-u+o,z=O;if(y=Dd(e,r,n,i,j,O,F,z,!1),y.length>0)return y}if(g){var G=n-c-o,Z=i-f+u-o,I=G,W=i+f-u+o;if(y=Dd(e,r,n,i,G,Z,I,W,!1),y.length>0)return y}var U;{var K=n-c+u,$=i-f+u;if(U=qg(e,r,n,i,K,$,u+o),U.length>0&&U[0]<=K&&U[1]<=$)return[U[0],U[1]]}{var Q=n+c-u,ie=i-f+u;if(U=qg(e,r,n,i,Q,ie,u+o),U.length>0&&U[0]>=Q&&U[1]<=ie)return[U[0],U[1]]}{var te=n+c-u,X=i+f-u;if(U=qg(e,r,n,i,te,X,u+o),U.length>0&&U[0]>=te&&U[1]>=X)return[U[0],U[1]]}{var re=n-c+u,fe=i+f-u;if(U=qg(e,r,n,i,re,fe,u+o),U.length>0&&U[0]<=re&&U[1]>=fe)return[U[0],U[1]]}return[]},lF=function(e,r,n,i,a,s,o){var l=o,u=Math.min(n,a),c=Math.max(n,a),f=Math.min(i,s),p=Math.max(i,s);return u-l<=e&&e<=c+l&&f-l<=r&&r<=p+l},uF=function(e,r,n,i,a,s,o,l,u){var c={x1:Math.min(n,o,a)-u,x2:Math.max(n,o,a)+u,y1:Math.min(i,l,s)-u,y2:Math.max(i,l,s)+u};return!(e<c.x1||e>c.x2||r<c.y1||r>c.y2)},cF=function(e,r,n,i){n-=i;var a=r*r-4*e*n;if(a<0)return[];var s=Math.sqrt(a),o=2*e,l=(-r+s)/o,u=(-r-s)/o;return[l,u]},dF=function(e,r,n,i,a){var s=1e-5;e===0&&(e=s),r/=e,n/=e,i/=e;var o,l,u,c,f,p,g,y;if(l=(3*n-r*r)/9,u=-(27*i)+r*(9*n-2*(r*r)),u/=54,o=l*l*l+u*u,a[1]=0,g=r/3,o>0){f=u+Math.sqrt(o),f=f<0?-Math.pow(-f,1/3):Math.pow(f,1/3),p=u-Math.sqrt(o),p=p<0?-Math.pow(-p,1/3):Math.pow(p,1/3),a[0]=-g+f+p,g+=(f+p)/2,a[4]=a[2]=-g,g=Math.sqrt(3)*(-p+f)/2,a[3]=g,a[5]=-g;return}if(a[5]=a[3]=0,o===0){y=u<0?-Math.pow(-u,1/3):Math.pow(u,1/3),a[0]=-g+2*y,a[4]=a[2]=-(y+g);return}l=-l,c=l*l*l,c=Math.acos(u/Math.sqrt(c)),y=2*Math.sqrt(l),a[0]=-g+y*Math.cos(c/3),a[2]=-g+y*Math.cos((c+2*Math.PI)/3),a[4]=-g+y*Math.cos((c+4*Math.PI)/3)},fF=function(e,r,n,i,a,s,o,l){var u=1*n*n-4*n*a+2*n*o+4*a*a-4*a*o+o*o+i*i-4*i*s+2*i*l+4*s*s-4*s*l+l*l,c=9*n*a-3*n*n-3*n*o-6*a*a+3*a*o+9*i*s-3*i*i-3*i*l-6*s*s+3*s*l,f=3*n*n-6*n*a+n*o-n*e+2*a*a+2*a*e-o*e+3*i*i-6*i*s+i*l-i*r+2*s*s+2*s*r-l*r,p=1*n*a-n*n+n*e-a*e+i*s-i*i+i*r-s*r,g=[];dF(u,c,f,p,g);for(var y=1e-7,S=[],w=0;w<6;w+=2)Math.abs(g[w+1])<y&&g[w]>=0&&g[w]<=1&&S.push(g[w]);S.push(1),S.push(0);for(var C=-1,_,T,N,R=0;R<S.length;R++)_=Math.pow(1-S[R],2)*n+2*(1-S[R])*S[R]*a+S[R]*S[R]*o,T=Math.pow(1-S[R],2)*i+2*(1-S[R])*S[R]*s+S[R]*S[R]*l,N=Math.pow(_-e,2)+Math.pow(T-r,2),C>=0?N<C&&(C=N):C=N;return C},hF=function(e,r,n,i,a,s){var o=[e-n,r-i],l=[a-n,s-i],u=l[0]*l[0]+l[1]*l[1],c=o[0]*o[0]+o[1]*o[1],f=o[0]*l[0]+o[1]*l[1],p=f*f/u;return f<0?c:p>u?(e-a)*(e-a)+(r-s)*(r-s):c-p},Ks=function(e,r,n){for(var i,a,s,o,l,u=0,c=0;c<n.length/2;c++)if(i=n[c*2],a=n[c*2+1],c+1<n.length/2?(s=n[(c+1)*2],o=n[(c+1)*2+1]):(s=n[(c+1-n.length/2)*2],o=n[(c+1-n.length/2)*2+1]),!(i==e&&s==e))if(i>=e&&e>=s||i<=e&&e<=s)l=(e-i)/(s-i)*(o-a)+a,l>r&&u++;else continue;return u%2!==0},xc=function(e,r,n,i,a,s,o,l,u){var c=new Array(n.length),f;l[0]!=null?(f=Math.atan(l[1]/l[0]),l[0]<0?f=f+Math.PI/2:f=-f-Math.PI/2):f=l;for(var p=Math.cos(-f),g=Math.sin(-f),y=0;y<c.length/2;y++)c[y*2]=s/2*(n[y*2]*p-n[y*2+1]*g),c[y*2+1]=o/2*(n[y*2+1]*p+n[y*2]*g),c[y*2]+=i,c[y*2+1]+=a;var S;if(u>0){var w=hx(c,-u);S=fx(w)}else S=c;return Ks(e,r,S)},pF=function(e,r,n,i,a,s,o,l){for(var u=new Array(n.length*2),c=0;c<l.length;c++){var f=l[c];u[c*4+0]=f.startX,u[c*4+1]=f.startY,u[c*4+2]=f.stopX,u[c*4+3]=f.stopY;var p=Math.pow(f.cx-e,2)+Math.pow(f.cy-r,2);if(p<=Math.pow(f.radius,2))return!0}return Ks(e,r,u)},fx=function(e){for(var r=new Array(e.length/2),n,i,a,s,o,l,u,c,f=0;f<e.length/4;f++){n=e[f*4],i=e[f*4+1],a=e[f*4+2],s=e[f*4+3],f<e.length/4-1?(o=e[(f+1)*4],l=e[(f+1)*4+1],u=e[(f+1)*4+2],c=e[(f+1)*4+3]):(o=e[0],l=e[1],u=e[2],c=e[3]);var p=Dd(n,i,a,s,o,l,u,c,!0);r[f*2]=p[0],r[f*2+1]=p[1]}return r},hx=function(e,r){for(var n=new Array(e.length*2),i,a,s,o,l=0;l<e.length/2;l++){i=e[l*2],a=e[l*2+1],l<e.length/2-1?(s=e[(l+1)*2],o=e[(l+1)*2+1]):(s=e[0],o=e[1]);var u=o-a,c=-(s-i),f=Math.sqrt(u*u+c*c),p=u/f,g=c/f;n[l*4]=i+p*r,n[l*4+1]=a+g*r,n[l*4+2]=s+p*r,n[l*4+3]=o+g*r}return n},mF=function(e,r,n,i,a,s){var o=n-e,l=i-r;o/=a,l/=s;var u=Math.sqrt(o*o+l*l),c=u-1;if(c<0)return[];var f=c/u;return[(n-e)*f+e,(i-r)*f+r]},rh=function(e,r,n,i,a,s,o){return e-=a,r-=s,e/=n/2+o,r/=i/2+o,e*e+r*r<=1},qg=function(e,r,n,i,a,s,o){var l=[n-e,i-r],u=[e-a,r-s],c=l[0]*l[0]+l[1]*l[1],f=2*(u[0]*l[0]+u[1]*l[1]),p=u[0]*u[0]+u[1]*u[1]-o*o,g=f*f-4*c*p;if(g<0)return[];var y=(-f+Math.sqrt(g))/(2*c),S=(-f-Math.sqrt(g))/(2*c),w=Math.min(y,S),C=Math.max(y,S),_=[];if(w>=0&&w<=1&&_.push(w),C>=0&&C<=1&&_.push(C),_.length===0)return[];var T=_[0]*l[0]+e,N=_[0]*l[1]+r;if(_.length>1){if(_[0]==_[1])return[T,N];var R=_[1]*l[0]+e,D=_[1]*l[1]+r;return[T,N,R,D]}else return[T,N]},hw=function(e,r,n){return r<=e&&e<=n||n<=e&&e<=r?e:e<=r&&r<=n||n<=r&&r<=e?r:n},Dd=function(e,r,n,i,a,s,o,l,u){var c=e-a,f=n-e,p=o-a,g=r-s,y=i-r,S=l-s,w=p*g-S*c,C=f*g-y*c,_=S*f-p*y;if(_!==0){var T=w/_,N=C/_,R=.001,D=0-R,j=1+R;return D<=T&&T<=j&&D<=N&&N<=j?[e+T*f,r+T*y]:u?[e+T*f,r+T*y]:[]}else return w===0||C===0?hw(e,n,o)===o?[o,l]:hw(e,n,a)===a?[a,s]:hw(a,o,n)===n?[n,i]:[]:[]},gF=function(e,r,n,i,a){var s=[],o=i/2,l=a/2,u=r,c=n;s.push({x:u+o*e[0],y:c+l*e[1]});for(var f=1;f<e.length/2;f++)s.push({x:u+o*e[f*2],y:c+l*e[f*2+1]});return s},Cv=function(e,r,n,i,a,s,o,l){var u=[],c,f=new Array(n.length),p=!0;s==null&&(p=!1);var g;if(p){for(var y=0;y<f.length/2;y++)f[y*2]=n[y*2]*s+i,f[y*2+1]=n[y*2+1]*o+a;if(l>0){var S=hx(f,-l);g=fx(S)}else g=f}else g=n;for(var w,C,_,T,N=0;N<g.length/2;N++)w=g[N*2],C=g[N*2+1],N<g.length/2-1?(_=g[(N+1)*2],T=g[(N+1)*2+1]):(_=g[0],T=g[1]),c=Dd(e,r,i,a,w,C,_,T),c.length!==0&&u.push(c[0],c[1]);return u},vF=function(e,r,n,i,a,s,o,l,u){var c=[],f,p=new Array(n.length*2);u.forEach(function(_,T){T===0?(p[p.length-2]=_.startX,p[p.length-1]=_.startY):(p[T*4-2]=_.startX,p[T*4-1]=_.startY),p[T*4]=_.stopX,p[T*4+1]=_.stopY,f=qg(e,r,i,a,_.cx,_.cy,_.radius),f.length!==0&&c.push(f[0],f[1])});for(var g=0;g<p.length/4;g++)f=Dd(e,r,i,a,p[g*4],p[g*4+1],p[g*4+2],p[g*4+3],!1),f.length!==0&&c.push(f[0],f[1]);if(c.length>2){for(var y=[c[0],c[1]],S=Math.pow(y[0]-e,2)+Math.pow(y[1]-r,2),w=1;w<c.length/2;w++){var C=Math.pow(c[w*2]-e,2)+Math.pow(c[w*2+1]-r,2);C<=S&&(y[0]=c[w*2],y[1]=c[w*2+1],S=C)}return y}return c},ry=function(e,r,n){var i=[e[0]-r[0],e[1]-r[1]],a=Math.sqrt(i[0]*i[0]+i[1]*i[1]),s=(a-n)/a;return s<0&&(s=1e-5),[r[0]+s*i[0],r[1]+s*i[1]]},Cs=function(e,r){var n=US(e,r);return n=aA(n),n},aA=function(e){for(var r,n,i=e.length/2,a=1/0,s=1/0,o=-1/0,l=-1/0,u=0;u<i;u++)r=e[2*u],n=e[2*u+1],a=Math.min(a,r),o=Math.max(o,r),s=Math.min(s,n),l=Math.max(l,n);for(var c=2/(o-a),f=2/(l-s),p=0;p<i;p++)r=e[2*p]=e[2*p]*c,n=e[2*p+1]=e[2*p+1]*f,a=Math.min(a,r),o=Math.max(o,r),s=Math.min(s,n),l=Math.max(l,n);if(s<-1)for(var g=0;g<i;g++)n=e[2*g+1]=e[2*g+1]+(-1-s);return e},US=function(e,r){var n=1/e*2*Math.PI,i=e%2===0?Math.PI/2+n/2:Math.PI/2;i+=r;for(var a=new Array(e*2),s,o=0;o<e;o++)s=o*n+i,a[2*o]=Math.cos(s),a[2*o+1]=Math.sin(-s);return a},Yd=function(e,r){return Math.min(e/4,r/4,8)},sA=function(e,r){return Math.min(e/10,r/10,8)},f_=function(){return 8},yF=function(e,r,n){return[e-2*r+n,2*(r-e),e]},GS=function(e,r){return{heightOffset:Math.min(15,.05*r),widthOffset:Math.min(100,.25*e),ctrlPtOffsetPct:.05}};function pw(t,e){function r(f){for(var p=[],g=0;g<f.length;g++){var y=f[g],S=f[(g+1)%f.length],w={x:S.x-y.x,y:S.y-y.y},C={x:-w.y,y:w.x},_=Math.sqrt(C.x*C.x+C.y*C.y);p.push({x:C.x/_,y:C.y/_})}return p}function n(f,p){var g=1/0,y=-1/0,S=Ys(f),w;try{for(S.s();!(w=S.n()).done;){var C=w.value,_=C.x*p.x+C.y*p.y;g=Math.min(g,_),y=Math.max(y,_)}}catch(T){S.e(T)}finally{S.f()}return{min:g,max:y}}function i(f,p){return!(f.max<p.min||p.max<f.min)}var a=[].concat(lx(r(t)),lx(r(e))),s=Ys(a),o;try{for(s.s();!(o=s.n()).done;){var l=o.value,u=n(t,l),c=n(e,l);if(!i(u,c))return!1}}catch(f){s.e(f)}finally{s.f()}return!0}var xF=Ha({dampingFactor:.8,precision:1e-6,iterations:200,weight:function(e){return 1}}),bF={pageRank:function(e){for(var r=xF(e),n=r.dampingFactor,i=r.precision,a=r.iterations,s=r.weight,o=this._private.cy,l=this.byGroup(),u=l.nodes,c=l.edges,f=u.length,p=f*f,g=c.length,y=new Array(p),S=new Array(f),w=(1-n)/f,C=0;C<f;C++){for(var _=0;_<f;_++){var T=C*f+_;y[T]=0}S[C]=0}for(var N=0;N<g;N++){var R=c[N],D=R.data("source"),j=R.data("target");if(D!==j){var O=u.indexOfId(D),F=u.indexOfId(j),z=s(R),G=F*f+O;y[G]+=z,S[O]+=z}}for(var Z=1/f+w,I=0;I<f;I++)if(S[I]===0)for(var W=0;W<f;W++){var U=W*f+I;y[U]=Z}else for(var K=0;K<f;K++){var $=K*f+I;y[$]=y[$]/S[I]+w}for(var Q=new Array(f),ie=new Array(f),te,X=0;X<f;X++)Q[X]=1;for(var re=0;re<a;re++){for(var fe=0;fe<f;fe++)ie[fe]=0;for(var oe=0;oe<f;oe++)for(var se=0;se<f;se++){var he=oe*f+se;ie[oe]+=y[he]*Q[se]}eF(ie),te=Q,Q=ie,ie=te;for(var ae=0,pe=0;pe<f;pe++){var ye=te[pe]-Q[pe];ae+=ye*ye}if(ae<i)break}var ve={rank:function(xe){return xe=o.collection(xe)[0],Q[u.indexOf(xe)]}};return ve}},sT=Ha({root:null,weight:function(e){return 1},directed:!1,alpha:0}),jp={degreeCentralityNormalized:function(e){e=sT(e);var r=this.cy(),n=this.nodes(),i=n.length;if(e.directed){for(var c={},f={},p=0,g=0,y=0;y<i;y++){var S=n[y],w=S.id();e.root=S;var C=this.degreeCentrality(e);p<C.indegree&&(p=C.indegree),g<C.outdegree&&(g=C.outdegree),c[w]=C.indegree,f[w]=C.outdegree}return{indegree:function(T){return p==0?0:(Yt(T)&&(T=r.filter(T)),c[T.id()]/p)},outdegree:function(T){return g===0?0:(Yt(T)&&(T=r.filter(T)),f[T.id()]/g)}}}else{for(var a={},s=0,o=0;o<i;o++){var l=n[o];e.root=l;var u=this.degreeCentrality(e);s<u.degree&&(s=u.degree),a[l.id()]=u.degree}return{degree:function(T){return s===0?0:(Yt(T)&&(T=r.filter(T)),a[T.id()]/s)}}}},degreeCentrality:function(e){e=sT(e);var r=this.cy(),n=this,i=e,a=i.root,s=i.weight,o=i.directed,l=i.alpha;if(a=r.collection(a)[0],o){for(var g=a.connectedEdges(),y=g.filter(function(D){return D.target().same(a)&&n.has(D)}),S=g.filter(function(D){return D.source().same(a)&&n.has(D)}),w=y.length,C=S.length,_=0,T=0,N=0;N<y.length;N++)_+=s(y[N]);for(var R=0;R<S.length;R++)T+=s(S[R]);return{indegree:Math.pow(w,1-l)*Math.pow(_,l),outdegree:Math.pow(C,1-l)*Math.pow(T,l)}}else{for(var u=a.connectedEdges().intersection(n),c=u.length,f=0,p=0;p<u.length;p++)f+=s(u[p]);return{degree:Math.pow(c,1-l)*Math.pow(f,l)}}}};jp.dc=jp.degreeCentrality;jp.dcn=jp.degreeCentralityNormalised=jp.degreeCentralityNormalized;var oT=Ha({harmonic:!0,weight:function(){return 1},directed:!1,root:null}),Fp={closenessCentralityNormalized:function(e){for(var r=oT(e),n=r.harmonic,i=r.weight,a=r.directed,s=this.cy(),o={},l=0,u=this.nodes(),c=this.floydWarshall({weight:i,directed:a}),f=0;f<u.length;f++){for(var p=0,g=u[f],y=0;y<u.length;y++)if(f!==y){var S=c.distance(g,u[y]);n?p+=1/S:p+=S}n||(p=1/p),l<p&&(l=p),o[g.id()]=p}return{closeness:function(C){return l==0?0:(Yt(C)?C=s.filter(C)[0].id():C=C.id(),o[C]/l)}}},closenessCentrality:function(e){var r=oT(e),n=r.root,i=r.weight,a=r.directed,s=r.harmonic;n=this.filter(n)[0];for(var o=this.dijkstra({root:n,weight:i,directed:a}),l=0,u=this.nodes(),c=0;c<u.length;c++){var f=u[c];if(!f.same(n)){var p=o.distanceTo(f);s?l+=1/p:l+=p}}return s?l:1/l}};Fp.cc=Fp.closenessCentrality;Fp.ccn=Fp.closenessCentralityNormalised=Fp.closenessCentralityNormalized;var wF=Ha({weight:null,directed:!1}),VS={betweennessCentrality:function(e){for(var r=wF(e),n=r.directed,i=r.weight,a=i!=null,s=this.cy(),o=this.nodes(),l={},u={},c=0,f={set:function(T,N){u[T]=N,N>c&&(c=N)},get:function(T){return u[T]}},p=0;p<o.length;p++){var g=o[p],y=g.id();n?l[y]=g.outgoers().nodes():l[y]=g.openNeighborhood().nodes(),f.set(y,0)}for(var S=function(){for(var T=o[w].id(),N=[],R={},D={},j={},O=new r0(function(oe,se){return j[oe]-j[se]}),F=0;F<o.length;F++){var z=o[F].id();R[z]=[],D[z]=0,j[z]=1/0}for(D[T]=1,j[T]=0,O.push(T);!O.empty();){var G=O.pop();if(N.push(G),a)for(var Z=0;Z<l[G].length;Z++){var I=l[G][Z],W=s.getElementById(G),U=void 0;W.edgesTo(I).length>0?U=W.edgesTo(I)[0]:U=I.edgesTo(W)[0];var K=i(U);I=I.id(),j[I]>j[G]+K&&(j[I]=j[G]+K,O.nodes.indexOf(I)<0?O.push(I):O.updateItem(I),D[I]=0,R[I]=[]),j[I]==j[G]+K&&(D[I]=D[I]+D[G],R[I].push(G))}else for(var $=0;$<l[G].length;$++){var Q=l[G][$].id();j[Q]==1/0&&(O.push(Q),j[Q]=j[G]+1),j[Q]==j[G]+1&&(D[Q]=D[Q]+D[G],R[Q].push(G))}}for(var ie={},te=0;te<o.length;te++)ie[o[te].id()]=0;for(;N.length>0;){for(var X=N.pop(),re=0;re<R[X].length;re++){var fe=R[X][re];ie[fe]=ie[fe]+D[fe]/D[X]*(1+ie[X])}X!=o[w].id()&&f.set(X,f.get(X)+ie[X])}},w=0;w<o.length;w++)S();var C={betweenness:function(T){var N=s.collection(T).id();return f.get(N)},betweennessNormalized:function(T){if(c==0)return 0;var N=s.collection(T).id();return f.get(N)/c}};return C.betweennessNormalised=C.betweennessNormalized,C}};VS.bc=VS.betweennessCentrality;var SF=Ha({expandFactor:2,inflateFactor:2,multFactor:1,maxIterations:20,attributes:[function(t){return 1}]}),kF=function(e){return SF(e)},_F=function(e,r){for(var n=0,i=0;i<r.length;i++)n+=r[i](e);return n},CF=function(e,r,n){for(var i=0;i<r;i++)e[i*r+i]=n},oA=function(e,r){for(var n,i=0;i<r;i++){n=0;for(var a=0;a<r;a++)n+=e[a*r+i];for(var s=0;s<r;s++)e[s*r+i]=e[s*r+i]/n}},EF=function(e,r,n){for(var i=new Array(n*n),a=0;a<n;a++){for(var s=0;s<n;s++)i[a*n+s]=0;for(var o=0;o<n;o++)for(var l=0;l<n;l++)i[a*n+l]+=e[a*n+o]*r[o*n+l]}return i},TF=function(e,r,n){for(var i=e.slice(0),a=1;a<n;a++)e=EF(e,i,r);return e},NF=function(e,r,n){for(var i=new Array(r*r),a=0;a<r*r;a++)i[a]=Math.pow(e[a],n);return oA(i,r),i},PF=function(e,r,n,i){for(var a=0;a<n;a++){var s=Math.round(e[a]*Math.pow(10,i))/Math.pow(10,i),o=Math.round(r[a]*Math.pow(10,i))/Math.pow(10,i);if(s!==o)return!1}return!0},MF=function(e,r,n,i){for(var a=[],s=0;s<r;s++){for(var o=[],l=0;l<r;l++)Math.round(e[s*r+l]*1e3)/1e3>0&&o.push(n[l]);o.length!==0&&a.push(i.collection(o))}return a},AF=function(e,r){for(var n=0;n<e.length;n++)if(!r[n]||e[n].id()!==r[n].id())return!1;return!0},LF=function(e){for(var r=0;r<e.length;r++)for(var n=0;n<e.length;n++)r!=n&&AF(e[r],e[n])&&e.splice(n,1);return e},lT=function(e){for(var r=this.nodes(),n=this.edges(),i=this.cy(),a=kF(e),s={},o=0;o<r.length;o++)s[r[o].id()]=o;for(var l=r.length,u=l*l,c=new Array(u),f,p=0;p<u;p++)c[p]=0;for(var g=0;g<n.length;g++){var y=n[g],S=s[y.source().id()],w=s[y.target().id()],C=_F(y,a.attributes);c[S*l+w]+=C,c[w*l+S]+=C}CF(c,l,a.multFactor),oA(c,l);for(var _=!0,T=0;_&&T<a.maxIterations;)_=!1,f=TF(c,l,a.expandFactor),c=NF(f,l,a.inflateFactor),PF(c,f,u,4)||(_=!0),T++;var N=MF(c,l,r,i);return N=LF(N),N},RF={markovClustering:lT,mcl:lT},OF=function(e){return e},lA=function(e,r){return Math.abs(r-e)},uT=function(e,r,n){return e+lA(r,n)},cT=function(e,r,n){return e+Math.pow(n-r,2)},DF=function(e){return Math.sqrt(e)},IF=function(e,r,n){return Math.max(e,lA(r,n))},Vm=function(e,r,n,i,a){for(var s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:OF,o=i,l,u,c=0;c<e;c++)l=r(c),u=n(c),o=a(o,l,u);return s(o)},Wp={euclidean:function(e,r,n){return e>=2?Vm(e,r,n,0,cT,DF):Vm(e,r,n,0,uT)},squaredEuclidean:function(e,r,n){return Vm(e,r,n,0,cT)},manhattan:function(e,r,n){return Vm(e,r,n,0,uT)},max:function(e,r,n){return Vm(e,r,n,-1/0,IF)}};Wp["squared-euclidean"]=Wp.squaredEuclidean;Wp.squaredeuclidean=Wp.squaredEuclidean;function P1(t,e,r,n,i,a){var s;return ri(t)?s=t:s=Wp[t]||Wp.euclidean,e===0&&ri(t)?s(i,a):s(e,r,n,i,a)}var jF=Ha({k:2,m:2,sensitivityThreshold:1e-4,distance:"euclidean",maxIterations:10,attributes:[],testMode:!1,testCentroids:null}),h_=function(e){return jF(e)},px=function(e,r,n,i,a){var s=a!=="kMedoids",o=s?function(f){return n[f]}:function(f){return i[f](n)},l=function(p){return i[p](r)},u=n,c=r;return P1(e,i.length,o,l,u,c)},mw=function(e,r,n){for(var i=n.length,a=new Array(i),s=new Array(i),o=new Array(r),l=null,u=0;u<i;u++)a[u]=e.min(n[u]).value,s[u]=e.max(n[u]).value;for(var c=0;c<r;c++){l=[];for(var f=0;f<i;f++)l[f]=Math.random()*(s[f]-a[f])+a[f];o[c]=l}return o},uA=function(e,r,n,i,a){for(var s=1/0,o=0,l=0;l<r.length;l++){var u=px(n,e,r[l],i,a);u<s&&(s=u,o=l)}return o},cA=function(e,r,n){for(var i=[],a=null,s=0;s<r.length;s++)a=r[s],n[a.id()]===e&&i.push(a);return i},FF=function(e,r,n){return Math.abs(r-e)<=n},BF=function(e,r,n){for(var i=0;i<e.length;i++)for(var a=0;a<e[i].length;a++){var s=Math.abs(e[i][a]-r[i][a]);if(s>n)return!1}return!0},zF=function(e,r,n){for(var i=0;i<n;i++)if(e===r[i])return!0;return!1},dT=function(e,r){var n=new Array(r);if(e.length<50)for(var i=0;i<r;i++){for(var a=e[Math.floor(Math.random()*e.length)];zF(a,n,i);)a=e[Math.floor(Math.random()*e.length)];n[i]=a}else for(var s=0;s<r;s++)n[s]=e[Math.floor(Math.random()*e.length)];return n},fT=function(e,r,n){for(var i=0,a=0;a<r.length;a++)i+=px("manhattan",r[a],e,n,"kMedoids");return i},UF=function(e){var r=this.cy(),n=this.nodes(),i=null,a=h_(e),s=new Array(a.k),o={},l;a.testMode?typeof a.testCentroids=="number"?(a.testCentroids,l=mw(n,a.k,a.attributes)):qi(a.testCentroids)==="object"?l=a.testCentroids:l=mw(n,a.k,a.attributes):l=mw(n,a.k,a.attributes);for(var u=!0,c=0;u&&c<a.maxIterations;){for(var f=0;f<n.length;f++)i=n[f],o[i.id()]=uA(i,l,a.distance,a.attributes,"kMeans");u=!1;for(var p=0;p<a.k;p++){var g=cA(p,n,o);if(g.length!==0){for(var y=a.attributes.length,S=l[p],w=new Array(y),C=new Array(y),_=0;_<y;_++){C[_]=0;for(var T=0;T<g.length;T++)i=g[T],C[_]+=a.attributes[_](i);w[_]=C[_]/g.length,FF(w[_],S[_],a.sensitivityThreshold)||(u=!0)}l[p]=w,s[p]=r.collection(g)}}c++}return s},GF=function(e){var r=this.cy(),n=this.nodes(),i=null,a=h_(e),s=new Array(a.k),o,l={},u,c=new Array(a.k);a.testMode?typeof a.testCentroids=="number"||(qi(a.testCentroids)==="object"?o=a.testCentroids:o=dT(n,a.k)):o=dT(n,a.k);for(var f=!0,p=0;f&&p<a.maxIterations;){for(var g=0;g<n.length;g++)i=n[g],l[i.id()]=uA(i,o,a.distance,a.attributes,"kMedoids");f=!1;for(var y=0;y<o.length;y++){var S=cA(y,n,l);if(S.length!==0){c[y]=fT(o[y],S,a.attributes);for(var w=0;w<S.length;w++)u=fT(S[w],S,a.attributes),u<c[y]&&(c[y]=u,o[y]=S[w],f=!0);s[y]=r.collection(S)}}p++}return s},VF=function(e,r,n,i,a){for(var s,o,l=0;l<r.length;l++)for(var u=0;u<e.length;u++)i[l][u]=Math.pow(n[l][u],a.m);for(var c=0;c<e.length;c++)for(var f=0;f<a.attributes.length;f++){s=0,o=0;for(var p=0;p<r.length;p++)s+=i[p][c]*a.attributes[f](r[p]),o+=i[p][c];e[c][f]=s/o}},HF=function(e,r,n,i,a){for(var s=0;s<e.length;s++)r[s]=e[s].slice();for(var o,l,u,c=2/(a.m-1),f=0;f<n.length;f++)for(var p=0;p<i.length;p++){o=0;for(var g=0;g<n.length;g++)l=px(a.distance,i[p],n[f],a.attributes,"cmeans"),u=px(a.distance,i[p],n[g],a.attributes,"cmeans"),o+=Math.pow(l/u,c);e[p][f]=1/o}},WF=function(e,r,n,i){for(var a=new Array(n.k),s=0;s<a.length;s++)a[s]=[];for(var o,l,u=0;u<r.length;u++){o=-1/0,l=-1;for(var c=0;c<r[0].length;c++)r[u][c]>o&&(o=r[u][c],l=c);a[l].push(e[u])}for(var f=0;f<a.length;f++)a[f]=i.collection(a[f]);return a},hT=function(e){var r=this.cy(),n=this.nodes(),i=h_(e),a,s,o,l,u;l=new Array(n.length);for(var c=0;c<n.length;c++)l[c]=new Array(i.k);o=new Array(n.length);for(var f=0;f<n.length;f++)o[f]=new Array(i.k);for(var p=0;p<n.length;p++){for(var g=0,y=0;y<i.k;y++)o[p][y]=Math.random(),g+=o[p][y];for(var S=0;S<i.k;S++)o[p][S]=o[p][S]/g}s=new Array(i.k);for(var w=0;w<i.k;w++)s[w]=new Array(i.attributes.length);u=new Array(n.length);for(var C=0;C<n.length;C++)u[C]=new Array(i.k);for(var _=!0,T=0;_&&T<i.maxIterations;)_=!1,VF(s,n,o,u,i),HF(o,l,s,n,i),BF(o,l,i.sensitivityThreshold)||(_=!0),T++;return a=WF(n,o,i,r),{clusters:a,degreeOfMembership:o}},qF={kMeans:UF,kMedoids:GF,fuzzyCMeans:hT,fcm:hT},$F=Ha({distance:"euclidean",linkage:"min",mode:"threshold",threshold:1/0,addDendrogram:!1,dendrogramDepth:0,attributes:[]}),KF={single:"min",complete:"max"},ZF=function(e){var r=$F(e),n=KF[r.linkage];return n!=null&&(r.linkage=n),r},pT=function(e,r,n,i,a){for(var s=0,o=1/0,l,u=a.attributes,c=function(F,z){return P1(a.distance,u.length,function(G){return u[G](F)},function(G){return u[G](z)},F,z)},f=0;f<e.length;f++){var p=e[f].key,g=n[p][i[p]];g<o&&(s=p,o=g)}if(a.mode==="threshold"&&o>=a.threshold||a.mode==="dendrogram"&&e.length===1)return!1;var y=r[s],S=r[i[s]],w;a.mode==="dendrogram"?w={left:y,right:S,key:y.key}:w={value:y.value.concat(S.value),key:y.key},e[y.index]=w,e.splice(S.index,1),r[y.key]=w;for(var C=0;C<e.length;C++){var _=e[C];y.key===_.key?l=1/0:a.linkage==="min"?(l=n[y.key][_.key],n[y.key][_.key]>n[S.key][_.key]&&(l=n[S.key][_.key])):a.linkage==="max"?(l=n[y.key][_.key],n[y.key][_.key]<n[S.key][_.key]&&(l=n[S.key][_.key])):a.linkage==="mean"?l=(n[y.key][_.key]*y.size+n[S.key][_.key]*S.size)/(y.size+S.size):a.mode==="dendrogram"?l=c(_.value,y.value):l=c(_.value[0],y.value[0]),n[y.key][_.key]=n[_.key][y.key]=l}for(var T=0;T<e.length;T++){var N=e[T].key;if(i[N]===y.key||i[N]===S.key){for(var R=N,D=0;D<e.length;D++){var j=e[D].key;n[N][j]<n[N][R]&&(R=j)}i[N]=R}e[T].index=T}return y.key=S.key=y.index=S.index=null,!0},Lp=function(e,r,n){e&&(e.value?r.push(e.value):(e.left&&Lp(e.left,r),e.right&&Lp(e.right,r)))},HS=function(e,r){if(!e)return"";if(e.left&&e.right){var n=HS(e.left,r),i=HS(e.right,r),a=r.add({group:"nodes",data:{id:n+","+i}});return r.add({group:"edges",data:{source:n,target:a.id()}}),r.add({group:"edges",data:{source:i,target:a.id()}}),a.id()}else if(e.value)return e.value.id()},WS=function(e,r,n){if(!e)return[];var i=[],a=[],s=[];return r===0?(e.left&&Lp(e.left,i),e.right&&Lp(e.right,a),s=i.concat(a),[n.collection(s)]):r===1?e.value?[n.collection(e.value)]:(e.left&&Lp(e.left,i),e.right&&Lp(e.right,a),[n.collection(i),n.collection(a)]):e.value?[n.collection(e.value)]:(e.left&&(i=WS(e.left,r-1,n)),e.right&&(a=WS(e.right,r-1,n)),i.concat(a))},mT=function(e){for(var r=this.cy(),n=this.nodes(),i=ZF(e),a=i.attributes,s=function(T,N){return P1(i.distance,a.length,function(R){return a[R](T)},function(R){return a[R](N)},T,N)},o=[],l=[],u=[],c=[],f=0;f<n.length;f++){var p={value:i.mode==="dendrogram"?n[f]:[n[f]],key:f,index:f};o[f]=p,c[f]=p,l[f]=[],u[f]=0}for(var g=0;g<o.length;g++)for(var y=0;y<=g;y++){var S=void 0;i.mode==="dendrogram"?S=g===y?1/0:s(o[g].value,o[y].value):S=g===y?1/0:s(o[g].value[0],o[y].value[0]),l[g][y]=S,l[y][g]=S,S<l[g][u[g]]&&(u[g]=y)}for(var w=pT(o,c,l,u,i);w;)w=pT(o,c,l,u,i);var C;return i.mode==="dendrogram"?(C=WS(o[0],i.dendrogramDepth,r),i.addDendrogram&&HS(o[0],r)):(C=new Array(o.length),o.forEach(function(_,T){_.key=_.index=null,C[T]=r.collection(_.value)})),C},YF={hierarchicalClustering:mT,hca:mT},XF=Ha({distance:"euclidean",preference:"median",damping:.8,maxIterations:1e3,minIterations:100,attributes:[]}),QF=function(e){var r=e.damping,n=e.preference;.5<=r&&r<1||Zn("Damping must range on [0.5, 1).  Got: ".concat(r));var i=["median","mean","min","max"];return i.some(function(a){return a===n})||_t(n)||Zn("Preference must be one of [".concat(i.map(function(a){return"'".concat(a,"'")}).join(", "),"] or a number.  Got: ").concat(n)),XF(e)},JF=function(e,r,n,i){var a=function(o,l){return i[l](o)};return-P1(e,i.length,function(s){return a(r,s)},function(s){return a(n,s)},r,n)},eB=function(e,r){var n=null;return r==="median"?n=Q9(e):r==="mean"?n=X9(e):r==="min"?n=Z9(e):r==="max"?n=Y9(e):n=r,n},tB=function(e,r,n){for(var i=[],a=0;a<e;a++)r[a*e+a]+n[a*e+a]>0&&i.push(a);return i},gT=function(e,r,n){for(var i=[],a=0;a<e;a++){for(var s=-1,o=-1/0,l=0;l<n.length;l++){var u=n[l];r[a*e+u]>o&&(s=u,o=r[a*e+u])}s>0&&i.push(s)}for(var c=0;c<n.length;c++)i[n[c]]=n[c];return i},rB=function(e,r,n){for(var i=gT(e,r,n),a=0;a<n.length;a++){for(var s=[],o=0;o<i.length;o++)i[o]===n[a]&&s.push(o);for(var l=-1,u=-1/0,c=0;c<s.length;c++){for(var f=0,p=0;p<s.length;p++)f+=r[s[p]*e+s[c]];f>u&&(l=c,u=f)}n[a]=s[l]}return i=gT(e,r,n),i},vT=function(e){for(var r=this.cy(),n=this.nodes(),i=QF(e),a={},s=0;s<n.length;s++)a[n[s].id()]=s;var o,l,u,c,f,p;o=n.length,l=o*o,u=new Array(l);for(var g=0;g<l;g++)u[g]=-1/0;for(var y=0;y<o;y++)for(var S=0;S<o;S++)y!==S&&(u[y*o+S]=JF(i.distance,n[y],n[S],i.attributes));c=eB(u,i.preference);for(var w=0;w<o;w++)u[w*o+w]=c;f=new Array(l);for(var C=0;C<l;C++)f[C]=0;p=new Array(l);for(var _=0;_<l;_++)p[_]=0;for(var T=new Array(o),N=new Array(o),R=new Array(o),D=0;D<o;D++)T[D]=0,N[D]=0,R[D]=0;for(var j=new Array(o*i.minIterations),O=0;O<j.length;O++)j[O]=0;var F;for(F=0;F<i.maxIterations;F++){for(var z=0;z<o;z++){for(var G=-1/0,Z=-1/0,I=-1,W=0,U=0;U<o;U++)T[U]=f[z*o+U],W=p[z*o+U]+u[z*o+U],W>=G?(Z=G,G=W,I=U):W>Z&&(Z=W);for(var K=0;K<o;K++)f[z*o+K]=(1-i.damping)*(u[z*o+K]-G)+i.damping*T[K];f[z*o+I]=(1-i.damping)*(u[z*o+I]-Z)+i.damping*T[I]}for(var $=0;$<o;$++){for(var Q=0,ie=0;ie<o;ie++)T[ie]=p[ie*o+$],N[ie]=Math.max(0,f[ie*o+$]),Q+=N[ie];Q-=N[$],N[$]=f[$*o+$],Q+=N[$];for(var te=0;te<o;te++)p[te*o+$]=(1-i.damping)*Math.min(0,Q-N[te])+i.damping*T[te];p[$*o+$]=(1-i.damping)*(Q-N[$])+i.damping*T[$]}for(var X=0,re=0;re<o;re++){var fe=p[re*o+re]+f[re*o+re]>0?1:0;j[F%i.minIterations*o+re]=fe,X+=fe}if(X>0&&(F>=i.minIterations-1||F==i.maxIterations-1)){for(var oe=0,se=0;se<o;se++){R[se]=0;for(var he=0;he<i.minIterations;he++)R[se]+=j[he*o+se];(R[se]===0||R[se]===i.minIterations)&&oe++}if(oe===o)break}}for(var ae=tB(o,f,p),pe=rB(o,u,ae),ye={},ve=0;ve<ae.length;ve++)ye[ae[ve]]=[];for(var ue=0;ue<n.length;ue++){var xe=a[n[ue].id()],Se=pe[xe];Se!=null&&ye[Se].push(n[ue])}for(var Ae=new Array(ae.length),Me=0;Me<ae.length;Me++)Ae[Me]=r.collection(ye[ae[Me]]);return Ae},nB={affinityPropagation:vT,ap:vT},iB=Ha({root:void 0,directed:!1}),aB={hierholzer:function(e){if(!Wr(e)){var r=arguments;e={root:r[0],directed:r[1]}}var n=iB(e),i=n.root,a=n.directed,s=this,o=!1,l,u,c;i&&(c=Yt(i)?this.filter(i)[0].id():i[0].id());var f={},p={};a?s.forEach(function(_){var T=_.id();if(_.isNode()){var N=_.indegree(!0),R=_.outdegree(!0),D=N-R,j=R-N;D==1?l?o=!0:l=T:j==1?u?o=!0:u=T:(j>1||D>1)&&(o=!0),f[T]=[],_.outgoers().forEach(function(O){O.isEdge()&&f[T].push(O.id())})}else p[T]=[void 0,_.target().id()]}):s.forEach(function(_){var T=_.id();if(_.isNode()){var N=_.degree(!0);N%2&&(l?u?o=!0:u=T:l=T),f[T]=[],_.connectedEdges().forEach(function(R){return f[T].push(R.id())})}else p[T]=[_.source().id(),_.target().id()]});var g={found:!1,trail:void 0};if(o)return g;if(u&&l)if(a){if(c&&u!=c)return g;c=u}else{if(c&&u!=c&&l!=c)return g;c||(c=u)}else c||(c=s[0].id());var y=function(T){for(var N=T,R=[T],D,j,O;f[N].length;)D=f[N].shift(),j=p[D][0],O=p[D][1],N!=O?(f[O]=f[O].filter(function(F){return F!=D}),N=O):!a&&N!=j&&(f[j]=f[j].filter(function(F){return F!=D}),N=j),R.unshift(D),R.unshift(N);return R},S=[],w=[];for(w=y(c);w.length!=1;)f[w[0]].length==0?(S.unshift(s.getElementById(w.shift())),S.unshift(s.getElementById(w.shift()))):w=y(w.shift()).concat(w);S.unshift(s.getElementById(w.shift()));for(var C in f)if(f[C].length)return g;return g.found=!0,g.trail=this.spawn(S,!0),g}},ny=function(){var e=this,r={},n=0,i=0,a=[],s=[],o={},l=function(p,g){for(var y=s.length-1,S=[],w=e.spawn();s[y].x!=p||s[y].y!=g;)S.push(s.pop().edge),y--;S.push(s.pop().edge),S.forEach(function(C){var _=C.connectedNodes().intersection(e);w.merge(C),_.forEach(function(T){var N=T.id(),R=T.connectedEdges().intersection(e);w.merge(T),r[N].cutVertex?w.merge(R.filter(function(D){return D.isLoop()})):w.merge(R)})}),a.push(w)},u=function(p,g,y){p===y&&(i+=1),r[g]={id:n,low:n++,cutVertex:!1};var S=e.getElementById(g).connectedEdges().intersection(e);if(S.size()===0)a.push(e.spawn(e.getElementById(g)));else{var w,C,_,T;S.forEach(function(N){w=N.source().id(),C=N.target().id(),_=w===g?C:w,_!==y&&(T=N.id(),o[T]||(o[T]=!0,s.push({x:g,y:_,edge:N})),_ in r?r[g].low=Math.min(r[g].low,r[_].id):(u(p,_,g),r[g].low=Math.min(r[g].low,r[_].low),r[g].id<=r[_].low&&(r[g].cutVertex=!0,l(g,_))))})}};e.forEach(function(f){if(f.isNode()){var p=f.id();p in r||(i=0,u(p,p),r[p].cutVertex=i>1)}});var c=Object.keys(r).filter(function(f){return r[f].cutVertex}).map(function(f){return e.getElementById(f)});return{cut:e.spawn(c),components:a}},sB={hopcroftTarjanBiconnected:ny,htbc:ny,htb:ny,hopcroftTarjanBiconnectedComponents:ny},iy=function(){var e=this,r={},n=0,i=[],a=[],s=e.spawn(e),o=function(u){a.push(u),r[u]={index:n,low:n++,explored:!1};var c=e.getElementById(u).connectedEdges().intersection(e);if(c.forEach(function(S){var w=S.target().id();w!==u&&(w in r||o(w),r[w].explored||(r[u].low=Math.min(r[u].low,r[w].low)))}),r[u].index===r[u].low){for(var f=e.spawn();;){var p=a.pop();if(f.merge(e.getElementById(p)),r[p].low=r[u].index,r[p].explored=!0,p===u)break}var g=f.edgesWith(f),y=f.merge(g);i.push(y),s=s.difference(y)}};return e.forEach(function(l){if(l.isNode()){var u=l.id();u in r||o(u)}}),{cut:s,components:i}},oB={tarjanStronglyConnected:iy,tsc:iy,tscc:iy,tarjanStronglyConnectedComponents:iy},dA={};[kv,j9,F9,z9,G9,H9,$9,bF,jp,Fp,VS,RF,qF,YF,nB,aB,sB,oB].forEach(function(t){sr(dA,t)});var fA=0,hA=1,pA=2,Fl=function(e){if(!(this instanceof Fl))return new Fl(e);this.id="Thenable/1.0.7",this.state=fA,this.fulfillValue=void 0,this.rejectReason=void 0,this.onFulfilled=[],this.onRejected=[],this.proxy={then:this.then.bind(this)},typeof e=="function"&&e.call(this,this.fulfill.bind(this),this.reject.bind(this))};Fl.prototype={fulfill:function(e){return yT(this,hA,"fulfillValue",e)},reject:function(e){return yT(this,pA,"rejectReason",e)},then:function(e,r){var n=this,i=new Fl;return n.onFulfilled.push(bT(e,i,"fulfill")),n.onRejected.push(bT(r,i,"reject")),mA(n),i.proxy}};var yT=function(e,r,n,i){return e.state===fA&&(e.state=r,e[n]=i,mA(e)),e},mA=function(e){e.state===hA?xT(e,"onFulfilled",e.fulfillValue):e.state===pA&&xT(e,"onRejected",e.rejectReason)},xT=function(e,r,n){if(e[r].length!==0){var i=e[r];e[r]=[];var a=function(){for(var o=0;o<i.length;o++)i[o](n)};typeof setImmediate=="function"?setImmediate(a):setTimeout(a,0)}},bT=function(e,r,n){return function(i){if(typeof e!="function")r[n].call(r,i);else{var a;try{a=e(i)}catch(s){r.reject(s);return}gA(r,a)}}},gA=function(e,r){if(e===r||e.proxy===r){e.reject(new TypeError("cannot resolve promise with itself"));return}var n;if(qi(r)==="object"&&r!==null||typeof r=="function")try{n=r.then}catch(a){e.reject(a);return}if(typeof n=="function"){var i=!1;try{n.call(r,function(a){i||(i=!0,a===r?e.reject(new TypeError("circular thenable chain")):gA(e,a))},function(a){i||(i=!0,e.reject(a))})}catch(a){i||e.reject(a)}return}e.fulfill(r)};Fl.all=function(t){return new Fl(function(e,r){for(var n=new Array(t.length),i=0,a=function(l,u){n[l]=u,i++,i===t.length&&e(n)},s=0;s<t.length;s++)(function(o){var l=t[o],u=l!=null&&l.then!=null;if(u)l.then(function(f){a(o,f)},function(f){r(f)});else{var c=l;a(o,c)}})(s)})};Fl.resolve=function(t){return new Fl(function(e,r){e(t)})};Fl.reject=function(t){return new Fl(function(e,r){r(t)})};var um=typeof Promise<"u"?Promise:Fl,qS=function(e,r,n){var i=n_(e),a=!i,s=this._private=sr({duration:1e3},r,n);if(s.target=e,s.style=s.style||s.css,s.started=!1,s.playing=!1,s.hooked=!1,s.applying=!1,s.progress=0,s.completes=[],s.frames=[],s.complete&&ri(s.complete)&&s.completes.push(s.complete),a){var o=e.position();s.startPosition=s.startPosition||{x:o.x,y:o.y},s.startStyle=s.startStyle||e.cy().style().getAnimationStartStyle(e,s.style)}if(i){var l=e.pan();s.startPan={x:l.x,y:l.y},s.startZoom=e.zoom()}this.length=1,this[0]=this},gh=qS.prototype;sr(gh,{instanceString:function(){return"animation"},hook:function(){var e=this._private;if(!e.hooked){var r,n=e.target._private.animation;e.queue?r=n.queue:r=n.current,r.push(this),vo(e.target)&&e.target.cy().addToAnimationPool(e.target),e.hooked=!0}return this},play:function(){var e=this._private;return e.progress===1&&(e.progress=0),e.playing=!0,e.started=!1,e.stopped=!1,this.hook(),this},playing:function(){return this._private.playing},apply:function(){var e=this._private;return e.applying=!0,e.started=!1,e.stopped=!1,this.hook(),this},applying:function(){return this._private.applying},pause:function(){var e=this._private;return e.playing=!1,e.started=!1,this},stop:function(){var e=this._private;return e.playing=!1,e.started=!1,e.stopped=!0,this},rewind:function(){return this.progress(0)},fastforward:function(){return this.progress(1)},time:function(e){var r=this._private;return e===void 0?r.progress*r.duration:this.progress(e/r.duration)},progress:function(e){var r=this._private,n=r.playing;return e===void 0?r.progress:(n&&this.pause(),r.progress=e,r.started=!1,n&&this.play(),this)},completed:function(){return this._private.progress===1},reverse:function(){var e=this._private,r=e.playing;r&&this.pause(),e.progress=1-e.progress,e.started=!1;var n=function(u,c){var f=e[u];f!=null&&(e[u]=e[c],e[c]=f)};if(n("zoom","startZoom"),n("pan","startPan"),n("position","startPosition"),e.style)for(var i=0;i<e.style.length;i++){var a=e.style[i],s=a.name,o=e.startStyle[s];e.startStyle[s]=a,e.style[i]=o}return r&&this.play(),this},promise:function(e){var r=this._private,n;switch(e){case"frame":n=r.frames;break;default:case"complete":case"completed":n=r.completes}return new um(function(i,a){n.push(function(){i()})})}});gh.complete=gh.completed;gh.run=gh.play;gh.running=gh.playing;var lB={animated:function(){return function(){var r=this,n=r.length!==void 0,i=n?r:[r],a=this._private.cy||this;if(!a.styleEnabled())return!1;var s=i[0];if(s)return s._private.animation.current.length>0}},clearQueue:function(){return function(){var r=this,n=r.length!==void 0,i=n?r:[r],a=this._private.cy||this;if(!a.styleEnabled())return this;for(var s=0;s<i.length;s++){var o=i[s];o._private.animation.queue=[]}return this}},delay:function(){return function(r,n){var i=this._private.cy||this;return i.styleEnabled()?this.animate({delay:r,duration:r,complete:n}):this}},delayAnimation:function(){return function(r,n){var i=this._private.cy||this;return i.styleEnabled()?this.animation({delay:r,duration:r,complete:n}):this}},animation:function(){return function(r,n){var i=this,a=i.length!==void 0,s=a?i:[i],o=this._private.cy||this,l=!a,u=!l;if(!o.styleEnabled())return this;var c=o.style();r=sr({},r,n);var f=Object.keys(r).length===0;if(f)return new qS(s[0],r);switch(r.duration===void 0&&(r.duration=400),r.duration){case"slow":r.duration=600;break;case"fast":r.duration=200;break}if(u&&(r.style=c.getPropsList(r.style||r.css),r.css=void 0),u&&r.renderedPosition!=null){var p=r.renderedPosition,g=o.pan(),y=o.zoom();r.position=tA(p,y,g)}if(l&&r.panBy!=null){var S=r.panBy,w=o.pan();r.pan={x:w.x+S.x,y:w.y+S.y}}var C=r.center||r.centre;if(l&&C!=null){var _=o.getCenterPan(C.eles,r.zoom);_!=null&&(r.pan=_)}if(l&&r.fit!=null){var T=r.fit,N=o.getFitViewport(T.eles||T.boundingBox,T.padding);N!=null&&(r.pan=N.pan,r.zoom=N.zoom)}if(l&&Wr(r.zoom)){var R=o.getZoomedViewport(r.zoom);R!=null?(R.zoomed&&(r.zoom=R.zoom),R.panned&&(r.pan=R.pan)):r.zoom=null}return new qS(s[0],r)}},animate:function(){return function(r,n){var i=this,a=i.length!==void 0,s=a?i:[i],o=this._private.cy||this;if(!o.styleEnabled())return this;n&&(r=sr({},r,n));for(var l=0;l<s.length;l++){var u=s[l],c=u.animated()&&(r.queue===void 0||r.queue),f=u.animation(r,c?{queue:!0}:void 0);f.play()}return this}},stop:function(){return function(r,n){var i=this,a=i.length!==void 0,s=a?i:[i],o=this._private.cy||this;if(!o.styleEnabled())return this;for(var l=0;l<s.length;l++){for(var u=s[l],c=u._private,f=c.animation.current,p=0;p<f.length;p++){var g=f[p],y=g._private;n&&(y.duration=0)}r&&(c.animation.queue=[]),n||(c.animation.current=[])}return o.notify("draw"),this}}},gw,wT;function M1(){if(wT)return gw;wT=1;var t=Array.isArray;return gw=t,gw}var vw,ST;function uB(){if(ST)return vw;ST=1;var t=M1(),e=e0(),r=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,n=/^\w*$/;function i(a,s){if(t(a))return!1;var o=typeof a;return o=="number"||o=="symbol"||o=="boolean"||a==null||e(a)?!0:n.test(a)||!r.test(a)||s!=null&&a in Object(s)}return vw=i,vw}var yw,kT;function cB(){if(kT)return yw;kT=1;var t=qM(),e=Jv(),r="[object AsyncFunction]",n="[object Function]",i="[object GeneratorFunction]",a="[object Proxy]";function s(o){if(!e(o))return!1;var l=t(o);return l==n||l==i||l==r||l==a}return yw=s,yw}var xw,_T;function dB(){if(_T)return xw;_T=1;var t=E1(),e=t["__core-js_shared__"];return xw=e,xw}var bw,CT;function fB(){if(CT)return bw;CT=1;var t=dB(),e=(function(){var n=/[^.]+$/.exec(t&&t.keys&&t.keys.IE_PROTO||"");return n?"Symbol(src)_1."+n:""})();function r(n){return!!e&&e in n}return bw=r,bw}var ww,ET;function hB(){if(ET)return ww;ET=1;var t=Function.prototype,e=t.toString;function r(n){if(n!=null){try{return e.call(n)}catch{}try{return n+""}catch{}}return""}return ww=r,ww}var Sw,TT;function pB(){if(TT)return Sw;TT=1;var t=cB(),e=fB(),r=Jv(),n=hB(),i=/[\\^$.*+?()[\]{}|]/g,a=/^\[object .+?Constructor\]$/,s=Function.prototype,o=Object.prototype,l=s.toString,u=o.hasOwnProperty,c=RegExp("^"+l.call(u).replace(i,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function f(p){if(!r(p)||e(p))return!1;var g=t(p)?c:a;return g.test(n(p))}return Sw=f,Sw}var kw,NT;function mB(){if(NT)return kw;NT=1;function t(e,r){return e?.[r]}return kw=t,kw}var _w,PT;function p_(){if(PT)return _w;PT=1;var t=pB(),e=mB();function r(n,i){var a=e(n,i);return t(a)?a:void 0}return _w=r,_w}var Cw,MT;function A1(){if(MT)return Cw;MT=1;var t=p_(),e=t(Object,"create");return Cw=e,Cw}var Ew,AT;function gB(){if(AT)return Ew;AT=1;var t=A1();function e(){this.__data__=t?t(null):{},this.size=0}return Ew=e,Ew}var Tw,LT;function vB(){if(LT)return Tw;LT=1;function t(e){var r=this.has(e)&&delete this.__data__[e];return this.size-=r?1:0,r}return Tw=t,Tw}var Nw,RT;function yB(){if(RT)return Nw;RT=1;var t=A1(),e="__lodash_hash_undefined__",r=Object.prototype,n=r.hasOwnProperty;function i(a){var s=this.__data__;if(t){var o=s[a];return o===e?void 0:o}return n.call(s,a)?s[a]:void 0}return Nw=i,Nw}var Pw,OT;function xB(){if(OT)return Pw;OT=1;var t=A1(),e=Object.prototype,r=e.hasOwnProperty;function n(i){var a=this.__data__;return t?a[i]!==void 0:r.call(a,i)}return Pw=n,Pw}var Mw,DT;function bB(){if(DT)return Mw;DT=1;var t=A1(),e="__lodash_hash_undefined__";function r(n,i){var a=this.__data__;return this.size+=this.has(n)?0:1,a[n]=t&&i===void 0?e:i,this}return Mw=r,Mw}var Aw,IT;function wB(){if(IT)return Aw;IT=1;var t=gB(),e=vB(),r=yB(),n=xB(),i=bB();function a(s){var o=-1,l=s==null?0:s.length;for(this.clear();++o<l;){var u=s[o];this.set(u[0],u[1])}}return a.prototype.clear=t,a.prototype.delete=e,a.prototype.get=r,a.prototype.has=n,a.prototype.set=i,Aw=a,Aw}var Lw,jT;function SB(){if(jT)return Lw;jT=1;function t(){this.__data__=[],this.size=0}return Lw=t,Lw}var Rw,FT;function vA(){if(FT)return Rw;FT=1;function t(e,r){return e===r||e!==e&&r!==r}return Rw=t,Rw}var Ow,BT;function L1(){if(BT)return Ow;BT=1;var t=vA();function e(r,n){for(var i=r.length;i--;)if(t(r[i][0],n))return i;return-1}return Ow=e,Ow}var Dw,zT;function kB(){if(zT)return Dw;zT=1;var t=L1(),e=Array.prototype,r=e.splice;function n(i){var a=this.__data__,s=t(a,i);if(s<0)return!1;var o=a.length-1;return s==o?a.pop():r.call(a,s,1),--this.size,!0}return Dw=n,Dw}var Iw,UT;function _B(){if(UT)return Iw;UT=1;var t=L1();function e(r){var n=this.__data__,i=t(n,r);return i<0?void 0:n[i][1]}return Iw=e,Iw}var jw,GT;function CB(){if(GT)return jw;GT=1;var t=L1();function e(r){return t(this.__data__,r)>-1}return jw=e,jw}var Fw,VT;function EB(){if(VT)return Fw;VT=1;var t=L1();function e(r,n){var i=this.__data__,a=t(i,r);return a<0?(++this.size,i.push([r,n])):i[a][1]=n,this}return Fw=e,Fw}var Bw,HT;function TB(){if(HT)return Bw;HT=1;var t=SB(),e=kB(),r=_B(),n=CB(),i=EB();function a(s){var o=-1,l=s==null?0:s.length;for(this.clear();++o<l;){var u=s[o];this.set(u[0],u[1])}}return a.prototype.clear=t,a.prototype.delete=e,a.prototype.get=r,a.prototype.has=n,a.prototype.set=i,Bw=a,Bw}var zw,WT;function NB(){if(WT)return zw;WT=1;var t=p_(),e=E1(),r=t(e,"Map");return zw=r,zw}var Uw,qT;function PB(){if(qT)return Uw;qT=1;var t=wB(),e=TB(),r=NB();function n(){this.size=0,this.__data__={hash:new t,map:new(r||e),string:new t}}return Uw=n,Uw}var Gw,$T;function MB(){if($T)return Gw;$T=1;function t(e){var r=typeof e;return r=="string"||r=="number"||r=="symbol"||r=="boolean"?e!=="__proto__":e===null}return Gw=t,Gw}var Vw,KT;function R1(){if(KT)return Vw;KT=1;var t=MB();function e(r,n){var i=r.__data__;return t(n)?i[typeof n=="string"?"string":"hash"]:i.map}return Vw=e,Vw}var Hw,ZT;function AB(){if(ZT)return Hw;ZT=1;var t=R1();function e(r){var n=t(this,r).delete(r);return this.size-=n?1:0,n}return Hw=e,Hw}var Ww,YT;function LB(){if(YT)return Ww;YT=1;var t=R1();function e(r){return t(this,r).get(r)}return Ww=e,Ww}var qw,XT;function RB(){if(XT)return qw;XT=1;var t=R1();function e(r){return t(this,r).has(r)}return qw=e,qw}var $w,QT;function OB(){if(QT)return $w;QT=1;var t=R1();function e(r,n){var i=t(this,r),a=i.size;return i.set(r,n),this.size+=i.size==a?0:1,this}return $w=e,$w}var Kw,JT;function DB(){if(JT)return Kw;JT=1;var t=PB(),e=AB(),r=LB(),n=RB(),i=OB();function a(s){var o=-1,l=s==null?0:s.length;for(this.clear();++o<l;){var u=s[o];this.set(u[0],u[1])}}return a.prototype.clear=t,a.prototype.delete=e,a.prototype.get=r,a.prototype.has=n,a.prototype.set=i,Kw=a,Kw}var Zw,eN;function IB(){if(eN)return Zw;eN=1;var t=DB(),e="Expected a function";function r(n,i){if(typeof n!="function"||i!=null&&typeof i!="function")throw new TypeError(e);var a=function(){var s=arguments,o=i?i.apply(this,s):s[0],l=a.cache;if(l.has(o))return l.get(o);var u=n.apply(this,s);return a.cache=l.set(o,u)||l,u};return a.cache=new(r.Cache||t),a}return r.Cache=t,Zw=r,Zw}var Yw,tN;function jB(){if(tN)return Yw;tN=1;var t=IB(),e=500;function r(n){var i=t(n,function(s){return a.size===e&&a.clear(),s}),a=i.cache;return i}return Yw=r,Yw}var Xw,rN;function yA(){if(rN)return Xw;rN=1;var t=jB(),e=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,r=/\\(\\)?/g,n=t(function(i){var a=[];return i.charCodeAt(0)===46&&a.push(""),i.replace(e,function(s,o,l,u){a.push(l?u.replace(r,"$1"):o||s)}),a});return Xw=n,Xw}var Qw,nN;function xA(){if(nN)return Qw;nN=1;function t(e,r){for(var n=-1,i=e==null?0:e.length,a=Array(i);++n<i;)a[n]=r(e[n],n,e);return a}return Qw=t,Qw}var Jw,iN;function FB(){if(iN)return Jw;iN=1;var t=a_(),e=xA(),r=M1(),n=e0(),i=t?t.prototype:void 0,a=i?i.toString:void 0;function s(o){if(typeof o=="string")return o;if(r(o))return e(o,s)+"";if(n(o))return a?a.call(o):"";var l=o+"";return l=="0"&&1/o==-1/0?"-0":l}return Jw=s,Jw}var e2,aN;function bA(){if(aN)return e2;aN=1;var t=FB();function e(r){return r==null?"":t(r)}return e2=e,e2}var t2,sN;function wA(){if(sN)return t2;sN=1;var t=M1(),e=uB(),r=yA(),n=bA();function i(a,s){return t(a)?a:e(a,s)?[a]:r(n(a))}return t2=i,t2}var r2,oN;function m_(){if(oN)return r2;oN=1;var t=e0();function e(r){if(typeof r=="string"||t(r))return r;var n=r+"";return n=="0"&&1/r==-1/0?"-0":n}return r2=e,r2}var n2,lN;function BB(){if(lN)return n2;lN=1;var t=wA(),e=m_();function r(n,i){i=t(i,n);for(var a=0,s=i.length;n!=null&&a<s;)n=n[e(i[a++])];return a&&a==s?n:void 0}return n2=r,n2}var i2,uN;function zB(){if(uN)return i2;uN=1;var t=BB();function e(r,n,i){var a=r==null?void 0:t(r,n);return a===void 0?i:a}return i2=e,i2}var UB=zB(),GB=Qv(UB),a2,cN;function VB(){if(cN)return a2;cN=1;var t=p_(),e=(function(){try{var r=t(Object,"defineProperty");return r({},"",{}),r}catch{}})();return a2=e,a2}var s2,dN;function HB(){if(dN)return s2;dN=1;var t=VB();function e(r,n,i){n=="__proto__"&&t?t(r,n,{configurable:!0,enumerable:!0,value:i,writable:!0}):r[n]=i}return s2=e,s2}var o2,fN;function WB(){if(fN)return o2;fN=1;var t=HB(),e=vA(),r=Object.prototype,n=r.hasOwnProperty;function i(a,s,o){var l=a[s];(!(n.call(a,s)&&e(l,o))||o===void 0&&!(s in a))&&t(a,s,o)}return o2=i,o2}var l2,hN;function qB(){if(hN)return l2;hN=1;var t=9007199254740991,e=/^(?:0|[1-9]\d*)$/;function r(n,i){var a=typeof n;return i=i??t,!!i&&(a=="number"||a!="symbol"&&e.test(n))&&n>-1&&n%1==0&&n<i}return l2=r,l2}var u2,pN;function $B(){if(pN)return u2;pN=1;var t=WB(),e=wA(),r=qB(),n=Jv(),i=m_();function a(s,o,l,u){if(!n(s))return s;o=e(o,s);for(var c=-1,f=o.length,p=f-1,g=s;g!=null&&++c<f;){var y=i(o[c]),S=l;if(y==="__proto__"||y==="constructor"||y==="prototype")return s;if(c!=p){var w=g[y];S=u?u(w,y,g):void 0,S===void 0&&(S=n(w)?w:r(o[c+1])?[]:{})}t(g,y,S),g=g[y]}return s}return u2=a,u2}var c2,mN;function KB(){if(mN)return c2;mN=1;var t=$B();function e(r,n,i){return r==null?r:t(r,n,i)}return c2=e,c2}var ZB=KB(),YB=Qv(ZB),d2,gN;function XB(){if(gN)return d2;gN=1;function t(e,r){var n=-1,i=e.length;for(r||(r=Array(i));++n<i;)r[n]=e[n];return r}return d2=t,d2}var f2,vN;function QB(){if(vN)return f2;vN=1;var t=xA(),e=XB(),r=M1(),n=e0(),i=yA(),a=m_(),s=bA();function o(l){return r(l)?t(l,a):n(l)?[l]:e(i(s(l)))}return f2=o,f2}var JB=QB(),e7=Qv(JB),t7={data:function(e){var r={field:"data",bindingEvent:"data",allowBinding:!1,allowSetting:!1,allowGetting:!1,settingEvent:"data",settingTriggersEvent:!1,triggerFnName:"trigger",immutableKeys:{},updateStyle:!1,beforeGet:function(i){},beforeSet:function(i,a){},onSet:function(i){},canSet:function(i){return!0}};return e=sr({},r,e),function(i,a){var s=e,o=this,l=o.length!==void 0,u=l?o:[o],c=l?o[0]:o;if(Yt(i)){var f=i.indexOf(".")!==-1,p=f&&e7(i);if(s.allowGetting&&a===void 0){var g;return c&&(s.beforeGet(c),p&&c._private[s.field][i]===void 0?g=GB(c._private[s.field],p):g=c._private[s.field][i]),g}else if(s.allowSetting&&a!==void 0){var y=!s.immutableKeys[i];if(y){var S=IM({},i,a);s.beforeSet(o,S);for(var w=0,C=u.length;w<C;w++){var _=u[w];s.canSet(_)&&(p&&c._private[s.field][i]===void 0?YB(_._private[s.field],p,a):_._private[s.field][i]=a)}s.updateStyle&&o.updateStyle(),s.onSet(o),s.settingTriggersEvent&&o[s.triggerFnName](s.settingEvent)}}}else if(s.allowSetting&&Wr(i)){var T=i,N,R,D=Object.keys(T);s.beforeSet(o,T);for(var j=0;j<D.length;j++){N=D[j],R=T[N];var O=!s.immutableKeys[N];if(O)for(var F=0;F<u.length;F++){var z=u[F];s.canSet(z)&&(z._private[s.field][N]=R)}}s.updateStyle&&o.updateStyle(),s.onSet(o),s.settingTriggersEvent&&o[s.triggerFnName](s.settingEvent)}else if(s.allowBinding&&ri(i)){var G=i;o.on(s.bindingEvent,G)}else if(s.allowGetting&&i===void 0){var Z;return c&&(s.beforeGet(c),Z=c._private[s.field]),Z}return o}},removeData:function(e){var r={field:"data",event:"data",triggerFnName:"trigger",triggerEvent:!1,immutableKeys:{}};return e=sr({},r,e),function(i){var a=e,s=this,o=s.length!==void 0,l=o?s:[s];if(Yt(i)){for(var u=i.split(/\s+/),c=u.length,f=0;f<c;f++){var p=u[f];if(!Kd(p)){var g=!a.immutableKeys[p];if(g)for(var y=0,S=l.length;y<S;y++)l[y]._private[a.field][p]=void 0}}a.triggerEvent&&s[a.triggerFnName](a.event)}else if(i===void 0){for(var w=0,C=l.length;w<C;w++)for(var _=l[w]._private[a.field],T=Object.keys(_),N=0;N<T.length;N++){var R=T[N],D=!a.immutableKeys[R];D&&(_[R]=void 0)}a.triggerEvent&&s[a.triggerFnName](a.event)}return s}}},r7={eventAliasesOn:function(e){var r=e;r.addListener=r.listen=r.bind=r.on,r.unlisten=r.unbind=r.off=r.removeListener,r.trigger=r.emit,r.pon=r.promiseOn=function(n,i){var a=this,s=Array.prototype.slice.call(arguments,0);return new um(function(o,l){var u=function(g){a.off.apply(a,f),o(g)},c=s.concat([u]),f=c.concat([]);a.on.apply(a,c)})}}},nn={};[lB,t7,r7].forEach(function(t){sr(nn,t)});var n7={animate:nn.animate(),animation:nn.animation(),animated:nn.animated(),clearQueue:nn.clearQueue(),delay:nn.delay(),delayAnimation:nn.delayAnimation(),stop:nn.stop()},Uy={classes:function(e){var r=this;if(e===void 0){var n=[];return r[0]._private.classes.forEach(function(y){return n.push(y)}),n}else Sn(e)||(e=(e||"").match(/\S+/g)||[]);for(var i=[],a=new lm(e),s=0;s<r.length;s++){for(var o=r[s],l=o._private,u=l.classes,c=!1,f=0;f<e.length;f++){var p=e[f],g=u.has(p);if(!g){c=!0;break}}c||(c=u.size!==e.length),c&&(l.classes=a,i.push(o))}return i.length>0&&this.spawn(i).updateStyle().emit("class"),r},addClass:function(e){return this.toggleClass(e,!0)},hasClass:function(e){var r=this[0];return r!=null&&r._private.classes.has(e)},toggleClass:function(e,r){Sn(e)||(e=e.match(/\S+/g)||[]);for(var n=this,i=r===void 0,a=[],s=0,o=n.length;s<o;s++)for(var l=n[s],u=l._private.classes,c=!1,f=0;f<e.length;f++){var p=e[f],g=u.has(p),y=!1;r||i&&!g?(u.add(p),y=!0):(!r||i&&g)&&(u.delete(p),y=!0),!c&&y&&(a.push(l),c=!0)}return a.length>0&&this.spawn(a).updateStyle().emit("class"),n},removeClass:function(e){return this.toggleClass(e,!1)},flashClass:function(e,r){var n=this;if(r==null)r=250;else if(r===0)return n;return n.addClass(e),setTimeout(function(){n.removeClass(e)},r),n}};Uy.className=Uy.classNames=Uy.classes;var Hr={metaChar:"[\\!\\\"\\#\\$\\%\\&\\'\\(\\)\\*\\+\\,\\.\\/\\:\\;\\<\\=\\>\\?\\@\\[\\]\\^\\`\\{\\|\\}\\~]",comparatorOp:"=|\\!=|>|>=|<|<=|\\$=|\\^=|\\*=",boolOp:"\\?|\\!|\\^",string:`"(?:\\\\"|[^"])*"|'(?:\\\\'|[^'])*'`,number:Wi,meta:"degree|indegree|outdegree",separator:"\\s*,\\s*",descendant:"\\s+",child:"\\s+>\\s+",subject:"\\$",group:"node|edge|\\*",directedEdge:"\\s+->\\s+",undirectedEdge:"\\s+<->\\s+"};Hr.variable="(?:[\\w-.]|(?:\\\\"+Hr.metaChar+"))+";Hr.className="(?:[\\w-]|(?:\\\\"+Hr.metaChar+"))+";Hr.value=Hr.string+"|"+Hr.number;Hr.id=Hr.variable;(function(){var t,e,r;for(t=Hr.comparatorOp.split("|"),r=0;r<t.length;r++)e=t[r],Hr.comparatorOp+="|@"+e;for(t=Hr.comparatorOp.split("|"),r=0;r<t.length;r++)e=t[r],!(e.indexOf("!")>=0)&&e!=="="&&(Hr.comparatorOp+="|\\!"+e)})();var vn=function(){return{checks:[]}},Ft={GROUP:0,COLLECTION:1,FILTER:2,DATA_COMPARE:3,DATA_EXIST:4,DATA_BOOL:5,META_COMPARE:6,STATE:7,ID:8,CLASS:9,UNDIRECTED_EDGE:10,DIRECTED_EDGE:11,NODE_SOURCE:12,NODE_TARGET:13,NODE_NEIGHBOR:14,CHILD:15,DESCENDANT:16,PARENT:17,ANCESTOR:18,COMPOUND_SPLIT:19,TRUE:20},$S=[{selector:":selected",matches:function(e){return e.selected()}},{selector:":unselected",matches:function(e){return!e.selected()}},{selector:":selectable",matches:function(e){return e.selectable()}},{selector:":unselectable",matches:function(e){return!e.selectable()}},{selector:":locked",matches:function(e){return e.locked()}},{selector:":unlocked",matches:function(e){return!e.locked()}},{selector:":visible",matches:function(e){return e.visible()}},{selector:":hidden",matches:function(e){return!e.visible()}},{selector:":transparent",matches:function(e){return e.transparent()}},{selector:":grabbed",matches:function(e){return e.grabbed()}},{selector:":free",matches:function(e){return!e.grabbed()}},{selector:":removed",matches:function(e){return e.removed()}},{selector:":inside",matches:function(e){return!e.removed()}},{selector:":grabbable",matches:function(e){return e.grabbable()}},{selector:":ungrabbable",matches:function(e){return!e.grabbable()}},{selector:":animated",matches:function(e){return e.animated()}},{selector:":unanimated",matches:function(e){return!e.animated()}},{selector:":parent",matches:function(e){return e.isParent()}},{selector:":childless",matches:function(e){return e.isChildless()}},{selector:":child",matches:function(e){return e.isChild()}},{selector:":orphan",matches:function(e){return e.isOrphan()}},{selector:":nonorphan",matches:function(e){return e.isChild()}},{selector:":compound",matches:function(e){return e.isNode()?e.isParent():e.source().isParent()||e.target().isParent()}},{selector:":loop",matches:function(e){return e.isLoop()}},{selector:":simple",matches:function(e){return e.isSimple()}},{selector:":active",matches:function(e){return e.active()}},{selector:":inactive",matches:function(e){return!e.active()}},{selector:":backgrounding",matches:function(e){return e.backgrounding()}},{selector:":nonbackgrounding",matches:function(e){return!e.backgrounding()}}].sort(function(t,e){return t9(t.selector,e.selector)}),i7=(function(){for(var t={},e,r=0;r<$S.length;r++)e=$S[r],t[e.selector]=e.matches;return t})(),a7=function(e,r){return i7[e](r)},s7="("+$S.map(function(t){return t.selector}).join("|")+")",dp=function(e){return e.replace(new RegExp("\\\\("+Hr.metaChar+")","g"),function(r,n){return n})},yd=function(e,r,n){e[e.length-1]=n},KS=[{name:"group",query:!0,regex:"("+Hr.group+")",populate:function(e,r,n){var i=Di(n,1),a=i[0];r.checks.push({type:Ft.GROUP,value:a==="*"?a:a+"s"})}},{name:"state",query:!0,regex:s7,populate:function(e,r,n){var i=Di(n,1),a=i[0];r.checks.push({type:Ft.STATE,value:a})}},{name:"id",query:!0,regex:"\\#("+Hr.id+")",populate:function(e,r,n){var i=Di(n,1),a=i[0];r.checks.push({type:Ft.ID,value:dp(a)})}},{name:"className",query:!0,regex:"\\.("+Hr.className+")",populate:function(e,r,n){var i=Di(n,1),a=i[0];r.checks.push({type:Ft.CLASS,value:dp(a)})}},{name:"dataExists",query:!0,regex:"\\[\\s*("+Hr.variable+")\\s*\\]",populate:function(e,r,n){var i=Di(n,1),a=i[0];r.checks.push({type:Ft.DATA_EXIST,field:dp(a)})}},{name:"dataCompare",query:!0,regex:"\\[\\s*("+Hr.variable+")\\s*("+Hr.comparatorOp+")\\s*("+Hr.value+")\\s*\\]",populate:function(e,r,n){var i=Di(n,3),a=i[0],s=i[1],o=i[2],l=new RegExp("^"+Hr.string+"$").exec(o)!=null;l?o=o.substring(1,o.length-1):o=parseFloat(o),r.checks.push({type:Ft.DATA_COMPARE,field:dp(a),operator:s,value:o})}},{name:"dataBool",query:!0,regex:"\\[\\s*("+Hr.boolOp+")\\s*("+Hr.variable+")\\s*\\]",populate:function(e,r,n){var i=Di(n,2),a=i[0],s=i[1];r.checks.push({type:Ft.DATA_BOOL,field:dp(s),operator:a})}},{name:"metaCompare",query:!0,regex:"\\[\\[\\s*("+Hr.meta+")\\s*("+Hr.comparatorOp+")\\s*("+Hr.number+")\\s*\\]\\]",populate:function(e,r,n){var i=Di(n,3),a=i[0],s=i[1],o=i[2];r.checks.push({type:Ft.META_COMPARE,field:dp(a),operator:s,value:parseFloat(o)})}},{name:"nextQuery",separator:!0,regex:Hr.separator,populate:function(e,r){var n=e.currentSubject,i=e.edgeCount,a=e.compoundCount,s=e[e.length-1];n!=null&&(s.subject=n,e.currentSubject=null),s.edgeCount=i,s.compoundCount=a,e.edgeCount=0,e.compoundCount=0;var o=e[e.length++]=vn();return o}},{name:"directedEdge",separator:!0,regex:Hr.directedEdge,populate:function(e,r){if(e.currentSubject==null){var n=vn(),i=r,a=vn();return n.checks.push({type:Ft.DIRECTED_EDGE,source:i,target:a}),yd(e,r,n),e.edgeCount++,a}else{var s=vn(),o=r,l=vn();return s.checks.push({type:Ft.NODE_SOURCE,source:o,target:l}),yd(e,r,s),e.edgeCount++,l}}},{name:"undirectedEdge",separator:!0,regex:Hr.undirectedEdge,populate:function(e,r){if(e.currentSubject==null){var n=vn(),i=r,a=vn();return n.checks.push({type:Ft.UNDIRECTED_EDGE,nodes:[i,a]}),yd(e,r,n),e.edgeCount++,a}else{var s=vn(),o=r,l=vn();return s.checks.push({type:Ft.NODE_NEIGHBOR,node:o,neighbor:l}),yd(e,r,s),l}}},{name:"child",separator:!0,regex:Hr.child,populate:function(e,r){if(e.currentSubject==null){var n=vn(),i=vn(),a=e[e.length-1];return n.checks.push({type:Ft.CHILD,parent:a,child:i}),yd(e,r,n),e.compoundCount++,i}else if(e.currentSubject===r){var s=vn(),o=e[e.length-1],l=vn(),u=vn(),c=vn(),f=vn();return s.checks.push({type:Ft.COMPOUND_SPLIT,left:o,right:l,subject:u}),u.checks=r.checks,r.checks=[{type:Ft.TRUE}],f.checks.push({type:Ft.TRUE}),l.checks.push({type:Ft.PARENT,parent:f,child:c}),yd(e,o,s),e.currentSubject=u,e.compoundCount++,c}else{var p=vn(),g=vn(),y=[{type:Ft.PARENT,parent:p,child:g}];return p.checks=r.checks,r.checks=y,e.compoundCount++,g}}},{name:"descendant",separator:!0,regex:Hr.descendant,populate:function(e,r){if(e.currentSubject==null){var n=vn(),i=vn(),a=e[e.length-1];return n.checks.push({type:Ft.DESCENDANT,ancestor:a,descendant:i}),yd(e,r,n),e.compoundCount++,i}else if(e.currentSubject===r){var s=vn(),o=e[e.length-1],l=vn(),u=vn(),c=vn(),f=vn();return s.checks.push({type:Ft.COMPOUND_SPLIT,left:o,right:l,subject:u}),u.checks=r.checks,r.checks=[{type:Ft.TRUE}],f.checks.push({type:Ft.TRUE}),l.checks.push({type:Ft.ANCESTOR,ancestor:f,descendant:c}),yd(e,o,s),e.currentSubject=u,e.compoundCount++,c}else{var p=vn(),g=vn(),y=[{type:Ft.ANCESTOR,ancestor:p,descendant:g}];return p.checks=r.checks,r.checks=y,e.compoundCount++,g}}},{name:"subject",modifier:!0,regex:Hr.subject,populate:function(e,r){if(e.currentSubject!=null&&e.currentSubject!==r)return an("Redefinition of subject in selector `"+e.toString()+"`"),!1;e.currentSubject=r;var n=e[e.length-1],i=n.checks[0],a=i==null?null:i.type;a===Ft.DIRECTED_EDGE?i.type=Ft.NODE_TARGET:a===Ft.UNDIRECTED_EDGE&&(i.type=Ft.NODE_NEIGHBOR,i.node=i.nodes[1],i.neighbor=i.nodes[0],i.nodes=null)}}];KS.forEach(function(t){return t.regexObj=new RegExp("^"+t.regex)});var o7=function(e){for(var r,n,i,a=0;a<KS.length;a++){var s=KS[a],o=s.name,l=e.match(s.regexObj);if(l!=null){n=l,r=s,i=o;var u=l[0];e=e.substring(u.length);break}}return{expr:r,match:n,name:i,remaining:e}},l7=function(e){var r=e.match(/^\s+/);if(r){var n=r[0];e=e.substring(n.length)}return e},u7=function(e){var r=this,n=r.inputText=e,i=r[0]=vn();for(r.length=1,n=l7(n);;){var a=o7(n);if(a.expr==null)return an("The selector `"+e+"`is invalid"),!1;var s=a.match.slice(1),o=a.expr.populate(r,i,s);if(o===!1)return!1;if(o!=null&&(i=o),n=a.remaining,n.match(/^\s*$/))break}var l=r[r.length-1];r.currentSubject!=null&&(l.subject=r.currentSubject),l.edgeCount=r.edgeCount,l.compoundCount=r.compoundCount;for(var u=0;u<r.length;u++){var c=r[u];if(c.compoundCount>0&&c.edgeCount>0)return an("The selector `"+e+"` is invalid because it uses both a compound selector and an edge selector"),!1;if(c.edgeCount>1)return an("The selector `"+e+"` is invalid because it uses multiple edge selectors"),!1;c.edgeCount===1&&an("The selector `"+e+"` is deprecated.  Edge selectors do not take effect on changes to source and target nodes after an edge is added, for performance reasons.  Use a class or data selector on edges instead, updating the class or data of an edge when your app detects a change in source or target nodes.")}return!0},c7=function(){if(this.toStringCache!=null)return this.toStringCache;for(var e=function(c){return c??""},r=function(c){return Yt(c)?'"'+c+'"':e(c)},n=function(c){return" "+c+" "},i=function(c,f){var p=c.type,g=c.value;switch(p){case Ft.GROUP:{var y=e(g);return y.substring(0,y.length-1)}case Ft.DATA_COMPARE:{var S=c.field,w=c.operator;return"["+S+n(e(w))+r(g)+"]"}case Ft.DATA_BOOL:{var C=c.operator,_=c.field;return"["+e(C)+_+"]"}case Ft.DATA_EXIST:{var T=c.field;return"["+T+"]"}case Ft.META_COMPARE:{var N=c.operator,R=c.field;return"[["+R+n(e(N))+r(g)+"]]"}case Ft.STATE:return g;case Ft.ID:return"#"+g;case Ft.CLASS:return"."+g;case Ft.PARENT:case Ft.CHILD:return a(c.parent,f)+n(">")+a(c.child,f);case Ft.ANCESTOR:case Ft.DESCENDANT:return a(c.ancestor,f)+" "+a(c.descendant,f);case Ft.COMPOUND_SPLIT:{var D=a(c.left,f),j=a(c.subject,f),O=a(c.right,f);return D+(D.length>0?" ":"")+j+O}case Ft.TRUE:return""}},a=function(c,f){return c.checks.reduce(function(p,g,y){return p+(f===c&&y===0?"$":"")+i(g,f)},"")},s="",o=0;o<this.length;o++){var l=this[o];s+=a(l,l.subject),this.length>1&&o<this.length-1&&(s+=", ")}return this.toStringCache=s,s},d7={parse:u7,toString:c7},SA=function(e,r,n){var i,a=Yt(e),s=_t(e),o=Yt(n),l,u,c=!1,f=!1,p=!1;switch(r.indexOf("!")>=0&&(r=r.replace("!",""),f=!0),r.indexOf("@")>=0&&(r=r.replace("@",""),c=!0),(a||o||c)&&(l=!a&&!s?"":""+e,u=""+n),c&&(e=l=l.toLowerCase(),n=u=u.toLowerCase()),r){case"*=":i=l.indexOf(u)>=0;break;case"$=":i=l.indexOf(u,l.length-u.length)>=0;break;case"^=":i=l.indexOf(u)===0;break;case"=":i=e===n;break;case">":p=!0,i=e>n;break;case">=":p=!0,i=e>=n;break;case"<":p=!0,i=e<n;break;case"<=":p=!0,i=e<=n;break;default:i=!1;break}return f&&(e!=null||!p)&&(i=!i),i},f7=function(e,r){switch(r){case"?":return!!e;case"!":return!e;case"^":return e===void 0}},h7=function(e){return e!==void 0},g_=function(e,r){return e.data(r)},p7=function(e,r){return e[r]()},hi=[],Dn=function(e,r){return e.checks.every(function(n){return hi[n.type](n,r)})};hi[Ft.GROUP]=function(t,e){var r=t.value;return r==="*"||r===e.group()};hi[Ft.STATE]=function(t,e){var r=t.value;return a7(r,e)};hi[Ft.ID]=function(t,e){var r=t.value;return e.id()===r};hi[Ft.CLASS]=function(t,e){var r=t.value;return e.hasClass(r)};hi[Ft.META_COMPARE]=function(t,e){var r=t.field,n=t.operator,i=t.value;return SA(p7(e,r),n,i)};hi[Ft.DATA_COMPARE]=function(t,e){var r=t.field,n=t.operator,i=t.value;return SA(g_(e,r),n,i)};hi[Ft.DATA_BOOL]=function(t,e){var r=t.field,n=t.operator;return f7(g_(e,r),n)};hi[Ft.DATA_EXIST]=function(t,e){var r=t.field;return t.operator,h7(g_(e,r))};hi[Ft.UNDIRECTED_EDGE]=function(t,e){var r=t.nodes[0],n=t.nodes[1],i=e.source(),a=e.target();return Dn(r,i)&&Dn(n,a)||Dn(n,i)&&Dn(r,a)};hi[Ft.NODE_NEIGHBOR]=function(t,e){return Dn(t.node,e)&&e.neighborhood().some(function(r){return r.isNode()&&Dn(t.neighbor,r)})};hi[Ft.DIRECTED_EDGE]=function(t,e){return Dn(t.source,e.source())&&Dn(t.target,e.target())};hi[Ft.NODE_SOURCE]=function(t,e){return Dn(t.source,e)&&e.outgoers().some(function(r){return r.isNode()&&Dn(t.target,r)})};hi[Ft.NODE_TARGET]=function(t,e){return Dn(t.target,e)&&e.incomers().some(function(r){return r.isNode()&&Dn(t.source,r)})};hi[Ft.CHILD]=function(t,e){return Dn(t.child,e)&&Dn(t.parent,e.parent())};hi[Ft.PARENT]=function(t,e){return Dn(t.parent,e)&&e.children().some(function(r){return Dn(t.child,r)})};hi[Ft.DESCENDANT]=function(t,e){return Dn(t.descendant,e)&&e.ancestors().some(function(r){return Dn(t.ancestor,r)})};hi[Ft.ANCESTOR]=function(t,e){return Dn(t.ancestor,e)&&e.descendants().some(function(r){return Dn(t.descendant,r)})};hi[Ft.COMPOUND_SPLIT]=function(t,e){return Dn(t.subject,e)&&Dn(t.left,e)&&Dn(t.right,e)};hi[Ft.TRUE]=function(){return!0};hi[Ft.COLLECTION]=function(t,e){var r=t.value;return r.has(e)};hi[Ft.FILTER]=function(t,e){var r=t.value;return r(e)};var m7=function(e){var r=this;if(r.length===1&&r[0].checks.length===1&&r[0].checks[0].type===Ft.ID)return e.getElementById(r[0].checks[0].value).collection();var n=function(a){for(var s=0;s<r.length;s++){var o=r[s];if(Dn(o,a))return!0}return!1};return r.text()==null&&(n=function(){return!0}),e.filter(n)},g7=function(e){for(var r=this,n=0;n<r.length;n++){var i=r[n];if(Dn(i,e))return!0}return!1},v7={matches:g7,filter:m7},Xd=function(e){this.inputText=e,this.currentSubject=null,this.compoundCount=0,this.edgeCount=0,this.length=0,e==null||Yt(e)&&e.match(/^\s*$/)||(vo(e)?this.addQuery({checks:[{type:Ft.COLLECTION,value:e.collection()}]}):ri(e)?this.addQuery({checks:[{type:Ft.FILTER,value:e}]}):Yt(e)?this.parse(e)||(this.invalid=!0):Zn("A selector must be created from a string; found "))},Qd=Xd.prototype;[d7,v7].forEach(function(t){return sr(Qd,t)});Qd.text=function(){return this.inputText};Qd.size=function(){return this.length};Qd.eq=function(t){return this[t]};Qd.sameText=function(t){return!this.invalid&&!t.invalid&&this.text()===t.text()};Qd.addQuery=function(t){this[this.length++]=t};Qd.selector=Qd.toString;var Ud={allAre:function(e){var r=new Xd(e);return this.every(function(n){return r.matches(n)})},is:function(e){var r=new Xd(e);return this.some(function(n){return r.matches(n)})},some:function(e,r){for(var n=0;n<this.length;n++){var i=r?e.apply(r,[this[n],n,this]):e(this[n],n,this);if(i)return!0}return!1},every:function(e,r){for(var n=0;n<this.length;n++){var i=r?e.apply(r,[this[n],n,this]):e(this[n],n,this);if(!i)return!1}return!0},same:function(e){if(this===e)return!0;e=this.cy().collection(e);var r=this.length,n=e.length;return r!==n?!1:r===1?this[0]===e[0]:this.every(function(i){return e.hasElementWithId(i.id())})},anySame:function(e){return e=this.cy().collection(e),this.some(function(r){return e.hasElementWithId(r.id())})},allAreNeighbors:function(e){e=this.cy().collection(e);var r=this.neighborhood();return e.every(function(n){return r.hasElementWithId(n.id())})},contains:function(e){e=this.cy().collection(e);var r=this;return e.every(function(n){return r.hasElementWithId(n.id())})}};Ud.allAreNeighbours=Ud.allAreNeighbors;Ud.has=Ud.contains;Ud.equal=Ud.equals=Ud.same;var Xo=function(e,r){return function(i,a,s,o){var l=i,u=this,c;if(l==null?c="":vo(l)&&l.length===1&&(c=l.id()),u.length===1&&c){var f=u[0]._private,p=f.traversalCache=f.traversalCache||{},g=p[r]=p[r]||[],y=ph(c),S=g[y];return S||(g[y]=e.call(u,i,a,s,o))}else return e.call(u,i,a,s,o)}},qp={parent:function(e){var r=[];if(this.length===1){var n=this[0]._private.parent;if(n)return n}for(var i=0;i<this.length;i++){var a=this[i],s=a._private.parent;s&&r.push(s)}return this.spawn(r,!0).filter(e)},parents:function(e){for(var r=[],n=this.parent();n.nonempty();){for(var i=0;i<n.length;i++){var a=n[i];r.push(a)}n=n.parent()}return this.spawn(r,!0).filter(e)},commonAncestors:function(e){for(var r,n=0;n<this.length;n++){var i=this[n],a=i.parents();r=r||a,r=r.intersect(a)}return r.filter(e)},orphans:function(e){return this.stdFilter(function(r){return r.isOrphan()}).filter(e)},nonorphans:function(e){return this.stdFilter(function(r){return r.isChild()}).filter(e)},children:Xo(function(t){for(var e=[],r=0;r<this.length;r++)for(var n=this[r],i=n._private.children,a=0;a<i.length;a++)e.push(i[a]);return this.spawn(e,!0).filter(t)},"children"),siblings:function(e){return this.parent().children().not(this).filter(e)},isParent:function(){var e=this[0];if(e)return e.isNode()&&e._private.children.length!==0},isChildless:function(){var e=this[0];if(e)return e.isNode()&&e._private.children.length===0},isChild:function(){var e=this[0];if(e)return e.isNode()&&e._private.parent!=null},isOrphan:function(){var e=this[0];if(e)return e.isNode()&&e._private.parent==null},descendants:function(e){var r=[];function n(i){for(var a=0;a<i.length;a++){var s=i[a];r.push(s),s.children().nonempty()&&n(s.children())}}return n(this.children()),this.spawn(r,!0).filter(e)}};function v_(t,e,r,n){for(var i=[],a=new lm,s=t.cy(),o=s.hasCompoundNodes(),l=0;l<t.length;l++){var u=t[l];r?i.push(u):o&&n(i,a,u)}for(;i.length>0;){var c=i.shift();e(c),a.add(c.id()),o&&n(i,a,c)}return t}function kA(t,e,r){if(r.isParent())for(var n=r._private.children,i=0;i<n.length;i++){var a=n[i];e.has(a.id())||t.push(a)}}qp.forEachDown=function(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return v_(this,t,e,kA)};function _A(t,e,r){if(r.isChild()){var n=r._private.parent;e.has(n.id())||t.push(n)}}qp.forEachUp=function(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return v_(this,t,e,_A)};function y7(t,e,r){_A(t,e,r),kA(t,e,r)}qp.forEachUpAndDown=function(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return v_(this,t,e,y7)};qp.ancestors=qp.parents;var Ev,CA;Ev=CA={data:nn.data({field:"data",bindingEvent:"data",allowBinding:!0,allowSetting:!0,settingEvent:"data",settingTriggersEvent:!0,triggerFnName:"trigger",allowGetting:!0,immutableKeys:{id:!0,source:!0,target:!0,parent:!0},updateStyle:!0}),removeData:nn.removeData({field:"data",event:"data",triggerFnName:"trigger",triggerEvent:!0,immutableKeys:{id:!0,source:!0,target:!0,parent:!0},updateStyle:!0}),scratch:nn.data({field:"scratch",bindingEvent:"scratch",allowBinding:!0,allowSetting:!0,settingEvent:"scratch",settingTriggersEvent:!0,triggerFnName:"trigger",allowGetting:!0,updateStyle:!0}),removeScratch:nn.removeData({field:"scratch",event:"scratch",triggerFnName:"trigger",triggerEvent:!0,updateStyle:!0}),rscratch:nn.data({field:"rscratch",allowBinding:!1,allowSetting:!0,settingTriggersEvent:!1,allowGetting:!0}),removeRscratch:nn.removeData({field:"rscratch",triggerEvent:!1}),id:function(){var e=this[0];if(e)return e._private.data.id}};Ev.attr=Ev.data;Ev.removeAttr=Ev.removeData;var x7=CA,O1={};function h2(t){return function(e){var r=this;if(e===void 0&&(e=!0),r.length!==0)if(r.isNode()&&!r.removed()){for(var n=0,i=r[0],a=i._private.edges,s=0;s<a.length;s++){var o=a[s];!e&&o.isLoop()||(n+=t(i,o))}return n}else return}}sr(O1,{degree:h2(function(t,e){return e.source().same(e.target())?2:1}),indegree:h2(function(t,e){return e.target().same(t)?1:0}),outdegree:h2(function(t,e){return e.source().same(t)?1:0})});function fp(t,e){return function(r){for(var n,i=this.nodes(),a=0;a<i.length;a++){var s=i[a],o=s[t](r);o!==void 0&&(n===void 0||e(o,n))&&(n=o)}return n}}sr(O1,{minDegree:fp("degree",function(t,e){return t<e}),maxDegree:fp("degree",function(t,e){return t>e}),minIndegree:fp("indegree",function(t,e){return t<e}),maxIndegree:fp("indegree",function(t,e){return t>e}),minOutdegree:fp("outdegree",function(t,e){return t<e}),maxOutdegree:fp("outdegree",function(t,e){return t>e})});sr(O1,{totalDegree:function(e){for(var r=0,n=this.nodes(),i=0;i<n.length;i++)r+=n[i].degree(e);return r}});var Il,EA,TA=function(e,r,n){for(var i=0;i<e.length;i++){var a=e[i];if(!a.locked()){var s=a._private.position,o={x:r.x!=null?r.x-s.x:0,y:r.y!=null?r.y-s.y:0};a.isParent()&&!(o.x===0&&o.y===0)&&a.children().shift(o,n),a.dirtyBoundingBoxCache()}}},yN={field:"position",bindingEvent:"position",allowBinding:!0,allowSetting:!0,settingEvent:"position",settingTriggersEvent:!0,triggerFnName:"emitAndNotify",allowGetting:!0,validKeys:["x","y"],beforeGet:function(e){e.updateCompoundBounds()},beforeSet:function(e,r){TA(e,r,!1)},onSet:function(e){e.dirtyCompoundBoundsCache()},canSet:function(e){return!e.locked()}};Il=EA={position:nn.data(yN),silentPosition:nn.data(sr({},yN,{allowBinding:!1,allowSetting:!0,settingTriggersEvent:!1,allowGetting:!1,beforeSet:function(e,r){TA(e,r,!0)},onSet:function(e){e.dirtyCompoundBoundsCache()}})),positions:function(e,r){if(Wr(e))r?this.silentPosition(e):this.position(e);else if(ri(e)){var n=e,i=this.cy();i.startBatch();for(var a=0;a<this.length;a++){var s=this[a],o=void 0;(o=n(s,a))&&(r?s.silentPosition(o):s.position(o))}i.endBatch()}return this},silentPositions:function(e){return this.positions(e,!0)},shift:function(e,r,n){var i;if(Wr(e)?(i={x:_t(e.x)?e.x:0,y:_t(e.y)?e.y:0},n=r):Yt(e)&&_t(r)&&(i={x:0,y:0},i[e]=r),i!=null){var a=this.cy();a.startBatch();for(var s=0;s<this.length;s++){var o=this[s];if(!(a.hasCompoundNodes()&&o.isChild()&&o.ancestors().anySame(this))){var l=o.position(),u={x:l.x+i.x,y:l.y+i.y};n?o.silentPosition(u):o.position(u)}}a.endBatch()}return this},silentShift:function(e,r){return Wr(e)?this.shift(e,!0):Yt(e)&&_t(r)&&this.shift(e,r,!0),this},renderedPosition:function(e,r){var n=this[0],i=this.cy(),a=i.zoom(),s=i.pan(),o=Wr(e)?e:void 0,l=o!==void 0||r!==void 0&&Yt(e);if(n&&n.isNode())if(l)for(var u=0;u<this.length;u++){var c=this[u];r!==void 0?c.position(e,(r-s[e])/a):o!==void 0&&c.position(tA(o,a,s))}else{var f=n.position();return o=N1(f,a,s),e===void 0?o:o[e]}else if(!l)return;return this},relativePosition:function(e,r){var n=this[0],i=this.cy(),a=Wr(e)?e:void 0,s=a!==void 0||r!==void 0&&Yt(e),o=i.hasCompoundNodes();if(n&&n.isNode())if(s)for(var l=0;l<this.length;l++){var u=this[l],c=o?u.parent():null,f=c&&c.length>0,p=f;f&&(c=c[0]);var g=p?c.position():{x:0,y:0};r!==void 0?u.position(e,r+g[e]):a!==void 0&&u.position({x:a.x+g.x,y:a.y+g.y})}else{var y=n.position(),S=o?n.parent():null,w=S&&S.length>0,C=w;w&&(S=S[0]);var _=C?S.position():{x:0,y:0};return a={x:y.x-_.x,y:y.y-_.y},e===void 0?a:a[e]}else if(!s)return;return this}};Il.modelPosition=Il.point=Il.position;Il.modelPositions=Il.points=Il.positions;Il.renderedPoint=Il.renderedPosition;Il.relativePoint=Il.relativePosition;var b7=EA,Bp,lf;Bp=lf={};lf.renderedBoundingBox=function(t){var e=this.boundingBox(t),r=this.cy(),n=r.zoom(),i=r.pan(),a=e.x1*n+i.x,s=e.x2*n+i.x,o=e.y1*n+i.y,l=e.y2*n+i.y;return{x1:a,x2:s,y1:o,y2:l,w:s-a,h:l-o}};lf.dirtyCompoundBoundsCache=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,e=this.cy();return!e.styleEnabled()||!e.hasCompoundNodes()?this:(this.forEachUp(function(r){if(r.isParent()){var n=r._private;n.compoundBoundsClean=!1,n.bbCache=null,t||r.emitAndNotify("bounds")}}),this)};lf.updateCompoundBounds=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,e=this.cy();if(!e.styleEnabled()||!e.hasCompoundNodes())return this;if(!t&&e.batching())return this;function r(s){if(!s.isParent())return;var o=s._private,l=s.children(),u=s.pstyle("compound-sizing-wrt-labels").value==="include",c={width:{val:s.pstyle("min-width").pfValue,left:s.pstyle("min-width-bias-left"),right:s.pstyle("min-width-bias-right")},height:{val:s.pstyle("min-height").pfValue,top:s.pstyle("min-height-bias-top"),bottom:s.pstyle("min-height-bias-bottom")}},f=l.boundingBox({includeLabels:u,includeOverlays:!1,useCache:!1}),p=o.position;(f.w===0||f.h===0)&&(f={w:s.pstyle("width").pfValue,h:s.pstyle("height").pfValue},f.x1=p.x-f.w/2,f.x2=p.x+f.w/2,f.y1=p.y-f.h/2,f.y2=p.y+f.h/2);function g(F,z,G){var Z=0,I=0,W=z+G;return F>0&&W>0&&(Z=z/W*F,I=G/W*F),{biasDiff:Z,biasComplementDiff:I}}function y(F,z,G,Z){if(G.units==="%")switch(Z){case"width":return F>0?G.pfValue*F:0;case"height":return z>0?G.pfValue*z:0;case"average":return F>0&&z>0?G.pfValue*(F+z)/2:0;case"min":return F>0&&z>0?F>z?G.pfValue*z:G.pfValue*F:0;case"max":return F>0&&z>0?F>z?G.pfValue*F:G.pfValue*z:0;default:return 0}else return G.units==="px"?G.pfValue:0}var S=c.width.left.value;c.width.left.units==="px"&&c.width.val>0&&(S=S*100/c.width.val);var w=c.width.right.value;c.width.right.units==="px"&&c.width.val>0&&(w=w*100/c.width.val);var C=c.height.top.value;c.height.top.units==="px"&&c.height.val>0&&(C=C*100/c.height.val);var _=c.height.bottom.value;c.height.bottom.units==="px"&&c.height.val>0&&(_=_*100/c.height.val);var T=g(c.width.val-f.w,S,w),N=T.biasDiff,R=T.biasComplementDiff,D=g(c.height.val-f.h,C,_),j=D.biasDiff,O=D.biasComplementDiff;o.autoPadding=y(f.w,f.h,s.pstyle("padding"),s.pstyle("padding-relative-to").value),o.autoWidth=Math.max(f.w,c.width.val),p.x=(-N+f.x1+f.x2+R)/2,o.autoHeight=Math.max(f.h,c.height.val),p.y=(-j+f.y1+f.y2+O)/2}for(var n=0;n<this.length;n++){var i=this[n],a=i._private;(!a.compoundBoundsClean||t)&&(r(i),e.batching()||(a.compoundBoundsClean=!0))}return this};var Zo=function(e){return e===1/0||e===-1/0?0:e},Ll=function(e,r,n,i,a){i-r===0||a-n===0||r==null||n==null||i==null||a==null||(e.x1=r<e.x1?r:e.x1,e.x2=i>e.x2?i:e.x2,e.y1=n<e.y1?n:e.y1,e.y2=a>e.y2?a:e.y2,e.w=e.x2-e.x1,e.h=e.y2-e.y1)},Ed=function(e,r){return r==null?e:Ll(e,r.x1,r.y1,r.x2,r.y2)},Hm=function(e,r,n){return $s(e,r,n)},ay=function(e,r,n){if(!r.cy().headless()){var i=r._private,a=i.rstyle,s=a.arrowWidth/2,o=r.pstyle(n+"-arrow-shape").value,l,u;if(o!=="none"){n==="source"?(l=a.srcX,u=a.srcY):n==="target"?(l=a.tgtX,u=a.tgtY):(l=a.midX,u=a.midY);var c=i.arrowBounds=i.arrowBounds||{},f=c[n]=c[n]||{};f.x1=l-s,f.y1=u-s,f.x2=l+s,f.y2=u+s,f.w=f.x2-f.x1,f.h=f.y2-f.y1,By(f,1),Ll(e,f.x1,f.y1,f.x2,f.y2)}}},p2=function(e,r,n){if(!r.cy().headless()){var i;n?i=n+"-":i="";var a=r._private,s=a.rstyle,o=r.pstyle(i+"label").strValue;if(o){var l=r.pstyle("text-halign"),u=r.pstyle("text-valign"),c=Hm(s,"labelWidth",n),f=Hm(s,"labelHeight",n),p=Hm(s,"labelX",n),g=Hm(s,"labelY",n),y=r.pstyle(i+"text-margin-x").pfValue,S=r.pstyle(i+"text-margin-y").pfValue,w=r.isEdge(),C=r.pstyle(i+"text-rotation"),_=r.pstyle("text-outline-width").pfValue,T=r.pstyle("text-border-width").pfValue,N=T/2,R=r.pstyle("text-background-padding").pfValue,D=2,j=f,O=c,F=O/2,z=j/2,G,Z,I,W;if(w)G=p-F,Z=p+F,I=g-z,W=g+z;else{switch(l.value){case"left":G=p-O,Z=p;break;case"center":G=p-F,Z=p+F;break;case"right":G=p,Z=p+O;break}switch(u.value){case"top":I=g-j,W=g;break;case"center":I=g-z,W=g+z;break;case"bottom":I=g,W=g+j;break}}var U=y-Math.max(_,N)-R-D,K=y+Math.max(_,N)+R+D,$=S-Math.max(_,N)-R-D,Q=S+Math.max(_,N)+R+D;G+=U,Z+=K,I+=$,W+=Q;var ie=n||"main",te=a.labelBounds,X=te[ie]=te[ie]||{};X.x1=G,X.y1=I,X.x2=Z,X.y2=W,X.w=Z-G,X.h=W-I,X.leftPad=U,X.rightPad=K,X.topPad=$,X.botPad=Q;var re=w&&C.strValue==="autorotate",fe=C.pfValue!=null&&C.pfValue!==0;if(re||fe){var oe=re?Hm(a.rstyle,"labelAngle",n):C.pfValue,se=Math.cos(oe),he=Math.sin(oe),ae=(G+Z)/2,pe=(I+W)/2;if(!w){switch(l.value){case"left":ae=Z;break;case"right":ae=G;break}switch(u.value){case"top":pe=W;break;case"bottom":pe=I;break}}var ye=function(rt,dt){return rt=rt-ae,dt=dt-pe,{x:rt*se-dt*he+ae,y:rt*he+dt*se+pe}},ve=ye(G,I),ue=ye(G,W),xe=ye(Z,I),Se=ye(Z,W);G=Math.min(ve.x,ue.x,xe.x,Se.x),Z=Math.max(ve.x,ue.x,xe.x,Se.x),I=Math.min(ve.y,ue.y,xe.y,Se.y),W=Math.max(ve.y,ue.y,xe.y,Se.y)}var Ae=ie+"Rot",Me=te[Ae]=te[Ae]||{};Me.x1=G,Me.y1=I,Me.x2=Z,Me.y2=W,Me.w=Z-G,Me.h=W-I,Ll(e,G,I,Z,W),Ll(a.labelBounds.all,G,I,Z,W)}return e}},xN=function(e,r){if(!r.cy().headless()){var n=r.pstyle("outline-opacity").value,i=r.pstyle("outline-width").value,a=r.pstyle("outline-offset").value,s=i+a;NA(e,r,n,s,"outside",s/2)}},NA=function(e,r,n,i,a,s){if(!(n===0||i<=0||a==="inside")){var o=r.cy(),l=r.pstyle("shape").value,u=o.renderer().nodeShapes[l],c=r.position(),f=c.x,p=c.y,g=r.width(),y=r.height();if(u.hasMiterBounds){a==="center"&&(i/=2);var S=u.miterBounds(f,p,g,y,i);Ed(e,S)}else s!=null&&s>0&&zy(e,[s,s,s,s])}},w7=function(e,r){if(!r.cy().headless()){var n=r.pstyle("border-opacity").value,i=r.pstyle("border-width").pfValue,a=r.pstyle("border-position").value;NA(e,r,n,i,a)}},S7=function(e,r){var n=e._private.cy,i=n.styleEnabled(),a=n.headless(),s=Es(),o=e._private,l=e.isNode(),u=e.isEdge(),c,f,p,g,y,S,w=o.rstyle,C=l&&i?e.pstyle("bounds-expansion").pfValue:[0],_=function(st){return st.pstyle("display").value!=="none"},T=!i||_(e)&&(!u||_(e.source())&&_(e.target()));if(T){var N=0,R=0;i&&r.includeOverlays&&(N=e.pstyle("overlay-opacity").value,N!==0&&(R=e.pstyle("overlay-padding").value));var D=0,j=0;i&&r.includeUnderlays&&(D=e.pstyle("underlay-opacity").value,D!==0&&(j=e.pstyle("underlay-padding").value));var O=Math.max(R,j),F=0,z=0;if(i&&(F=e.pstyle("width").pfValue,z=F/2),l&&r.includeNodes){var G=e.position();y=G.x,S=G.y;var Z=e.outerWidth(),I=Z/2,W=e.outerHeight(),U=W/2;c=y-I,f=y+I,p=S-U,g=S+U,Ll(s,c,p,f,g),i&&xN(s,e),i&&r.includeOutlines&&!a&&xN(s,e),i&&w7(s,e)}else if(u&&r.includeEdges)if(i&&!a){var K=e.pstyle("curve-style").strValue;if(c=Math.min(w.srcX,w.midX,w.tgtX),f=Math.max(w.srcX,w.midX,w.tgtX),p=Math.min(w.srcY,w.midY,w.tgtY),g=Math.max(w.srcY,w.midY,w.tgtY),c-=z,f+=z,p-=z,g+=z,Ll(s,c,p,f,g),K==="haystack"){var $=w.haystackPts;if($&&$.length===2){if(c=$[0].x,p=$[0].y,f=$[1].x,g=$[1].y,c>f){var Q=c;c=f,f=Q}if(p>g){var ie=p;p=g,g=ie}Ll(s,c-z,p-z,f+z,g+z)}}else if(K==="bezier"||K==="unbundled-bezier"||Rd(K,"segments")||Rd(K,"taxi")){var te;switch(K){case"bezier":case"unbundled-bezier":te=w.bezierPts;break;case"segments":case"taxi":case"round-segments":case"round-taxi":te=w.linePts;break}if(te!=null)for(var X=0;X<te.length;X++){var re=te[X];c=re.x-z,f=re.x+z,p=re.y-z,g=re.y+z,Ll(s,c,p,f,g)}}}else{var fe=e.source(),oe=fe.position(),se=e.target(),he=se.position();if(c=oe.x,f=he.x,p=oe.y,g=he.y,c>f){var ae=c;c=f,f=ae}if(p>g){var pe=p;p=g,g=pe}c-=z,f+=z,p-=z,g+=z,Ll(s,c,p,f,g)}if(i&&r.includeEdges&&u&&(ay(s,e,"mid-source"),ay(s,e,"mid-target"),ay(s,e,"source"),ay(s,e,"target")),i){var ye=e.pstyle("ghost").value==="yes";if(ye){var ve=e.pstyle("ghost-offset-x").pfValue,ue=e.pstyle("ghost-offset-y").pfValue;Ll(s,s.x1+ve,s.y1+ue,s.x2+ve,s.y2+ue)}}var xe=o.bodyBounds=o.bodyBounds||{};iT(xe,s),zy(xe,C),By(xe,1),i&&(c=s.x1,f=s.x2,p=s.y1,g=s.y2,Ll(s,c-O,p-O,f+O,g+O));var Se=o.overlayBounds=o.overlayBounds||{};iT(Se,s),zy(Se,C),By(Se,1);var Ae=o.labelBounds=o.labelBounds||{};Ae.all!=null?nF(Ae.all):Ae.all=Es(),i&&r.includeLabels&&(r.includeMainLabels&&p2(s,e,null),u&&(r.includeSourceLabels&&p2(s,e,"source"),r.includeTargetLabels&&p2(s,e,"target")))}return s.x1=Zo(s.x1),s.y1=Zo(s.y1),s.x2=Zo(s.x2),s.y2=Zo(s.y2),s.w=Zo(s.x2-s.x1),s.h=Zo(s.y2-s.y1),s.w>0&&s.h>0&&T&&(zy(s,C),By(s,1)),s},PA=function(e){var r=0,n=function(s){return(s?1:0)<<r++},i=0;return i+=n(e.incudeNodes),i+=n(e.includeEdges),i+=n(e.includeLabels),i+=n(e.includeMainLabels),i+=n(e.includeSourceLabels),i+=n(e.includeTargetLabels),i+=n(e.includeOverlays),i+=n(e.includeOutlines),i},MA=function(e){var r=function(o){return Math.round(o)};if(e.isEdge()){var n=e.source().position(),i=e.target().position();return QE([r(n.x),r(n.y),r(i.x),r(i.y)])}else{var a=e.position();return QE([r(a.x),r(a.y)])}},bN=function(e,r){var n=e._private,i,a=e.isEdge(),s=r==null?wN:PA(r),o=s===wN;if(n.bbCache==null?(i=S7(e,Tv),n.bbCache=i,n.bbCachePosKey=MA(e)):i=n.bbCache,!o){var l=e.isNode();i=Es(),(r.includeNodes&&l||r.includeEdges&&!l)&&(r.includeOverlays?Ed(i,n.overlayBounds):Ed(i,n.bodyBounds)),r.includeLabels&&(r.includeMainLabels&&(!a||r.includeSourceLabels&&r.includeTargetLabels)?Ed(i,n.labelBounds.all):(r.includeMainLabels&&Ed(i,n.labelBounds.mainRot),r.includeSourceLabels&&Ed(i,n.labelBounds.sourceRot),r.includeTargetLabels&&Ed(i,n.labelBounds.targetRot))),i.w=i.x2-i.x1,i.h=i.y2-i.y1}return i},Tv={includeNodes:!0,includeEdges:!0,includeLabels:!0,includeMainLabels:!0,includeSourceLabels:!0,includeTargetLabels:!0,includeOverlays:!0,includeUnderlays:!0,includeOutlines:!0,useCache:!0},wN=PA(Tv),SN=Ha(Tv);lf.boundingBox=function(t){var e,r=t===void 0||t.useCache===void 0||t.useCache===!0,n=Hp(function(c){var f=c._private;return f.bbCache==null||f.styleDirty||f.bbCachePosKey!==MA(c)},function(c){return c.id()});if(r&&this.length===1&&!n(this[0]))t===void 0?t=Tv:t=SN(t),e=bN(this[0],t);else{e=Es(),t=t||Tv;var i=SN(t),a=this,s=a.cy(),o=s.styleEnabled();this.edges().forEach(n),this.nodes().forEach(n),o&&this.recalculateRenderedStyle(r),this.updateCompoundBounds(!r);for(var l=0;l<a.length;l++){var u=a[l];n(u)&&u.dirtyBoundingBoxCache(),Ed(e,bN(u,i))}}return e.x1=Zo(e.x1),e.y1=Zo(e.y1),e.x2=Zo(e.x2),e.y2=Zo(e.y2),e.w=Zo(e.x2-e.x1),e.h=Zo(e.y2-e.y1),e};lf.dirtyBoundingBoxCache=function(){for(var t=0;t<this.length;t++){var e=this[t]._private;e.bbCache=null,e.bbCachePosKey=null,e.bodyBounds=null,e.overlayBounds=null,e.labelBounds.all=null,e.labelBounds.source=null,e.labelBounds.target=null,e.labelBounds.main=null,e.labelBounds.sourceRot=null,e.labelBounds.targetRot=null,e.labelBounds.mainRot=null,e.arrowBounds.source=null,e.arrowBounds.target=null,e.arrowBounds["mid-source"]=null,e.arrowBounds["mid-target"]=null}return this.emitAndNotify("bounds"),this};lf.boundingBoxAt=function(t){var e=this.nodes(),r=this.cy(),n=r.hasCompoundNodes(),i=r.collection();if(n&&(i=e.filter(function(u){return u.isParent()}),e=e.not(i)),Wr(t)){var a=t;t=function(){return a}}var s=function(c,f){return c._private.bbAtOldPos=t(c,f)},o=function(c){return c._private.bbAtOldPos};r.startBatch(),e.forEach(s).silentPositions(t),n&&(i.dirtyCompoundBoundsCache(),i.dirtyBoundingBoxCache(),i.updateCompoundBounds(!0));var l=rF(this.boundingBox({useCache:!1}));return e.silentPositions(o),n&&(i.dirtyCompoundBoundsCache(),i.dirtyBoundingBoxCache(),i.updateCompoundBounds(!0)),r.endBatch(),l};Bp.boundingbox=Bp.bb=Bp.boundingBox;Bp.renderedBoundingbox=Bp.renderedBoundingBox;var k7=lf,$g,n0;$g=n0={};var AA=function(e){e.uppercaseName=jE(e.name),e.autoName="auto"+e.uppercaseName,e.labelName="label"+e.uppercaseName,e.outerName="outer"+e.uppercaseName,e.uppercaseOuterName=jE(e.outerName),$g[e.name]=function(){var n=this[0],i=n._private,a=i.cy,s=a._private.styleEnabled;if(n)if(s){if(n.isParent())return n.updateCompoundBounds(),i[e.autoName]||0;var o=n.pstyle(e.name);return o.strValue==="label"?(n.recalculateRenderedStyle(),i.rstyle[e.labelName]||0):o.pfValue}else return 1},$g["outer"+e.uppercaseName]=function(){var n=this[0],i=n._private,a=i.cy,s=a._private.styleEnabled;if(n)if(s){var o=n[e.name](),l=n.pstyle("border-position").value,u;l==="center"?u=n.pstyle("border-width").pfValue:l==="outside"?u=2*n.pstyle("border-width").pfValue:u=0;var c=2*n.padding();return o+u+c}else return 1},$g["rendered"+e.uppercaseName]=function(){var n=this[0];if(n){var i=n[e.name]();return i*this.cy().zoom()}},$g["rendered"+e.uppercaseOuterName]=function(){var n=this[0];if(n){var i=n[e.outerName]();return i*this.cy().zoom()}}};AA({name:"width"});AA({name:"height"});n0.padding=function(){var t=this[0],e=t._private;return t.isParent()?(t.updateCompoundBounds(),e.autoPadding!==void 0?e.autoPadding:t.pstyle("padding").pfValue):t.pstyle("padding").pfValue};n0.paddedHeight=function(){var t=this[0];return t.height()+2*t.padding()};n0.paddedWidth=function(){var t=this[0];return t.width()+2*t.padding()};var _7=n0,C7=function(e,r){if(e.isEdge()&&e.takesUpSpace())return r(e)},E7=function(e,r){if(e.isEdge()&&e.takesUpSpace()){var n=e.cy();return N1(r(e),n.zoom(),n.pan())}},T7=function(e,r){if(e.isEdge()&&e.takesUpSpace()){var n=e.cy(),i=n.pan(),a=n.zoom();return r(e).map(function(s){return N1(s,a,i)})}},N7=function(e){return e.renderer().getControlPoints(e)},P7=function(e){return e.renderer().getSegmentPoints(e)},M7=function(e){return e.renderer().getSourceEndpoint(e)},A7=function(e){return e.renderer().getTargetEndpoint(e)},L7=function(e){return e.renderer().getEdgeMidpoint(e)},kN={controlPoints:{get:N7,mult:!0},segmentPoints:{get:P7,mult:!0},sourceEndpoint:{get:M7},targetEndpoint:{get:A7},midpoint:{get:L7}},R7=function(e){return"rendered"+e[0].toUpperCase()+e.substr(1)},O7=Object.keys(kN).reduce(function(t,e){var r=kN[e],n=R7(e);return t[e]=function(){return C7(this,r.get)},r.mult?t[n]=function(){return T7(this,r.get)}:t[n]=function(){return E7(this,r.get)},t},{}),D7=sr({},b7,k7,_7,O7);var LA=function(e,r){this.recycle(e,r)};function Wm(){return!1}function sy(){return!0}LA.prototype={instanceString:function(){return"event"},recycle:function(e,r){if(this.isImmediatePropagationStopped=this.isPropagationStopped=this.isDefaultPrevented=Wm,e!=null&&e.preventDefault?(this.type=e.type,this.isDefaultPrevented=e.defaultPrevented?sy:Wm):e!=null&&e.type?r=e:this.type=e,r!=null&&(this.originalEvent=r.originalEvent,this.type=r.type!=null?r.type:this.type,this.cy=r.cy,this.target=r.target,this.position=r.position,this.renderedPosition=r.renderedPosition,this.namespace=r.namespace,this.layout=r.layout),this.cy!=null&&this.position!=null&&this.renderedPosition==null){var n=this.position,i=this.cy.zoom(),a=this.cy.pan();this.renderedPosition={x:n.x*i+a.x,y:n.y*i+a.y}}this.timeStamp=e&&e.timeStamp||Date.now()},preventDefault:function(){this.isDefaultPrevented=sy;var e=this.originalEvent;e&&e.preventDefault&&e.preventDefault()},stopPropagation:function(){this.isPropagationStopped=sy;var e=this.originalEvent;e&&e.stopPropagation&&e.stopPropagation()},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=sy,this.stopPropagation()},isDefaultPrevented:Wm,isPropagationStopped:Wm,isImmediatePropagationStopped:Wm};var RA=/^([^.]+)(\.(?:[^.]+))?$/,I7=".*",OA={qualifierCompare:function(e,r){return e===r},eventMatches:function(){return!0},addEventFields:function(){},callbackContext:function(e){return e},beforeEmit:function(){},afterEmit:function(){},bubble:function(){return!1},parent:function(){return null},context:null},_N=Object.keys(OA),j7={};function D1(){for(var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:j7,e=arguments.length>1?arguments[1]:void 0,r=0;r<_N.length;r++){var n=_N[r];this[n]=t[n]||OA[n]}this.context=e||this.context,this.listeners=[],this.emitting=0}var Jd=D1.prototype,DA=function(e,r,n,i,a,s,o){ri(i)&&(a=i,i=null),o&&(s==null?s=o:s=sr({},s,o));for(var l=Sn(n)?n:n.split(/\s+/),u=0;u<l.length;u++){var c=l[u];if(!Kd(c)){var f=c.match(RA);if(f){var p=f[1],g=f[2]?f[2]:null,y=r(e,c,p,g,i,a,s);if(y===!1)break}}}},CN=function(e,r){return e.addEventFields(e.context,r),new LA(r.type,r)},F7=function(e,r,n){if(Hj(n)){r(e,n);return}else if(Wr(n)){r(e,CN(e,n));return}for(var i=Sn(n)?n:n.split(/\s+/),a=0;a<i.length;a++){var s=i[a];if(!Kd(s)){var o=s.match(RA);if(o){var l=o[1],u=o[2]?o[2]:null,c=CN(e,{type:l,namespace:u,target:e.context});r(e,c)}}}};Jd.on=Jd.addListener=function(t,e,r,n,i){return DA(this,function(a,s,o,l,u,c,f){ri(c)&&a.listeners.push({event:s,callback:c,type:o,namespace:l,qualifier:u,conf:f})},t,e,r,n,i),this};Jd.one=function(t,e,r,n){return this.on(t,e,r,n,{one:!0})};Jd.removeListener=Jd.off=function(t,e,r,n){var i=this;this.emitting!==0&&(this.listeners=E9(this.listeners));for(var a=this.listeners,s=function(u){var c=a[u];DA(i,function(f,p,g,y,S,w){if((c.type===g||t==="*")&&(!y&&c.namespace!==".*"||c.namespace===y)&&(!S||f.qualifierCompare(c.qualifier,S))&&(!w||c.callback===w))return a.splice(u,1),!1},t,e,r,n)},o=a.length-1;o>=0;o--)s(o);return this};Jd.removeAllListeners=function(){return this.removeListener("*")};Jd.emit=Jd.trigger=function(t,e,r){var n=this.listeners,i=n.length;return this.emitting++,Sn(e)||(e=[e]),F7(this,function(a,s){r!=null&&(n=[{event:s.event,type:s.type,namespace:s.namespace,callback:r}],i=n.length);for(var o=function(){var c=n[l];if(c.type===s.type&&(!c.namespace||c.namespace===s.namespace||c.namespace===I7)&&a.eventMatches(a.context,c,s)){var f=[s];e!=null&&N9(f,e),a.beforeEmit(a.context,c,s),c.conf&&c.conf.one&&(a.listeners=a.listeners.filter(function(y){return y!==c}));var p=a.callbackContext(a.context,c,s),g=c.callback.apply(p,f);a.afterEmit(a.context,c,s),g===!1&&(s.stopPropagation(),s.preventDefault())}},l=0;l<i;l++)o();a.bubble(a.context)&&!s.isPropagationStopped()&&a.parent(a.context).emit(s,e)},t),this.emitting--,this};var B7={qualifierCompare:function(e,r){return e==null||r==null?e==null&&r==null:e.sameText(r)},eventMatches:function(e,r,n){var i=r.qualifier;return i!=null?e!==n.target&&Xv(n.target)&&i.matches(n.target):!0},addEventFields:function(e,r){r.cy=e.cy(),r.target=e},callbackContext:function(e,r,n){return r.qualifier!=null?n.target:e},beforeEmit:function(e,r){r.conf&&r.conf.once&&r.conf.onceCollection.removeListener(r.event,r.qualifier,r.callback)},bubble:function(){return!0},parent:function(e){return e.isChild()?e.parent():e.cy()}},oy=function(e){return Yt(e)?new Xd(e):e},IA={createEmitter:function(){for(var e=0;e<this.length;e++){var r=this[e],n=r._private;n.emitter||(n.emitter=new D1(B7,r))}return this},emitter:function(){return this._private.emitter},on:function(e,r,n){for(var i=oy(r),a=0;a<this.length;a++){var s=this[a];s.emitter().on(e,i,n)}return this},removeListener:function(e,r,n){for(var i=oy(r),a=0;a<this.length;a++){var s=this[a];s.emitter().removeListener(e,i,n)}return this},removeAllListeners:function(){for(var e=0;e<this.length;e++){var r=this[e];r.emitter().removeAllListeners()}return this},one:function(e,r,n){for(var i=oy(r),a=0;a<this.length;a++){var s=this[a];s.emitter().one(e,i,n)}return this},once:function(e,r,n){for(var i=oy(r),a=0;a<this.length;a++){var s=this[a];s.emitter().on(e,i,n,{once:!0,onceCollection:this})}},emit:function(e,r){for(var n=0;n<this.length;n++){var i=this[n];i.emitter().emit(e,r)}return this},emitAndNotify:function(e,r){if(this.length!==0)return this.cy().notify(e,this),this.emit(e,r),this}};nn.eventAliasesOn(IA);var jA={nodes:function(e){return this.filter(function(r){return r.isNode()}).filter(e)},edges:function(e){return this.filter(function(r){return r.isEdge()}).filter(e)},byGroup:function(){for(var e=this.spawn(),r=this.spawn(),n=0;n<this.length;n++){var i=this[n];i.isNode()?e.push(i):r.push(i)}return{nodes:e,edges:r}},filter:function(e,r){if(e===void 0)return this;if(Yt(e)||vo(e))return new Xd(e).filter(this);if(ri(e)){for(var n=this.spawn(),i=this,a=0;a<i.length;a++){var s=i[a],o=r?e.apply(r,[s,a,i]):e(s,a,i);o&&n.push(s)}return n}return this.spawn()},not:function(e){if(e){Yt(e)&&(e=this.filter(e));for(var r=this.spawn(),n=0;n<this.length;n++){var i=this[n],a=e.has(i);a||r.push(i)}return r}else return this},absoluteComplement:function(){var e=this.cy();return e.mutableElements().not(this)},intersect:function(e){if(Yt(e)){var r=e;return this.filter(r)}for(var n=this.spawn(),i=this,a=e,s=this.length<e.length,o=s?i:a,l=s?a:i,u=0;u<o.length;u++){var c=o[u];l.has(c)&&n.push(c)}return n},xor:function(e){var r=this._private.cy;Yt(e)&&(e=r.$(e));var n=this.spawn(),i=this,a=e,s=function(l,u){for(var c=0;c<l.length;c++){var f=l[c],p=f._private.data.id,g=u.hasElementWithId(p);g||n.push(f)}};return s(i,a),s(a,i),n},diff:function(e){var r=this._private.cy;Yt(e)&&(e=r.$(e));var n=this.spawn(),i=this.spawn(),a=this.spawn(),s=this,o=e,l=function(c,f,p){for(var g=0;g<c.length;g++){var y=c[g],S=y._private.data.id,w=f.hasElementWithId(S);w?a.merge(y):p.push(y)}};return l(s,o,n),l(o,s,i),{left:n,right:i,both:a}},add:function(e){var r=this._private.cy;if(!e)return this;if(Yt(e)){var n=e;e=r.mutableElements().filter(n)}for(var i=this.spawnSelf(),a=0;a<e.length;a++){var s=e[a],o=!this.has(s);o&&i.push(s)}return i},merge:function(e){var r=this._private,n=r.cy;if(!e)return this;if(e&&Yt(e)){var i=e;e=n.mutableElements().filter(i)}for(var a=r.map,s=0;s<e.length;s++){var o=e[s],l=o._private.data.id,u=!a.has(l);if(u){var c=this.length++;this[c]=o,a.set(l,{ele:o,index:c})}}return this},unmergeAt:function(e){var r=this[e],n=r.id(),i=this._private,a=i.map;this[e]=void 0,a.delete(n);var s=e===this.length-1;if(this.length>1&&!s){var o=this.length-1,l=this[o],u=l._private.data.id;this[o]=void 0,this[e]=l,a.set(u,{ele:l,index:e})}return this.length--,this},unmergeOne:function(e){e=e[0];var r=this._private,n=e._private.data.id,i=r.map,a=i.get(n);if(!a)return this;var s=a.index;return this.unmergeAt(s),this},unmerge:function(e){var r=this._private.cy;if(!e)return this;if(e&&Yt(e)){var n=e;e=r.mutableElements().filter(n)}for(var i=0;i<e.length;i++)this.unmergeOne(e[i]);return this},unmergeBy:function(e){for(var r=this.length-1;r>=0;r--){var n=this[r];e(n)&&this.unmergeAt(r)}return this},map:function(e,r){for(var n=[],i=this,a=0;a<i.length;a++){var s=i[a],o=r?e.apply(r,[s,a,i]):e(s,a,i);n.push(o)}return n},reduce:function(e,r){for(var n=r,i=this,a=0;a<i.length;a++)n=e(n,i[a],a,i);return n},max:function(e,r){for(var n=-1/0,i,a=this,s=0;s<a.length;s++){var o=a[s],l=r?e.apply(r,[o,s,a]):e(o,s,a);l>n&&(n=l,i=o)}return{value:n,ele:i}},min:function(e,r){for(var n=1/0,i,a=this,s=0;s<a.length;s++){var o=a[s],l=r?e.apply(r,[o,s,a]):e(o,s,a);l<n&&(n=l,i=o)}return{value:n,ele:i}}},Kr=jA;Kr.u=Kr["|"]=Kr["+"]=Kr.union=Kr.or=Kr.add;Kr["\\"]=Kr["!"]=Kr["-"]=Kr.difference=Kr.relativeComplement=Kr.subtract=Kr.not;Kr.n=Kr["&"]=Kr["."]=Kr.and=Kr.intersection=Kr.intersect;Kr["^"]=Kr["(+)"]=Kr["(-)"]=Kr.symmetricDifference=Kr.symdiff=Kr.xor;Kr.fnFilter=Kr.filterFn=Kr.stdFilter=Kr.filter;Kr.complement=Kr.abscomp=Kr.absoluteComplement;var z7={isNode:function(){return this.group()==="nodes"},isEdge:function(){return this.group()==="edges"},isLoop:function(){return this.isEdge()&&this.source()[0]===this.target()[0]},isSimple:function(){return this.isEdge()&&this.source()[0]!==this.target()[0]},group:function(){var e=this[0];if(e)return e._private.group}},FA=function(e,r){var n=e.cy(),i=n.hasCompoundNodes();function a(c){var f=c.pstyle("z-compound-depth");return f.value==="auto"?i?c.zDepth():0:f.value==="bottom"?-1:f.value==="top"?s_:0}var s=a(e)-a(r);if(s!==0)return s;function o(c){var f=c.pstyle("z-index-compare");return f.value==="auto"&&c.isNode()?1:0}var l=o(e)-o(r);if(l!==0)return l;var u=e.pstyle("z-index").value-r.pstyle("z-index").value;return u!==0?u:e.poolIndex()-r.poolIndex()},mx={forEach:function(e,r){if(ri(e))for(var n=this.length,i=0;i<n;i++){var a=this[i],s=r?e.apply(r,[a,i,this]):e(a,i,this);if(s===!1)break}return this},toArray:function(){for(var e=[],r=0;r<this.length;r++)e.push(this[r]);return e},slice:function(e,r){var n=[],i=this.length;r==null&&(r=i),e==null&&(e=0),e<0&&(e=i+e),r<0&&(r=i+r);for(var a=e;a>=0&&a<r&&a<i;a++)n.push(this[a]);return this.spawn(n)},size:function(){return this.length},eq:function(e){return this[e]||this.spawn()},first:function(){return this[0]||this.spawn()},last:function(){return this[this.length-1]||this.spawn()},empty:function(){return this.length===0},nonempty:function(){return!this.empty()},sort:function(e){if(!ri(e))return this;var r=this.toArray().sort(e);return this.spawn(r)},sortByZIndex:function(){return this.sort(FA)},zDepth:function(){var e=this[0];if(e){var r=e._private,n=r.group;if(n==="nodes"){var i=r.data.parent?e.parents().size():0;return e.isParent()?i:s_-1}else{var a=r.source,s=r.target,o=a.zDepth(),l=s.zDepth();return Math.max(o,l,0)}}}};mx.each=mx.forEach;var U7=function(){var e="undefined",r=(typeof Symbol>"u"?"undefined":qi(Symbol))!=e&&qi(Symbol.iterator)!=e;r&&(mx[Symbol.iterator]=function(){var n=this,i={value:void 0,done:!1},a=0,s=this.length;return IM({next:function(){return a<s?i.value=n[a++]:(i.value=void 0,i.done=!0),i}},Symbol.iterator,function(){return this})})};U7();var G7=Ha({nodeDimensionsIncludeLabels:!1}),Gy={layoutDimensions:function(e){e=G7(e);var r;if(!this.takesUpSpace())r={w:0,h:0};else if(e.nodeDimensionsIncludeLabels){var n=this.boundingBox();r={w:n.w,h:n.h}}else r={w:this.outerWidth(),h:this.outerHeight()};return(r.w===0||r.h===0)&&(r.w=r.h=1),r},layoutPositions:function(e,r,n){var i=this.nodes().filter(function(R){return!R.isParent()}),a=this.cy(),s=r.eles,o=function(D){return D.id()},l=Hp(n,o);e.emit({type:"layoutstart",layout:e}),e.animations=[];var u=function(D,j,O){var F={x:j.x1+j.w/2,y:j.y1+j.h/2},z={x:(O.x-F.x)*D,y:(O.y-F.y)*D};return{x:F.x+z.x,y:F.y+z.y}},c=r.spacingFactor&&r.spacingFactor!==1,f=function(){if(!c)return null;for(var D=Es(),j=0;j<i.length;j++){var O=i[j],F=l(O,j);rA(D,F.x,F.y)}return D},p=f(),g=Hp(function(R,D){var j=l(R,D);if(c){var O=Math.abs(r.spacingFactor);j=u(O,p,j)}return r.transform!=null&&(j=r.transform(R,j)),j},o);if(r.animate){for(var y=0;y<i.length;y++){var S=i[y],w=g(S,y),C=r.animateFilter==null||r.animateFilter(S,y);if(C){var _=S.animation({position:w,duration:r.animationDuration,easing:r.animationEasing});e.animations.push(_)}else S.position(w)}if(r.fit){var T=a.animation({fit:{boundingBox:s.boundingBoxAt(g),padding:r.padding},duration:r.animationDuration,easing:r.animationEasing});e.animations.push(T)}else if(r.zoom!==void 0&&r.pan!==void 0){var N=a.animation({zoom:r.zoom,pan:r.pan,duration:r.animationDuration,easing:r.animationEasing});e.animations.push(N)}e.animations.forEach(function(R){return R.play()}),e.one("layoutready",r.ready),e.emit({type:"layoutready",layout:e}),um.all(e.animations.map(function(R){return R.promise()})).then(function(){e.one("layoutstop",r.stop),e.emit({type:"layoutstop",layout:e})})}else i.positions(g),r.fit&&a.fit(r.eles,r.padding),r.zoom!=null&&a.zoom(r.zoom),r.pan&&a.pan(r.pan),e.one("layoutready",r.ready),e.emit({type:"layoutready",layout:e}),e.one("layoutstop",r.stop),e.emit({type:"layoutstop",layout:e});return this},layout:function(e){var r=this.cy();return r.makeLayout(sr({},e,{eles:this}))}};Gy.createLayout=Gy.makeLayout=Gy.layout;function BA(t,e,r){var n=r._private,i=n.styleCache=n.styleCache||[],a;return(a=i[t])!=null||(a=i[t]=e(r)),a}function I1(t,e){return t=ph(t),function(n){return BA(t,e,n)}}function j1(t,e){t=ph(t);var r=function(i){return e.call(i)};return function(){var i=this[0];if(i)return BA(t,r,i)}}var Ba={recalculateRenderedStyle:function(e){var r=this.cy(),n=r.renderer(),i=r.styleEnabled();return n&&i&&n.recalculateRenderedStyle(this,e),this},dirtyStyleCache:function(){var e=this.cy(),r=function(a){return a._private.styleCache=null};if(e.hasCompoundNodes()){var n;n=this.spawnSelf().merge(this.descendants()).merge(this.parents()),n.merge(n.connectedEdges()),n.forEach(r)}else this.forEach(function(i){r(i),i.connectedEdges().forEach(r)});return this},updateStyle:function(e){var r=this._private.cy;if(!r.styleEnabled())return this;if(r.batching()){var n=r._private.batchStyleEles;return n.merge(this),this}var i=r.hasCompoundNodes(),a=this;e=!!(e||e===void 0),i&&(a=this.spawnSelf().merge(this.descendants()).merge(this.parents()));var s=a;return e?s.emitAndNotify("style"):s.emit("style"),a.forEach(function(o){return o._private.styleDirty=!0}),this},cleanStyle:function(){var e=this.cy();if(e.styleEnabled())for(var r=0;r<this.length;r++){var n=this[r];n._private.styleDirty&&(n._private.styleDirty=!1,e.style().apply(n))}},parsedStyle:function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,n=this[0],i=n.cy();if(i.styleEnabled()&&n){n._private.styleDirty&&(n._private.styleDirty=!1,i.style().apply(n));var a=n._private.style[e];return a??(r?i.style().getDefaultProperty(e):null)}},numericStyle:function(e){var r=this[0];if(r.cy().styleEnabled()&&r){var n=r.pstyle(e);return n.pfValue!==void 0?n.pfValue:n.value}},numericStyleUnits:function(e){var r=this[0];if(r.cy().styleEnabled()&&r)return r.pstyle(e).units},renderedStyle:function(e){var r=this.cy();if(!r.styleEnabled())return this;var n=this[0];if(n)return r.style().getRenderedStyle(n,e)},style:function(e,r){var n=this.cy();if(!n.styleEnabled())return this;var i=!1,a=n.style();if(Wr(e)){var s=e;a.applyBypass(this,s,i),this.emitAndNotify("style")}else if(Yt(e))if(r===void 0){var o=this[0];return o?a.getStylePropertyValue(o,e):void 0}else a.applyBypass(this,e,r,i),this.emitAndNotify("style");else if(e===void 0){var l=this[0];return l?a.getRawStyle(l):void 0}return this},removeStyle:function(e){var r=this.cy();if(!r.styleEnabled())return this;var n=!1,i=r.style(),a=this;if(e===void 0)for(var s=0;s<a.length;s++){var o=a[s];i.removeAllBypasses(o,n)}else{e=e.split(/\s+/);for(var l=0;l<a.length;l++){var u=a[l];i.removeBypasses(u,e,n)}}return this.emitAndNotify("style"),this},show:function(){return this.css("display","element"),this},hide:function(){return this.css("display","none"),this},effectiveOpacity:function(){var e=this.cy();if(!e.styleEnabled())return 1;var r=e.hasCompoundNodes(),n=this[0];if(n){var i=n._private,a=n.pstyle("opacity").value;if(!r)return a;var s=i.data.parent?n.parents():null;if(s)for(var o=0;o<s.length;o++){var l=s[o],u=l.pstyle("opacity").value;a=u*a}return a}},transparent:function(){var e=this.cy();if(!e.styleEnabled())return!1;var r=this[0],n=r.cy().hasCompoundNodes();if(r)return n?r.effectiveOpacity()===0:r.pstyle("opacity").value===0},backgrounding:function(){var e=this.cy();if(!e.styleEnabled())return!1;var r=this[0];return!!r._private.backgrounding}};function m2(t,e){var r=t._private,n=r.data.parent?t.parents():null;if(n)for(var i=0;i<n.length;i++){var a=n[i];if(!e(a))return!1}return!0}function y_(t){var e=t.ok,r=t.edgeOkViaNode||t.ok,n=t.parentOk||t.ok;return function(){var i=this.cy();if(!i.styleEnabled())return!0;var a=this[0],s=i.hasCompoundNodes();if(a){var o=a._private;if(!e(a))return!1;if(a.isNode())return!s||m2(a,n);var l=o.source,u=o.target;return r(l)&&(!s||m2(l,r))&&(l===u||r(u)&&(!s||m2(u,r)))}}}var cm=I1("eleTakesUpSpace",function(t){return t.pstyle("display").value==="element"&&t.width()!==0&&(t.isNode()?t.height()!==0:!0)});Ba.takesUpSpace=j1("takesUpSpace",y_({ok:cm}));var V7=I1("eleInteractive",function(t){return t.pstyle("events").value==="yes"&&t.pstyle("visibility").value==="visible"&&cm(t)}),H7=I1("parentInteractive",function(t){return t.pstyle("visibility").value==="visible"&&cm(t)});Ba.interactive=j1("interactive",y_({ok:V7,parentOk:H7,edgeOkViaNode:cm}));Ba.noninteractive=function(){var t=this[0];if(t)return!t.interactive()};var W7=I1("eleVisible",function(t){return t.pstyle("visibility").value==="visible"&&t.pstyle("opacity").pfValue!==0&&cm(t)}),q7=cm;Ba.visible=j1("visible",y_({ok:W7,edgeOkViaNode:q7}));Ba.hidden=function(){var t=this[0];if(t)return!t.visible()};Ba.isBundledBezier=j1("isBundledBezier",function(){return this.cy().styleEnabled()?!this.removed()&&this.pstyle("curve-style").value==="bezier"&&this.takesUpSpace():!1});Ba.bypass=Ba.css=Ba.style;Ba.renderedCss=Ba.renderedStyle;Ba.removeBypass=Ba.removeCss=Ba.removeStyle;Ba.pstyle=Ba.parsedStyle;var Gd={};function EN(t){return function(){var e=arguments,r=[];if(e.length===2){var n=e[0],i=e[1];this.on(t.event,n,i)}else if(e.length===1&&ri(e[0])){var a=e[0];this.on(t.event,a)}else if(e.length===0||e.length===1&&Sn(e[0])){for(var s=e.length===1?e[0]:null,o=0;o<this.length;o++){var l=this[o],u=!t.ableField||l._private[t.ableField],c=l._private[t.field]!=t.value;if(t.overrideAble){var f=t.overrideAble(l);if(f!==void 0&&(u=f,!f))return this}u&&(l._private[t.field]=t.value,c&&r.push(l))}var p=this.spawn(r);p.updateStyle(),p.emit(t.event),s&&p.emit(s)}return this}}function dm(t){Gd[t.field]=function(){var e=this[0];if(e){if(t.overrideField){var r=t.overrideField(e);if(r!==void 0)return r}return e._private[t.field]}},Gd[t.on]=EN({event:t.on,field:t.field,ableField:t.ableField,overrideAble:t.overrideAble,value:!0}),Gd[t.off]=EN({event:t.off,field:t.field,ableField:t.ableField,overrideAble:t.overrideAble,value:!1})}dm({field:"locked",overrideField:function(e){return e.cy().autolock()?!0:void 0},on:"lock",off:"unlock"});dm({field:"grabbable",overrideField:function(e){return e.cy().autoungrabify()||e.pannable()?!1:void 0},on:"grabify",off:"ungrabify"});dm({field:"selected",ableField:"selectable",overrideAble:function(e){return e.cy().autounselectify()?!1:void 0},on:"select",off:"unselect"});dm({field:"selectable",overrideField:function(e){return e.cy().autounselectify()?!1:void 0},on:"selectify",off:"unselectify"});Gd.deselect=Gd.unselect;Gd.grabbed=function(){var t=this[0];if(t)return t._private.grabbed};dm({field:"active",on:"activate",off:"unactivate"});dm({field:"pannable",on:"panify",off:"unpanify"});Gd.inactive=function(){var t=this[0];if(t)return!t._private.active};var ss={},TN=function(e){return function(n){for(var i=this,a=[],s=0;s<i.length;s++){var o=i[s];if(o.isNode()){for(var l=!1,u=o.connectedEdges(),c=0;c<u.length;c++){var f=u[c],p=f.source(),g=f.target();if(e.noIncomingEdges&&g===o&&p!==o||e.noOutgoingEdges&&p===o&&g!==o){l=!0;break}}l||a.push(o)}}return this.spawn(a,!0).filter(n)}},NN=function(e){return function(r){for(var n=this,i=[],a=0;a<n.length;a++){var s=n[a];if(s.isNode())for(var o=s.connectedEdges(),l=0;l<o.length;l++){var u=o[l],c=u.source(),f=u.target();e.outgoing&&c===s?(i.push(u),i.push(f)):e.incoming&&f===s&&(i.push(u),i.push(c))}}return this.spawn(i,!0).filter(r)}},PN=function(e){return function(r){for(var n=this,i=[],a={};;){var s=e.outgoing?n.outgoers():n.incomers();if(s.length===0)break;for(var o=!1,l=0;l<s.length;l++){var u=s[l],c=u.id();a[c]||(a[c]=!0,i.push(u),o=!0)}if(!o)break;n=s}return this.spawn(i,!0).filter(r)}};ss.clearTraversalCache=function(){for(var t=0;t<this.length;t++)this[t]._private.traversalCache=null};sr(ss,{roots:TN({noIncomingEdges:!0}),leaves:TN({noOutgoingEdges:!0}),outgoers:Xo(NN({outgoing:!0}),"outgoers"),successors:PN({outgoing:!0}),incomers:Xo(NN({incoming:!0}),"incomers"),predecessors:PN({})});sr(ss,{neighborhood:Xo(function(t){for(var e=[],r=this.nodes(),n=0;n<r.length;n++)for(var i=r[n],a=i.connectedEdges(),s=0;s<a.length;s++){var o=a[s],l=o.source(),u=o.target(),c=i===l?u:l;c.length>0&&e.push(c[0]),e.push(o[0])}return this.spawn(e,!0).filter(t)},"neighborhood"),closedNeighborhood:function(e){return this.neighborhood().add(this).filter(e)},openNeighborhood:function(e){return this.neighborhood(e)}});ss.neighbourhood=ss.neighborhood;ss.closedNeighbourhood=ss.closedNeighborhood;ss.openNeighbourhood=ss.openNeighborhood;sr(ss,{source:Xo(function(e){var r=this[0],n;return r&&(n=r._private.source||r.cy().collection()),n&&e?n.filter(e):n},"source"),target:Xo(function(e){var r=this[0],n;return r&&(n=r._private.target||r.cy().collection()),n&&e?n.filter(e):n},"target"),sources:MN({attr:"source"}),targets:MN({attr:"target"})});function MN(t){return function(r){for(var n=[],i=0;i<this.length;i++){var a=this[i],s=a._private[t.attr];s&&n.push(s)}return this.spawn(n,!0).filter(r)}}sr(ss,{edgesWith:Xo(AN(),"edgesWith"),edgesTo:Xo(AN({thisIsSrc:!0}),"edgesTo")});function AN(t){return function(r){var n=[],i=this._private.cy,a=t||{};Yt(r)&&(r=i.$(r));for(var s=0;s<r.length;s++)for(var o=r[s]._private.edges,l=0;l<o.length;l++){var u=o[l],c=u._private.data,f=this.hasElementWithId(c.source)&&r.hasElementWithId(c.target),p=r.hasElementWithId(c.source)&&this.hasElementWithId(c.target),g=f||p;g&&((a.thisIsSrc||a.thisIsTgt)&&(a.thisIsSrc&&!f||a.thisIsTgt&&!p)||n.push(u))}return this.spawn(n,!0)}}sr(ss,{connectedEdges:Xo(function(t){for(var e=[],r=this,n=0;n<r.length;n++){var i=r[n];if(i.isNode())for(var a=i._private.edges,s=0;s<a.length;s++){var o=a[s];e.push(o)}}return this.spawn(e,!0).filter(t)},"connectedEdges"),connectedNodes:Xo(function(t){for(var e=[],r=this,n=0;n<r.length;n++){var i=r[n];i.isEdge()&&(e.push(i.source()[0]),e.push(i.target()[0]))}return this.spawn(e,!0).filter(t)},"connectedNodes"),parallelEdges:Xo(LN(),"parallelEdges"),codirectedEdges:Xo(LN({codirected:!0}),"codirectedEdges")});function LN(t){var e={codirected:!1};return t=sr({},e,t),function(n){for(var i=[],a=this.edges(),s=t,o=0;o<a.length;o++)for(var l=a[o],u=l._private,c=u.source,f=c._private.data.id,p=u.data.target,g=c._private.edges,y=0;y<g.length;y++){var S=g[y],w=S._private.data,C=w.target,_=w.source,T=C===p&&_===f,N=f===C&&p===_;(s.codirected&&T||!s.codirected&&(T||N))&&i.push(S)}return this.spawn(i,!0).filter(n)}}sr(ss,{components:function(e){var r=this,n=r.cy(),i=n.collection(),a=e==null?r.nodes():e.nodes(),s=[];e!=null&&a.empty()&&(a=e.sources());var o=function(c,f){i.merge(c),a.unmerge(c),f.merge(c)};if(a.empty())return r.spawn();var l=function(){var c=n.collection();s.push(c);var f=a[0];o(f,c),r.bfs({directed:!1,roots:f,visit:function(g){return o(g,c)}}),c.forEach(function(p){p.connectedEdges().forEach(function(g){r.has(g)&&c.has(g.source())&&c.has(g.target())&&c.merge(g)})})};do l();while(a.length>0);return s},component:function(){var e=this[0];return e.cy().mutableElements().components(e)[0]}});ss.componentsOf=ss.components;var za=function(e,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(e===void 0){Zn("A collection must have a reference to the core");return}var a=new fc,s=!1;if(!r)r=[];else if(r.length>0&&Wr(r[0])&&!Xv(r[0])){s=!0;for(var o=[],l=new lm,u=0,c=r.length;u<c;u++){var f=r[u];f.data==null&&(f.data={});var p=f.data;if(p.id==null)p.id=JM();else if(e.hasElementWithId(p.id)||l.has(p.id))continue;var g=new T1(e,f,!1);o.push(g),l.add(p.id)}r=o}this.length=0;for(var y=0,S=r.length;y<S;y++){var w=r[y][0];if(w!=null){var C=w._private.data.id;(!n||!a.has(C))&&(n&&a.set(C,{index:this.length,ele:w}),this[this.length]=w,this.length++)}}this._private={eles:this,cy:e,get map(){return this.lazyMap==null&&this.rebuildMap(),this.lazyMap},set map(_){this.lazyMap=_},rebuildMap:function(){for(var T=this.lazyMap=new fc,N=this.eles,R=0;R<N.length;R++){var D=N[R];T.set(D.id(),{index:R,ele:D})}}},n&&(this._private.map=a),s&&!i&&this.restore()},Mn=T1.prototype=za.prototype=Object.create(Array.prototype);Mn.instanceString=function(){return"collection"};Mn.spawn=function(t,e){return new za(this.cy(),t,e)};Mn.spawnSelf=function(){return this.spawn(this)};Mn.cy=function(){return this._private.cy};Mn.renderer=function(){return this._private.cy.renderer()};Mn.element=function(){return this[0]};Mn.collection=function(){return BM(this)?this:new za(this._private.cy,[this])};Mn.unique=function(){return new za(this._private.cy,this,!0)};Mn.hasElementWithId=function(t){return t=""+t,this._private.map.has(t)};Mn.getElementById=function(t){t=""+t;var e=this._private.cy,r=this._private.map.get(t);return r?r.ele:new za(e)};Mn.$id=Mn.getElementById;Mn.poolIndex=function(){var t=this._private.cy,e=t._private.elements,r=this[0]._private.data.id;return e._private.map.get(r).index};Mn.indexOf=function(t){var e=t[0]._private.data.id;return this._private.map.get(e).index};Mn.indexOfId=function(t){return t=""+t,this._private.map.get(t).index};Mn.json=function(t){var e=this.element(),r=this.cy();if(e==null&&t)return this;if(e!=null){var n=e._private;if(Wr(t)){if(r.startBatch(),t.data){e.data(t.data);var i=n.data;if(e.isEdge()){var a=!1,s={},o=t.data.source,l=t.data.target;o!=null&&o!=i.source&&(s.source=""+o,a=!0),l!=null&&l!=i.target&&(s.target=""+l,a=!0),a&&(e=e.move(s))}else{var u="parent"in t.data,c=t.data.parent;u&&(c!=null||i.parent!=null)&&c!=i.parent&&(c===void 0&&(c=null),c!=null&&(c=""+c),e=e.move({parent:c}))}}t.position&&e.position(t.position);var f=function(S,w,C){var _=t[S];_!=null&&_!==n[S]&&(_?e[w]():e[C]())};return f("removed","remove","restore"),f("selected","select","unselect"),f("selectable","selectify","unselectify"),f("locked","lock","unlock"),f("grabbable","grabify","ungrabify"),f("pannable","panify","unpanify"),t.classes!=null&&e.classes(t.classes),r.endBatch(),this}else if(t===void 0){var p={data:_u(n.data),position:_u(n.position),group:n.group,removed:n.removed,selected:n.selected,selectable:n.selectable,locked:n.locked,grabbable:n.grabbable,pannable:n.pannable,classes:null};p.classes="";var g=0;return n.classes.forEach(function(y){return p.classes+=g++===0?y:" "+y}),p}}};Mn.jsons=function(){for(var t=[],e=0;e<this.length;e++){var r=this[e],n=r.json();t.push(n)}return t};Mn.clone=function(){for(var t=this.cy(),e=[],r=0;r<this.length;r++){var n=this[r],i=n.json(),a=new T1(t,i,!1);e.push(a)}return new za(t,e)};Mn.copy=Mn.clone;Mn.restore=function(){for(var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=this,n=r.cy(),i=n._private,a=[],s=[],o,l=0,u=r.length;l<u;l++){var c=r[l];e&&!c.removed()||(c.isNode()?a.push(c):s.push(c))}o=a.concat(s);var f,p=function(){o.splice(f,1),f--};for(f=0;f<o.length;f++){var g=o[f],y=g._private,S=y.data;if(g.clearTraversalCache(),!(!e&&!y.removed)){if(S.id===void 0)S.id=JM();else if(_t(S.id))S.id=""+S.id;else if(Kd(S.id)||!Yt(S.id)){Zn("Can not create element with invalid string ID `"+S.id+"`"),p();continue}else if(n.hasElementWithId(S.id)){Zn("Can not create second element with ID `"+S.id+"`"),p();continue}}var w=S.id;if(g.isNode()){var C=y.position;C.x==null&&(C.x=0),C.y==null&&(C.y=0)}if(g.isEdge()){for(var _=g,T=["source","target"],N=T.length,R=!1,D=0;D<N;D++){var j=T[D],O=S[j];_t(O)&&(O=S[j]=""+S[j]),O==null||O===""?(Zn("Can not create edge `"+w+"` with unspecified "+j),R=!0):n.hasElementWithId(O)||(Zn("Can not create edge `"+w+"` with nonexistant "+j+" `"+O+"`"),R=!0)}if(R){p();continue}var F=n.getElementById(S.source),z=n.getElementById(S.target);F.same(z)?F._private.edges.push(_):(F._private.edges.push(_),z._private.edges.push(_)),_._private.source=F,_._private.target=z}y.map=new fc,y.map.set(w,{ele:g,index:0}),y.removed=!1,e&&n.addToPool(g)}for(var G=0;G<a.length;G++){var Z=a[G],I=Z._private.data;_t(I.parent)&&(I.parent=""+I.parent);var W=I.parent,U=W!=null;if(U||Z._private.parent){var K=Z._private.parent?n.collection().merge(Z._private.parent):n.getElementById(W);if(K.empty())I.parent=void 0;else if(K[0].removed())an("Node added with missing parent, reference to parent removed"),I.parent=void 0,Z._private.parent=null;else{for(var $=!1,Q=K;!Q.empty();){if(Z.same(Q)){$=!0,I.parent=void 0;break}Q=Q.parent()}$||(K[0]._private.children.push(Z),Z._private.parent=K[0],i.hasCompoundNodes=!0)}}}if(o.length>0){for(var ie=o.length===r.length?r:new za(n,o),te=0;te<ie.length;te++){var X=ie[te];X.isNode()||(X.parallelEdges().clearTraversalCache(),X.source().clearTraversalCache(),X.target().clearTraversalCache())}var re;i.hasCompoundNodes?re=n.collection().merge(ie).merge(ie.connectedNodes()).merge(ie.parent()):re=ie,re.dirtyCompoundBoundsCache().dirtyBoundingBoxCache().updateStyle(t),t?ie.emitAndNotify("add"):e&&ie.emit("add")}return r};Mn.removed=function(){var t=this[0];return t&&t._private.removed};Mn.inside=function(){var t=this[0];return t&&!t._private.removed};Mn.remove=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=this,n=[],i={},a=r._private.cy;function s(W){for(var U=W._private.edges,K=0;K<U.length;K++)l(U[K])}function o(W){for(var U=W._private.children,K=0;K<U.length;K++)l(U[K])}function l(W){var U=i[W.id()];e&&W.removed()||U||(i[W.id()]=!0,W.isNode()?(n.push(W),s(W),o(W)):n.unshift(W))}for(var u=0,c=r.length;u<c;u++){var f=r[u];l(f)}function p(W,U){var K=W._private.edges;Zd(K,U),W.clearTraversalCache()}function g(W){W.clearTraversalCache()}var y=[];y.ids={};function S(W,U){U=U[0],W=W[0];var K=W._private.children,$=W.id();Zd(K,U),U._private.parent=null,y.ids[$]||(y.ids[$]=!0,y.push(W))}r.dirtyCompoundBoundsCache(),e&&a.removeFromPool(n);for(var w=0;w<n.length;w++){var C=n[w];if(C.isEdge()){var _=C.source()[0],T=C.target()[0];p(_,C),p(T,C);for(var N=C.parallelEdges(),R=0;R<N.length;R++){var D=N[R];g(D),D.isBundledBezier()&&D.dirtyBoundingBoxCache()}}else{var j=C.parent();j.length!==0&&S(j,C)}e&&(C._private.removed=!0)}var O=a._private.elements;a._private.hasCompoundNodes=!1;for(var F=0;F<O.length;F++){var z=O[F];if(z.isParent()){a._private.hasCompoundNodes=!0;break}}var G=new za(this.cy(),n);G.size()>0&&(t?G.emitAndNotify("remove"):e&&G.emit("remove"));for(var Z=0;Z<y.length;Z++){var I=y[Z];(!e||!I.removed())&&I.updateStyle()}return G};Mn.move=function(t){var e=this._private.cy,r=this,n=!1,i=!1,a=function(y){return y==null?y:""+y};if(t.source!==void 0||t.target!==void 0){var s=a(t.source),o=a(t.target),l=s!=null&&e.hasElementWithId(s),u=o!=null&&e.hasElementWithId(o);(l||u)&&(e.batch(function(){r.remove(n,i),r.emitAndNotify("moveout");for(var g=0;g<r.length;g++){var y=r[g],S=y._private.data;y.isEdge()&&(l&&(S.source=s),u&&(S.target=o))}r.restore(n,i)}),r.emitAndNotify("move"))}else if(t.parent!==void 0){var c=a(t.parent),f=c===null||e.hasElementWithId(c);if(f){var p=c===null?void 0:c;e.batch(function(){var g=r.remove(n,i);g.emitAndNotify("moveout");for(var y=0;y<r.length;y++){var S=r[y],w=S._private.data;S.isNode()&&(w.parent=p)}g.restore(n,i)}),r.emitAndNotify("move")}}return this};[dA,n7,Uy,Ud,qp,x7,O1,D7,IA,jA,z7,mx,Gy,Ba,Gd,ss].forEach(function(t){sr(Mn,t)});var $7={add:function(e){var r,n=this;if(vo(e)){var i=e;if(i._private.cy===n)r=i.restore();else{for(var a=[],s=0;s<i.length;s++){var o=i[s];a.push(o.json())}r=new za(n,a)}}else if(Sn(e)){var l=e;r=new za(n,l)}else if(Wr(e)&&(Sn(e.nodes)||Sn(e.edges))){for(var u=e,c=[],f=["nodes","edges"],p=0,g=f.length;p<g;p++){var y=f[p],S=u[y];if(Sn(S))for(var w=0,C=S.length;w<C;w++){var _=sr({group:y},S[w]);c.push(_)}}r=new za(n,c)}else{var T=e;r=new T1(n,T).collection()}return r},remove:function(e){if(!vo(e)){if(Yt(e)){var r=e;e=this.$(r)}}return e.remove()}};function K7(t,e,r,n){var i=4,a=.001,s=1e-7,o=10,l=11,u=1/(l-1),c=typeof Float32Array<"u";if(arguments.length!==4)return!1;for(var f=0;f<4;++f)if(typeof arguments[f]!="number"||isNaN(arguments[f])||!isFinite(arguments[f]))return!1;t=Math.min(t,1),r=Math.min(r,1),t=Math.max(t,0),r=Math.max(r,0);var p=c?new Float32Array(l):new Array(l);function g(z,G){return 1-3*G+3*z}function y(z,G){return 3*G-6*z}function S(z){return 3*z}function w(z,G,Z){return((g(G,Z)*z+y(G,Z))*z+S(G))*z}function C(z,G,Z){return 3*g(G,Z)*z*z+2*y(G,Z)*z+S(G)}function _(z,G){for(var Z=0;Z<i;++Z){var I=C(G,t,r);if(I===0)return G;var W=w(G,t,r)-z;G-=W/I}return G}function T(){for(var z=0;z<l;++z)p[z]=w(z*u,t,r)}function N(z,G,Z){var I,W,U=0;do W=G+(Z-G)/2,I=w(W,t,r)-z,I>0?Z=W:G=W;while(Math.abs(I)>s&&++U<o);return W}function R(z){for(var G=0,Z=1,I=l-1;Z!==I&&p[Z]<=z;++Z)G+=u;--Z;var W=(z-p[Z])/(p[Z+1]-p[Z]),U=G+W*u,K=C(U,t,r);return K>=a?_(z,U):K===0?U:N(z,G,G+u)}var D=!1;function j(){D=!0,(t!==e||r!==n)&&T()}var O=function(G){return D||j(),t===e&&r===n?G:G===0?0:G===1?1:w(R(G),e,n)};O.getControlPoints=function(){return[{x:t,y:e},{x:r,y:n}]};var F="generateBezier("+[t,e,r,n]+")";return O.toString=function(){return F},O}var Z7=(function(){function t(n){return-n.tension*n.x-n.friction*n.v}function e(n,i,a){var s={x:n.x+a.dx*i,v:n.v+a.dv*i,tension:n.tension,friction:n.friction};return{dx:s.v,dv:t(s)}}function r(n,i){var a={dx:n.v,dv:t(n)},s=e(n,i*.5,a),o=e(n,i*.5,s),l=e(n,i,o),u=1/6*(a.dx+2*(s.dx+o.dx)+l.dx),c=1/6*(a.dv+2*(s.dv+o.dv)+l.dv);return n.x=n.x+u*i,n.v=n.v+c*i,n}return function n(i,a,s){var o={x:-1,v:0,tension:null,friction:null},l=[0],u=0,c=1/1e4,f=16/1e3,p,g,y;for(i=parseFloat(i)||500,a=parseFloat(a)||20,s=s||null,o.tension=i,o.friction=a,p=s!==null,p?(u=n(i,a),g=u/s*f):g=f;y=r(y||o,g),l.push(1+y.x),u+=16,Math.abs(y.x)>c&&Math.abs(y.v)>c;);return p?function(S){return l[S*(l.length-1)|0]}:u}})(),Nn=function(e,r,n,i){var a=K7(e,r,n,i);return function(s,o,l){return s+(o-s)*a(l)}},Vy={linear:function(e,r,n){return e+(r-e)*n},ease:Nn(.25,.1,.25,1),"ease-in":Nn(.42,0,1,1),"ease-out":Nn(0,0,.58,1),"ease-in-out":Nn(.42,0,.58,1),"ease-in-sine":Nn(.47,0,.745,.715),"ease-out-sine":Nn(.39,.575,.565,1),"ease-in-out-sine":Nn(.445,.05,.55,.95),"ease-in-quad":Nn(.55,.085,.68,.53),"ease-out-quad":Nn(.25,.46,.45,.94),"ease-in-out-quad":Nn(.455,.03,.515,.955),"ease-in-cubic":Nn(.55,.055,.675,.19),"ease-out-cubic":Nn(.215,.61,.355,1),"ease-in-out-cubic":Nn(.645,.045,.355,1),"ease-in-quart":Nn(.895,.03,.685,.22),"ease-out-quart":Nn(.165,.84,.44,1),"ease-in-out-quart":Nn(.77,0,.175,1),"ease-in-quint":Nn(.755,.05,.855,.06),"ease-out-quint":Nn(.23,1,.32,1),"ease-in-out-quint":Nn(.86,0,.07,1),"ease-in-expo":Nn(.95,.05,.795,.035),"ease-out-expo":Nn(.19,1,.22,1),"ease-in-out-expo":Nn(1,0,0,1),"ease-in-circ":Nn(.6,.04,.98,.335),"ease-out-circ":Nn(.075,.82,.165,1),"ease-in-out-circ":Nn(.785,.135,.15,.86),spring:function(e,r,n){if(n===0)return Vy.linear;var i=Z7(e,r,n);return function(a,s,o){return a+(s-a)*i(o)}},"cubic-bezier":Nn};function RN(t,e,r,n,i){if(n===1||e===r)return r;var a=i(e,r,n);return t==null||((t.roundValue||t.color)&&(a=Math.round(a)),t.min!==void 0&&(a=Math.max(a,t.min)),t.max!==void 0&&(a=Math.min(a,t.max))),a}function ON(t,e){return t.pfValue!=null||t.value!=null?t.pfValue!=null&&(e==null||e.type.units!=="%")?t.pfValue:t.value:t}function hp(t,e,r,n,i){var a=i!=null?i.type:null;r<0?r=0:r>1&&(r=1);var s=ON(t,i),o=ON(e,i);if(_t(s)&&_t(o))return RN(a,s,o,r,n);if(Sn(s)&&Sn(o)){for(var l=[],u=0;u<o.length;u++){var c=s[u],f=o[u];if(c!=null&&f!=null){var p=RN(a,c,f,r,n);l.push(p)}else l.push(f)}return l}}function Y7(t,e,r,n){var i=!n,a=t._private,s=e._private,o=s.easing,l=s.startTime,u=n?t:t.cy(),c=u.style();if(!s.easingImpl)if(o==null)s.easingImpl=Vy.linear;else{var f;if(Yt(o)){var p=c.parse("transition-timing-function",o);f=p.value}else f=o;var g,y;Yt(f)?(g=f,y=[]):(g=f[1],y=f.slice(2).map(function(ie){return+ie})),y.length>0?(g==="spring"&&y.push(s.duration),s.easingImpl=Vy[g].apply(null,y)):s.easingImpl=Vy[g]}var S=s.easingImpl,w;if(s.duration===0?w=1:w=(r-l)/s.duration,s.applying&&(w=s.progress),w<0?w=0:w>1&&(w=1),s.delay==null){var C=s.startPosition,_=s.position;if(_&&i&&!t.locked()){var T={};qm(C.x,_.x)&&(T.x=hp(C.x,_.x,w,S)),qm(C.y,_.y)&&(T.y=hp(C.y,_.y,w,S)),t.position(T)}var N=s.startPan,R=s.pan,D=a.pan,j=R!=null&&n;j&&(qm(N.x,R.x)&&(D.x=hp(N.x,R.x,w,S)),qm(N.y,R.y)&&(D.y=hp(N.y,R.y,w,S)),t.emit("pan"));var O=s.startZoom,F=s.zoom,z=F!=null&&n;z&&(qm(O,F)&&(a.zoom=_v(a.minZoom,hp(O,F,w,S),a.maxZoom)),t.emit("zoom")),(j||z)&&t.emit("viewport");var G=s.style;if(G&&G.length>0&&i){for(var Z=0;Z<G.length;Z++){var I=G[Z],W=I.name,U=I,K=s.startStyle[W],$=c.properties[K.name],Q=hp(K,U,w,S,$);c.overrideBypass(t,W,Q)}t.emit("style")}}return s.progress=w,w}function qm(t,e){return t==null||e==null?!1:_t(t)&&_t(e)?!0:!!(t&&e)}function X7(t,e,r,n){var i=e._private;i.started=!0,i.startTime=r-i.progress*i.duration}function DN(t,e){var r=e._private.aniEles,n=[];function i(c,f){var p=c._private,g=p.animation.current,y=p.animation.queue,S=!1;if(g.length===0){var w=y.shift();w&&g.push(w)}for(var C=function(D){for(var j=D.length-1;j>=0;j--){var O=D[j];O()}D.splice(0,D.length)},_=g.length-1;_>=0;_--){var T=g[_],N=T._private;if(N.stopped){g.splice(_,1),N.hooked=!1,N.playing=!1,N.started=!1,C(N.frames);continue}!N.playing&&!N.applying||(N.playing&&N.applying&&(N.applying=!1),N.started||X7(c,T,t),Y7(c,T,t,f),N.applying&&(N.applying=!1),C(N.frames),N.step!=null&&N.step(t),T.completed()&&(g.splice(_,1),N.hooked=!1,N.playing=!1,N.started=!1,C(N.completes)),S=!0)}return!f&&g.length===0&&y.length===0&&n.push(c),S}for(var a=!1,s=0;s<r.length;s++){var o=r[s],l=i(o);a=a||l}var u=i(e,!0);(a||u)&&(r.length>0?e.notify("draw",r):e.notify("draw")),r.unmerge(n),e.emit("step")}var Q7={animate:nn.animate(),animation:nn.animation(),animated:nn.animated(),clearQueue:nn.clearQueue(),delay:nn.delay(),delayAnimation:nn.delayAnimation(),stop:nn.stop(),addToAnimationPool:function(e){var r=this;r.styleEnabled()&&r._private.aniEles.merge(e)},stopAnimationLoop:function(){this._private.animationsRunning=!1},startAnimationLoop:function(){var e=this;if(e._private.animationsRunning=!0,!e.styleEnabled())return;function r(){e._private.animationsRunning&&cx(function(a){DN(a,e),r()})}var n=e.renderer();n&&n.beforeRender?n.beforeRender(function(a,s){DN(s,e)},n.beforeRenderPriorities.animations):r()}},J7={qualifierCompare:function(e,r){return e==null||r==null?e==null&&r==null:e.sameText(r)},eventMatches:function(e,r,n){var i=r.qualifier;return i!=null?e!==n.target&&Xv(n.target)&&i.matches(n.target):!0},addEventFields:function(e,r){r.cy=e,r.target=e},callbackContext:function(e,r,n){return r.qualifier!=null?n.target:e}},ly=function(e){return Yt(e)?new Xd(e):e},zA={createEmitter:function(){var e=this._private;return e.emitter||(e.emitter=new D1(J7,this)),this},emitter:function(){return this._private.emitter},on:function(e,r,n){return this.emitter().on(e,ly(r),n),this},removeListener:function(e,r,n){return this.emitter().removeListener(e,ly(r),n),this},removeAllListeners:function(){return this.emitter().removeAllListeners(),this},one:function(e,r,n){return this.emitter().one(e,ly(r),n),this},once:function(e,r,n){return this.emitter().one(e,ly(r),n),this},emit:function(e,r){return this.emitter().emit(e,r),this},emitAndNotify:function(e,r){return this.emit(e),this.notify(e,r),this}};nn.eventAliasesOn(zA);var ZS={png:function(e){var r=this._private.renderer;return e=e||{},r.png(e)},jpg:function(e){var r=this._private.renderer;return e=e||{},e.bg=e.bg||"#fff",r.jpg(e)}};ZS.jpeg=ZS.jpg;var Hy={layout:function(e){var r=this;if(e==null){Zn("Layout options must be specified to make a layout");return}if(e.name==null){Zn("A `name` must be specified to make a layout");return}var n=e.name,i=r.extension("layout",n);if(i==null){Zn("No such layout `"+n+"` found.  Did you forget to import it and `cytoscape.use()` it?");return}var a;Yt(e.eles)?a=r.$(e.eles):a=e.eles!=null?e.eles:r.$();var s=new i(sr({},e,{cy:r,eles:a}));return s}};Hy.createLayout=Hy.makeLayout=Hy.layout;var ez={notify:function(e,r){var n=this._private;if(this.batching()){n.batchNotifications=n.batchNotifications||{};var i=n.batchNotifications[e]=n.batchNotifications[e]||this.collection();r!=null&&i.merge(r);return}if(n.notificationsEnabled){var a=this.renderer();this.destroyed()||!a||a.notify(e,r)}},notifications:function(e){var r=this._private;return e===void 0?r.notificationsEnabled:(r.notificationsEnabled=!!e,this)},noNotifications:function(e){this.notifications(!1),e(),this.notifications(!0)},batching:function(){return this._private.batchCount>0},startBatch:function(){var e=this._private;return e.batchCount==null&&(e.batchCount=0),e.batchCount===0&&(e.batchStyleEles=this.collection(),e.batchNotifications={}),e.batchCount++,this},endBatch:function(){var e=this._private;if(e.batchCount===0)return this;if(e.batchCount--,e.batchCount===0){e.batchStyleEles.updateStyle();var r=this.renderer();Object.keys(e.batchNotifications).forEach(function(n){var i=e.batchNotifications[n];i.empty()?r.notify(n):r.notify(n,i)})}return this},batch:function(e){return this.startBatch(),e(),this.endBatch(),this},batchData:function(e){var r=this;return this.batch(function(){for(var n=Object.keys(e),i=0;i<n.length;i++){var a=n[i],s=e[a],o=r.getElementById(a);o.data(s)}})}},tz=Ha({hideEdgesOnViewport:!1,textureOnViewport:!1,motionBlur:!1,motionBlurOpacity:.05,pixelRatio:void 0,desktopTapThreshold:4,touchTapThreshold:8,wheelSensitivity:1,debug:!1,showFps:!1,webgl:!1,webglDebug:!1,webglDebugShowAtlases:!1,webglTexSize:2048,webglTexRows:36,webglTexRowsNodes:18,webglBatchSize:2048,webglTexPerBatch:14,webglBgColor:[255,255,255]}),YS={renderTo:function(e,r,n,i){var a=this._private.renderer;return a.renderTo(e,r,n,i),this},renderer:function(){return this._private.renderer},forceRender:function(){return this.notify("draw"),this},resize:function(){return this.invalidateSize(),this.emitAndNotify("resize"),this},initRenderer:function(e){var r=this,n=r.extension("renderer",e.name);if(n==null){Zn("Can not initialise: No such renderer `".concat(e.name,"` found. Did you forget to import it and `cytoscape.use()` it?"));return}e.wheelSensitivity!==void 0&&an("You have set a custom wheel sensitivity.  This will make your app zoom unnaturally when using mainstream mice.  You should change this value from the default only if you can guarantee that all your users will use the same hardware and OS configuration as your current machine.");var i=tz(e);i.cy=r,r._private.renderer=new n(i),this.notify("init")},destroyRenderer:function(){var e=this;e.notify("destroy");var r=e.container();if(r)for(r._cyreg=null;r.childNodes.length>0;)r.removeChild(r.childNodes[0]);e._private.renderer=null,e.mutableElements().forEach(function(n){var i=n._private;i.rscratch={},i.rstyle={},i.animation.current=[],i.animation.queue=[]})},onRender:function(e){return this.on("render",e)},offRender:function(e){return this.off("render",e)}};YS.invalidateDimensions=YS.resize;var Wy={collection:function(e,r){return Yt(e)?this.$(e):vo(e)?e.collection():Sn(e)?(r||(r={}),new za(this,e,r.unique,r.removed)):new za(this)},nodes:function(e){var r=this.$(function(n){return n.isNode()});return e?r.filter(e):r},edges:function(e){var r=this.$(function(n){return n.isEdge()});return e?r.filter(e):r},$:function(e){var r=this._private.elements;return e?r.filter(e):r.spawnSelf()},mutableElements:function(){return this._private.elements}};Wy.elements=Wy.filter=Wy.$;var ya={},tv="t",rz="f";ya.apply=function(t){for(var e=this,r=e._private,n=r.cy,i=n.collection(),a=0;a<t.length;a++){var s=t[a],o=e.getContextMeta(s);if(!o.empty){var l=e.getContextStyle(o),u=e.applyContextStyle(o,l,s);s._private.appliedInitStyle?e.updateTransitions(s,u.diffProps):s._private.appliedInitStyle=!0;var c=e.updateStyleHints(s);c&&i.push(s)}}return i};ya.getPropertiesDiff=function(t,e){var r=this,n=r._private.propDiffs=r._private.propDiffs||{},i=t+"-"+e,a=n[i];if(a)return a;for(var s=[],o={},l=0;l<r.length;l++){var u=r[l],c=t[l]===tv,f=e[l]===tv,p=c!==f,g=u.mappedProperties.length>0;if(p||f&&g){var y=void 0;p&&g||p?y=u.properties:g&&(y=u.mappedProperties);for(var S=0;S<y.length;S++){for(var w=y[S],C=w.name,_=!1,T=l+1;T<r.length;T++){var N=r[T],R=e[T]===tv;if(R&&(_=N.properties[w.name]!=null,_))break}!o[C]&&!_&&(o[C]=!0,s.push(C))}}}return n[i]=s,s};ya.getContextMeta=function(t){for(var e=this,r="",n,i=t._private.styleCxtKey||"",a=0;a<e.length;a++){var s=e[a],o=s.selector&&s.selector.matches(t);o?r+=tv:r+=rz}return n=e.getPropertiesDiff(i,r),t._private.styleCxtKey=r,{key:r,diffPropNames:n,empty:n.length===0}};ya.getContextStyle=function(t){var e=t.key,r=this,n=this._private.contextStyles=this._private.contextStyles||{};if(n[e])return n[e];for(var i={_private:{key:e}},a=0;a<r.length;a++){var s=r[a],o=e[a]===tv;if(o)for(var l=0;l<s.properties.length;l++){var u=s.properties[l];i[u.name]=u}}return n[e]=i,i};ya.applyContextStyle=function(t,e,r){for(var n=this,i=t.diffPropNames,a={},s=n.types,o=0;o<i.length;o++){var l=i[o],u=e[l],c=r.pstyle(l);if(!u)if(c)c.bypass?u={name:l,deleteBypassed:!0}:u={name:l,delete:!0};else continue;if(c!==u){if(u.mapped===s.fn&&c!=null&&c.mapping!=null&&c.mapping.value===u.value){var f=c.mapping,p=f.fnValue=u.value(r);if(p===f.prevFnValue)continue}var g=a[l]={prev:c};n.applyParsedProperty(r,u),g.next=r.pstyle(l),g.next&&g.next.bypass&&(g.next=g.next.bypassed)}}return{diffProps:a}};ya.updateStyleHints=function(t){var e=t._private,r=this,n=r.propertyGroupNames,i=r.propertyGroupKeys,a=function(xe,Se,Ae){return r.getPropertiesHash(xe,Se,Ae)},s=e.styleKey;if(t.removed())return!1;var o=e.group==="nodes",l=t._private.style;n=Object.keys(l);for(var u=0;u<i.length;u++){var c=i[u];e.styleKeys[c]=[Xf,_p]}for(var f=function(xe,Se){return e.styleKeys[Se][0]=wv(xe,e.styleKeys[Se][0])},p=function(xe,Se){return e.styleKeys[Se][1]=Sv(xe,e.styleKeys[Se][1])},g=function(xe,Se){f(xe,Se),p(xe,Se)},y=function(xe,Se){for(var Ae=0;Ae<xe.length;Ae++){var Me=xe.charCodeAt(Ae);f(Me,Se),p(Me,Se)}},S=2e9,w=function(xe){return-128<xe&&xe<128&&Math.floor(xe)!==xe?S-(xe*1024|0):xe},C=0;C<n.length;C++){var _=n[C],T=l[_];if(T!=null){var N=this.properties[_],R=N.type,D=N.groupKey,j=void 0;N.hashOverride!=null?j=N.hashOverride(t,T):T.pfValue!=null&&(j=T.pfValue);var O=N.enums==null?T.value:null,F=j!=null,z=O!=null,G=F||z,Z=T.units;if(R.number&&G&&!R.multiple){var I=F?j:O;g(w(I),D),!F&&Z!=null&&y(Z,D)}else y(T.strValue,D)}}for(var W=[Xf,_p],U=0;U<i.length;U++){var K=i[U],$=e.styleKeys[K];W[0]=wv($[0],W[0]),W[1]=Sv($[1],W[1])}e.styleKey=y9(W[0],W[1]);var Q=e.styleKeys;e.labelDimsKey=vd(Q.labelDimensions);var ie=a(t,["label"],Q.labelDimensions);if(e.labelKey=vd(ie),e.labelStyleKey=vd(ey(Q.commonLabel,ie)),!o){var te=a(t,["source-label"],Q.labelDimensions);e.sourceLabelKey=vd(te),e.sourceLabelStyleKey=vd(ey(Q.commonLabel,te));var X=a(t,["target-label"],Q.labelDimensions);e.targetLabelKey=vd(X),e.targetLabelStyleKey=vd(ey(Q.commonLabel,X))}if(o){var re=e.styleKeys,fe=re.nodeBody,oe=re.nodeBorder,se=re.nodeOutline,he=re.backgroundImage,ae=re.compound,pe=re.pie,ye=re.stripe,ve=[fe,oe,se,he,ae,pe,ye].filter(function(ue){return ue!=null}).reduce(ey,[Xf,_p]);e.nodeKey=vd(ve),e.hasPie=pe!=null&&pe[0]!==Xf&&pe[1]!==_p,e.hasStripe=ye!=null&&ye[0]!==Xf&&ye[1]!==_p}return s!==e.styleKey};ya.clearStyleHints=function(t){var e=t._private;e.styleCxtKey="",e.styleKeys={},e.styleKey=null,e.labelKey=null,e.labelStyleKey=null,e.sourceLabelKey=null,e.sourceLabelStyleKey=null,e.targetLabelKey=null,e.targetLabelStyleKey=null,e.nodeKey=null,e.hasPie=null,e.hasStripe=null};ya.applyParsedProperty=function(t,e){var r=this,n=e,i=t._private.style,a,s=r.types,o=r.properties[n.name].type,l=n.bypass,u=i[n.name],c=u&&u.bypass,f=t._private,p="mapping",g=function(fe){return fe==null?null:fe.pfValue!=null?fe.pfValue:fe.value},y=function(){var fe=g(u),oe=g(n);r.checkTriggers(t,n.name,fe,oe)};if(e.name==="curve-style"&&t.isEdge()&&(e.value!=="bezier"&&t.isLoop()||e.value==="haystack"&&(t.source().isParent()||t.target().isParent()))&&(n=e=this.parse(e.name,"bezier",l)),n.delete)return i[n.name]=void 0,y(),!0;if(n.deleteBypassed)return u?u.bypass?(u.bypassed=void 0,y(),!0):!1:(y(),!0);if(n.deleteBypass)return u?u.bypass?(i[n.name]=u.bypassed,y(),!0):!1:(y(),!0);var S=function(){an("Do not assign mappings to elements without corresponding data (i.e. ele `"+t.id()+"` has no mapping for property `"+n.name+"` with data field `"+n.field+"`); try a `["+n.field+"]` selector to limit scope to elements with `"+n.field+"` defined")};switch(n.mapped){case s.mapData:{for(var w=n.field.split("."),C=f.data,_=0;_<w.length&&C;_++){var T=w[_];C=C[T]}if(C==null)return S(),!1;var N;if(_t(C)){var R=n.fieldMax-n.fieldMin;R===0?N=0:N=(C-n.fieldMin)/R}else return an("Do not use continuous mappers without specifying numeric data (i.e. `"+n.field+": "+C+"` for `"+t.id()+"` is non-numeric)"),!1;if(N<0?N=0:N>1&&(N=1),o.color){var D=n.valueMin[0],j=n.valueMax[0],O=n.valueMin[1],F=n.valueMax[1],z=n.valueMin[2],G=n.valueMax[2],Z=n.valueMin[3]==null?1:n.valueMin[3],I=n.valueMax[3]==null?1:n.valueMax[3],W=[Math.round(D+(j-D)*N),Math.round(O+(F-O)*N),Math.round(z+(G-z)*N),Math.round(Z+(I-Z)*N)];a={bypass:n.bypass,name:n.name,value:W,strValue:"rgb("+W[0]+", "+W[1]+", "+W[2]+")"}}else if(o.number){var U=n.valueMin+(n.valueMax-n.valueMin)*N;a=this.parse(n.name,U,n.bypass,p)}else return!1;if(!a)return S(),!1;a.mapping=n,n=a;break}case s.data:{for(var K=n.field.split("."),$=f.data,Q=0;Q<K.length&&$;Q++){var ie=K[Q];$=$[ie]}if($!=null&&(a=this.parse(n.name,$,n.bypass,p)),!a)return S(),!1;a.mapping=n,n=a;break}case s.fn:{var te=n.value,X=n.fnValue!=null?n.fnValue:te(t);if(n.prevFnValue=X,X==null)return an("Custom function mappers may not return null (i.e. `"+n.name+"` for ele `"+t.id()+"` is null)"),!1;if(a=this.parse(n.name,X,n.bypass,p),!a)return an("Custom function mappers may not return invalid values for the property type (i.e. `"+n.name+"` for ele `"+t.id()+"` is invalid)"),!1;a.mapping=_u(n),n=a;break}case void 0:break;default:return!1}return l?(c?n.bypassed=u.bypassed:n.bypassed=u,i[n.name]=n):c?u.bypassed=n:i[n.name]=n,y(),!0};ya.cleanElements=function(t,e){for(var r=0;r<t.length;r++){var n=t[r];if(this.clearStyleHints(n),n.dirtyCompoundBoundsCache(),n.dirtyBoundingBoxCache(),!e)n._private.style={};else for(var i=n._private.style,a=Object.keys(i),s=0;s<a.length;s++){var o=a[s],l=i[o];l!=null&&(l.bypass?l.bypassed=null:i[o]=null)}}};ya.update=function(){var t=this._private.cy,e=t.mutableElements();e.updateStyle()};ya.updateTransitions=function(t,e){var r=this,n=t._private,i=t.pstyle("transition-property").value,a=t.pstyle("transition-duration").pfValue,s=t.pstyle("transition-delay").pfValue;if(i.length>0&&a>0){for(var o={},l=!1,u=0;u<i.length;u++){var c=i[u],f=t.pstyle(c),p=e[c];if(p){var g=p.prev,y=g,S=p.next!=null?p.next:f,w=!1,C=void 0,_=1e-6;y&&(_t(y.pfValue)&&_t(S.pfValue)?(w=S.pfValue-y.pfValue,C=y.pfValue+_*w):_t(y.value)&&_t(S.value)?(w=S.value-y.value,C=y.value+_*w):Sn(y.value)&&Sn(S.value)&&(w=y.value[0]!==S.value[0]||y.value[1]!==S.value[1]||y.value[2]!==S.value[2],C=y.strValue),w&&(o[c]=S.strValue,this.applyBypass(t,c,C),l=!0))}}if(!l)return;n.transitioning=!0,new um(function(T){s>0?t.delayAnimation(s).play().promise().then(T):T()}).then(function(){return t.animation({style:o,duration:a,easing:t.pstyle("transition-timing-function").value,queue:!1}).play().promise()}).then(function(){r.removeBypasses(t,i),t.emitAndNotify("style"),n.transitioning=!1})}else n.transitioning&&(this.removeBypasses(t,i),t.emitAndNotify("style"),n.transitioning=!1)};ya.checkTrigger=function(t,e,r,n,i,a){var s=this.properties[e],o=i(s);t.removed()||o!=null&&o(r,n,t)&&a(s)};ya.checkZOrderTrigger=function(t,e,r,n){var i=this;this.checkTrigger(t,e,r,n,function(a){return a.triggersZOrder},function(){i._private.cy.notify("zorder",t)})};ya.checkBoundsTrigger=function(t,e,r,n){this.checkTrigger(t,e,r,n,function(i){return i.triggersBounds},function(i){t.dirtyCompoundBoundsCache(),t.dirtyBoundingBoxCache()})};ya.checkConnectedEdgesBoundsTrigger=function(t,e,r,n){this.checkTrigger(t,e,r,n,function(i){return i.triggersBoundsOfConnectedEdges},function(i){t.connectedEdges().forEach(function(a){a.dirtyBoundingBoxCache()})})};ya.checkParallelEdgesBoundsTrigger=function(t,e,r,n){this.checkTrigger(t,e,r,n,function(i){return i.triggersBoundsOfParallelEdges},function(i){t.parallelEdges().forEach(function(a){a.dirtyBoundingBoxCache()})})};ya.checkTriggers=function(t,e,r,n){t.dirtyStyleCache(),this.checkZOrderTrigger(t,e,r,n),this.checkBoundsTrigger(t,e,r,n),this.checkConnectedEdgesBoundsTrigger(t,e,r,n),this.checkParallelEdgesBoundsTrigger(t,e,r,n)};var i0={};i0.applyBypass=function(t,e,r,n){var i=this,a=[],s=!0;if(e==="*"||e==="**"){if(r!==void 0)for(var o=0;o<i.properties.length;o++){var l=i.properties[o],u=l.name,c=this.parse(u,r,!0);c&&a.push(c)}}else if(Yt(e)){var f=this.parse(e,r,!0);f&&a.push(f)}else if(Wr(e)){var p=e;n=r;for(var g=Object.keys(p),y=0;y<g.length;y++){var S=g[y],w=p[S];if(w===void 0&&(w=p[C1(S)]),w!==void 0){var C=this.parse(S,w,!0);C&&a.push(C)}}}else return!1;if(a.length===0)return!1;for(var _=!1,T=0;T<t.length;T++){for(var N=t[T],R={},D=void 0,j=0;j<a.length;j++){var O=a[j];if(n){var F=N.pstyle(O.name);D=R[O.name]={prev:F}}_=this.applyParsedProperty(N,_u(O))||_,n&&(D.next=N.pstyle(O.name))}_&&this.updateStyleHints(N),n&&this.updateTransitions(N,R,s)}return _};i0.overrideBypass=function(t,e,r){e=i_(e);for(var n=0;n<t.length;n++){var i=t[n],a=i._private.style[e],s=this.properties[e].type,o=s.color,l=s.mutiple,u=a?a.pfValue!=null?a.pfValue:a.value:null;!a||!a.bypass?this.applyBypass(i,e,r):(a.value=r,a.pfValue!=null&&(a.pfValue=r),o?a.strValue="rgb("+r.join(",")+")":l?a.strValue=r.join(" "):a.strValue=""+r,this.updateStyleHints(i)),this.checkTriggers(i,e,u,r)}};i0.removeAllBypasses=function(t,e){return this.removeBypasses(t,this.propertyNames,e)};i0.removeBypasses=function(t,e,r){for(var n=!0,i=0;i<t.length;i++){for(var a=t[i],s={},o=0;o<e.length;o++){var l=e[o],u=this.properties[l],c=a.pstyle(u.name);if(!(!c||!c.bypass)){var f="",p=this.parse(l,f,!0),g=s[u.name]={prev:c};this.applyParsedProperty(a,p),g.next=a.pstyle(u.name)}}this.updateStyleHints(a),r&&this.updateTransitions(a,s,n)}};var x_={};x_.getEmSizeInPixels=function(){var t=this.containerCss("font-size");return t!=null?parseFloat(t):1};x_.containerCss=function(t){var e=this._private.cy,r=e.container(),n=e.window();if(n&&r&&n.getComputedStyle)return n.getComputedStyle(r).getPropertyValue(t)};var Nu={};Nu.getRenderedStyle=function(t,e){return e?this.getStylePropertyValue(t,e,!0):this.getRawStyle(t,!0)};Nu.getRawStyle=function(t,e){var r=this;if(t=t[0],t){for(var n={},i=0;i<r.properties.length;i++){var a=r.properties[i],s=r.getStylePropertyValue(t,a.name,e);s!=null&&(n[a.name]=s,n[C1(a.name)]=s)}return n}};Nu.getIndexedStyle=function(t,e,r,n){var i=t.pstyle(e)[r][n];return i??t.cy().style().getDefaultProperty(e)[r][0]};Nu.getStylePropertyValue=function(t,e,r){var n=this;if(t=t[0],t){var i=n.properties[e];i.alias&&(i=i.pointsTo);var a=i.type,s=t.pstyle(i.name);if(s){var o=s.value,l=s.units,u=s.strValue;if(r&&a.number&&o!=null&&_t(o)){var c=t.cy().zoom(),f=function(w){return w*c},p=function(w,C){return f(w)+C},g=Sn(o),y=g?l.every(function(S){return S!=null}):l!=null;return y?g?o.map(function(S,w){return p(S,l[w])}).join(" "):p(o,l):g?o.map(function(S){return Yt(S)?S:""+f(S)}).join(" "):""+f(o)}else if(u!=null)return u}return null}};Nu.getAnimationStartStyle=function(t,e){for(var r={},n=0;n<e.length;n++){var i=e[n],a=i.name,s=t.pstyle(a);s!==void 0&&(Wr(s)?s=this.parse(a,s.strValue):s=this.parse(a,s)),s&&(r[a]=s)}return r};Nu.getPropsList=function(t){var e=this,r=[],n=t,i=e.properties;if(n)for(var a=Object.keys(n),s=0;s<a.length;s++){var o=a[s],l=n[o],u=i[o]||i[i_(o)],c=this.parse(u.name,l);c&&r.push(c)}return r};Nu.getNonDefaultPropertiesHash=function(t,e,r){var n=r.slice(),i,a,s,o,l,u;for(l=0;l<e.length;l++)if(i=e[l],a=t.pstyle(i,!1),a!=null)if(a.pfValue!=null)n[0]=wv(o,n[0]),n[1]=Sv(o,n[1]);else for(s=a.strValue,u=0;u<s.length;u++)o=s.charCodeAt(u),n[0]=wv(o,n[0]),n[1]=Sv(o,n[1]);return n};Nu.getPropertiesHash=Nu.getNonDefaultPropertiesHash;var F1={};F1.appendFromJson=function(t){for(var e=this,r=0;r<t.length;r++){var n=t[r],i=n.selector,a=n.style||n.css,s=Object.keys(a);e.selector(i);for(var o=0;o<s.length;o++){var l=s[o],u=a[l];e.css(l,u)}}return e};F1.fromJson=function(t){var e=this;return e.resetToDefault(),e.appendFromJson(t),e};F1.json=function(){for(var t=[],e=this.defaultLength;e<this.length;e++){for(var r=this[e],n=r.selector,i=r.properties,a={},s=0;s<i.length;s++){var o=i[s];a[o.name]=o.strValue}t.push({selector:n?n.toString():"core",style:a})}return t};var b_={};b_.appendFromString=function(t){var e=this,r=this,n=""+t,i,a,s;n=n.replace(/[/][*](\s|.)+?[*][/]/g,"");function o(){n.length>i.length?n=n.substr(i.length):n=""}function l(){a.length>s.length?a=a.substr(s.length):a=""}for(;;){var u=n.match(/^\s*$/);if(u)break;var c=n.match(/^\s*((?:.|\s)+?)\s*\{((?:.|\s)+?)\}/);if(!c){an("Halting stylesheet parsing: String stylesheet contains more to parse but no selector and block found in: "+n);break}i=c[0];var f=c[1];if(f!=="core"){var p=new Xd(f);if(p.invalid){an("Skipping parsing of block: Invalid selector found in string stylesheet: "+f),o();continue}}var g=c[2],y=!1;a=g;for(var S=[];;){var w=a.match(/^\s*$/);if(w)break;var C=a.match(/^\s*(.+?)\s*:\s*(.+?)(?:\s*;|\s*$)/);if(!C){an("Skipping parsing of block: Invalid formatting of style property and value definitions found in:"+g),y=!0;break}s=C[0];var _=C[1],T=C[2],N=e.properties[_];if(!N){an("Skipping property: Invalid property name in: "+s),l();continue}var R=r.parse(_,T);if(!R){an("Skipping property: Invalid property definition in: "+s),l();continue}S.push({name:_,val:T}),l()}if(y){o();break}r.selector(f);for(var D=0;D<S.length;D++){var j=S[D];r.css(j.name,j.val)}o()}return r};b_.fromString=function(t){var e=this;return e.resetToDefault(),e.appendFromString(t),e};var Oi={};(function(){var t=Wi,e=Yj,r=Qj,n=Jj,i=e9,a=function(ue){return"^"+ue+"\\s*\\(\\s*([\\w\\.]+)\\s*\\)$"},s=function(ue){var xe=t+"|\\w+|"+e+"|"+r+"|"+n+"|"+i;return"^"+ue+"\\s*\\(([\\w\\.]+)\\s*\\,\\s*("+t+")\\s*\\,\\s*("+t+")\\s*,\\s*("+xe+")\\s*\\,\\s*("+xe+")\\)$"},o=[`^url\\s*\\(\\s*['"]?(.+?)['"]?\\s*\\)$`,"^(none)$","^(.+)$"];Oi.types={time:{number:!0,min:0,units:"s|ms",implicitUnits:"ms"},percent:{number:!0,min:0,max:100,units:"%",implicitUnits:"%"},percentages:{number:!0,min:0,max:100,units:"%",implicitUnits:"%",multiple:!0},zeroOneNumber:{number:!0,min:0,max:1,unitless:!0},zeroOneNumbers:{number:!0,min:0,max:1,unitless:!0,multiple:!0},nOneOneNumber:{number:!0,min:-1,max:1,unitless:!0},nonNegativeInt:{number:!0,min:0,integer:!0,unitless:!0},nonNegativeNumber:{number:!0,min:0,unitless:!0},position:{enums:["parent","origin"]},nodeSize:{number:!0,min:0,enums:["label"]},number:{number:!0,unitless:!0},numbers:{number:!0,unitless:!0,multiple:!0},positiveNumber:{number:!0,unitless:!0,min:0,strictMin:!0},size:{number:!0,min:0},bidirectionalSize:{number:!0},bidirectionalSizeMaybePercent:{number:!0,allowPercent:!0},bidirectionalSizes:{number:!0,multiple:!0},sizeMaybePercent:{number:!0,min:0,allowPercent:!0},axisDirection:{enums:["horizontal","leftward","rightward","vertical","upward","downward","auto"]},axisDirectionExplicit:{enums:["leftward","rightward","upward","downward"]},axisDirectionPrimary:{enums:["horizontal","vertical"]},paddingRelativeTo:{enums:["width","height","average","min","max"]},bgWH:{number:!0,min:0,allowPercent:!0,enums:["auto"],multiple:!0},bgPos:{number:!0,allowPercent:!0,multiple:!0},bgRelativeTo:{enums:["inner","include-padding"],multiple:!0},bgRepeat:{enums:["repeat","repeat-x","repeat-y","no-repeat"],multiple:!0},bgFit:{enums:["none","contain","cover"],multiple:!0},bgCrossOrigin:{enums:["anonymous","use-credentials","null"],multiple:!0},bgClip:{enums:["none","node"],multiple:!0},bgContainment:{enums:["inside","over"],multiple:!0},boxSelection:{enums:["contain","overlap","none"]},color:{color:!0},colors:{color:!0,multiple:!0},fill:{enums:["solid","linear-gradient","radial-gradient"]},bool:{enums:["yes","no"]},bools:{enums:["yes","no"],multiple:!0},lineStyle:{enums:["solid","dotted","dashed"]},lineCap:{enums:["butt","round","square"]},linePosition:{enums:["center","inside","outside"]},lineJoin:{enums:["round","bevel","miter"]},borderStyle:{enums:["solid","dotted","dashed","double"]},curveStyle:{enums:["bezier","unbundled-bezier","haystack","segments","straight","straight-triangle","taxi","round-segments","round-taxi"]},radiusType:{enums:["arc-radius","influence-radius"],multiple:!0},fontFamily:{regex:'^([\\w- \\"]+(?:\\s*,\\s*[\\w- \\"]+)*)$'},fontStyle:{enums:["italic","normal","oblique"]},fontWeight:{enums:["normal","bold","bolder","lighter","100","200","300","400","500","600","800","900",100,200,300,400,500,600,700,800,900]},textDecoration:{enums:["none","underline","overline","line-through"]},textTransform:{enums:["none","uppercase","lowercase"]},textWrap:{enums:["none","wrap","ellipsis"]},textOverflowWrap:{enums:["whitespace","anywhere"]},textBackgroundShape:{enums:["rectangle","roundrectangle","round-rectangle","circle"]},nodeShape:{enums:["rectangle","roundrectangle","round-rectangle","cutrectangle","cut-rectangle","bottomroundrectangle","bottom-round-rectangle","barrel","ellipse","triangle","round-triangle","square","pentagon","round-pentagon","hexagon","round-hexagon","concavehexagon","concave-hexagon","heptagon","round-heptagon","octagon","round-octagon","tag","round-tag","star","diamond","round-diamond","vee","rhomboid","right-rhomboid","polygon"]},overlayShape:{enums:["roundrectangle","round-rectangle","ellipse"]},cornerRadius:{number:!0,min:0,units:"px|em",implicitUnits:"px",enums:["auto"]},compoundIncludeLabels:{enums:["include","exclude"]},arrowShape:{enums:["tee","triangle","triangle-tee","circle-triangle","triangle-cross","triangle-backcurve","vee","square","circle","diamond","chevron","none"]},arrowFill:{enums:["filled","hollow"]},arrowWidth:{number:!0,units:"%|px|em",implicitUnits:"px",enums:["match-line"]},display:{enums:["element","none"]},visibility:{enums:["hidden","visible"]},zCompoundDepth:{enums:["bottom","orphan","auto","top"]},zIndexCompare:{enums:["auto","manual"]},valign:{enums:["top","center","bottom"]},halign:{enums:["left","center","right"]},justification:{enums:["left","center","right","auto"]},text:{string:!0},data:{mapping:!0,regex:a("data")},layoutData:{mapping:!0,regex:a("layoutData")},scratch:{mapping:!0,regex:a("scratch")},mapData:{mapping:!0,regex:s("mapData")},mapLayoutData:{mapping:!0,regex:s("mapLayoutData")},mapScratch:{mapping:!0,regex:s("mapScratch")},fn:{mapping:!0,fn:!0},url:{regexes:o,singleRegexMatchValue:!0},urls:{regexes:o,singleRegexMatchValue:!0,multiple:!0},propList:{propList:!0},angle:{number:!0,units:"deg|rad",implicitUnits:"rad"},textRotation:{number:!0,units:"deg|rad",implicitUnits:"rad",enums:["none","autorotate"]},polygonPointList:{number:!0,multiple:!0,evenMultiple:!0,min:-1,max:1,unitless:!0},edgeDistances:{enums:["intersection","node-position","endpoints"]},edgeEndpoint:{number:!0,multiple:!0,units:"%|px|em|deg|rad",implicitUnits:"px",enums:["inside-to-node","outside-to-node","outside-to-node-or-label","outside-to-line","outside-to-line-or-label"],singleEnum:!0,validate:function(ue,xe){switch(ue.length){case 2:return xe[0]!=="deg"&&xe[0]!=="rad"&&xe[1]!=="deg"&&xe[1]!=="rad";case 1:return Yt(ue[0])||xe[0]==="deg"||xe[0]==="rad";default:return!1}}},easing:{regexes:["^(spring)\\s*\\(\\s*("+t+")\\s*,\\s*("+t+")\\s*\\)$","^(cubic-bezier)\\s*\\(\\s*("+t+")\\s*,\\s*("+t+")\\s*,\\s*("+t+")\\s*,\\s*("+t+")\\s*\\)$"],enums:["linear","ease","ease-in","ease-out","ease-in-out","ease-in-sine","ease-out-sine","ease-in-out-sine","ease-in-quad","ease-out-quad","ease-in-out-quad","ease-in-cubic","ease-out-cubic","ease-in-out-cubic","ease-in-quart","ease-out-quart","ease-in-out-quart","ease-in-quint","ease-out-quint","ease-in-out-quint","ease-in-expo","ease-out-expo","ease-in-out-expo","ease-in-circ","ease-out-circ","ease-in-out-circ"]},gradientDirection:{enums:["to-bottom","to-top","to-left","to-right","to-bottom-right","to-bottom-left","to-top-right","to-top-left","to-right-bottom","to-left-bottom","to-right-top","to-left-top"]},boundsExpansion:{number:!0,multiple:!0,min:0,validate:function(ue){var xe=ue.length;return xe===1||xe===2||xe===4}}};var l={zeroNonZero:function(ue,xe){return(ue==null||xe==null)&&ue!==xe||ue==0&&xe!=0?!0:ue!=0&&xe==0},any:function(ue,xe){return ue!=xe},emptyNonEmpty:function(ue,xe){var Se=Kd(ue),Ae=Kd(xe);return Se&&!Ae||!Se&&Ae}},u=Oi.types,c=[{name:"label",type:u.text,triggersBounds:l.any,triggersZOrder:l.emptyNonEmpty},{name:"text-rotation",type:u.textRotation,triggersBounds:l.any},{name:"text-margin-x",type:u.bidirectionalSize,triggersBounds:l.any},{name:"text-margin-y",type:u.bidirectionalSize,triggersBounds:l.any}],f=[{name:"source-label",type:u.text,triggersBounds:l.any},{name:"source-text-rotation",type:u.textRotation,triggersBounds:l.any},{name:"source-text-margin-x",type:u.bidirectionalSize,triggersBounds:l.any},{name:"source-text-margin-y",type:u.bidirectionalSize,triggersBounds:l.any},{name:"source-text-offset",type:u.size,triggersBounds:l.any}],p=[{name:"target-label",type:u.text,triggersBounds:l.any},{name:"target-text-rotation",type:u.textRotation,triggersBounds:l.any},{name:"target-text-margin-x",type:u.bidirectionalSize,triggersBounds:l.any},{name:"target-text-margin-y",type:u.bidirectionalSize,triggersBounds:l.any},{name:"target-text-offset",type:u.size,triggersBounds:l.any}],g=[{name:"font-family",type:u.fontFamily,triggersBounds:l.any},{name:"font-style",type:u.fontStyle,triggersBounds:l.any},{name:"font-weight",type:u.fontWeight,triggersBounds:l.any},{name:"font-size",type:u.size,triggersBounds:l.any},{name:"text-transform",type:u.textTransform,triggersBounds:l.any},{name:"text-wrap",type:u.textWrap,triggersBounds:l.any},{name:"text-overflow-wrap",type:u.textOverflowWrap,triggersBounds:l.any},{name:"text-max-width",type:u.size,triggersBounds:l.any},{name:"text-outline-width",type:u.size,triggersBounds:l.any},{name:"line-height",type:u.positiveNumber,triggersBounds:l.any}],y=[{name:"text-valign",type:u.valign,triggersBounds:l.any},{name:"text-halign",type:u.halign,triggersBounds:l.any},{name:"color",type:u.color},{name:"text-outline-color",type:u.color},{name:"text-outline-opacity",type:u.zeroOneNumber},{name:"text-background-color",type:u.color},{name:"text-background-opacity",type:u.zeroOneNumber},{name:"text-background-padding",type:u.size,triggersBounds:l.any},{name:"text-border-opacity",type:u.zeroOneNumber},{name:"text-border-color",type:u.color},{name:"text-border-width",type:u.size,triggersBounds:l.any},{name:"text-border-style",type:u.borderStyle,triggersBounds:l.any},{name:"text-background-shape",type:u.textBackgroundShape,triggersBounds:l.any},{name:"text-justification",type:u.justification},{name:"box-select-labels",type:u.bool,triggersBounds:l.any}],S=[{name:"events",type:u.bool,triggersZOrder:l.any},{name:"text-events",type:u.bool,triggersZOrder:l.any},{name:"box-selection",type:u.boxSelection,triggersZOrder:l.any}],w=[{name:"display",type:u.display,triggersZOrder:l.any,triggersBounds:l.any,triggersBoundsOfConnectedEdges:l.any,triggersBoundsOfParallelEdges:function(ue,xe,Se){return ue===xe?!1:Se.pstyle("curve-style").value==="bezier"}},{name:"visibility",type:u.visibility,triggersZOrder:l.any},{name:"opacity",type:u.zeroOneNumber,triggersZOrder:l.zeroNonZero},{name:"text-opacity",type:u.zeroOneNumber},{name:"min-zoomed-font-size",type:u.size},{name:"z-compound-depth",type:u.zCompoundDepth,triggersZOrder:l.any},{name:"z-index-compare",type:u.zIndexCompare,triggersZOrder:l.any},{name:"z-index",type:u.number,triggersZOrder:l.any}],C=[{name:"overlay-padding",type:u.size,triggersBounds:l.any},{name:"overlay-color",type:u.color},{name:"overlay-opacity",type:u.zeroOneNumber,triggersBounds:l.zeroNonZero},{name:"overlay-shape",type:u.overlayShape,triggersBounds:l.any},{name:"overlay-corner-radius",type:u.cornerRadius}],_=[{name:"underlay-padding",type:u.size,triggersBounds:l.any},{name:"underlay-color",type:u.color},{name:"underlay-opacity",type:u.zeroOneNumber,triggersBounds:l.zeroNonZero},{name:"underlay-shape",type:u.overlayShape,triggersBounds:l.any},{name:"underlay-corner-radius",type:u.cornerRadius}],T=[{name:"transition-property",type:u.propList},{name:"transition-duration",type:u.time},{name:"transition-delay",type:u.time},{name:"transition-timing-function",type:u.easing}],N=function(ue,xe){return xe.value==="label"?-ue.poolIndex():xe.pfValue},R=[{name:"height",type:u.nodeSize,triggersBounds:l.any,hashOverride:N},{name:"width",type:u.nodeSize,triggersBounds:l.any,hashOverride:N},{name:"shape",type:u.nodeShape,triggersBounds:l.any},{name:"shape-polygon-points",type:u.polygonPointList,triggersBounds:l.any},{name:"corner-radius",type:u.cornerRadius},{name:"background-color",type:u.color},{name:"background-fill",type:u.fill},{name:"background-opacity",type:u.zeroOneNumber},{name:"background-blacken",type:u.nOneOneNumber},{name:"background-gradient-stop-colors",type:u.colors},{name:"background-gradient-stop-positions",type:u.percentages},{name:"background-gradient-direction",type:u.gradientDirection},{name:"padding",type:u.sizeMaybePercent,triggersBounds:l.any},{name:"padding-relative-to",type:u.paddingRelativeTo,triggersBounds:l.any},{name:"bounds-expansion",type:u.boundsExpansion,triggersBounds:l.any}],D=[{name:"border-color",type:u.color},{name:"border-opacity",type:u.zeroOneNumber},{name:"border-width",type:u.size,triggersBounds:l.any},{name:"border-style",type:u.borderStyle},{name:"border-cap",type:u.lineCap},{name:"border-join",type:u.lineJoin},{name:"border-dash-pattern",type:u.numbers},{name:"border-dash-offset",type:u.number},{name:"border-position",type:u.linePosition}],j=[{name:"outline-color",type:u.color},{name:"outline-opacity",type:u.zeroOneNumber},{name:"outline-width",type:u.size,triggersBounds:l.any},{name:"outline-style",type:u.borderStyle},{name:"outline-offset",type:u.size,triggersBounds:l.any}],O=[{name:"background-image",type:u.urls},{name:"background-image-crossorigin",type:u.bgCrossOrigin},{name:"background-image-opacity",type:u.zeroOneNumbers},{name:"background-image-containment",type:u.bgContainment},{name:"background-image-smoothing",type:u.bools},{name:"background-position-x",type:u.bgPos},{name:"background-position-y",type:u.bgPos},{name:"background-width-relative-to",type:u.bgRelativeTo},{name:"background-height-relative-to",type:u.bgRelativeTo},{name:"background-repeat",type:u.bgRepeat},{name:"background-fit",type:u.bgFit},{name:"background-clip",type:u.bgClip},{name:"background-width",type:u.bgWH},{name:"background-height",type:u.bgWH},{name:"background-offset-x",type:u.bgPos},{name:"background-offset-y",type:u.bgPos}],F=[{name:"position",type:u.position,triggersBounds:l.any},{name:"compound-sizing-wrt-labels",type:u.compoundIncludeLabels,triggersBounds:l.any},{name:"min-width",type:u.size,triggersBounds:l.any},{name:"min-width-bias-left",type:u.sizeMaybePercent,triggersBounds:l.any},{name:"min-width-bias-right",type:u.sizeMaybePercent,triggersBounds:l.any},{name:"min-height",type:u.size,triggersBounds:l.any},{name:"min-height-bias-top",type:u.sizeMaybePercent,triggersBounds:l.any},{name:"min-height-bias-bottom",type:u.sizeMaybePercent,triggersBounds:l.any}],z=[{name:"line-style",type:u.lineStyle},{name:"line-color",type:u.color},{name:"line-fill",type:u.fill},{name:"line-cap",type:u.lineCap},{name:"line-opacity",type:u.zeroOneNumber},{name:"line-dash-pattern",type:u.numbers},{name:"line-dash-offset",type:u.number},{name:"line-outline-width",type:u.size},{name:"line-outline-color",type:u.color},{name:"line-gradient-stop-colors",type:u.colors},{name:"line-gradient-stop-positions",type:u.percentages},{name:"curve-style",type:u.curveStyle,triggersBounds:l.any,triggersBoundsOfParallelEdges:function(ue,xe){return ue===xe?!1:ue==="bezier"||xe==="bezier"}},{name:"haystack-radius",type:u.zeroOneNumber,triggersBounds:l.any},{name:"source-endpoint",type:u.edgeEndpoint,triggersBounds:l.any},{name:"target-endpoint",type:u.edgeEndpoint,triggersBounds:l.any},{name:"control-point-step-size",type:u.size,triggersBounds:l.any},{name:"control-point-distances",type:u.bidirectionalSizes,triggersBounds:l.any},{name:"control-point-weights",type:u.numbers,triggersBounds:l.any},{name:"segment-distances",type:u.bidirectionalSizes,triggersBounds:l.any},{name:"segment-weights",type:u.numbers,triggersBounds:l.any},{name:"segment-radii",type:u.numbers,triggersBounds:l.any},{name:"radius-type",type:u.radiusType,triggersBounds:l.any},{name:"taxi-turn",type:u.bidirectionalSizeMaybePercent,triggersBounds:l.any},{name:"taxi-turn-min-distance",type:u.size,triggersBounds:l.any},{name:"taxi-direction",type:u.axisDirection,triggersBounds:l.any},{name:"taxi-radius",type:u.number,triggersBounds:l.any},{name:"edge-distances",type:u.edgeDistances,triggersBounds:l.any},{name:"arrow-scale",type:u.positiveNumber,triggersBounds:l.any},{name:"loop-direction",type:u.angle,triggersBounds:l.any},{name:"loop-sweep",type:u.angle,triggersBounds:l.any},{name:"source-distance-from-node",type:u.size,triggersBounds:l.any},{name:"target-distance-from-node",type:u.size,triggersBounds:l.any}],G=[{name:"ghost",type:u.bool,triggersBounds:l.any},{name:"ghost-offset-x",type:u.bidirectionalSize,triggersBounds:l.any},{name:"ghost-offset-y",type:u.bidirectionalSize,triggersBounds:l.any},{name:"ghost-opacity",type:u.zeroOneNumber}],Z=[{name:"selection-box-color",type:u.color},{name:"selection-box-opacity",type:u.zeroOneNumber},{name:"selection-box-border-color",type:u.color},{name:"selection-box-border-width",type:u.size},{name:"active-bg-color",type:u.color},{name:"active-bg-opacity",type:u.zeroOneNumber},{name:"active-bg-size",type:u.size},{name:"outside-texture-bg-color",type:u.color},{name:"outside-texture-bg-opacity",type:u.zeroOneNumber}],I=[];Oi.pieBackgroundN=16,I.push({name:"pie-size",type:u.sizeMaybePercent}),I.push({name:"pie-hole",type:u.sizeMaybePercent}),I.push({name:"pie-start-angle",type:u.angle});for(var W=1;W<=Oi.pieBackgroundN;W++)I.push({name:"pie-"+W+"-background-color",type:u.color}),I.push({name:"pie-"+W+"-background-size",type:u.percent}),I.push({name:"pie-"+W+"-background-opacity",type:u.zeroOneNumber});var U=[];Oi.stripeBackgroundN=16,U.push({name:"stripe-size",type:u.sizeMaybePercent}),U.push({name:"stripe-direction",type:u.axisDirectionPrimary});for(var K=1;K<=Oi.stripeBackgroundN;K++)U.push({name:"stripe-"+K+"-background-color",type:u.color}),U.push({name:"stripe-"+K+"-background-size",type:u.percent}),U.push({name:"stripe-"+K+"-background-opacity",type:u.zeroOneNumber});var $=[],Q=Oi.arrowPrefixes=["source","mid-source","target","mid-target"];[{name:"arrow-shape",type:u.arrowShape,triggersBounds:l.any},{name:"arrow-color",type:u.color},{name:"arrow-fill",type:u.arrowFill},{name:"arrow-width",type:u.arrowWidth}].forEach(function(ve){Q.forEach(function(ue){var xe=ue+"-"+ve.name,Se=ve.type,Ae=ve.triggersBounds;$.push({name:xe,type:Se,triggersBounds:Ae})})},{});var ie=Oi.properties=[].concat(S,T,w,C,_,G,y,g,c,f,p,R,D,j,O,I,U,F,z,$,Z),te=Oi.propertyGroups={behavior:S,transition:T,visibility:w,overlay:C,underlay:_,ghost:G,commonLabel:y,labelDimensions:g,mainLabel:c,sourceLabel:f,targetLabel:p,nodeBody:R,nodeBorder:D,nodeOutline:j,backgroundImage:O,pie:I,stripe:U,compound:F,edgeLine:z,edgeArrow:$,core:Z},X=Oi.propertyGroupNames={},re=Oi.propertyGroupKeys=Object.keys(te);re.forEach(function(ve){X[ve]=te[ve].map(function(ue){return ue.name}),te[ve].forEach(function(ue){return ue.groupKey=ve})});var fe=Oi.aliases=[{name:"content",pointsTo:"label"},{name:"control-point-distance",pointsTo:"control-point-distances"},{name:"control-point-weight",pointsTo:"control-point-weights"},{name:"segment-distance",pointsTo:"segment-distances"},{name:"segment-weight",pointsTo:"segment-weights"},{name:"segment-radius",pointsTo:"segment-radii"},{name:"edge-text-rotation",pointsTo:"text-rotation"},{name:"padding-left",pointsTo:"padding"},{name:"padding-right",pointsTo:"padding"},{name:"padding-top",pointsTo:"padding"},{name:"padding-bottom",pointsTo:"padding"}];Oi.propertyNames=ie.map(function(ve){return ve.name});for(var oe=0;oe<ie.length;oe++){var se=ie[oe];ie[se.name]=se}for(var he=0;he<fe.length;he++){var ae=fe[he],pe=ie[ae.pointsTo],ye={name:ae.name,alias:!0,pointsTo:pe};ie.push(ye),ie[ae.name]=ye}})();Oi.getDefaultProperty=function(t){return this.getDefaultProperties()[t]};Oi.getDefaultProperties=function(){var t=this._private;if(t.defaultProperties!=null)return t.defaultProperties;for(var e=sr({"selection-box-color":"#ddd","selection-box-opacity":.65,"selection-box-border-color":"#aaa","selection-box-border-width":1,"active-bg-color":"black","active-bg-opacity":.15,"active-bg-size":30,"outside-texture-bg-color":"#000","outside-texture-bg-opacity":.125,events:"yes","text-events":"no","text-valign":"top","text-halign":"center","text-justification":"auto","line-height":1,color:"#000","box-selection":"contain","text-outline-color":"#000","text-outline-width":0,"text-outline-opacity":1,"text-opacity":1,"text-decoration":"none","text-transform":"none","text-wrap":"none","text-overflow-wrap":"whitespace","text-max-width":9999,"text-background-color":"#000","text-background-opacity":0,"text-background-shape":"rectangle","text-background-padding":0,"text-border-opacity":0,"text-border-width":0,"text-border-style":"solid","text-border-color":"#000","font-family":"Helvetica Neue, Helvetica, sans-serif","font-style":"normal","font-weight":"normal","font-size":16,"min-zoomed-font-size":0,"text-rotation":"none","source-text-rotation":"none","target-text-rotation":"none",visibility:"visible",display:"element",opacity:1,"z-compound-depth":"auto","z-index-compare":"auto","z-index":0,label:"","text-margin-x":0,"text-margin-y":0,"source-label":"","source-text-offset":0,"source-text-margin-x":0,"source-text-margin-y":0,"target-label":"","target-text-offset":0,"target-text-margin-x":0,"target-text-margin-y":0,"overlay-opacity":0,"overlay-color":"#000","overlay-padding":10,"overlay-shape":"round-rectangle","overlay-corner-radius":"auto","underlay-opacity":0,"underlay-color":"#000","underlay-padding":10,"underlay-shape":"round-rectangle","underlay-corner-radius":"auto","transition-property":"none","transition-duration":0,"transition-delay":0,"transition-timing-function":"linear","box-select-labels":"no","background-blacken":0,"background-color":"#999","background-fill":"solid","background-opacity":1,"background-image":"none","background-image-crossorigin":"anonymous","background-image-opacity":1,"background-image-containment":"inside","background-image-smoothing":"yes","background-position-x":"50%","background-position-y":"50%","background-offset-x":0,"background-offset-y":0,"background-width-relative-to":"include-padding","background-height-relative-to":"include-padding","background-repeat":"no-repeat","background-fit":"none","background-clip":"node","background-width":"auto","background-height":"auto","border-color":"#000","border-opacity":1,"border-width":0,"border-style":"solid","border-dash-pattern":[4,2],"border-dash-offset":0,"border-cap":"butt","border-join":"miter","border-position":"center","outline-color":"#999","outline-opacity":1,"outline-width":0,"outline-offset":0,"outline-style":"solid",height:30,width:30,shape:"ellipse","shape-polygon-points":"-1, -1,   1, -1,   1, 1,   -1, 1","corner-radius":"auto","bounds-expansion":0,"background-gradient-direction":"to-bottom","background-gradient-stop-colors":"#999","background-gradient-stop-positions":"0%",ghost:"no","ghost-offset-y":0,"ghost-offset-x":0,"ghost-opacity":0,padding:0,"padding-relative-to":"width",position:"origin","compound-sizing-wrt-labels":"include","min-width":0,"min-width-bias-left":0,"min-width-bias-right":0,"min-height":0,"min-height-bias-top":0,"min-height-bias-bottom":0},{"pie-size":"100%","pie-hole":0,"pie-start-angle":"0deg"},[{name:"pie-{{i}}-background-color",value:"black"},{name:"pie-{{i}}-background-size",value:"0%"},{name:"pie-{{i}}-background-opacity",value:1}].reduce(function(l,u){for(var c=1;c<=Oi.pieBackgroundN;c++){var f=u.name.replace("{{i}}",c),p=u.value;l[f]=p}return l},{}),{"stripe-size":"100%","stripe-direction":"horizontal"},[{name:"stripe-{{i}}-background-color",value:"black"},{name:"stripe-{{i}}-background-size",value:"0%"},{name:"stripe-{{i}}-background-opacity",value:1}].reduce(function(l,u){for(var c=1;c<=Oi.stripeBackgroundN;c++){var f=u.name.replace("{{i}}",c),p=u.value;l[f]=p}return l},{}),{"line-style":"solid","line-color":"#999","line-fill":"solid","line-cap":"butt","line-opacity":1,"line-outline-width":0,"line-outline-color":"#000","line-gradient-stop-colors":"#999","line-gradient-stop-positions":"0%","control-point-step-size":40,"control-point-weights":.5,"segment-weights":.5,"segment-distances":20,"segment-radii":15,"radius-type":"arc-radius","taxi-turn":"50%","taxi-radius":15,"taxi-turn-min-distance":10,"taxi-direction":"auto","edge-distances":"intersection","curve-style":"haystack","haystack-radius":0,"arrow-scale":1,"loop-direction":"-45deg","loop-sweep":"-90deg","source-distance-from-node":0,"target-distance-from-node":0,"source-endpoint":"outside-to-node","target-endpoint":"outside-to-node","line-dash-pattern":[6,3],"line-dash-offset":0},[{name:"arrow-shape",value:"none"},{name:"arrow-color",value:"#999"},{name:"arrow-fill",value:"filled"},{name:"arrow-width",value:1}].reduce(function(l,u){return Oi.arrowPrefixes.forEach(function(c){var f=c+"-"+u.name,p=u.value;l[f]=p}),l},{})),r={},n=0;n<this.properties.length;n++){var i=this.properties[n];if(!i.pointsTo){var a=i.name,s=e[a],o=this.parse(a,s);r[a]=o}}return t.defaultProperties=r,t.defaultProperties};Oi.addDefaultStylesheet=function(){this.selector(":parent").css({shape:"rectangle",padding:10,"background-color":"#eee","border-color":"#ccc","border-width":1}).selector("edge").css({width:3}).selector(":loop").css({"curve-style":"bezier"}).selector("edge:compound").css({"curve-style":"bezier","source-endpoint":"outside-to-line","target-endpoint":"outside-to-line"}).selector(":selected").css({"background-color":"#0169D9","line-color":"#0169D9","source-arrow-color":"#0169D9","target-arrow-color":"#0169D9","mid-source-arrow-color":"#0169D9","mid-target-arrow-color":"#0169D9"}).selector(":parent:selected").css({"background-color":"#CCE1F9","border-color":"#aec8e5"}).selector(":active").css({"overlay-color":"black","overlay-padding":10,"overlay-opacity":.25}),this.defaultLength=this.length};var B1={};B1.parse=function(t,e,r,n){var i=this;if(ri(e))return i.parseImplWarn(t,e,r,n);var a=n==="mapping"||n===!0||n===!1||n==null?"dontcare":n,s=r?"t":"f",o=""+e,l=YM(t,o,s,a),u=i.propCache=i.propCache||[],c;return(c=u[l])||(c=u[l]=i.parseImplWarn(t,e,r,n)),(r||n==="mapping")&&(c=_u(c),c&&(c.value=_u(c.value))),c};B1.parseImplWarn=function(t,e,r,n){var i=this.parseImpl(t,e,r,n);return!i&&e!=null&&an("The style property `".concat(t,": ").concat(e,"` is invalid")),i&&(i.name==="width"||i.name==="height")&&e==="label"&&an("The style value of `label` is deprecated for `"+i.name+"`"),i};B1.parseImpl=function(t,e,r,n){var i=this;t=i_(t);var a=i.properties[t],s=e,o=i.types;if(!a||e===void 0)return null;a.alias&&(a=a.pointsTo,t=a.name);var l=Yt(e);l&&(e=e.trim());var u=a.type;if(!u)return null;if(r&&(e===""||e===null))return{name:t,value:e,bypass:!0,deleteBypass:!0};if(ri(e))return{name:t,value:e,strValue:"fn",mapped:o.fn,bypass:r};var c,f;if(!(!l||n||e.length<7||e[1]!=="a")){if(e.length>=7&&e[0]==="d"&&(c=new RegExp(o.data.regex).exec(e))){if(r)return!1;var p=o.data;return{name:t,value:c,strValue:""+e,mapped:p,field:c[1],bypass:r}}else if(e.length>=10&&e[0]==="m"&&(f=new RegExp(o.mapData.regex).exec(e))){if(r||u.multiple)return!1;var g=o.mapData;if(!(u.color||u.number))return!1;var y=this.parse(t,f[4]);if(!y||y.mapped)return!1;var S=this.parse(t,f[5]);if(!S||S.mapped)return!1;if(y.pfValue===S.pfValue||y.strValue===S.strValue)return an("`"+t+": "+e+"` is not a valid mapper because the output range is zero; converting to `"+t+": "+y.strValue+"`"),this.parse(t,y.strValue);if(u.color){var w=y.value,C=S.value,_=w[0]===C[0]&&w[1]===C[1]&&w[2]===C[2]&&(w[3]===C[3]||(w[3]==null||w[3]===1)&&(C[3]==null||C[3]===1));if(_)return!1}return{name:t,value:f,strValue:""+e,mapped:g,field:f[1],fieldMin:parseFloat(f[2]),fieldMax:parseFloat(f[3]),valueMin:y.value,valueMax:S.value,bypass:r}}}if(u.multiple&&n!=="multiple"){var T;if(l?T=e.split(/\s+/):Sn(e)?T=e:T=[e],u.evenMultiple&&T.length%2!==0)return null;for(var N=[],R=[],D=[],j="",O=!1,F=0;F<T.length;F++){var z=i.parse(t,T[F],r,"multiple");O=O||Yt(z.value),N.push(z.value),D.push(z.pfValue!=null?z.pfValue:z.value),R.push(z.units),j+=(F>0?" ":"")+z.strValue}return u.validate&&!u.validate(N,R)?null:u.singleEnum&&O?N.length===1&&Yt(N[0])?{name:t,value:N[0],strValue:N[0],bypass:r}:null:{name:t,value:N,pfValue:D,strValue:j,bypass:r,units:R}}var G=function(){for(var ye=0;ye<u.enums.length;ye++){var ve=u.enums[ye];if(ve===e)return{name:t,value:e,strValue:""+e,bypass:r}}return null};if(u.number){var Z,I="px";if(u.units&&(Z=u.units),u.implicitUnits&&(I=u.implicitUnits),!u.unitless)if(l){var W="px|em"+(u.allowPercent?"|\\%":"");Z&&(W=Z);var U=e.match("^("+Wi+")("+W+")?$");U&&(e=U[1],Z=U[2]||I)}else(!Z||u.implicitUnits)&&(Z=I);if(e=parseFloat(e),isNaN(e)&&u.enums===void 0)return null;if(isNaN(e)&&u.enums!==void 0)return e=s,G();if(u.integer&&!Vj(e)||u.min!==void 0&&(e<u.min||u.strictMin&&e===u.min)||u.max!==void 0&&(e>u.max||u.strictMax&&e===u.max))return null;var K={name:t,value:e,strValue:""+e+(Z||""),units:Z,bypass:r};return u.unitless||Z!=="px"&&Z!=="em"?K.pfValue=e:K.pfValue=Z==="px"||!Z?e:this.getEmSizeInPixels()*e,(Z==="ms"||Z==="s")&&(K.pfValue=Z==="ms"?e:1e3*e),(Z==="deg"||Z==="rad")&&(K.pfValue=Z==="rad"?e:J9(e)),Z==="%"&&(K.pfValue=e/100),K}else if(u.propList){var $=[],Q=""+e;if(Q!=="none"){for(var ie=Q.split(/\s*,\s*|\s+/),te=0;te<ie.length;te++){var X=ie[te].trim();i.properties[X]?$.push(X):an("`"+X+"` is not a valid property name")}if($.length===0)return null}return{name:t,value:$,strValue:$.length===0?"none":$.join(" "),bypass:r}}else if(u.color){var re=VM(e);return re?{name:t,value:re,pfValue:re,strValue:"rgb("+re[0]+","+re[1]+","+re[2]+")",bypass:r}:null}else if(u.regex||u.regexes){if(u.enums){var fe=G();if(fe)return fe}for(var oe=u.regexes?u.regexes:[u.regex],se=0;se<oe.length;se++){var he=new RegExp(oe[se]),ae=he.exec(e);if(ae)return{name:t,value:u.singleRegexMatchValue?ae[1]:ae,strValue:""+e,bypass:r}}return null}else return u.string?{name:t,value:""+e,strValue:""+e,bypass:r}:u.enums?G():null};var ma=function(e){if(!(this instanceof ma))return new ma(e);if(!n_(e)){Zn("A style must have a core reference");return}this._private={cy:e,coreStyle:{}},this.length=0,this.resetToDefault()},ls=ma.prototype;ls.instanceString=function(){return"style"};ls.clear=function(){for(var t=this._private,e=t.cy,r=e.elements(),n=0;n<this.length;n++)this[n]=void 0;return this.length=0,t.contextStyles={},t.propDiffs={},this.cleanElements(r,!0),r.forEach(function(i){var a=i[0]._private;a.styleDirty=!0,a.appliedInitStyle=!1}),this};ls.resetToDefault=function(){return this.clear(),this.addDefaultStylesheet(),this};ls.core=function(t){return this._private.coreStyle[t]||this.getDefaultProperty(t)};ls.selector=function(t){var e=t==="core"?null:new Xd(t),r=this.length++;return this[r]={selector:e,properties:[],mappedProperties:[],index:r},this};ls.css=function(){var t=this,e=arguments;if(e.length===1)for(var r=e[0],n=0;n<t.properties.length;n++){var i=t.properties[n],a=r[i.name];a===void 0&&(a=r[C1(i.name)]),a!==void 0&&this.cssRule(i.name,a)}else e.length===2&&this.cssRule(e[0],e[1]);return this};ls.style=ls.css;ls.cssRule=function(t,e){var r=this.parse(t,e);if(r){var n=this.length-1;this[n].properties.push(r),this[n].properties[r.name]=r,r.name.match(/pie-(\d+)-background-size/)&&r.value&&(this._private.hasPie=!0),r.name.match(/stripe-(\d+)-background-size/)&&r.value&&(this._private.hasStripe=!0),r.mapped&&this[n].mappedProperties.push(r);var i=!this[n].selector;i&&(this._private.coreStyle[r.name]=r)}return this};ls.append=function(t){return zM(t)?t.appendToStyle(this):Sn(t)?this.appendFromJson(t):Yt(t)&&this.appendFromString(t),this};ma.fromJson=function(t,e){var r=new ma(t);return r.fromJson(e),r};ma.fromString=function(t,e){return new ma(t).fromString(e)};[ya,i0,x_,Nu,F1,b_,Oi,B1].forEach(function(t){sr(ls,t)});ma.types=ls.types;ma.properties=ls.properties;ma.propertyGroups=ls.propertyGroups;ma.propertyGroupNames=ls.propertyGroupNames;ma.propertyGroupKeys=ls.propertyGroupKeys;var nz={style:function(e){if(e){var r=this.setStyle(e);r.update()}return this._private.style},setStyle:function(e){var r=this._private;return zM(e)?r.style=e.generateStyle(this):Sn(e)?r.style=ma.fromJson(this,e):Yt(e)?r.style=ma.fromString(this,e):r.style=ma(this),r.style},updateStyle:function(){this.mutableElements().updateStyle()}},iz="single",vh={autolock:function(e){if(e!==void 0)this._private.autolock=!!e;else return this._private.autolock;return this},autoungrabify:function(e){if(e!==void 0)this._private.autoungrabify=!!e;else return this._private.autoungrabify;return this},autounselectify:function(e){if(e!==void 0)this._private.autounselectify=!!e;else return this._private.autounselectify;return this},selectionType:function(e){var r=this._private;if(r.selectionType==null&&(r.selectionType=iz),e!==void 0)(e==="additive"||e==="single")&&(r.selectionType=e);else return r.selectionType;return this},panningEnabled:function(e){if(e!==void 0)this._private.panningEnabled=!!e;else return this._private.panningEnabled;return this},userPanningEnabled:function(e){if(e!==void 0)this._private.userPanningEnabled=!!e;else return this._private.userPanningEnabled;return this},zoomingEnabled:function(e){if(e!==void 0)this._private.zoomingEnabled=!!e;else return this._private.zoomingEnabled;return this},userZoomingEnabled:function(e){if(e!==void 0)this._private.userZoomingEnabled=!!e;else return this._private.userZoomingEnabled;return this},boxSelectionEnabled:function(e){if(e!==void 0)this._private.boxSelectionEnabled=!!e;else return this._private.boxSelectionEnabled;return this},pan:function(){var e=arguments,r=this._private.pan,n,i,a,s,o;switch(e.length){case 0:return r;case 1:if(Yt(e[0]))return n=e[0],r[n];if(Wr(e[0])){if(!this._private.panningEnabled)return this;a=e[0],s=a.x,o=a.y,_t(s)&&(r.x=s),_t(o)&&(r.y=o),this.emit("pan viewport")}break;case 2:if(!this._private.panningEnabled)return this;n=e[0],i=e[1],(n==="x"||n==="y")&&_t(i)&&(r[n]=i),this.emit("pan viewport");break}return this.notify("viewport"),this},panBy:function(e,r){var n=arguments,i=this._private.pan,a,s,o,l,u;if(!this._private.panningEnabled)return this;switch(n.length){case 1:Wr(e)&&(o=n[0],l=o.x,u=o.y,_t(l)&&(i.x+=l),_t(u)&&(i.y+=u),this.emit("pan viewport"));break;case 2:a=e,s=r,(a==="x"||a==="y")&&_t(s)&&(i[a]+=s),this.emit("pan viewport");break}return this.notify("viewport"),this},gc:function(){this.notify("gc")},fit:function(e,r){var n=this.getFitViewport(e,r);if(n){var i=this._private;i.zoom=n.zoom,i.pan=n.pan,this.emit("pan zoom viewport"),this.notify("viewport")}return this},getFitViewport:function(e,r){if(_t(e)&&r===void 0&&(r=e,e=void 0),!(!this._private.panningEnabled||!this._private.zoomingEnabled)){var n;if(Yt(e)){var i=e;e=this.$(i)}else if(qj(e)){var a=e;n={x1:a.x1,y1:a.y1,x2:a.x2,y2:a.y2},n.w=n.x2-n.x1,n.h=n.y2-n.y1}else vo(e)||(e=this.mutableElements());if(!(vo(e)&&e.empty())){n=n||e.boundingBox();var s=this.width(),o=this.height(),l;if(r=_t(r)?r:0,!isNaN(s)&&!isNaN(o)&&s>0&&o>0&&!isNaN(n.w)&&!isNaN(n.h)&&n.w>0&&n.h>0){l=Math.min((s-2*r)/n.w,(o-2*r)/n.h),l=l>this._private.maxZoom?this._private.maxZoom:l,l=l<this._private.minZoom?this._private.minZoom:l;var u={x:(s-l*(n.x1+n.x2))/2,y:(o-l*(n.y1+n.y2))/2};return{zoom:l,pan:u}}}}},zoomRange:function(e,r){var n=this._private;if(r==null){var i=e;e=i.min,r=i.max}return _t(e)&&_t(r)&&e<=r?(n.minZoom=e,n.maxZoom=r):_t(e)&&r===void 0&&e<=n.maxZoom?n.minZoom=e:_t(r)&&e===void 0&&r>=n.minZoom&&(n.maxZoom=r),this},minZoom:function(e){return e===void 0?this._private.minZoom:this.zoomRange({min:e})},maxZoom:function(e){return e===void 0?this._private.maxZoom:this.zoomRange({max:e})},getZoomedViewport:function(e){var r=this._private,n=r.pan,i=r.zoom,a,s,o=!1;if(r.zoomingEnabled||(o=!0),_t(e)?s=e:Wr(e)&&(s=e.level,e.position!=null?a=N1(e.position,i,n):e.renderedPosition!=null&&(a=e.renderedPosition),a!=null&&!r.panningEnabled&&(o=!0)),s=s>r.maxZoom?r.maxZoom:s,s=s<r.minZoom?r.minZoom:s,o||!_t(s)||s===i||a!=null&&(!_t(a.x)||!_t(a.y)))return null;if(a!=null){var l=n,u=i,c=s,f={x:-c/u*(a.x-l.x)+a.x,y:-c/u*(a.y-l.y)+a.y};return{zoomed:!0,panned:!0,zoom:c,pan:f}}else return{zoomed:!0,panned:!1,zoom:s,pan:n}},zoom:function(e){if(e===void 0)return this._private.zoom;var r=this.getZoomedViewport(e),n=this._private;return r==null||!r.zoomed?this:(n.zoom=r.zoom,r.panned&&(n.pan.x=r.pan.x,n.pan.y=r.pan.y),this.emit("zoom"+(r.panned?" pan":"")+" viewport"),this.notify("viewport"),this)},viewport:function(e){var r=this._private,n=!0,i=!0,a=[],s=!1,o=!1;if(!e)return this;if(_t(e.zoom)||(n=!1),Wr(e.pan)||(i=!1),!n&&!i)return this;if(n){var l=e.zoom;l<r.minZoom||l>r.maxZoom||!r.zoomingEnabled?s=!0:(r.zoom=l,a.push("zoom"))}if(i&&(!s||!e.cancelOnFailedZoom)&&r.panningEnabled){var u=e.pan;_t(u.x)&&(r.pan.x=u.x,o=!1),_t(u.y)&&(r.pan.y=u.y,o=!1),o||a.push("pan")}return a.length>0&&(a.push("viewport"),this.emit(a.join(" ")),this.notify("viewport")),this},center:function(e){var r=this.getCenterPan(e);return r&&(this._private.pan=r,this.emit("pan viewport"),this.notify("viewport")),this},getCenterPan:function(e,r){if(this._private.panningEnabled){if(Yt(e)){var n=e;e=this.mutableElements().filter(n)}else vo(e)||(e=this.mutableElements());if(e.length!==0){var i=e.boundingBox(),a=this.width(),s=this.height();r=r===void 0?this._private.zoom:r;var o={x:(a-r*(i.x1+i.x2))/2,y:(s-r*(i.y1+i.y2))/2};return o}}},reset:function(){return!this._private.panningEnabled||!this._private.zoomingEnabled?this:(this.viewport({pan:{x:0,y:0},zoom:1}),this)},invalidateSize:function(){this._private.sizeCache=null},size:function(){var e=this._private,r=e.container,n=this;return e.sizeCache=e.sizeCache||(r?(function(){var i=n.window().getComputedStyle(r),a=function(o){return parseFloat(i.getPropertyValue(o))};return{width:r.clientWidth-a("padding-left")-a("padding-right"),height:r.clientHeight-a("padding-top")-a("padding-bottom")}})():{width:1,height:1})},width:function(){return this.size().width},height:function(){return this.size().height},extent:function(){var e=this._private.pan,r=this._private.zoom,n=this.renderedExtent(),i={x1:(n.x1-e.x)/r,x2:(n.x2-e.x)/r,y1:(n.y1-e.y)/r,y2:(n.y2-e.y)/r};return i.w=i.x2-i.x1,i.h=i.y2-i.y1,i},renderedExtent:function(){var e=this.width(),r=this.height();return{x1:0,y1:0,x2:e,y2:r,w:e,h:r}},multiClickDebounceTime:function(e){if(e)this._private.multiClickDebounceTime=e;else return this._private.multiClickDebounceTime;return this}};vh.centre=vh.center;vh.autolockNodes=vh.autolock;vh.autoungrabifyNodes=vh.autoungrabify;var Nv={data:nn.data({field:"data",bindingEvent:"data",allowBinding:!0,allowSetting:!0,settingEvent:"data",settingTriggersEvent:!0,triggerFnName:"trigger",allowGetting:!0,updateStyle:!0}),removeData:nn.removeData({field:"data",event:"data",triggerFnName:"trigger",triggerEvent:!0,updateStyle:!0}),scratch:nn.data({field:"scratch",bindingEvent:"scratch",allowBinding:!0,allowSetting:!0,settingEvent:"scratch",settingTriggersEvent:!0,triggerFnName:"trigger",allowGetting:!0,updateStyle:!0}),removeScratch:nn.removeData({field:"scratch",event:"scratch",triggerFnName:"trigger",triggerEvent:!0,updateStyle:!0})};Nv.attr=Nv.data;Nv.removeAttr=Nv.removeData;var Pv=function(e){var r=this;e=sr({},e);var n=e.container;n&&!ux(n)&&ux(n[0])&&(n=n[0]);var i=n?n._cyreg:null;i=i||{},i&&i.cy&&(i.cy.destroy(),i={});var a=i.readies=i.readies||[];n&&(n._cyreg=i),i.cy=r;var s=Hi!==void 0&&n!==void 0&&!e.headless,o=e;o.layout=sr({name:s?"grid":"null"},o.layout),o.renderer=sr({name:s?"canvas":"null"},o.renderer);var l=function(y,S,w){return S!==void 0?S:w!==void 0?w:y},u=this._private={container:n,ready:!1,options:o,elements:new za(this),listeners:[],aniEles:new za(this),data:o.data||{},scratch:{},layout:null,renderer:null,destroyed:!1,notificationsEnabled:!0,minZoom:1e-50,maxZoom:1e50,zoomingEnabled:l(!0,o.zoomingEnabled),userZoomingEnabled:l(!0,o.userZoomingEnabled),panningEnabled:l(!0,o.panningEnabled),userPanningEnabled:l(!0,o.userPanningEnabled),boxSelectionEnabled:l(!0,o.boxSelectionEnabled),autolock:l(!1,o.autolock,o.autolockNodes),autoungrabify:l(!1,o.autoungrabify,o.autoungrabifyNodes),autounselectify:l(!1,o.autounselectify),styleEnabled:o.styleEnabled===void 0?s:o.styleEnabled,zoom:_t(o.zoom)?o.zoom:1,pan:{x:Wr(o.pan)&&_t(o.pan.x)?o.pan.x:0,y:Wr(o.pan)&&_t(o.pan.y)?o.pan.y:0},animation:{current:[],queue:[]},hasCompoundNodes:!1,multiClickDebounceTime:l(250,o.multiClickDebounceTime)};this.createEmitter(),this.selectionType(o.selectionType),this.zoomRange({min:o.minZoom,max:o.maxZoom});var c=function(y,S){var w=y.some($j);if(w)return um.all(y).then(S);S(y)};u.styleEnabled&&r.setStyle([]);var f=sr({},o,o.renderer);r.initRenderer(f);var p=function(y,S,w){r.notifications(!1);var C=r.mutableElements();C.length>0&&C.remove(),y!=null&&(Wr(y)||Sn(y))&&r.add(y),r.one("layoutready",function(T){r.notifications(!0),r.emit(T),r.one("load",S),r.emitAndNotify("load")}).one("layoutstop",function(){r.one("done",w),r.emit("done")});var _=sr({},r._private.options.layout);_.eles=r.elements(),r.layout(_).run()};c([o.style,o.elements],function(g){var y=g[0],S=g[1];u.styleEnabled&&r.style().append(y),p(S,function(){r.startAnimationLoop(),u.ready=!0,ri(o.ready)&&r.on("ready",o.ready);for(var w=0;w<a.length;w++){var C=a[w];r.on("ready",C)}i&&(i.readies=[]),r.emit("ready")},o.done)})},gx=Pv.prototype;sr(gx,{instanceString:function(){return"core"},isReady:function(){return this._private.ready},destroyed:function(){return this._private.destroyed},ready:function(e){return this.isReady()?this.emitter().emit("ready",[],e):this.on("ready",e),this},destroy:function(){var e=this;if(!e.destroyed())return e.stopAnimationLoop(),e.destroyRenderer(),this.emit("destroy"),e._private.destroyed=!0,e},hasElementWithId:function(e){return this._private.elements.hasElementWithId(e)},getElementById:function(e){return this._private.elements.getElementById(e)},hasCompoundNodes:function(){return this._private.hasCompoundNodes},headless:function(){return this._private.renderer.isHeadless()},styleEnabled:function(){return this._private.styleEnabled},addToPool:function(e){return this._private.elements.merge(e),this},removeFromPool:function(e){return this._private.elements.unmerge(e),this},container:function(){return this._private.container||null},window:function(){var e=this._private.container;if(e==null)return Hi;var r=this._private.container.ownerDocument;return r===void 0||r==null?Hi:r.defaultView||Hi},mount:function(e){if(e!=null){var r=this,n=r._private,i=n.options;return!ux(e)&&ux(e[0])&&(e=e[0]),r.stopAnimationLoop(),r.destroyRenderer(),n.container=e,n.styleEnabled=!0,r.invalidateSize(),r.initRenderer(sr({},i,i.renderer,{name:i.renderer.name==="null"?"canvas":i.renderer.name})),r.startAnimationLoop(),r.style(i.style),r.emit("mount"),r}},unmount:function(){var e=this;return e.stopAnimationLoop(),e.destroyRenderer(),e.initRenderer({name:"null"}),e.emit("unmount"),e},options:function(){return _u(this._private.options)},json:function(e){var r=this,n=r._private,i=r.mutableElements(),a=function(N){return r.getElementById(N.id())};if(Wr(e)){if(r.startBatch(),e.elements){var s={},o=function(N,R){for(var D=[],j=[],O=0;O<N.length;O++){var F=N[O];if(!F.data.id){an("cy.json() cannot handle elements without an ID attribute");continue}var z=""+F.data.id,G=r.getElementById(z);s[z]=!0,G.length!==0?j.push({ele:G,json:F}):(R&&(F.group=R),D.push(F))}r.add(D);for(var Z=0;Z<j.length;Z++){var I=j[Z],W=I.ele,U=I.json;W.json(U)}};if(Sn(e.elements))o(e.elements);else for(var l=["nodes","edges"],u=0;u<l.length;u++){var c=l[u],f=e.elements[c];Sn(f)&&o(f,c)}var p=r.collection();i.filter(function(T){return!s[T.id()]}).forEach(function(T){T.isParent()?p.merge(T):T.remove()}),p.forEach(function(T){return T.children().move({parent:null})}),p.forEach(function(T){return a(T).remove()})}e.style&&r.style(e.style),e.zoom!=null&&e.zoom!==n.zoom&&r.zoom(e.zoom),e.pan&&(e.pan.x!==n.pan.x||e.pan.y!==n.pan.y)&&r.pan(e.pan),e.data&&r.data(e.data);for(var g=["minZoom","maxZoom","zoomingEnabled","userZoomingEnabled","panningEnabled","userPanningEnabled","boxSelectionEnabled","autolock","autoungrabify","autounselectify","multiClickDebounceTime"],y=0;y<g.length;y++){var S=g[y];e[S]!=null&&r[S](e[S])}return r.endBatch(),this}else{var w=!!e,C={};w?C.elements=this.elements().map(function(T){return T.json()}):(C.elements={},i.forEach(function(T){var N=T.group();C.elements[N]||(C.elements[N]=[]),C.elements[N].push(T.json())})),this._private.styleEnabled&&(C.style=r.style().json()),C.data=_u(r.data());var _=n.options;return C.zoomingEnabled=n.zoomingEnabled,C.userZoomingEnabled=n.userZoomingEnabled,C.zoom=n.zoom,C.minZoom=n.minZoom,C.maxZoom=n.maxZoom,C.panningEnabled=n.panningEnabled,C.userPanningEnabled=n.userPanningEnabled,C.pan=_u(n.pan),C.boxSelectionEnabled=n.boxSelectionEnabled,C.renderer=_u(_.renderer),C.hideEdgesOnViewport=_.hideEdgesOnViewport,C.textureOnViewport=_.textureOnViewport,C.wheelSensitivity=_.wheelSensitivity,C.motionBlur=_.motionBlur,C.multiClickDebounceTime=_.multiClickDebounceTime,C}}});gx.$id=gx.getElementById;[$7,Q7,zA,ZS,Hy,ez,YS,Wy,nz,vh,Nv].forEach(function(t){sr(gx,t)});var az={fit:!0,directed:!1,direction:"downward",padding:30,circle:!1,grid:!1,spacingFactor:1.75,boundingBox:void 0,avoidOverlap:!0,nodeDimensionsIncludeLabels:!1,roots:void 0,depthSort:void 0,animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function(e,r){return!0},ready:void 0,stop:void 0,transform:function(e,r){return r}},sz={maximal:!1,acyclic:!1},pp=function(e){return e.scratch("breadthfirst")},IN=function(e,r){return e.scratch("breadthfirst",r)};function UA(t){this.options=sr({},az,sz,t)}UA.prototype.run=function(){var t=this.options,e=t.cy,r=t.eles,n=r.nodes().filter(function(Ct){return Ct.isChildless()}),i=r,a=t.directed,s=t.acyclic||t.maximal||t.maximalAdjustments>0,o=!!t.boundingBox,l=Es(o?t.boundingBox:structuredClone(e.extent())),u;if(vo(t.roots))u=t.roots;else if(Sn(t.roots)){for(var c=[],f=0;f<t.roots.length;f++){var p=t.roots[f],g=e.getElementById(p);c.push(g)}u=e.collection(c)}else if(Yt(t.roots))u=e.$(t.roots);else if(a)u=n.roots();else{var y=r.components();u=e.collection();for(var S=function(){var Ke=y[w],ut=Ke.maxDegree(!1),ct=Ke.filter(function(xt){return xt.degree(!1)===ut});u=u.add(ct)},w=0;w<y.length;w++)S()}var C=[],_={},T=function(Ke,ut){C[ut]==null&&(C[ut]=[]);var ct=C[ut].length;C[ut].push(Ke),IN(Ke,{index:ct,depth:ut})},N=function(Ke,ut){var ct=pp(Ke),xt=ct.depth,ot=ct.index;C[xt][ot]=null,Ke.isChildless()&&T(Ke,ut)};i.bfs({roots:u,directed:t.directed,visit:function(Ke,ut,ct,xt,ot){var Lt=Ke[0],Bt=Lt.id();Lt.isChildless()&&T(Lt,ot),_[Bt]=!0}});for(var R=[],D=0;D<n.length;D++){var j=n[D];_[j.id()]||R.push(j)}var O=function(Ke){for(var ut=C[Ke],ct=0;ct<ut.length;ct++){var xt=ut[ct];if(xt==null){ut.splice(ct,1),ct--;continue}IN(xt,{depth:Ke,index:ct})}},F=function(Ke,ut){for(var ct=pp(Ke),xt=Ke.incomers().filter(function(it){return it.isNode()&&r.has(it)}),ot=-1,Lt=Ke.id(),Bt=0;Bt<xt.length;Bt++){var Ne=xt[Bt],qe=pp(Ne);ot=Math.max(ot,qe.depth)}if(ct.depth<=ot){if(!t.acyclic&&ut[Lt])return null;var St=ot+1;return N(Ke,St),ut[Lt]=St,!0}return!1};if(a&&s){var z=[],G={},Z=function(Ke){return z.push(Ke)},I=function(){return z.shift()};for(n.forEach(function(Ct){return z.push(Ct)});z.length>0;){var W=I(),U=F(W,G);if(U)W.outgoers().filter(function(Ct){return Ct.isNode()&&r.has(Ct)}).forEach(Z);else if(U===null){an("Detected double maximal shift for node `"+W.id()+"`.  Bailing maximal adjustment due to cycle.  Use `options.maximal: true` only on DAGs.");break}}}var K=0;if(t.avoidOverlap)for(var $=0;$<n.length;$++){var Q=n[$],ie=Q.layoutDimensions(t),te=ie.w,X=ie.h;K=Math.max(K,te,X)}var re={},fe=function(Ke){if(re[Ke.id()])return re[Ke.id()];for(var ut=pp(Ke).depth,ct=Ke.neighborhood(),xt=0,ot=0,Lt=0;Lt<ct.length;Lt++){var Bt=ct[Lt];if(!(Bt.isEdge()||Bt.isParent()||!n.has(Bt))){var Ne=pp(Bt);if(Ne!=null){var qe=Ne.index,St=Ne.depth;if(!(qe==null||St==null)){var it=C[St].length;St<ut&&(xt+=qe/it,ot++)}}}}return ot=Math.max(1,ot),xt=xt/ot,ot===0&&(xt=0),re[Ke.id()]=xt,xt},oe=function(Ke,ut){var ct=fe(Ke),xt=fe(ut),ot=ct-xt;return ot===0?GM(Ke.id(),ut.id()):ot};t.depthSort!==void 0&&(oe=t.depthSort);for(var se=C.length,he=0;he<se;he++)C[he].sort(oe),O(he);for(var ae=[],pe=0;pe<R.length;pe++)ae.push(R[pe]);var ye=function(){for(var Ke=0;Ke<se;Ke++)O(Ke)};ae.length&&(C.unshift(ae),se=C.length,ye());for(var ve=0,ue=0;ue<se;ue++)ve=Math.max(C[ue].length,ve);var xe={x:l.x1+l.w/2,y:l.y1+l.h/2},Se=n.reduce(function(Ct,Ke){return(function(ut){return{w:Ct.w===-1?ut.w:(Ct.w+ut.w)/2,h:Ct.h===-1?ut.h:(Ct.h+ut.h)/2}})(Ke.boundingBox({includeLabels:t.nodeDimensionsIncludeLabels}))},{w:-1,h:-1}),Ae=Math.max(se===1?0:o?(l.h-t.padding*2-Se.h)/(se-1):(l.h-t.padding*2-Se.h)/(se+1),K),Me=C.reduce(function(Ct,Ke){return Math.max(Ct,Ke.length)},0),st=function(Ke){var ut=pp(Ke),ct=ut.depth,xt=ut.index;if(t.circle){var ot=Math.min(l.w/2/se,l.h/2/se);ot=Math.max(ot,K);var Lt=ot*ct+ot-(se>0&&C[0].length<=3?ot/2:0),Bt=2*Math.PI/C[ct].length*xt;return ct===0&&C[0].length===1&&(Lt=1),{x:xe.x+Lt*Math.cos(Bt),y:xe.y+Lt*Math.sin(Bt)}}else{var Ne=C[ct].length,qe=Math.max(Ne===1?0:o?(l.w-t.padding*2-Se.w)/((t.grid?Me:Ne)-1):(l.w-t.padding*2-Se.w)/((t.grid?Me:Ne)+1),K),St={x:xe.x+(xt+1-(Ne+1)/2)*qe,y:xe.y+(ct+1-(se+1)/2)*Ae};return St}},rt={downward:0,leftward:90,upward:180,rightward:-90};Object.keys(rt).indexOf(t.direction)===-1&&Zn("Invalid direction '".concat(t.direction,"' specified for breadthfirst layout. Valid values are: ").concat(Object.keys(rt).join(", ")));var dt=function(Ke){return S9(st(Ke),l,rt[t.direction])};return r.nodes().layoutPositions(this,t,dt),this};var oz={fit:!0,padding:30,boundingBox:void 0,avoidOverlap:!0,nodeDimensionsIncludeLabels:!1,spacingFactor:void 0,radius:void 0,startAngle:3/2*Math.PI,sweep:void 0,clockwise:!0,sort:void 0,animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function(e,r){return!0},ready:void 0,stop:void 0,transform:function(e,r){return r}};function GA(t){this.options=sr({},oz,t)}GA.prototype.run=function(){var t=this.options,e=t,r=t.cy,n=e.eles,i=e.counterclockwise!==void 0?!e.counterclockwise:e.clockwise,a=n.nodes().not(":parent");e.sort&&(a=a.sort(e.sort));for(var s=Es(e.boundingBox?e.boundingBox:{x1:0,y1:0,w:r.width(),h:r.height()}),o={x:s.x1+s.w/2,y:s.y1+s.h/2},l=e.sweep===void 0?2*Math.PI-2*Math.PI/a.length:e.sweep,u=l/Math.max(1,a.length-1),c,f=0,p=0;p<a.length;p++){var g=a[p],y=g.layoutDimensions(e),S=y.w,w=y.h;f=Math.max(f,S,w)}if(_t(e.radius)?c=e.radius:a.length<=1?c=0:c=Math.min(s.h,s.w)/2-f,a.length>1&&e.avoidOverlap){f*=1.75;var C=Math.cos(u)-Math.cos(0),_=Math.sin(u)-Math.sin(0),T=Math.sqrt(f*f/(C*C+_*_));c=Math.max(T,c)}var N=function(D,j){var O=e.startAngle+j*u*(i?1:-1),F=c*Math.cos(O),z=c*Math.sin(O),G={x:o.x+F,y:o.y+z};return G};return n.nodes().layoutPositions(this,e,N),this};var lz={fit:!0,padding:30,startAngle:3/2*Math.PI,sweep:void 0,clockwise:!0,equidistant:!1,minNodeSpacing:10,boundingBox:void 0,avoidOverlap:!0,nodeDimensionsIncludeLabels:!1,height:void 0,width:void 0,spacingFactor:void 0,concentric:function(e){return e.degree()},levelWidth:function(e){return e.maxDegree()/4},animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function(e,r){return!0},ready:void 0,stop:void 0,transform:function(e,r){return r}};function VA(t){this.options=sr({},lz,t)}VA.prototype.run=function(){for(var t=this.options,e=t,r=e.counterclockwise!==void 0?!e.counterclockwise:e.clockwise,n=t.cy,i=e.eles,a=i.nodes().not(":parent"),s=Es(e.boundingBox?e.boundingBox:{x1:0,y1:0,w:n.width(),h:n.height()}),o={x:s.x1+s.w/2,y:s.y1+s.h/2},l=[],u=0,c=0;c<a.length;c++){var f=a[c],p=void 0;p=e.concentric(f),l.push({value:p,node:f}),f._private.scratch.concentric=p}a.updateStyle();for(var g=0;g<a.length;g++){var y=a[g],S=y.layoutDimensions(e);u=Math.max(u,S.w,S.h)}l.sort(function(Ae,Me){return Me.value-Ae.value});for(var w=e.levelWidth(a),C=[[]],_=C[0],T=0;T<l.length;T++){var N=l[T];if(_.length>0){var R=Math.abs(_[0].value-N.value);R>=w&&(_=[],C.push(_))}_.push(N)}var D=u+e.minNodeSpacing;if(!e.avoidOverlap){var j=C.length>0&&C[0].length>1,O=Math.min(s.w,s.h)/2-D,F=O/(C.length+j?1:0);D=Math.min(D,F)}for(var z=0,G=0;G<C.length;G++){var Z=C[G],I=e.sweep===void 0?2*Math.PI-2*Math.PI/Z.length:e.sweep,W=Z.dTheta=I/Math.max(1,Z.length-1);if(Z.length>1&&e.avoidOverlap){var U=Math.cos(W)-Math.cos(0),K=Math.sin(W)-Math.sin(0),$=Math.sqrt(D*D/(U*U+K*K));z=Math.max($,z)}Z.r=z,z+=D}if(e.equidistant){for(var Q=0,ie=0,te=0;te<C.length;te++){var X=C[te],re=X.r-ie;Q=Math.max(Q,re)}ie=0;for(var fe=0;fe<C.length;fe++){var oe=C[fe];fe===0&&(ie=oe.r),oe.r=ie,ie+=Q}}for(var se={},he=0;he<C.length;he++)for(var ae=C[he],pe=ae.dTheta,ye=ae.r,ve=0;ve<ae.length;ve++){var ue=ae[ve],xe=e.startAngle+(r?1:-1)*pe*ve,Se={x:o.x+ye*Math.cos(xe),y:o.y+ye*Math.sin(xe)};se[ue.node.id()]=Se}return i.nodes().layoutPositions(this,e,function(Ae){var Me=Ae.id();return se[Me]}),this};var g2,uz={ready:function(){},stop:function(){},animate:!0,animationEasing:void 0,animationDuration:void 0,animateFilter:function(e,r){return!0},animationThreshold:250,refresh:20,fit:!0,padding:30,boundingBox:void 0,nodeDimensionsIncludeLabels:!1,randomize:!1,componentSpacing:40,nodeRepulsion:function(e){return 2048},nodeOverlap:4,idealEdgeLength:function(e){return 32},edgeElasticity:function(e){return 32},nestingFactor:1.2,gravity:1,numIter:1e3,initialTemp:1e3,coolingFactor:.99,minTemp:1};function z1(t){this.options=sr({},uz,t),this.options.layout=this;var e=this.options.eles.nodes(),r=this.options.eles.edges(),n=r.filter(function(i){var a=i.source().data("id"),s=i.target().data("id"),o=e.some(function(u){return u.data("id")===a}),l=e.some(function(u){return u.data("id")===s});return!o||!l});this.options.eles=this.options.eles.not(n)}z1.prototype.run=function(){var t=this.options,e=t.cy,r=this;r.stopped=!1,(t.animate===!0||t.animate===!1)&&r.emit({type:"layoutstart",layout:r}),t.debug===!0?g2=!0:g2=!1;var n=cz(e,r,t);g2&&fz(n),t.randomize&&hz(n);var i=yc(),a=function(){pz(n,e,t),t.fit===!0&&e.fit(t.padding)},s=function(p){return!(r.stopped||p>=t.numIter||(mz(n,t),n.temperature=n.temperature*t.coolingFactor,n.temperature<t.minTemp))},o=function(){if(t.animate===!0||t.animate===!1)a(),r.one("layoutstop",t.stop),r.emit({type:"layoutstop",layout:r});else{var p=t.eles.nodes(),g=WA(n,t,p);p.layoutPositions(r,t,g)}},l=0,u=!0;if(t.animate===!0){var c=function(){for(var p=0;u&&p<t.refresh;)u=s(l),l++,p++;if(!u)FN(n,t),o();else{var g=yc();g-i>=t.animationThreshold&&a(),cx(c)}};c()}else{for(;u;)u=s(l),l++;FN(n,t),o()}return this};z1.prototype.stop=function(){return this.stopped=!0,this.thread&&this.thread.stop(),this.emit("layoutstop"),this};z1.prototype.destroy=function(){return this.thread&&this.thread.stop(),this};var cz=function(e,r,n){for(var i=n.eles.edges(),a=n.eles.nodes(),s=Es(n.boundingBox?n.boundingBox:{x1:0,y1:0,w:e.width(),h:e.height()}),o={isCompound:e.hasCompoundNodes(),layoutNodes:[],idToIndex:{},nodeSize:a.size(),graphSet:[],indexToGraph:[],layoutEdges:[],edgeSize:i.size(),temperature:n.initialTemp,clientWidth:s.w,clientHeight:s.h,boundingBox:s},l=n.eles.components(),u={},c=0;c<l.length;c++)for(var f=l[c],p=0;p<f.length;p++){var g=f[p];u[g.id()]=c}for(var c=0;c<o.nodeSize;c++){var y=a[c],S=y.layoutDimensions(n),w={};w.isLocked=y.locked(),w.id=y.data("id"),w.parentId=y.data("parent"),w.cmptId=u[y.id()],w.children=[],w.positionX=y.position("x"),w.positionY=y.position("y"),w.offsetX=0,w.offsetY=0,w.height=S.w,w.width=S.h,w.maxX=w.positionX+w.width/2,w.minX=w.positionX-w.width/2,w.maxY=w.positionY+w.height/2,w.minY=w.positionY-w.height/2,w.padLeft=parseFloat(y.style("padding")),w.padRight=parseFloat(y.style("padding")),w.padTop=parseFloat(y.style("padding")),w.padBottom=parseFloat(y.style("padding")),w.nodeRepulsion=ri(n.nodeRepulsion)?n.nodeRepulsion(y):n.nodeRepulsion,o.layoutNodes.push(w),o.idToIndex[w.id]=c}for(var C=[],_=0,T=-1,N=[],c=0;c<o.nodeSize;c++){var y=o.layoutNodes[c],R=y.parentId;R!=null?o.layoutNodes[o.idToIndex[R]].children.push(y.id):(C[++T]=y.id,N.push(y.id))}for(o.graphSet.push(N);_<=T;){var D=C[_++],j=o.idToIndex[D],g=o.layoutNodes[j],O=g.children;if(O.length>0){o.graphSet.push(O);for(var c=0;c<O.length;c++)C[++T]=O[c]}}for(var c=0;c<o.graphSet.length;c++)for(var F=o.graphSet[c],p=0;p<F.length;p++){var z=o.idToIndex[F[p]];o.indexToGraph[z]=c}for(var c=0;c<o.edgeSize;c++){var G=i[c],Z={};Z.id=G.data("id"),Z.sourceId=G.data("source"),Z.targetId=G.data("target");var I=ri(n.idealEdgeLength)?n.idealEdgeLength(G):n.idealEdgeLength,W=ri(n.edgeElasticity)?n.edgeElasticity(G):n.edgeElasticity,U=o.idToIndex[Z.sourceId],K=o.idToIndex[Z.targetId],$=o.indexToGraph[U],Q=o.indexToGraph[K];if($!=Q){for(var ie=dz(Z.sourceId,Z.targetId,o),te=o.graphSet[ie],X=0,w=o.layoutNodes[U];te.indexOf(w.id)===-1;)w=o.layoutNodes[o.idToIndex[w.parentId]],X++;for(w=o.layoutNodes[K];te.indexOf(w.id)===-1;)w=o.layoutNodes[o.idToIndex[w.parentId]],X++;I*=X*n.nestingFactor}Z.idealLength=I,Z.elasticity=W,o.layoutEdges.push(Z)}return o},dz=function(e,r,n){var i=HA(e,r,0,n);return 2>i.count?0:i.graph},HA=function(e,r,n,i){var a=i.graphSet[n];if(-1<a.indexOf(e)&&-1<a.indexOf(r))return{count:2,graph:n};for(var s=0,o=0;o<a.length;o++){var l=a[o],u=i.idToIndex[l],c=i.layoutNodes[u].children;if(c.length!==0){var f=i.indexToGraph[i.idToIndex[c[0]]],p=HA(e,r,f,i);if(p.count!==0)if(p.count===1){if(s++,s===2)break}else return p}}return{count:s,graph:n}},fz,hz=function(e,r){for(var n=e.clientWidth,i=e.clientHeight,a=0;a<e.nodeSize;a++){var s=e.layoutNodes[a];s.children.length===0&&!s.isLocked&&(s.positionX=Math.random()*n,s.positionY=Math.random()*i)}},WA=function(e,r,n){var i=e.boundingBox,a={x1:1/0,x2:-1/0,y1:1/0,y2:-1/0};return r.boundingBox&&(n.forEach(function(s){var o=e.layoutNodes[e.idToIndex[s.data("id")]];a.x1=Math.min(a.x1,o.positionX),a.x2=Math.max(a.x2,o.positionX),a.y1=Math.min(a.y1,o.positionY),a.y2=Math.max(a.y2,o.positionY)}),a.w=a.x2-a.x1,a.h=a.y2-a.y1),function(s,o){var l=e.layoutNodes[e.idToIndex[s.data("id")]];if(r.boundingBox){var u=a.w===0?.5:(l.positionX-a.x1)/a.w,c=a.h===0?.5:(l.positionY-a.y1)/a.h;return{x:i.x1+u*i.w,y:i.y1+c*i.h}}else return{x:l.positionX,y:l.positionY}}},pz=function(e,r,n){var i=n.layout,a=n.eles.nodes(),s=WA(e,n,a);a.positions(s),e.ready!==!0&&(e.ready=!0,i.one("layoutready",n.ready),i.emit({type:"layoutready",layout:this}))},mz=function(e,r,n){gz(e,r),xz(e),bz(e,r),wz(e),Sz(e)},gz=function(e,r){for(var n=0;n<e.graphSet.length;n++)for(var i=e.graphSet[n],a=i.length,s=0;s<a;s++)for(var o=e.layoutNodes[e.idToIndex[i[s]]],l=s+1;l<a;l++){var u=e.layoutNodes[e.idToIndex[i[l]]];vz(o,u,e,r)}},jN=function(e){return-1+2*e*Math.random()},vz=function(e,r,n,i){var a=e.cmptId,s=r.cmptId;if(!(a!==s&&!n.isCompound)){var o=r.positionX-e.positionX,l=r.positionY-e.positionY,u=1;o===0&&l===0&&(o=jN(u),l=jN(u));var c=yz(e,r,o,l);if(c>0)var f=i.nodeOverlap*c,p=Math.sqrt(o*o+l*l),g=f*o/p,y=f*l/p;else var S=vx(e,o,l),w=vx(r,-1*o,-1*l),C=w.x-S.x,_=w.y-S.y,T=C*C+_*_,p=Math.sqrt(T),f=(e.nodeRepulsion+r.nodeRepulsion)/T,g=f*C/p,y=f*_/p;e.isLocked||(e.offsetX-=g,e.offsetY-=y),r.isLocked||(r.offsetX+=g,r.offsetY+=y)}},yz=function(e,r,n,i){if(n>0)var a=e.maxX-r.minX;else var a=r.maxX-e.minX;if(i>0)var s=e.maxY-r.minY;else var s=r.maxY-e.minY;return a>=0&&s>=0?Math.sqrt(a*a+s*s):0},vx=function(e,r,n){var i=e.positionX,a=e.positionY,s=e.height||1,o=e.width||1,l=n/r,u=s/o,c={};return r===0&&0<n||r===0&&0>n?(c.x=i,c.y=a+s/2,c):0<r&&-1*u<=l&&l<=u?(c.x=i+o/2,c.y=a+o*n/2/r,c):0>r&&-1*u<=l&&l<=u?(c.x=i-o/2,c.y=a-o*n/2/r,c):0<n&&(l<=-1*u||l>=u)?(c.x=i+s*r/2/n,c.y=a+s/2,c):(0>n&&(l<=-1*u||l>=u)&&(c.x=i-s*r/2/n,c.y=a-s/2),c)},xz=function(e,r){for(var n=0;n<e.edgeSize;n++){var i=e.layoutEdges[n],a=e.idToIndex[i.sourceId],s=e.layoutNodes[a],o=e.idToIndex[i.targetId],l=e.layoutNodes[o],u=l.positionX-s.positionX,c=l.positionY-s.positionY;if(!(u===0&&c===0)){var f=vx(s,u,c),p=vx(l,-1*u,-1*c),g=p.x-f.x,y=p.y-f.y,S=Math.sqrt(g*g+y*y),w=Math.pow(i.idealLength-S,2)/i.elasticity;if(S!==0)var C=w*g/S,_=w*y/S;else var C=0,_=0;s.isLocked||(s.offsetX+=C,s.offsetY+=_),l.isLocked||(l.offsetX-=C,l.offsetY-=_)}}},bz=function(e,r){if(r.gravity!==0)for(var n=1,i=0;i<e.graphSet.length;i++){var a=e.graphSet[i],s=a.length;if(i===0)var o=e.clientHeight/2,l=e.clientWidth/2;else var u=e.layoutNodes[e.idToIndex[a[0]]],c=e.layoutNodes[e.idToIndex[u.parentId]],o=c.positionX,l=c.positionY;for(var f=0;f<s;f++){var p=e.layoutNodes[e.idToIndex[a[f]]];if(!p.isLocked){var g=o-p.positionX,y=l-p.positionY,S=Math.sqrt(g*g+y*y);if(S>n){var w=r.gravity*g/S,C=r.gravity*y/S;p.offsetX+=w,p.offsetY+=C}}}}},wz=function(e,r){var n=[],i=0,a=-1;for(n.push.apply(n,e.graphSet[0]),a+=e.graphSet[0].length;i<=a;){var s=n[i++],o=e.idToIndex[s],l=e.layoutNodes[o],u=l.children;if(0<u.length&&!l.isLocked){for(var c=l.offsetX,f=l.offsetY,p=0;p<u.length;p++){var g=e.layoutNodes[e.idToIndex[u[p]]];g.offsetX+=c,g.offsetY+=f,n[++a]=u[p]}l.offsetX=0,l.offsetY=0}}},Sz=function(e,r){for(var n=0;n<e.nodeSize;n++){var i=e.layoutNodes[n];0<i.children.length&&(i.maxX=void 0,i.minX=void 0,i.maxY=void 0,i.minY=void 0)}for(var n=0;n<e.nodeSize;n++){var i=e.layoutNodes[n];if(!(0<i.children.length||i.isLocked)){var a=kz(i.offsetX,i.offsetY,e.temperature);i.positionX+=a.x,i.positionY+=a.y,i.offsetX=0,i.offsetY=0,i.minX=i.positionX-i.width,i.maxX=i.positionX+i.width,i.minY=i.positionY-i.height,i.maxY=i.positionY+i.height,qA(i,e)}}for(var n=0;n<e.nodeSize;n++){var i=e.layoutNodes[n];0<i.children.length&&!i.isLocked&&(i.positionX=(i.maxX+i.minX)/2,i.positionY=(i.maxY+i.minY)/2,i.width=i.maxX-i.minX,i.height=i.maxY-i.minY)}},kz=function(e,r,n){var i=Math.sqrt(e*e+r*r);if(i>n)var a={x:n*e/i,y:n*r/i};else var a={x:e,y:r};return a},qA=function(e,r){var n=e.parentId;if(n!=null){var i=r.layoutNodes[r.idToIndex[n]],a=!1;if((i.maxX==null||e.maxX+i.padRight>i.maxX)&&(i.maxX=e.maxX+i.padRight,a=!0),(i.minX==null||e.minX-i.padLeft<i.minX)&&(i.minX=e.minX-i.padLeft,a=!0),(i.maxY==null||e.maxY+i.padBottom>i.maxY)&&(i.maxY=e.maxY+i.padBottom,a=!0),(i.minY==null||e.minY-i.padTop<i.minY)&&(i.minY=e.minY-i.padTop,a=!0),a)return qA(i,r)}},FN=function(e,r){for(var n=e.layoutNodes,i=[],a=0;a<n.length;a++){var s=n[a],o=s.cmptId,l=i[o]=i[o]||[];l.push(s)}for(var u=0,a=0;a<i.length;a++){var c=i[a];if(c){c.x1=1/0,c.x2=-1/0,c.y1=1/0,c.y2=-1/0;for(var f=0;f<c.length;f++){var p=c[f];c.x1=Math.min(c.x1,p.positionX-p.width/2),c.x2=Math.max(c.x2,p.positionX+p.width/2),c.y1=Math.min(c.y1,p.positionY-p.height/2),c.y2=Math.max(c.y2,p.positionY+p.height/2)}c.w=c.x2-c.x1,c.h=c.y2-c.y1,u+=c.w*c.h}}i.sort(function(_,T){return T.w*T.h-_.w*_.h});for(var g=0,y=0,S=0,w=0,C=Math.sqrt(u)*e.clientWidth/e.clientHeight,a=0;a<i.length;a++){var c=i[a];if(c){for(var f=0;f<c.length;f++){var p=c[f];p.isLocked||(p.positionX+=g-c.x1,p.positionY+=y-c.y1)}g+=c.w+r.componentSpacing,S+=c.w+r.componentSpacing,w=Math.max(w,c.h),S>C&&(y+=w+r.componentSpacing,g=0,S=0,w=0)}}},_z={fit:!0,padding:30,boundingBox:void 0,avoidOverlap:!0,avoidOverlapPadding:10,nodeDimensionsIncludeLabels:!1,spacingFactor:void 0,condense:!1,rows:void 0,cols:void 0,position:function(e){},sort:void 0,animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function(e,r){return!0},ready:void 0,stop:void 0,transform:function(e,r){return r}};function $A(t){this.options=sr({},_z,t)}$A.prototype.run=function(){var t=this.options,e=t,r=t.cy,n=e.eles,i=n.nodes().not(":parent");e.sort&&(i=i.sort(e.sort));var a=Es(e.boundingBox?e.boundingBox:{x1:0,y1:0,w:r.width(),h:r.height()});if(a.h===0||a.w===0)n.nodes().layoutPositions(this,e,function(fe){return{x:a.x1,y:a.y1}});else{var s=i.size(),o=Math.sqrt(s*a.h/a.w),l=Math.round(o),u=Math.round(a.w/a.h*o),c=function(oe){if(oe==null)return Math.min(l,u);var se=Math.min(l,u);se==l?l=oe:u=oe},f=function(oe){if(oe==null)return Math.max(l,u);var se=Math.max(l,u);se==l?l=oe:u=oe},p=e.rows,g=e.cols!=null?e.cols:e.columns;if(p!=null&&g!=null)l=p,u=g;else if(p!=null&&g==null)l=p,u=Math.ceil(s/l);else if(p==null&&g!=null)u=g,l=Math.ceil(s/u);else if(u*l>s){var y=c(),S=f();(y-1)*S>=s?c(y-1):(S-1)*y>=s&&f(S-1)}else for(;u*l<s;){var w=c(),C=f();(C+1)*w>=s?f(C+1):c(w+1)}var _=a.w/u,T=a.h/l;if(e.condense&&(_=0,T=0),e.avoidOverlap)for(var N=0;N<i.length;N++){var R=i[N],D=R._private.position;(D.x==null||D.y==null)&&(D.x=0,D.y=0);var j=R.layoutDimensions(e),O=e.avoidOverlapPadding,F=j.w+O,z=j.h+O;_=Math.max(_,F),T=Math.max(T,z)}for(var G={},Z=function(oe,se){return!!G["c-"+oe+"-"+se]},I=function(oe,se){G["c-"+oe+"-"+se]=!0},W=0,U=0,K=function(){U++,U>=u&&(U=0,W++)},$={},Q=0;Q<i.length;Q++){var ie=i[Q],te=e.position(ie);if(te&&(te.row!==void 0||te.col!==void 0)){var X={row:te.row,col:te.col};if(X.col===void 0)for(X.col=0;Z(X.row,X.col);)X.col++;else if(X.row===void 0)for(X.row=0;Z(X.row,X.col);)X.row++;$[ie.id()]=X,I(X.row,X.col)}}var re=function(oe,se){var he,ae;if(oe.locked()||oe.isParent())return!1;var pe=$[oe.id()];if(pe)he=pe.col*_+_/2+a.x1,ae=pe.row*T+T/2+a.y1;else{for(;Z(W,U);)K();he=U*_+_/2+a.x1,ae=W*T+T/2+a.y1,I(W,U),K()}return{x:he,y:ae}};i.layoutPositions(this,e,re)}return this};var Cz={ready:function(){},stop:function(){}};function w_(t){this.options=sr({},Cz,t)}w_.prototype.run=function(){var t=this.options,e=t.eles,r=this;return t.cy,r.emit("layoutstart"),e.nodes().positions(function(){return{x:0,y:0}}),r.one("layoutready",t.ready),r.emit("layoutready"),r.one("layoutstop",t.stop),r.emit("layoutstop"),this};w_.prototype.stop=function(){return this};var Ez={positions:void 0,zoom:void 0,pan:void 0,fit:!0,padding:30,spacingFactor:void 0,animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function(e,r){return!0},ready:void 0,stop:void 0,transform:function(e,r){return r}};function KA(t){this.options=sr({},Ez,t)}KA.prototype.run=function(){var t=this.options,e=t.eles,r=e.nodes(),n=ri(t.positions);function i(a){if(t.positions==null)return K9(a.position());if(n)return t.positions(a);var s=t.positions[a._private.data.id];return s??null}return r.layoutPositions(this,t,function(a,s){var o=i(a);return a.locked()||o==null?!1:o}),this};var Tz={fit:!0,padding:30,boundingBox:void 0,animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function(e,r){return!0},ready:void 0,stop:void 0,transform:function(e,r){return r}};function ZA(t){this.options=sr({},Tz,t)}ZA.prototype.run=function(){var t=this.options,e=t.cy,r=t.eles,n=Es(t.boundingBox?t.boundingBox:{x1:0,y1:0,w:e.width(),h:e.height()}),i=function(s,o){return{x:n.x1+Math.round(Math.random()*n.w),y:n.y1+Math.round(Math.random()*n.h)}};return r.nodes().layoutPositions(this,t,i),this};var Nz=[{name:"breadthfirst",impl:UA},{name:"circle",impl:GA},{name:"concentric",impl:VA},{name:"cose",impl:z1},{name:"grid",impl:$A},{name:"null",impl:w_},{name:"preset",impl:KA},{name:"random",impl:ZA}];function YA(t){this.options=t,this.notifications=0}var BN=function(){},zN=function(){throw new Error("A headless instance can not render images")};YA.prototype={recalculateRenderedStyle:BN,notify:function(){this.notifications++},init:BN,isHeadless:function(){return!0},png:zN,jpg:zN};var S_={};S_.arrowShapeWidth=.3;S_.registerArrowShapes=function(){var t=this.arrowShapes={},e=this,r=function(u,c,f,p,g,y,S){var w=g.x-f/2-S,C=g.x+f/2+S,_=g.y-f/2-S,T=g.y+f/2+S,N=w<=u&&u<=C&&_<=c&&c<=T;return N},n=function(u,c,f,p,g){var y=u*Math.cos(p)-c*Math.sin(p),S=u*Math.sin(p)+c*Math.cos(p),w=y*f,C=S*f,_=w+g.x,T=C+g.y;return{x:_,y:T}},i=function(u,c,f,p){for(var g=[],y=0;y<u.length;y+=2){var S=u[y],w=u[y+1];g.push(n(S,w,c,f,p))}return g},a=function(u){for(var c=[],f=0;f<u.length;f++){var p=u[f];c.push(p.x,p.y)}return c},s=function(u){return u.pstyle("width").pfValue*u.pstyle("arrow-scale").pfValue*2},o=function(u,c){Yt(c)&&(c=t[c]),t[u]=sr({name:u,points:[-.15,-.3,.15,-.3,.15,.3,-.15,.3],collide:function(p,g,y,S,w,C){var _=a(i(this.points,y+2*C,S,w)),T=Ks(p,g,_);return T},roughCollide:r,draw:function(p,g,y,S){var w=i(this.points,g,y,S);e.arrowShapeImpl("polygon")(p,w)},spacing:function(p){return 0},gap:s},c)};o("none",{collide:dx,roughCollide:dx,draw:o_,spacing:eT,gap:eT}),o("triangle",{points:[-.15,-.3,0,0,.15,-.3]}),o("arrow","triangle"),o("triangle-backcurve",{points:t.triangle.points,controlPoint:[0,-.15],roughCollide:r,draw:function(u,c,f,p,g){var y=i(this.points,c,f,p),S=this.controlPoint,w=n(S[0],S[1],c,f,p);e.arrowShapeImpl(this.name)(u,y,w)},gap:function(u){return s(u)*.8}}),o("triangle-tee",{points:[0,0,.15,-.3,-.15,-.3,0,0],pointsTee:[-.15,-.4,-.15,-.5,.15,-.5,.15,-.4],collide:function(u,c,f,p,g,y,S){var w=a(i(this.points,f+2*S,p,g)),C=a(i(this.pointsTee,f+2*S,p,g)),_=Ks(u,c,w)||Ks(u,c,C);return _},draw:function(u,c,f,p,g){var y=i(this.points,c,f,p),S=i(this.pointsTee,c,f,p);e.arrowShapeImpl(this.name)(u,y,S)}}),o("circle-triangle",{radius:.15,pointsTr:[0,-.15,.15,-.45,-.15,-.45,0,-.15],collide:function(u,c,f,p,g,y,S){var w=g,C=Math.pow(w.x-u,2)+Math.pow(w.y-c,2)<=Math.pow((f+2*S)*this.radius,2),_=a(i(this.points,f+2*S,p,g));return Ks(u,c,_)||C},draw:function(u,c,f,p,g){var y=i(this.pointsTr,c,f,p);e.arrowShapeImpl(this.name)(u,y,p.x,p.y,this.radius*c)},spacing:function(u){return e.getArrowWidth(u.pstyle("width").pfValue,u.pstyle("arrow-scale").value)*this.radius}}),o("triangle-cross",{points:[0,0,.15,-.3,-.15,-.3,0,0],baseCrossLinePts:[-.15,-.4,-.15,-.4,.15,-.4,.15,-.4],crossLinePts:function(u,c){var f=this.baseCrossLinePts.slice(),p=c/u,g=3,y=5;return f[g]=f[g]-p,f[y]=f[y]-p,f},collide:function(u,c,f,p,g,y,S){var w=a(i(this.points,f+2*S,p,g)),C=a(i(this.crossLinePts(f,y),f+2*S,p,g)),_=Ks(u,c,w)||Ks(u,c,C);return _},draw:function(u,c,f,p,g){var y=i(this.points,c,f,p),S=i(this.crossLinePts(c,g),c,f,p);e.arrowShapeImpl(this.name)(u,y,S)}}),o("vee",{points:[-.15,-.3,0,0,.15,-.3,0,-.15],gap:function(u){return s(u)*.525}}),o("circle",{radius:.15,collide:function(u,c,f,p,g,y,S){var w=g,C=Math.pow(w.x-u,2)+Math.pow(w.y-c,2)<=Math.pow((f+2*S)*this.radius,2);return C},draw:function(u,c,f,p,g){e.arrowShapeImpl(this.name)(u,p.x,p.y,this.radius*c)},spacing:function(u){return e.getArrowWidth(u.pstyle("width").pfValue,u.pstyle("arrow-scale").value)*this.radius}}),o("tee",{points:[-.15,0,-.15,-.1,.15,-.1,.15,0],spacing:function(u){return 1},gap:function(u){return 1}}),o("square",{points:[-.15,0,.15,0,.15,-.3,-.15,-.3]}),o("diamond",{points:[-.15,-.15,0,-.3,.15,-.15,0,0],gap:function(u){return u.pstyle("width").pfValue*u.pstyle("arrow-scale").value}}),o("chevron",{points:[0,0,-.15,-.15,-.1,-.2,0,-.1,.1,-.2,.15,-.15],gap:function(u){return .95*u.pstyle("width").pfValue*u.pstyle("arrow-scale").value}})};var Nh={};Nh.projectIntoViewport=function(t,e){var r=this.cy,n=this.findContainerClientCoords(),i=n[0],a=n[1],s=n[4],o=r.pan(),l=r.zoom(),u=((t-i)/s-o.x)/l,c=((e-a)/s-o.y)/l;return[u,c]};Nh.findContainerClientCoords=function(){if(this.containerBB)return this.containerBB;var t=this.container,e=t.getBoundingClientRect(),r=this.cy.window().getComputedStyle(t),n=function(C){return parseFloat(r.getPropertyValue(C))},i={left:n("padding-left"),right:n("padding-right"),top:n("padding-top"),bottom:n("padding-bottom")},a={left:n("border-left-width"),right:n("border-right-width"),top:n("border-top-width"),bottom:n("border-bottom-width")},s=t.clientWidth,o=t.clientHeight,l=i.left+i.right,u=i.top+i.bottom,c=a.left+a.right,f=e.width/(s+c),p=s-l,g=o-u,y=e.left+i.left+a.left,S=e.top+i.top+a.top;return this.containerBB=[y,S,p,g,f]};Nh.invalidateContainerClientCoordsCache=function(){this.containerBB=null};Nh.findNearestElement=function(t,e,r,n){return this.findNearestElements(t,e,r,n)[0]};Nh.findNearestElements=function(t,e,r,n){var i=this,a=this,s=a.getCachedZSortedEles(),o=[],l=a.cy.zoom(),u=a.cy.hasCompoundNodes(),c=(n?24:8)/l,f=(n?8:2)/l,p=(n?8:2)/l,g=1/0,y,S;r&&(s=s.interactive);function w(j,O){if(j.isNode()){if(S)return;S=j,o.push(j)}if(j.isEdge()&&(O==null||O<g))if(y){if(y.pstyle("z-compound-depth").value===j.pstyle("z-compound-depth").value&&y.pstyle("z-compound-depth").value===j.pstyle("z-compound-depth").value){for(var F=0;F<o.length;F++)if(o[F].isEdge()){o[F]=j,y=j,g=O??g;break}}}else o.push(j),y=j,g=O??g}function C(j){var O=j.outerWidth()+2*f,F=j.outerHeight()+2*f,z=O/2,G=F/2,Z=j.position(),I=j.pstyle("corner-radius").value==="auto"?"auto":j.pstyle("corner-radius").pfValue,W=j._private.rscratch;if(Z.x-z<=t&&t<=Z.x+z&&Z.y-G<=e&&e<=Z.y+G){var U=a.nodeShapes[i.getNodeShape(j)];if(U.checkPoint(t,e,0,O,F,Z.x,Z.y,I,W))return w(j,0),!0}}function _(j){var O=j._private,F=O.rscratch,z=j.pstyle("width").pfValue,G=j.pstyle("arrow-scale").value,Z=z/2+c,I=Z*Z,W=Z*2,Q=O.source,ie=O.target,U;if(F.edgeType==="segments"||F.edgeType==="straight"||F.edgeType==="haystack"){for(var K=F.allpts,$=0;$+3<K.length;$+=2)if(lF(t,e,K[$],K[$+1],K[$+2],K[$+3],W)&&I>(U=hF(t,e,K[$],K[$+1],K[$+2],K[$+3])))return w(j,U),!0}else if(F.edgeType==="bezier"||F.edgeType==="multibezier"||F.edgeType==="self"||F.edgeType==="compound"){for(var K=F.allpts,$=0;$+5<F.allpts.length;$+=4)if(uF(t,e,K[$],K[$+1],K[$+2],K[$+3],K[$+4],K[$+5],W)&&I>(U=fF(t,e,K[$],K[$+1],K[$+2],K[$+3],K[$+4],K[$+5])))return w(j,U),!0}for(var Q=Q||O.source,ie=ie||O.target,te=i.getArrowWidth(z,G),X=[{name:"source",x:F.arrowStartX,y:F.arrowStartY,angle:F.srcArrowAngle},{name:"target",x:F.arrowEndX,y:F.arrowEndY,angle:F.tgtArrowAngle},{name:"mid-source",x:F.midX,y:F.midY,angle:F.midsrcArrowAngle},{name:"mid-target",x:F.midX,y:F.midY,angle:F.midtgtArrowAngle}],$=0;$<X.length;$++){var re=X[$],fe=a.arrowShapes[j.pstyle(re.name+"-arrow-shape").value],oe=j.pstyle("width").pfValue;if(fe.roughCollide(t,e,te,re.angle,{x:re.x,y:re.y},oe,c)&&fe.collide(t,e,te,re.angle,{x:re.x,y:re.y},oe,c))return w(j),!0}u&&o.length>0&&(C(Q),C(ie))}function T(j,O,F){return $s(j,O,F)}function N(j,O){var F=j._private,z=p,G;O?G=O+"-":G="",j.boundingBox();var Z=F.labelBounds[O||"main"],I=j.pstyle(G+"label").value,W=j.pstyle("text-events").strValue==="yes";if(!(!W||!I)){var U=T(F.rscratch,"labelX",O),K=T(F.rscratch,"labelY",O),$=T(F.rscratch,"labelAngle",O),Q=j.pstyle(G+"text-margin-x").pfValue,ie=j.pstyle(G+"text-margin-y").pfValue,te=Z.x1-z-Q,X=Z.x2+z-Q,re=Z.y1-z-ie,fe=Z.y2+z-ie;if($){var oe=Math.cos($),se=Math.sin($),he=function(Se,Ae){return Se=Se-U,Ae=Ae-K,{x:Se*oe-Ae*se+U,y:Se*se+Ae*oe+K}},ae=he(te,re),pe=he(te,fe),ye=he(X,re),ve=he(X,fe),ue=[ae.x+Q,ae.y+ie,ye.x+Q,ye.y+ie,ve.x+Q,ve.y+ie,pe.x+Q,pe.y+ie];if(Ks(t,e,ue))return w(j),!0}else if(Od(Z,t,e))return w(j),!0}}for(var R=s.length-1;R>=0;R--){var D=s[R];D.isNode()?C(D)||N(D):_(D)||N(D)||N(D,"source")||N(D,"target")}return o};Nh.getAllInBox=function(t,e,r,n){var i=this.getCachedZSortedEles().interactive,a=this.cy.zoom(),s=2/a,o=[],l=Math.min(t,r),u=Math.max(t,r),c=Math.min(e,n),f=Math.max(e,n);t=l,r=u,e=c,n=f;var p=Es({x1:t,y1:e,x2:r,y2:n}),g=[{x:p.x1,y:p.y1},{x:p.x2,y:p.y1},{x:p.x2,y:p.y2},{x:p.x1,y:p.y2}],y=[[g[0],g[1]],[g[1],g[2]],[g[2],g[3]],[g[3],g[0]]];function S(Se,Ae,Me){return $s(Se,Ae,Me)}function w(Se,Ae){var Me=Se._private,st=s,rt="";Se.boundingBox();var dt=Me.labelBounds.main;if(!dt)return null;var Ct=S(Me.rscratch,"labelX",Ae),Ke=S(Me.rscratch,"labelY",Ae),ut=S(Me.rscratch,"labelAngle",Ae),ct=Se.pstyle(rt+"text-margin-x").pfValue,xt=Se.pstyle(rt+"text-margin-y").pfValue,ot=dt.x1-st-ct,Lt=dt.x2+st-ct,Bt=dt.y1-st-xt,Ne=dt.y2+st-xt;if(ut){var qe=Math.cos(ut),St=Math.sin(ut),it=function(Ie,de){return Ie=Ie-Ct,de=de-Ke,{x:Ie*qe-de*St+Ct,y:Ie*St+de*qe+Ke}};return[it(ot,Bt),it(Lt,Bt),it(Lt,Ne),it(ot,Ne)]}else return[{x:ot,y:Bt},{x:Lt,y:Bt},{x:Lt,y:Ne},{x:ot,y:Ne}]}function C(Se,Ae,Me,st){function rt(dt,Ct,Ke){return(Ke.y-dt.y)*(Ct.x-dt.x)>(Ct.y-dt.y)*(Ke.x-dt.x)}return rt(Se,Me,st)!==rt(Ae,Me,st)&&rt(Se,Ae,Me)!==rt(Se,Ae,st)}for(var _=0;_<i.length;_++){var T=i[_];if(T.isNode()){var N=T,R=N.pstyle("text-events").strValue==="yes",D=N.pstyle("box-selection").strValue,j=N.pstyle("box-select-labels").strValue==="yes";if(D==="none")continue;var O=(D==="overlap"||j)&&R,F=N.boundingBox({includeNodes:!0,includeEdges:!1,includeLabels:O});if(D==="contain"){var z=!1;if(j&&R){var G=w(N);G&&pw(G,g)&&(o.push(N),z=!0)}!z&&nA(p,F)&&o.push(N)}else if(D==="overlap"&&d_(p,F)){var Z=N.boundingBox({includeNodes:!0,includeEdges:!0,includeLabels:!1,includeMainLabels:!1,includeSourceLabels:!1,includeTargetLabels:!1}),I=[{x:Z.x1,y:Z.y1},{x:Z.x2,y:Z.y1},{x:Z.x2,y:Z.y2},{x:Z.x1,y:Z.y2}];if(pw(I,g))o.push(N);else{var W=w(N);W&&pw(W,g)&&o.push(N)}}}else{var U=T,K=U._private,$=K.rscratch,Q=U.pstyle("box-selection").strValue;if(Q==="none")continue;if(Q==="contain"){if($.startX!=null&&$.startY!=null&&!Od(p,$.startX,$.startY)||$.endX!=null&&$.endY!=null&&!Od(p,$.endX,$.endY))continue;if($.edgeType==="bezier"||$.edgeType==="multibezier"||$.edgeType==="self"||$.edgeType==="compound"||$.edgeType==="segments"||$.edgeType==="haystack"){for(var ie=K.rstyle.bezierPts||K.rstyle.linePts||K.rstyle.haystackPts,te=!0,X=0;X<ie.length;X++)if(!aT(p,ie[X])){te=!1;break}te&&o.push(U)}else $.edgeType==="straight"&&o.push(U)}else if(Q==="overlap"){var re=!1;if($.startX!=null&&$.startY!=null&&$.endX!=null&&$.endY!=null&&(Od(p,$.startX,$.startY)||Od(p,$.endX,$.endY)))o.push(U),re=!0;else if(!re&&$.edgeType==="haystack"){for(var fe=K.rstyle.haystackPts,oe=0;oe<fe.length;oe++)if(aT(p,fe[oe])){o.push(U),re=!0;break}}if(!re){var se=K.rstyle.bezierPts||K.rstyle.linePts||K.rstyle.haystackPts;if((!se||se.length<2)&&$.edgeType==="straight"&&$.startX!=null&&$.startY!=null&&$.endX!=null&&$.endY!=null&&(se=[{x:$.startX,y:$.startY},{x:$.endX,y:$.endY}]),!se||se.length<2)continue;for(var he=0;he<se.length-1;he++){for(var ae=se[he],pe=se[he+1],ye=0;ye<y.length;ye++){var ve=Di(y[ye],2),ue=ve[0],xe=ve[1];if(C(ae,pe,ue,xe)){o.push(U),re=!0;break}}if(re)break}}}}}return o};var yx={};yx.calculateArrowAngles=function(t){var e=t._private.rscratch,r=e.edgeType==="haystack",n=e.edgeType==="bezier",i=e.edgeType==="multibezier",a=e.edgeType==="segments",s=e.edgeType==="compound",o=e.edgeType==="self",l,u,c,f,p,g,C,_;if(r?(c=e.haystackPts[0],f=e.haystackPts[1],p=e.haystackPts[2],g=e.haystackPts[3]):(c=e.arrowStartX,f=e.arrowStartY,p=e.arrowEndX,g=e.arrowEndY),C=e.midX,_=e.midY,a)l=c-e.segpts[0],u=f-e.segpts[1];else if(i||s||o||n){var y=e.allpts,S=da(y[0],y[2],y[4],.1),w=da(y[1],y[3],y[5],.1);l=c-S,u=f-w}else l=c-C,u=f-_;e.srcArrowAngle=ty(l,u);var C=e.midX,_=e.midY;if(r&&(C=(c+p)/2,_=(f+g)/2),l=p-c,u=g-f,a){var y=e.allpts;if(y.length/2%2===0){var T=y.length/2,N=T-2;l=y[T]-y[N],u=y[T+1]-y[N+1]}else if(e.isRound)l=e.midVector[1],u=-e.midVector[0];else{var T=y.length/2-1,N=T-2;l=y[T]-y[N],u=y[T+1]-y[N+1]}}else if(i||s||o){var y=e.allpts,R=e.ctrlpts,D,j,O,F;if(R.length/2%2===0){var z=y.length/2-1,G=z+2,Z=G+2;D=da(y[z],y[G],y[Z],0),j=da(y[z+1],y[G+1],y[Z+1],0),O=da(y[z],y[G],y[Z],1e-4),F=da(y[z+1],y[G+1],y[Z+1],1e-4)}else{var G=y.length/2-1,z=G-2,Z=G+2;D=da(y[z],y[G],y[Z],.4999),j=da(y[z+1],y[G+1],y[Z+1],.4999),O=da(y[z],y[G],y[Z],.5),F=da(y[z+1],y[G+1],y[Z+1],.5)}l=O-D,u=F-j}if(e.midtgtArrowAngle=ty(l,u),e.midDispX=l,e.midDispY=u,l*=-1,u*=-1,a){var y=e.allpts;if(y.length/2%2!==0){if(!e.isRound){var T=y.length/2-1,I=T+2;l=-(y[I]-y[T]),u=-(y[I+1]-y[T+1])}}}if(e.midsrcArrowAngle=ty(l,u),a)l=p-e.segpts[e.segpts.length-2],u=g-e.segpts[e.segpts.length-1];else if(i||s||o||n){var y=e.allpts,W=y.length,S=da(y[W-6],y[W-4],y[W-2],.9),w=da(y[W-5],y[W-3],y[W-1],.9);l=p-S,u=g-w}else l=p-C,u=g-_;e.tgtArrowAngle=ty(l,u)};yx.getArrowWidth=yx.getArrowHeight=function(t,e){var r=this.arrowWidthCache=this.arrowWidthCache||{},n=r[t+", "+e];return n||(n=Math.max(Math.pow(t*13.37,.9),29)*e,r[t+", "+e]=n,n)};var XS,QS,xu={},qo={},UN,GN,Qf,qy,nc,Gf,Zf,vu,mp,uy,XA,QA,JS,ek,VN,HN=function(e,r,n){n.x=r.x-e.x,n.y=r.y-e.y,n.len=Math.sqrt(n.x*n.x+n.y*n.y),n.nx=n.x/n.len,n.ny=n.y/n.len,n.ang=Math.atan2(n.ny,n.nx)},Pz=function(e,r){r.x=e.x*-1,r.y=e.y*-1,r.nx=e.nx*-1,r.ny=e.ny*-1,r.ang=e.ang>0?-(Math.PI-e.ang):Math.PI+e.ang},Mz=function(e,r,n,i,a){if(e!==VN?HN(r,e,xu):Pz(qo,xu),HN(r,n,qo),UN=xu.nx*qo.ny-xu.ny*qo.nx,GN=xu.nx*qo.nx-xu.ny*-qo.ny,nc=Math.asin(Math.max(-1,Math.min(1,UN))),Math.abs(nc)<1e-6){XS=r.x,QS=r.y,Zf=mp=0;return}Qf=1,qy=!1,GN<0?nc<0?nc=Math.PI+nc:(nc=Math.PI-nc,Qf=-1,qy=!0):nc>0&&(Qf=-1,qy=!0),r.radius!==void 0?mp=r.radius:mp=i,Gf=nc/2,uy=Math.min(xu.len/2,qo.len/2),a?(vu=Math.abs(Math.cos(Gf)*mp/Math.sin(Gf)),vu>uy?(vu=uy,Zf=Math.abs(vu*Math.sin(Gf)/Math.cos(Gf))):Zf=mp):(vu=Math.min(uy,mp),Zf=Math.abs(vu*Math.sin(Gf)/Math.cos(Gf))),JS=r.x+qo.nx*vu,ek=r.y+qo.ny*vu,XS=JS-qo.ny*Zf*Qf,QS=ek+qo.nx*Zf*Qf,XA=r.x+xu.nx*vu,QA=r.y+xu.ny*vu,VN=r};function JA(t,e){e.radius===0?t.lineTo(e.cx,e.cy):t.arc(e.cx,e.cy,e.radius,e.startAngle,e.endAngle,e.counterClockwise)}function k_(t,e,r,n){var i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0;return n===0||e.radius===0?{cx:e.x,cy:e.y,radius:0,startX:e.x,startY:e.y,stopX:e.x,stopY:e.y,startAngle:void 0,endAngle:void 0,counterClockwise:void 0}:(Mz(t,e,r,n,i),{cx:XS,cy:QS,radius:Zf,startX:XA,startY:QA,stopX:JS,stopY:ek,startAngle:xu.ang+Math.PI/2*Qf,endAngle:qo.ang-Math.PI/2*Qf,counterClockwise:qy})}var Mv=.01,Az=Math.sqrt(2*Mv),us={};us.findMidptPtsEtc=function(t,e){var r=e.posPts,n=e.intersectionPts,i=e.vectorNormInverse,a,s=t.pstyle("source-endpoint"),o=t.pstyle("target-endpoint"),l=s.units!=null&&o.units!=null,u=function(R,D,j,O){var F=O-D,z=j-R,G=Math.sqrt(z*z+F*F);return{x:-F/G,y:z/G}},c=t.pstyle("edge-distances").value;switch(c){case"node-position":a=r;break;case"intersection":a=n;break;case"endpoints":{if(l){var f=this.manualEndptToPx(t.source()[0],s),p=Di(f,2),g=p[0],y=p[1],S=this.manualEndptToPx(t.target()[0],o),w=Di(S,2),C=w[0],_=w[1],T={x1:g,y1:y,x2:C,y2:_};i=u(g,y,C,_),a=T}else an("Edge ".concat(t.id()," has edge-distances:endpoints specified without manual endpoints specified via source-endpoint and target-endpoint.  Falling back on edge-distances:intersection (default).")),a=n;break}}return{midptPts:a,vectorNormInverse:i}};us.findHaystackPoints=function(t){for(var e=0;e<t.length;e++){var r=t[e],n=r._private,i=n.rscratch;if(!i.haystack){var a=Math.random()*2*Math.PI;i.source={x:Math.cos(a),y:Math.sin(a)},a=Math.random()*2*Math.PI,i.target={x:Math.cos(a),y:Math.sin(a)}}var s=n.source,o=n.target,l=s.position(),u=o.position(),c=s.width(),f=o.width(),p=s.height(),g=o.height(),y=r.pstyle("haystack-radius").value,S=y/2;i.haystackPts=i.allpts=[i.source.x*c*S+l.x,i.source.y*p*S+l.y,i.target.x*f*S+u.x,i.target.y*g*S+u.y],i.midX=(i.allpts[0]+i.allpts[2])/2,i.midY=(i.allpts[1]+i.allpts[3])/2,i.edgeType="haystack",i.haystack=!0,this.storeEdgeProjections(r),this.calculateArrowAngles(r),this.recalculateEdgeLabelProjections(r),this.calculateLabelAngles(r)}};us.findSegmentsPoints=function(t,e){var r=t._private.rscratch,n=t.pstyle("segment-weights"),i=t.pstyle("segment-distances"),a=t.pstyle("segment-radii"),s=t.pstyle("radius-type"),o=Math.min(n.pfValue.length,i.pfValue.length),l=a.pfValue[a.pfValue.length-1],u=s.pfValue[s.pfValue.length-1];r.edgeType="segments",r.segpts=[],r.radii=[],r.isArcRadius=[];for(var c=0;c<o;c++){var f=n.pfValue[c],p=i.pfValue[c],g=1-f,y=f,S=this.findMidptPtsEtc(t,e),w=S.midptPts,C=S.vectorNormInverse,_={x:w.x1*g+w.x2*y,y:w.y1*g+w.y2*y};r.segpts.push(_.x+C.x*p,_.y+C.y*p),r.radii.push(a.pfValue[c]!==void 0?a.pfValue[c]:l),r.isArcRadius.push((s.pfValue[c]!==void 0?s.pfValue[c]:u)==="arc-radius")}};us.findLoopPoints=function(t,e,r,n){var i=t._private.rscratch,a=e.dirCounts,s=e.srcPos,o=t.pstyle("control-point-distances"),l=o?o.pfValue[0]:void 0,u=t.pstyle("loop-direction").pfValue,c=t.pstyle("loop-sweep").pfValue,f=t.pstyle("control-point-step-size").pfValue;i.edgeType="self";var p=r,g=f;n&&(p=0,g=l);var y=u-Math.PI/2,S=y-c/2,w=y+c/2,C=u+"_"+c;p=a[C]===void 0?a[C]=0:++a[C],i.ctrlpts=[s.x+Math.cos(S)*1.4*g*(p/3+1),s.y+Math.sin(S)*1.4*g*(p/3+1),s.x+Math.cos(w)*1.4*g*(p/3+1),s.y+Math.sin(w)*1.4*g*(p/3+1)]};us.findCompoundLoopPoints=function(t,e,r,n){var i=t._private.rscratch;i.edgeType="compound";var a=e.srcPos,s=e.tgtPos,o=e.srcW,l=e.srcH,u=e.tgtW,c=e.tgtH,f=t.pstyle("control-point-step-size").pfValue,p=t.pstyle("control-point-distances"),g=p?p.pfValue[0]:void 0,y=r,S=f;n&&(y=0,S=g);var w=50,C={x:a.x-o/2,y:a.y-l/2},_={x:s.x-u/2,y:s.y-c/2},T={x:Math.min(C.x,_.x),y:Math.min(C.y,_.y)},N=.5,R=Math.max(N,Math.log(o*Mv)),D=Math.max(N,Math.log(u*Mv));i.ctrlpts=[T.x,T.y-(1+Math.pow(w,1.12)/100)*S*(y/3+1)*R,T.x-(1+Math.pow(w,1.12)/100)*S*(y/3+1)*D,T.y]};us.findStraightEdgePoints=function(t){t._private.rscratch.edgeType="straight"};us.findBezierPoints=function(t,e,r,n,i){var a=t._private.rscratch,s=t.pstyle("control-point-step-size").pfValue,o=t.pstyle("control-point-distances"),l=t.pstyle("control-point-weights"),u=o&&l?Math.min(o.value.length,l.value.length):1,c=o?o.pfValue[0]:void 0,f=l.value[0],p=n;a.edgeType=p?"multibezier":"bezier",a.ctrlpts=[];for(var g=0;g<u;g++){var y=(.5-e.eles.length/2+r)*s*(i?-1:1),S=void 0,w=c_(y);p&&(c=o?o.pfValue[g]:s,f=l.value[g]),n?S=c:S=c!==void 0?w*c:void 0;var C=S!==void 0?S:y,_=1-f,T=f,N=this.findMidptPtsEtc(t,e),R=N.midptPts,D=N.vectorNormInverse,j={x:R.x1*_+R.x2*T,y:R.y1*_+R.y2*T};a.ctrlpts.push(j.x+D.x*C,j.y+D.y*C)}};us.findTaxiPoints=function(t,e){var r=t._private.rscratch;r.edgeType="segments";var n="vertical",i="horizontal",a="leftward",s="rightward",o="downward",l="upward",u="auto",c=e.posPts,f=e.srcW,p=e.srcH,g=e.tgtW,y=e.tgtH,S=t.pstyle("edge-distances").value,w=S!=="node-position",C=t.pstyle("taxi-direction").value,_=C,T=t.pstyle("taxi-turn"),N=T.units==="%",R=T.pfValue,D=R<0,j=t.pstyle("taxi-turn-min-distance").pfValue,O=w?(f+g)/2:0,F=w?(p+y)/2:0,z=c.x2-c.x1,G=c.y2-c.y1,Z=function(de,ge){return de>0?Math.max(de-ge,0):Math.min(de+ge,0)},I=Z(z,O),W=Z(G,F),U=!1;_===u?C=Math.abs(I)>Math.abs(W)?i:n:_===l||_===o?(C=n,U=!0):(_===a||_===s)&&(C=i,U=!0);var K=C===n,$=K?W:I,Q=K?G:z,ie=c_(Q),te=!1;!(U&&(N||D))&&(_===o&&Q<0||_===l&&Q>0||_===a&&Q>0||_===s&&Q<0)&&(ie*=-1,$=ie*Math.abs($),te=!0);var X;if(N){var re=R<0?1+R:R;X=re*$}else{var fe=R<0?$:0;X=fe+R*ie}var oe=function(de){return Math.abs(de)<j||Math.abs(de)>=Math.abs($)},se=oe(X),he=oe(Math.abs($)-Math.abs(X)),ae=se||he;if(ae&&!te)if(K){var pe=Math.abs(Q)<=p/2,ye=Math.abs(z)<=g/2;if(pe){var ve=(c.x1+c.x2)/2,ue=c.y1,xe=c.y2;r.segpts=[ve,ue,ve,xe]}else if(ye){var Se=(c.y1+c.y2)/2,Ae=c.x1,Me=c.x2;r.segpts=[Ae,Se,Me,Se]}else r.segpts=[c.x1,c.y2]}else{var st=Math.abs(Q)<=f/2,rt=Math.abs(G)<=y/2;if(st){var dt=(c.y1+c.y2)/2,Ct=c.x1,Ke=c.x2;r.segpts=[Ct,dt,Ke,dt]}else if(rt){var ut=(c.x1+c.x2)/2,ct=c.y1,xt=c.y2;r.segpts=[ut,ct,ut,xt]}else r.segpts=[c.x2,c.y1]}else if(K){var ot=c.y1+X+(w?p/2*ie:0),Lt=c.x1,Bt=c.x2;r.segpts=[Lt,ot,Bt,ot]}else{var Ne=c.x1+X+(w?f/2*ie:0),qe=c.y1,St=c.y2;r.segpts=[Ne,qe,Ne,St]}if(r.isRound){var it=t.pstyle("taxi-radius").value,lt=t.pstyle("radius-type").value[0]==="arc-radius";r.radii=new Array(r.segpts.length/2).fill(it),r.isArcRadius=new Array(r.segpts.length/2).fill(lt)}};us.tryToCorrectInvalidPoints=function(t,e){var r=t._private.rscratch;if(r.edgeType==="bezier"){var n=e.srcPos,i=e.tgtPos,a=e.srcW,s=e.srcH,o=e.tgtW,l=e.tgtH,u=e.srcShape,c=e.tgtShape,f=e.srcCornerRadius,p=e.tgtCornerRadius,g=e.srcRs,y=e.tgtRs,S=!_t(r.startX)||!_t(r.startY),w=!_t(r.arrowStartX)||!_t(r.arrowStartY),C=!_t(r.endX)||!_t(r.endY),_=!_t(r.arrowEndX)||!_t(r.arrowEndY),T=3,N=this.getArrowWidth(t.pstyle("width").pfValue,t.pstyle("arrow-scale").value)*this.arrowShapeWidth,R=T*N,D=mh({x:r.ctrlpts[0],y:r.ctrlpts[1]},{x:r.startX,y:r.startY}),j=D<R,O=mh({x:r.ctrlpts[0],y:r.ctrlpts[1]},{x:r.endX,y:r.endY}),F=O<R,z=!1;if(S||w||j){z=!0;var G={x:r.ctrlpts[0]-n.x,y:r.ctrlpts[1]-n.y},Z=Math.sqrt(G.x*G.x+G.y*G.y),I={x:G.x/Z,y:G.y/Z},W=Math.max(a,s),U={x:r.ctrlpts[0]+I.x*2*W,y:r.ctrlpts[1]+I.y*2*W},K=u.intersectLine(n.x,n.y,a,s,U.x,U.y,0,f,g);j?(r.ctrlpts[0]=r.ctrlpts[0]+I.x*(R-D),r.ctrlpts[1]=r.ctrlpts[1]+I.y*(R-D)):(r.ctrlpts[0]=K[0]+I.x*R,r.ctrlpts[1]=K[1]+I.y*R)}if(C||_||F){z=!0;var $={x:r.ctrlpts[0]-i.x,y:r.ctrlpts[1]-i.y},Q=Math.sqrt($.x*$.x+$.y*$.y),ie={x:$.x/Q,y:$.y/Q},te=Math.max(a,s),X={x:r.ctrlpts[0]+ie.x*2*te,y:r.ctrlpts[1]+ie.y*2*te},re=c.intersectLine(i.x,i.y,o,l,X.x,X.y,0,p,y);F?(r.ctrlpts[0]=r.ctrlpts[0]+ie.x*(R-O),r.ctrlpts[1]=r.ctrlpts[1]+ie.y*(R-O)):(r.ctrlpts[0]=re[0]+ie.x*R,r.ctrlpts[1]=re[1]+ie.y*R)}z&&this.findEndpoints(t)}};us.storeAllpts=function(t){var e=t._private.rscratch;if(e.edgeType==="multibezier"||e.edgeType==="bezier"||e.edgeType==="self"||e.edgeType==="compound"){e.allpts=[],e.allpts.push(e.startX,e.startY);for(var r=0;r+1<e.ctrlpts.length;r+=2)e.allpts.push(e.ctrlpts[r],e.ctrlpts[r+1]),r+3<e.ctrlpts.length&&e.allpts.push((e.ctrlpts[r]+e.ctrlpts[r+2])/2,(e.ctrlpts[r+1]+e.ctrlpts[r+3])/2);e.allpts.push(e.endX,e.endY);var n,i;e.ctrlpts.length/2%2===0?(n=e.allpts.length/2-1,e.midX=e.allpts[n],e.midY=e.allpts[n+1]):(n=e.allpts.length/2-3,i=.5,e.midX=da(e.allpts[n],e.allpts[n+2],e.allpts[n+4],i),e.midY=da(e.allpts[n+1],e.allpts[n+3],e.allpts[n+5],i))}else if(e.edgeType==="straight")e.allpts=[e.startX,e.startY,e.endX,e.endY],e.midX=(e.startX+e.endX+e.arrowStartX+e.arrowEndX)/4,e.midY=(e.startY+e.endY+e.arrowStartY+e.arrowEndY)/4;else if(e.edgeType==="segments"){if(e.allpts=[],e.allpts.push(e.startX,e.startY),e.allpts.push.apply(e.allpts,e.segpts),e.allpts.push(e.endX,e.endY),e.isRound){e.roundCorners=[];for(var a=2;a+3<e.allpts.length;a+=2){var s=e.radii[a/2-1],o=e.isArcRadius[a/2-1];e.roundCorners.push(k_({x:e.allpts[a-2],y:e.allpts[a-1]},{x:e.allpts[a],y:e.allpts[a+1],radius:s},{x:e.allpts[a+2],y:e.allpts[a+3]},s,o))}}if(e.segpts.length%4===0){var l=e.segpts.length/2,u=l-2;e.midX=(e.segpts[u]+e.segpts[l])/2,e.midY=(e.segpts[u+1]+e.segpts[l+1])/2}else{var c=e.segpts.length/2-1;if(!e.isRound)e.midX=e.segpts[c],e.midY=e.segpts[c+1];else{var f={x:e.segpts[c],y:e.segpts[c+1]},p=e.roundCorners[c/2];if(p.radius===0){var g={x:e.segpts[c+2],y:e.segpts[c+3]};e.midX=f.x,e.midY=f.y,e.midVector=[f.y-g.y,g.x-f.x]}else{var y=[f.x-p.cx,f.y-p.cy],S=p.radius/Math.sqrt(Math.pow(y[0],2)+Math.pow(y[1],2));y=y.map(function(w){return w*S}),e.midX=p.cx+y[0],e.midY=p.cy+y[1],e.midVector=y}}}}};us.checkForInvalidEdgeWarning=function(t){var e=t[0]._private.rscratch;e.nodesOverlap||_t(e.startX)&&_t(e.startY)&&_t(e.endX)&&_t(e.endY)?e.loggedErr=!1:e.loggedErr||(e.loggedErr=!0,an("Edge `"+t.id()+"` has invalid endpoints and so it is impossible to draw.  Adjust your edge style (e.g. control points) accordingly or use an alternative edge type.  This is expected behaviour when the source node and the target node overlap."))};us.findEdgeControlPoints=function(t){var e=this;if(!(!t||t.length===0)){for(var r=this,n=r.cy,i=n.hasCompoundNodes(),a=new fc,s=function(F,z){return[].concat(lx(F),[z?1:0]).join("-")},o=[],l=[],u=0;u<t.length;u++){var c=t[u],f=c._private,p=c.pstyle("curve-style").value;if(!(c.removed()||!c.takesUpSpace())){if(p==="haystack"){l.push(c);continue}var g=p==="unbundled-bezier"||Rd(p,"segments")||p==="straight"||p==="straight-triangle"||Rd(p,"taxi"),y=p==="unbundled-bezier"||p==="bezier",S=f.source,w=f.target,C=S.poolIndex(),_=w.poolIndex(),T=[C,_].sort(),N=s(T,g),R=a.get(N);R==null&&(R={eles:[]},o.push({pairId:T,edgeIsUnbundled:g}),a.set(N,R)),R.eles.push(c),g&&(R.hasUnbundled=!0),y&&(R.hasBezier=!0)}}for(var D=function(){var F=o[j],z=F.pairId,G=F.edgeIsUnbundled,Z=s(z,G),I=a.get(Z),W;if(!I.hasUnbundled){var U=I.eles[0].parallelEdges().filter(function(lt){return lt.isBundledBezier()});l_(I.eles),U.forEach(function(lt){return I.eles.push(lt)}),I.eles.sort(function(lt,Ie){return lt.poolIndex()-Ie.poolIndex()})}var K=I.eles[0],$=K.source(),Q=K.target();if($.poolIndex()>Q.poolIndex()){var ie=$;$=Q,Q=ie}var te=I.srcPos=$.position(),X=I.tgtPos=Q.position(),re=I.srcW=$.outerWidth(),fe=I.srcH=$.outerHeight(),oe=I.tgtW=Q.outerWidth(),se=I.tgtH=Q.outerHeight(),he=I.srcShape=r.nodeShapes[e.getNodeShape($)],ae=I.tgtShape=r.nodeShapes[e.getNodeShape(Q)],pe=I.srcCornerRadius=$.pstyle("corner-radius").value==="auto"?"auto":$.pstyle("corner-radius").pfValue,ye=I.tgtCornerRadius=Q.pstyle("corner-radius").value==="auto"?"auto":Q.pstyle("corner-radius").pfValue,ve=I.tgtRs=Q._private.rscratch,ue=I.srcRs=$._private.rscratch;I.dirCounts={north:0,west:0,south:0,east:0,northwest:0,southwest:0,northeast:0,southeast:0};for(var xe=0;xe<I.eles.length;xe++){var Se=I.eles[xe],Ae=Se[0]._private.rscratch,Me=Se.pstyle("curve-style").value,st=Me==="unbundled-bezier"||Rd(Me,"segments")||Rd(Me,"taxi"),rt=!$.same(Se.source());if(!I.calculatedIntersection&&$!==Q&&(I.hasBezier||I.hasUnbundled)){I.calculatedIntersection=!0;var dt=he.intersectLine(te.x,te.y,re,fe,X.x,X.y,0,pe,ue),Ct=I.srcIntn=dt,Ke=ae.intersectLine(X.x,X.y,oe,se,te.x,te.y,0,ye,ve),ut=I.tgtIntn=Ke,ct=I.intersectionPts={x1:dt[0],x2:Ke[0],y1:dt[1],y2:Ke[1]},xt=I.posPts={x1:te.x,x2:X.x,y1:te.y,y2:X.y},ot=Ke[1]-dt[1],Lt=Ke[0]-dt[0],Bt=Math.sqrt(Lt*Lt+ot*ot);_t(Bt)&&Bt>=Az||(Bt=Math.sqrt(Math.max(Lt*Lt,Mv)+Math.max(ot*ot,Mv)));var Ne=I.vector={x:Lt,y:ot},qe=I.vectorNorm={x:Ne.x/Bt,y:Ne.y/Bt},St={x:-qe.y,y:qe.x};I.nodesOverlap=!_t(Bt)||ae.checkPoint(dt[0],dt[1],0,oe,se,X.x,X.y,ye,ve)||he.checkPoint(Ke[0],Ke[1],0,re,fe,te.x,te.y,pe,ue),I.vectorNormInverse=St,W={nodesOverlap:I.nodesOverlap,dirCounts:I.dirCounts,calculatedIntersection:!0,hasBezier:I.hasBezier,hasUnbundled:I.hasUnbundled,eles:I.eles,srcPos:X,srcRs:ve,tgtPos:te,tgtRs:ue,srcW:oe,srcH:se,tgtW:re,tgtH:fe,srcIntn:ut,tgtIntn:Ct,srcShape:ae,tgtShape:he,posPts:{x1:xt.x2,y1:xt.y2,x2:xt.x1,y2:xt.y1},intersectionPts:{x1:ct.x2,y1:ct.y2,x2:ct.x1,y2:ct.y1},vector:{x:-Ne.x,y:-Ne.y},vectorNorm:{x:-qe.x,y:-qe.y},vectorNormInverse:{x:-St.x,y:-St.y}}}var it=rt?W:I;Ae.nodesOverlap=it.nodesOverlap,Ae.srcIntn=it.srcIntn,Ae.tgtIntn=it.tgtIntn,Ae.isRound=Me.startsWith("round"),i&&($.isParent()||$.isChild()||Q.isParent()||Q.isChild())&&($.parents().anySame(Q)||Q.parents().anySame($)||$.same(Q)&&$.isParent())?e.findCompoundLoopPoints(Se,it,xe,st):$===Q?e.findLoopPoints(Se,it,xe,st):Me.endsWith("segments")?e.findSegmentsPoints(Se,it):Me.endsWith("taxi")?e.findTaxiPoints(Se,it):Me==="straight"||!st&&I.eles.length%2===1&&xe===Math.floor(I.eles.length/2)?e.findStraightEdgePoints(Se):e.findBezierPoints(Se,it,xe,st,rt),e.findEndpoints(Se),e.tryToCorrectInvalidPoints(Se,it),e.checkForInvalidEdgeWarning(Se),e.storeAllpts(Se),e.storeEdgeProjections(Se),e.calculateArrowAngles(Se),e.recalculateEdgeLabelProjections(Se),e.calculateLabelAngles(Se)}},j=0;j<o.length;j++)D();this.findHaystackPoints(l)}};function eL(t){var e=[];if(t!=null){for(var r=0;r<t.length;r+=2){var n=t[r],i=t[r+1];e.push({x:n,y:i})}return e}}us.getSegmentPoints=function(t){var e=t[0]._private.rscratch;this.recalculateRenderedStyle(t);var r=e.edgeType;if(r==="segments")return eL(e.segpts)};us.getControlPoints=function(t){var e=t[0]._private.rscratch;this.recalculateRenderedStyle(t);var r=e.edgeType;if(r==="bezier"||r==="multibezier"||r==="self"||r==="compound")return eL(e.ctrlpts)};us.getEdgeMidpoint=function(t){var e=t[0]._private.rscratch;return this.recalculateRenderedStyle(t),{x:e.midX,y:e.midY}};var a0={};a0.manualEndptToPx=function(t,e){var r=this,n=t.position(),i=t.outerWidth(),a=t.outerHeight(),s=t._private.rscratch;if(e.value.length===2){var o=[e.pfValue[0],e.pfValue[1]];return e.units[0]==="%"&&(o[0]=o[0]*i),e.units[1]==="%"&&(o[1]=o[1]*a),o[0]+=n.x,o[1]+=n.y,o}else{var l=e.pfValue[0];l=-Math.PI/2+l;var u=2*Math.max(i,a),c=[n.x+Math.cos(l)*u,n.y+Math.sin(l)*u];return r.nodeShapes[this.getNodeShape(t)].intersectLine(n.x,n.y,i,a,c[0],c[1],0,t.pstyle("corner-radius").value==="auto"?"auto":t.pstyle("corner-radius").pfValue,s)}};a0.findEndpoints=function(t){var e,r,n,i,a=this,s,o=t.source()[0],l=t.target()[0],u=o.position(),c=l.position(),f=t.pstyle("target-arrow-shape").value,p=t.pstyle("source-arrow-shape").value,g=t.pstyle("target-distance-from-node").pfValue,y=t.pstyle("source-distance-from-node").pfValue,S=o._private.rscratch,w=l._private.rscratch,C=t.pstyle("curve-style").value,_=t._private.rscratch,T=_.edgeType,N=Rd(C,"taxi"),R=T==="self"||T==="compound",D=T==="bezier"||T==="multibezier"||R,j=T!=="bezier",O=T==="straight"||T==="segments",F=T==="segments",z=D||j||O,G=R||N,Z=t.pstyle("source-endpoint"),I=G?"outside-to-node":Z.value,W=o.pstyle("corner-radius").value==="auto"?"auto":o.pstyle("corner-radius").pfValue,U=t.pstyle("target-endpoint"),K=G?"outside-to-node":U.value,$=l.pstyle("corner-radius").value==="auto"?"auto":l.pstyle("corner-radius").pfValue;_.srcManEndpt=Z,_.tgtManEndpt=U;var Q,ie,te,X,re=(e=(U==null||(r=U.pfValue)===null||r===void 0?void 0:r.length)===2?U.pfValue:null)!==null&&e!==void 0?e:[0,0],fe=(n=(Z==null||(i=Z.pfValue)===null||i===void 0?void 0:i.length)===2?Z.pfValue:null)!==null&&n!==void 0?n:[0,0];if(D){var oe=[_.ctrlpts[0],_.ctrlpts[1]],se=j?[_.ctrlpts[_.ctrlpts.length-2],_.ctrlpts[_.ctrlpts.length-1]]:oe;Q=se,ie=oe}else if(O){var he=F?_.segpts.slice(0,2):[c.x+re[0],c.y+re[1]],ae=F?_.segpts.slice(_.segpts.length-2):[u.x+fe[0],u.y+fe[1]];Q=ae,ie=he}if(K==="inside-to-node")s=[c.x,c.y];else if(U.units)s=this.manualEndptToPx(l,U);else if(K==="outside-to-line")s=_.tgtIntn;else if(K==="outside-to-node"||K==="outside-to-node-or-label"?te=Q:(K==="outside-to-line"||K==="outside-to-line-or-label")&&(te=[u.x,u.y]),s=a.nodeShapes[this.getNodeShape(l)].intersectLine(c.x,c.y,l.outerWidth(),l.outerHeight(),te[0],te[1],0,$,w),K==="outside-to-node-or-label"||K==="outside-to-line-or-label"){var pe=l._private.rscratch,ye=pe.labelWidth,ve=pe.labelHeight,ue=pe.labelX,xe=pe.labelY,Se=ye/2,Ae=ve/2,Me=l.pstyle("text-valign").value;Me==="top"?xe-=Ae:Me==="bottom"&&(xe+=Ae);var st=l.pstyle("text-halign").value;st==="left"?ue-=Se:st==="right"&&(ue+=Se);var rt=Cv(te[0],te[1],[ue-Se,xe-Ae,ue+Se,xe-Ae,ue+Se,xe+Ae,ue-Se,xe+Ae],c.x,c.y);if(rt.length>0){var dt=u,Ct=Kf(dt,Ap(s)),Ke=Kf(dt,Ap(rt)),ut=Ct;if(Ke<Ct&&(s=rt,ut=Ke),rt.length>2){var ct=Kf(dt,{x:rt[2],y:rt[3]});ct<ut&&(s=[rt[2],rt[3]])}}}var xt=ry(s,Q,a.arrowShapes[f].spacing(t)+g),ot=ry(s,Q,a.arrowShapes[f].gap(t)+g);if(_.endX=ot[0],_.endY=ot[1],_.arrowEndX=xt[0],_.arrowEndY=xt[1],I==="inside-to-node")s=[u.x,u.y];else if(Z.units)s=this.manualEndptToPx(o,Z);else if(I==="outside-to-line")s=_.srcIntn;else if(I==="outside-to-node"||I==="outside-to-node-or-label"?X=ie:(I==="outside-to-line"||I==="outside-to-line-or-label")&&(X=[c.x,c.y]),s=a.nodeShapes[this.getNodeShape(o)].intersectLine(u.x,u.y,o.outerWidth(),o.outerHeight(),X[0],X[1],0,W,S),I==="outside-to-node-or-label"||I==="outside-to-line-or-label"){var Lt=o._private.rscratch,Bt=Lt.labelWidth,Ne=Lt.labelHeight,qe=Lt.labelX,St=Lt.labelY,it=Bt/2,lt=Ne/2,Ie=o.pstyle("text-valign").value;Ie==="top"?St-=lt:Ie==="bottom"&&(St+=lt);var de=o.pstyle("text-halign").value;de==="left"?qe-=it:de==="right"&&(qe+=it);var ge=Cv(X[0],X[1],[qe-it,St-lt,qe+it,St-lt,qe+it,St+lt,qe-it,St+lt],u.x,u.y);if(ge.length>0){var ke=c,Ee=Kf(ke,Ap(s)),Re=Kf(ke,Ap(ge)),Qe=Ee;if(Re<Ee&&(s=[ge[0],ge[1]],Qe=Re),ge.length>2){var Ge=Kf(ke,{x:ge[2],y:ge[3]});Ge<Qe&&(s=[ge[2],ge[3]])}}}var wt=ry(s,ie,a.arrowShapes[p].spacing(t)+y),bt=ry(s,ie,a.arrowShapes[p].gap(t)+y);_.startX=bt[0],_.startY=bt[1],_.arrowStartX=wt[0],_.arrowStartY=wt[1],z&&(!_t(_.startX)||!_t(_.startY)||!_t(_.endX)||!_t(_.endY)?_.badLine=!0:_.badLine=!1)};a0.getSourceEndpoint=function(t){var e=t[0]._private.rscratch;return this.recalculateRenderedStyle(t),e.edgeType==="haystack"?{x:e.haystackPts[0],y:e.haystackPts[1]}:{x:e.arrowStartX,y:e.arrowStartY}};a0.getTargetEndpoint=function(t){var e=t[0]._private.rscratch;return this.recalculateRenderedStyle(t),e.edgeType==="haystack"?{x:e.haystackPts[2],y:e.haystackPts[3]}:{x:e.arrowEndX,y:e.arrowEndY}};var __={};function Lz(t,e,r){for(var n=function(u,c,f,p){return da(u,c,f,p)},i=e._private,a=i.rstyle.bezierPts,s=0;s<t.bezierProjPcts.length;s++){var o=t.bezierProjPcts[s];a.push({x:n(r[0],r[2],r[4],o),y:n(r[1],r[3],r[5],o)})}}__.storeEdgeProjections=function(t){var e=t._private,r=e.rscratch,n=r.edgeType;if(e.rstyle.bezierPts=null,e.rstyle.linePts=null,e.rstyle.haystackPts=null,n==="multibezier"||n==="bezier"||n==="self"||n==="compound"){e.rstyle.bezierPts=[];for(var i=0;i+5<r.allpts.length;i+=4)Lz(this,t,r.allpts.slice(i,i+6))}else if(n==="segments")for(var a=e.rstyle.linePts=[],i=0;i+1<r.allpts.length;i+=2)a.push({x:r.allpts[i],y:r.allpts[i+1]});else if(n==="haystack"){var s=r.haystackPts;e.rstyle.haystackPts=[{x:s[0],y:s[1]},{x:s[2],y:s[3]}]}e.rstyle.arrowWidth=this.getArrowWidth(t.pstyle("width").pfValue,t.pstyle("arrow-scale").value)*this.arrowShapeWidth};__.recalculateEdgeProjections=function(t){this.findEdgeControlPoints(t)};var Lu={};Lu.recalculateNodeLabelProjection=function(t){var e=t.pstyle("label").strValue;if(!Kd(e)){var r,n,i=t._private,a=t.width(),s=t.height(),o=t.padding(),l=t.position(),u=t.pstyle("text-halign").strValue,c=t.pstyle("text-valign").strValue,f=i.rscratch,p=i.rstyle;switch(u){case"left":r=l.x-a/2-o;break;case"right":r=l.x+a/2+o;break;default:r=l.x}switch(c){case"top":n=l.y-s/2-o;break;case"bottom":n=l.y+s/2+o;break;default:n=l.y}f.labelX=r,f.labelY=n,p.labelX=r,p.labelY=n,this.calculateLabelAngles(t),this.applyLabelDimensions(t)}};var tL=function(e,r){var n=Math.atan(r/e);return e===0&&n<0&&(n=n*-1),n},rL=function(e,r){var n=r.x-e.x,i=r.y-e.y;return tL(n,i)},Rz=function(e,r,n,i){var a=_v(0,i-.001,1),s=_v(0,i+.001,1),o=Ip(e,r,n,a),l=Ip(e,r,n,s);return rL(o,l)};Lu.recalculateEdgeLabelProjections=function(t){var e,r=t._private,n=r.rscratch,i=this,a={mid:t.pstyle("label").strValue,source:t.pstyle("source-label").strValue,target:t.pstyle("target-label").strValue};if(a.mid||a.source||a.target){e={x:n.midX,y:n.midY};var s=function(f,p,g){dc(r.rscratch,f,p,g),dc(r.rstyle,f,p,g)};s("labelX",null,e.x),s("labelY",null,e.y);var o=tL(n.midDispX,n.midDispY);s("labelAutoAngle",null,o);var l=function(){if(l.cache)return l.cache;for(var f=[],p=0;p+5<n.allpts.length;p+=4){var g={x:n.allpts[p],y:n.allpts[p+1]},y={x:n.allpts[p+2],y:n.allpts[p+3]},S={x:n.allpts[p+4],y:n.allpts[p+5]};f.push({p0:g,p1:y,p2:S,startDist:0,length:0,segments:[]})}var w=r.rstyle.bezierPts,C=i.bezierProjPcts.length;function _(j,O,F,z,G){var Z=mh(O,F),I=j.segments[j.segments.length-1],W={p0:O,p1:F,t0:z,t1:G,startDist:I?I.startDist+I.length:0,length:Z};j.segments.push(W),j.length+=Z}for(var T=0;T<f.length;T++){var N=f[T],R=f[T-1];R&&(N.startDist=R.startDist+R.length),_(N,N.p0,w[T*C],0,i.bezierProjPcts[0]);for(var D=0;D<C-1;D++)_(N,w[T*C+D],w[T*C+D+1],i.bezierProjPcts[D],i.bezierProjPcts[D+1]);_(N,w[T*C+C-1],N.p2,i.bezierProjPcts[C-1],1)}return l.cache=f},u=function(f){var p,g=f==="source";if(a[f]){var y=t.pstyle(f+"-text-offset").pfValue;switch(n.edgeType){case"self":case"compound":case"bezier":case"multibezier":{for(var S=l(),w,C=0,_=0,T=0;T<S.length;T++){for(var N=S[g?T:S.length-1-T],R=0;R<N.segments.length;R++){var D=N.segments[g?R:N.segments.length-1-R],j=T===S.length-1&&R===N.segments.length-1;if(C=_,_+=D.length,_>=y||j){w={cp:N,segment:D};break}}if(w)break}var O=w.cp,F=w.segment,z=(y-C)/F.length,G=F.t1-F.t0,Z=g?F.t0+G*z:F.t1-G*z;Z=_v(0,Z,1),e=Ip(O.p0,O.p1,O.p2,Z),p=Rz(O.p0,O.p1,O.p2,Z);break}case"straight":case"segments":case"haystack":{for(var I=0,W,U,K,$,Q=n.allpts.length,ie=0;ie+3<Q&&(g?(K={x:n.allpts[ie],y:n.allpts[ie+1]},$={x:n.allpts[ie+2],y:n.allpts[ie+3]}):(K={x:n.allpts[Q-2-ie],y:n.allpts[Q-1-ie]},$={x:n.allpts[Q-4-ie],y:n.allpts[Q-3-ie]}),W=mh(K,$),U=I,I+=W,!(I>=y));ie+=2);var te=y-U,X=te/W;X=_v(0,X,1),e=tF(K,$,X),p=rL(K,$);break}}s("labelX",f,e.x),s("labelY",f,e.y),s("labelAutoAngle",f,p)}};u("source"),u("target"),this.applyLabelDimensions(t)}};Lu.applyLabelDimensions=function(t){this.applyPrefixedLabelDimensions(t),t.isEdge()&&(this.applyPrefixedLabelDimensions(t,"source"),this.applyPrefixedLabelDimensions(t,"target"))};Lu.applyPrefixedLabelDimensions=function(t,e){var r=t._private,n=this.getLabelText(t,e),i=ph(n,t._private.labelDimsKey);if($s(r.rscratch,"prefixedLabelDimsKey",e)!==i){dc(r.rscratch,"prefixedLabelDimsKey",e,i);var a=this.calculateLabelDimensions(t,n),s=t.pstyle("line-height").pfValue,o=t.pstyle("text-wrap").strValue,l=$s(r.rscratch,"labelWrapCachedLines",e)||[],u=o!=="wrap"?1:Math.max(l.length,1),c=a.height/u,f=c*s,p=a.width,g=a.height+(u-1)*(s-1)*c;dc(r.rstyle,"labelWidth",e,p),dc(r.rscratch,"labelWidth",e,p),dc(r.rstyle,"labelHeight",e,g),dc(r.rscratch,"labelHeight",e,g),dc(r.rscratch,"labelLineHeight",e,f)}};Lu.getLabelText=function(t,e){var r=t._private,n=e?e+"-":"",i=t.pstyle(n+"label").strValue,a=t.pstyle("text-transform").value,s=function(fe,oe){return oe?(dc(r.rscratch,fe,e,oe),oe):$s(r.rscratch,fe,e)};if(!i)return"";a=="none"||(a=="uppercase"?i=i.toUpperCase():a=="lowercase"&&(i=i.toLowerCase()));var o=t.pstyle("text-wrap").value;if(o==="wrap"){var l=s("labelKey");if(l!=null&&s("labelWrapKey")===l)return s("labelWrapCachedText");for(var u="",c=i.split(`
`),f=t.pstyle("text-max-width").pfValue,p=t.pstyle("text-overflow-wrap").value,g=p==="anywhere",y=[],S=/[\s\u200b]+|$/g,w=0;w<c.length;w++){var C=c[w],_=this.calculateLabelDimensions(t,C),T=_.width;if(g){var N=C.split("").join(u);C=N}if(T>f){var R=C.matchAll(S),D="",j=0,O=Ys(R),F;try{for(O.s();!(F=O.n()).done;){var z=F.value,G=z[0],Z=C.substring(j,z.index);j=z.index+G.length;var I=D.length===0?Z:D+Z+G,W=this.calculateLabelDimensions(t,I),U=W.width;U<=f?D+=Z+G:(D&&y.push(D),D=Z+G)}}catch(re){O.e(re)}finally{O.f()}D.match(/^[\s\u200b]+$/)||y.push(D)}else y.push(C)}s("labelWrapCachedLines",y),i=s("labelWrapCachedText",y.join(`
`)),s("labelWrapKey",l)}else if(o==="ellipsis"){var K=t.pstyle("text-max-width").pfValue,$="",Q="",ie=!1;if(this.calculateLabelDimensions(t,i).width<K)return i;for(var te=0;te<i.length;te++){var X=this.calculateLabelDimensions(t,$+i[te]+Q).width;if(X>K)break;$+=i[te],te===i.length-1&&(ie=!0)}return ie||($+=Q),$}return i};Lu.getLabelJustification=function(t){var e=t.pstyle("text-justification").strValue,r=t.pstyle("text-halign").strValue;if(e==="auto")if(t.isNode())switch(r){case"left":return"right";case"right":return"left";default:return"center"}else return"center";else return e};Lu.calculateLabelDimensions=function(t,e){var r=this,n=r.cy.window(),i=n.document,a=0,s=t.pstyle("font-style").strValue,o=t.pstyle("font-size").pfValue,l=t.pstyle("font-family").strValue,u=t.pstyle("font-weight").strValue,c=this.labelCalcCanvas,f=this.labelCalcCanvasContext;if(!c){c=this.labelCalcCanvas=i.createElement("canvas"),f=this.labelCalcCanvasContext=c.getContext("2d");var p=c.style;p.position="absolute",p.left="-9999px",p.top="-9999px",p.zIndex="-1",p.visibility="hidden",p.pointerEvents="none"}f.font="".concat(s," ").concat(u," ").concat(o,"px ").concat(l);for(var g=0,y=0,S=e.split(`
`),w=0;w<S.length;w++){var C=S[w],_=f.measureText(C),T=Math.ceil(_.width),N=o;g=Math.max(T,g),y+=N}return g+=a,y+=a,{width:g,height:y}};Lu.calculateLabelAngle=function(t,e){var r=t._private,n=r.rscratch,i=t.isEdge(),a=e?e+"-":"",s=t.pstyle(a+"text-rotation"),o=s.strValue;return o==="none"?0:i&&o==="autorotate"?n.labelAutoAngle:o==="autorotate"?0:s.pfValue};Lu.calculateLabelAngles=function(t){var e=this,r=t.isEdge(),n=t._private,i=n.rscratch;i.labelAngle=e.calculateLabelAngle(t),r&&(i.sourceLabelAngle=e.calculateLabelAngle(t,"source"),i.targetLabelAngle=e.calculateLabelAngle(t,"target"))};var nL={},WN=28,qN=!1;nL.getNodeShape=function(t){var e=this,r=t.pstyle("shape").value;if(r==="cutrectangle"&&(t.width()<WN||t.height()<WN))return qN||(an("The `cutrectangle` node shape can not be used at small sizes so `rectangle` is used instead"),qN=!0),"rectangle";if(t.isParent())return r==="rectangle"||r==="roundrectangle"||r==="round-rectangle"||r==="cutrectangle"||r==="cut-rectangle"||r==="barrel"?r:"rectangle";if(r==="polygon"){var n=t.pstyle("shape-polygon-points").value;return e.nodeShapes.makePolygon(n).name}return r};var U1={};U1.registerCalculationListeners=function(){var t=this.cy,e=t.collection(),r=this,n=function(s){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(e.merge(s),o)for(var l=0;l<s.length;l++){var u=s[l],c=u._private,f=c.rstyle;f.clean=!1,f.cleanConnected=!1}};r.binder(t).on("bounds.* dirty.*",function(s){var o=s.target;n(o)}).on("style.* background.*",function(s){var o=s.target;n(o,!1)});var i=function(s){if(s){var o=r.onUpdateEleCalcsFns;e.cleanStyle();for(var l=0;l<e.length;l++){var u=e[l],c=u._private.rstyle;u.isNode()&&!c.cleanConnected&&(n(u.connectedEdges()),c.cleanConnected=!0)}if(o)for(var f=0;f<o.length;f++){var p=o[f];p(s,e)}r.recalculateRenderedStyle(e),e=t.collection()}};r.flushRenderedStyleQueue=function(){i(!0)},r.beforeRender(i,r.beforeRenderPriorities.eleCalcs)};U1.onUpdateEleCalcs=function(t){var e=this.onUpdateEleCalcsFns=this.onUpdateEleCalcsFns||[];e.push(t)};U1.recalculateRenderedStyle=function(t,e){var r=function(N){return N._private.rstyle.cleanConnected};if(t.length!==0){var n=[],i=[];if(!this.destroyed){e===void 0&&(e=!0);for(var a=0;a<t.length;a++){var s=t[a],o=s._private,l=o.rstyle;s.isEdge()&&(!r(s.source())||!r(s.target()))&&(l.clean=!1),s.isEdge()&&s.isBundledBezier()&&s.parallelEdges().some(function(T){return!T._private.rstyle.clean&&T.isBundledBezier()})&&(l.clean=!1),!(e&&l.clean||s.removed())&&s.pstyle("display").value!=="none"&&(o.group==="nodes"?i.push(s):n.push(s),l.clean=!0)}for(var u=0;u<i.length;u++){var c=i[u],f=c._private,p=f.rstyle,g=c.position();this.recalculateNodeLabelProjection(c),p.nodeX=g.x,p.nodeY=g.y,p.nodeW=c.pstyle("width").pfValue,p.nodeH=c.pstyle("height").pfValue}this.recalculateEdgeProjections(n);for(var y=0;y<n.length;y++){var S=n[y],w=S._private,C=w.rstyle,_=w.rscratch;C.srcX=_.arrowStartX,C.srcY=_.arrowStartY,C.tgtX=_.arrowEndX,C.tgtY=_.arrowEndY,C.midX=_.midX,C.midY=_.midY,C.labelAngle=_.labelAngle,C.sourceLabelAngle=_.sourceLabelAngle,C.targetLabelAngle=_.targetLabelAngle}}}};var G1={};G1.updateCachedGrabbedEles=function(){var t=this.cachedZSortedEles;if(t){t.drag=[],t.nondrag=[];for(var e=[],r=0;r<t.length;r++){var n=t[r],i=n._private.rscratch;n.grabbed()&&!n.isParent()?e.push(n):i.inDragLayer?t.drag.push(n):t.nondrag.push(n)}for(var r=0;r<e.length;r++){var n=e[r];t.drag.push(n)}}};G1.invalidateCachedZSortedEles=function(){this.cachedZSortedEles=null};G1.getCachedZSortedEles=function(t){if(t||!this.cachedZSortedEles){var e=this.cy.mutableElements().toArray();e.sort(FA),e.interactive=e.filter(function(r){return r.interactive()}),this.cachedZSortedEles=e,this.updateCachedGrabbedEles()}else e=this.cachedZSortedEles;return e};var iL={};[Nh,yx,us,a0,__,Lu,nL,U1,G1].forEach(function(t){sr(iL,t)});var aL={};aL.getCachedImage=function(t,e,r){var n=this,i=n.imageCache=n.imageCache||{},a=i[t];if(a)return a.image.complete||a.image.addEventListener("load",r),a.image;a=i[t]=i[t]||{};var s=a.image=new Image;s.addEventListener("load",r),s.addEventListener("error",function(){s.error=!0});var o="data:",l=t.substring(0,o.length).toLowerCase()===o;return l||(e=e==="null"?null:e,s.crossOrigin=e),s.src=t,s};var fm={};fm.registerBinding=function(t,e,r,n){var i=Array.prototype.slice.apply(arguments,[1]);if(Array.isArray(t)){for(var a=[],s=0;s<t.length;s++){var o=t[s];if(o!==void 0){var l=this.binder(o);a.push(l.on.apply(l,i))}}return a}var l=this.binder(t);return l.on.apply(l,i)};fm.binder=function(t){var e=this,r=e.cy.window(),n=t===r||t===r.document||t===r.document.body||Wj(t);if(e.supportsPassiveEvents==null){var i=!1;try{var a=Object.defineProperty({},"passive",{get:function(){return i=!0,!0}});r.addEventListener("test",null,a)}catch{}e.supportsPassiveEvents=i}var s=function(l,u,c){var f=Array.prototype.slice.call(arguments);return n&&e.supportsPassiveEvents&&(f[2]={capture:c??!1,passive:!1,once:!1}),e.bindings.push({target:t,args:f}),(t.addEventListener||t.on).apply(t,f),this};return{on:s,addEventListener:s,addListener:s,bind:s}};fm.nodeIsDraggable=function(t){return t&&t.isNode()&&!t.locked()&&t.grabbable()};fm.nodeIsGrabbable=function(t){return this.nodeIsDraggable(t)&&t.interactive()};fm.load=function(){var t=this,e=t.cy.window(),r=function(de){return de.selected()},n=function(de){var ge=de.getRootNode();if(ge&&ge.nodeType===11&&ge.host!==void 0)return ge},i=function(de,ge,ke,Ee){de==null&&(de=t.cy);for(var Re=0;Re<ge.length;Re++){var Qe=ge[Re];de.emit({originalEvent:ke,type:Qe,position:Ee})}},a=function(de){return de.shiftKey||de.metaKey||de.ctrlKey},s=function(de,ge){var ke=!0;if(t.cy.hasCompoundNodes()&&de&&de.pannable())for(var Ee=0;ge&&Ee<ge.length;Ee++){var de=ge[Ee];if(de.isNode()&&de.isParent()&&!de.pannable()){ke=!1;break}}else ke=!0;return ke},o=function(de){de[0]._private.grabbed=!0},l=function(de){de[0]._private.grabbed=!1},u=function(de){de[0]._private.rscratch.inDragLayer=!0},c=function(de){de[0]._private.rscratch.inDragLayer=!1},f=function(de){de[0]._private.rscratch.isGrabTarget=!0},p=function(de){de[0]._private.rscratch.isGrabTarget=!1},g=function(de,ge){var ke=ge.addToList,Ee=ke.has(de);!Ee&&de.grabbable()&&!de.locked()&&(ke.merge(de),o(de))},y=function(de,ge){if(de.cy().hasCompoundNodes()&&!(ge.inDragLayer==null&&ge.addToList==null)){var ke=de.descendants();ge.inDragLayer&&(ke.forEach(u),ke.connectedEdges().forEach(u)),ge.addToList&&g(ke,ge)}},S=function(de,ge){ge=ge||{};var ke=de.cy().hasCompoundNodes();ge.inDragLayer&&(de.forEach(u),de.neighborhood().stdFilter(function(Ee){return!ke||Ee.isEdge()}).forEach(u)),ge.addToList&&de.forEach(function(Ee){g(Ee,ge)}),y(de,ge),_(de,{inDragLayer:ge.inDragLayer}),t.updateCachedGrabbedEles()},w=S,C=function(de){de&&(t.getCachedZSortedEles().forEach(function(ge){l(ge),c(ge),p(ge)}),t.updateCachedGrabbedEles())},_=function(de,ge){if(!(ge.inDragLayer==null&&ge.addToList==null)&&de.cy().hasCompoundNodes()){var ke=de.ancestors().orphans();if(!ke.same(de)){var Ee=ke.descendants().spawnSelf().merge(ke).unmerge(de).unmerge(de.descendants()),Re=Ee.connectedEdges();ge.inDragLayer&&(Re.forEach(u),Ee.forEach(u)),ge.addToList&&Ee.forEach(function(Qe){g(Qe,ge)})}}},T=function(){document.activeElement!=null&&document.activeElement.blur!=null&&document.activeElement.blur()},N=typeof MutationObserver<"u",R=typeof ResizeObserver<"u";N?(t.removeObserver=new MutationObserver(function(Ie){for(var de=0;de<Ie.length;de++){var ge=Ie[de],ke=ge.removedNodes;if(ke)for(var Ee=0;Ee<ke.length;Ee++){var Re=ke[Ee];if(Re===t.container){t.destroy();break}}}}),t.container.parentNode&&t.removeObserver.observe(t.container.parentNode,{childList:!0})):t.registerBinding(t.container,"DOMNodeRemoved",function(Ie){t.destroy()});var D=t0(function(){t.cy.resize()},100);N&&(t.styleObserver=new MutationObserver(D),t.styleObserver.observe(t.container,{attributes:!0})),t.registerBinding(e,"resize",D),R&&(t.resizeObserver=new ResizeObserver(D),t.resizeObserver.observe(t.container));var j=function(de,ge){for(;de!=null;)ge(de),de=de.parentNode},O=function(){t.invalidateContainerClientCoordsCache()};j(t.container,function(Ie){t.registerBinding(Ie,"transitionend",O),t.registerBinding(Ie,"animationend",O),t.registerBinding(Ie,"scroll",O)}),t.registerBinding(t.container,"contextmenu",function(Ie){Ie.preventDefault()});var F=function(){return t.selection[4]!==0},z=function(de){for(var ge=t.findContainerClientCoords(),ke=ge[0],Ee=ge[1],Re=ge[2],Qe=ge[3],Ge=de.touches?de.touches:[de],wt=!1,bt=0;bt<Ge.length;bt++){var pt=Ge[bt];if(ke<=pt.clientX&&pt.clientX<=ke+Re&&Ee<=pt.clientY&&pt.clientY<=Ee+Qe){wt=!0;break}}if(!wt)return!1;for(var Kt=t.container,Wt=de.target,Ve=Wt.parentNode,vt=!1;Ve;){if(Ve===Kt){vt=!0;break}Ve=Ve.parentNode}return!!vt};t.registerBinding(t.container,"mousedown",function(de){if(z(de)&&!(t.hoverData.which===1&&de.which!==1)){de.preventDefault(),T(),t.hoverData.capture=!0,t.hoverData.which=de.which;var ge=t.cy,ke=[de.clientX,de.clientY],Ee=t.projectIntoViewport(ke[0],ke[1]),Re=t.selection,Qe=t.findNearestElements(Ee[0],Ee[1],!0,!1),Ge=Qe[0],wt=t.dragData.possibleDragElements;t.hoverData.mdownPos=Ee,t.hoverData.mdownGPos=ke;var bt=function(Et){return{originalEvent:de,type:Et,position:{x:Ee[0],y:Ee[1]}}},pt=function(){t.hoverData.tapholdCancelled=!1,clearTimeout(t.hoverData.tapholdTimeout),t.hoverData.tapholdTimeout=setTimeout(function(){if(!t.hoverData.tapholdCancelled){var Et=t.hoverData.down;Et?Et.emit(bt("taphold")):ge.emit(bt("taphold"))}},t.tapholdDuration)};if(de.which==3){t.hoverData.cxtStarted=!0;var Kt={originalEvent:de,type:"cxttapstart",position:{x:Ee[0],y:Ee[1]}};Ge?(Ge.activate(),Ge.emit(Kt),t.hoverData.down=Ge):ge.emit(Kt),t.hoverData.downTime=new Date().getTime(),t.hoverData.cxtDragged=!1}else if(de.which==1){Ge&&Ge.activate();{if(Ge!=null&&t.nodeIsGrabbable(Ge)){var Wt=function(Et){Et.emit(bt("grab"))};if(f(Ge),!Ge.selected())wt=t.dragData.possibleDragElements=ge.collection(),w(Ge,{addToList:wt}),Ge.emit(bt("grabon")).emit(bt("grab"));else{wt=t.dragData.possibleDragElements=ge.collection();var Ve=ge.$(function(vt){return vt.isNode()&&vt.selected()&&t.nodeIsGrabbable(vt)});S(Ve,{addToList:wt}),Ge.emit(bt("grabon")),Ve.forEach(Wt)}t.redrawHint("eles",!0),t.redrawHint("drag",!0)}t.hoverData.down=Ge,t.hoverData.downs=Qe,t.hoverData.downTime=new Date().getTime()}i(Ge,["mousedown","tapstart","vmousedown"],de,{x:Ee[0],y:Ee[1]}),Ge==null?(Re[4]=1,t.data.bgActivePosistion={x:Ee[0],y:Ee[1]},t.redrawHint("select",!0),t.redraw()):Ge.pannable()&&(Re[4]=1),pt()}Re[0]=Re[2]=Ee[0],Re[1]=Re[3]=Ee[1]}},!1);var G=n(t.container);t.registerBinding([e,G],"mousemove",function(de){var ge=t.hoverData.capture;if(!(!ge&&!z(de))){var ke=!1,Ee=t.cy,Re=Ee.zoom(),Qe=[de.clientX,de.clientY],Ge=t.projectIntoViewport(Qe[0],Qe[1]),wt=t.hoverData.mdownPos,bt=t.hoverData.mdownGPos,pt=t.selection,Kt=null;!t.hoverData.draggingEles&&!t.hoverData.dragging&&!t.hoverData.selecting&&(Kt=t.findNearestElement(Ge[0],Ge[1],!0,!1));var Wt=t.hoverData.last,Ve=t.hoverData.down,vt=[Ge[0]-pt[2],Ge[1]-pt[3]],Et=t.dragData.possibleDragElements,er;if(bt){var gr=Qe[0]-bt[0],Ir=gr*gr,zr=Qe[1]-bt[1],Cr=zr*zr,fn=Ir+Cr;t.hoverData.isOverThresholdDrag=er=fn>=t.desktopTapThreshold2}var xr=a(de);er&&(t.hoverData.tapholdCancelled=!0);var Tt=function(){var gi=t.hoverData.dragDelta=t.hoverData.dragDelta||[];gi.length===0?(gi.push(vt[0]),gi.push(vt[1])):(gi[0]+=vt[0],gi[1]+=vt[1])};ke=!0,i(Kt,["mousemove","vmousemove","tapdrag"],de,{x:Ge[0],y:Ge[1]});var Ur=function(gi){return{originalEvent:de,type:gi,position:{x:Ge[0],y:Ge[1]}}},Qn=function(){t.data.bgActivePosistion=void 0,t.hoverData.selecting||Ee.emit(Ur("boxstart")),pt[4]=1,t.hoverData.selecting=!0,t.redrawHint("select",!0),t.redraw()};if(t.hoverData.which===3){if(er){var Zi=Ur("cxtdrag");Ve?Ve.emit(Zi):Ee.emit(Zi),t.hoverData.cxtDragged=!0,(!t.hoverData.cxtOver||Kt!==t.hoverData.cxtOver)&&(t.hoverData.cxtOver&&t.hoverData.cxtOver.emit(Ur("cxtdragout")),t.hoverData.cxtOver=Kt,Kt&&Kt.emit(Ur("cxtdragover")))}}else if(t.hoverData.dragging){if(ke=!0,Ee.panningEnabled()&&Ee.userPanningEnabled()){var ds;if(t.hoverData.justStartedPan){var As=t.hoverData.mdownPos;ds={x:(Ge[0]-As[0])*Re,y:(Ge[1]-As[1])*Re},t.hoverData.justStartedPan=!1}else ds={x:vt[0]*Re,y:vt[1]*Re};Ee.panBy(ds),Ee.emit(Ur("dragpan")),t.hoverData.dragged=!0}Ge=t.projectIntoViewport(de.clientX,de.clientY)}else if(pt[4]==1&&(Ve==null||Ve.pannable())){if(er){if(!t.hoverData.dragging&&Ee.boxSelectionEnabled()&&(xr||!Ee.panningEnabled()||!Ee.userPanningEnabled()))Qn();else if(!t.hoverData.selecting&&Ee.panningEnabled()&&Ee.userPanningEnabled()){var ni=s(Ve,t.hoverData.downs);ni&&(t.hoverData.dragging=!0,t.hoverData.justStartedPan=!0,pt[4]=0,t.data.bgActivePosistion=Ap(wt),t.redrawHint("select",!0),t.redraw())}Ve&&Ve.pannable()&&Ve.active()&&Ve.unactivate()}}else{if(Ve&&Ve.pannable()&&Ve.active()&&Ve.unactivate(),(!Ve||!Ve.grabbed())&&Kt!=Wt&&(Wt&&i(Wt,["mouseout","tapdragout"],de,{x:Ge[0],y:Ge[1]}),Kt&&i(Kt,["mouseover","tapdragover"],de,{x:Ge[0],y:Ge[1]}),t.hoverData.last=Kt),Ve)if(er){if(Ee.boxSelectionEnabled()&&xr)Ve&&Ve.grabbed()&&(C(Et),Ve.emit(Ur("freeon")),Et.emit(Ur("free")),t.dragData.didDrag&&(Ve.emit(Ur("dragfreeon")),Et.emit(Ur("dragfree")))),Qn();else if(Ve&&Ve.grabbed()&&t.nodeIsDraggable(Ve)){var sn=!t.dragData.didDrag;sn&&t.redrawHint("eles",!0),t.dragData.didDrag=!0,t.hoverData.draggingEles||S(Et,{inDragLayer:!0});var kn={x:0,y:0};if(_t(vt[0])&&_t(vt[1])&&(kn.x+=vt[0],kn.y+=vt[1],sn)){var In=t.hoverData.dragDelta;In&&_t(In[0])&&_t(In[1])&&(kn.x+=In[0],kn.y+=In[1])}t.hoverData.draggingEles=!0,Et.silentShift(kn).emit(Ur("position")).emit(Ur("drag")),t.redrawHint("drag",!0),t.redraw()}}else Tt();ke=!0}if(pt[2]=Ge[0],pt[3]=Ge[1],ke)return de.stopPropagation&&de.stopPropagation(),de.preventDefault&&de.preventDefault(),!1}},!1);var Z,I,W;t.registerBinding(e,"mouseup",function(de){if(!(t.hoverData.which===1&&de.which!==1&&t.hoverData.capture)){var ge=t.hoverData.capture;if(ge){t.hoverData.capture=!1;var ke=t.cy,Ee=t.projectIntoViewport(de.clientX,de.clientY),Re=t.selection,Qe=t.findNearestElement(Ee[0],Ee[1],!0,!1),Ge=t.dragData.possibleDragElements,wt=t.hoverData.down,bt=a(de);t.data.bgActivePosistion&&(t.redrawHint("select",!0),t.redraw()),t.hoverData.tapholdCancelled=!0,t.data.bgActivePosistion=void 0,wt&&wt.unactivate();var pt=function(gr){return{originalEvent:de,type:gr,position:{x:Ee[0],y:Ee[1]}}};if(t.hoverData.which===3){var Kt=pt("cxttapend");if(wt?wt.emit(Kt):ke.emit(Kt),!t.hoverData.cxtDragged){var Wt=pt("cxttap");wt?wt.emit(Wt):ke.emit(Wt)}t.hoverData.cxtDragged=!1,t.hoverData.which=null}else if(t.hoverData.which===1){if(i(Qe,["mouseup","tapend","vmouseup"],de,{x:Ee[0],y:Ee[1]}),!t.dragData.didDrag&&!t.hoverData.dragged&&!t.hoverData.selecting&&!t.hoverData.isOverThresholdDrag&&(i(wt,["click","tap","vclick"],de,{x:Ee[0],y:Ee[1]}),I=!1,de.timeStamp-W<=ke.multiClickDebounceTime()?(Z&&clearTimeout(Z),I=!0,W=null,i(wt,["dblclick","dbltap","vdblclick"],de,{x:Ee[0],y:Ee[1]})):(Z=setTimeout(function(){I||i(wt,["oneclick","onetap","voneclick"],de,{x:Ee[0],y:Ee[1]})},ke.multiClickDebounceTime()),W=de.timeStamp)),wt==null&&!t.dragData.didDrag&&!t.hoverData.selecting&&!t.hoverData.dragged&&!a(de)&&(ke.$(r).unselect(["tapunselect"]),Ge.length>0&&t.redrawHint("eles",!0),t.dragData.possibleDragElements=Ge=ke.collection()),Qe==wt&&!t.dragData.didDrag&&!t.hoverData.selecting&&Qe!=null&&Qe._private.selectable&&(t.hoverData.dragging||(ke.selectionType()==="additive"||bt?Qe.selected()?Qe.unselect(["tapunselect"]):Qe.select(["tapselect"]):bt||(ke.$(r).unmerge(Qe).unselect(["tapunselect"]),Qe.select(["tapselect"]))),t.redrawHint("eles",!0)),t.hoverData.selecting){var Ve=ke.collection(t.getAllInBox(Re[0],Re[1],Re[2],Re[3]));t.redrawHint("select",!0),Ve.length>0&&t.redrawHint("eles",!0),ke.emit(pt("boxend"));var vt=function(gr){return gr.selectable()&&!gr.selected()};ke.selectionType()==="additive"||bt||ke.$(r).unmerge(Ve).unselect(),Ve.emit(pt("box")).stdFilter(vt).select().emit(pt("boxselect")),t.redraw()}if(t.hoverData.dragging&&(t.hoverData.dragging=!1,t.redrawHint("select",!0),t.redrawHint("eles",!0),t.redraw()),!Re[4]){t.redrawHint("drag",!0),t.redrawHint("eles",!0);var Et=wt&&wt.grabbed();C(Ge),Et&&(wt.emit(pt("freeon")),Ge.emit(pt("free")),t.dragData.didDrag&&(wt.emit(pt("dragfreeon")),Ge.emit(pt("dragfree"))))}}Re[4]=0,t.hoverData.down=null,t.hoverData.cxtStarted=!1,t.hoverData.draggingEles=!1,t.hoverData.selecting=!1,t.hoverData.isOverThresholdDrag=!1,t.dragData.didDrag=!1,t.hoverData.dragged=!1,t.hoverData.dragDelta=[],t.hoverData.mdownPos=null,t.hoverData.mdownGPos=null,t.hoverData.which=null}}},!1);var U=[],K=4,$,Q=1e5,ie=function(de,ge){for(var ke=0;ke<de.length;ke++)if(de[ke]%ge!==0)return!1;return!0},te=function(de){for(var ge=Math.abs(de[0]),ke=1;ke<de.length;ke++)if(Math.abs(de[ke])!==ge)return!1;return!0},X=function(de){var ge=!1,ke=de.deltaY;if(ke==null&&(de.wheelDeltaY!=null?ke=de.wheelDeltaY/4:de.wheelDelta!=null&&(ke=de.wheelDelta/4)),ke!==0){if($==null)if(U.length>=K){var Ee=U;if($=ie(Ee,5),!$){var Re=Math.abs(Ee[0]);$=te(Ee)&&Re>5}if($)for(var Qe=0;Qe<Ee.length;Qe++)Q=Math.min(Math.abs(Ee[Qe]),Q)}else U.push(ke),ge=!0;else $&&(Q=Math.min(Math.abs(ke),Q));if(!t.scrollingPage){var Ge=t.cy,wt=Ge.zoom(),bt=Ge.pan(),pt=t.projectIntoViewport(de.clientX,de.clientY),Kt=[pt[0]*wt+bt.x,pt[1]*wt+bt.y];if(t.hoverData.draggingEles||t.hoverData.dragging||t.hoverData.cxtStarted||F()){de.preventDefault();return}if(Ge.panningEnabled()&&Ge.userPanningEnabled()&&Ge.zoomingEnabled()&&Ge.userZoomingEnabled()){de.preventDefault(),t.data.wheelZooming=!0,clearTimeout(t.data.wheelTimeout),t.data.wheelTimeout=setTimeout(function(){t.data.wheelZooming=!1,t.redrawHint("eles",!0),t.redraw()},150);var Wt;ge&&Math.abs(ke)>5&&(ke=c_(ke)*5),Wt=ke/-250,$&&(Wt/=Q,Wt*=3),Wt=Wt*t.wheelSensitivity;var Ve=de.deltaMode===1;Ve&&(Wt*=33);var vt=Ge.zoom()*Math.pow(10,Wt);de.type==="gesturechange"&&(vt=t.gestureStartZoom*de.scale),Ge.zoom({level:vt,renderedPosition:{x:Kt[0],y:Kt[1]}}),Ge.emit({type:de.type==="gesturechange"?"pinchzoom":"scrollzoom",originalEvent:de,position:{x:pt[0],y:pt[1]}})}}}};t.registerBinding(t.container,"wheel",X,!0),t.registerBinding(e,"scroll",function(de){t.scrollingPage=!0,clearTimeout(t.scrollingPageTimeout),t.scrollingPageTimeout=setTimeout(function(){t.scrollingPage=!1},250)},!0),t.registerBinding(t.container,"gesturestart",function(de){t.gestureStartZoom=t.cy.zoom(),t.hasTouchStarted||de.preventDefault()},!0),t.registerBinding(t.container,"gesturechange",function(Ie){t.hasTouchStarted||X(Ie)},!0),t.registerBinding(t.container,"mouseout",function(de){var ge=t.projectIntoViewport(de.clientX,de.clientY);t.cy.emit({originalEvent:de,type:"mouseout",position:{x:ge[0],y:ge[1]}})},!1),t.registerBinding(t.container,"mouseover",function(de){var ge=t.projectIntoViewport(de.clientX,de.clientY);t.cy.emit({originalEvent:de,type:"mouseover",position:{x:ge[0],y:ge[1]}})},!1);var re,fe,oe,se,he,ae,pe,ye,ve,ue,xe,Se,Ae,Me=function(de,ge,ke,Ee){return Math.sqrt((ke-de)*(ke-de)+(Ee-ge)*(Ee-ge))},st=function(de,ge,ke,Ee){return(ke-de)*(ke-de)+(Ee-ge)*(Ee-ge)},rt;t.registerBinding(t.container,"touchstart",rt=function(de){if(t.hasTouchStarted=!0,!!z(de)){T(),t.touchData.capture=!0,t.data.bgActivePosistion=void 0;var ge=t.cy,ke=t.touchData.now,Ee=t.touchData.earlier;if(de.touches[0]){var Re=t.projectIntoViewport(de.touches[0].clientX,de.touches[0].clientY);ke[0]=Re[0],ke[1]=Re[1]}if(de.touches[1]){var Re=t.projectIntoViewport(de.touches[1].clientX,de.touches[1].clientY);ke[2]=Re[0],ke[3]=Re[1]}if(de.touches[2]){var Re=t.projectIntoViewport(de.touches[2].clientX,de.touches[2].clientY);ke[4]=Re[0],ke[5]=Re[1]}var Qe=function(xr){return{originalEvent:de,type:xr,position:{x:ke[0],y:ke[1]}}};if(de.touches[1]){t.touchData.singleTouchMoved=!0,C(t.dragData.touchDragEles);var Ge=t.findContainerClientCoords();ve=Ge[0],ue=Ge[1],xe=Ge[2],Se=Ge[3],re=de.touches[0].clientX-ve,fe=de.touches[0].clientY-ue,oe=de.touches[1].clientX-ve,se=de.touches[1].clientY-ue,Ae=0<=re&&re<=xe&&0<=oe&&oe<=xe&&0<=fe&&fe<=Se&&0<=se&&se<=Se;var wt=ge.pan(),bt=ge.zoom();he=Me(re,fe,oe,se),ae=st(re,fe,oe,se),pe=[(re+oe)/2,(fe+se)/2],ye=[(pe[0]-wt.x)/bt,(pe[1]-wt.y)/bt];var pt=200,Kt=pt*pt;if(ae<Kt&&!de.touches[2]){var Wt=t.findNearestElement(ke[0],ke[1],!0,!0),Ve=t.findNearestElement(ke[2],ke[3],!0,!0);Wt&&Wt.isNode()?(Wt.activate().emit(Qe("cxttapstart")),t.touchData.start=Wt):Ve&&Ve.isNode()?(Ve.activate().emit(Qe("cxttapstart")),t.touchData.start=Ve):ge.emit(Qe("cxttapstart")),t.touchData.start&&(t.touchData.start._private.grabbed=!1),t.touchData.cxt=!0,t.touchData.cxtDragged=!1,t.data.bgActivePosistion=void 0,t.redraw();return}}if(de.touches[2])ge.boxSelectionEnabled()&&de.preventDefault();else if(!de.touches[1]){if(de.touches[0]){var vt=t.findNearestElements(ke[0],ke[1],!0,!0),Et=vt[0];if(Et!=null&&(Et.activate(),t.touchData.start=Et,t.touchData.starts=vt,t.nodeIsGrabbable(Et))){var er=t.dragData.touchDragEles=ge.collection(),gr=null;t.redrawHint("eles",!0),t.redrawHint("drag",!0),Et.selected()?(gr=ge.$(function(fn){return fn.selected()&&t.nodeIsGrabbable(fn)}),S(gr,{addToList:er})):w(Et,{addToList:er}),f(Et),Et.emit(Qe("grabon")),gr?gr.forEach(function(fn){fn.emit(Qe("grab"))}):Et.emit(Qe("grab"))}i(Et,["touchstart","tapstart","vmousedown"],de,{x:ke[0],y:ke[1]}),Et==null&&(t.data.bgActivePosistion={x:Re[0],y:Re[1]},t.redrawHint("select",!0),t.redraw()),t.touchData.singleTouchMoved=!1,t.touchData.singleTouchStartTime=+new Date,clearTimeout(t.touchData.tapholdTimeout),t.touchData.tapholdTimeout=setTimeout(function(){t.touchData.singleTouchMoved===!1&&!t.pinching&&!t.touchData.selecting&&i(t.touchData.start,["taphold"],de,{x:ke[0],y:ke[1]})},t.tapholdDuration)}}if(de.touches.length>=1){for(var Ir=t.touchData.startPosition=[null,null,null,null,null,null],zr=0;zr<ke.length;zr++)Ir[zr]=Ee[zr]=ke[zr];var Cr=de.touches[0];t.touchData.startGPosition=[Cr.clientX,Cr.clientY]}}},!1);var dt;t.registerBinding(e,"touchmove",dt=function(de){var ge=t.touchData.capture;if(!(!ge&&!z(de))){var ke=t.selection,Ee=t.cy,Re=t.touchData.now,Qe=t.touchData.earlier,Ge=Ee.zoom();if(de.touches[0]){var wt=t.projectIntoViewport(de.touches[0].clientX,de.touches[0].clientY);Re[0]=wt[0],Re[1]=wt[1]}if(de.touches[1]){var wt=t.projectIntoViewport(de.touches[1].clientX,de.touches[1].clientY);Re[2]=wt[0],Re[3]=wt[1]}if(de.touches[2]){var wt=t.projectIntoViewport(de.touches[2].clientX,de.touches[2].clientY);Re[4]=wt[0],Re[5]=wt[1]}var bt=function(jr){return{originalEvent:de,type:jr,position:{x:Re[0],y:Re[1]}}},pt=t.touchData.startGPosition,Kt;if(ge&&de.touches[0]&&pt){for(var Wt=[],Ve=0;Ve<Re.length;Ve++)Wt[Ve]=Re[Ve]-Qe[Ve];var vt=de.touches[0].clientX-pt[0],Et=vt*vt,er=de.touches[0].clientY-pt[1],gr=er*er,Ir=Et+gr;Kt=Ir>=t.touchTapThreshold2}if(ge&&t.touchData.cxt){de.preventDefault();var zr=de.touches[0].clientX-ve,Cr=de.touches[0].clientY-ue,fn=de.touches[1].clientX-ve,xr=de.touches[1].clientY-ue,Tt=st(zr,Cr,fn,xr),Ur=Tt/ae,Qn=150,Zi=Qn*Qn,ds=1.5,As=ds*ds;if(Ur>=As||Tt>=Zi){t.touchData.cxt=!1,t.data.bgActivePosistion=void 0,t.redrawHint("select",!0);var ni=bt("cxttapend");t.touchData.start?(t.touchData.start.unactivate().emit(ni),t.touchData.start=null):Ee.emit(ni)}}if(ge&&t.touchData.cxt){var ni=bt("cxtdrag");t.data.bgActivePosistion=void 0,t.redrawHint("select",!0),t.touchData.start?t.touchData.start.emit(ni):Ee.emit(ni),t.touchData.start&&(t.touchData.start._private.grabbed=!1),t.touchData.cxtDragged=!0;var sn=t.findNearestElement(Re[0],Re[1],!0,!0);(!t.touchData.cxtOver||sn!==t.touchData.cxtOver)&&(t.touchData.cxtOver&&t.touchData.cxtOver.emit(bt("cxtdragout")),t.touchData.cxtOver=sn,sn&&sn.emit(bt("cxtdragover")))}else if(ge&&de.touches[2]&&Ee.boxSelectionEnabled())de.preventDefault(),t.data.bgActivePosistion=void 0,this.lastThreeTouch=+new Date,t.touchData.selecting||Ee.emit(bt("boxstart")),t.touchData.selecting=!0,t.touchData.didSelect=!0,ke[4]=1,!ke||ke.length===0||ke[0]===void 0?(ke[0]=(Re[0]+Re[2]+Re[4])/3,ke[1]=(Re[1]+Re[3]+Re[5])/3,ke[2]=(Re[0]+Re[2]+Re[4])/3+1,ke[3]=(Re[1]+Re[3]+Re[5])/3+1):(ke[2]=(Re[0]+Re[2]+Re[4])/3,ke[3]=(Re[1]+Re[3]+Re[5])/3),t.redrawHint("select",!0),t.redraw();else if(ge&&de.touches[1]&&!t.touchData.didSelect&&Ee.zoomingEnabled()&&Ee.panningEnabled()&&Ee.userZoomingEnabled()&&Ee.userPanningEnabled()){de.preventDefault(),t.data.bgActivePosistion=void 0,t.redrawHint("select",!0);var kn=t.dragData.touchDragEles;if(kn){t.redrawHint("drag",!0);for(var In=0;In<kn.length;In++){var Ls=kn[In]._private;Ls.grabbed=!1,Ls.rscratch.inDragLayer=!1}}var gi=t.touchData.start,zr=de.touches[0].clientX-ve,Cr=de.touches[0].clientY-ue,fn=de.touches[1].clientX-ve,xr=de.touches[1].clientY-ue,ko=Me(zr,Cr,fn,xr),qa=ko/he;if(Ae){var Ou=zr-re,_o=Cr-fe,on=fn-oe,Co=xr-se,fs=(Ou+on)/2,ro=(_o+Co)/2,Yi=Ee.zoom(),no=Yi*qa,Ue=Ee.pan(),Ye=ye[0]*Yi+Ue.x,et=ye[1]*Yi+Ue.y,ht={x:-no/Yi*(Ye-Ue.x-fs)+Ye,y:-no/Yi*(et-Ue.y-ro)+et};if(gi&&gi.active()){var kn=t.dragData.touchDragEles;C(kn),t.redrawHint("drag",!0),t.redrawHint("eles",!0),gi.unactivate().emit(bt("freeon")),kn.emit(bt("free")),t.dragData.didDrag&&(gi.emit(bt("dragfreeon")),kn.emit(bt("dragfree")))}Ee.viewport({zoom:no,pan:ht,cancelOnFailedZoom:!0}),Ee.emit(bt("pinchzoom")),he=ko,re=zr,fe=Cr,oe=fn,se=xr,t.pinching=!0}if(de.touches[0]){var wt=t.projectIntoViewport(de.touches[0].clientX,de.touches[0].clientY);Re[0]=wt[0],Re[1]=wt[1]}if(de.touches[1]){var wt=t.projectIntoViewport(de.touches[1].clientX,de.touches[1].clientY);Re[2]=wt[0],Re[3]=wt[1]}if(de.touches[2]){var wt=t.projectIntoViewport(de.touches[2].clientX,de.touches[2].clientY);Re[4]=wt[0],Re[5]=wt[1]}}else if(de.touches[0]&&!t.touchData.didSelect){var Ze=t.touchData.start,Dt=t.touchData.last,sn;if(!t.hoverData.draggingEles&&!t.swipePanning&&(sn=t.findNearestElement(Re[0],Re[1],!0,!0)),ge&&Ze!=null&&de.preventDefault(),ge&&Ze!=null&&t.nodeIsDraggable(Ze))if(Kt){var kn=t.dragData.touchDragEles,Pr=!t.dragData.didDrag;Pr&&S(kn,{inDragLayer:!0}),t.dragData.didDrag=!0;var Mr={x:0,y:0};if(_t(Wt[0])&&_t(Wt[1])&&(Mr.x+=Wt[0],Mr.y+=Wt[1],Pr)){t.redrawHint("eles",!0);var Br=t.touchData.dragDelta;Br&&_t(Br[0])&&_t(Br[1])&&(Mr.x+=Br[0],Mr.y+=Br[1])}t.hoverData.draggingEles=!0,kn.silentShift(Mr).emit(bt("position")).emit(bt("drag")),t.redrawHint("drag",!0),t.touchData.startPosition[0]==Qe[0]&&t.touchData.startPosition[1]==Qe[1]&&t.redrawHint("eles",!0),t.redraw()}else{var Br=t.touchData.dragDelta=t.touchData.dragDelta||[];Br.length===0?(Br.push(Wt[0]),Br.push(Wt[1])):(Br[0]+=Wt[0],Br[1]+=Wt[1])}if(i(Ze||sn,["touchmove","tapdrag","vmousemove"],de,{x:Re[0],y:Re[1]}),(!Ze||!Ze.grabbed())&&sn!=Dt&&(Dt&&Dt.emit(bt("tapdragout")),sn&&sn.emit(bt("tapdragover"))),t.touchData.last=sn,ge)for(var In=0;In<Re.length;In++)Re[In]&&t.touchData.startPosition[In]&&Kt&&(t.touchData.singleTouchMoved=!0);if(ge&&(Ze==null||Ze.pannable())&&Ee.panningEnabled()&&Ee.userPanningEnabled()){var vi=s(Ze,t.touchData.starts);vi&&(de.preventDefault(),t.data.bgActivePosistion||(t.data.bgActivePosistion=Ap(t.touchData.startPosition)),t.swipePanning?(Ee.panBy({x:Wt[0]*Ge,y:Wt[1]*Ge}),Ee.emit(bt("dragpan"))):Kt&&(t.swipePanning=!0,Ee.panBy({x:vt*Ge,y:er*Ge}),Ee.emit(bt("dragpan")),Ze&&(Ze.unactivate(),t.redrawHint("select",!0),t.touchData.start=null)));var wt=t.projectIntoViewport(de.touches[0].clientX,de.touches[0].clientY);Re[0]=wt[0],Re[1]=wt[1]}}for(var Ve=0;Ve<Re.length;Ve++)Qe[Ve]=Re[Ve];ge&&de.touches.length>0&&!t.hoverData.draggingEles&&!t.swipePanning&&t.data.bgActivePosistion!=null&&(t.data.bgActivePosistion=void 0,t.redrawHint("select",!0),t.redraw())}},!1);var Ct;t.registerBinding(e,"touchcancel",Ct=function(de){var ge=t.touchData.start;t.touchData.capture=!1,ge&&ge.unactivate()});var Ke,ut,ct,xt;if(t.registerBinding(e,"touchend",Ke=function(de){var ge=t.touchData.start,ke=t.touchData.capture;if(ke)de.touches.length===0&&(t.touchData.capture=!1),de.preventDefault();else return;var Ee=t.selection;t.swipePanning=!1,t.hoverData.draggingEles=!1;var Re=t.cy,Qe=Re.zoom(),Ge=t.touchData.now,wt=t.touchData.earlier;if(de.touches[0]){var bt=t.projectIntoViewport(de.touches[0].clientX,de.touches[0].clientY);Ge[0]=bt[0],Ge[1]=bt[1]}if(de.touches[1]){var bt=t.projectIntoViewport(de.touches[1].clientX,de.touches[1].clientY);Ge[2]=bt[0],Ge[3]=bt[1]}if(de.touches[2]){var bt=t.projectIntoViewport(de.touches[2].clientX,de.touches[2].clientY);Ge[4]=bt[0],Ge[5]=bt[1]}var pt=function(Zi){return{originalEvent:de,type:Zi,position:{x:Ge[0],y:Ge[1]}}};ge&&ge.unactivate();var Kt;if(t.touchData.cxt){if(Kt=pt("cxttapend"),ge?ge.emit(Kt):Re.emit(Kt),!t.touchData.cxtDragged){var Wt=pt("cxttap");ge?ge.emit(Wt):Re.emit(Wt)}t.touchData.start&&(t.touchData.start._private.grabbed=!1),t.touchData.cxt=!1,t.touchData.start=null,t.redraw();return}if(!de.touches[2]&&Re.boxSelectionEnabled()&&t.touchData.selecting){t.touchData.selecting=!1;var Ve=Re.collection(t.getAllInBox(Ee[0],Ee[1],Ee[2],Ee[3]));Ee[0]=void 0,Ee[1]=void 0,Ee[2]=void 0,Ee[3]=void 0,Ee[4]=0,t.redrawHint("select",!0),Re.emit(pt("boxend"));var vt=function(Zi){return Zi.selectable()&&!Zi.selected()};Ve.emit(pt("box")).stdFilter(vt).select().emit(pt("boxselect")),Ve.nonempty()&&t.redrawHint("eles",!0),t.redraw()}if(ge?.unactivate(),de.touches[2])t.data.bgActivePosistion=void 0,t.redrawHint("select",!0);else if(!de.touches[1]){if(!de.touches[0]){if(!de.touches[0]){t.data.bgActivePosistion=void 0,t.redrawHint("select",!0);var Et=t.dragData.touchDragEles;if(ge!=null){var er=ge._private.grabbed;C(Et),t.redrawHint("drag",!0),t.redrawHint("eles",!0),er&&(ge.emit(pt("freeon")),Et.emit(pt("free")),t.dragData.didDrag&&(ge.emit(pt("dragfreeon")),Et.emit(pt("dragfree")))),i(ge,["touchend","tapend","vmouseup","tapdragout"],de,{x:Ge[0],y:Ge[1]}),ge.unactivate(),t.touchData.start=null}else{var gr=t.findNearestElement(Ge[0],Ge[1],!0,!0);i(gr,["touchend","tapend","vmouseup","tapdragout"],de,{x:Ge[0],y:Ge[1]})}var Ir=t.touchData.startPosition[0]-Ge[0],zr=Ir*Ir,Cr=t.touchData.startPosition[1]-Ge[1],fn=Cr*Cr,xr=zr+fn,Tt=xr*Qe*Qe;t.touchData.singleTouchMoved||(ge||Re.$(":selected").unselect(["tapunselect"]),i(ge,["tap","vclick"],de,{x:Ge[0],y:Ge[1]}),ut=!1,de.timeStamp-xt<=Re.multiClickDebounceTime()?(ct&&clearTimeout(ct),ut=!0,xt=null,i(ge,["dbltap","vdblclick"],de,{x:Ge[0],y:Ge[1]})):(ct=setTimeout(function(){ut||i(ge,["onetap","voneclick"],de,{x:Ge[0],y:Ge[1]})},Re.multiClickDebounceTime()),xt=de.timeStamp)),ge!=null&&!t.dragData.didDrag&&ge._private.selectable&&Tt<t.touchTapThreshold2&&!t.pinching&&(Re.selectionType()==="single"?(Re.$(r).unmerge(ge).unselect(["tapunselect"]),ge.select(["tapselect"])):ge.selected()?ge.unselect(["tapunselect"]):ge.select(["tapselect"]),t.redrawHint("eles",!0)),t.touchData.singleTouchMoved=!0}}}for(var Ur=0;Ur<Ge.length;Ur++)wt[Ur]=Ge[Ur];t.dragData.didDrag=!1,de.touches.length===0&&(t.touchData.dragDelta=[],t.touchData.startPosition=[null,null,null,null,null,null],t.touchData.startGPosition=null,t.touchData.didSelect=!1),de.touches.length<2&&(de.touches.length===1&&(t.touchData.startGPosition=[de.touches[0].clientX,de.touches[0].clientY]),t.pinching=!1,t.redrawHint("eles",!0),t.redraw())},!1),typeof TouchEvent>"u"){var ot=[],Lt=function(de){return{clientX:de.clientX,clientY:de.clientY,force:1,identifier:de.pointerId,pageX:de.pageX,pageY:de.pageY,radiusX:de.width/2,radiusY:de.height/2,screenX:de.screenX,screenY:de.screenY,target:de.target}},Bt=function(de){return{event:de,touch:Lt(de)}},Ne=function(de){ot.push(Bt(de))},qe=function(de){for(var ge=0;ge<ot.length;ge++){var ke=ot[ge];if(ke.event.pointerId===de.pointerId){ot.splice(ge,1);return}}},St=function(de){var ge=ot.filter(function(ke){return ke.event.pointerId===de.pointerId})[0];ge.event=de,ge.touch=Lt(de)},it=function(de){de.touches=ot.map(function(ge){return ge.touch})},lt=function(de){return de.pointerType==="mouse"||de.pointerType===4};t.registerBinding(t.container,"pointerdown",function(Ie){lt(Ie)||(Ie.preventDefault(),Ne(Ie),it(Ie),rt(Ie))}),t.registerBinding(t.container,"pointerup",function(Ie){lt(Ie)||(qe(Ie),it(Ie),Ke(Ie))}),t.registerBinding(t.container,"pointercancel",function(Ie){lt(Ie)||(qe(Ie),it(Ie),Ct(Ie))}),t.registerBinding(t.container,"pointermove",function(Ie){lt(Ie)||(Ie.preventDefault(),St(Ie),it(Ie),dt(Ie))})}};var Sc={};Sc.generatePolygon=function(t,e){return this.nodeShapes[t]={renderer:this,name:t,points:e,draw:function(n,i,a,s,o,l){this.renderer.nodeShapeImpl("polygon",n,i,a,s,o,this.points)},intersectLine:function(n,i,a,s,o,l,u,c){return Cv(o,l,this.points,n,i,a/2,s/2,u)},checkPoint:function(n,i,a,s,o,l,u,c){return xc(n,i,this.points,l,u,s,o,[0,-1],a)},hasMiterBounds:t!=="rectangle",miterBounds:function(n,i,a,s,o,l){return oF(this.points,n,i,a,s,o)}}};Sc.generateEllipse=function(){return this.nodeShapes.ellipse={renderer:this,name:"ellipse",draw:function(e,r,n,i,a,s){this.renderer.nodeShapeImpl(this.name,e,r,n,i,a)},intersectLine:function(e,r,n,i,a,s,o,l){return mF(a,s,e,r,n/2+o,i/2+o)},checkPoint:function(e,r,n,i,a,s,o,l){return rh(e,r,i,a,s,o,n)}}};Sc.generateRoundPolygon=function(t,e){return this.nodeShapes[t]={renderer:this,name:t,points:e,getOrCreateCorners:function(n,i,a,s,o,l,u){if(l[u]!==void 0&&l[u+"-cx"]===n&&l[u+"-cy"]===i)return l[u];l[u]=new Array(e.length/2),l[u+"-cx"]=n,l[u+"-cy"]=i;var c=a/2,f=s/2;o=o==="auto"?sA(a,s):o;for(var p=new Array(e.length/2),g=0;g<e.length/2;g++)p[g]={x:n+c*e[g*2],y:i+f*e[g*2+1]};var y,S,w,C,_=p.length;for(S=p[_-1],y=0;y<_;y++)w=p[y%_],C=p[(y+1)%_],l[u][y]=k_(S,w,C,o),S=w,w=C;return l[u]},draw:function(n,i,a,s,o,l,u){this.renderer.nodeShapeImpl("round-polygon",n,i,a,s,o,this.points,this.getOrCreateCorners(i,a,s,o,l,u,"drawCorners"))},intersectLine:function(n,i,a,s,o,l,u,c,f){return vF(o,l,this.points,n,i,a,s,u,this.getOrCreateCorners(n,i,a,s,c,f,"corners"))},checkPoint:function(n,i,a,s,o,l,u,c,f){return pF(n,i,this.points,l,u,s,o,this.getOrCreateCorners(l,u,s,o,c,f,"corners"))}}};Sc.generateRoundRectangle=function(){return this.nodeShapes["round-rectangle"]=this.nodeShapes.roundrectangle={renderer:this,name:"round-rectangle",points:Cs(4,0),draw:function(e,r,n,i,a,s){this.renderer.nodeShapeImpl(this.name,e,r,n,i,a,this.points,s)},intersectLine:function(e,r,n,i,a,s,o,l){return iA(a,s,e,r,n,i,o,l)},checkPoint:function(e,r,n,i,a,s,o,l){var u=i/2,c=a/2;l=l==="auto"?Yd(i,a):l,l=Math.min(u,c,l);var f=l*2;return!!(xc(e,r,this.points,s,o,i,a-f,[0,-1],n)||xc(e,r,this.points,s,o,i-f,a,[0,-1],n)||rh(e,r,f,f,s-u+l,o-c+l,n)||rh(e,r,f,f,s+u-l,o-c+l,n)||rh(e,r,f,f,s+u-l,o+c-l,n)||rh(e,r,f,f,s-u+l,o+c-l,n))}}};Sc.generateCutRectangle=function(){return this.nodeShapes["cut-rectangle"]=this.nodeShapes.cutrectangle={renderer:this,name:"cut-rectangle",cornerLength:f_(),points:Cs(4,0),draw:function(e,r,n,i,a,s){this.renderer.nodeShapeImpl(this.name,e,r,n,i,a,null,s)},generateCutTrianglePts:function(e,r,n,i,a){var s=a==="auto"?this.cornerLength:a,o=r/2,l=e/2,u=n-l,c=n+l,f=i-o,p=i+o;return{topLeft:[u,f+s,u+s,f,u+s,f+s],topRight:[c-s,f,c,f+s,c-s,f+s],bottomRight:[c,p-s,c-s,p,c-s,p-s],bottomLeft:[u+s,p,u,p-s,u+s,p-s]}},intersectLine:function(e,r,n,i,a,s,o,l){var u=this.generateCutTrianglePts(n+2*o,i+2*o,e,r,l),c=[].concat.apply([],[u.topLeft.splice(0,4),u.topRight.splice(0,4),u.bottomRight.splice(0,4),u.bottomLeft.splice(0,4)]);return Cv(a,s,c,e,r)},checkPoint:function(e,r,n,i,a,s,o,l){var u=l==="auto"?this.cornerLength:l;if(xc(e,r,this.points,s,o,i,a-2*u,[0,-1],n)||xc(e,r,this.points,s,o,i-2*u,a,[0,-1],n))return!0;var c=this.generateCutTrianglePts(i,a,s,o);return Ks(e,r,c.topLeft)||Ks(e,r,c.topRight)||Ks(e,r,c.bottomRight)||Ks(e,r,c.bottomLeft)}}};Sc.generateBarrel=function(){return this.nodeShapes.barrel={renderer:this,name:"barrel",points:Cs(4,0),draw:function(e,r,n,i,a,s){this.renderer.nodeShapeImpl(this.name,e,r,n,i,a)},intersectLine:function(e,r,n,i,a,s,o,l){var u=.15,c=.5,f=.85,p=this.generateBarrelBezierPts(n+2*o,i+2*o,e,r),g=function(w){var C=Ip({x:w[0],y:w[1]},{x:w[2],y:w[3]},{x:w[4],y:w[5]},u),_=Ip({x:w[0],y:w[1]},{x:w[2],y:w[3]},{x:w[4],y:w[5]},c),T=Ip({x:w[0],y:w[1]},{x:w[2],y:w[3]},{x:w[4],y:w[5]},f);return[w[0],w[1],C.x,C.y,_.x,_.y,T.x,T.y,w[4],w[5]]},y=[].concat(g(p.topLeft),g(p.topRight),g(p.bottomRight),g(p.bottomLeft));return Cv(a,s,y,e,r)},generateBarrelBezierPts:function(e,r,n,i){var a=r/2,s=e/2,o=n-s,l=n+s,u=i-a,c=i+a,f=GS(e,r),p=f.heightOffset,g=f.widthOffset,y=f.ctrlPtOffsetPct*e,S={topLeft:[o,u+p,o+y,u,o+g,u],topRight:[l-g,u,l-y,u,l,u+p],bottomRight:[l,c-p,l-y,c,l-g,c],bottomLeft:[o+g,c,o+y,c,o,c-p]};return S.topLeft.isTop=!0,S.topRight.isTop=!0,S.bottomLeft.isBottom=!0,S.bottomRight.isBottom=!0,S},checkPoint:function(e,r,n,i,a,s,o,l){var u=GS(i,a),c=u.heightOffset,f=u.widthOffset;if(xc(e,r,this.points,s,o,i,a-2*c,[0,-1],n)||xc(e,r,this.points,s,o,i-2*f,a,[0,-1],n))return!0;for(var p=this.generateBarrelBezierPts(i,a,s,o),g=function(O,F,z){var G=z[4],Z=z[2],I=z[0],W=z[5],U=z[1],K=Math.min(G,I),$=Math.max(G,I),Q=Math.min(W,U),ie=Math.max(W,U);if(K<=O&&O<=$&&Q<=F&&F<=ie){var te=yF(G,Z,I),X=cF(te[0],te[1],te[2],O),re=X.filter(function(fe){return 0<=fe&&fe<=1});if(re.length>0)return re[0]}return null},y=Object.keys(p),S=0;S<y.length;S++){var w=y[S],C=p[w],_=g(e,r,C);if(_!=null){var T=C[5],N=C[3],R=C[1],D=da(T,N,R,_);if(C.isTop&&D<=r||C.isBottom&&r<=D)return!0}}return!1}}};Sc.generateBottomRoundrectangle=function(){return this.nodeShapes["bottom-round-rectangle"]=this.nodeShapes.bottomroundrectangle={renderer:this,name:"bottom-round-rectangle",points:Cs(4,0),draw:function(e,r,n,i,a,s){this.renderer.nodeShapeImpl(this.name,e,r,n,i,a,this.points,s)},intersectLine:function(e,r,n,i,a,s,o,l){var u=e-(n/2+o),c=r-(i/2+o),f=c,p=e+(n/2+o),g=Dd(a,s,e,r,u,c,p,f,!1);return g.length>0?g:iA(a,s,e,r,n,i,o,l)},checkPoint:function(e,r,n,i,a,s,o,l){l=l==="auto"?Yd(i,a):l;var u=2*l;if(xc(e,r,this.points,s,o,i,a-u,[0,-1],n)||xc(e,r,this.points,s,o,i-u,a,[0,-1],n))return!0;var c=i/2+2*n,f=a/2+2*n,p=[s-c,o-f,s-c,o,s+c,o,s+c,o-f];return!!(Ks(e,r,p)||rh(e,r,u,u,s+i/2-l,o+a/2-l,n)||rh(e,r,u,u,s-i/2+l,o+a/2-l,n))}}};Sc.registerNodeShapes=function(){var t=this.nodeShapes={},e=this;this.generateEllipse(),this.generatePolygon("triangle",Cs(3,0)),this.generateRoundPolygon("round-triangle",Cs(3,0)),this.generatePolygon("rectangle",Cs(4,0)),t.square=t.rectangle,this.generateRoundRectangle(),this.generateCutRectangle(),this.generateBarrel(),this.generateBottomRoundrectangle();{var r=[0,1,1,0,0,-1,-1,0];this.generatePolygon("diamond",r),this.generateRoundPolygon("round-diamond",r)}this.generatePolygon("pentagon",Cs(5,0)),this.generateRoundPolygon("round-pentagon",Cs(5,0)),this.generatePolygon("hexagon",Cs(6,0)),this.generateRoundPolygon("round-hexagon",Cs(6,0)),this.generatePolygon("heptagon",Cs(7,0)),this.generateRoundPolygon("round-heptagon",Cs(7,0)),this.generatePolygon("octagon",Cs(8,0)),this.generateRoundPolygon("round-octagon",Cs(8,0));var n=new Array(20);{var i=US(5,0),a=US(5,Math.PI/5),s=.5*(3-Math.sqrt(5));s*=1.57;for(var o=0;o<a.length/2;o++)a[o*2]*=s,a[o*2+1]*=s;for(var o=0;o<20/4;o++)n[o*4]=i[o*2],n[o*4+1]=i[o*2+1],n[o*4+2]=a[o*2],n[o*4+3]=a[o*2+1]}n=aA(n),this.generatePolygon("star",n),this.generatePolygon("vee",[-1,-1,0,-.333,1,-1,0,1]),this.generatePolygon("rhomboid",[-1,-1,.333,-1,1,1,-.333,1]),this.generatePolygon("right-rhomboid",[-.333,-1,1,-1,.333,1,-1,1]),this.nodeShapes.concavehexagon=this.generatePolygon("concave-hexagon",[-1,-.95,-.75,0,-1,.95,1,.95,.75,0,1,-.95]);{var l=[-1,-1,.25,-1,1,0,.25,1,-1,1];this.generatePolygon("tag",l),this.generateRoundPolygon("round-tag",l)}t.makePolygon=function(u){var c=u.join("$"),f="polygon-"+c,p;return(p=this[f])?p:e.generatePolygon(f,u)}};var s0={};s0.timeToRender=function(){return this.redrawTotalTime/this.redrawCount};s0.redraw=function(t){t=t||eA();var e=this;e.averageRedrawTime===void 0&&(e.averageRedrawTime=0),e.lastRedrawTime===void 0&&(e.lastRedrawTime=0),e.lastDrawTime===void 0&&(e.lastDrawTime=0),e.requestedFrame=!0,e.renderOptions=t};s0.beforeRender=function(t,e){if(!this.destroyed){e==null&&Zn("Priority is not optional for beforeRender");var r=this.beforeRenderCallbacks;r.push({fn:t,priority:e}),r.sort(function(n,i){return i.priority-n.priority})}};var $N=function(e,r,n){for(var i=e.beforeRenderCallbacks,a=0;a<i.length;a++)i[a].fn(r,n)};s0.startRenderLoop=function(){var t=this,e=t.cy;if(!t.renderLoopStarted){t.renderLoopStarted=!0;var r=function(i){if(!t.destroyed){if(!e.batching())if(t.requestedFrame&&!t.skipFrame){$N(t,!0,i);var a=yc();t.render(t.renderOptions);var s=t.lastDrawTime=yc();t.averageRedrawTime===void 0&&(t.averageRedrawTime=s-a),t.redrawCount===void 0&&(t.redrawCount=0),t.redrawCount++,t.redrawTotalTime===void 0&&(t.redrawTotalTime=0);var o=s-a;t.redrawTotalTime+=o,t.lastRedrawTime=o,t.averageRedrawTime=t.averageRedrawTime/2+o/2,t.requestedFrame=!1}else $N(t,!1,i);t.skipFrame=!1,cx(r)}};cx(r)}};var Oz=function(e){this.init(e)},sL=Oz,hm=sL.prototype;hm.clientFunctions=["redrawHint","render","renderTo","matchCanvasSize","nodeShapeImpl","arrowShapeImpl"];hm.init=function(t){var e=this;e.options=t,e.cy=t.cy;var r=e.container=t.cy.container(),n=e.cy.window();if(n){var i=n.document,a=i.head,s="__________cytoscape_stylesheet",o="__________cytoscape_container",l=i.getElementById(s)!=null;if(r.className.indexOf(o)<0&&(r.className=(r.className||"")+" "+o),!l){var u=i.createElement("style");u.id=s,u.textContent="."+o+" { position: relative; }",a.insertBefore(u,a.children[0])}var c=n.getComputedStyle(r),f=c.getPropertyValue("position");f==="static"&&an("A Cytoscape container has style position:static and so can not use UI extensions properly")}e.selection=[void 0,void 0,void 0,void 0,0],e.bezierProjPcts=[.05,.225,.4,.5,.6,.775,.95],e.hoverData={down:null,last:null,downTime:null,triggerMode:null,dragging:!1,initialPan:[null,null],capture:!1},e.dragData={possibleDragElements:[]},e.touchData={start:null,capture:!1,startPosition:[null,null,null,null,null,null],singleTouchStartTime:null,singleTouchMoved:!0,now:[null,null,null,null,null,null],earlier:[null,null,null,null,null,null]},e.redraws=0,e.showFps=t.showFps,e.debug=t.debug,e.webgl=t.webgl,e.hideEdgesOnViewport=t.hideEdgesOnViewport,e.textureOnViewport=t.textureOnViewport,e.wheelSensitivity=t.wheelSensitivity,e.motionBlurEnabled=t.motionBlur,e.forcedPixelRatio=_t(t.pixelRatio)?t.pixelRatio:null,e.motionBlur=t.motionBlur,e.motionBlurOpacity=t.motionBlurOpacity,e.motionBlurTransparency=1-e.motionBlurOpacity,e.motionBlurPxRatio=1,e.mbPxRBlurry=1,e.minMbLowQualFrames=4,e.fullQualityMb=!1,e.clearedForMotionBlur=[],e.desktopTapThreshold=t.desktopTapThreshold,e.desktopTapThreshold2=t.desktopTapThreshold*t.desktopTapThreshold,e.touchTapThreshold=t.touchTapThreshold,e.touchTapThreshold2=t.touchTapThreshold*t.touchTapThreshold,e.tapholdDuration=500,e.bindings=[],e.beforeRenderCallbacks=[],e.beforeRenderPriorities={animations:400,eleCalcs:300,eleTxrDeq:200,lyrTxrDeq:150,lyrTxrSkip:100},e.registerNodeShapes(),e.registerArrowShapes(),e.registerCalculationListeners()};hm.notify=function(t,e){var r=this,n=r.cy;if(!this.destroyed){if(t==="init"){r.load();return}if(t==="destroy"){r.destroy();return}(t==="add"||t==="remove"||t==="move"&&n.hasCompoundNodes()||t==="load"||t==="zorder"||t==="mount")&&r.invalidateCachedZSortedEles(),t==="viewport"&&r.redrawHint("select",!0),t==="gc"&&r.redrawHint("gc",!0),(t==="load"||t==="resize"||t==="mount")&&(r.invalidateContainerClientCoordsCache(),r.matchCanvasSize(r.container)),r.redrawHint("eles",!0),r.redrawHint("drag",!0),this.startRenderLoop(),this.redraw()}};hm.destroy=function(){var t=this;t.destroyed=!0,t.cy.stopAnimationLoop();for(var e=0;e<t.bindings.length;e++){var r=t.bindings[e],n=r,i=n.target;(i.off||i.removeEventListener).apply(i,n.args)}if(t.bindings=[],t.beforeRenderCallbacks=[],t.onUpdateEleCalcsFns=[],t.removeObserver&&t.removeObserver.disconnect(),t.styleObserver&&t.styleObserver.disconnect(),t.resizeObserver&&t.resizeObserver.disconnect(),t.labelCalcDiv)try{document.body.removeChild(t.labelCalcDiv)}catch{}};hm.isHeadless=function(){return!1};[S_,iL,aL,fm,Sc,s0].forEach(function(t){sr(hm,t)});var v2=1e3/60,oL={setupDequeueing:function(e){return function(){var n=this,i=this.renderer;if(!n.dequeueingSetup){n.dequeueingSetup=!0;var a=t0(function(){i.redrawHint("eles",!0),i.redrawHint("drag",!0),i.redraw()},e.deqRedrawThreshold),s=function(u,c){var f=yc(),p=i.averageRedrawTime,g=i.lastRedrawTime,y=[],S=i.cy.extent(),w=i.getPixelRatio();for(u||i.flushRenderedStyleQueue();;){var C=yc(),_=C-f,T=C-c;if(g<v2){var N=v2-(u?p:0);if(T>=e.deqFastCost*N)break}else if(u){if(_>=e.deqCost*g||_>=e.deqAvgCost*p)break}else if(T>=e.deqNoDrawCost*v2)break;var R=e.deq(n,w,S);if(R.length>0)for(var D=0;D<R.length;D++)y.push(R[D]);else break}y.length>0&&(e.onDeqd(n,y),!u&&e.shouldRedraw(n,y,w,S)&&a())},o=e.priority||o_;i.beforeRender(s,o(n))}}}},Dz=(function(){function t(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:dx;sf(this,t),this.idsByKey=new fc,this.keyForId=new fc,this.cachesByLvl=new fc,this.lvls=[],this.getKey=e,this.doesEleInvalidateKey=r}return of(t,[{key:"getIdsFor",value:function(r){r==null&&Zn("Can not get id list for null key");var n=this.idsByKey,i=this.idsByKey.get(r);return i||(i=new lm,n.set(r,i)),i}},{key:"addIdForKey",value:function(r,n){r!=null&&this.getIdsFor(r).add(n)}},{key:"deleteIdForKey",value:function(r,n){r!=null&&this.getIdsFor(r).delete(n)}},{key:"getNumberOfIdsForKey",value:function(r){return r==null?0:this.getIdsFor(r).size}},{key:"updateKeyMappingFor",value:function(r){var n=r.id(),i=this.keyForId.get(n),a=this.getKey(r);this.deleteIdForKey(i,n),this.addIdForKey(a,n),this.keyForId.set(n,a)}},{key:"deleteKeyMappingFor",value:function(r){var n=r.id(),i=this.keyForId.get(n);this.deleteIdForKey(i,n),this.keyForId.delete(n)}},{key:"keyHasChangedFor",value:function(r){var n=r.id(),i=this.keyForId.get(n),a=this.getKey(r);return i!==a}},{key:"isInvalid",value:function(r){return this.keyHasChangedFor(r)||this.doesEleInvalidateKey(r)}},{key:"getCachesAt",value:function(r){var n=this.cachesByLvl,i=this.lvls,a=n.get(r);return a||(a=new fc,n.set(r,a),i.push(r)),a}},{key:"getCache",value:function(r,n){return this.getCachesAt(n).get(r)}},{key:"get",value:function(r,n){var i=this.getKey(r),a=this.getCache(i,n);return a!=null&&this.updateKeyMappingFor(r),a}},{key:"getForCachedKey",value:function(r,n){var i=this.keyForId.get(r.id()),a=this.getCache(i,n);return a}},{key:"hasCache",value:function(r,n){return this.getCachesAt(n).has(r)}},{key:"has",value:function(r,n){var i=this.getKey(r);return this.hasCache(i,n)}},{key:"setCache",value:function(r,n,i){i.key=r,this.getCachesAt(n).set(r,i)}},{key:"set",value:function(r,n,i){var a=this.getKey(r);this.setCache(a,n,i),this.updateKeyMappingFor(r)}},{key:"deleteCache",value:function(r,n){this.getCachesAt(n).delete(r)}},{key:"delete",value:function(r,n){var i=this.getKey(r);this.deleteCache(i,n)}},{key:"invalidateKey",value:function(r){var n=this;this.lvls.forEach(function(i){return n.deleteCache(r,i)})}},{key:"invalidate",value:function(r){var n=r.id(),i=this.keyForId.get(n);this.deleteKeyMappingFor(r);var a=this.doesEleInvalidateKey(r);return a&&this.invalidateKey(i),a||this.getNumberOfIdsForKey(i)===0}}])})(),KN=25,cy=50,$y=-4,tk=3,lL=7.99,Iz=8,jz=1024,Fz=1024,Bz=1024,zz=.2,Uz=.8,Gz=10,Vz=.15,Hz=.1,Wz=.9,qz=.9,$z=100,Kz=1,Rp={dequeue:"dequeue",downscale:"downscale",highQuality:"highQuality"},Zz=Ha({getKey:null,doesEleInvalidateKey:dx,drawElement:null,getBoundingBox:null,getRotationPoint:null,getRotationOffset:null,isVisible:XM,allowEdgeTxrCaching:!0,allowParentTxrCaching:!0}),Kg=function(e,r){var n=this;n.renderer=e,n.onDequeues=[];var i=Zz(r);sr(n,i),n.lookup=new Dz(i.getKey,i.doesEleInvalidateKey),n.setupDequeueing()},Ki=Kg.prototype;Ki.reasons=Rp;Ki.getTextureQueue=function(t){var e=this;return e.eleImgCaches=e.eleImgCaches||{},e.eleImgCaches[t]=e.eleImgCaches[t]||[]};Ki.getRetiredTextureQueue=function(t){var e=this,r=e.eleImgCaches.retired=e.eleImgCaches.retired||{},n=r[t]=r[t]||[];return n};Ki.getElementQueue=function(){var t=this,e=t.eleCacheQueue=t.eleCacheQueue||new r0(function(r,n){return n.reqs-r.reqs});return e};Ki.getElementKeyToQueue=function(){var t=this,e=t.eleKeyToCacheQueue=t.eleKeyToCacheQueue||{};return e};Ki.getElement=function(t,e,r,n,i){var a=this,s=this.renderer,o=s.cy.zoom(),l=this.lookup;if(!e||e.w===0||e.h===0||isNaN(e.w)||isNaN(e.h)||!t.visible()||t.removed()||!a.allowEdgeTxrCaching&&t.isEdge()||!a.allowParentTxrCaching&&t.isParent())return null;if(n==null&&(n=Math.ceil(u_(o*r))),n<$y)n=$y;else if(o>=lL||n>tk)return null;var u=Math.pow(2,n),c=e.h*u,f=e.w*u,p=s.eleTextBiggerThanMin(t,u);if(!this.isVisible(t,p))return null;var g=l.get(t,n);if(g&&g.invalidated&&(g.invalidated=!1,g.texture.invalidatedWidth-=g.width),g)return g;var y;if(c<=KN?y=KN:c<=cy?y=cy:y=Math.ceil(c/cy)*cy,c>Bz||f>Fz)return null;var S=a.getTextureQueue(y),w=S[S.length-2],C=function(){return a.recycleTexture(y,f)||a.addTexture(y,f)};w||(w=S[S.length-1]),w||(w=C()),w.width-w.usedWidth<f&&(w=C());for(var _=function(K){return K&&K.scaledLabelShown===p},T=i&&i===Rp.dequeue,N=i&&i===Rp.highQuality,R=i&&i===Rp.downscale,D,j=n+1;j<=tk;j++){var O=l.get(t,j);if(O){D=O;break}}var F=D&&D.level===n+1?D:null,z=function(){w.context.drawImage(F.texture.canvas,F.x,0,F.width,F.height,w.usedWidth,0,f,c)};if(w.context.setTransform(1,0,0,1,0,0),w.context.clearRect(w.usedWidth,0,f,y),_(F))z();else if(_(D))if(N){for(var G=D.level;G>n;G--)F=a.getElement(t,e,r,G,Rp.downscale);z()}else return a.queueElement(t,D.level-1),D;else{var Z;if(!T&&!N&&!R)for(var I=n-1;I>=$y;I--){var W=l.get(t,I);if(W){Z=W;break}}if(_(Z))return a.queueElement(t,n),Z;w.context.translate(w.usedWidth,0),w.context.scale(u,u),this.drawElement(w.context,t,e,p,!1),w.context.scale(1/u,1/u),w.context.translate(-w.usedWidth,0)}return g={x:w.usedWidth,texture:w,level:n,scale:u,width:f,height:c,scaledLabelShown:p},w.usedWidth+=Math.ceil(f+Iz),w.eleCaches.push(g),l.set(t,n,g),a.checkTextureFullness(w),g};Ki.invalidateElements=function(t){for(var e=0;e<t.length;e++)this.invalidateElement(t[e])};Ki.invalidateElement=function(t){var e=this,r=e.lookup,n=[],i=r.isInvalid(t);if(i){for(var a=$y;a<=tk;a++){var s=r.getForCachedKey(t,a);s&&n.push(s)}var o=r.invalidate(t);if(o)for(var l=0;l<n.length;l++){var u=n[l],c=u.texture;c.invalidatedWidth+=u.width,u.invalidated=!0,e.checkTextureUtility(c)}e.removeFromQueue(t)}};Ki.checkTextureUtility=function(t){t.invalidatedWidth>=zz*t.width&&this.retireTexture(t)};Ki.checkTextureFullness=function(t){var e=this,r=e.getTextureQueue(t.height);t.usedWidth/t.width>Uz&&t.fullnessChecks>=Gz?Zd(r,t):t.fullnessChecks++};Ki.retireTexture=function(t){var e=this,r=t.height,n=e.getTextureQueue(r),i=this.lookup;Zd(n,t),t.retired=!0;for(var a=t.eleCaches,s=0;s<a.length;s++){var o=a[s];i.deleteCache(o.key,o.level)}l_(a);var l=e.getRetiredTextureQueue(r);l.push(t)};Ki.addTexture=function(t,e){var r=this,n=r.getTextureQueue(t),i={};return n.push(i),i.eleCaches=[],i.height=t,i.width=Math.max(jz,e),i.usedWidth=0,i.invalidatedWidth=0,i.fullnessChecks=0,i.canvas=r.renderer.makeOffscreenCanvas(i.width,i.height),i.context=i.canvas.getContext("2d"),i};Ki.recycleTexture=function(t,e){for(var r=this,n=r.getTextureQueue(t),i=r.getRetiredTextureQueue(t),a=0;a<i.length;a++){var s=i[a];if(s.width>=e)return s.retired=!1,s.usedWidth=0,s.invalidatedWidth=0,s.fullnessChecks=0,l_(s.eleCaches),s.context.setTransform(1,0,0,1,0,0),s.context.clearRect(0,0,s.width,s.height),Zd(i,s),n.push(s),s}};Ki.queueElement=function(t,e){var r=this,n=r.getElementQueue(),i=r.getElementKeyToQueue(),a=this.getKey(t),s=i[a];if(s)s.level=Math.max(s.level,e),s.eles.merge(t),s.reqs++,n.updateItem(s);else{var o={eles:t.spawn().merge(t),level:e,reqs:1,key:a};n.push(o),i[a]=o}};Ki.dequeue=function(t){for(var e=this,r=e.getElementQueue(),n=e.getElementKeyToQueue(),i=[],a=e.lookup,s=0;s<Kz&&r.size()>0;s++){var o=r.pop(),l=o.key,u=o.eles[0],c=a.hasCache(u,o.level);if(n[l]=null,c)continue;i.push(o);var f=e.getBoundingBox(u);e.getElement(u,f,t,o.level,Rp.dequeue)}return i};Ki.removeFromQueue=function(t){var e=this,r=e.getElementQueue(),n=e.getElementKeyToQueue(),i=this.getKey(t),a=n[i];a!=null&&(a.eles.length===1?(a.reqs=s_,r.updateItem(a),r.pop(),n[i]=null):a.eles.unmerge(t))};Ki.onDequeue=function(t){this.onDequeues.push(t)};Ki.offDequeue=function(t){Zd(this.onDequeues,t)};Ki.setupDequeueing=oL.setupDequeueing({deqRedrawThreshold:$z,deqCost:Vz,deqAvgCost:Hz,deqNoDrawCost:Wz,deqFastCost:qz,deq:function(e,r,n){return e.dequeue(r,n)},onDeqd:function(e,r){for(var n=0;n<e.onDequeues.length;n++){var i=e.onDequeues[n];i(r)}},shouldRedraw:function(e,r,n,i){for(var a=0;a<r.length;a++)for(var s=r[a].eles,o=0;o<s.length;o++){var l=s[o].boundingBox();if(d_(l,i))return!0}return!1},priority:function(e){return e.renderer.beforeRenderPriorities.eleTxrDeq}});var Yz=1,rv=-4,xx=2,Xz=3.99,Qz=50,Jz=50,eU=.15,tU=.1,rU=.9,nU=.9,iU=1,ZN=250,aU=4e3*4e3,YN=32767,sU=!0,uL=function(e){var r=this,n=r.renderer=e,i=n.cy;r.layersByLevel={},r.firstGet=!0,r.lastInvalidationTime=yc()-2*ZN,r.skipping=!1,r.eleTxrDeqs=i.collection(),r.scheduleElementRefinement=t0(function(){r.refineElementTextures(r.eleTxrDeqs),r.eleTxrDeqs.unmerge(r.eleTxrDeqs)},Jz),n.beforeRender(function(s,o){o-r.lastInvalidationTime<=ZN?r.skipping=!0:r.skipping=!1},n.beforeRenderPriorities.lyrTxrSkip);var a=function(o,l){return l.reqs-o.reqs};r.layersQueue=new r0(a),r.setupDequeueing()},Wa=uL.prototype,XN=0,oU=Math.pow(2,53)-1;Wa.makeLayer=function(t,e){var r=Math.pow(2,e),n=Math.ceil(t.w*r),i=Math.ceil(t.h*r),a=this.renderer.makeOffscreenCanvas(n,i),s={id:XN=++XN%oU,bb:t,level:e,width:n,height:i,canvas:a,context:a.getContext("2d"),eles:[],elesQueue:[],reqs:0},o=s.context,l=-s.bb.x1,u=-s.bb.y1;return o.scale(r,r),o.translate(l,u),s};Wa.getLayers=function(t,e,r){var n=this,i=n.renderer,a=i.cy,s=a.zoom(),o=n.firstGet;if(n.firstGet=!1,r==null){if(r=Math.ceil(u_(s*e)),r<rv)r=rv;else if(s>=Xz||r>xx)return null}n.validateLayersElesOrdering(r,t);var l=n.layersByLevel,u=Math.pow(2,r),c=l[r]=l[r]||[],f,p=n.levelIsComplete(r,t),g,y=function(){var z=function(U){if(n.validateLayersElesOrdering(U,t),n.levelIsComplete(U,t))return g=l[U],!0},G=function(U){if(!g)for(var K=r+U;rv<=K&&K<=xx&&!z(K);K+=U);};G(1),G(-1);for(var Z=c.length-1;Z>=0;Z--){var I=c[Z];I.invalid&&Zd(c,I)}};if(!p)y();else return c;var S=function(){if(!f){f=Es();for(var z=0;z<t.length;z++)iF(f,t[z].boundingBox())}return f},w=function(z){z=z||{};var G=z.after;S();var Z=Math.ceil(f.w*u),I=Math.ceil(f.h*u);if(Z>YN||I>YN)return null;var W=Z*I;if(W>aU)return null;var U=n.makeLayer(f,r);if(G!=null){var K=c.indexOf(G)+1;c.splice(K,0,U)}else(z.insert===void 0||z.insert)&&c.unshift(U);return U};if(n.skipping&&!o)return null;for(var C=null,_=t.length/Yz,T=!o,N=0;N<t.length;N++){var R=t[N],D=R._private.rscratch,j=D.imgLayerCaches=D.imgLayerCaches||{},O=j[r];if(O){C=O;continue}if((!C||C.eles.length>=_||!nA(C.bb,R.boundingBox()))&&(C=w({insert:!0,after:C}),!C))return null;g||T?n.queueLayer(C,R):n.drawEleInLayer(C,R,r,e),C.eles.push(R),j[r]=C}return g||(T?null:c)};Wa.getEleLevelForLayerLevel=function(t,e){return t};Wa.drawEleInLayer=function(t,e,r,n){var i=this,a=this.renderer,s=t.context,o=e.boundingBox();o.w===0||o.h===0||!e.visible()||(r=i.getEleLevelForLayerLevel(r,n),a.setImgSmoothing(s,!1),a.drawCachedElement(s,e,null,null,r,sU),a.setImgSmoothing(s,!0))};Wa.levelIsComplete=function(t,e){var r=this,n=r.layersByLevel[t];if(!n||n.length===0)return!1;for(var i=0,a=0;a<n.length;a++){var s=n[a];if(s.reqs>0||s.invalid)return!1;i+=s.eles.length}return i===e.length};Wa.validateLayersElesOrdering=function(t,e){var r=this.layersByLevel[t];if(r)for(var n=0;n<r.length;n++){for(var i=r[n],a=-1,s=0;s<e.length;s++)if(i.eles[0]===e[s]){a=s;break}if(a<0){this.invalidateLayer(i);continue}for(var o=a,s=0;s<i.eles.length;s++)if(i.eles[s]!==e[o+s]){this.invalidateLayer(i);break}}};Wa.updateElementsInLayers=function(t,e){for(var r=this,n=Xv(t[0]),i=0;i<t.length;i++)for(var a=n?null:t[i],s=n?t[i]:t[i].ele,o=s._private.rscratch,l=o.imgLayerCaches=o.imgLayerCaches||{},u=rv;u<=xx;u++){var c=l[u];c&&(a&&r.getEleLevelForLayerLevel(c.level)!==a.level||e(c,s,a))}};Wa.haveLayers=function(){for(var t=this,e=!1,r=rv;r<=xx;r++){var n=t.layersByLevel[r];if(n&&n.length>0){e=!0;break}}return e};Wa.invalidateElements=function(t){var e=this;t.length!==0&&(e.lastInvalidationTime=yc(),!(t.length===0||!e.haveLayers())&&e.updateElementsInLayers(t,function(n,i,a){e.invalidateLayer(n)}))};Wa.invalidateLayer=function(t){if(this.lastInvalidationTime=yc(),!t.invalid){var e=t.level,r=t.eles,n=this.layersByLevel[e];Zd(n,t),t.elesQueue=[],t.invalid=!0,t.replacement&&(t.replacement.invalid=!0);for(var i=0;i<r.length;i++){var a=r[i]._private.rscratch.imgLayerCaches;a&&(a[e]=null)}}};Wa.refineElementTextures=function(t){var e=this;e.updateElementsInLayers(t,function(n,i,a){var s=n.replacement;if(s||(s=n.replacement=e.makeLayer(n.bb,n.level),s.replaces=n,s.eles=n.eles),!s.reqs)for(var o=0;o<s.eles.length;o++)e.queueLayer(s,s.eles[o])})};Wa.enqueueElementRefinement=function(t){this.eleTxrDeqs.merge(t),this.scheduleElementRefinement()};Wa.queueLayer=function(t,e){var r=this,n=r.layersQueue,i=t.elesQueue,a=i.hasId=i.hasId||{};if(!t.replacement){if(e){if(a[e.id()])return;i.push(e),a[e.id()]=!0}t.reqs?(t.reqs++,n.updateItem(t)):(t.reqs=1,n.push(t))}};Wa.dequeue=function(t){for(var e=this,r=e.layersQueue,n=[],i=0;i<iU&&r.size()!==0;){var a=r.peek();if(a.replacement){r.pop();continue}if(a.replaces&&a!==a.replaces.replacement){r.pop();continue}if(a.invalid){r.pop();continue}var s=a.elesQueue.shift();s&&(e.drawEleInLayer(a,s,a.level,t),i++),n.length===0&&n.push(!0),a.elesQueue.length===0&&(r.pop(),a.reqs=0,a.replaces&&e.applyLayerReplacement(a),e.requestRedraw())}return n};Wa.applyLayerReplacement=function(t){var e=this,r=e.layersByLevel[t.level],n=t.replaces,i=r.indexOf(n);if(!(i<0||n.invalid)){r[i]=t;for(var a=0;a<t.eles.length;a++){var s=t.eles[a]._private,o=s.imgLayerCaches=s.imgLayerCaches||{};o&&(o[t.level]=t)}e.requestRedraw()}};Wa.requestRedraw=t0(function(){var t=this.renderer;t.redrawHint("eles",!0),t.redrawHint("drag",!0),t.redraw()},100);Wa.setupDequeueing=oL.setupDequeueing({deqRedrawThreshold:Qz,deqCost:eU,deqAvgCost:tU,deqNoDrawCost:rU,deqFastCost:nU,deq:function(e,r){return e.dequeue(r)},onDeqd:o_,shouldRedraw:XM,priority:function(e){return e.renderer.beforeRenderPriorities.lyrTxrDeq}});var cL={},QN;function lU(t,e){for(var r=0;r<e.length;r++){var n=e[r];t.lineTo(n.x,n.y)}}function uU(t,e,r){for(var n,i=0;i<e.length;i++){var a=e[i];i===0&&(n=a),t.lineTo(a.x,a.y)}t.quadraticCurveTo(r.x,r.y,n.x,n.y)}function JN(t,e,r){t.beginPath&&t.beginPath();for(var n=e,i=0;i<n.length;i++){var a=n[i];t.lineTo(a.x,a.y)}var s=r,o=r[0];t.moveTo(o.x,o.y);for(var i=1;i<s.length;i++){var a=s[i];t.lineTo(a.x,a.y)}t.closePath&&t.closePath()}function cU(t,e,r,n,i){t.beginPath&&t.beginPath(),t.arc(r,n,i,0,Math.PI*2,!1);var a=e,s=a[0];t.moveTo(s.x,s.y);for(var o=0;o<a.length;o++){var l=a[o];t.lineTo(l.x,l.y)}t.closePath&&t.closePath()}function dU(t,e,r,n){t.arc(e,r,n,0,Math.PI*2,!1)}cL.arrowShapeImpl=function(t){return(QN||(QN={polygon:lU,"triangle-backcurve":uU,"triangle-tee":JN,"circle-triangle":cU,"triangle-cross":JN,circle:dU}))[t]};var Ru={};Ru.drawElement=function(t,e,r,n,i,a){var s=this;e.isNode()?s.drawNode(t,e,r,n,i,a):s.drawEdge(t,e,r,n,i,a)};Ru.drawElementOverlay=function(t,e){var r=this;e.isNode()?r.drawNodeOverlay(t,e):r.drawEdgeOverlay(t,e)};Ru.drawElementUnderlay=function(t,e){var r=this;e.isNode()?r.drawNodeUnderlay(t,e):r.drawEdgeUnderlay(t,e)};Ru.drawCachedElementPortion=function(t,e,r,n,i,a,s,o){var l=this,u=r.getBoundingBox(e);if(!(u.w===0||u.h===0)){var c=r.getElement(e,u,n,i,a);if(c!=null){var f=o(l,e);if(f===0)return;var p=s(l,e),g=u.x1,y=u.y1,S=u.w,w=u.h,C,_,T,N,R;if(p!==0){var D=r.getRotationPoint(e);T=D.x,N=D.y,t.translate(T,N),t.rotate(p),R=l.getImgSmoothing(t),R||l.setImgSmoothing(t,!0);var j=r.getRotationOffset(e);C=j.x,_=j.y}else C=g,_=y;var O;f!==1&&(O=t.globalAlpha,t.globalAlpha=O*f),t.drawImage(c.texture.canvas,c.x,0,c.width,c.height,C,_,S,w),f!==1&&(t.globalAlpha=O),p!==0&&(t.rotate(-p),t.translate(-T,-N),R||l.setImgSmoothing(t,!1))}else r.drawElement(t,e)}};var fU=function(){return 0},hU=function(e,r){return e.getTextAngle(r,null)},pU=function(e,r){return e.getTextAngle(r,"source")},mU=function(e,r){return e.getTextAngle(r,"target")},gU=function(e,r){return r.effectiveOpacity()},y2=function(e,r){return r.pstyle("text-opacity").pfValue*r.effectiveOpacity()};Ru.drawCachedElement=function(t,e,r,n,i,a){var s=this,o=s.data,l=o.eleTxrCache,u=o.lblTxrCache,c=o.slbTxrCache,f=o.tlbTxrCache,p=e.boundingBox(),g=a===!0?l.reasons.highQuality:null;if(!(p.w===0||p.h===0||!e.visible())&&(!n||d_(p,n))){var y=e.isEdge(),S=e.element()._private.rscratch.badLine;s.drawElementUnderlay(t,e),s.drawCachedElementPortion(t,e,l,r,i,g,fU,gU),(!y||!S)&&s.drawCachedElementPortion(t,e,u,r,i,g,hU,y2),y&&!S&&(s.drawCachedElementPortion(t,e,c,r,i,g,pU,y2),s.drawCachedElementPortion(t,e,f,r,i,g,mU,y2)),s.drawElementOverlay(t,e)}};Ru.drawElements=function(t,e){for(var r=this,n=0;n<e.length;n++){var i=e[n];r.drawElement(t,i)}};Ru.drawCachedElements=function(t,e,r,n){for(var i=this,a=0;a<e.length;a++){var s=e[a];i.drawCachedElement(t,s,r,n)}};Ru.drawCachedNodes=function(t,e,r,n){for(var i=this,a=0;a<e.length;a++){var s=e[a];s.isNode()&&i.drawCachedElement(t,s,r,n)}};Ru.drawLayeredElements=function(t,e,r,n){var i=this,a=i.data.lyrTxrCache.getLayers(e,r);if(a)for(var s=0;s<a.length;s++){var o=a[s],l=o.bb;l.w===0||l.h===0||t.drawImage(o.canvas,l.x1,l.y1,l.w,l.h)}else i.drawCachedElements(t,e,r,n)};var kc={};kc.drawEdge=function(t,e,r){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!0,s=this,o=e._private.rscratch;if(!(a&&!e.visible())&&!(o.badLine||o.allpts==null||isNaN(o.allpts[0]))){var l;r&&(l=r,t.translate(-l.x1,-l.y1));var u=a?e.pstyle("opacity").value:1,c=a?e.pstyle("line-opacity").value:1,f=e.pstyle("curve-style").value,p=e.pstyle("line-style").value,g=e.pstyle("width").pfValue,y=e.pstyle("line-cap").value,S=e.pstyle("line-outline-width").value,w=e.pstyle("line-outline-color").value,C=u*c,_=u*c,T=function(){var U=arguments.length>0&&arguments[0]!==void 0?arguments[0]:C;f==="straight-triangle"?(s.eleStrokeStyle(t,e,U),s.drawEdgeTrianglePath(e,t,o.allpts)):(t.lineWidth=g,t.lineCap=y,s.eleStrokeStyle(t,e,U),s.drawEdgePath(e,t,o.allpts,p),t.lineCap="butt")},N=function(){var U=arguments.length>0&&arguments[0]!==void 0?arguments[0]:C;if(t.lineWidth=g+S,t.lineCap=y,S>0)s.colorStrokeStyle(t,w[0],w[1],w[2],U);else{t.lineCap="butt";return}f==="straight-triangle"?s.drawEdgeTrianglePath(e,t,o.allpts):(s.drawEdgePath(e,t,o.allpts,p),t.lineCap="butt")},R=function(){i&&s.drawEdgeOverlay(t,e)},D=function(){i&&s.drawEdgeUnderlay(t,e)},j=function(){var U=arguments.length>0&&arguments[0]!==void 0?arguments[0]:_;s.drawArrowheads(t,e,U)},O=function(){s.drawElementText(t,e,null,n)};t.lineJoin="round";var F=e.pstyle("ghost").value==="yes";if(F){var z=e.pstyle("ghost-offset-x").pfValue,G=e.pstyle("ghost-offset-y").pfValue,Z=e.pstyle("ghost-opacity").value,I=C*Z;t.translate(z,G),T(I),j(I),t.translate(-z,-G)}else N();D(),T(),j(),R(),O(),r&&t.translate(l.x1,l.y1)}};var dL=function(e){if(!["overlay","underlay"].includes(e))throw new Error("Invalid state");return function(r,n){if(n.visible()){var i=n.pstyle("".concat(e,"-opacity")).value;if(i!==0){var a=this,s=a.usePaths(),o=n._private.rscratch,l=n.pstyle("".concat(e,"-padding")).pfValue,u=2*l,c=n.pstyle("".concat(e,"-color")).value;r.lineWidth=u,o.edgeType==="self"&&!s?r.lineCap="butt":r.lineCap="round",a.colorStrokeStyle(r,c[0],c[1],c[2],i),a.drawEdgePath(n,r,o.allpts,"solid")}}}};kc.drawEdgeOverlay=dL("overlay");kc.drawEdgeUnderlay=dL("underlay");kc.drawEdgePath=function(t,e,r,n){var i=t._private.rscratch,a=e,s,o=!1,l=this.usePaths(),u=t.pstyle("line-dash-pattern").pfValue,c=t.pstyle("line-dash-offset").pfValue;if(l){var f=r.join("$"),p=i.pathCacheKey&&i.pathCacheKey===f;p?(s=e=i.pathCache,o=!0):(s=e=new Path2D,i.pathCacheKey=f,i.pathCache=s)}if(a.setLineDash)switch(n){case"dotted":a.setLineDash([1,1]);break;case"dashed":a.setLineDash(u),a.lineDashOffset=c;break;case"solid":a.setLineDash([]);break}if(!o&&!i.badLine)switch(e.beginPath&&e.beginPath(),e.moveTo(r[0],r[1]),i.edgeType){case"bezier":case"self":case"compound":case"multibezier":for(var g=2;g+3<r.length;g+=4)e.quadraticCurveTo(r[g],r[g+1],r[g+2],r[g+3]);break;case"straight":case"haystack":for(var y=2;y+1<r.length;y+=2)e.lineTo(r[y],r[y+1]);break;case"segments":if(i.isRound){var S=Ys(i.roundCorners),w;try{for(S.s();!(w=S.n()).done;){var C=w.value;JA(e,C)}}catch(T){S.e(T)}finally{S.f()}e.lineTo(r[r.length-2],r[r.length-1])}else for(var _=2;_+1<r.length;_+=2)e.lineTo(r[_],r[_+1]);break}e=a,l?e.stroke(s):e.stroke(),e.setLineDash&&e.setLineDash([])};kc.drawEdgeTrianglePath=function(t,e,r){e.fillStyle=e.strokeStyle;for(var n=t.pstyle("width").pfValue,i=0;i+1<r.length;i+=2){var a=[r[i+2]-r[i],r[i+3]-r[i+1]],s=Math.sqrt(a[0]*a[0]+a[1]*a[1]),o=[a[1]/s,-a[0]/s],l=[o[0]*n/2,o[1]*n/2];e.beginPath(),e.moveTo(r[i]-l[0],r[i+1]-l[1]),e.lineTo(r[i]+l[0],r[i+1]+l[1]),e.lineTo(r[i+2],r[i+3]),e.closePath(),e.fill()}};kc.drawArrowheads=function(t,e,r){var n=e._private.rscratch,i=n.edgeType==="haystack";i||this.drawArrowhead(t,e,"source",n.arrowStartX,n.arrowStartY,n.srcArrowAngle,r),this.drawArrowhead(t,e,"mid-target",n.midX,n.midY,n.midtgtArrowAngle,r),this.drawArrowhead(t,e,"mid-source",n.midX,n.midY,n.midsrcArrowAngle,r),i||this.drawArrowhead(t,e,"target",n.arrowEndX,n.arrowEndY,n.tgtArrowAngle,r)};kc.drawArrowhead=function(t,e,r,n,i,a,s){if(!(isNaN(n)||n==null||isNaN(i)||i==null||isNaN(a)||a==null)){var o=this,l=e.pstyle(r+"-arrow-shape").value;if(l!=="none"){var u=e.pstyle(r+"-arrow-fill").value==="hollow"?"both":"filled",c=e.pstyle(r+"-arrow-fill").value,f=e.pstyle("width").pfValue,p=e.pstyle(r+"-arrow-width"),g=p.value==="match-line"?f:p.pfValue;p.units==="%"&&(g*=f);var y=e.pstyle("opacity").value;s===void 0&&(s=y);var S=t.globalCompositeOperation;(s!==1||c==="hollow")&&(t.globalCompositeOperation="destination-out",o.colorFillStyle(t,255,255,255,1),o.colorStrokeStyle(t,255,255,255,1),o.drawArrowShape(e,t,u,f,l,g,n,i,a),t.globalCompositeOperation=S);var w=e.pstyle(r+"-arrow-color").value;o.colorFillStyle(t,w[0],w[1],w[2],s),o.colorStrokeStyle(t,w[0],w[1],w[2],s),o.drawArrowShape(e,t,c,f,l,g,n,i,a)}}};kc.drawArrowShape=function(t,e,r,n,i,a,s,o,l){var u=this,c=this.usePaths()&&i!=="triangle-cross",f=!1,p,g=e,y={x:s,y:o},S=t.pstyle("arrow-scale").value,w=this.getArrowWidth(n,S),C=u.arrowShapes[i];if(c){var _=u.arrowPathCache=u.arrowPathCache||[],T=ph(i),N=_[T];N!=null?(p=e=N,f=!0):(p=e=new Path2D,_[T]=p)}f||(e.beginPath&&e.beginPath(),c?C.draw(e,1,0,{x:0,y:0},1):C.draw(e,w,l,y,n),e.closePath&&e.closePath()),e=g,c&&(e.translate(s,o),e.rotate(l),e.scale(w,w)),(r==="filled"||r==="both")&&(c?e.fill(p):e.fill()),(r==="hollow"||r==="both")&&(e.lineWidth=a/(c?w:1),e.lineJoin="miter",c?e.stroke(p):e.stroke()),c&&(e.scale(1/w,1/w),e.rotate(-l),e.translate(-s,-o))};var C_={};C_.safeDrawImage=function(t,e,r,n,i,a,s,o,l,u){if(!(i<=0||a<=0||l<=0||u<=0))try{t.drawImage(e,r,n,i,a,s,o,l,u)}catch(c){an(c)}};C_.drawInscribedImage=function(t,e,r,n,i){var a=this,s=r.position(),o=s.x,l=s.y,u=r.cy().style(),c=u.getIndexedStyle.bind(u),f=c(r,"background-fit","value",n),p=c(r,"background-repeat","value",n),g=r.width(),y=r.height(),S=r.padding()*2,w=g+(c(r,"background-width-relative-to","value",n)==="inner"?0:S),C=y+(c(r,"background-height-relative-to","value",n)==="inner"?0:S),_=r._private.rscratch,T=c(r,"background-clip","value",n),N=T==="node",R=c(r,"background-image-opacity","value",n)*i,D=c(r,"background-image-smoothing","value",n),j=r.pstyle("corner-radius").value;j!=="auto"&&(j=r.pstyle("corner-radius").pfValue);var O=e.width||e.cachedW,F=e.height||e.cachedH;(O==null||F==null)&&(document.body.appendChild(e),O=e.cachedW=e.width||e.offsetWidth,F=e.cachedH=e.height||e.offsetHeight,document.body.removeChild(e));var z=O,G=F;if(c(r,"background-width","value",n)!=="auto"&&(c(r,"background-width","units",n)==="%"?z=c(r,"background-width","pfValue",n)*w:z=c(r,"background-width","pfValue",n)),c(r,"background-height","value",n)!=="auto"&&(c(r,"background-height","units",n)==="%"?G=c(r,"background-height","pfValue",n)*C:G=c(r,"background-height","pfValue",n)),!(z===0||G===0)){if(f==="contain"){var Z=Math.min(w/z,C/G);z*=Z,G*=Z}else if(f==="cover"){var Z=Math.max(w/z,C/G);z*=Z,G*=Z}var I=o-w/2,W=c(r,"background-position-x","units",n),U=c(r,"background-position-x","pfValue",n);W==="%"?I+=(w-z)*U:I+=U;var K=c(r,"background-offset-x","units",n),$=c(r,"background-offset-x","pfValue",n);K==="%"?I+=(w-z)*$:I+=$;var Q=l-C/2,ie=c(r,"background-position-y","units",n),te=c(r,"background-position-y","pfValue",n);ie==="%"?Q+=(C-G)*te:Q+=te;var X=c(r,"background-offset-y","units",n),re=c(r,"background-offset-y","pfValue",n);X==="%"?Q+=(C-G)*re:Q+=re,_.pathCache&&(I-=o,Q-=l,o=0,l=0);var fe=t.globalAlpha;t.globalAlpha=R;var oe=a.getImgSmoothing(t),se=!1;if(D==="no"&&oe?(a.setImgSmoothing(t,!1),se=!0):D==="yes"&&!oe&&(a.setImgSmoothing(t,!0),se=!0),p==="no-repeat")N&&(t.save(),_.pathCache?t.clip(_.pathCache):(a.nodeShapes[a.getNodeShape(r)].draw(t,o,l,w,C,j,_),t.clip())),a.safeDrawImage(t,e,0,0,O,F,I,Q,z,G),N&&t.restore();else{var he=t.createPattern(e,p);t.fillStyle=he,a.nodeShapes[a.getNodeShape(r)].draw(t,o,l,w,C,j,_),t.translate(I,Q),t.fill(),t.translate(-I,-Q)}t.globalAlpha=fe,se&&a.setImgSmoothing(t,oe)}};var Ph={};Ph.eleTextBiggerThanMin=function(t,e){if(!e){var r=t.cy().zoom(),n=this.getPixelRatio(),i=Math.ceil(u_(r*n));e=Math.pow(2,i)}var a=t.pstyle("font-size").pfValue*e,s=t.pstyle("min-zoomed-font-size").pfValue;return!(a<s)};Ph.drawElementText=function(t,e,r,n,i){var a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!0,s=this;if(n==null){if(a&&!s.eleTextBiggerThanMin(e))return}else if(n===!1)return;if(e.isNode()){var o=e.pstyle("label");if(!o||!o.value)return;var l=s.getLabelJustification(e);t.textAlign=l,t.textBaseline="bottom"}else{var u=e.element()._private.rscratch.badLine,c=e.pstyle("label"),f=e.pstyle("source-label"),p=e.pstyle("target-label");if(u||(!c||!c.value)&&(!f||!f.value)&&(!p||!p.value))return;t.textAlign="center",t.textBaseline="bottom"}var g=!r,y;r&&(y=r,t.translate(-y.x1,-y.y1)),i==null?(s.drawText(t,e,null,g,a),e.isEdge()&&(s.drawText(t,e,"source",g,a),s.drawText(t,e,"target",g,a))):s.drawText(t,e,i,g,a),r&&t.translate(y.x1,y.y1)};Ph.getFontCache=function(t){var e;this.fontCaches=this.fontCaches||[];for(var r=0;r<this.fontCaches.length;r++)if(e=this.fontCaches[r],e.context===t)return e;return e={context:t},this.fontCaches.push(e),e};Ph.setupTextStyle=function(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,n=e.pstyle("font-style").strValue,i=e.pstyle("font-size").pfValue+"px",a=e.pstyle("font-family").strValue,s=e.pstyle("font-weight").strValue,o=r?e.effectiveOpacity()*e.pstyle("text-opacity").value:1,l=e.pstyle("text-outline-opacity").value*o,u=e.pstyle("color").value,c=e.pstyle("text-outline-color").value;t.font=n+" "+s+" "+i+" "+a,t.lineJoin="round",this.colorFillStyle(t,u[0],u[1],u[2],o),this.colorStrokeStyle(t,c[0],c[1],c[2],l)};function vU(t,e,r,n,i){var a=Math.min(n,i),s=a/2,o=e+n/2,l=r+i/2;t.beginPath(),t.arc(o,l,s,0,Math.PI*2),t.closePath()}function e5(t,e,r,n,i){var a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:5,s=Math.min(a,n/2,i/2);t.beginPath(),t.moveTo(e+s,r),t.lineTo(e+n-s,r),t.quadraticCurveTo(e+n,r,e+n,r+s),t.lineTo(e+n,r+i-s),t.quadraticCurveTo(e+n,r+i,e+n-s,r+i),t.lineTo(e+s,r+i),t.quadraticCurveTo(e,r+i,e,r+i-s),t.lineTo(e,r+s),t.quadraticCurveTo(e,r,e+s,r),t.closePath()}Ph.getTextAngle=function(t,e){var r,n=t._private,i=n.rscratch,a=e?e+"-":"",s=t.pstyle(a+"text-rotation");if(s.strValue==="autorotate"){var o=$s(i,"labelAngle",e);r=t.isEdge()?o:0}else s.strValue==="none"?r=0:r=s.pfValue;return r};Ph.drawText=function(t,e,r){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,a=e._private,s=a.rscratch,o=i?e.effectiveOpacity():1;if(!(i&&(o===0||e.pstyle("text-opacity").value===0))){r==="main"&&(r=null);var l=$s(s,"labelX",r),u=$s(s,"labelY",r),c,f,p=this.getLabelText(e,r);if(p!=null&&p!==""&&!isNaN(l)&&!isNaN(u)){this.setupTextStyle(t,e,i);var g=r?r+"-":"",y=$s(s,"labelWidth",r),S=$s(s,"labelHeight",r),w=e.pstyle(g+"text-margin-x").pfValue,C=e.pstyle(g+"text-margin-y").pfValue,_=e.isEdge(),T=e.pstyle("text-halign").value,N=e.pstyle("text-valign").value;_&&(T="center",N="center"),l+=w,u+=C;var R;switch(n?R=this.getTextAngle(e,r):R=0,R!==0&&(c=l,f=u,t.translate(c,f),t.rotate(R),l=0,u=0),N){case"top":break;case"center":u+=S/2;break;case"bottom":u+=S;break}var D=e.pstyle("text-background-opacity").value,j=e.pstyle("text-border-opacity").value,O=e.pstyle("text-border-width").pfValue,F=e.pstyle("text-background-padding").pfValue,z=e.pstyle("text-background-shape").strValue,G=z==="round-rectangle"||z==="roundrectangle",Z=z==="circle",I=2;if(D>0||O>0&&j>0){var W=t.fillStyle,U=t.strokeStyle,K=t.lineWidth,$=e.pstyle("text-background-color").value,Q=e.pstyle("text-border-color").value,ie=e.pstyle("text-border-style").value,te=D>0,X=O>0&&j>0,re=l-F;switch(T){case"left":re-=y;break;case"center":re-=y/2;break}var fe=u-S-F,oe=y+2*F,se=S+2*F;if(te&&(t.fillStyle="rgba(".concat($[0],",").concat($[1],",").concat($[2],",").concat(D*o,")")),X&&(t.strokeStyle="rgba(".concat(Q[0],",").concat(Q[1],",").concat(Q[2],",").concat(j*o,")"),t.lineWidth=O,t.setLineDash))switch(ie){case"dotted":t.setLineDash([1,1]);break;case"dashed":t.setLineDash([4,2]);break;case"double":t.lineWidth=O/4,t.setLineDash([]);break;default:t.setLineDash([]);break}if(G?(t.beginPath(),e5(t,re,fe,oe,se,I)):Z?(t.beginPath(),vU(t,re,fe,oe,se)):(t.beginPath(),t.rect(re,fe,oe,se)),te&&t.fill(),X&&t.stroke(),X&&ie==="double"){var he=O/2;t.beginPath(),G?e5(t,re+he,fe+he,oe-2*he,se-2*he,I):t.rect(re+he,fe+he,oe-2*he,se-2*he),t.stroke()}t.fillStyle=W,t.strokeStyle=U,t.lineWidth=K,t.setLineDash&&t.setLineDash([])}var ae=2*e.pstyle("text-outline-width").pfValue;if(ae>0&&(t.lineWidth=ae),e.pstyle("text-wrap").value==="wrap"){var pe=$s(s,"labelWrapCachedLines",r),ye=$s(s,"labelLineHeight",r),ve=y/2,ue=this.getLabelJustification(e);switch(ue==="auto"||(T==="left"?ue==="left"?l+=-y:ue==="center"&&(l+=-ve):T==="center"?ue==="left"?l+=-ve:ue==="right"&&(l+=ve):T==="right"&&(ue==="center"?l+=ve:ue==="right"&&(l+=y))),N){case"top":u-=(pe.length-1)*ye;break;case"center":case"bottom":u-=(pe.length-1)*ye;break}for(var xe=0;xe<pe.length;xe++)ae>0&&t.strokeText(pe[xe],l,u),t.fillText(pe[xe],l,u),u+=ye}else ae>0&&t.strokeText(p,l,u),t.fillText(p,l,u);R!==0&&(t.rotate(-R),t.translate(-c,-f))}}};var uf={};uf.drawNode=function(t,e,r){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!0,s=this,o,l,u=e._private,c=u.rscratch,f=e.position();if(!(!_t(f.x)||!_t(f.y))&&!(a&&!e.visible())){var p=a?e.effectiveOpacity():1,g=s.usePaths(),y,S=!1,w=e.padding();o=e.width()+2*w,l=e.height()+2*w;var C;r&&(C=r,t.translate(-C.x1,-C.y1));for(var _=e.pstyle("background-image"),T=_.value,N=new Array(T.length),R=new Array(T.length),D=0,j=0;j<T.length;j++){var O=T[j],F=N[j]=O!=null&&O!=="none";if(F){var z=e.cy().style().getIndexedStyle(e,"background-image-crossorigin","value",j);D++,R[j]=s.getCachedImage(O,z,function(){u.backgroundTimestamp=Date.now(),e.emitAndNotify("background")})}}var G=e.pstyle("background-blacken").value,Z=e.pstyle("border-width").pfValue,I=e.pstyle("background-opacity").value*p,W=e.pstyle("border-color").value,U=e.pstyle("border-style").value,K=e.pstyle("border-join").value,$=e.pstyle("border-cap").value,Q=e.pstyle("border-position").value,ie=e.pstyle("border-dash-pattern").pfValue,te=e.pstyle("border-dash-offset").pfValue,X=e.pstyle("border-opacity").value*p,re=e.pstyle("outline-width").pfValue,fe=e.pstyle("outline-color").value,oe=e.pstyle("outline-style").value,se=e.pstyle("outline-opacity").value*p,he=e.pstyle("outline-offset").value,ae=e.pstyle("corner-radius").value;ae!=="auto"&&(ae=e.pstyle("corner-radius").pfValue);var pe=function(){var lt=arguments.length>0&&arguments[0]!==void 0?arguments[0]:I;s.eleFillStyle(t,e,lt)},ye=function(){var lt=arguments.length>0&&arguments[0]!==void 0?arguments[0]:X;s.colorStrokeStyle(t,W[0],W[1],W[2],lt)},ve=function(){var lt=arguments.length>0&&arguments[0]!==void 0?arguments[0]:se;s.colorStrokeStyle(t,fe[0],fe[1],fe[2],lt)},ue=function(lt,Ie,de,ge){var ke=s.nodePathCache=s.nodePathCache||[],Ee=YM(de==="polygon"?de+","+ge.join(","):de,""+Ie,""+lt,""+ae),Re=ke[Ee],Qe,Ge=!1;return Re!=null?(Qe=Re,Ge=!0,c.pathCache=Qe):(Qe=new Path2D,ke[Ee]=c.pathCache=Qe),{path:Qe,cacheHit:Ge}},xe=e.pstyle("shape").strValue,Se=e.pstyle("shape-polygon-points").pfValue;if(g){t.translate(f.x,f.y);var Ae=ue(o,l,xe,Se);y=Ae.path,S=Ae.cacheHit}var Me=function(){if(!S){var lt=f;g&&(lt={x:0,y:0}),s.nodeShapes[s.getNodeShape(e)].draw(y||t,lt.x,lt.y,o,l,ae,c)}g?t.fill(y):t.fill()},st=function(){for(var lt=arguments.length>0&&arguments[0]!==void 0?arguments[0]:p,Ie=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,de=u.backgrounding,ge=0,ke=0;ke<R.length;ke++){var Ee=e.cy().style().getIndexedStyle(e,"background-image-containment","value",ke);if(Ie&&Ee==="over"||!Ie&&Ee==="inside"){ge++;continue}N[ke]&&R[ke].complete&&!R[ke].error&&(ge++,s.drawInscribedImage(t,R[ke],e,ke,lt))}u.backgrounding=ge!==D,de!==u.backgrounding&&e.updateStyle(!1)},rt=function(){var lt=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,Ie=arguments.length>1&&arguments[1]!==void 0?arguments[1]:p;s.hasPie(e)&&(s.drawPie(t,e,Ie),lt&&(g||s.nodeShapes[s.getNodeShape(e)].draw(t,f.x,f.y,o,l,ae,c)))},dt=function(){var lt=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,Ie=arguments.length>1&&arguments[1]!==void 0?arguments[1]:p;s.hasStripe(e)&&(t.save(),g?t.clip(c.pathCache):(s.nodeShapes[s.getNodeShape(e)].draw(t,f.x,f.y,o,l,ae,c),t.clip()),s.drawStripe(t,e,Ie),t.restore(),lt&&(g||s.nodeShapes[s.getNodeShape(e)].draw(t,f.x,f.y,o,l,ae,c)))},Ct=function(){var lt=arguments.length>0&&arguments[0]!==void 0?arguments[0]:p,Ie=(G>0?G:-G)*lt,de=G>0?0:255;G!==0&&(s.colorFillStyle(t,de,de,de,Ie),g?t.fill(y):t.fill())},Ke=function(){if(Z>0){if(t.lineWidth=Z,t.lineCap=$,t.lineJoin=K,t.setLineDash)switch(U){case"dotted":t.setLineDash([1,1]);break;case"dashed":t.setLineDash(ie),t.lineDashOffset=te;break;case"solid":case"double":t.setLineDash([]);break}if(Q!=="center"){if(t.save(),t.lineWidth*=2,Q==="inside")g?t.clip(y):t.clip();else{var lt=new Path2D;lt.rect(-o/2-Z,-l/2-Z,o+2*Z,l+2*Z),lt.addPath(y),t.clip(lt,"evenodd")}g?t.stroke(y):t.stroke(),t.restore()}else g?t.stroke(y):t.stroke();if(U==="double"){t.lineWidth=Z/3;var Ie=t.globalCompositeOperation;t.globalCompositeOperation="destination-out",g?t.stroke(y):t.stroke(),t.globalCompositeOperation=Ie}t.setLineDash&&t.setLineDash([])}},ut=function(){if(re>0){if(t.lineWidth=re,t.lineCap="butt",t.setLineDash)switch(oe){case"dotted":t.setLineDash([1,1]);break;case"dashed":t.setLineDash([4,2]);break;case"solid":case"double":t.setLineDash([]);break}var lt=f;g&&(lt={x:0,y:0});var Ie=s.getNodeShape(e),de=Z;Q==="inside"&&(de=0),Q==="outside"&&(de*=2);var ge=(o+de+(re+he))/o,ke=(l+de+(re+he))/l,Ee=o*ge,Re=l*ke,Qe=s.nodeShapes[Ie].points,Ge;if(g){var wt=ue(Ee,Re,Ie,Qe);Ge=wt.path}if(Ie==="ellipse")s.drawEllipsePath(Ge||t,lt.x,lt.y,Ee,Re);else if(["round-diamond","round-heptagon","round-hexagon","round-octagon","round-pentagon","round-polygon","round-triangle","round-tag"].includes(Ie)){var bt=0,pt=0,Kt=0;Ie==="round-diamond"?bt=(de+he+re)*1.4:Ie==="round-heptagon"?(bt=(de+he+re)*1.075,Kt=-(de/2+he+re)/35):Ie==="round-hexagon"?bt=(de+he+re)*1.12:Ie==="round-pentagon"?(bt=(de+he+re)*1.13,Kt=-(de/2+he+re)/15):Ie==="round-tag"?(bt=(de+he+re)*1.12,pt=(de/2+re+he)*.07):Ie==="round-triangle"&&(bt=(de+he+re)*(Math.PI/2),Kt=-(de+he/2+re)/Math.PI),bt!==0&&(ge=(o+bt)/o,Ee=o*ge,["round-hexagon","round-tag"].includes(Ie)||(ke=(l+bt)/l,Re=l*ke)),ae=ae==="auto"?sA(Ee,Re):ae;for(var Wt=Ee/2,Ve=Re/2,vt=ae+(de+re+he)/2,Et=new Array(Qe.length/2),er=new Array(Qe.length/2),gr=0;gr<Qe.length/2;gr++)Et[gr]={x:lt.x+pt+Wt*Qe[gr*2],y:lt.y+Kt+Ve*Qe[gr*2+1]};var Ir,zr,Cr,fn,xr=Et.length;for(zr=Et[xr-1],Ir=0;Ir<xr;Ir++)Cr=Et[Ir%xr],fn=Et[(Ir+1)%xr],er[Ir]=k_(zr,Cr,fn,vt),zr=Cr,Cr=fn;s.drawRoundPolygonPath(Ge||t,lt.x+pt,lt.y+Kt,o*ge,l*ke,Qe,er)}else if(["roundrectangle","round-rectangle"].includes(Ie))ae=ae==="auto"?Yd(Ee,Re):ae,s.drawRoundRectanglePath(Ge||t,lt.x,lt.y,Ee,Re,ae+(de+re+he)/2);else if(["cutrectangle","cut-rectangle"].includes(Ie))ae=ae==="auto"?f_():ae,s.drawCutRectanglePath(Ge||t,lt.x,lt.y,Ee,Re,null,ae+(de+re+he)/4);else if(["bottomroundrectangle","bottom-round-rectangle"].includes(Ie))ae=ae==="auto"?Yd(Ee,Re):ae,s.drawBottomRoundRectanglePath(Ge||t,lt.x,lt.y,Ee,Re,ae+(de+re+he)/2);else if(Ie==="barrel")s.drawBarrelPath(Ge||t,lt.x,lt.y,Ee,Re);else if(Ie.startsWith("polygon")||["rhomboid","right-rhomboid","round-tag","tag","vee"].includes(Ie)){var Tt=(de+re+he)/o;Qe=fx(hx(Qe,Tt)),s.drawPolygonPath(Ge||t,lt.x,lt.y,o,l,Qe)}else{var Ur=(de+re+he)/o;Qe=fx(hx(Qe,-Ur)),s.drawPolygonPath(Ge||t,lt.x,lt.y,o,l,Qe)}if(g?t.stroke(Ge):t.stroke(),oe==="double"){t.lineWidth=de/3;var Qn=t.globalCompositeOperation;t.globalCompositeOperation="destination-out",g?t.stroke(Ge):t.stroke(),t.globalCompositeOperation=Qn}t.setLineDash&&t.setLineDash([])}},ct=function(){i&&s.drawNodeOverlay(t,e,f,o,l)},xt=function(){i&&s.drawNodeUnderlay(t,e,f,o,l)},ot=function(){s.drawElementText(t,e,null,n)},Lt=e.pstyle("ghost").value==="yes";if(Lt){var Bt=e.pstyle("ghost-offset-x").pfValue,Ne=e.pstyle("ghost-offset-y").pfValue,qe=e.pstyle("ghost-opacity").value,St=qe*p;t.translate(Bt,Ne),ve(),ut(),pe(qe*I),Me(),st(St,!0),ye(qe*X),Ke(),rt(G!==0||Z!==0),dt(G!==0||Z!==0),st(St,!1),Ct(St),t.translate(-Bt,-Ne)}g&&t.translate(-f.x,-f.y),xt(),g&&t.translate(f.x,f.y),ve(),ut(),pe(),Me(),st(p,!0),ye(),Ke(),rt(G!==0||Z!==0),dt(G!==0||Z!==0),st(p,!1),Ct(),g&&t.translate(-f.x,-f.y),ot(),ct(),r&&t.translate(C.x1,C.y1)}};var fL=function(e){if(!["overlay","underlay"].includes(e))throw new Error("Invalid state");return function(r,n,i,a,s){var o=this;if(n.visible()){var l=n.pstyle("".concat(e,"-padding")).pfValue,u=n.pstyle("".concat(e,"-opacity")).value,c=n.pstyle("".concat(e,"-color")).value,f=n.pstyle("".concat(e,"-shape")).value,p=n.pstyle("".concat(e,"-corner-radius")).value;if(u>0){if(i=i||n.position(),a==null||s==null){var g=n.padding();a=n.width()+2*g,s=n.height()+2*g}o.colorFillStyle(r,c[0],c[1],c[2],u),o.nodeShapes[f].draw(r,i.x,i.y,a+l*2,s+l*2,p),r.fill()}}}};uf.drawNodeOverlay=fL("overlay");uf.drawNodeUnderlay=fL("underlay");uf.hasPie=function(t){return t=t[0],t._private.hasPie};uf.hasStripe=function(t){return t=t[0],t._private.hasStripe};uf.drawPie=function(t,e,r,n){e=e[0],n=n||e.position();var i=e.cy().style(),a=e.pstyle("pie-size"),s=e.pstyle("pie-hole"),o=e.pstyle("pie-start-angle").pfValue,l=n.x,u=n.y,c=e.width(),f=e.height(),p=Math.min(c,f)/2,g,y=0,S=this.usePaths();if(S&&(l=0,u=0),a.units==="%"?p=p*a.pfValue:a.pfValue!==void 0&&(p=a.pfValue/2),s.units==="%"?g=p*s.pfValue:s.pfValue!==void 0&&(g=s.pfValue/2),!(g>=p))for(var w=1;w<=i.pieBackgroundN;w++){var C=e.pstyle("pie-"+w+"-background-size").value,_=e.pstyle("pie-"+w+"-background-color").value,T=e.pstyle("pie-"+w+"-background-opacity").value*r,N=C/100;N+y>1&&(N=1-y);var R=1.5*Math.PI+2*Math.PI*y;R+=o;var D=2*Math.PI*N,j=R+D;C===0||y>=1||y+N>1||(g===0?(t.beginPath(),t.moveTo(l,u),t.arc(l,u,p,R,j),t.closePath()):(t.beginPath(),t.arc(l,u,p,R,j),t.arc(l,u,g,j,R,!0),t.closePath()),this.colorFillStyle(t,_[0],_[1],_[2],T),t.fill(),y+=N)}};uf.drawStripe=function(t,e,r,n){e=e[0],n=n||e.position();var i=e.cy().style(),a=n.x,s=n.y,o=e.width(),l=e.height(),u=0,c=this.usePaths();t.save();var f=e.pstyle("stripe-direction").value,p=e.pstyle("stripe-size");switch(f){case"vertical":break;case"righward":t.rotate(-Math.PI/2);break}var g=o,y=l;p.units==="%"?(g=g*p.pfValue,y=y*p.pfValue):p.pfValue!==void 0&&(g=p.pfValue,y=p.pfValue),c&&(a=0,s=0),s-=g/2,a-=y/2;for(var S=1;S<=i.stripeBackgroundN;S++){var w=e.pstyle("stripe-"+S+"-background-size").value,C=e.pstyle("stripe-"+S+"-background-color").value,_=e.pstyle("stripe-"+S+"-background-opacity").value*r,T=w/100;T+u>1&&(T=1-u),!(w===0||u>=1||u+T>1)&&(t.beginPath(),t.rect(a,s+y*u,g,y*T),t.closePath(),this.colorFillStyle(t,C[0],C[1],C[2],_),t.fill(),u+=T)}t.restore()};var Ms={},yU=100;Ms.getPixelRatio=function(){var t=this.data.contexts[0];if(this.forcedPixelRatio!=null)return this.forcedPixelRatio;var e=this.cy.window(),r=t.backingStorePixelRatio||t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1;return(e.devicePixelRatio||1)/r};Ms.paintCache=function(t){for(var e=this.paintCaches=this.paintCaches||[],r=!0,n,i=0;i<e.length;i++)if(n=e[i],n.context===t){r=!1;break}return r&&(n={context:t},e.push(n)),n};Ms.createGradientStyleFor=function(t,e,r,n,i){var a,s=this.usePaths(),o=r.pstyle(e+"-gradient-stop-colors").value,l=r.pstyle(e+"-gradient-stop-positions").pfValue;if(n==="radial-gradient")if(r.isEdge()){var u=r.sourceEndpoint(),c=r.targetEndpoint(),f=r.midpoint(),p=mh(u,f),g=mh(c,f);a=t.createRadialGradient(f.x,f.y,0,f.x,f.y,Math.max(p,g))}else{var y=s?{x:0,y:0}:r.position(),S=r.paddedWidth(),w=r.paddedHeight();a=t.createRadialGradient(y.x,y.y,0,y.x,y.y,Math.max(S,w))}else if(r.isEdge()){var C=r.sourceEndpoint(),_=r.targetEndpoint();a=t.createLinearGradient(C.x,C.y,_.x,_.y)}else{var T=s?{x:0,y:0}:r.position(),N=r.paddedWidth(),R=r.paddedHeight(),D=N/2,j=R/2,O=r.pstyle("background-gradient-direction").value;switch(O){case"to-bottom":a=t.createLinearGradient(T.x,T.y-j,T.x,T.y+j);break;case"to-top":a=t.createLinearGradient(T.x,T.y+j,T.x,T.y-j);break;case"to-left":a=t.createLinearGradient(T.x+D,T.y,T.x-D,T.y);break;case"to-right":a=t.createLinearGradient(T.x-D,T.y,T.x+D,T.y);break;case"to-bottom-right":case"to-right-bottom":a=t.createLinearGradient(T.x-D,T.y-j,T.x+D,T.y+j);break;case"to-top-right":case"to-right-top":a=t.createLinearGradient(T.x-D,T.y+j,T.x+D,T.y-j);break;case"to-bottom-left":case"to-left-bottom":a=t.createLinearGradient(T.x+D,T.y-j,T.x-D,T.y+j);break;case"to-top-left":case"to-left-top":a=t.createLinearGradient(T.x+D,T.y+j,T.x-D,T.y-j);break}}if(!a)return null;for(var F=l.length===o.length,z=o.length,G=0;G<z;G++)a.addColorStop(F?l[G]:G/(z-1),"rgba("+o[G][0]+","+o[G][1]+","+o[G][2]+","+i+")");return a};Ms.gradientFillStyle=function(t,e,r,n){var i=this.createGradientStyleFor(t,"background",e,r,n);if(!i)return null;t.fillStyle=i};Ms.colorFillStyle=function(t,e,r,n,i){t.fillStyle="rgba("+e+","+r+","+n+","+i+")"};Ms.eleFillStyle=function(t,e,r){var n=e.pstyle("background-fill").value;if(n==="linear-gradient"||n==="radial-gradient")this.gradientFillStyle(t,e,n,r);else{var i=e.pstyle("background-color").value;this.colorFillStyle(t,i[0],i[1],i[2],r)}};Ms.gradientStrokeStyle=function(t,e,r,n){var i=this.createGradientStyleFor(t,"line",e,r,n);if(!i)return null;t.strokeStyle=i};Ms.colorStrokeStyle=function(t,e,r,n,i){t.strokeStyle="rgba("+e+","+r+","+n+","+i+")"};Ms.eleStrokeStyle=function(t,e,r){var n=e.pstyle("line-fill").value;if(n==="linear-gradient"||n==="radial-gradient")this.gradientStrokeStyle(t,e,n,r);else{var i=e.pstyle("line-color").value;this.colorStrokeStyle(t,i[0],i[1],i[2],r)}};Ms.matchCanvasSize=function(t){var e=this,r=e.data,n=e.findContainerClientCoords(),i=n[2],a=n[3],s=e.getPixelRatio(),o=e.motionBlurPxRatio;(t===e.data.bufferCanvases[e.MOTIONBLUR_BUFFER_NODE]||t===e.data.bufferCanvases[e.MOTIONBLUR_BUFFER_DRAG])&&(s=o);var l=i*s,u=a*s,c;if(!(l===e.canvasWidth&&u===e.canvasHeight)){e.fontCaches=null;var f=r.canvasContainer;f.style.width=i+"px",f.style.height=a+"px";for(var p=0;p<e.CANVAS_LAYERS;p++)c=r.canvases[p],c.width=l,c.height=u,c.style.width=i+"px",c.style.height=a+"px";for(var p=0;p<e.BUFFER_COUNT;p++)c=r.bufferCanvases[p],c.width=l,c.height=u,c.style.width=i+"px",c.style.height=a+"px";e.textureMult=1,s<=1&&(c=r.bufferCanvases[e.TEXTURE_BUFFER],e.textureMult=2,c.width=l*e.textureMult,c.height=u*e.textureMult),e.canvasWidth=l,e.canvasHeight=u,e.pixelRatio=s}};Ms.renderTo=function(t,e,r,n){this.render({forcedContext:t,forcedZoom:e,forcedPan:r,drawAllLayers:!0,forcedPxRatio:n})};Ms.clearCanvas=function(){var t=this,e=t.data;function r(n){n.clearRect(0,0,t.canvasWidth,t.canvasHeight)}r(e.contexts[t.NODE]),r(e.contexts[t.DRAG])};Ms.render=function(t){var e=this;t=t||eA();var r=e.cy,n=t.forcedContext,i=t.drawAllLayers,a=t.drawOnlyNodeLayer,s=t.forcedZoom,o=t.forcedPan,l=t.forcedPxRatio===void 0?this.getPixelRatio():t.forcedPxRatio,u=e.data,c=u.canvasNeedsRedraw,f=e.textureOnViewport&&!n&&(e.pinching||e.hoverData.dragging||e.swipePanning||e.data.wheelZooming),p=t.motionBlur!==void 0?t.motionBlur:e.motionBlur,g=e.motionBlurPxRatio,y=r.hasCompoundNodes(),S=e.hoverData.draggingEles,w=!!(e.hoverData.selecting||e.touchData.selecting);p=p&&!n&&e.motionBlurEnabled&&!w;var C=p;n||(e.prevPxRatio!==l&&(e.invalidateContainerClientCoordsCache(),e.matchCanvasSize(e.container),e.redrawHint("eles",!0),e.redrawHint("drag",!0)),e.prevPxRatio=l),!n&&e.motionBlurTimeout&&clearTimeout(e.motionBlurTimeout),p&&(e.mbFrames==null&&(e.mbFrames=0),e.mbFrames++,e.mbFrames<3&&(C=!1),e.mbFrames>e.minMbLowQualFrames&&(e.motionBlurPxRatio=e.mbPxRBlurry)),e.clearingMotionBlur&&(e.motionBlurPxRatio=1),e.textureDrawLastFrame&&!f&&(c[e.NODE]=!0,c[e.SELECT_BOX]=!0);var _=r.style(),T=r.zoom(),N=s!==void 0?s:T,R=r.pan(),D={x:R.x,y:R.y},j={zoom:T,pan:{x:R.x,y:R.y}},O=e.prevViewport,F=O===void 0||j.zoom!==O.zoom||j.pan.x!==O.pan.x||j.pan.y!==O.pan.y;!F&&!(S&&!y)&&(e.motionBlurPxRatio=1),o&&(D=o),N*=l,D.x*=l,D.y*=l;var z=e.getCachedZSortedEles();function G(ye,ve,ue,xe,Se){var Ae=ye.globalCompositeOperation;ye.globalCompositeOperation="destination-out",e.colorFillStyle(ye,255,255,255,e.motionBlurTransparency),ye.fillRect(ve,ue,xe,Se),ye.globalCompositeOperation=Ae}function Z(ye,ve){var ue,xe,Se,Ae;!e.clearingMotionBlur&&(ye===u.bufferContexts[e.MOTIONBLUR_BUFFER_NODE]||ye===u.bufferContexts[e.MOTIONBLUR_BUFFER_DRAG])?(ue={x:R.x*g,y:R.y*g},xe=T*g,Se=e.canvasWidth*g,Ae=e.canvasHeight*g):(ue=D,xe=N,Se=e.canvasWidth,Ae=e.canvasHeight),ye.setTransform(1,0,0,1,0,0),ve==="motionBlur"?G(ye,0,0,Se,Ae):!n&&(ve===void 0||ve)&&ye.clearRect(0,0,Se,Ae),i||(ye.translate(ue.x,ue.y),ye.scale(xe,xe)),o&&ye.translate(o.x,o.y),s&&ye.scale(s,s)}if(f||(e.textureDrawLastFrame=!1),f){if(e.textureDrawLastFrame=!0,!e.textureCache){e.textureCache={},e.textureCache.bb=r.mutableElements().boundingBox(),e.textureCache.texture=e.data.bufferCanvases[e.TEXTURE_BUFFER];var I=e.data.bufferContexts[e.TEXTURE_BUFFER];I.setTransform(1,0,0,1,0,0),I.clearRect(0,0,e.canvasWidth*e.textureMult,e.canvasHeight*e.textureMult),e.render({forcedContext:I,drawOnlyNodeLayer:!0,forcedPxRatio:l*e.textureMult});var j=e.textureCache.viewport={zoom:r.zoom(),pan:r.pan(),width:e.canvasWidth,height:e.canvasHeight};j.mpan={x:(0-j.pan.x)/j.zoom,y:(0-j.pan.y)/j.zoom}}c[e.DRAG]=!1,c[e.NODE]=!1;var W=u.contexts[e.NODE],U=e.textureCache.texture,j=e.textureCache.viewport;W.setTransform(1,0,0,1,0,0),p?G(W,0,0,j.width,j.height):W.clearRect(0,0,j.width,j.height);var K=_.core("outside-texture-bg-color").value,$=_.core("outside-texture-bg-opacity").value;e.colorFillStyle(W,K[0],K[1],K[2],$),W.fillRect(0,0,j.width,j.height);var T=r.zoom();Z(W,!1),W.clearRect(j.mpan.x,j.mpan.y,j.width/j.zoom/l,j.height/j.zoom/l),W.drawImage(U,j.mpan.x,j.mpan.y,j.width/j.zoom/l,j.height/j.zoom/l)}else e.textureOnViewport&&!n&&(e.textureCache=null);var Q=r.extent(),ie=e.pinching||e.hoverData.dragging||e.swipePanning||e.data.wheelZooming||e.hoverData.draggingEles||e.cy.animated(),te=e.hideEdgesOnViewport&&ie,X=[];if(X[e.NODE]=!c[e.NODE]&&p&&!e.clearedForMotionBlur[e.NODE]||e.clearingMotionBlur,X[e.NODE]&&(e.clearedForMotionBlur[e.NODE]=!0),X[e.DRAG]=!c[e.DRAG]&&p&&!e.clearedForMotionBlur[e.DRAG]||e.clearingMotionBlur,X[e.DRAG]&&(e.clearedForMotionBlur[e.DRAG]=!0),c[e.NODE]||i||a||X[e.NODE]){var re=p&&!X[e.NODE]&&g!==1,W=n||(re?e.data.bufferContexts[e.MOTIONBLUR_BUFFER_NODE]:u.contexts[e.NODE]),fe=p&&!re?"motionBlur":void 0;Z(W,fe),te?e.drawCachedNodes(W,z.nondrag,l,Q):e.drawLayeredElements(W,z.nondrag,l,Q),e.debug&&e.drawDebugPoints(W,z.nondrag),!i&&!p&&(c[e.NODE]=!1)}if(!a&&(c[e.DRAG]||i||X[e.DRAG])){var re=p&&!X[e.DRAG]&&g!==1,W=n||(re?e.data.bufferContexts[e.MOTIONBLUR_BUFFER_DRAG]:u.contexts[e.DRAG]);Z(W,p&&!re?"motionBlur":void 0),te?e.drawCachedNodes(W,z.drag,l,Q):e.drawCachedElements(W,z.drag,l,Q),e.debug&&e.drawDebugPoints(W,z.drag),!i&&!p&&(c[e.DRAG]=!1)}if(this.drawSelectionRectangle(t,Z),p&&g!==1){var oe=u.contexts[e.NODE],se=e.data.bufferCanvases[e.MOTIONBLUR_BUFFER_NODE],he=u.contexts[e.DRAG],ae=e.data.bufferCanvases[e.MOTIONBLUR_BUFFER_DRAG],pe=function(ve,ue,xe){ve.setTransform(1,0,0,1,0,0),xe||!C?ve.clearRect(0,0,e.canvasWidth,e.canvasHeight):G(ve,0,0,e.canvasWidth,e.canvasHeight);var Se=g;ve.drawImage(ue,0,0,e.canvasWidth*Se,e.canvasHeight*Se,0,0,e.canvasWidth,e.canvasHeight)};(c[e.NODE]||X[e.NODE])&&(pe(oe,se,X[e.NODE]),c[e.NODE]=!1),(c[e.DRAG]||X[e.DRAG])&&(pe(he,ae,X[e.DRAG]),c[e.DRAG]=!1)}e.prevViewport=j,e.clearingMotionBlur&&(e.clearingMotionBlur=!1,e.motionBlurCleared=!0,e.motionBlur=!0),p&&(e.motionBlurTimeout=setTimeout(function(){e.motionBlurTimeout=null,e.clearedForMotionBlur[e.NODE]=!1,e.clearedForMotionBlur[e.DRAG]=!1,e.motionBlur=!1,e.clearingMotionBlur=!f,e.mbFrames=0,c[e.NODE]=!0,c[e.DRAG]=!0,e.redraw()},yU)),n||r.emit("render")};var $m;Ms.drawSelectionRectangle=function(t,e){var r=this,n=r.cy,i=r.data,a=n.style(),s=t.drawOnlyNodeLayer,o=t.drawAllLayers,l=i.canvasNeedsRedraw,u=t.forcedContext;if(r.showFps||!s&&l[r.SELECT_BOX]&&!o){var c=u||i.contexts[r.SELECT_BOX];if(e(c),r.selection[4]==1&&(r.hoverData.selecting||r.touchData.selecting)){var f=r.cy.zoom(),p=a.core("selection-box-border-width").value/f;c.lineWidth=p,c.fillStyle="rgba("+a.core("selection-box-color").value[0]+","+a.core("selection-box-color").value[1]+","+a.core("selection-box-color").value[2]+","+a.core("selection-box-opacity").value+")",c.fillRect(r.selection[0],r.selection[1],r.selection[2]-r.selection[0],r.selection[3]-r.selection[1]),p>0&&(c.strokeStyle="rgba("+a.core("selection-box-border-color").value[0]+","+a.core("selection-box-border-color").value[1]+","+a.core("selection-box-border-color").value[2]+","+a.core("selection-box-opacity").value+")",c.strokeRect(r.selection[0],r.selection[1],r.selection[2]-r.selection[0],r.selection[3]-r.selection[1]))}if(i.bgActivePosistion&&!r.hoverData.selecting){var f=r.cy.zoom(),g=i.bgActivePosistion;c.fillStyle="rgba("+a.core("active-bg-color").value[0]+","+a.core("active-bg-color").value[1]+","+a.core("active-bg-color").value[2]+","+a.core("active-bg-opacity").value+")",c.beginPath(),c.arc(g.x,g.y,a.core("active-bg-size").pfValue/f,0,2*Math.PI),c.fill()}var y=r.lastRedrawTime;if(r.showFps&&y){y=Math.round(y);var S=Math.round(1e3/y),w="1 frame = "+y+" ms = "+S+" fps";if(c.setTransform(1,0,0,1,0,0),c.fillStyle="rgba(255, 0, 0, 0.75)",c.strokeStyle="rgba(255, 0, 0, 0.75)",c.font="30px Arial",!$m){var C=c.measureText(w);$m=C.actualBoundingBoxAscent}c.fillText(w,0,$m);var _=60;c.strokeRect(0,$m+10,250,20),c.fillRect(0,$m+10,250*Math.min(S/_,1),20)}o||(l[r.SELECT_BOX]=!1)}};function t5(t,e,r){var n=t.createShader(e);if(t.shaderSource(n,r),t.compileShader(n),!t.getShaderParameter(n,t.COMPILE_STATUS))throw new Error(t.getShaderInfoLog(n));return n}function xU(t,e,r){var n=t5(t,t.VERTEX_SHADER,e),i=t5(t,t.FRAGMENT_SHADER,r),a=t.createProgram();if(t.attachShader(a,n),t.attachShader(a,i),t.linkProgram(a),!t.getProgramParameter(a,t.LINK_STATUS))throw new Error("Could not initialize shaders");return a}function bU(t,e,r){r===void 0&&(r=e);var n=t.makeOffscreenCanvas(e,r),i=n.context=n.getContext("2d");return n.clear=function(){return i.clearRect(0,0,n.width,n.height)},n.clear(),n}function E_(t){var e=t.pixelRatio,r=t.cy.zoom(),n=t.cy.pan();return{zoom:r*e,pan:{x:n.x*e,y:n.y*e}}}function wU(t){var e=t.pixelRatio,r=t.cy.zoom();return r*e}function SU(t,e,r,n,i){var a=n*r+e.x,s=i*r+e.y;return s=Math.round(t.canvasHeight-s),[a,s]}function kU(t){return t.pstyle("background-fill").value!=="solid"||t.pstyle("background-image").strValue!=="none"?!1:t.pstyle("border-width").value===0||t.pstyle("border-opacity").value===0?!0:t.pstyle("border-style").value==="solid"}function _U(t,e){if(t.length!==e.length)return!1;for(var r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function Vf(t,e,r){var n=t[0]/255,i=t[1]/255,a=t[2]/255,s=e,o=r||new Array(4);return o[0]=n*s,o[1]=i*s,o[2]=a*s,o[3]=s,o}function gp(t,e){var r=e||new Array(4);return r[0]=(t>>0&255)/255,r[1]=(t>>8&255)/255,r[2]=(t>>16&255)/255,r[3]=(t>>24&255)/255,r}function CU(t){return t[0]+(t[1]<<8)+(t[2]<<16)+(t[3]<<24)}function EU(t,e){var r=t.createTexture();return r.buffer=function(n){t.bindTexture(t.TEXTURE_2D,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR_MIPMAP_NEAREST),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n),t.generateMipmap(t.TEXTURE_2D),t.bindTexture(t.TEXTURE_2D,null)},r.deleteTexture=function(){t.deleteTexture(r)},r}function hL(t,e){switch(e){case"float":return[1,t.FLOAT,4];case"vec2":return[2,t.FLOAT,4];case"vec3":return[3,t.FLOAT,4];case"vec4":return[4,t.FLOAT,4];case"int":return[1,t.INT,4];case"ivec2":return[2,t.INT,4]}}function pL(t,e,r){switch(e){case t.FLOAT:return new Float32Array(r);case t.INT:return new Int32Array(r)}}function TU(t,e,r,n,i,a){switch(e){case t.FLOAT:return new Float32Array(r.buffer,a*n,i);case t.INT:return new Int32Array(r.buffer,a*n,i)}}function NU(t,e,r,n){var i=hL(t,e),a=Di(i,2),s=a[0],o=a[1],l=pL(t,o,n),u=t.createBuffer();return t.bindBuffer(t.ARRAY_BUFFER,u),t.bufferData(t.ARRAY_BUFFER,l,t.STATIC_DRAW),o===t.FLOAT?t.vertexAttribPointer(r,s,o,!1,0,0):o===t.INT&&t.vertexAttribIPointer(r,s,o,0,0),t.enableVertexAttribArray(r),t.bindBuffer(t.ARRAY_BUFFER,null),u}function yu(t,e,r,n){var i=hL(t,r),a=Di(i,3),s=a[0],o=a[1],l=a[2],u=pL(t,o,e*s),c=s*l,f=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,f),t.bufferData(t.ARRAY_BUFFER,e*c,t.DYNAMIC_DRAW),t.enableVertexAttribArray(n),o===t.FLOAT?t.vertexAttribPointer(n,s,o,!1,c,0):o===t.INT&&t.vertexAttribIPointer(n,s,o,c,0),t.vertexAttribDivisor(n,1),t.bindBuffer(t.ARRAY_BUFFER,null);for(var p=new Array(e),g=0;g<e;g++)p[g]=TU(t,o,u,c,s,g);return f.dataArray=u,f.stride=c,f.size=s,f.getView=function(y){return p[y]},f.setPoint=function(y,S,w){var C=p[y];C[0]=S,C[1]=w},f.bufferSubData=function(y){t.bindBuffer(t.ARRAY_BUFFER,f),y?t.bufferSubData(t.ARRAY_BUFFER,0,u,0,y*s):t.bufferSubData(t.ARRAY_BUFFER,0,u)},f}function PU(t,e,r){for(var n=9,i=new Float32Array(e*n),a=new Array(e),s=0;s<e;s++){var o=s*n*4;a[s]=new Float32Array(i.buffer,o,n)}var l=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,l),t.bufferData(t.ARRAY_BUFFER,i.byteLength,t.DYNAMIC_DRAW);for(var u=0;u<3;u++){var c=r+u;t.enableVertexAttribArray(c),t.vertexAttribPointer(c,3,t.FLOAT,!1,36,u*12),t.vertexAttribDivisor(c,1)}return t.bindBuffer(t.ARRAY_BUFFER,null),l.getMatrixView=function(f){return a[f]},l.setData=function(f,p){a[p].set(f,0)},l.bufferSubData=function(){t.bindBuffer(t.ARRAY_BUFFER,l),t.bufferSubData(t.ARRAY_BUFFER,0,i)},l}function MU(t){var e=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,e);var r=t.createTexture();return t.bindTexture(t.TEXTURE_2D,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r,0),t.bindFramebuffer(t.FRAMEBUFFER,null),e.setFramebufferAttachmentSizes=function(n,i){t.bindTexture(t.TEXTURE_2D,r),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,n,i,0,t.RGBA,t.UNSIGNED_BYTE,null)},e}var r5=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});function x2(){var t=new r5(9);return r5!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function n5(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function AU(t,e,r){var n=e[0],i=e[1],a=e[2],s=e[3],o=e[4],l=e[5],u=e[6],c=e[7],f=e[8],p=r[0],g=r[1],y=r[2],S=r[3],w=r[4],C=r[5],_=r[6],T=r[7],N=r[8];return t[0]=p*n+g*s+y*u,t[1]=p*i+g*o+y*c,t[2]=p*a+g*l+y*f,t[3]=S*n+w*s+C*u,t[4]=S*i+w*o+C*c,t[5]=S*a+w*l+C*f,t[6]=_*n+T*s+N*u,t[7]=_*i+T*o+N*c,t[8]=_*a+T*l+N*f,t}function Ky(t,e,r){var n=e[0],i=e[1],a=e[2],s=e[3],o=e[4],l=e[5],u=e[6],c=e[7],f=e[8],p=r[0],g=r[1];return t[0]=n,t[1]=i,t[2]=a,t[3]=s,t[4]=o,t[5]=l,t[6]=p*n+g*s+u,t[7]=p*i+g*o+c,t[8]=p*a+g*l+f,t}function i5(t,e,r){var n=e[0],i=e[1],a=e[2],s=e[3],o=e[4],l=e[5],u=e[6],c=e[7],f=e[8],p=Math.sin(r),g=Math.cos(r);return t[0]=g*n+p*s,t[1]=g*i+p*o,t[2]=g*a+p*l,t[3]=g*s-p*n,t[4]=g*o-p*i,t[5]=g*l-p*a,t[6]=u,t[7]=c,t[8]=f,t}function rk(t,e,r){var n=r[0],i=r[1];return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=i*e[3],t[4]=i*e[4],t[5]=i*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function LU(t,e,r){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/r,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}var RU=(function(){function t(e,r,n,i){sf(this,t),this.debugID=Math.floor(Math.random()*1e4),this.r=e,this.texSize=r,this.texRows=n,this.texHeight=Math.floor(r/n),this.enableWrapping=!0,this.locked=!1,this.texture=null,this.needsBuffer=!0,this.freePointer={x:0,row:0},this.keyToLocation=new Map,this.canvas=i(e,r,r),this.scratch=i(e,r,this.texHeight,"scratch")}return of(t,[{key:"lock",value:function(){this.locked=!0}},{key:"getKeys",value:function(){return new Set(this.keyToLocation.keys())}},{key:"getScale",value:function(r){var n=r.w,i=r.h,a=this.texHeight,s=this.texSize,o=a/i,l=n*o,u=i*o;return l>s&&(o=s/n,l=n*o,u=i*o),{scale:o,texW:l,texH:u}}},{key:"draw",value:function(r,n,i){var a=this;if(this.locked)throw new Error("can't draw, atlas is locked");var s=this.texSize,o=this.texRows,l=this.texHeight,u=this.getScale(n),c=u.scale,f=u.texW,p=u.texH,g=function(T,N){if(i&&N){var R=N.context,D=T.x,j=T.row,O=D,F=l*j;R.save(),R.translate(O,F),R.scale(c,c),i(R,n),R.restore()}},y=[null,null],S=function(){g(a.freePointer,a.canvas),y[0]={x:a.freePointer.x,y:a.freePointer.row*l,w:f,h:p},y[1]={x:a.freePointer.x+f,y:a.freePointer.row*l,w:0,h:p},a.freePointer.x+=f,a.freePointer.x==s&&(a.freePointer.x=0,a.freePointer.row++)},w=function(){var T=a.scratch,N=a.canvas;T.clear(),g({x:0,row:0},T);var R=s-a.freePointer.x,D=f-R,j=l;{var O=a.freePointer.x,F=a.freePointer.row*l,z=R;N.context.drawImage(T,0,0,z,j,O,F,z,j),y[0]={x:O,y:F,w:z,h:p}}{var G=R,Z=(a.freePointer.row+1)*l,I=D;N&&N.context.drawImage(T,G,0,I,j,0,Z,I,j),y[1]={x:0,y:Z,w:I,h:p}}a.freePointer.x=D,a.freePointer.row++},C=function(){a.freePointer.x=0,a.freePointer.row++};if(this.freePointer.x+f<=s)S();else{if(this.freePointer.row>=o-1)return!1;this.freePointer.x===s?(C(),S()):this.enableWrapping?w():(C(),S())}return this.keyToLocation.set(r,y),this.needsBuffer=!0,y}},{key:"getOffsets",value:function(r){return this.keyToLocation.get(r)}},{key:"isEmpty",value:function(){return this.freePointer.x===0&&this.freePointer.row===0}},{key:"canFit",value:function(r){if(this.locked)return!1;var n=this.texSize,i=this.texRows,a=this.getScale(r),s=a.texW;return this.freePointer.x+s>n?this.freePointer.row<i-1:!0}},{key:"bufferIfNeeded",value:function(r){this.texture||(this.texture=EU(r,this.debugID)),this.needsBuffer&&(this.texture.buffer(this.canvas),this.needsBuffer=!1,this.locked&&(this.canvas=null,this.scratch=null))}},{key:"dispose",value:function(){this.texture&&(this.texture.deleteTexture(),this.texture=null),this.canvas=null,this.scratch=null,this.locked=!0}}])})(),OU=(function(){function t(e,r,n,i){sf(this,t),this.r=e,this.texSize=r,this.texRows=n,this.createTextureCanvas=i,this.atlases=[],this.styleKeyToAtlas=new Map,this.markedKeys=new Set}return of(t,[{key:"getKeys",value:function(){return new Set(this.styleKeyToAtlas.keys())}},{key:"_createAtlas",value:function(){var r=this.r,n=this.texSize,i=this.texRows,a=this.createTextureCanvas;return new RU(r,n,i,a)}},{key:"_getScratchCanvas",value:function(){if(!this.scratch){var r=this.r,n=this.texSize,i=this.texRows,a=this.createTextureCanvas,s=Math.floor(n/i);this.scratch=a(r,n,s,"scratch")}return this.scratch}},{key:"draw",value:function(r,n,i){var a=this.styleKeyToAtlas.get(r);return a||(a=this.atlases[this.atlases.length-1],(!a||!a.canFit(n))&&(a&&a.lock(),a=this._createAtlas(),this.atlases.push(a)),a.draw(r,n,i),this.styleKeyToAtlas.set(r,a)),a}},{key:"getAtlas",value:function(r){return this.styleKeyToAtlas.get(r)}},{key:"hasAtlas",value:function(r){return this.styleKeyToAtlas.has(r)}},{key:"markKeyForGC",value:function(r){this.markedKeys.add(r)}},{key:"gc",value:function(){var r=this,n=this.markedKeys;if(n.size===0){console.log("nothing to garbage collect");return}var i=[],a=new Map,s=null,o=Ys(this.atlases),l;try{var u=function(){var f=l.value,p=f.getKeys(),g=DU(n,p);if(g.size===0)return i.push(f),p.forEach(function(R){return a.set(R,f)}),1;s||(s=r._createAtlas(),i.push(s));var y=Ys(p),S;try{for(y.s();!(S=y.n()).done;){var w=S.value;if(!g.has(w)){var C=f.getOffsets(w),_=Di(C,2),T=_[0],N=_[1];s.canFit({w:T.w+N.w,h:T.h})||(s.lock(),s=r._createAtlas(),i.push(s)),f.canvas&&(r._copyTextureToNewAtlas(w,f,s),a.set(w,s))}}}catch(R){y.e(R)}finally{y.f()}f.dispose()};for(o.s();!(l=o.n()).done;)u()}catch(c){o.e(c)}finally{o.f()}this.atlases=i,this.styleKeyToAtlas=a,this.markedKeys=new Set}},{key:"_copyTextureToNewAtlas",value:function(r,n,i){var a=n.getOffsets(r),s=Di(a,2),o=s[0],l=s[1];if(l.w===0)i.draw(r,o,function(p){p.drawImage(n.canvas,o.x,o.y,o.w,o.h,0,0,o.w,o.h)});else{var u=this._getScratchCanvas();u.clear(),u.context.drawImage(n.canvas,o.x,o.y,o.w,o.h,0,0,o.w,o.h),u.context.drawImage(n.canvas,l.x,l.y,l.w,l.h,o.w,0,l.w,l.h);var c=o.w+l.w,f=o.h;i.draw(r,{w:c,h:f},function(p){p.drawImage(u,0,0,c,f,0,0,c,f)})}}},{key:"getCounts",value:function(){return{keyCount:this.styleKeyToAtlas.size,atlasCount:new Set(this.styleKeyToAtlas.values()).size}}}])})();function DU(t,e){return t.intersection?t.intersection(e):new Set(lx(t).filter(function(r){return e.has(r)}))}var IU=(function(){function t(e,r){sf(this,t),this.r=e,this.globalOptions=r,this.atlasSize=r.webglTexSize,this.maxAtlasesPerBatch=r.webglTexPerBatch,this.renderTypes=new Map,this.collections=new Map,this.typeAndIdToKey=new Map}return of(t,[{key:"getAtlasSize",value:function(){return this.atlasSize}},{key:"addAtlasCollection",value:function(r,n){var i=this.globalOptions,a=i.webglTexSize,s=i.createTextureCanvas,o=n.texRows,l=this._cacheScratchCanvas(s),u=new OU(this.r,a,o,l);this.collections.set(r,u)}},{key:"addRenderType",value:function(r,n){var i=n.collection;if(!this.collections.has(i))throw new Error("invalid atlas collection name '".concat(i,"'"));var a=this.collections.get(i),s=sr({type:r,atlasCollection:a},n);this.renderTypes.set(r,s)}},{key:"getRenderTypeOpts",value:function(r){return this.renderTypes.get(r)}},{key:"getAtlasCollection",value:function(r){return this.collections.get(r)}},{key:"_cacheScratchCanvas",value:function(r){var n=-1,i=-1,a=null;return function(s,o,l,u){return u?((!a||o!=n||l!=i)&&(n=o,i=l,a=r(s,o,l)),a):r(s,o,l)}}},{key:"_key",value:function(r,n){return"".concat(r,"-").concat(n)}},{key:"invalidate",value:function(r){var n=this,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=i.forceRedraw,s=a===void 0?!1:a,o=i.filterEle,l=o===void 0?function(){return!0}:o,u=i.filterType,c=u===void 0?function(){return!0}:u,f=!1,p=!1,g=Ys(r),y;try{for(g.s();!(y=g.n()).done;){var S=y.value;if(l(S)){var w=Ys(this.renderTypes.values()),C;try{var _=function(){var N=C.value,R=N.type;if(c(R)){var D=n.collections.get(N.collection),j=N.getKey(S),O=Array.isArray(j)?j:[j];if(s)O.forEach(function(Z){return D.markKeyForGC(Z)}),p=!0;else{var F=N.getID?N.getID(S):S.id(),z=n._key(R,F),G=n.typeAndIdToKey.get(z);G!==void 0&&!_U(O,G)&&(f=!0,n.typeAndIdToKey.delete(z),G.forEach(function(Z){return D.markKeyForGC(Z)}))}}};for(w.s();!(C=w.n()).done;)_()}catch(T){w.e(T)}finally{w.f()}}}}catch(T){g.e(T)}finally{g.f()}return p&&(this.gc(),f=!1),f}},{key:"gc",value:function(){var r=Ys(this.collections.values()),n;try{for(r.s();!(n=r.n()).done;){var i=n.value;i.gc()}}catch(a){r.e(a)}finally{r.f()}}},{key:"getOrCreateAtlas",value:function(r,n,i,a){var s=this.renderTypes.get(n),o=this.collections.get(s.collection),l=!1,u=o.draw(a,i,function(p){s.drawClipped?(p.save(),p.beginPath(),p.rect(0,0,i.w,i.h),p.clip(),s.drawElement(p,r,i,!0,!0),p.restore()):s.drawElement(p,r,i,!0,!0),l=!0});if(l){var c=s.getID?s.getID(r):r.id(),f=this._key(n,c);this.typeAndIdToKey.has(f)?this.typeAndIdToKey.get(f).push(a):this.typeAndIdToKey.set(f,[a])}return u}},{key:"getAtlasInfo",value:function(r,n){var i=this,a=this.renderTypes.get(n),s=a.getKey(r),o=Array.isArray(s)?s:[s];return o.map(function(l){var u=a.getBoundingBox(r,l),c=i.getOrCreateAtlas(r,n,u,l),f=c.getOffsets(l),p=Di(f,2),g=p[0],y=p[1];return{atlas:c,tex:g,tex1:g,tex2:y,bb:u}})}},{key:"getDebugInfo",value:function(){var r=[],n=Ys(this.collections),i;try{for(n.s();!(i=n.n()).done;){var a=Di(i.value,2),s=a[0],o=a[1],l=o.getCounts(),u=l.keyCount,c=l.atlasCount;r.push({type:s,keyCount:u,atlasCount:c})}}catch(f){n.e(f)}finally{n.f()}return r}}])})(),jU=(function(){function t(e){sf(this,t),this.globalOptions=e,this.atlasSize=e.webglTexSize,this.maxAtlasesPerBatch=e.webglTexPerBatch,this.batchAtlases=[]}return of(t,[{key:"getMaxAtlasesPerBatch",value:function(){return this.maxAtlasesPerBatch}},{key:"getAtlasSize",value:function(){return this.atlasSize}},{key:"getIndexArray",value:function(){return Array.from({length:this.maxAtlasesPerBatch},function(r,n){return n})}},{key:"startBatch",value:function(){this.batchAtlases=[]}},{key:"getAtlasCount",value:function(){return this.batchAtlases.length}},{key:"getAtlases",value:function(){return this.batchAtlases}},{key:"canAddToCurrentBatch",value:function(r){return this.batchAtlases.length===this.maxAtlasesPerBatch?this.batchAtlases.includes(r):!0}},{key:"getAtlasIndexForBatch",value:function(r){var n=this.batchAtlases.indexOf(r);if(n<0){if(this.batchAtlases.length===this.maxAtlasesPerBatch)throw new Error("cannot add more atlases to batch");this.batchAtlases.push(r),n=this.batchAtlases.length-1}return n}}])})(),FU=`
  float circleSD(vec2 p, float r) {
    return distance(vec2(0), p) - r; // signed distance
  }
`,BU=`
  float rectangleSD(vec2 p, vec2 b) {
    vec2 d = abs(p)-b;
    return distance(vec2(0),max(d,0.0)) + min(max(d.x,d.y),0.0);
  }
`,zU=`
  float roundRectangleSD(vec2 p, vec2 b, vec4 cr) {
    cr.xy = (p.x > 0.0) ? cr.xy : cr.zw;
    cr.x  = (p.y > 0.0) ? cr.x  : cr.y;
    vec2 q = abs(p) - b + cr.x;
    return min(max(q.x, q.y), 0.0) + distance(vec2(0), max(q, 0.0)) - cr.x;
  }
`,UU=`
  float ellipseSD(vec2 p, vec2 ab) {
    p = abs( p ); // symmetry

    // find root with Newton solver
    vec2 q = ab*(p-ab);
    float w = (q.x<q.y)? 1.570796327 : 0.0;
    for( int i=0; i<5; i++ ) {
      vec2 cs = vec2(cos(w),sin(w));
      vec2 u = ab*vec2( cs.x,cs.y);
      vec2 v = ab*vec2(-cs.y,cs.x);
      w = w + dot(p-u,v)/(dot(p-u,u)+dot(v,v));
    }
    
    // compute final point and distance
    float d = length(p-ab*vec2(cos(w),sin(w)));
    
    // return signed distance
    return (dot(p/ab,p/ab)>1.0) ? d : -d;
  }
`,nv={SCREEN:{name:"screen",screen:!0},PICKING:{name:"picking",picking:!0}},bx={IGNORE:1,USE_BB:2},b2=0,a5=1,s5=2,w2=3,vp=4,dy=5,Km=6,Zm=7,GU=(function(){function t(e,r,n){sf(this,t),this.r=e,this.gl=r,this.maxInstances=n.webglBatchSize,this.atlasSize=n.webglTexSize,this.bgColor=n.bgColor,this.debug=n.webglDebug,this.batchDebugInfo=[],n.enableWrapping=!0,n.createTextureCanvas=bU,this.atlasManager=new IU(e,n),this.batchManager=new jU(n),this.simpleShapeOptions=new Map,this.program=this._createShaderProgram(nv.SCREEN),this.pickingProgram=this._createShaderProgram(nv.PICKING),this.vao=this._createVAO()}return of(t,[{key:"addAtlasCollection",value:function(r,n){this.atlasManager.addAtlasCollection(r,n)}},{key:"addTextureAtlasRenderType",value:function(r,n){this.atlasManager.addRenderType(r,n)}},{key:"addSimpleShapeRenderType",value:function(r,n){this.simpleShapeOptions.set(r,n)}},{key:"invalidate",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=n.type,a=this.atlasManager;return i?a.invalidate(r,{filterType:function(o){return o===i},forceRedraw:!0}):a.invalidate(r)}},{key:"gc",value:function(){this.atlasManager.gc()}},{key:"_createShaderProgram",value:function(r){var n=this.gl,i=`#version 300 es
      precision highp float;

      uniform mat3 uPanZoomMatrix;
      uniform int  uAtlasSize;
      
      // instanced
      in vec2 aPosition; // a vertex from the unit square
      
      in mat3 aTransform; // used to transform verticies, eg into a bounding box
      in int aVertType; // the type of thing we are rendering

      // the z-index that is output when using picking mode
      in vec4 aIndex;
      
      // For textures
      in int aAtlasId; // which shader unit/atlas to use
      in vec4 aTex; // x/y/w/h of texture in atlas

      // for edges
      in vec4 aPointAPointB;
      in vec4 aPointCPointD;
      in vec2 aLineWidth; // also used for node border width

      // simple shapes
      in vec4 aCornerRadius; // for round-rectangle [top-right, bottom-right, top-left, bottom-left]
      in vec4 aColor; // also used for edges
      in vec4 aBorderColor; // aLineWidth is used for border width

      // output values passed to the fragment shader
      out vec2 vTexCoord;
      out vec4 vColor;
      out vec2 vPosition;
      // flat values are not interpolated
      flat out int vAtlasId; 
      flat out int vVertType;
      flat out vec2 vTopRight;
      flat out vec2 vBotLeft;
      flat out vec4 vCornerRadius;
      flat out vec4 vBorderColor;
      flat out vec2 vBorderWidth;
      flat out vec4 vIndex;
      
      void main(void) {
        int vid = gl_VertexID;
        vec2 position = aPosition; // TODO make this a vec3, simplifies some code below

        if(aVertType == `.concat(b2,`) {
          float texX = aTex.x; // texture coordinates
          float texY = aTex.y;
          float texW = aTex.z;
          float texH = aTex.w;

          if(vid == 1 || vid == 2 || vid == 4) {
            texX += texW;
          }
          if(vid == 2 || vid == 4 || vid == 5) {
            texY += texH;
          }

          float d = float(uAtlasSize);
          vTexCoord = vec2(texX / d, texY / d); // tex coords must be between 0 and 1

          gl_Position = vec4(uPanZoomMatrix * aTransform * vec3(position, 1.0), 1.0);
        }
        else if(aVertType == `).concat(vp," || aVertType == ").concat(Zm,` 
             || aVertType == `).concat(dy," || aVertType == ").concat(Km,`) { // simple shapes

          // the bounding box is needed by the fragment shader
          vBotLeft  = (aTransform * vec3(0, 0, 1)).xy; // flat
          vTopRight = (aTransform * vec3(1, 1, 1)).xy; // flat
          vPosition = (aTransform * vec3(position, 1)).xy; // will be interpolated

          // calculations are done in the fragment shader, just pass these along
          vColor = aColor;
          vCornerRadius = aCornerRadius;
          vBorderColor = aBorderColor;
          vBorderWidth = aLineWidth;

          gl_Position = vec4(uPanZoomMatrix * aTransform * vec3(position, 1.0), 1.0);
        }
        else if(aVertType == `).concat(a5,`) {
          vec2 source = aPointAPointB.xy;
          vec2 target = aPointAPointB.zw;

          // adjust the geometry so that the line is centered on the edge
          position.y = position.y - 0.5;

          // stretch the unit square into a long skinny rectangle
          vec2 xBasis = target - source;
          vec2 yBasis = normalize(vec2(-xBasis.y, xBasis.x));
          vec2 point = source + xBasis * position.x + yBasis * aLineWidth[0] * position.y;

          gl_Position = vec4(uPanZoomMatrix * vec3(point, 1.0), 1.0);
          vColor = aColor;
        } 
        else if(aVertType == `).concat(s5,`) {
          vec2 pointA = aPointAPointB.xy;
          vec2 pointB = aPointAPointB.zw;
          vec2 pointC = aPointCPointD.xy;
          vec2 pointD = aPointCPointD.zw;

          // adjust the geometry so that the line is centered on the edge
          position.y = position.y - 0.5;

          vec2 p0, p1, p2, pos;
          if(position.x == 0.0) { // The left side of the unit square
            p0 = pointA;
            p1 = pointB;
            p2 = pointC;
            pos = position;
          } else { // The right side of the unit square, use same approach but flip the geometry upside down
            p0 = pointD;
            p1 = pointC;
            p2 = pointB;
            pos = vec2(0.0, -position.y);
          }

          vec2 p01 = p1 - p0;
          vec2 p12 = p2 - p1;
          vec2 p21 = p1 - p2;

          // Find the normal vector.
          vec2 tangent = normalize(normalize(p12) + normalize(p01));
          vec2 normal = vec2(-tangent.y, tangent.x);

          // Find the vector perpendicular to p0 -> p1.
          vec2 p01Norm = normalize(vec2(-p01.y, p01.x));

          // Determine the bend direction.
          float sigma = sign(dot(p01 + p21, normal));
          float width = aLineWidth[0];

          if(sign(pos.y) == -sigma) {
            // This is an intersecting vertex. Adjust the position so that there's no overlap.
            vec2 point = 0.5 * width * normal * -sigma / dot(normal, p01Norm);
            gl_Position = vec4(uPanZoomMatrix * vec3(p1 + point, 1.0), 1.0);
          } else {
            // This is a non-intersecting vertex. Treat it like a mitre join.
            vec2 point = 0.5 * width * normal * sigma * dot(normal, p01Norm);
            gl_Position = vec4(uPanZoomMatrix * vec3(p1 + point, 1.0), 1.0);
          }

          vColor = aColor;
        } 
        else if(aVertType == `).concat(w2,` && vid < 3) {
          // massage the first triangle into an edge arrow
          if(vid == 0)
            position = vec2(-0.15, -0.3);
          if(vid == 1)
            position = vec2(  0.0,  0.0);
          if(vid == 2)
            position = vec2( 0.15, -0.3);

          gl_Position = vec4(uPanZoomMatrix * aTransform * vec3(position, 1.0), 1.0);
          vColor = aColor;
        }
        else {
          gl_Position = vec4(2.0, 0.0, 0.0, 1.0); // discard vertex by putting it outside webgl clip space
        }

        vAtlasId = aAtlasId;
        vVertType = aVertType;
        vIndex = aIndex;
      }
    `),a=this.batchManager.getIndexArray(),s=`#version 300 es
      precision highp float;

      // declare texture unit for each texture atlas in the batch
      `.concat(a.map(function(u){return"uniform sampler2D uTexture".concat(u,";")}).join(`
	`),`

      uniform vec4 uBGColor;
      uniform float uZoom;

      in vec2 vTexCoord;
      in vec4 vColor;
      in vec2 vPosition; // model coordinates

      flat in int vAtlasId;
      flat in vec4 vIndex;
      flat in int vVertType;
      flat in vec2 vTopRight;
      flat in vec2 vBotLeft;
      flat in vec4 vCornerRadius;
      flat in vec4 vBorderColor;
      flat in vec2 vBorderWidth;

      out vec4 outColor;

      `).concat(FU,`
      `).concat(BU,`
      `).concat(zU,`
      `).concat(UU,`

      vec4 blend(vec4 top, vec4 bot) { // blend colors with premultiplied alpha
        return vec4( 
          top.rgb + (bot.rgb * (1.0 - top.a)),
          top.a   + (bot.a   * (1.0 - top.a)) 
        );
      }

      vec4 distInterp(vec4 cA, vec4 cB, float d) { // interpolate color using Signed Distance
        // scale to the zoom level so that borders don't look blurry when zoomed in
        // note 1.5 is an aribitrary value chosen because it looks good
        return mix(cA, cB, 1.0 - smoothstep(0.0, 1.5 / uZoom, abs(d))); 
      }

      void main(void) {
        if(vVertType == `).concat(b2,`) {
          // look up the texel from the texture unit
          `).concat(a.map(function(u){return"if(vAtlasId == ".concat(u,") outColor = texture(uTexture").concat(u,", vTexCoord);")}).join(`
	else `),`
        } 
        else if(vVertType == `).concat(w2,`) {
          // mimics how canvas renderer uses context.globalCompositeOperation = 'destination-out';
          outColor = blend(vColor, uBGColor);
          outColor.a = 1.0; // make opaque, masks out line under arrow
        }
        else if(vVertType == `).concat(vp,` && vBorderWidth == vec2(0.0)) { // simple rectangle with no border
          outColor = vColor; // unit square is already transformed to the rectangle, nothing else needs to be done
        }
        else if(vVertType == `).concat(vp," || vVertType == ").concat(Zm,` 
          || vVertType == `).concat(dy," || vVertType == ").concat(Km,`) { // use SDF

          float outerBorder = vBorderWidth[0];
          float innerBorder = vBorderWidth[1];
          float borderPadding = outerBorder * 2.0;
          float w = vTopRight.x - vBotLeft.x - borderPadding;
          float h = vTopRight.y - vBotLeft.y - borderPadding;
          vec2 b = vec2(w/2.0, h/2.0); // half width, half height
          vec2 p = vPosition - vec2(vTopRight.x - b[0] - outerBorder, vTopRight.y - b[1] - outerBorder); // translate to center

          float d; // signed distance
          if(vVertType == `).concat(vp,`) {
            d = rectangleSD(p, b);
          } else if(vVertType == `).concat(Zm,` && w == h) {
            d = circleSD(p, b.x); // faster than ellipse
          } else if(vVertType == `).concat(Zm,`) {
            d = ellipseSD(p, b);
          } else {
            d = roundRectangleSD(p, b, vCornerRadius.wzyx);
          }

          // use the distance to interpolate a color to smooth the edges of the shape, doesn't need multisampling
          // we must smooth colors inwards, because we can't change pixels outside the shape's bounding box
          if(d > 0.0) {
            if(d > outerBorder) {
              discard;
            } else {
              outColor = distInterp(vBorderColor, vec4(0), d - outerBorder);
            }
          } else {
            if(d > innerBorder) {
              vec4 outerColor = outerBorder == 0.0 ? vec4(0) : vBorderColor;
              vec4 innerBorderColor = blend(vBorderColor, vColor);
              outColor = distInterp(innerBorderColor, outerColor, d);
            } 
            else {
              vec4 outerColor;
              if(innerBorder == 0.0 && outerBorder == 0.0) {
                outerColor = vec4(0);
              } else if(innerBorder == 0.0) {
                outerColor = vBorderColor;
              } else {
                outerColor = blend(vBorderColor, vColor);
              }
              outColor = distInterp(vColor, outerColor, d - innerBorder);
            }
          }
        }
        else {
          outColor = vColor;
        }

        `).concat(r.picking?`if(outColor.a == 0.0) discard;
             else outColor = vIndex;`:"",`
      }
    `),o=xU(n,i,s);o.aPosition=n.getAttribLocation(o,"aPosition"),o.aIndex=n.getAttribLocation(o,"aIndex"),o.aVertType=n.getAttribLocation(o,"aVertType"),o.aTransform=n.getAttribLocation(o,"aTransform"),o.aAtlasId=n.getAttribLocation(o,"aAtlasId"),o.aTex=n.getAttribLocation(o,"aTex"),o.aPointAPointB=n.getAttribLocation(o,"aPointAPointB"),o.aPointCPointD=n.getAttribLocation(o,"aPointCPointD"),o.aLineWidth=n.getAttribLocation(o,"aLineWidth"),o.aColor=n.getAttribLocation(o,"aColor"),o.aCornerRadius=n.getAttribLocation(o,"aCornerRadius"),o.aBorderColor=n.getAttribLocation(o,"aBorderColor"),o.uPanZoomMatrix=n.getUniformLocation(o,"uPanZoomMatrix"),o.uAtlasSize=n.getUniformLocation(o,"uAtlasSize"),o.uBGColor=n.getUniformLocation(o,"uBGColor"),o.uZoom=n.getUniformLocation(o,"uZoom"),o.uTextures=[];for(var l=0;l<this.batchManager.getMaxAtlasesPerBatch();l++)o.uTextures.push(n.getUniformLocation(o,"uTexture".concat(l)));return o}},{key:"_createVAO",value:function(){var r=[0,0,1,0,1,1,0,0,1,1,0,1];this.vertexCount=r.length/2;var n=this.maxInstances,i=this.gl,a=this.program,s=i.createVertexArray();return i.bindVertexArray(s),NU(i,"vec2",a.aPosition,r),this.transformBuffer=PU(i,n,a.aTransform),this.indexBuffer=yu(i,n,"vec4",a.aIndex),this.vertTypeBuffer=yu(i,n,"int",a.aVertType),this.atlasIdBuffer=yu(i,n,"int",a.aAtlasId),this.texBuffer=yu(i,n,"vec4",a.aTex),this.pointAPointBBuffer=yu(i,n,"vec4",a.aPointAPointB),this.pointCPointDBuffer=yu(i,n,"vec4",a.aPointCPointD),this.lineWidthBuffer=yu(i,n,"vec2",a.aLineWidth),this.colorBuffer=yu(i,n,"vec4",a.aColor),this.cornerRadiusBuffer=yu(i,n,"vec4",a.aCornerRadius),this.borderColorBuffer=yu(i,n,"vec4",a.aBorderColor),i.bindVertexArray(null),s}},{key:"buffers",get:function(){var r=this;return this._buffers||(this._buffers=Object.keys(this).filter(function(n){return Rd(n,"Buffer")}).map(function(n){return r[n]})),this._buffers}},{key:"startFrame",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:nv.SCREEN;this.panZoomMatrix=r,this.renderTarget=n,this.batchDebugInfo=[],this.wrappedCount=0,this.simpleCount=0,this.startBatch()}},{key:"startBatch",value:function(){this.instanceCount=0,this.batchManager.startBatch()}},{key:"endFrame",value:function(){this.endBatch()}},{key:"_isVisible",value:function(r,n){return r.visible()?n&&n.isVisible?n.isVisible(r):!0:!1}},{key:"drawTexture",value:function(r,n,i){var a=this.atlasManager,s=this.batchManager,o=a.getRenderTypeOpts(i);if(this._isVisible(r,o)&&!(r.isEdge()&&!this._isValidEdge(r))){if(this.renderTarget.picking&&o.getTexPickingMode){var l=o.getTexPickingMode(r);if(l===bx.IGNORE)return;if(l==bx.USE_BB){this.drawPickingRectangle(r,n,i);return}}var u=a.getAtlasInfo(r,i),c=Ys(u),f;try{for(c.s();!(f=c.n()).done;){var p=f.value,g=p.atlas,y=p.tex1,S=p.tex2;s.canAddToCurrentBatch(g)||this.endBatch();for(var w=s.getAtlasIndexForBatch(g),C=0,_=[[y,!0],[S,!1]];C<_.length;C++){var T=Di(_[C],2),N=T[0],R=T[1];if(N.w!=0){var D=this.instanceCount;this.vertTypeBuffer.getView(D)[0]=b2;var j=this.indexBuffer.getView(D);gp(n,j);var O=this.atlasIdBuffer.getView(D);O[0]=w;var F=this.texBuffer.getView(D);F[0]=N.x,F[1]=N.y,F[2]=N.w,F[3]=N.h;var z=this.transformBuffer.getMatrixView(D);this.setTransformMatrix(r,z,o,p,R),this.instanceCount++,R||this.wrappedCount++,this.instanceCount>=this.maxInstances&&this.endBatch()}}}}catch(G){c.e(G)}finally{c.f()}}}},{key:"setTransformMatrix",value:function(r,n,i,a){var s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,o=0;if(i.shapeProps&&i.shapeProps.padding&&(o=r.pstyle(i.shapeProps.padding).pfValue),a){var l=a.bb,u=a.tex1,c=a.tex2,f=u.w/(u.w+c.w);s||(f=1-f);var p=this._getAdjustedBB(l,o,s,f);this._applyTransformMatrix(n,p,i,r)}else{var g=i.getBoundingBox(r),y=this._getAdjustedBB(g,o,!0,1);this._applyTransformMatrix(n,y,i,r)}}},{key:"_applyTransformMatrix",value:function(r,n,i,a){var s,o;n5(r);var l=i.getRotation?i.getRotation(a):0;if(l!==0){var u=i.getRotationPoint(a),c=u.x,f=u.y;Ky(r,r,[c,f]),i5(r,r,l);var p=i.getRotationOffset(a);s=p.x+(n.xOffset||0),o=p.y+(n.yOffset||0)}else s=n.x1,o=n.y1;Ky(r,r,[s,o]),rk(r,r,[n.w,n.h])}},{key:"_getAdjustedBB",value:function(r,n,i,a){var s=r.x1,o=r.y1,l=r.w,u=r.h,c=r.yOffset;n&&(s-=n,o-=n,l+=2*n,u+=2*n);var f=0,p=l*a;return i&&a<1?l=p:!i&&a<1&&(f=l-p,s+=f,l=p),{x1:s,y1:o,w:l,h:u,xOffset:f,yOffset:c}}},{key:"drawPickingRectangle",value:function(r,n,i){var a=this.atlasManager.getRenderTypeOpts(i),s=this.instanceCount;this.vertTypeBuffer.getView(s)[0]=vp;var o=this.indexBuffer.getView(s);gp(n,o);var l=this.colorBuffer.getView(s);Vf([0,0,0],1,l);var u=this.transformBuffer.getMatrixView(s);this.setTransformMatrix(r,u,a),this.simpleCount++,this.instanceCount++,this.instanceCount>=this.maxInstances&&this.endBatch()}},{key:"drawNode",value:function(r,n,i){var a=this.simpleShapeOptions.get(i);if(this._isVisible(r,a)){var s=a.shapeProps,o=this._getVertTypeForShape(r,s.shape);if(o===void 0||a.isSimple&&!a.isSimple(r)){this.drawTexture(r,n,i);return}var l=this.instanceCount;if(this.vertTypeBuffer.getView(l)[0]=o,o===dy||o===Km){var u=a.getBoundingBox(r),c=this._getCornerRadius(r,s.radius,u),f=this.cornerRadiusBuffer.getView(l);f[0]=c,f[1]=c,f[2]=c,f[3]=c,o===Km&&(f[0]=0,f[2]=0)}var p=this.indexBuffer.getView(l);gp(n,p);var g=r.pstyle(s.color).value,y=r.pstyle(s.opacity).value,S=this.colorBuffer.getView(l);Vf(g,y,S);var w=this.lineWidthBuffer.getView(l);if(w[0]=0,w[1]=0,s.border){var C=r.pstyle("border-width").value;if(C>0){var _=r.pstyle("border-color").value,T=r.pstyle("border-opacity").value,N=this.borderColorBuffer.getView(l);Vf(_,T,N);var R=r.pstyle("border-position").value;if(R==="inside")w[0]=0,w[1]=-C;else if(R==="outside")w[0]=C,w[1]=0;else{var D=C/2;w[0]=D,w[1]=-D}}}var j=this.transformBuffer.getMatrixView(l);this.setTransformMatrix(r,j,a),this.simpleCount++,this.instanceCount++,this.instanceCount>=this.maxInstances&&this.endBatch()}}},{key:"_getVertTypeForShape",value:function(r,n){var i=r.pstyle(n).value;switch(i){case"rectangle":return vp;case"ellipse":return Zm;case"roundrectangle":case"round-rectangle":return dy;case"bottom-round-rectangle":return Km;default:return}}},{key:"_getCornerRadius",value:function(r,n,i){var a=i.w,s=i.h;if(r.pstyle(n).value==="auto")return Yd(a,s);var o=r.pstyle(n).pfValue,l=a/2,u=s/2;return Math.min(o,u,l)}},{key:"drawEdgeArrow",value:function(r,n,i){if(r.visible()){var a=r._private.rscratch,s,o,l;if(i==="source"?(s=a.arrowStartX,o=a.arrowStartY,l=a.srcArrowAngle):(s=a.arrowEndX,o=a.arrowEndY,l=a.tgtArrowAngle),!(isNaN(s)||s==null||isNaN(o)||o==null||isNaN(l)||l==null)){var u=r.pstyle(i+"-arrow-shape").value;if(u!=="none"){var c=r.pstyle(i+"-arrow-color").value,f=r.pstyle("opacity").value,p=r.pstyle("line-opacity").value,g=f*p,y=r.pstyle("width").pfValue,S=r.pstyle("arrow-scale").value,w=this.r.getArrowWidth(y,S),C=this.instanceCount,_=this.transformBuffer.getMatrixView(C);n5(_),Ky(_,_,[s,o]),rk(_,_,[w,w]),i5(_,_,l),this.vertTypeBuffer.getView(C)[0]=w2;var T=this.indexBuffer.getView(C);gp(n,T);var N=this.colorBuffer.getView(C);Vf(c,g,N),this.instanceCount++,this.instanceCount>=this.maxInstances&&this.endBatch()}}}}},{key:"drawEdgeLine",value:function(r,n){if(r.visible()){var i=this._getEdgePoints(r);if(i){var a=r.pstyle("opacity").value,s=r.pstyle("line-opacity").value,o=r.pstyle("width").pfValue,l=r.pstyle("line-color").value,u=a*s;if(i.length/2+this.instanceCount>this.maxInstances&&this.endBatch(),i.length==4){var c=this.instanceCount;this.vertTypeBuffer.getView(c)[0]=a5;var f=this.indexBuffer.getView(c);gp(n,f);var p=this.colorBuffer.getView(c);Vf(l,u,p);var g=this.lineWidthBuffer.getView(c);g[0]=o;var y=this.pointAPointBBuffer.getView(c);y[0]=i[0],y[1]=i[1],y[2]=i[2],y[3]=i[3],this.instanceCount++,this.instanceCount>=this.maxInstances&&this.endBatch()}else for(var S=0;S<i.length-2;S+=2){var w=this.instanceCount;this.vertTypeBuffer.getView(w)[0]=s5;var C=this.indexBuffer.getView(w);gp(n,C);var _=this.colorBuffer.getView(w);Vf(l,u,_);var T=this.lineWidthBuffer.getView(w);T[0]=o;var N=i[S-2],R=i[S-1],D=i[S],j=i[S+1],O=i[S+2],F=i[S+3],z=i[S+4],G=i[S+5];S==0&&(N=2*D-O+.001,R=2*j-F+.001),S==i.length-4&&(z=2*O-D+.001,G=2*F-j+.001);var Z=this.pointAPointBBuffer.getView(w);Z[0]=N,Z[1]=R,Z[2]=D,Z[3]=j;var I=this.pointCPointDBuffer.getView(w);I[0]=O,I[1]=F,I[2]=z,I[3]=G,this.instanceCount++,this.instanceCount>=this.maxInstances&&this.endBatch()}}}}},{key:"_isValidEdge",value:function(r){var n=r._private.rscratch;return!(n.badLine||n.allpts==null||isNaN(n.allpts[0]))}},{key:"_getEdgePoints",value:function(r){var n=r._private.rscratch;if(this._isValidEdge(r)){var i=n.allpts;if(i.length==4)return i;var a=this._getNumSegments(r);return this._getCurveSegmentPoints(i,a)}}},{key:"_getNumSegments",value:function(r){var n=15;return Math.min(Math.max(n,5),this.maxInstances)}},{key:"_getCurveSegmentPoints",value:function(r,n){if(r.length==4)return r;for(var i=Array((n+1)*2),a=0;a<=n;a++)if(a==0)i[0]=r[0],i[1]=r[1];else if(a==n)i[a*2]=r[r.length-2],i[a*2+1]=r[r.length-1];else{var s=a/n;this._setCurvePoint(r,s,i,a*2)}return i}},{key:"_setCurvePoint",value:function(r,n,i,a){if(r.length<=2)i[a]=r[0],i[a+1]=r[1];else{for(var s=Array(r.length-2),o=0;o<s.length;o+=2){var l=(1-n)*r[o]+n*r[o+2],u=(1-n)*r[o+1]+n*r[o+3];s[o]=l,s[o+1]=u}return this._setCurvePoint(s,n,i,a)}}},{key:"endBatch",value:function(){var r=this.gl,n=this.vao,i=this.vertexCount,a=this.instanceCount;if(a!==0){var s=this.renderTarget.picking?this.pickingProgram:this.program;r.useProgram(s),r.bindVertexArray(n);var o=Ys(this.buffers),l;try{for(o.s();!(l=o.n()).done;){var u=l.value;u.bufferSubData(a)}}catch(y){o.e(y)}finally{o.f()}for(var c=this.batchManager.getAtlases(),f=0;f<c.length;f++)c[f].bufferIfNeeded(r);for(var p=0;p<c.length;p++)r.activeTexture(r.TEXTURE0+p),r.bindTexture(r.TEXTURE_2D,c[p].texture),r.uniform1i(s.uTextures[p],p);r.uniform1f(s.uZoom,wU(this.r)),r.uniformMatrix3fv(s.uPanZoomMatrix,!1,this.panZoomMatrix),r.uniform1i(s.uAtlasSize,this.batchManager.getAtlasSize());var g=Vf(this.bgColor,1);r.uniform4fv(s.uBGColor,g),r.drawArraysInstanced(r.TRIANGLES,0,i,a),r.bindVertexArray(null),r.bindTexture(r.TEXTURE_2D,null),this.debug&&this.batchDebugInfo.push({count:a,atlasCount:c.length}),this.startBatch()}}},{key:"getDebugInfo",value:function(){var r=this.atlasManager.getDebugInfo(),n=r.reduce(function(s,o){return s+o.atlasCount},0),i=this.batchDebugInfo,a=i.reduce(function(s,o){return s+o.count},0);return{atlasInfo:r,totalAtlases:n,wrappedCount:this.wrappedCount,simpleCount:this.simpleCount,batchCount:i.length,batchInfo:i,totalInstances:a}}}])})(),mL={};mL.initWebgl=function(t,e){var r=this,n=r.data.contexts[r.WEBGL];t.bgColor=VU(r),t.webglTexSize=Math.min(t.webglTexSize,n.getParameter(n.MAX_TEXTURE_SIZE)),t.webglTexRows=Math.min(t.webglTexRows,54),t.webglTexRowsNodes=Math.min(t.webglTexRowsNodes,54),t.webglBatchSize=Math.min(t.webglBatchSize,16384),t.webglTexPerBatch=Math.min(t.webglTexPerBatch,n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS)),r.webglDebug=t.webglDebug,r.webglDebugShowAtlases=t.webglDebugShowAtlases,r.pickingFrameBuffer=MU(n),r.pickingFrameBuffer.needsDraw=!0,r.drawing=new GU(r,n,t);var i=function(f){return function(p){return r.getTextAngle(p,f)}},a=function(f){return function(p){var g=p.pstyle(f);return g&&g.value}},s=function(f){return function(p){return p.pstyle("".concat(f,"-opacity")).value>0}},o=function(f){var p=f.pstyle("text-events").strValue==="yes";return p?bx.USE_BB:bx.IGNORE},l=function(f){var p=f.position(),g=p.x,y=p.y,S=f.outerWidth(),w=f.outerHeight();return{w:S,h:w,x1:g-S/2,y1:y-w/2}};r.drawing.addAtlasCollection("node",{texRows:t.webglTexRowsNodes}),r.drawing.addAtlasCollection("label",{texRows:t.webglTexRows}),r.drawing.addTextureAtlasRenderType("node-body",{collection:"node",getKey:e.getStyleKey,getBoundingBox:e.getElementBox,drawElement:e.drawElement}),r.drawing.addSimpleShapeRenderType("node-body",{getBoundingBox:l,isSimple:kU,shapeProps:{shape:"shape",color:"background-color",opacity:"background-opacity",radius:"corner-radius",border:!0}}),r.drawing.addSimpleShapeRenderType("node-overlay",{getBoundingBox:l,isVisible:s("overlay"),shapeProps:{shape:"overlay-shape",color:"overlay-color",opacity:"overlay-opacity",padding:"overlay-padding",radius:"overlay-corner-radius"}}),r.drawing.addSimpleShapeRenderType("node-underlay",{getBoundingBox:l,isVisible:s("underlay"),shapeProps:{shape:"underlay-shape",color:"underlay-color",opacity:"underlay-opacity",padding:"underlay-padding",radius:"underlay-corner-radius"}}),r.drawing.addTextureAtlasRenderType("label",{collection:"label",getTexPickingMode:o,getKey:S2(e.getLabelKey,null),getBoundingBox:k2(e.getLabelBox,null),drawClipped:!0,drawElement:e.drawLabel,getRotation:i(null),getRotationPoint:e.getLabelRotationPoint,getRotationOffset:e.getLabelRotationOffset,isVisible:a("label")}),r.drawing.addTextureAtlasRenderType("edge-source-label",{collection:"label",getTexPickingMode:o,getKey:S2(e.getSourceLabelKey,"source"),getBoundingBox:k2(e.getSourceLabelBox,"source"),drawClipped:!0,drawElement:e.drawSourceLabel,getRotation:i("source"),getRotationPoint:e.getSourceLabelRotationPoint,getRotationOffset:e.getSourceLabelRotationOffset,isVisible:a("source-label")}),r.drawing.addTextureAtlasRenderType("edge-target-label",{collection:"label",getTexPickingMode:o,getKey:S2(e.getTargetLabelKey,"target"),getBoundingBox:k2(e.getTargetLabelBox,"target"),drawClipped:!0,drawElement:e.drawTargetLabel,getRotation:i("target"),getRotationPoint:e.getTargetLabelRotationPoint,getRotationOffset:e.getTargetLabelRotationOffset,isVisible:a("target-label")});var u=t0(function(){console.log("garbage collect flag set"),r.data.gc=!0},1e4);r.onUpdateEleCalcs(function(c,f){var p=!1;f&&f.length>0&&(p|=r.drawing.invalidate(f)),p&&u()}),HU(r)};function VU(t){var e=t.cy.container(),r=e&&e.style&&e.style.backgroundColor||"white";return VM(r)}function gL(t,e){var r=t._private.rscratch;return $s(r,"labelWrapCachedLines",e)||[]}var S2=function(e,r){return function(n){var i=e(n),a=gL(n,r);return a.length>1?a.map(function(s,o){return"".concat(i,"_").concat(o)}):i}},k2=function(e,r){return function(n,i){var a=e(n);if(typeof i=="string"){var s=i.indexOf("_");if(s>0){var o=Number(i.substring(s+1)),l=gL(n,r),u=a.h/l.length,c=u*o,f=a.y1+c;return{x1:a.x1,w:a.w,y1:f,h:u,yOffset:c}}}return a}};function HU(t){{var e=t.render;t.render=function(a){a=a||{};var s=t.cy;t.webgl&&(s.zoom()>lL?(WU(t),e.call(t,a)):(qU(t),yL(t,a,nv.SCREEN)))}}{var r=t.matchCanvasSize;t.matchCanvasSize=function(a){r.call(t,a),t.pickingFrameBuffer.setFramebufferAttachmentSizes(t.canvasWidth,t.canvasHeight),t.pickingFrameBuffer.needsDraw=!0}}t.findNearestElements=function(a,s,o,l){return QU(t,a,s)};{var n=t.invalidateCachedZSortedEles;t.invalidateCachedZSortedEles=function(){n.call(t),t.pickingFrameBuffer.needsDraw=!0}}{var i=t.notify;t.notify=function(a,s){i.call(t,a,s),a==="viewport"||a==="bounds"?t.pickingFrameBuffer.needsDraw=!0:a==="background"&&t.drawing.invalidate(s,{type:"node-body"})}}}function WU(t){var e=t.data.contexts[t.WEBGL];e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT)}function qU(t){var e=function(n){n.save(),n.setTransform(1,0,0,1,0,0),n.clearRect(0,0,t.canvasWidth,t.canvasHeight),n.restore()};e(t.data.contexts[t.NODE]),e(t.data.contexts[t.DRAG])}function $U(t){var e=t.canvasWidth,r=t.canvasHeight,n=E_(t),i=n.pan,a=n.zoom,s=x2();Ky(s,s,[i.x,i.y]),rk(s,s,[a,a]);var o=x2();LU(o,e,r);var l=x2();return AU(l,o,s),l}function vL(t,e){var r=t.canvasWidth,n=t.canvasHeight,i=E_(t),a=i.pan,s=i.zoom;e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,r,n),e.translate(a.x,a.y),e.scale(s,s)}function KU(t,e){t.drawSelectionRectangle(e,function(r){return vL(t,r)})}function ZU(t){var e=t.data.contexts[t.NODE];e.save(),vL(t,e),e.strokeStyle="rgba(0, 0, 0, 0.3)",e.beginPath(),e.moveTo(-1e3,0),e.lineTo(1e3,0),e.stroke(),e.beginPath(),e.moveTo(0,-1e3),e.lineTo(0,1e3),e.stroke(),e.restore()}function YU(t){var e=function(i,a,s){for(var o=i.atlasManager.getAtlasCollection(a),l=t.data.contexts[t.NODE],u=o.atlases,c=0;c<u.length;c++){var f=u[c],p=f.canvas;if(p){var g=p.width,y=p.height,S=g*c,w=p.height*s,C=.4;l.save(),l.scale(C,C),l.drawImage(p,S,w),l.strokeStyle="black",l.rect(S,w,g,y),l.stroke(),l.restore()}}},r=0;e(t.drawing,"node",r++),e(t.drawing,"label",r++)}function XU(t,e,r,n,i){var a,s,o,l,u=E_(t),c=u.pan,f=u.zoom;{var p=SU(t,c,f,e,r),g=Di(p,2),y=g[0],S=g[1],w=6;a=y-w/2,s=S-w/2,o=w,l=w}if(o===0||l===0)return[];var C=t.data.contexts[t.WEBGL];C.bindFramebuffer(C.FRAMEBUFFER,t.pickingFrameBuffer),t.pickingFrameBuffer.needsDraw&&(C.viewport(0,0,C.canvas.width,C.canvas.height),yL(t,null,nv.PICKING),t.pickingFrameBuffer.needsDraw=!1);var _=o*l,T=new Uint8Array(_*4);C.readPixels(a,s,o,l,C.RGBA,C.UNSIGNED_BYTE,T),C.bindFramebuffer(C.FRAMEBUFFER,null);for(var N=new Set,R=0;R<_;R++){var D=T.slice(R*4,R*4+4),j=CU(D)-1;j>=0&&N.add(j)}return N}function QU(t,e,r){var n=XU(t,e,r),i=t.getCachedZSortedEles(),a,s,o=Ys(n),l;try{for(o.s();!(l=o.n()).done;){var u=l.value,c=i[u];if(!a&&c.isNode()&&(a=c),!s&&c.isEdge()&&(s=c),a&&s)break}}catch(f){o.e(f)}finally{o.f()}return[a,s].filter(Boolean)}function _2(t,e,r){var n=t.drawing;e+=1,r.isNode()?(n.drawNode(r,e,"node-underlay"),n.drawNode(r,e,"node-body"),n.drawTexture(r,e,"label"),n.drawNode(r,e,"node-overlay")):(n.drawEdgeLine(r,e),n.drawEdgeArrow(r,e,"source"),n.drawEdgeArrow(r,e,"target"),n.drawTexture(r,e,"label"),n.drawTexture(r,e,"edge-source-label"),n.drawTexture(r,e,"edge-target-label"))}function yL(t,e,r){var n;t.webglDebug&&(n=performance.now());var i=t.drawing,a=0;if(r.screen&&t.data.canvasNeedsRedraw[t.SELECT_BOX]&&KU(t,e),t.data.canvasNeedsRedraw[t.NODE]||r.picking){var s=t.data.contexts[t.WEBGL];r.screen?(s.clearColor(0,0,0,0),s.enable(s.BLEND),s.blendFunc(s.ONE,s.ONE_MINUS_SRC_ALPHA)):s.disable(s.BLEND),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT),s.viewport(0,0,s.canvas.width,s.canvas.height);var o=$U(t),l=t.getCachedZSortedEles();if(a=l.length,i.startFrame(o,r),r.screen){for(var u=0;u<l.nondrag.length;u++)_2(t,u,l.nondrag[u]);for(var c=0;c<l.drag.length;c++)_2(t,c,l.drag[c])}else if(r.picking)for(var f=0;f<l.length;f++)_2(t,f,l[f]);i.endFrame(),r.screen&&t.webglDebugShowAtlases&&(ZU(t),YU(t)),t.data.canvasNeedsRedraw[t.NODE]=!1,t.data.canvasNeedsRedraw[t.DRAG]=!1}if(t.webglDebug){var p=performance.now(),g=!1,y=Math.ceil(p-n),S=i.getDebugInfo(),w=["".concat(a," elements"),"".concat(S.totalInstances," instances"),"".concat(S.batchCount," batches"),"".concat(S.totalAtlases," atlases"),"".concat(S.wrappedCount," wrapped textures"),"".concat(S.simpleCount," simple shapes")].join(", ");if(g)console.log("WebGL (".concat(r.name,") - time ").concat(y,"ms, ").concat(w));else{console.log("WebGL (".concat(r.name,") - frame time ").concat(y,"ms")),console.log("Totals:"),console.log("  ".concat(w)),console.log("Texture Atlases Used:");var C=S.atlasInfo,_=Ys(C),T;try{for(_.s();!(T=_.n()).done;){var N=T.value;console.log("  ".concat(N.type,": ").concat(N.keyCount," keys, ").concat(N.atlasCount," atlases"))}}catch(R){_.e(R)}finally{_.f()}console.log("")}}t.data.gc&&(console.log("Garbage Collect!"),t.data.gc=!1,i.gc())}var cf={};cf.drawPolygonPath=function(t,e,r,n,i,a){var s=n/2,o=i/2;t.beginPath&&t.beginPath(),t.moveTo(e+s*a[0],r+o*a[1]);for(var l=1;l<a.length/2;l++)t.lineTo(e+s*a[l*2],r+o*a[l*2+1]);t.closePath()};cf.drawRoundPolygonPath=function(t,e,r,n,i,a,s){s.forEach(function(o){return JA(t,o)}),t.closePath()};cf.drawRoundRectanglePath=function(t,e,r,n,i,a){var s=n/2,o=i/2,l=a==="auto"?Yd(n,i):Math.min(a,o,s);t.beginPath&&t.beginPath(),t.moveTo(e,r-o),t.arcTo(e+s,r-o,e+s,r,l),t.arcTo(e+s,r+o,e,r+o,l),t.arcTo(e-s,r+o,e-s,r,l),t.arcTo(e-s,r-o,e,r-o,l),t.lineTo(e,r-o),t.closePath()};cf.drawBottomRoundRectanglePath=function(t,e,r,n,i,a){var s=n/2,o=i/2,l=a==="auto"?Yd(n,i):a;t.beginPath&&t.beginPath(),t.moveTo(e,r-o),t.lineTo(e+s,r-o),t.lineTo(e+s,r),t.arcTo(e+s,r+o,e,r+o,l),t.arcTo(e-s,r+o,e-s,r,l),t.lineTo(e-s,r-o),t.lineTo(e,r-o),t.closePath()};cf.drawCutRectanglePath=function(t,e,r,n,i,a,s){var o=n/2,l=i/2,u=s==="auto"?f_():s;t.beginPath&&t.beginPath(),t.moveTo(e-o+u,r-l),t.lineTo(e+o-u,r-l),t.lineTo(e+o,r-l+u),t.lineTo(e+o,r+l-u),t.lineTo(e+o-u,r+l),t.lineTo(e-o+u,r+l),t.lineTo(e-o,r+l-u),t.lineTo(e-o,r-l+u),t.closePath()};cf.drawBarrelPath=function(t,e,r,n,i){var a=n/2,s=i/2,o=e-a,l=e+a,u=r-s,c=r+s,f=GS(n,i),p=f.widthOffset,g=f.heightOffset,y=f.ctrlPtOffsetPct*p;t.beginPath&&t.beginPath(),t.moveTo(o,u+g),t.lineTo(o,c-g),t.quadraticCurveTo(o+y,c,o+p,c),t.lineTo(l-p,c),t.quadraticCurveTo(l-y,c,l,c-g),t.lineTo(l,u+g),t.quadraticCurveTo(l-y,u,l-p,u),t.lineTo(o+p,u),t.quadraticCurveTo(o+y,u,o,u+g),t.closePath()};var o5=Math.sin(0),l5=Math.cos(0),nk={},ik={},xL=Math.PI/40;for(var yp=0*Math.PI;yp<2*Math.PI;yp+=xL)nk[yp]=Math.sin(yp),ik[yp]=Math.cos(yp);cf.drawEllipsePath=function(t,e,r,n,i){if(t.beginPath&&t.beginPath(),t.ellipse)t.ellipse(e,r,n/2,i/2,0,0,2*Math.PI);else for(var a,s,o=n/2,l=i/2,u=0*Math.PI;u<2*Math.PI;u+=xL)a=e-o*nk[u]*o5+o*ik[u]*l5,s=r+l*ik[u]*o5+l*nk[u]*l5,u===0?t.moveTo(a,s):t.lineTo(a,s);t.closePath()};var o0={};o0.createBuffer=function(t,e){var r=document.createElement("canvas");return r.width=t,r.height=e,[r,r.getContext("2d")]};o0.bufferCanvasImage=function(t){var e=this.cy,r=e.mutableElements(),n=r.boundingBox(),i=this.findContainerClientCoords(),a=t.full?Math.ceil(n.w):i[2],s=t.full?Math.ceil(n.h):i[3],o=_t(t.maxWidth)||_t(t.maxHeight),l=this.getPixelRatio(),u=1;if(t.scale!==void 0)a*=t.scale,s*=t.scale,u=t.scale;else if(o){var c=1/0,f=1/0;_t(t.maxWidth)&&(c=u*t.maxWidth/a),_t(t.maxHeight)&&(f=u*t.maxHeight/s),u=Math.min(c,f),a*=u,s*=u}o||(a*=l,s*=l,u*=l);var p=document.createElement("canvas");p.width=a,p.height=s,p.style.width=a+"px",p.style.height=s+"px";var g=p.getContext("2d");if(a>0&&s>0){g.clearRect(0,0,a,s),g.globalCompositeOperation="source-over";var y=this.getCachedZSortedEles();if(t.full)g.translate(-n.x1*u,-n.y1*u),g.scale(u,u),this.drawElements(g,y),g.scale(1/u,1/u),g.translate(n.x1*u,n.y1*u);else{var S=e.pan(),w={x:S.x*u,y:S.y*u};u*=e.zoom(),g.translate(w.x,w.y),g.scale(u,u),this.drawElements(g,y),g.scale(1/u,1/u),g.translate(-w.x,-w.y)}t.bg&&(g.globalCompositeOperation="destination-over",g.fillStyle=t.bg,g.rect(0,0,a,s),g.fill())}return p};function JU(t,e){for(var r=atob(t),n=new ArrayBuffer(r.length),i=new Uint8Array(n),a=0;a<r.length;a++)i[a]=r.charCodeAt(a);return new Blob([n],{type:e})}function u5(t){var e=t.indexOf(",");return t.substr(e+1)}function bL(t,e,r){var n=function(){return e.toDataURL(r,t.quality)};switch(t.output){case"blob-promise":return new um(function(i,a){try{e.toBlob(function(s){s!=null?i(s):a(new Error("`canvas.toBlob()` sent a null value in its callback"))},r,t.quality)}catch(s){a(s)}});case"blob":return JU(u5(n()),r);case"base64":return u5(n());default:return n()}}o0.png=function(t){return bL(t,this.bufferCanvasImage(t),"image/png")};o0.jpg=function(t){return bL(t,this.bufferCanvasImage(t),"image/jpeg")};var wL={};wL.nodeShapeImpl=function(t,e,r,n,i,a,s,o){switch(t){case"ellipse":return this.drawEllipsePath(e,r,n,i,a);case"polygon":return this.drawPolygonPath(e,r,n,i,a,s);case"round-polygon":return this.drawRoundPolygonPath(e,r,n,i,a,s,o);case"roundrectangle":case"round-rectangle":return this.drawRoundRectanglePath(e,r,n,i,a,o);case"cutrectangle":case"cut-rectangle":return this.drawCutRectanglePath(e,r,n,i,a,s,o);case"bottomroundrectangle":case"bottom-round-rectangle":return this.drawBottomRoundRectanglePath(e,r,n,i,a,o);case"barrel":return this.drawBarrelPath(e,r,n,i,a)}};var eG=SL,Tr=SL.prototype;Tr.CANVAS_LAYERS=3;Tr.SELECT_BOX=0;Tr.DRAG=1;Tr.NODE=2;Tr.WEBGL=3;Tr.CANVAS_TYPES=["2d","2d","2d","webgl2"];Tr.BUFFER_COUNT=3;Tr.TEXTURE_BUFFER=0;Tr.MOTIONBLUR_BUFFER_NODE=1;Tr.MOTIONBLUR_BUFFER_DRAG=2;function SL(t){var e=this,r=e.cy.window(),n=r.document;t.webgl&&(Tr.CANVAS_LAYERS=e.CANVAS_LAYERS=4,console.log("webgl rendering enabled")),e.data={canvases:new Array(Tr.CANVAS_LAYERS),contexts:new Array(Tr.CANVAS_LAYERS),canvasNeedsRedraw:new Array(Tr.CANVAS_LAYERS),bufferCanvases:new Array(Tr.BUFFER_COUNT),bufferContexts:new Array(Tr.CANVAS_LAYERS)};var i="-webkit-tap-highlight-color",a="rgba(0,0,0,0)";e.data.canvasContainer=n.createElement("div");var s=e.data.canvasContainer.style;e.data.canvasContainer.style[i]=a,s.position="relative",s.zIndex="0",s.overflow="hidden";var o=t.cy.container();o.appendChild(e.data.canvasContainer),o.style[i]=a;var l={"-webkit-user-select":"none","-moz-user-select":"-moz-none","user-select":"none","-webkit-tap-highlight-color":"rgba(0,0,0,0)","outline-style":"none"};Kj()&&(l["-ms-touch-action"]="none",l["touch-action"]="none");for(var u=0;u<Tr.CANVAS_LAYERS;u++){var c=e.data.canvases[u]=n.createElement("canvas"),f=Tr.CANVAS_TYPES[u];e.data.contexts[u]=c.getContext(f),e.data.contexts[u]||Zn("Could not create canvas of type "+f),Object.keys(l).forEach(function(ye){c.style[ye]=l[ye]}),c.style.position="absolute",c.setAttribute("data-id","layer"+u),c.style.zIndex=String(Tr.CANVAS_LAYERS-u),e.data.canvasContainer.appendChild(c),e.data.canvasNeedsRedraw[u]=!1}e.data.topCanvas=e.data.canvases[0],e.data.canvases[Tr.NODE].setAttribute("data-id","layer"+Tr.NODE+"-node"),e.data.canvases[Tr.SELECT_BOX].setAttribute("data-id","layer"+Tr.SELECT_BOX+"-selectbox"),e.data.canvases[Tr.DRAG].setAttribute("data-id","layer"+Tr.DRAG+"-drag"),e.data.canvases[Tr.WEBGL]&&e.data.canvases[Tr.WEBGL].setAttribute("data-id","layer"+Tr.WEBGL+"-webgl");for(var u=0;u<Tr.BUFFER_COUNT;u++)e.data.bufferCanvases[u]=n.createElement("canvas"),e.data.bufferContexts[u]=e.data.bufferCanvases[u].getContext("2d"),e.data.bufferCanvases[u].style.position="absolute",e.data.bufferCanvases[u].setAttribute("data-id","buffer"+u),e.data.bufferCanvases[u].style.zIndex=String(-u-1),e.data.bufferCanvases[u].style.visibility="hidden";e.pathsEnabled=!0;var p=Es(),g=function(ve){return{x:(ve.x1+ve.x2)/2,y:(ve.y1+ve.y2)/2}},y=function(ve){return{x:-ve.w/2,y:-ve.h/2}},S=function(ve){var ue=ve[0]._private,xe=ue.oldBackgroundTimestamp===ue.backgroundTimestamp;return!xe},w=function(ve){return ve[0]._private.nodeKey},C=function(ve){return ve[0]._private.labelStyleKey},_=function(ve){return ve[0]._private.sourceLabelStyleKey},T=function(ve){return ve[0]._private.targetLabelStyleKey},N=function(ve,ue,xe,Se,Ae){return e.drawElement(ve,ue,xe,!1,!1,Ae)},R=function(ve,ue,xe,Se,Ae){return e.drawElementText(ve,ue,xe,Se,"main",Ae)},D=function(ve,ue,xe,Se,Ae){return e.drawElementText(ve,ue,xe,Se,"source",Ae)},j=function(ve,ue,xe,Se,Ae){return e.drawElementText(ve,ue,xe,Se,"target",Ae)},O=function(ve){return ve.boundingBox(),ve[0]._private.bodyBounds},F=function(ve){return ve.boundingBox(),ve[0]._private.labelBounds.main||p},z=function(ve){return ve.boundingBox(),ve[0]._private.labelBounds.source||p},G=function(ve){return ve.boundingBox(),ve[0]._private.labelBounds.target||p},Z=function(ve,ue){return ue},I=function(ve){return g(O(ve))},W=function(ve,ue,xe){var Se=ve?ve+"-":"";return{x:ue.x+xe.pstyle(Se+"text-margin-x").pfValue,y:ue.y+xe.pstyle(Se+"text-margin-y").pfValue}},U=function(ve,ue,xe){var Se=ve[0]._private.rscratch;return{x:Se[ue],y:Se[xe]}},K=function(ve){return W("",U(ve,"labelX","labelY"),ve)},$=function(ve){return W("source",U(ve,"sourceLabelX","sourceLabelY"),ve)},Q=function(ve){return W("target",U(ve,"targetLabelX","targetLabelY"),ve)},ie=function(ve){return y(O(ve))},te=function(ve){return y(z(ve))},X=function(ve){return y(G(ve))},re=function(ve){var ue=F(ve),xe=y(F(ve));if(ve.isNode()){switch(ve.pstyle("text-halign").value){case"left":xe.x=-ue.w-(ue.leftPad||0);break;case"right":xe.x=-(ue.rightPad||0);break}switch(ve.pstyle("text-valign").value){case"top":xe.y=-ue.h-(ue.topPad||0);break;case"bottom":xe.y=-(ue.botPad||0);break}}return xe},fe=e.data.eleTxrCache=new Kg(e,{getKey:w,doesEleInvalidateKey:S,drawElement:N,getBoundingBox:O,getRotationPoint:I,getRotationOffset:ie,allowEdgeTxrCaching:!1,allowParentTxrCaching:!1}),oe=e.data.lblTxrCache=new Kg(e,{getKey:C,drawElement:R,getBoundingBox:F,getRotationPoint:K,getRotationOffset:re,isVisible:Z}),se=e.data.slbTxrCache=new Kg(e,{getKey:_,drawElement:D,getBoundingBox:z,getRotationPoint:$,getRotationOffset:te,isVisible:Z}),he=e.data.tlbTxrCache=new Kg(e,{getKey:T,drawElement:j,getBoundingBox:G,getRotationPoint:Q,getRotationOffset:X,isVisible:Z}),ae=e.data.lyrTxrCache=new uL(e);e.onUpdateEleCalcs(function(ve,ue){fe.invalidateElements(ue),oe.invalidateElements(ue),se.invalidateElements(ue),he.invalidateElements(ue),ae.invalidateElements(ue);for(var xe=0;xe<ue.length;xe++){var Se=ue[xe]._private;Se.oldBackgroundTimestamp=Se.backgroundTimestamp}});var pe=function(ve){for(var ue=0;ue<ve.length;ue++)ae.enqueueElementRefinement(ve[ue].ele)};fe.onDequeue(pe),oe.onDequeue(pe),se.onDequeue(pe),he.onDequeue(pe),t.webgl&&e.initWebgl(t,{getStyleKey:w,getLabelKey:C,getSourceLabelKey:_,getTargetLabelKey:T,drawElement:N,drawLabel:R,drawSourceLabel:D,drawTargetLabel:j,getElementBox:O,getLabelBox:F,getSourceLabelBox:z,getTargetLabelBox:G,getElementRotationPoint:I,getElementRotationOffset:ie,getLabelRotationPoint:K,getSourceLabelRotationPoint:$,getTargetLabelRotationPoint:Q,getLabelRotationOffset:re,getSourceLabelRotationOffset:te,getTargetLabelRotationOffset:X})}Tr.redrawHint=function(t,e){var r=this;switch(t){case"eles":r.data.canvasNeedsRedraw[Tr.NODE]=e;break;case"drag":r.data.canvasNeedsRedraw[Tr.DRAG]=e;break;case"select":r.data.canvasNeedsRedraw[Tr.SELECT_BOX]=e;break;case"gc":r.data.gc=!0;break}};var tG=typeof Path2D<"u";Tr.path2dEnabled=function(t){if(t===void 0)return this.pathsEnabled;this.pathsEnabled=!!t};Tr.usePaths=function(){return tG&&this.pathsEnabled};Tr.setImgSmoothing=function(t,e){t.imageSmoothingEnabled!=null?t.imageSmoothingEnabled=e:(t.webkitImageSmoothingEnabled=e,t.mozImageSmoothingEnabled=e,t.msImageSmoothingEnabled=e)};Tr.getImgSmoothing=function(t){return t.imageSmoothingEnabled!=null?t.imageSmoothingEnabled:t.webkitImageSmoothingEnabled||t.mozImageSmoothingEnabled||t.msImageSmoothingEnabled};Tr.makeOffscreenCanvas=function(t,e){var r;if((typeof OffscreenCanvas>"u"?"undefined":qi(OffscreenCanvas))!=="undefined")r=new OffscreenCanvas(t,e);else{var n=this.cy.window(),i=n.document;r=i.createElement("canvas"),r.width=t,r.height=e}return r};[cL,Ru,kc,C_,Ph,uf,Ms,mL,cf,o0,wL].forEach(function(t){sr(Tr,t)});var rG=[{name:"null",impl:YA},{name:"base",impl:sL},{name:"canvas",impl:eG}],nG=[{type:"layout",extensions:Nz},{type:"renderer",extensions:rG}],kL={},_L={};function CL(t,e,r){var n=r,i=function(O){an("Can not register `"+e+"` for `"+t+"` since `"+O+"` already exists in the prototype and can not be overridden")};if(t==="core"){if(Pv.prototype[e])return i(e);Pv.prototype[e]=r}else if(t==="collection"){if(za.prototype[e])return i(e);za.prototype[e]=r}else if(t==="layout"){for(var a=function(O){this.options=O,r.call(this,O),Wr(this._private)||(this._private={}),this._private.cy=O.cy,this._private.listeners=[],this.createEmitter()},s=a.prototype=Object.create(r.prototype),o=[],l=0;l<o.length;l++){var u=o[l];s[u]=s[u]||function(){return this}}s.start&&!s.run?s.run=function(){return this.start(),this}:!s.start&&s.run&&(s.start=function(){return this.run(),this});var c=r.prototype.stop;s.stop=function(){var j=this.options;if(j&&j.animate){var O=this.animations;if(O)for(var F=0;F<O.length;F++)O[F].stop()}return c?c.call(this):this.emit("layoutstop"),this},s.destroy||(s.destroy=function(){return this}),s.cy=function(){return this._private.cy};var f=function(O){return O._private.cy},p={addEventFields:function(O,F){F.layout=O,F.cy=f(O),F.target=O},bubble:function(){return!0},parent:function(O){return f(O)}};sr(s,{createEmitter:function(){return this._private.emitter=new D1(p,this),this},emitter:function(){return this._private.emitter},on:function(O,F){return this.emitter().on(O,F),this},one:function(O,F){return this.emitter().one(O,F),this},once:function(O,F){return this.emitter().one(O,F),this},removeListener:function(O,F){return this.emitter().removeListener(O,F),this},removeAllListeners:function(){return this.emitter().removeAllListeners(),this},emit:function(O,F){return this.emitter().emit(O,F),this}}),nn.eventAliasesOn(s),n=a}else if(t==="renderer"&&e!=="null"&&e!=="base"){var g=EL("renderer","base"),y=g.prototype,S=r,w=r.prototype,C=function(){g.apply(this,arguments),S.apply(this,arguments)},_=C.prototype;for(var T in y){var N=y[T],R=w[T]!=null;if(R)return i(T);_[T]=N}for(var D in w)_[D]=w[D];y.clientFunctions.forEach(function(j){_[j]=_[j]||function(){Zn("Renderer does not implement `renderer."+j+"()` on its prototype")}}),n=C}else if(t==="__proto__"||t==="constructor"||t==="prototype")return Zn(t+" is an illegal type to be registered, possibly lead to prototype pollutions");return HM({map:kL,keys:[t,e],value:n})}function EL(t,e){return WM({map:kL,keys:[t,e]})}function iG(t,e,r,n,i){return HM({map:_L,keys:[t,e,r,n],value:i})}function aG(t,e,r,n){return WM({map:_L,keys:[t,e,r,n]})}var ak=function(){if(arguments.length===2)return EL.apply(null,arguments);if(arguments.length===3)return CL.apply(null,arguments);if(arguments.length===4)return aG.apply(null,arguments);if(arguments.length===5)return iG.apply(null,arguments);Zn("Invalid extension access syntax")};Pv.prototype.extension=ak;nG.forEach(function(t){t.extensions.forEach(function(e){CL(t.type,e.name,e.impl)})});var wx=function(){if(!(this instanceof wx))return new wx;this.length=0},yh=wx.prototype;yh.instanceString=function(){return"stylesheet"};yh.selector=function(t){var e=this.length++;return this[e]={selector:t,properties:[]},this};yh.css=function(t,e){var r=this.length-1;if(Yt(t))this[r].properties.push({name:t,value:e});else if(Wr(t))for(var n=t,i=Object.keys(n),a=0;a<i.length;a++){var s=i[a],o=n[s];if(o!=null){var l=ma.properties[s]||ma.properties[C1(s)];if(l!=null){var u=l.name,c=o;this[r].properties.push({name:u,value:c})}}}return this};yh.style=yh.css;yh.generateStyle=function(t){var e=new ma(t);return this.appendToStyle(e)};yh.appendToStyle=function(t){for(var e=0;e<this.length;e++){var r=this[e],n=r.selector,i=r.properties;t.selector(n);for(var a=0;a<i.length;a++){var s=i[a];t.css(s.name,s.value)}}return t};var sG="3.33.1",xh=function(e){if(e===void 0&&(e={}),Wr(e))return new Pv(e);if(Yt(e))return ak.apply(ak,arguments)};xh.use=function(t){var e=Array.prototype.slice.call(arguments,1);return e.unshift(xh),t.apply(null,e),this};xh.warnings=function(t){return QM(t)};xh.version=sG;xh.stylesheet=xh.Stylesheet=wx;const{string:fy,array:c5,object:hy,number:Ym,bool:mo,oneOfType:xp,any:py,func:Xm}=Mj,oG={id:fy,className:fy,style:xp([fy,hy]),elements:xp([c5,py]),stylesheet:xp([c5,py]),layout:xp([hy,py]),pan:xp([hy,py]),zoom:Ym,panningEnabled:mo,userPanningEnabled:mo,minZoom:Ym,maxZoom:Ym,zoomingEnabled:mo,userZoomingEnabled:mo,boxSelectionEnabled:mo,autoungrabify:mo,autolock:mo,autounselectify:mo,get:Xm,toJson:Xm,diff:Xm,forEach:Xm,cy:Xm,headless:mo,styleEnabled:mo,hideEdgesOnViewport:mo,textureOnViewport:mo,motionBlur:mo,motionBlurOpacity:Ym,wheelSensitivity:Ym,pixelRatio:xp([fy,hy])},TL=(t,e)=>{if(((a,s)=>a==null||s==null)(t,e)&&(t!=null||e!=null))return!0;if(t===e)return!1;if(typeof t!="object"||typeof e!="object")return t!==e;const r=Object.keys(t),n=Object.keys(e),i=a=>t[a]!==e[a];return r.length!==n.length||!(!r.some(i)&&!n.some(i))},Al=(t,e)=>t!=null?t[e]:null,lG={diff:TL,get:Al,toJson:t=>t,forEach:(t,e)=>t.forEach(e),elements:[{data:{id:"a",label:"Example node A"}},{data:{id:"b",label:"Example node B"}},{data:{id:"e",source:"a",target:"b"}}],stylesheet:[{selector:"node",style:{label:"data(label)"}}],zoom:1,pan:{x:0,y:0}},my=(t,e,r,n)=>r(Al(t,n),Al(e,n)),uG=(t,e,r,n,i,a,s)=>{t.batch(()=>{(n===TL||my(e,r,n,"elements"))&&hG(t,Al(e,"elements"),Al(r,"elements"),i,a,s,n),my(e,r,n,"stylesheet")&&fG(t,Al(e,"stylesheet"),Al(r,"stylesheet"),i),["zoom","minZoom","maxZoom","zoomingEnabled","userZoomingEnabled","pan","panningEnabled","userPanningEnabled","boxSelectionEnabled","autoungrabify","autolock","autounselectify"].forEach(o=>{my(e,r,n,o)&&cG(t,o,Al(e,o),Al(r,o),i)})}),my(e,r,n,"layout")&&dG(t,Al(e,"layout"),Al(r,"layout"),i)},cG=(t,e,r,n,i)=>{t[e](i(n))},dG=(t,e,r,n)=>{const i=n(r);i!=null&&t.layout(i).run()},fG=(t,e,r,n)=>{const i=t.style();i?.fromJson(n(r)).update()},hG=(t,e,r,n,i,a,s)=>{const o=[],l=t.collection(),u=[],c={},f={},p=g=>i(i(g,"data"),"id");a(r,g=>{const y=p(g);f[y]=g}),e!=null&&a(e,g=>{const y=p(g);c[y]=g,(S=>f[S]!=null)(y)||l.merge(t.getElementById(y))}),a(r,g=>{const y=p(g),S=(w=>c[w])(y);(w=>c[w]!=null)(y)?u.push({ele1:S,ele2:g}):o.push(n(g))}),l.length>0&&t.remove(l),o.length>0&&t.add(o),u.forEach(({ele1:g,ele2:y})=>pG(t,g,y,n,i,s))},pG=(t,e,r,n,i,a)=>{const s=i(i(r,"data"),"id"),o=t.getElementById(s),l={};["data","position","selected","selectable","locked","grabbable","classes"].forEach(c=>{const f=i(r,c);a(f,i(e,c))&&(l[c]=n(f))});const u=i(r,"scratch");a(u,i(e,"scratch"))&&o.scratch(n(u)),Object.keys(l).length>0&&o.json(l)};class mG extends Qt.Component{static get propTypes(){return oG}static get defaultProps(){return lG}static normalizeElements(e){if(e.length!=null)return e;{let{nodes:r,edges:n}=e;return r==null&&(r=[]),n==null&&(n=[]),r.concat(n)}}constructor(e){super(e),this.displayName="CytoscapeComponent",this.containerRef=Qt.createRef()}componentDidMount(){const e=this.containerRef.current,{global:r,headless:n,styleEnabled:i,hideEdgesOnViewport:a,textureOnViewport:s,motionBlur:o,motionBlurOpacity:l,wheelSensitivity:u,pixelRatio:c}=this.props,f=this._cy=new xh({container:e,headless:n,styleEnabled:i,hideEdgesOnViewport:a,textureOnViewport:s,motionBlur:o,motionBlurOpacity:l,wheelSensitivity:u,pixelRatio:c});r&&(window[r]=f),this.updateCytoscape(null,this.props)}updateCytoscape(e,r){const n=this._cy,{diff:i,toJson:a,get:s,forEach:o}=r;uG(n,e,r,i,a,s,o),r.cy!=null&&r.cy(n)}componentDidUpdate(e){this.updateCytoscape(e,this.props)}componentWillUnmount(){this._cy.destroy()}render(){const{id:e,className:r,style:n}=this.props;return Qt.createElement("div",{ref:this.containerRef,id:e,className:r,style:n})}}const gG=[{value:"All",label:"Todo"},{value:"Individual",label:"Personaje"},{value:"Group",label:"Grupo/Faccin"},{value:"Location",label:"Lugar"},{value:"Item",label:"Objeto"},{value:"Event",label:"Evento"},{value:"Timeline",label:"Lnea de Tiempo"},{value:"Map",label:"Mapa"},{value:"Structure",label:"Construccin"},{value:"Creature",label:"Criatura"},{value:"Plant",label:"Flora"}],vG=({entityId:t,entityType:e})=>{console.log(">>> RELATIONSHIP MANAGER V2 LOADED");const[r,n]=ne.useState([]),[i,a]=ne.useState(!1),[s,o]=ne.useState(!1),[l,u]=ne.useState("All"),[c,f]=ne.useState([]),[p,g]=ne.useState(""),[y,S]=ne.useState(""),[w,C]=ne.useState(""),[_,T]=ne.useState(""),[N,R]=ne.useState(!1);ne.useEffect(()=>{t&&(console.log(`[RelationshipManager] Loading for ID: ${t} Type: ${e}`),D())},[t,e]),ne.useEffect(()=>{s&&l&&j(l)},[s,l]);const D=async()=>{a(!0);try{const G=await $e.get("/bd/relacion");console.log(`[RelationshipManager] Total relationships in DB: ${G.length}`);const Z=G.filter(W=>{const U=W.nodoOrigenId===parseInt(t),K=W.nodoDestinoId===parseInt(t),$=X=>{if(!X)return"";const re=X.toLowerCase();return re==="generic"||re==="genericentity"?"generic":re},Q=$(e),ie=$(W.tipoOrigen),te=$(W.tipoDestino);return(U||K)&&(console.log("[RelationshipManager] Potential match:",W),console.log(`   SourceMatch: ${U} (Type: ${ie} vs ${Q})`),console.log(`   TargetMatch: ${K} (Type: ${te} vs ${Q})`)),U&&(ie===Q||ie==="generic")||K&&(te===Q||te==="generic")});console.log(`[RelationshipManager] Relevant relationships found: ${Z.length}`);const I=await Promise.all(Z.map(async W=>{const U=W.nodoOrigenId===parseInt(t),K=U?W.nodoDestinoId:W.nodoOrigenId,$=await $e.get(`/world-bible/entities/${K}`);if(!$)throw new Error(`Entity ${K} not found`);return{...W,otherName:$.nombre,otherType:$.categoria||"Entity",isOutgoing:U}}));n(I)}catch(G){console.error("Failed to load relationships",G)}finally{a(!1)}},j=async G=>{R(!0);try{const Z=await $e.get("/world-bible/entities"),I=G==="All"?Z:Z.filter(W=>(W.categoria||"Generic").toLowerCase()===G.toLowerCase()||W.tipoEspecial&&W.tipoEspecial.toLowerCase()===G.toLowerCase());f(I||[])}catch(Z){console.error("Failed to fetch targets",Z),f([])}finally{R(!1)}},O=async()=>{if(!(!y||!w))try{const G={nodoOrigenId:parseInt(t),tipoOrigen:e,nodoDestinoId:parseInt(y),tipoDestino:"GenericEntity",tipoRelacion:w,descripcion:_,metadata:JSON.stringify({originalCategory:l}),tipoEntidad:"relacion"};await $e.put("/bd/insertar",G),o(!1),z(),D(),window.dispatchEvent(new CustomEvent("relationships-update"))}catch(G){console.error("Failed to save relationship",G),alert("Error saving relationship")}},F=async G=>{if(confirm("Are you sure?"))try{await $e.delete(`/bd/relacion/${G}`),D(),window.dispatchEvent(new CustomEvent("relationships-update"))}catch(Z){console.error("Failed to delete",Z)}},z=()=>{u("All"),g(""),S(""),C(""),T("")};return m.jsxs("div",{className:"p-6 space-y-6",children:[m.jsxs("header",{className:"flex justify-between items-center",children:[m.jsx("h3",{className:"text-lg font-bold text-white uppercase tracking-widest",children:"Relationships"}),m.jsx(Pn,{variant:"secondary",icon:"add_link",onClick:()=>o(!s),children:s?"Cancel":"Connect"})]}),s&&m.jsxs("div",{className:"p-4 rounded-2xl bg-white/5 border border-white/10 space-y-4 animate-in fade-in slide-in-from-top-4",children:[m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[m.jsxs("div",{className:"space-y-1",children:[m.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-slate-500",children:"Target Type"}),m.jsx("select",{className:"w-full bg-black/40 border border-white/10 rounded-xl p-2 text-sm text-white outline-none focus:border-primary",value:l,onChange:G=>{u(G.target.value),g(""),S("")},children:gG.map(G=>m.jsx("option",{value:G.value,className:"bg-[#1a1a20] text-white",children:G.label},G.value))})]}),m.jsxs("div",{className:"space-y-1",children:[m.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-slate-500",children:"Search & Select Target"}),m.jsxs("div",{className:"relative",children:[m.jsx("input",{type:"text",className:"w-full bg-black/40 border border-white/10 rounded-xl p-2 pl-8 text-sm text-white outline-none focus:border-primary",placeholder:"Type to search...",value:p,onChange:G=>g(G.target.value)}),m.jsx("span",{className:"material-symbols-outlined absolute left-2 top-2 text-slate-500 text-sm",children:"search"}),p&&!y&&m.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 bg-surface-dark border border-white/10 rounded-xl shadow-2xl z-50 max-h-40 overflow-y-auto custom-scrollbar",children:c.filter(G=>G.nombre.toLowerCase().includes(p.toLowerCase())).length===0?m.jsx("div",{className:"p-3 text-[10px] text-slate-500 text-center italic",children:"No results found"}):c.filter(G=>G.nombre.toLowerCase().includes(p.toLowerCase())).map(G=>m.jsx("div",{onClick:()=>{S(G.id),g(G.nombre)},className:"p-2 hover:bg-primary/10 hover:text-primary cursor-pointer text-xs text-slate-300 border-b border-white/5 last:border-0",children:G.nombre},G.id))}),y&&m.jsx("button",{onClick:()=>{S(""),g("")},className:"absolute right-2 top-2 text-slate-500 hover:text-primary transition-colors",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"close"})})]})]})]}),m.jsxs("div",{className:"space-y-1",children:[m.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-slate-500",children:"Relationship Type"}),m.jsx("input",{type:"text",placeholder:"e.g. Father of, Located in, Enemy of...",className:"w-full bg-black/40 border border-white/10 rounded-xl p-2 text-sm text-white outline-none focus:border-primary",value:w,onChange:G=>C(G.target.value)})]}),m.jsxs("div",{className:"space-y-1",children:[m.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-slate-500",children:"Description (The Why)"}),m.jsx("textarea",{placeholder:"Explain the nature of this connection...",className:"w-full bg-black/40 border border-white/10 rounded-xl p-2 text-sm text-white outline-none focus:border-primary h-20 resize-none",value:_,onChange:G=>T(G.target.value)})]}),m.jsx("div",{className:"flex justify-end pt-2",children:m.jsx(Pn,{variant:"primary",icon:"save",onClick:O,disabled:!y||!w,children:"Save Connection"})})]}),m.jsx("div",{className:"space-y-3",children:i?m.jsx("div",{className:"text-center text-slate-500 py-8",children:"Scanning connections..."}):r.length===0?m.jsx("div",{className:"text-center text-slate-500 py-8 italic border border-dashed border-white/10 rounded-2xl",children:"No connections established"}):r.map((G,Z)=>m.jsxs("div",{className:"group relative p-4 rounded-2xl bg-surface-dark border border-white/5 hover:border-primary/50 transition-all flex items-start gap-4",children:[m.jsx("div",{className:"mt-1",children:m.jsx("span",{className:"material-symbols-outlined text-slate-500",children:G.isOutgoing?"arrow_outward":"arrow_inward"})}),m.jsxs("div",{className:"flex-1",children:[m.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[m.jsx("span",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider",children:G.isOutgoing?"To:":"From:"}),m.jsx("span",{className:"text-sm font-bold text-white",children:G.otherName}),m.jsx("span",{className:"text-[9px] px-1.5 py-0.5 rounded bg-white/10 text-slate-400 font-bold uppercase tracking-wider",children:G.otherType})]}),m.jsx("div",{className:"text-primary text-xs font-black uppercase tracking-widest mb-2",children:G.tipoRelacion}),G.descripcion&&m.jsxs("p",{className:"text-xs text-slate-400 leading-relaxed bg-black/20 p-2 rounded-lg border border-white/5",children:['"',G.descripcion,'"']})]}),m.jsx("button",{onClick:()=>F(G.id),className:"opacity-0 group-hover:opacity-100 p-2 text-slate-600 hover:text-red-400 transition-all",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})})]},G.id||Z))})]})},yG=({node:t,elements:e,onClose:r,onCenter:n,onLock:i,isPinned:a})=>{const[s,o]=ne.useState("ESENCIA"),[l,u]=ne.useState(null),[c,f]=ne.useState(!1);if(ne.useEffect(()=>{if(!t?.id)return;const y=async()=>{try{f(!0);const S=await $e.get(`/world-bible/entities/${t.id}`);u(S)}catch(S){console.error(`Error fetching details for node ${t.id}:`,S)}finally{f(!1)}};t.isFull||y()},[t?.id]),!t)return null;const p=l||t,g=a?"border-primary":t.category==="Individual"?"border-indigo-500/50":t.category==="Location"?"border-emerald-500/50":"border-purple-500/50";return m.jsxs(Kn,{className:`w-[260px] flex flex-col shadow-2xl border-t-4 ${g} pointer-events-none overflow-hidden transition-all duration-300`,children:[m.jsxs("div",{className:`p-3 border-b border-white/5 flex items-center justify-between pointer-events-none text-drag-handle glass-panel-header ${a?"bg-primary/10":"bg-white/[0.03]"}`,children:[m.jsxs("div",{className:"flex items-center gap-2 overflow-hidden",children:[m.jsx("span",{className:`material-symbols-outlined text-[14px] ${a?"text-primary":"text-slate-400"}`,children:a?"keep":t.category==="Individual"?"person":t.category==="Location"?"location_on":"groups"}),m.jsx("h3",{className:"text-[10px] font-serif font-black text-white truncate uppercase tracking-tight",children:t.label||t.nombre})]}),m.jsxs("div",{className:"flex gap-1",children:[m.jsx("button",{onClick:i,className:`p-1 rounded-md transition-colors pointer-events-auto ${a?"text-primary bg-primary/20":"text-slate-500 hover:bg-white/10"}`,title:a?"Desanclar":"Fijar posicin",children:m.jsx("span",{className:"material-symbols-outlined text-xs",children:a?"lock":"lock_open"})}),m.jsx("button",{onClick:n,className:"p-1 hover:bg-white/10 rounded-md text-slate-400 transition-colors pointer-events-auto",children:m.jsx("span",{className:"material-symbols-outlined text-xs",children:"center_focus_strong"})})]})]}),m.jsx("div",{className:"flex bg-black/40 text-[8px] font-black uppercase tracking-widest border-b border-white/5 pointer-events-auto",children:["ESENCIA","RELACIONES","CRNICA"].map(y=>m.jsx("button",{onClick:()=>o(y),className:`flex-1 py-2.5 transition-all ${s===y?"bg-white/5 text-primary border-b border-primary":"text-slate-500 hover:text-slate-300"}`,children:y},y))}),m.jsx("div",{className:"p-4 min-h-[300px] max-h-[400px] overflow-y-auto custom-scrollbar bg-black/10 pointer-events-auto",children:c&&!l?m.jsxs("div",{className:"flex flex-col items-center justify-center h-40 opacity-20",children:[m.jsx("div",{className:"size-4 border-2 border-primary border-t-transparent animate-spin rounded-full mb-2"}),m.jsx("span",{className:"text-[8px] uppercase tracking-widest font-bold",children:"Invocando datos..."})]}):m.jsxs(m.Fragment,{children:[s==="ESENCIA"&&m.jsxs("div",{className:"space-y-4 animate-in fade-in slide-in-from-top-1 duration-300",children:[m.jsxs("div",{className:"space-y-1",children:[m.jsx("span",{className:"text-[8px] font-black uppercase text-slate-600 tracking-widest",children:"Resumen Etreo"}),m.jsx("p",{className:"text-xs text-slate-400 leading-relaxed italic border-l border-white/10 pl-3",children:p.description||p.summary||"Ningn cronista ha registrado detalles sobre esta entidad."})]}),p.attributes&&Object.entries(p.attributes).length>0&&m.jsx("div",{className:"grid grid-cols-1 gap-1.5 pt-2",children:Object.entries(p.attributes).map(([y,S])=>m.jsxs("div",{className:"flex justify-between items-center p-2 rounded bg-white/[0.02] border border-white/5",children:[m.jsx("span",{className:"text-[8px] font-bold text-slate-500 uppercase",children:y.replace(/_/g," ")}),m.jsx("span",{className:"text-[10px] text-slate-300 truncate ml-4 font-medium",children:String(S)})]},y))})]}),s==="RELACIONES"&&m.jsx("div",{className:"space-y-2 animate-in fade-in slide-in-from-top-1 duration-300",children:(()=>{const y=String(t.id),S=e.filter(w=>w.group==="edges"&&(String(w.data.source)===y||String(w.data.target)===y));return S.length===0?m.jsx("p",{className:"text-[10px] text-slate-600 italic py-8 text-center",children:"Sin hilos de causalidad activos."}):S.map(w=>{const C=String(w.data.source)===y?w.data.target:w.data.source,_=e.find(T=>String(T.data?.id)===String(C));return m.jsxs("div",{className:"flex items-center justify-between p-2.5 rounded bg-white/[0.02] border border-white/5 group/rel",children:[m.jsxs("div",{className:"flex items-center gap-2 overflow-hidden",children:[m.jsx("span",{className:"size-1 rounded-full bg-primary/40 group-hover/rel:bg-primary transition-colors"}),m.jsx("span",{className:"text-[10px] text-slate-300 font-medium truncate",children:_?.data?.label||_?.label||"Incgnito"})]}),m.jsx("span",{className:"px-1.5 py-0.5 rounded bg-primary/10 text-primary text-[7px] font-black uppercase tracking-tighter shrink-0",children:w.data.label||"Vnculo"})]},w.data.id)})})()}),s==="CRNICA"&&m.jsx("div",{className:"space-y-3 animate-in fade-in slide-in-from-top-1 duration-300",children:m.jsxs("div",{className:"flex flex-col items-center justify-center py-12 opacity-30 text-slate-500",children:[m.jsx("span",{className:"material-symbols-outlined text-3xl mb-2",children:"history_edu"}),m.jsx("span",{className:"text-[8px] font-black uppercase tracking-widest",children:"Cronologa sellada"})]})})]})}),m.jsx("div",{className:"p-2 bg-black/30 border-t border-white/5 flex gap-2 pointer-events-auto",children:m.jsx("button",{className:"flex-1 py-1.5 bg-primary/10 hover:bg-primary/20 text-primary rounded text-[9px] font-black uppercase tracking-widest transition-all",children:"Abrir en Archivador"})})]})},xG=[{selector:"node",style:{width:260,height:400,shape:"round-rectangle","background-opacity":0,"border-width":0,label:"","z-index":10,"overlay-opacity":0}},{selector:"node:selected",style:{"background-opacity":.05,"background-color":"#6366f1"}},{selector:"edge",style:{width:2,"line-color":"#334155","target-arrow-color":"#334155","target-arrow-shape":"triangle","curve-style":"bezier",opacity:.3,"z-index":1}},{selector:"edge.highlighted",style:{"line-color":"#6366f1",width:4,opacity:.8}}],bG=()=>{const{projectName:t}=Va(),{setRightOpen:e}=bo(),[r,n]=ne.useState([]),[i,a]=ne.useState(!0),[s,o]=ne.useState({}),[l,u]=ne.useState(1),c=ne.useRef(null);ne.useEffect(()=>{e&&e(!1),f()},[]);const f=async()=>{try{a(!0),t&&await $e.get(`/proyectos/${t}`);const y=await $e.get("/world-bible/graph"),S=y.nodes||y.data?.nodes||[],w=y.edges||y.data?.edges||[],C=S.map(T=>({...T,data:{...T.data,id:String(T.data.id)}})),_=w.map(T=>({...T,data:{...T.data,id:T.data.id?String(T.data.id):void 0,source:String(T.data.source),target:String(T.data.target)}}));C.length>0&&n([...C,..._])}catch(y){console.error("Failed to load graph data:",y)}finally{a(!1)}},p=()=>{c.current&&c.current.layout({name:"cose",animate:!0,padding:150,componentSpacing:350,nodeOverlap:200}).run()},g=ne.useCallback(()=>{if(!c.current)return;const y={},S=c.current;u(S.zoom()),S.nodes().forEach(w=>{const C=w.renderedPosition();y[w.id()]={x:C.x,y:C.y,isPinned:w.hasClass("pinned")||w.locked()}}),o(y)},[]);return ne.useEffect(()=>{if(!c.current||r.length===0)return;const y=c.current;return setTimeout(g,200),y.on("pan zoom drag position",g),y.on("dragfree","node",S=>{S.target.addClass("pinned"),g()}),()=>{y.off("pan zoom drag position dragfree",g)}},[r,g]),m.jsxs("div",{className:"w-full h-full bg-[#050508] relative overflow-hidden font-display",children:[m.jsx("div",{className:"absolute inset-0 z-50 pointer-events-none overflow-hidden",children:r.filter(y=>y.group==="nodes"||!y.data.source).map(y=>{const S=String(y.data.id),w=s[S];return w?m.jsx("div",{className:"absolute pointer-events-none origin-center",style:{left:w.x,top:w.y,transform:`translate(-50%, -50%) scale(${l})`,zIndex:w.isPinned?55:50,opacity:i?0:1},children:m.jsx(yG,{node:y.data,elements:r,isPinned:w.isPinned,onCenter:()=>{const C=c.current.$id(S);c.current.animate({center:{eles:C},zoom:1})},onLock:()=>{const C=c.current.$id(S);C.hasClass("pinned")?(C.removeClass("pinned"),C.unlock()):(C.addClass("pinned"),C.lock(),g()),g()}})},`win-${S}`):null})}),m.jsxs("div",{className:"absolute top-6 left-6 z-[60] flex flex-col gap-2",children:[m.jsx("button",{onClick:p,className:"p-3 bg-glass backdrop-blur-md border border-glass-border rounded-xl text-slate-400 hover:text-white transition-all shadow-xl hover:scale-105 active:scale-95",title:"Reordenar Arcanos",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"auto_graph"})}),m.jsx("button",{onClick:()=>c.current?.fit(150),className:"p-3 bg-glass backdrop-blur-md border border-glass-border rounded-xl text-slate-400 hover:text-white transition-all shadow-xl hover:scale-105 active:scale-95",title:"Encuadre Divino",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"fit_screen"})})]}),m.jsx(mG,{elements:r,stylesheet:xG,style:{width:"100%",height:"100%"},cy:y=>{c.current=y},minZoom:.05,maxZoom:2,wheelSensitivity:.3,className:"bg-[#050508]"})]})},Hf=({to:t,icon:e,label:r,collapsed:n,end:i})=>m.jsxs(lI,{to:t,end:i,className:({isActive:a})=>`
            flex items-center gap-3 px-3 py-2 border-l-[3px] transition-all duration-200 group
            ${a?"border-[#007acc] text-white bg-[#2b2b2b]":"border-transparent text-slate-400 hover:text-primary hover:bg-primary/5"}
            ${n?"justify-center px-0":""}
        `,title:n?r:"",children:[m.jsx("span",{className:"material-symbols-outlined text-[19px] transition-transform group-hover:scale-110",children:e}),!n&&m.jsx("span",{className:"text-[12.5px] font-sans tracking-wide font-medium",children:r})]}),wG=()=>{console.log("ArchitectLayout Mounting");const{username:t,projectName:e,folderSlug:r}=Va(),n=Ga(),{t:i}=Ps(),a=af(),[s]=dI(),o=s.get("hideSidebar")==="true",[l,u]=ne.useState(!0),[c,f]=ne.useState(!1),[p,g]=ne.useState("Loading..."),[y,S]=ne.useState(null),[w,C]=ne.useState(null),[_,T]=ne.useState("NOTEBOOKS"),[N,R]=ne.useState(null),[D,j]=ne.useState("overlay"),[O,F]=ne.useState(!1),[z,G]=ne.useState({name:"",description:"",type:"regional",showGrid:!0,gridSize:50,width:800,height:600,bgImage:null}),[Z,I]=ne.useState(null),W=Ve=>{C(Ve),Ve&&f(!0)},[U,K]=ne.useState("identity"),[$,Q]=ne.useState("notes"),[ie,te]=ne.useState(""),[X,re]=ne.useState("ALL"),fe=a.pathname.includes("/bible"),[oe,se]=ne.useState([]),[he,ae]=ne.useState(""),[pe,ye]=ne.useState("ALL"),[ve,ue]=ne.useState(null);a.pathname.includes("/writing");const[xe,Se]=ne.useState("index");a.pathname.includes("/languages");const[Ae,Me]=ne.useState(null),[st,rt]=ne.useState([]),[dt,Ct]=ne.useState("identity"),[Ke,ut]=ne.useState(null),[ct,xt]=ne.useState(!1),[ot,Lt]=ne.useState(null),[Bt,Ne]=ne.useState(!1),[qe,St]=ne.useState(null),it=async()=>{if(Ke){try{await $e.delete(`/world-bible/templates/${Ke}`),setAvailableTemplates(Ve=>Ve.filter(vt=>vt.id!==Ke))}catch(Ve){console.error("Delete failed",Ve)}ut(null)}},lt=async Ve=>{Ve.preventDefault();try{await $e.put(`/world-bible/templates/${Ae.id}`,Ae),setAvailableTemplates(vt=>vt.map(Et=>Et.id===Ae.id?Ae:Et)),Me(null)}catch(vt){console.error("Update failed",vt)}},Ie=`/${t}/${e}`;if(o)return m.jsx("div",{className:"h-screen w-screen bg-[#0a0a0a]",children:m.jsx(sx,{context:{setRightPanelTab:T,setRightOpen:f,setRightPanelContent:W,projectId:y,baseUrl:Ie}})});ne.useEffect(()=>{e&&de()},[e]);const de=async()=>{try{const Ve=await $e.get("/world-bible/folders");se(Ve)}catch(Ve){console.error("Error loading folders:",Ve)}};ne.useEffect(()=>{e&&pt(e);const Ve=()=>{e&&pt(e)};return window.addEventListener("focus",Ve),()=>window.removeEventListener("focus",Ve)},[e]),ne.useEffect(()=>{console.log("[ArchitectLayout] Route changed, clearing panel content"),C(null),T("CONTEXT")},[a.pathname]),ne.useEffect(()=>{fe||ue(null)},[fe]);const ge=()=>f(Ve=>!Ve),ke=async(Ve=null,vt="FOLDER")=>{try{const Et=Ve?typeof Ve=="object"?Ve.id:Ve:null,er=await $e.post("/world-bible/folders",{nombre:vt==="TIMELINE"?"Nueva Timeline":"Nueva Carpeta",padreId:Et,tipo:vt});Et===null?(await de(),window.dispatchEvent(new CustomEvent("folder-update",{detail:{folderId:null}}))):window.dispatchEvent(new CustomEvent("folder-update",{detail:{folderId:Et,optimisticType:"folder",item:er,expand:!0}}))}catch(Et){console.error("Error creating simple folder:",Et)}},Ee=async(Ve,vt)=>{try{await $e.put(`/world-bible/folders/${Ve}`,{nombre:vt}),se(Et=>Et.map(er=>er.id===Ve?{...er,nombre:vt}:er))}catch(Et){throw Et}},Re=(Ve,vt=null)=>{St({id:Ve,parentId:vt,type:"folder"}),Ne(!0)},Qe=async(Ve,vt,Et)=>{try{await $e.put(`/world-bible/entities/${Ve}`,{carpetaId:vt}),window.dispatchEvent(new CustomEvent("folder-update",{detail:{folderId:Et,removeId:Ve,type:"entity"}})),window.dispatchEvent(new CustomEvent("folder-update",{detail:{folderId:vt,type:"move-in",entityId:Ve}}))}catch(er){console.error("Move failed:",er)}},Ge=async(Ve,vt)=>{try{const Et=await $e.get(`/world-bible/entities/${Ve}`),er=await $e.post("/world-bible/entities",{...Et,id:void 0,nombre:`${Et.nombre} (Copia)`,carpetaId:vt});window.dispatchEvent(new CustomEvent("folder-update",{detail:{folderId:vt,type:"entity",item:er}}))}catch(Et){console.error("Duplicate failed:",Et)}},wt=async(Ve,vt="entidadindividual")=>{const Et=typeof Ve=="object"?Ve.slug||Ve.id:Ve;n(`${Ie}/bible/folder/${Et}/entity/new/${vt}`)},bt=async(Ve,vt,Et,er,gr)=>{try{if(Et==="folder")typeof Ve=="number"&&!Ve.toString().startsWith("temp")&&(await $e.put(`/world-bible/folders/${Ve}`,{nombre:vt}),window.dispatchEvent(new CustomEvent("folder-update",{detail:{folderId:er,confirmedType:"folder",oldId:Ve,item:{id:Ve,nombre:vt,parentId:er,tipo:gr,uiKey:Date.now()}}})),er||se(Ir=>Ir.map(zr=>zr.id===Ve?{...zr,nombre:vt}:zr)));else if(Et==="entity"&&typeof Ve=="string"&&Ve.startsWith("new-")){const Ir=await $e.post("/world-bible/entities",{nombre:vt,carpetaId:er,tipoEspecial:gr||"entidadindividual"});window.dispatchEvent(new CustomEvent("folder-update",{detail:{folderId:er,confirmedType:"entity",oldId:Ve,item:Ir}}))}}catch(Ir){console.error("Confirm create failed:",Ir)}},pt=async Ve=>{try{const vt=await $e.get(`/proyectos/${Ve}`);vt&&(g(vt.nombreProyecto),S(vt.id))}catch(vt){console.error("Error loading project:",vt),g("Error"),n("/")}},[Kt,Wt]=ne.useState(null);return ne.useEffect(()=>{const Ve=localStorage.getItem("user");Ve&&Ve!=="undefined"&&Wt(JSON.parse(Ve))},[]),m.jsxs("div",{className:"flex flex-col h-screen w-full overflow-hidden bg-[#1e1e1e] text-slate-300 font-sans selection:bg-primary/30",children:[m.jsxs("div",{className:"flex flex-1 overflow-hidden",children:[!o&&m.jsxs("aside",{className:`
                        fixed top-0 left-0 h-full bg-surface-dark border-r border-glass-border shadow-2xl z-40 transition-all duration-500 ease-in-out flex flex-col
                        ${l?"w-64 translate-x-0":"w-64 -translate-x-full"}
                    `,children:[m.jsxs("div",{className:"w-full h-full flex flex-col overflow-hidden",children:[m.jsx("div",{className:"h-16 flex items-center justify-center border-b border-glass-border relative bg-white/[0.02]",children:m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("div",{className:"size-8 rounded-lg bg-surface-light flex items-center justify-center text-primary shadow-inner",children:m.jsx("span",{className:"material-symbols-outlined",children:a.pathname.includes("/writing")?"edit_note":a.pathname.includes("/graph")?"hub":a.pathname.includes("/bible")?"auto_stories":a.pathname.includes("/map")?"map":a.pathname.includes("/timeline")?"timeline":a.pathname.includes("/languages")?"translate":"auto_stories"})}),m.jsx("h2",{className:"text-sm font-black uppercase tracking-widest text-white truncate max-w-[150px]",children:p})]})}),m.jsx("div",{className:"flex-1 overflow-y-auto no-scrollbar flex flex-col",children:m.jsxs("div",{className:"p-3 space-y-1",children:[m.jsx(Hf,{to:Ie,icon:"home",label:i("nav.dashboard"),collapsed:!1,end:!0}),m.jsx(Hf,{to:`${Ie}/bible`,icon:"menu_book",label:i("nav.bible"),collapsed:!1}),m.jsx(Hf,{to:`${Ie}/map`,icon:"map",label:i("nav.atlas"),collapsed:!1}),m.jsx(Hf,{to:`${Ie}/timeline`,icon:"calendar_month",label:i("nav.chronology"),collapsed:!1}),m.jsx(Hf,{to:`${Ie}/languages`,icon:"translate",label:i("nav.languages"),collapsed:!1}),m.jsx("div",{className:"h-px bg-glass-border my-2 mx-2 opacity-50"}),m.jsx(Hf,{to:`${Ie}/writing`,icon:"edit_note",label:i("nav.writing"),collapsed:!1}),m.jsx("div",{className:"h-px bg-glass-border my-2 mx-2 opacity-10"}),m.jsx(Hf,{to:"/",icon:"logout",label:i("nav.logout"),collapsed:!1})]})})]}),m.jsxs("button",{onClick:()=>u(!l),className:`
                            absolute top-1/2 -translate-y-1/2 -right-10 w-10 h-24 
                            bg-surface-dark border border-glass-border border-l-0
                            rounded-r-2xl flex flex-col items-center justify-center gap-1
                            transition-all duration-300 group
                            hover:bg-primary/10 hover:border-primary/30
                            ${l?"text-primary shadow-[4px_0_15px_-5px_rgba(var(--primary-rgb),0.3)]":"text-slate-500"}
                        `,title:l?"Cerrar Panel":"Abrir Panel",children:[m.jsx("div",{className:`w-1 h-3 rounded-full bg-current opacity-20 transition-all duration-500 ${l?"h-6 opacity-40":""}`}),m.jsx("span",{className:`material-symbols-outlined text-lg transition-transform duration-500 ${l?"":"rotate-180"}`,children:"side_navigation"}),m.jsx("div",{className:`w-1 h-3 rounded-full bg-current opacity-20 transition-all duration-500 ${l?"h-6 opacity-40":""}`}),m.jsx("div",{className:"absolute inset-0 rounded-r-2xl bg-primary/5 opacity-0 group-hover:opacity-100 transition-opacity"})]})]}),m.jsxs("main",{className:"flex-1 flex flex-col min-w-0 bg-[#1e1e1e] relative",children:[m.jsx("div",{className:"flex-1 flex flex-col min-w-0 bg-background-dark relative overflow-hidden",children:m.jsx(sx,{context:{setRightPanelContent:W,setRightOpen:f,toggleRightPanel:ge,rightPanelTab:_,setRightPanelTab:T,setRightPanelTitle:R,setRightPanelMode:j,folderSearchTerm:ie,setFolderSearchTerm:te,folderFilterType:X,setFolderFilterType:re,setBibleExplorerState:ue,projectId:y,mapSettings:z,setMapSettings:G,onMapSettingsChange:Z,setOnMapSettingsChange:I}})}),m.jsx(Cj,{isOpen:c,onClose:()=>f(!1),onToggle:ge,contextContent:w,projectId:y,activeTab:_,setActiveTab:T,title:N,onClearContext:()=>C(null),folders:oe,searchTerm:he,setSearchTerm:ae,filterType:pe,setFilterType:ye,handleCreateSimpleFolder:ke,handleRenameFolder:Ee,handleDeleteFolder:Re,handleMoveEntity:Qe,handleDuplicateEntity:Ge,handleCreateEntity:wt,handleConfirmCreate:bt})]})]}),m.jsxs("div",{className:`
                fixed bottom-0 left-0 w-full bg-[#141414] border-t border-[#2d2d2d] z-50
                transition-transform duration-500 ease-in-out flex flex-col shadow-[0_-10px_40px_rgba(0,0,0,0.5)]
                ${O?"h-[60vh] translate-y-0":"h-[60vh] translate-y-full"}
            `,children:[m.jsx("div",{className:"absolute -top-10 left-1/2 -translate-x-1/2 h-10 px-4 bg-[#141414] border border-b-0 border-[#2d2d2d] rounded-t-2xl flex items-center justify-center cursor-pointer hover:bg-[#1e1e1e] transition-colors group shadow-[0_-5px_15px_rgba(0,0,0,0.2)]",onClick:()=>F(!O),children:m.jsxs("div",{className:"flex items-center gap-2 text-slate-400 group-hover:text-primary transition-colors",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:O?"keyboard_arrow_down":"hub"}),m.jsx("span",{className:"text-xs font-black tracking-widest uppercase",children:O?"Cerrar Grafo":"Grafo Global"})]})}),m.jsx("div",{className:`flex-1 w-full h-full p-2 relative bg-black/40 transition-opacity duration-300 ${O?"opacity-100":"opacity-0 pointer-events-none"}`,style:{visibility:O?"visible":"hidden"},children:m.jsx("div",{className:"w-full h-full border border-glass-border rounded-xl overflow-hidden bg-[#0a0a0a]",children:m.jsx("iframe",{src:`${Ie}/graph?hideSidebar=true`,className:"w-full h-full border-none",title:"Global Graph",loading:"eager"})})})]}),Ae&&m.jsx("div",{className:"fixed inset-0 z-[100] bg-black/60 backdrop-blur-sm flex items-center justify-center p-4",children:m.jsxs("div",{className:"bg-surface-dark border border-glass-border rounded-2xl p-6 w-full max-w-md shadow-2xl animate-scale-in",children:[m.jsx("h3",{className:"text-xl font-black text-white mb-4",children:i("settings.edit_template")}),m.jsxs("form",{onSubmit:lt,className:"space-y-4",children:[m.jsxs("div",{children:[m.jsx("label",{className:"text-xs uppercase font-bold text-text-muted block mb-1",children:i("settings.name")}),m.jsx("input",{autoFocus:!0,className:"w-full bg-black/30 border border-white/10 rounded-xl p-3 text-white focus:border-primary outline-none",value:Ae.nombre,onChange:Ve=>Me({...Ae,nombre:Ve.target.value}),required:!0})]}),m.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[m.jsxs("div",{children:[m.jsx("label",{className:"text-xs uppercase font-bold text-text-muted block mb-1",children:i("settings.type")}),m.jsxs("select",{className:"w-full bg-black/30 border border-white/10 rounded-xl p-3 text-white focus:border-primary outline-none",value:Ae.tipo,onChange:Ve=>Me({...Ae,tipo:Ve.target.value}),children:[m.jsx("option",{className:"bg-[#1a1a20] text-white",value:"text",children:"Texto Largo"}),m.jsx("option",{className:"bg-[#1a1a20] text-white",value:"short_text",children:"Texto Corto"}),m.jsx("option",{className:"bg-[#1a1a20] text-white",value:"number",children:"Nmero"}),m.jsx("option",{className:"bg-[#1a1a20] text-white",value:"boolean",children:"Si/No"}),m.jsx("option",{className:"bg-[#1a1a20] text-white",value:"date",children:"Fecha"}),m.jsx("option",{className:"bg-[#1a1a20] text-white",value:"entity_link",children:"Vnculo Entidad"}),m.jsx("option",{className:"bg-[#1a1a20] text-white",value:"image",children:"Imagen URL"})]})]}),m.jsx("div",{className:"flex items-center",children:m.jsxs("label",{className:"flex items-center gap-2 cursor-pointer p-3 bg-white/5 rounded-xl w-full hover:bg-white/10 transition-colors",children:[m.jsx("input",{type:"checkbox",checked:Ae.global,onChange:Ve=>Me({...Ae,global:Ve.target.checked}),className:"accent-primary size-4"}),m.jsx("span",{className:"text-sm font-bold text-white",children:i("settings.is_global")})]})})]}),m.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[m.jsx("button",{type:"button",onClick:()=>Me(null),className:"px-4 py-2 text-text-muted hover:text-white font-bold transition-colors",children:i("common.cancel")}),m.jsx("button",{type:"submit",className:"px-6 py-2 bg-primary text-white rounded-xl font-bold shadow-lg shadow-primary/20 hover:scale-105 transition-transform",children:i("common.save")})]})]})]})}),m.jsx(Zv,{isOpen:!!Ke,onClose:()=>ut(null),onConfirm:it,title:i("settings.delete_template"),message:i("common.are_you_sure"),confirmText:i("common.confirm_delete"),type:"danger"})]})},SG=({id:t})=>{const{id:e}=Va(),r=Ga(),[n,i]=ne.useState("overview"),[a,s]=ne.useState(null),[o,l]=ne.useState(!0),[u,c]=ne.useState(!1);ne.useEffect(()=>{f()},[t]);const f=async()=>{l(!0);try{const S=await $e.get(`/bd/entidadindividual/${t}`);s(S)}catch(S){console.error("Error loading character:",S)}finally{l(!1)}},p=async()=>{try{await $e.patch("/bd/modificar",{...a,tipoEntidad:"entidadindividual"}),c(!1)}catch(S){console.error("Error saving:",S)}},g=async()=>{if(window.confirm("Move this character to the Trash Bin?"))try{await $e.delete(`/bd/entidadindividual/${t}`),r(`/project/${e}`)}catch(S){console.error(S)}},y=(S,w)=>{s(C=>({...C,[S]:w}))};return o?m.jsx("div",{className:"p-20 text-center text-slate-500 animate-pulse",children:"Summoning entity..."}):a?m.jsxs("div",{className:"flex h-full",children:[m.jsxs("div",{className:"flex-1 flex flex-col overflow-y-auto custom-scrollbar p-8 gap-6",children:[m.jsxs("div",{className:"flex items-start gap-6",children:[m.jsx("div",{className:"relative",children:m.jsx(e_,{url:a.imagenUrl||"https://images.unsplash.com/photo-1544005313-94ddf0286df2?q=80&w=1976&auto=format&fit=crop",size:"xl",className:"rounded-2xl border-2 border-primary shadow-[0_0_30px_rgba(99,102,242,0.3)]"})}),m.jsxs("div",{className:"flex-1",children:[m.jsxs("div",{className:"flex items-center gap-3 mb-1",children:[m.jsx("span",{className:"text-xs font-bold text-primary bg-primary/10 px-2 py-0.5 rounded border border-primary/20",children:a.estado||"ACTIVE"}),m.jsx("span",{className:"text-xs font-bold text-slate-400 bg-surface-light px-2 py-0.5 rounded border border-white/5",children:a.tipo||"Unknown"})]}),m.jsxs("h1",{className:"text-4xl font-bold text-white mb-2",children:[a.nombre," ",a.apellidos]}),m.jsx("p",{className:"text-lg text-slate-300",children:a.origen||"Traveling the void"})]}),m.jsxs("div",{className:"flex gap-2",children:[!u&&m.jsx(Pn,{className:"border-red-500/30 text-red-400 hover:bg-red-500/10",icon:"delete",onClick:g,children:"Delete"}),m.jsx(Pn,{variant:"secondary",icon:u?"close":"edit",onClick:()=>c(!u),children:u?"Cancel":"Edit Profile"}),u&&m.jsx(Pn,{variant:"primary",icon:"save",onClick:p,children:"Save Changes"})]})]}),m.jsx("div",{className:"border-b border-glass-border flex gap-6",children:["Overview","Biography","Attributes & Stats","Relationships"].map(S=>m.jsx("button",{onClick:()=>i(S.toLowerCase()),className:`pb-4 px-2 text-sm font-bold border-b-2 transition-colors ${n===S.toLowerCase()?"text-primary border-primary":"text-slate-500 border-transparent hover:text-white"}`,children:S},S))}),m.jsxs("div",{className:"grid grid-cols-3 gap-6",children:[m.jsx("div",{className:"col-span-1 space-y-6",children:m.jsxs(Kn,{className:"p-4",children:[m.jsxs("h3",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider mb-4 flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"fingerprint"})," Identity"]}),m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[m.jsxs("div",{children:[m.jsx("label",{className:"text-xs text-slate-400 block mb-1",children:"Name"}),m.jsx("input",{type:"text",value:a.nombre,onChange:S=>y("nombre",S.target.value),className:"w-full bg-surface-light border border-white/10 rounded px-3 py-2 text-white text-sm",readOnly:!u})]}),m.jsxs("div",{children:[m.jsx("label",{className:"text-xs text-slate-400 block mb-1",children:"Surnames"}),m.jsx("input",{type:"text",value:a.apellidos||"",onChange:S=>y("apellidos",S.target.value),className:"w-full bg-surface-light border border-white/10 rounded px-3 py-2 text-white text-sm",readOnly:!u})]})]}),m.jsxs("div",{children:[m.jsx("label",{className:"text-xs text-slate-400 block mb-1",children:"Type / Species"}),m.jsx("input",{type:"text",value:a.tipo||"",onChange:S=>y("tipo",S.target.value),className:"w-full bg-surface-light border border-white/10 rounded px-3 py-2 text-white text-sm",readOnly:!u})]}),m.jsxs("div",{children:[m.jsx("label",{className:"text-xs text-slate-400 block mb-1",children:"Origin"}),m.jsx("input",{type:"text",value:a.origen||"",onChange:S=>y("origen",S.target.value),className:"w-full bg-surface-light border border-white/10 rounded px-3 py-2 text-white text-sm",readOnly:!u})]})]})]})}),m.jsx("div",{className:"col-span-2 space-y-6",children:m.jsxs(Kn,{className:"p-6 relative overflow-hidden group",children:[m.jsxs("div",{className:"flex items-center justify-between mb-6",children:[m.jsxs("h3",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"auto_stories"})," Narrative & Connections"]}),!u&&m.jsx("span",{className:"text-[10px] text-slate-600 bg-white/5 px-2 py-1 rounded",children:"Read Only"})]}),m.jsxs("div",{className:"mb-8",children:[m.jsx("h4",{className:"text-[10px] font-black uppercase tracking-widest text-primary mb-3 opacity-80",children:"Biography"}),m.jsx("textarea",{value:a.descripcion||"",onChange:S=>y("descripcion",S.target.value),readOnly:!u,className:`w-full bg-transparent border-none outline-none text-slate-300 text-sm leading-relaxed resize-none custom-scrollbar ${u?"min-h-[150px] placeholder-white/20":"h-auto overflow-hidden"}`,placeholder:"Write the history of this person..."}),m.jsx("h4",{className:"text-[10px] font-black uppercase tracking-widest text-primary mt-6 mb-3 opacity-80",children:"Behavior & Personality"}),m.jsx("textarea",{value:a.comportamiento||"",onChange:S=>y("comportamiento",S.target.value),readOnly:!u,className:`w-full bg-transparent border-none outline-none text-slate-300 text-sm leading-relaxed resize-none custom-scrollbar ${u?"min-h-[100px]":"h-auto overflow-hidden"}`,placeholder:"How does this person act?"})]}),m.jsxs("div",{className:"pt-6 border-t border-white/5",children:[m.jsxs("h4",{className:"text-[10px] font-black uppercase tracking-widest text-primary mb-4 flex items-center gap-2 opacity-80",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"hub"})," Established Connections"]}),a.relaciones&&a.relaciones.length>0?m.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:a.relaciones.map((S,w)=>m.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white/5 rounded-xl border border-white/5 hover:border-primary/30 transition-colors",children:[m.jsx("div",{className:"size-8 rounded-full bg-white/10 flex items-center justify-center text-xs font-bold",children:S.entidadDestino?.nombre?.charAt(0)||"?"}),m.jsxs("div",{className:"flex-1 min-w-0",children:[m.jsx("div",{className:"text-sm font-bold text-white truncate",children:S.entidadDestino?.nombre||"Unknown"}),m.jsx("div",{className:"text-[10px] text-primary truncate",children:S.tipoRelacion||"Connected"})]})]},w))}):m.jsx("div",{className:"p-6 text-center bg-white/5 rounded-xl border border-dashed border-white/10",children:m.jsx("p",{className:"text-xs text-slate-500 italic",children:"No relationships recorded yet."})})]})]})})]})]}),m.jsxs("div",{className:"w-80 border-l border-glass-border bg-surface-dark/50 hidden xl:flex flex-col",children:[m.jsxs("div",{className:"p-4 border-b border-glass-border flex justify-between items-center",children:[m.jsx("span",{className:"text-xs font-bold text-slate-500",children:"QUICK NOTES"}),m.jsx("button",{className:"text-slate-400 hover:text-white",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"open_in_new"})})]}),m.jsx("div",{className:"p-4 flex-1",children:m.jsx("textarea",{className:"w-full h-full bg-transparent border-none outline-none text-sm text-slate-300 placeholder-slate-600 resize-none",placeholder:"Draft a quick scene or jot down notes for Elara here..."})}),m.jsx("div",{className:"p-2 border-t border-glass-border text-right text-[10px] text-slate-600",children:"0 words"})]})]}):m.jsx("div",{className:"p-20 text-center text-red-500",children:"Character not found in the archives."})},d5=({id:t})=>{const[e,r]=ne.useState(null),[n,i]=ne.useState(!0),[a,s]=ne.useState(!1);ne.useEffect(()=>{o()},[t]);const o=async()=>{i(!0);try{const c=await $e.get(`/bd/zona/${t}`);r(c)}catch(c){console.error("Error loading location:",c)}finally{i(!1)}},l=async()=>{try{await $e.patch("/bd/modificar",{...e,tipoEntidad:"zona"}),s(!1)}catch(c){console.error("Error saving:",c)}},u=(c,f)=>{r(p=>({...p,[c]:f}))};return n?m.jsx("div",{className:"p-20 text-center text-slate-500 animate-pulse",children:"Scanning terrain..."}):e?m.jsxs("div",{className:"flex h-full overflow-y-auto custom-scrollbar p-8 flex-col gap-8",children:[m.jsxs("header",{className:"flex justify-between items-end",children:[m.jsxs("div",{children:[m.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[m.jsx("span",{className:"text-xs font-bold text-emerald-400 bg-emerald-400/10 px-2 py-0.5 rounded border border-emerald-400/20",children:"LOCATION"}),m.jsx("span",{className:"text-xs font-bold text-slate-400 bg-surface-light px-2 py-0.5 rounded border border-white/5",children:e.tipo||"Wilderness"})]}),m.jsx("h1",{className:"text-5xl font-manrope font-black text-white tracking-tight",children:e.nombre}),m.jsx("p",{className:"text-slate-400 mt-2",children:e.apellidos||"Uncharted territory"})]}),m.jsxs("div",{className:"flex gap-2",children:[m.jsx(Pn,{variant:"secondary",icon:a?"close":"edit",onClick:()=>s(!a),children:a?"Cancel":"Edit Location"}),a&&m.jsx(Pn,{variant:"primary",icon:"save",onClick:l,children:"Update Records"})]})]}),m.jsxs("div",{className:"grid grid-cols-3 gap-8",children:[m.jsxs("div",{className:"col-span-1 space-y-6",children:[m.jsxs(Kn,{className:"p-6",children:[m.jsxs("h3",{className:"text-xs font-bold text-slate-500 uppercase tracking-widest mb-4 flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"straighten"})," Geography & Scale"]}),m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{children:[m.jsx("label",{className:"text-xs text-slate-400 block mb-1",children:"Size / Scale"}),m.jsx("input",{type:"text",value:e.tamanno||"",onChange:c=>u("tamanno",c.target.value),className:"w-full bg-surface-light border border-white/10 rounded px-3 py-2 text-white text-sm",readOnly:!a})]}),m.jsxs("div",{children:[m.jsx("label",{className:"text-xs text-slate-400 block mb-1",children:"Development Level"}),m.jsx("input",{type:"text",value:e.desarrollo||"",onChange:c=>u("desarrollo",c.target.value),className:"w-full bg-surface-light border border-white/10 rounded px-3 py-2 text-white text-sm",readOnly:!a})]})]})]}),m.jsxs(Kn,{className:"p-6",children:[m.jsx("h3",{className:"text-xs font-bold text-slate-500 uppercase tracking-widest mb-4",children:"Quick Stats"}),m.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[m.jsxs("div",{className:"bg-white/5 p-3 rounded-xl border border-white/5",children:[m.jsx("span",{className:"text-[10px] text-slate-500 block",children:"Density"}),m.jsx("span",{className:"text-white font-bold",children:"Medium"})]}),m.jsxs("div",{className:"bg-white/5 p-3 rounded-xl border border-white/5",children:[m.jsx("span",{className:"text-[10px] text-slate-500 block",children:"Security"}),m.jsx("span",{className:"text-emerald-400 font-bold",children:"Stable"})]})]})]})]}),m.jsx("div",{className:"col-span-2 space-y-6",children:m.jsxs(Kn,{className:"p-8",children:[m.jsxs("h3",{className:"text-xs font-bold text-slate-500 uppercase tracking-widest mb-4 flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"description"})," Topographic Records & Lore"]}),m.jsx("textarea",{value:e.descripcion||"",onChange:c=>u("descripcion",c.target.value),readOnly:!a,className:"w-full bg-transparent border-none outline-none text-slate-300 text-lg leading-relaxed min-h-[400px] resize-none",placeholder:"Describe the vistas, the smells, and the secrets of this place..."})]})})]})]}):m.jsx("div",{className:"p-20 text-center text-red-500",children:"Location not found in the maps."})},kG=({id:t})=>{const[e,r]=ne.useState(null),[n,i]=ne.useState(!0),[a,s]=ne.useState(!1);ne.useEffect(()=>{o()},[t]);const o=async()=>{i(!0);try{const c=await $e.get(`/bd/entidadcolectiva/${t}`);r(c)}catch(c){console.error("Error loading collective:",c)}finally{i(!1)}},l=async()=>{try{await $e.patch("/bd/modificar",{...e,tipoEntidad:"entidadcolectiva"}),s(!1)}catch(c){console.error("Error saving:",c)}},u=(c,f)=>{r(p=>({...p,[c]:f}))};return n?m.jsx("div",{className:"p-20 text-center text-slate-500 animate-pulse",children:"Gathering intelligence..."}):e?m.jsxs("div",{className:"flex h-full overflow-y-auto custom-scrollbar p-8 flex-col gap-8",children:[m.jsxs("header",{className:"flex justify-between items-end",children:[m.jsxs("div",{children:[m.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[m.jsx("span",{className:"text-xs font-bold text-indigo-400 bg-indigo-400/10 px-2 py-0.5 rounded border border-indigo-400/20",children:"COLLECTIVE"}),m.jsx("span",{className:"text-xs font-bold text-slate-400 bg-surface-light px-2 py-0.5 rounded border border-white/5",children:e.tipo||"Organization"})]}),m.jsx("h1",{className:"text-5xl font-manrope font-black text-white tracking-tight",children:e.nombre}),m.jsxs("p",{className:"text-slate-400 mt-2",children:[e.cantidadMiembros||"Unknown"," members"]})]}),m.jsxs("div",{className:"flex gap-2",children:[m.jsx(Pn,{variant:"secondary",icon:a?"close":"edit",onClick:()=>s(!a),children:a?"Cancel":"Edit Collective"}),a&&m.jsx(Pn,{variant:"primary",icon:"save",onClick:l,children:"Update Dossier"})]})]}),m.jsxs("div",{className:"grid grid-cols-3 gap-8",children:[m.jsx("div",{className:"col-span-1 space-y-6",children:m.jsxs(Kn,{className:"p-6",children:[m.jsxs("h3",{className:"text-xs font-bold text-slate-500 uppercase tracking-widest mb-4 flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"group_work"})," Group Dynamics"]}),m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{children:[m.jsx("label",{className:"text-xs text-slate-400 block mb-1",children:"Scale / Members"}),m.jsx("input",{type:"text",value:e.cantidadMiembros||"",onChange:c=>u("cantidadMiembros",c.target.value),className:"w-full bg-surface-light border border-white/10 rounded px-3 py-2 text-white text-sm",readOnly:!a})]}),m.jsxs("div",{children:[m.jsx("label",{className:"text-xs text-slate-400 block mb-1",children:"Behavior / Alignment"}),m.jsx("input",{type:"text",value:e.comportamiento||"",onChange:c=>u("comportamiento",c.target.value),className:"w-full bg-surface-light border border-white/10 rounded px-3 py-2 text-white text-sm",readOnly:!a})]})]})]})}),m.jsx("div",{className:"col-span-2 space-y-6",children:m.jsxs(Kn,{className:"p-8",children:[m.jsxs("h3",{className:"text-xs font-bold text-slate-500 uppercase tracking-widest mb-4 flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"history_edu"})," Mandate & History"]}),m.jsx("textarea",{value:e.descripcion||"",onChange:c=>u("descripcion",c.target.value),readOnly:!a,className:"w-full bg-transparent border-none outline-none text-slate-300 text-lg leading-relaxed min-h-[400px] resize-none",placeholder:"Detail the motives, the structure, and the legacy of this group..."})]})})]})]}):m.jsx("div",{className:"p-20 text-center text-red-500",children:"Collective not found in the records."})},_G=()=>m.jsx("div",{className:"flex-1 flex overflow-hidden bg-background-dark font-sans text-slate-300",children:m.jsxs("main",{className:"flex-1 flex flex-col p-12 overflow-y-auto custom-scrollbar relative",children:[m.jsxs("header",{className:"mb-12 space-y-4",children:[m.jsxs("div",{className:"flex items-center gap-2 text-slate-500 font-bold text-[10px] tracking-widest uppercase",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"grid_view"}),m.jsx("span",{children:"Universo Alpha"}),m.jsx("span",{className:"material-symbols-outlined text-sm",children:"chevron_right"}),m.jsx("span",{children:"Galaxia Andrmeda"}),m.jsx("span",{className:"material-symbols-outlined text-sm",children:"chevron_right"}),m.jsx("span",{className:"text-white",children:"Sistema Solar"})]}),m.jsxs("div",{className:"flex justify-between items-start",children:[m.jsxs("div",{className:"space-y-4 max-w-3xl",children:[m.jsxs("div",{className:"flex items-center gap-3 px-3 py-1 rounded bg-orange-500/10 text-orange-400 border border-orange-500/20 inline-block",children:[m.jsx("span",{className:"material-symbols-outlined text-[14px]",children:"sunny"}),m.jsx("span",{className:"text-[9px] font-black uppercase tracking-widest",children:"Sistema Planetario"}),m.jsx("span",{className:"text-[9px] font-bold text-slate-600 tracking-widest ml-2",children:"ID: SYS-SOL-001"})]}),m.jsx("h1",{className:"text-6xl font-manrope font-black text-white tracking-tight",children:"Sistema Solar"}),m.jsx("p",{className:"text-slate-400 text-lg leading-relaxed",children:"Sistema planetario principal ubicado en el Brazo de Orin, hogar de la nica vida biolgica compleja confirmada en el sector galctico Alpha-9."})]}),m.jsxs("div",{className:"flex gap-3",children:[m.jsx("button",{className:"p-3 rounded-2xl bg-white/5 hover:bg-red-500/10 text-slate-500 hover:text-red-400 border border-white/5 transition-all outline-none",children:m.jsx("span",{className:"material-symbols-outlined",children:"delete"})}),m.jsx(Pn,{variant:"primary",icon:"save",children:"Guardar"})]})]})]}),m.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-12",children:[m.jsxs("div",{className:"lg:col-span-1 space-y-8",children:[m.jsxs("section",{className:"space-y-4",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-primary text-lg",children:"sell"}),m.jsx("h4",{className:"text-[10px] font-black uppercase tracking-[0.2em] text-slate-500",children:"Etiquetas"}),m.jsx("span",{className:"ml-auto text-[9px] font-bold text-slate-600 px-1.5 py-0.5 rounded bg-white/5",children:"3 ACTIVAS"})]}),m.jsxs("div",{className:"flex flex-wrap gap-2",children:[m.jsx(C2,{label:"Estrella Tipo G",color:"amber",icon:"star"}),m.jsx(C2,{label:"Vida Confirmada",color:"emerald",icon:"tempest"}),m.jsx(C2,{label:"Rico en Agua",color:"cyan",icon:"water_drop"}),m.jsx("button",{className:"size-8 rounded-full border border-dashed border-white/10 flex items-center justify-center text-slate-600 hover:text-white hover:border-white/30 transition-all",children:"+"})]})]}),m.jsxs("section",{className:"space-y-6",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-primary text-lg",children:"analytics"}),m.jsx("h4",{className:"text-[10px] font-black uppercase tracking-[0.2em] text-slate-500",children:"Atributos Principales"}),m.jsx("button",{className:"ml-auto text-slate-600 hover:text-white transition-colors",children:m.jsx("span",{className:"material-symbols-outlined text-lg",children:"settings"})})]}),m.jsxs("div",{className:"space-y-4",children:[m.jsx(gy,{label:"Forma / Estructura",value:"Heliosfrica Estndar",icon:"hive"}),m.jsx(gy,{label:"Composicin",value:"Hidrgeno (74%), Helio (24%)",icon:"experiment"}),m.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[m.jsx(gy,{label:"Edad (Aos)",value:"4.6 MM",unit:"Aos"}),m.jsx(gy,{label:"Ciclo Orbital",value:"230 MM",unit:"Aos"})]})]})]}),m.jsxs("section",{className:"space-y-4",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-primary text-lg",children:"menu_book"}),m.jsx("h4",{className:"text-[10px] font-black uppercase tracking-[0.2em] text-slate-500",children:"Notas de Lore"})]}),m.jsx("textarea",{className:"w-full h-48 bg-white/5 border border-white/5 rounded-[2rem] p-6 text-sm text-slate-400 placeholder:text-slate-700 focus:border-primary/50 outline-none transition-all resize-none leading-relaxed italic shadow-inner",defaultValue:"El sistema contiene un cinturn de asteroides inusualmente denso entre el 4 y 5 planeta. Se teoriza que es el remanente de una colisin planetaria antigua conocida como 'El Gran Impacto' en las escrituras sagradas de los habitantes de Terra."})]})]}),m.jsx("div",{className:"lg:col-span-2",children:m.jsxs(Kn,{className:"h-full border-white/5 bg-surface-dark/40 overflow-hidden flex flex-col shadow-2xl",children:[m.jsxs("header",{className:"p-8 border-b border-white/5 flex justify-between items-center",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("div",{className:"size-10 rounded-xl bg-primary/20 text-primary flex items-center justify-center",children:m.jsx("span",{className:"material-symbols-outlined",children:"hub"})}),m.jsxs("div",{children:[m.jsx("h3",{className:"font-bold text-white text-lg tracking-tight",children:"Contenido Interno (Planetas)"}),m.jsx("p",{className:"text-[10px] font-medium text-slate-500 mt-0.5",children:"Arrastra para reordenar la jerarqua orbital"})]})]}),m.jsxs("div",{className:"px-3 py-1 rounded-full bg-emerald-500/10 text-emerald-400 border border-emerald-500/20 text-[10px] font-black uppercase tracking-widest flex items-center gap-2",children:[m.jsx("div",{className:"size-1.5 rounded-full bg-emerald-500 animate-pulse"}),"8 Entidades"]})]}),m.jsxs("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-6 space-y-3",children:[m.jsx(Qm,{name:"Mercurio",type:"Rocoso",stats:"430C | 88 Das",icon:"public"}),m.jsx(Qm,{name:"Venus",type:"Atmsfera",stats:"462C | 225 Das",icon:"public"}),m.jsx(Qm,{name:"Tierra",type:"Habitable",stats:"8B Hab | 1 Luna",icon:"public",active:!0}),m.jsx(Qm,{name:"Marte",type:"Desierto",stats:"-60C | 2 Lunas",icon:"public"}),m.jsx(Qm,{name:"Cinturn Asteroides",type:"Anillo",stats:">1M Obj",icon:"grain"})]}),m.jsx("div",{className:"p-8 bg-black/20 border-t border-white/5",children:m.jsxs("button",{className:"w-full py-4 rounded-[1.5rem] border-2 border-dashed border-white/10 text-slate-500 hover:text-white hover:border-primary/50 hover:bg-primary/5 transition-all flex items-center justify-center gap-3 font-black uppercase text-[10px] tracking-[0.2em]",children:[m.jsx("span",{className:"material-symbols-outlined",children:"add"}),"Aadir Nueva Entidad"]})})]})})]})]})}),C2=({label:t,color:e,icon:r})=>m.jsxs("div",{className:`px-4 py-1.5 rounded-xl bg-${e}-500/10 text-${e}-400 border border-${e}-500/20 flex items-center gap-2 text-[10px] font-black uppercase tracking-widest shadow-lg`,children:[m.jsx("span",{className:"material-symbols-outlined text-[14px]",children:r}),t]}),gy=({label:t,value:e,unit:r,icon:n})=>m.jsxs("div",{className:"space-y-2",children:[m.jsx("p",{className:"text-[9px] font-black uppercase tracking-widest text-slate-600 ml-1",children:t}),m.jsxs("div",{className:"w-full bg-white/5 border border-white/5 rounded-2xl px-5 py-3.5 flex items-center justify-between group hover:border-white/10 transition-all",children:[m.jsxs("div",{className:"flex items-center gap-3",children:[n&&m.jsx("span",{className:"material-symbols-outlined text-slate-500 text-lg group-hover:text-primary transition-colors",children:n}),m.jsx("span",{className:"text-sm font-bold text-slate-300",children:e})]}),r&&m.jsx("span",{className:"text-[10px] font-black text-slate-600 uppercase tracking-widest",children:r})]})]}),Qm=({name:t,type:e,stats:r,icon:n,active:i})=>m.jsxs("div",{className:`group flex items-center gap-6 p-4 rounded-2xl transition-all cursor-pointer ${i?"bg-primary/10 border border-primary/20 shadow-xl":"hover:bg-white/5 border border-transparent"}`,children:[m.jsx("span",{className:"material-symbols-outlined text-slate-700 group-hover:text-slate-500",children:"drag_indicator"}),m.jsx("div",{className:`size-12 rounded-xl flex items-center justify-center ${i?"bg-primary text-white shadow-lg shadow-primary/30":"bg-surface-dark border border-white/5 text-slate-500"}`,children:m.jsx("span",{className:"material-symbols-outlined text-3xl",children:n})}),m.jsx("div",{className:"flex-1",children:m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsx("h4",{className:"text-sm font-bold text-white group-hover:text-primary transition-colors",children:t}),m.jsx("span",{className:`text-[8px] font-black px-1.5 py-0.5 rounded uppercase tracking-widest ${i?"bg-emerald-500/20 text-emerald-400 border border-emerald-500/30":"bg-white/5 text-slate-600"}`,children:e})]})}),m.jsx("div",{className:"flex flex-col items-end gap-1",children:m.jsxs("div",{className:"flex items-center gap-1.5 text-slate-500",children:[m.jsx("span",{className:"material-symbols-outlined text-[12px]",children:"analytics"}),m.jsx("span",{className:"text-[10px] font-mono tracking-tight group-hover:text-slate-300",children:r})]})}),m.jsxs("div",{className:"flex gap-2 ml-4",children:[m.jsx("button",{className:"p-2 rounded-lg text-slate-700 hover:text-white hover:bg-white/5 transition-all",children:m.jsx("span",{className:"material-symbols-outlined text-xl",children:"edit_note"})}),i?m.jsx("button",{className:"size-8 rounded-full bg-primary text-white flex items-center justify-center shadow-lg",children:m.jsx("span",{className:"material-symbols-outlined text-lg",children:"arrow_forward"})}):m.jsx("button",{className:"p-2 rounded-lg text-slate-700 hover:text-white hover:bg-white/5 transition-all",children:m.jsx("span",{className:"material-symbols-outlined text-xl",children:"open_in_new"})})]})]}),CG=()=>m.jsx("div",{className:"flex-1 flex overflow-hidden bg-background-dark font-sans text-slate-300",children:m.jsxs("main",{className:"flex-1 flex flex-col p-12 overflow-y-auto custom-scrollbar relative",children:[m.jsxs("header",{className:"mb-12 space-y-4",children:[m.jsxs("div",{className:"flex items-center gap-2 text-slate-500 font-bold text-[10px] tracking-widest uppercase",children:[m.jsx("span",{children:"Sistema Solar"}),m.jsx("span",{className:"material-symbols-outlined text-sm",children:"chevron_right"}),m.jsx("span",{children:"Kepler-186f"}),m.jsx("span",{className:"material-symbols-outlined text-sm",children:"chevron_right"}),m.jsx("span",{className:"text-white",children:"Territorios"})]}),m.jsxs("div",{className:"flex justify-between items-end",children:[m.jsxs("div",{children:[m.jsxs("div",{className:"flex items-center gap-4 mb-2",children:[m.jsx("h1",{className:"text-6xl font-manrope font-black text-white tracking-tight",children:"Kepler-186f"}),m.jsx("span",{className:"material-symbols-outlined text-4xl text-primary",children:"public"})]}),m.jsx("p",{className:"text-slate-400 text-lg max-w-2xl leading-relaxed",children:"Gestin geopoltica y geogrfica de la superficie planetaria. Administra biomas, asentamientos y recursos estratgicos."})]}),m.jsxs("div",{className:"flex gap-3",children:[m.jsx(Pn,{variant:"secondary",icon:"map",children:"Ver Atlas"}),m.jsx(Pn,{variant:"primary",icon:"add",children:"Nuevo Territorio"})]})]})]}),m.jsxs("section",{className:"space-y-8",children:[m.jsxs(Kn,{className:"p-2 flex items-center justify-between border-white/5",children:[m.jsxs("div",{className:"flex items-center gap-4 flex-1",children:[m.jsxs("div",{className:"relative flex-1 max-w-sm",children:[m.jsx("span",{className:"material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-slate-500 text-sm",children:"search"}),m.jsx("input",{type:"text",placeholder:"Buscar por nombre...",className:"w-full bg-transparent border-none rounded-xl py-2 pl-9 pr-4 text-xs focus:ring-1 focus:ring-primary/30 outline-none transition-all"})]}),m.jsx("div",{className:"w-px h-6 bg-white/5 mx-2"}),m.jsx(E2,{label:"Bioma: Todos"}),m.jsx(E2,{label:"Poblacin"}),m.jsx(E2,{label:"Estado"})]}),m.jsxs("div",{className:"flex items-center gap-1 p-1 bg-white/5 rounded-lg",children:[m.jsx("button",{className:"p-1.5 rounded-md text-slate-500 hover:text-white transition-colors",children:m.jsx("span",{className:"material-symbols-outlined text-lg",children:"format_list_bulleted"})}),m.jsx("button",{className:"p-1.5 rounded-md bg-white/10 text-white shadow-sm",children:m.jsx("span",{className:"material-symbols-outlined text-lg",children:"grid_view"})})]})]}),m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:[m.jsx(T2,{title:"Nueva Neo-Tokyo",desc:"Metrpolis vertical construida sobre las...",image:"https://lh3.googleusercontent.com/aida-public/AB6AXuAYF5Q6W3o1w1f1",badges:["Capital"],stats:["15M","Templado","Costero"],color:"cyan"}),m.jsx(T2,{title:"Mar de Dunas",desc:"Extensin rida rica en especia slica...",image:"https://lh3.googleusercontent.com/aida-public/AB6AXuBYG6R7X4p2x2g2",stats:["Hostil","rido"],color:"amber"}),m.jsx(T2,{title:"Sanctum Bio-Domo",desc:"Instalacin de investigacin...",image:"https://lh3.googleusercontent.com/aida-public/AB6AXuCZ H7S8Y5q3z3h3",badges:["Ciencia"],stats:["5K","Jungla"],color:"purple"}),m.jsxs("div",{className:"group border-2 border-dashed border-white/5 rounded-[2.5rem] flex flex-col items-center justify-center p-12 gap-4 hover:border-primary/30 hover:bg-primary/5 transition-all cursor-pointer",children:[m.jsx("div",{className:"size-16 rounded-3xl bg-white/5 flex items-center justify-center group-hover:scale-110 transition-transform",children:m.jsx("span",{className:"material-symbols-outlined text-3xl text-slate-600 group-hover:text-primary",children:"add_location_alt"})}),m.jsx("p",{className:"text-xs font-black uppercase tracking-widest text-slate-600 group-hover:text-white",children:"Aadir Territorio"})]})]})]})]})}),E2=({label:t})=>m.jsxs("button",{className:"flex items-center gap-2 px-3 py-1.5 rounded-xl hover:bg-white/5 transition-all group",children:[m.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest text-slate-500 group-hover:text-white",children:t}),m.jsx("span",{className:"material-symbols-outlined text-slate-600 text-[14px]",children:"expand_more"})]}),T2=({title:t,desc:e,image:r,badges:n=[],stats:i=[],color:a})=>m.jsxs("div",{className:"group relative rounded-[2.5rem] overflow-hidden border border-white/5 bg-surface-dark/50 hover:border-white/10 transition-all shadow-2xl",children:[m.jsxs("div",{className:"h-48 overflow-hidden relative",children:[m.jsx("img",{src:r,alt:t,className:"w-full h-full object-cover transition-transform duration-700 group-hover:scale-110 opacity-60 group-hover:opacity-100"}),m.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-surface-dark via-transparent to-transparent"}),m.jsx("div",{className:"absolute top-4 right-4 flex gap-2",children:n.map(s=>m.jsxs("span",{className:`px-3 py-1 rounded-full text-[9px] font-black uppercase tracking-widest bg-${a==="cyan"?"primary":a==="amber"?"amber-500":"purple-500"}/20 text-${a==="cyan"?"primary":a==="amber"?"amber-400":"purple-400"} border border-white/10 backdrop-blur-md flex items-center gap-1.5`,children:[m.jsx("span",{className:"material-symbols-outlined text-[12px]",children:s==="Capital"?"star":"science"}),s]},s))})]}),m.jsxs("div",{className:"p-8 space-y-6",children:[m.jsxs("header",{className:"flex justify-between items-start",children:[m.jsxs("div",{children:[m.jsx("h3",{className:"text-2xl font-manrope font-black text-white mb-2 group-hover:text-primary transition-colors",children:t}),m.jsx("p",{className:"text-xs text-slate-500 leading-relaxed line-clamp-2",children:e})]}),m.jsx("button",{className:"p-2 text-slate-700 hover:text-white",children:m.jsx("span",{className:"material-symbols-outlined",children:"more_vert"})})]}),m.jsx("div",{className:"flex flex-wrap gap-2",children:i.map(s=>m.jsxs("div",{className:"flex items-center gap-1.5 px-3 py-1 rounded-full bg-white/5 border border-white/5 text-[9px] font-black text-slate-400 uppercase tracking-widest",children:[m.jsx("div",{className:`size-1.5 rounded-full bg-${a==="cyan"?"primary":a==="amber"?"amber-500":"purple-500"}/50`}),s]},s))}),m.jsxs("div",{className:"flex gap-3 pt-2",children:[m.jsxs("button",{className:"flex-1 py-2.5 rounded-xl bg-white/5 hover:bg-white/10 border border-white/5 text-[10px] font-black uppercase tracking-widest text-slate-300 flex items-center justify-center gap-2 transition-all",children:[m.jsx("span",{className:"material-symbols-outlined text-sm opacity-50",children:"edit"})," Editar"]}),m.jsxs("button",{className:"flex-1 py-2.5 rounded-xl bg-white/5 hover:bg-white/10 border border-white/5 text-[10px] font-black uppercase tracking-widest text-slate-300 flex items-center justify-center gap-2 transition-all",children:[m.jsx("span",{className:"material-symbols-outlined text-sm opacity-50",children:"map"})," Ubicacin"]})]})]})]}),EG=()=>{const{type:t,entityId:e}=Va(),r=()=>{const n=t?.toLowerCase();switch(n){case"character":case"entidadindividual":return m.jsx(SG,{id:e});case"location":case"zona":return m.jsx(d5,{id:e});case"culture":case"entidadcolectiva":return m.jsx(kG,{id:e});case"universe":case"galaxy":case"system":return m.jsx(_G,{id:e,type:n});case"planet":return m.jsx(CG,{id:e});case"construccion":return m.jsx(d5,{id:e});case"efectos":return m.jsxs("div",{className:"p-8 text-white",children:["Effect/Spell View for ID: ",e]});case"interaccion":return m.jsxs("div",{className:"p-8 text-white",children:["Interaction/Event View for ID: ",e]});case"magic":return m.jsxs("div",{className:"p-8 text-white",children:["Magic System View for ID: ",id]});default:return m.jsxs("div",{className:"p-8 text-white",children:["Unknown Entity Type: ",t]})}};return m.jsx("div",{className:"flex-1 bg-background-dark overflow-hidden",children:r()})},TG=()=>{const{t}=Ps(),{setRightPanelTab:e,setRightOpen:r,setRightPanelTitle:n,setRightPanelMode:i}=bo(),[a,s]=ne.useState([]),[o,l]=ne.useState(null),[u,c]=ne.useState([]),[f,p]=ne.useState(!0),[g,y]=ne.useState(!1),[S,w]=ne.useState(!1),[C,_]=ne.useState({nombre:"",descripcion:"",fechaTexto:"",ordenAbsoluto:0}),[T,N]=ne.useState({nombre:"",descripcion:""}),[R,D]=ne.useState(null),[j,O]=ne.useState(null),[F,z]=ne.useState(null),[G,Z]=ne.useState([]),[I,W]=ne.useState(""),[U,K]=ne.useState([]),[$,Q]=ne.useState("eventos");u.find(Ne=>Ne.id===F);const[ie,te]=ne.useState(null),X=Qt.useRef(!1);ne.useEffect(()=>{e&&e("CONTEXT");const Ne=setInterval(()=>{const qe=document.getElementById("global-right-panel-portal");qe&&(te(qe),clearInterval(Ne))},50);return()=>{console.log("[TimelineView] Cleanup: unmounting, clearing portal"),clearInterval(Ne);const qe=document.getElementById("global-right-panel-portal");qe?(console.log("[TimelineView] Portal found, clearing innerHTML"),qe.innerHTML=""):console.log("[TimelineView] Portal NOT found"),n&&n(null),e&&e("NOTEBOOKS")}},[e]);const[re,fe]=ne.useState([]),[oe,se]=ne.useState(null);ne.useEffect(()=>{X.current||(X.current=!0,ae())},[]);const he=Ne=>{n(m.jsxs("div",{className:"flex flex-col",children:[m.jsx("span",{children:t("timeline.title").toUpperCase()}),Ne&&m.jsx("span",{className:"text-[10px] text-slate-400 font-medium normal-case tracking-normal mt-0.5",children:Ne})]}))};ne.useEffect(()=>{if($==="eventos"||$==="anexos")if(o){const qe=re.flatMap(St=>St.lineasTemporales||[]).find(St=>St.id===o);he(qe?.nombre)}else he(null);else $==="universo"&&n(t("timeline.multiverse"))},[o,$,re]);const ae=async()=>{try{const Ne=await $e.get("/multiverso/list");if(fe(Ne),!o&&Ne.length>0){const qe=Ne[0];qe.lineasTemporales&&qe.lineasTemporales.length>0&&l(qe.lineasTemporales[0].id)}}catch(Ne){console.error("Failed to load multiverse",Ne)}};ne.useEffect(()=>{o?pe(o):c([])},[o]);const pe=async Ne=>{try{const qe=await $e.get(`/timeline/linea/${Ne}/eventos`);qe.sort((St,it)=>(St.ordenAbsoluto||0)-(it.ordenAbsoluto||0)),c(qe)}catch(qe){console.error("Failed to load events",qe)}},ye=async()=>{if(!o||!C.nombre)return;const Ne={...C,ordenAbsoluto:parseInt(C.ordenAbsoluto)||0};try{R?await $e.put(`/timeline/evento/${R.id}`,{...Ne,lineaTiempo:{id:o}}):await $e.post("/timeline/evento",{...Ne,lineaTiempo:{id:o}}),_({nombre:"",descripcion:"",fechaTexto:"",ordenAbsoluto:0}),D(null),pe(o)}catch(qe){console.error(qe)}},ve=Ne=>{D(Ne),z(Ne.id),_({nombre:Ne.nombre,descripcion:Ne.descripcion,fechaTexto:Ne.fechaTexto,ordenAbsoluto:Ne.ordenAbsoluto||0}),Q("eventos"),r(!0),ue(Ne.id)},ue=async Ne=>{try{const St=(await $e.get("/bd/relacion")).filter(Ie=>Ie.idOrigen===Ne&&Ie.tipoOrigen==="evento"||Ie.idDestino===Ne&&Ie.tipoDestino==="evento"),it=await $e.get("/world-bible/entities"),lt=St.map(Ie=>{const de=Ie.idOrigen===Ne?Ie.idDestino:Ie.idOrigen,ge=it.find(ke=>ke.id===de);return ge?{...ge,relId:Ie.id}:null}).filter(Boolean);Z(lt)}catch(qe){console.error(qe)}},xe=async Ne=>{if(W(Ne),Ne.length<2){K([]);return}try{const St=(await $e.get("/world-bible/entities")).filter(it=>it.nombre.toLowerCase().includes(Ne.toLowerCase())&&it.tipoEspecial!=="map"&&it.tipoEspecial!=="timeline").slice(0,5);K(St)}catch(qe){console.error(qe)}},Se=async Ne=>{if(F)try{await $e.put("/bd/insertar",{tipoEntidad:"relacion",tipoOrigen:"evento",idOrigen:F,tipoDestino:"entidad",idDestino:Ne.id,descripcion:"Anexo de evento"}),W(""),K([]),ue(F)}catch(qe){console.error(qe)}},Ae=async Ne=>{try{await $e.delete(`/bd/relacion/${Ne}`),ue(F)}catch(qe){console.error(qe)}},Me=async()=>{if(!(!T.nombre||!T.universoId))try{const Ne=await $e.post("/timeline/linea",{...T,esRaiz:!1,universo:{id:T.universoId}});w(!1),N({nombre:"",descripcion:"",universoId:null}),await ae(),l(Ne.id)}catch(Ne){console.error("Error creating timeline:",Ne)}},[st,rt]=ne.useState({nombre:"",descripcion:""}),dt=async()=>{if(st.nombre)try{const Ne=await $e.post("/multiverso/crear",st);rt({nombre:"",descripcion:""}),r(!1),await ae()}catch(Ne){console.error("Error creating universe",Ne)}},Ct=async()=>{if(oe)try{await $e.put(`/multiverso/${oe}`,{nombre:st.nombre,descripcion:st.descripcion}),r(!1),await ae()}catch(Ne){console.error("Error updating universe",Ne)}},Ke=async()=>{if(oe&&window.confirm(t("timeline.delete_universe_confirm")))try{await $e.delete(`/multiverso/${oe}`),r(!1),se(null),await ae()}catch(Ne){console.error("Error deleting universe",Ne)}};ne.useEffect(()=>{if($==="universe-create")rt({nombre:"",descripcion:""});else if($==="universe-edit"&&oe){const Ne=re.find(qe=>qe.id===oe);Ne&&rt({nombre:Ne.nombre,descripcion:Ne.descripcion||""})}},[$,oe,re]);const[ut,ct]=ne.useState({open:!1,type:null,id:null,title:"",message:""}),xt=(Ne,qe)=>{qe.stopPropagation(),ct({open:!0,type:"TIMELINE",id:Ne,title:t("timeline.delete_line"),message:t("bible.delete_folder_msg")})},ot=(Ne,qe)=>{qe.stopPropagation(),ct({open:!0,type:"EVENT",id:Ne,title:t("timeline.delete_event"),message:t("common.are_you_sure")})},Lt=async()=>{const{type:Ne,id:qe}=ut;if(!(!Ne||!qe))try{if(Ne==="TIMELINE"){if(await $e.delete(`/timeline/linea/${qe}`),o===qe){const it=re.flatMap(lt=>lt.lineasTemporales||[]).filter(lt=>lt.id!==qe);l(it.length>0?it[0].id:null)}await ae()}else Ne==="EVENT"&&(await $e.delete(`/timeline/evento/${qe}`),pe(o),R&&R.id===qe&&D(null))}catch(St){console.error(St),alert(t("common.error_delete"))}},Bt=m.jsxs(m.Fragment,{children:[m.jsx("div",{className:"p-4 border-b border-white/5",children:m.jsxs("div",{className:"flex bg-black/40 rounded-lg p-1 overflow-x-auto gap-1",children:[m.jsx("button",{onClick:()=>Q("eventos"),className:`flex-1 py-2 text-xs font-bold uppercase tracking-wider rounded-md transition-all ${$==="eventos"?"bg-primary text-white shadow-lg":"text-slate-500 hover:text-slate-300"}`,children:t("timeline.events_tab")}),m.jsx("button",{onClick:()=>Q("anexos"),className:`flex-1 py-2 text-xs font-bold uppercase tracking-wider rounded-md transition-all ${$==="anexos"?"bg-primary text-white shadow-lg":"text-slate-500 hover:text-slate-300"}`,children:t("timeline.annexes_tab")}),m.jsx("button",{onClick:()=>Q("universo"),className:`flex-1 py-2 text-xs font-bold uppercase tracking-wider rounded-md transition-all ${$==="universo"?"bg-amber-600 text-white shadow-lg":"text-slate-500 hover:text-amber-500/80"}`,children:t("timeline.multiverse")})]})}),m.jsxs("div",{className:"flex-1 overflow-y-auto p-4 custom-scrollbar",children:[$==="eventos"&&m.jsx("div",{className:"space-y-6 animate-in fade-in slide-in-from-right-4",children:m.jsxs("div",{className:"bg-black/20 rounded-xl p-4 border border-white/5",children:[m.jsxs("h3",{className:"text-xs font-black uppercase text-primary mb-4 flex items-center justify-between",children:[t(R?"timeline.edit_event":"timeline.add_event"),R&&m.jsx("button",{onClick:()=>{D(null),_({nombre:"",descripcion:"",fechaTexto:"",ordenAbsoluto:u.length+1})},className:"text-[10px] text-slate-500 hover:text-white underline",children:t("common.cancel").toUpperCase()})]}),m.jsxs("div",{className:"space-y-3",children:[m.jsxs("div",{children:[m.jsx("label",{className:"text-[10px] text-slate-500 uppercase font-bold mb-1 block",children:t("timeline.event_name")}),m.jsx("input",{className:"w-full bg-background-dark border border-white/10 rounded-lg p-2 text-sm text-white outline-none focus:border-primary",value:C.nombre,onChange:Ne=>_({...C,nombre:Ne.target.value}),placeholder:t("timeline.event_name")})]}),m.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[m.jsxs("div",{children:[m.jsx("label",{className:"text-[10px] text-slate-500 uppercase font-bold mb-1 block",children:t("timeline.date_label")}),m.jsx("input",{className:"w-full bg-background-dark border border-white/10 rounded-lg p-2 text-sm text-white outline-none focus:border-primary",value:C.fechaTexto,onChange:Ne=>_({...C,fechaTexto:Ne.target.value}),placeholder:"e.g. Year 500"})]}),m.jsxs("div",{children:[m.jsx("label",{className:"text-[10px] text-slate-500 uppercase font-bold mb-1 block",children:t("timeline.order")}),m.jsx("input",{type:"text",className:"w-full bg-background-dark border border-white/10 rounded-lg p-2 text-sm text-white outline-none focus:border-primary",value:C.ordenAbsoluto,onChange:Ne=>{const qe=Ne.target.value;/^[-+]?\d*$/.test(qe)&&_({...C,ordenAbsoluto:qe})},placeholder:"+/- Num"})]})]}),m.jsxs("div",{children:[m.jsx("label",{className:"text-[10px] text-slate-500 uppercase font-bold mb-1 block",children:t("timeline.description")}),m.jsx("textarea",{className:"w-full bg-background-dark border border-white/10 rounded-lg p-2 text-sm text-white outline-none focus:border-primary h-24 resize-none",value:C.descripcion,onChange:Ne=>_({...C,descripcion:Ne.target.value}),placeholder:t("timeline.description")})]}),m.jsx("div",{className:"pt-2",children:m.jsx(Pn,{variant:"primary",onClick:ye,className:"w-full justify-center",children:t(R?"timeline.save_changes":"timeline.create_event")})}),R&&m.jsx("button",{onClick:Ne=>ot(R.id,Ne),className:"w-full text-center text-xs text-red-500 hover:text-red-400 py-2 border border-red-500/20 rounded-lg hover:bg-red-500/10 transition-colors",children:t("timeline.delete_event_btn")})]})]})}),$==="anexos"&&m.jsx("div",{className:"space-y-6 animate-in fade-in slide-in-from-right-4",children:F?m.jsx("div",{className:"space-y-6",children:m.jsxs("div",{className:"bg-black/20 rounded-xl p-4 border border-white/5",children:[m.jsx("h3",{className:"text-xs font-black uppercase text-primary mb-4",children:"Anexar Entidades"}),m.jsxs("div",{className:"relative mb-4",children:[m.jsx("span",{className:"material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-slate-500 text-sm",children:"search"}),m.jsx("input",{className:"w-full bg-background-dark border border-white/10 rounded-lg pl-9 pr-4 py-2 text-xs text-white outline-none focus:border-primary",placeholder:"Buscar personaje, lugar...",value:I,onChange:Ne=>xe(Ne.target.value)}),U.length>0&&m.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 bg-surface-dark border border-white/10 rounded-xl shadow-2xl z-50 overflow-hidden",children:U.map(Ne=>m.jsxs("button",{onClick:()=>Se(Ne),className:"w-full px-4 py-2 hover:bg-primary/20 text-left text-[10px] font-bold text-white/70 hover:text-white flex items-center justify-between",children:[m.jsx("span",{children:Ne.nombre}),m.jsx("span",{className:"text-[8px] opacity-40 uppercase",children:Ne.categoria})]},Ne.id))})]}),m.jsxs("div",{className:"space-y-2",children:[G.map(Ne=>m.jsxs("div",{className:"flex items-center justify-between p-2 bg-white/5 rounded-lg border border-white/5 group",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-xs text-primary/50",children:"link"}),m.jsx("span",{className:"text-xs font-bold text-slate-300",children:Ne.nombre})]}),m.jsx("button",{onClick:()=>Ae(Ne.relId),className:"opacity-0 group-hover:opacity-100 text-slate-500 hover:text-red-500 transition-opacity",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"link_off"})})]},Ne.id)),G.length===0&&m.jsx("p",{className:"text-[10px] text-slate-600 italic",children:"No hay entidades anexadas a este evento."})]})]})}):m.jsx("div",{className:"p-10 text-center opacity-30 italic text-xs",children:"Selecciona un evento para ver sus anexos."})}),$==="universo"&&m.jsx("div",{className:"space-y-6 animate-in fade-in slide-in-from-right-4",children:m.jsxs("div",{className:"bg-black/20 rounded-xl p-4 border border-white/5",children:[m.jsx("h3",{className:"text-xs font-black uppercase text-amber-500 mb-4",children:t(oe?"timeline.universe_settings":"timeline.new_universe")}),m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{children:[m.jsx("label",{className:"text-[10px] text-slate-500 uppercase font-bold mb-1 block",children:t("timeline.universe_name")}),m.jsx("input",{className:"w-full bg-background-dark border border-white/10 rounded-lg p-2 text-sm text-white outline-none focus:border-primary",value:st.nombre,onChange:Ne=>rt({...st,nombre:Ne.target.value}),placeholder:"e.g. Alternate Reality 1"})]}),m.jsxs("div",{children:[m.jsx("label",{className:"text-[10px] text-slate-500 uppercase font-bold mb-1 block",children:"Description"}),m.jsx("textarea",{className:"w-full bg-background-dark border border-white/10 rounded-lg p-2 text-sm text-white outline-none focus:border-primary h-24 resize-none",value:st.descripcion,onChange:Ne=>rt({...st,descripcion:Ne.target.value}),placeholder:t("timeline.universe_desc")})]}),m.jsx("div",{className:"pt-2",children:m.jsx(Pn,{variant:"primary",onClick:oe?Ct:dt,className:"w-full justify-center",children:t(oe?"common.save":"common.create")})}),oe&&m.jsx("button",{onClick:Ke,className:"w-full text-center text-xs text-red-500 hover:text-red-400 py-2 border border-red-500/20 rounded-lg hover:bg-red-500/10 transition-colors",children:t("common.delete")})]})]})})]})]});return m.jsxs("div",{className:"flex h-screen bg-background-dark text-white overflow-hidden",children:[ie&&eo.createPortal(Bt,ie),m.jsxs("aside",{className:"w-64 bg-surface-dark border-r border-white/5 flex flex-col p-4 z-20 shrink-0",children:[m.jsxs("header",{className:"flex justify-between items-center mb-6",children:[m.jsx("h2",{className:"text-xs font-black uppercase tracking-widest text-primary",children:t("timeline.multiverse")}),m.jsx("button",{onClick:()=>{i("CUSTOM"),Q("universo"),se(null),rt({nombre:"",descripcion:""}),r(!0)},className:"text-slate-400 hover:text-white",title:"New Universe",children:m.jsx("span",{className:"material-symbols-outlined",children:"add_circle"})})]}),m.jsx("div",{className:"space-y-6 overflow-y-auto flex-1 custom-scrollbar",children:re.map(Ne=>m.jsxs("div",{className:"space-y-2",children:[m.jsxs("div",{className:"flex items-center justify-between group",children:[m.jsx("h3",{className:`text-[10px] font-bold uppercase pl-2 cursor-pointer ${oe===Ne.id?"text-white":"text-slate-500"}`,onClick:()=>{se(Ne.id),rt({nombre:Ne.nombre,descripcion:Ne.descripcion||""}),Q("universo"),i("CUSTOM"),r(!0)},children:Ne.nombre}),m.jsx("div",{className:"flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:m.jsx("button",{onClick:()=>{N({...T,universoId:Ne.id}),w(!0)},className:"text-slate-500 hover:text-primary",title:"Add Timeline here",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"add"})})})]}),S&&T.universoId===Ne.id&&m.jsxs("div",{className:"ml-2 mb-2 p-2 bg-black/20 rounded-lg animate-in fade-in",children:[m.jsx("input",{className:"w-full bg-transparent border-b border-white/20 text-xs p-1 outline-none focus:border-primary mb-1",placeholder:"Timeline Name",value:T.nombre,onChange:qe=>N({...T,nombre:qe.target.value}),autoFocus:!0,onKeyDown:qe=>qe.key==="Enter"&&Me()}),m.jsxs("div",{className:"flex justify-end gap-1",children:[m.jsx("button",{onClick:()=>w(!1),className:"text-[10px] text-slate-500 hover:text-white",children:t("common.cancel").toUpperCase()}),m.jsx("button",{onClick:Me,className:"text-[10px] font-bold text-primary",children:t("common.create").toUpperCase()})]})]}),m.jsxs("div",{className:"space-y-1 pl-2 border-l border-white/5 ml-1",children:[Ne.lineasTemporales&&Ne.lineasTemporales.map(qe=>m.jsxs("div",{onClick:()=>{l(qe.id),Q("eventos"),i("CUSTOM"),r(!0)},className:`group flex items-center justify-between p-2 rounded-lg cursor-pointer transition-all ${o===qe.id?"bg-primary/10 text-white shadow-[0_0_10px_rgba(var(--primary-rgb),0.1)]":"text-slate-400 hover:bg-white/5"}`,children:[m.jsx("span",{className:"text-xs truncate",children:qe.nombre}),m.jsx("button",{onClick:St=>xt(qe.id,St),className:"opacity-0 group-hover:opacity-100 text-slate-500 hover:text-red-500 transition-opacity",children:m.jsx("span",{className:"material-symbols-outlined text-[10px]",children:"delete"})})]},qe.id)),(!Ne.lineasTemporales||Ne.lineasTemporales.length===0)&&m.jsx("div",{className:"p-2 text-[10px] italic text-slate-600",children:t("timeline.no_timelines")})]})]},Ne.id))})]}),m.jsxs("main",{className:"flex-1 relative flex flex-col h-full overflow-hidden bg-background-dark",children:[m.jsx("div",{className:"h-16 border-b border-white/5 bg-background-dark/80 backdrop-blur flex items-center px-8 z-10 shrink-0",children:m.jsx("div",{children:(()=>{const qe=re.flatMap(St=>St.lineasTemporales||[]).find(St=>St.id===o);return m.jsxs(m.Fragment,{children:[m.jsxs("h1",{className:"text-xl font-bold flex items-center gap-2",children:[qe?.esRaiz&&m.jsx("span",{className:"text-amber-400 material-symbols-outlined",children:"star"}),qe?.nombre||t("timeline.select_timeline")]}),m.jsx("p",{className:"text-xs text-slate-500",children:qe?.descripcion})]})})()})}),m.jsx("div",{className:"flex-1 overflow-y-auto p-8 relative custom-scrollbar z-10",children:m.jsxs("div",{className:"max-w-2xl mx-auto relative pl-8 border-l-2 border-white/10 space-y-8 pb-32",children:[u.length===0&&m.jsx("div",{className:"text-center text-slate-600 italic py-20",children:t("timeline.no_events")}),u.map((Ne,qe)=>m.jsxs("div",{className:"relative group animate-in fade-in slide-in-from-bottom-4",style:{animationDelay:`${qe*50}ms`},children:[m.jsx("div",{className:"absolute top-6 -left-[41px] size-4 rounded-full bg-white/20 border-4 border-background-dark group-hover:bg-primary transition-colors cursor-pointer",onClick:()=>ve(Ne)}),m.jsxs("div",{className:`ml-4 bg-surface-dark/50 border border-white/5 p-5 rounded-2xl hover:border-primary/30 transition-all hover:bg-surface-dark group-hover:translate-x-1 duration-300 relative group/card ${F===Ne.id?"ring-2 ring-primary border-primary/50 bg-primary/5":""}`,children:[m.jsxs("div",{className:"absolute top-3 right-3 opacity-0 group-hover/card:opacity-100 transition-opacity flex gap-1 bg-black/50 rounded-lg backdrop-blur-sm border border-white/5 p-1",children:[m.jsx("button",{onClick:()=>ve(Ne),className:"p-1.5 text-slate-400 hover:text-white hover:bg-white/10 rounded transition-colors",title:"Edit",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"edit"})}),m.jsx("button",{onClick:St=>ot(Ne.id,St),className:"p-1.5 text-slate-400 hover:text-red-500 hover:bg-red-500/10 rounded transition-colors",title:"Delete",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})})]}),m.jsx("div",{className:"flex justify-between items-start",onClick:()=>ve(Ne),children:m.jsxs("div",{className:"cursor-pointer",children:[m.jsxs("div",{className:"flex flex-col mb-1",children:[m.jsx("h3",{className:"text-lg font-bold text-white",children:Ne.nombre}),m.jsx("span",{className:"text-xs font-mono font-bold text-primary opacity-80",children:Ne.fechaTexto})]}),m.jsx("p",{className:"text-sm text-slate-400 leading-relaxed",children:Ne.descripcion})]})})]})]},Ne.id))]})})]}),m.jsx(Zv,{isOpen:ut.open,onClose:()=>ct({...ut,open:!1}),onConfirm:Lt,title:ut.title,message:ut.message,confirmText:t("common.delete"),type:"danger"})]})},NG=({onCancel:t,onCreate:e})=>{const[r,n]=ne.useState(1),[i,a]=ne.useState("regional"),[s,o]=ne.useState("upload"),[l,u]=ne.useState(null),[c,f]=ne.useState(""),p=Qt.useRef(null),g=w=>{const C=w.target.files?.[0];C&&C.type.startsWith("image/")&&(u(C),o("upload"))},y=()=>{p.current?.click()},S=()=>{e(s,c||"Nuevo Mapa",l)};return m.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-background-dark/80 backdrop-blur-xl animate-in fade-in duration-300",children:m.jsx("div",{className:"w-full max-w-4xl max-h-[90vh] overflow-y-auto no-scrollbar relative animate-in zoom-in-95 duration-500",children:m.jsxs(Kn,{className:"p-0 border-white/10 shadow-[0_0_100px_rgba(0,0,0,0.5)] overflow-hidden",children:[m.jsxs("header",{className:"p-8 border-b border-white/5 flex justify-between items-center bg-white/[0.02]",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("div",{className:"size-12 rounded-2xl bg-primary/20 text-primary flex items-center justify-center",children:m.jsx("span",{className:"material-symbols-outlined text-2xl",children:"add_location_alt"})}),m.jsxs("div",{children:[m.jsx("h1",{className:"text-2xl font-manrope font-black text-white tracking-tight",children:"Crear Nuevo Mapa / Zona"}),m.jsx("p",{className:"text-xs text-slate-500 font-medium",children:"Configura los detalles para tu nueva entrada cartogrfica."})]})]}),m.jsx("button",{onClick:t,className:"text-slate-500 hover:text-white transition-colors",children:m.jsx("span",{className:"material-symbols-outlined",children:"close"})})]}),m.jsxs("div",{className:"p-12 space-y-12",children:[m.jsxs("section",{className:"space-y-6",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("div",{className:`size-8 rounded-full flex items-center justify-center text-[10px] font-black ${r===1?"bg-primary text-white shadow-lg shadow-primary/30":"bg-white/10 text-slate-500"}`,children:"1"}),m.jsx("h2",{className:"text-sm font-black uppercase tracking-[0.2em] text-white",children:"Identidad y Jerarqua"})]}),m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8 pl-12",children:[m.jsxs("div",{className:"space-y-1.5",children:[m.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-slate-600 ml-1",children:"Nombre del Mapa"}),m.jsx("input",{type:"text",placeholder:"ej. La Costa de Zafiro",value:c,onChange:w=>f(w.target.value),className:"w-full bg-white/5 border border-white/5 rounded-2xl px-4 py-3 text-sm text-white focus:border-primary/50 transition-all outline-none"})]}),m.jsxs("div",{className:"space-y-1.5 row-span-2",children:[m.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-slate-600 ml-1",children:"Descripcin"}),m.jsx("textarea",{placeholder:"Breve descripcin de la geografa, clima o importancia...",className:"w-full h-[120px] bg-white/5 border border-white/5 rounded-2xl p-4 text-sm text-white focus:border-primary/50 outline-none transition-all resize-none"})]}),m.jsxs("div",{className:"space-y-1.5",children:[m.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-slate-600 ml-1",children:"Zona Padre (Opcional)"}),m.jsxs("select",{className:"w-full bg-[#1a1a20] border border-white/5 rounded-2xl px-4 py-3 text-sm text-white focus:border-primary/50 outline-none appearance-none",children:[m.jsx("option",{className:"bg-[#1a1a20] text-white",children:"Ninguna (Nivel Superior)"}),m.jsx("option",{className:"bg-[#1a1a20] text-white",children:"Reino de Aethelgard"}),m.jsx("option",{className:"bg-[#1a1a20] text-white",children:"Continente de Aurum"})]}),m.jsx("p",{className:"text-[9px] text-slate-500 italic mt-1 ml-1 text-primary/70",children:"Seleccionar un padre convierte esto en sub-zona."})]})]})]}),m.jsx("div",{className:"h-px w-full bg-white/5"}),m.jsxs("section",{className:"space-y-6",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("div",{className:`size-8 rounded-full flex items-center justify-center text-[10px] font-black ${r===2?"bg-primary text-white shadow-lg shadow-primary/30":"bg-white/10 text-slate-500"}`,children:"2"}),m.jsx("h2",{className:"text-sm font-black uppercase tracking-[0.2em] text-white",children:"Tipo de Mapa"})]}),m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 pl-12",children:[m.jsx(N2,{active:i==="world",onClick:()=>a("world"),icon:"public",label:"Mapa Mundial",desc:"Continentes, ocanos, escala global."}),m.jsx(N2,{active:i==="regional",onClick:()=>a("regional"),icon:"map",label:"Mapa Regional",desc:"Reinos, provincias, biomas."}),m.jsx(N2,{active:i==="local",onClick:()=>a("local"),icon:"location_city",label:"Ciudad / Local",desc:"Ciudades, mazmorras, mapas de batalla."})]})]}),m.jsx("div",{className:"h-px w-full bg-white/5"}),m.jsxs("section",{className:"space-y-6",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("div",{className:`size-8 rounded-full flex items-center justify-center text-[10px] font-black ${r===3?"bg-primary text-white shadow-lg shadow-primary/30":"bg-white/10 text-slate-500"}`,children:"3"}),m.jsx("h2",{className:"text-sm font-black uppercase tracking-[0.2em] text-white",children:"Fuente del Lienzo"})]}),m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 pl-12",children:[m.jsx("input",{ref:p,type:"file",accept:"image/*",onChange:g,className:"hidden"}),m.jsx(f5,{active:s==="upload",onClick:y,icon:"cloud_upload",label:l?l.name:"Cargar Archivo de Imagen",desc:l?"Archivo seleccionado":"Arrastra y suelta o haz clic para buscar",subdesc:"JPG, PNG, WEBP  MAX 25MB"}),m.jsx(f5,{active:s==="blank",onClick:()=>o("blank"),icon:"brush",label:"Lienzo en Blanco",desc:"Crear un nuevo dibujo desde cero",subdesc:"4096 px x 4096 px"})]})]})]}),m.jsxs("footer",{className:"p-8 bg-white/[0.02] border-t border-white/5 flex justify-between items-center",children:[m.jsx("button",{onClick:t,className:"text-sm font-bold text-slate-500 hover:text-white transition-colors",children:"Cancelar"}),m.jsxs("div",{className:"flex items-center gap-6",children:[m.jsx("span",{className:"text-[9px] font-black uppercase tracking-widest text-slate-600",children:"Cambios guardados localmente"}),m.jsx(Pn,{variant:"primary",className:"px-10 py-3 shadow-xl",onClick:S,children:"Crear Mapa"})]})]})]})})})},N2=({active:t,onClick:e,icon:r,label:n,desc:i})=>m.jsxs("div",{onClick:e,className:`p-6 rounded-3xl border transition-all cursor-pointer group ${t?"bg-primary/10 border-primary shadow-lg shadow-primary/10":"bg-white/5 border-white/5 hover:border-white/10"}`,children:[m.jsx("div",{className:`size-10 rounded-xl mb-4 flex items-center justify-center transition-all ${t?"bg-primary text-white":"bg-white/5 text-slate-500 group-hover:text-slate-300"}`,children:m.jsx("span",{className:"material-symbols-outlined",children:r})}),m.jsx("h3",{className:`text-sm font-bold mb-1 transition-colors ${t?"text-white":"text-slate-400 group-hover:text-slate-200"}`,children:n}),m.jsx("p",{className:"text-[10px] text-slate-500 leading-relaxed font-medium",children:i})]}),f5=({active:t,onClick:e,icon:r,label:n,desc:i,subdesc:a})=>m.jsxs("div",{onClick:e,className:`p-10 rounded-[2.5rem] border transition-all cursor-pointer group flex flex-col items-center text-center gap-4 ${t?"bg-primary/5 border-primary shadow-lg":"bg-white/[0.02] border-white/5 hover:border-white/10 hover:bg-white/[0.04]"}`,children:[m.jsx("div",{className:`size-16 rounded-[2rem] flex items-center justify-center transition-all ${t?"bg-primary text-white shadow-xl shadow-primary/20":"bg-white/5 text-slate-600 group-hover:text-slate-400"}`,children:m.jsx("span",{className:"material-symbols-outlined text-3xl",children:r})}),m.jsxs("div",{className:"space-y-1",children:[m.jsx("h3",{className:`font-bold transition-colors ${t?"text-white":"text-slate-400"}`,children:n}),m.jsx("p",{className:"text-xs text-slate-500 font-medium",children:i})]}),m.jsx("div",{className:"flex gap-2 mt-2",children:a.split("").map((s,o)=>m.jsx("span",{className:"px-2 py-1 rounded bg-black/20 text-[8px] font-black text-slate-600 tracking-tighter uppercase whitespace-nowrap",children:s.trim()},o))})]});var Zy={exports:{}},Jm={},P2={},M2={},h5;function Nr(){return h5||(h5=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t._registerNode=t.Konva=t.glob=void 0;const e=Math.PI/180;function r(){return typeof window<"u"&&({}.toString.call(window)==="[object Window]"||{}.toString.call(window)==="[object global]")}t.glob=typeof hE<"u"?hE:typeof window<"u"?window:typeof WorkerGlobalScope<"u"?self:{},t.Konva={_global:t.glob,version:"9.3.16",isBrowser:r(),isUnminified:/param/.test((function(i){}).toString()),dblClickWindow:400,getAngle(i){return t.Konva.angleDeg?i*e:i},enableTrace:!1,pointerEventsEnabled:!0,autoDrawEnabled:!0,hitOnDragEnabled:!1,capturePointerEventsEnabled:!1,_mouseListenClick:!1,_touchListenClick:!1,_pointerListenClick:!1,_mouseInDblClickWindow:!1,_touchInDblClickWindow:!1,_pointerInDblClickWindow:!1,_mouseDblClickPointerId:null,_touchDblClickPointerId:null,_pointerDblClickPointerId:null,_fixTextRendering:!1,pixelRatio:typeof window<"u"&&window.devicePixelRatio||1,dragDistance:3,angleDeg:!0,showWarnings:!0,dragButtons:[0,1],isDragging(){return t.Konva.DD.isDragging},isTransforming(){var i;return(i=t.Konva.Transformer)===null||i===void 0?void 0:i.isTransforming()},isDragReady(){return!!t.Konva.DD.node},releaseCanvasOnDestroy:!0,document:t.glob.document,_injectGlobal(i){t.glob.Konva=i}};const n=i=>{t.Konva[i.prototype.getClassName()]=i};t._registerNode=n,t.Konva._injectGlobal(t.Konva)})(M2)),M2}var A2={},p5;function pi(){return p5||(p5=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Util=t.Transform=void 0;const e=Nr();class r{constructor(N=[1,0,0,1,0,0]){this.dirty=!1,this.m=N&&N.slice()||[1,0,0,1,0,0]}reset(){this.m[0]=1,this.m[1]=0,this.m[2]=0,this.m[3]=1,this.m[4]=0,this.m[5]=0}copy(){return new r(this.m)}copyInto(N){N.m[0]=this.m[0],N.m[1]=this.m[1],N.m[2]=this.m[2],N.m[3]=this.m[3],N.m[4]=this.m[4],N.m[5]=this.m[5]}point(N){const R=this.m;return{x:R[0]*N.x+R[2]*N.y+R[4],y:R[1]*N.x+R[3]*N.y+R[5]}}translate(N,R){return this.m[4]+=this.m[0]*N+this.m[2]*R,this.m[5]+=this.m[1]*N+this.m[3]*R,this}scale(N,R){return this.m[0]*=N,this.m[1]*=N,this.m[2]*=R,this.m[3]*=R,this}rotate(N){const R=Math.cos(N),D=Math.sin(N),j=this.m[0]*R+this.m[2]*D,O=this.m[1]*R+this.m[3]*D,F=this.m[0]*-D+this.m[2]*R,z=this.m[1]*-D+this.m[3]*R;return this.m[0]=j,this.m[1]=O,this.m[2]=F,this.m[3]=z,this}getTranslation(){return{x:this.m[4],y:this.m[5]}}skew(N,R){const D=this.m[0]+this.m[2]*R,j=this.m[1]+this.m[3]*R,O=this.m[2]+this.m[0]*N,F=this.m[3]+this.m[1]*N;return this.m[0]=D,this.m[1]=j,this.m[2]=O,this.m[3]=F,this}multiply(N){const R=this.m[0]*N.m[0]+this.m[2]*N.m[1],D=this.m[1]*N.m[0]+this.m[3]*N.m[1],j=this.m[0]*N.m[2]+this.m[2]*N.m[3],O=this.m[1]*N.m[2]+this.m[3]*N.m[3],F=this.m[0]*N.m[4]+this.m[2]*N.m[5]+this.m[4],z=this.m[1]*N.m[4]+this.m[3]*N.m[5]+this.m[5];return this.m[0]=R,this.m[1]=D,this.m[2]=j,this.m[3]=O,this.m[4]=F,this.m[5]=z,this}invert(){const N=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),R=this.m[3]*N,D=-this.m[1]*N,j=-this.m[2]*N,O=this.m[0]*N,F=N*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),z=N*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);return this.m[0]=R,this.m[1]=D,this.m[2]=j,this.m[3]=O,this.m[4]=F,this.m[5]=z,this}getMatrix(){return this.m}decompose(){const N=this.m[0],R=this.m[1],D=this.m[2],j=this.m[3],O=this.m[4],F=this.m[5],z=N*j-R*D,G={x:O,y:F,rotation:0,scaleX:0,scaleY:0,skewX:0,skewY:0};if(N!=0||R!=0){const Z=Math.sqrt(N*N+R*R);G.rotation=R>0?Math.acos(N/Z):-Math.acos(N/Z),G.scaleX=Z,G.scaleY=z/Z,G.skewX=(N*D+R*j)/z,G.skewY=0}else if(D!=0||j!=0){const Z=Math.sqrt(D*D+j*j);G.rotation=Math.PI/2-(j>0?Math.acos(-D/Z):-Math.acos(D/Z)),G.scaleX=z/Z,G.scaleY=Z,G.skewX=0,G.skewY=(N*D+R*j)/z}return G.rotation=t.Util._getRotation(G.rotation),G}}t.Transform=r;let n="[object Array]",i="[object Number]",a="[object String]",s="[object Boolean]",o=Math.PI/180,l=180/Math.PI,u="#",c="",f="0",p="Konva warning: ",g="Konva error: ",y="rgb(",S={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,132,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,255,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,203],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[119,128,144],slategrey:[119,128,144],snow:[255,255,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],transparent:[255,255,255,0],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,5]},w=/rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)/,C=[];const _=typeof requestAnimationFrame<"u"&&requestAnimationFrame||function(T){setTimeout(T,60)};t.Util={_isElement(T){return!!(T&&T.nodeType==1)},_isFunction(T){return!!(T&&T.constructor&&T.call&&T.apply)},_isPlainObject(T){return!!T&&T.constructor===Object},_isArray(T){return Object.prototype.toString.call(T)===n},_isNumber(T){return Object.prototype.toString.call(T)===i&&!isNaN(T)&&isFinite(T)},_isString(T){return Object.prototype.toString.call(T)===a},_isBoolean(T){return Object.prototype.toString.call(T)===s},isObject(T){return T instanceof Object},isValidSelector(T){if(typeof T!="string")return!1;const N=T[0];return N==="#"||N==="."||N===N.toUpperCase()},_sign(T){return T===0||T>0?1:-1},requestAnimFrame(T){C.push(T),C.length===1&&_(function(){const N=C;C=[],N.forEach(function(R){R()})})},createCanvasElement(){const T=document.createElement("canvas");try{T.style=T.style||{}}catch{}return T},createImageElement(){return document.createElement("img")},_isInDocument(T){for(;T=T.parentNode;)if(T==document)return!0;return!1},_urlToImage(T,N){const R=t.Util.createImageElement();R.onload=function(){N(R)},R.src=T},_rgbToHex(T,N,R){return((1<<24)+(T<<16)+(N<<8)+R).toString(16).slice(1)},_hexToRgb(T){T=T.replace(u,c);const N=parseInt(T,16);return{r:N>>16&255,g:N>>8&255,b:N&255}},getRandomColor(){let T=(Math.random()*16777215<<0).toString(16);for(;T.length<6;)T=f+T;return u+T},getRGB(T){let N;return T in S?(N=S[T],{r:N[0],g:N[1],b:N[2]}):T[0]===u?this._hexToRgb(T.substring(1)):T.substr(0,4)===y?(N=w.exec(T.replace(/ /g,"")),{r:parseInt(N[1],10),g:parseInt(N[2],10),b:parseInt(N[3],10)}):{r:0,g:0,b:0}},colorToRGBA(T){return T=T||"black",t.Util._namedColorToRBA(T)||t.Util._hex3ColorToRGBA(T)||t.Util._hex4ColorToRGBA(T)||t.Util._hex6ColorToRGBA(T)||t.Util._hex8ColorToRGBA(T)||t.Util._rgbColorToRGBA(T)||t.Util._rgbaColorToRGBA(T)||t.Util._hslColorToRGBA(T)},_namedColorToRBA(T){const N=S[T.toLowerCase()];return N?{r:N[0],g:N[1],b:N[2],a:1}:null},_rgbColorToRGBA(T){if(T.indexOf("rgb(")===0){T=T.match(/rgb\(([^)]+)\)/)[1];const N=T.split(/ *, */).map(Number);return{r:N[0],g:N[1],b:N[2],a:1}}},_rgbaColorToRGBA(T){if(T.indexOf("rgba(")===0){T=T.match(/rgba\(([^)]+)\)/)[1];const N=T.split(/ *, */).map((R,D)=>R.slice(-1)==="%"?D===3?parseInt(R)/100:parseInt(R)/100*255:Number(R));return{r:N[0],g:N[1],b:N[2],a:N[3]}}},_hex8ColorToRGBA(T){if(T[0]==="#"&&T.length===9)return{r:parseInt(T.slice(1,3),16),g:parseInt(T.slice(3,5),16),b:parseInt(T.slice(5,7),16),a:parseInt(T.slice(7,9),16)/255}},_hex6ColorToRGBA(T){if(T[0]==="#"&&T.length===7)return{r:parseInt(T.slice(1,3),16),g:parseInt(T.slice(3,5),16),b:parseInt(T.slice(5,7),16),a:1}},_hex4ColorToRGBA(T){if(T[0]==="#"&&T.length===5)return{r:parseInt(T[1]+T[1],16),g:parseInt(T[2]+T[2],16),b:parseInt(T[3]+T[3],16),a:parseInt(T[4]+T[4],16)/255}},_hex3ColorToRGBA(T){if(T[0]==="#"&&T.length===4)return{r:parseInt(T[1]+T[1],16),g:parseInt(T[2]+T[2],16),b:parseInt(T[3]+T[3],16),a:1}},_hslColorToRGBA(T){if(/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.test(T)){const[N,...R]=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(T),D=Number(R[0])/360,j=Number(R[1])/100,O=Number(R[2])/100;let F,z,G;if(j===0)return G=O*255,{r:Math.round(G),g:Math.round(G),b:Math.round(G),a:1};O<.5?F=O*(1+j):F=O+j-O*j;const Z=2*O-F,I=[0,0,0];for(let W=0;W<3;W++)z=D+1/3*-(W-1),z<0&&z++,z>1&&z--,6*z<1?G=Z+(F-Z)*6*z:2*z<1?G=F:3*z<2?G=Z+(F-Z)*(2/3-z)*6:G=Z,I[W]=G*255;return{r:Math.round(I[0]),g:Math.round(I[1]),b:Math.round(I[2]),a:1}}},haveIntersection(T,N){return!(N.x>T.x+T.width||N.x+N.width<T.x||N.y>T.y+T.height||N.y+N.height<T.y)},cloneObject(T){const N={};for(const R in T)this._isPlainObject(T[R])?N[R]=this.cloneObject(T[R]):this._isArray(T[R])?N[R]=this.cloneArray(T[R]):N[R]=T[R];return N},cloneArray(T){return T.slice(0)},degToRad(T){return T*o},radToDeg(T){return T*l},_degToRad(T){return t.Util.warn("Util._degToRad is removed. Please use public Util.degToRad instead."),t.Util.degToRad(T)},_radToDeg(T){return t.Util.warn("Util._radToDeg is removed. Please use public Util.radToDeg instead."),t.Util.radToDeg(T)},_getRotation(T){return e.Konva.angleDeg?t.Util.radToDeg(T):T},_capitalize(T){return T.charAt(0).toUpperCase()+T.slice(1)},throw(T){throw new Error(g+T)},error(T){console.error(g+T)},warn(T){e.Konva.showWarnings&&console.warn(p+T)},each(T,N){for(const R in T)N(R,T[R])},_inRange(T,N,R){return N<=T&&T<R},_getProjectionToSegment(T,N,R,D,j,O){let F,z,G;const Z=(T-R)*(T-R)+(N-D)*(N-D);if(Z==0)F=T,z=N,G=(j-R)*(j-R)+(O-D)*(O-D);else{const I=((j-T)*(R-T)+(O-N)*(D-N))/Z;I<0?(F=T,z=N,G=(T-j)*(T-j)+(N-O)*(N-O)):I>1?(F=R,z=D,G=(R-j)*(R-j)+(D-O)*(D-O)):(F=T+I*(R-T),z=N+I*(D-N),G=(F-j)*(F-j)+(z-O)*(z-O))}return[F,z,G]},_getProjectionToLine(T,N,R){const D=t.Util.cloneObject(T);let j=Number.MAX_VALUE;return N.forEach(function(O,F){if(!R&&F===N.length-1)return;const z=N[(F+1)%N.length],G=t.Util._getProjectionToSegment(O.x,O.y,z.x,z.y,T.x,T.y),Z=G[0],I=G[1],W=G[2];W<j&&(D.x=Z,D.y=I,j=W)}),D},_prepareArrayForTween(T,N,R){let D,j=[],O=[];if(T.length>N.length){const z=N;N=T,T=z}for(D=0;D<T.length;D+=2)j.push({x:T[D],y:T[D+1]});for(D=0;D<N.length;D+=2)O.push({x:N[D],y:N[D+1]});const F=[];return O.forEach(function(z){const G=t.Util._getProjectionToLine(z,j,R);F.push(G.x),F.push(G.y)}),F},_prepareToStringify(T){let N;T.visitedByCircularReferenceRemoval=!0;for(const R in T)if(T.hasOwnProperty(R)&&T[R]&&typeof T[R]=="object"){if(N=Object.getOwnPropertyDescriptor(T,R),T[R].visitedByCircularReferenceRemoval||t.Util._isElement(T[R]))if(N.configurable)delete T[R];else return null;else if(t.Util._prepareToStringify(T[R])===null)if(N.configurable)delete T[R];else return null}return delete T.visitedByCircularReferenceRemoval,T},_assign(T,N){for(const R in N)T[R]=N[R];return T},_getFirstPointerId(T){return T.touches?T.changedTouches[0].identifier:T.pointerId||999},releaseCanvas(...T){e.Konva.releaseCanvasOnDestroy&&T.forEach(N=>{N.width=0,N.height=0})},drawRoundedRectPath(T,N,R,D){let j=0,O=0,F=0,z=0;typeof D=="number"?j=O=F=z=Math.min(D,N/2,R/2):(j=Math.min(D[0]||0,N/2,R/2),O=Math.min(D[1]||0,N/2,R/2),z=Math.min(D[2]||0,N/2,R/2),F=Math.min(D[3]||0,N/2,R/2)),T.moveTo(j,0),T.lineTo(N-O,0),T.arc(N-O,O,O,Math.PI*3/2,0,!1),T.lineTo(N,R-z),T.arc(N-z,R-z,z,0,Math.PI/2,!1),T.lineTo(F,R),T.arc(F,R-F,F,Math.PI/2,Math.PI,!1),T.lineTo(0,j),T.arc(j,j,j,Math.PI,Math.PI*3/2,!1)}}})(A2)),A2}var eg={},L2={},qs={},m5;function Dr(){if(m5)return qs;m5=1,Object.defineProperty(qs,"__esModule",{value:!0}),qs.RGBComponent=n,qs.alphaComponent=i,qs.getNumberValidator=a,qs.getNumberOrArrayOfNumbersValidator=s,qs.getNumberOrAutoValidator=o,qs.getStringValidator=l,qs.getStringOrGradientValidator=u,qs.getFunctionValidator=c,qs.getNumberArrayValidator=f,qs.getBooleanValidator=p,qs.getComponentValidator=g;const t=Nr(),e=pi();function r(y){return e.Util._isString(y)?'"'+y+'"':Object.prototype.toString.call(y)==="[object Number]"||e.Util._isBoolean(y)?y:Object.prototype.toString.call(y)}function n(y){return y>255?255:y<0?0:Math.round(y)}function i(y){return y>1?1:y<1e-4?1e-4:y}function a(){if(t.Konva.isUnminified)return function(y,S){return e.Util._isNumber(y)||e.Util.warn(r(y)+' is a not valid value for "'+S+'" attribute. The value should be a number.'),y}}function s(y){if(t.Konva.isUnminified)return function(S,w){const C=e.Util._isNumber(S),_=e.Util._isArray(S)&&S.length==y;return!C&&!_&&e.Util.warn(r(S)+' is a not valid value for "'+w+'" attribute. The value should be a number or Array<number>('+y+")"),S}}function o(){if(t.Konva.isUnminified)return function(y,S){return e.Util._isNumber(y)||y==="auto"||e.Util.warn(r(y)+' is a not valid value for "'+S+'" attribute. The value should be a number or "auto".'),y}}function l(){if(t.Konva.isUnminified)return function(y,S){return e.Util._isString(y)||e.Util.warn(r(y)+' is a not valid value for "'+S+'" attribute. The value should be a string.'),y}}function u(){if(t.Konva.isUnminified)return function(y,S){const w=e.Util._isString(y),C=Object.prototype.toString.call(y)==="[object CanvasGradient]"||y&&y.addColorStop;return w||C||e.Util.warn(r(y)+' is a not valid value for "'+S+'" attribute. The value should be a string or a native gradient.'),y}}function c(){if(t.Konva.isUnminified)return function(y,S){return e.Util._isFunction(y)||e.Util.warn(r(y)+' is a not valid value for "'+S+'" attribute. The value should be a function.'),y}}function f(){if(t.Konva.isUnminified)return function(y,S){const w=Int8Array?Object.getPrototypeOf(Int8Array):null;return w&&y instanceof w||(e.Util._isArray(y)?y.forEach(function(C){e.Util._isNumber(C)||e.Util.warn('"'+S+'" attribute has non numeric element '+C+". Make sure that all elements are numbers.")}):e.Util.warn(r(y)+' is a not valid value for "'+S+'" attribute. The value should be a array of numbers.')),y}}function p(){if(t.Konva.isUnminified)return function(y,S){return y===!0||y===!1||e.Util.warn(r(y)+' is a not valid value for "'+S+'" attribute. The value should be a boolean.'),y}}function g(y){if(t.Konva.isUnminified)return function(S,w){return S==null||e.Util.isObject(S)||e.Util.warn(r(S)+' is a not valid value for "'+w+'" attribute. The value should be an object with properties '+y),S}}return qs}var g5;function Lr(){return g5||(g5=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Factory=void 0;const e=pi(),r=Dr(),n="get",i="set";t.Factory={addGetterSetter(a,s,o,l,u){t.Factory.addGetter(a,s,o),t.Factory.addSetter(a,s,l,u),t.Factory.addOverloadedGetterSetter(a,s)},addGetter(a,s,o){const l=n+e.Util._capitalize(s);a.prototype[l]=a.prototype[l]||function(){const u=this.attrs[s];return u===void 0?o:u}},addSetter(a,s,o,l){const u=i+e.Util._capitalize(s);a.prototype[u]||t.Factory.overWriteSetter(a,s,o,l)},overWriteSetter(a,s,o,l){const u=i+e.Util._capitalize(s);a.prototype[u]=function(c){return o&&c!==void 0&&c!==null&&(c=o.call(this,c,s)),this._setAttr(s,c),l&&l.call(this),this}},addComponentsGetterSetter(a,s,o,l,u){let c=o.length,f=e.Util._capitalize,p=n+f(s),g=i+f(s),y,S;a.prototype[p]=function(){const C={};for(y=0;y<c;y++)S=o[y],C[S]=this.getAttr(s+f(S));return C};const w=(0,r.getComponentValidator)(o);a.prototype[g]=function(C){let _=this.attrs[s],T;l&&(C=l.call(this,C)),w&&w.call(this,C,s);for(T in C)C.hasOwnProperty(T)&&this._setAttr(s+f(T),C[T]);return C||o.forEach(N=>{this._setAttr(s+f(N),void 0)}),this._fireChangeEvent(s,_,C),u&&u.call(this),this},t.Factory.addOverloadedGetterSetter(a,s)},addOverloadedGetterSetter(a,s){const o=e.Util._capitalize(s),l=i+o,u=n+o;a.prototype[s]=function(){return arguments.length?(this[l](arguments[0]),this):this[u]()}},addDeprecatedGetterSetter(a,s,o,l){e.Util.error("Adding deprecated "+s);const u=n+e.Util._capitalize(s),c=s+" property is deprecated and will be removed soon. Look at Konva change log for more information.";a.prototype[u]=function(){e.Util.error(c);const f=this.attrs[s];return f===void 0?o:f},t.Factory.addSetter(a,s,l,function(){e.Util.error(c)}),t.Factory.addOverloadedGetterSetter(a,s)},backCompat(a,s){e.Util.each(s,function(o,l){const u=a.prototype[l],c=n+e.Util._capitalize(o),f=i+e.Util._capitalize(o);function p(){u.apply(this,arguments),e.Util.error('"'+o+'" method is deprecated and will be removed soon. Use ""'+l+'" instead.')}a.prototype[o]=p,a.prototype[c]=p,a.prototype[f]=p})},afterSetFilter(){this._filterUpToDate=!1}}})(L2)),L2}var ic={},ac={},v5;function NL(){if(v5)return ac;v5=1,Object.defineProperty(ac,"__esModule",{value:!0}),ac.HitContext=ac.SceneContext=ac.Context=void 0;const t=pi(),e=Nr();function r(C){let _=[],T=C.length,N=t.Util,R,D;for(R=0;R<T;R++)D=C[R],N._isNumber(D)?D=Math.round(D*1e3)/1e3:N._isString(D)||(D=D+""),_.push(D);return _}const n=",",i="(",a=")",s="([",o="])",l=";",u="()",c="=",f=["arc","arcTo","beginPath","bezierCurveTo","clearRect","clip","closePath","createLinearGradient","createPattern","createRadialGradient","drawImage","ellipse","fill","fillText","getImageData","createImageData","lineTo","moveTo","putImageData","quadraticCurveTo","rect","roundRect","restore","rotate","save","scale","setLineDash","setTransform","stroke","strokeText","transform","translate"],p=["fillStyle","strokeStyle","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","letterSpacing","lineCap","lineDashOffset","lineJoin","lineWidth","miterLimit","direction","font","textAlign","textBaseline","globalAlpha","globalCompositeOperation","imageSmoothingEnabled"],g=100;let y=class{constructor(_){this.canvas=_,e.Konva.enableTrace&&(this.traceArr=[],this._enableTrace())}fillShape(_){_.fillEnabled()&&this._fill(_)}_fill(_){}strokeShape(_){_.hasStroke()&&this._stroke(_)}_stroke(_){}fillStrokeShape(_){_.attrs.fillAfterStrokeEnabled?(this.strokeShape(_),this.fillShape(_)):(this.fillShape(_),this.strokeShape(_))}getTrace(_,T){let N=this.traceArr,R=N.length,D="",j,O,F,z;for(j=0;j<R;j++)O=N[j],F=O.method,F?(z=O.args,D+=F,_?D+=u:t.Util._isArray(z[0])?D+=s+z.join(n)+o:(T&&(z=z.map(G=>typeof G=="number"?Math.floor(G):G)),D+=i+z.join(n)+a)):(D+=O.property,_||(D+=c+O.val)),D+=l;return D}clearTrace(){this.traceArr=[]}_trace(_){let T=this.traceArr,N;T.push(_),N=T.length,N>=g&&T.shift()}reset(){const _=this.getCanvas().getPixelRatio();this.setTransform(1*_,0,0,1*_,0,0)}getCanvas(){return this.canvas}clear(_){const T=this.getCanvas();_?this.clearRect(_.x||0,_.y||0,_.width||0,_.height||0):this.clearRect(0,0,T.getWidth()/T.pixelRatio,T.getHeight()/T.pixelRatio)}_applyLineCap(_){const T=_.attrs.lineCap;T&&this.setAttr("lineCap",T)}_applyOpacity(_){const T=_.getAbsoluteOpacity();T!==1&&this.setAttr("globalAlpha",T)}_applyLineJoin(_){const T=_.attrs.lineJoin;T&&this.setAttr("lineJoin",T)}setAttr(_,T){this._context[_]=T}arc(_,T,N,R,D,j){this._context.arc(_,T,N,R,D,j)}arcTo(_,T,N,R,D){this._context.arcTo(_,T,N,R,D)}beginPath(){this._context.beginPath()}bezierCurveTo(_,T,N,R,D,j){this._context.bezierCurveTo(_,T,N,R,D,j)}clearRect(_,T,N,R){this._context.clearRect(_,T,N,R)}clip(..._){this._context.clip.apply(this._context,_)}closePath(){this._context.closePath()}createImageData(_,T){const N=arguments;if(N.length===2)return this._context.createImageData(_,T);if(N.length===1)return this._context.createImageData(_)}createLinearGradient(_,T,N,R){return this._context.createLinearGradient(_,T,N,R)}createPattern(_,T){return this._context.createPattern(_,T)}createRadialGradient(_,T,N,R,D,j){return this._context.createRadialGradient(_,T,N,R,D,j)}drawImage(_,T,N,R,D,j,O,F,z){const G=arguments,Z=this._context;G.length===3?Z.drawImage(_,T,N):G.length===5?Z.drawImage(_,T,N,R,D):G.length===9&&Z.drawImage(_,T,N,R,D,j,O,F,z)}ellipse(_,T,N,R,D,j,O,F){this._context.ellipse(_,T,N,R,D,j,O,F)}isPointInPath(_,T,N,R){return N?this._context.isPointInPath(N,_,T,R):this._context.isPointInPath(_,T,R)}fill(..._){this._context.fill.apply(this._context,_)}fillRect(_,T,N,R){this._context.fillRect(_,T,N,R)}strokeRect(_,T,N,R){this._context.strokeRect(_,T,N,R)}fillText(_,T,N,R){R?this._context.fillText(_,T,N,R):this._context.fillText(_,T,N)}measureText(_){return this._context.measureText(_)}getImageData(_,T,N,R){return this._context.getImageData(_,T,N,R)}lineTo(_,T){this._context.lineTo(_,T)}moveTo(_,T){this._context.moveTo(_,T)}rect(_,T,N,R){this._context.rect(_,T,N,R)}roundRect(_,T,N,R,D){this._context.roundRect(_,T,N,R,D)}putImageData(_,T,N){this._context.putImageData(_,T,N)}quadraticCurveTo(_,T,N,R){this._context.quadraticCurveTo(_,T,N,R)}restore(){this._context.restore()}rotate(_){this._context.rotate(_)}save(){this._context.save()}scale(_,T){this._context.scale(_,T)}setLineDash(_){this._context.setLineDash?this._context.setLineDash(_):"mozDash"in this._context?this._context.mozDash=_:"webkitLineDash"in this._context&&(this._context.webkitLineDash=_)}getLineDash(){return this._context.getLineDash()}setTransform(_,T,N,R,D,j){this._context.setTransform(_,T,N,R,D,j)}stroke(_){_?this._context.stroke(_):this._context.stroke()}strokeText(_,T,N,R){this._context.strokeText(_,T,N,R)}transform(_,T,N,R,D,j){this._context.transform(_,T,N,R,D,j)}translate(_,T){this._context.translate(_,T)}_enableTrace(){let _=this,T=f.length,N=this.setAttr,R,D;const j=function(O){let F=_[O],z;_[O]=function(){return D=r(Array.prototype.slice.call(arguments,0)),z=F.apply(_,arguments),_._trace({method:O,args:D}),z}};for(R=0;R<T;R++)j(f[R]);_.setAttr=function(){N.apply(_,arguments);const O=arguments[0];let F=arguments[1];(O==="shadowOffsetX"||O==="shadowOffsetY"||O==="shadowBlur")&&(F=F/this.canvas.getPixelRatio()),_._trace({property:O,val:F})}}_applyGlobalCompositeOperation(_){const T=_.attrs.globalCompositeOperation;!T||T==="source-over"||this.setAttr("globalCompositeOperation",T)}};ac.Context=y,p.forEach(function(C){Object.defineProperty(y.prototype,C,{get(){return this._context[C]},set(_){this._context[C]=_}})});class S extends y{constructor(_,{willReadFrequently:T=!1}={}){super(_),this._context=_._canvas.getContext("2d",{willReadFrequently:T})}_fillColor(_){const T=_.fill();this.setAttr("fillStyle",T),_._fillFunc(this)}_fillPattern(_){this.setAttr("fillStyle",_._getFillPattern()),_._fillFunc(this)}_fillLinearGradient(_){const T=_._getLinearGradient();T&&(this.setAttr("fillStyle",T),_._fillFunc(this))}_fillRadialGradient(_){const T=_._getRadialGradient();T&&(this.setAttr("fillStyle",T),_._fillFunc(this))}_fill(_){const T=_.fill(),N=_.getFillPriority();if(T&&N==="color"){this._fillColor(_);return}const R=_.getFillPatternImage();if(R&&N==="pattern"){this._fillPattern(_);return}const D=_.getFillLinearGradientColorStops();if(D&&N==="linear-gradient"){this._fillLinearGradient(_);return}const j=_.getFillRadialGradientColorStops();if(j&&N==="radial-gradient"){this._fillRadialGradient(_);return}T?this._fillColor(_):R?this._fillPattern(_):D?this._fillLinearGradient(_):j&&this._fillRadialGradient(_)}_strokeLinearGradient(_){const T=_.getStrokeLinearGradientStartPoint(),N=_.getStrokeLinearGradientEndPoint(),R=_.getStrokeLinearGradientColorStops(),D=this.createLinearGradient(T.x,T.y,N.x,N.y);if(R){for(let j=0;j<R.length;j+=2)D.addColorStop(R[j],R[j+1]);this.setAttr("strokeStyle",D)}}_stroke(_){const T=_.dash(),N=_.getStrokeScaleEnabled();if(_.hasStroke()){if(!N){this.save();const D=this.getCanvas().getPixelRatio();this.setTransform(D,0,0,D,0,0)}this._applyLineCap(_),T&&_.dashEnabled()&&(this.setLineDash(T),this.setAttr("lineDashOffset",_.dashOffset())),this.setAttr("lineWidth",_.strokeWidth()),_.getShadowForStrokeEnabled()||this.setAttr("shadowColor","rgba(0,0,0,0)"),_.getStrokeLinearGradientColorStops()?this._strokeLinearGradient(_):this.setAttr("strokeStyle",_.stroke()),_._strokeFunc(this),N||this.restore()}}_applyShadow(_){var T,N,R;const D=(T=_.getShadowRGBA())!==null&&T!==void 0?T:"black",j=(N=_.getShadowBlur())!==null&&N!==void 0?N:5,O=(R=_.getShadowOffset())!==null&&R!==void 0?R:{x:0,y:0},F=_.getAbsoluteScale(),z=this.canvas.getPixelRatio(),G=F.x*z,Z=F.y*z;this.setAttr("shadowColor",D),this.setAttr("shadowBlur",j*Math.min(Math.abs(G),Math.abs(Z))),this.setAttr("shadowOffsetX",O.x*G),this.setAttr("shadowOffsetY",O.y*Z)}}ac.SceneContext=S;class w extends y{constructor(_){super(_),this._context=_._canvas.getContext("2d",{willReadFrequently:!0})}_fill(_){this.save(),this.setAttr("fillStyle",_.colorKey),_._fillFuncHit(this),this.restore()}strokeShape(_){_.hasHitStroke()&&this._stroke(_)}_stroke(_){if(_.hasHitStroke()){const T=_.getStrokeScaleEnabled();if(!T){this.save();const D=this.getCanvas().getPixelRatio();this.setTransform(D,0,0,D,0,0)}this._applyLineCap(_);const N=_.hitStrokeWidth(),R=N==="auto"?_.strokeWidth():N;this.setAttr("lineWidth",R),this.setAttr("strokeStyle",_.colorKey),_._strokeFuncHit(this),T||this.restore()}}}return ac.HitContext=w,ac}var y5;function V1(){if(y5)return ic;y5=1,Object.defineProperty(ic,"__esModule",{value:!0}),ic.HitCanvas=ic.SceneCanvas=ic.Canvas=void 0;const t=pi(),e=NL(),r=Nr(),n=Lr(),i=Dr();let a;function s(){if(a)return a;const c=t.Util.createCanvasElement(),f=c.getContext("2d");return a=(function(){const p=r.Konva._global.devicePixelRatio||1,g=f.webkitBackingStorePixelRatio||f.mozBackingStorePixelRatio||f.msBackingStorePixelRatio||f.oBackingStorePixelRatio||f.backingStorePixelRatio||1;return p/g})(),t.Util.releaseCanvas(c),a}let o=class{constructor(f){this.pixelRatio=1,this.width=0,this.height=0,this.isCache=!1;const g=(f||{}).pixelRatio||r.Konva.pixelRatio||s();this.pixelRatio=g,this._canvas=t.Util.createCanvasElement(),this._canvas.style.padding="0",this._canvas.style.margin="0",this._canvas.style.border="0",this._canvas.style.background="transparent",this._canvas.style.position="absolute",this._canvas.style.top="0",this._canvas.style.left="0"}getContext(){return this.context}getPixelRatio(){return this.pixelRatio}setPixelRatio(f){const p=this.pixelRatio;this.pixelRatio=f,this.setSize(this.getWidth()/p,this.getHeight()/p)}setWidth(f){this.width=this._canvas.width=f*this.pixelRatio,this._canvas.style.width=f+"px";const p=this.pixelRatio;this.getContext()._context.scale(p,p)}setHeight(f){this.height=this._canvas.height=f*this.pixelRatio,this._canvas.style.height=f+"px";const p=this.pixelRatio;this.getContext()._context.scale(p,p)}getWidth(){return this.width}getHeight(){return this.height}setSize(f,p){this.setWidth(f||0),this.setHeight(p||0)}toDataURL(f,p){try{return this._canvas.toDataURL(f,p)}catch{try{return this._canvas.toDataURL()}catch(y){return t.Util.error("Unable to get data URL. "+y.message+" For more info read https://konvajs.org/docs/posts/Tainted_Canvas.html."),""}}}};ic.Canvas=o,n.Factory.addGetterSetter(o,"pixelRatio",void 0,(0,i.getNumberValidator)());class l extends o{constructor(f={width:0,height:0,willReadFrequently:!1}){super(f),this.context=new e.SceneContext(this,{willReadFrequently:f.willReadFrequently}),this.setSize(f.width,f.height)}}ic.SceneCanvas=l;class u extends o{constructor(f={width:0,height:0}){super(f),this.hitCanvas=!0,this.context=new e.HitContext(this),this.setSize(f.width,f.height)}}return ic.HitCanvas=u,ic}var R2={},x5;function T_(){return x5||(x5=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.DD=void 0;const e=Nr(),r=pi();t.DD={get isDragging(){let n=!1;return t.DD._dragElements.forEach(i=>{i.dragStatus==="dragging"&&(n=!0)}),n},justDragged:!1,get node(){let n;return t.DD._dragElements.forEach(i=>{n=i.node}),n},_dragElements:new Map,_drag(n){const i=[];t.DD._dragElements.forEach((a,s)=>{const{node:o}=a,l=o.getStage();l.setPointersPositions(n),a.pointerId===void 0&&(a.pointerId=r.Util._getFirstPointerId(n));const u=l._changedPointerPositions.find(c=>c.id===a.pointerId);if(u){if(a.dragStatus!=="dragging"){const c=o.dragDistance();if(Math.max(Math.abs(u.x-a.startPointerPos.x),Math.abs(u.y-a.startPointerPos.y))<c||(o.startDrag({evt:n}),!o.isDragging()))return}o._setDragPosition(n,a),i.push(o)}}),i.forEach(a=>{a.fire("dragmove",{type:"dragmove",target:a,evt:n},!0)})},_endDragBefore(n){const i=[];t.DD._dragElements.forEach(a=>{const{node:s}=a,o=s.getStage();if(n&&o.setPointersPositions(n),!o._changedPointerPositions.find(c=>c.id===a.pointerId))return;(a.dragStatus==="dragging"||a.dragStatus==="stopped")&&(t.DD.justDragged=!0,e.Konva._mouseListenClick=!1,e.Konva._touchListenClick=!1,e.Konva._pointerListenClick=!1,a.dragStatus="stopped");const u=a.node.getLayer()||a.node instanceof e.Konva.Stage&&a.node;u&&i.indexOf(u)===-1&&i.push(u)}),i.forEach(a=>{a.draw()})},_endDragAfter(n){t.DD._dragElements.forEach((i,a)=>{i.dragStatus==="stopped"&&i.node.fire("dragend",{type:"dragend",target:i.node,evt:n},!0),i.dragStatus!=="dragging"&&t.DD._dragElements.delete(a)})}},e.Konva.isBrowser&&(window.addEventListener("mouseup",t.DD._endDragBefore,!0),window.addEventListener("touchend",t.DD._endDragBefore,!0),window.addEventListener("touchcancel",t.DD._endDragBefore,!0),window.addEventListener("mousemove",t.DD._drag),window.addEventListener("touchmove",t.DD._drag),window.addEventListener("mouseup",t.DD._endDragAfter,!1),window.addEventListener("touchend",t.DD._endDragAfter,!1),window.addEventListener("touchcancel",t.DD._endDragAfter,!1))})(R2)),R2}var b5;function Ei(){if(b5)return eg;b5=1,Object.defineProperty(eg,"__esModule",{value:!0}),eg.Node=void 0;const t=pi(),e=Lr(),r=V1(),n=Nr(),i=T_(),a=Dr(),s="absoluteOpacity",o="allEventListeners",l="absoluteTransform",u="absoluteScale",c="canvas",f="Change",p="children",g="konva",y="listening",S="mouseenter",w="mouseleave",C="set",_="Shape",T=" ",N="stage",R="transform",D="Stage",j="visible",O=["xChange.konva","yChange.konva","scaleXChange.konva","scaleYChange.konva","skewXChange.konva","skewYChange.konva","rotationChange.konva","offsetXChange.konva","offsetYChange.konva","transformsEnabledChange.konva"].join(T);let F=1;class z{constructor(I){this._id=F++,this.eventListeners={},this.attrs={},this.index=0,this._allEventListeners=null,this.parent=null,this._cache=new Map,this._attachedDepsListeners=new Map,this._lastPos=null,this._batchingTransformChange=!1,this._needClearTransformCache=!1,this._filterUpToDate=!1,this._isUnderCache=!1,this._dragEventId=null,this._shouldFireChangeEvents=!1,this.setAttrs(I),this._shouldFireChangeEvents=!0}hasChildren(){return!1}_clearCache(I){(I===R||I===l)&&this._cache.get(I)?this._cache.get(I).dirty=!0:I?this._cache.delete(I):this._cache.clear()}_getCache(I,W){let U=this._cache.get(I);return(U===void 0||(I===R||I===l)&&U.dirty===!0)&&(U=W.call(this),this._cache.set(I,U)),U}_calculate(I,W,U){if(!this._attachedDepsListeners.get(I)){const K=W.map($=>$+"Change.konva").join(T);this.on(K,()=>{this._clearCache(I)}),this._attachedDepsListeners.set(I,!0)}return this._getCache(I,U)}_getCanvasCache(){return this._cache.get(c)}_clearSelfAndDescendantCache(I){this._clearCache(I),I===l&&this.fire("absoluteTransformChange")}clearCache(){if(this._cache.has(c)){const{scene:I,filter:W,hit:U}=this._cache.get(c);t.Util.releaseCanvas(I,W,U),this._cache.delete(c)}return this._clearSelfAndDescendantCache(),this._requestDraw(),this}cache(I){const W=I||{};let U={};(W.x===void 0||W.y===void 0||W.width===void 0||W.height===void 0)&&(U=this.getClientRect({skipTransform:!0,relativeTo:this.getParent()||void 0}));let K=Math.ceil(W.width||U.width),$=Math.ceil(W.height||U.height),Q=W.pixelRatio,ie=W.x===void 0?Math.floor(U.x):W.x,te=W.y===void 0?Math.floor(U.y):W.y,X=W.offset||0,re=W.drawBorder||!1,fe=W.hitCanvasPixelRatio||1;if(!K||!$){t.Util.error("Can not cache the node. Width or height of the node equals 0. Caching is skipped.");return}const oe=Math.abs(Math.round(U.x)-ie)>.5?1:0,se=Math.abs(Math.round(U.y)-te)>.5?1:0;K+=X*2+oe,$+=X*2+se,ie-=X,te-=X;const he=new r.SceneCanvas({pixelRatio:Q,width:K,height:$}),ae=new r.SceneCanvas({pixelRatio:Q,width:0,height:0,willReadFrequently:!0}),pe=new r.HitCanvas({pixelRatio:fe,width:K,height:$}),ye=he.getContext(),ve=pe.getContext();return pe.isCache=!0,he.isCache=!0,this._cache.delete(c),this._filterUpToDate=!1,W.imageSmoothingEnabled===!1&&(he.getContext()._context.imageSmoothingEnabled=!1,ae.getContext()._context.imageSmoothingEnabled=!1),ye.save(),ve.save(),ye.translate(-ie,-te),ve.translate(-ie,-te),this._isUnderCache=!0,this._clearSelfAndDescendantCache(s),this._clearSelfAndDescendantCache(u),this.drawScene(he,this),this.drawHit(pe,this),this._isUnderCache=!1,ye.restore(),ve.restore(),re&&(ye.save(),ye.beginPath(),ye.rect(0,0,K,$),ye.closePath(),ye.setAttr("strokeStyle","red"),ye.setAttr("lineWidth",5),ye.stroke(),ye.restore()),this._cache.set(c,{scene:he,filter:ae,hit:pe,x:ie,y:te}),this._requestDraw(),this}isCached(){return this._cache.has(c)}getClientRect(I){throw new Error('abstract "getClientRect" method call')}_transformedRect(I,W){const U=[{x:I.x,y:I.y},{x:I.x+I.width,y:I.y},{x:I.x+I.width,y:I.y+I.height},{x:I.x,y:I.y+I.height}];let K=1/0,$=1/0,Q=-1/0,ie=-1/0;const te=this.getAbsoluteTransform(W);return U.forEach(function(X){const re=te.point(X);K===void 0&&(K=Q=re.x,$=ie=re.y),K=Math.min(K,re.x),$=Math.min($,re.y),Q=Math.max(Q,re.x),ie=Math.max(ie,re.y)}),{x:K,y:$,width:Q-K,height:ie-$}}_drawCachedSceneCanvas(I){I.save(),I._applyOpacity(this),I._applyGlobalCompositeOperation(this);const W=this._getCanvasCache();I.translate(W.x,W.y);const U=this._getCachedSceneCanvas(),K=U.pixelRatio;I.drawImage(U._canvas,0,0,U.width/K,U.height/K),I.restore()}_drawCachedHitCanvas(I){const W=this._getCanvasCache(),U=W.hit;I.save(),I.translate(W.x,W.y),I.drawImage(U._canvas,0,0,U.width/U.pixelRatio,U.height/U.pixelRatio),I.restore()}_getCachedSceneCanvas(){let I=this.filters(),W=this._getCanvasCache(),U=W.scene,K=W.filter,$=K.getContext(),Q,ie,te,X;if(I){if(!this._filterUpToDate){const re=U.pixelRatio;K.setSize(U.width/U.pixelRatio,U.height/U.pixelRatio);try{for(Q=I.length,$.clear(),$.drawImage(U._canvas,0,0,U.getWidth()/re,U.getHeight()/re),ie=$.getImageData(0,0,K.getWidth(),K.getHeight()),te=0;te<Q;te++){if(X=I[te],typeof X!="function"){t.Util.error("Filter should be type of function, but got "+typeof X+" instead. Please check correct filters");continue}X.call(this,ie),$.putImageData(ie,0,0)}}catch(fe){t.Util.error("Unable to apply filter. "+fe.message+" This post my help you https://konvajs.org/docs/posts/Tainted_Canvas.html.")}this._filterUpToDate=!0}return K}return U}on(I,W){if(this._cache&&this._cache.delete(o),arguments.length===3)return this._delegate.apply(this,arguments);let U=I.split(T),K=U.length,$,Q,ie,te,X;for($=0;$<K;$++)Q=U[$],ie=Q.split("."),te=ie[0],X=ie[1]||"",this.eventListeners[te]||(this.eventListeners[te]=[]),this.eventListeners[te].push({name:X,handler:W});return this}off(I,W){let U=(I||"").split(T),K=U.length,$,Q,ie,te,X,re;if(this._cache&&this._cache.delete(o),!I)for(Q in this.eventListeners)this._off(Q);for($=0;$<K;$++)if(ie=U[$],te=ie.split("."),X=te[0],re=te[1],X)this.eventListeners[X]&&this._off(X,re,W);else for(Q in this.eventListeners)this._off(Q,re,W);return this}dispatchEvent(I){const W={target:this,type:I.type,evt:I};return this.fire(I.type,W),this}addEventListener(I,W){return this.on(I,function(U){W.call(this,U.evt)}),this}removeEventListener(I){return this.off(I),this}_delegate(I,W,U){const K=this;this.on(I,function($){const Q=$.target.findAncestors(W,!0,K);for(let ie=0;ie<Q.length;ie++)$=t.Util.cloneObject($),$.currentTarget=Q[ie],U.call(Q[ie],$)})}remove(){return this.isDragging()&&this.stopDrag(),i.DD._dragElements.delete(this._id),this._remove(),this}_clearCaches(){this._clearSelfAndDescendantCache(l),this._clearSelfAndDescendantCache(s),this._clearSelfAndDescendantCache(u),this._clearSelfAndDescendantCache(N),this._clearSelfAndDescendantCache(j),this._clearSelfAndDescendantCache(y)}_remove(){this._clearCaches();const I=this.getParent();I&&I.children&&(I.children.splice(this.index,1),I._setChildrenIndices(),this.parent=null)}destroy(){return this.remove(),this.clearCache(),this}getAttr(I){const W="get"+t.Util._capitalize(I);return t.Util._isFunction(this[W])?this[W]():this.attrs[I]}getAncestors(){let I=this.getParent(),W=[];for(;I;)W.push(I),I=I.getParent();return W}getAttrs(){return this.attrs||{}}setAttrs(I){return this._batchTransformChanges(()=>{let W,U;if(!I)return this;for(W in I)W!==p&&(U=C+t.Util._capitalize(W),t.Util._isFunction(this[U])?this[U](I[W]):this._setAttr(W,I[W]))}),this}isListening(){return this._getCache(y,this._isListening)}_isListening(I){if(!this.listening())return!1;const U=this.getParent();return U&&U!==I&&this!==I?U._isListening(I):!0}isVisible(){return this._getCache(j,this._isVisible)}_isVisible(I){if(!this.visible())return!1;const U=this.getParent();return U&&U!==I&&this!==I?U._isVisible(I):!0}shouldDrawHit(I,W=!1){if(I)return this._isVisible(I)&&this._isListening(I);const U=this.getLayer();let K=!1;i.DD._dragElements.forEach(Q=>{Q.dragStatus==="dragging"&&(Q.node.nodeType==="Stage"||Q.node.getLayer()===U)&&(K=!0)});const $=!W&&!n.Konva.hitOnDragEnabled&&(K||n.Konva.isTransforming());return this.isListening()&&this.isVisible()&&!$}show(){return this.visible(!0),this}hide(){return this.visible(!1),this}getZIndex(){return this.index||0}getAbsoluteZIndex(){let I=this.getDepth(),W=this,U=0,K,$,Q,ie;function te(re){for(K=[],$=re.length,Q=0;Q<$;Q++)ie=re[Q],U++,ie.nodeType!==_&&(K=K.concat(ie.getChildren().slice())),ie._id===W._id&&(Q=$);K.length>0&&K[0].getDepth()<=I&&te(K)}const X=this.getStage();return W.nodeType!==D&&X&&te(X.getChildren()),U}getDepth(){let I=0,W=this.parent;for(;W;)I++,W=W.parent;return I}_batchTransformChanges(I){this._batchingTransformChange=!0,I(),this._batchingTransformChange=!1,this._needClearTransformCache&&(this._clearCache(R),this._clearSelfAndDescendantCache(l)),this._needClearTransformCache=!1}setPosition(I){return this._batchTransformChanges(()=>{this.x(I.x),this.y(I.y)}),this}getPosition(){return{x:this.x(),y:this.y()}}getRelativePointerPosition(){const I=this.getStage();if(!I)return null;const W=I.getPointerPosition();if(!W)return null;const U=this.getAbsoluteTransform().copy();return U.invert(),U.point(W)}getAbsolutePosition(I){let W=!1,U=this.parent;for(;U;){if(U.isCached()){W=!0;break}U=U.parent}W&&!I&&(I=!0);const K=this.getAbsoluteTransform(I).getMatrix(),$=new t.Transform,Q=this.offset();return $.m=K.slice(),$.translate(Q.x,Q.y),$.getTranslation()}setAbsolutePosition(I){const{x:W,y:U,...K}=this._clearTransform();this.attrs.x=W,this.attrs.y=U,this._clearCache(R);const $=this._getAbsoluteTransform().copy();return $.invert(),$.translate(I.x,I.y),I={x:this.attrs.x+$.getTranslation().x,y:this.attrs.y+$.getTranslation().y},this._setTransform(K),this.setPosition({x:I.x,y:I.y}),this._clearCache(R),this._clearSelfAndDescendantCache(l),this}_setTransform(I){let W;for(W in I)this.attrs[W]=I[W]}_clearTransform(){const I={x:this.x(),y:this.y(),rotation:this.rotation(),scaleX:this.scaleX(),scaleY:this.scaleY(),offsetX:this.offsetX(),offsetY:this.offsetY(),skewX:this.skewX(),skewY:this.skewY()};return this.attrs.x=0,this.attrs.y=0,this.attrs.rotation=0,this.attrs.scaleX=1,this.attrs.scaleY=1,this.attrs.offsetX=0,this.attrs.offsetY=0,this.attrs.skewX=0,this.attrs.skewY=0,I}move(I){let W=I.x,U=I.y,K=this.x(),$=this.y();return W!==void 0&&(K+=W),U!==void 0&&($+=U),this.setPosition({x:K,y:$}),this}_eachAncestorReverse(I,W){let U=[],K=this.getParent(),$,Q;if(!(W&&W._id===this._id)){for(U.unshift(this);K&&(!W||K._id!==W._id);)U.unshift(K),K=K.parent;for($=U.length,Q=0;Q<$;Q++)I(U[Q])}}rotate(I){return this.rotation(this.rotation()+I),this}moveToTop(){if(!this.parent)return t.Util.warn("Node has no parent. moveToTop function is ignored."),!1;const I=this.index,W=this.parent.getChildren().length;return I<W-1?(this.parent.children.splice(I,1),this.parent.children.push(this),this.parent._setChildrenIndices(),!0):!1}moveUp(){if(!this.parent)return t.Util.warn("Node has no parent. moveUp function is ignored."),!1;const I=this.index,W=this.parent.getChildren().length;return I<W-1?(this.parent.children.splice(I,1),this.parent.children.splice(I+1,0,this),this.parent._setChildrenIndices(),!0):!1}moveDown(){if(!this.parent)return t.Util.warn("Node has no parent. moveDown function is ignored."),!1;const I=this.index;return I>0?(this.parent.children.splice(I,1),this.parent.children.splice(I-1,0,this),this.parent._setChildrenIndices(),!0):!1}moveToBottom(){if(!this.parent)return t.Util.warn("Node has no parent. moveToBottom function is ignored."),!1;const I=this.index;return I>0?(this.parent.children.splice(I,1),this.parent.children.unshift(this),this.parent._setChildrenIndices(),!0):!1}setZIndex(I){if(!this.parent)return t.Util.warn("Node has no parent. zIndex parameter is ignored."),this;(I<0||I>=this.parent.children.length)&&t.Util.warn("Unexpected value "+I+" for zIndex property. zIndex is just index of a node in children of its parent. Expected value is from 0 to "+(this.parent.children.length-1)+".");const W=this.index;return this.parent.children.splice(W,1),this.parent.children.splice(I,0,this),this.parent._setChildrenIndices(),this}getAbsoluteOpacity(){return this._getCache(s,this._getAbsoluteOpacity)}_getAbsoluteOpacity(){let I=this.opacity();const W=this.getParent();return W&&!W._isUnderCache&&(I*=W.getAbsoluteOpacity()),I}moveTo(I){return this.getParent()!==I&&(this._remove(),I.add(this)),this}toObject(){let I=this.getAttrs(),W,U,K,$,Q;const ie={attrs:{},className:this.getClassName()};for(W in I)U=I[W],Q=t.Util.isObject(U)&&!t.Util._isPlainObject(U)&&!t.Util._isArray(U),!Q&&(K=typeof this[W]=="function"&&this[W],delete I[W],$=K?K.call(this):null,I[W]=U,$!==U&&(ie.attrs[W]=U));return t.Util._prepareToStringify(ie)}toJSON(){return JSON.stringify(this.toObject())}getParent(){return this.parent}findAncestors(I,W,U){const K=[];W&&this._isMatch(I)&&K.push(this);let $=this.parent;for(;$;){if($===U)return K;$._isMatch(I)&&K.push($),$=$.parent}return K}isAncestorOf(I){return!1}findAncestor(I,W,U){return this.findAncestors(I,W,U)[0]}_isMatch(I){if(!I)return!1;if(typeof I=="function")return I(this);let W=I.replace(/ /g,"").split(","),U=W.length,K,$;for(K=0;K<U;K++)if($=W[K],t.Util.isValidSelector($)||(t.Util.warn('Selector "'+$+'" is invalid. Allowed selectors examples are "#foo", ".bar" or "Group".'),t.Util.warn('If you have a custom shape with such className, please change it to start with upper letter like "Triangle".'),t.Util.warn("Konva is awesome, right?")),$.charAt(0)==="#"){if(this.id()===$.slice(1))return!0}else if($.charAt(0)==="."){if(this.hasName($.slice(1)))return!0}else if(this.className===$||this.nodeType===$)return!0;return!1}getLayer(){const I=this.getParent();return I?I.getLayer():null}getStage(){return this._getCache(N,this._getStage)}_getStage(){const I=this.getParent();return I?I.getStage():null}fire(I,W={},U){return W.target=W.target||this,U?this._fireAndBubble(I,W):this._fire(I,W),this}getAbsoluteTransform(I){return I?this._getAbsoluteTransform(I):this._getCache(l,this._getAbsoluteTransform)}_getAbsoluteTransform(I){let W;if(I)return W=new t.Transform,this._eachAncestorReverse(function(U){const K=U.transformsEnabled();K==="all"?W.multiply(U.getTransform()):K==="position"&&W.translate(U.x()-U.offsetX(),U.y()-U.offsetY())},I),W;{W=this._cache.get(l)||new t.Transform,this.parent?this.parent.getAbsoluteTransform().copyInto(W):W.reset();const U=this.transformsEnabled();if(U==="all")W.multiply(this.getTransform());else if(U==="position"){const K=this.attrs.x||0,$=this.attrs.y||0,Q=this.attrs.offsetX||0,ie=this.attrs.offsetY||0;W.translate(K-Q,$-ie)}return W.dirty=!1,W}}getAbsoluteScale(I){let W=this;for(;W;)W._isUnderCache&&(I=W),W=W.getParent();const K=this.getAbsoluteTransform(I).decompose();return{x:K.scaleX,y:K.scaleY}}getAbsoluteRotation(){return this.getAbsoluteTransform().decompose().rotation}getTransform(){return this._getCache(R,this._getTransform)}_getTransform(){var I,W;const U=this._cache.get(R)||new t.Transform;U.reset();const K=this.x(),$=this.y(),Q=n.Konva.getAngle(this.rotation()),ie=(I=this.attrs.scaleX)!==null&&I!==void 0?I:1,te=(W=this.attrs.scaleY)!==null&&W!==void 0?W:1,X=this.attrs.skewX||0,re=this.attrs.skewY||0,fe=this.attrs.offsetX||0,oe=this.attrs.offsetY||0;return(K!==0||$!==0)&&U.translate(K,$),Q!==0&&U.rotate(Q),(X!==0||re!==0)&&U.skew(X,re),(ie!==1||te!==1)&&U.scale(ie,te),(fe!==0||oe!==0)&&U.translate(-1*fe,-1*oe),U.dirty=!1,U}clone(I){let W=t.Util.cloneObject(this.attrs),U,K,$,Q,ie;for(U in I)W[U]=I[U];const te=new this.constructor(W);for(U in this.eventListeners)for(K=this.eventListeners[U],$=K.length,Q=0;Q<$;Q++)ie=K[Q],ie.name.indexOf(g)<0&&(te.eventListeners[U]||(te.eventListeners[U]=[]),te.eventListeners[U].push(ie));return te}_toKonvaCanvas(I){I=I||{};const W=this.getClientRect(),U=this.getStage(),K=I.x!==void 0?I.x:Math.floor(W.x),$=I.y!==void 0?I.y:Math.floor(W.y),Q=I.pixelRatio||1,ie=new r.SceneCanvas({width:I.width||Math.ceil(W.width)||(U?U.width():0),height:I.height||Math.ceil(W.height)||(U?U.height():0),pixelRatio:Q}),te=ie.getContext(),X=new r.SceneCanvas({width:ie.width/ie.pixelRatio+Math.abs(K),height:ie.height/ie.pixelRatio+Math.abs($),pixelRatio:ie.pixelRatio});return I.imageSmoothingEnabled===!1&&(te._context.imageSmoothingEnabled=!1),te.save(),(K||$)&&te.translate(-1*K,-1*$),this.drawScene(ie,void 0,X),te.restore(),ie}toCanvas(I){return this._toKonvaCanvas(I)._canvas}toDataURL(I){I=I||{};const W=I.mimeType||null,U=I.quality||null,K=this._toKonvaCanvas(I).toDataURL(W,U);return I.callback&&I.callback(K),K}toImage(I){return new Promise((W,U)=>{try{const K=I?.callback;K&&delete I.callback,t.Util._urlToImage(this.toDataURL(I),function($){W($),K?.($)})}catch(K){U(K)}})}toBlob(I){return new Promise((W,U)=>{try{const K=I?.callback;K&&delete I.callback,this.toCanvas(I).toBlob($=>{W($),K?.($)},I?.mimeType,I?.quality)}catch(K){U(K)}})}setSize(I){return this.width(I.width),this.height(I.height),this}getSize(){return{width:this.width(),height:this.height()}}getClassName(){return this.className||this.nodeType}getType(){return this.nodeType}getDragDistance(){return this.attrs.dragDistance!==void 0?this.attrs.dragDistance:this.parent?this.parent.getDragDistance():n.Konva.dragDistance}_off(I,W,U){let K=this.eventListeners[I],$,Q,ie;for($=0;$<K.length;$++)if(Q=K[$].name,ie=K[$].handler,(Q!=="konva"||W==="konva")&&(!W||Q===W)&&(!U||U===ie)){if(K.splice($,1),K.length===0){delete this.eventListeners[I];break}$--}}_fireChangeEvent(I,W,U){this._fire(I+f,{oldVal:W,newVal:U})}addName(I){if(!this.hasName(I)){const W=this.name(),U=W?W+" "+I:I;this.name(U)}return this}hasName(I){if(!I)return!1;const W=this.name();return W?(W||"").split(/\s/g).indexOf(I)!==-1:!1}removeName(I){const W=(this.name()||"").split(/\s/g),U=W.indexOf(I);return U!==-1&&(W.splice(U,1),this.name(W.join(" "))),this}setAttr(I,W){const U=this[C+t.Util._capitalize(I)];return t.Util._isFunction(U)?U.call(this,W):this._setAttr(I,W),this}_requestDraw(){if(n.Konva.autoDrawEnabled){const I=this.getLayer()||this.getStage();I?.batchDraw()}}_setAttr(I,W){const U=this.attrs[I];U===W&&!t.Util.isObject(W)||(W==null?delete this.attrs[I]:this.attrs[I]=W,this._shouldFireChangeEvents&&this._fireChangeEvent(I,U,W),this._requestDraw())}_setComponentAttr(I,W,U){let K;U!==void 0&&(K=this.attrs[I],K||(this.attrs[I]=this.getAttr(I)),this.attrs[I][W]=U,this._fireChangeEvent(I,K,U))}_fireAndBubble(I,W,U){if(W&&this.nodeType===_&&(W.target=this),!((I===S||I===w)&&(U&&(this===U||this.isAncestorOf&&this.isAncestorOf(U))||this.nodeType==="Stage"&&!U))){this._fire(I,W);const $=(I===S||I===w)&&U&&U.isAncestorOf&&U.isAncestorOf(this)&&!U.isAncestorOf(this.parent);(W&&!W.cancelBubble||!W)&&this.parent&&this.parent.isListening()&&!$&&(U&&U.parent?this._fireAndBubble.call(this.parent,I,W,U):this._fireAndBubble.call(this.parent,I,W))}}_getProtoListeners(I){var W,U,K;const $=(W=this._cache.get(o))!==null&&W!==void 0?W:{};let Q=$?.[I];if(Q===void 0){Q=[];let ie=Object.getPrototypeOf(this);for(;ie;){const te=(K=(U=ie.eventListeners)===null||U===void 0?void 0:U[I])!==null&&K!==void 0?K:[];Q.push(...te),ie=Object.getPrototypeOf(ie)}$[I]=Q,this._cache.set(o,$)}return Q}_fire(I,W){W=W||{},W.currentTarget=this,W.type=I;const U=this._getProtoListeners(I);if(U)for(var K=0;K<U.length;K++)U[K].handler.call(this,W);const $=this.eventListeners[I];if($)for(var K=0;K<$.length;K++)$[K].handler.call(this,W)}draw(){return this.drawScene(),this.drawHit(),this}_createDragElement(I){const W=I?I.pointerId:void 0,U=this.getStage(),K=this.getAbsolutePosition();if(!U)return;const $=U._getPointerById(W)||U._changedPointerPositions[0]||K;i.DD._dragElements.set(this._id,{node:this,startPointerPos:$,offset:{x:$.x-K.x,y:$.y-K.y},dragStatus:"ready",pointerId:W})}startDrag(I,W=!0){i.DD._dragElements.has(this._id)||this._createDragElement(I);const U=i.DD._dragElements.get(this._id);U.dragStatus="dragging",this.fire("dragstart",{type:"dragstart",target:this,evt:I&&I.evt},W)}_setDragPosition(I,W){const U=this.getStage()._getPointerById(W.pointerId);if(!U)return;let K={x:U.x-W.offset.x,y:U.y-W.offset.y};const $=this.dragBoundFunc();if($!==void 0){const Q=$.call(this,K,I);Q?K=Q:t.Util.warn("dragBoundFunc did not return any value. That is unexpected behavior. You must return new absolute position from dragBoundFunc.")}(!this._lastPos||this._lastPos.x!==K.x||this._lastPos.y!==K.y)&&(this.setAbsolutePosition(K),this._requestDraw()),this._lastPos=K}stopDrag(I){const W=i.DD._dragElements.get(this._id);W&&(W.dragStatus="stopped"),i.DD._endDragBefore(I),i.DD._endDragAfter(I)}setDraggable(I){this._setAttr("draggable",I),this._dragChange()}isDragging(){const I=i.DD._dragElements.get(this._id);return I?I.dragStatus==="dragging":!1}_listenDrag(){this._dragCleanup(),this.on("mousedown.konva touchstart.konva",function(I){if(!(!(I.evt.button!==void 0)||n.Konva.dragButtons.indexOf(I.evt.button)>=0)||this.isDragging())return;let K=!1;i.DD._dragElements.forEach($=>{this.isAncestorOf($.node)&&(K=!0)}),K||this._createDragElement(I)})}_dragChange(){if(this.attrs.draggable)this._listenDrag();else{if(this._dragCleanup(),!this.getStage())return;const W=i.DD._dragElements.get(this._id),U=W&&W.dragStatus==="dragging",K=W&&W.dragStatus==="ready";U?this.stopDrag():K&&i.DD._dragElements.delete(this._id)}}_dragCleanup(){this.off("mousedown.konva"),this.off("touchstart.konva")}isClientRectOnScreen(I={x:0,y:0}){const W=this.getStage();if(!W)return!1;const U={x:-I.x,y:-I.y,width:W.width()+2*I.x,height:W.height()+2*I.y};return t.Util.haveIntersection(U,this.getClientRect())}static create(I,W){return t.Util._isString(I)&&(I=JSON.parse(I)),this._createNode(I,W)}static _createNode(I,W){let U=z.prototype.getClassName.call(I),K=I.children,$,Q,ie;W&&(I.attrs.container=W),n.Konva[U]||(t.Util.warn('Can not find a node with class name "'+U+'". Fallback to "Shape".'),U="Shape");const te=n.Konva[U];if($=new te(I.attrs),K)for(Q=K.length,ie=0;ie<Q;ie++)$.add(z._createNode(K[ie]));return $}}eg.Node=z,z.prototype.nodeType="Node",z.prototype._attrsAffectingSize=[],z.prototype.eventListeners={},z.prototype.on.call(z.prototype,O,function(){if(this._batchingTransformChange){this._needClearTransformCache=!0;return}this._clearCache(R),this._clearSelfAndDescendantCache(l)}),z.prototype.on.call(z.prototype,"visibleChange.konva",function(){this._clearSelfAndDescendantCache(j)}),z.prototype.on.call(z.prototype,"listeningChange.konva",function(){this._clearSelfAndDescendantCache(y)}),z.prototype.on.call(z.prototype,"opacityChange.konva",function(){this._clearSelfAndDescendantCache(s)});const G=e.Factory.addGetterSetter;return G(z,"zIndex"),G(z,"absolutePosition"),G(z,"position"),G(z,"x",0,(0,a.getNumberValidator)()),G(z,"y",0,(0,a.getNumberValidator)()),G(z,"globalCompositeOperation","source-over",(0,a.getStringValidator)()),G(z,"opacity",1,(0,a.getNumberValidator)()),G(z,"name","",(0,a.getStringValidator)()),G(z,"id","",(0,a.getStringValidator)()),G(z,"rotation",0,(0,a.getNumberValidator)()),e.Factory.addComponentsGetterSetter(z,"scale",["x","y"]),G(z,"scaleX",1,(0,a.getNumberValidator)()),G(z,"scaleY",1,(0,a.getNumberValidator)()),e.Factory.addComponentsGetterSetter(z,"skew",["x","y"]),G(z,"skewX",0,(0,a.getNumberValidator)()),G(z,"skewY",0,(0,a.getNumberValidator)()),e.Factory.addComponentsGetterSetter(z,"offset",["x","y"]),G(z,"offsetX",0,(0,a.getNumberValidator)()),G(z,"offsetY",0,(0,a.getNumberValidator)()),G(z,"dragDistance",null,(0,a.getNumberValidator)()),G(z,"width",0,(0,a.getNumberValidator)()),G(z,"height",0,(0,a.getNumberValidator)()),G(z,"listening",!0,(0,a.getBooleanValidator)()),G(z,"preventDefault",!0,(0,a.getBooleanValidator)()),G(z,"filters",null,function(Z){return this._filterUpToDate=!1,Z}),G(z,"visible",!0,(0,a.getBooleanValidator)()),G(z,"transformsEnabled","all",(0,a.getStringValidator)()),G(z,"size"),G(z,"dragBoundFunc"),G(z,"draggable",!1,(0,a.getBooleanValidator)()),e.Factory.backCompat(z,{rotateDeg:"rotate",setRotationDeg:"setRotation",getRotationDeg:"getRotation"}),eg}var tg={},w5;function H1(){if(w5)return tg;w5=1,Object.defineProperty(tg,"__esModule",{value:!0}),tg.Container=void 0;const t=Lr(),e=Ei(),r=Dr();let n=class extends e.Node{constructor(){super(...arguments),this.children=[]}getChildren(a){if(!a)return this.children||[];const s=this.children||[],o=[];return s.forEach(function(l){a(l)&&o.push(l)}),o}hasChildren(){return this.getChildren().length>0}removeChildren(){return this.getChildren().forEach(a=>{a.parent=null,a.index=0,a.remove()}),this.children=[],this._requestDraw(),this}destroyChildren(){return this.getChildren().forEach(a=>{a.parent=null,a.index=0,a.destroy()}),this.children=[],this._requestDraw(),this}add(...a){if(a.length===0)return this;if(a.length>1){for(let o=0;o<a.length;o++)this.add(a[o]);return this}const s=a[0];return s.getParent()?(s.moveTo(this),this):(this._validateAdd(s),s.index=this.getChildren().length,s.parent=this,s._clearCaches(),this.getChildren().push(s),this._fire("add",{child:s}),this._requestDraw(),this)}destroy(){return this.hasChildren()&&this.destroyChildren(),super.destroy(),this}find(a){return this._generalFind(a,!1)}findOne(a){const s=this._generalFind(a,!0);return s.length>0?s[0]:void 0}_generalFind(a,s){const o=[];return this._descendants(l=>{const u=l._isMatch(a);return u&&o.push(l),!!(u&&s)}),o}_descendants(a){let s=!1;const o=this.getChildren();for(const l of o){if(s=a(l),s)return!0;if(l.hasChildren()&&(s=l._descendants(a),s))return!0}return!1}toObject(){const a=e.Node.prototype.toObject.call(this);return a.children=[],this.getChildren().forEach(s=>{a.children.push(s.toObject())}),a}isAncestorOf(a){let s=a.getParent();for(;s;){if(s._id===this._id)return!0;s=s.getParent()}return!1}clone(a){const s=e.Node.prototype.clone.call(this,a);return this.getChildren().forEach(function(o){s.add(o.clone())}),s}getAllIntersections(a){const s=[];return this.find("Shape").forEach(o=>{o.isVisible()&&o.intersects(a)&&s.push(o)}),s}_clearSelfAndDescendantCache(a){var s;super._clearSelfAndDescendantCache(a),!this.isCached()&&((s=this.children)===null||s===void 0||s.forEach(function(o){o._clearSelfAndDescendantCache(a)}))}_setChildrenIndices(){var a;(a=this.children)===null||a===void 0||a.forEach(function(s,o){s.index=o}),this._requestDraw()}drawScene(a,s,o){const l=this.getLayer(),u=a||l&&l.getCanvas(),c=u&&u.getContext(),f=this._getCanvasCache(),p=f&&f.scene,g=u&&u.isCache;if(!this.isVisible()&&!g)return this;if(p){c.save();const y=this.getAbsoluteTransform(s).getMatrix();c.transform(y[0],y[1],y[2],y[3],y[4],y[5]),this._drawCachedSceneCanvas(c),c.restore()}else this._drawChildren("drawScene",u,s,o);return this}drawHit(a,s){if(!this.shouldDrawHit(s))return this;const o=this.getLayer(),l=a||o&&o.hitCanvas,u=l&&l.getContext(),c=this._getCanvasCache();if(c&&c.hit){u.save();const p=this.getAbsoluteTransform(s).getMatrix();u.transform(p[0],p[1],p[2],p[3],p[4],p[5]),this._drawCachedHitCanvas(u),u.restore()}else this._drawChildren("drawHit",l,s);return this}_drawChildren(a,s,o,l){var u;const c=s&&s.getContext(),f=this.clipWidth(),p=this.clipHeight(),g=this.clipFunc(),y=typeof f=="number"&&typeof p=="number"||g,S=o===this;if(y){c.save();const C=this.getAbsoluteTransform(o);let _=C.getMatrix();c.transform(_[0],_[1],_[2],_[3],_[4],_[5]),c.beginPath();let T;if(g)T=g.call(this,c,this);else{const N=this.clipX(),R=this.clipY();c.rect(N||0,R||0,f,p)}c.clip.apply(c,T),_=C.copy().invert().getMatrix(),c.transform(_[0],_[1],_[2],_[3],_[4],_[5])}const w=!S&&this.globalCompositeOperation()!=="source-over"&&a==="drawScene";w&&(c.save(),c._applyGlobalCompositeOperation(this)),(u=this.children)===null||u===void 0||u.forEach(function(C){C[a](s,o,l)}),w&&c.restore(),y&&c.restore()}getClientRect(a={}){var s;const o=a.skipTransform,l=a.relativeTo;let u,c,f,p,g={x:1/0,y:1/0,width:0,height:0};const y=this;(s=this.children)===null||s===void 0||s.forEach(function(C){if(!C.visible())return;const _=C.getClientRect({relativeTo:y,skipShadow:a.skipShadow,skipStroke:a.skipStroke});_.width===0&&_.height===0||(u===void 0?(u=_.x,c=_.y,f=_.x+_.width,p=_.y+_.height):(u=Math.min(u,_.x),c=Math.min(c,_.y),f=Math.max(f,_.x+_.width),p=Math.max(p,_.y+_.height)))});const S=this.find("Shape");let w=!1;for(let C=0;C<S.length;C++)if(S[C]._isVisible(this)){w=!0;break}return w&&u!==void 0?g={x:u,y:c,width:f-u,height:p-c}:g={x:0,y:0,width:0,height:0},o?g:this._transformedRect(g,l)}};return tg.Container=n,t.Factory.addComponentsGetterSetter(n,"clip",["x","y","width","height"]),t.Factory.addGetterSetter(n,"clipX",void 0,(0,r.getNumberValidator)()),t.Factory.addGetterSetter(n,"clipY",void 0,(0,r.getNumberValidator)()),t.Factory.addGetterSetter(n,"clipWidth",void 0,(0,r.getNumberValidator)()),t.Factory.addGetterSetter(n,"clipHeight",void 0,(0,r.getNumberValidator)()),t.Factory.addGetterSetter(n,"clipFunc"),tg}var O2={},xd={},S5;function PL(){if(S5)return xd;S5=1,Object.defineProperty(xd,"__esModule",{value:!0}),xd.getCapturedShape=n,xd.createEvent=i,xd.hasPointerCapture=a,xd.setPointerCapture=s,xd.releaseCapture=o;const t=Nr(),e=new Map,r=t.Konva._global.PointerEvent!==void 0;function n(l){return e.get(l)}function i(l){return{evt:l,pointerId:l.pointerId}}function a(l,u){return e.get(l)===u}function s(l,u){o(l),u.getStage()&&(e.set(l,u),r&&u._fire("gotpointercapture",i(new PointerEvent("gotpointercapture"))))}function o(l,u){const c=e.get(l);if(!c)return;const f=c.getStage();f&&f.content,e.delete(l),r&&c._fire("lostpointercapture",i(new PointerEvent("lostpointercapture")))}return xd}var k5;function PG(){return k5||(k5=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Stage=t.stages=void 0;const e=pi(),r=Lr(),n=H1(),i=Nr(),a=V1(),s=T_(),o=Nr(),l=PL(),u="Stage",c="string",f="px",p="mouseout",g="mouseleave",y="mouseover",S="mouseenter",w="mousemove",C="mousedown",_="mouseup",T="pointermove",N="pointerdown",R="pointerup",D="pointercancel",j="lostpointercapture",O="pointerout",F="pointerleave",z="pointerover",G="pointerenter",Z="contextmenu",I="touchstart",W="touchend",U="touchmove",K="touchcancel",$="wheel",Q=5,ie=[[S,"_pointerenter"],[C,"_pointerdown"],[w,"_pointermove"],[_,"_pointerup"],[g,"_pointerleave"],[I,"_pointerdown"],[U,"_pointermove"],[W,"_pointerup"],[K,"_pointercancel"],[y,"_pointerover"],[$,"_wheel"],[Z,"_contextmenu"],[N,"_pointerdown"],[T,"_pointermove"],[R,"_pointerup"],[D,"_pointercancel"],[j,"_lostpointercapture"]],te={mouse:{[O]:p,[F]:g,[z]:y,[G]:S,[T]:w,[N]:C,[R]:_,[D]:"mousecancel",pointerclick:"click",pointerdblclick:"dblclick"},touch:{[O]:"touchout",[F]:"touchleave",[z]:"touchover",[G]:"touchenter",[T]:U,[N]:I,[R]:W,[D]:K,pointerclick:"tap",pointerdblclick:"dbltap"},pointer:{[O]:O,[F]:F,[z]:z,[G]:G,[T]:T,[N]:N,[R]:R,[D]:D,pointerclick:"pointerclick",pointerdblclick:"pointerdblclick"}},X=he=>he.indexOf("pointer")>=0?"pointer":he.indexOf("touch")>=0?"touch":"mouse",re=he=>{const ae=X(he);if(ae==="pointer")return i.Konva.pointerEventsEnabled&&te.pointer;if(ae==="touch")return te.touch;if(ae==="mouse")return te.mouse};function fe(he={}){return(he.clipFunc||he.clipWidth||he.clipHeight)&&e.Util.warn("Stage does not support clipping. Please use clip for Layers or Groups."),he}const oe="Pointer position is missing and not registered by the stage. Looks like it is outside of the stage container. You can set it manually from event: stage.setPointersPositions(event);";t.stages=[];class se extends n.Container{constructor(ae){super(fe(ae)),this._pointerPositions=[],this._changedPointerPositions=[],this._buildDOM(),this._bindContentEvents(),t.stages.push(this),this.on("widthChange.konva heightChange.konva",this._resizeDOM),this.on("visibleChange.konva",this._checkVisibility),this.on("clipWidthChange.konva clipHeightChange.konva clipFuncChange.konva",()=>{fe(this.attrs)}),this._checkVisibility()}_validateAdd(ae){const pe=ae.getType()==="Layer",ye=ae.getType()==="FastLayer";pe||ye||e.Util.throw("You may only add layers to the stage.")}_checkVisibility(){if(!this.content)return;const ae=this.visible()?"":"none";this.content.style.display=ae}setContainer(ae){if(typeof ae===c){if(ae.charAt(0)==="."){const ye=ae.slice(1);ae=document.getElementsByClassName(ye)[0]}else{var pe;ae.charAt(0)!=="#"?pe=ae:pe=ae.slice(1),ae=document.getElementById(pe)}if(!ae)throw"Can not find container in document with id "+pe}return this._setAttr("container",ae),this.content&&(this.content.parentElement&&this.content.parentElement.removeChild(this.content),ae.appendChild(this.content)),this}shouldDrawHit(){return!0}clear(){let ae=this.children,pe=ae.length,ye;for(ye=0;ye<pe;ye++)ae[ye].clear();return this}clone(ae){return ae||(ae={}),ae.container=typeof document<"u"&&document.createElement("div"),n.Container.prototype.clone.call(this,ae)}destroy(){super.destroy();const ae=this.content;ae&&e.Util._isInDocument(ae)&&this.container().removeChild(ae);const pe=t.stages.indexOf(this);return pe>-1&&t.stages.splice(pe,1),e.Util.releaseCanvas(this.bufferCanvas._canvas,this.bufferHitCanvas._canvas),this}getPointerPosition(){const ae=this._pointerPositions[0]||this._changedPointerPositions[0];return ae?{x:ae.x,y:ae.y}:(e.Util.warn(oe),null)}_getPointerById(ae){return this._pointerPositions.find(pe=>pe.id===ae)}getPointersPositions(){return this._pointerPositions}getStage(){return this}getContent(){return this.content}_toKonvaCanvas(ae){ae=ae||{},ae.x=ae.x||0,ae.y=ae.y||0,ae.width=ae.width||this.width(),ae.height=ae.height||this.height();const pe=new a.SceneCanvas({width:ae.width,height:ae.height,pixelRatio:ae.pixelRatio||1}),ye=pe.getContext()._context,ve=this.children;return(ae.x||ae.y)&&ye.translate(-1*ae.x,-1*ae.y),ve.forEach(function(ue){if(!ue.isVisible())return;const xe=ue._toKonvaCanvas(ae);ye.drawImage(xe._canvas,ae.x,ae.y,xe.getWidth()/xe.getPixelRatio(),xe.getHeight()/xe.getPixelRatio())}),pe}getIntersection(ae){if(!ae)return null;let pe=this.children,ye=pe.length,ve=ye-1,ue;for(ue=ve;ue>=0;ue--){const xe=pe[ue].getIntersection(ae);if(xe)return xe}return null}_resizeDOM(){const ae=this.width(),pe=this.height();this.content&&(this.content.style.width=ae+f,this.content.style.height=pe+f),this.bufferCanvas.setSize(ae,pe),this.bufferHitCanvas.setSize(ae,pe),this.children.forEach(ye=>{ye.setSize({width:ae,height:pe}),ye.draw()})}add(ae,...pe){if(arguments.length>1){for(let ve=0;ve<arguments.length;ve++)this.add(arguments[ve]);return this}super.add(ae);const ye=this.children.length;return ye>Q&&e.Util.warn("The stage has "+ye+" layers. Recommended maximum number of layers is 3-5. Adding more layers into the stage may drop the performance. Rethink your tree structure, you can use Konva.Group."),ae.setSize({width:this.width(),height:this.height()}),ae.draw(),i.Konva.isBrowser&&this.content.appendChild(ae.canvas._canvas),this}getParent(){return null}getLayer(){return null}hasPointerCapture(ae){return l.hasPointerCapture(ae,this)}setPointerCapture(ae){l.setPointerCapture(ae,this)}releaseCapture(ae){l.releaseCapture(ae,this)}getLayers(){return this.children}_bindContentEvents(){i.Konva.isBrowser&&ie.forEach(([ae,pe])=>{this.content.addEventListener(ae,ye=>{this[pe](ye)},{passive:!1})})}_pointerenter(ae){this.setPointersPositions(ae);const pe=re(ae.type);pe&&this._fire(pe.pointerenter,{evt:ae,target:this,currentTarget:this})}_pointerover(ae){this.setPointersPositions(ae);const pe=re(ae.type);pe&&this._fire(pe.pointerover,{evt:ae,target:this,currentTarget:this})}_getTargetShape(ae){let pe=this[ae+"targetShape"];return pe&&!pe.getStage()&&(pe=null),pe}_pointerleave(ae){const pe=re(ae.type),ye=X(ae.type);if(!pe)return;this.setPointersPositions(ae);const ve=this._getTargetShape(ye),ue=!(i.Konva.isDragging()||i.Konva.isTransforming())||i.Konva.hitOnDragEnabled;ve&&ue?(ve._fireAndBubble(pe.pointerout,{evt:ae}),ve._fireAndBubble(pe.pointerleave,{evt:ae}),this._fire(pe.pointerleave,{evt:ae,target:this,currentTarget:this}),this[ye+"targetShape"]=null):ue&&(this._fire(pe.pointerleave,{evt:ae,target:this,currentTarget:this}),this._fire(pe.pointerout,{evt:ae,target:this,currentTarget:this})),this.pointerPos=null,this._pointerPositions=[]}_pointerdown(ae){const pe=re(ae.type),ye=X(ae.type);if(!pe)return;this.setPointersPositions(ae);let ve=!1;this._changedPointerPositions.forEach(ue=>{const xe=this.getIntersection(ue);if(s.DD.justDragged=!1,i.Konva["_"+ye+"ListenClick"]=!0,!xe||!xe.isListening()){this[ye+"ClickStartShape"]=void 0;return}i.Konva.capturePointerEventsEnabled&&xe.setPointerCapture(ue.id),this[ye+"ClickStartShape"]=xe,xe._fireAndBubble(pe.pointerdown,{evt:ae,pointerId:ue.id}),ve=!0;const Se=ae.type.indexOf("touch")>=0;xe.preventDefault()&&ae.cancelable&&Se&&ae.preventDefault()}),ve||this._fire(pe.pointerdown,{evt:ae,target:this,currentTarget:this,pointerId:this._pointerPositions[0].id})}_pointermove(ae){const pe=re(ae.type),ye=X(ae.type);if(!pe||(i.Konva.isDragging()&&s.DD.node.preventDefault()&&ae.cancelable&&ae.preventDefault(),this.setPointersPositions(ae),!(!(i.Konva.isDragging()||i.Konva.isTransforming())||i.Konva.hitOnDragEnabled)))return;const ue={};let xe=!1;const Se=this._getTargetShape(ye);this._changedPointerPositions.forEach(Ae=>{const Me=l.getCapturedShape(Ae.id)||this.getIntersection(Ae),st=Ae.id,rt={evt:ae,pointerId:st},dt=Se!==Me;if(dt&&Se&&(Se._fireAndBubble(pe.pointerout,{...rt},Me),Se._fireAndBubble(pe.pointerleave,{...rt},Me)),Me){if(ue[Me._id])return;ue[Me._id]=!0}Me&&Me.isListening()?(xe=!0,dt&&(Me._fireAndBubble(pe.pointerover,{...rt},Se),Me._fireAndBubble(pe.pointerenter,{...rt},Se),this[ye+"targetShape"]=Me),Me._fireAndBubble(pe.pointermove,{...rt})):Se&&(this._fire(pe.pointerover,{evt:ae,target:this,currentTarget:this,pointerId:st}),this[ye+"targetShape"]=null)}),xe||this._fire(pe.pointermove,{evt:ae,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id})}_pointerup(ae){const pe=re(ae.type),ye=X(ae.type);if(!pe)return;this.setPointersPositions(ae);const ve=this[ye+"ClickStartShape"],ue=this[ye+"ClickEndShape"],xe={};let Se=!1;this._changedPointerPositions.forEach(Ae=>{const Me=l.getCapturedShape(Ae.id)||this.getIntersection(Ae);if(Me){if(Me.releaseCapture(Ae.id),xe[Me._id])return;xe[Me._id]=!0}const st=Ae.id,rt={evt:ae,pointerId:st};let dt=!1;i.Konva["_"+ye+"InDblClickWindow"]?(dt=!0,clearTimeout(this[ye+"DblTimeout"])):s.DD.justDragged||(i.Konva["_"+ye+"InDblClickWindow"]=!0,clearTimeout(this[ye+"DblTimeout"])),this[ye+"DblTimeout"]=setTimeout(function(){i.Konva["_"+ye+"InDblClickWindow"]=!1},i.Konva.dblClickWindow),Me&&Me.isListening()?(Se=!0,this[ye+"ClickEndShape"]=Me,Me._fireAndBubble(pe.pointerup,{...rt}),i.Konva["_"+ye+"ListenClick"]&&ve&&ve===Me&&(Me._fireAndBubble(pe.pointerclick,{...rt}),dt&&ue&&ue===Me&&Me._fireAndBubble(pe.pointerdblclick,{...rt}))):(this[ye+"ClickEndShape"]=null,i.Konva["_"+ye+"ListenClick"]&&this._fire(pe.pointerclick,{evt:ae,target:this,currentTarget:this,pointerId:st}),dt&&this._fire(pe.pointerdblclick,{evt:ae,target:this,currentTarget:this,pointerId:st}))}),Se||this._fire(pe.pointerup,{evt:ae,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id}),i.Konva["_"+ye+"ListenClick"]=!1,ae.cancelable&&ye!=="touch"&&ae.preventDefault()}_contextmenu(ae){this.setPointersPositions(ae);const pe=this.getIntersection(this.getPointerPosition());pe&&pe.isListening()?pe._fireAndBubble(Z,{evt:ae}):this._fire(Z,{evt:ae,target:this,currentTarget:this})}_wheel(ae){this.setPointersPositions(ae);const pe=this.getIntersection(this.getPointerPosition());pe&&pe.isListening()?pe._fireAndBubble($,{evt:ae}):this._fire($,{evt:ae,target:this,currentTarget:this})}_pointercancel(ae){this.setPointersPositions(ae);const pe=l.getCapturedShape(ae.pointerId)||this.getIntersection(this.getPointerPosition());pe&&pe._fireAndBubble(R,l.createEvent(ae)),l.releaseCapture(ae.pointerId)}_lostpointercapture(ae){l.releaseCapture(ae.pointerId)}setPointersPositions(ae){let pe=this._getContentPosition(),ye=null,ve=null;ae=ae||window.event,ae.touches!==void 0?(this._pointerPositions=[],this._changedPointerPositions=[],Array.prototype.forEach.call(ae.touches,ue=>{this._pointerPositions.push({id:ue.identifier,x:(ue.clientX-pe.left)/pe.scaleX,y:(ue.clientY-pe.top)/pe.scaleY})}),Array.prototype.forEach.call(ae.changedTouches||ae.touches,ue=>{this._changedPointerPositions.push({id:ue.identifier,x:(ue.clientX-pe.left)/pe.scaleX,y:(ue.clientY-pe.top)/pe.scaleY})})):(ye=(ae.clientX-pe.left)/pe.scaleX,ve=(ae.clientY-pe.top)/pe.scaleY,this.pointerPos={x:ye,y:ve},this._pointerPositions=[{x:ye,y:ve,id:e.Util._getFirstPointerId(ae)}],this._changedPointerPositions=[{x:ye,y:ve,id:e.Util._getFirstPointerId(ae)}])}_setPointerPosition(ae){e.Util.warn('Method _setPointerPosition is deprecated. Use "stage.setPointersPositions(event)" instead.'),this.setPointersPositions(ae)}_getContentPosition(){if(!this.content||!this.content.getBoundingClientRect)return{top:0,left:0,scaleX:1,scaleY:1};const ae=this.content.getBoundingClientRect();return{top:ae.top,left:ae.left,scaleX:ae.width/this.content.clientWidth||1,scaleY:ae.height/this.content.clientHeight||1}}_buildDOM(){if(this.bufferCanvas=new a.SceneCanvas({width:this.width(),height:this.height()}),this.bufferHitCanvas=new a.HitCanvas({pixelRatio:1,width:this.width(),height:this.height()}),!i.Konva.isBrowser)return;const ae=this.container();if(!ae)throw"Stage has no container. A container is required.";ae.innerHTML="",this.content=document.createElement("div"),this.content.style.position="relative",this.content.style.userSelect="none",this.content.className="konvajs-content",this.content.setAttribute("role","presentation"),ae.appendChild(this.content),this._resizeDOM()}cache(){return e.Util.warn("Cache function is not allowed for stage. You may use cache only for layers, groups and shapes."),this}clearCache(){return this}batchDraw(){return this.getChildren().forEach(function(ae){ae.batchDraw()}),this}}t.Stage=se,se.prototype.nodeType=u,(0,o._registerNode)(se),r.Factory.addGetterSetter(se,"container"),i.Konva.isBrowser&&document.addEventListener("visibilitychange",()=>{t.stages.forEach(he=>{he.batchDraw()})})})(O2)),O2}var rg={},D2={},_5;function xa(){return _5||(_5=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Shape=t.shapes=void 0;const e=Nr(),r=pi(),n=Lr(),i=Ei(),a=Dr(),s=Nr(),o=PL(),l="hasShadow",u="shadowRGBA",c="patternImage",f="linearGradient",p="radialGradient";let g;function y(){return g||(g=r.Util.createCanvasElement().getContext("2d"),g)}t.shapes={};function S(F){const z=this.attrs.fillRule;z?F.fill(z):F.fill()}function w(F){F.stroke()}function C(F){const z=this.attrs.fillRule;z?F.fill(z):F.fill()}function _(F){F.stroke()}function T(){this._clearCache(l)}function N(){this._clearCache(u)}function R(){this._clearCache(c)}function D(){this._clearCache(f)}function j(){this._clearCache(p)}class O extends i.Node{constructor(z){super(z);let G;for(;G=r.Util.getRandomColor(),!(G&&!(G in t.shapes)););this.colorKey=G,t.shapes[G]=this}getContext(){return r.Util.warn("shape.getContext() method is deprecated. Please do not use it."),this.getLayer().getContext()}getCanvas(){return r.Util.warn("shape.getCanvas() method is deprecated. Please do not use it."),this.getLayer().getCanvas()}getSceneFunc(){return this.attrs.sceneFunc||this._sceneFunc}getHitFunc(){return this.attrs.hitFunc||this._hitFunc}hasShadow(){return this._getCache(l,this._hasShadow)}_hasShadow(){return this.shadowEnabled()&&this.shadowOpacity()!==0&&!!(this.shadowColor()||this.shadowBlur()||this.shadowOffsetX()||this.shadowOffsetY())}_getFillPattern(){return this._getCache(c,this.__getFillPattern)}__getFillPattern(){if(this.fillPatternImage()){const G=y().createPattern(this.fillPatternImage(),this.fillPatternRepeat()||"repeat");if(G&&G.setTransform){const Z=new r.Transform;Z.translate(this.fillPatternX(),this.fillPatternY()),Z.rotate(e.Konva.getAngle(this.fillPatternRotation())),Z.scale(this.fillPatternScaleX(),this.fillPatternScaleY()),Z.translate(-1*this.fillPatternOffsetX(),-1*this.fillPatternOffsetY());const I=Z.getMatrix(),W=typeof DOMMatrix>"u"?{a:I[0],b:I[1],c:I[2],d:I[3],e:I[4],f:I[5]}:new DOMMatrix(I);G.setTransform(W)}return G}}_getLinearGradient(){return this._getCache(f,this.__getLinearGradient)}__getLinearGradient(){const z=this.fillLinearGradientColorStops();if(z){const G=y(),Z=this.fillLinearGradientStartPoint(),I=this.fillLinearGradientEndPoint(),W=G.createLinearGradient(Z.x,Z.y,I.x,I.y);for(let U=0;U<z.length;U+=2)W.addColorStop(z[U],z[U+1]);return W}}_getRadialGradient(){return this._getCache(p,this.__getRadialGradient)}__getRadialGradient(){const z=this.fillRadialGradientColorStops();if(z){const G=y(),Z=this.fillRadialGradientStartPoint(),I=this.fillRadialGradientEndPoint(),W=G.createRadialGradient(Z.x,Z.y,this.fillRadialGradientStartRadius(),I.x,I.y,this.fillRadialGradientEndRadius());for(let U=0;U<z.length;U+=2)W.addColorStop(z[U],z[U+1]);return W}}getShadowRGBA(){return this._getCache(u,this._getShadowRGBA)}_getShadowRGBA(){if(!this.hasShadow())return;const z=r.Util.colorToRGBA(this.shadowColor());if(z)return"rgba("+z.r+","+z.g+","+z.b+","+z.a*(this.shadowOpacity()||1)+")"}hasFill(){return this._calculate("hasFill",["fillEnabled","fill","fillPatternImage","fillLinearGradientColorStops","fillRadialGradientColorStops"],()=>this.fillEnabled()&&!!(this.fill()||this.fillPatternImage()||this.fillLinearGradientColorStops()||this.fillRadialGradientColorStops()))}hasStroke(){return this._calculate("hasStroke",["strokeEnabled","strokeWidth","stroke","strokeLinearGradientColorStops"],()=>this.strokeEnabled()&&this.strokeWidth()&&!!(this.stroke()||this.strokeLinearGradientColorStops()))}hasHitStroke(){const z=this.hitStrokeWidth();return z==="auto"?this.hasStroke():this.strokeEnabled()&&!!z}intersects(z){const G=this.getStage();if(!G)return!1;const Z=G.bufferHitCanvas;return Z.getContext().clear(),this.drawHit(Z,void 0,!0),Z.context.getImageData(Math.round(z.x),Math.round(z.y),1,1).data[3]>0}destroy(){return i.Node.prototype.destroy.call(this),delete t.shapes[this.colorKey],delete this.colorKey,this}_useBufferCanvas(z){var G;if(!((G=this.attrs.perfectDrawEnabled)!==null&&G!==void 0?G:!0))return!1;const I=z||this.hasFill(),W=this.hasStroke(),U=this.getAbsoluteOpacity()!==1;if(I&&W&&U)return!0;const K=this.hasShadow(),$=this.shadowForStrokeEnabled();return!!(I&&W&&K&&$)}setStrokeHitEnabled(z){r.Util.warn("strokeHitEnabled property is deprecated. Please use hitStrokeWidth instead."),z?this.hitStrokeWidth("auto"):this.hitStrokeWidth(0)}getStrokeHitEnabled(){return this.hitStrokeWidth()!==0}getSelfRect(){const z=this.size();return{x:this._centroid?-z.width/2:0,y:this._centroid?-z.height/2:0,width:z.width,height:z.height}}getClientRect(z={}){let G=!1,Z=this.getParent();for(;Z;){if(Z.isCached()){G=!0;break}Z=Z.getParent()}const I=z.skipTransform,W=z.relativeTo||G&&this.getStage()||void 0,U=this.getSelfRect(),$=!z.skipStroke&&this.hasStroke()&&this.strokeWidth()||0,Q=U.width+$,ie=U.height+$,te=!z.skipShadow&&this.hasShadow(),X=te?this.shadowOffsetX():0,re=te?this.shadowOffsetY():0,fe=Q+Math.abs(X),oe=ie+Math.abs(re),se=te&&this.shadowBlur()||0,he=fe+se*2,ae=oe+se*2,pe={width:he,height:ae,x:-($/2+se)+Math.min(X,0)+U.x,y:-($/2+se)+Math.min(re,0)+U.y};return I?pe:this._transformedRect(pe,W)}drawScene(z,G,Z){const I=this.getLayer();let W=z||I.getCanvas(),U=W.getContext(),K=this._getCanvasCache(),$=this.getSceneFunc(),Q=this.hasShadow(),ie,te;const X=W.isCache,re=G===this;if(!this.isVisible()&&!re)return this;if(K){U.save();const oe=this.getAbsoluteTransform(G).getMatrix();return U.transform(oe[0],oe[1],oe[2],oe[3],oe[4],oe[5]),this._drawCachedSceneCanvas(U),U.restore(),this}if(!$)return this;if(U.save(),this._useBufferCanvas()&&!X){ie=this.getStage();const oe=Z||ie.bufferCanvas;te=oe.getContext(),te.clear(),te.save(),te._applyLineJoin(this);var fe=this.getAbsoluteTransform(G).getMatrix();te.transform(fe[0],fe[1],fe[2],fe[3],fe[4],fe[5]),$.call(this,te,this),te.restore();const se=oe.pixelRatio;Q&&U._applyShadow(this),U._applyOpacity(this),U._applyGlobalCompositeOperation(this),U.drawImage(oe._canvas,0,0,oe.width/se,oe.height/se)}else{if(U._applyLineJoin(this),!re){var fe=this.getAbsoluteTransform(G).getMatrix();U.transform(fe[0],fe[1],fe[2],fe[3],fe[4],fe[5]),U._applyOpacity(this),U._applyGlobalCompositeOperation(this)}Q&&U._applyShadow(this),$.call(this,U,this)}return U.restore(),this}drawHit(z,G,Z=!1){if(!this.shouldDrawHit(G,Z))return this;const I=this.getLayer(),W=z||I.hitCanvas,U=W&&W.getContext(),K=this.hitFunc()||this.sceneFunc(),$=this._getCanvasCache(),Q=$&&$.hit;if(this.colorKey||r.Util.warn("Looks like your canvas has a destroyed shape in it. Do not reuse shape after you destroyed it. If you want to reuse shape you should call remove() instead of destroy()"),Q){U.save();const te=this.getAbsoluteTransform(G).getMatrix();return U.transform(te[0],te[1],te[2],te[3],te[4],te[5]),this._drawCachedHitCanvas(U),U.restore(),this}if(!K)return this;if(U.save(),U._applyLineJoin(this),!(this===G)){const te=this.getAbsoluteTransform(G).getMatrix();U.transform(te[0],te[1],te[2],te[3],te[4],te[5])}return K.call(this,U,this),U.restore(),this}drawHitFromCache(z=0){let G=this._getCanvasCache(),Z=this._getCachedSceneCanvas(),I=G.hit,W=I.getContext(),U=I.getWidth(),K=I.getHeight(),$,Q,ie,te,X,re;W.clear(),W.drawImage(Z._canvas,0,0,U,K);try{for($=W.getImageData(0,0,U,K),Q=$.data,ie=Q.length,te=r.Util._hexToRgb(this.colorKey),X=0;X<ie;X+=4)re=Q[X+3],re>z?(Q[X]=te.r,Q[X+1]=te.g,Q[X+2]=te.b,Q[X+3]=255):Q[X+3]=0;W.putImageData($,0,0)}catch(fe){r.Util.error("Unable to draw hit graph from cached scene canvas. "+fe.message)}return this}hasPointerCapture(z){return o.hasPointerCapture(z,this)}setPointerCapture(z){o.setPointerCapture(z,this)}releaseCapture(z){o.releaseCapture(z,this)}}t.Shape=O,O.prototype._fillFunc=S,O.prototype._strokeFunc=w,O.prototype._fillFuncHit=C,O.prototype._strokeFuncHit=_,O.prototype._centroid=!1,O.prototype.nodeType="Shape",(0,s._registerNode)(O),O.prototype.eventListeners={},O.prototype.on.call(O.prototype,"shadowColorChange.konva shadowBlurChange.konva shadowOffsetChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",T),O.prototype.on.call(O.prototype,"shadowColorChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",N),O.prototype.on.call(O.prototype,"fillPriorityChange.konva fillPatternImageChange.konva fillPatternRepeatChange.konva fillPatternScaleXChange.konva fillPatternScaleYChange.konva fillPatternOffsetXChange.konva fillPatternOffsetYChange.konva fillPatternXChange.konva fillPatternYChange.konva fillPatternRotationChange.konva",R),O.prototype.on.call(O.prototype,"fillPriorityChange.konva fillLinearGradientColorStopsChange.konva fillLinearGradientStartPointXChange.konva fillLinearGradientStartPointYChange.konva fillLinearGradientEndPointXChange.konva fillLinearGradientEndPointYChange.konva",D),O.prototype.on.call(O.prototype,"fillPriorityChange.konva fillRadialGradientColorStopsChange.konva fillRadialGradientStartPointXChange.konva fillRadialGradientStartPointYChange.konva fillRadialGradientEndPointXChange.konva fillRadialGradientEndPointYChange.konva fillRadialGradientStartRadiusChange.konva fillRadialGradientEndRadiusChange.konva",j),n.Factory.addGetterSetter(O,"stroke",void 0,(0,a.getStringOrGradientValidator)()),n.Factory.addGetterSetter(O,"strokeWidth",2,(0,a.getNumberValidator)()),n.Factory.addGetterSetter(O,"fillAfterStrokeEnabled",!1),n.Factory.addGetterSetter(O,"hitStrokeWidth","auto",(0,a.getNumberOrAutoValidator)()),n.Factory.addGetterSetter(O,"strokeHitEnabled",!0,(0,a.getBooleanValidator)()),n.Factory.addGetterSetter(O,"perfectDrawEnabled",!0,(0,a.getBooleanValidator)()),n.Factory.addGetterSetter(O,"shadowForStrokeEnabled",!0,(0,a.getBooleanValidator)()),n.Factory.addGetterSetter(O,"lineJoin"),n.Factory.addGetterSetter(O,"lineCap"),n.Factory.addGetterSetter(O,"sceneFunc"),n.Factory.addGetterSetter(O,"hitFunc"),n.Factory.addGetterSetter(O,"dash"),n.Factory.addGetterSetter(O,"dashOffset",0,(0,a.getNumberValidator)()),n.Factory.addGetterSetter(O,"shadowColor",void 0,(0,a.getStringValidator)()),n.Factory.addGetterSetter(O,"shadowBlur",0,(0,a.getNumberValidator)()),n.Factory.addGetterSetter(O,"shadowOpacity",1,(0,a.getNumberValidator)()),n.Factory.addComponentsGetterSetter(O,"shadowOffset",["x","y"]),n.Factory.addGetterSetter(O,"shadowOffsetX",0,(0,a.getNumberValidator)()),n.Factory.addGetterSetter(O,"shadowOffsetY",0,(0,a.getNumberValidator)()),n.Factory.addGetterSetter(O,"fillPatternImage"),n.Factory.addGetterSetter(O,"fill",void 0,(0,a.getStringOrGradientValidator)()),n.Factory.addGetterSetter(O,"fillPatternX",0,(0,a.getNumberValidator)()),n.Factory.addGetterSetter(O,"fillPatternY",0,(0,a.getNumberValidator)()),n.Factory.addGetterSetter(O,"fillLinearGradientColorStops"),n.Factory.addGetterSetter(O,"strokeLinearGradientColorStops"),n.Factory.addGetterSetter(O,"fillRadialGradientStartRadius",0),n.Factory.addGetterSetter(O,"fillRadialGradientEndRadius",0),n.Factory.addGetterSetter(O,"fillRadialGradientColorStops"),n.Factory.addGetterSetter(O,"fillPatternRepeat","repeat"),n.Factory.addGetterSetter(O,"fillEnabled",!0),n.Factory.addGetterSetter(O,"strokeEnabled",!0),n.Factory.addGetterSetter(O,"shadowEnabled",!0),n.Factory.addGetterSetter(O,"dashEnabled",!0),n.Factory.addGetterSetter(O,"strokeScaleEnabled",!0),n.Factory.addGetterSetter(O,"fillPriority","color"),n.Factory.addComponentsGetterSetter(O,"fillPatternOffset",["x","y"]),n.Factory.addGetterSetter(O,"fillPatternOffsetX",0,(0,a.getNumberValidator)()),n.Factory.addGetterSetter(O,"fillPatternOffsetY",0,(0,a.getNumberValidator)()),n.Factory.addComponentsGetterSetter(O,"fillPatternScale",["x","y"]),n.Factory.addGetterSetter(O,"fillPatternScaleX",1,(0,a.getNumberValidator)()),n.Factory.addGetterSetter(O,"fillPatternScaleY",1,(0,a.getNumberValidator)()),n.Factory.addComponentsGetterSetter(O,"fillLinearGradientStartPoint",["x","y"]),n.Factory.addComponentsGetterSetter(O,"strokeLinearGradientStartPoint",["x","y"]),n.Factory.addGetterSetter(O,"fillLinearGradientStartPointX",0),n.Factory.addGetterSetter(O,"strokeLinearGradientStartPointX",0),n.Factory.addGetterSetter(O,"fillLinearGradientStartPointY",0),n.Factory.addGetterSetter(O,"strokeLinearGradientStartPointY",0),n.Factory.addComponentsGetterSetter(O,"fillLinearGradientEndPoint",["x","y"]),n.Factory.addComponentsGetterSetter(O,"strokeLinearGradientEndPoint",["x","y"]),n.Factory.addGetterSetter(O,"fillLinearGradientEndPointX",0),n.Factory.addGetterSetter(O,"strokeLinearGradientEndPointX",0),n.Factory.addGetterSetter(O,"fillLinearGradientEndPointY",0),n.Factory.addGetterSetter(O,"strokeLinearGradientEndPointY",0),n.Factory.addComponentsGetterSetter(O,"fillRadialGradientStartPoint",["x","y"]),n.Factory.addGetterSetter(O,"fillRadialGradientStartPointX",0),n.Factory.addGetterSetter(O,"fillRadialGradientStartPointY",0),n.Factory.addComponentsGetterSetter(O,"fillRadialGradientEndPoint",["x","y"]),n.Factory.addGetterSetter(O,"fillRadialGradientEndPointX",0),n.Factory.addGetterSetter(O,"fillRadialGradientEndPointY",0),n.Factory.addGetterSetter(O,"fillPatternRotation",0),n.Factory.addGetterSetter(O,"fillRule",void 0,(0,a.getStringValidator)()),n.Factory.backCompat(O,{dashArray:"dash",getDashArray:"getDash",setDashArray:"getDash",drawFunc:"sceneFunc",getDrawFunc:"getSceneFunc",setDrawFunc:"setSceneFunc",drawHitFunc:"hitFunc",getDrawHitFunc:"getHitFunc",setDrawHitFunc:"setHitFunc"})})(D2)),D2}var C5;function ML(){if(C5)return rg;C5=1,Object.defineProperty(rg,"__esModule",{value:!0}),rg.Layer=void 0;const t=pi(),e=H1(),r=Ei(),n=Lr(),i=V1(),a=Dr(),s=xa(),o=Nr(),l="#",u="beforeDraw",c="draw",f=[{x:0,y:0},{x:-1,y:-1},{x:1,y:-1},{x:1,y:1},{x:-1,y:1}],p=f.length;class g extends e.Container{constructor(S){super(S),this.canvas=new i.SceneCanvas,this.hitCanvas=new i.HitCanvas({pixelRatio:1}),this._waitingForDraw=!1,this.on("visibleChange.konva",this._checkVisibility),this._checkVisibility(),this.on("imageSmoothingEnabledChange.konva",this._setSmoothEnabled),this._setSmoothEnabled()}createPNGStream(){return this.canvas._canvas.createPNGStream()}getCanvas(){return this.canvas}getNativeCanvasElement(){return this.canvas._canvas}getHitCanvas(){return this.hitCanvas}getContext(){return this.getCanvas().getContext()}clear(S){return this.getContext().clear(S),this.getHitCanvas().getContext().clear(S),this}setZIndex(S){super.setZIndex(S);const w=this.getStage();return w&&w.content&&(w.content.removeChild(this.getNativeCanvasElement()),S<w.children.length-1?w.content.insertBefore(this.getNativeCanvasElement(),w.children[S+1].getCanvas()._canvas):w.content.appendChild(this.getNativeCanvasElement())),this}moveToTop(){r.Node.prototype.moveToTop.call(this);const S=this.getStage();return S&&S.content&&(S.content.removeChild(this.getNativeCanvasElement()),S.content.appendChild(this.getNativeCanvasElement())),!0}moveUp(){if(!r.Node.prototype.moveUp.call(this))return!1;const w=this.getStage();return!w||!w.content?!1:(w.content.removeChild(this.getNativeCanvasElement()),this.index<w.children.length-1?w.content.insertBefore(this.getNativeCanvasElement(),w.children[this.index+1].getCanvas()._canvas):w.content.appendChild(this.getNativeCanvasElement()),!0)}moveDown(){if(r.Node.prototype.moveDown.call(this)){const S=this.getStage();if(S){const w=S.children;S.content&&(S.content.removeChild(this.getNativeCanvasElement()),S.content.insertBefore(this.getNativeCanvasElement(),w[this.index+1].getCanvas()._canvas))}return!0}return!1}moveToBottom(){if(r.Node.prototype.moveToBottom.call(this)){const S=this.getStage();if(S){const w=S.children;S.content&&(S.content.removeChild(this.getNativeCanvasElement()),S.content.insertBefore(this.getNativeCanvasElement(),w[1].getCanvas()._canvas))}return!0}return!1}getLayer(){return this}remove(){const S=this.getNativeCanvasElement();return r.Node.prototype.remove.call(this),S&&S.parentNode&&t.Util._isInDocument(S)&&S.parentNode.removeChild(S),this}getStage(){return this.parent}setSize({width:S,height:w}){return this.canvas.setSize(S,w),this.hitCanvas.setSize(S,w),this._setSmoothEnabled(),this}_validateAdd(S){const w=S.getType();w!=="Group"&&w!=="Shape"&&t.Util.throw("You may only add groups and shapes to a layer.")}_toKonvaCanvas(S){return S=S||{},S.width=S.width||this.getWidth(),S.height=S.height||this.getHeight(),S.x=S.x!==void 0?S.x:this.x(),S.y=S.y!==void 0?S.y:this.y(),r.Node.prototype._toKonvaCanvas.call(this,S)}_checkVisibility(){this.visible()?this.canvas._canvas.style.display="block":this.canvas._canvas.style.display="none"}_setSmoothEnabled(){this.getContext()._context.imageSmoothingEnabled=this.imageSmoothingEnabled()}getWidth(){if(this.parent)return this.parent.width()}setWidth(){t.Util.warn('Can not change width of layer. Use "stage.width(value)" function instead.')}getHeight(){if(this.parent)return this.parent.height()}setHeight(){t.Util.warn('Can not change height of layer. Use "stage.height(value)" function instead.')}batchDraw(){return this._waitingForDraw||(this._waitingForDraw=!0,t.Util.requestAnimFrame(()=>{this.draw(),this._waitingForDraw=!1})),this}getIntersection(S){if(!this.isListening()||!this.isVisible())return null;let w=1,C=!1;for(;;){for(let _=0;_<p;_++){const T=f[_],N=this._getIntersection({x:S.x+T.x*w,y:S.y+T.y*w}),R=N.shape;if(R)return R;if(C=!!N.antialiased,!N.antialiased)break}if(C)w+=1;else return null}}_getIntersection(S){const w=this.hitCanvas.pixelRatio,C=this.hitCanvas.context.getImageData(Math.round(S.x*w),Math.round(S.y*w),1,1).data,_=C[3];if(_===255){const T=t.Util._rgbToHex(C[0],C[1],C[2]),N=s.shapes[l+T];return N?{shape:N}:{antialiased:!0}}else if(_>0)return{antialiased:!0};return{}}drawScene(S,w){const C=this.getLayer(),_=S||C&&C.getCanvas();return this._fire(u,{node:this}),this.clearBeforeDraw()&&_.getContext().clear(),e.Container.prototype.drawScene.call(this,_,w),this._fire(c,{node:this}),this}drawHit(S,w){const C=this.getLayer(),_=S||C&&C.hitCanvas;return C&&C.clearBeforeDraw()&&C.getHitCanvas().getContext().clear(),e.Container.prototype.drawHit.call(this,_,w),this}enableHitGraph(){return this.hitGraphEnabled(!0),this}disableHitGraph(){return this.hitGraphEnabled(!1),this}setHitGraphEnabled(S){t.Util.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening(S)}getHitGraphEnabled(S){return t.Util.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening()}toggleHitCanvas(){if(!this.parent||!this.parent.content)return;const S=this.parent;!!this.hitCanvas._canvas.parentNode?S.content.removeChild(this.hitCanvas._canvas):S.content.appendChild(this.hitCanvas._canvas)}destroy(){return t.Util.releaseCanvas(this.getNativeCanvasElement(),this.getHitCanvas()._canvas),super.destroy()}}return rg.Layer=g,g.prototype.nodeType="Layer",(0,o._registerNode)(g),n.Factory.addGetterSetter(g,"imageSmoothingEnabled",!0),n.Factory.addGetterSetter(g,"clearBeforeDraw",!0),n.Factory.addGetterSetter(g,"hitGraphEnabled",!0,(0,a.getBooleanValidator)()),rg}var ng={},E5;function MG(){if(E5)return ng;E5=1,Object.defineProperty(ng,"__esModule",{value:!0}),ng.FastLayer=void 0;const t=pi(),e=ML(),r=Nr();let n=class extends e.Layer{constructor(a){super(a),this.listening(!1),t.Util.warn('Konva.Fast layer is deprecated. Please use "new Konva.Layer({ listening: false })" instead.')}};return ng.FastLayer=n,n.prototype.nodeType="FastLayer",(0,r._registerNode)(n),ng}var ig={},T5;function N_(){if(T5)return ig;T5=1,Object.defineProperty(ig,"__esModule",{value:!0}),ig.Group=void 0;const t=pi(),e=H1(),r=Nr();let n=class extends e.Container{_validateAdd(a){const s=a.getType();s!=="Group"&&s!=="Shape"&&t.Util.throw("You may only add groups and shapes to groups.")}};return ig.Group=n,n.prototype.nodeType="Group",(0,r._registerNode)(n),ig}var ag={},N5;function P_(){if(N5)return ag;N5=1,Object.defineProperty(ag,"__esModule",{value:!0}),ag.Animation=void 0;const t=Nr(),e=pi(),r=(function(){return t.glob.performance&&t.glob.performance.now?function(){return t.glob.performance.now()}:function(){return new Date().getTime()}})();let n=class Cp{constructor(a,s){this.id=Cp.animIdCounter++,this.frame={time:0,timeDiff:0,lastTime:r(),frameRate:0},this.func=a,this.setLayers(s)}setLayers(a){let s=[];return a&&(s=Array.isArray(a)?a:[a]),this.layers=s,this}getLayers(){return this.layers}addLayer(a){const s=this.layers,o=s.length;for(let l=0;l<o;l++)if(s[l]._id===a._id)return!1;return this.layers.push(a),!0}isRunning(){const s=Cp.animations,o=s.length;for(let l=0;l<o;l++)if(s[l].id===this.id)return!0;return!1}start(){return this.stop(),this.frame.timeDiff=0,this.frame.lastTime=r(),Cp._addAnimation(this),this}stop(){return Cp._removeAnimation(this),this}_updateFrameObject(a){this.frame.timeDiff=a-this.frame.lastTime,this.frame.lastTime=a,this.frame.time+=this.frame.timeDiff,this.frame.frameRate=1e3/this.frame.timeDiff}static _addAnimation(a){this.animations.push(a),this._handleAnimation()}static _removeAnimation(a){const s=a.id,o=this.animations,l=o.length;for(let u=0;u<l;u++)if(o[u].id===s){this.animations.splice(u,1);break}}static _runFrames(){const a={},s=this.animations;for(let o=0;o<s.length;o++){const l=s[o],u=l.layers,c=l.func;l._updateFrameObject(r());const f=u.length;let p;if(c?p=c.call(l,l.frame)!==!1:p=!0,!!p)for(let g=0;g<f;g++){const y=u[g];y._id!==void 0&&(a[y._id]=y)}}for(const o in a)a.hasOwnProperty(o)&&a[o].batchDraw()}static _animationLoop(){const a=Cp;a.animations.length?(a._runFrames(),e.Util.requestAnimFrame(a._animationLoop)):a.animRunning=!1}static _handleAnimation(){this.animRunning||(this.animRunning=!0,e.Util.requestAnimFrame(this._animationLoop))}};return ag.Animation=n,n.animations=[],n.animIdCounter=0,n.animRunning=!1,ag}var I2={},P5;function AG(){return P5||(P5=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Easings=t.Tween=void 0;const e=pi(),r=P_(),n=Ei(),i=Nr();let a={node:1,duration:1,easing:1,onFinish:1,yoyo:1},s=1,o=2,l=3,u=0,c=["fill","stroke","shadowColor"];class f{constructor(y,S,w,C,_,T,N){this.prop=y,this.propFunc=S,this.begin=C,this._pos=C,this.duration=T,this._change=0,this.prevPos=0,this.yoyo=N,this._time=0,this._position=0,this._startTime=0,this._finish=0,this.func=w,this._change=_-this.begin,this.pause()}fire(y){const S=this[y];S&&S()}setTime(y){y>this.duration?this.yoyo?(this._time=this.duration,this.reverse()):this.finish():y<0?this.yoyo?(this._time=0,this.play()):this.reset():(this._time=y,this.update())}getTime(){return this._time}setPosition(y){this.prevPos=this._pos,this.propFunc(y),this._pos=y}getPosition(y){return y===void 0&&(y=this._time),this.func(y,this.begin,this._change,this.duration)}play(){this.state=o,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onPlay")}reverse(){this.state=l,this._time=this.duration-this._time,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onReverse")}seek(y){this.pause(),this._time=y,this.update(),this.fire("onSeek")}reset(){this.pause(),this._time=0,this.update(),this.fire("onReset")}finish(){this.pause(),this._time=this.duration,this.update(),this.fire("onFinish")}update(){this.setPosition(this.getPosition(this._time)),this.fire("onUpdate")}onEnterFrame(){const y=this.getTimer()-this._startTime;this.state===o?this.setTime(y):this.state===l&&this.setTime(this.duration-y)}pause(){this.state=s,this.fire("onPause")}getTimer(){return new Date().getTime()}}class p{constructor(y){let S=this,w=y.node,C=w._id,_,T=y.easing||t.Easings.Linear,N=!!y.yoyo,R;typeof y.duration>"u"?_=.3:y.duration===0?_=.001:_=y.duration,this.node=w,this._id=u++;const D=w.getLayer()||(w instanceof i.Konva.Stage?w.getLayers():null);D||e.Util.error("Tween constructor have `node` that is not in a layer. Please add node into layer first."),this.anim=new r.Animation(function(){S.tween.onEnterFrame()},D),this.tween=new f(R,function(j){S._tweenFunc(j)},T,0,1,_*1e3,N),this._addListeners(),p.attrs[C]||(p.attrs[C]={}),p.attrs[C][this._id]||(p.attrs[C][this._id]={}),p.tweens[C]||(p.tweens[C]={});for(R in y)a[R]===void 0&&this._addAttr(R,y[R]);this.reset(),this.onFinish=y.onFinish,this.onReset=y.onReset,this.onUpdate=y.onUpdate}_addAttr(y,S){let w=this.node,C=w._id,_,T,N,R,D,j,O,F;if(N=p.tweens[C][y],N&&delete p.attrs[C][N][y],_=w.getAttr(y),e.Util._isArray(S))if(T=[],D=Math.max(S.length,_.length),y==="points"&&S.length!==_.length&&(S.length>_.length?(O=_,_=e.Util._prepareArrayForTween(_,S,w.closed())):(j=S,S=e.Util._prepareArrayForTween(S,_,w.closed()))),y.indexOf("fill")===0)for(R=0;R<D;R++)if(R%2===0)T.push(S[R]-_[R]);else{const z=e.Util.colorToRGBA(_[R]);F=e.Util.colorToRGBA(S[R]),_[R]=z,T.push({r:F.r-z.r,g:F.g-z.g,b:F.b-z.b,a:F.a-z.a})}else for(R=0;R<D;R++)T.push(S[R]-_[R]);else c.indexOf(y)!==-1?(_=e.Util.colorToRGBA(_),F=e.Util.colorToRGBA(S),T={r:F.r-_.r,g:F.g-_.g,b:F.b-_.b,a:F.a-_.a}):T=S-_;p.attrs[C][this._id][y]={start:_,diff:T,end:S,trueEnd:j,trueStart:O},p.tweens[C][y]=this._id}_tweenFunc(y){let S=this.node,w=p.attrs[S._id][this._id],C,_,T,N,R,D,j,O;for(C in w){if(_=w[C],T=_.start,N=_.diff,O=_.end,e.Util._isArray(T))if(R=[],j=Math.max(T.length,O.length),C.indexOf("fill")===0)for(D=0;D<j;D++)D%2===0?R.push((T[D]||0)+N[D]*y):R.push("rgba("+Math.round(T[D].r+N[D].r*y)+","+Math.round(T[D].g+N[D].g*y)+","+Math.round(T[D].b+N[D].b*y)+","+(T[D].a+N[D].a*y)+")");else for(D=0;D<j;D++)R.push((T[D]||0)+N[D]*y);else c.indexOf(C)!==-1?R="rgba("+Math.round(T.r+N.r*y)+","+Math.round(T.g+N.g*y)+","+Math.round(T.b+N.b*y)+","+(T.a+N.a*y)+")":R=T+N*y;S.setAttr(C,R)}}_addListeners(){this.tween.onPlay=()=>{this.anim.start()},this.tween.onReverse=()=>{this.anim.start()},this.tween.onPause=()=>{this.anim.stop()},this.tween.onFinish=()=>{const y=this.node,S=p.attrs[y._id][this._id];S.points&&S.points.trueEnd&&y.setAttr("points",S.points.trueEnd),this.onFinish&&this.onFinish.call(this)},this.tween.onReset=()=>{const y=this.node,S=p.attrs[y._id][this._id];S.points&&S.points.trueStart&&y.points(S.points.trueStart),this.onReset&&this.onReset()},this.tween.onUpdate=()=>{this.onUpdate&&this.onUpdate.call(this)}}play(){return this.tween.play(),this}reverse(){return this.tween.reverse(),this}reset(){return this.tween.reset(),this}seek(y){return this.tween.seek(y*1e3),this}pause(){return this.tween.pause(),this}finish(){return this.tween.finish(),this}destroy(){let y=this.node._id,S=this._id,w=p.tweens[y],C;this.pause();for(C in w)delete p.tweens[y][C];delete p.attrs[y][S]}}t.Tween=p,p.attrs={},p.tweens={},n.Node.prototype.to=function(g){const y=g.onFinish;g.node=this,g.onFinish=function(){this.destroy(),y&&y()},new p(g).play()},t.Easings={BackEaseIn(g,y,S,w){return S*(g/=w)*g*((1.70158+1)*g-1.70158)+y},BackEaseOut(g,y,S,w){return S*((g=g/w-1)*g*((1.70158+1)*g+1.70158)+1)+y},BackEaseInOut(g,y,S,w){let C=1.70158;return(g/=w/2)<1?S/2*(g*g*(((C*=1.525)+1)*g-C))+y:S/2*((g-=2)*g*(((C*=1.525)+1)*g+C)+2)+y},ElasticEaseIn(g,y,S,w,C,_){let T=0;return g===0?y:(g/=w)===1?y+S:(_||(_=w*.3),!C||C<Math.abs(S)?(C=S,T=_/4):T=_/(2*Math.PI)*Math.asin(S/C),-(C*Math.pow(2,10*(g-=1))*Math.sin((g*w-T)*(2*Math.PI)/_))+y)},ElasticEaseOut(g,y,S,w,C,_){let T=0;return g===0?y:(g/=w)===1?y+S:(_||(_=w*.3),!C||C<Math.abs(S)?(C=S,T=_/4):T=_/(2*Math.PI)*Math.asin(S/C),C*Math.pow(2,-10*g)*Math.sin((g*w-T)*(2*Math.PI)/_)+S+y)},ElasticEaseInOut(g,y,S,w,C,_){let T=0;return g===0?y:(g/=w/2)===2?y+S:(_||(_=w*(.3*1.5)),!C||C<Math.abs(S)?(C=S,T=_/4):T=_/(2*Math.PI)*Math.asin(S/C),g<1?-.5*(C*Math.pow(2,10*(g-=1))*Math.sin((g*w-T)*(2*Math.PI)/_))+y:C*Math.pow(2,-10*(g-=1))*Math.sin((g*w-T)*(2*Math.PI)/_)*.5+S+y)},BounceEaseOut(g,y,S,w){return(g/=w)<1/2.75?S*(7.5625*g*g)+y:g<2/2.75?S*(7.5625*(g-=1.5/2.75)*g+.75)+y:g<2.5/2.75?S*(7.5625*(g-=2.25/2.75)*g+.9375)+y:S*(7.5625*(g-=2.625/2.75)*g+.984375)+y},BounceEaseIn(g,y,S,w){return S-t.Easings.BounceEaseOut(w-g,0,S,w)+y},BounceEaseInOut(g,y,S,w){return g<w/2?t.Easings.BounceEaseIn(g*2,0,S,w)*.5+y:t.Easings.BounceEaseOut(g*2-w,0,S,w)*.5+S*.5+y},EaseIn(g,y,S,w){return S*(g/=w)*g+y},EaseOut(g,y,S,w){return-S*(g/=w)*(g-2)+y},EaseInOut(g,y,S,w){return(g/=w/2)<1?S/2*g*g+y:-S/2*(--g*(g-2)-1)+y},StrongEaseIn(g,y,S,w){return S*(g/=w)*g*g*g*g+y},StrongEaseOut(g,y,S,w){return S*((g=g/w-1)*g*g*g*g+1)+y},StrongEaseInOut(g,y,S,w){return(g/=w/2)<1?S/2*g*g*g*g*g+y:S/2*((g-=2)*g*g*g*g+2)+y},Linear(g,y,S,w){return S*g/w+y}}})(I2)),I2}var M5;function sk(){return M5||(M5=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Konva=void 0;const e=Nr(),r=pi(),n=Ei(),i=H1(),a=PG(),s=ML(),o=MG(),l=N_(),u=T_(),c=xa(),f=P_(),p=AG(),g=NL(),y=V1();t.Konva=r.Util._assign(e.Konva,{Util:r.Util,Transform:r.Transform,Node:n.Node,Container:i.Container,Stage:a.Stage,stages:a.stages,Layer:s.Layer,FastLayer:o.FastLayer,Group:l.Group,DD:u.DD,Shape:c.Shape,shapes:c.shapes,Animation:f.Animation,Tween:p.Tween,Easings:p.Easings,Context:g.Context,Canvas:y.Canvas}),t.default=t.Konva})(P2)),P2}var sg={},A5;function LG(){if(A5)return sg;A5=1,Object.defineProperty(sg,"__esModule",{value:!0}),sg.Arc=void 0;const t=Lr(),e=xa(),r=Nr(),n=Dr(),i=Nr();let a=class extends e.Shape{_sceneFunc(o){const l=r.Konva.getAngle(this.angle()),u=this.clockwise();o.beginPath(),o.arc(0,0,this.outerRadius(),0,l,u),o.arc(0,0,this.innerRadius(),l,0,!u),o.closePath(),o.fillStrokeShape(this)}getWidth(){return this.outerRadius()*2}getHeight(){return this.outerRadius()*2}setWidth(o){this.outerRadius(o/2)}setHeight(o){this.outerRadius(o/2)}getSelfRect(){const o=this.innerRadius(),l=this.outerRadius(),u=this.clockwise(),c=r.Konva.getAngle(u?360-this.angle():this.angle()),f=Math.cos(Math.min(c,Math.PI)),p=1,g=Math.sin(Math.min(Math.max(Math.PI,c),3*Math.PI/2)),y=Math.sin(Math.min(c,Math.PI/2)),S=f*(f>0?o:l),w=p*l,C=g*(g>0?o:l),_=y*(y>0?l:o);return{x:S,y:u?-1*_:C,width:w-S,height:_-C}}};return sg.Arc=a,a.prototype._centroid=!0,a.prototype.className="Arc",a.prototype._attrsAffectingSize=["innerRadius","outerRadius"],(0,i._registerNode)(a),t.Factory.addGetterSetter(a,"innerRadius",0,(0,n.getNumberValidator)()),t.Factory.addGetterSetter(a,"outerRadius",0,(0,n.getNumberValidator)()),t.Factory.addGetterSetter(a,"angle",0,(0,n.getNumberValidator)()),t.Factory.addGetterSetter(a,"clockwise",!1,(0,n.getBooleanValidator)()),sg}var og={},lg={},L5;function AL(){if(L5)return lg;L5=1,Object.defineProperty(lg,"__esModule",{value:!0}),lg.Line=void 0;const t=Lr(),e=Nr(),r=xa(),n=Dr();function i(o,l,u,c,f,p,g){const y=Math.sqrt(Math.pow(u-o,2)+Math.pow(c-l,2)),S=Math.sqrt(Math.pow(f-u,2)+Math.pow(p-c,2)),w=g*y/(y+S),C=g*S/(y+S),_=u-w*(f-o),T=c-w*(p-l),N=u+C*(f-o),R=c+C*(p-l);return[_,T,N,R]}function a(o,l){const u=o.length,c=[];for(let f=2;f<u-2;f+=2){const p=i(o[f-2],o[f-1],o[f],o[f+1],o[f+2],o[f+3],l);isNaN(p[0])||(c.push(p[0]),c.push(p[1]),c.push(o[f]),c.push(o[f+1]),c.push(p[2]),c.push(p[3]))}return c}class s extends r.Shape{constructor(l){super(l),this.on("pointsChange.konva tensionChange.konva closedChange.konva bezierChange.konva",function(){this._clearCache("tensionPoints")})}_sceneFunc(l){let u=this.points(),c=u.length,f=this.tension(),p=this.closed(),g=this.bezier(),y,S,w;if(c){if(l.beginPath(),l.moveTo(u[0],u[1]),f!==0&&c>4){for(y=this.getTensionPoints(),S=y.length,w=p?0:4,p||l.quadraticCurveTo(y[0],y[1],y[2],y[3]);w<S-2;)l.bezierCurveTo(y[w++],y[w++],y[w++],y[w++],y[w++],y[w++]);p||l.quadraticCurveTo(y[S-2],y[S-1],u[c-2],u[c-1])}else if(g)for(w=2;w<c;)l.bezierCurveTo(u[w++],u[w++],u[w++],u[w++],u[w++],u[w++]);else for(w=2;w<c;w+=2)l.lineTo(u[w],u[w+1]);p?(l.closePath(),l.fillStrokeShape(this)):l.strokeShape(this)}}getTensionPoints(){return this._getCache("tensionPoints",this._getTensionPoints)}_getTensionPoints(){return this.closed()?this._getTensionPointsClosed():a(this.points(),this.tension())}_getTensionPointsClosed(){const l=this.points(),u=l.length,c=this.tension(),f=i(l[u-2],l[u-1],l[0],l[1],l[2],l[3],c),p=i(l[u-4],l[u-3],l[u-2],l[u-1],l[0],l[1],c),g=a(l,c);return[f[2],f[3]].concat(g).concat([p[0],p[1],l[u-2],l[u-1],p[2],p[3],f[0],f[1],l[0],l[1]])}getWidth(){return this.getSelfRect().width}getHeight(){return this.getSelfRect().height}getSelfRect(){let l=this.points();if(l.length<4)return{x:l[0]||0,y:l[1]||0,width:0,height:0};this.tension()!==0?l=[l[0],l[1],...this._getTensionPoints(),l[l.length-2],l[l.length-1]]:l=this.points();let u=l[0],c=l[0],f=l[1],p=l[1],g,y;for(let S=0;S<l.length/2;S++)g=l[S*2],y=l[S*2+1],u=Math.min(u,g),c=Math.max(c,g),f=Math.min(f,y),p=Math.max(p,y);return{x:u,y:f,width:c-u,height:p-f}}}return lg.Line=s,s.prototype.className="Line",s.prototype._attrsAffectingSize=["points","bezier","tension"],(0,e._registerNode)(s),t.Factory.addGetterSetter(s,"closed",!1),t.Factory.addGetterSetter(s,"bezier",!1),t.Factory.addGetterSetter(s,"tension",0,(0,n.getNumberValidator)()),t.Factory.addGetterSetter(s,"points",[],(0,n.getNumberArrayValidator)()),lg}var ug={},j2={},R5;function RG(){return R5||(R5=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.t2length=t.getQuadraticArcLength=t.getCubicArcLength=t.binomialCoefficients=t.cValues=t.tValues=void 0,t.tValues=[[],[],[-.5773502691896257,.5773502691896257],[0,-.7745966692414834,.7745966692414834],[-.33998104358485626,.33998104358485626,-.8611363115940526,.8611363115940526],[0,-.5384693101056831,.5384693101056831,-.906179845938664,.906179845938664],[.6612093864662645,-.6612093864662645,-.2386191860831969,.2386191860831969,-.932469514203152,.932469514203152],[0,.4058451513773972,-.4058451513773972,-.7415311855993945,.7415311855993945,-.9491079123427585,.9491079123427585],[-.1834346424956498,.1834346424956498,-.525532409916329,.525532409916329,-.7966664774136267,.7966664774136267,-.9602898564975363,.9602898564975363],[0,-.8360311073266358,.8360311073266358,-.9681602395076261,.9681602395076261,-.3242534234038089,.3242534234038089,-.6133714327005904,.6133714327005904],[-.14887433898163122,.14887433898163122,-.4333953941292472,.4333953941292472,-.6794095682990244,.6794095682990244,-.8650633666889845,.8650633666889845,-.9739065285171717,.9739065285171717],[0,-.26954315595234496,.26954315595234496,-.5190961292068118,.5190961292068118,-.7301520055740494,.7301520055740494,-.8870625997680953,.8870625997680953,-.978228658146057,.978228658146057],[-.1252334085114689,.1252334085114689,-.3678314989981802,.3678314989981802,-.5873179542866175,.5873179542866175,-.7699026741943047,.7699026741943047,-.9041172563704749,.9041172563704749,-.9815606342467192,.9815606342467192],[0,-.2304583159551348,.2304583159551348,-.44849275103644687,.44849275103644687,-.6423493394403402,.6423493394403402,-.8015780907333099,.8015780907333099,-.9175983992229779,.9175983992229779,-.9841830547185881,.9841830547185881],[-.10805494870734367,.10805494870734367,-.31911236892788974,.31911236892788974,-.5152486363581541,.5152486363581541,-.6872929048116855,.6872929048116855,-.827201315069765,.827201315069765,-.9284348836635735,.9284348836635735,-.9862838086968123,.9862838086968123],[0,-.20119409399743451,.20119409399743451,-.3941513470775634,.3941513470775634,-.5709721726085388,.5709721726085388,-.7244177313601701,.7244177313601701,-.8482065834104272,.8482065834104272,-.937273392400706,.937273392400706,-.9879925180204854,.9879925180204854],[-.09501250983763744,.09501250983763744,-.2816035507792589,.2816035507792589,-.45801677765722737,.45801677765722737,-.6178762444026438,.6178762444026438,-.755404408355003,.755404408355003,-.8656312023878318,.8656312023878318,-.9445750230732326,.9445750230732326,-.9894009349916499,.9894009349916499],[0,-.17848418149584785,.17848418149584785,-.3512317634538763,.3512317634538763,-.5126905370864769,.5126905370864769,-.6576711592166907,.6576711592166907,-.7815140038968014,.7815140038968014,-.8802391537269859,.8802391537269859,-.9506755217687678,.9506755217687678,-.9905754753144174,.9905754753144174],[-.0847750130417353,.0847750130417353,-.2518862256915055,.2518862256915055,-.41175116146284263,.41175116146284263,-.5597708310739475,.5597708310739475,-.6916870430603532,.6916870430603532,-.8037049589725231,.8037049589725231,-.8926024664975557,.8926024664975557,-.9558239495713977,.9558239495713977,-.9915651684209309,.9915651684209309],[0,-.16035864564022537,.16035864564022537,-.31656409996362983,.31656409996362983,-.46457074137596094,.46457074137596094,-.600545304661681,.600545304661681,-.7209661773352294,.7209661773352294,-.8227146565371428,.8227146565371428,-.9031559036148179,.9031559036148179,-.96020815213483,.96020815213483,-.9924068438435844,.9924068438435844],[-.07652652113349734,.07652652113349734,-.22778585114164507,.22778585114164507,-.37370608871541955,.37370608871541955,-.5108670019508271,.5108670019508271,-.636053680726515,.636053680726515,-.7463319064601508,.7463319064601508,-.8391169718222188,.8391169718222188,-.912234428251326,.912234428251326,-.9639719272779138,.9639719272779138,-.9931285991850949,.9931285991850949],[0,-.1455618541608951,.1455618541608951,-.2880213168024011,.2880213168024011,-.4243421202074388,.4243421202074388,-.5516188358872198,.5516188358872198,-.6671388041974123,.6671388041974123,-.7684399634756779,.7684399634756779,-.8533633645833173,.8533633645833173,-.9200993341504008,.9200993341504008,-.9672268385663063,.9672268385663063,-.9937521706203895,.9937521706203895],[-.06973927331972223,.06973927331972223,-.20786042668822127,.20786042668822127,-.34193582089208424,.34193582089208424,-.469355837986757,.469355837986757,-.5876404035069116,.5876404035069116,-.6944872631866827,.6944872631866827,-.7878168059792081,.7878168059792081,-.8658125777203002,.8658125777203002,-.926956772187174,.926956772187174,-.9700604978354287,.9700604978354287,-.9942945854823992,.9942945854823992],[0,-.1332568242984661,.1332568242984661,-.26413568097034495,.26413568097034495,-.3903010380302908,.3903010380302908,-.5095014778460075,.5095014778460075,-.6196098757636461,.6196098757636461,-.7186613631319502,.7186613631319502,-.8048884016188399,.8048884016188399,-.8767523582704416,.8767523582704416,-.9329710868260161,.9329710868260161,-.9725424712181152,.9725424712181152,-.9947693349975522,.9947693349975522],[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213]],t.cValues=[[],[],[1,1],[.8888888888888888,.5555555555555556,.5555555555555556],[.6521451548625461,.6521451548625461,.34785484513745385,.34785484513745385],[.5688888888888889,.47862867049936647,.47862867049936647,.23692688505618908,.23692688505618908],[.3607615730481386,.3607615730481386,.46791393457269104,.46791393457269104,.17132449237917036,.17132449237917036],[.4179591836734694,.3818300505051189,.3818300505051189,.27970539148927664,.27970539148927664,.1294849661688697,.1294849661688697],[.362683783378362,.362683783378362,.31370664587788727,.31370664587788727,.22238103445337448,.22238103445337448,.10122853629037626,.10122853629037626],[.3302393550012598,.1806481606948574,.1806481606948574,.08127438836157441,.08127438836157441,.31234707704000286,.31234707704000286,.26061069640293544,.26061069640293544],[.29552422471475287,.29552422471475287,.26926671930999635,.26926671930999635,.21908636251598204,.21908636251598204,.1494513491505806,.1494513491505806,.06667134430868814,.06667134430868814],[.2729250867779006,.26280454451024665,.26280454451024665,.23319376459199048,.23319376459199048,.18629021092773426,.18629021092773426,.1255803694649046,.1255803694649046,.05566856711617366,.05566856711617366],[.24914704581340277,.24914704581340277,.2334925365383548,.2334925365383548,.20316742672306592,.20316742672306592,.16007832854334622,.16007832854334622,.10693932599531843,.10693932599531843,.04717533638651183,.04717533638651183],[.2325515532308739,.22628318026289723,.22628318026289723,.2078160475368885,.2078160475368885,.17814598076194574,.17814598076194574,.13887351021978725,.13887351021978725,.09212149983772845,.09212149983772845,.04048400476531588,.04048400476531588],[.2152638534631578,.2152638534631578,.2051984637212956,.2051984637212956,.18553839747793782,.18553839747793782,.15720316715819355,.15720316715819355,.12151857068790319,.12151857068790319,.08015808715976021,.08015808715976021,.03511946033175186,.03511946033175186],[.2025782419255613,.19843148532711158,.19843148532711158,.1861610000155622,.1861610000155622,.16626920581699392,.16626920581699392,.13957067792615432,.13957067792615432,.10715922046717194,.10715922046717194,.07036604748810812,.07036604748810812,.03075324199611727,.03075324199611727],[.1894506104550685,.1894506104550685,.18260341504492358,.18260341504492358,.16915651939500254,.16915651939500254,.14959598881657674,.14959598881657674,.12462897125553388,.12462897125553388,.09515851168249279,.09515851168249279,.062253523938647894,.062253523938647894,.027152459411754096,.027152459411754096],[.17944647035620653,.17656270536699264,.17656270536699264,.16800410215645004,.16800410215645004,.15404576107681028,.15404576107681028,.13513636846852548,.13513636846852548,.11188384719340397,.11188384719340397,.08503614831717918,.08503614831717918,.0554595293739872,.0554595293739872,.02414830286854793,.02414830286854793],[.1691423829631436,.1691423829631436,.16427648374583273,.16427648374583273,.15468467512626524,.15468467512626524,.14064291467065065,.14064291467065065,.12255520671147846,.12255520671147846,.10094204410628717,.10094204410628717,.07642573025488905,.07642573025488905,.0497145488949698,.0497145488949698,.02161601352648331,.02161601352648331],[.1610544498487837,.15896884339395434,.15896884339395434,.15276604206585967,.15276604206585967,.1426067021736066,.1426067021736066,.12875396253933621,.12875396253933621,.11156664554733399,.11156664554733399,.09149002162245,.09149002162245,.06904454273764123,.06904454273764123,.0448142267656996,.0448142267656996,.019461788229726478,.019461788229726478],[.15275338713072584,.15275338713072584,.14917298647260374,.14917298647260374,.14209610931838204,.14209610931838204,.13168863844917664,.13168863844917664,.11819453196151841,.11819453196151841,.10193011981724044,.10193011981724044,.08327674157670475,.08327674157670475,.06267204833410907,.06267204833410907,.04060142980038694,.04060142980038694,.017614007139152118,.017614007139152118],[.14608113364969041,.14452440398997005,.14452440398997005,.13988739479107315,.13988739479107315,.13226893863333747,.13226893863333747,.12183141605372853,.12183141605372853,.10879729916714838,.10879729916714838,.09344442345603386,.09344442345603386,.0761001136283793,.0761001136283793,.057134425426857205,.057134425426857205,.036953789770852494,.036953789770852494,.016017228257774335,.016017228257774335],[.13925187285563198,.13925187285563198,.13654149834601517,.13654149834601517,.13117350478706238,.13117350478706238,.12325237681051242,.12325237681051242,.11293229608053922,.11293229608053922,.10041414444288096,.10041414444288096,.08594160621706773,.08594160621706773,.06979646842452049,.06979646842452049,.052293335152683286,.052293335152683286,.03377490158481415,.03377490158481415,.0146279952982722,.0146279952982722],[.13365457218610619,.1324620394046966,.1324620394046966,.12890572218808216,.12890572218808216,.12304908430672953,.12304908430672953,.11499664022241136,.11499664022241136,.10489209146454141,.10489209146454141,.09291576606003515,.09291576606003515,.07928141177671895,.07928141177671895,.06423242140852585,.06423242140852585,.04803767173108467,.04803767173108467,.030988005856979445,.030988005856979445,.013411859487141771,.013411859487141771],[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872]],t.binomialCoefficients=[[1],[1,1],[1,2,1],[1,3,3,1]];const e=(s,o,l)=>{let u,c;const p=l/2;u=0;for(let g=0;g<20;g++)c=p*t.tValues[20][g]+p,u+=t.cValues[20][g]*n(s,o,c);return p*u};t.getCubicArcLength=e;const r=(s,o,l)=>{l===void 0&&(l=1);const u=s[0]-2*s[1]+s[2],c=o[0]-2*o[1]+o[2],f=2*s[1]-2*s[0],p=2*o[1]-2*o[0],g=4*(u*u+c*c),y=4*(u*f+c*p),S=f*f+p*p;if(g===0)return l*Math.sqrt(Math.pow(s[2]-s[0],2)+Math.pow(o[2]-o[0],2));const w=y/(2*g),C=S/g,_=l+w,T=C-w*w,N=_*_+T>0?Math.sqrt(_*_+T):0,R=w*w+T>0?Math.sqrt(w*w+T):0,D=w+Math.sqrt(w*w+T)!==0?T*Math.log(Math.abs((_+N)/(w+R))):0;return Math.sqrt(g)/2*(_*N-w*R+D)};t.getQuadraticArcLength=r;function n(s,o,l){const u=i(1,l,s),c=i(1,l,o),f=u*u+c*c;return Math.sqrt(f)}const i=(s,o,l)=>{const u=l.length-1;let c,f;if(u===0)return 0;if(s===0){f=0;for(let p=0;p<=u;p++)f+=t.binomialCoefficients[u][p]*Math.pow(1-o,u-p)*Math.pow(o,p)*l[p];return f}else{c=new Array(u);for(let p=0;p<u;p++)c[p]=u*(l[p+1]-l[p]);return i(s-1,o,c)}},a=(s,o,l)=>{let u=1,c=s/o,f=(s-l(c))/o,p=0;for(;u>.001;){const g=l(c+f),y=Math.abs(s-g)/o;if(y<u)u=y,c+=f;else{const S=l(c-f),w=Math.abs(s-S)/o;w<u?(u=w,c-=f):f/=2}if(p++,p>500)break}return c};t.t2length=a})(j2)),j2}var O5;function M_(){if(O5)return ug;O5=1,Object.defineProperty(ug,"__esModule",{value:!0}),ug.Path=void 0;const t=Lr(),e=xa(),r=Nr(),n=RG();class i extends e.Shape{constructor(s){super(s),this.dataArray=[],this.pathLength=0,this._readDataAttribute(),this.on("dataChange.konva",function(){this._readDataAttribute()})}_readDataAttribute(){this.dataArray=i.parsePathData(this.data()),this.pathLength=i.getPathLength(this.dataArray)}_sceneFunc(s){const o=this.dataArray;s.beginPath();let l=!1;for(let N=0;N<o.length;N++){const R=o[N].command,D=o[N].points;switch(R){case"L":s.lineTo(D[0],D[1]);break;case"M":s.moveTo(D[0],D[1]);break;case"C":s.bezierCurveTo(D[0],D[1],D[2],D[3],D[4],D[5]);break;case"Q":s.quadraticCurveTo(D[0],D[1],D[2],D[3]);break;case"A":var u=D[0],c=D[1],f=D[2],p=D[3],g=D[4],y=D[5],S=D[6],w=D[7],C=f>p?f:p,_=f>p?1:f/p,T=f>p?p/f:1;s.translate(u,c),s.rotate(S),s.scale(_,T),s.arc(0,0,C,g,g+y,1-w),s.scale(1/_,1/T),s.rotate(-S),s.translate(-u,-c);break;case"z":l=!0,s.closePath();break}}!l&&!this.hasFill()?s.strokeShape(this):s.fillStrokeShape(this)}getSelfRect(){let s=[];this.dataArray.forEach(function(g){if(g.command==="A"){const y=g.points[4],S=g.points[5],w=g.points[4]+S;let C=Math.PI/180;if(Math.abs(y-w)<C&&(C=Math.abs(y-w)),S<0)for(let _=y-C;_>w;_-=C){const T=i.getPointOnEllipticalArc(g.points[0],g.points[1],g.points[2],g.points[3],_,0);s.push(T.x,T.y)}else for(let _=y+C;_<w;_+=C){const T=i.getPointOnEllipticalArc(g.points[0],g.points[1],g.points[2],g.points[3],_,0);s.push(T.x,T.y)}}else if(g.command==="C")for(let y=0;y<=1;y+=.01){const S=i.getPointOnCubicBezier(y,g.start.x,g.start.y,g.points[0],g.points[1],g.points[2],g.points[3],g.points[4],g.points[5]);s.push(S.x,S.y)}else s=s.concat(g.points)});let o=s[0],l=s[0],u=s[1],c=s[1],f,p;for(let g=0;g<s.length/2;g++)f=s[g*2],p=s[g*2+1],isNaN(f)||(o=Math.min(o,f),l=Math.max(l,f)),isNaN(p)||(u=Math.min(u,p),c=Math.max(c,p));return{x:o,y:u,width:l-o,height:c-u}}getLength(){return this.pathLength}getPointAtLength(s){return i.getPointAtLengthOfDataArray(s,this.dataArray)}static getLineLength(s,o,l,u){return Math.sqrt((l-s)*(l-s)+(u-o)*(u-o))}static getPathLength(s){let o=0;for(let l=0;l<s.length;++l)o+=s[l].pathLength;return o}static getPointAtLengthOfDataArray(s,o){let l,u=0,c=o.length;if(!c)return null;for(;u<c&&s>o[u].pathLength;)s-=o[u].pathLength,++u;if(u===c)return l=o[u-1].points.slice(-2),{x:l[0],y:l[1]};if(s<.01)return l=o[u].points.slice(0,2),{x:l[0],y:l[1]};const f=o[u],p=f.points;switch(f.command){case"L":return i.getPointOnLine(s,f.start.x,f.start.y,p[0],p[1]);case"C":return i.getPointOnCubicBezier((0,n.t2length)(s,i.getPathLength(o),N=>(0,n.getCubicArcLength)([f.start.x,p[0],p[2],p[4]],[f.start.y,p[1],p[3],p[5]],N)),f.start.x,f.start.y,p[0],p[1],p[2],p[3],p[4],p[5]);case"Q":return i.getPointOnQuadraticBezier((0,n.t2length)(s,i.getPathLength(o),N=>(0,n.getQuadraticArcLength)([f.start.x,p[0],p[2]],[f.start.y,p[1],p[3]],N)),f.start.x,f.start.y,p[0],p[1],p[2],p[3]);case"A":var g=p[0],y=p[1],S=p[2],w=p[3],C=p[4],_=p[5],T=p[6];return C+=_*s/f.pathLength,i.getPointOnEllipticalArc(g,y,S,w,C,T)}return null}static getPointOnLine(s,o,l,u,c,f,p){f=f??o,p=p??l;const g=this.getLineLength(o,l,u,c);if(g<1e-10)return{x:o,y:l};if(u===o)return{x:f,y:p+(c>l?s:-s)};const y=(c-l)/(u-o),S=Math.sqrt(s*s/(1+y*y))*(u<o?-1:1),w=y*S;if(Math.abs(p-l-y*(f-o))<1e-10)return{x:f+S,y:p+w};const C=((f-o)*(u-o)+(p-l)*(c-l))/(g*g),_=o+C*(u-o),T=l+C*(c-l),N=this.getLineLength(f,p,_,T),R=Math.sqrt(s*s-N*N),D=Math.sqrt(R*R/(1+y*y))*(u<o?-1:1),j=y*D;return{x:_+D,y:T+j}}static getPointOnCubicBezier(s,o,l,u,c,f,p,g,y){function S(R){return R*R*R}function w(R){return 3*R*R*(1-R)}function C(R){return 3*R*(1-R)*(1-R)}function _(R){return(1-R)*(1-R)*(1-R)}const T=g*S(s)+f*w(s)+u*C(s)+o*_(s),N=y*S(s)+p*w(s)+c*C(s)+l*_(s);return{x:T,y:N}}static getPointOnQuadraticBezier(s,o,l,u,c,f,p){function g(_){return _*_}function y(_){return 2*_*(1-_)}function S(_){return(1-_)*(1-_)}const w=f*g(s)+u*y(s)+o*S(s),C=p*g(s)+c*y(s)+l*S(s);return{x:w,y:C}}static getPointOnEllipticalArc(s,o,l,u,c,f){const p=Math.cos(f),g=Math.sin(f),y={x:l*Math.cos(c),y:u*Math.sin(c)};return{x:s+(y.x*p-y.y*g),y:o+(y.x*g+y.y*p)}}static parsePathData(s){if(!s)return[];let o=s;const l=["m","M","l","L","v","V","h","H","z","Z","c","C","q","Q","t","T","s","S","a","A"];o=o.replace(new RegExp(" ","g"),",");for(var u=0;u<l.length;u++)o=o.replace(new RegExp(l[u],"g"),"|"+l[u]);const c=o.split("|"),f=[],p=[];let g=0,y=0;const S=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/gi;let w;for(u=1;u<c.length;u++){let I=c[u],W=I.charAt(0);for(I=I.slice(1),p.length=0;w=S.exec(I);)p.push(w[0]);const U=[];for(let K=0,$=p.length;K<$;K++){if(p[K]==="00"){U.push(0,0);continue}const Q=parseFloat(p[K]);isNaN(Q)?U.push(0):U.push(Q)}for(;U.length>0&&!isNaN(U[0]);){let K="",$=[];const Q=g,ie=y;var C,_,T,N,R,D,j,O,F,z;switch(W){case"l":g+=U.shift(),y+=U.shift(),K="L",$.push(g,y);break;case"L":g=U.shift(),y=U.shift(),$.push(g,y);break;case"m":var G=U.shift(),Z=U.shift();if(g+=G,y+=Z,K="M",f.length>2&&f[f.length-1].command==="z"){for(let te=f.length-2;te>=0;te--)if(f[te].command==="M"){g=f[te].points[0]+G,y=f[te].points[1]+Z;break}}$.push(g,y),W="l";break;case"M":g=U.shift(),y=U.shift(),K="M",$.push(g,y),W="L";break;case"h":g+=U.shift(),K="L",$.push(g,y);break;case"H":g=U.shift(),K="L",$.push(g,y);break;case"v":y+=U.shift(),K="L",$.push(g,y);break;case"V":y=U.shift(),K="L",$.push(g,y);break;case"C":$.push(U.shift(),U.shift(),U.shift(),U.shift()),g=U.shift(),y=U.shift(),$.push(g,y);break;case"c":$.push(g+U.shift(),y+U.shift(),g+U.shift(),y+U.shift()),g+=U.shift(),y+=U.shift(),K="C",$.push(g,y);break;case"S":_=g,T=y,C=f[f.length-1],C.command==="C"&&(_=g+(g-C.points[2]),T=y+(y-C.points[3])),$.push(_,T,U.shift(),U.shift()),g=U.shift(),y=U.shift(),K="C",$.push(g,y);break;case"s":_=g,T=y,C=f[f.length-1],C.command==="C"&&(_=g+(g-C.points[2]),T=y+(y-C.points[3])),$.push(_,T,g+U.shift(),y+U.shift()),g+=U.shift(),y+=U.shift(),K="C",$.push(g,y);break;case"Q":$.push(U.shift(),U.shift()),g=U.shift(),y=U.shift(),$.push(g,y);break;case"q":$.push(g+U.shift(),y+U.shift()),g+=U.shift(),y+=U.shift(),K="Q",$.push(g,y);break;case"T":_=g,T=y,C=f[f.length-1],C.command==="Q"&&(_=g+(g-C.points[0]),T=y+(y-C.points[1])),g=U.shift(),y=U.shift(),K="Q",$.push(_,T,g,y);break;case"t":_=g,T=y,C=f[f.length-1],C.command==="Q"&&(_=g+(g-C.points[0]),T=y+(y-C.points[1])),g+=U.shift(),y+=U.shift(),K="Q",$.push(_,T,g,y);break;case"A":N=U.shift(),R=U.shift(),D=U.shift(),j=U.shift(),O=U.shift(),F=g,z=y,g=U.shift(),y=U.shift(),K="A",$=this.convertEndpointToCenterParameterization(F,z,g,y,j,O,N,R,D);break;case"a":N=U.shift(),R=U.shift(),D=U.shift(),j=U.shift(),O=U.shift(),F=g,z=y,g+=U.shift(),y+=U.shift(),K="A",$=this.convertEndpointToCenterParameterization(F,z,g,y,j,O,N,R,D);break}f.push({command:K||W,points:$,start:{x:Q,y:ie},pathLength:this.calcLength(Q,ie,K||W,$)})}(W==="z"||W==="Z")&&f.push({command:"z",points:[],start:void 0,pathLength:0})}return f}static calcLength(s,o,l,u){let c,f,p,g;const y=i;switch(l){case"L":return y.getLineLength(s,o,u[0],u[1]);case"C":return(0,n.getCubicArcLength)([s,u[0],u[2],u[4]],[o,u[1],u[3],u[5]],1);case"Q":return(0,n.getQuadraticArcLength)([s,u[0],u[2]],[o,u[1],u[3]],1);case"A":c=0;var S=u[4],w=u[5],C=u[4]+w,_=Math.PI/180;if(Math.abs(S-C)<_&&(_=Math.abs(S-C)),f=y.getPointOnEllipticalArc(u[0],u[1],u[2],u[3],S,0),w<0)for(g=S-_;g>C;g-=_)p=y.getPointOnEllipticalArc(u[0],u[1],u[2],u[3],g,0),c+=y.getLineLength(f.x,f.y,p.x,p.y),f=p;else for(g=S+_;g<C;g+=_)p=y.getPointOnEllipticalArc(u[0],u[1],u[2],u[3],g,0),c+=y.getLineLength(f.x,f.y,p.x,p.y),f=p;return p=y.getPointOnEllipticalArc(u[0],u[1],u[2],u[3],C,0),c+=y.getLineLength(f.x,f.y,p.x,p.y),c}return 0}static convertEndpointToCenterParameterization(s,o,l,u,c,f,p,g,y){const S=y*(Math.PI/180),w=Math.cos(S)*(s-l)/2+Math.sin(S)*(o-u)/2,C=-1*Math.sin(S)*(s-l)/2+Math.cos(S)*(o-u)/2,_=w*w/(p*p)+C*C/(g*g);_>1&&(p*=Math.sqrt(_),g*=Math.sqrt(_));let T=Math.sqrt((p*p*(g*g)-p*p*(C*C)-g*g*(w*w))/(p*p*(C*C)+g*g*(w*w)));c===f&&(T*=-1),isNaN(T)&&(T=0);const N=T*p*C/g,R=T*-g*w/p,D=(s+l)/2+Math.cos(S)*N-Math.sin(S)*R,j=(o+u)/2+Math.sin(S)*N+Math.cos(S)*R,O=function(U){return Math.sqrt(U[0]*U[0]+U[1]*U[1])},F=function(U,K){return(U[0]*K[0]+U[1]*K[1])/(O(U)*O(K))},z=function(U,K){return(U[0]*K[1]<U[1]*K[0]?-1:1)*Math.acos(F(U,K))},G=z([1,0],[(w-N)/p,(C-R)/g]),Z=[(w-N)/p,(C-R)/g],I=[(-1*w-N)/p,(-1*C-R)/g];let W=z(Z,I);return F(Z,I)<=-1&&(W=Math.PI),F(Z,I)>=1&&(W=0),f===0&&W>0&&(W=W-2*Math.PI),f===1&&W<0&&(W=W+2*Math.PI),[D,j,p,g,G,W,S,f]}}return ug.Path=i,i.prototype.className="Path",i.prototype._attrsAffectingSize=["data"],(0,r._registerNode)(i),t.Factory.addGetterSetter(i,"data"),ug}var D5;function OG(){if(D5)return og;D5=1,Object.defineProperty(og,"__esModule",{value:!0}),og.Arrow=void 0;const t=Lr(),e=AL(),r=Dr(),n=Nr(),i=M_();let a=class extends e.Line{_sceneFunc(o){super._sceneFunc(o);const l=Math.PI*2,u=this.points();let c=u;const f=this.tension()!==0&&u.length>4;f&&(c=this.getTensionPoints());const p=this.pointerLength(),g=u.length;let y,S;if(f){const _=[c[c.length-4],c[c.length-3],c[c.length-2],c[c.length-1],u[g-2],u[g-1]],T=i.Path.calcLength(c[c.length-4],c[c.length-3],"C",_),N=i.Path.getPointOnQuadraticBezier(Math.min(1,1-p/T),_[0],_[1],_[2],_[3],_[4],_[5]);y=u[g-2]-N.x,S=u[g-1]-N.y}else y=u[g-2]-u[g-4],S=u[g-1]-u[g-3];const w=(Math.atan2(S,y)+l)%l,C=this.pointerWidth();this.pointerAtEnding()&&(o.save(),o.beginPath(),o.translate(u[g-2],u[g-1]),o.rotate(w),o.moveTo(0,0),o.lineTo(-p,C/2),o.lineTo(-p,-C/2),o.closePath(),o.restore(),this.__fillStroke(o)),this.pointerAtBeginning()&&(o.save(),o.beginPath(),o.translate(u[0],u[1]),f?(y=(c[0]+c[2])/2-u[0],S=(c[1]+c[3])/2-u[1]):(y=u[2]-u[0],S=u[3]-u[1]),o.rotate((Math.atan2(-S,-y)+l)%l),o.moveTo(0,0),o.lineTo(-p,C/2),o.lineTo(-p,-C/2),o.closePath(),o.restore(),this.__fillStroke(o))}__fillStroke(o){const l=this.dashEnabled();l&&(this.attrs.dashEnabled=!1,o.setLineDash([])),o.fillStrokeShape(this),l&&(this.attrs.dashEnabled=!0)}getSelfRect(){const o=super.getSelfRect(),l=this.pointerWidth()/2;return{x:o.x-l,y:o.y-l,width:o.width+l*2,height:o.height+l*2}}};return og.Arrow=a,a.prototype.className="Arrow",(0,n._registerNode)(a),t.Factory.addGetterSetter(a,"pointerLength",10,(0,r.getNumberValidator)()),t.Factory.addGetterSetter(a,"pointerWidth",10,(0,r.getNumberValidator)()),t.Factory.addGetterSetter(a,"pointerAtBeginning",!1),t.Factory.addGetterSetter(a,"pointerAtEnding",!0),og}var cg={},I5;function DG(){if(I5)return cg;I5=1,Object.defineProperty(cg,"__esModule",{value:!0}),cg.Circle=void 0;const t=Lr(),e=xa(),r=Dr(),n=Nr();class i extends e.Shape{_sceneFunc(s){s.beginPath(),s.arc(0,0,this.attrs.radius||0,0,Math.PI*2,!1),s.closePath(),s.fillStrokeShape(this)}getWidth(){return this.radius()*2}getHeight(){return this.radius()*2}setWidth(s){this.radius()!==s/2&&this.radius(s/2)}setHeight(s){this.radius()!==s/2&&this.radius(s/2)}}return cg.Circle=i,i.prototype._centroid=!0,i.prototype.className="Circle",i.prototype._attrsAffectingSize=["radius"],(0,n._registerNode)(i),t.Factory.addGetterSetter(i,"radius",0,(0,r.getNumberValidator)()),cg}var dg={},j5;function IG(){if(j5)return dg;j5=1,Object.defineProperty(dg,"__esModule",{value:!0}),dg.Ellipse=void 0;const t=Lr(),e=xa(),r=Dr(),n=Nr();let i=class extends e.Shape{_sceneFunc(s){const o=this.radiusX(),l=this.radiusY();s.beginPath(),s.save(),o!==l&&s.scale(1,l/o),s.arc(0,0,o,0,Math.PI*2,!1),s.restore(),s.closePath(),s.fillStrokeShape(this)}getWidth(){return this.radiusX()*2}getHeight(){return this.radiusY()*2}setWidth(s){this.radiusX(s/2)}setHeight(s){this.radiusY(s/2)}};return dg.Ellipse=i,i.prototype.className="Ellipse",i.prototype._centroid=!0,i.prototype._attrsAffectingSize=["radiusX","radiusY"],(0,n._registerNode)(i),t.Factory.addComponentsGetterSetter(i,"radius",["x","y"]),t.Factory.addGetterSetter(i,"radiusX",0,(0,r.getNumberValidator)()),t.Factory.addGetterSetter(i,"radiusY",0,(0,r.getNumberValidator)()),dg}var fg={},F5;function jG(){if(F5)return fg;F5=1,Object.defineProperty(fg,"__esModule",{value:!0}),fg.Image=void 0;const t=pi(),e=Lr(),r=xa(),n=Nr(),i=Dr();class a extends r.Shape{constructor(o){super(o),this.on("imageChange.konva",()=>{this._setImageLoad()}),this._setImageLoad()}_setImageLoad(){const o=this.image();o&&o.complete||o&&o.readyState===4||o&&o.addEventListener&&o.addEventListener("load",()=>{this._requestDraw()})}_useBufferCanvas(){const o=!!this.cornerRadius(),l=this.hasShadow();return o&&l?!0:super._useBufferCanvas(!0)}_sceneFunc(o){const l=this.getWidth(),u=this.getHeight(),c=this.cornerRadius(),f=this.attrs.image;let p;if(f){const g=this.attrs.cropWidth,y=this.attrs.cropHeight;g&&y?p=[f,this.cropX(),this.cropY(),g,y,0,0,l,u]:p=[f,0,0,l,u]}(this.hasFill()||this.hasStroke()||c)&&(o.beginPath(),c?t.Util.drawRoundedRectPath(o,l,u,c):o.rect(0,0,l,u),o.closePath(),o.fillStrokeShape(this)),f&&(c&&o.clip(),o.drawImage.apply(o,p))}_hitFunc(o){const l=this.width(),u=this.height(),c=this.cornerRadius();o.beginPath(),c?t.Util.drawRoundedRectPath(o,l,u,c):o.rect(0,0,l,u),o.closePath(),o.fillStrokeShape(this)}getWidth(){var o,l;return(o=this.attrs.width)!==null&&o!==void 0?o:(l=this.image())===null||l===void 0?void 0:l.width}getHeight(){var o,l;return(o=this.attrs.height)!==null&&o!==void 0?o:(l=this.image())===null||l===void 0?void 0:l.height}static fromURL(o,l,u=null){const c=t.Util.createImageElement();c.onload=function(){const f=new a({image:c});l(f)},c.onerror=u,c.crossOrigin="Anonymous",c.src=o}}return fg.Image=a,a.prototype.className="Image",(0,n._registerNode)(a),e.Factory.addGetterSetter(a,"cornerRadius",0,(0,i.getNumberOrArrayOfNumbersValidator)(4)),e.Factory.addGetterSetter(a,"image"),e.Factory.addComponentsGetterSetter(a,"crop",["x","y","width","height"]),e.Factory.addGetterSetter(a,"cropX",0,(0,i.getNumberValidator)()),e.Factory.addGetterSetter(a,"cropY",0,(0,i.getNumberValidator)()),e.Factory.addGetterSetter(a,"cropWidth",0,(0,i.getNumberValidator)()),e.Factory.addGetterSetter(a,"cropHeight",0,(0,i.getNumberValidator)()),fg}var Wf={},B5;function FG(){if(B5)return Wf;B5=1,Object.defineProperty(Wf,"__esModule",{value:!0}),Wf.Tag=Wf.Label=void 0;const t=Lr(),e=xa(),r=N_(),n=Dr(),i=Nr(),a=["fontFamily","fontSize","fontStyle","padding","lineHeight","text","width","height","pointerDirection","pointerWidth","pointerHeight"],s="Change.konva",o="none",l="up",u="right",c="down",f="left",p=a.length;let g=class extends r.Group{constructor(w){super(w),this.on("add.konva",function(C){this._addListeners(C.child),this._sync()})}getText(){return this.find("Text")[0]}getTag(){return this.find("Tag")[0]}_addListeners(w){let C=this,_;const T=function(){C._sync()};for(_=0;_<p;_++)w.on(a[_]+s,T)}getWidth(){return this.getText().width()}getHeight(){return this.getText().height()}_sync(){let w=this.getText(),C=this.getTag(),_,T,N,R,D,j,O;if(w&&C){switch(_=w.width(),T=w.height(),N=C.pointerDirection(),R=C.pointerWidth(),O=C.pointerHeight(),D=0,j=0,N){case l:D=_/2,j=-1*O;break;case u:D=_+R,j=T/2;break;case c:D=_/2,j=T+O;break;case f:D=-1*R,j=T/2;break}C.setAttrs({x:-1*D,y:-1*j,width:_,height:T}),w.setAttrs({x:-1*D,y:-1*j})}}};Wf.Label=g,g.prototype.className="Label",(0,i._registerNode)(g);class y extends e.Shape{_sceneFunc(w){const C=this.width(),_=this.height(),T=this.pointerDirection(),N=this.pointerWidth(),R=this.pointerHeight(),D=this.cornerRadius();let j=0,O=0,F=0,z=0;typeof D=="number"?j=O=F=z=Math.min(D,C/2,_/2):(j=Math.min(D[0]||0,C/2,_/2),O=Math.min(D[1]||0,C/2,_/2),z=Math.min(D[2]||0,C/2,_/2),F=Math.min(D[3]||0,C/2,_/2)),w.beginPath(),w.moveTo(j,0),T===l&&(w.lineTo((C-N)/2,0),w.lineTo(C/2,-1*R),w.lineTo((C+N)/2,0)),w.lineTo(C-O,0),w.arc(C-O,O,O,Math.PI*3/2,0,!1),T===u&&(w.lineTo(C,(_-R)/2),w.lineTo(C+N,_/2),w.lineTo(C,(_+R)/2)),w.lineTo(C,_-z),w.arc(C-z,_-z,z,0,Math.PI/2,!1),T===c&&(w.lineTo((C+N)/2,_),w.lineTo(C/2,_+R),w.lineTo((C-N)/2,_)),w.lineTo(F,_),w.arc(F,_-F,F,Math.PI/2,Math.PI,!1),T===f&&(w.lineTo(0,(_+R)/2),w.lineTo(-1*N,_/2),w.lineTo(0,(_-R)/2)),w.lineTo(0,j),w.arc(j,j,j,Math.PI,Math.PI*3/2,!1),w.closePath(),w.fillStrokeShape(this)}getSelfRect(){let w=0,C=0,_=this.pointerWidth(),T=this.pointerHeight(),N=this.pointerDirection(),R=this.width(),D=this.height();return N===l?(C-=T,D+=T):N===c?D+=T:N===f?(w-=_*1.5,R+=_):N===u&&(R+=_*1.5),{x:w,y:C,width:R,height:D}}}return Wf.Tag=y,y.prototype.className="Tag",(0,i._registerNode)(y),t.Factory.addGetterSetter(y,"pointerDirection",o),t.Factory.addGetterSetter(y,"pointerWidth",0,(0,n.getNumberValidator)()),t.Factory.addGetterSetter(y,"pointerHeight",0,(0,n.getNumberValidator)()),t.Factory.addGetterSetter(y,"cornerRadius",0,(0,n.getNumberOrArrayOfNumbersValidator)(4)),Wf}var hg={},z5;function LL(){if(z5)return hg;z5=1,Object.defineProperty(hg,"__esModule",{value:!0}),hg.Rect=void 0;const t=Lr(),e=xa(),r=Nr(),n=pi(),i=Dr();class a extends e.Shape{_sceneFunc(o){const l=this.cornerRadius(),u=this.width(),c=this.height();o.beginPath(),l?n.Util.drawRoundedRectPath(o,u,c,l):o.rect(0,0,u,c),o.closePath(),o.fillStrokeShape(this)}}return hg.Rect=a,a.prototype.className="Rect",(0,r._registerNode)(a),t.Factory.addGetterSetter(a,"cornerRadius",0,(0,i.getNumberOrArrayOfNumbersValidator)(4)),hg}var pg={},U5;function BG(){if(U5)return pg;U5=1,Object.defineProperty(pg,"__esModule",{value:!0}),pg.RegularPolygon=void 0;const t=Lr(),e=xa(),r=Dr(),n=Nr();let i=class extends e.Shape{_sceneFunc(s){const o=this._getPoints();s.beginPath(),s.moveTo(o[0].x,o[0].y);for(let l=1;l<o.length;l++)s.lineTo(o[l].x,o[l].y);s.closePath(),s.fillStrokeShape(this)}_getPoints(){const s=this.attrs.sides,o=this.attrs.radius||0,l=[];for(let u=0;u<s;u++)l.push({x:o*Math.sin(u*2*Math.PI/s),y:-1*o*Math.cos(u*2*Math.PI/s)});return l}getSelfRect(){const s=this._getPoints();let o=s[0].x,l=s[0].y,u=s[0].x,c=s[0].y;return s.forEach(f=>{o=Math.min(o,f.x),l=Math.max(l,f.x),u=Math.min(u,f.y),c=Math.max(c,f.y)}),{x:o,y:u,width:l-o,height:c-u}}getWidth(){return this.radius()*2}getHeight(){return this.radius()*2}setWidth(s){this.radius(s/2)}setHeight(s){this.radius(s/2)}};return pg.RegularPolygon=i,i.prototype.className="RegularPolygon",i.prototype._centroid=!0,i.prototype._attrsAffectingSize=["radius"],(0,n._registerNode)(i),t.Factory.addGetterSetter(i,"radius",0,(0,r.getNumberValidator)()),t.Factory.addGetterSetter(i,"sides",0,(0,r.getNumberValidator)()),pg}var mg={},G5;function zG(){if(G5)return mg;G5=1,Object.defineProperty(mg,"__esModule",{value:!0}),mg.Ring=void 0;const t=Lr(),e=xa(),r=Dr(),n=Nr(),i=Math.PI*2;let a=class extends e.Shape{_sceneFunc(o){o.beginPath(),o.arc(0,0,this.innerRadius(),0,i,!1),o.moveTo(this.outerRadius(),0),o.arc(0,0,this.outerRadius(),i,0,!0),o.closePath(),o.fillStrokeShape(this)}getWidth(){return this.outerRadius()*2}getHeight(){return this.outerRadius()*2}setWidth(o){this.outerRadius(o/2)}setHeight(o){this.outerRadius(o/2)}};return mg.Ring=a,a.prototype.className="Ring",a.prototype._centroid=!0,a.prototype._attrsAffectingSize=["innerRadius","outerRadius"],(0,n._registerNode)(a),t.Factory.addGetterSetter(a,"innerRadius",0,(0,r.getNumberValidator)()),t.Factory.addGetterSetter(a,"outerRadius",0,(0,r.getNumberValidator)()),mg}var gg={},V5;function UG(){if(V5)return gg;V5=1,Object.defineProperty(gg,"__esModule",{value:!0}),gg.Sprite=void 0;const t=Lr(),e=xa(),r=P_(),n=Dr(),i=Nr();let a=class extends e.Shape{constructor(o){super(o),this._updated=!0,this.anim=new r.Animation(()=>{const l=this._updated;return this._updated=!1,l}),this.on("animationChange.konva",function(){this.frameIndex(0)}),this.on("frameIndexChange.konva",function(){this._updated=!0}),this.on("frameRateChange.konva",function(){this.anim.isRunning()&&(clearInterval(this.interval),this._setInterval())})}_sceneFunc(o){const l=this.animation(),u=this.frameIndex(),c=u*4,f=this.animations()[l],p=this.frameOffsets(),g=f[c+0],y=f[c+1],S=f[c+2],w=f[c+3],C=this.image();if((this.hasFill()||this.hasStroke())&&(o.beginPath(),o.rect(0,0,S,w),o.closePath(),o.fillStrokeShape(this)),C)if(p){const _=p[l],T=u*2;o.drawImage(C,g,y,S,w,_[T+0],_[T+1],S,w)}else o.drawImage(C,g,y,S,w,0,0,S,w)}_hitFunc(o){const l=this.animation(),u=this.frameIndex(),c=u*4,f=this.animations()[l],p=this.frameOffsets(),g=f[c+2],y=f[c+3];if(o.beginPath(),p){const S=p[l],w=u*2;o.rect(S[w+0],S[w+1],g,y)}else o.rect(0,0,g,y);o.closePath(),o.fillShape(this)}_useBufferCanvas(){return super._useBufferCanvas(!0)}_setInterval(){const o=this;this.interval=setInterval(function(){o._updateIndex()},1e3/this.frameRate())}start(){if(this.isRunning())return;const o=this.getLayer();this.anim.setLayers(o),this._setInterval(),this.anim.start()}stop(){this.anim.stop(),clearInterval(this.interval)}isRunning(){return this.anim.isRunning()}_updateIndex(){const o=this.frameIndex(),l=this.animation(),u=this.animations(),c=u[l],f=c.length/4;o<f-1?this.frameIndex(o+1):this.frameIndex(0)}};return gg.Sprite=a,a.prototype.className="Sprite",(0,i._registerNode)(a),t.Factory.addGetterSetter(a,"animation"),t.Factory.addGetterSetter(a,"animations"),t.Factory.addGetterSetter(a,"frameOffsets"),t.Factory.addGetterSetter(a,"image"),t.Factory.addGetterSetter(a,"frameIndex",0,(0,n.getNumberValidator)()),t.Factory.addGetterSetter(a,"frameRate",17,(0,n.getNumberValidator)()),t.Factory.backCompat(a,{index:"frameIndex",getIndex:"getFrameIndex",setIndex:"setFrameIndex"}),gg}var vg={},H5;function GG(){if(H5)return vg;H5=1,Object.defineProperty(vg,"__esModule",{value:!0}),vg.Star=void 0;const t=Lr(),e=xa(),r=Dr(),n=Nr();let i=class extends e.Shape{_sceneFunc(s){const o=this.innerRadius(),l=this.outerRadius(),u=this.numPoints();s.beginPath(),s.moveTo(0,0-l);for(let c=1;c<u*2;c++){const f=c%2===0?l:o,p=f*Math.sin(c*Math.PI/u),g=-1*f*Math.cos(c*Math.PI/u);s.lineTo(p,g)}s.closePath(),s.fillStrokeShape(this)}getWidth(){return this.outerRadius()*2}getHeight(){return this.outerRadius()*2}setWidth(s){this.outerRadius(s/2)}setHeight(s){this.outerRadius(s/2)}};return vg.Star=i,i.prototype.className="Star",i.prototype._centroid=!0,i.prototype._attrsAffectingSize=["innerRadius","outerRadius"],(0,n._registerNode)(i),t.Factory.addGetterSetter(i,"numPoints",5,(0,r.getNumberValidator)()),t.Factory.addGetterSetter(i,"innerRadius",0,(0,r.getNumberValidator)()),t.Factory.addGetterSetter(i,"outerRadius",0,(0,r.getNumberValidator)()),vg}var bp={},W5;function RL(){if(W5)return bp;W5=1,Object.defineProperty(bp,"__esModule",{value:!0}),bp.Text=void 0,bp.stringToArray=s;const t=pi(),e=Lr(),r=xa(),n=Nr(),i=Dr(),a=Nr();function s(re){return[...re].reduce((fe,oe,se,he)=>(new RegExp("\\p{Emoji_Modifier_Base}\\p{Emoji_Modifier}?(?:\\u200D\\p{Emoji_Presentation})+","u").test(oe)?fe.push(oe):new RegExp("\\p{Regional_Indicator}{2}","u").test(oe+(he[se+1]||""))?fe.push(oe+he[se+1]):se>0&&new RegExp("\\p{Mn}|\\p{Me}|\\p{Mc}","u").test(oe)?fe[fe.length-1]+=oe:fe.push(oe),fe),[])}const o="auto",l="center",u="inherit",c="justify",f="Change.konva",p="2d",g="-",y="left",S="text",w="Text",C="top",_="bottom",T="middle",N="normal",R="px ",D=" ",j="right",O="rtl",F="word",z="char",G="none",Z="",I=["direction","fontFamily","fontSize","fontStyle","fontVariant","padding","align","verticalAlign","lineHeight","text","width","height","wrap","ellipsis","letterSpacing"],W=I.length;function U(re){return re.split(",").map(fe=>{fe=fe.trim();const oe=fe.indexOf(" ")>=0,se=fe.indexOf('"')>=0||fe.indexOf("'")>=0;return oe&&!se&&(fe=`"${fe}"`),fe}).join(", ")}let K;function $(){return K||(K=t.Util.createCanvasElement().getContext(p),K)}function Q(re){re.fillText(this._partialText,this._partialTextX,this._partialTextY)}function ie(re){re.setAttr("miterLimit",2),re.strokeText(this._partialText,this._partialTextX,this._partialTextY)}function te(re){return re=re||{},!re.fillLinearGradientColorStops&&!re.fillRadialGradientColorStops&&!re.fillPatternImage&&(re.fill=re.fill||"black"),re}class X extends r.Shape{constructor(fe){super(te(fe)),this._partialTextX=0,this._partialTextY=0;for(let oe=0;oe<W;oe++)this.on(I[oe]+f,this._setTextData);this._setTextData()}_sceneFunc(fe){const oe=this.textArr,se=oe.length;if(!this.text())return;let he=this.padding(),ae=this.fontSize(),pe=this.lineHeight()*ae,ye=this.verticalAlign(),ve=this.direction(),ue=0,xe=this.align(),Se=this.getWidth(),Ae=this.letterSpacing(),Me=this.fill(),st=this.textDecoration(),rt=st.indexOf("underline")!==-1,dt=st.indexOf("line-through")!==-1,Ct;ve=ve===u?fe.direction:ve;let Ke=pe/2,ut=T;if(n.Konva._fixTextRendering){const lt=this.measureSize("M");ut="alphabetic",Ke=(lt.fontBoundingBoxAscent-lt.fontBoundingBoxDescent)/2+pe/2}var ct=0,xt=0;for(ve===O&&fe.setAttr("direction",ve),fe.setAttr("font",this._getContextFont()),fe.setAttr("textBaseline",ut),fe.setAttr("textAlign",y),ye===T?ue=(this.getHeight()-se*pe-he*2)/2:ye===_&&(ue=this.getHeight()-se*pe-he*2),fe.translate(he,ue+he),Ct=0;Ct<se;Ct++){var ct=0,xt=0,ot=oe[Ct],Lt=ot.text,Bt=ot.width,Ne=ot.lastInParagraph,qe,St,it;if(fe.save(),xe===j?ct+=Se-Bt-he*2:xe===l&&(ct+=(Se-Bt-he*2)/2),rt){fe.save(),fe.beginPath();const de=n.Konva._fixTextRendering?Math.round(ae/4):Math.round(ae/2),ge=ct,ke=Ke+xt+de;fe.moveTo(ge,ke),qe=Lt.split(" ").length-1,St=qe===0,it=xe===c&&!Ne?Se-he*2:Bt,fe.lineTo(ge+Math.round(it),ke),fe.lineWidth=ae/15;const Ee=this._getLinearGradient();fe.strokeStyle=Ee||Me,fe.stroke(),fe.restore()}if(dt){fe.save(),fe.beginPath();const de=n.Konva._fixTextRendering?-Math.round(ae/4):0;fe.moveTo(ct,Ke+xt+de),qe=Lt.split(" ").length-1,St=qe===0,it=xe===c&&Ne&&!St?Se-he*2:Bt,fe.lineTo(ct+Math.round(it),Ke+xt+de),fe.lineWidth=ae/15;const ge=this._getLinearGradient();fe.strokeStyle=ge||Me,fe.stroke(),fe.restore()}if(ve!==O&&(Ae!==0||xe===c)){qe=Lt.split(" ").length-1;const de=s(Lt);for(let ge=0;ge<de.length;ge++){const ke=de[ge];ke===" "&&!Ne&&xe===c&&(ct+=(Se-he*2-Bt)/qe),this._partialTextX=ct,this._partialTextY=Ke+xt,this._partialText=ke,fe.fillStrokeShape(this),ct+=this.measureSize(ke).width+Ae}}else Ae!==0&&fe.setAttr("letterSpacing",`${Ae}px`),this._partialTextX=ct,this._partialTextY=Ke+xt,this._partialText=Lt,fe.fillStrokeShape(this);fe.restore(),se>1&&(Ke+=pe)}}_hitFunc(fe){const oe=this.getWidth(),se=this.getHeight();fe.beginPath(),fe.rect(0,0,oe,se),fe.closePath(),fe.fillStrokeShape(this)}setText(fe){const oe=t.Util._isString(fe)?fe:fe==null?"":fe+"";return this._setAttr(S,oe),this}getWidth(){return this.attrs.width===o||this.attrs.width===void 0?this.getTextWidth()+this.padding()*2:this.attrs.width}getHeight(){return this.attrs.height===o||this.attrs.height===void 0?this.fontSize()*this.textArr.length*this.lineHeight()+this.padding()*2:this.attrs.height}getTextWidth(){return this.textWidth}getTextHeight(){return t.Util.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height."),this.textHeight}measureSize(fe){var oe,se,he,ae,pe,ye,ve,ue,xe,Se,Ae;let Me=$(),st=this.fontSize(),rt;Me.save(),Me.font=this._getContextFont(),rt=Me.measureText(fe),Me.restore();const dt=st/100;return{actualBoundingBoxAscent:(oe=rt.actualBoundingBoxAscent)!==null&&oe!==void 0?oe:71.58203125*dt,actualBoundingBoxDescent:(se=rt.actualBoundingBoxDescent)!==null&&se!==void 0?se:0,actualBoundingBoxLeft:(he=rt.actualBoundingBoxLeft)!==null&&he!==void 0?he:-7.421875*dt,actualBoundingBoxRight:(ae=rt.actualBoundingBoxRight)!==null&&ae!==void 0?ae:75.732421875*dt,alphabeticBaseline:(pe=rt.alphabeticBaseline)!==null&&pe!==void 0?pe:0,emHeightAscent:(ye=rt.emHeightAscent)!==null&&ye!==void 0?ye:100*dt,emHeightDescent:(ve=rt.emHeightDescent)!==null&&ve!==void 0?ve:-20*dt,fontBoundingBoxAscent:(ue=rt.fontBoundingBoxAscent)!==null&&ue!==void 0?ue:91*dt,fontBoundingBoxDescent:(xe=rt.fontBoundingBoxDescent)!==null&&xe!==void 0?xe:21*dt,hangingBaseline:(Se=rt.hangingBaseline)!==null&&Se!==void 0?Se:72.80000305175781*dt,ideographicBaseline:(Ae=rt.ideographicBaseline)!==null&&Ae!==void 0?Ae:-21*dt,width:rt.width,height:st}}_getContextFont(){return this.fontStyle()+D+this.fontVariant()+D+(this.fontSize()+R)+U(this.fontFamily())}_addTextLine(fe){this.align()===c&&(fe=fe.trim());const se=this._getTextWidth(fe);return this.textArr.push({text:fe,width:se,lastInParagraph:!1})}_getTextWidth(fe){const oe=this.letterSpacing(),se=fe.length;return $().measureText(fe).width+(se?oe*(se-1):0)}_setTextData(){let fe=this.text().split(`
`),oe=+this.fontSize(),se=0,he=this.lineHeight()*oe,ae=this.attrs.width,pe=this.attrs.height,ye=ae!==o&&ae!==void 0,ve=pe!==o&&pe!==void 0,ue=this.padding(),xe=ae-ue*2,Se=pe-ue*2,Ae=0,Me=this.wrap(),st=Me!==G,rt=Me!==z&&st,dt=this.ellipsis();this.textArr=[],$().font=this._getContextFont();const Ct=dt?this._getTextWidth(Z):0;for(let ut=0,ct=fe.length;ut<ct;++ut){let xt=fe[ut],ot=this._getTextWidth(xt);if(ye&&ot>xe)for(;xt.length>0;){let Lt=0,Bt=xt.length,Ne="",qe=0;for(;Lt<Bt;){const St=Lt+Bt>>>1,it=xt.slice(0,St+1),lt=this._getTextWidth(it)+Ct;lt<=xe?(Lt=St+1,Ne=it,qe=lt):Bt=St}if(Ne){if(rt){var Ke;const it=xt[Ne.length];(it===D||it===g)&&qe<=xe?Ke=Ne.length:Ke=Math.max(Ne.lastIndexOf(D),Ne.lastIndexOf(g))+1,Ke>0&&(Lt=Ke,Ne=Ne.slice(0,Lt),qe=this._getTextWidth(Ne))}if(Ne=Ne.trimRight(),this._addTextLine(Ne),se=Math.max(se,qe),Ae+=he,this._shouldHandleEllipsis(Ae)){this._tryToAddEllipsisToLastLine();break}if(xt=xt.slice(Lt),xt=xt.trimLeft(),xt.length>0&&(ot=this._getTextWidth(xt),ot<=xe)){this._addTextLine(xt),Ae+=he,se=Math.max(se,ot);break}}else break}else this._addTextLine(xt),Ae+=he,se=Math.max(se,ot),this._shouldHandleEllipsis(Ae)&&ut<ct-1&&this._tryToAddEllipsisToLastLine();if(this.textArr[this.textArr.length-1]&&(this.textArr[this.textArr.length-1].lastInParagraph=!0),ve&&Ae+he>Se)break}this.textHeight=oe,this.textWidth=se}_shouldHandleEllipsis(fe){const oe=+this.fontSize(),se=this.lineHeight()*oe,he=this.attrs.height,ae=he!==o&&he!==void 0,pe=this.padding(),ye=he-pe*2;return!(this.wrap()!==G)||ae&&fe+se>ye}_tryToAddEllipsisToLastLine(){const fe=this.attrs.width,oe=fe!==o&&fe!==void 0,se=this.padding(),he=fe-se*2,ae=this.ellipsis(),pe=this.textArr[this.textArr.length-1];!pe||!ae||(oe&&(this._getTextWidth(pe.text+Z)<he||(pe.text=pe.text.slice(0,pe.text.length-3))),this.textArr.splice(this.textArr.length-1,1),this._addTextLine(pe.text+Z))}getStrokeScaleEnabled(){return!0}_useBufferCanvas(){const fe=this.textDecoration().indexOf("underline")!==-1||this.textDecoration().indexOf("line-through")!==-1,oe=this.hasShadow();return fe&&oe?!0:super._useBufferCanvas()}}return bp.Text=X,X.prototype._fillFunc=Q,X.prototype._strokeFunc=ie,X.prototype.className=w,X.prototype._attrsAffectingSize=["text","fontSize","padding","wrap","lineHeight","letterSpacing"],(0,a._registerNode)(X),e.Factory.overWriteSetter(X,"width",(0,i.getNumberOrAutoValidator)()),e.Factory.overWriteSetter(X,"height",(0,i.getNumberOrAutoValidator)()),e.Factory.addGetterSetter(X,"direction",u),e.Factory.addGetterSetter(X,"fontFamily","Arial"),e.Factory.addGetterSetter(X,"fontSize",12,(0,i.getNumberValidator)()),e.Factory.addGetterSetter(X,"fontStyle",N),e.Factory.addGetterSetter(X,"fontVariant",N),e.Factory.addGetterSetter(X,"padding",0,(0,i.getNumberValidator)()),e.Factory.addGetterSetter(X,"align",y),e.Factory.addGetterSetter(X,"verticalAlign",C),e.Factory.addGetterSetter(X,"lineHeight",1,(0,i.getNumberValidator)()),e.Factory.addGetterSetter(X,"wrap",F),e.Factory.addGetterSetter(X,"ellipsis",!1,(0,i.getBooleanValidator)()),e.Factory.addGetterSetter(X,"letterSpacing",0,(0,i.getNumberValidator)()),e.Factory.addGetterSetter(X,"text","",(0,i.getStringValidator)()),e.Factory.addGetterSetter(X,"textDecoration",""),bp}var yg={},q5;function VG(){if(q5)return yg;q5=1,Object.defineProperty(yg,"__esModule",{value:!0}),yg.TextPath=void 0;const t=pi(),e=Lr(),r=xa(),n=M_(),i=RL(),a=Dr(),s=Nr(),o="",l="normal";function u(p){p.fillText(this.partialText,0,0)}function c(p){p.strokeText(this.partialText,0,0)}let f=class extends r.Shape{constructor(g){super(g),this.dummyCanvas=t.Util.createCanvasElement(),this.dataArray=[],this._readDataAttribute(),this.on("dataChange.konva",function(){this._readDataAttribute(),this._setTextData()}),this.on("textChange.konva alignChange.konva letterSpacingChange.konva kerningFuncChange.konva fontSizeChange.konva fontFamilyChange.konva",this._setTextData),this._setTextData()}_getTextPathLength(){return n.Path.getPathLength(this.dataArray)}_getPointAtLength(g){if(!this.attrs.data)return null;const y=this.pathLength;return g-1>y?null:n.Path.getPointAtLengthOfDataArray(g,this.dataArray)}_readDataAttribute(){this.dataArray=n.Path.parsePathData(this.attrs.data),this.pathLength=this._getTextPathLength()}_sceneFunc(g){g.setAttr("font",this._getContextFont()),g.setAttr("textBaseline",this.textBaseline()),g.setAttr("textAlign","left"),g.save();const y=this.textDecoration(),S=this.fill(),w=this.fontSize(),C=this.glyphInfo;y==="underline"&&g.beginPath();for(let _=0;_<C.length;_++){g.save();const T=C[_].p0;g.translate(T.x,T.y),g.rotate(C[_].rotation),this.partialText=C[_].text,g.fillStrokeShape(this),y==="underline"&&(_===0&&g.moveTo(0,w/2+1),g.lineTo(w,w/2+1)),g.restore()}y==="underline"&&(g.strokeStyle=S,g.lineWidth=w/20,g.stroke()),g.restore()}_hitFunc(g){g.beginPath();const y=this.glyphInfo;if(y.length>=1){const S=y[0].p0;g.moveTo(S.x,S.y)}for(let S=0;S<y.length;S++){const w=y[S].p1;g.lineTo(w.x,w.y)}g.setAttr("lineWidth",this.fontSize()),g.setAttr("strokeStyle",this.colorKey),g.stroke()}getTextWidth(){return this.textWidth}getTextHeight(){return t.Util.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height."),this.textHeight}setText(g){return i.Text.prototype.setText.call(this,g)}_getContextFont(){return i.Text.prototype._getContextFont.call(this)}_getTextSize(g){const S=this.dummyCanvas.getContext("2d");S.save(),S.font=this._getContextFont();const w=S.measureText(g);return S.restore(),{width:w.width,height:parseInt(`${this.fontSize()}`,10)}}_setTextData(){const{width:g,height:y}=this._getTextSize(this.attrs.text);if(this.textWidth=g,this.textHeight=y,this.glyphInfo=[],!this.attrs.data)return null;const S=this.letterSpacing(),w=this.align(),C=this.kerningFunc(),_=Math.max(this.textWidth+((this.attrs.text||"").length-1)*S,0);let T=0;w==="center"&&(T=Math.max(0,this.pathLength/2-_/2)),w==="right"&&(T=Math.max(0,this.pathLength-_));const N=(0,i.stringToArray)(this.text());let R=T;for(let D=0;D<N.length;D++){const j=this._getPointAtLength(R);if(!j)return;let O=this._getTextSize(N[D]).width+S;if(N[D]===" "&&w==="justify"){const W=this.text().split(" ").length-1;O+=(this.pathLength-_)/W}const F=this._getPointAtLength(R+O);if(!F)return;const z=n.Path.getLineLength(j.x,j.y,F.x,F.y);let G=0;if(C)try{G=C(N[D-1],N[D])*this.fontSize()}catch{G=0}j.x+=G,F.x+=G,this.textWidth+=G;const Z=n.Path.getPointOnLine(G+z/2,j.x,j.y,F.x,F.y),I=Math.atan2(F.y-j.y,F.x-j.x);this.glyphInfo.push({transposeX:Z.x,transposeY:Z.y,text:N[D],rotation:I,p0:j,p1:F}),R+=O}}getSelfRect(){if(!this.glyphInfo.length)return{x:0,y:0,width:0,height:0};const g=[];this.glyphInfo.forEach(function(R){g.push(R.p0.x),g.push(R.p0.y),g.push(R.p1.x),g.push(R.p1.y)});let y=g[0]||0,S=g[0]||0,w=g[1]||0,C=g[1]||0,_,T;for(let R=0;R<g.length/2;R++)_=g[R*2],T=g[R*2+1],y=Math.min(y,_),S=Math.max(S,_),w=Math.min(w,T),C=Math.max(C,T);const N=this.fontSize();return{x:y-N/2,y:w-N/2,width:S-y+N,height:C-w+N}}destroy(){return t.Util.releaseCanvas(this.dummyCanvas),super.destroy()}};return yg.TextPath=f,f.prototype._fillFunc=u,f.prototype._strokeFunc=c,f.prototype._fillFuncHit=u,f.prototype._strokeFuncHit=c,f.prototype.className="TextPath",f.prototype._attrsAffectingSize=["text","fontSize","data"],(0,s._registerNode)(f),e.Factory.addGetterSetter(f,"data"),e.Factory.addGetterSetter(f,"fontFamily","Arial"),e.Factory.addGetterSetter(f,"fontSize",12,(0,a.getNumberValidator)()),e.Factory.addGetterSetter(f,"fontStyle",l),e.Factory.addGetterSetter(f,"align","left"),e.Factory.addGetterSetter(f,"letterSpacing",0,(0,a.getNumberValidator)()),e.Factory.addGetterSetter(f,"textBaseline","middle"),e.Factory.addGetterSetter(f,"fontVariant",l),e.Factory.addGetterSetter(f,"text",o),e.Factory.addGetterSetter(f,"textDecoration",null),e.Factory.addGetterSetter(f,"kerningFunc",null),yg}var xg={},$5;function HG(){if($5)return xg;$5=1,Object.defineProperty(xg,"__esModule",{value:!0}),xg.Transformer=void 0;const t=pi(),e=Lr(),r=Ei(),n=xa(),i=LL(),a=N_(),s=Nr(),o=Dr(),l=Nr(),u="tr-konva",c=["resizeEnabledChange","rotateAnchorOffsetChange","rotateEnabledChange","enabledAnchorsChange","anchorSizeChange","borderEnabledChange","borderStrokeChange","borderStrokeWidthChange","borderDashChange","anchorStrokeChange","anchorStrokeWidthChange","anchorFillChange","anchorCornerRadiusChange","ignoreStrokeChange","anchorStyleFuncChange"].map(O=>O+`.${u}`).join(" "),f="nodesRect",p=["widthChange","heightChange","scaleXChange","scaleYChange","skewXChange","skewYChange","rotationChange","offsetXChange","offsetYChange","transformsEnabledChange","strokeWidthChange"],g={"top-left":-45,"top-center":0,"top-right":45,"middle-right":-90,"middle-left":90,"bottom-left":-135,"bottom-center":180,"bottom-right":135},y="ontouchstart"in s.Konva._global;function S(O,F,z){if(O==="rotater")return z;F+=t.Util.degToRad(g[O]||0);const G=(t.Util.radToDeg(F)%360+360)%360;return t.Util._inRange(G,315+22.5,360)||t.Util._inRange(G,0,22.5)?"ns-resize":t.Util._inRange(G,45-22.5,45+22.5)?"nesw-resize":t.Util._inRange(G,90-22.5,90+22.5)?"ew-resize":t.Util._inRange(G,135-22.5,135+22.5)?"nwse-resize":t.Util._inRange(G,180-22.5,180+22.5)?"ns-resize":t.Util._inRange(G,225-22.5,225+22.5)?"nesw-resize":t.Util._inRange(G,270-22.5,270+22.5)?"ew-resize":t.Util._inRange(G,315-22.5,315+22.5)?"nwse-resize":(t.Util.error("Transformer has unknown angle for cursor detection: "+G),"pointer")}const w=["top-left","top-center","top-right","middle-right","middle-left","bottom-left","bottom-center","bottom-right"];function C(O){return{x:O.x+O.width/2*Math.cos(O.rotation)+O.height/2*Math.sin(-O.rotation),y:O.y+O.height/2*Math.cos(O.rotation)+O.width/2*Math.sin(O.rotation)}}function _(O,F,z){const G=z.x+(O.x-z.x)*Math.cos(F)-(O.y-z.y)*Math.sin(F),Z=z.y+(O.x-z.x)*Math.sin(F)+(O.y-z.y)*Math.cos(F);return{...O,rotation:O.rotation+F,x:G,y:Z}}function T(O,F){const z=C(O);return _(O,F,z)}function N(O,F,z){let G=F;for(let Z=0;Z<O.length;Z++){const I=s.Konva.getAngle(O[Z]),W=Math.abs(I-F)%(Math.PI*2);Math.min(W,Math.PI*2-W)<z&&(G=I)}return G}let R=0;class D extends a.Group{constructor(F){super(F),this._movingAnchorName=null,this._transforming=!1,this._createElements(),this._handleMouseMove=this._handleMouseMove.bind(this),this._handleMouseUp=this._handleMouseUp.bind(this),this.update=this.update.bind(this),this.on(c,this.update),this.getNode()&&this.update()}attachTo(F){return this.setNode(F),this}setNode(F){return t.Util.warn("tr.setNode(shape), tr.node(shape) and tr.attachTo(shape) methods are deprecated. Please use tr.nodes(nodesArray) instead."),this.setNodes([F])}getNode(){return this._nodes&&this._nodes[0]}_getEventNamespace(){return u+this._id}setNodes(F=[]){this._nodes&&this._nodes.length&&this.detach();const z=F.filter(Z=>Z.isAncestorOf(this)?(t.Util.error("Konva.Transformer cannot be an a child of the node you are trying to attach"),!1):!0);return this._nodes=F=z,F.length===1&&this.useSingleNodeRotation()?this.rotation(F[0].getAbsoluteRotation()):this.rotation(0),this._nodes.forEach(Z=>{const I=()=>{this.nodes().length===1&&this.useSingleNodeRotation()&&this.rotation(this.nodes()[0].getAbsoluteRotation()),this._resetTransformCache(),!this._transforming&&!this.isDragging()&&this.update()},W=Z._attrsAffectingSize.map(U=>U+"Change."+this._getEventNamespace()).join(" ");Z.on(W,I),Z.on(p.map(U=>U+`.${this._getEventNamespace()}`).join(" "),I),Z.on(`absoluteTransformChange.${this._getEventNamespace()}`,I),this._proxyDrag(Z)}),this._resetTransformCache(),this.findOne(".top-left")&&this.update(),this}_proxyDrag(F){let z;F.on(`dragstart.${this._getEventNamespace()}`,G=>{z=F.getAbsolutePosition(),!this.isDragging()&&F!==this.findOne(".back")&&this.startDrag(G,!1)}),F.on(`dragmove.${this._getEventNamespace()}`,G=>{if(!z)return;const Z=F.getAbsolutePosition(),I=Z.x-z.x,W=Z.y-z.y;this.nodes().forEach(U=>{if(U===F||U.isDragging())return;const K=U.getAbsolutePosition();U.setAbsolutePosition({x:K.x+I,y:K.y+W}),U.startDrag(G)}),z=null})}getNodes(){return this._nodes||[]}getActiveAnchor(){return this._movingAnchorName}detach(){this._nodes&&this._nodes.forEach(F=>{F.off("."+this._getEventNamespace())}),this._nodes=[],this._resetTransformCache()}_resetTransformCache(){this._clearCache(f),this._clearCache("transform"),this._clearSelfAndDescendantCache("absoluteTransform")}_getNodeRect(){return this._getCache(f,this.__getNodeRect)}__getNodeShape(F,z=this.rotation(),G){const Z=F.getClientRect({skipTransform:!0,skipShadow:!0,skipStroke:this.ignoreStroke()}),I=F.getAbsoluteScale(G),W=F.getAbsolutePosition(G),U=Z.x*I.x-F.offsetX()*I.x,K=Z.y*I.y-F.offsetY()*I.y,$=(s.Konva.getAngle(F.getAbsoluteRotation())+Math.PI*2)%(Math.PI*2),Q={x:W.x+U*Math.cos($)+K*Math.sin(-$),y:W.y+K*Math.cos($)+U*Math.sin($),width:Z.width*I.x,height:Z.height*I.y,rotation:$};return _(Q,-s.Konva.getAngle(z),{x:0,y:0})}__getNodeRect(){if(!this.getNode())return{x:-1e8,y:-1e8,width:0,height:0,rotation:0};const z=[];this.nodes().map($=>{const Q=$.getClientRect({skipTransform:!0,skipShadow:!0,skipStroke:this.ignoreStroke()}),ie=[{x:Q.x,y:Q.y},{x:Q.x+Q.width,y:Q.y},{x:Q.x+Q.width,y:Q.y+Q.height},{x:Q.x,y:Q.y+Q.height}],te=$.getAbsoluteTransform();ie.forEach(function(X){const re=te.point(X);z.push(re)})});const G=new t.Transform;G.rotate(-s.Konva.getAngle(this.rotation()));let Z=1/0,I=1/0,W=-1/0,U=-1/0;z.forEach(function($){const Q=G.point($);Z===void 0&&(Z=W=Q.x,I=U=Q.y),Z=Math.min(Z,Q.x),I=Math.min(I,Q.y),W=Math.max(W,Q.x),U=Math.max(U,Q.y)}),G.invert();const K=G.point({x:Z,y:I});return{x:K.x,y:K.y,width:W-Z,height:U-I,rotation:s.Konva.getAngle(this.rotation())}}getX(){return this._getNodeRect().x}getY(){return this._getNodeRect().y}getWidth(){return this._getNodeRect().width}getHeight(){return this._getNodeRect().height}_createElements(){this._createBack(),w.forEach(F=>{this._createAnchor(F)}),this._createAnchor("rotater")}_createAnchor(F){const z=new i.Rect({stroke:"rgb(0, 161, 255)",fill:"white",strokeWidth:1,name:F+" _anchor",dragDistance:0,draggable:!0,hitStrokeWidth:y?10:"auto"}),G=this;z.on("mousedown touchstart",function(Z){G._handleMouseDown(Z)}),z.on("dragstart",Z=>{z.stopDrag(),Z.cancelBubble=!0}),z.on("dragend",Z=>{Z.cancelBubble=!0}),z.on("mouseenter",()=>{const Z=s.Konva.getAngle(this.rotation()),I=this.rotateAnchorCursor(),W=S(F,Z,I);z.getStage().content&&(z.getStage().content.style.cursor=W),this._cursorChange=!0}),z.on("mouseout",()=>{z.getStage().content&&(z.getStage().content.style.cursor=""),this._cursorChange=!1}),this.add(z)}_createBack(){const F=new n.Shape({name:"back",width:0,height:0,draggable:!0,sceneFunc(z,G){const Z=G.getParent(),I=Z.padding();z.beginPath(),z.rect(-I,-I,G.width()+I*2,G.height()+I*2),z.moveTo(G.width()/2,-I),Z.rotateEnabled()&&Z.rotateLineVisible()&&z.lineTo(G.width()/2,-Z.rotateAnchorOffset()*t.Util._sign(G.height())-I),z.fillStrokeShape(G)},hitFunc:(z,G)=>{if(!this.shouldOverdrawWholeArea())return;const Z=this.padding();z.beginPath(),z.rect(-Z,-Z,G.width()+Z*2,G.height()+Z*2),z.fillStrokeShape(G)}});this.add(F),this._proxyDrag(F),F.on("dragstart",z=>{z.cancelBubble=!0}),F.on("dragmove",z=>{z.cancelBubble=!0}),F.on("dragend",z=>{z.cancelBubble=!0}),this.on("dragmove",z=>{this.update()})}_handleMouseDown(F){if(this._transforming)return;this._movingAnchorName=F.target.name().split(" ")[0];const z=this._getNodeRect(),G=z.width,Z=z.height,I=Math.sqrt(Math.pow(G,2)+Math.pow(Z,2));this.sin=Math.abs(Z/I),this.cos=Math.abs(G/I),typeof window<"u"&&(window.addEventListener("mousemove",this._handleMouseMove),window.addEventListener("touchmove",this._handleMouseMove),window.addEventListener("mouseup",this._handleMouseUp,!0),window.addEventListener("touchend",this._handleMouseUp,!0)),this._transforming=!0;const W=F.target.getAbsolutePosition(),U=F.target.getStage().getPointerPosition();this._anchorDragOffset={x:U.x-W.x,y:U.y-W.y},R++,this._fire("transformstart",{evt:F.evt,target:this.getNode()}),this._nodes.forEach(K=>{K._fire("transformstart",{evt:F.evt,target:K})})}_handleMouseMove(F){let z,G,Z;const I=this.findOne("."+this._movingAnchorName),W=I.getStage();W.setPointersPositions(F);const U=W.getPointerPosition();let K={x:U.x-this._anchorDragOffset.x,y:U.y-this._anchorDragOffset.y};const $=I.getAbsolutePosition();this.anchorDragBoundFunc()&&(K=this.anchorDragBoundFunc()($,K,F)),I.setAbsolutePosition(K);const Q=I.getAbsolutePosition();if($.x===Q.x&&$.y===Q.y)return;if(this._movingAnchorName==="rotater"){const ye=this._getNodeRect();z=I.x()-ye.width/2,G=-I.y()+ye.height/2;let ve=Math.atan2(-G,z)+Math.PI/2;ye.height<0&&(ve-=Math.PI);const xe=s.Konva.getAngle(this.rotation())+ve,Se=s.Konva.getAngle(this.rotationSnapTolerance()),Me=N(this.rotationSnaps(),xe,Se)-ye.rotation,st=T(ye,Me);this._fitNodesInto(st,F);return}const ie=this.shiftBehavior();let te;ie==="inverted"?te=this.keepRatio()&&!F.shiftKey:ie==="none"?te=this.keepRatio():te=this.keepRatio()||F.shiftKey;var se=this.centeredScaling()||F.altKey;if(this._movingAnchorName==="top-left"){if(te){var X=se?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".bottom-right").x(),y:this.findOne(".bottom-right").y()};Z=Math.sqrt(Math.pow(X.x-I.x(),2)+Math.pow(X.y-I.y(),2));var re=this.findOne(".top-left").x()>X.x?-1:1,fe=this.findOne(".top-left").y()>X.y?-1:1;z=Z*this.cos*re,G=Z*this.sin*fe,this.findOne(".top-left").x(X.x-z),this.findOne(".top-left").y(X.y-G)}}else if(this._movingAnchorName==="top-center")this.findOne(".top-left").y(I.y());else if(this._movingAnchorName==="top-right"){if(te){var X=se?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".bottom-left").x(),y:this.findOne(".bottom-left").y()};Z=Math.sqrt(Math.pow(I.x()-X.x,2)+Math.pow(X.y-I.y(),2));var re=this.findOne(".top-right").x()<X.x?-1:1,fe=this.findOne(".top-right").y()>X.y?-1:1;z=Z*this.cos*re,G=Z*this.sin*fe,this.findOne(".top-right").x(X.x+z),this.findOne(".top-right").y(X.y-G)}var oe=I.position();this.findOne(".top-left").y(oe.y),this.findOne(".bottom-right").x(oe.x)}else if(this._movingAnchorName==="middle-left")this.findOne(".top-left").x(I.x());else if(this._movingAnchorName==="middle-right")this.findOne(".bottom-right").x(I.x());else if(this._movingAnchorName==="bottom-left"){if(te){var X=se?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".top-right").x(),y:this.findOne(".top-right").y()};Z=Math.sqrt(Math.pow(X.x-I.x(),2)+Math.pow(I.y()-X.y,2));var re=X.x<I.x()?-1:1,fe=I.y()<X.y?-1:1;z=Z*this.cos*re,G=Z*this.sin*fe,I.x(X.x-z),I.y(X.y+G)}oe=I.position(),this.findOne(".top-left").x(oe.x),this.findOne(".bottom-right").y(oe.y)}else if(this._movingAnchorName==="bottom-center")this.findOne(".bottom-right").y(I.y());else if(this._movingAnchorName==="bottom-right"){if(te){var X=se?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".top-left").x(),y:this.findOne(".top-left").y()};Z=Math.sqrt(Math.pow(I.x()-X.x,2)+Math.pow(I.y()-X.y,2));var re=this.findOne(".bottom-right").x()<X.x?-1:1,fe=this.findOne(".bottom-right").y()<X.y?-1:1;z=Z*this.cos*re,G=Z*this.sin*fe,this.findOne(".bottom-right").x(X.x+z),this.findOne(".bottom-right").y(X.y+G)}}else console.error(new Error("Wrong position argument of selection resizer: "+this._movingAnchorName));var se=this.centeredScaling()||F.altKey;if(se){const ye=this.findOne(".top-left"),ve=this.findOne(".bottom-right"),ue=ye.x(),xe=ye.y(),Se=this.getWidth()-ve.x(),Ae=this.getHeight()-ve.y();ve.move({x:-ue,y:-xe}),ye.move({x:Se,y:Ae})}const he=this.findOne(".top-left").getAbsolutePosition();z=he.x,G=he.y;const ae=this.findOne(".bottom-right").x()-this.findOne(".top-left").x(),pe=this.findOne(".bottom-right").y()-this.findOne(".top-left").y();this._fitNodesInto({x:z,y:G,width:ae,height:pe,rotation:s.Konva.getAngle(this.rotation())},F)}_handleMouseUp(F){this._removeEvents(F)}getAbsoluteTransform(){return this.getTransform()}_removeEvents(F){var z;if(this._transforming){this._transforming=!1,typeof window<"u"&&(window.removeEventListener("mousemove",this._handleMouseMove),window.removeEventListener("touchmove",this._handleMouseMove),window.removeEventListener("mouseup",this._handleMouseUp,!0),window.removeEventListener("touchend",this._handleMouseUp,!0));const G=this.getNode();R--,this._fire("transformend",{evt:F,target:G}),(z=this.getLayer())===null||z===void 0||z.batchDraw(),G&&this._nodes.forEach(Z=>{var I;Z._fire("transformend",{evt:F,target:Z}),(I=Z.getLayer())===null||I===void 0||I.batchDraw()}),this._movingAnchorName=null}}_fitNodesInto(F,z){const G=this._getNodeRect(),Z=1;if(t.Util._inRange(F.width,-this.padding()*2-Z,Z)){this.update();return}if(t.Util._inRange(F.height,-this.padding()*2-Z,Z)){this.update();return}const I=new t.Transform;if(I.rotate(s.Konva.getAngle(this.rotation())),this._movingAnchorName&&F.width<0&&this._movingAnchorName.indexOf("left")>=0){const te=I.point({x:-this.padding()*2,y:0});F.x+=te.x,F.y+=te.y,F.width+=this.padding()*2,this._movingAnchorName=this._movingAnchorName.replace("left","right"),this._anchorDragOffset.x-=te.x,this._anchorDragOffset.y-=te.y}else if(this._movingAnchorName&&F.width<0&&this._movingAnchorName.indexOf("right")>=0){const te=I.point({x:this.padding()*2,y:0});this._movingAnchorName=this._movingAnchorName.replace("right","left"),this._anchorDragOffset.x-=te.x,this._anchorDragOffset.y-=te.y,F.width+=this.padding()*2}if(this._movingAnchorName&&F.height<0&&this._movingAnchorName.indexOf("top")>=0){const te=I.point({x:0,y:-this.padding()*2});F.x+=te.x,F.y+=te.y,this._movingAnchorName=this._movingAnchorName.replace("top","bottom"),this._anchorDragOffset.x-=te.x,this._anchorDragOffset.y-=te.y,F.height+=this.padding()*2}else if(this._movingAnchorName&&F.height<0&&this._movingAnchorName.indexOf("bottom")>=0){const te=I.point({x:0,y:this.padding()*2});this._movingAnchorName=this._movingAnchorName.replace("bottom","top"),this._anchorDragOffset.x-=te.x,this._anchorDragOffset.y-=te.y,F.height+=this.padding()*2}if(this.boundBoxFunc()){const te=this.boundBoxFunc()(G,F);te?F=te:t.Util.warn("boundBoxFunc returned falsy. You should return new bound rect from it!")}const W=1e7,U=new t.Transform;U.translate(G.x,G.y),U.rotate(G.rotation),U.scale(G.width/W,G.height/W);const K=new t.Transform,$=F.width/W,Q=F.height/W;this.flipEnabled()===!1?(K.translate(F.x,F.y),K.rotate(F.rotation),K.translate(F.width<0?F.width:0,F.height<0?F.height:0),K.scale(Math.abs($),Math.abs(Q))):(K.translate(F.x,F.y),K.rotate(F.rotation),K.scale($,Q));const ie=K.multiply(U.invert());this._nodes.forEach(te=>{var X;const re=te.getParent().getAbsoluteTransform(),fe=te.getTransform().copy();fe.translate(te.offsetX(),te.offsetY());const oe=new t.Transform;oe.multiply(re.copy().invert()).multiply(ie).multiply(re).multiply(fe);const se=oe.decompose();te.setAttrs(se),(X=te.getLayer())===null||X===void 0||X.batchDraw()}),this.rotation(t.Util._getRotation(F.rotation)),this._nodes.forEach(te=>{this._fire("transform",{evt:z,target:te}),te._fire("transform",{evt:z,target:te})}),this._resetTransformCache(),this.update(),this.getLayer().batchDraw()}forceUpdate(){this._resetTransformCache(),this.update()}_batchChangeChild(F,z){this.findOne(F).setAttrs(z)}update(){var F;const z=this._getNodeRect();this.rotation(t.Util._getRotation(z.rotation));const G=z.width,Z=z.height,I=this.enabledAnchors(),W=this.resizeEnabled(),U=this.padding(),K=this.anchorSize(),$=this.find("._anchor");$.forEach(ie=>{ie.setAttrs({width:K,height:K,offsetX:K/2,offsetY:K/2,stroke:this.anchorStroke(),strokeWidth:this.anchorStrokeWidth(),fill:this.anchorFill(),cornerRadius:this.anchorCornerRadius()})}),this._batchChangeChild(".top-left",{x:0,y:0,offsetX:K/2+U,offsetY:K/2+U,visible:W&&I.indexOf("top-left")>=0}),this._batchChangeChild(".top-center",{x:G/2,y:0,offsetY:K/2+U,visible:W&&I.indexOf("top-center")>=0}),this._batchChangeChild(".top-right",{x:G,y:0,offsetX:K/2-U,offsetY:K/2+U,visible:W&&I.indexOf("top-right")>=0}),this._batchChangeChild(".middle-left",{x:0,y:Z/2,offsetX:K/2+U,visible:W&&I.indexOf("middle-left")>=0}),this._batchChangeChild(".middle-right",{x:G,y:Z/2,offsetX:K/2-U,visible:W&&I.indexOf("middle-right")>=0}),this._batchChangeChild(".bottom-left",{x:0,y:Z,offsetX:K/2+U,offsetY:K/2-U,visible:W&&I.indexOf("bottom-left")>=0}),this._batchChangeChild(".bottom-center",{x:G/2,y:Z,offsetY:K/2-U,visible:W&&I.indexOf("bottom-center")>=0}),this._batchChangeChild(".bottom-right",{x:G,y:Z,offsetX:K/2-U,offsetY:K/2-U,visible:W&&I.indexOf("bottom-right")>=0}),this._batchChangeChild(".rotater",{x:G/2,y:-this.rotateAnchorOffset()*t.Util._sign(Z)-U,visible:this.rotateEnabled()}),this._batchChangeChild(".back",{width:G,height:Z,visible:this.borderEnabled(),stroke:this.borderStroke(),strokeWidth:this.borderStrokeWidth(),dash:this.borderDash(),x:0,y:0});const Q=this.anchorStyleFunc();Q&&$.forEach(ie=>{Q(ie)}),(F=this.getLayer())===null||F===void 0||F.batchDraw()}isTransforming(){return this._transforming}stopTransform(){if(this._transforming){this._removeEvents();const F=this.findOne("."+this._movingAnchorName);F&&F.stopDrag()}}destroy(){return this.getStage()&&this._cursorChange&&this.getStage().content&&(this.getStage().content.style.cursor=""),a.Group.prototype.destroy.call(this),this.detach(),this._removeEvents(),this}toObject(){return r.Node.prototype.toObject.call(this)}clone(F){return r.Node.prototype.clone.call(this,F)}getClientRect(){return this.nodes().length>0?super.getClientRect():{x:0,y:0,width:0,height:0}}}xg.Transformer=D,D.isTransforming=()=>R>0;function j(O){return O instanceof Array||t.Util.warn("enabledAnchors value should be an array"),O instanceof Array&&O.forEach(function(F){w.indexOf(F)===-1&&t.Util.warn("Unknown anchor name: "+F+". Available names are: "+w.join(", "))}),O||[]}return D.prototype.className="Transformer",(0,l._registerNode)(D),e.Factory.addGetterSetter(D,"enabledAnchors",w,j),e.Factory.addGetterSetter(D,"flipEnabled",!0,(0,o.getBooleanValidator)()),e.Factory.addGetterSetter(D,"resizeEnabled",!0),e.Factory.addGetterSetter(D,"anchorSize",10,(0,o.getNumberValidator)()),e.Factory.addGetterSetter(D,"rotateEnabled",!0),e.Factory.addGetterSetter(D,"rotateLineVisible",!0),e.Factory.addGetterSetter(D,"rotationSnaps",[]),e.Factory.addGetterSetter(D,"rotateAnchorOffset",50,(0,o.getNumberValidator)()),e.Factory.addGetterSetter(D,"rotateAnchorCursor","crosshair"),e.Factory.addGetterSetter(D,"rotationSnapTolerance",5,(0,o.getNumberValidator)()),e.Factory.addGetterSetter(D,"borderEnabled",!0),e.Factory.addGetterSetter(D,"anchorStroke","rgb(0, 161, 255)"),e.Factory.addGetterSetter(D,"anchorStrokeWidth",1,(0,o.getNumberValidator)()),e.Factory.addGetterSetter(D,"anchorFill","white"),e.Factory.addGetterSetter(D,"anchorCornerRadius",0,(0,o.getNumberValidator)()),e.Factory.addGetterSetter(D,"borderStroke","rgb(0, 161, 255)"),e.Factory.addGetterSetter(D,"borderStrokeWidth",1,(0,o.getNumberValidator)()),e.Factory.addGetterSetter(D,"borderDash"),e.Factory.addGetterSetter(D,"keepRatio",!0),e.Factory.addGetterSetter(D,"shiftBehavior","default"),e.Factory.addGetterSetter(D,"centeredScaling",!1),e.Factory.addGetterSetter(D,"ignoreStroke",!1),e.Factory.addGetterSetter(D,"padding",0,(0,o.getNumberValidator)()),e.Factory.addGetterSetter(D,"node"),e.Factory.addGetterSetter(D,"nodes"),e.Factory.addGetterSetter(D,"boundBoxFunc"),e.Factory.addGetterSetter(D,"anchorDragBoundFunc"),e.Factory.addGetterSetter(D,"anchorStyleFunc"),e.Factory.addGetterSetter(D,"shouldOverdrawWholeArea",!1),e.Factory.addGetterSetter(D,"useSingleNodeRotation",!0),e.Factory.backCompat(D,{lineEnabled:"borderEnabled",rotateHandlerOffset:"rotateAnchorOffset",enabledHandlers:"enabledAnchors"}),xg}var bg={},K5;function WG(){if(K5)return bg;K5=1,Object.defineProperty(bg,"__esModule",{value:!0}),bg.Wedge=void 0;const t=Lr(),e=xa(),r=Nr(),n=Dr(),i=Nr();let a=class extends e.Shape{_sceneFunc(o){o.beginPath(),o.arc(0,0,this.radius(),0,r.Konva.getAngle(this.angle()),this.clockwise()),o.lineTo(0,0),o.closePath(),o.fillStrokeShape(this)}getWidth(){return this.radius()*2}getHeight(){return this.radius()*2}setWidth(o){this.radius(o/2)}setHeight(o){this.radius(o/2)}};return bg.Wedge=a,a.prototype.className="Wedge",a.prototype._centroid=!0,a.prototype._attrsAffectingSize=["radius"],(0,i._registerNode)(a),t.Factory.addGetterSetter(a,"radius",0,(0,n.getNumberValidator)()),t.Factory.addGetterSetter(a,"angle",0,(0,n.getNumberValidator)()),t.Factory.addGetterSetter(a,"clockwise",!1),t.Factory.backCompat(a,{angleDeg:"angle",getAngleDeg:"getAngle",setAngleDeg:"setAngle"}),bg}var wg={},Z5;function qG(){if(Z5)return wg;Z5=1,Object.defineProperty(wg,"__esModule",{value:!0}),wg.Blur=void 0;const t=Lr(),e=Ei(),r=Dr();function n(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}const i=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],a=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function s(l,u){const c=l.data,f=l.width,p=l.height;let g,y,S,w,C,_,T,N,R,D,j,O,F,z,G,Z,I,W,U,K,$,Q,ie,te,X=u+u+1,re=f-1,fe=p-1,oe=u+1,se=oe*(oe+1)/2,he=new n,ae=null,pe=he,ye=null,ve=null,ue=i[u],xe=a[u];for(S=1;S<X;S++)pe=pe.next=new n,S===oe&&(ae=pe);for(pe.next=he,T=_=0,y=0;y<p;y++){for(Z=I=W=U=N=R=D=j=0,O=oe*(K=c[_]),F=oe*($=c[_+1]),z=oe*(Q=c[_+2]),G=oe*(ie=c[_+3]),N+=se*K,R+=se*$,D+=se*Q,j+=se*ie,pe=he,S=0;S<oe;S++)pe.r=K,pe.g=$,pe.b=Q,pe.a=ie,pe=pe.next;for(S=1;S<oe;S++)w=_+((re<S?re:S)<<2),N+=(pe.r=K=c[w])*(te=oe-S),R+=(pe.g=$=c[w+1])*te,D+=(pe.b=Q=c[w+2])*te,j+=(pe.a=ie=c[w+3])*te,Z+=K,I+=$,W+=Q,U+=ie,pe=pe.next;for(ye=he,ve=ae,g=0;g<f;g++)c[_+3]=ie=j*ue>>xe,ie!==0?(ie=255/ie,c[_]=(N*ue>>xe)*ie,c[_+1]=(R*ue>>xe)*ie,c[_+2]=(D*ue>>xe)*ie):c[_]=c[_+1]=c[_+2]=0,N-=O,R-=F,D-=z,j-=G,O-=ye.r,F-=ye.g,z-=ye.b,G-=ye.a,w=T+((w=g+u+1)<re?w:re)<<2,Z+=ye.r=c[w],I+=ye.g=c[w+1],W+=ye.b=c[w+2],U+=ye.a=c[w+3],N+=Z,R+=I,D+=W,j+=U,ye=ye.next,O+=K=ve.r,F+=$=ve.g,z+=Q=ve.b,G+=ie=ve.a,Z-=K,I-=$,W-=Q,U-=ie,ve=ve.next,_+=4;T+=f}for(g=0;g<f;g++){for(I=W=U=Z=R=D=j=N=0,_=g<<2,O=oe*(K=c[_]),F=oe*($=c[_+1]),z=oe*(Q=c[_+2]),G=oe*(ie=c[_+3]),N+=se*K,R+=se*$,D+=se*Q,j+=se*ie,pe=he,S=0;S<oe;S++)pe.r=K,pe.g=$,pe.b=Q,pe.a=ie,pe=pe.next;for(C=f,S=1;S<=u;S++)_=C+g<<2,N+=(pe.r=K=c[_])*(te=oe-S),R+=(pe.g=$=c[_+1])*te,D+=(pe.b=Q=c[_+2])*te,j+=(pe.a=ie=c[_+3])*te,Z+=K,I+=$,W+=Q,U+=ie,pe=pe.next,S<fe&&(C+=f);for(_=g,ye=he,ve=ae,y=0;y<p;y++)w=_<<2,c[w+3]=ie=j*ue>>xe,ie>0?(ie=255/ie,c[w]=(N*ue>>xe)*ie,c[w+1]=(R*ue>>xe)*ie,c[w+2]=(D*ue>>xe)*ie):c[w]=c[w+1]=c[w+2]=0,N-=O,R-=F,D-=z,j-=G,O-=ye.r,F-=ye.g,z-=ye.b,G-=ye.a,w=g+((w=y+oe)<fe?w:fe)*f<<2,N+=Z+=ye.r=c[w],R+=I+=ye.g=c[w+1],D+=W+=ye.b=c[w+2],j+=U+=ye.a=c[w+3],ye=ye.next,O+=K=ve.r,F+=$=ve.g,z+=Q=ve.b,G+=ie=ve.a,Z-=K,I-=$,W-=Q,U-=ie,ve=ve.next,_+=f}}const o=function(u){const c=Math.round(this.blurRadius());c>0&&s(u,c)};return wg.Blur=o,t.Factory.addGetterSetter(e.Node,"blurRadius",0,(0,r.getNumberValidator)(),t.Factory.afterSetFilter),wg}var Sg={},Y5;function $G(){if(Y5)return Sg;Y5=1,Object.defineProperty(Sg,"__esModule",{value:!0}),Sg.Brighten=void 0;const t=Lr(),e=Ei(),r=Dr(),n=function(i){let a=this.brightness()*255,s=i.data,o=s.length,l;for(l=0;l<o;l+=4)s[l]+=a,s[l+1]+=a,s[l+2]+=a};return Sg.Brighten=n,t.Factory.addGetterSetter(e.Node,"brightness",0,(0,r.getNumberValidator)(),t.Factory.afterSetFilter),Sg}var kg={},X5;function KG(){if(X5)return kg;X5=1,Object.defineProperty(kg,"__esModule",{value:!0}),kg.Contrast=void 0;const t=Lr(),e=Ei(),r=Dr(),n=function(i){const a=Math.pow((this.contrast()+100)/100,2);let s=i.data,o=s.length,l=150,u=150,c=150,f;for(f=0;f<o;f+=4)l=s[f],u=s[f+1],c=s[f+2],l/=255,l-=.5,l*=a,l+=.5,l*=255,u/=255,u-=.5,u*=a,u+=.5,u*=255,c/=255,c-=.5,c*=a,c+=.5,c*=255,l=l<0?0:l>255?255:l,u=u<0?0:u>255?255:u,c=c<0?0:c>255?255:c,s[f]=l,s[f+1]=u,s[f+2]=c};return kg.Contrast=n,t.Factory.addGetterSetter(e.Node,"contrast",0,(0,r.getNumberValidator)(),t.Factory.afterSetFilter),kg}var _g={},Q5;function ZG(){if(Q5)return _g;Q5=1,Object.defineProperty(_g,"__esModule",{value:!0}),_g.Emboss=void 0;const t=Lr(),e=Ei(),r=pi(),n=Dr(),i=function(a){let s=this.embossStrength()*10,o=this.embossWhiteLevel()*255,l=this.embossDirection(),u=this.embossBlend(),c=0,f=0,p=a.data,g=a.width,y=a.height,S=g*4,w=y;switch(l){case"top-left":c=-1,f=-1;break;case"top":c=-1,f=0;break;case"top-right":c=-1,f=1;break;case"right":c=0,f=1;break;case"bottom-right":c=1,f=1;break;case"bottom":c=1,f=0;break;case"bottom-left":c=1,f=-1;break;case"left":c=0,f=-1;break;default:r.Util.error("Unknown emboss direction: "+l)}do{const C=(w-1)*S;let _=c;w+_<1&&(_=0),w+_>y&&(_=0);const T=(w-1+_)*g*4;let N=g;do{const R=C+(N-1)*4;let D=f;N+D<1&&(D=0),N+D>g&&(D=0);const j=T+(N-1+D)*4,O=p[R]-p[j],F=p[R+1]-p[j+1],z=p[R+2]-p[j+2];let G=O;const Z=G>0?G:-G,I=F>0?F:-F,W=z>0?z:-z;if(I>Z&&(G=F),W>Z&&(G=z),G*=s,u){const U=p[R]+G,K=p[R+1]+G,$=p[R+2]+G;p[R]=U>255?255:U<0?0:U,p[R+1]=K>255?255:K<0?0:K,p[R+2]=$>255?255:$<0?0:$}else{let U=o-G;U<0?U=0:U>255&&(U=255),p[R]=p[R+1]=p[R+2]=U}}while(--N)}while(--w)};return _g.Emboss=i,t.Factory.addGetterSetter(e.Node,"embossStrength",.5,(0,n.getNumberValidator)(),t.Factory.afterSetFilter),t.Factory.addGetterSetter(e.Node,"embossWhiteLevel",.5,(0,n.getNumberValidator)(),t.Factory.afterSetFilter),t.Factory.addGetterSetter(e.Node,"embossDirection","top-left",null,t.Factory.afterSetFilter),t.Factory.addGetterSetter(e.Node,"embossBlend",!1,null,t.Factory.afterSetFilter),_g}var Cg={},J5;function YG(){if(J5)return Cg;J5=1,Object.defineProperty(Cg,"__esModule",{value:!0}),Cg.Enhance=void 0;const t=Lr(),e=Ei(),r=Dr();function n(a,s,o,l,u){let c=o-s,f=u-l,p;return c===0?l+f/2:f===0?l:(p=(a-s)/c,p=f*p+l,p)}const i=function(a){let s=a.data,o=s.length,l=s[0],u=l,c,f=s[1],p=f,g,y=s[2],S=y,w,C;const _=this.enhance();if(_===0)return;for(C=0;C<o;C+=4)c=s[C+0],c<l?l=c:c>u&&(u=c),g=s[C+1],g<f?f=g:g>p&&(p=g),w=s[C+2],w<y?y=w:w>S&&(S=w);u===l&&(u=255,l=0),p===f&&(p=255,f=0),S===y&&(S=255,y=0);let T,N,R,D,j,O,F,z,G;for(_>0?(N=u+_*(255-u),R=l-_*(l-0),j=p+_*(255-p),O=f-_*(f-0),z=S+_*(255-S),G=y-_*(y-0)):(T=(u+l)*.5,N=u+_*(u-T),R=l+_*(l-T),D=(p+f)*.5,j=p+_*(p-D),O=f+_*(f-D),F=(S+y)*.5,z=S+_*(S-F),G=y+_*(y-F)),C=0;C<o;C+=4)s[C+0]=n(s[C+0],l,u,R,N),s[C+1]=n(s[C+1],f,p,O,j),s[C+2]=n(s[C+2],y,S,G,z)};return Cg.Enhance=i,t.Factory.addGetterSetter(e.Node,"enhance",0,(0,r.getNumberValidator)(),t.Factory.afterSetFilter),Cg}var Eg={},e4;function XG(){if(e4)return Eg;e4=1,Object.defineProperty(Eg,"__esModule",{value:!0}),Eg.Grayscale=void 0;const t=function(e){let r=e.data,n=r.length,i,a;for(i=0;i<n;i+=4)a=.34*r[i]+.5*r[i+1]+.16*r[i+2],r[i]=a,r[i+1]=a,r[i+2]=a};return Eg.Grayscale=t,Eg}var Tg={},t4;function QG(){if(t4)return Tg;t4=1,Object.defineProperty(Tg,"__esModule",{value:!0}),Tg.HSL=void 0;const t=Lr(),e=Ei(),r=Dr();t.Factory.addGetterSetter(e.Node,"hue",0,(0,r.getNumberValidator)(),t.Factory.afterSetFilter),t.Factory.addGetterSetter(e.Node,"saturation",0,(0,r.getNumberValidator)(),t.Factory.afterSetFilter),t.Factory.addGetterSetter(e.Node,"luminance",0,(0,r.getNumberValidator)(),t.Factory.afterSetFilter);const n=function(i){let a=i.data,s=a.length,o=1,l=Math.pow(2,this.saturation()),u=Math.abs(this.hue()+360)%360,c=this.luminance()*127,f;const p=o*l*Math.cos(u*Math.PI/180),g=o*l*Math.sin(u*Math.PI/180),y=.299*o+.701*p+.167*g,S=.587*o-.587*p+.33*g,w=.114*o-.114*p-.497*g,C=.299*o-.299*p-.328*g,_=.587*o+.413*p+.035*g,T=.114*o-.114*p+.293*g,N=.299*o-.3*p+1.25*g,R=.587*o-.586*p-1.05*g,D=.114*o+.886*p-.2*g;let j,O,F,z;for(f=0;f<s;f+=4)j=a[f+0],O=a[f+1],F=a[f+2],z=a[f+3],a[f+0]=y*j+S*O+w*F+c,a[f+1]=C*j+_*O+T*F+c,a[f+2]=N*j+R*O+D*F+c,a[f+3]=z};return Tg.HSL=n,Tg}var Ng={},r4;function JG(){if(r4)return Ng;r4=1,Object.defineProperty(Ng,"__esModule",{value:!0}),Ng.HSV=void 0;const t=Lr(),e=Ei(),r=Dr(),n=function(i){const a=i.data,s=a.length,o=Math.pow(2,this.value()),l=Math.pow(2,this.saturation()),u=Math.abs(this.hue()+360)%360,c=o*l*Math.cos(u*Math.PI/180),f=o*l*Math.sin(u*Math.PI/180),p=.299*o+.701*c+.167*f,g=.587*o-.587*c+.33*f,y=.114*o-.114*c-.497*f,S=.299*o-.299*c-.328*f,w=.587*o+.413*c+.035*f,C=.114*o-.114*c+.293*f,_=.299*o-.3*c+1.25*f,T=.587*o-.586*c-1.05*f,N=.114*o+.886*c-.2*f;let R,D,j,O;for(let F=0;F<s;F+=4)R=a[F+0],D=a[F+1],j=a[F+2],O=a[F+3],a[F+0]=p*R+g*D+y*j,a[F+1]=S*R+w*D+C*j,a[F+2]=_*R+T*D+N*j,a[F+3]=O};return Ng.HSV=n,t.Factory.addGetterSetter(e.Node,"hue",0,(0,r.getNumberValidator)(),t.Factory.afterSetFilter),t.Factory.addGetterSetter(e.Node,"saturation",0,(0,r.getNumberValidator)(),t.Factory.afterSetFilter),t.Factory.addGetterSetter(e.Node,"value",0,(0,r.getNumberValidator)(),t.Factory.afterSetFilter),Ng}var Pg={},n4;function eV(){if(n4)return Pg;n4=1,Object.defineProperty(Pg,"__esModule",{value:!0}),Pg.Invert=void 0;const t=function(e){let r=e.data,n=r.length,i;for(i=0;i<n;i+=4)r[i]=255-r[i],r[i+1]=255-r[i+1],r[i+2]=255-r[i+2]};return Pg.Invert=t,Pg}var Mg={},i4;function tV(){if(i4)return Mg;i4=1,Object.defineProperty(Mg,"__esModule",{value:!0}),Mg.Kaleidoscope=void 0;const t=Lr(),e=Ei(),r=pi(),n=Dr(),i=function(o,l,u){let c=o.data,f=l.data,p=o.width,g=o.height,y=u.polarCenterX||p/2,S=u.polarCenterY||g/2,w,C,_,T=0,N=0,R=0,D=0,j,O=Math.sqrt(y*y+S*S);C=p-y,_=g-S,j=Math.sqrt(C*C+_*_),O=j>O?j:O;let F=g,z=p,G,Z,I=360/z*Math.PI/180,W,U;for(Z=0;Z<z;Z+=1)for(W=Math.sin(Z*I),U=Math.cos(Z*I),G=0;G<F;G+=1)C=Math.floor(y+O*G/F*U),_=Math.floor(S+O*G/F*W),w=(_*p+C)*4,T=c[w+0],N=c[w+1],R=c[w+2],D=c[w+3],w=(Z+G*p)*4,f[w+0]=T,f[w+1]=N,f[w+2]=R,f[w+3]=D},a=function(o,l,u){let c=o.data,f=l.data,p=o.width,g=o.height,y=u.polarCenterX||p/2,S=u.polarCenterY||g/2,w,C,_,T,N,R=0,D=0,j=0,O=0,F,z=Math.sqrt(y*y+S*S);C=p-y,_=g-S,F=Math.sqrt(C*C+_*_),z=F>z?F:z;let G=g,Z=p,I,W,U=0,K,$;for(C=0;C<p;C+=1)for(_=0;_<g;_+=1)T=C-y,N=_-S,I=Math.sqrt(T*T+N*N)*G/z,W=(Math.atan2(N,T)*180/Math.PI+360+U)%360,W=W*Z/360,K=Math.floor(W),$=Math.floor(I),w=($*p+K)*4,R=c[w+0],D=c[w+1],j=c[w+2],O=c[w+3],w=(_*p+C)*4,f[w+0]=R,f[w+1]=D,f[w+2]=j,f[w+3]=O},s=function(o){const l=o.width,u=o.height;let c,f,p,g,y,S,w,C,_,T,N=Math.round(this.kaleidoscopePower());const R=Math.round(this.kaleidoscopeAngle()),D=Math.floor(l*(R%360)/360);if(N<1)return;const j=r.Util.createCanvasElement();j.width=l,j.height=u;const O=j.getContext("2d").getImageData(0,0,l,u);r.Util.releaseCanvas(j),i(o,O,{polarCenterX:l/2,polarCenterY:u/2});let F=l/Math.pow(2,N);for(;F<=8;)F=F*2,N-=1;F=Math.ceil(F);let z=F,G=0,Z=z,I=1;for(D+F>l&&(G=z,Z=0,I=-1),f=0;f<u;f+=1)for(c=G;c!==Z;c+=I)p=Math.round(c+D)%l,_=(l*f+p)*4,y=O.data[_+0],S=O.data[_+1],w=O.data[_+2],C=O.data[_+3],T=(l*f+c)*4,O.data[T+0]=y,O.data[T+1]=S,O.data[T+2]=w,O.data[T+3]=C;for(f=0;f<u;f+=1)for(z=Math.floor(F),g=0;g<N;g+=1){for(c=0;c<z+1;c+=1)_=(l*f+c)*4,y=O.data[_+0],S=O.data[_+1],w=O.data[_+2],C=O.data[_+3],T=(l*f+z*2-c-1)*4,O.data[T+0]=y,O.data[T+1]=S,O.data[T+2]=w,O.data[T+3]=C;z*=2}a(O,o,{})};return Mg.Kaleidoscope=s,t.Factory.addGetterSetter(e.Node,"kaleidoscopePower",2,(0,n.getNumberValidator)(),t.Factory.afterSetFilter),t.Factory.addGetterSetter(e.Node,"kaleidoscopeAngle",0,(0,n.getNumberValidator)(),t.Factory.afterSetFilter),Mg}var Ag={},a4;function rV(){if(a4)return Ag;a4=1,Object.defineProperty(Ag,"__esModule",{value:!0}),Ag.Mask=void 0;const t=Lr(),e=Ei(),r=Dr();function n(p,g,y){let S=(y*p.width+g)*4;const w=[];return w.push(p.data[S++],p.data[S++],p.data[S++],p.data[S++]),w}function i(p,g){return Math.sqrt(Math.pow(p[0]-g[0],2)+Math.pow(p[1]-g[1],2)+Math.pow(p[2]-g[2],2))}function a(p){const g=[0,0,0];for(let y=0;y<p.length;y++)g[0]+=p[y][0],g[1]+=p[y][1],g[2]+=p[y][2];return g[0]/=p.length,g[1]/=p.length,g[2]/=p.length,g}function s(p,g){const y=n(p,0,0),S=n(p,p.width-1,0),w=n(p,0,p.height-1),C=n(p,p.width-1,p.height-1),_=g||10;if(i(y,S)<_&&i(S,C)<_&&i(C,w)<_&&i(w,y)<_){const T=a([S,y,C,w]),N=[];for(let R=0;R<p.width*p.height;R++){const D=i(T,[p.data[R*4],p.data[R*4+1],p.data[R*4+2]]);N[R]=D<_?0:255}return N}}function o(p,g){for(let y=0;y<p.width*p.height;y++)p.data[4*y+3]=g[y]}function l(p,g,y){const S=[1,1,1,1,0,1,1,1,1],w=Math.round(Math.sqrt(S.length)),C=Math.floor(w/2),_=[];for(let T=0;T<y;T++)for(let N=0;N<g;N++){const R=T*g+N;let D=0;for(let j=0;j<w;j++)for(let O=0;O<w;O++){const F=T+j-C,z=N+O-C;if(F>=0&&F<y&&z>=0&&z<g){const G=F*g+z,Z=S[j*w+O];D+=p[G]*Z}}_[R]=D===2040?255:0}return _}function u(p,g,y){const S=[1,1,1,1,1,1,1,1,1],w=Math.round(Math.sqrt(S.length)),C=Math.floor(w/2),_=[];for(let T=0;T<y;T++)for(let N=0;N<g;N++){const R=T*g+N;let D=0;for(let j=0;j<w;j++)for(let O=0;O<w;O++){const F=T+j-C,z=N+O-C;if(F>=0&&F<y&&z>=0&&z<g){const G=F*g+z,Z=S[j*w+O];D+=p[G]*Z}}_[R]=D>=1020?255:0}return _}function c(p,g,y){const S=[.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111],w=Math.round(Math.sqrt(S.length)),C=Math.floor(w/2),_=[];for(let T=0;T<y;T++)for(let N=0;N<g;N++){const R=T*g+N;let D=0;for(let j=0;j<w;j++)for(let O=0;O<w;O++){const F=T+j-C,z=N+O-C;if(F>=0&&F<y&&z>=0&&z<g){const G=F*g+z,Z=S[j*w+O];D+=p[G]*Z}}_[R]=D}return _}const f=function(p){let g=this.threshold(),y=s(p,g);return y&&(y=l(y,p.width,p.height),y=u(y,p.width,p.height),y=c(y,p.width,p.height),o(p,y)),p};return Ag.Mask=f,t.Factory.addGetterSetter(e.Node,"threshold",0,(0,r.getNumberValidator)(),t.Factory.afterSetFilter),Ag}var Lg={},s4;function nV(){if(s4)return Lg;s4=1,Object.defineProperty(Lg,"__esModule",{value:!0}),Lg.Noise=void 0;const t=Lr(),e=Ei(),r=Dr(),n=function(i){const a=this.noise()*255,s=i.data,o=s.length,l=a/2;for(let u=0;u<o;u+=4)s[u+0]+=l-2*l*Math.random(),s[u+1]+=l-2*l*Math.random(),s[u+2]+=l-2*l*Math.random()};return Lg.Noise=n,t.Factory.addGetterSetter(e.Node,"noise",.2,(0,r.getNumberValidator)(),t.Factory.afterSetFilter),Lg}var Rg={},o4;function iV(){if(o4)return Rg;o4=1,Object.defineProperty(Rg,"__esModule",{value:!0}),Rg.Pixelate=void 0;const t=Lr(),e=pi(),r=Ei(),n=Dr(),i=function(a){let s=Math.ceil(this.pixelSize()),o=a.width,l=a.height,u,c,f,p,g,y,S,w=Math.ceil(o/s),C=Math.ceil(l/s),_,T,N,R,D,j,O,F=a.data;if(s<=0){e.Util.error("pixelSize value can not be <= 0");return}for(D=0;D<w;D+=1)for(j=0;j<C;j+=1){for(p=0,g=0,y=0,S=0,_=D*s,T=_+s,N=j*s,R=N+s,O=0,u=_;u<T;u+=1)if(!(u>=o))for(c=N;c<R;c+=1)c>=l||(f=(o*c+u)*4,p+=F[f+0],g+=F[f+1],y+=F[f+2],S+=F[f+3],O+=1);for(p=p/O,g=g/O,y=y/O,S=S/O,u=_;u<T;u+=1)if(!(u>=o))for(c=N;c<R;c+=1)c>=l||(f=(o*c+u)*4,F[f+0]=p,F[f+1]=g,F[f+2]=y,F[f+3]=S)}};return Rg.Pixelate=i,t.Factory.addGetterSetter(r.Node,"pixelSize",8,(0,n.getNumberValidator)(),t.Factory.afterSetFilter),Rg}var Og={},l4;function aV(){if(l4)return Og;l4=1,Object.defineProperty(Og,"__esModule",{value:!0}),Og.Posterize=void 0;const t=Lr(),e=Ei(),r=Dr(),n=function(i){let a=Math.round(this.levels()*254)+1,s=i.data,o=s.length,l=255/a,u;for(u=0;u<o;u+=1)s[u]=Math.floor(s[u]/l)*l};return Og.Posterize=n,t.Factory.addGetterSetter(e.Node,"levels",.5,(0,r.getNumberValidator)(),t.Factory.afterSetFilter),Og}var Dg={},u4;function sV(){if(u4)return Dg;u4=1,Object.defineProperty(Dg,"__esModule",{value:!0}),Dg.RGB=void 0;const t=Lr(),e=Ei(),r=Dr(),n=function(i){let a=i.data,s=a.length,o=this.red(),l=this.green(),u=this.blue(),c,f;for(c=0;c<s;c+=4)f=(.34*a[c]+.5*a[c+1]+.16*a[c+2])/255,a[c]=f*o,a[c+1]=f*l,a[c+2]=f*u,a[c+3]=a[c+3]};return Dg.RGB=n,t.Factory.addGetterSetter(e.Node,"red",0,function(i){return this._filterUpToDate=!1,i>255?255:i<0?0:Math.round(i)}),t.Factory.addGetterSetter(e.Node,"green",0,function(i){return this._filterUpToDate=!1,i>255?255:i<0?0:Math.round(i)}),t.Factory.addGetterSetter(e.Node,"blue",0,r.RGBComponent,t.Factory.afterSetFilter),Dg}var Ig={},c4;function oV(){if(c4)return Ig;c4=1,Object.defineProperty(Ig,"__esModule",{value:!0}),Ig.RGBA=void 0;const t=Lr(),e=Ei(),r=Dr(),n=function(i){const a=i.data,s=a.length,o=this.red(),l=this.green(),u=this.blue(),c=this.alpha();for(let f=0;f<s;f+=4){const p=1-c;a[f]=o*c+a[f]*p,a[f+1]=l*c+a[f+1]*p,a[f+2]=u*c+a[f+2]*p}};return Ig.RGBA=n,t.Factory.addGetterSetter(e.Node,"red",0,function(i){return this._filterUpToDate=!1,i>255?255:i<0?0:Math.round(i)}),t.Factory.addGetterSetter(e.Node,"green",0,function(i){return this._filterUpToDate=!1,i>255?255:i<0?0:Math.round(i)}),t.Factory.addGetterSetter(e.Node,"blue",0,r.RGBComponent,t.Factory.afterSetFilter),t.Factory.addGetterSetter(e.Node,"alpha",1,function(i){return this._filterUpToDate=!1,i>1?1:i<0?0:i}),Ig}var jg={},d4;function lV(){if(d4)return jg;d4=1,Object.defineProperty(jg,"__esModule",{value:!0}),jg.Sepia=void 0;const t=function(e){let r=e.data,n=r.length,i,a,s,o;for(i=0;i<n;i+=4)a=r[i+0],s=r[i+1],o=r[i+2],r[i+0]=Math.min(255,a*.393+s*.769+o*.189),r[i+1]=Math.min(255,a*.349+s*.686+o*.168),r[i+2]=Math.min(255,a*.272+s*.534+o*.131)};return jg.Sepia=t,jg}var Fg={},f4;function uV(){if(f4)return Fg;f4=1,Object.defineProperty(Fg,"__esModule",{value:!0}),Fg.Solarize=void 0;const t=function(e){const r=e.data,n=e.width,i=e.height,a=n*4;let s=i;do{const o=(s-1)*a;let l=n;do{const u=o+(l-1)*4;let c=r[u],f=r[u+1],p=r[u+2];c>127&&(c=255-c),f>127&&(f=255-f),p>127&&(p=255-p),r[u]=c,r[u+1]=f,r[u+2]=p}while(--l)}while(--s)};return Fg.Solarize=t,Fg}var Bg={},h4;function cV(){if(h4)return Bg;h4=1,Object.defineProperty(Bg,"__esModule",{value:!0}),Bg.Threshold=void 0;const t=Lr(),e=Ei(),r=Dr(),n=function(i){const a=this.threshold()*255,s=i.data,o=s.length;for(let l=0;l<o;l+=1)s[l]=s[l]<a?0:255};return Bg.Threshold=n,t.Factory.addGetterSetter(e.Node,"threshold",.5,(0,r.getNumberValidator)(),t.Factory.afterSetFilter),Bg}var p4;function dV(){if(p4)return Jm;p4=1,Object.defineProperty(Jm,"__esModule",{value:!0}),Jm.Konva=void 0;const t=sk(),e=LG(),r=OG(),n=DG(),i=IG(),a=jG(),s=FG(),o=AL(),l=M_(),u=LL(),c=BG(),f=zG(),p=UG(),g=GG(),y=RL(),S=VG(),w=HG(),C=WG(),_=qG(),T=$G(),N=KG(),R=ZG(),D=YG(),j=XG(),O=QG(),F=JG(),z=eV(),G=tV(),Z=rV(),I=nV(),W=iV(),U=aV(),K=sV(),$=oV(),Q=lV(),ie=uV(),te=cV();return Jm.Konva=t.Konva.Util._assign(t.Konva,{Arc:e.Arc,Arrow:r.Arrow,Circle:n.Circle,Ellipse:i.Ellipse,Image:a.Image,Label:s.Label,Tag:s.Tag,Line:o.Line,Path:l.Path,Rect:u.Rect,RegularPolygon:c.RegularPolygon,Ring:f.Ring,Sprite:p.Sprite,Star:g.Star,Text:y.Text,TextPath:S.TextPath,Transformer:w.Transformer,Wedge:C.Wedge,Filters:{Blur:_.Blur,Brighten:T.Brighten,Contrast:N.Contrast,Emboss:R.Emboss,Enhance:D.Enhance,Grayscale:j.Grayscale,HSL:O.HSL,HSV:F.HSV,Invert:z.Invert,Kaleidoscope:G.Kaleidoscope,Mask:Z.Mask,Noise:I.Noise,Pixelate:W.Pixelate,Posterize:U.Posterize,RGB:K.RGB,RGBA:$.RGBA,Sepia:Q.Sepia,Solarize:ie.Solarize,Threshold:te.Threshold}}),Jm}var fV=Zy.exports,m4;function hV(){if(m4)return Zy.exports;m4=1,Object.defineProperty(fV,"__esModule",{value:!0});const t=dV();return Zy.exports=t.Konva,Zy.exports}hV();var vy={exports:{}},g4;function pV(){return g4||(g4=1,(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.Konva=void 0;var r=sk();Object.defineProperty(e,"Konva",{enumerable:!0,get:function(){return r.Konva}});const n=sk();t.exports=n.Konva})(vy,vy.exports)),vy.exports}var mV=pV();const Av=Th(mV);var F2={exports:{}};var B2,v4;function gV(){return v4||(v4=1,B2=function(e){var r={},n=am(),i=Yk(),a=Object.assign;function s(x){for(var b="https://reactjs.org/docs/error-decoder.html?invariant="+x,M=1;M<arguments.length;M++)b+="&args[]="+encodeURIComponent(arguments[M]);return"Minified React error #"+x+"; visit "+b+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,l=Symbol.for("react.element"),u=Symbol.for("react.portal"),c=Symbol.for("react.fragment"),f=Symbol.for("react.strict_mode"),p=Symbol.for("react.profiler"),g=Symbol.for("react.provider"),y=Symbol.for("react.context"),S=Symbol.for("react.forward_ref"),w=Symbol.for("react.suspense"),C=Symbol.for("react.suspense_list"),_=Symbol.for("react.memo"),T=Symbol.for("react.lazy"),N=Symbol.for("react.offscreen"),R=Symbol.iterator;function D(x){return x===null||typeof x!="object"?null:(x=R&&x[R]||x["@@iterator"],typeof x=="function"?x:null)}function j(x){if(x==null)return null;if(typeof x=="function")return x.displayName||x.name||null;if(typeof x=="string")return x;switch(x){case c:return"Fragment";case u:return"Portal";case p:return"Profiler";case f:return"StrictMode";case w:return"Suspense";case C:return"SuspenseList"}if(typeof x=="object")switch(x.$$typeof){case y:return(x.displayName||"Context")+".Consumer";case g:return(x._context.displayName||"Context")+".Provider";case S:var b=x.render;return x=x.displayName,x||(x=b.displayName||b.name||"",x=x!==""?"ForwardRef("+x+")":"ForwardRef"),x;case _:return b=x.displayName||null,b!==null?b:j(x.type)||"Memo";case T:b=x._payload,x=x._init;try{return j(x(b))}catch{}}return null}function O(x){var b=x.type;switch(x.tag){case 24:return"Cache";case 9:return(b.displayName||"Context")+".Consumer";case 10:return(b._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return x=b.render,x=x.displayName||x.name||"",b.displayName||(x!==""?"ForwardRef("+x+")":"ForwardRef");case 7:return"Fragment";case 5:return b;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return j(b);case 8:return b===f?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof b=="function")return b.displayName||b.name||null;if(typeof b=="string")return b}return null}function F(x){var b=x,M=x;if(x.alternate)for(;b.return;)b=b.return;else{x=b;do b=x,(b.flags&4098)!==0&&(M=b.return),x=b.return;while(x)}return b.tag===3?M:null}function z(x){if(F(x)!==x)throw Error(s(188))}function G(x){var b=x.alternate;if(!b){if(b=F(x),b===null)throw Error(s(188));return b!==x?null:x}for(var M=x,B=b;;){var q=M.return;if(q===null)break;var ee=q.alternate;if(ee===null){if(B=q.return,B!==null){M=B;continue}break}if(q.child===ee.child){for(ee=q.child;ee;){if(ee===M)return z(q),x;if(ee===B)return z(q),b;ee=ee.sibling}throw Error(s(188))}if(M.return!==B.return)M=q,B=ee;else{for(var me=!1,Te=q.child;Te;){if(Te===M){me=!0,M=q,B=ee;break}if(Te===B){me=!0,B=q,M=ee;break}Te=Te.sibling}if(!me){for(Te=ee.child;Te;){if(Te===M){me=!0,M=ee,B=q;break}if(Te===B){me=!0,B=ee,M=q;break}Te=Te.sibling}if(!me)throw Error(s(189))}}if(M.alternate!==B)throw Error(s(190))}if(M.tag!==3)throw Error(s(188));return M.stateNode.current===M?x:b}function Z(x){return x=G(x),x!==null?I(x):null}function I(x){if(x.tag===5||x.tag===6)return x;for(x=x.child;x!==null;){var b=I(x);if(b!==null)return b;x=x.sibling}return null}function W(x){if(x.tag===5||x.tag===6)return x;for(x=x.child;x!==null;){if(x.tag!==4){var b=W(x);if(b!==null)return b}x=x.sibling}return null}var U=Array.isArray,K=e.getPublicInstance,$=e.getRootHostContext,Q=e.getChildHostContext,ie=e.prepareForCommit,te=e.resetAfterCommit,X=e.createInstance,re=e.appendInitialChild,fe=e.finalizeInitialChildren,oe=e.prepareUpdate,se=e.shouldSetTextContent,he=e.createTextInstance,ae=e.scheduleTimeout,pe=e.cancelTimeout,ye=e.noTimeout,ve=e.isPrimaryRenderer,ue=e.supportsMutation,xe=e.supportsPersistence,Se=e.supportsHydration,Ae=e.getInstanceFromNode,Me=e.preparePortalMount,st=e.getCurrentEventPriority,rt=e.detachDeletedInstance,dt=e.supportsMicrotasks,Ct=e.scheduleMicrotask,Ke=e.supportsTestSelectors,ut=e.findFiberRoot,ct=e.getBoundingRect,xt=e.getTextContent,ot=e.isHiddenSubtree,Lt=e.matchAccessibilityRole,Bt=e.setFocusIfFocusable,Ne=e.setupIntersectionObserver,qe=e.appendChild,St=e.appendChildToContainer,it=e.commitTextUpdate,lt=e.commitMount,Ie=e.commitUpdate,de=e.insertBefore,ge=e.insertInContainerBefore,ke=e.removeChild,Ee=e.removeChildFromContainer,Re=e.resetTextContent,Qe=e.hideInstance,Ge=e.hideTextInstance,wt=e.unhideInstance,bt=e.unhideTextInstance,pt=e.clearContainer,Kt=e.cloneInstance,Wt=e.createContainerChildSet,Ve=e.appendChildToContainerChildSet,vt=e.finalizeContainerChildren,Et=e.replaceContainerChildren,er=e.cloneHiddenInstance,gr=e.cloneHiddenTextInstance,Ir=e.canHydrateInstance,zr=e.canHydrateTextInstance,Cr=e.canHydrateSuspenseInstance,fn=e.isSuspenseInstancePending,xr=e.isSuspenseInstanceFallback,Tt=e.getSuspenseInstanceFallbackErrorDetails,Ur=e.registerSuspenseInstanceRetry,Qn=e.getNextHydratableSibling,Zi=e.getFirstHydratableChild,ds=e.getFirstHydratableChildWithinContainer,As=e.getFirstHydratableChildWithinSuspenseInstance,ni=e.hydrateInstance,sn=e.hydrateTextInstance,kn=e.hydrateSuspenseInstance,In=e.getNextHydratableInstanceAfterSuspenseInstance,Ls=e.commitHydratedContainer,gi=e.commitHydratedSuspenseInstance,ko=e.clearSuspenseBoundary,qa=e.clearSuspenseBoundaryFromContainer,Ou=e.shouldDeleteUnhydratedTailInstances,_o=e.didNotMatchHydratedContainerTextInstance,on=e.didNotMatchHydratedTextInstance,Co;function fs(x){if(Co===void 0)try{throw Error()}catch(M){var b=M.stack.trim().match(/\n( *(at )?)/);Co=b&&b[1]||""}return`
`+Co+x}var ro=!1;function Yi(x,b){if(!x||ro)return"";ro=!0;var M=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(b)if(b=function(){throw Error()},Object.defineProperty(b.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(b,[])}catch(gt){var B=gt}Reflect.construct(x,[],b)}else{try{b.call()}catch(gt){B=gt}x.call(b.prototype)}else{try{throw Error()}catch(gt){B=gt}x()}}catch(gt){if(gt&&B&&typeof gt.stack=="string"){for(var q=gt.stack.split(`
`),ee=B.stack.split(`
`),me=q.length-1,Te=ee.length-1;1<=me&&0<=Te&&q[me]!==ee[Te];)Te--;for(;1<=me&&0<=Te;me--,Te--)if(q[me]!==ee[Te]){if(me!==1||Te!==1)do if(me--,Te--,0>Te||q[me]!==ee[Te]){var ze=`
`+q[me].replace(" at new "," at ");return x.displayName&&ze.includes("<anonymous>")&&(ze=ze.replace("<anonymous>",x.displayName)),ze}while(1<=me&&0<=Te);break}}}finally{ro=!1,Error.prepareStackTrace=M}return(x=x?x.displayName||x.name:"")?fs(x):""}var no=Object.prototype.hasOwnProperty,Ue=[],Ye=-1;function et(x){return{current:x}}function ht(x){0>Ye||(x.current=Ue[Ye],Ue[Ye]=null,Ye--)}function Ze(x,b){Ye++,Ue[Ye]=x.current,x.current=b}var Dt={},Pr=et(Dt),Mr=et(!1),Br=Dt;function vi(x,b){var M=x.type.contextTypes;if(!M)return Dt;var B=x.stateNode;if(B&&B.__reactInternalMemoizedUnmaskedChildContext===b)return B.__reactInternalMemoizedMaskedChildContext;var q={},ee;for(ee in M)q[ee]=b[ee];return B&&(x=x.stateNode,x.__reactInternalMemoizedUnmaskedChildContext=b,x.__reactInternalMemoizedMaskedChildContext=q),q}function zt(x){return x=x.childContextTypes,x!=null}function jr(){ht(Mr),ht(Pr)}function al(x,b,M){if(Pr.current!==Dt)throw Error(s(168));Ze(Pr,b),Ze(Mr,M)}function tr(x,b,M){var B=x.stateNode;if(b=b.childContextTypes,typeof B.getChildContext!="function")return M;B=B.getChildContext();for(var q in B)if(!(q in b))throw Error(s(108,O(x)||"Unknown",q));return a({},M,B)}function nr(x){return x=(x=x.stateNode)&&x.__reactInternalMemoizedMergedChildContext||Dt,Br=Pr.current,Ze(Pr,x),Ze(Mr,Mr.current),!0}function Rr(x,b,M){var B=x.stateNode;if(!B)throw Error(s(169));M?(x=tr(x,b,Br),B.__reactInternalMemoizedMergedChildContext=x,ht(Mr),ht(Pr),Ze(Pr,x)):ht(Mr),Ze(Mr,M)}var rr=Math.clz32?Math.clz32:io,en=Math.log,yn=Math.LN2;function io(x){return x>>>=0,x===0?32:31-(en(x)/yn|0)|0}var wr=64,ao=4194304;function Eo(x){switch(x&-x){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return x&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return x&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return x}}function Rs(x,b){var M=x.pendingLanes;if(M===0)return 0;var B=0,q=x.suspendedLanes,ee=x.pingedLanes,me=M&268435455;if(me!==0){var Te=me&~q;Te!==0?B=Eo(Te):(ee&=me,ee!==0&&(B=Eo(ee)))}else me=M&~q,me!==0?B=Eo(me):ee!==0&&(B=Eo(ee));if(B===0)return 0;if(b!==0&&b!==B&&(b&q)===0&&(q=B&-B,ee=b&-b,q>=ee||q===16&&(ee&4194240)!==0))return b;if((B&4)!==0&&(B|=M&16),b=x.entangledLanes,b!==0)for(x=x.entanglements,b&=B;0<b;)M=31-rr(b),q=1<<M,B|=x[M],b&=~q;return B}function Ec(x,b){switch(x){case 1:case 2:case 4:return b+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return b+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Tc(x,b){for(var M=x.suspendedLanes,B=x.pingedLanes,q=x.expirationTimes,ee=x.pendingLanes;0<ee;){var me=31-rr(ee),Te=1<<me,ze=q[me];ze===-1?((Te&M)===0||(Te&B)!==0)&&(q[me]=Ec(Te,b)):ze<=b&&(x.expiredLanes|=Te),ee&=~Te}}function sl(x){return x=x.pendingLanes&-1073741825,x!==0?x:x&1073741824?1073741824:0}function Vl(){var x=wr;return wr<<=1,(wr&4194240)===0&&(wr=64),x}function To(x){for(var b=[],M=0;31>M;M++)b.push(x);return b}function Fi(x,b,M){x.pendingLanes|=b,b!==536870912&&(x.suspendedLanes=0,x.pingedLanes=0),x=x.eventTimes,b=31-rr(b),x[b]=M}function so(x,b){var M=x.pendingLanes&~b;x.pendingLanes=b,x.suspendedLanes=0,x.pingedLanes=0,x.expiredLanes&=b,x.mutableReadLanes&=b,x.entangledLanes&=b,b=x.entanglements;var B=x.eventTimes;for(x=x.expirationTimes;0<M;){var q=31-rr(M),ee=1<<q;b[q]=0,B[q]=-1,x[q]=-1,M&=~ee}}function $a(x,b){var M=x.entangledLanes|=b;for(x=x.entanglements;M;){var B=31-rr(M),q=1<<B;q&b|x[B]&b&&(x[B]|=b),M&=~q}}var Sr=0;function or(x){return x&=-x,1<x?4<x?(x&268435455)!==0?16:536870912:4:1}var Jn=i.unstable_scheduleCallback,Zr=i.unstable_cancelCallback,vf=i.unstable_shouldYield,ol=i.unstable_requestPaint,jn=i.unstable_now,Hl=i.unstable_ImmediatePriority,Os=i.unstable_UserBlockingPriority,Wl=i.unstable_NormalPriority,Du=i.unstable_IdlePriority,hn=null,Fn=null;function ll(x){if(Fn&&typeof Fn.onCommitFiberRoot=="function")try{Fn.onCommitFiberRoot(hn,x,void 0,(x.current.flags&128)===128)}catch{}}function Iu(x,b){return x===b&&(x!==0||1/x===1/b)||x!==x&&b!==b}var hs=typeof Object.is=="function"?Object.is:Iu,Ds=null,No=!1,ql=!1;function ju(x){Ds===null?Ds=[x]:Ds.push(x)}function Er(x){No=!0,ju(x)}function yi(){if(!ql&&Ds!==null){ql=!0;var x=0,b=Sr;try{var M=Ds;for(Sr=1;x<M.length;x++){var B=M[x];do B=B(!0);while(B!==null)}Ds=null,No=!1}catch(q){throw Ds!==null&&(Ds=Ds.slice(x+1)),Jn(Hl,yi),q}finally{Sr=b,ql=!1}}return null}var ii=[],ba=0,$l=null,ul=0,xi=[],wa=0,Bn=null,Xi=1,ps="";function Sa(x,b){ii[ba++]=ul,ii[ba++]=$l,$l=x,ul=b}function Rh(x,b,M){xi[wa++]=Xi,xi[wa++]=ps,xi[wa++]=Bn,Bn=x;var B=Xi;x=ps;var q=32-rr(B)-1;B&=~(1<<q),M+=1;var ee=32-rr(b)+q;if(30<ee){var me=q-q%5;ee=(B&(1<<me)-1).toString(32),B>>=me,q-=me,Xi=1<<32-rr(b)+q|M<<q|B,ps=ee+x}else Xi=1<<ee|M<<q|B,ps=x}function Qi(x){x.return!==null&&(Sa(x,1),Rh(x,1,0))}function Fu(x){for(;x===$l;)$l=ii[--ba],ii[ba]=null,ul=ii[--ba],ii[ba]=null;for(;x===Bn;)Bn=xi[--wa],xi[wa]=null,ps=xi[--wa],xi[wa]=null,Xi=xi[--wa],xi[wa]=null}var ai=null,_n=null,tn=!1,Kl=!1,ka=null;function Oh(x,b){var M=ks(5,null,null,0);M.elementType="DELETED",M.stateNode=b,M.return=x,b=x.deletions,b===null?(x.deletions=[M],x.flags|=16):b.push(M)}function Bu(x,b){switch(x.tag){case 5:return b=Ir(b,x.type,x.pendingProps),b!==null?(x.stateNode=b,ai=x,_n=Zi(b),!0):!1;case 6:return b=zr(b,x.pendingProps),b!==null?(x.stateNode=b,ai=x,_n=null,!0):!1;case 13:if(b=Cr(b),b!==null){var M=Bn!==null?{id:Xi,overflow:ps}:null;return x.memoizedState={dehydrated:b,treeContext:M,retryLane:1073741824},M=ks(18,null,null,0),M.stateNode=b,M.return=x,x.child=M,ai=x,_n=null,!0}return!1;default:return!1}}function Nc(x){return(x.mode&1)!==0&&(x.flags&128)===0}function yf(x){if(tn){var b=_n;if(b){var M=b;if(!Bu(x,b)){if(Nc(x))throw Error(s(418));b=Qn(M);var B=ai;b&&Bu(x,b)?Oh(B,M):(x.flags=x.flags&-4097|2,tn=!1,ai=x)}}else{if(Nc(x))throw Error(s(418));x.flags=x.flags&-4097|2,tn=!1,ai=x}}}function Dh(x){for(x=x.return;x!==null&&x.tag!==5&&x.tag!==3&&x.tag!==13;)x=x.return;ai=x}function Zl(x){if(!Se||x!==ai)return!1;if(!tn)return Dh(x),tn=!0,!1;if(x.tag!==3&&(x.tag!==5||Ou(x.type)&&!se(x.type,x.memoizedProps))){var b=_n;if(b){if(Nc(x))throw Ih(),Error(s(418));for(;b;)Oh(x,b),b=Qn(b)}}if(Dh(x),x.tag===13){if(!Se)throw Error(s(316));if(x=x.memoizedState,x=x!==null?x.dehydrated:null,!x)throw Error(s(317));_n=In(x)}else _n=ai?Qn(x.stateNode):null;return!0}function Ih(){for(var x=_n;x;)x=Qn(x)}function Po(){Se&&(_n=ai=null,Kl=tn=!1)}function Pc(x){ka===null?ka=[x]:ka.push(x)}var Mc=o.ReactCurrentBatchConfig;function Is(x,b){if(hs(x,b))return!0;if(typeof x!="object"||x===null||typeof b!="object"||b===null)return!1;var M=Object.keys(x),B=Object.keys(b);if(M.length!==B.length)return!1;for(B=0;B<M.length;B++){var q=M[B];if(!no.call(b,q)||!hs(x[q],b[q]))return!1}return!0}function xm(x){switch(x.tag){case 5:return fs(x.type);case 16:return fs("Lazy");case 13:return fs("Suspense");case 19:return fs("SuspenseList");case 0:case 2:case 15:return x=Yi(x.type,!1),x;case 11:return x=Yi(x.type.render,!1),x;case 1:return x=Yi(x.type,!0),x;default:return""}}function ms(x,b,M){if(x=M.ref,x!==null&&typeof x!="function"&&typeof x!="object"){if(M._owner){if(M=M._owner,M){if(M.tag!==1)throw Error(s(309));var B=M.stateNode}if(!B)throw Error(s(147,x));var q=B,ee=""+x;return b!==null&&b.ref!==null&&typeof b.ref=="function"&&b.ref._stringRef===ee?b.ref:(b=function(me){var Te=q.refs;me===null?delete Te[ee]:Te[ee]=me},b._stringRef=ee,b)}if(typeof x!="string")throw Error(s(284));if(!M._owner)throw Error(s(290,x))}return x}function Bi(x,b){throw x=Object.prototype.toString.call(b),Error(s(31,x==="[object Object]"?"object with keys {"+Object.keys(b).join(", ")+"}":x))}function xf(x){var b=x._init;return b(x._payload)}function bf(x){function b(Fe,Pe){if(x){var He=Fe.deletions;He===null?(Fe.deletions=[Pe],Fe.flags|=16):He.push(Pe)}}function M(Fe,Pe){if(!x)return null;for(;Pe!==null;)b(Fe,Pe),Pe=Pe.sibling;return null}function B(Fe,Pe){for(Fe=new Map;Pe!==null;)Pe.key!==null?Fe.set(Pe.key,Pe):Fe.set(Pe.index,Pe),Pe=Pe.sibling;return Fe}function q(Fe,Pe){return Fe=mu(Fe,Pe),Fe.index=0,Fe.sibling=null,Fe}function ee(Fe,Pe,He){return Fe.index=He,x?(He=Fe.alternate,He!==null?(He=He.index,He<Pe?(Fe.flags|=2,Pe):He):(Fe.flags|=2,Pe)):(Fe.flags|=1048576,Pe)}function me(Fe){return x&&Fe.alternate===null&&(Fe.flags|=2),Fe}function Te(Fe,Pe,He,At){return Pe===null||Pe.tag!==6?(Pe=sd(He,Fe.mode,At),Pe.return=Fe,Pe):(Pe=q(Pe,He),Pe.return=Fe,Pe)}function ze(Fe,Pe,He,At){var $t=He.type;return $t===c?It(Fe,Pe,He.props.children,At,He.key):Pe!==null&&(Pe.elementType===$t||typeof $t=="object"&&$t!==null&&$t.$$typeof===T&&xf($t)===Pe.type)?(At=q(Pe,He.props),At.ref=ms(Fe,Pe,He),At.return=Fe,At):(At=rp(He.type,He.key,He.props,null,Fe.mode,At),At.ref=ms(Fe,Pe,He),At.return=Fe,At)}function gt(Fe,Pe,He,At){return Pe===null||Pe.tag!==4||Pe.stateNode.containerInfo!==He.containerInfo||Pe.stateNode.implementation!==He.implementation?(Pe=np(He,Fe.mode,At),Pe.return=Fe,Pe):(Pe=q(Pe,He.children||[]),Pe.return=Fe,Pe)}function It(Fe,Pe,He,At,$t){return Pe===null||Pe.tag!==7?(Pe=Gi(He,Fe.mode,At,$t),Pe.return=Fe,Pe):(Pe=q(Pe,He),Pe.return=Fe,Pe)}function cr(Fe,Pe,He){if(typeof Pe=="string"&&Pe!==""||typeof Pe=="number")return Pe=sd(""+Pe,Fe.mode,He),Pe.return=Fe,Pe;if(typeof Pe=="object"&&Pe!==null){switch(Pe.$$typeof){case l:return He=rp(Pe.type,Pe.key,Pe.props,null,Fe.mode,He),He.ref=ms(Fe,null,Pe),He.return=Fe,He;case u:return Pe=np(Pe,Fe.mode,He),Pe.return=Fe,Pe;case T:var At=Pe._init;return cr(Fe,At(Pe._payload),He)}if(U(Pe)||D(Pe))return Pe=Gi(Pe,Fe.mode,He,null),Pe.return=Fe,Pe;Bi(Fe,Pe)}return null}function Mt(Fe,Pe,He,At){var $t=Pe!==null?Pe.key:null;if(typeof He=="string"&&He!==""||typeof He=="number")return $t!==null?null:Te(Fe,Pe,""+He,At);if(typeof He=="object"&&He!==null){switch(He.$$typeof){case l:return He.key===$t?ze(Fe,Pe,He,At):null;case u:return He.key===$t?gt(Fe,Pe,He,At):null;case T:return $t=He._init,Mt(Fe,Pe,$t(He._payload),At)}if(U(He)||D(He))return $t!==null?null:It(Fe,Pe,He,At,null);Bi(Fe,He)}return null}function gn(Fe,Pe,He,At,$t){if(typeof At=="string"&&At!==""||typeof At=="number")return Fe=Fe.get(He)||null,Te(Pe,Fe,""+At,$t);if(typeof At=="object"&&At!==null){switch(At.$$typeof){case l:return Fe=Fe.get(At.key===null?He:At.key)||null,ze(Pe,Fe,At,$t);case u:return Fe=Fe.get(At.key===null?He:At.key)||null,gt(Pe,Fe,At,$t);case T:var vr=At._init;return gn(Fe,Pe,He,vr(At._payload),$t)}if(U(At)||D(At))return Fe=Fe.get(He)||null,It(Pe,Fe,At,$t,null);Bi(Pe,At)}return null}function Jr(Fe,Pe,He,At){for(var $t=null,vr=null,dr=Pe,Fr=Pe=0,_i=null;dr!==null&&Fr<He.length;Fr++){dr.index>Fr?(_i=dr,dr=null):_i=dr.sibling;var Or=Mt(Fe,dr,He[Fr],At);if(Or===null){dr===null&&(dr=_i);break}x&&dr&&Or.alternate===null&&b(Fe,dr),Pe=ee(Or,Pe,Fr),vr===null?$t=Or:vr.sibling=Or,vr=Or,dr=_i}if(Fr===He.length)return M(Fe,dr),tn&&Sa(Fe,Fr),$t;if(dr===null){for(;Fr<He.length;Fr++)dr=cr(Fe,He[Fr],At),dr!==null&&(Pe=ee(dr,Pe,Fr),vr===null?$t=dr:vr.sibling=dr,vr=dr);return tn&&Sa(Fe,Fr),$t}for(dr=B(Fe,dr);Fr<He.length;Fr++)_i=gn(dr,Fe,Fr,He[Fr],At),_i!==null&&(x&&_i.alternate!==null&&dr.delete(_i.key===null?Fr:_i.key),Pe=ee(_i,Pe,Fr),vr===null?$t=_i:vr.sibling=_i,vr=_i);return x&&dr.forEach(function(la){return b(Fe,la)}),tn&&Sa(Fe,Fr),$t}function Ra(Fe,Pe,He,At){var $t=D(He);if(typeof $t!="function")throw Error(s(150));if(He=$t.call(He),He==null)throw Error(s(151));for(var vr=$t=null,dr=Pe,Fr=Pe=0,_i=null,Or=He.next();dr!==null&&!Or.done;Fr++,Or=He.next()){dr.index>Fr?(_i=dr,dr=null):_i=dr.sibling;var la=Mt(Fe,dr,Or.value,At);if(la===null){dr===null&&(dr=_i);break}x&&dr&&la.alternate===null&&b(Fe,dr),Pe=ee(la,Pe,Fr),vr===null?$t=la:vr.sibling=la,vr=la,dr=_i}if(Or.done)return M(Fe,dr),tn&&Sa(Fe,Fr),$t;if(dr===null){for(;!Or.done;Fr++,Or=He.next())Or=cr(Fe,Or.value,At),Or!==null&&(Pe=ee(Or,Pe,Fr),vr===null?$t=Or:vr.sibling=Or,vr=Or);return tn&&Sa(Fe,Fr),$t}for(dr=B(Fe,dr);!Or.done;Fr++,Or=He.next())Or=gn(dr,Fe,Fr,Or.value,At),Or!==null&&(x&&Or.alternate!==null&&dr.delete(Or.key===null?Fr:Or.key),Pe=ee(Or,Pe,Fr),vr===null?$t=Or:vr.sibling=Or,vr=Or);return x&&dr.forEach(function(gb){return b(Fe,gb)}),tn&&Sa(Fe,Fr),$t}function Go(Fe,Pe,He,At){if(typeof He=="object"&&He!==null&&He.type===c&&He.key===null&&(He=He.props.children),typeof He=="object"&&He!==null){switch(He.$$typeof){case l:e:{for(var $t=He.key,vr=Pe;vr!==null;){if(vr.key===$t){if($t=He.type,$t===c){if(vr.tag===7){M(Fe,vr.sibling),Pe=q(vr,He.props.children),Pe.return=Fe,Fe=Pe;break e}}else if(vr.elementType===$t||typeof $t=="object"&&$t!==null&&$t.$$typeof===T&&xf($t)===vr.type){M(Fe,vr.sibling),Pe=q(vr,He.props),Pe.ref=ms(Fe,vr,He),Pe.return=Fe,Fe=Pe;break e}M(Fe,vr);break}else b(Fe,vr);vr=vr.sibling}He.type===c?(Pe=Gi(He.props.children,Fe.mode,At,He.key),Pe.return=Fe,Fe=Pe):(At=rp(He.type,He.key,He.props,null,Fe.mode,At),At.ref=ms(Fe,Pe,He),At.return=Fe,Fe=At)}return me(Fe);case u:e:{for(vr=He.key;Pe!==null;){if(Pe.key===vr)if(Pe.tag===4&&Pe.stateNode.containerInfo===He.containerInfo&&Pe.stateNode.implementation===He.implementation){M(Fe,Pe.sibling),Pe=q(Pe,He.children||[]),Pe.return=Fe,Fe=Pe;break e}else{M(Fe,Pe);break}else b(Fe,Pe);Pe=Pe.sibling}Pe=np(He,Fe.mode,At),Pe.return=Fe,Fe=Pe}return me(Fe);case T:return vr=He._init,Go(Fe,Pe,vr(He._payload),At)}if(U(He))return Jr(Fe,Pe,He,At);if(D(He))return Ra(Fe,Pe,He,At);Bi(Fe,He)}return typeof He=="string"&&He!==""||typeof He=="number"?(He=""+He,Pe!==null&&Pe.tag===6?(M(Fe,Pe.sibling),Pe=q(Pe,He),Pe.return=Fe,Fe=Pe):(M(Fe,Pe),Pe=sd(He,Fe.mode,At),Pe.return=Fe,Fe=Pe),me(Fe)):M(Fe,Pe)}return Go}var cl=bf(!0),Ac=bf(!1),Yl=et(null),Lc=null,Xl=null,Rc=null;function wf(){Rc=Xl=Lc=null}function Ka(x,b,M){ve?(Ze(Yl,b._currentValue),b._currentValue=M):(Ze(Yl,b._currentValue2),b._currentValue2=M)}function js(x){var b=Yl.current;ht(Yl),ve?x._currentValue=b:x._currentValue2=b}function dl(x,b,M){for(;x!==null;){var B=x.alternate;if((x.childLanes&b)!==b?(x.childLanes|=b,B!==null&&(B.childLanes|=b)):B!==null&&(B.childLanes&b)!==b&&(B.childLanes|=b),x===M)break;x=x.return}}function Ji(x,b){Lc=x,Rc=Xl=null,x=x.dependencies,x!==null&&x.firstContext!==null&&((x.lanes&b)!==0&&(Vn=!0),x.firstContext=null)}function _a(x){var b=ve?x._currentValue:x._currentValue2;if(Rc!==x)if(x={context:x,memoizedValue:b,next:null},Xl===null){if(Lc===null)throw Error(s(308));Xl=x,Lc.dependencies={lanes:0,firstContext:x}}else Xl=Xl.next=x;return b}var Ca=null;function Oc(x){Ca===null?Ca=[x]:Ca.push(x)}function fl(x,b,M,B){var q=b.interleaved;return q===null?(M.next=M,Oc(b)):(M.next=q.next,q.next=M),b.interleaved=M,Za(x,B)}function Za(x,b){x.lanes|=b;var M=x.alternate;for(M!==null&&(M.lanes|=b),M=x,x=x.return;x!==null;)x.childLanes|=b,M=x.alternate,M!==null&&(M.childLanes|=b),M=x,x=x.return;return M.tag===3?M.stateNode:null}var Pi=!1;function Sf(x){x.updateQueue={baseState:x.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function oo(x,b){x=x.updateQueue,b.updateQueue===x&&(b.updateQueue={baseState:x.baseState,firstBaseUpdate:x.firstBaseUpdate,lastBaseUpdate:x.lastBaseUpdate,shared:x.shared,effects:x.effects})}function Ya(x,b){return{eventTime:x,lane:b,tag:0,payload:null,callback:null,next:null}}function lo(x,b,M){var B=x.updateQueue;if(B===null)return null;if(B=B.shared,(pr&2)!==0){var q=B.pending;return q===null?b.next=b:(b.next=q.next,q.next=b),B.pending=b,Za(x,M)}return q=B.interleaved,q===null?(b.next=b,Oc(B)):(b.next=q.next,q.next=b),B.interleaved=b,Za(x,M)}function hl(x,b,M){if(b=b.updateQueue,b!==null&&(b=b.shared,(M&4194240)!==0)){var B=b.lanes;B&=x.pendingLanes,M|=B,b.lanes=M,$a(x,M)}}function Ql(x,b){var M=x.updateQueue,B=x.alternate;if(B!==null&&(B=B.updateQueue,M===B)){var q=null,ee=null;if(M=M.firstBaseUpdate,M!==null){do{var me={eventTime:M.eventTime,lane:M.lane,tag:M.tag,payload:M.payload,callback:M.callback,next:null};ee===null?q=ee=me:ee=ee.next=me,M=M.next}while(M!==null);ee===null?q=ee=b:ee=ee.next=b}else q=ee=b;M={baseState:B.baseState,firstBaseUpdate:q,lastBaseUpdate:ee,shared:B.shared,effects:B.effects},x.updateQueue=M;return}x=M.lastBaseUpdate,x===null?M.firstBaseUpdate=b:x.next=b,M.lastBaseUpdate=b}function Mi(x,b,M,B){var q=x.updateQueue;Pi=!1;var ee=q.firstBaseUpdate,me=q.lastBaseUpdate,Te=q.shared.pending;if(Te!==null){q.shared.pending=null;var ze=Te,gt=ze.next;ze.next=null,me===null?ee=gt:me.next=gt,me=ze;var It=x.alternate;It!==null&&(It=It.updateQueue,Te=It.lastBaseUpdate,Te!==me&&(Te===null?It.firstBaseUpdate=gt:Te.next=gt,It.lastBaseUpdate=ze))}if(ee!==null){var cr=q.baseState;me=0,It=gt=ze=null,Te=ee;do{var Mt=Te.lane,gn=Te.eventTime;if((B&Mt)===Mt){It!==null&&(It=It.next={eventTime:gn,lane:0,tag:Te.tag,payload:Te.payload,callback:Te.callback,next:null});e:{var Jr=x,Ra=Te;switch(Mt=b,gn=M,Ra.tag){case 1:if(Jr=Ra.payload,typeof Jr=="function"){cr=Jr.call(gn,cr,Mt);break e}cr=Jr;break e;case 3:Jr.flags=Jr.flags&-65537|128;case 0:if(Jr=Ra.payload,Mt=typeof Jr=="function"?Jr.call(gn,cr,Mt):Jr,Mt==null)break e;cr=a({},cr,Mt);break e;case 2:Pi=!0}}Te.callback!==null&&Te.lane!==0&&(x.flags|=64,Mt=q.effects,Mt===null?q.effects=[Te]:Mt.push(Te))}else gn={eventTime:gn,lane:Mt,tag:Te.tag,payload:Te.payload,callback:Te.callback,next:null},It===null?(gt=It=gn,ze=cr):It=It.next=gn,me|=Mt;if(Te=Te.next,Te===null){if(Te=q.shared.pending,Te===null)break;Mt=Te,Te=Mt.next,Mt.next=null,q.lastBaseUpdate=Mt,q.shared.pending=null}}while(!0);if(It===null&&(ze=cr),q.baseState=ze,q.firstBaseUpdate=gt,q.lastBaseUpdate=It,b=q.shared.interleaved,b!==null){q=b;do me|=q.lane,q=q.next;while(q!==b)}else ee===null&&(q.shared.lanes=0);Cl|=me,x.lanes=me,x.memoizedState=cr}}function jh(x,b,M){if(x=b.effects,b.effects=null,x!==null)for(b=0;b<x.length;b++){var B=x[b],q=B.callback;if(q!==null){if(B.callback=null,B=M,typeof q!="function")throw Error(s(191,q));q.call(B)}}}var Ea={},Xa=et(Ea),ea=et(Ea),gs=et(Ea);function Ta(x){if(x===Ea)throw Error(s(174));return x}function Jl(x,b){Ze(gs,b),Ze(ea,x),Ze(Xa,Ea),x=$(b),ht(Xa),Ze(Xa,x)}function Fs(){ht(Xa),ht(ea),ht(gs)}function zu(x){var b=Ta(gs.current),M=Ta(Xa.current);b=Q(M,x.type,b),M!==b&&(Ze(ea,x),Ze(Xa,b))}function eu(x){ea.current===x&&(ht(Xa),ht(ea))}var qr=et(0);function pl(x){for(var b=x;b!==null;){if(b.tag===13){var M=b.memoizedState;if(M!==null&&(M=M.dehydrated,M===null||fn(M)||xr(M)))return b}else if(b.tag===19&&b.memoizedProps.revealOrder!==void 0){if((b.flags&128)!==0)return b}else if(b.child!==null){b.child.return=b,b=b.child;continue}if(b===x)break;for(;b.sibling===null;){if(b.return===null||b.return===x)return null;b=b.return}b.sibling.return=b.return,b=b.sibling}return null}var Uu=[];function Dc(){for(var x=0;x<Uu.length;x++){var b=Uu[x];ve?b._workInProgressVersionPrimary=null:b._workInProgressVersionSecondary=null}Uu.length=0}var ta=o.ReactCurrentDispatcher,Bs=o.ReactCurrentBatchConfig,Mo=0,ln=null,zn=null,Un=null,tu=!1,ra=!1,Ao=0,ru=0;function Ln(){throw Error(s(321))}function ml(x,b){if(b===null)return!1;for(var M=0;M<b.length&&M<x.length;M++)if(!hs(x[M],b[M]))return!1;return!0}function nu(x,b,M,B,q,ee){if(Mo=ee,ln=b,b.memoizedState=null,b.updateQueue=null,b.lanes=0,ta.current=x===null||x.memoizedState===null?Nt:Xt,x=M(B,q),ra){ee=0;do{if(ra=!1,Ao=0,25<=ee)throw Error(s(301));ee+=1,Un=zn=null,b.updateQueue=null,ta.current=hr,x=M(B,q)}while(ra)}if(ta.current=Xe,b=zn!==null&&zn.next!==null,Mo=0,Un=zn=ln=null,tu=!1,b)throw Error(s(300));return x}function Ic(){var x=Ao!==0;return Ao=0,x}function bi(){var x={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Un===null?ln.memoizedState=Un=x:Un=Un.next=x,Un}function wi(){if(zn===null){var x=ln.alternate;x=x!==null?x.memoizedState:null}else x=zn.next;var b=Un===null?ln.memoizedState:Un.next;if(b!==null)Un=b,zn=x;else{if(x===null)throw Error(s(310));zn=x,x={memoizedState:zn.memoizedState,baseState:zn.baseState,baseQueue:zn.baseQueue,queue:zn.queue,next:null},Un===null?ln.memoizedState=Un=x:Un=Un.next=x}return Un}function Qa(x,b){return typeof b=="function"?b(x):b}function Gu(x){var b=wi(),M=b.queue;if(M===null)throw Error(s(311));M.lastRenderedReducer=x;var B=zn,q=B.baseQueue,ee=M.pending;if(ee!==null){if(q!==null){var me=q.next;q.next=ee.next,ee.next=me}B.baseQueue=q=ee,M.pending=null}if(q!==null){ee=q.next,B=B.baseState;var Te=me=null,ze=null,gt=ee;do{var It=gt.lane;if((Mo&It)===It)ze!==null&&(ze=ze.next={lane:0,action:gt.action,hasEagerState:gt.hasEagerState,eagerState:gt.eagerState,next:null}),B=gt.hasEagerState?gt.eagerState:x(B,gt.action);else{var cr={lane:It,action:gt.action,hasEagerState:gt.hasEagerState,eagerState:gt.eagerState,next:null};ze===null?(Te=ze=cr,me=B):ze=ze.next=cr,ln.lanes|=It,Cl|=It}gt=gt.next}while(gt!==null&&gt!==ee);ze===null?me=B:ze.next=Te,hs(B,b.memoizedState)||(Vn=!0),b.memoizedState=B,b.baseState=me,b.baseQueue=ze,M.lastRenderedState=B}if(x=M.interleaved,x!==null){q=x;do ee=q.lane,ln.lanes|=ee,Cl|=ee,q=q.next;while(q!==x)}else q===null&&(M.lanes=0);return[b.memoizedState,M.dispatch]}function gl(x){var b=wi(),M=b.queue;if(M===null)throw Error(s(311));M.lastRenderedReducer=x;var B=M.dispatch,q=M.pending,ee=b.memoizedState;if(q!==null){M.pending=null;var me=q=q.next;do ee=x(ee,me.action),me=me.next;while(me!==q);hs(ee,b.memoizedState)||(Vn=!0),b.memoizedState=ee,b.baseQueue===null&&(b.baseState=ee),M.lastRenderedState=ee}return[ee,B]}function kf(){}function vs(x,b){var M=ln,B=wi(),q=b(),ee=!hs(B.memoizedState,q);if(ee&&(B.memoizedState=q,Vn=!0),B=B.queue,Vu(vl.bind(null,M,B,x),[x]),B.getSnapshot!==b||ee||Un!==null&&Un.memoizedState.tag&1){if(M.flags|=2048,Ro(9,Fc.bind(null,M,B,q,b),void 0,null),cn===null)throw Error(s(349));(Mo&30)!==0||jc(M,b,q)}return q}function jc(x,b,M){x.flags|=16384,x={getSnapshot:b,value:M},b=ln.updateQueue,b===null?(b={lastEffect:null,stores:null},ln.updateQueue=b,b.stores=[x]):(M=b.stores,M===null?b.stores=[x]:M.push(x))}function Fc(x,b,M,B){b.value=M,b.getSnapshot=B,_f(b)&&Ja(x)}function vl(x,b,M){return M(function(){_f(b)&&Ja(x)})}function _f(x){var b=x.getSnapshot;x=x.value;try{var M=b();return!hs(x,M)}catch{return!0}}function Ja(x){var b=Za(x,1);b!==null&&sa(b,x,1,-1)}function Lo(x){var b=bi();return typeof x=="function"&&(x=x()),b.memoizedState=b.baseState=x,x={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Qa,lastRenderedState:x},b.queue=x,x=x.dispatch=ce.bind(null,ln,x),[b.memoizedState,x]}function Ro(x,b,M,B){return x={tag:x,create:b,destroy:M,deps:B,next:null},b=ln.updateQueue,b===null?(b={lastEffect:null,stores:null},ln.updateQueue=b,b.lastEffect=x.next=x):(M=b.lastEffect,M===null?b.lastEffect=x.next=x:(B=M.next,M.next=x,x.next=B,b.lastEffect=x)),x}function Cf(){return wi().memoizedState}function Bc(x,b,M,B){var q=bi();ln.flags|=x,q.memoizedState=Ro(1|b,M,void 0,B===void 0?null:B)}function uo(x,b,M,B){var q=wi();B=B===void 0?null:B;var ee=void 0;if(zn!==null){var me=zn.memoizedState;if(ee=me.destroy,B!==null&&ml(B,me.deps)){q.memoizedState=Ro(b,M,ee,B);return}}ln.flags|=x,q.memoizedState=Ro(1|b,M,ee,B)}function Ef(x,b){return Bc(8390656,8,x,b)}function Vu(x,b){return uo(2048,8,x,b)}function zc(x,b){return uo(4,2,x,b)}function Yr(x,b){return uo(4,4,x,b)}function Uc(x,b){if(typeof b=="function")return x=x(),b(x),function(){b(null)};if(b!=null)return x=x(),b.current=x,function(){b.current=null}}function iu(x,b,M){return M=M!=null?M.concat([x]):null,uo(4,4,Uc.bind(null,b,x),M)}function Oo(){}function Tf(x,b){var M=wi();b=b===void 0?null:b;var B=M.memoizedState;return B!==null&&b!==null&&ml(b,B[1])?B[0]:(M.memoizedState=[x,b],x)}function h(x,b){var M=wi();b=b===void 0?null:b;var B=M.memoizedState;return B!==null&&b!==null&&ml(b,B[1])?B[0]:(x=x(),M.memoizedState=[x,b],x)}function k(x,b,M){return(Mo&21)===0?(x.baseState&&(x.baseState=!1,Vn=!0),x.memoizedState=M):(hs(M,b)||(M=Vl(),ln.lanes|=M,Cl|=M,x.baseState=!0),b)}function P(x,b){var M=Sr;Sr=M!==0&&4>M?M:4,x(!0);var B=Bs.transition;Bs.transition={};try{x(!1),b()}finally{Sr=M,Bs.transition=B}}function V(){return wi().memoizedState}function J(x,b,M){var B=ki(x);if(M={lane:B,action:M,hasEagerState:!1,eagerState:null,next:null},we(x))Le(b,M);else if(M=fl(x,b,M,B),M!==null){var q=xn();sa(M,x,B,q),je(M,b,B)}}function ce(x,b,M){var B=ki(x),q={lane:B,action:M,hasEagerState:!1,eagerState:null,next:null};if(we(x))Le(b,q);else{var ee=x.alternate;if(x.lanes===0&&(ee===null||ee.lanes===0)&&(ee=b.lastRenderedReducer,ee!==null))try{var me=b.lastRenderedState,Te=ee(me,M);if(q.hasEagerState=!0,q.eagerState=Te,hs(Te,me)){var ze=b.interleaved;ze===null?(q.next=q,Oc(b)):(q.next=ze.next,ze.next=q),b.interleaved=q;return}}catch{}M=fl(x,b,q,B),M!==null&&(q=xn(),sa(M,x,B,q),je(M,b,B))}}function we(x){var b=x.alternate;return x===ln||b!==null&&b===ln}function Le(x,b){ra=tu=!0;var M=x.pending;M===null?b.next=b:(b.next=M.next,M.next=b),x.pending=b}function je(x,b,M){if((M&4194240)!==0){var B=b.lanes;B&=x.pendingLanes,M|=B,b.lanes=M,$a(x,M)}}var Xe={readContext:_a,useCallback:Ln,useContext:Ln,useEffect:Ln,useImperativeHandle:Ln,useInsertionEffect:Ln,useLayoutEffect:Ln,useMemo:Ln,useReducer:Ln,useRef:Ln,useState:Ln,useDebugValue:Ln,useDeferredValue:Ln,useTransition:Ln,useMutableSource:Ln,useSyncExternalStore:Ln,useId:Ln,unstable_isNewReconciler:!1},Nt={readContext:_a,useCallback:function(x,b){return bi().memoizedState=[x,b===void 0?null:b],x},useContext:_a,useEffect:Ef,useImperativeHandle:function(x,b,M){return M=M!=null?M.concat([x]):null,Bc(4194308,4,Uc.bind(null,b,x),M)},useLayoutEffect:function(x,b){return Bc(4194308,4,x,b)},useInsertionEffect:function(x,b){return Bc(4,2,x,b)},useMemo:function(x,b){var M=bi();return b=b===void 0?null:b,x=x(),M.memoizedState=[x,b],x},useReducer:function(x,b,M){var B=bi();return b=M!==void 0?M(b):b,B.memoizedState=B.baseState=b,x={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:x,lastRenderedState:b},B.queue=x,x=x.dispatch=J.bind(null,ln,x),[B.memoizedState,x]},useRef:function(x){var b=bi();return x={current:x},b.memoizedState=x},useState:Lo,useDebugValue:Oo,useDeferredValue:function(x){return bi().memoizedState=x},useTransition:function(){var x=Lo(!1),b=x[0];return x=P.bind(null,x[1]),bi().memoizedState=x,[b,x]},useMutableSource:function(){},useSyncExternalStore:function(x,b,M){var B=ln,q=bi();if(tn){if(M===void 0)throw Error(s(407));M=M()}else{if(M=b(),cn===null)throw Error(s(349));(Mo&30)!==0||jc(B,b,M)}q.memoizedState=M;var ee={value:M,getSnapshot:b};return q.queue=ee,Ef(vl.bind(null,B,ee,x),[x]),B.flags|=2048,Ro(9,Fc.bind(null,B,ee,M,b),void 0,null),M},useId:function(){var x=bi(),b=cn.identifierPrefix;if(tn){var M=ps,B=Xi;M=(B&~(1<<32-rr(B)-1)).toString(32)+M,b=":"+b+"R"+M,M=Ao++,0<M&&(b+="H"+M.toString(32)),b+=":"}else M=ru++,b=":"+b+"r"+M.toString(32)+":";return x.memoizedState=b},unstable_isNewReconciler:!1},Xt={readContext:_a,useCallback:Tf,useContext:_a,useEffect:Vu,useImperativeHandle:iu,useInsertionEffect:zc,useLayoutEffect:Yr,useMemo:h,useReducer:Gu,useRef:Cf,useState:function(){return Gu(Qa)},useDebugValue:Oo,useDeferredValue:function(x){var b=wi();return k(b,zn.memoizedState,x)},useTransition:function(){var x=Gu(Qa)[0],b=wi().memoizedState;return[x,b]},useMutableSource:kf,useSyncExternalStore:vs,useId:V,unstable_isNewReconciler:!1},hr={readContext:_a,useCallback:Tf,useContext:_a,useEffect:Vu,useImperativeHandle:iu,useInsertionEffect:zc,useLayoutEffect:Yr,useMemo:h,useReducer:gl,useRef:Cf,useState:function(){return gl(Qa)},useDebugValue:Oo,useDeferredValue:function(x){var b=wi();return zn===null?b.memoizedState=x:k(b,zn.memoizedState,x)},useTransition:function(){var x=gl(Qa)[0],b=wi().memoizedState;return[x,b]},useMutableSource:kf,useSyncExternalStore:vs,useId:V,unstable_isNewReconciler:!1};function Xr(x,b){if(x&&x.defaultProps){b=a({},b),x=x.defaultProps;for(var M in x)b[M]===void 0&&(b[M]=x[M]);return b}return b}function Gn(x,b,M,B){b=x.memoizedState,M=M(B,b),M=M==null?b:a({},b,M),x.memoizedState=M,x.lanes===0&&(x.updateQueue.baseState=M)}var Ai={isMounted:function(x){return(x=x._reactInternals)?F(x)===x:!1},enqueueSetState:function(x,b,M){x=x._reactInternals;var B=xn(),q=ki(x),ee=Ya(B,q);ee.payload=b,M!=null&&(ee.callback=M),b=lo(x,ee,q),b!==null&&(sa(b,x,q,B),hl(b,x,q))},enqueueReplaceState:function(x,b,M){x=x._reactInternals;var B=xn(),q=ki(x),ee=Ya(B,q);ee.tag=1,ee.payload=b,M!=null&&(ee.callback=M),b=lo(x,ee,q),b!==null&&(sa(b,x,q,B),hl(b,x,q))},enqueueForceUpdate:function(x,b){x=x._reactInternals;var M=xn(),B=ki(x),q=Ya(M,B);q.tag=2,b!=null&&(q.callback=b),b=lo(x,q,B),b!==null&&(sa(b,x,B,M),hl(b,x,B))}};function zi(x,b,M,B,q,ee,me){return x=x.stateNode,typeof x.shouldComponentUpdate=="function"?x.shouldComponentUpdate(B,ee,me):b.prototype&&b.prototype.isPureReactComponent?!Is(M,B)||!Is(q,ee):!0}function yl(x,b,M){var B=!1,q=Dt,ee=b.contextType;return typeof ee=="object"&&ee!==null?ee=_a(ee):(q=zt(b)?Br:Pr.current,B=b.contextTypes,ee=(B=B!=null)?vi(x,q):Dt),b=new b(M,ee),x.memoizedState=b.state!==null&&b.state!==void 0?b.state:null,b.updater=Ai,x.stateNode=b,b._reactInternals=x,B&&(x=x.stateNode,x.__reactInternalMemoizedUnmaskedChildContext=q,x.__reactInternalMemoizedMaskedChildContext=ee),b}function Gc(x,b,M,B){x=b.state,typeof b.componentWillReceiveProps=="function"&&b.componentWillReceiveProps(M,B),typeof b.UNSAFE_componentWillReceiveProps=="function"&&b.UNSAFE_componentWillReceiveProps(M,B),b.state!==x&&Ai.enqueueReplaceState(b,b.state,null)}function zs(x,b,M,B){var q=x.stateNode;q.props=M,q.state=x.memoizedState,q.refs={},Sf(x);var ee=b.contextType;typeof ee=="object"&&ee!==null?q.context=_a(ee):(ee=zt(b)?Br:Pr.current,q.context=vi(x,ee)),q.state=x.memoizedState,ee=b.getDerivedStateFromProps,typeof ee=="function"&&(Gn(x,b,ee,M),q.state=x.memoizedState),typeof b.getDerivedStateFromProps=="function"||typeof q.getSnapshotBeforeUpdate=="function"||typeof q.UNSAFE_componentWillMount!="function"&&typeof q.componentWillMount!="function"||(b=q.state,typeof q.componentWillMount=="function"&&q.componentWillMount(),typeof q.UNSAFE_componentWillMount=="function"&&q.UNSAFE_componentWillMount(),b!==q.state&&Ai.enqueueReplaceState(q,q.state,null),Mi(x,M,q,B),q.state=x.memoizedState),typeof q.componentDidMount=="function"&&(x.flags|=4194308)}function xl(x,b){try{var M="",B=b;do M+=xm(B),B=B.return;while(B);var q=M}catch(ee){q=`
Error generating stack: `+ee.message+`
`+ee.stack}return{value:x,source:b,stack:q,digest:null}}function co(x,b,M){return{value:x,source:null,stack:M??null,digest:b??null}}function es(x,b){try{console.error(b.value)}catch(M){setTimeout(function(){throw M})}}var au=typeof WeakMap=="function"?WeakMap:Map;function Gr(x,b,M){M=Ya(-1,M),M.tag=3,M.payload={element:null};var B=b.value;return M.callback=function(){Wn||(Wn=!0,oi=B),es(x,b)},M}function bl(x,b,M){M=Ya(-1,M),M.tag=3;var B=x.type.getDerivedStateFromError;if(typeof B=="function"){var q=b.value;M.payload=function(){return B(q)},M.callback=function(){es(x,b)}}var ee=x.stateNode;return ee!==null&&typeof ee.componentDidCatch=="function"&&(M.callback=function(){es(x,b),typeof B!="function"&&(ho===null?ho=new Set([this]):ho.add(this));var me=b.stack;this.componentDidCatch(b.value,{componentStack:me!==null?me:""})}),M}function Fh(x,b,M){var B=x.pingCache;if(B===null){B=x.pingCache=new au;var q=new Set;B.set(b,q)}else q=B.get(b),q===void 0&&(q=new Set,B.set(b,q));q.has(M)||(q.add(M),x=T0.bind(null,x,b,M),b.then(x,x))}function Bh(x){do{var b;if((b=x.tag===13)&&(b=x.memoizedState,b=b!==null?b.dehydrated!==null:!0),b)return x;x=x.return}while(x!==null);return null}function Do(x,b,M,B,q){return(x.mode&1)===0?(x===b?x.flags|=65536:(x.flags|=128,M.flags|=131072,M.flags&=-52805,M.tag===1&&(M.alternate===null?M.tag=17:(b=Ya(-1,1),b.tag=2,lo(M,b,1))),M.lanes|=1),x):(x.flags|=65536,x.lanes=q,x)}var wl=o.ReactCurrentOwner,Vn=!1;function si(x,b,M,B){b.child=x===null?Ac(b,null,M,B):cl(b,x.child,M,B)}function zh(x,b,M,B,q){M=M.render;var ee=b.ref;return Ji(b,q),B=nu(x,b,M,B,ee,q),M=Ic(),x!==null&&!Vn?(b.updateQueue=x.updateQueue,b.flags&=-2053,x.lanes&=~q,kl(x,b,q)):(tn&&M&&Qi(b),b.flags|=1,si(x,b,B,q),b.child)}function Hu(x,b,M,B,q){if(x===null){var ee=M.type;return typeof ee=="function"&&!nd(ee)&&ee.defaultProps===void 0&&M.compare===null&&M.defaultProps===void 0?(b.tag=15,b.type=ee,Sl(x,b,ee,B,q)):(x=rp(M.type,null,B,b,b.mode,q),x.ref=b.ref,x.return=b,b.child=x)}if(ee=x.child,(x.lanes&q)===0){var me=ee.memoizedProps;if(M=M.compare,M=M!==null?M:Is,M(me,B)&&x.ref===b.ref)return kl(x,b,q)}return b.flags|=1,x=mu(ee,B),x.ref=b.ref,x.return=b,b.child=x}function Sl(x,b,M,B,q){if(x!==null){var ee=x.memoizedProps;if(Is(ee,B)&&x.ref===b.ref)if(Vn=!1,b.pendingProps=B=ee,(x.lanes&q)!==0)(x.flags&131072)!==0&&(Vn=!0);else return b.lanes=x.lanes,kl(x,b,q)}return Io(x,b,M,B,q)}function pn(x,b,M){var B=b.pendingProps,q=B.children,ee=x!==null?x.memoizedState:null;if(B.mode==="hidden")if((b.mode&1)===0)b.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ze(du,Si),Si|=M;else{if((M&1073741824)===0)return x=ee!==null?ee.baseLanes|M:M,b.lanes=b.childLanes=1073741824,b.memoizedState={baseLanes:x,cachePool:null,transitions:null},b.updateQueue=null,Ze(du,Si),Si|=x,null;b.memoizedState={baseLanes:0,cachePool:null,transitions:null},B=ee!==null?ee.baseLanes:M,Ze(du,Si),Si|=B}else ee!==null?(B=ee.baseLanes|M,b.memoizedState=null):B=M,Ze(du,Si),Si|=B;return si(x,b,q,M),b.child}function un(x,b){var M=b.ref;(x===null&&M!==null||x!==null&&x.ref!==M)&&(b.flags|=512,b.flags|=2097152)}function Io(x,b,M,B,q){var ee=zt(M)?Br:Pr.current;return ee=vi(b,ee),Ji(b,q),M=nu(x,b,M,B,ee,q),B=Ic(),x!==null&&!Vn?(b.updateQueue=x.updateQueue,b.flags&=-2053,x.lanes&=~q,kl(x,b,q)):(tn&&B&&Qi(b),b.flags|=1,si(x,b,M,q),b.child)}function Ui(x,b,M,B,q){if(zt(M)){var ee=!0;nr(b)}else ee=!1;if(Ji(b,q),b.stateNode===null)Nf(x,b),yl(b,M,B),zs(b,M,B,q),B=!0;else if(x===null){var me=b.stateNode,Te=b.memoizedProps;me.props=Te;var ze=me.context,gt=M.contextType;typeof gt=="object"&&gt!==null?gt=_a(gt):(gt=zt(M)?Br:Pr.current,gt=vi(b,gt));var It=M.getDerivedStateFromProps,cr=typeof It=="function"||typeof me.getSnapshotBeforeUpdate=="function";cr||typeof me.UNSAFE_componentWillReceiveProps!="function"&&typeof me.componentWillReceiveProps!="function"||(Te!==B||ze!==gt)&&Gc(b,me,B,gt),Pi=!1;var Mt=b.memoizedState;me.state=Mt,Mi(b,B,me,q),ze=b.memoizedState,Te!==B||Mt!==ze||Mr.current||Pi?(typeof It=="function"&&(Gn(b,M,It,B),ze=b.memoizedState),(Te=Pi||zi(b,M,Te,B,Mt,ze,gt))?(cr||typeof me.UNSAFE_componentWillMount!="function"&&typeof me.componentWillMount!="function"||(typeof me.componentWillMount=="function"&&me.componentWillMount(),typeof me.UNSAFE_componentWillMount=="function"&&me.UNSAFE_componentWillMount()),typeof me.componentDidMount=="function"&&(b.flags|=4194308)):(typeof me.componentDidMount=="function"&&(b.flags|=4194308),b.memoizedProps=B,b.memoizedState=ze),me.props=B,me.state=ze,me.context=gt,B=Te):(typeof me.componentDidMount=="function"&&(b.flags|=4194308),B=!1)}else{me=b.stateNode,oo(x,b),Te=b.memoizedProps,gt=b.type===b.elementType?Te:Xr(b.type,Te),me.props=gt,cr=b.pendingProps,Mt=me.context,ze=M.contextType,typeof ze=="object"&&ze!==null?ze=_a(ze):(ze=zt(M)?Br:Pr.current,ze=vi(b,ze));var gn=M.getDerivedStateFromProps;(It=typeof gn=="function"||typeof me.getSnapshotBeforeUpdate=="function")||typeof me.UNSAFE_componentWillReceiveProps!="function"&&typeof me.componentWillReceiveProps!="function"||(Te!==cr||Mt!==ze)&&Gc(b,me,B,ze),Pi=!1,Mt=b.memoizedState,me.state=Mt,Mi(b,B,me,q);var Jr=b.memoizedState;Te!==cr||Mt!==Jr||Mr.current||Pi?(typeof gn=="function"&&(Gn(b,M,gn,B),Jr=b.memoizedState),(gt=Pi||zi(b,M,gt,B,Mt,Jr,ze)||!1)?(It||typeof me.UNSAFE_componentWillUpdate!="function"&&typeof me.componentWillUpdate!="function"||(typeof me.componentWillUpdate=="function"&&me.componentWillUpdate(B,Jr,ze),typeof me.UNSAFE_componentWillUpdate=="function"&&me.UNSAFE_componentWillUpdate(B,Jr,ze)),typeof me.componentDidUpdate=="function"&&(b.flags|=4),typeof me.getSnapshotBeforeUpdate=="function"&&(b.flags|=1024)):(typeof me.componentDidUpdate!="function"||Te===x.memoizedProps&&Mt===x.memoizedState||(b.flags|=4),typeof me.getSnapshotBeforeUpdate!="function"||Te===x.memoizedProps&&Mt===x.memoizedState||(b.flags|=1024),b.memoizedProps=B,b.memoizedState=Jr),me.props=B,me.state=Jr,me.context=ze,B=gt):(typeof me.componentDidUpdate!="function"||Te===x.memoizedProps&&Mt===x.memoizedState||(b.flags|=4),typeof me.getSnapshotBeforeUpdate!="function"||Te===x.memoizedProps&&Mt===x.memoizedState||(b.flags|=1024),B=!1)}return na(x,b,M,B,ee,q)}function na(x,b,M,B,q,ee){un(x,b);var me=(b.flags&128)!==0;if(!B&&!me)return q&&Rr(b,M,!1),kl(x,b,ee);B=b.stateNode,wl.current=b;var Te=me&&typeof M.getDerivedStateFromError!="function"?null:B.render();return b.flags|=1,x!==null&&me?(b.child=cl(b,x.child,null,ee),b.child=cl(b,null,Te,ee)):si(x,b,Te,ee),b.memoizedState=B.state,q&&Rr(b,M,!0),b.child}function su(x){var b=x.stateNode;b.pendingContext?al(x,b.pendingContext,b.pendingContext!==b.context):b.context&&al(x,b.context,!1),Jl(x,b.containerInfo)}function Wu(x,b,M,B,q){return Po(),Pc(q),b.flags|=256,si(x,b,M,B),b.child}var ia={dehydrated:null,treeContext:null,retryLane:0};function Vc(x){return{baseLanes:x,cachePool:null,transitions:null}}function bm(x,b,M){var B=b.pendingProps,q=qr.current,ee=!1,me=(b.flags&128)!==0,Te;if((Te=me)||(Te=x!==null&&x.memoizedState===null?!1:(q&2)!==0),Te?(ee=!0,b.flags&=-129):(x===null||x.memoizedState!==null)&&(q|=1),Ze(qr,q&1),x===null)return yf(b),x=b.memoizedState,x!==null&&(x=x.dehydrated,x!==null)?((b.mode&1)===0?b.lanes=1:xr(x)?b.lanes=8:b.lanes=1073741824,null):(me=B.children,x=B.fallback,ee?(B=b.mode,ee=b.child,me={mode:"hidden",children:me},(B&1)===0&&ee!==null?(ee.childLanes=0,ee.pendingProps=me):ee=ad(me,B,0,null),x=Gi(x,B,M,null),ee.return=b,x.return=b,ee.sibling=x,b.child=ee,b.child.memoizedState=Vc(M),b.memoizedState=ia,x):Uh(b,me));if(q=x.memoizedState,q!==null&&(Te=q.dehydrated,Te!==null))return w0(x,b,me,B,Te,q,M);if(ee){ee=B.fallback,me=b.mode,q=x.child,Te=q.sibling;var ze={mode:"hidden",children:B.children};return(me&1)===0&&b.child!==q?(B=b.child,B.childLanes=0,B.pendingProps=ze,b.deletions=null):(B=mu(q,ze),B.subtreeFlags=q.subtreeFlags&14680064),Te!==null?ee=mu(Te,ee):(ee=Gi(ee,me,M,null),ee.flags|=2),ee.return=b,B.return=b,B.sibling=ee,b.child=B,B=ee,ee=b.child,me=x.child.memoizedState,me=me===null?Vc(M):{baseLanes:me.baseLanes|M,cachePool:null,transitions:me.transitions},ee.memoizedState=me,ee.childLanes=x.childLanes&~M,b.memoizedState=ia,B}return ee=x.child,x=ee.sibling,B=mu(ee,{mode:"visible",children:B.children}),(b.mode&1)===0&&(B.lanes=M),B.return=b,B.sibling=null,x!==null&&(M=b.deletions,M===null?(b.deletions=[x],b.flags|=16):M.push(x)),b.child=B,b.memoizedState=null,B}function Uh(x,b){return b=ad({mode:"visible",children:b},x.mode,0,null),b.return=x,x.child=b}function qu(x,b,M,B){return B!==null&&Pc(B),cl(b,x.child,null,M),x=Uh(b,b.pendingProps.children),x.flags|=2,b.memoizedState=null,x}function w0(x,b,M,B,q,ee,me){if(M)return b.flags&256?(b.flags&=-257,B=co(Error(s(422))),qu(x,b,me,B)):b.memoizedState!==null?(b.child=x.child,b.flags|=128,null):(ee=B.fallback,q=b.mode,B=ad({mode:"visible",children:B.children},q,0,null),ee=Gi(ee,q,me,null),ee.flags|=2,B.return=b,ee.return=b,B.sibling=ee,b.child=B,(b.mode&1)!==0&&cl(b,x.child,null,me),b.child.memoizedState=Vc(me),b.memoizedState=ia,ee);if((b.mode&1)===0)return qu(x,b,me,null);if(xr(q))return B=Tt(q).digest,ee=Error(s(419)),B=co(ee,B,void 0),qu(x,b,me,B);if(M=(me&x.childLanes)!==0,Vn||M){if(B=cn,B!==null){switch(me&-me){case 4:q=2;break;case 16:q=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:q=32;break;case 536870912:q=268435456;break;default:q=0}q=(q&(B.suspendedLanes|me))!==0?0:q,q!==0&&q!==ee.retryLane&&(ee.retryLane=q,Za(x,q),sa(B,x,q,-1))}return rd(),B=co(Error(s(421))),qu(x,b,me,B)}return fn(q)?(b.flags|=128,b.child=x.child,b=P0.bind(null,x),Ur(q,b),null):(x=ee.treeContext,Se&&(_n=As(q),ai=b,tn=!0,ka=null,Kl=!1,x!==null&&(xi[wa++]=Xi,xi[wa++]=ps,xi[wa++]=Bn,Xi=x.id,ps=x.overflow,Bn=b)),b=Uh(b,B.children),b.flags|=4096,b)}function jo(x,b,M){x.lanes|=b;var B=x.alternate;B!==null&&(B.lanes|=b),dl(x.return,b,M)}function Hc(x,b,M,B,q){var ee=x.memoizedState;ee===null?x.memoizedState={isBackwards:b,rendering:null,renderingStartTime:0,last:B,tail:M,tailMode:q}:(ee.isBackwards=b,ee.rendering=null,ee.renderingStartTime=0,ee.last=B,ee.tail=M,ee.tailMode=q)}function Gh(x,b,M){var B=b.pendingProps,q=B.revealOrder,ee=B.tail;if(si(x,b,B.children,M),B=qr.current,(B&2)!==0)B=B&1|2,b.flags|=128;else{if(x!==null&&(x.flags&128)!==0)e:for(x=b.child;x!==null;){if(x.tag===13)x.memoizedState!==null&&jo(x,M,b);else if(x.tag===19)jo(x,M,b);else if(x.child!==null){x.child.return=x,x=x.child;continue}if(x===b)break e;for(;x.sibling===null;){if(x.return===null||x.return===b)break e;x=x.return}x.sibling.return=x.return,x=x.sibling}B&=1}if(Ze(qr,B),(b.mode&1)===0)b.memoizedState=null;else switch(q){case"forwards":for(M=b.child,q=null;M!==null;)x=M.alternate,x!==null&&pl(x)===null&&(q=M),M=M.sibling;M=q,M===null?(q=b.child,b.child=null):(q=M.sibling,M.sibling=null),Hc(b,!1,q,M,ee);break;case"backwards":for(M=null,q=b.child,b.child=null;q!==null;){if(x=q.alternate,x!==null&&pl(x)===null){b.child=q;break}x=q.sibling,q.sibling=M,M=q,q=x}Hc(b,!0,M,null,ee);break;case"together":Hc(b,!1,null,null,void 0);break;default:b.memoizedState=null}return b.child}function Nf(x,b){(b.mode&1)===0&&x!==null&&(x.alternate=null,b.alternate=null,b.flags|=2)}function kl(x,b,M){if(x!==null&&(b.dependencies=x.dependencies),Cl|=b.lanes,(M&b.childLanes)===0)return null;if(x!==null&&b.child!==x.child)throw Error(s(153));if(b.child!==null){for(x=b.child,M=mu(x,x.pendingProps),b.child=M,M.return=b;x.sibling!==null;)x=x.sibling,M=M.sibling=mu(x,x.pendingProps),M.return=b;M.sibling=null}return b.child}function ou(x,b,M){switch(b.tag){case 3:su(b),Po();break;case 5:zu(b);break;case 1:zt(b.type)&&nr(b);break;case 4:Jl(b,b.stateNode.containerInfo);break;case 10:Ka(b,b.type._context,b.memoizedProps.value);break;case 13:var B=b.memoizedState;if(B!==null)return B.dehydrated!==null?(Ze(qr,qr.current&1),b.flags|=128,null):(M&b.child.childLanes)!==0?bm(x,b,M):(Ze(qr,qr.current&1),x=kl(x,b,M),x!==null?x.sibling:null);Ze(qr,qr.current&1);break;case 19:if(B=(M&b.childLanes)!==0,(x.flags&128)!==0){if(B)return Gh(x,b,M);b.flags|=128}var q=b.memoizedState;if(q!==null&&(q.rendering=null,q.tail=null,q.lastEffect=null),Ze(qr,qr.current),B)break;return null;case 22:case 23:return b.lanes=0,pn(x,b,M)}return kl(x,b,M)}function Na(x){x.flags|=4}function $u(x,b){if(x!==null&&x.child===b.child)return!0;if((b.flags&16)!==0)return!1;for(x=b.child;x!==null;){if((x.flags&12854)!==0||(x.subtreeFlags&12854)!==0)return!1;x=x.sibling}return!0}var lu,uu,Pa,Ma;if(ue)lu=function(x,b){for(var M=b.child;M!==null;){if(M.tag===5||M.tag===6)re(x,M.stateNode);else if(M.tag!==4&&M.child!==null){M.child.return=M,M=M.child;continue}if(M===b)break;for(;M.sibling===null;){if(M.return===null||M.return===b)return;M=M.return}M.sibling.return=M.return,M=M.sibling}},uu=function(){},Pa=function(x,b,M,B,q){if(x=x.memoizedProps,x!==B){var ee=b.stateNode,me=Ta(Xa.current);M=oe(ee,M,x,B,q,me),(b.updateQueue=M)&&Na(b)}},Ma=function(x,b,M,B){M!==B&&Na(b)};else if(xe){lu=function(x,b,M,B){for(var q=b.child;q!==null;){if(q.tag===5){var ee=q.stateNode;M&&B&&(ee=er(ee,q.type,q.memoizedProps,q)),re(x,ee)}else if(q.tag===6)ee=q.stateNode,M&&B&&(ee=gr(ee,q.memoizedProps,q)),re(x,ee);else if(q.tag!==4){if(q.tag===22&&q.memoizedState!==null)ee=q.child,ee!==null&&(ee.return=q),lu(x,q,!0,!0);else if(q.child!==null){q.child.return=q,q=q.child;continue}}if(q===b)break;for(;q.sibling===null;){if(q.return===null||q.return===b)return;q=q.return}q.sibling.return=q.return,q=q.sibling}};var cu=function(x,b,M,B){for(var q=b.child;q!==null;){if(q.tag===5){var ee=q.stateNode;M&&B&&(ee=er(ee,q.type,q.memoizedProps,q)),Ve(x,ee)}else if(q.tag===6)ee=q.stateNode,M&&B&&(ee=gr(ee,q.memoizedProps,q)),Ve(x,ee);else if(q.tag!==4){if(q.tag===22&&q.memoizedState!==null)ee=q.child,ee!==null&&(ee.return=q),cu(x,q,!0,!0);else if(q.child!==null){q.child.return=q,q=q.child;continue}}if(q===b)break;for(;q.sibling===null;){if(q.return===null||q.return===b)return;q=q.return}q.sibling.return=q.return,q=q.sibling}};uu=function(x,b){var M=b.stateNode;if(!$u(x,b)){x=M.containerInfo;var B=Wt(x);cu(B,b,!1,!1),M.pendingChildren=B,Na(b),vt(x,B)}},Pa=function(x,b,M,B,q){var ee=x.stateNode,me=x.memoizedProps;if((x=$u(x,b))&&me===B)b.stateNode=ee;else{var Te=b.stateNode,ze=Ta(Xa.current),gt=null;me!==B&&(gt=oe(Te,M,me,B,q,ze)),x&&gt===null?b.stateNode=ee:(ee=Kt(ee,gt,M,me,B,b,x,Te),fe(ee,M,B,q,ze)&&Na(b),b.stateNode=ee,x?Na(b):lu(ee,b,!1,!1))}},Ma=function(x,b,M,B){M!==B?(x=Ta(gs.current),M=Ta(Xa.current),b.stateNode=he(B,x,M,b),Na(b)):b.stateNode=x.stateNode}}else uu=function(){},Pa=function(){},Ma=function(){};function ys(x,b){if(!tn)switch(x.tailMode){case"hidden":b=x.tail;for(var M=null;b!==null;)b.alternate!==null&&(M=b),b=b.sibling;M===null?x.tail=null:M.sibling=null;break;case"collapsed":M=x.tail;for(var B=null;M!==null;)M.alternate!==null&&(B=M),M=M.sibling;B===null?b||x.tail===null?x.tail=null:x.tail.sibling=null:B.sibling=null}}function Cn(x){var b=x.alternate!==null&&x.alternate.child===x.child,M=0,B=0;if(b)for(var q=x.child;q!==null;)M|=q.lanes|q.childLanes,B|=q.subtreeFlags&14680064,B|=q.flags&14680064,q.return=x,q=q.sibling;else for(q=x.child;q!==null;)M|=q.lanes|q.childLanes,B|=q.subtreeFlags,B|=q.flags,q.return=x,q=q.sibling;return x.subtreeFlags|=B,x.childLanes=M,b}function Ku(x,b,M){var B=b.pendingProps;switch(Fu(b),b.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Cn(b),null;case 1:return zt(b.type)&&jr(),Cn(b),null;case 3:return M=b.stateNode,Fs(),ht(Mr),ht(Pr),Dc(),M.pendingContext&&(M.context=M.pendingContext,M.pendingContext=null),(x===null||x.child===null)&&(Zl(b)?Na(b):x===null||x.memoizedState.isDehydrated&&(b.flags&256)===0||(b.flags|=1024,ka!==null&&(ep(ka),ka=null))),uu(x,b),Cn(b),null;case 5:eu(b),M=Ta(gs.current);var q=b.type;if(x!==null&&b.stateNode!=null)Pa(x,b,q,B,M),x.ref!==b.ref&&(b.flags|=512,b.flags|=2097152);else{if(!B){if(b.stateNode===null)throw Error(s(166));return Cn(b),null}if(x=Ta(Xa.current),Zl(b)){if(!Se)throw Error(s(175));x=ni(b.stateNode,b.type,b.memoizedProps,M,x,b,!Kl),b.updateQueue=x,x!==null&&Na(b)}else{var ee=X(q,B,M,x,b);lu(ee,b,!1,!1),b.stateNode=ee,fe(ee,q,B,M,x)&&Na(b)}b.ref!==null&&(b.flags|=512,b.flags|=2097152)}return Cn(b),null;case 6:if(x&&b.stateNode!=null)Ma(x,b,x.memoizedProps,B);else{if(typeof B!="string"&&b.stateNode===null)throw Error(s(166));if(x=Ta(gs.current),M=Ta(Xa.current),Zl(b)){if(!Se)throw Error(s(176));if(x=b.stateNode,M=b.memoizedProps,(B=sn(x,M,b,!Kl))&&(q=ai,q!==null))switch(q.tag){case 3:_o(q.stateNode.containerInfo,x,M,(q.mode&1)!==0);break;case 5:on(q.type,q.memoizedProps,q.stateNode,x,M,(q.mode&1)!==0)}B&&Na(b)}else b.stateNode=he(B,x,M,b)}return Cn(b),null;case 13:if(ht(qr),B=b.memoizedState,x===null||x.memoizedState!==null&&x.memoizedState.dehydrated!==null){if(tn&&_n!==null&&(b.mode&1)!==0&&(b.flags&128)===0)Ih(),Po(),b.flags|=98560,q=!1;else if(q=Zl(b),B!==null&&B.dehydrated!==null){if(x===null){if(!q)throw Error(s(318));if(!Se)throw Error(s(344));if(q=b.memoizedState,q=q!==null?q.dehydrated:null,!q)throw Error(s(317));kn(q,b)}else Po(),(b.flags&128)===0&&(b.memoizedState=null),b.flags|=4;Cn(b),q=!1}else ka!==null&&(ep(ka),ka=null),q=!0;if(!q)return b.flags&65536?b:null}return(b.flags&128)!==0?(b.lanes=M,b):(M=B!==null,M!==(x!==null&&x.memoizedState!==null)&&M&&(b.child.flags|=8192,(b.mode&1)!==0&&(x===null||(qr.current&1)!==0?Tn===0&&(Tn=3):rd())),b.updateQueue!==null&&(b.flags|=4),Cn(b),null);case 4:return Fs(),uu(x,b),x===null&&Me(b.stateNode.containerInfo),Cn(b),null;case 10:return js(b.type._context),Cn(b),null;case 17:return zt(b.type)&&jr(),Cn(b),null;case 19:if(ht(qr),q=b.memoizedState,q===null)return Cn(b),null;if(B=(b.flags&128)!==0,ee=q.rendering,ee===null)if(B)ys(q,!1);else{if(Tn!==0||x!==null&&(x.flags&128)!==0)for(x=b.child;x!==null;){if(ee=pl(x),ee!==null){for(b.flags|=128,ys(q,!1),x=ee.updateQueue,x!==null&&(b.updateQueue=x,b.flags|=4),b.subtreeFlags=0,x=M,M=b.child;M!==null;)B=M,q=x,B.flags&=14680066,ee=B.alternate,ee===null?(B.childLanes=0,B.lanes=q,B.child=null,B.subtreeFlags=0,B.memoizedProps=null,B.memoizedState=null,B.updateQueue=null,B.dependencies=null,B.stateNode=null):(B.childLanes=ee.childLanes,B.lanes=ee.lanes,B.child=ee.child,B.subtreeFlags=0,B.deletions=null,B.memoizedProps=ee.memoizedProps,B.memoizedState=ee.memoizedState,B.updateQueue=ee.updateQueue,B.type=ee.type,q=ee.dependencies,B.dependencies=q===null?null:{lanes:q.lanes,firstContext:q.firstContext}),M=M.sibling;return Ze(qr,qr.current&1|2),b.child}x=x.sibling}q.tail!==null&&jn()>Df&&(b.flags|=128,B=!0,ys(q,!1),b.lanes=4194304)}else{if(!B)if(x=pl(ee),x!==null){if(b.flags|=128,B=!0,x=x.updateQueue,x!==null&&(b.updateQueue=x,b.flags|=4),ys(q,!0),q.tail===null&&q.tailMode==="hidden"&&!ee.alternate&&!tn)return Cn(b),null}else 2*jn()-q.renderingStartTime>Df&&M!==1073741824&&(b.flags|=128,B=!0,ys(q,!1),b.lanes=4194304);q.isBackwards?(ee.sibling=b.child,b.child=ee):(x=q.last,x!==null?x.sibling=ee:b.child=ee,q.last=ee)}return q.tail!==null?(b=q.tail,q.rendering=b,q.tail=b.sibling,q.renderingStartTime=jn(),b.sibling=null,x=qr.current,Ze(qr,B?x&1|2:x&1),b):(Cn(b),null);case 22:case 23:return tp(),M=b.memoizedState!==null,x!==null&&x.memoizedState!==null!==M&&(b.flags|=8192),M&&(b.mode&1)!==0?(Si&1073741824)!==0&&(Cn(b),ue&&b.subtreeFlags&6&&(b.flags|=8192)):Cn(b),null;case 24:return null;case 25:return null}throw Error(s(156,b.tag))}function S0(x,b){switch(Fu(b),b.tag){case 1:return zt(b.type)&&jr(),x=b.flags,x&65536?(b.flags=x&-65537|128,b):null;case 3:return Fs(),ht(Mr),ht(Pr),Dc(),x=b.flags,(x&65536)!==0&&(x&128)===0?(b.flags=x&-65537|128,b):null;case 5:return eu(b),null;case 13:if(ht(qr),x=b.memoizedState,x!==null&&x.dehydrated!==null){if(b.alternate===null)throw Error(s(340));Po()}return x=b.flags,x&65536?(b.flags=x&-65537|128,b):null;case 19:return ht(qr),null;case 4:return Fs(),null;case 10:return js(b.type._context),null;case 22:case 23:return tp(),null;case 24:return null;default:return null}}var Wc=!1,Li=!1,xs=typeof WeakSet=="function"?WeakSet:Set,kt=null;function Qr(x,b){var M=x.ref;if(M!==null)if(typeof M=="function")try{M(null)}catch(B){bn(x,b,B)}else M.current=null}function bs(x,b,M){try{M()}catch(B){bn(x,b,B)}}var wm=!1;function k0(x,b){for(ie(x.containerInfo),kt=b;kt!==null;)if(x=kt,b=x.child,(x.subtreeFlags&1028)!==0&&b!==null)b.return=x,kt=b;else for(;kt!==null;){x=kt;try{var M=x.alternate;if((x.flags&1024)!==0)switch(x.tag){case 0:case 11:case 15:break;case 1:if(M!==null){var B=M.memoizedProps,q=M.memoizedState,ee=x.stateNode,me=ee.getSnapshotBeforeUpdate(x.elementType===x.type?B:Xr(x.type,B),q);ee.__reactInternalSnapshotBeforeUpdate=me}break;case 3:ue&&pt(x.stateNode.containerInfo);break;case 5:case 6:case 4:case 17:break;default:throw Error(s(163))}}catch(Te){bn(x,x.return,Te)}if(b=x.sibling,b!==null){b.return=x.return,kt=b;break}kt=x.return}return M=wm,wm=!1,M}function Zu(x,b,M){var B=b.updateQueue;if(B=B!==null?B.lastEffect:null,B!==null){var q=B=B.next;do{if((q.tag&x)===x){var ee=q.destroy;q.destroy=void 0,ee!==void 0&&bs(b,M,ee)}q=q.next}while(q!==B)}}function qc(x,b){if(b=b.updateQueue,b=b!==null?b.lastEffect:null,b!==null){var M=b=b.next;do{if((M.tag&x)===x){var B=M.create;M.destroy=B()}M=M.next}while(M!==b)}}function Vh(x){var b=x.ref;if(b!==null){var M=x.stateNode;x.tag===5?x=K(M):x=M,typeof b=="function"?b(x):b.current=x}}function Pf(x){var b=x.alternate;b!==null&&(x.alternate=null,Pf(b)),x.child=null,x.deletions=null,x.sibling=null,x.tag===5&&(b=x.stateNode,b!==null&&rt(b)),x.stateNode=null,x.return=null,x.dependencies=null,x.memoizedProps=null,x.memoizedState=null,x.pendingProps=null,x.stateNode=null,x.updateQueue=null}function Sm(x){return x.tag===5||x.tag===3||x.tag===4}function Yu(x){e:for(;;){for(;x.sibling===null;){if(x.return===null||Sm(x.return))return null;x=x.return}for(x.sibling.return=x.return,x=x.sibling;x.tag!==5&&x.tag!==6&&x.tag!==18;){if(x.flags&2||x.child===null||x.tag===4)continue e;x.child.return=x,x=x.child}if(!(x.flags&2))return x.stateNode}}function Mf(x,b,M){var B=x.tag;if(B===5||B===6)x=x.stateNode,b?ge(M,x,b):St(M,x);else if(B!==4&&(x=x.child,x!==null))for(Mf(x,b,M),x=x.sibling;x!==null;)Mf(x,b,M),x=x.sibling}function km(x,b,M){var B=x.tag;if(B===5||B===6)x=x.stateNode,b?de(M,x,b):qe(M,x);else if(B!==4&&(x=x.child,x!==null))for(km(x,b,M),x=x.sibling;x!==null;)km(x,b,M),x=x.sibling}var ei=null,ts=!1;function fo(x,b,M){for(M=M.child;M!==null;)Hh(x,b,M),M=M.sibling}function Hh(x,b,M){if(Fn&&typeof Fn.onCommitFiberUnmount=="function")try{Fn.onCommitFiberUnmount(hn,M)}catch{}switch(M.tag){case 5:Li||Qr(M,b);case 6:if(ue){var B=ei,q=ts;ei=null,fo(x,b,M),ei=B,ts=q,ei!==null&&(ts?Ee(ei,M.stateNode):ke(ei,M.stateNode))}else fo(x,b,M);break;case 18:ue&&ei!==null&&(ts?qa(ei,M.stateNode):ko(ei,M.stateNode));break;case 4:ue?(B=ei,q=ts,ei=M.stateNode.containerInfo,ts=!0,fo(x,b,M),ei=B,ts=q):(xe&&(B=M.stateNode.containerInfo,q=Wt(B),Et(B,q)),fo(x,b,M));break;case 0:case 11:case 14:case 15:if(!Li&&(B=M.updateQueue,B!==null&&(B=B.lastEffect,B!==null))){q=B=B.next;do{var ee=q,me=ee.destroy;ee=ee.tag,me!==void 0&&((ee&2)!==0||(ee&4)!==0)&&bs(M,b,me),q=q.next}while(q!==B)}fo(x,b,M);break;case 1:if(!Li&&(Qr(M,b),B=M.stateNode,typeof B.componentWillUnmount=="function"))try{B.props=M.memoizedProps,B.state=M.memoizedState,B.componentWillUnmount()}catch(Te){bn(M,b,Te)}fo(x,b,M);break;case 21:fo(x,b,M);break;case 22:M.mode&1?(Li=(B=Li)||M.memoizedState!==null,fo(x,b,M),Li=B):fo(x,b,M);break;default:fo(x,b,M)}}function Xu(x){var b=x.updateQueue;if(b!==null){x.updateQueue=null;var M=x.stateNode;M===null&&(M=x.stateNode=new xs),b.forEach(function(B){var q=hb.bind(null,x,B);M.has(B)||(M.add(B),B.then(q,q))})}}function Us(x,b){var M=b.deletions;if(M!==null)for(var B=0;B<M.length;B++){var q=M[B];try{var ee=x,me=b;if(ue){var Te=me;e:for(;Te!==null;){switch(Te.tag){case 5:ei=Te.stateNode,ts=!1;break e;case 3:ei=Te.stateNode.containerInfo,ts=!0;break e;case 4:ei=Te.stateNode.containerInfo,ts=!0;break e}Te=Te.return}if(ei===null)throw Error(s(160));Hh(ee,me,q),ei=null,ts=!1}else Hh(ee,me,q);var ze=q.alternate;ze!==null&&(ze.return=null),q.return=null}catch(gt){bn(q,b,gt)}}if(b.subtreeFlags&12854)for(b=b.child;b!==null;)Af(b,x),b=b.sibling}function Af(x,b){var M=x.alternate,B=x.flags;switch(x.tag){case 0:case 11:case 14:case 15:if(Us(b,x),ws(x),B&4){try{Zu(3,x,x.return),qc(3,x)}catch(Mt){bn(x,x.return,Mt)}try{Zu(5,x,x.return)}catch(Mt){bn(x,x.return,Mt)}}break;case 1:Us(b,x),ws(x),B&512&&M!==null&&Qr(M,M.return);break;case 5:if(Us(b,x),ws(x),B&512&&M!==null&&Qr(M,M.return),ue){if(x.flags&32){var q=x.stateNode;try{Re(q)}catch(Mt){bn(x,x.return,Mt)}}if(B&4&&(q=x.stateNode,q!=null)){var ee=x.memoizedProps;if(M=M!==null?M.memoizedProps:ee,B=x.type,b=x.updateQueue,x.updateQueue=null,b!==null)try{Ie(q,b,B,M,ee,x)}catch(Mt){bn(x,x.return,Mt)}}}break;case 6:if(Us(b,x),ws(x),B&4&&ue){if(x.stateNode===null)throw Error(s(162));q=x.stateNode,ee=x.memoizedProps,M=M!==null?M.memoizedProps:ee;try{it(q,M,ee)}catch(Mt){bn(x,x.return,Mt)}}break;case 3:if(Us(b,x),ws(x),B&4){if(ue&&Se&&M!==null&&M.memoizedState.isDehydrated)try{Ls(b.containerInfo)}catch(Mt){bn(x,x.return,Mt)}if(xe){q=b.containerInfo,ee=b.pendingChildren;try{Et(q,ee)}catch(Mt){bn(x,x.return,Mt)}}}break;case 4:if(Us(b,x),ws(x),B&4&&xe){ee=x.stateNode,q=ee.containerInfo,ee=ee.pendingChildren;try{Et(q,ee)}catch(Mt){bn(x,x.return,Mt)}}break;case 13:Us(b,x),ws(x),q=x.child,q.flags&8192&&(ee=q.memoizedState!==null,q.stateNode.isHidden=ee,!ee||q.alternate!==null&&q.alternate.memoizedState!==null||(Qc=jn())),B&4&&Xu(x);break;case 22:var me=M!==null&&M.memoizedState!==null;if(x.mode&1?(Li=(M=Li)||me,Us(b,x),Li=M):Us(b,x),ws(x),B&8192){if(M=x.memoizedState!==null,(x.stateNode.isHidden=M)&&!me&&(x.mode&1)!==0)for(kt=x,B=x.child;B!==null;){for(b=kt=B;kt!==null;){me=kt;var Te=me.child;switch(me.tag){case 0:case 11:case 14:case 15:Zu(4,me,me.return);break;case 1:Qr(me,me.return);var ze=me.stateNode;if(typeof ze.componentWillUnmount=="function"){var gt=me,It=me.return;try{var cr=gt;ze.props=cr.memoizedProps,ze.state=cr.memoizedState,ze.componentWillUnmount()}catch(Mt){bn(gt,It,Mt)}}break;case 5:Qr(me,me.return);break;case 22:if(me.memoizedState!==null){$h(b);continue}}Te!==null?(Te.return=me,kt=Te):$h(b)}B=B.sibling}if(ue){e:if(B=null,ue)for(b=x;;){if(b.tag===5){if(B===null){B=b;try{q=b.stateNode,M?Qe(q):wt(b.stateNode,b.memoizedProps)}catch(Mt){bn(x,x.return,Mt)}}}else if(b.tag===6){if(B===null)try{ee=b.stateNode,M?Ge(ee):bt(ee,b.memoizedProps)}catch(Mt){bn(x,x.return,Mt)}}else if((b.tag!==22&&b.tag!==23||b.memoizedState===null||b===x)&&b.child!==null){b.child.return=b,b=b.child;continue}if(b===x)break e;for(;b.sibling===null;){if(b.return===null||b.return===x)break e;B===b&&(B=null),b=b.return}B===b&&(B=null),b.sibling.return=b.return,b=b.sibling}}}break;case 19:Us(b,x),ws(x),B&4&&Xu(x);break;case 21:break;default:Us(b,x),ws(x)}}function ws(x){var b=x.flags;if(b&2){try{if(ue){e:{for(var M=x.return;M!==null;){if(Sm(M)){var B=M;break e}M=M.return}throw Error(s(160))}switch(B.tag){case 5:var q=B.stateNode;B.flags&32&&(Re(q),B.flags&=-33);var ee=Yu(x);km(x,ee,q);break;case 3:case 4:var me=B.stateNode.containerInfo,Te=Yu(x);Mf(x,Te,me);break;default:throw Error(s(161))}}}catch(ze){bn(x,x.return,ze)}x.flags&=-3}b&4096&&(x.flags&=-4097)}function $c(x,b,M){kt=x,Wh(x)}function Wh(x,b,M){for(var B=(x.mode&1)!==0;kt!==null;){var q=kt,ee=q.child;if(q.tag===22&&B){var me=q.memoizedState!==null||Wc;if(!me){var Te=q.alternate,ze=Te!==null&&Te.memoizedState!==null||Li;Te=Wc;var gt=Li;if(Wc=me,(Li=ze)&&!gt)for(kt=q;kt!==null;)me=kt,ze=me.child,me.tag===22&&me.memoizedState!==null?Kh(q):ze!==null?(ze.return=me,kt=ze):Kh(q);for(;ee!==null;)kt=ee,Wh(ee),ee=ee.sibling;kt=q,Wc=Te,Li=gt}qh(x)}else(q.subtreeFlags&8772)!==0&&ee!==null?(ee.return=q,kt=ee):qh(x)}}function qh(x){for(;kt!==null;){var b=kt;if((b.flags&8772)!==0){var M=b.alternate;try{if((b.flags&8772)!==0)switch(b.tag){case 0:case 11:case 15:Li||qc(5,b);break;case 1:var B=b.stateNode;if(b.flags&4&&!Li)if(M===null)B.componentDidMount();else{var q=b.elementType===b.type?M.memoizedProps:Xr(b.type,M.memoizedProps);B.componentDidUpdate(q,M.memoizedState,B.__reactInternalSnapshotBeforeUpdate)}var ee=b.updateQueue;ee!==null&&jh(b,ee,B);break;case 3:var me=b.updateQueue;if(me!==null){if(M=null,b.child!==null)switch(b.child.tag){case 5:M=K(b.child.stateNode);break;case 1:M=b.child.stateNode}jh(b,me,M)}break;case 5:var Te=b.stateNode;M===null&&b.flags&4&&lt(Te,b.type,b.memoizedProps,b);break;case 6:break;case 4:break;case 12:break;case 13:if(Se&&b.memoizedState===null){var ze=b.alternate;if(ze!==null){var gt=ze.memoizedState;if(gt!==null){var It=gt.dehydrated;It!==null&&gi(It)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(s(163))}Li||b.flags&512&&Vh(b)}catch(cr){bn(b,b.return,cr)}}if(b===x){kt=null;break}if(M=b.sibling,M!==null){M.return=b.return,kt=M;break}kt=b.return}}function $h(x){for(;kt!==null;){var b=kt;if(b===x){kt=null;break}var M=b.sibling;if(M!==null){M.return=b.return,kt=M;break}kt=b.return}}function Kh(x){for(;kt!==null;){var b=kt;try{switch(b.tag){case 0:case 11:case 15:var M=b.return;try{qc(4,b)}catch(ze){bn(b,M,ze)}break;case 1:var B=b.stateNode;if(typeof B.componentDidMount=="function"){var q=b.return;try{B.componentDidMount()}catch(ze){bn(b,q,ze)}}var ee=b.return;try{Vh(b)}catch(ze){bn(b,ee,ze)}break;case 5:var me=b.return;try{Vh(b)}catch(ze){bn(b,me,ze)}}}catch(ze){bn(b,b.return,ze)}if(b===x){kt=null;break}var Te=b.sibling;if(Te!==null){Te.return=b.return,kt=Te;break}kt=b.return}}var _l=0,Aa=1,Fo=2,Kc=3,Lf=4;if(typeof Symbol=="function"&&Symbol.for){var Ss=Symbol.for;_l=Ss("selector.component"),Aa=Ss("selector.has_pseudo_class"),Fo=Ss("selector.role"),Kc=Ss("selector.test_id"),Lf=Ss("selector.text")}function Bo(x){var b=Ae(x);if(b!=null){if(typeof b.memoizedProps["data-testname"]!="string")throw Error(s(364));return b}if(x=ut(x),x===null)throw Error(s(362));return x.stateNode.current}function Rf(x,b){switch(b.$$typeof){case _l:if(x.type===b.value)return!0;break;case Aa:e:{b=b.value,x=[x,0];for(var M=0;M<x.length;){var B=x[M++],q=x[M++],ee=b[q];if(B.tag!==5||!ot(B)){for(;ee!=null&&Rf(B,ee);)q++,ee=b[q];if(q===b.length){b=!0;break e}else for(B=B.child;B!==null;)x.push(B,q),B=B.sibling}}b=!1}return b;case Fo:if(x.tag===5&&Lt(x.stateNode,b.value))return!0;break;case Lf:if((x.tag===5||x.tag===6)&&(x=xt(x),x!==null&&0<=x.indexOf(b.value)))return!0;break;case Kc:if(x.tag===5&&(x=x.memoizedProps["data-testname"],typeof x=="string"&&x.toLowerCase()===b.value.toLowerCase()))return!0;break;default:throw Error(s(365))}return!1}function Zh(x){switch(x.$$typeof){case _l:return"<"+(j(x.value)||"Unknown")+">";case Aa:return":has("+(Zh(x)||"")+")";case Fo:return'[role="'+x.value+'"]';case Lf:return'"'+x.value+'"';case Kc:return'[data-testname="'+x.value+'"]';default:throw Error(s(365))}}function zo(x,b){var M=[];x=[x,0];for(var B=0;B<x.length;){var q=x[B++],ee=x[B++],me=b[ee];if(q.tag!==5||!ot(q)){for(;me!=null&&Rf(q,me);)ee++,me=b[ee];if(ee===b.length)M.push(q);else for(q=q.child;q!==null;)x.push(q,ee),q=q.sibling}}return M}function Uo(x,b){if(!Ke)throw Error(s(363));x=Bo(x),x=zo(x,b),b=[],x=Array.from(x);for(var M=0;M<x.length;){var B=x[M++];if(B.tag===5)ot(B)||b.push(B.stateNode);else for(B=B.child;B!==null;)x.push(B),B=B.sibling}return b}var Yh=Math.ceil,Of=o.ReactCurrentDispatcher,Zc=o.ReactCurrentOwner,Hn=o.ReactCurrentBatchConfig,pr=0,cn=null,En=null,ti=0,Si=0,du=et(0),Tn=0,Yc=null,Cl=0,mn=0,Xc=0,Qu=null,aa=null,Qc=0,Df=1/0,La=null;function rn(){Df=jn()+500}var Wn=!1,oi=null,ho=null,fu=!1,Gs=null,Xh=0,li=0,If=null,Jc=-1,ed=0;function xn(){return(pr&6)!==0?jn():Jc!==-1?Jc:Jc=jn()}function ki(x){return(x.mode&1)===0?1:(pr&2)!==0&&ti!==0?ti&-ti:Mc.transition!==null?(ed===0&&(ed=Vl()),ed):(x=Sr,x!==0?x:st())}function sa(x,b,M,B){if(50<li)throw li=0,If=null,Error(s(185));Fi(x,M,B),((pr&2)===0||x!==cn)&&(x===cn&&((pr&2)===0&&(mn|=M),Tn===4&&El(x,ti)),oa(x,B),M===1&&pr===0&&(b.mode&1)===0&&(rn(),No&&yi()))}function oa(x,b){var M=x.callbackNode;Tc(x,b);var B=Rs(x,x===cn?ti:0);if(B===0)M!==null&&Zr(M),x.callbackNode=null,x.callbackPriority=0;else if(b=B&-B,x.callbackPriority!==b){if(M!=null&&Zr(M),b===1)x.tag===0?Er(_m.bind(null,x)):ju(_m.bind(null,x)),dt?Ct(function(){(pr&6)===0&&yi()}):Jn(Hl,yi),M=null;else{switch(or(B)){case 1:M=Hl;break;case 4:M=Os;break;case 16:M=Wl;break;case 536870912:M=Du;break;default:M=Wl}M=Am(M,Qh.bind(null,x))}x.callbackPriority=b,x.callbackNode=M}}function Qh(x,b){if(Jc=-1,ed=0,(pr&6)!==0)throw Error(s(327));var M=x.callbackNode;if(Tl()&&x.callbackNode!==M)return null;var B=Rs(x,x===cn?ti:0);if(B===0)return null;if((B&30)!==0||(B&x.expiredLanes)!==0||b)b=Ju(x,B);else{b=B;var q=pr;pr|=2;var ee=Em();(cn!==x||ti!==b)&&(La=null,rn(),hu(x,b));do try{Tm();break}catch(Te){td(x,Te)}while(!0);wf(),Of.current=ee,pr=q,En!==null?b=0:(cn=null,ti=0,b=Tn)}if(b!==0){if(b===2&&(q=sl(x),q!==0&&(B=q,b=Jh(x,q))),b===1)throw M=Yc,hu(x,0),El(x,B),oa(x,jn()),M;if(b===6)El(x,B);else{if(q=x.current.alternate,(B&30)===0&&!_0(q)&&(b=Ju(x,B),b===2&&(ee=sl(x),ee!==0&&(B=ee,b=Jh(x,ee))),b===1))throw M=Yc,hu(x,0),El(x,B),oa(x,jn()),M;switch(x.finishedWork=q,x.finishedLanes=B,b){case 0:case 1:throw Error(s(345));case 2:pu(x,aa,La);break;case 3:if(El(x,B),(B&130023424)===B&&(b=Qc+500-jn(),10<b)){if(Rs(x,0)!==0)break;if(q=x.suspendedLanes,(q&B)!==B){xn(),x.pingedLanes|=x.suspendedLanes&q;break}x.timeoutHandle=ae(pu.bind(null,x,aa,La),b);break}pu(x,aa,La);break;case 4:if(El(x,B),(B&4194240)===B)break;for(b=x.eventTimes,q=-1;0<B;){var me=31-rr(B);ee=1<<me,me=b[me],me>q&&(q=me),B&=~ee}if(B=q,B=jn()-B,B=(120>B?120:480>B?480:1080>B?1080:1920>B?1920:3e3>B?3e3:4320>B?4320:1960*Yh(B/1960))-B,10<B){x.timeoutHandle=ae(pu.bind(null,x,aa,La),B);break}pu(x,aa,La);break;case 5:pu(x,aa,La);break;default:throw Error(s(329))}}}return oa(x,jn()),x.callbackNode===M?Qh.bind(null,x):null}function Jh(x,b){var M=Qu;return x.current.memoizedState.isDehydrated&&(hu(x,b).flags|=256),x=Ju(x,b),x!==2&&(b=aa,aa=M,b!==null&&ep(b)),x}function ep(x){aa===null?aa=x:aa.push.apply(aa,x)}function _0(x){for(var b=x;;){if(b.flags&16384){var M=b.updateQueue;if(M!==null&&(M=M.stores,M!==null))for(var B=0;B<M.length;B++){var q=M[B],ee=q.getSnapshot;q=q.value;try{if(!hs(ee(),q))return!1}catch{return!1}}}if(M=b.child,b.subtreeFlags&16384&&M!==null)M.return=b,b=M;else{if(b===x)break;for(;b.sibling===null;){if(b.return===null||b.return===x)return!0;b=b.return}b.sibling.return=b.return,b=b.sibling}}return!0}function El(x,b){for(b&=~Xc,b&=~mn,x.suspendedLanes|=b,x.pingedLanes&=~b,x=x.expirationTimes;0<b;){var M=31-rr(b),B=1<<M;x[M]=-1,b&=~B}}function _m(x){if((pr&6)!==0)throw Error(s(327));Tl();var b=Rs(x,0);if((b&1)===0)return oa(x,jn()),null;var M=Ju(x,b);if(x.tag!==0&&M===2){var B=sl(x);B!==0&&(b=B,M=Jh(x,B))}if(M===1)throw M=Yc,hu(x,0),El(x,b),oa(x,jn()),M;if(M===6)throw Error(s(345));return x.finishedWork=x.current.alternate,x.finishedLanes=b,pu(x,aa,La),oa(x,jn()),null}function Cm(x){Gs!==null&&Gs.tag===0&&(pr&6)===0&&Tl();var b=pr;pr|=1;var M=Hn.transition,B=Sr;try{if(Hn.transition=null,Sr=1,x)return x()}finally{Sr=B,Hn.transition=M,pr=b,(pr&6)===0&&yi()}}function tp(){Si=du.current,ht(du)}function hu(x,b){x.finishedWork=null,x.finishedLanes=0;var M=x.timeoutHandle;if(M!==ye&&(x.timeoutHandle=ye,pe(M)),En!==null)for(M=En.return;M!==null;){var B=M;switch(Fu(B),B.tag){case 1:B=B.type.childContextTypes,B!=null&&jr();break;case 3:Fs(),ht(Mr),ht(Pr),Dc();break;case 5:eu(B);break;case 4:Fs();break;case 13:ht(qr);break;case 19:ht(qr);break;case 10:js(B.type._context);break;case 22:case 23:tp()}M=M.return}if(cn=x,En=x=mu(x.current,null),ti=Si=b,Tn=0,Yc=null,Xc=mn=Cl=0,aa=Qu=null,Ca!==null){for(b=0;b<Ca.length;b++)if(M=Ca[b],B=M.interleaved,B!==null){M.interleaved=null;var q=B.next,ee=M.pending;if(ee!==null){var me=ee.next;ee.next=q,B.next=me}M.pending=B}Ca=null}return x}function td(x,b){do{var M=En;try{if(wf(),ta.current=Xe,tu){for(var B=ln.memoizedState;B!==null;){var q=B.queue;q!==null&&(q.pending=null),B=B.next}tu=!1}if(Mo=0,Un=zn=ln=null,ra=!1,Ao=0,Zc.current=null,M===null||M.return===null){Tn=1,Yc=b,En=null;break}e:{var ee=x,me=M.return,Te=M,ze=b;if(b=ti,Te.flags|=32768,ze!==null&&typeof ze=="object"&&typeof ze.then=="function"){var gt=ze,It=Te,cr=It.tag;if((It.mode&1)===0&&(cr===0||cr===11||cr===15)){var Mt=It.alternate;Mt?(It.updateQueue=Mt.updateQueue,It.memoizedState=Mt.memoizedState,It.lanes=Mt.lanes):(It.updateQueue=null,It.memoizedState=null)}var gn=Bh(me);if(gn!==null){gn.flags&=-257,Do(gn,me,Te,ee,b),gn.mode&1&&Fh(ee,gt,b),b=gn,ze=gt;var Jr=b.updateQueue;if(Jr===null){var Ra=new Set;Ra.add(ze),b.updateQueue=Ra}else Jr.add(ze);break e}else{if((b&1)===0){Fh(ee,gt,b),rd();break e}ze=Error(s(426))}}else if(tn&&Te.mode&1){var Go=Bh(me);if(Go!==null){(Go.flags&65536)===0&&(Go.flags|=256),Do(Go,me,Te,ee,b),Pc(xl(ze,Te));break e}}ee=ze=xl(ze,Te),Tn!==4&&(Tn=2),Qu===null?Qu=[ee]:Qu.push(ee),ee=me;do{switch(ee.tag){case 3:ee.flags|=65536,b&=-b,ee.lanes|=b;var Fe=Gr(ee,ze,b);Ql(ee,Fe);break e;case 1:Te=ze;var Pe=ee.type,He=ee.stateNode;if((ee.flags&128)===0&&(typeof Pe.getDerivedStateFromError=="function"||He!==null&&typeof He.componentDidCatch=="function"&&(ho===null||!ho.has(He)))){ee.flags|=65536,b&=-b,ee.lanes|=b;var At=bl(ee,Te,b);Ql(ee,At);break e}}ee=ee.return}while(ee!==null)}Pm(M)}catch($t){b=$t,En===M&&M!==null&&(En=M=M.return);continue}break}while(!0)}function Em(){var x=Of.current;return Of.current=Xe,x===null?Xe:x}function rd(){(Tn===0||Tn===3||Tn===2)&&(Tn=4),cn===null||(Cl&268435455)===0&&(mn&268435455)===0||El(cn,ti)}function Ju(x,b){var M=pr;pr|=2;var B=Em();(cn!==x||ti!==b)&&(La=null,hu(x,b));do try{C0();break}catch(q){td(x,q)}while(!0);if(wf(),pr=M,Of.current=B,En!==null)throw Error(s(261));return cn=null,ti=0,Tn}function C0(){for(;En!==null;)Nm(En)}function Tm(){for(;En!==null&&!vf();)Nm(En)}function Nm(x){var b=M0(x.alternate,x,Si);x.memoizedProps=x.pendingProps,b===null?Pm(x):En=b,Zc.current=null}function Pm(x){var b=x;do{var M=b.alternate;if(x=b.return,(b.flags&32768)===0){if(M=Ku(M,b,Si),M!==null){En=M;return}}else{if(M=S0(M,b),M!==null){M.flags&=32767,En=M;return}if(x!==null)x.flags|=32768,x.subtreeFlags=0,x.deletions=null;else{Tn=6,En=null;return}}if(b=b.sibling,b!==null){En=b;return}En=b=x}while(b!==null);Tn===0&&(Tn=5)}function pu(x,b,M){var B=Sr,q=Hn.transition;try{Hn.transition=null,Sr=1,E0(x,b,M,B)}finally{Hn.transition=q,Sr=B}return null}function E0(x,b,M,B){do Tl();while(Gs!==null);if((pr&6)!==0)throw Error(s(327));M=x.finishedWork;var q=x.finishedLanes;if(M===null)return null;if(x.finishedWork=null,x.finishedLanes=0,M===x.current)throw Error(s(177));x.callbackNode=null,x.callbackPriority=0;var ee=M.lanes|M.childLanes;if(so(x,ee),x===cn&&(En=cn=null,ti=0),(M.subtreeFlags&2064)===0&&(M.flags&2064)===0||fu||(fu=!0,Am(Wl,function(){return Tl(),null})),ee=(M.flags&15990)!==0,(M.subtreeFlags&15990)!==0||ee){ee=Hn.transition,Hn.transition=null;var me=Sr;Sr=1;var Te=pr;pr|=4,Zc.current=null,k0(x,M),Af(M,x),te(x.containerInfo),x.current=M,$c(M),ol(),pr=Te,Sr=me,Hn.transition=ee}else x.current=M;if(fu&&(fu=!1,Gs=x,Xh=q),ee=x.pendingLanes,ee===0&&(ho=null),ll(M.stateNode),oa(x,jn()),b!==null)for(B=x.onRecoverableError,M=0;M<b.length;M++)q=b[M],B(q.value,{componentStack:q.stack,digest:q.digest});if(Wn)throw Wn=!1,x=oi,oi=null,x;return(Xh&1)!==0&&x.tag!==0&&Tl(),ee=x.pendingLanes,(ee&1)!==0?x===If?li++:(li=0,If=x):li=0,yi(),null}function Tl(){if(Gs!==null){var x=or(Xh),b=Hn.transition,M=Sr;try{if(Hn.transition=null,Sr=16>x?16:x,Gs===null)var B=!1;else{if(x=Gs,Gs=null,Xh=0,(pr&6)!==0)throw Error(s(331));var q=pr;for(pr|=4,kt=x.current;kt!==null;){var ee=kt,me=ee.child;if((kt.flags&16)!==0){var Te=ee.deletions;if(Te!==null){for(var ze=0;ze<Te.length;ze++){var gt=Te[ze];for(kt=gt;kt!==null;){var It=kt;switch(It.tag){case 0:case 11:case 15:Zu(8,It,ee)}var cr=It.child;if(cr!==null)cr.return=It,kt=cr;else for(;kt!==null;){It=kt;var Mt=It.sibling,gn=It.return;if(Pf(It),It===gt){kt=null;break}if(Mt!==null){Mt.return=gn,kt=Mt;break}kt=gn}}}var Jr=ee.alternate;if(Jr!==null){var Ra=Jr.child;if(Ra!==null){Jr.child=null;do{var Go=Ra.sibling;Ra.sibling=null,Ra=Go}while(Ra!==null)}}kt=ee}}if((ee.subtreeFlags&2064)!==0&&me!==null)me.return=ee,kt=me;else e:for(;kt!==null;){if(ee=kt,(ee.flags&2048)!==0)switch(ee.tag){case 0:case 11:case 15:Zu(9,ee,ee.return)}var Fe=ee.sibling;if(Fe!==null){Fe.return=ee.return,kt=Fe;break e}kt=ee.return}}var Pe=x.current;for(kt=Pe;kt!==null;){me=kt;var He=me.child;if((me.subtreeFlags&2064)!==0&&He!==null)He.return=me,kt=He;else e:for(me=Pe;kt!==null;){if(Te=kt,(Te.flags&2048)!==0)try{switch(Te.tag){case 0:case 11:case 15:qc(9,Te)}}catch($t){bn(Te,Te.return,$t)}if(Te===me){kt=null;break e}var At=Te.sibling;if(At!==null){At.return=Te.return,kt=At;break e}kt=Te.return}}if(pr=q,yi(),Fn&&typeof Fn.onPostCommitFiberRoot=="function")try{Fn.onPostCommitFiberRoot(hn,x)}catch{}B=!0}return B}finally{Sr=M,Hn.transition=b}}return!1}function Mm(x,b,M){b=xl(M,b),b=Gr(x,b,1),x=lo(x,b,1),b=xn(),x!==null&&(Fi(x,1,b),oa(x,b))}function bn(x,b,M){if(x.tag===3)Mm(x,x,M);else for(;b!==null;){if(b.tag===3){Mm(b,x,M);break}else if(b.tag===1){var B=b.stateNode;if(typeof b.type.getDerivedStateFromError=="function"||typeof B.componentDidCatch=="function"&&(ho===null||!ho.has(B))){x=xl(M,x),x=bl(b,x,1),b=lo(b,x,1),x=xn(),b!==null&&(Fi(b,1,x),oa(b,x));break}}b=b.return}}function T0(x,b,M){var B=x.pingCache;B!==null&&B.delete(b),b=xn(),x.pingedLanes|=x.suspendedLanes&M,cn===x&&(ti&M)===M&&(Tn===4||Tn===3&&(ti&130023424)===ti&&500>jn()-Qc?hu(x,0):Xc|=M),oa(x,b)}function N0(x,b){b===0&&((x.mode&1)===0?b=1:(b=ao,ao<<=1,(ao&130023424)===0&&(ao=4194304)));var M=xn();x=Za(x,b),x!==null&&(Fi(x,b,M),oa(x,M))}function P0(x){var b=x.memoizedState,M=0;b!==null&&(M=b.retryLane),N0(x,M)}function hb(x,b){var M=0;switch(x.tag){case 13:var B=x.stateNode,q=x.memoizedState;q!==null&&(M=q.retryLane);break;case 19:B=x.stateNode;break;default:throw Error(s(314))}B!==null&&B.delete(b),N0(x,M)}var M0;M0=function(x,b,M){if(x!==null)if(x.memoizedProps!==b.pendingProps||Mr.current)Vn=!0;else{if((x.lanes&M)===0&&(b.flags&128)===0)return Vn=!1,ou(x,b,M);Vn=(x.flags&131072)!==0}else Vn=!1,tn&&(b.flags&1048576)!==0&&Rh(b,ul,b.index);switch(b.lanes=0,b.tag){case 2:var B=b.type;Nf(x,b),x=b.pendingProps;var q=vi(b,Pr.current);Ji(b,M),q=nu(null,b,B,x,q,M);var ee=Ic();return b.flags|=1,typeof q=="object"&&q!==null&&typeof q.render=="function"&&q.$$typeof===void 0?(b.tag=1,b.memoizedState=null,b.updateQueue=null,zt(B)?(ee=!0,nr(b)):ee=!1,b.memoizedState=q.state!==null&&q.state!==void 0?q.state:null,Sf(b),q.updater=Ai,b.stateNode=q,q._reactInternals=b,zs(b,B,x,M),b=na(null,b,B,!0,ee,M)):(b.tag=0,tn&&ee&&Qi(b),si(null,b,q,M),b=b.child),b;case 16:B=b.elementType;e:{switch(Nf(x,b),x=b.pendingProps,q=B._init,B=q(B._payload),b.type=B,q=b.tag=pb(B),x=Xr(B,x),q){case 0:b=Io(null,b,B,x,M);break e;case 1:b=Ui(null,b,B,x,M);break e;case 11:b=zh(null,b,B,x,M);break e;case 14:b=Hu(null,b,B,Xr(B.type,x),M);break e}throw Error(s(306,B,""))}return b;case 0:return B=b.type,q=b.pendingProps,q=b.elementType===B?q:Xr(B,q),Io(x,b,B,q,M);case 1:return B=b.type,q=b.pendingProps,q=b.elementType===B?q:Xr(B,q),Ui(x,b,B,q,M);case 3:e:{if(su(b),x===null)throw Error(s(387));B=b.pendingProps,ee=b.memoizedState,q=ee.element,oo(x,b),Mi(b,B,null,M);var me=b.memoizedState;if(B=me.element,Se&&ee.isDehydrated)if(ee={element:B,isDehydrated:!1,cache:me.cache,pendingSuspenseBoundaries:me.pendingSuspenseBoundaries,transitions:me.transitions},b.updateQueue.baseState=ee,b.memoizedState=ee,b.flags&256){q=xl(Error(s(423)),b),b=Wu(x,b,B,M,q);break e}else if(B!==q){q=xl(Error(s(424)),b),b=Wu(x,b,B,M,q);break e}else for(Se&&(_n=ds(b.stateNode.containerInfo),ai=b,tn=!0,ka=null,Kl=!1),M=Ac(b,null,B,M),b.child=M;M;)M.flags=M.flags&-3|4096,M=M.sibling;else{if(Po(),B===q){b=kl(x,b,M);break e}si(x,b,B,M)}b=b.child}return b;case 5:return zu(b),x===null&&yf(b),B=b.type,q=b.pendingProps,ee=x!==null?x.memoizedProps:null,me=q.children,se(B,q)?me=null:ee!==null&&se(B,ee)&&(b.flags|=32),un(x,b),si(x,b,me,M),b.child;case 6:return x===null&&yf(b),null;case 13:return bm(x,b,M);case 4:return Jl(b,b.stateNode.containerInfo),B=b.pendingProps,x===null?b.child=cl(b,null,B,M):si(x,b,B,M),b.child;case 11:return B=b.type,q=b.pendingProps,q=b.elementType===B?q:Xr(B,q),zh(x,b,B,q,M);case 7:return si(x,b,b.pendingProps,M),b.child;case 8:return si(x,b,b.pendingProps.children,M),b.child;case 12:return si(x,b,b.pendingProps.children,M),b.child;case 10:e:{if(B=b.type._context,q=b.pendingProps,ee=b.memoizedProps,me=q.value,Ka(b,B,me),ee!==null)if(hs(ee.value,me)){if(ee.children===q.children&&!Mr.current){b=kl(x,b,M);break e}}else for(ee=b.child,ee!==null&&(ee.return=b);ee!==null;){var Te=ee.dependencies;if(Te!==null){me=ee.child;for(var ze=Te.firstContext;ze!==null;){if(ze.context===B){if(ee.tag===1){ze=Ya(-1,M&-M),ze.tag=2;var gt=ee.updateQueue;if(gt!==null){gt=gt.shared;var It=gt.pending;It===null?ze.next=ze:(ze.next=It.next,It.next=ze),gt.pending=ze}}ee.lanes|=M,ze=ee.alternate,ze!==null&&(ze.lanes|=M),dl(ee.return,M,b),Te.lanes|=M;break}ze=ze.next}}else if(ee.tag===10)me=ee.type===b.type?null:ee.child;else if(ee.tag===18){if(me=ee.return,me===null)throw Error(s(341));me.lanes|=M,Te=me.alternate,Te!==null&&(Te.lanes|=M),dl(me,M,b),me=ee.sibling}else me=ee.child;if(me!==null)me.return=ee;else for(me=ee;me!==null;){if(me===b){me=null;break}if(ee=me.sibling,ee!==null){ee.return=me.return,me=ee;break}me=me.return}ee=me}si(x,b,q.children,M),b=b.child}return b;case 9:return q=b.type,B=b.pendingProps.children,Ji(b,M),q=_a(q),B=B(q),b.flags|=1,si(x,b,B,M),b.child;case 14:return B=b.type,q=Xr(B,b.pendingProps),q=Xr(B.type,q),Hu(x,b,B,q,M);case 15:return Sl(x,b,b.type,b.pendingProps,M);case 17:return B=b.type,q=b.pendingProps,q=b.elementType===B?q:Xr(B,q),Nf(x,b),b.tag=1,zt(B)?(x=!0,nr(b)):x=!1,Ji(b,M),yl(b,B,q),zs(b,B,q,M),na(null,b,B,!0,x,M);case 19:return Gh(x,b,M);case 22:return pn(x,b,M)}throw Error(s(156,b.tag))};function Am(x,b){return Jn(x,b)}function A0(x,b,M,B){this.tag=x,this.key=M,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=b,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=B,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ks(x,b,M,B){return new A0(x,b,M,B)}function nd(x){return x=x.prototype,!(!x||!x.isReactComponent)}function pb(x){if(typeof x=="function")return nd(x)?1:0;if(x!=null){if(x=x.$$typeof,x===S)return 11;if(x===_)return 14}return 2}function mu(x,b){var M=x.alternate;return M===null?(M=ks(x.tag,b,x.key,x.mode),M.elementType=x.elementType,M.type=x.type,M.stateNode=x.stateNode,M.alternate=x,x.alternate=M):(M.pendingProps=b,M.type=x.type,M.flags=0,M.subtreeFlags=0,M.deletions=null),M.flags=x.flags&14680064,M.childLanes=x.childLanes,M.lanes=x.lanes,M.child=x.child,M.memoizedProps=x.memoizedProps,M.memoizedState=x.memoizedState,M.updateQueue=x.updateQueue,b=x.dependencies,M.dependencies=b===null?null:{lanes:b.lanes,firstContext:b.firstContext},M.sibling=x.sibling,M.index=x.index,M.ref=x.ref,M}function rp(x,b,M,B,q,ee){var me=2;if(B=x,typeof x=="function")nd(x)&&(me=1);else if(typeof x=="string")me=5;else e:switch(x){case c:return Gi(M.children,q,ee,b);case f:me=8,q|=8;break;case p:return x=ks(12,M,b,q|2),x.elementType=p,x.lanes=ee,x;case w:return x=ks(13,M,b,q),x.elementType=w,x.lanes=ee,x;case C:return x=ks(19,M,b,q),x.elementType=C,x.lanes=ee,x;case N:return ad(M,q,ee,b);default:if(typeof x=="object"&&x!==null)switch(x.$$typeof){case g:me=10;break e;case y:me=9;break e;case S:me=11;break e;case _:me=14;break e;case T:me=16,B=null;break e}throw Error(s(130,x==null?x:typeof x,""))}return b=ks(me,M,b,q),b.elementType=x,b.type=B,b.lanes=ee,b}function Gi(x,b,M,B){return x=ks(7,x,B,b),x.lanes=M,x}function ad(x,b,M,B){return x=ks(22,x,B,b),x.elementType=N,x.lanes=M,x.stateNode={isHidden:!1},x}function sd(x,b,M){return x=ks(6,x,null,b),x.lanes=M,x}function np(x,b,M){return b=ks(4,x.children!==null?x.children:[],x.key,b),b.lanes=M,b.stateNode={containerInfo:x.containerInfo,pendingChildren:null,implementation:x.implementation},b}function L0(x,b,M,B,q){this.tag=b,this.containerInfo=x,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=ye,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=To(0),this.expirationTimes=To(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=To(0),this.identifierPrefix=B,this.onRecoverableError=q,Se&&(this.mutableSourceEagerHydrationData=null)}function Lm(x,b,M,B,q,ee,me,Te,ze){return x=new L0(x,b,M,Te,ze),b===1?(b=1,ee===!0&&(b|=8)):b=0,ee=ks(3,null,null,b),x.current=ee,ee.stateNode=x,ee.memoizedState={element:B,isDehydrated:M,cache:null,transitions:null,pendingSuspenseBoundaries:null},Sf(ee),x}function ip(x){if(!x)return Dt;x=x._reactInternals;e:{if(F(x)!==x||x.tag!==1)throw Error(s(170));var b=x;do{switch(b.tag){case 3:b=b.stateNode.context;break e;case 1:if(zt(b.type)){b=b.stateNode.__reactInternalMemoizedMergedChildContext;break e}}b=b.return}while(b!==null);throw Error(s(171))}if(x.tag===1){var M=x.type;if(zt(M))return tr(x,M,b)}return b}function ec(x){var b=x._reactInternals;if(b===void 0)throw typeof x.render=="function"?Error(s(188)):(x=Object.keys(x).join(","),Error(s(268,x)));return x=Z(b),x===null?null:x.stateNode}function ap(x,b){if(x=x.memoizedState,x!==null&&x.dehydrated!==null){var M=x.retryLane;x.retryLane=M!==0&&M<b?M:b}}function od(x,b){ap(x,b),(x=x.alternate)&&ap(x,b)}function mb(x){return x=Z(x),x===null?null:x.stateNode}function R0(){return null}return r.attemptContinuousHydration=function(x){if(x.tag===13){var b=Za(x,134217728);if(b!==null){var M=xn();sa(b,x,134217728,M)}od(x,134217728)}},r.attemptDiscreteHydration=function(x){if(x.tag===13){var b=Za(x,1);if(b!==null){var M=xn();sa(b,x,1,M)}od(x,1)}},r.attemptHydrationAtCurrentPriority=function(x){if(x.tag===13){var b=ki(x),M=Za(x,b);if(M!==null){var B=xn();sa(M,x,b,B)}od(x,b)}},r.attemptSynchronousHydration=function(x){switch(x.tag){case 3:var b=x.stateNode;if(b.current.memoizedState.isDehydrated){var M=Eo(b.pendingLanes);M!==0&&($a(b,M|1),oa(b,jn()),(pr&6)===0&&(rn(),yi()))}break;case 13:Cm(function(){var B=Za(x,1);if(B!==null){var q=xn();sa(B,x,1,q)}}),od(x,1)}},r.batchedUpdates=function(x,b){var M=pr;pr|=1;try{return x(b)}finally{pr=M,pr===0&&(rn(),No&&yi())}},r.createComponentSelector=function(x){return{$$typeof:_l,value:x}},r.createContainer=function(x,b,M,B,q,ee,me){return Lm(x,b,!1,null,M,B,q,ee,me)},r.createHasPseudoClassSelector=function(x){return{$$typeof:Aa,value:x}},r.createHydrationContainer=function(x,b,M,B,q,ee,me,Te,ze){return x=Lm(M,B,!0,x,q,ee,me,Te,ze),x.context=ip(null),M=x.current,B=xn(),q=ki(M),ee=Ya(B,q),ee.callback=b??null,lo(M,ee,q),x.current.lanes=q,Fi(x,q,B),oa(x,B),x},r.createPortal=function(x,b,M){var B=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:u,key:B==null?null:""+B,children:x,containerInfo:b,implementation:M}},r.createRoleSelector=function(x){return{$$typeof:Fo,value:x}},r.createTestNameSelector=function(x){return{$$typeof:Kc,value:x}},r.createTextSelector=function(x){return{$$typeof:Lf,value:x}},r.deferredUpdates=function(x){var b=Sr,M=Hn.transition;try{return Hn.transition=null,Sr=16,x()}finally{Sr=b,Hn.transition=M}},r.discreteUpdates=function(x,b,M,B,q){var ee=Sr,me=Hn.transition;try{return Hn.transition=null,Sr=1,x(b,M,B,q)}finally{Sr=ee,Hn.transition=me,pr===0&&rn()}},r.findAllNodes=Uo,r.findBoundingRects=function(x,b){if(!Ke)throw Error(s(363));b=Uo(x,b),x=[];for(var M=0;M<b.length;M++)x.push(ct(b[M]));for(b=x.length-1;0<b;b--){M=x[b];for(var B=M.x,q=B+M.width,ee=M.y,me=ee+M.height,Te=b-1;0<=Te;Te--)if(b!==Te){var ze=x[Te],gt=ze.x,It=gt+ze.width,cr=ze.y,Mt=cr+ze.height;if(B>=gt&&ee>=cr&&q<=It&&me<=Mt){x.splice(b,1);break}else if(B!==gt||M.width!==ze.width||Mt<ee||cr>me){if(!(ee!==cr||M.height!==ze.height||It<B||gt>q)){gt>B&&(ze.width+=gt-B,ze.x=B),It<q&&(ze.width=q-gt),x.splice(b,1);break}}else{cr>ee&&(ze.height+=cr-ee,ze.y=ee),Mt<me&&(ze.height=me-cr),x.splice(b,1);break}}}return x},r.findHostInstance=ec,r.findHostInstanceWithNoPortals=function(x){return x=G(x),x=x!==null?W(x):null,x===null?null:x.stateNode},r.findHostInstanceWithWarning=function(x){return ec(x)},r.flushControlled=function(x){var b=pr;pr|=1;var M=Hn.transition,B=Sr;try{Hn.transition=null,Sr=1,x()}finally{Sr=B,Hn.transition=M,pr=b,pr===0&&(rn(),yi())}},r.flushPassiveEffects=Tl,r.flushSync=Cm,r.focusWithin=function(x,b){if(!Ke)throw Error(s(363));for(x=Bo(x),b=zo(x,b),b=Array.from(b),x=0;x<b.length;){var M=b[x++];if(!ot(M)){if(M.tag===5&&Bt(M.stateNode))return!0;for(M=M.child;M!==null;)b.push(M),M=M.sibling}}return!1},r.getCurrentUpdatePriority=function(){return Sr},r.getFindAllNodesFailureDescription=function(x,b){if(!Ke)throw Error(s(363));var M=0,B=[];x=[Bo(x),0];for(var q=0;q<x.length;){var ee=x[q++],me=x[q++],Te=b[me];if((ee.tag!==5||!ot(ee))&&(Rf(ee,Te)&&(B.push(Zh(Te)),me++,me>M&&(M=me)),me<b.length))for(ee=ee.child;ee!==null;)x.push(ee,me),ee=ee.sibling}if(M<b.length){for(x=[];M<b.length;M++)x.push(Zh(b[M]));return`findAllNodes was able to match part of the selector:
  `+(B.join(" > ")+`

No matching component was found for:
  `)+x.join(" > ")}return null},r.getPublicRootInstance=function(x){return x=x.current,x.child?x.child.tag===5?K(x.child.stateNode):x.child.stateNode:null},r.injectIntoDevTools=function(x){if(x={bundleType:x.bundleType,version:x.version,rendererPackageName:x.rendererPackageName,rendererConfig:x.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:o.ReactCurrentDispatcher,findHostInstanceByFiber:mb,findFiberByHostInstance:x.findFiberByHostInstance||R0,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1"},typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u")x=!1;else{var b=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(b.isDisabled||!b.supportsFiber)x=!0;else{try{hn=b.inject(x),Fn=b}catch{}x=!!b.checkDCE}}return x},r.isAlreadyRendering=function(){return!1},r.observeVisibleRects=function(x,b,M,B){if(!Ke)throw Error(s(363));x=Uo(x,b);var q=Ne(x,M,B).disconnect;return{disconnect:function(){q()}}},r.registerMutableSourceForHydration=function(x,b){var M=b._getVersion;M=M(b._source),x.mutableSourceEagerHydrationData==null?x.mutableSourceEagerHydrationData=[b,M]:x.mutableSourceEagerHydrationData.push(b,M)},r.runWithPriority=function(x,b){var M=Sr;try{return Sr=x,b()}finally{Sr=M}},r.shouldError=function(){return null},r.shouldSuspend=function(){return!1},r.updateContainer=function(x,b,M,B){var q=b.current,ee=xn(),me=ki(q);return M=ip(M),b.context===null?b.context=M:b.pendingContext=M,b=Ya(ee,me),b.payload={element:x},B=B===void 0?null:B,B!==null&&(b.callback=B),x=lo(q,b,me),x!==null&&(sa(x,q,me,ee),hl(x,q,me)),me},r}),B2}var y4;function vV(){return y4||(y4=1,F2.exports=gV()),F2.exports}var yV=vV();const xV=Th(yV);var z2={exports:{}},bd={};var x4;function bV(){return x4||(x4=1,bd.ConcurrentRoot=1,bd.ContinuousEventPriority=4,bd.DefaultEventPriority=16,bd.DiscreteEventPriority=1,bd.IdleEventPriority=536870912,bd.LegacyRoot=0),bd}var b4;function wV(){return b4||(b4=1,z2.exports=bV()),z2.exports}var OL=wV(),SV=Nr();const w4={children:!0,ref:!0,key:!0,style:!0,forwardedRef:!0,unstable_applyCache:!0,unstable_applyDrawHitFromCache:!0};let S4=!1,k4=!1;const A_=".react-konva-event",kV=`ReactKonva: You have a Konva node with draggable = true and position defined but no onDragMove or onDragEnd events are handled.
Position of a node will be changed during drag&drop, so you should update state of the react app as well.
Consider to add onDragMove or onDragEnd events.
For more info see: https://github.com/konvajs/react-konva/issues/256
`,_V=`ReactKonva: You are using "zIndex" attribute for a Konva node.
react-konva may get confused with ordering. Just define correct order of elements in your render function of a component.
For more info see: https://github.com/konvajs/react-konva/issues/194
`,CV={};function W1(t,e,r=CV){if(!S4&&"zIndex"in e&&(console.warn(_V),S4=!0),!k4&&e.draggable){var n=e.x!==void 0||e.y!==void 0,i=e.onDragEnd||e.onDragMove;n&&!i&&(console.warn(kV),k4=!0)}for(var a in r)if(!w4[a]){var s=a.slice(0,2)==="on",o=r[a]!==e[a];if(s&&o){var l=a.substr(2).toLowerCase();l.substr(0,7)==="content"&&(l="content"+l.substr(7,1).toUpperCase()+l.substr(8)),t.off(l,r[a])}var u=!e.hasOwnProperty(a);u&&t.setAttr(a,void 0)}var c=e._useStrictMode,f={},p=!1;const g={};for(var a in e)if(!w4[a]){var s=a.slice(0,2)==="on",y=r[a]!==e[a];if(s&&y){var l=a.substr(2).toLowerCase();l.substr(0,7)==="content"&&(l="content"+l.substr(7,1).toUpperCase()+l.substr(8)),e[a]&&(g[l]=e[a])}!s&&(e[a]!==r[a]||c&&e[a]!==t.getAttr(a))&&(p=!0,f[a]=e[a])}p&&(t.setAttrs(f),df(t));for(var l in g)t.on(l+A_,g[l])}function df(t){if(!SV.Konva.autoDrawEnabled){var e=t.getLayer()||t.getStage();e&&e.batchDraw()}}var U2=Yk();const DL={},EV={};Av.Node.prototype._applyProps=W1;function TV(t,e){if(typeof e=="string"){console.error(`Do not use plain text as child of Konva.Node. You are using text: ${e}`);return}t.add(e),df(t)}function NV(t,e,r){let n=Av[t];n||(console.error(`Konva has no node with the type ${t}. Group will be used instead. If you use minimal version of react-konva, just import required nodes into Konva: "import "konva/lib/shapes/${t}"  If you want to render DOM elements as part of canvas tree take a look into this demo: https://konvajs.github.io/docs/react/DOM_Portal.html`),n=Av.Group);const i={},a={};for(var s in e){var o=s.slice(0,2)==="on";o?a[s]=e[s]:i[s]=e[s]}const l=new n(i);return W1(l,a),l}function PV(t,e,r){console.error(`Text components are not supported for now in ReactKonva. Your text is: "${t}"`)}function MV(t,e,r){return!1}function AV(t){return t}function LV(){return null}function RV(){return null}function OV(t,e,r,n){return EV}function DV(){}function IV(t){}function jV(t,e){return!1}function FV(){return DL}function BV(){return DL}const zV=setTimeout,UV=clearTimeout,GV=-1;function VV(t,e){return!1}const HV=!1,WV=!0,qV=!0;function $V(t,e){e.parent===t?e.moveToTop():t.add(e),df(t)}function KV(t,e){e.parent===t?e.moveToTop():t.add(e),df(t)}function IL(t,e,r){e._remove(),t.add(e),e.setZIndex(r.getZIndex()),df(t)}function ZV(t,e,r){IL(t,e,r)}function YV(t,e){e.destroy(),e.off(A_),df(t)}function XV(t,e){e.destroy(),e.off(A_),df(t)}function QV(t,e,r){console.error(`Text components are not yet supported in ReactKonva. You text is: "${r}"`)}function JV(t,e,r){}function eH(t,e,r,n,i){W1(t,i,n)}function tH(t){t.hide(),df(t)}function rH(t){}function nH(t,e){(e.visible==null||e.visible)&&t.show()}function iH(t,e){}function aH(t){}function sH(){}const oH=()=>OL.DefaultEventPriority,lH=Object.freeze(Object.defineProperty({__proto__:null,appendChild:$V,appendChildToContainer:KV,appendInitialChild:TV,cancelTimeout:UV,clearContainer:aH,commitMount:JV,commitTextUpdate:QV,commitUpdate:eH,createInstance:NV,createTextInstance:PV,detachDeletedInstance:sH,finalizeInitialChildren:MV,getChildHostContext:BV,getCurrentEventPriority:oH,getPublicInstance:AV,getRootHostContext:FV,hideInstance:tH,hideTextInstance:rH,idlePriority:U2.unstable_IdlePriority,insertBefore:IL,insertInContainerBefore:ZV,isPrimaryRenderer:HV,noTimeout:GV,now:U2.unstable_now,prepareForCommit:LV,preparePortalMount:RV,prepareUpdate:OV,removeChild:YV,removeChildFromContainer:XV,resetAfterCommit:DV,resetTextContent:IV,run:U2.unstable_runWithPriority,scheduleTimeout:zV,shouldDeprioritizeSubtree:jV,shouldSetTextContent:VV,supportsMutation:qV,unhideInstance:nH,unhideTextInstance:iH,warnsIfNotActing:WV},Symbol.toStringTag,{value:"Module"}));var uH=Object.defineProperty,cH=Object.defineProperties,dH=Object.getOwnPropertyDescriptors,_4=Object.getOwnPropertySymbols,fH=Object.prototype.hasOwnProperty,hH=Object.prototype.propertyIsEnumerable,C4=(t,e,r)=>e in t?uH(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,E4=(t,e)=>{for(var r in e||(e={}))fH.call(e,r)&&C4(t,r,e[r]);if(_4)for(var r of _4(e))hH.call(e,r)&&C4(t,r,e[r]);return t},pH=(t,e)=>cH(t,dH(e)),T4,N4;typeof window<"u"&&((T4=window.document)!=null&&T4.createElement||((N4=window.navigator)==null?void 0:N4.product)==="ReactNative")?ne.useLayoutEffect:ne.useEffect;function jL(t,e,r){if(!t)return;if(r(t)===!0)return t;let n=t.child;for(;n;){const i=jL(n,e,r);if(i)return i;n=n.sibling}}function FL(t){try{return Object.defineProperties(t,{_currentRenderer:{get(){return null},set(){}},_currentRenderer2:{get(){return null},set(){}}})}catch{return t}}const P4=console.error;console.error=function(){const t=[...arguments].join("");if(t?.startsWith("Warning:")&&t.includes("useContext")){console.error=P4;return}return P4.apply(this,arguments)};const L_=FL(ne.createContext(null));class BL extends ne.Component{render(){return ne.createElement(L_.Provider,{value:this._reactInternals},this.props.children)}}function mH(){const t=ne.useContext(L_);if(t===null)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const e=ne.useId();return ne.useMemo(()=>{for(const n of[t,t?.alternate]){if(!n)continue;const i=jL(n,!1,a=>{let s=a.memoizedState;for(;s;){if(s.memoizedState===e)return!0;s=s.next}});if(i)return i}},[t,e])}function gH(){const t=mH(),[e]=ne.useState(()=>new Map);e.clear();let r=t;for(;r;){if(r.type&&typeof r.type=="object"){const i=r.type._context===void 0&&r.type.Provider===r.type?r.type:r.type._context;i&&i!==L_&&!e.has(i)&&e.set(i,ne.useContext(FL(i)))}r=r.return}return e}function vH(){const t=gH();return ne.useMemo(()=>Array.from(t.keys()).reduce((e,r)=>n=>ne.createElement(e,null,ne.createElement(r.Provider,pH(E4({},n),{value:t.get(r)}))),e=>ne.createElement(BL,E4({},e))),[t])}function yH(t){const e=Qt.useRef({});return Qt.useLayoutEffect(()=>{e.current=t}),Qt.useLayoutEffect(()=>()=>{e.current={}},[]),e.current}const xH=t=>{const e=Qt.useRef(),r=Qt.useRef(),n=Qt.useRef(),i=yH(t),a=vH(),s=o=>{const{forwardedRef:l}=t;l&&(typeof l=="function"?l(o):l.current=o)};return Qt.useLayoutEffect(()=>(r.current=new Av.Stage({width:t.width,height:t.height,container:e.current}),s(r.current),n.current=Zg.createContainer(r.current,OL.LegacyRoot,!1,null),Zg.updateContainer(Qt.createElement(a,{},t.children),n.current),()=>{Av.isBrowser&&(s(null),Zg.updateContainer(null,n.current,null),r.current.destroy())}),[]),Qt.useLayoutEffect(()=>{s(r.current),W1(r.current,t,i),Zg.updateContainer(Qt.createElement(a,{},t.children),n.current,null)}),Qt.createElement("div",{ref:e,id:t.id,accessKey:t.accessKey,className:t.className,role:t.role,style:t.style,tabIndex:t.tabIndex,title:t.title})},Sx="Layer",kx="Rect",bH="Circle",zL="Line",wH="Image",SH="Text",kH="Path",UL="Transformer",Zg=xV(lH);Zg.injectIntoDevTools({findHostInstanceByFiber:()=>null,bundleType:0,version:Qt.version,rendererPackageName:"react-konva"});const GL=Qt.forwardRef((t,e)=>Qt.createElement(BL,{},Qt.createElement(xH,{...t,forwardedRef:e}))),_H=({isOpen:t,onClose:e,onConfirm:r,title:n,message:i,initialValue:a="",placeholder:s="",confirmText:o="Confirmar",cancelText:l="Cancelar"})=>{const[u,c]=ne.useState(a),f=ne.useRef(null);if(ne.useEffect(()=>{c(a)},[a,t]),ne.useEffect(()=>{t&&f.current&&setTimeout(()=>f.current.focus(),50)},[t]),!t)return null;const p=g=>{g.preventDefault(),r(u),e()};return eo.createPortal(m.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/80 backdrop-blur-md animate-in fade-in duration-300",children:m.jsxs("div",{className:"bg-[#0f0f13] border border-white/10 rounded-2xl p-6 shadow-2xl shadow-black/50 w-full max-w-md space-y-5 animate-in zoom-in-95 slide-in-from-bottom-2 duration-300 relative overflow-hidden ring-1 ring-white/5",onClick:g=>g.stopPropagation(),children:[m.jsx("div",{className:"absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-primary to-transparent opacity-70"}),m.jsx("div",{className:"absolute -top-10 -right-10 size-40 bg-primary/5 rounded-full blur-3xl pointer-events-none"}),m.jsxs("div",{children:[m.jsx("h3",{className:"text-xl font-bold text-white tracking-tight",children:n}),i&&m.jsx("p",{className:"text-sm text-slate-400 leading-relaxed mt-2",children:i})]}),m.jsxs("form",{onSubmit:p,className:"space-y-6",children:[m.jsx("input",{ref:f,type:"text",value:u,onChange:g=>c(g.target.value),placeholder:s,className:"w-full bg-black/30 border border-white/10 rounded-xl px-4 py-3.5 text-white placeholder-slate-600 focus:border-primary/50 focus:ring-1 focus:ring-primary/50 outline-none transition-all font-sans text-sm shadow-inner"}),m.jsxs("div",{className:"flex justify-end gap-3 pt-2",children:[m.jsx("button",{type:"button",onClick:e,className:"px-4 py-2 text-sm text-slate-400 hover:text-white transition-colors",children:l}),m.jsx(Pn,{type:"submit",variant:"primary",disabled:!u.trim(),children:o})]})]})]})}),document.body)},CH=({settings:t,onUpdate:e})=>{const{t:r}=Ps();if(!t)return null;const n=(i,a)=>{e({...t,[i]:a})};return m.jsxs("div",{className:"p-6 space-y-8 animate-in fade-in slide-in-from-right-4",children:[m.jsxs("div",{className:"flex items-center gap-3 text-slate-400 mb-2",children:[m.jsx("span",{className:"material-symbols-outlined",children:"tune"}),m.jsx("h3",{className:"text-xs font-black uppercase tracking-widest",children:r("map.settings")||"Settings"})]}),m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("label",{className:"text-sm font-bold text-white flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-slate-500",children:"grid_4x4"}),r("map.show_grid")||"Show Grid"]}),m.jsx("input",{type:"checkbox",checked:t.showGrid||!1,onChange:i=>n("showGrid",i.target.checked),className:"accent-primary size-5 rounded cursor-pointer"})]}),t.showGrid&&m.jsxs("div",{children:[m.jsxs("label",{className:"text-[10px] uppercase font-bold text-slate-500 mb-2 block",children:[r("map.grid_size")||"Grid Size"," (px)"]}),m.jsx("input",{type:"range",min:"20",max:"200",step:"10",value:t.gridSize||50,onChange:i=>n("gridSize",parseInt(i.target.value)),className:"w-full accent-primary mb-2"}),m.jsxs("div",{className:"flex justify-between text-[10px] font-mono text-slate-500",children:[m.jsx("span",{children:"20px"}),m.jsxs("span",{className:"text-primary font-bold",children:[t.gridSize||50,"px"]}),m.jsx("span",{children:"200px"})]})]})]}),m.jsx("div",{className:"h-px bg-white/5 my-4"}),m.jsxs("div",{className:"space-y-4",children:[m.jsxs("h4",{className:"text-[10px] uppercase font-bold text-slate-500 tracking-widest mb-4 flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"aspect_ratio"}),r("map.dimensions")||"Dimensions"]}),m.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[m.jsxs("div",{children:[m.jsx("label",{className:"text-[10px] uppercase font-bold text-slate-600 mb-1 block",children:"Width"}),m.jsx("input",{type:"number",value:t.width||800,onChange:i=>n("width",parseInt(i.target.value)),className:"w-full bg-black/30 border border-white/10 rounded-lg p-2 text-white font-mono text-xs focus:border-primary outline-none"})]}),m.jsxs("div",{children:[m.jsx("label",{className:"text-[10px] uppercase font-bold text-slate-600 mb-1 block",children:"Height"}),m.jsx("input",{type:"number",value:t.height||600,onChange:i=>n("height",parseInt(i.target.value)),className:"w-full bg-black/30 border border-white/10 rounded-lg p-2 text-white font-mono text-xs focus:border-primary outline-none"})]})]})]}),m.jsx("div",{className:"h-px bg-white/5 my-4"}),m.jsxs("div",{className:"space-y-2",children:[m.jsxs("h4",{className:"text-[10px] uppercase font-bold text-slate-500 tracking-widest mb-2 flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"image"}),r("map.background")||"Background"]}),t.bgImage?m.jsxs("div",{className:"w-full h-32 rounded-xl border border-white/10 overflow-hidden relative group",children:[m.jsx("img",{src:t.bgImage,className:"w-full h-full object-cover opacity-50"}),m.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:m.jsxs("span",{className:"text-xs font-mono text-white/50",children:[t.width,"x",t.height]})})]}):m.jsx("div",{className:"p-4 rounded-xl border border-dashed border-white/10 text-center text-xs text-slate-500",children:"No background image"})]})]})},G2=({stepNumber:t,title:e,isOpen:r,onClick:n,children:i})=>m.jsxs("div",{className:`border border-white/10 rounded-2xl bg-[#13141f] overflow-hidden transition-all duration-300 ${r?"ring-1 ring-primary/50":"opacity-80"}`,children:[m.jsxs("button",{onClick:n,className:"w-full flex items-center justify-between p-6 hover:bg-white/5 transition-colors",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("div",{className:`size-8 rounded-full flex items-center justify-center font-black text-sm ${r?"bg-primary text-white":"bg-white/10 text-slate-400"}`,children:t}),m.jsx("h3",{className:`text-lg font-bold ${r?"text-white":"text-slate-400"}`,children:e})]}),m.jsx("span",{className:`material-symbols-outlined transition-transform duration-300 ${r?"rotate-180 text-primary":"text-slate-500"}`,children:"expand_more"})]}),r&&m.jsx("div",{className:"p-6 pt-0 border-t border-white/5 animate-in fade-in slide-in-from-top-2",children:i})]}),V2=({icon:t,title:e,desc:r,selected:n,onClick:i})=>m.jsxs("div",{onClick:i,className:`p-6 rounded-xl border cursor-pointer transition-all relative group h-full flex flex-col justify-between ${n?"bg-primary/20 border-primary shadow-[0_0_30px_rgba(var(--color-primary),0.3)]":"bg-[#0a0a0c] border-white/10 hover:border-white/30"}`,children:[m.jsxs("div",{className:"mb-4",children:[m.jsx("div",{className:`size-12 rounded-lg flex items-center justify-center mb-4 ${n?"bg-primary text-white":"bg-white/10 text-slate-400 group-hover:text-white group-hover:bg-white/20"}`,children:m.jsx("span",{className:"material-symbols-outlined text-2xl",children:t})}),m.jsx("h4",{className:"font-bold text-white mb-1",children:e}),m.jsx("p",{className:"text-xs text-slate-500 leading-relaxed",children:r})]}),n&&m.jsx("div",{className:"absolute top-4 right-4 size-3 bg-primary rounded-full shadow-glow"})]}),EH=({src:t,x:e,y:r,width:n,height:i,...a})=>{const[s,o]=ne.useState(null);return ne.useEffect(()=>{if(!t)return;const l=new window.Image;l.src=t,l.crossOrigin="Anonymous",l.onload=()=>{o(l)}},[t]),m.jsx(wH,{image:s,x:e,y:r,width:n,height:i,...a})},TH=({selectedId:t})=>{const e=Qt.useRef();return Qt.useEffect(()=>{if(t){const r=e.current.getStage().findOne("#"+t);r&&(e.current.nodes([r]),e.current.getLayer().batchDraw())}else e.current.nodes([])},[t]),m.jsx(UL,{ref:e})},ok=({mode:t})=>{const{username:e,projectName:r,folderId:n,entityId:i}=Va(),a=Ga(),s=af(),{setRightOpen:o,setRightPanelTab:l,setAvailableTemplates:u,mapSettings:c,setMapSettings:f}=bo(),[p,g]=ne.useState(t==="create"?"setup":"editor"),[y,S]=ne.useState(null);ne.useEffect(()=>{g(t==="create"?"setup":"editor")},[t]);const[w,C]=ne.useState(s.state?.folderId||null),[_,T]=ne.useState(1),[N,R]=ne.useState({name:"New Map",description:"",parentZone:null,type:"regional",sourceType:"blank",dims:{width:800,height:600},bgImage:null}),[D,j]=ne.useState(!1),[O,F]=ne.useState("brush"),[z,G]=ne.useState([]),[Z,I]=ne.useState([]),[W,U]=ne.useState([]),[K,$]=ne.useState(null),Q=Qt.useRef(!1),[ie,te]=ne.useState({isOpen:!1,id:null,text:""}),X=ue=>{(ue.target===ue.target.getStage()||ue.target.name()==="bg-image")&&$(null)},re=ue=>{X(ue);const Se=ue.target.getStage().getPointerPosition();O!=="select"&&(Q.current=!0,O==="brush"||O==="eraser"?G([...z,{id:`line-${Date.now()}`,tool:O,points:[Se.x,Se.y],color:O==="eraser"?"#ffffff":"#df4b26",size:O==="eraser"?20:5}]):O==="rect"?I([...Z,{id:`rect-${Date.now()}`,x:Se.x,y:Se.y,width:0,height:0,color:"#df4b26"}]):O==="text"&&(U([...W,{id:`text-${Date.now()}`,x:Se.x,y:Se.y,text:"Double click to edit",fontSize:20,color:"#ffffff"}]),Q.current=!1))},fe=ue=>{if(!Q.current)return;const Se=ue.target.getStage().getPointerPosition();O==="brush"||O==="eraser"?G(Ae=>{const Me=[...Ae],st={...Me[Me.length-1]};return st.points=st.points.concat([Se.x,Se.y]),Me[Me.length-1]=st,Me}):O==="rect"&&I(Ae=>{const Me=[...Ae],st={...Me[Me.length-1]};return st.width=Se.x-st.x,st.height=Se.y-st.y,Me[Me.length-1]=st,Me})},oe=()=>{Q.current=!1};ne.useEffect(()=>{if(o(p==="editor"),p==="editor"){l&&l("CONTEXT");const xe={showGrid:!0,gridSize:50,width:N.dims.width,height:N.dims.height};f(xe)}const ue=setInterval(()=>{const xe=document.getElementById("global-right-panel-portal");xe&&(S(xe),clearInterval(ue))},100);return()=>{clearInterval(ue),l&&l("NOTEBOOKS")}},[p,l]);const se=ue=>{f(ue),R(xe=>({...xe,dims:{width:ue.width,height:ue.height},bgImage:ue.bgImage||xe.bgImage}))};ne.useEffect(()=>{t==="create"&&!w&&n&&(console.log("Resolving folder ID for slug:",n),$e.get(`/world-bible/folders/${n}`).then(ue=>C(ue.id)).catch(ue=>console.error("Could not resolve folder ID",ue)))},[t,n,w]);const he=ue=>{const xe=ue.target.files[0];if(xe){const Se=new FileReader;Se.onload=Ae=>{const Me=new Image;Me.onload=()=>{R(st=>({...st,bgImage:Ae.target.result,dims:{width:Me.width,height:Me.height},sourceType:"upload"}))},Me.src=Ae.target.result},Se.readAsDataURL(xe)}},ae=Qt.useRef(null),pe=async()=>{if(!w){alert("Folder context missing. Please start from the folder view again.");return}j(!0);try{let ue=N.bgImage;if(ae.current){const Ae=ae.current.findOne("Transformer");if(Ae&&Ae.nodes([]),ue=ae.current.toDataURL({pixelRatio:.5}),Ae&&K){const Me=ae.current.findOne("#"+K);Me&&Ae.nodes([Me])}}const xe={nombre:N.name,tipoEspecial:"map",carpetaId:w,descripcion:N.description,attributes:{type:N.type,width:N.dims.width,height:N.dims.height,bgImage:N.bgImage,layers:{lines:z,rectangles:Z,texts:W},snapshotUrl:ue},iconUrl:ue},Se=await $e.post("/world-bible/entities",xe);window.dispatchEvent(new CustomEvent("folder-update",{detail:{folderId:w}})),a(`/${e}/${r}/map-editor/edit/${Se.id}`,{replace:!0})}catch(ue){console.error(ue),alert("Error creating map. Check console.")}finally{j(!1)}},ye=Qt.useRef(null);ne.useEffect(()=>{(!t||t==="edit")&&i&&$e.get(`/world-bible/entities/${i}`).then(ue=>{C(ue.carpetaId),ye.current=ue.iconUrl,g("editor");let xe=ue.attributes||{},Se={};const Ae=xe.layers||xe.bgImage;if(!Ae&&ue.descripcion&&ue.descripcion.trim().startsWith("{"))try{Se=JSON.parse(ue.descripcion)}catch(rt){console.error("Error parsing legacy map data",rt)}const Me=Ae?xe:Se;let st=ue.descripcion;ue.descripcion&&ue.descripcion.trim().startsWith("{")&&(st=Se.description||""),R({name:ue.nombre,description:st||"",parentZone:null,type:Me.type||"regional",sourceType:Me.bgImage?"upload":"blank",dims:{width:Me.width||800,height:Me.height||600},bgImage:Me.bgImage}),Me.layers&&(G(Me.layers.lines||[]),I(Me.layers.rectangles||[]),U(Me.layers.texts||[])),f({name:ue.nombre,description:st||"",type:Me.type||"regional",showGrid:!0,gridSize:50,width:Me.width||800,height:Me.height||600,bgImage:Me.bgImage})}).catch(ue=>console.error("Error loading entity",ue))},[t,i]);const ve=async()=>{j(!0);try{let ue=N.bgImage;if(ae.current){$(null);const Se=ae.current.findOne("Transformer");Se&&Se.nodes([]),ue=ae.current.toDataURL({pixelRatio:.5})}const xe={id:i,nombre:N.name,tipoEspecial:"map",carpetaId:w,descripcion:N.description,attributes:{type:N.type,width:N.dims.width,height:N.dims.height,bgImage:N.bgImage,layers:{lines:z,rectangles:Z,texts:W},snapshotUrl:ue},iconUrl:ye.current};await $e.put(`/world-bible/entities/${i}`,xe),a(w?`/${e}/${r}/bible/folder/${w}`:`/${e}/${r}/bible`)}catch(ue){console.error("Save failed",ue),alert("Error saving map")}finally{j(!1)}};return p==="setup"?m.jsxs("div",{className:"flex-1 flex flex-col h-screen bg-[#060608] text-white",children:[m.jsxs("div",{className:"h-16 border-b border-white/5 flex items-center justify-between px-8 bg-[#0a0a0c]",children:[m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsx("div",{className:"p-2 bg-primary/20 rounded-lg text-primary",children:m.jsx("span",{className:"material-symbols-outlined",children:"add_circle"})}),m.jsxs("div",{children:[m.jsx("h1",{className:"text-lg font-bold leading-tight",children:"Create New Map / Zone"}),m.jsx("p",{className:"text-[10px] text-slate-500 uppercase font-bold tracking-wider",children:"Configure details for your new cartography entry"})]})]}),m.jsx("button",{onClick:()=>a(-1),className:"p-2 hover:bg-white/5 rounded-full text-slate-500 hover:text-white transition-colors",children:m.jsx("span",{className:"material-symbols-outlined",children:"close"})})]}),m.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-8",children:m.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[m.jsx(G2,{stepNumber:"1",title:"Identity & Hierarchy",isOpen:_===1,onClick:()=>T(1),children:m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{children:[m.jsx("label",{className:"text-[10px] uppercase font-bold text-slate-500 mb-2 block",children:"Map Name"}),m.jsx("input",{autoFocus:!0,value:N.name,onChange:ue=>R({...N,name:ue.target.value}),className:"w-full bg-[#0a0a0c] border border-white/10 rounded-xl p-4 text-white focus:border-primary outline-none transition-colors",placeholder:"e.g. The Sapphire Coast"})]}),m.jsxs("div",{children:[m.jsx("label",{className:"text-[10px] uppercase font-bold text-slate-500 mb-2 block",children:"Parent Zone (Optional)"}),m.jsxs("div",{className:"w-full bg-[#0a0a0c] border border-white/10 rounded-xl p-4 text-slate-400 flex items-center justify-between cursor-pointer hover:border-white/20",children:[m.jsx("span",{children:"Current Folder (Default)"}),m.jsx("span",{className:"material-symbols-outlined text-sm",children:"expand_more"})]}),m.jsx("p",{className:"text-[10px] text-slate-600 mt-2",children:"Selecting a parent makes this a sub-zone."})]})]}),m.jsxs("div",{children:[m.jsx("label",{className:"text-[10px] uppercase font-bold text-slate-500 mb-2 block",children:"Description"}),m.jsx("textarea",{value:N.description,onChange:ue=>R({...N,description:ue.target.value}),className:"w-full h-40 bg-[#0a0a0c] border border-white/10 rounded-xl p-4 text-white resize-none focus:border-primary outline-none transition-colors leading-relaxed",placeholder:"Brief description of geography, climate, or importance..."})]})]})}),m.jsx(G2,{stepNumber:"2",title:"Map Type",isOpen:_===2,onClick:()=>T(2),children:m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[m.jsx(V2,{icon:"public",title:"World Map",desc:"Continents, oceans, global scale.",selected:N.type==="world",onClick:()=>R({...N,type:"world"})}),m.jsx(V2,{icon:"map",title:"Regional Map",desc:"Kingdoms, provinces, biomes.",selected:N.type==="regional",onClick:()=>R({...N,type:"regional"})}),m.jsx(V2,{icon:"location_city",title:"City / Local",desc:"Cities, dungeons, battlemaps.",selected:N.type==="local",onClick:()=>R({...N,type:"local"})})]})}),m.jsx(G2,{stepNumber:"3",title:"Canvas Source",isOpen:_===3,onClick:()=>T(3),children:m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[m.jsxs("div",{onClick:()=>document.getElementById("map-upload-input").click(),className:`relative p-8 rounded-xl border-2 border-dashed flex flex-col items-center justify-center text-center cursor-pointer transition-all group min-h-[200px] ${N.sourceType==="upload"?"border-primary bg-primary/5":"border-white/10 hover:border-white/30 bg-[#0a0a0c]"}`,children:[m.jsx("input",{id:"map-upload-input",type:"file",accept:"image/*",className:"hidden",onChange:he}),N.bgImage?m.jsx("img",{src:N.bgImage,alt:"Preview",className:"absolute inset-0 w-full h-full object-cover rounded-xl opacity-50 group-hover:opacity-70"}):m.jsxs(m.Fragment,{children:[m.jsx("div",{className:"size-16 bg-white/5 rounded-full flex items-center justify-center mb-4 group-hover:scale-110 transition-transform",children:m.jsx("span",{className:"material-symbols-outlined text-3xl text-slate-400",children:"cloud_upload"})}),m.jsx("h4",{className:"font-bold text-white",children:"Upload Image File"}),m.jsx("p",{className:"text-xs text-slate-500 mt-2",children:"Drag & drop or click to browse"}),m.jsx("p",{className:"text-[10px] text-slate-600 mt-1 uppercase font-bold",children:"JPG, PNG, WEBP  Max 20MB"})]}),N.sourceType==="upload"&&m.jsx("div",{className:"absolute top-4 right-4 size-3 bg-primary rounded-full shadow-glow z-10"})]}),m.jsxs("div",{onClick:()=>R({...N,sourceType:"blank",bgImage:null}),className:`p-8 rounded-xl border flex flex-col items-center justify-center text-center cursor-pointer transition-all min-h-[200px] ${N.sourceType==="blank"?"border-primary bg-primary/5":"border-white/10 hover:border-white/30 bg-[#0a0a0c]"}`,children:[m.jsx("div",{className:"size-16 bg-white/5 rounded-full flex items-center justify-center mb-4",children:m.jsx("span",{className:"material-symbols-outlined text-3xl text-slate-400",children:"check_box_outline_blank"})}),m.jsx("h4",{className:"font-bold text-white",children:"Blank Canvas"}),m.jsx("p",{className:"text-xs text-slate-500 mt-2",children:"Start a new drawing from scratch"}),N.sourceType==="blank"&&m.jsxs("div",{className:"mt-6 flex items-center gap-2 bg-black/50 p-1 rounded-lg border border-white/10",children:[m.jsx("span",{className:"text-[10px] uppercase font-bold text-slate-500 px-2",children:"Size"}),m.jsx("span",{className:"text-xs font-mono text-white",children:"4096 px"}),m.jsx("span",{className:"text-xs text-slate-500",children:"x"}),m.jsx("span",{className:"text-xs font-mono text-white",children:"4096 px"})]})]})]})})]})}),m.jsxs("div",{className:"h-20 border-t border-white/5 bg-[#0a0a0c] flex items-center justify-between px-8 z-20",children:[m.jsx("button",{onClick:()=>a(-1),className:"text-sm font-bold text-slate-500 hover:text-white transition-colors",children:"Cancel"}),m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("span",{className:"text-xs text-slate-600 italic",children:"Changes saved locally"}),m.jsx(Pn,{variant:"primary",size:"lg",icon:"check",onClick:pe,disabled:!N.name||D,className:"bg-primary hover:bg-primary-light text-white shadow-lg shadow-primary/25 px-8",children:D?"Creating...":"Create Map"})]})]})]}):m.jsxs("div",{className:"flex flex-col h-screen w-full bg-[#0f0f13] text-white overflow-hidden",children:[y&&eo.createPortal(m.jsx(CH,{settings:c,onUpdate:se}),y),m.jsxs("header",{className:"h-14 border-b border-white/5 flex items-center justify-between px-4 bg-[#1a1a20] shrink-0",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("button",{onClick:()=>a(-1),className:"p-2 hover:bg-white/5 rounded-full",title:"Back to Collection",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"arrow_back"})}),m.jsxs("div",{className:"flex flex-col",children:[m.jsx("input",{value:N.name,onChange:ue=>R({...N,name:ue.target.value}),className:"bg-transparent font-bold text-sm outline-none focus:bg-white/5 rounded px-2 -ml-2"}),m.jsxs("span",{className:"text-[10px] text-text-muted px-2",children:[N.dims.width," x ",N.dims.height,"  ",c?.gridSize||50,"px Grid"]})]})]}),m.jsx("div",{className:"flex items-center gap-2",children:m.jsx(Pn,{variant:"primary",size:"sm",icon:"save",onClick:ve,disabled:D,children:D?"Saving...":"Save Changes"})})]}),m.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[m.jsx("div",{className:"w-14 bg-[#1a1a20] border-r border-white/5 flex flex-col items-center py-4 gap-4 z-10",children:[{id:"select",icon:"near_me"},{id:"brush",icon:"brush"},{id:"eraser",icon:"ink_eraser"},{id:"rect",icon:"check_box_outline_blank"},{id:"text",icon:"title"}].map(ue=>m.jsx("button",{onClick:()=>F(ue.id),className:`p-2 rounded-lg transition-colors ${O===ue.id?"bg-primary text-white shadow-lg shadow-primary/30":"hover:bg-white/5 text-slate-400 hover:text-white"}`,children:m.jsx("span",{className:"material-symbols-outlined",children:ue.icon})},ue.id))}),m.jsx("div",{className:"flex-1 overflow-auto bg-[#0f0f13] relative flex items-center justify-center p-8 custom-scrollbar",children:m.jsx("div",{className:"bg-[#1a1a20] shadow-[0_0_50px_rgba(0,0,0,0.5)] flex-none",children:m.jsxs(GL,{ref:ae,width:N.dims.width,height:N.dims.height,onMouseDown:re,onMouseMove:fe,onMouseUp:oe,className:"bg-white",children:[m.jsxs(Sx,{children:[N.bgImage&&m.jsx(EH,{name:"bg-image",src:N.bgImage,x:0,y:0,width:N.dims.width,height:N.dims.height,onMouseDown:re,onTouchStart:re}),c?.showGrid&&m.jsx(kx,{width:N.dims.width,height:N.dims.height,fillPatternImage:(()=>{const ue=document.createElement("canvas");ue.width=c.gridSize||50,ue.height=c.gridSize||50;const xe=ue.getContext("2d");return xe.strokeStyle="rgba(0,0,0,0.2)",xe.lineWidth=1,xe.strokeRect(0,0,ue.width,ue.height),ue})(),listening:!1})]}),m.jsxs(Sx,{children:[z.map((ue,xe)=>m.jsx(zL,{points:ue.points,stroke:ue.color,strokeWidth:ue.size,tension:.5,lineCap:"round",lineJoin:"round",globalCompositeOperation:ue.tool==="eraser"?"destination-out":"source-over"},xe)),Z.map((ue,xe)=>m.jsx(kx,{id:ue.id,x:ue.x,y:ue.y,width:ue.width,height:ue.height,stroke:ue.color,strokeWidth:2,draggable:O==="select",onClick:()=>O==="select"&&$(ue.id),onTap:()=>O==="select"&&$(ue.id)},ue.id)),W.map((ue,xe)=>m.jsx(SH,{id:ue.id,x:ue.x,y:ue.y,text:ue.text,fontSize:ue.fontSize,fill:ue.color,draggable:O==="select",onClick:()=>O==="select"&&$(ue.id),onTap:()=>O==="select"&&$(ue.id),onDblClick:Se=>{te({isOpen:!0,id:ue.id,text:ue.text})}},ue.id)),m.jsx(TH,{selectedId:K})]})]})})})]}),m.jsx(_H,{isOpen:ie.isOpen,onClose:()=>te(ue=>({...ue,isOpen:!1})),title:"Edit Map Text",initialValue:ie.text,onConfirm:ue=>{U(xe=>xe.map(Se=>Se.id===ie.id?{...Se,text:ue}:Se))},confirmText:"Save Text"})]})};function VL(t,e){const r=ne.useRef(e);ne.useEffect(function(){e!==r.current&&t.attributionControl!=null&&(r.current!=null&&t.attributionControl.removeAttribution(r.current),e!=null&&t.attributionControl.addAttribution(e)),r.current=e},[t,e])}const NH=1;function PH(t){return Object.freeze({__version:NH,map:t})}function l0(t,e){return Object.freeze({...t,...e})}const HL=ne.createContext(null),R_=HL.Provider;function pm(){const t=ne.useContext(HL);if(t==null)throw new Error("No context provided: useLeafletContext() can only be used in a descendant of <MapContainer>");return t}function O_(t){function e(r,n){const{instance:i,context:a}=t(r).current;return ne.useImperativeHandle(n,()=>i),r.children==null?null:Qt.createElement(R_,{value:a},r.children)}return ne.forwardRef(e)}function MH(t){function e(r,n){const[i,a]=ne.useState(!1),{instance:s}=t(r,a).current;ne.useImperativeHandle(n,()=>s),ne.useEffect(function(){i&&s.update()},[s,i,r.children]);const o=s._contentNode;return o?eo.createPortal(r.children,o):null}return ne.forwardRef(e)}function AH(t){return function(r){const n=pm(),i=t(r,n),{instance:a}=i.current,s=ne.useRef(r.position),{position:o}=r;return ne.useEffect(function(){return a.addTo(n.map),function(){a.remove()}},[n.map,a]),ne.useEffect(function(){o!=null&&o!==s.current&&(a.setPosition(o),s.current=o)},[a,o]),i}}function D_(t,e){const r=ne.useRef();ne.useEffect(function(){return e!=null&&t.instance.on(e),r.current=e,function(){r.current!=null&&t.instance.off(r.current),r.current=null}},[t,e])}function I_(t,e){const r=t.pane??e.pane;return r?{...t,pane:r}:t}function LH(t,e){return function(n,i){const a=pm(),s=t(I_(n,a),a);return VL(a.map,n.attribution),D_(s.current,n.eventHandlers),e(s.current,a,n,i),s}}var Yg={exports:{}};var RH=Yg.exports,M4;function OH(){return M4||(M4=1,(function(t,e){(function(r,n){n(e)})(RH,(function(r){var n="1.9.4";function i(h){var k,P,V,J;for(P=1,V=arguments.length;P<V;P++){J=arguments[P];for(k in J)h[k]=J[k]}return h}var a=Object.create||(function(){function h(){}return function(k){return h.prototype=k,new h}})();function s(h,k){var P=Array.prototype.slice;if(h.bind)return h.bind.apply(h,P.call(arguments,1));var V=P.call(arguments,2);return function(){return h.apply(k,V.length?V.concat(P.call(arguments)):arguments)}}var o=0;function l(h){return"_leaflet_id"in h||(h._leaflet_id=++o),h._leaflet_id}function u(h,k,P){var V,J,ce,we;return we=function(){V=!1,J&&(ce.apply(P,J),J=!1)},ce=function(){V?J=arguments:(h.apply(P,arguments),setTimeout(we,k),V=!0)},ce}function c(h,k,P){var V=k[1],J=k[0],ce=V-J;return h===V&&P?h:((h-J)%ce+ce)%ce+J}function f(){return!1}function p(h,k){if(k===!1)return h;var P=Math.pow(10,k===void 0?6:k);return Math.round(h*P)/P}function g(h){return h.trim?h.trim():h.replace(/^\s+|\s+$/g,"")}function y(h){return g(h).split(/\s+/)}function S(h,k){Object.prototype.hasOwnProperty.call(h,"options")||(h.options=h.options?a(h.options):{});for(var P in k)h.options[P]=k[P];return h.options}function w(h,k,P){var V=[];for(var J in h)V.push(encodeURIComponent(P?J.toUpperCase():J)+"="+encodeURIComponent(h[J]));return(!k||k.indexOf("?")===-1?"?":"&")+V.join("&")}var C=/\{ *([\w_ -]+) *\}/g;function _(h,k){return h.replace(C,function(P,V){var J=k[V];if(J===void 0)throw new Error("No value provided for variable "+P);return typeof J=="function"&&(J=J(k)),J})}var T=Array.isArray||function(h){return Object.prototype.toString.call(h)==="[object Array]"};function N(h,k){for(var P=0;P<h.length;P++)if(h[P]===k)return P;return-1}var R="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function D(h){return window["webkit"+h]||window["moz"+h]||window["ms"+h]}var j=0;function O(h){var k=+new Date,P=Math.max(0,16-(k-j));return j=k+P,window.setTimeout(h,P)}var F=window.requestAnimationFrame||D("RequestAnimationFrame")||O,z=window.cancelAnimationFrame||D("CancelAnimationFrame")||D("CancelRequestAnimationFrame")||function(h){window.clearTimeout(h)};function G(h,k,P){if(P&&F===O)h.call(k);else return F.call(window,s(h,k))}function Z(h){h&&z.call(window,h)}var I={__proto__:null,extend:i,create:a,bind:s,get lastId(){return o},stamp:l,throttle:u,wrapNum:c,falseFn:f,formatNum:p,trim:g,splitWords:y,setOptions:S,getParamString:w,template:_,isArray:T,indexOf:N,emptyImageUrl:R,requestFn:F,cancelFn:z,requestAnimFrame:G,cancelAnimFrame:Z};function W(){}W.extend=function(h){var k=function(){S(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},P=k.__super__=this.prototype,V=a(P);V.constructor=k,k.prototype=V;for(var J in this)Object.prototype.hasOwnProperty.call(this,J)&&J!=="prototype"&&J!=="__super__"&&(k[J]=this[J]);return h.statics&&i(k,h.statics),h.includes&&(U(h.includes),i.apply(null,[V].concat(h.includes))),i(V,h),delete V.statics,delete V.includes,V.options&&(V.options=P.options?a(P.options):{},i(V.options,h.options)),V._initHooks=[],V.callInitHooks=function(){if(!this._initHooksCalled){P.callInitHooks&&P.callInitHooks.call(this),this._initHooksCalled=!0;for(var ce=0,we=V._initHooks.length;ce<we;ce++)V._initHooks[ce].call(this)}},k},W.include=function(h){var k=this.prototype.options;return i(this.prototype,h),h.options&&(this.prototype.options=k,this.mergeOptions(h.options)),this},W.mergeOptions=function(h){return i(this.prototype.options,h),this},W.addInitHook=function(h){var k=Array.prototype.slice.call(arguments,1),P=typeof h=="function"?h:function(){this[h].apply(this,k)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(P),this};function U(h){if(!(typeof L>"u"||!L||!L.Mixin)){h=T(h)?h:[h];for(var k=0;k<h.length;k++)h[k]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",new Error().stack)}}var K={on:function(h,k,P){if(typeof h=="object")for(var V in h)this._on(V,h[V],k);else{h=y(h);for(var J=0,ce=h.length;J<ce;J++)this._on(h[J],k,P)}return this},off:function(h,k,P){if(!arguments.length)delete this._events;else if(typeof h=="object")for(var V in h)this._off(V,h[V],k);else{h=y(h);for(var J=arguments.length===1,ce=0,we=h.length;ce<we;ce++)J?this._off(h[ce]):this._off(h[ce],k,P)}return this},_on:function(h,k,P,V){if(typeof k!="function"){console.warn("wrong listener type: "+typeof k);return}if(this._listens(h,k,P)===!1){P===this&&(P=void 0);var J={fn:k,ctx:P};V&&(J.once=!0),this._events=this._events||{},this._events[h]=this._events[h]||[],this._events[h].push(J)}},_off:function(h,k,P){var V,J,ce;if(this._events&&(V=this._events[h],!!V)){if(arguments.length===1){if(this._firingCount)for(J=0,ce=V.length;J<ce;J++)V[J].fn=f;delete this._events[h];return}if(typeof k!="function"){console.warn("wrong listener type: "+typeof k);return}var we=this._listens(h,k,P);if(we!==!1){var Le=V[we];this._firingCount&&(Le.fn=f,this._events[h]=V=V.slice()),V.splice(we,1)}}},fire:function(h,k,P){if(!this.listens(h,P))return this;var V=i({},k,{type:h,target:this,sourceTarget:k&&k.sourceTarget||this});if(this._events){var J=this._events[h];if(J){this._firingCount=this._firingCount+1||1;for(var ce=0,we=J.length;ce<we;ce++){var Le=J[ce],je=Le.fn;Le.once&&this.off(h,je,Le.ctx),je.call(Le.ctx||this,V)}this._firingCount--}}return P&&this._propagateEvent(V),this},listens:function(h,k,P,V){typeof h!="string"&&console.warn('"string" type argument expected');var J=k;typeof k!="function"&&(V=!!k,J=void 0,P=void 0);var ce=this._events&&this._events[h];if(ce&&ce.length&&this._listens(h,J,P)!==!1)return!0;if(V){for(var we in this._eventParents)if(this._eventParents[we].listens(h,k,P,V))return!0}return!1},_listens:function(h,k,P){if(!this._events)return!1;var V=this._events[h]||[];if(!k)return!!V.length;P===this&&(P=void 0);for(var J=0,ce=V.length;J<ce;J++)if(V[J].fn===k&&V[J].ctx===P)return J;return!1},once:function(h,k,P){if(typeof h=="object")for(var V in h)this._on(V,h[V],k,!0);else{h=y(h);for(var J=0,ce=h.length;J<ce;J++)this._on(h[J],k,P,!0)}return this},addEventParent:function(h){return this._eventParents=this._eventParents||{},this._eventParents[l(h)]=h,this},removeEventParent:function(h){return this._eventParents&&delete this._eventParents[l(h)],this},_propagateEvent:function(h){for(var k in this._eventParents)this._eventParents[k].fire(h.type,i({layer:h.target,propagatedFrom:h.target},h),!0)}};K.addEventListener=K.on,K.removeEventListener=K.clearAllEventListeners=K.off,K.addOneTimeEventListener=K.once,K.fireEvent=K.fire,K.hasEventListeners=K.listens;var $=W.extend(K);function Q(h,k,P){this.x=P?Math.round(h):h,this.y=P?Math.round(k):k}var ie=Math.trunc||function(h){return h>0?Math.floor(h):Math.ceil(h)};Q.prototype={clone:function(){return new Q(this.x,this.y)},add:function(h){return this.clone()._add(te(h))},_add:function(h){return this.x+=h.x,this.y+=h.y,this},subtract:function(h){return this.clone()._subtract(te(h))},_subtract:function(h){return this.x-=h.x,this.y-=h.y,this},divideBy:function(h){return this.clone()._divideBy(h)},_divideBy:function(h){return this.x/=h,this.y/=h,this},multiplyBy:function(h){return this.clone()._multiplyBy(h)},_multiplyBy:function(h){return this.x*=h,this.y*=h,this},scaleBy:function(h){return new Q(this.x*h.x,this.y*h.y)},unscaleBy:function(h){return new Q(this.x/h.x,this.y/h.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=ie(this.x),this.y=ie(this.y),this},distanceTo:function(h){h=te(h);var k=h.x-this.x,P=h.y-this.y;return Math.sqrt(k*k+P*P)},equals:function(h){return h=te(h),h.x===this.x&&h.y===this.y},contains:function(h){return h=te(h),Math.abs(h.x)<=Math.abs(this.x)&&Math.abs(h.y)<=Math.abs(this.y)},toString:function(){return"Point("+p(this.x)+", "+p(this.y)+")"}};function te(h,k,P){return h instanceof Q?h:T(h)?new Q(h[0],h[1]):h==null?h:typeof h=="object"&&"x"in h&&"y"in h?new Q(h.x,h.y):new Q(h,k,P)}function X(h,k){if(h)for(var P=k?[h,k]:h,V=0,J=P.length;V<J;V++)this.extend(P[V])}X.prototype={extend:function(h){var k,P;if(!h)return this;if(h instanceof Q||typeof h[0]=="number"||"x"in h)k=P=te(h);else if(h=re(h),k=h.min,P=h.max,!k||!P)return this;return!this.min&&!this.max?(this.min=k.clone(),this.max=P.clone()):(this.min.x=Math.min(k.x,this.min.x),this.max.x=Math.max(P.x,this.max.x),this.min.y=Math.min(k.y,this.min.y),this.max.y=Math.max(P.y,this.max.y)),this},getCenter:function(h){return te((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,h)},getBottomLeft:function(){return te(this.min.x,this.max.y)},getTopRight:function(){return te(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(h){var k,P;return typeof h[0]=="number"||h instanceof Q?h=te(h):h=re(h),h instanceof X?(k=h.min,P=h.max):k=P=h,k.x>=this.min.x&&P.x<=this.max.x&&k.y>=this.min.y&&P.y<=this.max.y},intersects:function(h){h=re(h);var k=this.min,P=this.max,V=h.min,J=h.max,ce=J.x>=k.x&&V.x<=P.x,we=J.y>=k.y&&V.y<=P.y;return ce&&we},overlaps:function(h){h=re(h);var k=this.min,P=this.max,V=h.min,J=h.max,ce=J.x>k.x&&V.x<P.x,we=J.y>k.y&&V.y<P.y;return ce&&we},isValid:function(){return!!(this.min&&this.max)},pad:function(h){var k=this.min,P=this.max,V=Math.abs(k.x-P.x)*h,J=Math.abs(k.y-P.y)*h;return re(te(k.x-V,k.y-J),te(P.x+V,P.y+J))},equals:function(h){return h?(h=re(h),this.min.equals(h.getTopLeft())&&this.max.equals(h.getBottomRight())):!1}};function re(h,k){return!h||h instanceof X?h:new X(h,k)}function fe(h,k){if(h)for(var P=k?[h,k]:h,V=0,J=P.length;V<J;V++)this.extend(P[V])}fe.prototype={extend:function(h){var k=this._southWest,P=this._northEast,V,J;if(h instanceof se)V=h,J=h;else if(h instanceof fe){if(V=h._southWest,J=h._northEast,!V||!J)return this}else return h?this.extend(he(h)||oe(h)):this;return!k&&!P?(this._southWest=new se(V.lat,V.lng),this._northEast=new se(J.lat,J.lng)):(k.lat=Math.min(V.lat,k.lat),k.lng=Math.min(V.lng,k.lng),P.lat=Math.max(J.lat,P.lat),P.lng=Math.max(J.lng,P.lng)),this},pad:function(h){var k=this._southWest,P=this._northEast,V=Math.abs(k.lat-P.lat)*h,J=Math.abs(k.lng-P.lng)*h;return new fe(new se(k.lat-V,k.lng-J),new se(P.lat+V,P.lng+J))},getCenter:function(){return new se((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new se(this.getNorth(),this.getWest())},getSouthEast:function(){return new se(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(h){typeof h[0]=="number"||h instanceof se||"lat"in h?h=he(h):h=oe(h);var k=this._southWest,P=this._northEast,V,J;return h instanceof fe?(V=h.getSouthWest(),J=h.getNorthEast()):V=J=h,V.lat>=k.lat&&J.lat<=P.lat&&V.lng>=k.lng&&J.lng<=P.lng},intersects:function(h){h=oe(h);var k=this._southWest,P=this._northEast,V=h.getSouthWest(),J=h.getNorthEast(),ce=J.lat>=k.lat&&V.lat<=P.lat,we=J.lng>=k.lng&&V.lng<=P.lng;return ce&&we},overlaps:function(h){h=oe(h);var k=this._southWest,P=this._northEast,V=h.getSouthWest(),J=h.getNorthEast(),ce=J.lat>k.lat&&V.lat<P.lat,we=J.lng>k.lng&&V.lng<P.lng;return ce&&we},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(h,k){return h?(h=oe(h),this._southWest.equals(h.getSouthWest(),k)&&this._northEast.equals(h.getNorthEast(),k)):!1},isValid:function(){return!!(this._southWest&&this._northEast)}};function oe(h,k){return h instanceof fe?h:new fe(h,k)}function se(h,k,P){if(isNaN(h)||isNaN(k))throw new Error("Invalid LatLng object: ("+h+", "+k+")");this.lat=+h,this.lng=+k,P!==void 0&&(this.alt=+P)}se.prototype={equals:function(h,k){if(!h)return!1;h=he(h);var P=Math.max(Math.abs(this.lat-h.lat),Math.abs(this.lng-h.lng));return P<=(k===void 0?1e-9:k)},toString:function(h){return"LatLng("+p(this.lat,h)+", "+p(this.lng,h)+")"},distanceTo:function(h){return pe.distance(this,he(h))},wrap:function(){return pe.wrapLatLng(this)},toBounds:function(h){var k=180*h/40075017,P=k/Math.cos(Math.PI/180*this.lat);return oe([this.lat-k,this.lng-P],[this.lat+k,this.lng+P])},clone:function(){return new se(this.lat,this.lng,this.alt)}};function he(h,k,P){return h instanceof se?h:T(h)&&typeof h[0]!="object"?h.length===3?new se(h[0],h[1],h[2]):h.length===2?new se(h[0],h[1]):null:h==null?h:typeof h=="object"&&"lat"in h?new se(h.lat,"lng"in h?h.lng:h.lon,h.alt):k===void 0?null:new se(h,k,P)}var ae={latLngToPoint:function(h,k){var P=this.projection.project(h),V=this.scale(k);return this.transformation._transform(P,V)},pointToLatLng:function(h,k){var P=this.scale(k),V=this.transformation.untransform(h,P);return this.projection.unproject(V)},project:function(h){return this.projection.project(h)},unproject:function(h){return this.projection.unproject(h)},scale:function(h){return 256*Math.pow(2,h)},zoom:function(h){return Math.log(h/256)/Math.LN2},getProjectedBounds:function(h){if(this.infinite)return null;var k=this.projection.bounds,P=this.scale(h),V=this.transformation.transform(k.min,P),J=this.transformation.transform(k.max,P);return new X(V,J)},infinite:!1,wrapLatLng:function(h){var k=this.wrapLng?c(h.lng,this.wrapLng,!0):h.lng,P=this.wrapLat?c(h.lat,this.wrapLat,!0):h.lat,V=h.alt;return new se(P,k,V)},wrapLatLngBounds:function(h){var k=h.getCenter(),P=this.wrapLatLng(k),V=k.lat-P.lat,J=k.lng-P.lng;if(V===0&&J===0)return h;var ce=h.getSouthWest(),we=h.getNorthEast(),Le=new se(ce.lat-V,ce.lng-J),je=new se(we.lat-V,we.lng-J);return new fe(Le,je)}},pe=i({},ae,{wrapLng:[-180,180],R:6371e3,distance:function(h,k){var P=Math.PI/180,V=h.lat*P,J=k.lat*P,ce=Math.sin((k.lat-h.lat)*P/2),we=Math.sin((k.lng-h.lng)*P/2),Le=ce*ce+Math.cos(V)*Math.cos(J)*we*we,je=2*Math.atan2(Math.sqrt(Le),Math.sqrt(1-Le));return this.R*je}}),ye=6378137,ve={R:ye,MAX_LATITUDE:85.0511287798,project:function(h){var k=Math.PI/180,P=this.MAX_LATITUDE,V=Math.max(Math.min(P,h.lat),-P),J=Math.sin(V*k);return new Q(this.R*h.lng*k,this.R*Math.log((1+J)/(1-J))/2)},unproject:function(h){var k=180/Math.PI;return new se((2*Math.atan(Math.exp(h.y/this.R))-Math.PI/2)*k,h.x*k/this.R)},bounds:(function(){var h=ye*Math.PI;return new X([-h,-h],[h,h])})()};function ue(h,k,P,V){if(T(h)){this._a=h[0],this._b=h[1],this._c=h[2],this._d=h[3];return}this._a=h,this._b=k,this._c=P,this._d=V}ue.prototype={transform:function(h,k){return this._transform(h.clone(),k)},_transform:function(h,k){return k=k||1,h.x=k*(this._a*h.x+this._b),h.y=k*(this._c*h.y+this._d),h},untransform:function(h,k){return k=k||1,new Q((h.x/k-this._b)/this._a,(h.y/k-this._d)/this._c)}};function xe(h,k,P,V){return new ue(h,k,P,V)}var Se=i({},pe,{code:"EPSG:3857",projection:ve,transformation:(function(){var h=.5/(Math.PI*ve.R);return xe(h,.5,-h,.5)})()}),Ae=i({},Se,{code:"EPSG:900913"});function Me(h){return document.createElementNS("http://www.w3.org/2000/svg",h)}function st(h,k){var P="",V,J,ce,we,Le,je;for(V=0,ce=h.length;V<ce;V++){for(Le=h[V],J=0,we=Le.length;J<we;J++)je=Le[J],P+=(J?"L":"M")+je.x+" "+je.y;P+=k?Tt.svg?"z":"x":""}return P||"M0 0"}var rt=document.documentElement.style,dt="ActiveXObject"in window,Ct=dt&&!document.addEventListener,Ke="msLaunchUri"in navigator&&!("documentMode"in document),ut=xr("webkit"),ct=xr("android"),xt=xr("android 2")||xr("android 3"),ot=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),Lt=ct&&xr("Google")&&ot<537&&!("AudioNode"in window),Bt=!!window.opera,Ne=!Ke&&xr("chrome"),qe=xr("gecko")&&!ut&&!Bt&&!dt,St=!Ne&&xr("safari"),it=xr("phantom"),lt="OTransition"in rt,Ie=navigator.platform.indexOf("Win")===0,de=dt&&"transition"in rt,ge="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!xt,ke="MozPerspective"in rt,Ee=!window.L_DISABLE_3D&&(de||ge||ke)&&!lt&&!it,Re=typeof orientation<"u"||xr("mobile"),Qe=Re&&ut,Ge=Re&&ge,wt=!window.PointerEvent&&window.MSPointerEvent,bt=!!(window.PointerEvent||wt),pt="ontouchstart"in window||!!window.TouchEvent,Kt=!window.L_NO_TOUCH&&(pt||bt),Wt=Re&&Bt,Ve=Re&&qe,vt=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,Et=(function(){var h=!1;try{var k=Object.defineProperty({},"passive",{get:function(){h=!0}});window.addEventListener("testPassiveEventSupport",f,k),window.removeEventListener("testPassiveEventSupport",f,k)}catch{}return h})(),er=(function(){return!!document.createElement("canvas").getContext})(),gr=!!(document.createElementNS&&Me("svg").createSVGRect),Ir=!!gr&&(function(){var h=document.createElement("div");return h.innerHTML="<svg/>",(h.firstChild&&h.firstChild.namespaceURI)==="http://www.w3.org/2000/svg"})(),zr=!gr&&(function(){try{var h=document.createElement("div");h.innerHTML='<v:shape adj="1"/>';var k=h.firstChild;return k.style.behavior="url(#default#VML)",k&&typeof k.adj=="object"}catch{return!1}})(),Cr=navigator.platform.indexOf("Mac")===0,fn=navigator.platform.indexOf("Linux")===0;function xr(h){return navigator.userAgent.toLowerCase().indexOf(h)>=0}var Tt={ie:dt,ielt9:Ct,edge:Ke,webkit:ut,android:ct,android23:xt,androidStock:Lt,opera:Bt,chrome:Ne,gecko:qe,safari:St,phantom:it,opera12:lt,win:Ie,ie3d:de,webkit3d:ge,gecko3d:ke,any3d:Ee,mobile:Re,mobileWebkit:Qe,mobileWebkit3d:Ge,msPointer:wt,pointer:bt,touch:Kt,touchNative:pt,mobileOpera:Wt,mobileGecko:Ve,retina:vt,passiveEvents:Et,canvas:er,svg:gr,vml:zr,inlineSvg:Ir,mac:Cr,linux:fn},Ur=Tt.msPointer?"MSPointerDown":"pointerdown",Qn=Tt.msPointer?"MSPointerMove":"pointermove",Zi=Tt.msPointer?"MSPointerUp":"pointerup",ds=Tt.msPointer?"MSPointerCancel":"pointercancel",As={touchstart:Ur,touchmove:Qn,touchend:Zi,touchcancel:ds},ni={touchstart:on,touchmove:_o,touchend:_o,touchcancel:_o},sn={},kn=!1;function In(h,k,P){return k==="touchstart"&&Ou(),ni[k]?(P=ni[k].bind(this,P),h.addEventListener(As[k],P,!1),P):(console.warn("wrong event specified:",k),f)}function Ls(h,k,P){if(!As[k]){console.warn("wrong event specified:",k);return}h.removeEventListener(As[k],P,!1)}function gi(h){sn[h.pointerId]=h}function ko(h){sn[h.pointerId]&&(sn[h.pointerId]=h)}function qa(h){delete sn[h.pointerId]}function Ou(){kn||(document.addEventListener(Ur,gi,!0),document.addEventListener(Qn,ko,!0),document.addEventListener(Zi,qa,!0),document.addEventListener(ds,qa,!0),kn=!0)}function _o(h,k){if(k.pointerType!==(k.MSPOINTER_TYPE_MOUSE||"mouse")){k.touches=[];for(var P in sn)k.touches.push(sn[P]);k.changedTouches=[k],h(k)}}function on(h,k){k.MSPOINTER_TYPE_TOUCH&&k.pointerType===k.MSPOINTER_TYPE_TOUCH&&hn(k),_o(h,k)}function Co(h){var k={},P,V;for(V in h)P=h[V],k[V]=P&&P.bind?P.bind(h):P;return h=k,k.type="dblclick",k.detail=2,k.isTrusted=!1,k._simulated=!0,k}var fs=200;function ro(h,k){h.addEventListener("dblclick",k);var P=0,V;function J(ce){if(ce.detail!==1){V=ce.detail;return}if(!(ce.pointerType==="mouse"||ce.sourceCapabilities&&!ce.sourceCapabilities.firesTouchEvents)){var we=ll(ce);if(!(we.some(function(je){return je instanceof HTMLLabelElement&&je.attributes.for})&&!we.some(function(je){return je instanceof HTMLInputElement||je instanceof HTMLSelectElement}))){var Le=Date.now();Le-P<=fs?(V++,V===2&&k(Co(ce))):V=1,P=Le}}}return h.addEventListener("click",J),{dblclick:k,simDblclick:J}}function Yi(h,k){h.removeEventListener("dblclick",k.dblclick),h.removeEventListener("click",k.simDblclick)}var no=rr(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),Ue=rr(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),Ye=Ue==="webkitTransition"||Ue==="OTransition"?Ue+"End":"transitionend";function et(h){return typeof h=="string"?document.getElementById(h):h}function ht(h,k){var P=h.style[k]||h.currentStyle&&h.currentStyle[k];if((!P||P==="auto")&&document.defaultView){var V=document.defaultView.getComputedStyle(h,null);P=V?V[k]:null}return P==="auto"?null:P}function Ze(h,k,P){var V=document.createElement(h);return V.className=k||"",P&&P.appendChild(V),V}function Dt(h){var k=h.parentNode;k&&k.removeChild(h)}function Pr(h){for(;h.firstChild;)h.removeChild(h.firstChild)}function Mr(h){var k=h.parentNode;k&&k.lastChild!==h&&k.appendChild(h)}function Br(h){var k=h.parentNode;k&&k.firstChild!==h&&k.insertBefore(h,k.firstChild)}function vi(h,k){if(h.classList!==void 0)return h.classList.contains(k);var P=tr(h);return P.length>0&&new RegExp("(^|\\s)"+k+"(\\s|$)").test(P)}function zt(h,k){if(h.classList!==void 0)for(var P=y(k),V=0,J=P.length;V<J;V++)h.classList.add(P[V]);else if(!vi(h,k)){var ce=tr(h);al(h,(ce?ce+" ":"")+k)}}function jr(h,k){h.classList!==void 0?h.classList.remove(k):al(h,g((" "+tr(h)+" ").replace(" "+k+" "," ")))}function al(h,k){h.className.baseVal===void 0?h.className=k:h.className.baseVal=k}function tr(h){return h.correspondingElement&&(h=h.correspondingElement),h.className.baseVal===void 0?h.className:h.className.baseVal}function nr(h,k){"opacity"in h.style?h.style.opacity=k:"filter"in h.style&&Rr(h,k)}function Rr(h,k){var P=!1,V="DXImageTransform.Microsoft.Alpha";try{P=h.filters.item(V)}catch{if(k===1)return}k=Math.round(k*100),P?(P.Enabled=k!==100,P.Opacity=k):h.style.filter+=" progid:"+V+"(opacity="+k+")"}function rr(h){for(var k=document.documentElement.style,P=0;P<h.length;P++)if(h[P]in k)return h[P];return!1}function en(h,k,P){var V=k||new Q(0,0);h.style[no]=(Tt.ie3d?"translate("+V.x+"px,"+V.y+"px)":"translate3d("+V.x+"px,"+V.y+"px,0)")+(P?" scale("+P+")":"")}function yn(h,k){h._leaflet_pos=k,Tt.any3d?en(h,k):(h.style.left=k.x+"px",h.style.top=k.y+"px")}function io(h){return h._leaflet_pos||new Q(0,0)}var wr,ao,Eo;if("onselectstart"in document)wr=function(){or(window,"selectstart",hn)},ao=function(){Zr(window,"selectstart",hn)};else{var Rs=rr(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);wr=function(){if(Rs){var h=document.documentElement.style;Eo=h[Rs],h[Rs]="none"}},ao=function(){Rs&&(document.documentElement.style[Rs]=Eo,Eo=void 0)}}function Ec(){or(window,"dragstart",hn)}function Tc(){Zr(window,"dragstart",hn)}var sl,Vl;function To(h){for(;h.tabIndex===-1;)h=h.parentNode;h.style&&(Fi(),sl=h,Vl=h.style.outlineStyle,h.style.outlineStyle="none",or(window,"keydown",Fi))}function Fi(){sl&&(sl.style.outlineStyle=Vl,sl=void 0,Vl=void 0,Zr(window,"keydown",Fi))}function so(h){do h=h.parentNode;while((!h.offsetWidth||!h.offsetHeight)&&h!==document.body);return h}function $a(h){var k=h.getBoundingClientRect();return{x:k.width/h.offsetWidth||1,y:k.height/h.offsetHeight||1,boundingClientRect:k}}var Sr={__proto__:null,TRANSFORM:no,TRANSITION:Ue,TRANSITION_END:Ye,get:et,getStyle:ht,create:Ze,remove:Dt,empty:Pr,toFront:Mr,toBack:Br,hasClass:vi,addClass:zt,removeClass:jr,setClass:al,getClass:tr,setOpacity:nr,testProp:rr,setTransform:en,setPosition:yn,getPosition:io,get disableTextSelection(){return wr},get enableTextSelection(){return ao},disableImageDrag:Ec,enableImageDrag:Tc,preventOutline:To,restoreOutline:Fi,getSizedParentNode:so,getScale:$a};function or(h,k,P,V){if(k&&typeof k=="object")for(var J in k)jn(h,J,k[J],P);else{k=y(k);for(var ce=0,we=k.length;ce<we;ce++)jn(h,k[ce],P,V)}return this}var Jn="_leaflet_events";function Zr(h,k,P,V){if(arguments.length===1)vf(h),delete h[Jn];else if(k&&typeof k=="object")for(var J in k)Hl(h,J,k[J],P);else if(k=y(k),arguments.length===2)vf(h,function(Le){return N(k,Le)!==-1});else for(var ce=0,we=k.length;ce<we;ce++)Hl(h,k[ce],P,V);return this}function vf(h,k){for(var P in h[Jn]){var V=P.split(/\d/)[0];(!k||k(V))&&Hl(h,V,null,null,P)}}var ol={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function jn(h,k,P,V){var J=k+l(P)+(V?"_"+l(V):"");if(h[Jn]&&h[Jn][J])return this;var ce=function(Le){return P.call(V||h,Le||window.event)},we=ce;!Tt.touchNative&&Tt.pointer&&k.indexOf("touch")===0?ce=In(h,k,ce):Tt.touch&&k==="dblclick"?ce=ro(h,ce):"addEventListener"in h?k==="touchstart"||k==="touchmove"||k==="wheel"||k==="mousewheel"?h.addEventListener(ol[k]||k,ce,Tt.passiveEvents?{passive:!1}:!1):k==="mouseenter"||k==="mouseleave"?(ce=function(Le){Le=Le||window.event,No(h,Le)&&we(Le)},h.addEventListener(ol[k],ce,!1)):h.addEventListener(k,we,!1):h.attachEvent("on"+k,ce),h[Jn]=h[Jn]||{},h[Jn][J]=ce}function Hl(h,k,P,V,J){J=J||k+l(P)+(V?"_"+l(V):"");var ce=h[Jn]&&h[Jn][J];if(!ce)return this;!Tt.touchNative&&Tt.pointer&&k.indexOf("touch")===0?Ls(h,k,ce):Tt.touch&&k==="dblclick"?Yi(h,ce):"removeEventListener"in h?h.removeEventListener(ol[k]||k,ce,!1):h.detachEvent("on"+k,ce),h[Jn][J]=null}function Os(h){return h.stopPropagation?h.stopPropagation():h.originalEvent?h.originalEvent._stopped=!0:h.cancelBubble=!0,this}function Wl(h){return jn(h,"wheel",Os),this}function Du(h){return or(h,"mousedown touchstart dblclick contextmenu",Os),h._leaflet_disable_click=!0,this}function hn(h){return h.preventDefault?h.preventDefault():h.returnValue=!1,this}function Fn(h){return hn(h),Os(h),this}function ll(h){if(h.composedPath)return h.composedPath();for(var k=[],P=h.target;P;)k.push(P),P=P.parentNode;return k}function Iu(h,k){if(!k)return new Q(h.clientX,h.clientY);var P=$a(k),V=P.boundingClientRect;return new Q((h.clientX-V.left)/P.x-k.clientLeft,(h.clientY-V.top)/P.y-k.clientTop)}var hs=Tt.linux&&Tt.chrome?window.devicePixelRatio:Tt.mac?window.devicePixelRatio*3:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function Ds(h){return Tt.edge?h.wheelDeltaY/2:h.deltaY&&h.deltaMode===0?-h.deltaY/hs:h.deltaY&&h.deltaMode===1?-h.deltaY*20:h.deltaY&&h.deltaMode===2?-h.deltaY*60:h.deltaX||h.deltaZ?0:h.wheelDelta?(h.wheelDeltaY||h.wheelDelta)/2:h.detail&&Math.abs(h.detail)<32765?-h.detail*20:h.detail?h.detail/-32765*60:0}function No(h,k){var P=k.relatedTarget;if(!P)return!0;try{for(;P&&P!==h;)P=P.parentNode}catch{return!1}return P!==h}var ql={__proto__:null,on:or,off:Zr,stopPropagation:Os,disableScrollPropagation:Wl,disableClickPropagation:Du,preventDefault:hn,stop:Fn,getPropagationPath:ll,getMousePosition:Iu,getWheelDelta:Ds,isExternalTarget:No,addListener:or,removeListener:Zr},ju=$.extend({run:function(h,k,P,V){this.stop(),this._el=h,this._inProgress=!0,this._duration=P||.25,this._easeOutPower=1/Math.max(V||.5,.2),this._startPos=io(h),this._offset=k.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=G(this._animate,this),this._step()},_step:function(h){var k=+new Date-this._startTime,P=this._duration*1e3;k<P?this._runFrame(this._easeOut(k/P),h):(this._runFrame(1),this._complete())},_runFrame:function(h,k){var P=this._startPos.add(this._offset.multiplyBy(h));k&&P._round(),yn(this._el,P),this.fire("step")},_complete:function(){Z(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(h){return 1-Math.pow(1-h,this._easeOutPower)}}),Er=$.extend({options:{crs:Se,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(h,k){k=S(this,k),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(h),this._initLayout(),this._onResize=s(this._onResize,this),this._initEvents(),k.maxBounds&&this.setMaxBounds(k.maxBounds),k.zoom!==void 0&&(this._zoom=this._limitZoom(k.zoom)),k.center&&k.zoom!==void 0&&this.setView(he(k.center),k.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=Ue&&Tt.any3d&&!Tt.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),or(this._proxy,Ye,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(h,k,P){if(k=k===void 0?this._zoom:this._limitZoom(k),h=this._limitCenter(he(h),k,this.options.maxBounds),P=P||{},this._stop(),this._loaded&&!P.reset&&P!==!0){P.animate!==void 0&&(P.zoom=i({animate:P.animate},P.zoom),P.pan=i({animate:P.animate,duration:P.duration},P.pan));var V=this._zoom!==k?this._tryAnimatedZoom&&this._tryAnimatedZoom(h,k,P.zoom):this._tryAnimatedPan(h,P.pan);if(V)return clearTimeout(this._sizeTimer),this}return this._resetView(h,k,P.pan&&P.pan.noMoveStart),this},setZoom:function(h,k){return this._loaded?this.setView(this.getCenter(),h,{zoom:k}):(this._zoom=h,this)},zoomIn:function(h,k){return h=h||(Tt.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+h,k)},zoomOut:function(h,k){return h=h||(Tt.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-h,k)},setZoomAround:function(h,k,P){var V=this.getZoomScale(k),J=this.getSize().divideBy(2),ce=h instanceof Q?h:this.latLngToContainerPoint(h),we=ce.subtract(J).multiplyBy(1-1/V),Le=this.containerPointToLatLng(J.add(we));return this.setView(Le,k,{zoom:P})},_getBoundsCenterZoom:function(h,k){k=k||{},h=h.getBounds?h.getBounds():oe(h);var P=te(k.paddingTopLeft||k.padding||[0,0]),V=te(k.paddingBottomRight||k.padding||[0,0]),J=this.getBoundsZoom(h,!1,P.add(V));if(J=typeof k.maxZoom=="number"?Math.min(k.maxZoom,J):J,J===1/0)return{center:h.getCenter(),zoom:J};var ce=V.subtract(P).divideBy(2),we=this.project(h.getSouthWest(),J),Le=this.project(h.getNorthEast(),J),je=this.unproject(we.add(Le).divideBy(2).add(ce),J);return{center:je,zoom:J}},fitBounds:function(h,k){if(h=oe(h),!h.isValid())throw new Error("Bounds are not valid.");var P=this._getBoundsCenterZoom(h,k);return this.setView(P.center,P.zoom,k)},fitWorld:function(h){return this.fitBounds([[-90,-180],[90,180]],h)},panTo:function(h,k){return this.setView(h,this._zoom,{pan:k})},panBy:function(h,k){if(h=te(h).round(),k=k||{},!h.x&&!h.y)return this.fire("moveend");if(k.animate!==!0&&!this.getSize().contains(h))return this._resetView(this.unproject(this.project(this.getCenter()).add(h)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new ju,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),k.noMoveStart||this.fire("movestart"),k.animate!==!1){zt(this._mapPane,"leaflet-pan-anim");var P=this._getMapPanePos().subtract(h).round();this._panAnim.run(this._mapPane,P,k.duration||.25,k.easeLinearity)}else this._rawPanBy(h),this.fire("move").fire("moveend");return this},flyTo:function(h,k,P){if(P=P||{},P.animate===!1||!Tt.any3d)return this.setView(h,k,P);this._stop();var V=this.project(this.getCenter()),J=this.project(h),ce=this.getSize(),we=this._zoom;h=he(h),k=k===void 0?we:k;var Le=Math.max(ce.x,ce.y),je=Le*this.getZoomScale(we,k),Xe=J.distanceTo(V)||1,Nt=1.42,Xt=Nt*Nt;function hr(Gr){var bl=Gr?-1:1,Fh=Gr?je:Le,Bh=je*je-Le*Le+bl*Xt*Xt*Xe*Xe,Do=2*Fh*Xt*Xe,wl=Bh/Do,Vn=Math.sqrt(wl*wl+1)-wl,si=Vn<1e-9?-18:Math.log(Vn);return si}function Xr(Gr){return(Math.exp(Gr)-Math.exp(-Gr))/2}function Gn(Gr){return(Math.exp(Gr)+Math.exp(-Gr))/2}function Ai(Gr){return Xr(Gr)/Gn(Gr)}var zi=hr(0);function yl(Gr){return Le*(Gn(zi)/Gn(zi+Nt*Gr))}function Gc(Gr){return Le*(Gn(zi)*Ai(zi+Nt*Gr)-Xr(zi))/Xt}function zs(Gr){return 1-Math.pow(1-Gr,1.5)}var xl=Date.now(),co=(hr(1)-zi)/Nt,es=P.duration?1e3*P.duration:1e3*co*.8;function au(){var Gr=(Date.now()-xl)/es,bl=zs(Gr)*co;Gr<=1?(this._flyToFrame=G(au,this),this._move(this.unproject(V.add(J.subtract(V).multiplyBy(Gc(bl)/Xe)),we),this.getScaleZoom(Le/yl(bl),we),{flyTo:!0})):this._move(h,k)._moveEnd(!0)}return this._moveStart(!0,P.noMoveStart),au.call(this),this},flyToBounds:function(h,k){var P=this._getBoundsCenterZoom(h,k);return this.flyTo(P.center,P.zoom,k)},setMaxBounds:function(h){return h=oe(h),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),h.isValid()?(this.options.maxBounds=h,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(h){var k=this.options.minZoom;return this.options.minZoom=h,this._loaded&&k!==h&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(h):this},setMaxZoom:function(h){var k=this.options.maxZoom;return this.options.maxZoom=h,this._loaded&&k!==h&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(h):this},panInsideBounds:function(h,k){this._enforcingBounds=!0;var P=this.getCenter(),V=this._limitCenter(P,this._zoom,oe(h));return P.equals(V)||this.panTo(V,k),this._enforcingBounds=!1,this},panInside:function(h,k){k=k||{};var P=te(k.paddingTopLeft||k.padding||[0,0]),V=te(k.paddingBottomRight||k.padding||[0,0]),J=this.project(this.getCenter()),ce=this.project(h),we=this.getPixelBounds(),Le=re([we.min.add(P),we.max.subtract(V)]),je=Le.getSize();if(!Le.contains(ce)){this._enforcingBounds=!0;var Xe=ce.subtract(Le.getCenter()),Nt=Le.extend(ce).getSize().subtract(je);J.x+=Xe.x<0?-Nt.x:Nt.x,J.y+=Xe.y<0?-Nt.y:Nt.y,this.panTo(this.unproject(J),k),this._enforcingBounds=!1}return this},invalidateSize:function(h){if(!this._loaded)return this;h=i({animate:!1,pan:!0},h===!0?{animate:!0}:h);var k=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var P=this.getSize(),V=k.divideBy(2).round(),J=P.divideBy(2).round(),ce=V.subtract(J);return!ce.x&&!ce.y?this:(h.animate&&h.pan?this.panBy(ce):(h.pan&&this._rawPanBy(ce),this.fire("move"),h.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(s(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:k,newSize:P}))},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(h){if(h=this._locateOptions=i({timeout:1e4,watch:!1},h),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var k=s(this._handleGeolocationResponse,this),P=s(this._handleGeolocationError,this);return h.watch?this._locationWatchId=navigator.geolocation.watchPosition(k,P,h):navigator.geolocation.getCurrentPosition(k,P,h),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(h){if(this._container._leaflet_id){var k=h.code,P=h.message||(k===1?"permission denied":k===2?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:k,message:"Geolocation error: "+P+"."})}},_handleGeolocationResponse:function(h){if(this._container._leaflet_id){var k=h.coords.latitude,P=h.coords.longitude,V=new se(k,P),J=V.toBounds(h.coords.accuracy*2),ce=this._locateOptions;if(ce.setView){var we=this.getBoundsZoom(J);this.setView(V,ce.maxZoom?Math.min(we,ce.maxZoom):we)}var Le={latlng:V,bounds:J,timestamp:h.timestamp};for(var je in h.coords)typeof h.coords[je]=="number"&&(Le[je]=h.coords[je]);this.fire("locationfound",Le)}},addHandler:function(h,k){if(!k)return this;var P=this[h]=new k(this);return this._handlers.push(P),this.options[h]&&P.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch{this._container._leaflet_id=void 0,this._containerId=void 0}this._locationWatchId!==void 0&&this.stopLocate(),this._stop(),Dt(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(Z(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload");var h;for(h in this._layers)this._layers[h].remove();for(h in this._panes)Dt(this._panes[h]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(h,k){var P="leaflet-pane"+(h?" leaflet-"+h.replace("Pane","")+"-pane":""),V=Ze("div",P,k||this._mapPane);return h&&(this._panes[h]=V),V},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var h=this.getPixelBounds(),k=this.unproject(h.getBottomLeft()),P=this.unproject(h.getTopRight());return new fe(k,P)},getMinZoom:function(){return this.options.minZoom===void 0?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===void 0?this._layersMaxZoom===void 0?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(h,k,P){h=oe(h),P=te(P||[0,0]);var V=this.getZoom()||0,J=this.getMinZoom(),ce=this.getMaxZoom(),we=h.getNorthWest(),Le=h.getSouthEast(),je=this.getSize().subtract(P),Xe=re(this.project(Le,V),this.project(we,V)).getSize(),Nt=Tt.any3d?this.options.zoomSnap:1,Xt=je.x/Xe.x,hr=je.y/Xe.y,Xr=k?Math.max(Xt,hr):Math.min(Xt,hr);return V=this.getScaleZoom(Xr,V),Nt&&(V=Math.round(V/(Nt/100))*(Nt/100),V=k?Math.ceil(V/Nt)*Nt:Math.floor(V/Nt)*Nt),Math.max(J,Math.min(ce,V))},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new Q(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(h,k){var P=this._getTopLeftPoint(h,k);return new X(P,P.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(h){return this.options.crs.getProjectedBounds(h===void 0?this.getZoom():h)},getPane:function(h){return typeof h=="string"?this._panes[h]:h},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(h,k){var P=this.options.crs;return k=k===void 0?this._zoom:k,P.scale(h)/P.scale(k)},getScaleZoom:function(h,k){var P=this.options.crs;k=k===void 0?this._zoom:k;var V=P.zoom(h*P.scale(k));return isNaN(V)?1/0:V},project:function(h,k){return k=k===void 0?this._zoom:k,this.options.crs.latLngToPoint(he(h),k)},unproject:function(h,k){return k=k===void 0?this._zoom:k,this.options.crs.pointToLatLng(te(h),k)},layerPointToLatLng:function(h){var k=te(h).add(this.getPixelOrigin());return this.unproject(k)},latLngToLayerPoint:function(h){var k=this.project(he(h))._round();return k._subtract(this.getPixelOrigin())},wrapLatLng:function(h){return this.options.crs.wrapLatLng(he(h))},wrapLatLngBounds:function(h){return this.options.crs.wrapLatLngBounds(oe(h))},distance:function(h,k){return this.options.crs.distance(he(h),he(k))},containerPointToLayerPoint:function(h){return te(h).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(h){return te(h).add(this._getMapPanePos())},containerPointToLatLng:function(h){var k=this.containerPointToLayerPoint(te(h));return this.layerPointToLatLng(k)},latLngToContainerPoint:function(h){return this.layerPointToContainerPoint(this.latLngToLayerPoint(he(h)))},mouseEventToContainerPoint:function(h){return Iu(h,this._container)},mouseEventToLayerPoint:function(h){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(h))},mouseEventToLatLng:function(h){return this.layerPointToLatLng(this.mouseEventToLayerPoint(h))},_initContainer:function(h){var k=this._container=et(h);if(k){if(k._leaflet_id)throw new Error("Map container is already initialized.")}else throw new Error("Map container not found.");or(k,"scroll",this._onScroll,this),this._containerId=l(k)},_initLayout:function(){var h=this._container;this._fadeAnimated=this.options.fadeAnimation&&Tt.any3d,zt(h,"leaflet-container"+(Tt.touch?" leaflet-touch":"")+(Tt.retina?" leaflet-retina":"")+(Tt.ielt9?" leaflet-oldie":"")+(Tt.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var k=ht(h,"position");k!=="absolute"&&k!=="relative"&&k!=="fixed"&&k!=="sticky"&&(h.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var h=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),yn(this._mapPane,new Q(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(zt(h.markerPane,"leaflet-zoom-hide"),zt(h.shadowPane,"leaflet-zoom-hide"))},_resetView:function(h,k,P){yn(this._mapPane,new Q(0,0));var V=!this._loaded;this._loaded=!0,k=this._limitZoom(k),this.fire("viewprereset");var J=this._zoom!==k;this._moveStart(J,P)._move(h,k)._moveEnd(J),this.fire("viewreset"),V&&this.fire("load")},_moveStart:function(h,k){return h&&this.fire("zoomstart"),k||this.fire("movestart"),this},_move:function(h,k,P,V){k===void 0&&(k=this._zoom);var J=this._zoom!==k;return this._zoom=k,this._lastCenter=h,this._pixelOrigin=this._getNewPixelOrigin(h),V?P&&P.pinch&&this.fire("zoom",P):((J||P&&P.pinch)&&this.fire("zoom",P),this.fire("move",P)),this},_moveEnd:function(h){return h&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return Z(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(h){yn(this._mapPane,this._getMapPanePos().subtract(h))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(h){this._targets={},this._targets[l(this._container)]=this;var k=h?Zr:or;k(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&k(window,"resize",this._onResize,this),Tt.any3d&&this.options.transform3DLimit&&(h?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){Z(this._resizeRequest),this._resizeRequest=G(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var h=this._getMapPanePos();Math.max(Math.abs(h.x),Math.abs(h.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(h,k){for(var P=[],V,J=k==="mouseout"||k==="mouseover",ce=h.target||h.srcElement,we=!1;ce;){if(V=this._targets[l(ce)],V&&(k==="click"||k==="preclick")&&this._draggableMoved(V)){we=!0;break}if(V&&V.listens(k,!0)&&(J&&!No(ce,h)||(P.push(V),J))||ce===this._container)break;ce=ce.parentNode}return!P.length&&!we&&!J&&this.listens(k,!0)&&(P=[this]),P},_isClickDisabled:function(h){for(;h&&h!==this._container;){if(h._leaflet_disable_click)return!0;h=h.parentNode}},_handleDOMEvent:function(h){var k=h.target||h.srcElement;if(!(!this._loaded||k._leaflet_disable_events||h.type==="click"&&this._isClickDisabled(k))){var P=h.type;P==="mousedown"&&To(k),this._fireDOMEvent(h,P)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(h,k,P){if(h.type==="click"){var V=i({},h);V.type="preclick",this._fireDOMEvent(V,V.type,P)}var J=this._findEventTargets(h,k);if(P){for(var ce=[],we=0;we<P.length;we++)P[we].listens(k,!0)&&ce.push(P[we]);J=ce.concat(J)}if(J.length){k==="contextmenu"&&hn(h);var Le=J[0],je={originalEvent:h};if(h.type!=="keypress"&&h.type!=="keydown"&&h.type!=="keyup"){var Xe=Le.getLatLng&&(!Le._radius||Le._radius<=10);je.containerPoint=Xe?this.latLngToContainerPoint(Le.getLatLng()):this.mouseEventToContainerPoint(h),je.layerPoint=this.containerPointToLayerPoint(je.containerPoint),je.latlng=Xe?Le.getLatLng():this.layerPointToLatLng(je.layerPoint)}for(we=0;we<J.length;we++)if(J[we].fire(k,je,!0),je.originalEvent._stopped||J[we].options.bubblingMouseEvents===!1&&N(this._mouseEvents,k)!==-1)return}},_draggableMoved:function(h){return h=h.dragging&&h.dragging.enabled()?h:this,h.dragging&&h.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var h=0,k=this._handlers.length;h<k;h++)this._handlers[h].disable()},whenReady:function(h,k){return this._loaded?h.call(k||this,{target:this}):this.on("load",h,k),this},_getMapPanePos:function(){return io(this._mapPane)||new Q(0,0)},_moved:function(){var h=this._getMapPanePos();return h&&!h.equals([0,0])},_getTopLeftPoint:function(h,k){var P=h&&k!==void 0?this._getNewPixelOrigin(h,k):this.getPixelOrigin();return P.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(h,k){var P=this.getSize()._divideBy(2);return this.project(h,k)._subtract(P)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(h,k,P){var V=this._getNewPixelOrigin(P,k);return this.project(h,k)._subtract(V)},_latLngBoundsToNewLayerBounds:function(h,k,P){var V=this._getNewPixelOrigin(P,k);return re([this.project(h.getSouthWest(),k)._subtract(V),this.project(h.getNorthWest(),k)._subtract(V),this.project(h.getSouthEast(),k)._subtract(V),this.project(h.getNorthEast(),k)._subtract(V)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(h){return this.latLngToLayerPoint(h).subtract(this._getCenterLayerPoint())},_limitCenter:function(h,k,P){if(!P)return h;var V=this.project(h,k),J=this.getSize().divideBy(2),ce=new X(V.subtract(J),V.add(J)),we=this._getBoundsOffset(ce,P,k);return Math.abs(we.x)<=1&&Math.abs(we.y)<=1?h:this.unproject(V.add(we),k)},_limitOffset:function(h,k){if(!k)return h;var P=this.getPixelBounds(),V=new X(P.min.add(h),P.max.add(h));return h.add(this._getBoundsOffset(V,k))},_getBoundsOffset:function(h,k,P){var V=re(this.project(k.getNorthEast(),P),this.project(k.getSouthWest(),P)),J=V.min.subtract(h.min),ce=V.max.subtract(h.max),we=this._rebound(J.x,-ce.x),Le=this._rebound(J.y,-ce.y);return new Q(we,Le)},_rebound:function(h,k){return h+k>0?Math.round(h-k)/2:Math.max(0,Math.ceil(h))-Math.max(0,Math.floor(k))},_limitZoom:function(h){var k=this.getMinZoom(),P=this.getMaxZoom(),V=Tt.any3d?this.options.zoomSnap:1;return V&&(h=Math.round(h/V)*V),Math.max(k,Math.min(P,h))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){jr(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(h,k){var P=this._getCenterOffset(h)._trunc();return(k&&k.animate)!==!0&&!this.getSize().contains(P)?!1:(this.panBy(P,k),!0)},_createAnimProxy:function(){var h=this._proxy=Ze("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(h),this.on("zoomanim",function(k){var P=no,V=this._proxy.style[P];en(this._proxy,this.project(k.center,k.zoom),this.getZoomScale(k.zoom,1)),V===this._proxy.style[P]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){Dt(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var h=this.getCenter(),k=this.getZoom();en(this._proxy,this.project(h,k),this.getZoomScale(k,1))},_catchTransitionEnd:function(h){this._animatingZoom&&h.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(h,k,P){if(this._animatingZoom)return!0;if(P=P||{},!this._zoomAnimated||P.animate===!1||this._nothingToAnimate()||Math.abs(k-this._zoom)>this.options.zoomAnimationThreshold)return!1;var V=this.getZoomScale(k),J=this._getCenterOffset(h)._divideBy(1-1/V);return P.animate!==!0&&!this.getSize().contains(J)?!1:(G(function(){this._moveStart(!0,P.noMoveStart||!1)._animateZoom(h,k,!0)},this),!0)},_animateZoom:function(h,k,P,V){this._mapPane&&(P&&(this._animatingZoom=!0,this._animateToCenter=h,this._animateToZoom=k,zt(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:h,zoom:k,noUpdate:V}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(s(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&jr(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function yi(h,k){return new Er(h,k)}var ii=W.extend({options:{position:"topright"},initialize:function(h){S(this,h)},getPosition:function(){return this.options.position},setPosition:function(h){var k=this._map;return k&&k.removeControl(this),this.options.position=h,k&&k.addControl(this),this},getContainer:function(){return this._container},addTo:function(h){this.remove(),this._map=h;var k=this._container=this.onAdd(h),P=this.getPosition(),V=h._controlCorners[P];return zt(k,"leaflet-control"),P.indexOf("bottom")!==-1?V.insertBefore(k,V.firstChild):V.appendChild(k),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(Dt(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(h){this._map&&h&&h.screenX>0&&h.screenY>0&&this._map.getContainer().focus()}}),ba=function(h){return new ii(h)};Er.include({addControl:function(h){return h.addTo(this),this},removeControl:function(h){return h.remove(),this},_initControlPos:function(){var h=this._controlCorners={},k="leaflet-",P=this._controlContainer=Ze("div",k+"control-container",this._container);function V(J,ce){var we=k+J+" "+k+ce;h[J+ce]=Ze("div",we,P)}V("top","left"),V("top","right"),V("bottom","left"),V("bottom","right")},_clearControlPos:function(){for(var h in this._controlCorners)Dt(this._controlCorners[h]);Dt(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var $l=ii.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(h,k,P,V){return P<V?-1:V<P?1:0}},initialize:function(h,k,P){S(this,P),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1;for(var V in h)this._addLayer(h[V],V);for(V in k)this._addLayer(k[V],V,!0)},onAdd:function(h){this._initLayout(),this._update(),this._map=h,h.on("zoomend",this._checkDisabledLayers,this);for(var k=0;k<this._layers.length;k++)this._layers[k].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(h){return ii.prototype.addTo.call(this,h),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var h=0;h<this._layers.length;h++)this._layers[h].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(h,k){return this._addLayer(h,k),this._map?this._update():this},addOverlay:function(h,k){return this._addLayer(h,k,!0),this._map?this._update():this},removeLayer:function(h){h.off("add remove",this._onLayerChange,this);var k=this._getLayer(l(h));return k&&this._layers.splice(this._layers.indexOf(k),1),this._map?this._update():this},expand:function(){zt(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var h=this._map.getSize().y-(this._container.offsetTop+50);return h<this._section.clientHeight?(zt(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=h+"px"):jr(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return jr(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var h="leaflet-control-layers",k=this._container=Ze("div",h),P=this.options.collapsed;k.setAttribute("aria-haspopup",!0),Du(k),Wl(k);var V=this._section=Ze("section",h+"-list");P&&(this._map.on("click",this.collapse,this),or(k,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var J=this._layersLink=Ze("a",h+"-toggle",k);J.href="#",J.title="Layers",J.setAttribute("role","button"),or(J,{keydown:function(ce){ce.keyCode===13&&this._expandSafely()},click:function(ce){hn(ce),this._expandSafely()}},this),P||this.expand(),this._baseLayersList=Ze("div",h+"-base",V),this._separator=Ze("div",h+"-separator",V),this._overlaysList=Ze("div",h+"-overlays",V),k.appendChild(V)},_getLayer:function(h){for(var k=0;k<this._layers.length;k++)if(this._layers[k]&&l(this._layers[k].layer)===h)return this._layers[k]},_addLayer:function(h,k,P){this._map&&h.on("add remove",this._onLayerChange,this),this._layers.push({layer:h,name:k,overlay:P}),this.options.sortLayers&&this._layers.sort(s(function(V,J){return this.options.sortFunction(V.layer,J.layer,V.name,J.name)},this)),this.options.autoZIndex&&h.setZIndex&&(this._lastZIndex++,h.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;Pr(this._baseLayersList),Pr(this._overlaysList),this._layerControlInputs=[];var h,k,P,V,J=0;for(P=0;P<this._layers.length;P++)V=this._layers[P],this._addItem(V),k=k||V.overlay,h=h||!V.overlay,J+=V.overlay?0:1;return this.options.hideSingleBase&&(h=h&&J>1,this._baseLayersList.style.display=h?"":"none"),this._separator.style.display=k&&h?"":"none",this},_onLayerChange:function(h){this._handlingClick||this._update();var k=this._getLayer(l(h.target)),P=k.overlay?h.type==="add"?"overlayadd":"overlayremove":h.type==="add"?"baselayerchange":null;P&&this._map.fire(P,k)},_createRadioElement:function(h,k){var P='<input type="radio" class="leaflet-control-layers-selector" name="'+h+'"'+(k?' checked="checked"':"")+"/>",V=document.createElement("div");return V.innerHTML=P,V.firstChild},_addItem:function(h){var k=document.createElement("label"),P=this._map.hasLayer(h.layer),V;h.overlay?(V=document.createElement("input"),V.type="checkbox",V.className="leaflet-control-layers-selector",V.defaultChecked=P):V=this._createRadioElement("leaflet-base-layers_"+l(this),P),this._layerControlInputs.push(V),V.layerId=l(h.layer),or(V,"click",this._onInputClick,this);var J=document.createElement("span");J.innerHTML=" "+h.name;var ce=document.createElement("span");k.appendChild(ce),ce.appendChild(V),ce.appendChild(J);var we=h.overlay?this._overlaysList:this._baseLayersList;return we.appendChild(k),this._checkDisabledLayers(),k},_onInputClick:function(){if(!this._preventClick){var h=this._layerControlInputs,k,P,V=[],J=[];this._handlingClick=!0;for(var ce=h.length-1;ce>=0;ce--)k=h[ce],P=this._getLayer(k.layerId).layer,k.checked?V.push(P):k.checked||J.push(P);for(ce=0;ce<J.length;ce++)this._map.hasLayer(J[ce])&&this._map.removeLayer(J[ce]);for(ce=0;ce<V.length;ce++)this._map.hasLayer(V[ce])||this._map.addLayer(V[ce]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var h=this._layerControlInputs,k,P,V=this._map.getZoom(),J=h.length-1;J>=0;J--)k=h[J],P=this._getLayer(k.layerId).layer,k.disabled=P.options.minZoom!==void 0&&V<P.options.minZoom||P.options.maxZoom!==void 0&&V>P.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var h=this._section;this._preventClick=!0,or(h,"click",hn),this.expand();var k=this;setTimeout(function(){Zr(h,"click",hn),k._preventClick=!1})}}),ul=function(h,k,P){return new $l(h,k,P)},xi=ii.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(h){var k="leaflet-control-zoom",P=Ze("div",k+" leaflet-bar"),V=this.options;return this._zoomInButton=this._createButton(V.zoomInText,V.zoomInTitle,k+"-in",P,this._zoomIn),this._zoomOutButton=this._createButton(V.zoomOutText,V.zoomOutTitle,k+"-out",P,this._zoomOut),this._updateDisabled(),h.on("zoomend zoomlevelschange",this._updateDisabled,this),P},onRemove:function(h){h.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(h){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(h.shiftKey?3:1))},_zoomOut:function(h){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(h.shiftKey?3:1))},_createButton:function(h,k,P,V,J){var ce=Ze("a",P,V);return ce.innerHTML=h,ce.href="#",ce.title=k,ce.setAttribute("role","button"),ce.setAttribute("aria-label",k),Du(ce),or(ce,"click",Fn),or(ce,"click",J,this),or(ce,"click",this._refocusOnMap,this),ce},_updateDisabled:function(){var h=this._map,k="leaflet-disabled";jr(this._zoomInButton,k),jr(this._zoomOutButton,k),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||h._zoom===h.getMinZoom())&&(zt(this._zoomOutButton,k),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||h._zoom===h.getMaxZoom())&&(zt(this._zoomInButton,k),this._zoomInButton.setAttribute("aria-disabled","true"))}});Er.mergeOptions({zoomControl:!0}),Er.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new xi,this.addControl(this.zoomControl))});var wa=function(h){return new xi(h)},Bn=ii.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(h){var k="leaflet-control-scale",P=Ze("div",k),V=this.options;return this._addScales(V,k+"-line",P),h.on(V.updateWhenIdle?"moveend":"move",this._update,this),h.whenReady(this._update,this),P},onRemove:function(h){h.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(h,k,P){h.metric&&(this._mScale=Ze("div",k,P)),h.imperial&&(this._iScale=Ze("div",k,P))},_update:function(){var h=this._map,k=h.getSize().y/2,P=h.distance(h.containerPointToLatLng([0,k]),h.containerPointToLatLng([this.options.maxWidth,k]));this._updateScales(P)},_updateScales:function(h){this.options.metric&&h&&this._updateMetric(h),this.options.imperial&&h&&this._updateImperial(h)},_updateMetric:function(h){var k=this._getRoundNum(h),P=k<1e3?k+" m":k/1e3+" km";this._updateScale(this._mScale,P,k/h)},_updateImperial:function(h){var k=h*3.2808399,P,V,J;k>5280?(P=k/5280,V=this._getRoundNum(P),this._updateScale(this._iScale,V+" mi",V/P)):(J=this._getRoundNum(k),this._updateScale(this._iScale,J+" ft",J/k))},_updateScale:function(h,k,P){h.style.width=Math.round(this.options.maxWidth*P)+"px",h.innerHTML=k},_getRoundNum:function(h){var k=Math.pow(10,(Math.floor(h)+"").length-1),P=h/k;return P=P>=10?10:P>=5?5:P>=3?3:P>=2?2:1,k*P}}),Xi=function(h){return new Bn(h)},ps='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',Sa=ii.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(Tt.inlineSvg?ps+" ":"")+"Leaflet</a>"},initialize:function(h){S(this,h),this._attributions={}},onAdd:function(h){h.attributionControl=this,this._container=Ze("div","leaflet-control-attribution"),Du(this._container);for(var k in h._layers)h._layers[k].getAttribution&&this.addAttribution(h._layers[k].getAttribution());return this._update(),h.on("layeradd",this._addAttribution,this),this._container},onRemove:function(h){h.off("layeradd",this._addAttribution,this)},_addAttribution:function(h){h.layer.getAttribution&&(this.addAttribution(h.layer.getAttribution()),h.layer.once("remove",function(){this.removeAttribution(h.layer.getAttribution())},this))},setPrefix:function(h){return this.options.prefix=h,this._update(),this},addAttribution:function(h){return h?(this._attributions[h]||(this._attributions[h]=0),this._attributions[h]++,this._update(),this):this},removeAttribution:function(h){return h?(this._attributions[h]&&(this._attributions[h]--,this._update()),this):this},_update:function(){if(this._map){var h=[];for(var k in this._attributions)this._attributions[k]&&h.push(k);var P=[];this.options.prefix&&P.push(this.options.prefix),h.length&&P.push(h.join(", ")),this._container.innerHTML=P.join(' <span aria-hidden="true">|</span> ')}}});Er.mergeOptions({attributionControl:!0}),Er.addInitHook(function(){this.options.attributionControl&&new Sa().addTo(this)});var Rh=function(h){return new Sa(h)};ii.Layers=$l,ii.Zoom=xi,ii.Scale=Bn,ii.Attribution=Sa,ba.layers=ul,ba.zoom=wa,ba.scale=Xi,ba.attribution=Rh;var Qi=W.extend({initialize:function(h){this._map=h},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});Qi.addTo=function(h,k){return h.addHandler(k,this),this};var Fu={Events:K},ai=Tt.touch?"touchstart mousedown":"mousedown",_n=$.extend({options:{clickTolerance:3},initialize:function(h,k,P,V){S(this,V),this._element=h,this._dragStartTarget=k||h,this._preventOutline=P},enable:function(){this._enabled||(or(this._dragStartTarget,ai,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(_n._dragging===this&&this.finishDrag(!0),Zr(this._dragStartTarget,ai,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(h){if(this._enabled&&(this._moved=!1,!vi(this._element,"leaflet-zoom-anim"))){if(h.touches&&h.touches.length!==1){_n._dragging===this&&this.finishDrag();return}if(!(_n._dragging||h.shiftKey||h.which!==1&&h.button!==1&&!h.touches)&&(_n._dragging=this,this._preventOutline&&To(this._element),Ec(),wr(),!this._moving)){this.fire("down");var k=h.touches?h.touches[0]:h,P=so(this._element);this._startPoint=new Q(k.clientX,k.clientY),this._startPos=io(this._element),this._parentScale=$a(P);var V=h.type==="mousedown";or(document,V?"mousemove":"touchmove",this._onMove,this),or(document,V?"mouseup":"touchend touchcancel",this._onUp,this)}}},_onMove:function(h){if(this._enabled){if(h.touches&&h.touches.length>1){this._moved=!0;return}var k=h.touches&&h.touches.length===1?h.touches[0]:h,P=new Q(k.clientX,k.clientY)._subtract(this._startPoint);!P.x&&!P.y||Math.abs(P.x)+Math.abs(P.y)<this.options.clickTolerance||(P.x/=this._parentScale.x,P.y/=this._parentScale.y,hn(h),this._moved||(this.fire("dragstart"),this._moved=!0,zt(document.body,"leaflet-dragging"),this._lastTarget=h.target||h.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),zt(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(P),this._moving=!0,this._lastEvent=h,this._updatePosition())}},_updatePosition:function(){var h={originalEvent:this._lastEvent};this.fire("predrag",h),yn(this._element,this._newPos),this.fire("drag",h)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(h){jr(document.body,"leaflet-dragging"),this._lastTarget&&(jr(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),Zr(document,"mousemove touchmove",this._onMove,this),Zr(document,"mouseup touchend touchcancel",this._onUp,this),Tc(),ao();var k=this._moved&&this._moving;this._moving=!1,_n._dragging=!1,k&&this.fire("dragend",{noInertia:h,distance:this._newPos.distanceTo(this._startPos)})}});function tn(h,k,P){var V,J=[1,4,2,8],ce,we,Le,je,Xe,Nt,Xt,hr;for(ce=0,Nt=h.length;ce<Nt;ce++)h[ce]._code=Is(h[ce],k);for(Le=0;Le<4;Le++){for(Xt=J[Le],V=[],ce=0,Nt=h.length,we=Nt-1;ce<Nt;we=ce++)je=h[ce],Xe=h[we],je._code&Xt?Xe._code&Xt||(hr=Mc(Xe,je,Xt,k,P),hr._code=Is(hr,k),V.push(hr)):(Xe._code&Xt&&(hr=Mc(Xe,je,Xt,k,P),hr._code=Is(hr,k),V.push(hr)),V.push(je));h=V}return h}function Kl(h,k){var P,V,J,ce,we,Le,je,Xe,Nt;if(!h||h.length===0)throw new Error("latlngs not passed");Bi(h)||(console.warn("latlngs are not flat! Only the first ring will be used"),h=h[0]);var Xt=he([0,0]),hr=oe(h),Xr=hr.getNorthWest().distanceTo(hr.getSouthWest())*hr.getNorthEast().distanceTo(hr.getNorthWest());Xr<1700&&(Xt=ka(h));var Gn=h.length,Ai=[];for(P=0;P<Gn;P++){var zi=he(h[P]);Ai.push(k.project(he([zi.lat-Xt.lat,zi.lng-Xt.lng])))}for(Le=je=Xe=0,P=0,V=Gn-1;P<Gn;V=P++)J=Ai[P],ce=Ai[V],we=J.y*ce.x-ce.y*J.x,je+=(J.x+ce.x)*we,Xe+=(J.y+ce.y)*we,Le+=we*3;Le===0?Nt=Ai[0]:Nt=[je/Le,Xe/Le];var yl=k.unproject(te(Nt));return he([yl.lat+Xt.lat,yl.lng+Xt.lng])}function ka(h){for(var k=0,P=0,V=0,J=0;J<h.length;J++){var ce=he(h[J]);k+=ce.lat,P+=ce.lng,V++}return he([k/V,P/V])}var Oh={__proto__:null,clipPolygon:tn,polygonCenter:Kl,centroid:ka};function Bu(h,k){if(!k||!h.length)return h.slice();var P=k*k;return h=Ih(h,P),h=Dh(h,P),h}function Nc(h,k,P){return Math.sqrt(ms(h,k,P,!0))}function yf(h,k,P){return ms(h,k,P)}function Dh(h,k){var P=h.length,V=typeof Uint8Array<"u"?Uint8Array:Array,J=new V(P);J[0]=J[P-1]=1,Zl(h,J,k,0,P-1);var ce,we=[];for(ce=0;ce<P;ce++)J[ce]&&we.push(h[ce]);return we}function Zl(h,k,P,V,J){var ce=0,we,Le,je;for(Le=V+1;Le<=J-1;Le++)je=ms(h[Le],h[V],h[J],!0),je>ce&&(we=Le,ce=je);ce>P&&(k[we]=1,Zl(h,k,P,V,we),Zl(h,k,P,we,J))}function Ih(h,k){for(var P=[h[0]],V=1,J=0,ce=h.length;V<ce;V++)xm(h[V],h[J])>k&&(P.push(h[V]),J=V);return J<ce-1&&P.push(h[ce-1]),P}var Po;function Pc(h,k,P,V,J){var ce=V?Po:Is(h,P),we=Is(k,P),Le,je,Xe;for(Po=we;;){if(!(ce|we))return[h,k];if(ce&we)return!1;Le=ce||we,je=Mc(h,k,Le,P,J),Xe=Is(je,P),Le===ce?(h=je,ce=Xe):(k=je,we=Xe)}}function Mc(h,k,P,V,J){var ce=k.x-h.x,we=k.y-h.y,Le=V.min,je=V.max,Xe,Nt;return P&8?(Xe=h.x+ce*(je.y-h.y)/we,Nt=je.y):P&4?(Xe=h.x+ce*(Le.y-h.y)/we,Nt=Le.y):P&2?(Xe=je.x,Nt=h.y+we*(je.x-h.x)/ce):P&1&&(Xe=Le.x,Nt=h.y+we*(Le.x-h.x)/ce),new Q(Xe,Nt,J)}function Is(h,k){var P=0;return h.x<k.min.x?P|=1:h.x>k.max.x&&(P|=2),h.y<k.min.y?P|=4:h.y>k.max.y&&(P|=8),P}function xm(h,k){var P=k.x-h.x,V=k.y-h.y;return P*P+V*V}function ms(h,k,P,V){var J=k.x,ce=k.y,we=P.x-J,Le=P.y-ce,je=we*we+Le*Le,Xe;return je>0&&(Xe=((h.x-J)*we+(h.y-ce)*Le)/je,Xe>1?(J=P.x,ce=P.y):Xe>0&&(J+=we*Xe,ce+=Le*Xe)),we=h.x-J,Le=h.y-ce,V?we*we+Le*Le:new Q(J,ce)}function Bi(h){return!T(h[0])||typeof h[0][0]!="object"&&typeof h[0][0]<"u"}function xf(h){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),Bi(h)}function bf(h,k){var P,V,J,ce,we,Le,je,Xe;if(!h||h.length===0)throw new Error("latlngs not passed");Bi(h)||(console.warn("latlngs are not flat! Only the first ring will be used"),h=h[0]);var Nt=he([0,0]),Xt=oe(h),hr=Xt.getNorthWest().distanceTo(Xt.getSouthWest())*Xt.getNorthEast().distanceTo(Xt.getNorthWest());hr<1700&&(Nt=ka(h));var Xr=h.length,Gn=[];for(P=0;P<Xr;P++){var Ai=he(h[P]);Gn.push(k.project(he([Ai.lat-Nt.lat,Ai.lng-Nt.lng])))}for(P=0,V=0;P<Xr-1;P++)V+=Gn[P].distanceTo(Gn[P+1])/2;if(V===0)Xe=Gn[0];else for(P=0,ce=0;P<Xr-1;P++)if(we=Gn[P],Le=Gn[P+1],J=we.distanceTo(Le),ce+=J,ce>V){je=(ce-V)/J,Xe=[Le.x-je*(Le.x-we.x),Le.y-je*(Le.y-we.y)];break}var zi=k.unproject(te(Xe));return he([zi.lat+Nt.lat,zi.lng+Nt.lng])}var cl={__proto__:null,simplify:Bu,pointToSegmentDistance:Nc,closestPointOnSegment:yf,clipSegment:Pc,_getEdgeIntersection:Mc,_getBitCode:Is,_sqClosestPointOnSegment:ms,isFlat:Bi,_flat:xf,polylineCenter:bf},Ac={project:function(h){return new Q(h.lng,h.lat)},unproject:function(h){return new se(h.y,h.x)},bounds:new X([-180,-90],[180,90])},Yl={R:6378137,R_MINOR:6356752314245179e-9,bounds:new X([-2003750834279e-5,-1549657073972e-5],[2003750834279e-5,1876465623138e-5]),project:function(h){var k=Math.PI/180,P=this.R,V=h.lat*k,J=this.R_MINOR/P,ce=Math.sqrt(1-J*J),we=ce*Math.sin(V),Le=Math.tan(Math.PI/4-V/2)/Math.pow((1-we)/(1+we),ce/2);return V=-P*Math.log(Math.max(Le,1e-10)),new Q(h.lng*k*P,V)},unproject:function(h){for(var k=180/Math.PI,P=this.R,V=this.R_MINOR/P,J=Math.sqrt(1-V*V),ce=Math.exp(-h.y/P),we=Math.PI/2-2*Math.atan(ce),Le=0,je=.1,Xe;Le<15&&Math.abs(je)>1e-7;Le++)Xe=J*Math.sin(we),Xe=Math.pow((1-Xe)/(1+Xe),J/2),je=Math.PI/2-2*Math.atan(ce*Xe)-we,we+=je;return new se(we*k,h.x*k/P)}},Lc={__proto__:null,LonLat:Ac,Mercator:Yl,SphericalMercator:ve},Xl=i({},pe,{code:"EPSG:3395",projection:Yl,transformation:(function(){var h=.5/(Math.PI*Yl.R);return xe(h,.5,-h,.5)})()}),Rc=i({},pe,{code:"EPSG:4326",projection:Ac,transformation:xe(1/180,1,-1/180,.5)}),wf=i({},ae,{projection:Ac,transformation:xe(1,0,-1,0),scale:function(h){return Math.pow(2,h)},zoom:function(h){return Math.log(h)/Math.LN2},distance:function(h,k){var P=k.lng-h.lng,V=k.lat-h.lat;return Math.sqrt(P*P+V*V)},infinite:!0});ae.Earth=pe,ae.EPSG3395=Xl,ae.EPSG3857=Se,ae.EPSG900913=Ae,ae.EPSG4326=Rc,ae.Simple=wf;var Ka=$.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(h){return h.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(h){return h&&h.removeLayer(this),this},getPane:function(h){return this._map.getPane(h?this.options[h]||h:this.options.pane)},addInteractiveTarget:function(h){return this._map._targets[l(h)]=this,this},removeInteractiveTarget:function(h){return delete this._map._targets[l(h)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(h){var k=h.target;if(k.hasLayer(this)){if(this._map=k,this._zoomAnimated=k._zoomAnimated,this.getEvents){var P=this.getEvents();k.on(P,this),this.once("remove",function(){k.off(P,this)},this)}this.onAdd(k),this.fire("add"),k.fire("layeradd",{layer:this})}}});Er.include({addLayer:function(h){if(!h._layerAdd)throw new Error("The provided object is not a Layer.");var k=l(h);return this._layers[k]?this:(this._layers[k]=h,h._mapToAdd=this,h.beforeAdd&&h.beforeAdd(this),this.whenReady(h._layerAdd,h),this)},removeLayer:function(h){var k=l(h);return this._layers[k]?(this._loaded&&h.onRemove(this),delete this._layers[k],this._loaded&&(this.fire("layerremove",{layer:h}),h.fire("remove")),h._map=h._mapToAdd=null,this):this},hasLayer:function(h){return l(h)in this._layers},eachLayer:function(h,k){for(var P in this._layers)h.call(k,this._layers[P]);return this},_addLayers:function(h){h=h?T(h)?h:[h]:[];for(var k=0,P=h.length;k<P;k++)this.addLayer(h[k])},_addZoomLimit:function(h){(!isNaN(h.options.maxZoom)||!isNaN(h.options.minZoom))&&(this._zoomBoundLayers[l(h)]=h,this._updateZoomLevels())},_removeZoomLimit:function(h){var k=l(h);this._zoomBoundLayers[k]&&(delete this._zoomBoundLayers[k],this._updateZoomLevels())},_updateZoomLevels:function(){var h=1/0,k=-1/0,P=this._getZoomSpan();for(var V in this._zoomBoundLayers){var J=this._zoomBoundLayers[V].options;h=J.minZoom===void 0?h:Math.min(h,J.minZoom),k=J.maxZoom===void 0?k:Math.max(k,J.maxZoom)}this._layersMaxZoom=k===-1/0?void 0:k,this._layersMinZoom=h===1/0?void 0:h,P!==this._getZoomSpan()&&this.fire("zoomlevelschange"),this.options.maxZoom===void 0&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),this.options.minZoom===void 0&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var js=Ka.extend({initialize:function(h,k){S(this,k),this._layers={};var P,V;if(h)for(P=0,V=h.length;P<V;P++)this.addLayer(h[P])},addLayer:function(h){var k=this.getLayerId(h);return this._layers[k]=h,this._map&&this._map.addLayer(h),this},removeLayer:function(h){var k=h in this._layers?h:this.getLayerId(h);return this._map&&this._layers[k]&&this._map.removeLayer(this._layers[k]),delete this._layers[k],this},hasLayer:function(h){var k=typeof h=="number"?h:this.getLayerId(h);return k in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(h){var k=Array.prototype.slice.call(arguments,1),P,V;for(P in this._layers)V=this._layers[P],V[h]&&V[h].apply(V,k);return this},onAdd:function(h){this.eachLayer(h.addLayer,h)},onRemove:function(h){this.eachLayer(h.removeLayer,h)},eachLayer:function(h,k){for(var P in this._layers)h.call(k,this._layers[P]);return this},getLayer:function(h){return this._layers[h]},getLayers:function(){var h=[];return this.eachLayer(h.push,h),h},setZIndex:function(h){return this.invoke("setZIndex",h)},getLayerId:function(h){return l(h)}}),dl=function(h,k){return new js(h,k)},Ji=js.extend({addLayer:function(h){return this.hasLayer(h)?this:(h.addEventParent(this),js.prototype.addLayer.call(this,h),this.fire("layeradd",{layer:h}))},removeLayer:function(h){return this.hasLayer(h)?(h in this._layers&&(h=this._layers[h]),h.removeEventParent(this),js.prototype.removeLayer.call(this,h),this.fire("layerremove",{layer:h})):this},setStyle:function(h){return this.invoke("setStyle",h)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var h=new fe;for(var k in this._layers){var P=this._layers[k];h.extend(P.getBounds?P.getBounds():P.getLatLng())}return h}}),_a=function(h,k){return new Ji(h,k)},Ca=W.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(h){S(this,h)},createIcon:function(h){return this._createIcon("icon",h)},createShadow:function(h){return this._createIcon("shadow",h)},_createIcon:function(h,k){var P=this._getIconUrl(h);if(!P){if(h==="icon")throw new Error("iconUrl not set in Icon options (see the docs).");return null}var V=this._createImg(P,k&&k.tagName==="IMG"?k:null);return this._setIconStyles(V,h),(this.options.crossOrigin||this.options.crossOrigin==="")&&(V.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),V},_setIconStyles:function(h,k){var P=this.options,V=P[k+"Size"];typeof V=="number"&&(V=[V,V]);var J=te(V),ce=te(k==="shadow"&&P.shadowAnchor||P.iconAnchor||J&&J.divideBy(2,!0));h.className="leaflet-marker-"+k+" "+(P.className||""),ce&&(h.style.marginLeft=-ce.x+"px",h.style.marginTop=-ce.y+"px"),J&&(h.style.width=J.x+"px",h.style.height=J.y+"px")},_createImg:function(h,k){return k=k||document.createElement("img"),k.src=h,k},_getIconUrl:function(h){return Tt.retina&&this.options[h+"RetinaUrl"]||this.options[h+"Url"]}});function Oc(h){return new Ca(h)}var fl=Ca.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(h){return typeof fl.imagePath!="string"&&(fl.imagePath=this._detectIconPath()),(this.options.imagePath||fl.imagePath)+Ca.prototype._getIconUrl.call(this,h)},_stripUrl:function(h){var k=function(P,V,J){var ce=V.exec(P);return ce&&ce[J]};return h=k(h,/^url\((['"])?(.+)\1\)$/,2),h&&k(h,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var h=Ze("div","leaflet-default-icon-path",document.body),k=ht(h,"background-image")||ht(h,"backgroundImage");if(document.body.removeChild(h),k=this._stripUrl(k),k)return k;var P=document.querySelector('link[href$="leaflet.css"]');return P?P.href.substring(0,P.href.length-11-1):""}}),Za=Qi.extend({initialize:function(h){this._marker=h},addHooks:function(){var h=this._marker._icon;this._draggable||(this._draggable=new _n(h,h,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),zt(h,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&jr(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(h){var k=this._marker,P=k._map,V=this._marker.options.autoPanSpeed,J=this._marker.options.autoPanPadding,ce=io(k._icon),we=P.getPixelBounds(),Le=P.getPixelOrigin(),je=re(we.min._subtract(Le).add(J),we.max._subtract(Le).subtract(J));if(!je.contains(ce)){var Xe=te((Math.max(je.max.x,ce.x)-je.max.x)/(we.max.x-je.max.x)-(Math.min(je.min.x,ce.x)-je.min.x)/(we.min.x-je.min.x),(Math.max(je.max.y,ce.y)-je.max.y)/(we.max.y-je.max.y)-(Math.min(je.min.y,ce.y)-je.min.y)/(we.min.y-je.min.y)).multiplyBy(V);P.panBy(Xe,{animate:!1}),this._draggable._newPos._add(Xe),this._draggable._startPos._add(Xe),yn(k._icon,this._draggable._newPos),this._onDrag(h),this._panRequest=G(this._adjustPan.bind(this,h))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(h){this._marker.options.autoPan&&(Z(this._panRequest),this._panRequest=G(this._adjustPan.bind(this,h)))},_onDrag:function(h){var k=this._marker,P=k._shadow,V=io(k._icon),J=k._map.layerPointToLatLng(V);P&&yn(P,V),k._latlng=J,h.latlng=J,h.oldLatLng=this._oldLatLng,k.fire("move",h).fire("drag",h)},_onDragEnd:function(h){Z(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",h)}}),Pi=Ka.extend({options:{icon:new fl,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(h,k){S(this,k),this._latlng=he(h)},onAdd:function(h){this._zoomAnimated=this._zoomAnimated&&h.options.markerZoomAnimation,this._zoomAnimated&&h.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(h){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&h.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(h){var k=this._latlng;return this._latlng=he(h),this.update(),this.fire("move",{oldLatLng:k,latlng:this._latlng})},setZIndexOffset:function(h){return this.options.zIndexOffset=h,this.update()},getIcon:function(){return this.options.icon},setIcon:function(h){return this.options.icon=h,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var h=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(h)}return this},_initIcon:function(){var h=this.options,k="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),P=h.icon.createIcon(this._icon),V=!1;P!==this._icon&&(this._icon&&this._removeIcon(),V=!0,h.title&&(P.title=h.title),P.tagName==="IMG"&&(P.alt=h.alt||"")),zt(P,k),h.keyboard&&(P.tabIndex="0",P.setAttribute("role","button")),this._icon=P,h.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&or(P,"focus",this._panOnFocus,this);var J=h.icon.createShadow(this._shadow),ce=!1;J!==this._shadow&&(this._removeShadow(),ce=!0),J&&(zt(J,k),J.alt=""),this._shadow=J,h.opacity<1&&this._updateOpacity(),V&&this.getPane().appendChild(this._icon),this._initInteraction(),J&&ce&&this.getPane(h.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&Zr(this._icon,"focus",this._panOnFocus,this),Dt(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&Dt(this._shadow),this._shadow=null},_setPos:function(h){this._icon&&yn(this._icon,h),this._shadow&&yn(this._shadow,h),this._zIndex=h.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(h){this._icon&&(this._icon.style.zIndex=this._zIndex+h)},_animateZoom:function(h){var k=this._map._latLngToNewLayerPoint(this._latlng,h.zoom,h.center).round();this._setPos(k)},_initInteraction:function(){if(this.options.interactive&&(zt(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),Za)){var h=this.options.draggable;this.dragging&&(h=this.dragging.enabled(),this.dragging.disable()),this.dragging=new Za(this),h&&this.dragging.enable()}},setOpacity:function(h){return this.options.opacity=h,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var h=this.options.opacity;this._icon&&nr(this._icon,h),this._shadow&&nr(this._shadow,h)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var h=this._map;if(h){var k=this.options.icon.options,P=k.iconSize?te(k.iconSize):te(0,0),V=k.iconAnchor?te(k.iconAnchor):te(0,0);h.panInside(this._latlng,{paddingTopLeft:V,paddingBottomRight:P.subtract(V)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function Sf(h,k){return new Pi(h,k)}var oo=Ka.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(h){this._renderer=h.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(h){return S(this,h),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&h&&Object.prototype.hasOwnProperty.call(h,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),Ya=oo.extend({options:{fill:!0,radius:10},initialize:function(h,k){S(this,k),this._latlng=he(h),this._radius=this.options.radius},setLatLng:function(h){var k=this._latlng;return this._latlng=he(h),this.redraw(),this.fire("move",{oldLatLng:k,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(h){return this.options.radius=this._radius=h,this.redraw()},getRadius:function(){return this._radius},setStyle:function(h){var k=h&&h.radius||this._radius;return oo.prototype.setStyle.call(this,h),this.setRadius(k),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var h=this._radius,k=this._radiusY||h,P=this._clickTolerance(),V=[h+P,k+P];this._pxBounds=new X(this._point.subtract(V),this._point.add(V))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(h){return h.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function lo(h,k){return new Ya(h,k)}var hl=Ya.extend({initialize:function(h,k,P){if(typeof k=="number"&&(k=i({},P,{radius:k})),S(this,k),this._latlng=he(h),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(h){return this._mRadius=h,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var h=[this._radius,this._radiusY||this._radius];return new fe(this._map.layerPointToLatLng(this._point.subtract(h)),this._map.layerPointToLatLng(this._point.add(h)))},setStyle:oo.prototype.setStyle,_project:function(){var h=this._latlng.lng,k=this._latlng.lat,P=this._map,V=P.options.crs;if(V.distance===pe.distance){var J=Math.PI/180,ce=this._mRadius/pe.R/J,we=P.project([k+ce,h]),Le=P.project([k-ce,h]),je=we.add(Le).divideBy(2),Xe=P.unproject(je).lat,Nt=Math.acos((Math.cos(ce*J)-Math.sin(k*J)*Math.sin(Xe*J))/(Math.cos(k*J)*Math.cos(Xe*J)))/J;(isNaN(Nt)||Nt===0)&&(Nt=ce/Math.cos(Math.PI/180*k)),this._point=je.subtract(P.getPixelOrigin()),this._radius=isNaN(Nt)?0:je.x-P.project([Xe,h-Nt]).x,this._radiusY=je.y-we.y}else{var Xt=V.unproject(V.project(this._latlng).subtract([this._mRadius,0]));this._point=P.latLngToLayerPoint(this._latlng),this._radius=this._point.x-P.latLngToLayerPoint(Xt).x}this._updateBounds()}});function Ql(h,k,P){return new hl(h,k,P)}var Mi=oo.extend({options:{smoothFactor:1,noClip:!1},initialize:function(h,k){S(this,k),this._setLatLngs(h)},getLatLngs:function(){return this._latlngs},setLatLngs:function(h){return this._setLatLngs(h),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(h){for(var k=1/0,P=null,V=ms,J,ce,we=0,Le=this._parts.length;we<Le;we++)for(var je=this._parts[we],Xe=1,Nt=je.length;Xe<Nt;Xe++){J=je[Xe-1],ce=je[Xe];var Xt=V(h,J,ce,!0);Xt<k&&(k=Xt,P=V(h,J,ce))}return P&&(P.distance=Math.sqrt(k)),P},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return bf(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(h,k){return k=k||this._defaultShape(),h=he(h),k.push(h),this._bounds.extend(h),this.redraw()},_setLatLngs:function(h){this._bounds=new fe,this._latlngs=this._convertLatLngs(h)},_defaultShape:function(){return Bi(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(h){for(var k=[],P=Bi(h),V=0,J=h.length;V<J;V++)P?(k[V]=he(h[V]),this._bounds.extend(k[V])):k[V]=this._convertLatLngs(h[V]);return k},_project:function(){var h=new X;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,h),this._bounds.isValid()&&h.isValid()&&(this._rawPxBounds=h,this._updateBounds())},_updateBounds:function(){var h=this._clickTolerance(),k=new Q(h,h);this._rawPxBounds&&(this._pxBounds=new X([this._rawPxBounds.min.subtract(k),this._rawPxBounds.max.add(k)]))},_projectLatlngs:function(h,k,P){var V=h[0]instanceof se,J=h.length,ce,we;if(V){for(we=[],ce=0;ce<J;ce++)we[ce]=this._map.latLngToLayerPoint(h[ce]),P.extend(we[ce]);k.push(we)}else for(ce=0;ce<J;ce++)this._projectLatlngs(h[ce],k,P)},_clipPoints:function(){var h=this._renderer._bounds;if(this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(h))){if(this.options.noClip){this._parts=this._rings;return}var k=this._parts,P,V,J,ce,we,Le,je;for(P=0,J=0,ce=this._rings.length;P<ce;P++)for(je=this._rings[P],V=0,we=je.length;V<we-1;V++)Le=Pc(je[V],je[V+1],h,V,!0),Le&&(k[J]=k[J]||[],k[J].push(Le[0]),(Le[1]!==je[V+1]||V===we-2)&&(k[J].push(Le[1]),J++))}},_simplifyPoints:function(){for(var h=this._parts,k=this.options.smoothFactor,P=0,V=h.length;P<V;P++)h[P]=Bu(h[P],k)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(h,k){var P,V,J,ce,we,Le,je=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(h))return!1;for(P=0,ce=this._parts.length;P<ce;P++)for(Le=this._parts[P],V=0,we=Le.length,J=we-1;V<we;J=V++)if(!(!k&&V===0)&&Nc(h,Le[J],Le[V])<=je)return!0;return!1}});function jh(h,k){return new Mi(h,k)}Mi._flat=xf;var Ea=Mi.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Kl(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(h){var k=Mi.prototype._convertLatLngs.call(this,h),P=k.length;return P>=2&&k[0]instanceof se&&k[0].equals(k[P-1])&&k.pop(),k},_setLatLngs:function(h){Mi.prototype._setLatLngs.call(this,h),Bi(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return Bi(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var h=this._renderer._bounds,k=this.options.weight,P=new Q(k,k);if(h=new X(h.min.subtract(P),h.max.add(P)),this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(h))){if(this.options.noClip){this._parts=this._rings;return}for(var V=0,J=this._rings.length,ce;V<J;V++)ce=tn(this._rings[V],h,!0),ce.length&&this._parts.push(ce)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(h){var k=!1,P,V,J,ce,we,Le,je,Xe;if(!this._pxBounds||!this._pxBounds.contains(h))return!1;for(ce=0,je=this._parts.length;ce<je;ce++)for(P=this._parts[ce],we=0,Xe=P.length,Le=Xe-1;we<Xe;Le=we++)V=P[we],J=P[Le],V.y>h.y!=J.y>h.y&&h.x<(J.x-V.x)*(h.y-V.y)/(J.y-V.y)+V.x&&(k=!k);return k||Mi.prototype._containsPoint.call(this,h,!0)}});function Xa(h,k){return new Ea(h,k)}var ea=Ji.extend({initialize:function(h,k){S(this,k),this._layers={},h&&this.addData(h)},addData:function(h){var k=T(h)?h:h.features,P,V,J;if(k){for(P=0,V=k.length;P<V;P++)J=k[P],(J.geometries||J.geometry||J.features||J.coordinates)&&this.addData(J);return this}var ce=this.options;if(ce.filter&&!ce.filter(h))return this;var we=gs(h,ce);return we?(we.feature=pl(h),we.defaultOptions=we.options,this.resetStyle(we),ce.onEachFeature&&ce.onEachFeature(h,we),this.addLayer(we)):this},resetStyle:function(h){return h===void 0?this.eachLayer(this.resetStyle,this):(h.options=i({},h.defaultOptions),this._setLayerStyle(h,this.options.style),this)},setStyle:function(h){return this.eachLayer(function(k){this._setLayerStyle(k,h)},this)},_setLayerStyle:function(h,k){h.setStyle&&(typeof k=="function"&&(k=k(h.feature)),h.setStyle(k))}});function gs(h,k){var P=h.type==="Feature"?h.geometry:h,V=P?P.coordinates:null,J=[],ce=k&&k.pointToLayer,we=k&&k.coordsToLatLng||Jl,Le,je,Xe,Nt;if(!V&&!P)return null;switch(P.type){case"Point":return Le=we(V),Ta(ce,h,Le,k);case"MultiPoint":for(Xe=0,Nt=V.length;Xe<Nt;Xe++)Le=we(V[Xe]),J.push(Ta(ce,h,Le,k));return new Ji(J);case"LineString":case"MultiLineString":return je=Fs(V,P.type==="LineString"?0:1,we),new Mi(je,k);case"Polygon":case"MultiPolygon":return je=Fs(V,P.type==="Polygon"?1:2,we),new Ea(je,k);case"GeometryCollection":for(Xe=0,Nt=P.geometries.length;Xe<Nt;Xe++){var Xt=gs({geometry:P.geometries[Xe],type:"Feature",properties:h.properties},k);Xt&&J.push(Xt)}return new Ji(J);case"FeatureCollection":for(Xe=0,Nt=P.features.length;Xe<Nt;Xe++){var hr=gs(P.features[Xe],k);hr&&J.push(hr)}return new Ji(J);default:throw new Error("Invalid GeoJSON object.")}}function Ta(h,k,P,V){return h?h(k,P):new Pi(P,V&&V.markersInheritOptions&&V)}function Jl(h){return new se(h[1],h[0],h[2])}function Fs(h,k,P){for(var V=[],J=0,ce=h.length,we;J<ce;J++)we=k?Fs(h[J],k-1,P):(P||Jl)(h[J]),V.push(we);return V}function zu(h,k){return h=he(h),h.alt!==void 0?[p(h.lng,k),p(h.lat,k),p(h.alt,k)]:[p(h.lng,k),p(h.lat,k)]}function eu(h,k,P,V){for(var J=[],ce=0,we=h.length;ce<we;ce++)J.push(k?eu(h[ce],Bi(h[ce])?0:k-1,P,V):zu(h[ce],V));return!k&&P&&J.length>0&&J.push(J[0].slice()),J}function qr(h,k){return h.feature?i({},h.feature,{geometry:k}):pl(k)}function pl(h){return h.type==="Feature"||h.type==="FeatureCollection"?h:{type:"Feature",properties:{},geometry:h}}var Uu={toGeoJSON:function(h){return qr(this,{type:"Point",coordinates:zu(this.getLatLng(),h)})}};Pi.include(Uu),hl.include(Uu),Ya.include(Uu),Mi.include({toGeoJSON:function(h){var k=!Bi(this._latlngs),P=eu(this._latlngs,k?1:0,!1,h);return qr(this,{type:(k?"Multi":"")+"LineString",coordinates:P})}}),Ea.include({toGeoJSON:function(h){var k=!Bi(this._latlngs),P=k&&!Bi(this._latlngs[0]),V=eu(this._latlngs,P?2:k?1:0,!0,h);return k||(V=[V]),qr(this,{type:(P?"Multi":"")+"Polygon",coordinates:V})}}),js.include({toMultiPoint:function(h){var k=[];return this.eachLayer(function(P){k.push(P.toGeoJSON(h).geometry.coordinates)}),qr(this,{type:"MultiPoint",coordinates:k})},toGeoJSON:function(h){var k=this.feature&&this.feature.geometry&&this.feature.geometry.type;if(k==="MultiPoint")return this.toMultiPoint(h);var P=k==="GeometryCollection",V=[];return this.eachLayer(function(J){if(J.toGeoJSON){var ce=J.toGeoJSON(h);if(P)V.push(ce.geometry);else{var we=pl(ce);we.type==="FeatureCollection"?V.push.apply(V,we.features):V.push(we)}}}),P?qr(this,{geometries:V,type:"GeometryCollection"}):{type:"FeatureCollection",features:V}}});function Dc(h,k){return new ea(h,k)}var ta=Dc,Bs=Ka.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(h,k,P){this._url=h,this._bounds=oe(k),S(this,P)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(zt(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){Dt(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(h){return this.options.opacity=h,this._image&&this._updateOpacity(),this},setStyle:function(h){return h.opacity&&this.setOpacity(h.opacity),this},bringToFront:function(){return this._map&&Mr(this._image),this},bringToBack:function(){return this._map&&Br(this._image),this},setUrl:function(h){return this._url=h,this._image&&(this._image.src=h),this},setBounds:function(h){return this._bounds=oe(h),this._map&&this._reset(),this},getEvents:function(){var h={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(h.zoomanim=this._animateZoom),h},setZIndex:function(h){return this.options.zIndex=h,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var h=this._url.tagName==="IMG",k=this._image=h?this._url:Ze("img");if(zt(k,"leaflet-image-layer"),this._zoomAnimated&&zt(k,"leaflet-zoom-animated"),this.options.className&&zt(k,this.options.className),k.onselectstart=f,k.onmousemove=f,k.onload=s(this.fire,this,"load"),k.onerror=s(this._overlayOnError,this,"error"),(this.options.crossOrigin||this.options.crossOrigin==="")&&(k.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),h){this._url=k.src;return}k.src=this._url,k.alt=this.options.alt},_animateZoom:function(h){var k=this._map.getZoomScale(h.zoom),P=this._map._latLngBoundsToNewLayerBounds(this._bounds,h.zoom,h.center).min;en(this._image,P,k)},_reset:function(){var h=this._image,k=new X(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),P=k.getSize();yn(h,k.min),h.style.width=P.x+"px",h.style.height=P.y+"px"},_updateOpacity:function(){nr(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var h=this.options.errorOverlayUrl;h&&this._url!==h&&(this._url=h,this._image.src=h)},getCenter:function(){return this._bounds.getCenter()}}),Mo=function(h,k,P){return new Bs(h,k,P)},ln=Bs.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var h=this._url.tagName==="VIDEO",k=this._image=h?this._url:Ze("video");if(zt(k,"leaflet-image-layer"),this._zoomAnimated&&zt(k,"leaflet-zoom-animated"),this.options.className&&zt(k,this.options.className),k.onselectstart=f,k.onmousemove=f,k.onloadeddata=s(this.fire,this,"load"),h){for(var P=k.getElementsByTagName("source"),V=[],J=0;J<P.length;J++)V.push(P[J].src);this._url=P.length>0?V:[k.src];return}T(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(k.style,"objectFit")&&(k.style.objectFit="fill"),k.autoplay=!!this.options.autoplay,k.loop=!!this.options.loop,k.muted=!!this.options.muted,k.playsInline=!!this.options.playsInline;for(var ce=0;ce<this._url.length;ce++){var we=Ze("source");we.src=this._url[ce],k.appendChild(we)}}});function zn(h,k,P){return new ln(h,k,P)}var Un=Bs.extend({_initImage:function(){var h=this._image=this._url;zt(h,"leaflet-image-layer"),this._zoomAnimated&&zt(h,"leaflet-zoom-animated"),this.options.className&&zt(h,this.options.className),h.onselectstart=f,h.onmousemove=f}});function tu(h,k,P){return new Un(h,k,P)}var ra=Ka.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(h,k){h&&(h instanceof se||T(h))?(this._latlng=he(h),S(this,k)):(S(this,h),this._source=k),this.options.content&&(this._content=this.options.content)},openOn:function(h){return h=arguments.length?h:this._source._map,h.hasLayer(this)||h.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(h){return this._map?this.close():(arguments.length?this._source=h:h=this._source,this._prepareOpen(),this.openOn(h._map)),this},onAdd:function(h){this._zoomAnimated=h._zoomAnimated,this._container||this._initLayout(),h._fadeAnimated&&nr(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),h._fadeAnimated&&nr(this._container,1),this.bringToFront(),this.options.interactive&&(zt(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(h){h._fadeAnimated?(nr(this._container,0),this._removeTimeout=setTimeout(s(Dt,void 0,this._container),200)):Dt(this._container),this.options.interactive&&(jr(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(h){return this._latlng=he(h),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(h){return this._content=h,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var h={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(h.zoomanim=this._animateZoom),h},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&Mr(this._container),this},bringToBack:function(){return this._map&&Br(this._container),this},_prepareOpen:function(h){var k=this._source;if(!k._map)return!1;if(k instanceof Ji){k=null;var P=this._source._layers;for(var V in P)if(P[V]._map){k=P[V];break}if(!k)return!1;this._source=k}if(!h)if(k.getCenter)h=k.getCenter();else if(k.getLatLng)h=k.getLatLng();else if(k.getBounds)h=k.getBounds().getCenter();else throw new Error("Unable to get source layer LatLng.");return this.setLatLng(h),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var h=this._contentNode,k=typeof this._content=="function"?this._content(this._source||this):this._content;if(typeof k=="string")h.innerHTML=k;else{for(;h.hasChildNodes();)h.removeChild(h.firstChild);h.appendChild(k)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var h=this._map.latLngToLayerPoint(this._latlng),k=te(this.options.offset),P=this._getAnchor();this._zoomAnimated?yn(this._container,h.add(P)):k=k.add(h).add(P);var V=this._containerBottom=-k.y,J=this._containerLeft=-Math.round(this._containerWidth/2)+k.x;this._container.style.bottom=V+"px",this._container.style.left=J+"px"}},_getAnchor:function(){return[0,0]}});Er.include({_initOverlay:function(h,k,P,V){var J=k;return J instanceof h||(J=new h(V).setContent(k)),P&&J.setLatLng(P),J}}),Ka.include({_initOverlay:function(h,k,P,V){var J=P;return J instanceof h?(S(J,V),J._source=this):(J=k&&!V?k:new h(V,this),J.setContent(P)),J}});var Ao=ra.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(h){return h=arguments.length?h:this._source._map,!h.hasLayer(this)&&h._popup&&h._popup.options.autoClose&&h.removeLayer(h._popup),h._popup=this,ra.prototype.openOn.call(this,h)},onAdd:function(h){ra.prototype.onAdd.call(this,h),h.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof oo||this._source.on("preclick",Os))},onRemove:function(h){ra.prototype.onRemove.call(this,h),h.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof oo||this._source.off("preclick",Os))},getEvents:function(){var h=ra.prototype.getEvents.call(this);return(this.options.closeOnClick!==void 0?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(h.preclick=this.close),this.options.keepInView&&(h.moveend=this._adjustPan),h},_initLayout:function(){var h="leaflet-popup",k=this._container=Ze("div",h+" "+(this.options.className||"")+" leaflet-zoom-animated"),P=this._wrapper=Ze("div",h+"-content-wrapper",k);if(this._contentNode=Ze("div",h+"-content",P),Du(k),Wl(this._contentNode),or(k,"contextmenu",Os),this._tipContainer=Ze("div",h+"-tip-container",k),this._tip=Ze("div",h+"-tip",this._tipContainer),this.options.closeButton){var V=this._closeButton=Ze("a",h+"-close-button",k);V.setAttribute("role","button"),V.setAttribute("aria-label","Close popup"),V.href="#close",V.innerHTML='<span aria-hidden="true">&#215;</span>',or(V,"click",function(J){hn(J),this.close()},this)}},_updateLayout:function(){var h=this._contentNode,k=h.style;k.width="",k.whiteSpace="nowrap";var P=h.offsetWidth;P=Math.min(P,this.options.maxWidth),P=Math.max(P,this.options.minWidth),k.width=P+1+"px",k.whiteSpace="",k.height="";var V=h.offsetHeight,J=this.options.maxHeight,ce="leaflet-popup-scrolled";J&&V>J?(k.height=J+"px",zt(h,ce)):jr(h,ce),this._containerWidth=this._container.offsetWidth},_animateZoom:function(h){var k=this._map._latLngToNewLayerPoint(this._latlng,h.zoom,h.center),P=this._getAnchor();yn(this._container,k.add(P))},_adjustPan:function(){if(this.options.autoPan){if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning){this._autopanning=!1;return}var h=this._map,k=parseInt(ht(this._container,"marginBottom"),10)||0,P=this._container.offsetHeight+k,V=this._containerWidth,J=new Q(this._containerLeft,-P-this._containerBottom);J._add(io(this._container));var ce=h.layerPointToContainerPoint(J),we=te(this.options.autoPanPadding),Le=te(this.options.autoPanPaddingTopLeft||we),je=te(this.options.autoPanPaddingBottomRight||we),Xe=h.getSize(),Nt=0,Xt=0;ce.x+V+je.x>Xe.x&&(Nt=ce.x+V-Xe.x+je.x),ce.x-Nt-Le.x<0&&(Nt=ce.x-Le.x),ce.y+P+je.y>Xe.y&&(Xt=ce.y+P-Xe.y+je.y),ce.y-Xt-Le.y<0&&(Xt=ce.y-Le.y),(Nt||Xt)&&(this.options.keepInView&&(this._autopanning=!0),h.fire("autopanstart").panBy([Nt,Xt]))}},_getAnchor:function(){return te(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),ru=function(h,k){return new Ao(h,k)};Er.mergeOptions({closePopupOnClick:!0}),Er.include({openPopup:function(h,k,P){return this._initOverlay(Ao,h,k,P).openOn(this),this},closePopup:function(h){return h=arguments.length?h:this._popup,h&&h.close(),this}}),Ka.include({bindPopup:function(h,k){return this._popup=this._initOverlay(Ao,this._popup,h,k),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(h){return this._popup&&(this instanceof Ji||(this._popup._source=this),this._popup._prepareOpen(h||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return this._popup?this._popup.isOpen():!1},setPopupContent:function(h){return this._popup&&this._popup.setContent(h),this},getPopup:function(){return this._popup},_openPopup:function(h){if(!(!this._popup||!this._map)){Fn(h);var k=h.layer||h.target;if(this._popup._source===k&&!(k instanceof oo)){this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(h.latlng);return}this._popup._source=k,this.openPopup(h.latlng)}},_movePopup:function(h){this._popup.setLatLng(h.latlng)},_onKeyPress:function(h){h.originalEvent.keyCode===13&&this._openPopup(h)}});var Ln=ra.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(h){ra.prototype.onAdd.call(this,h),this.setOpacity(this.options.opacity),h.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(h){ra.prototype.onRemove.call(this,h),h.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var h=ra.prototype.getEvents.call(this);return this.options.permanent||(h.preclick=this.close),h},_initLayout:function(){var h="leaflet-tooltip",k=h+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=Ze("div",k),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+l(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(h){var k,P,V=this._map,J=this._container,ce=V.latLngToContainerPoint(V.getCenter()),we=V.layerPointToContainerPoint(h),Le=this.options.direction,je=J.offsetWidth,Xe=J.offsetHeight,Nt=te(this.options.offset),Xt=this._getAnchor();Le==="top"?(k=je/2,P=Xe):Le==="bottom"?(k=je/2,P=0):Le==="center"?(k=je/2,P=Xe/2):Le==="right"?(k=0,P=Xe/2):Le==="left"?(k=je,P=Xe/2):we.x<ce.x?(Le="right",k=0,P=Xe/2):(Le="left",k=je+(Nt.x+Xt.x)*2,P=Xe/2),h=h.subtract(te(k,P,!0)).add(Nt).add(Xt),jr(J,"leaflet-tooltip-right"),jr(J,"leaflet-tooltip-left"),jr(J,"leaflet-tooltip-top"),jr(J,"leaflet-tooltip-bottom"),zt(J,"leaflet-tooltip-"+Le),yn(J,h)},_updatePosition:function(){var h=this._map.latLngToLayerPoint(this._latlng);this._setPosition(h)},setOpacity:function(h){this.options.opacity=h,this._container&&nr(this._container,h)},_animateZoom:function(h){var k=this._map._latLngToNewLayerPoint(this._latlng,h.zoom,h.center);this._setPosition(k)},_getAnchor:function(){return te(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),ml=function(h,k){return new Ln(h,k)};Er.include({openTooltip:function(h,k,P){return this._initOverlay(Ln,h,k,P).openOn(this),this},closeTooltip:function(h){return h.close(),this}}),Ka.include({bindTooltip:function(h,k){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(Ln,this._tooltip,h,k),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(h){if(!(!h&&this._tooltipHandlersAdded)){var k=h?"off":"on",P={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?P.add=this._openTooltip:(P.mouseover=this._openTooltip,P.mouseout=this.closeTooltip,P.click=this._openTooltip,this._map?this._addFocusListeners():P.add=this._addFocusListeners),this._tooltip.options.sticky&&(P.mousemove=this._moveTooltip),this[k](P),this._tooltipHandlersAdded=!h}},openTooltip:function(h){return this._tooltip&&(this instanceof Ji||(this._tooltip._source=this),this._tooltip._prepareOpen(h)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(h){return this._tooltip&&this._tooltip.setContent(h),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(h){var k=typeof h.getElement=="function"&&h.getElement();k&&(or(k,"focus",function(){this._tooltip._source=h,this.openTooltip()},this),or(k,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(h){var k=typeof h.getElement=="function"&&h.getElement();k&&k.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(h){if(!(!this._tooltip||!this._map)){if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var k=this;this._map.once("moveend",function(){k._openOnceFlag=!1,k._openTooltip(h)});return}this._tooltip._source=h.layer||h.target,this.openTooltip(this._tooltip.options.sticky?h.latlng:void 0)}},_moveTooltip:function(h){var k=h.latlng,P,V;this._tooltip.options.sticky&&h.originalEvent&&(P=this._map.mouseEventToContainerPoint(h.originalEvent),V=this._map.containerPointToLayerPoint(P),k=this._map.layerPointToLatLng(V)),this._tooltip.setLatLng(k)}});var nu=Ca.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(h){var k=h&&h.tagName==="DIV"?h:document.createElement("div"),P=this.options;if(P.html instanceof Element?(Pr(k),k.appendChild(P.html)):k.innerHTML=P.html!==!1?P.html:"",P.bgPos){var V=te(P.bgPos);k.style.backgroundPosition=-V.x+"px "+-V.y+"px"}return this._setIconStyles(k,"icon"),k},createShadow:function(){return null}});function Ic(h){return new nu(h)}Ca.Default=fl;var bi=Ka.extend({options:{tileSize:256,opacity:1,updateWhenIdle:Tt.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(h){S(this,h)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(h){h._addZoomLimit(this)},onRemove:function(h){this._removeAllTiles(),Dt(this._container),h._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(Mr(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(Br(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(h){return this.options.opacity=h,this._updateOpacity(),this},setZIndex:function(h){return this.options.zIndex=h,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var h=this._clampZoom(this._map.getZoom());h!==this._tileZoom&&(this._tileZoom=h,this._updateLevels()),this._update()}return this},getEvents:function(){var h={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=u(this._onMoveEnd,this.options.updateInterval,this)),h.move=this._onMove),this._zoomAnimated&&(h.zoomanim=this._animateZoom),h},createTile:function(){return document.createElement("div")},getTileSize:function(){var h=this.options.tileSize;return h instanceof Q?h:new Q(h,h)},_updateZIndex:function(){this._container&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(h){for(var k=this.getPane().children,P=-h(-1/0,1/0),V=0,J=k.length,ce;V<J;V++)ce=k[V].style.zIndex,k[V]!==this._container&&ce&&(P=h(P,+ce));isFinite(P)&&(this.options.zIndex=P+h(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!Tt.ielt9){nr(this._container,this.options.opacity);var h=+new Date,k=!1,P=!1;for(var V in this._tiles){var J=this._tiles[V];if(!(!J.current||!J.loaded)){var ce=Math.min(1,(h-J.loaded)/200);nr(J.el,ce),ce<1?k=!0:(J.active?P=!0:this._onOpaqueTile(J),J.active=!0)}}P&&!this._noPrune&&this._pruneTiles(),k&&(Z(this._fadeFrame),this._fadeFrame=G(this._updateOpacity,this))}},_onOpaqueTile:f,_initContainer:function(){this._container||(this._container=Ze("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var h=this._tileZoom,k=this.options.maxZoom;if(h!==void 0){for(var P in this._levels)P=Number(P),this._levels[P].el.children.length||P===h?(this._levels[P].el.style.zIndex=k-Math.abs(h-P),this._onUpdateLevel(P)):(Dt(this._levels[P].el),this._removeTilesAtZoom(P),this._onRemoveLevel(P),delete this._levels[P]);var V=this._levels[h],J=this._map;return V||(V=this._levels[h]={},V.el=Ze("div","leaflet-tile-container leaflet-zoom-animated",this._container),V.el.style.zIndex=k,V.origin=J.project(J.unproject(J.getPixelOrigin()),h).round(),V.zoom=h,this._setZoomTransform(V,J.getCenter(),J.getZoom()),f(V.el.offsetWidth),this._onCreateLevel(V)),this._level=V,V}},_onUpdateLevel:f,_onRemoveLevel:f,_onCreateLevel:f,_pruneTiles:function(){if(this._map){var h,k,P=this._map.getZoom();if(P>this.options.maxZoom||P<this.options.minZoom){this._removeAllTiles();return}for(h in this._tiles)k=this._tiles[h],k.retain=k.current;for(h in this._tiles)if(k=this._tiles[h],k.current&&!k.active){var V=k.coords;this._retainParent(V.x,V.y,V.z,V.z-5)||this._retainChildren(V.x,V.y,V.z,V.z+2)}for(h in this._tiles)this._tiles[h].retain||this._removeTile(h)}},_removeTilesAtZoom:function(h){for(var k in this._tiles)this._tiles[k].coords.z===h&&this._removeTile(k)},_removeAllTiles:function(){for(var h in this._tiles)this._removeTile(h)},_invalidateAll:function(){for(var h in this._levels)Dt(this._levels[h].el),this._onRemoveLevel(Number(h)),delete this._levels[h];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(h,k,P,V){var J=Math.floor(h/2),ce=Math.floor(k/2),we=P-1,Le=new Q(+J,+ce);Le.z=+we;var je=this._tileCoordsToKey(Le),Xe=this._tiles[je];return Xe&&Xe.active?(Xe.retain=!0,!0):(Xe&&Xe.loaded&&(Xe.retain=!0),we>V?this._retainParent(J,ce,we,V):!1)},_retainChildren:function(h,k,P,V){for(var J=2*h;J<2*h+2;J++)for(var ce=2*k;ce<2*k+2;ce++){var we=new Q(J,ce);we.z=P+1;var Le=this._tileCoordsToKey(we),je=this._tiles[Le];if(je&&je.active){je.retain=!0;continue}else je&&je.loaded&&(je.retain=!0);P+1<V&&this._retainChildren(J,ce,P+1,V)}},_resetView:function(h){var k=h&&(h.pinch||h.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),k,k)},_animateZoom:function(h){this._setView(h.center,h.zoom,!0,h.noUpdate)},_clampZoom:function(h){var k=this.options;return k.minNativeZoom!==void 0&&h<k.minNativeZoom?k.minNativeZoom:k.maxNativeZoom!==void 0&&k.maxNativeZoom<h?k.maxNativeZoom:h},_setView:function(h,k,P,V){var J=Math.round(k);this.options.maxZoom!==void 0&&J>this.options.maxZoom||this.options.minZoom!==void 0&&J<this.options.minZoom?J=void 0:J=this._clampZoom(J);var ce=this.options.updateWhenZooming&&J!==this._tileZoom;(!V||ce)&&(this._tileZoom=J,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),J!==void 0&&this._update(h),P||this._pruneTiles(),this._noPrune=!!P),this._setZoomTransforms(h,k)},_setZoomTransforms:function(h,k){for(var P in this._levels)this._setZoomTransform(this._levels[P],h,k)},_setZoomTransform:function(h,k,P){var V=this._map.getZoomScale(P,h.zoom),J=h.origin.multiplyBy(V).subtract(this._map._getNewPixelOrigin(k,P)).round();Tt.any3d?en(h.el,J,V):yn(h.el,J)},_resetGrid:function(){var h=this._map,k=h.options.crs,P=this._tileSize=this.getTileSize(),V=this._tileZoom,J=this._map.getPixelWorldBounds(this._tileZoom);J&&(this._globalTileRange=this._pxBoundsToTileRange(J)),this._wrapX=k.wrapLng&&!this.options.noWrap&&[Math.floor(h.project([0,k.wrapLng[0]],V).x/P.x),Math.ceil(h.project([0,k.wrapLng[1]],V).x/P.y)],this._wrapY=k.wrapLat&&!this.options.noWrap&&[Math.floor(h.project([k.wrapLat[0],0],V).y/P.x),Math.ceil(h.project([k.wrapLat[1],0],V).y/P.y)]},_onMoveEnd:function(){!this._map||this._map._animatingZoom||this._update()},_getTiledPixelBounds:function(h){var k=this._map,P=k._animatingZoom?Math.max(k._animateToZoom,k.getZoom()):k.getZoom(),V=k.getZoomScale(P,this._tileZoom),J=k.project(h,this._tileZoom).floor(),ce=k.getSize().divideBy(V*2);return new X(J.subtract(ce),J.add(ce))},_update:function(h){var k=this._map;if(k){var P=this._clampZoom(k.getZoom());if(h===void 0&&(h=k.getCenter()),this._tileZoom!==void 0){var V=this._getTiledPixelBounds(h),J=this._pxBoundsToTileRange(V),ce=J.getCenter(),we=[],Le=this.options.keepBuffer,je=new X(J.getBottomLeft().subtract([Le,-Le]),J.getTopRight().add([Le,-Le]));if(!(isFinite(J.min.x)&&isFinite(J.min.y)&&isFinite(J.max.x)&&isFinite(J.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var Xe in this._tiles){var Nt=this._tiles[Xe].coords;(Nt.z!==this._tileZoom||!je.contains(new Q(Nt.x,Nt.y)))&&(this._tiles[Xe].current=!1)}if(Math.abs(P-this._tileZoom)>1){this._setView(h,P);return}for(var Xt=J.min.y;Xt<=J.max.y;Xt++)for(var hr=J.min.x;hr<=J.max.x;hr++){var Xr=new Q(hr,Xt);if(Xr.z=this._tileZoom,!!this._isValidTile(Xr)){var Gn=this._tiles[this._tileCoordsToKey(Xr)];Gn?Gn.current=!0:we.push(Xr)}}if(we.sort(function(zi,yl){return zi.distanceTo(ce)-yl.distanceTo(ce)}),we.length!==0){this._loading||(this._loading=!0,this.fire("loading"));var Ai=document.createDocumentFragment();for(hr=0;hr<we.length;hr++)this._addTile(we[hr],Ai);this._level.el.appendChild(Ai)}}}},_isValidTile:function(h){var k=this._map.options.crs;if(!k.infinite){var P=this._globalTileRange;if(!k.wrapLng&&(h.x<P.min.x||h.x>P.max.x)||!k.wrapLat&&(h.y<P.min.y||h.y>P.max.y))return!1}if(!this.options.bounds)return!0;var V=this._tileCoordsToBounds(h);return oe(this.options.bounds).overlaps(V)},_keyToBounds:function(h){return this._tileCoordsToBounds(this._keyToTileCoords(h))},_tileCoordsToNwSe:function(h){var k=this._map,P=this.getTileSize(),V=h.scaleBy(P),J=V.add(P),ce=k.unproject(V,h.z),we=k.unproject(J,h.z);return[ce,we]},_tileCoordsToBounds:function(h){var k=this._tileCoordsToNwSe(h),P=new fe(k[0],k[1]);return this.options.noWrap||(P=this._map.wrapLatLngBounds(P)),P},_tileCoordsToKey:function(h){return h.x+":"+h.y+":"+h.z},_keyToTileCoords:function(h){var k=h.split(":"),P=new Q(+k[0],+k[1]);return P.z=+k[2],P},_removeTile:function(h){var k=this._tiles[h];k&&(Dt(k.el),delete this._tiles[h],this.fire("tileunload",{tile:k.el,coords:this._keyToTileCoords(h)}))},_initTile:function(h){zt(h,"leaflet-tile");var k=this.getTileSize();h.style.width=k.x+"px",h.style.height=k.y+"px",h.onselectstart=f,h.onmousemove=f,Tt.ielt9&&this.options.opacity<1&&nr(h,this.options.opacity)},_addTile:function(h,k){var P=this._getTilePos(h),V=this._tileCoordsToKey(h),J=this.createTile(this._wrapCoords(h),s(this._tileReady,this,h));this._initTile(J),this.createTile.length<2&&G(s(this._tileReady,this,h,null,J)),yn(J,P),this._tiles[V]={el:J,coords:h,current:!0},k.appendChild(J),this.fire("tileloadstart",{tile:J,coords:h})},_tileReady:function(h,k,P){k&&this.fire("tileerror",{error:k,tile:P,coords:h});var V=this._tileCoordsToKey(h);P=this._tiles[V],P&&(P.loaded=+new Date,this._map._fadeAnimated?(nr(P.el,0),Z(this._fadeFrame),this._fadeFrame=G(this._updateOpacity,this)):(P.active=!0,this._pruneTiles()),k||(zt(P.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:P.el,coords:h})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),Tt.ielt9||!this._map._fadeAnimated?G(this._pruneTiles,this):setTimeout(s(this._pruneTiles,this),250)))},_getTilePos:function(h){return h.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(h){var k=new Q(this._wrapX?c(h.x,this._wrapX):h.x,this._wrapY?c(h.y,this._wrapY):h.y);return k.z=h.z,k},_pxBoundsToTileRange:function(h){var k=this.getTileSize();return new X(h.min.unscaleBy(k).floor(),h.max.unscaleBy(k).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var h in this._tiles)if(!this._tiles[h].loaded)return!1;return!0}});function wi(h){return new bi(h)}var Qa=bi.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(h,k){this._url=h,k=S(this,k),k.detectRetina&&Tt.retina&&k.maxZoom>0?(k.tileSize=Math.floor(k.tileSize/2),k.zoomReverse?(k.zoomOffset--,k.minZoom=Math.min(k.maxZoom,k.minZoom+1)):(k.zoomOffset++,k.maxZoom=Math.max(k.minZoom,k.maxZoom-1)),k.minZoom=Math.max(0,k.minZoom)):k.zoomReverse?k.minZoom=Math.min(k.maxZoom,k.minZoom):k.maxZoom=Math.max(k.minZoom,k.maxZoom),typeof k.subdomains=="string"&&(k.subdomains=k.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(h,k){return this._url===h&&k===void 0&&(k=!0),this._url=h,k||this.redraw(),this},createTile:function(h,k){var P=document.createElement("img");return or(P,"load",s(this._tileOnLoad,this,k,P)),or(P,"error",s(this._tileOnError,this,k,P)),(this.options.crossOrigin||this.options.crossOrigin==="")&&(P.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),typeof this.options.referrerPolicy=="string"&&(P.referrerPolicy=this.options.referrerPolicy),P.alt="",P.src=this.getTileUrl(h),P},getTileUrl:function(h){var k={r:Tt.retina?"@2x":"",s:this._getSubdomain(h),x:h.x,y:h.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var P=this._globalTileRange.max.y-h.y;this.options.tms&&(k.y=P),k["-y"]=P}return _(this._url,i(k,this.options))},_tileOnLoad:function(h,k){Tt.ielt9?setTimeout(s(h,this,null,k),0):h(null,k)},_tileOnError:function(h,k,P){var V=this.options.errorTileUrl;V&&k.getAttribute("src")!==V&&(k.src=V),h(P,k)},_onTileRemove:function(h){h.tile.onload=null},_getZoomForUrl:function(){var h=this._tileZoom,k=this.options.maxZoom,P=this.options.zoomReverse,V=this.options.zoomOffset;return P&&(h=k-h),h+V},_getSubdomain:function(h){var k=Math.abs(h.x+h.y)%this.options.subdomains.length;return this.options.subdomains[k]},_abortLoading:function(){var h,k;for(h in this._tiles)if(this._tiles[h].coords.z!==this._tileZoom&&(k=this._tiles[h].el,k.onload=f,k.onerror=f,!k.complete)){k.src=R;var P=this._tiles[h].coords;Dt(k),delete this._tiles[h],this.fire("tileabort",{tile:k,coords:P})}},_removeTile:function(h){var k=this._tiles[h];if(k)return k.el.setAttribute("src",R),bi.prototype._removeTile.call(this,h)},_tileReady:function(h,k,P){if(!(!this._map||P&&P.getAttribute("src")===R))return bi.prototype._tileReady.call(this,h,k,P)}});function Gu(h,k){return new Qa(h,k)}var gl=Qa.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(h,k){this._url=h;var P=i({},this.defaultWmsParams);for(var V in k)V in this.options||(P[V]=k[V]);k=S(this,k);var J=k.detectRetina&&Tt.retina?2:1,ce=this.getTileSize();P.width=ce.x*J,P.height=ce.y*J,this.wmsParams=P},onAdd:function(h){this._crs=this.options.crs||h.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var k=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[k]=this._crs.code,Qa.prototype.onAdd.call(this,h)},getTileUrl:function(h){var k=this._tileCoordsToNwSe(h),P=this._crs,V=re(P.project(k[0]),P.project(k[1])),J=V.min,ce=V.max,we=(this._wmsVersion>=1.3&&this._crs===Rc?[J.y,J.x,ce.y,ce.x]:[J.x,J.y,ce.x,ce.y]).join(","),Le=Qa.prototype.getTileUrl.call(this,h);return Le+w(this.wmsParams,Le,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+we},setParams:function(h,k){return i(this.wmsParams,h),k||this.redraw(),this}});function kf(h,k){return new gl(h,k)}Qa.WMS=gl,Gu.wms=kf;var vs=Ka.extend({options:{padding:.1},initialize:function(h){S(this,h),l(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),zt(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var h={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(h.zoomanim=this._onAnimZoom),h},_onAnimZoom:function(h){this._updateTransform(h.center,h.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(h,k){var P=this._map.getZoomScale(k,this._zoom),V=this._map.getSize().multiplyBy(.5+this.options.padding),J=this._map.project(this._center,k),ce=V.multiplyBy(-P).add(J).subtract(this._map._getNewPixelOrigin(h,k));Tt.any3d?en(this._container,ce,P):yn(this._container,ce)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var h in this._layers)this._layers[h]._reset()},_onZoomEnd:function(){for(var h in this._layers)this._layers[h]._project()},_updatePaths:function(){for(var h in this._layers)this._layers[h]._update()},_update:function(){var h=this.options.padding,k=this._map.getSize(),P=this._map.containerPointToLayerPoint(k.multiplyBy(-h)).round();this._bounds=new X(P,P.add(k.multiplyBy(1+h*2)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),jc=vs.extend({options:{tolerance:0},getEvents:function(){var h=vs.prototype.getEvents.call(this);return h.viewprereset=this._onViewPreReset,h},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){vs.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var h=this._container=document.createElement("canvas");or(h,"mousemove",this._onMouseMove,this),or(h,"click dblclick mousedown mouseup contextmenu",this._onClick,this),or(h,"mouseout",this._handleMouseOut,this),h._leaflet_disable_events=!0,this._ctx=h.getContext("2d")},_destroyContainer:function(){Z(this._redrawRequest),delete this._ctx,Dt(this._container),Zr(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){var h;this._redrawBounds=null;for(var k in this._layers)h=this._layers[k],h._update();this._redraw()}},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){vs.prototype._update.call(this);var h=this._bounds,k=this._container,P=h.getSize(),V=Tt.retina?2:1;yn(k,h.min),k.width=V*P.x,k.height=V*P.y,k.style.width=P.x+"px",k.style.height=P.y+"px",Tt.retina&&this._ctx.scale(2,2),this._ctx.translate(-h.min.x,-h.min.y),this.fire("update")}},_reset:function(){vs.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(h){this._updateDashArray(h),this._layers[l(h)]=h;var k=h._order={layer:h,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=k),this._drawLast=k,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(h){this._requestRedraw(h)},_removePath:function(h){var k=h._order,P=k.next,V=k.prev;P?P.prev=V:this._drawLast=V,V?V.next=P:this._drawFirst=P,delete h._order,delete this._layers[l(h)],this._requestRedraw(h)},_updatePath:function(h){this._extendRedrawBounds(h),h._project(),h._update(),this._requestRedraw(h)},_updateStyle:function(h){this._updateDashArray(h),this._requestRedraw(h)},_updateDashArray:function(h){if(typeof h.options.dashArray=="string"){var k=h.options.dashArray.split(/[, ]+/),P=[],V,J;for(J=0;J<k.length;J++){if(V=Number(k[J]),isNaN(V))return;P.push(V)}h.options._dashArray=P}else h.options._dashArray=h.options.dashArray},_requestRedraw:function(h){this._map&&(this._extendRedrawBounds(h),this._redrawRequest=this._redrawRequest||G(this._redraw,this))},_extendRedrawBounds:function(h){if(h._pxBounds){var k=(h.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new X,this._redrawBounds.extend(h._pxBounds.min.subtract([k,k])),this._redrawBounds.extend(h._pxBounds.max.add([k,k]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var h=this._redrawBounds;if(h){var k=h.getSize();this._ctx.clearRect(h.min.x,h.min.y,k.x,k.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var h,k=this._redrawBounds;if(this._ctx.save(),k){var P=k.getSize();this._ctx.beginPath(),this._ctx.rect(k.min.x,k.min.y,P.x,P.y),this._ctx.clip()}this._drawing=!0;for(var V=this._drawFirst;V;V=V.next)h=V.layer,(!k||h._pxBounds&&h._pxBounds.intersects(k))&&h._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(h,k){if(this._drawing){var P,V,J,ce,we=h._parts,Le=we.length,je=this._ctx;if(Le){for(je.beginPath(),P=0;P<Le;P++){for(V=0,J=we[P].length;V<J;V++)ce=we[P][V],je[V?"lineTo":"moveTo"](ce.x,ce.y);k&&je.closePath()}this._fillStroke(je,h)}}},_updateCircle:function(h){if(!(!this._drawing||h._empty())){var k=h._point,P=this._ctx,V=Math.max(Math.round(h._radius),1),J=(Math.max(Math.round(h._radiusY),1)||V)/V;J!==1&&(P.save(),P.scale(1,J)),P.beginPath(),P.arc(k.x,k.y/J,V,0,Math.PI*2,!1),J!==1&&P.restore(),this._fillStroke(P,h)}},_fillStroke:function(h,k){var P=k.options;P.fill&&(h.globalAlpha=P.fillOpacity,h.fillStyle=P.fillColor||P.color,h.fill(P.fillRule||"evenodd")),P.stroke&&P.weight!==0&&(h.setLineDash&&h.setLineDash(k.options&&k.options._dashArray||[]),h.globalAlpha=P.opacity,h.lineWidth=P.weight,h.strokeStyle=P.color,h.lineCap=P.lineCap,h.lineJoin=P.lineJoin,h.stroke())},_onClick:function(h){for(var k=this._map.mouseEventToLayerPoint(h),P,V,J=this._drawFirst;J;J=J.next)P=J.layer,P.options.interactive&&P._containsPoint(k)&&(!(h.type==="click"||h.type==="preclick")||!this._map._draggableMoved(P))&&(V=P);this._fireEvent(V?[V]:!1,h)},_onMouseMove:function(h){if(!(!this._map||this._map.dragging.moving()||this._map._animatingZoom)){var k=this._map.mouseEventToLayerPoint(h);this._handleMouseHover(h,k)}},_handleMouseOut:function(h){var k=this._hoveredLayer;k&&(jr(this._container,"leaflet-interactive"),this._fireEvent([k],h,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(h,k){if(!this._mouseHoverThrottled){for(var P,V,J=this._drawFirst;J;J=J.next)P=J.layer,P.options.interactive&&P._containsPoint(k)&&(V=P);V!==this._hoveredLayer&&(this._handleMouseOut(h),V&&(zt(this._container,"leaflet-interactive"),this._fireEvent([V],h,"mouseover"),this._hoveredLayer=V)),this._fireEvent(this._hoveredLayer?[this._hoveredLayer]:!1,h),this._mouseHoverThrottled=!0,setTimeout(s(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(h,k,P){this._map._fireDOMEvent(k,P||k.type,h)},_bringToFront:function(h){var k=h._order;if(k){var P=k.next,V=k.prev;if(P)P.prev=V;else return;V?V.next=P:P&&(this._drawFirst=P),k.prev=this._drawLast,this._drawLast.next=k,k.next=null,this._drawLast=k,this._requestRedraw(h)}},_bringToBack:function(h){var k=h._order;if(k){var P=k.next,V=k.prev;if(V)V.next=P;else return;P?P.prev=V:V&&(this._drawLast=V),k.prev=null,k.next=this._drawFirst,this._drawFirst.prev=k,this._drawFirst=k,this._requestRedraw(h)}}});function Fc(h){return Tt.canvas?new jc(h):null}var vl=(function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(h){return document.createElement("<lvml:"+h+' class="lvml">')}}catch{}return function(h){return document.createElement("<"+h+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}})(),_f={_initContainer:function(){this._container=Ze("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(vs.prototype._update.call(this),this.fire("update"))},_initPath:function(h){var k=h._container=vl("shape");zt(k,"leaflet-vml-shape "+(this.options.className||"")),k.coordsize="1 1",h._path=vl("path"),k.appendChild(h._path),this._updateStyle(h),this._layers[l(h)]=h},_addPath:function(h){var k=h._container;this._container.appendChild(k),h.options.interactive&&h.addInteractiveTarget(k)},_removePath:function(h){var k=h._container;Dt(k),h.removeInteractiveTarget(k),delete this._layers[l(h)]},_updateStyle:function(h){var k=h._stroke,P=h._fill,V=h.options,J=h._container;J.stroked=!!V.stroke,J.filled=!!V.fill,V.stroke?(k||(k=h._stroke=vl("stroke")),J.appendChild(k),k.weight=V.weight+"px",k.color=V.color,k.opacity=V.opacity,V.dashArray?k.dashStyle=T(V.dashArray)?V.dashArray.join(" "):V.dashArray.replace(/( *, *)/g," "):k.dashStyle="",k.endcap=V.lineCap.replace("butt","flat"),k.joinstyle=V.lineJoin):k&&(J.removeChild(k),h._stroke=null),V.fill?(P||(P=h._fill=vl("fill")),J.appendChild(P),P.color=V.fillColor||V.color,P.opacity=V.fillOpacity):P&&(J.removeChild(P),h._fill=null)},_updateCircle:function(h){var k=h._point.round(),P=Math.round(h._radius),V=Math.round(h._radiusY||P);this._setPath(h,h._empty()?"M0 0":"AL "+k.x+","+k.y+" "+P+","+V+" 0,"+65535*360)},_setPath:function(h,k){h._path.v=k},_bringToFront:function(h){Mr(h._container)},_bringToBack:function(h){Br(h._container)}},Ja=Tt.vml?vl:Me,Lo=vs.extend({_initContainer:function(){this._container=Ja("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=Ja("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){Dt(this._container),Zr(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){vs.prototype._update.call(this);var h=this._bounds,k=h.getSize(),P=this._container;(!this._svgSize||!this._svgSize.equals(k))&&(this._svgSize=k,P.setAttribute("width",k.x),P.setAttribute("height",k.y)),yn(P,h.min),P.setAttribute("viewBox",[h.min.x,h.min.y,k.x,k.y].join(" ")),this.fire("update")}},_initPath:function(h){var k=h._path=Ja("path");h.options.className&&zt(k,h.options.className),h.options.interactive&&zt(k,"leaflet-interactive"),this._updateStyle(h),this._layers[l(h)]=h},_addPath:function(h){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(h._path),h.addInteractiveTarget(h._path)},_removePath:function(h){Dt(h._path),h.removeInteractiveTarget(h._path),delete this._layers[l(h)]},_updatePath:function(h){h._project(),h._update()},_updateStyle:function(h){var k=h._path,P=h.options;k&&(P.stroke?(k.setAttribute("stroke",P.color),k.setAttribute("stroke-opacity",P.opacity),k.setAttribute("stroke-width",P.weight),k.setAttribute("stroke-linecap",P.lineCap),k.setAttribute("stroke-linejoin",P.lineJoin),P.dashArray?k.setAttribute("stroke-dasharray",P.dashArray):k.removeAttribute("stroke-dasharray"),P.dashOffset?k.setAttribute("stroke-dashoffset",P.dashOffset):k.removeAttribute("stroke-dashoffset")):k.setAttribute("stroke","none"),P.fill?(k.setAttribute("fill",P.fillColor||P.color),k.setAttribute("fill-opacity",P.fillOpacity),k.setAttribute("fill-rule",P.fillRule||"evenodd")):k.setAttribute("fill","none"))},_updatePoly:function(h,k){this._setPath(h,st(h._parts,k))},_updateCircle:function(h){var k=h._point,P=Math.max(Math.round(h._radius),1),V=Math.max(Math.round(h._radiusY),1)||P,J="a"+P+","+V+" 0 1,0 ",ce=h._empty()?"M0 0":"M"+(k.x-P)+","+k.y+J+P*2+",0 "+J+-P*2+",0 ";this._setPath(h,ce)},_setPath:function(h,k){h._path.setAttribute("d",k)},_bringToFront:function(h){Mr(h._path)},_bringToBack:function(h){Br(h._path)}});Tt.vml&&Lo.include(_f);function Ro(h){return Tt.svg||Tt.vml?new Lo(h):null}Er.include({getRenderer:function(h){var k=h.options.renderer||this._getPaneRenderer(h.options.pane)||this.options.renderer||this._renderer;return k||(k=this._renderer=this._createRenderer()),this.hasLayer(k)||this.addLayer(k),k},_getPaneRenderer:function(h){if(h==="overlayPane"||h===void 0)return!1;var k=this._paneRenderers[h];return k===void 0&&(k=this._createRenderer({pane:h}),this._paneRenderers[h]=k),k},_createRenderer:function(h){return this.options.preferCanvas&&Fc(h)||Ro(h)}});var Cf=Ea.extend({initialize:function(h,k){Ea.prototype.initialize.call(this,this._boundsToLatLngs(h),k)},setBounds:function(h){return this.setLatLngs(this._boundsToLatLngs(h))},_boundsToLatLngs:function(h){return h=oe(h),[h.getSouthWest(),h.getNorthWest(),h.getNorthEast(),h.getSouthEast()]}});function Bc(h,k){return new Cf(h,k)}Lo.create=Ja,Lo.pointsToPath=st,ea.geometryToLayer=gs,ea.coordsToLatLng=Jl,ea.coordsToLatLngs=Fs,ea.latLngToCoords=zu,ea.latLngsToCoords=eu,ea.getFeature=qr,ea.asFeature=pl,Er.mergeOptions({boxZoom:!0});var uo=Qi.extend({initialize:function(h){this._map=h,this._container=h._container,this._pane=h._panes.overlayPane,this._resetStateTimeout=0,h.on("unload",this._destroy,this)},addHooks:function(){or(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){Zr(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){Dt(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){this._resetStateTimeout!==0&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(h){if(!h.shiftKey||h.which!==1&&h.button!==1)return!1;this._clearDeferredResetState(),this._resetState(),wr(),Ec(),this._startPoint=this._map.mouseEventToContainerPoint(h),or(document,{contextmenu:Fn,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(h){this._moved||(this._moved=!0,this._box=Ze("div","leaflet-zoom-box",this._container),zt(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(h);var k=new X(this._point,this._startPoint),P=k.getSize();yn(this._box,k.min),this._box.style.width=P.x+"px",this._box.style.height=P.y+"px"},_finish:function(){this._moved&&(Dt(this._box),jr(this._container,"leaflet-crosshair")),ao(),Tc(),Zr(document,{contextmenu:Fn,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(h){if(!(h.which!==1&&h.button!==1)&&(this._finish(),!!this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(s(this._resetState,this),0);var k=new fe(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(k).fire("boxzoomend",{boxZoomBounds:k})}},_onKeyDown:function(h){h.keyCode===27&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});Er.addInitHook("addHandler","boxZoom",uo),Er.mergeOptions({doubleClickZoom:!0});var Ef=Qi.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(h){var k=this._map,P=k.getZoom(),V=k.options.zoomDelta,J=h.originalEvent.shiftKey?P-V:P+V;k.options.doubleClickZoom==="center"?k.setZoom(J):k.setZoomAround(h.containerPoint,J)}});Er.addInitHook("addHandler","doubleClickZoom",Ef),Er.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var Vu=Qi.extend({addHooks:function(){if(!this._draggable){var h=this._map;this._draggable=new _n(h._mapPane,h._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),h.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),h.on("zoomend",this._onZoomEnd,this),h.whenReady(this._onZoomEnd,this))}zt(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){jr(this._map._container,"leaflet-grab"),jr(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var h=this._map;if(h._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var k=oe(this._map.options.maxBounds);this._offsetLimit=re(this._map.latLngToContainerPoint(k.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(k.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;h.fire("movestart").fire("dragstart"),h.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(h){if(this._map.options.inertia){var k=this._lastTime=+new Date,P=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(P),this._times.push(k),this._prunePositions(k)}this._map.fire("move",h).fire("drag",h)},_prunePositions:function(h){for(;this._positions.length>1&&h-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var h=this._map.getSize().divideBy(2),k=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=k.subtract(h).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(h,k){return h-(h-k)*this._viscosity},_onPreDragLimit:function(){if(!(!this._viscosity||!this._offsetLimit)){var h=this._draggable._newPos.subtract(this._draggable._startPos),k=this._offsetLimit;h.x<k.min.x&&(h.x=this._viscousLimit(h.x,k.min.x)),h.y<k.min.y&&(h.y=this._viscousLimit(h.y,k.min.y)),h.x>k.max.x&&(h.x=this._viscousLimit(h.x,k.max.x)),h.y>k.max.y&&(h.y=this._viscousLimit(h.y,k.max.y)),this._draggable._newPos=this._draggable._startPos.add(h)}},_onPreDragWrap:function(){var h=this._worldWidth,k=Math.round(h/2),P=this._initialWorldOffset,V=this._draggable._newPos.x,J=(V-k+P)%h+k-P,ce=(V+k+P)%h-k-P,we=Math.abs(J+P)<Math.abs(ce+P)?J:ce;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=we},_onDragEnd:function(h){var k=this._map,P=k.options,V=!P.inertia||h.noInertia||this._times.length<2;if(k.fire("dragend",h),V)k.fire("moveend");else{this._prunePositions(+new Date);var J=this._lastPos.subtract(this._positions[0]),ce=(this._lastTime-this._times[0])/1e3,we=P.easeLinearity,Le=J.multiplyBy(we/ce),je=Le.distanceTo([0,0]),Xe=Math.min(P.inertiaMaxSpeed,je),Nt=Le.multiplyBy(Xe/je),Xt=Xe/(P.inertiaDeceleration*we),hr=Nt.multiplyBy(-Xt/2).round();!hr.x&&!hr.y?k.fire("moveend"):(hr=k._limitOffset(hr,k.options.maxBounds),G(function(){k.panBy(hr,{duration:Xt,easeLinearity:we,noMoveStart:!0,animate:!0})}))}}});Er.addInitHook("addHandler","dragging",Vu),Er.mergeOptions({keyboard:!0,keyboardPanDelta:80});var zc=Qi.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(h){this._map=h,this._setPanDelta(h.options.keyboardPanDelta),this._setZoomDelta(h.options.zoomDelta)},addHooks:function(){var h=this._map._container;h.tabIndex<=0&&(h.tabIndex="0"),or(h,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),Zr(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var h=document.body,k=document.documentElement,P=h.scrollTop||k.scrollTop,V=h.scrollLeft||k.scrollLeft;this._map._container.focus(),window.scrollTo(V,P)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(h){var k=this._panKeys={},P=this.keyCodes,V,J;for(V=0,J=P.left.length;V<J;V++)k[P.left[V]]=[-1*h,0];for(V=0,J=P.right.length;V<J;V++)k[P.right[V]]=[h,0];for(V=0,J=P.down.length;V<J;V++)k[P.down[V]]=[0,h];for(V=0,J=P.up.length;V<J;V++)k[P.up[V]]=[0,-1*h]},_setZoomDelta:function(h){var k=this._zoomKeys={},P=this.keyCodes,V,J;for(V=0,J=P.zoomIn.length;V<J;V++)k[P.zoomIn[V]]=h;for(V=0,J=P.zoomOut.length;V<J;V++)k[P.zoomOut[V]]=-h},_addHooks:function(){or(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){Zr(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(h){if(!(h.altKey||h.ctrlKey||h.metaKey)){var k=h.keyCode,P=this._map,V;if(k in this._panKeys){if(!P._panAnim||!P._panAnim._inProgress)if(V=this._panKeys[k],h.shiftKey&&(V=te(V).multiplyBy(3)),P.options.maxBounds&&(V=P._limitOffset(te(V),P.options.maxBounds)),P.options.worldCopyJump){var J=P.wrapLatLng(P.unproject(P.project(P.getCenter()).add(V)));P.panTo(J)}else P.panBy(V)}else if(k in this._zoomKeys)P.setZoom(P.getZoom()+(h.shiftKey?3:1)*this._zoomKeys[k]);else if(k===27&&P._popup&&P._popup.options.closeOnEscapeKey)P.closePopup();else return;Fn(h)}}});Er.addInitHook("addHandler","keyboard",zc),Er.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var Yr=Qi.extend({addHooks:function(){or(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){Zr(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(h){var k=Ds(h),P=this._map.options.wheelDebounceTime;this._delta+=k,this._lastMousePos=this._map.mouseEventToContainerPoint(h),this._startTime||(this._startTime=+new Date);var V=Math.max(P-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(s(this._performZoom,this),V),Fn(h)},_performZoom:function(){var h=this._map,k=h.getZoom(),P=this._map.options.zoomSnap||0;h._stop();var V=this._delta/(this._map.options.wheelPxPerZoomLevel*4),J=4*Math.log(2/(1+Math.exp(-Math.abs(V))))/Math.LN2,ce=P?Math.ceil(J/P)*P:J,we=h._limitZoom(k+(this._delta>0?ce:-ce))-k;this._delta=0,this._startTime=null,we&&(h.options.scrollWheelZoom==="center"?h.setZoom(k+we):h.setZoomAround(this._lastMousePos,k+we))}});Er.addInitHook("addHandler","scrollWheelZoom",Yr);var Uc=600;Er.mergeOptions({tapHold:Tt.touchNative&&Tt.safari&&Tt.mobile,tapTolerance:15});var iu=Qi.extend({addHooks:function(){or(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){Zr(this._map._container,"touchstart",this._onDown,this)},_onDown:function(h){if(clearTimeout(this._holdTimeout),h.touches.length===1){var k=h.touches[0];this._startPos=this._newPos=new Q(k.clientX,k.clientY),this._holdTimeout=setTimeout(s(function(){this._cancel(),this._isTapValid()&&(or(document,"touchend",hn),or(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",k))},this),Uc),or(document,"touchend touchcancel contextmenu",this._cancel,this),or(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function h(){Zr(document,"touchend",hn),Zr(document,"touchend touchcancel",h)},_cancel:function(){clearTimeout(this._holdTimeout),Zr(document,"touchend touchcancel contextmenu",this._cancel,this),Zr(document,"touchmove",this._onMove,this)},_onMove:function(h){var k=h.touches[0];this._newPos=new Q(k.clientX,k.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(h,k){var P=new MouseEvent(h,{bubbles:!0,cancelable:!0,view:window,screenX:k.screenX,screenY:k.screenY,clientX:k.clientX,clientY:k.clientY});P._simulated=!0,k.target.dispatchEvent(P)}});Er.addInitHook("addHandler","tapHold",iu),Er.mergeOptions({touchZoom:Tt.touch,bounceAtZoomLimits:!0});var Oo=Qi.extend({addHooks:function(){zt(this._map._container,"leaflet-touch-zoom"),or(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){jr(this._map._container,"leaflet-touch-zoom"),Zr(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(h){var k=this._map;if(!(!h.touches||h.touches.length!==2||k._animatingZoom||this._zooming)){var P=k.mouseEventToContainerPoint(h.touches[0]),V=k.mouseEventToContainerPoint(h.touches[1]);this._centerPoint=k.getSize()._divideBy(2),this._startLatLng=k.containerPointToLatLng(this._centerPoint),k.options.touchZoom!=="center"&&(this._pinchStartLatLng=k.containerPointToLatLng(P.add(V)._divideBy(2))),this._startDist=P.distanceTo(V),this._startZoom=k.getZoom(),this._moved=!1,this._zooming=!0,k._stop(),or(document,"touchmove",this._onTouchMove,this),or(document,"touchend touchcancel",this._onTouchEnd,this),hn(h)}},_onTouchMove:function(h){if(!(!h.touches||h.touches.length!==2||!this._zooming)){var k=this._map,P=k.mouseEventToContainerPoint(h.touches[0]),V=k.mouseEventToContainerPoint(h.touches[1]),J=P.distanceTo(V)/this._startDist;if(this._zoom=k.getScaleZoom(J,this._startZoom),!k.options.bounceAtZoomLimits&&(this._zoom<k.getMinZoom()&&J<1||this._zoom>k.getMaxZoom()&&J>1)&&(this._zoom=k._limitZoom(this._zoom)),k.options.touchZoom==="center"){if(this._center=this._startLatLng,J===1)return}else{var ce=P._add(V)._divideBy(2)._subtract(this._centerPoint);if(J===1&&ce.x===0&&ce.y===0)return;this._center=k.unproject(k.project(this._pinchStartLatLng,this._zoom).subtract(ce),this._zoom)}this._moved||(k._moveStart(!0,!1),this._moved=!0),Z(this._animRequest);var we=s(k._move,k,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=G(we,this,!0),hn(h)}},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=!1;return}this._zooming=!1,Z(this._animRequest),Zr(document,"touchmove",this._onTouchMove,this),Zr(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))}});Er.addInitHook("addHandler","touchZoom",Oo),Er.BoxZoom=uo,Er.DoubleClickZoom=Ef,Er.Drag=Vu,Er.Keyboard=zc,Er.ScrollWheelZoom=Yr,Er.TapHold=iu,Er.TouchZoom=Oo,r.Bounds=X,r.Browser=Tt,r.CRS=ae,r.Canvas=jc,r.Circle=hl,r.CircleMarker=Ya,r.Class=W,r.Control=ii,r.DivIcon=nu,r.DivOverlay=ra,r.DomEvent=ql,r.DomUtil=Sr,r.Draggable=_n,r.Evented=$,r.FeatureGroup=Ji,r.GeoJSON=ea,r.GridLayer=bi,r.Handler=Qi,r.Icon=Ca,r.ImageOverlay=Bs,r.LatLng=se,r.LatLngBounds=fe,r.Layer=Ka,r.LayerGroup=js,r.LineUtil=cl,r.Map=Er,r.Marker=Pi,r.Mixin=Fu,r.Path=oo,r.Point=Q,r.PolyUtil=Oh,r.Polygon=Ea,r.Polyline=Mi,r.Popup=Ao,r.PosAnimation=ju,r.Projection=Lc,r.Rectangle=Cf,r.Renderer=vs,r.SVG=Lo,r.SVGOverlay=Un,r.TileLayer=Qa,r.Tooltip=Ln,r.Transformation=ue,r.Util=I,r.VideoOverlay=ln,r.bind=s,r.bounds=re,r.canvas=Fc,r.circle=Ql,r.circleMarker=lo,r.control=ba,r.divIcon=Ic,r.extend=i,r.featureGroup=_a,r.geoJSON=Dc,r.geoJson=ta,r.gridLayer=wi,r.icon=Oc,r.imageOverlay=Mo,r.latLng=he,r.latLngBounds=oe,r.layerGroup=dl,r.map=yi,r.marker=Sf,r.point=te,r.polygon=Xa,r.polyline=jh,r.popup=ru,r.rectangle=Bc,r.setOptions=S,r.stamp=l,r.svg=Ro,r.svgOverlay=tu,r.tileLayer=Gu,r.tooltip=ml,r.transformation=xe,r.version=n,r.videoOverlay=zn;var Tf=window.L;r.noConflict=function(){return window.L=Tf,this},window.L=r}))})(Yg,Yg.exports)),Yg.exports}var jl=OH();const q1=Th(jl);function mm(t,e,r){return Object.freeze({instance:t,context:e,container:r})}function $1(t,e){return e==null?function(n,i){const a=ne.useRef();return a.current||(a.current=t(n,i)),a}:function(n,i){const a=ne.useRef();a.current||(a.current=t(n,i));const s=ne.useRef(n),{instance:o}=a.current;return ne.useEffect(function(){s.current!==n&&(e(o,n,s.current),s.current=n)},[o,n,i]),a}}function WL(t,e){ne.useEffect(function(){return(e.layerContainer??e.map).addLayer(t.instance),function(){e.layerContainer?.removeLayer(t.instance),e.map.removeLayer(t.instance)}},[e,t])}function DH(t){return function(r){const n=pm(),i=t(I_(r,n),n);return VL(n.map,r.attribution),D_(i.current,r.eventHandlers),WL(i.current,n),i}}function IH(t,e){const r=ne.useRef();ne.useEffect(function(){if(e.pathOptions!==r.current){const i=e.pathOptions??{};t.instance.setStyle(i),r.current=i}},[t,e])}function jH(t){return function(r){const n=pm(),i=t(I_(r,n),n);return D_(i.current,r.eventHandlers),WL(i.current,n),IH(i.current,r),i}}function qL(t,e){const r=$1(t,e),n=DH(r);return O_(n)}function $L(t,e){const r=$1(t),n=LH(r,e);return MH(n)}function FH(t,e){const r=$1(t,e),n=jH(r);return O_(n)}function BH(t,e,r){e.bounds instanceof jl.LatLngBounds&&e.bounds!==r.bounds&&t.setBounds(e.bounds),e.opacity!=null&&e.opacity!==r.opacity&&t.setOpacity(e.opacity),e.zIndex!=null&&e.zIndex!==r.zIndex&&t.setZIndex(e.zIndex)}function zH(){return pm().map}const A4=qL(function({bounds:e,url:r,...n},i){const a=new jl.ImageOverlay(r,e,n);return mm(a,l0(i,{overlayContainer:a}))},function(e,r,n){if(BH(e,r,n),r.bounds!==n.bounds){const i=r.bounds instanceof jl.LatLngBounds?r.bounds:new jl.LatLngBounds(r.bounds);e.setBounds(i)}r.url!==n.url&&e.setUrl(r.url)}),UH=$1(function({children:e,...r},n){const i=new jl.Control.Layers(void 0,void 0,r);return mm(i,l0(n,{layersControl:i}))},function(e,r,n){r.collapsed!==n.collapsed&&(r.collapsed===!0?e.collapse():e.expand())}),GH=AH(UH),iv=O_(GH);function KL(t){return function(r){const n=pm(),i=ne.useRef(r),[a,s]=ne.useState(null),{layersControl:o,map:l}=n,u=ne.useCallback(p=>{o!=null&&(i.current.checked&&l.addLayer(p),t(o,p,i.current.name),s(p))},[o,l]),c=ne.useCallback(p=>{o?.removeLayer(p),s(null)},[o]),f=ne.useMemo(()=>l0(n,{layerContainer:{addLayer:u,removeLayer:c}}),[n,u,c]);return ne.useEffect(()=>{a!==null&&i.current!==r&&(r.checked===!0&&(i.current.checked==null||i.current.checked===!1)?l.addLayer(a):i.current.checked===!0&&(r.checked==null||r.checked===!1)&&l.removeLayer(a),i.current=r)}),r.children?Qt.createElement(R_,{value:f},r.children):null}}iv.BaseLayer=KL(function(e,r,n){e.addBaseLayer(r,n)});iv.Overlay=KL(function(e,r,n){e.addOverlay(r,n)});function lk(){return lk=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},lk.apply(this,arguments)}function VH({bounds:t,boundsOptions:e,center:r,children:n,className:i,id:a,placeholder:s,style:o,whenReady:l,zoom:u,...c},f){const[p]=ne.useState({className:i,id:a,style:o}),[g,y]=ne.useState(null);ne.useImperativeHandle(f,()=>g?.map??null,[g]);const S=ne.useCallback(C=>{if(C!==null&&g===null){const _=new jl.Map(C,c);r!=null&&u!=null?_.setView(r,u):t!=null&&_.fitBounds(t,e),l!=null&&_.whenReady(l),y(PH(_))}},[]);ne.useEffect(()=>()=>{g?.map.remove()},[g]);const w=g?Qt.createElement(R_,{value:g},n):s??null;return Qt.createElement("div",lk({},p,{ref:S}),w)}const HH=ne.forwardRef(VH),WH=qL(function({position:e,...r},n){const i=new jl.Marker(e,r);return mm(i,l0(n,{overlayContainer:i}))},function(e,r,n){r.position!==n.position&&e.setLatLng(r.position),r.icon!=null&&r.icon!==n.icon&&e.setIcon(r.icon),r.zIndexOffset!=null&&r.zIndexOffset!==n.zIndexOffset&&e.setZIndexOffset(r.zIndexOffset),r.opacity!=null&&r.opacity!==n.opacity&&e.setOpacity(r.opacity),e.dragging!=null&&r.draggable!==n.draggable&&(r.draggable===!0?e.dragging.enable():e.dragging.disable())}),qH=FH(function({positions:e,...r},n){const i=new jl.Polyline(e,r);return mm(i,l0(n,{overlayContainer:i}))},function(e,r,n){r.positions!==n.positions&&e.setLatLngs(r.positions)}),$H=$L(function(e,r){const n=new jl.Popup(e,r.overlayContainer);return mm(n,r)},function(e,r,{position:n},i){ne.useEffect(function(){const{instance:s}=e;function o(u){u.popup===s&&(s.update(),i(!0))}function l(u){u.popup===s&&i(!1)}return r.map.on({popupopen:o,popupclose:l}),r.overlayContainer==null?(n!=null&&s.setLatLng(n),s.openOn(r.map)):r.overlayContainer.bindPopup(s),function(){r.map.off({popupopen:o,popupclose:l}),r.overlayContainer?.unbindPopup(),r.map.removeLayer(s)}},[e,r,i,n])}),KH=$L(function(e,r){const n=new jl.Tooltip(e,r.overlayContainer);return mm(n,r)},function(e,r,{position:n},i){ne.useEffect(function(){const s=r.overlayContainer;if(s==null)return;const{instance:o}=e,l=c=>{c.tooltip===o&&(n!=null&&o.setLatLng(n),o.update(),i(!0))},u=c=>{c.tooltip===o&&i(!1)};return s.on({tooltipopen:l,tooltipclose:u}),s.bindTooltip(o),function(){s.off({tooltipopen:l,tooltipclose:u}),s._map!=null&&s.unbindTooltip()}},[e,r,i,n])});delete q1.Icon.Default.prototype._getIconUrl;q1.Icon.Default.mergeOptions({iconRetinaUrl:"/assets/leaflet/images/marker-icon-2x.png",iconUrl:"/assets/leaflet/images/marker-icon.png",shadowUrl:"/assets/leaflet/images/marker-shadow.png"});const ZH=(t="default")=>{const e=`
        <div class="custom-marker-icon marker-${t}">
            <span class="material-symbols-outlined" style="font-size: 18px; color: white;">
                ${YH(t)}
            </span>
        </div>
    `;return q1.divIcon({html:e,className:"custom-leaflet-marker",iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-32]})},YH=t=>{const e={city:"location_city",dungeon:"castle",landmark:"place",battle:"swords",default:"location_on"};return e[t]||e.default},XH=({bounds:t})=>{const e=zH();return Qt.useEffect(()=>{t&&e.fitBounds(t)},[e,t]),null},QH=({mapImage:t,markers:e=[],layers:r=[],connections:n=[],onMarkerClick:i,onMapClick:a,imageWidth:s=1920,imageHeight:o=1080})=>{const l=ne.useMemo(()=>[[0,0],[o,s]],[s,o]),u=ne.useMemo(()=>[o/2,s/2],[s,o]),c=e.length>0?e:[];return m.jsxs("div",{className:"w-full h-full relative",style:{cursor:a?"crosshair":"default"},children:[m.jsxs(HH,{center:u,zoom:0,minZoom:-2,maxZoom:3,crs:q1.CRS.Simple,style:{height:"100%",width:"100%",background:"#0a0a0c"},zoomControl:!0,attributionControl:!1,children:[m.jsxs(iv,{position:"topright",children:[t&&m.jsx(iv.BaseLayer,{checked:!0,name:"Superficie / Base",children:m.jsx(A4,{url:t,bounds:l,opacity:1,interactive:!!a,eventHandlers:{click:f=>a&&a(f.latlng)}})}),r.map((f,p)=>f.url&&!f.url.toLowerCase().includes("duckdns")&&!f.url.toLowerCase().includes("nopreview")&&m.jsx(iv.Overlay,{checked:f.defaultVisible,name:f.name||`Capa ${p+1}`,children:m.jsx(A4,{url:f.url,bounds:l,opacity:f.opacity||1,interactive:!!a,eventHandlers:{click:g=>a&&a(g.latlng)}})},p))]}),m.jsx(XH,{bounds:l}),c.map((f,p)=>{const g=f.position||[o/2,s/2];return m.jsx(WH,{position:g,icon:ZH(f.type),eventHandlers:{click:()=>{i&&i(f)}},children:m.jsx($H,{children:m.jsxs("div",{className:"space-y-2",children:[m.jsx("h3",{className:"text-white font-bold",children:f.label||"Unnamed Location"}),f.description&&m.jsx("p",{className:"text-slate-400 text-sm",children:f.description}),f.entityId&&m.jsxs("a",{href:`#/entity/${f.entityId}`,className:"text-primary hover:underline text-sm inline-flex items-center gap-1",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"open_in_new"}),"Ver Detalles"]})]})})},f.id||p)}),n.map((f,p)=>{const g=c.find(S=>S.id===f.sourceId),y=c.find(S=>S.id===f.targetId);if(g&&y){const S=g.position||[o/2,s/2],w=y.position||[o/2,s/2];return m.jsx(qH,{positions:[S,w],pathOptions:{color:f.color||"#6366f1",weight:f.weight||3,opacity:.8,dashArray:f.dashed?"10, 10":null},children:f.label&&m.jsx(KH,{sticky:!0,className:"bg-surface-dark border-white/10 text-slate-200",children:f.label})},`conn-${p}`)}return null})]}),c.length>0&&m.jsxs("div",{className:"absolute bottom-4 left-4 bg-surface-dark/90 backdrop-blur-xl border border-white/10 rounded-2xl p-4 max-w-xs z-[1000]",children:[m.jsxs("h4",{className:"text-white font-bold text-sm mb-2 flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-primary",children:"map"}),"Locations (",c.length,")"]}),m.jsxs("div",{className:"space-y-1 max-h-40 overflow-y-auto no-scrollbar",children:[c.slice(0,10).map((f,p)=>m.jsxs("div",{className:"text-xs text-slate-400 flex items-center gap-2 hover:text-white cursor-pointer transition-colors",onClick:()=>i&&i(f),children:[m.jsx("span",{className:"w-2 h-2 rounded-full bg-primary"}),f.label||`Location ${p+1}`]},f.id||p)),c.length>10&&m.jsxs("p",{className:"text-xs text-slate-500 italic",children:["+",c.length-10," more..."]})]})]})]})},JH=({map:t})=>{const{t:e}=Ps(),[r,n]=ne.useState(null),{setRightPanelContent:i,setRightOpen:a,setRightPanelTitle:s}=bo(),o=t?.nombre||e("maps.explorer"),[l,u]=ne.useState("explore"),[c,f]=ne.useState(null),[p,g]=ne.useState(""),[y,S]=ne.useState(""),[w,C]=ne.useState(t);ne.useEffect(()=>{C(t)},[t]);const _=w?.attributes||{};let T={};if(!_.bgImage&&w?.descripcion&&w?.descripcion.startsWith("{"))try{T=JSON.parse(w.descripcion)}catch{}let N=_.bgImage||T.bgImage||w?.iconUrl||null;N&&(N.toLowerCase().includes("duckdns")||N.toLowerCase().includes("nopreview"))&&(N=null);const R=_.markers||[],D=_.layers||[],j=_.connections||[],O=_.imageWidth||1920,F=_.imageHeight||1080,z=async U=>{try{const K={...w,attributes:U};await $e.put(`/world-bible/entities/${w.id}`,K),C(K)}catch(K){console.error("Error saving map attributes",K),alert("No se pudieron guardar los cambios en el mapa.")}},G=()=>{if(!p)return;const U={name:y||`Capa ${D.length+1}`,url:p,defaultVisible:!0,opacity:1},K={..._,layers:[...D,U]};z(K),g(""),S(""),u("explore")},Z=U=>{const K=[...D];K.splice(U,1),z({..._,layers:K})},I=U=>{const K=[...j];K.splice(U,1),z({..._,connections:K})};ne.useEffect(()=>{setRightPanelTab("CONTEXT"),s(m.jsxs("div",{className:"flex flex-col",children:[m.jsx("span",{className:"text-[10px] text-primary font-black uppercase tracking-widest leading-none mb-1",children:"Explorador de Atlas"}),m.jsx("span",{className:"text-white font-serif font-black text-lg truncate",children:o})]})),r?(i(m.jsxs("div",{className:"flex flex-col h-full gap-8 p-6 animate-in slide-in-from-right-4 duration-300 custom-scrollbar overflow-y-auto",children:[m.jsxs("header",{className:"space-y-6",children:[m.jsxs("div",{className:"relative aspect-[4/3] rounded-3xl overflow-hidden border border-white/10 shadow-xl group",children:[m.jsx("img",{src:"https://images.unsplash.com/photo-1533154683836-84ea7a0bc310?auto=format&fit=crop&w=500&q=80",alt:"Detail",className:"w-full h-full object-cover grayscale-[0.4] group-hover:grayscale-0 transition-all duration-700"}),m.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-background-dark via-transparent to-transparent"}),m.jsx("div",{className:"absolute top-4 right-4 flex gap-2",children:m.jsx("button",{onClick:()=>n(null),className:"size-8 rounded-lg bg-black/40 border border-white/10 backdrop-blur-md text-white flex items-center justify-center hover:bg-black/60 transition-colors",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"close"})})}),m.jsx("div",{className:"absolute bottom-4 left-4 flex gap-2",children:m.jsx("span",{className:"px-3 py-1 rounded bg-primary/20 text-primary border border-primary/20 text-[8px] font-black uppercase tracking-widest backdrop-blur-md",children:e("maps.place")})})]}),m.jsxs("div",{children:[m.jsx("h2",{className:"text-2xl font-black text-white leading-tight mb-2",children:r.label||"Ubicacin Desconocida"}),m.jsx("p",{className:"text-slate-500 font-medium text-xs leading-relaxed",children:r.description||"Sin descripcin disponible."})]})]}),m.jsxs("div",{className:"space-y-8",children:[m.jsxs("section",{className:"space-y-4",children:[m.jsx("div",{className:"flex justify-between items-center px-1",children:m.jsx("h3",{className:"text-[10px] font-black uppercase tracking-[0.2em] text-slate-500",children:e("maps.inhabitants")})}),m.jsx("div",{className:"space-y-3",children:m.jsx(eW,{name:"Personaje A",role:"Rol A"})})]}),m.jsxs("section",{className:"space-y-4 pt-6 border-t border-white/5",children:[m.jsx("h3",{className:"text-[10px] font-black uppercase tracking-[0.2em] text-slate-500",children:"Herramientas"}),m.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[m.jsxs("button",{onClick:()=>{n(null),u("add_layer")},className:"flex items-center gap-3 p-3 rounded-xl bg-white/[0.03] border border-white/5 text-[10px] font-black uppercase text-slate-400 hover:text-white hover:bg-white/10 transition-all",children:[m.jsx("span",{className:"material-symbols-outlined text-sm text-primary",children:"layers"}),"Gestionar Multicapas"]}),m.jsxs("button",{onClick:()=>{n(null),u("add_connection"),f(null)},className:"flex items-center gap-3 p-3 rounded-xl bg-white/[0.03] border border-white/5 text-[10px] font-black uppercase text-slate-400 hover:text-white hover:bg-white/10 transition-all",children:[m.jsx("span",{className:"material-symbols-outlined text-sm text-primary",children:"settings_ethernet"}),"Relaciones N:M"]})]})]})]})]})),a(!0)):i(l==="add_layer"?m.jsxs("div",{className:"p-6 h-full flex flex-col animate-in slide-in-from-right-4 duration-300",children:[m.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[m.jsx("button",{onClick:()=>u("explore"),className:"size-8 rounded-lg bg-white/5 border border-white/10 flex items-center justify-center hover:bg-white/10 text-white transition-colors",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"arrow_back"})}),m.jsx("h3",{className:"text-white font-serif font-black text-xl",children:"Multicapas"})]}),m.jsxs("div",{className:"space-y-6 flex-1",children:[m.jsxs("div",{className:"space-y-4 bg-white/[0.02] p-4 rounded-2xl border border-white/5",children:[m.jsx("h4",{className:"text-[10px] font-black uppercase tracking-widest text-primary",children:"Nueva Capa"}),m.jsxs("div",{children:[m.jsx("label",{className:"text-[10px] font-bold uppercase text-slate-500 block mb-2",children:"URL de la Imagen (Opcional Transparente)"}),m.jsx("input",{type:"text",value:p,onChange:U=>g(U.target.value),placeholder:"https://ejemplo.com/mapa-ruinas.png",className:"w-full bg-black/40 border border-white/10 rounded-xl px-4 py-3 text-sm text-white focus:border-primary outline-none"})]}),m.jsxs("div",{children:[m.jsx("label",{className:"text-[10px] font-bold uppercase text-slate-500 block mb-2",children:"Nombre de Capa"}),m.jsx("input",{type:"text",value:y,onChange:U=>S(U.target.value),placeholder:"Ej: Catacumbas, Rutas Martimas...",className:"w-full bg-black/40 border border-white/10 rounded-xl px-4 py-3 text-sm text-white focus:border-primary outline-none"})]}),m.jsx(Pn,{variant:"primary",className:"w-full justify-center",onClick:G,disabled:!p,children:"Agregar Capa"})]}),m.jsxs("div",{className:"space-y-3",children:[m.jsx("h4",{className:"text-[10px] font-black uppercase tracking-widest text-slate-500",children:"Capas Activas"}),D.length===0&&m.jsx("p",{className:"text-xs text-slate-600 italic",children:"No hay capas adicionales. Solo el mapa base."}),D.map((U,K)=>m.jsxs("div",{className:"flex items-center justify-between p-3 rounded-xl bg-white/[0.02] border border-white/5",children:[m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsx("span",{className:"material-symbols-outlined text-primary text-sm opacity-50",children:"layers"}),m.jsx("span",{className:"text-xs font-bold text-white",children:U.name})]}),m.jsx("button",{onClick:()=>Z(K),className:"text-red-400 hover:text-red-300 p-1",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})})]},K))]})]})]}):l==="add_connection"?m.jsxs("div",{className:"p-6 h-full flex flex-col animate-in slide-in-from-right-4 duration-300",children:[m.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[m.jsx("button",{onClick:()=>{u("explore"),f(null)},className:"size-8 rounded-lg bg-white/5 border border-white/10 flex items-center justify-center hover:bg-white/10 text-white transition-colors",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"arrow_back"})}),m.jsx("h3",{className:"text-white font-serif font-black text-xl",children:"Rutas y Relaciones"})]}),m.jsxs("div",{className:`p-4 rounded-xl border-2 border-dashed ${c?"border-primary/50 bg-primary/5 text-primary":"border-white/10 bg-white/[0.02] text-slate-400"} text-center mb-6`,children:[m.jsx("span",{className:"material-symbols-outlined text-3xl mb-2",children:c?"route":"touch_app"}),m.jsx("p",{className:"text-xs font-medium",children:c?"Selecciona el marcador de Destino en el mapa":"Haz clic en un marcador para establecer el Origen"}),c&&m.jsxs("div",{className:"mt-3 p-2 bg-black/40 rounded-lg text-white font-bold text-[10px] uppercase tracking-wider shadow-inner",children:["Origen: ",c.label]})]}),m.jsxs("div",{className:"space-y-3 flex-1 overflow-y-auto",children:[m.jsx("h4",{className:"text-[10px] font-black uppercase tracking-widest text-slate-500",children:"Rutas Existentes"}),j.length===0&&m.jsx("p",{className:"text-xs text-slate-600 italic",children:"No hay rutas conectadas."}),j.map((U,K)=>{const $=R.find(ie=>ie.id===U.sourceId),Q=R.find(ie=>ie.id===U.targetId);return m.jsxs("div",{className:"flex items-center justify-between p-3 rounded-xl bg-white/[0.02] border border-white/5 group",children:[m.jsxs("div",{className:"flex-1 min-w-0",children:[m.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[m.jsx("span",{className:"text-[10px] font-bold text-white truncate",children:$?.label||"???"}),m.jsx("span",{className:"material-symbols-outlined text-[10px] text-slate-500",children:"arrow_forward"}),m.jsx("span",{className:"text-[10px] font-bold text-white truncate",children:Q?.label||"???"})]}),m.jsx("span",{className:"text-[9px] font-medium text-primary uppercase tracking-widest",children:U.label})]}),m.jsx("button",{onClick:()=>I(K),className:"text-red-400 hover:text-red-300 p-1 opacity-0 group-hover:opacity-100 transition-opacity",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})})]},K)})]})]}):m.jsxs("div",{className:"p-6 text-slate-500 text-center flex flex-col items-center justify-center h-full animate-in fade-in duration-500",children:[m.jsx("div",{className:"size-20 rounded-full bg-primary/5 flex items-center justify-center mb-6 border border-primary/10",children:m.jsx("span",{className:"material-symbols-outlined text-4xl text-primary opacity-40",children:"explore"})}),m.jsx("h3",{className:"text-white font-serif font-black mb-2 text-xl",children:o}),m.jsx("p",{className:"text-xs max-w-[200px] leading-relaxed opacity-60",children:"Navega por el mapa e interacta con los puntos de inters para ver detalles especficos."}),m.jsxs("div",{className:"mt-12 w-full space-y-4 border-t border-white/5 pt-8",children:[m.jsx("h3",{className:"text-[10px] font-black uppercase tracking-[0.2em] text-slate-600 text-left px-2 mb-4",children:"Herramientas Globales"}),m.jsxs("button",{onClick:()=>u("add_layer"),className:"w-full p-4 rounded-2xl bg-white/[0.02] border border-white/5 flex items-center gap-4 hover:bg-white/[0.05] hover:border-primary/20 transition-all group",children:[m.jsx("div",{className:"size-10 rounded-xl bg-primary/10 flex items-center justify-center text-primary group-hover:scale-110 transition-transform shadow-lg shadow-primary/5",children:m.jsx("span",{className:"material-symbols-outlined",children:"layers"})}),m.jsxs("div",{className:"text-left",children:[m.jsx("span",{className:"block text-[10px] font-black uppercase tracking-widest text-white mb-0.5",children:"Gestionar Multicapas"}),m.jsx("span",{className:"block text-[9px] text-slate-500 font-medium normal-case tracking-normal",children:"Control de elevacin y estratos"})]})]}),m.jsxs("button",{onClick:()=>u("add_connection"),className:"w-full p-4 rounded-2xl bg-white/[0.02] border border-white/5 flex items-center gap-4 hover:bg-white/[0.05] hover:border-primary/20 transition-all group",children:[m.jsx("div",{className:"size-10 rounded-xl bg-primary/10 flex items-center justify-center text-primary group-hover:scale-110 transition-transform shadow-lg shadow-primary/5",children:m.jsx("span",{className:"material-symbols-outlined",children:"settings_ethernet"})}),m.jsxs("div",{className:"text-left",children:[m.jsx("span",{className:"block text-[10px] font-black uppercase tracking-widest text-white mb-0.5",children:"Relaciones N:M"}),m.jsx("span",{className:"block text-[9px] text-slate-500 font-medium normal-case tracking-normal",children:"Conectar territorios y zonas"})]})]})]})]}))},[r,w,l,p,y,c]),ne.useEffect(()=>()=>{i(null),s(null),a(!1)},[]);const W=U=>{if(l==="add_connection")if(!c)f(U);else{if(c.id!==U.id){const K=prompt("Nombre de la ruta/relacin (Opcional):","Camino");if(K!==null){const $={sourceId:c.id,targetId:U.id,label:K,color:"#6366f1",weight:3,dashed:!1};z({..._,connections:[...j,$]})}}f(null)}else n(U),a(!0)};return m.jsx("div",{className:"flex-1 flex overflow-hidden bg-background-dark font-sans text-slate-300 relative",children:m.jsx("main",{className:"flex-1 overflow-hidden relative group z-0",children:m.jsx("div",{className:"absolute inset-4 rounded-[2.5rem] overflow-hidden border border-white/5 shadow-2xl bg-surface-dark",children:N?m.jsx(QH,{mapImage:N,markers:R,layers:D,connections:j,onMarkerClick:W,imageWidth:O,imageHeight:F}):m.jsx("div",{className:"w-full h-full flex items-center justify-center text-slate-500",children:m.jsxs("div",{className:"text-center space-y-4",children:[m.jsx("span",{className:"material-symbols-outlined text-6xl opacity-20",children:"map"}),m.jsx("p",{children:e("maps.not_found")}),m.jsx("p",{className:"text-xs text-slate-600",children:e("maps.upload_desc")})]})})})})})},eW=({name:t,role:e})=>m.jsxs("div",{className:"flex items-center gap-4 p-3 rounded-2xl bg-white/[0.02] border border-white/5 hover:border-white/10 transition-all cursor-pointer group",children:[m.jsx(e_,{name:t,size:"sm",className:"border-white/10 group-hover:border-primary/50 transition-all"}),m.jsxs("div",{className:"flex-1 min-w-0",children:[m.jsx("h4",{className:"text-xs font-bold text-white truncate",children:t}),m.jsx("p",{className:"text-[10px] text-slate-500 font-medium truncate",children:e})]}),m.jsx("span",{className:"material-symbols-outlined text-slate-700 text-sm group-hover:text-white transition-colors",children:"chevron_right"})]}),tW=({maps:t,onSelectMap:e,onCreateMap:r,onDeleteMap:n,onDuplicateMap:i})=>{const{t:a}=Ps(),{setRightPanelTab:s,setRightOpen:o=()=>{}}=bo(),[l,u]=ne.useState(""),[c,f]=ne.useState("ALL"),[p,g]=ne.useState(null),y=document.getElementById("global-right-panel-portal"),S=t.find(N=>N.id===p),w=t.filter(N=>{const R=N.nombre.toLowerCase().includes(l.toLowerCase()),D=c==="ALL"||(N.attributes?.spatialLevel||"TERRITORY")===c;return R&&D}),C=N=>{let R=N.attributes?.snapshotUrl||N.attributes?.bgImage||N.iconUrl;return R&&(R.toLowerCase().includes("duckdns")||R.toLowerCase().includes("nopreview"))?null:R},_=async(N,R,D)=>{try{const j={...N,attributes:{...N.attributes,[R]:D}};await $e.put(`/world-bible/entities/${N.id}`,j),window.dispatchEvent(new CustomEvent("map-updated"))}catch(j){console.error("Error updating map attribute",j)}};ne.useEffect(()=>{p&&(s("CONTEXTO"),o(!0))},[p]);const T=()=>m.jsxs("div",{className:"flex flex-col h-full bg-surface-dark animate-in slide-in-from-right duration-500",children:[m.jsxs("div",{className:"p-6 border-b border-white/5 bg-gradient-to-br from-primary/10 to-transparent",children:[m.jsxs("div",{className:"flex items-center justify-between mb-2",children:[m.jsxs("h3",{className:"text-xs font-black uppercase tracking-widest text-primary flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"info"})," ",a("atlas.map_details")||"Detalles del Mapa"]}),m.jsx("button",{onClick:()=>g(null),className:"text-slate-500 hover:text-white transition-colors",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"close"})})]}),m.jsx("h4",{className:"text-lg font-serif font-black text-white truncate",children:S.nombre})]}),m.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-8 custom-scrollbar",children:[m.jsx("div",{className:"aspect-[16/9] rounded-2xl bg-black/40 border border-white/5 overflow-hidden group",children:C(S)?m.jsx("img",{src:C(S),className:"w-full h-full object-cover group-hover:scale-110 transition-transform duration-700",alt:"Preview"}):m.jsx("div",{className:"w-full h-full flex items-center justify-center opacity-20",children:m.jsx("span",{className:"material-symbols-outlined text-4xl",children:"public"})})}),m.jsx(Kn,{title:"JERARQUA ESPACIAL",icon:"layers",children:m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{children:[m.jsx("label",{className:"text-[10px] font-black uppercase text-text-muted mb-2 block tracking-widest",children:"Nivel de Escala"}),m.jsxs("div",{className:"relative",children:[m.jsxs("select",{value:S.attributes?.spatialLevel||"TERRITORY",onChange:N=>_(S,"spatialLevel",N.target.value),className:"w-full appearance-none bg-black/40 border border-white/5 rounded-xl px-4 py-3 text-xs font-bold text-white transition-all hover:bg-white/5 focus:border-primary outline-none",children:[m.jsx("option",{value:"UNIVERSE",children:" UNIVERSO"}),m.jsx("option",{value:"GALAXY",children:" GALAXIA"}),m.jsx("option",{value:"PLANET",children:" CUERPO CELESTE"}),m.jsx("option",{value:"TERRITORY",children:" TERRITORIO"}),m.jsx("option",{value:"ZONE",children:" ZONA"})]}),m.jsx("span",{className:"material-symbols-outlined absolute right-3 top-1/2 -translate-y-1/2 text-xs text-text-muted pointer-events-none",children:"expand_more"})]})]}),m.jsx("p",{className:"text-[10px] text-slate-500 leading-relaxed italic",children:"Define la escala de este mapa para facilitar su bsqueda y organizacin en el Atlas."})]})}),m.jsxs("div",{className:"space-y-3",children:[m.jsx("h4",{className:"text-[10px] font-black uppercase tracking-widest text-slate-600 px-1",children:"Herramientas Globales"}),m.jsx(Pn,{variant:"secondary",className:"w-full justify-start py-3 bg-white/[0.02] border-white/5",icon:"layers",onClick:()=>{e(S)},children:"Gestionar Multicapas"}),m.jsx(Pn,{variant:"secondary",className:"w-full justify-start py-3 bg-white/[0.02] border-white/5",icon:"alt_route",onClick:()=>{e(S)},children:"Configurar Relaciones N:M"})]}),m.jsxs("div",{className:"space-y-3 pt-4 border-t border-white/5",children:[m.jsx(Pn,{variant:"primary",className:"w-full justify-center py-4 shadow-xl shadow-primary/20",icon:"visibility",onClick:()=>e(S),children:"Abrir Visionador"}),m.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[m.jsxs("button",{onClick:()=>i(S),className:"flex items-center justify-center gap-2 py-3 bg-white/5 hover:bg-white/10 rounded-xl text-[10px] font-black uppercase text-slate-300 transition-all border border-white/5",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"content_copy"}),"Duplicar"]}),m.jsxs("button",{onClick:()=>n(S),className:"flex items-center justify-center gap-2 py-3 bg-red-500/10 hover:bg-red-500/20 rounded-xl text-[10px] font-black uppercase text-red-400 transition-all border border-red-500/10",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"}),"Eliminar"]})]})]})]})]});return m.jsxs("div",{className:"flex-1 flex overflow-hidden bg-background-dark",children:[y&&S&&eo.createPortal(T(),y),m.jsxs("div",{className:"flex-1 p-8 overflow-y-auto",children:[m.jsx("div",{className:"max-w-7xl mx-auto space-y-8",children:m.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-end gap-4 animate-in fade-in slide-in-from-top-4 duration-500",children:[m.jsxs("div",{children:[m.jsxs("h1",{className:"text-3xl font-black text-white uppercase tracking-tight flex items-center gap-3",children:[m.jsx("span",{className:"material-symbols-outlined text-primary text-4xl",children:"travel_explore"}),a("nav.atlas")||"Atlas"]}),m.jsx("p",{className:"text-sm text-slate-400 mt-2 max-w-xl",children:"Explora los territorios cartografiados de tu mundo. Gestiona mapas regionales, calabozos y planos astrales desde este centro de comando."})]}),m.jsxs("div",{className:"flex items-center gap-4 w-full md:w-auto",children:[m.jsxs("div",{className:"relative",children:[m.jsxs("select",{value:c,onChange:N=>f(N.target.value),className:"appearance-none bg-surface-dark border border-glass-border rounded-xl px-4 py-3 pr-10 text-xs font-bold text-white transition-all hover:bg-white/5 focus:border-primary outline-none",children:[m.jsx("option",{value:"ALL",children:"TODA LA ESCALA"}),m.jsx("option",{value:"UNIVERSE",children:"UNIVERSO"}),m.jsx("option",{value:"GALAXY",children:"GALAXIA"}),m.jsx("option",{value:"PLANET",children:"CUERPO CELESTE"}),m.jsx("option",{value:"TERRITORY",children:"TERRITORIO"}),m.jsx("option",{value:"ZONE",children:"ZONA"})]}),m.jsx("span",{className:"material-symbols-outlined absolute right-3 top-1/2 -translate-y-1/2 text-xs text-text-muted pointer-events-none",children:"expand_more"})]}),m.jsxs("div",{className:"relative flex-1 md:w-64",children:[m.jsx("span",{className:"material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-slate-500",children:"search"}),m.jsx("input",{type:"text",placeholder:"Buscar mapas...",value:l,onChange:N=>u(N.target.value),className:"w-full bg-black/30 border border-white/10 rounded-xl pl-10 pr-4 py-3 text-sm text-white focus:border-primary outline-none transition-all"})]})]})]})}),w.length===0?m.jsxs("div",{className:"flex flex-col items-center justify-center p-20 border-2 border-dashed border-white/5 rounded-3xl bg-white/[0.01] animate-in zoom-in-95 duration-500",children:[m.jsx("div",{className:"size-20 rounded-full bg-white/5 flex items-center justify-center mb-6",children:m.jsx("span",{className:"material-symbols-outlined text-4xl text-slate-600",children:"map"})}),m.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"No hay mapas visibles"}),m.jsx("p",{className:"text-slate-500 mb-6 text-center max-w-md",children:"No se encontraron mapas con los filtros actuales."})]}):m.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 animate-in fade-in duration-700 pt-12 pb-20",children:w.map((N,R)=>{const D=C(N),j=N.attributes?.layers?.length||0,O=N.attributes?.markers?.length||0;return m.jsxs(Kn,{className:`group relative overflow-hidden border-white/5 hover:border-primary/50 transition-all duration-300 hover:-translate-y-1 cursor-pointer ${p===N.id?"ring-2 ring-primary bg-primary/5":""}`,onClick:()=>g(N.id),onDoubleClick:()=>e(N),children:[m.jsxs("div",{className:"aspect-[16/9] w-full bg-black/50 relative overflow-hidden border-b border-white/5",children:[D?m.jsx("img",{src:D,alt:N.nombre,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-700"}):m.jsxs("div",{className:"w-full h-full flex items-center justify-center bg-surface-light",children:[m.jsx("span",{className:"material-symbols-outlined text-4xl text-white/10 group-hover:text-primary/50 transition-colors",children:"public"}),m.jsx("div",{className:"absolute inset-0 opacity-10 pointer-events-none",style:{backgroundImage:"radial-gradient(#fff 1px, transparent 1px)",backgroundSize:"20px 20px"}})]}),m.jsxs("div",{className:"absolute top-2 right-2 flex gap-1 transform translate-y-[-150%] group-hover:translate-y-0 transition-transform duration-300",children:[i&&m.jsx("button",{onClick:F=>{F.stopPropagation(),i(N)},className:"p-2 bg-black/60 hover:bg-primary text-white rounded-lg backdrop-blur-sm transition-colors",title:"Duplicar Mapa",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"content_copy"})}),n&&m.jsx("button",{onClick:F=>{F.stopPropagation(),n(N)},className:"p-2 bg-black/60 hover:bg-red-500 text-white rounded-lg backdrop-blur-sm transition-colors",title:"Eliminar Mapa",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})})]})]}),m.jsxs("div",{className:"p-5",children:[m.jsxs("div",{className:"flex justify-between items-start mb-2",children:[m.jsx("h3",{className:"font-bold text-white text-lg truncate pr-2 group-hover:text-primary transition-colors",children:N.nombre}),m.jsx("span",{className:"shrink-0 text-[10px] font-black uppercase tracking-widest bg-white/5 text-slate-400 px-2 py-1 rounded border border-white/5",children:N.attributes?.spatialLevel||N.attributes?.mapType||"Territorio"})]}),m.jsxs("div",{className:"flex items-center gap-4 text-xs text-slate-500 font-medium mt-4",children:[m.jsxs("div",{className:"flex items-center gap-1.5",title:"Capas",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"layers"}),j]}),m.jsxs("div",{className:"flex items-center gap-1.5",title:"Marcadores",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"location_on"}),O]}),m.jsxs("div",{className:"flex-1 text-right text-[10px] uppercase tracking-wider opacity-50",children:["ID: ",N.id]})]})]})]},N.id)})})]})]})},rW=()=>{const{username:t,projectName:e}=Va(),r=Ga(),[n,i]=ne.useState("manager"),[a,s]=ne.useState([]),[o,l]=ne.useState(null),[u,c]=ne.useState(null),[f,p]=ne.useState(null);Qt.useEffect(()=>{g();const C=()=>g();return window.addEventListener("map-updated",C),()=>window.removeEventListener("map-updated",C)},[]);const g=async()=>{try{const _=(await $e.get("/world-bible/entities")).filter(T=>T.tipoEspecial==="map");s(_)}catch(C){console.error("Error loading maps",C)}},y=async C=>{try{const{id:_,slug:T,createdAt:N,updatedAt:R,...D}=C,j=await $e.post("/world-bible/entities",{...D,nombre:`${C.nombre} (Copia)`,carpetaId:C.carpetaId||C.parent?.id,attributes:{...C.attributes,layers:(C.attributes?.layers||[]).map(O=>({...O,id:crypto.randomUUID()}))}});await g()}catch(_){console.error("Error duplicating map:",_),alert("Error al duplicar el mapa. Verifica la consola.")}},S=async()=>{if(f)try{await $e.delete(`/world-bible/entities/${f.id}`),p(null),await g()}catch(C){console.error("Error deleting map",C)}},w=async(C,_,T)=>{try{const N=await $e.get("/world-bible/folders"),R=N.find(j=>j.nombre.toLowerCase().includes("map"))||N[0];if(!R){console.error("No folders available to create map");return}const D=await $e.post("/world-bible/entities",{nombre:_,carpetaId:R.id,tipoEspecial:"map",categoria:"Location",descripcion:"",iconUrl:"",attributes:{mapType:"regional",layers:[]}});c(D.id),i("wizard"),await g(),setTimeout(()=>{i("editor")},100)}catch(N){console.error("Error creating map:",N)}};return m.jsxs("div",{className:"flex-1 flex flex-col h-full bg-background-dark overflow-hidden",children:[n==="manager"&&m.jsx(tW,{maps:a,onSelectMap:C=>{l(C),i("viewer")},onCreateMap:()=>i("wizard"),onDuplicateMap:y,onDeleteMap:C=>p(C)}),n==="viewer"&&o&&m.jsxs("div",{className:"flex-1 flex flex-col h-full relative",children:[m.jsx("div",{className:"absolute top-4 left-4 z-[1001]",children:m.jsxs("button",{onClick:()=>{i("manager"),window.dispatchEvent(new CustomEvent("clear-right-panel"))},className:"bg-black/60 hover:bg-black/80 text-white backdrop-blur-md px-4 py-2 rounded-xl flex items-center gap-2 border border-white/10 transition-all font-bold text-sm",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"arrow_back"}),"Volver al Atlas"]})}),m.jsx(JH,{map:o})]}),n==="wizard"&&m.jsx(NG,{onCancel:()=>i((a.length>0,"manager")),onCreate:w}),n==="editor"&&m.jsx(ok,{mode:u?"create":"edit",entityId:u,onBack:()=>{i("manager"),c(null)},onSave:async()=>{await g(),u?r(`/local/${e}/entity/${u}`):i("manager"),c(null)}}),m.jsx(Zv,{isOpen:!!f,onClose:()=>p(null),onConfirm:S,title:"Eliminar Mapa",message:`Ests seguro de que quieres eliminar el mapa "${f?.nombre}"? Esta accin no se puede deshacer.`,confirmText:"Eliminar",type:"danger"})]})};String.prototype.codePointAt||(function(){var t=(function(){try{var r={},n=Object.defineProperty,i=n(r,r,r)&&n}catch{}return i})(),e=function(r){if(this==null)throw TypeError();var n=String(this),i=n.length,a=r?Number(r):0;if(a!=a&&(a=0),!(a<0||a>=i)){var s=n.charCodeAt(a),o;return s>=55296&&s<=56319&&i>a+1&&(o=n.charCodeAt(a+1),o>=56320&&o<=57343)?(s-55296)*1024+o-56320+65536:s}};t?t(String.prototype,"codePointAt",{value:e,configurable:!0,writable:!0}):String.prototype.codePointAt=e})();function ZL(){this.table=new Uint16Array(16),this.trans=new Uint16Array(288)}var nW=new ZL,iW=new ZL,YL=new Uint8Array(30),XL=new Uint16Array(30),aW=new Uint8Array(30),sW=new Uint16Array(30);function QL(t,e,r,n){var i,a;for(i=0;i<r;++i)t[i]=0;for(i=0;i<30-r;++i)t[i+r]=i/r|0;for(a=n,i=0;i<30;++i)e[i]=a,a+=1<<t[i]}function oW(t,e){var r;for(r=0;r<7;++r)t.table[r]=0;for(t.table[7]=24,t.table[8]=152,t.table[9]=112,r=0;r<24;++r)t.trans[r]=256+r;for(r=0;r<144;++r)t.trans[24+r]=r;for(r=0;r<8;++r)t.trans[168+r]=280+r;for(r=0;r<112;++r)t.trans[176+r]=144+r;for(r=0;r<5;++r)e.table[r]=0;for(e.table[5]=32,r=0;r<32;++r)e.trans[r]=r}oW(nW,iW);QL(YL,XL,4,3);QL(aW,sW,2,1);YL[28]=0;XL[28]=258;function wp(t,e,r,n,i){return Math.pow(1-i,3)*t+3*Math.pow(1-i,2)*i*e+3*(1-i)*Math.pow(i,2)*r+Math.pow(i,3)*n}function ff(){this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN}ff.prototype.isEmpty=function(){return isNaN(this.x1)||isNaN(this.y1)||isNaN(this.x2)||isNaN(this.y2)};ff.prototype.addPoint=function(t,e){typeof t=="number"&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=t,this.x2=t),t<this.x1&&(this.x1=t),t>this.x2&&(this.x2=t)),typeof e=="number"&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=e,this.y2=e),e<this.y1&&(this.y1=e),e>this.y2&&(this.y2=e))};ff.prototype.addX=function(t){this.addPoint(t,null)};ff.prototype.addY=function(t){this.addPoint(null,t)};ff.prototype.addBezier=function(t,e,r,n,i,a,s,o){var l=[t,e],u=[r,n],c=[i,a],f=[s,o];this.addPoint(t,e),this.addPoint(s,o);for(var p=0;p<=1;p++){var g=6*l[p]-12*u[p]+6*c[p],y=-3*l[p]+9*u[p]-9*c[p]+3*f[p],S=3*u[p]-3*l[p];if(y===0){if(g===0)continue;var w=-S/g;0<w&&w<1&&(p===0&&this.addX(wp(l[p],u[p],c[p],f[p],w)),p===1&&this.addY(wp(l[p],u[p],c[p],f[p],w)));continue}var C=Math.pow(g,2)-4*S*y;if(!(C<0)){var _=(-g+Math.sqrt(C))/(2*y);0<_&&_<1&&(p===0&&this.addX(wp(l[p],u[p],c[p],f[p],_)),p===1&&this.addY(wp(l[p],u[p],c[p],f[p],_)));var T=(-g-Math.sqrt(C))/(2*y);0<T&&T<1&&(p===0&&this.addX(wp(l[p],u[p],c[p],f[p],T)),p===1&&this.addY(wp(l[p],u[p],c[p],f[p],T)))}}};ff.prototype.addQuad=function(t,e,r,n,i,a){var s=t+.6666666666666666*(r-t),o=e+2/3*(n-e),l=s+1/3*(i-t),u=o+1/3*(a-e);this.addBezier(t,e,s,o,l,u,i,a)};function $i(){this.commands=[],this.fill="black",this.stroke=null,this.strokeWidth=1}$i.prototype.moveTo=function(t,e){this.commands.push({type:"M",x:t,y:e})};$i.prototype.lineTo=function(t,e){this.commands.push({type:"L",x:t,y:e})};$i.prototype.curveTo=$i.prototype.bezierCurveTo=function(t,e,r,n,i,a){this.commands.push({type:"C",x1:t,y1:e,x2:r,y2:n,x:i,y:a})};$i.prototype.quadTo=$i.prototype.quadraticCurveTo=function(t,e,r,n){this.commands.push({type:"Q",x1:t,y1:e,x:r,y:n})};$i.prototype.close=$i.prototype.closePath=function(){this.commands.push({type:"Z"})};$i.prototype.extend=function(t){if(t.commands)t=t.commands;else if(t instanceof ff){var e=t;this.moveTo(e.x1,e.y1),this.lineTo(e.x2,e.y1),this.lineTo(e.x2,e.y2),this.lineTo(e.x1,e.y2),this.close();return}Array.prototype.push.apply(this.commands,t)};$i.prototype.getBoundingBox=function(){for(var t=new ff,e=0,r=0,n=0,i=0,a=0;a<this.commands.length;a++){var s=this.commands[a];switch(s.type){case"M":t.addPoint(s.x,s.y),e=n=s.x,r=i=s.y;break;case"L":t.addPoint(s.x,s.y),n=s.x,i=s.y;break;case"Q":t.addQuad(n,i,s.x1,s.y1,s.x,s.y),n=s.x,i=s.y;break;case"C":t.addBezier(n,i,s.x1,s.y1,s.x2,s.y2,s.x,s.y),n=s.x,i=s.y;break;case"Z":n=e,i=r;break;default:throw new Error("Unexpected path command "+s.type)}}return t.isEmpty()&&t.addPoint(0,0),t};$i.prototype.draw=function(t){t.beginPath();for(var e=0;e<this.commands.length;e+=1){var r=this.commands[e];r.type==="M"?t.moveTo(r.x,r.y):r.type==="L"?t.lineTo(r.x,r.y):r.type==="C"?t.bezierCurveTo(r.x1,r.y1,r.x2,r.y2,r.x,r.y):r.type==="Q"?t.quadraticCurveTo(r.x1,r.y1,r.x,r.y):r.type==="Z"&&t.closePath()}this.fill&&(t.fillStyle=this.fill,t.fill()),this.stroke&&(t.strokeStyle=this.stroke,t.lineWidth=this.strokeWidth,t.stroke())};$i.prototype.toPathData=function(t){t=t!==void 0?t:2;function e(s){return Math.round(s)===s?""+Math.round(s):s.toFixed(t)}function r(){for(var s=arguments,o="",l=0;l<arguments.length;l+=1){var u=s[l];u>=0&&l>0&&(o+=" "),o+=e(u)}return o}for(var n="",i=0;i<this.commands.length;i+=1){var a=this.commands[i];a.type==="M"?n+="M"+r(a.x,a.y):a.type==="L"?n+="L"+r(a.x,a.y):a.type==="C"?n+="C"+r(a.x1,a.y1,a.x2,a.y2,a.x,a.y):a.type==="Q"?n+="Q"+r(a.x1,a.y1,a.x,a.y):a.type==="Z"&&(n+="Z")}return n};$i.prototype.toSVG=function(t){var e='<path d="';return e+=this.toPathData(t),e+='"',this.fill&&this.fill!=="black"&&(this.fill===null?e+=' fill="none"':e+=' fill="'+this.fill+'"'),this.stroke&&(e+=' stroke="'+this.stroke+'" stroke-width="'+this.strokeWidth+'"'),e+="/>",e};$i.prototype.toDOMElement=function(t){var e=this.toPathData(t),r=document.createElementNS("http://www.w3.org/2000/svg","path");return r.setAttribute("d",e),r};function JL(t){throw new Error(t)}function L4(t,e){t||JL(e)}var mr={fail:JL,argument:L4,assert:L4},R4=32768,O4=2147483648,$p={},Pt={},ur={};function Ul(t){return function(){return t}}Pt.BYTE=function(t){return mr.argument(t>=0&&t<=255,"Byte value should be between 0 and 255."),[t]};ur.BYTE=Ul(1);Pt.CHAR=function(t){return[t.charCodeAt(0)]};ur.CHAR=Ul(1);Pt.CHARARRAY=function(t){typeof t>"u"&&(t="",console.warn("Undefined CHARARRAY encountered and treated as an empty string. This is probably caused by a missing glyph name."));for(var e=[],r=0;r<t.length;r+=1)e[r]=t.charCodeAt(r);return e};ur.CHARARRAY=function(t){return typeof t>"u"?0:t.length};Pt.USHORT=function(t){return[t>>8&255,t&255]};ur.USHORT=Ul(2);Pt.SHORT=function(t){return t>=R4&&(t=-(2*R4-t)),[t>>8&255,t&255]};ur.SHORT=Ul(2);Pt.UINT24=function(t){return[t>>16&255,t>>8&255,t&255]};ur.UINT24=Ul(3);Pt.ULONG=function(t){return[t>>24&255,t>>16&255,t>>8&255,t&255]};ur.ULONG=Ul(4);Pt.LONG=function(t){return t>=O4&&(t=-(2*O4-t)),[t>>24&255,t>>16&255,t>>8&255,t&255]};ur.LONG=Ul(4);Pt.FIXED=Pt.ULONG;ur.FIXED=ur.ULONG;Pt.FWORD=Pt.SHORT;ur.FWORD=ur.SHORT;Pt.UFWORD=Pt.USHORT;ur.UFWORD=ur.USHORT;Pt.LONGDATETIME=function(t){return[0,0,0,0,t>>24&255,t>>16&255,t>>8&255,t&255]};ur.LONGDATETIME=Ul(8);Pt.TAG=function(t){return mr.argument(t.length===4,"Tag should be exactly 4 ASCII characters."),[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]};ur.TAG=Ul(4);Pt.Card8=Pt.BYTE;ur.Card8=ur.BYTE;Pt.Card16=Pt.USHORT;ur.Card16=ur.USHORT;Pt.OffSize=Pt.BYTE;ur.OffSize=ur.BYTE;Pt.SID=Pt.USHORT;ur.SID=ur.USHORT;Pt.NUMBER=function(t){return t>=-107&&t<=107?[t+139]:t>=108&&t<=1131?(t=t-108,[(t>>8)+247,t&255]):t>=-1131&&t<=-108?(t=-t-108,[(t>>8)+251,t&255]):t>=-32768&&t<=32767?Pt.NUMBER16(t):Pt.NUMBER32(t)};ur.NUMBER=function(t){return Pt.NUMBER(t).length};Pt.NUMBER16=function(t){return[28,t>>8&255,t&255]};ur.NUMBER16=Ul(3);Pt.NUMBER32=function(t){return[29,t>>24&255,t>>16&255,t>>8&255,t&255]};ur.NUMBER32=Ul(5);Pt.REAL=function(t){var e=t.toString(),r=/\.(\d*?)(?:9{5,20}|0{5,20})\d{0,2}(?:e(.+)|$)/.exec(e);if(r){var n=parseFloat("1e"+((r[2]?+r[2]:0)+r[1].length));e=(Math.round(t*n)/n).toString()}for(var i="",a=0,s=e.length;a<s;a+=1){var o=e[a];o==="e"?i+=e[++a]==="-"?"c":"b":o==="."?i+="a":o==="-"?i+="e":i+=o}i+=i.length&1?"f":"ff";for(var l=[30],u=0,c=i.length;u<c;u+=2)l.push(parseInt(i.substr(u,2),16));return l};ur.REAL=function(t){return Pt.REAL(t).length};Pt.NAME=Pt.CHARARRAY;ur.NAME=ur.CHARARRAY;Pt.STRING=Pt.CHARARRAY;ur.STRING=ur.CHARARRAY;$p.UTF8=function(t,e,r){for(var n=[],i=r,a=0;a<i;a++,e+=1)n[a]=t.getUint8(e);return String.fromCharCode.apply(null,n)};$p.UTF16=function(t,e,r){for(var n=[],i=r/2,a=0;a<i;a++,e+=2)n[a]=t.getUint16(e);return String.fromCharCode.apply(null,n)};Pt.UTF16=function(t){for(var e=[],r=0;r<t.length;r+=1){var n=t.charCodeAt(r);e[e.length]=n>>8&255,e[e.length]=n&255}return e};ur.UTF16=function(t){return t.length*2};var uk={"x-mac-croatian":"","x-mac-cyrillic":"","x-mac-gaelic":"","x-mac-greek":"","x-mac-icelandic":"","x-mac-inuit":"","x-mac-ce":"",macintosh:"","x-mac-romanian":"","x-mac-turkish":""};$p.MACSTRING=function(t,e,r,n){var i=uk[n];if(i!==void 0){for(var a="",s=0;s<r;s++){var o=t.getUint8(e+s);o<=127?a+=String.fromCharCode(o):a+=i[o&127]}return a}};var yy=typeof WeakMap=="function"&&new WeakMap,xy,lW=function(t){if(!xy){xy={};for(var e in uk)xy[e]=new String(e)}var r=xy[t];if(r!==void 0){if(yy){var n=yy.get(r);if(n!==void 0)return n}var i=uk[t];if(i!==void 0){for(var a={},s=0;s<i.length;s++)a[i.charCodeAt(s)]=s+128;return yy&&yy.set(r,a),a}}};Pt.MACSTRING=function(t,e){var r=lW(e);if(r!==void 0){for(var n=[],i=0;i<t.length;i++){var a=t.charCodeAt(i);if(a>=128&&(a=r[a],a===void 0))return;n[i]=a}return n}};ur.MACSTRING=function(t,e){var r=Pt.MACSTRING(t,e);return r!==void 0?r.length:0};function ck(t){return t>=-128&&t<=127}function uW(t,e,r){for(var n=0,i=t.length;e<i&&n<64&&t[e]===0;)++e,++n;return r.push(128|n-1),e}function cW(t,e,r){for(var n=0,i=t.length,a=e;a<i&&n<64;){var s=t[a];if(!ck(s)||s===0&&a+1<i&&t[a+1]===0)break;++a,++n}r.push(n-1);for(var o=e;o<a;++o)r.push(t[o]+256&255);return a}function dW(t,e,r){for(var n=0,i=t.length,a=e;a<i&&n<64;){var s=t[a];if(s===0||ck(s)&&a+1<i&&ck(t[a+1]))break;++a,++n}r.push(64|n-1);for(var o=e;o<a;++o){var l=t[o];r.push(l+65536>>8&255,l+256&255)}return a}Pt.VARDELTAS=function(t){for(var e=0,r=[];e<t.length;){var n=t[e];n===0?e=uW(t,e,r):n>=-128&&n<=127?e=cW(t,e,r):e=dW(t,e,r)}return r};Pt.INDEX=function(t){for(var e=1,r=[e],n=[],i=0;i<t.length;i+=1){var a=Pt.OBJECT(t[i]);Array.prototype.push.apply(n,a),e+=a.length,r.push(e)}if(n.length===0)return[0,0];for(var s=[],o=1+Math.floor(Math.log(e)/Math.log(2))/8|0,l=[void 0,Pt.BYTE,Pt.USHORT,Pt.UINT24,Pt.ULONG][o],u=0;u<r.length;u+=1){var c=l(r[u]);Array.prototype.push.apply(s,c)}return Array.prototype.concat(Pt.Card16(t.length),Pt.OffSize(o),s,n)};ur.INDEX=function(t){return Pt.INDEX(t).length};Pt.DICT=function(t){for(var e=[],r=Object.keys(t),n=r.length,i=0;i<n;i+=1){var a=parseInt(r[i],0),s=t[a];e=e.concat(Pt.OPERAND(s.value,s.type)),e=e.concat(Pt.OPERATOR(a))}return e};ur.DICT=function(t){return Pt.DICT(t).length};Pt.OPERATOR=function(t){return t<1200?[t]:[12,t-1200]};Pt.OPERAND=function(t,e){var r=[];if(Array.isArray(e))for(var n=0;n<e.length;n+=1)mr.argument(t.length===e.length,"Not enough arguments given for type"+e),r=r.concat(Pt.OPERAND(t[n],e[n]));else if(e==="SID")r=r.concat(Pt.NUMBER(t));else if(e==="offset")r=r.concat(Pt.NUMBER32(t));else if(e==="number")r=r.concat(Pt.NUMBER(t));else if(e==="real")r=r.concat(Pt.REAL(t));else throw new Error("Unknown operand type "+e);return r};Pt.OP=Pt.BYTE;ur.OP=ur.BYTE;var by=typeof WeakMap=="function"&&new WeakMap;Pt.CHARSTRING=function(t){if(by){var e=by.get(t);if(e!==void 0)return e}for(var r=[],n=t.length,i=0;i<n;i+=1){var a=t[i];r=r.concat(Pt[a.type](a.value))}return by&&by.set(t,r),r};ur.CHARSTRING=function(t){return Pt.CHARSTRING(t).length};Pt.OBJECT=function(t){var e=Pt[t.type];return mr.argument(e!==void 0,"No encoding function for type "+t.type),e(t.value)};ur.OBJECT=function(t){var e=ur[t.type];return mr.argument(e!==void 0,"No sizeOf function for type "+t.type),e(t.value)};Pt.TABLE=function(t){for(var e=[],r=t.fields.length,n=[],i=[],a=0;a<r;a+=1){var s=t.fields[a],o=Pt[s.type];mr.argument(o!==void 0,"No encoding function for field type "+s.type+" ("+s.name+")");var l=t[s.name];l===void 0&&(l=s.value);var u=o(l);s.type==="TABLE"?(i.push(e.length),e=e.concat([0,0]),n.push(u)):e=e.concat(u)}for(var c=0;c<n.length;c+=1){var f=i[c],p=e.length;mr.argument(p<65536,"Table "+t.tableName+" too big."),e[f]=p>>8,e[f+1]=p&255,e=e.concat(n[c])}return e};ur.TABLE=function(t){for(var e=0,r=t.fields.length,n=0;n<r;n+=1){var i=t.fields[n],a=ur[i.type];mr.argument(a!==void 0,"No sizeOf function for field type "+i.type+" ("+i.name+")");var s=t[i.name];s===void 0&&(s=i.value),e+=a(s),i.type==="TABLE"&&(e+=2)}return e};Pt.RECORD=Pt.TABLE;ur.RECORD=ur.TABLE;Pt.LITERAL=function(t){return t};ur.LITERAL=function(t){return t.length};function ha(t,e,r){if(e.length&&(e[0].name!=="coverageFormat"||e[0].value===1))for(var n=0;n<e.length;n+=1){var i=e[n];this[i.name]=i.value}if(this.tableName=t,this.fields=e,r)for(var a=Object.keys(r),s=0;s<a.length;s+=1){var o=a[s],l=r[o];this[o]!==void 0&&(this[o]=l)}}ha.prototype.encode=function(){return Pt.TABLE(this)};ha.prototype.sizeOf=function(){return ur.TABLE(this)};function Lv(t,e,r){r===void 0&&(r=e.length);var n=new Array(e.length+1);n[0]={name:t+"Count",type:"USHORT",value:r};for(var i=0;i<e.length;i++)n[i+1]={name:t+i,type:"USHORT",value:e[i]};return n}function dk(t,e,r){var n=e.length,i=new Array(n+1);i[0]={name:t+"Count",type:"USHORT",value:n};for(var a=0;a<n;a++)i[a+1]={name:t+a,type:"TABLE",value:r(e[a],a)};return i}function Rv(t,e,r){var n=e.length,i=[];i[0]={name:t+"Count",type:"USHORT",value:n};for(var a=0;a<n;a++)i=i.concat(r(e[a],a));return i}function _x(t){t.format===1?ha.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:1}].concat(Lv("glyph",t.glyphs))):t.format===2?ha.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:2}].concat(Rv("rangeRecord",t.ranges,function(e){return[{name:"startGlyphID",type:"USHORT",value:e.start},{name:"endGlyphID",type:"USHORT",value:e.end},{name:"startCoverageIndex",type:"USHORT",value:e.index}]}))):mr.assert(!1,"Coverage format must be 1 or 2.")}_x.prototype=Object.create(ha.prototype);_x.prototype.constructor=_x;function Cx(t){ha.call(this,"scriptListTable",Rv("scriptRecord",t,function(e,r){var n=e.script,i=n.defaultLangSys;return mr.assert(!!i,"Unable to write GSUB: script "+e.tag+" has no default language system."),[{name:"scriptTag"+r,type:"TAG",value:e.tag},{name:"script"+r,type:"TABLE",value:new ha("scriptTable",[{name:"defaultLangSys",type:"TABLE",value:new ha("defaultLangSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:i.reqFeatureIndex}].concat(Lv("featureIndex",i.featureIndexes)))}].concat(Rv("langSys",n.langSysRecords,function(a,s){var o=a.langSys;return[{name:"langSysTag"+s,type:"TAG",value:a.tag},{name:"langSys"+s,type:"TABLE",value:new ha("langSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:o.reqFeatureIndex}].concat(Lv("featureIndex",o.featureIndexes)))}]})))}]}))}Cx.prototype=Object.create(ha.prototype);Cx.prototype.constructor=Cx;function Ex(t){ha.call(this,"featureListTable",Rv("featureRecord",t,function(e,r){var n=e.feature;return[{name:"featureTag"+r,type:"TAG",value:e.tag},{name:"feature"+r,type:"TABLE",value:new ha("featureTable",[{name:"featureParams",type:"USHORT",value:n.featureParams}].concat(Lv("lookupListIndex",n.lookupListIndexes)))}]}))}Ex.prototype=Object.create(ha.prototype);Ex.prototype.constructor=Ex;function Tx(t,e){ha.call(this,"lookupListTable",dk("lookup",t,function(r){var n=e[r.lookupType];return mr.assert(!!n,"Unable to write GSUB lookup type "+r.lookupType+" tables."),new ha("lookupTable",[{name:"lookupType",type:"USHORT",value:r.lookupType},{name:"lookupFlag",type:"USHORT",value:r.lookupFlag}].concat(dk("subtable",r.subtables,n)))}))}Tx.prototype=Object.create(ha.prototype);Tx.prototype.constructor=Tx;var Vt={Table:ha,Record:ha,Coverage:_x,ScriptList:Cx,FeatureList:Ex,LookupList:Tx,ushortList:Lv,tableList:dk,recordList:Rv};function D4(t,e){return t.getUint8(e)}function Nx(t,e){return t.getUint16(e,!1)}function fW(t,e){return t.getInt16(e,!1)}function j_(t,e){return t.getUint32(e,!1)}function eR(t,e){var r=t.getInt16(e,!1),n=t.getUint16(e+2,!1);return r+n/65535}function hW(t,e){for(var r="",n=e;n<e+4;n+=1)r+=String.fromCharCode(t.getInt8(n));return r}function pW(t,e,r){for(var n=0,i=0;i<r;i+=1)n<<=8,n+=t.getUint8(e+i);return n}function mW(t,e,r){for(var n=[],i=e;i<r;i+=1)n.push(t.getUint8(i));return n}function gW(t){for(var e="",r=0;r<t.length;r+=1)e+=String.fromCharCode(t[r]);return e}var vW={byte:1,uShort:2,short:2,uLong:4,fixed:4,longDateTime:8,tag:4};function We(t,e){this.data=t,this.offset=e,this.relativeOffset=0}We.prototype.parseByte=function(){var t=this.data.getUint8(this.offset+this.relativeOffset);return this.relativeOffset+=1,t};We.prototype.parseChar=function(){var t=this.data.getInt8(this.offset+this.relativeOffset);return this.relativeOffset+=1,t};We.prototype.parseCard8=We.prototype.parseByte;We.prototype.parseUShort=function(){var t=this.data.getUint16(this.offset+this.relativeOffset);return this.relativeOffset+=2,t};We.prototype.parseCard16=We.prototype.parseUShort;We.prototype.parseSID=We.prototype.parseUShort;We.prototype.parseOffset16=We.prototype.parseUShort;We.prototype.parseShort=function(){var t=this.data.getInt16(this.offset+this.relativeOffset);return this.relativeOffset+=2,t};We.prototype.parseF2Dot14=function(){var t=this.data.getInt16(this.offset+this.relativeOffset)/16384;return this.relativeOffset+=2,t};We.prototype.parseULong=function(){var t=j_(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,t};We.prototype.parseOffset32=We.prototype.parseULong;We.prototype.parseFixed=function(){var t=eR(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,t};We.prototype.parseString=function(t){var e=this.data,r=this.offset+this.relativeOffset,n="";this.relativeOffset+=t;for(var i=0;i<t;i++)n+=String.fromCharCode(e.getUint8(r+i));return n};We.prototype.parseTag=function(){return this.parseString(4)};We.prototype.parseLongDateTime=function(){var t=j_(this.data,this.offset+this.relativeOffset+4);return t-=2082844800,this.relativeOffset+=8,t};We.prototype.parseVersion=function(t){var e=Nx(this.data,this.offset+this.relativeOffset),r=Nx(this.data,this.offset+this.relativeOffset+2);return this.relativeOffset+=4,t===void 0&&(t=4096),e+r/t/10};We.prototype.skip=function(t,e){e===void 0&&(e=1),this.relativeOffset+=vW[t]*e};We.prototype.parseULongList=function(t){t===void 0&&(t=this.parseULong());for(var e=new Array(t),r=this.data,n=this.offset+this.relativeOffset,i=0;i<t;i++)e[i]=r.getUint32(n),n+=4;return this.relativeOffset+=t*4,e};We.prototype.parseOffset16List=We.prototype.parseUShortList=function(t){t===void 0&&(t=this.parseUShort());for(var e=new Array(t),r=this.data,n=this.offset+this.relativeOffset,i=0;i<t;i++)e[i]=r.getUint16(n),n+=2;return this.relativeOffset+=t*2,e};We.prototype.parseShortList=function(t){for(var e=new Array(t),r=this.data,n=this.offset+this.relativeOffset,i=0;i<t;i++)e[i]=r.getInt16(n),n+=2;return this.relativeOffset+=t*2,e};We.prototype.parseByteList=function(t){for(var e=new Array(t),r=this.data,n=this.offset+this.relativeOffset,i=0;i<t;i++)e[i]=r.getUint8(n++);return this.relativeOffset+=t,e};We.prototype.parseList=function(t,e){e||(e=t,t=this.parseUShort());for(var r=new Array(t),n=0;n<t;n++)r[n]=e.call(this);return r};We.prototype.parseList32=function(t,e){e||(e=t,t=this.parseULong());for(var r=new Array(t),n=0;n<t;n++)r[n]=e.call(this);return r};We.prototype.parseRecordList=function(t,e){e||(e=t,t=this.parseUShort());for(var r=new Array(t),n=Object.keys(e),i=0;i<t;i++){for(var a={},s=0;s<n.length;s++){var o=n[s],l=e[o];a[o]=l.call(this)}r[i]=a}return r};We.prototype.parseRecordList32=function(t,e){e||(e=t,t=this.parseULong());for(var r=new Array(t),n=Object.keys(e),i=0;i<t;i++){for(var a={},s=0;s<n.length;s++){var o=n[s],l=e[o];a[o]=l.call(this)}r[i]=a}return r};We.prototype.parseStruct=function(t){if(typeof t=="function")return t.call(this);for(var e=Object.keys(t),r={},n=0;n<e.length;n++){var i=e[n],a=t[i];r[i]=a.call(this)}return r};We.prototype.parseValueRecord=function(t){if(t===void 0&&(t=this.parseUShort()),t!==0){var e={};return t&1&&(e.xPlacement=this.parseShort()),t&2&&(e.yPlacement=this.parseShort()),t&4&&(e.xAdvance=this.parseShort()),t&8&&(e.yAdvance=this.parseShort()),t&16&&(e.xPlaDevice=void 0,this.parseShort()),t&32&&(e.yPlaDevice=void 0,this.parseShort()),t&64&&(e.xAdvDevice=void 0,this.parseShort()),t&128&&(e.yAdvDevice=void 0,this.parseShort()),e}};We.prototype.parseValueRecordList=function(){for(var t=this.parseUShort(),e=this.parseUShort(),r=new Array(e),n=0;n<e;n++)r[n]=this.parseValueRecord(t);return r};We.prototype.parsePointer=function(t){var e=this.parseOffset16();if(e>0)return new We(this.data,this.offset+e).parseStruct(t)};We.prototype.parsePointer32=function(t){var e=this.parseOffset32();if(e>0)return new We(this.data,this.offset+e).parseStruct(t)};We.prototype.parseListOfLists=function(t){for(var e=this.parseOffset16List(),r=e.length,n=this.relativeOffset,i=new Array(r),a=0;a<r;a++){var s=e[a];if(s===0){i[a]=void 0;continue}if(this.relativeOffset=s,t){for(var o=this.parseOffset16List(),l=new Array(o.length),u=0;u<o.length;u++)this.relativeOffset=s+o[u],l[u]=t.call(this);i[a]=l}else i[a]=this.parseUShortList()}return this.relativeOffset=n,i};We.prototype.parseCoverage=function(){var t=this.offset+this.relativeOffset,e=this.parseUShort(),r=this.parseUShort();if(e===1)return{format:1,glyphs:this.parseUShortList(r)};if(e===2){for(var n=new Array(r),i=0;i<r;i++)n[i]={start:this.parseUShort(),end:this.parseUShort(),index:this.parseUShort()};return{format:2,ranges:n}}throw new Error("0x"+t.toString(16)+": Coverage format must be 1 or 2.")};We.prototype.parseClassDef=function(){var t=this.offset+this.relativeOffset,e=this.parseUShort();if(e===1)return{format:1,startGlyph:this.parseUShort(),classes:this.parseUShortList()};if(e===2)return{format:2,ranges:this.parseRecordList({start:We.uShort,end:We.uShort,classId:We.uShort})};throw new Error("0x"+t.toString(16)+": ClassDef format must be 1 or 2.")};We.list=function(t,e){return function(){return this.parseList(t,e)}};We.list32=function(t,e){return function(){return this.parseList32(t,e)}};We.recordList=function(t,e){return function(){return this.parseRecordList(t,e)}};We.recordList32=function(t,e){return function(){return this.parseRecordList32(t,e)}};We.pointer=function(t){return function(){return this.parsePointer(t)}};We.pointer32=function(t){return function(){return this.parsePointer32(t)}};We.tag=We.prototype.parseTag;We.byte=We.prototype.parseByte;We.uShort=We.offset16=We.prototype.parseUShort;We.uShortList=We.prototype.parseUShortList;We.uLong=We.offset32=We.prototype.parseULong;We.uLongList=We.prototype.parseULongList;We.struct=We.prototype.parseStruct;We.coverage=We.prototype.parseCoverage;We.classDef=We.prototype.parseClassDef;var I4={reserved:We.uShort,reqFeatureIndex:We.uShort,featureIndexes:We.uShortList};We.prototype.parseScriptList=function(){return this.parsePointer(We.recordList({tag:We.tag,script:We.pointer({defaultLangSys:We.pointer(I4),langSysRecords:We.recordList({tag:We.tag,langSys:We.pointer(I4)})})}))||[]};We.prototype.parseFeatureList=function(){return this.parsePointer(We.recordList({tag:We.tag,feature:We.pointer({featureParams:We.offset16,lookupListIndexes:We.uShortList})}))||[]};We.prototype.parseLookupList=function(t){return this.parsePointer(We.list(We.pointer(function(){var e=this.parseUShort();mr.argument(1<=e&&e<=9,"GPOS/GSUB lookup type "+e+" unknown.");var r=this.parseUShort(),n=r&16;return{lookupType:e,lookupFlag:r,subtables:this.parseList(We.pointer(t[e])),markFilteringSet:n?this.parseUShort():void 0}})))||[]};We.prototype.parseFeatureVariationsList=function(){return this.parsePointer32(function(){var t=this.parseUShort(),e=this.parseUShort();mr.argument(t===1&&e<1,"GPOS/GSUB feature variations table unknown.");var r=this.parseRecordList32({conditionSetOffset:We.offset32,featureTableSubstitutionOffset:We.offset32});return r})||[]};var yr={getByte:D4,getCard8:D4,getUShort:Nx,getCard16:Nx,getShort:fW,getULong:j_,getFixed:eR,getTag:hW,getOffset:pW,getBytes:mW,bytesToString:gW,Parser:We};function yW(t,e){e.parseUShort(),t.length=e.parseULong(),t.language=e.parseULong();var r;t.groupCount=r=e.parseULong(),t.glyphIndexMap={};for(var n=0;n<r;n+=1)for(var i=e.parseULong(),a=e.parseULong(),s=e.parseULong(),o=i;o<=a;o+=1)t.glyphIndexMap[o]=s,s++}function xW(t,e,r,n,i){t.length=e.parseUShort(),t.language=e.parseUShort();var a;t.segCount=a=e.parseUShort()>>1,e.skip("uShort",3),t.glyphIndexMap={};for(var s=new yr.Parser(r,n+i+14),o=new yr.Parser(r,n+i+16+a*2),l=new yr.Parser(r,n+i+16+a*4),u=new yr.Parser(r,n+i+16+a*6),c=n+i+16+a*8,f=0;f<a-1;f+=1)for(var p=void 0,g=s.parseUShort(),y=o.parseUShort(),S=l.parseShort(),w=u.parseUShort(),C=y;C<=g;C+=1)w!==0?(c=u.offset+u.relativeOffset-2,c+=w,c+=(C-y)*2,p=yr.getUShort(r,c),p!==0&&(p=p+S&65535)):p=C+S&65535,t.glyphIndexMap[C]=p}function bW(t,e){var r={};r.version=yr.getUShort(t,e),mr.argument(r.version===0,"cmap table version should be 0."),r.numTables=yr.getUShort(t,e+2);for(var n=-1,i=r.numTables-1;i>=0;i-=1){var a=yr.getUShort(t,e+4+i*8),s=yr.getUShort(t,e+4+i*8+2);if(a===3&&(s===0||s===1||s===10)||a===0&&(s===0||s===1||s===2||s===3||s===4)){n=yr.getULong(t,e+4+i*8+4);break}}if(n===-1)throw new Error("No valid cmap sub-tables found.");var o=new yr.Parser(t,e+n);if(r.format=o.parseUShort(),r.format===12)yW(r,o);else if(r.format===4)xW(r,o,t,e,n);else throw new Error("Only format 4 and 12 cmap tables are supported (found format "+r.format+").");return r}function wW(t,e,r){t.segments.push({end:e,start:e,delta:-(e-r),offset:0,glyphIndex:r})}function SW(t){t.segments.push({end:65535,start:65535,delta:1,offset:0})}function kW(t){var e=!0,r;for(r=t.length-1;r>0;r-=1){var n=t.get(r);if(n.unicode>65535){console.log("Adding CMAP format 12 (needed!)"),e=!1;break}}var i=[{name:"version",type:"USHORT",value:0},{name:"numTables",type:"USHORT",value:e?1:2},{name:"platformID",type:"USHORT",value:3},{name:"encodingID",type:"USHORT",value:1},{name:"offset",type:"ULONG",value:e?12:20}];e||(i=i.concat([{name:"cmap12PlatformID",type:"USHORT",value:3},{name:"cmap12EncodingID",type:"USHORT",value:10},{name:"cmap12Offset",type:"ULONG",value:0}])),i=i.concat([{name:"format",type:"USHORT",value:4},{name:"cmap4Length",type:"USHORT",value:0},{name:"language",type:"USHORT",value:0},{name:"segCountX2",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);var a=new Vt.Table("cmap",i);for(a.segments=[],r=0;r<t.length;r+=1){for(var s=t.get(r),o=0;o<s.unicodes.length;o+=1)wW(a,s.unicodes[o],r);a.segments=a.segments.sort(function(_,T){return _.start-T.start})}SW(a);var l=a.segments.length,u=0,c=[],f=[],p=[],g=[],y=[],S=[];for(r=0;r<l;r+=1){var w=a.segments[r];w.end<=65535&&w.start<=65535?(c=c.concat({name:"end_"+r,type:"USHORT",value:w.end}),f=f.concat({name:"start_"+r,type:"USHORT",value:w.start}),p=p.concat({name:"idDelta_"+r,type:"SHORT",value:w.delta}),g=g.concat({name:"idRangeOffset_"+r,type:"USHORT",value:w.offset}),w.glyphId!==void 0&&(y=y.concat({name:"glyph_"+r,type:"USHORT",value:w.glyphId}))):u+=1,!e&&w.glyphIndex!==void 0&&(S=S.concat({name:"cmap12Start_"+r,type:"ULONG",value:w.start}),S=S.concat({name:"cmap12End_"+r,type:"ULONG",value:w.end}),S=S.concat({name:"cmap12Glyph_"+r,type:"ULONG",value:w.glyphIndex}))}if(a.segCountX2=(l-u)*2,a.searchRange=Math.pow(2,Math.floor(Math.log(l-u)/Math.log(2)))*2,a.entrySelector=Math.log(a.searchRange/2)/Math.log(2),a.rangeShift=a.segCountX2-a.searchRange,a.fields=a.fields.concat(c),a.fields.push({name:"reservedPad",type:"USHORT",value:0}),a.fields=a.fields.concat(f),a.fields=a.fields.concat(p),a.fields=a.fields.concat(g),a.fields=a.fields.concat(y),a.cmap4Length=14+c.length*2+2+f.length*2+p.length*2+g.length*2+y.length*2,!e){var C=16+S.length*4;a.cmap12Offset=20+a.cmap4Length,a.fields=a.fields.concat([{name:"cmap12Format",type:"USHORT",value:12},{name:"cmap12Reserved",type:"USHORT",value:0},{name:"cmap12Length",type:"ULONG",value:C},{name:"cmap12Language",type:"ULONG",value:0},{name:"cmap12nGroups",type:"ULONG",value:S.length/3}]),a.fields=a.fields.concat(S)}return a}var _W={parse:bW,make:kW},Yy=[".notdef","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","endash","dagger","daggerdbl","periodcentered","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","questiondown","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","ring","cedilla","hungarumlaut","ogonek","caron","emdash","AE","ordfeminine","Lslash","Oslash","OE","ordmasculine","ae","dotlessi","lslash","oslash","oe","germandbls","onesuperior","logicalnot","mu","trademark","Eth","onehalf","plusminus","Thorn","onequarter","divide","brokenbar","degree","thorn","threequarters","twosuperior","registered","minus","eth","multiply","threesuperior","copyright","Aacute","Acircumflex","Adieresis","Agrave","Aring","Atilde","Ccedilla","Eacute","Ecircumflex","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Ntilde","Oacute","Ocircumflex","Odieresis","Ograve","Otilde","Scaron","Uacute","Ucircumflex","Udieresis","Ugrave","Yacute","Ydieresis","Zcaron","aacute","acircumflex","adieresis","agrave","aring","atilde","ccedilla","eacute","ecircumflex","edieresis","egrave","iacute","icircumflex","idieresis","igrave","ntilde","oacute","ocircumflex","odieresis","ograve","otilde","scaron","uacute","ucircumflex","udieresis","ugrave","yacute","ydieresis","zcaron","exclamsmall","Hungarumlautsmall","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","266 ff","onedotenleader","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","commasuperior","threequartersemdash","periodsuperior","questionsmall","asuperior","bsuperior","centsuperior","dsuperior","esuperior","isuperior","lsuperior","msuperior","nsuperior","osuperior","rsuperior","ssuperior","tsuperior","ff","ffi","ffl","parenleftinferior","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","exclamdownsmall","centoldstyle","Lslashsmall","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","Dotaccentsmall","Macronsmall","figuredash","hypheninferior","Ogoneksmall","Ringsmall","Cedillasmall","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","zerosuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall","001.000","001.001","001.002","001.003","Black","Bold","Book","Light","Medium","Regular","Roman","Semibold"],CW=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","","endash","dagger","daggerdbl","periodcentered","","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","","questiondown","","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","","ring","cedilla","","hungarumlaut","ogonek","caron","emdash","","","","","","","","","","","","","","","","","AE","","ordfeminine","","","","","Lslash","Oslash","OE","ordmasculine","","","","","","ae","","","","dotlessi","","","lslash","oslash","oe","germandbls"],EW=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclamsmall","Hungarumlautsmall","","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","twodotenleader","onedotenleader","comma","hyphen","period","fraction","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","colon","semicolon","commasuperior","threequartersemdash","periodsuperior","questionsmall","","asuperior","bsuperior","centsuperior","dsuperior","esuperior","","","isuperior","","","lsuperior","msuperior","nsuperior","osuperior","","","rsuperior","ssuperior","tsuperior","","ff","fi","fl","ffi","ffl","parenleftinferior","","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdownsmall","centoldstyle","Lslashsmall","","","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","","Dotaccentsmall","","","Macronsmall","","","figuredash","hypheninferior","","","Ogoneksmall","Ringsmall","Cedillasmall","","","","onequarter","onehalf","threequarters","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","","","zerosuperior","onesuperior","twosuperior","threesuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall"],j4=[".notdef",".null","nonmarkingreturn","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quotesingle","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","grave","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","Adieresis","Aring","Ccedilla","Eacute","Ntilde","Odieresis","Udieresis","aacute","agrave","acircumflex","adieresis","atilde","aring","ccedilla","eacute","egrave","ecircumflex","edieresis","iacute","igrave","icircumflex","idieresis","ntilde","oacute","ograve","ocircumflex","odieresis","otilde","uacute","ugrave","ucircumflex","udieresis","dagger","degree","cent","sterling","section","bullet","paragraph","germandbls","registered","copyright","trademark","acute","dieresis","notequal","AE","Oslash","infinity","plusminus","lessequal","greaterequal","yen","mu","partialdiff","summation","product","pi","integral","ordfeminine","ordmasculine","Omega","ae","oslash","questiondown","exclamdown","logicalnot","radical","florin","approxequal","Delta","guillemotleft","guillemotright","ellipsis","nonbreakingspace","Agrave","Atilde","Otilde","OE","oe","endash","emdash","quotedblleft","quotedblright","quoteleft","quoteright","divide","lozenge","ydieresis","Ydieresis","fraction","currency","guilsinglleft","guilsinglright","fi","fl","daggerdbl","periodcentered","quotesinglbase","quotedblbase","perthousand","Acircumflex","Ecircumflex","Aacute","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Oacute","Ocircumflex","apple","Ograve","Uacute","Ucircumflex","Ugrave","dotlessi","circumflex","tilde","macron","breve","dotaccent","ring","cedilla","hungarumlaut","ogonek","caron","Lslash","lslash","Scaron","scaron","Zcaron","zcaron","brokenbar","Eth","eth","Yacute","yacute","Thorn","thorn","minus","multiply","onesuperior","twosuperior","threesuperior","onehalf","onequarter","threequarters","franc","Gbreve","gbreve","Idotaccent","Scedilla","scedilla","Cacute","cacute","Ccaron","ccaron","dcroat"];function tR(t){this.font=t}tR.prototype.charToGlyphIndex=function(t){var e=t.codePointAt(0),r=this.font.glyphs;if(r){for(var n=0;n<r.length;n+=1)for(var i=r.get(n),a=0;a<i.unicodes.length;a+=1)if(i.unicodes[a]===e)return n}return null};function Px(t,e){this.encoding=t,this.charset=e}Px.prototype.charToGlyphIndex=function(t){var e=t.codePointAt(0),r=this.encoding[e];return this.charset.indexOf(r)};function TW(t,e,r,n,i){t.beginPath(),t.moveTo(e,r),t.lineTo(n,i),t.stroke()}var qf={line:TW};function NW(t,e){var r=e||new $i;return{configurable:!0,get:function(){return typeof r=="function"&&(r=r()),r},set:function(n){r=n}}}function il(t){this.bindConstructorValues(t)}il.prototype.bindConstructorValues=function(t){this.index=t.index||0,this.name=t.name||null,this.unicode=t.unicode||void 0,this.unicodes=t.unicodes||t.unicode!==void 0?[t.unicode]:[],"xMin"in t&&(this.xMin=t.xMin),"yMin"in t&&(this.yMin=t.yMin),"xMax"in t&&(this.xMax=t.xMax),"yMax"in t&&(this.yMax=t.yMax),"advanceWidth"in t&&(this.advanceWidth=t.advanceWidth),Object.defineProperty(this,"path",NW(this,t.path))};il.prototype.addUnicode=function(t){this.unicodes.length===0&&(this.unicode=t),this.unicodes.push(t)};il.prototype.getBoundingBox=function(){return this.path.getBoundingBox()};il.prototype.getPath=function(t,e,r,n,i){t=t!==void 0?t:0,e=e!==void 0?e:0,r=r!==void 0?r:72;var a,s;n||(n={});var o=n.xScale,l=n.yScale;if(n.hinting&&i&&i.hinting&&(s=this.path&&i.hinting.exec(this,r)),s)a=i.hinting.getCommands(s),t=Math.round(t),e=Math.round(e),o=l=1;else{a=this.path.commands;var u=1/(this.path.unitsPerEm||1e3)*r;o===void 0&&(o=u),l===void 0&&(l=u)}for(var c=new $i,f=0;f<a.length;f+=1){var p=a[f];p.type==="M"?c.moveTo(t+p.x*o,e+-p.y*l):p.type==="L"?c.lineTo(t+p.x*o,e+-p.y*l):p.type==="Q"?c.quadraticCurveTo(t+p.x1*o,e+-p.y1*l,t+p.x*o,e+-p.y*l):p.type==="C"?c.curveTo(t+p.x1*o,e+-p.y1*l,t+p.x2*o,e+-p.y2*l,t+p.x*o,e+-p.y*l):p.type==="Z"&&c.closePath()}return c};il.prototype.getContours=function(){if(this.points===void 0)return[];for(var t=[],e=[],r=0;r<this.points.length;r+=1){var n=this.points[r];e.push(n),n.lastPointOfContour&&(t.push(e),e=[])}return mr.argument(e.length===0,"There are still points left in the current contour."),t};il.prototype.getMetrics=function(){for(var t=this.path.commands,e=[],r=[],n=0;n<t.length;n+=1){var i=t[n];i.type!=="Z"&&(e.push(i.x),r.push(i.y)),(i.type==="Q"||i.type==="C")&&(e.push(i.x1),r.push(i.y1)),i.type==="C"&&(e.push(i.x2),r.push(i.y2))}var a={xMin:Math.min.apply(null,e),yMin:Math.min.apply(null,r),xMax:Math.max.apply(null,e),yMax:Math.max.apply(null,r),leftSideBearing:this.leftSideBearing};return isFinite(a.xMin)||(a.xMin=0),isFinite(a.xMax)||(a.xMax=this.advanceWidth),isFinite(a.yMin)||(a.yMin=0),isFinite(a.yMax)||(a.yMax=0),a.rightSideBearing=this.advanceWidth-a.leftSideBearing-(a.xMax-a.xMin),a};il.prototype.draw=function(t,e,r,n,i){this.getPath(e,r,n,i).draw(t)};il.prototype.drawPoints=function(t,e,r,n){function i(f,p,g,y){t.beginPath();for(var S=0;S<f.length;S+=1)t.moveTo(p+f[S].x*y,g+f[S].y*y),t.arc(p+f[S].x*y,g+f[S].y*y,2,0,Math.PI*2,!1);t.closePath(),t.fill()}e=e!==void 0?e:0,r=r!==void 0?r:0,n=n!==void 0?n:24;for(var a=1/this.path.unitsPerEm*n,s=[],o=[],l=this.path,u=0;u<l.commands.length;u+=1){var c=l.commands[u];c.x!==void 0&&s.push({x:c.x,y:-c.y}),c.x1!==void 0&&o.push({x:c.x1,y:-c.y1}),c.x2!==void 0&&o.push({x:c.x2,y:-c.y2})}t.fillStyle="blue",i(s,e,r,a),t.fillStyle="red",i(o,e,r,a)};il.prototype.drawMetrics=function(t,e,r,n){var i;e=e!==void 0?e:0,r=r!==void 0?r:0,n=n!==void 0?n:24,i=1/this.path.unitsPerEm*n,t.lineWidth=1,t.strokeStyle="black",qf.line(t,e,-1e4,e,1e4),qf.line(t,-1e4,r,1e4,r);var a=this.xMin||0,s=this.yMin||0,o=this.xMax||0,l=this.yMax||0,u=this.advanceWidth||0;t.strokeStyle="blue",qf.line(t,e+a*i,-1e4,e+a*i,1e4),qf.line(t,e+o*i,-1e4,e+o*i,1e4),qf.line(t,-1e4,r+-s*i,1e4,r+-s*i),qf.line(t,-1e4,r+-l*i,1e4,r+-l*i),t.strokeStyle="green",qf.line(t,e+u*i,-1e4,e+u*i,1e4)};function wy(t,e,r){Object.defineProperty(t,e,{get:function(){return t.path,t[r]},set:function(n){t[r]=n},enumerable:!0,configurable:!0})}function F_(t,e){if(this.font=t,this.glyphs={},Array.isArray(e))for(var r=0;r<e.length;r++){var n=e[r];n.path.unitsPerEm=t.unitsPerEm,this.glyphs[r]=n}this.length=e&&e.length||0}F_.prototype.get=function(t){if(this.glyphs[t]===void 0){this.font._push(t),typeof this.glyphs[t]=="function"&&(this.glyphs[t]=this.glyphs[t]());var e=this.glyphs[t],r=this.font._IndexToUnicodeMap[t];if(r)for(var n=0;n<r.unicodes.length;n++)e.addUnicode(r.unicodes[n]);this.font.cffEncoding?this.font.isCIDFont?e.name="gid"+t:e.name=this.font.cffEncoding.charset[t]:this.font.glyphNames.names&&(e.name=this.font.glyphNames.glyphIndexToName(t)),this.glyphs[t].advanceWidth=this.font._hmtxTableData[t].advanceWidth,this.glyphs[t].leftSideBearing=this.font._hmtxTableData[t].leftSideBearing}else typeof this.glyphs[t]=="function"&&(this.glyphs[t]=this.glyphs[t]());return this.glyphs[t]};F_.prototype.push=function(t,e){this.glyphs[t]=e,this.length++};function PW(t,e){return new il({index:e,font:t})}function MW(t,e,r,n,i,a){return function(){var s=new il({index:e,font:t});return s.path=function(){r(s,n,i);var o=a(t.glyphs,s);return o.unitsPerEm=t.unitsPerEm,o},wy(s,"xMin","_xMin"),wy(s,"xMax","_xMax"),wy(s,"yMin","_yMin"),wy(s,"yMax","_yMax"),s}}function AW(t,e,r,n){return function(){var i=new il({index:e,font:t});return i.path=function(){var a=r(t,i,n);return a.unitsPerEm=t.unitsPerEm,a},i}}var Eu={GlyphSet:F_,glyphLoader:PW,ttfGlyphLoader:MW,cffGlyphLoader:AW};function rR(t,e){if(t===e)return!0;if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return!1;for(var r=0;r<t.length;r+=1)if(!rR(t[r],e[r]))return!1;return!0}else return!1}function fk(t){var e;return t.length<1240?e=107:t.length<33900?e=1131:e=32768,e}function _d(t,e,r){var n=[],i=[],a=yr.getCard16(t,e),s,o;if(a!==0){var l=yr.getByte(t,e+2);s=e+(a+1)*l+2;for(var u=e+3,c=0;c<a+1;c+=1)n.push(yr.getOffset(t,u,l)),u+=l;o=s+n[a]}else o=e+2;for(var f=0;f<n.length-1;f+=1){var p=yr.getBytes(t,s+n[f],s+n[f+1]);r&&(p=r(p)),i.push(p)}return{objects:i,startOffset:e,endOffset:o}}function LW(t,e){var r=[],n=yr.getCard16(t,e),i,a;if(n!==0){var s=yr.getByte(t,e+2);i=e+(n+1)*s+2;for(var o=e+3,l=0;l<n+1;l+=1)r.push(yr.getOffset(t,o,s)),o+=s;a=i+r[n]}else a=e+2;return{offsets:r,startOffset:e,endOffset:a}}function RW(t,e,r,n,i){var a=yr.getCard16(r,n),s=0;if(a!==0){var o=yr.getByte(r,n+2);s=n+(a+1)*o+2}var l=yr.getBytes(r,s+e[t],s+e[t+1]);return l}function OW(t){for(var e="",r=15,n=["0","1","2","3","4","5","6","7","8","9",".","E","E-",null,"-"];;){var i=t.parseByte(),a=i>>4,s=i&15;if(a===r||(e+=n[a],s===r))break;e+=n[s]}return parseFloat(e)}function DW(t,e){var r,n,i,a;if(e===28)return r=t.parseByte(),n=t.parseByte(),r<<8|n;if(e===29)return r=t.parseByte(),n=t.parseByte(),i=t.parseByte(),a=t.parseByte(),r<<24|n<<16|i<<8|a;if(e===30)return OW(t);if(e>=32&&e<=246)return e-139;if(e>=247&&e<=250)return r=t.parseByte(),(e-247)*256+r+108;if(e>=251&&e<=254)return r=t.parseByte(),-(e-251)*256-r-108;throw new Error("Invalid b0 "+e)}function IW(t){for(var e={},r=0;r<t.length;r+=1){var n=t[r][0],i=t[r][1],a=void 0;if(i.length===1?a=i[0]:a=i,e.hasOwnProperty(n)&&!isNaN(e[n]))throw new Error("Object "+e+" already has key "+n);e[n]=a}return e}function nR(t,e,r){e=e!==void 0?e:0;var n=new yr.Parser(t,e),i=[],a=[];for(r=r!==void 0?r:t.length;n.relativeOffset<r;){var s=n.parseByte();s<=21?(s===12&&(s=1200+n.parseByte()),i.push([s,a]),a=[]):a.push(DW(n,s))}return IW(i)}function av(t,e){return e<=390?e=Yy[e]:e=t[e-391],e}function iR(t,e,r){for(var n={},i,a=0;a<e.length;a+=1){var s=e[a];if(Array.isArray(s.type)){var o=[];o.length=s.type.length;for(var l=0;l<s.type.length;l++)i=t[s.op]!==void 0?t[s.op][l]:void 0,i===void 0&&(i=s.value!==void 0&&s.value[l]!==void 0?s.value[l]:null),s.type[l]==="SID"&&(i=av(r,i)),o[l]=i;n[s.name]=o}else i=t[s.op],i===void 0&&(i=s.value!==void 0?s.value:null),s.type==="SID"&&(i=av(r,i)),n[s.name]=i}return n}function jW(t,e){var r={};return r.formatMajor=yr.getCard8(t,e),r.formatMinor=yr.getCard8(t,e+1),r.size=yr.getCard8(t,e+2),r.offsetSize=yr.getCard8(t,e+3),r.startOffset=e,r.endOffset=e+4,r}var aR=[{name:"version",op:0,type:"SID"},{name:"notice",op:1,type:"SID"},{name:"copyright",op:1200,type:"SID"},{name:"fullName",op:2,type:"SID"},{name:"familyName",op:3,type:"SID"},{name:"weight",op:4,type:"SID"},{name:"isFixedPitch",op:1201,type:"number",value:0},{name:"italicAngle",op:1202,type:"number",value:0},{name:"underlinePosition",op:1203,type:"number",value:-100},{name:"underlineThickness",op:1204,type:"number",value:50},{name:"paintType",op:1205,type:"number",value:0},{name:"charstringType",op:1206,type:"number",value:2},{name:"fontMatrix",op:1207,type:["real","real","real","real","real","real"],value:[.001,0,0,.001,0,0]},{name:"uniqueId",op:13,type:"number"},{name:"fontBBox",op:5,type:["number","number","number","number"],value:[0,0,0,0]},{name:"strokeWidth",op:1208,type:"number",value:0},{name:"xuid",op:14,type:[],value:null},{name:"charset",op:15,type:"offset",value:0},{name:"encoding",op:16,type:"offset",value:0},{name:"charStrings",op:17,type:"offset",value:0},{name:"private",op:18,type:["number","offset"],value:[0,0]},{name:"ros",op:1230,type:["SID","SID","number"]},{name:"cidFontVersion",op:1231,type:"number",value:0},{name:"cidFontRevision",op:1232,type:"number",value:0},{name:"cidFontType",op:1233,type:"number",value:0},{name:"cidCount",op:1234,type:"number",value:8720},{name:"uidBase",op:1235,type:"number"},{name:"fdArray",op:1236,type:"offset"},{name:"fdSelect",op:1237,type:"offset"},{name:"fontName",op:1238,type:"SID"}],sR=[{name:"subrs",op:19,type:"offset",value:0},{name:"defaultWidthX",op:20,type:"number",value:0},{name:"nominalWidthX",op:21,type:"number",value:0}];function FW(t,e){var r=nR(t,0,t.byteLength);return iR(r,aR,e)}function oR(t,e,r,n){var i=nR(t,e,r);return iR(i,sR,n)}function F4(t,e,r,n){for(var i=[],a=0;a<r.length;a+=1){var s=new DataView(new Uint8Array(r[a]).buffer),o=FW(s,n);o._subrs=[],o._subrsBias=0,o._defaultWidthX=0,o._nominalWidthX=0;var l=o.private[0],u=o.private[1];if(l!==0&&u!==0){var c=oR(t,u+e,l,n);if(o._defaultWidthX=c.defaultWidthX,o._nominalWidthX=c.nominalWidthX,c.subrs!==0){var f=u+c.subrs,p=_d(t,f+e);o._subrs=p.objects,o._subrsBias=fk(o._subrs)}o._privateDict=c}i.push(o)}return i}function BW(t,e,r,n){var i,a,s=new yr.Parser(t,e);r-=1;var o=[".notdef"],l=s.parseCard8();if(l===0)for(var u=0;u<r;u+=1)i=s.parseSID(),o.push(av(n,i));else if(l===1)for(;o.length<=r;){i=s.parseSID(),a=s.parseCard8();for(var c=0;c<=a;c+=1)o.push(av(n,i)),i+=1}else if(l===2)for(;o.length<=r;){i=s.parseSID(),a=s.parseCard16();for(var f=0;f<=a;f+=1)o.push(av(n,i)),i+=1}else throw new Error("Unknown charset format "+l);return o}function zW(t,e,r){var n,i={},a=new yr.Parser(t,e),s=a.parseCard8();if(s===0)for(var o=a.parseCard8(),l=0;l<o;l+=1)n=a.parseCard8(),i[n]=l;else if(s===1){var u=a.parseCard8();n=1;for(var c=0;c<u;c+=1)for(var f=a.parseCard8(),p=a.parseCard8(),g=f;g<=f+p;g+=1)i[g]=n,n+=1}else throw new Error("Unknown encoding format "+s);return new Px(i,r)}function B4(t,e,r){var n,i,a,s,o=new $i,l=[],u=0,c=!1,f=!1,p=0,g=0,y,S,w,C;if(t.isCIDFont){var _=t.tables.cff.topDict._fdSelect[e.index],T=t.tables.cff.topDict._fdArray[_];y=T._subrs,S=T._subrsBias,w=T._defaultWidthX,C=T._nominalWidthX}else y=t.tables.cff.topDict._subrs,S=t.tables.cff.topDict._subrsBias,w=t.tables.cff.topDict._defaultWidthX,C=t.tables.cff.topDict._nominalWidthX;var N=w;function R(O,F){f&&o.closePath(),o.moveTo(O,F),f=!0}function D(){var O;O=l.length%2!==0,O&&!c&&(N=l.shift()+C),u+=l.length>>1,l.length=0,c=!0}function j(O){for(var F,z,G,Z,I,W,U,K,$,Q,ie,te,X=0;X<O.length;){var re=O[X];switch(X+=1,re){case 1:D();break;case 3:D();break;case 4:l.length>1&&!c&&(N=l.shift()+C,c=!0),g+=l.pop(),R(p,g);break;case 5:for(;l.length>0;)p+=l.shift(),g+=l.shift(),o.lineTo(p,g);break;case 6:for(;l.length>0&&(p+=l.shift(),o.lineTo(p,g),l.length!==0);)g+=l.shift(),o.lineTo(p,g);break;case 7:for(;l.length>0&&(g+=l.shift(),o.lineTo(p,g),l.length!==0);)p+=l.shift(),o.lineTo(p,g);break;case 8:for(;l.length>0;)n=p+l.shift(),i=g+l.shift(),a=n+l.shift(),s=i+l.shift(),p=a+l.shift(),g=s+l.shift(),o.curveTo(n,i,a,s,p,g);break;case 10:I=l.pop()+S,W=y[I],W&&j(W);break;case 11:return;case 12:switch(re=O[X],X+=1,re){case 35:n=p+l.shift(),i=g+l.shift(),a=n+l.shift(),s=i+l.shift(),U=a+l.shift(),K=s+l.shift(),$=U+l.shift(),Q=K+l.shift(),ie=$+l.shift(),te=Q+l.shift(),p=ie+l.shift(),g=te+l.shift(),l.shift(),o.curveTo(n,i,a,s,U,K),o.curveTo($,Q,ie,te,p,g);break;case 34:n=p+l.shift(),i=g,a=n+l.shift(),s=i+l.shift(),U=a+l.shift(),K=s,$=U+l.shift(),Q=s,ie=$+l.shift(),te=g,p=ie+l.shift(),o.curveTo(n,i,a,s,U,K),o.curveTo($,Q,ie,te,p,g);break;case 36:n=p+l.shift(),i=g+l.shift(),a=n+l.shift(),s=i+l.shift(),U=a+l.shift(),K=s,$=U+l.shift(),Q=s,ie=$+l.shift(),te=Q+l.shift(),p=ie+l.shift(),o.curveTo(n,i,a,s,U,K),o.curveTo($,Q,ie,te,p,g);break;case 37:n=p+l.shift(),i=g+l.shift(),a=n+l.shift(),s=i+l.shift(),U=a+l.shift(),K=s+l.shift(),$=U+l.shift(),Q=K+l.shift(),ie=$+l.shift(),te=Q+l.shift(),Math.abs(ie-p)>Math.abs(te-g)?p=ie+l.shift():g=te+l.shift(),o.curveTo(n,i,a,s,U,K),o.curveTo($,Q,ie,te,p,g);break;default:console.log("Glyph "+e.index+": unknown operator 1200"+re),l.length=0}break;case 14:l.length>0&&!c&&(N=l.shift()+C,c=!0),f&&(o.closePath(),f=!1);break;case 18:D();break;case 19:case 20:D(),X+=u+7>>3;break;case 21:l.length>2&&!c&&(N=l.shift()+C,c=!0),g+=l.pop(),p+=l.pop(),R(p,g);break;case 22:l.length>1&&!c&&(N=l.shift()+C,c=!0),p+=l.pop(),R(p,g);break;case 23:D();break;case 24:for(;l.length>2;)n=p+l.shift(),i=g+l.shift(),a=n+l.shift(),s=i+l.shift(),p=a+l.shift(),g=s+l.shift(),o.curveTo(n,i,a,s,p,g);p+=l.shift(),g+=l.shift(),o.lineTo(p,g);break;case 25:for(;l.length>6;)p+=l.shift(),g+=l.shift(),o.lineTo(p,g);n=p+l.shift(),i=g+l.shift(),a=n+l.shift(),s=i+l.shift(),p=a+l.shift(),g=s+l.shift(),o.curveTo(n,i,a,s,p,g);break;case 26:for(l.length%2&&(p+=l.shift());l.length>0;)n=p,i=g+l.shift(),a=n+l.shift(),s=i+l.shift(),p=a,g=s+l.shift(),o.curveTo(n,i,a,s,p,g);break;case 27:for(l.length%2&&(g+=l.shift());l.length>0;)n=p+l.shift(),i=g,a=n+l.shift(),s=i+l.shift(),p=a+l.shift(),g=s,o.curveTo(n,i,a,s,p,g);break;case 28:F=O[X],z=O[X+1],l.push((F<<24|z<<16)>>16),X+=2;break;case 29:I=l.pop()+t.gsubrsBias,W=t.gsubrs[I],W&&j(W);break;case 30:for(;l.length>0&&(n=p,i=g+l.shift(),a=n+l.shift(),s=i+l.shift(),p=a+l.shift(),g=s+(l.length===1?l.shift():0),o.curveTo(n,i,a,s,p,g),l.length!==0);)n=p+l.shift(),i=g,a=n+l.shift(),s=i+l.shift(),g=s+l.shift(),p=a+(l.length===1?l.shift():0),o.curveTo(n,i,a,s,p,g);break;case 31:for(;l.length>0&&(n=p+l.shift(),i=g,a=n+l.shift(),s=i+l.shift(),g=s+l.shift(),p=a+(l.length===1?l.shift():0),o.curveTo(n,i,a,s,p,g),l.length!==0);)n=p,i=g+l.shift(),a=n+l.shift(),s=i+l.shift(),p=a+l.shift(),g=s+(l.length===1?l.shift():0),o.curveTo(n,i,a,s,p,g);break;default:re<32?console.log("Glyph "+e.index+": unknown operator "+re):re<247?l.push(re-139):re<251?(F=O[X],X+=1,l.push((re-247)*256+F+108)):re<255?(F=O[X],X+=1,l.push(-(re-251)*256-F-108)):(F=O[X],z=O[X+1],G=O[X+2],Z=O[X+3],X+=4,l.push((F<<24|z<<16|G<<8|Z)/65536))}}}return j(r),e.advanceWidth=N,o}function UW(t,e,r,n){var i=[],a,s=new yr.Parser(t,e),o=s.parseCard8();if(o===0)for(var l=0;l<r;l++){if(a=s.parseCard8(),a>=n)throw new Error("CFF table CID Font FDSelect has bad FD index value "+a+" (FD count "+n+")");i.push(a)}else if(o===3){var u=s.parseCard16(),c=s.parseCard16();if(c!==0)throw new Error("CFF Table CID Font FDSelect format 3 range has bad initial GID "+c);for(var f,p=0;p<u;p++){if(a=s.parseCard8(),f=s.parseCard16(),a>=n)throw new Error("CFF table CID Font FDSelect has bad FD index value "+a+" (FD count "+n+")");if(f>r)throw new Error("CFF Table CID Font FDSelect format 3 range has bad GID "+f);for(;c<f;c++)i.push(a);c=f}if(f!==r)throw new Error("CFF Table CID Font FDSelect format 3 range has bad final GID "+f)}else throw new Error("CFF Table CID Font FDSelect table has unsupported format "+o);return i}function GW(t,e,r,n){r.tables.cff={};var i=jW(t,e),a=_d(t,i.endOffset,yr.bytesToString),s=_d(t,a.endOffset),o=_d(t,s.endOffset,yr.bytesToString),l=_d(t,o.endOffset);r.gsubrs=l.objects,r.gsubrsBias=fk(r.gsubrs);var u=F4(t,e,s.objects,o.objects);if(u.length!==1)throw new Error("CFF table has too many fonts in 'FontSet' - count of fonts NameIndex.length = "+u.length);var c=u[0];if(r.tables.cff.topDict=c,c._privateDict&&(r.defaultWidthX=c._privateDict.defaultWidthX,r.nominalWidthX=c._privateDict.nominalWidthX),c.ros[0]!==void 0&&c.ros[1]!==void 0&&(r.isCIDFont=!0),r.isCIDFont){var f=c.fdArray,p=c.fdSelect;if(f===0||p===0)throw new Error("Font is marked as a CID font, but FDArray and/or FDSelect information is missing");f+=e;var g=_d(t,f),y=F4(t,e,g.objects,o.objects);c._fdArray=y,p+=e,c._fdSelect=UW(t,p,r.numGlyphs,y.length)}var S=e+c.private[1],w=oR(t,S,c.private[0],o.objects);if(r.defaultWidthX=w.defaultWidthX,r.nominalWidthX=w.nominalWidthX,w.subrs!==0){var C=S+w.subrs,_=_d(t,C);r.subrs=_.objects,r.subrsBias=fk(r.subrs)}else r.subrs=[],r.subrsBias=0;var T;n.lowMemory?(T=LW(t,e+c.charStrings),r.nGlyphs=T.offsets.length):(T=_d(t,e+c.charStrings),r.nGlyphs=T.objects.length);var N=BW(t,e+c.charset,r.nGlyphs,o.objects);if(c.encoding===0?r.cffEncoding=new Px(CW,N):c.encoding===1?r.cffEncoding=new Px(EW,N):r.cffEncoding=zW(t,e+c.encoding,N),r.encoding=r.encoding||r.cffEncoding,r.glyphs=new Eu.GlyphSet(r),n.lowMemory)r._push=function(j){var O=RW(j,T.offsets,t,e+c.charStrings);r.glyphs.push(j,Eu.cffGlyphLoader(r,j,B4,O))};else for(var R=0;R<r.nGlyphs;R+=1){var D=T.objects[R];r.glyphs.push(R,Eu.cffGlyphLoader(r,R,B4,D))}}function lR(t,e){var r,n=Yy.indexOf(t);return n>=0&&(r=n),n=e.indexOf(t),n>=0?r=n+Yy.length:(r=Yy.length+e.length,e.push(t)),r}function VW(){return new Vt.Record("Header",[{name:"major",type:"Card8",value:1},{name:"minor",type:"Card8",value:0},{name:"hdrSize",type:"Card8",value:4},{name:"major",type:"Card8",value:1}])}function HW(t){var e=new Vt.Record("Name INDEX",[{name:"names",type:"INDEX",value:[]}]);e.names=[];for(var r=0;r<t.length;r+=1)e.names.push({name:"name_"+r,type:"NAME",value:t[r]});return e}function uR(t,e,r){for(var n={},i=0;i<t.length;i+=1){var a=t[i],s=e[a.name];s!==void 0&&!rR(s,a.value)&&(a.type==="SID"&&(s=lR(s,r)),n[a.op]={name:a.name,type:a.type,value:s})}return n}function z4(t,e){var r=new Vt.Record("Top DICT",[{name:"dict",type:"DICT",value:{}}]);return r.dict=uR(aR,t,e),r}function U4(t){var e=new Vt.Record("Top DICT INDEX",[{name:"topDicts",type:"INDEX",value:[]}]);return e.topDicts=[{name:"topDict_0",type:"TABLE",value:t}],e}function WW(t){var e=new Vt.Record("String INDEX",[{name:"strings",type:"INDEX",value:[]}]);e.strings=[];for(var r=0;r<t.length;r+=1)e.strings.push({name:"string_"+r,type:"STRING",value:t[r]});return e}function qW(){return new Vt.Record("Global Subr INDEX",[{name:"subrs",type:"INDEX",value:[]}])}function $W(t,e){for(var r=new Vt.Record("Charsets",[{name:"format",type:"Card8",value:0}]),n=0;n<t.length;n+=1){var i=t[n],a=lR(i,e);r.fields.push({name:"glyph_"+n,type:"SID",value:a})}return r}function KW(t){var e=[],r=t.path;e.push({name:"width",type:"NUMBER",value:t.advanceWidth});for(var n=0,i=0,a=0;a<r.commands.length;a+=1){var s=void 0,o=void 0,l=r.commands[a];if(l.type==="Q"){var u=.3333333333333333,c=2/3;l={type:"C",x:l.x,y:l.y,x1:Math.round(u*n+c*l.x1),y1:Math.round(u*i+c*l.y1),x2:Math.round(u*l.x+c*l.x1),y2:Math.round(u*l.y+c*l.y1)}}if(l.type==="M")s=Math.round(l.x-n),o=Math.round(l.y-i),e.push({name:"dx",type:"NUMBER",value:s}),e.push({name:"dy",type:"NUMBER",value:o}),e.push({name:"rmoveto",type:"OP",value:21}),n=Math.round(l.x),i=Math.round(l.y);else if(l.type==="L")s=Math.round(l.x-n),o=Math.round(l.y-i),e.push({name:"dx",type:"NUMBER",value:s}),e.push({name:"dy",type:"NUMBER",value:o}),e.push({name:"rlineto",type:"OP",value:5}),n=Math.round(l.x),i=Math.round(l.y);else if(l.type==="C"){var f=Math.round(l.x1-n),p=Math.round(l.y1-i),g=Math.round(l.x2-l.x1),y=Math.round(l.y2-l.y1);s=Math.round(l.x-l.x2),o=Math.round(l.y-l.y2),e.push({name:"dx1",type:"NUMBER",value:f}),e.push({name:"dy1",type:"NUMBER",value:p}),e.push({name:"dx2",type:"NUMBER",value:g}),e.push({name:"dy2",type:"NUMBER",value:y}),e.push({name:"dx",type:"NUMBER",value:s}),e.push({name:"dy",type:"NUMBER",value:o}),e.push({name:"rrcurveto",type:"OP",value:8}),n=Math.round(l.x),i=Math.round(l.y)}}return e.push({name:"endchar",type:"OP",value:14}),e}function ZW(t){for(var e=new Vt.Record("CharStrings INDEX",[{name:"charStrings",type:"INDEX",value:[]}]),r=0;r<t.length;r+=1){var n=t.get(r),i=KW(n);e.charStrings.push({name:n.name,type:"CHARSTRING",value:i})}return e}function YW(t,e){var r=new Vt.Record("Private DICT",[{name:"dict",type:"DICT",value:{}}]);return r.dict=uR(sR,t,e),r}function XW(t,e){for(var r=new Vt.Table("CFF ",[{name:"header",type:"RECORD"},{name:"nameIndex",type:"RECORD"},{name:"topDictIndex",type:"RECORD"},{name:"stringIndex",type:"RECORD"},{name:"globalSubrIndex",type:"RECORD"},{name:"charsets",type:"RECORD"},{name:"charStringsIndex",type:"RECORD"},{name:"privateDict",type:"RECORD"}]),n=1/e.unitsPerEm,i={version:e.version,fullName:e.fullName,familyName:e.familyName,weight:e.weightName,fontBBox:e.fontBBox||[0,0,0,0],fontMatrix:[n,0,0,n,0,0],charset:999,encoding:0,charStrings:999,private:[0,999]},a={},s=[],o,l=1;l<t.length;l+=1)o=t.get(l),s.push(o.name);var u=[];r.header=VW(),r.nameIndex=HW([e.postScriptName]);var c=z4(i,u);r.topDictIndex=U4(c),r.globalSubrIndex=qW(),r.charsets=$W(s,u),r.charStringsIndex=ZW(t),r.privateDict=YW(a,u),r.stringIndex=WW(u);var f=r.header.sizeOf()+r.nameIndex.sizeOf()+r.topDictIndex.sizeOf()+r.stringIndex.sizeOf()+r.globalSubrIndex.sizeOf();return i.charset=f,i.encoding=0,i.charStrings=i.charset+r.charsets.sizeOf(),i.private[1]=i.charStrings+r.charStringsIndex.sizeOf(),c=z4(i,u),r.topDictIndex=U4(c),r}var QW={parse:GW,make:XW};function JW(t,e){var r={},n=new yr.Parser(t,e);return r.version=n.parseVersion(),r.fontRevision=Math.round(n.parseFixed()*1e3)/1e3,r.checkSumAdjustment=n.parseULong(),r.magicNumber=n.parseULong(),mr.argument(r.magicNumber===1594834165,"Font header has wrong magic number."),r.flags=n.parseUShort(),r.unitsPerEm=n.parseUShort(),r.created=n.parseLongDateTime(),r.modified=n.parseLongDateTime(),r.xMin=n.parseShort(),r.yMin=n.parseShort(),r.xMax=n.parseShort(),r.yMax=n.parseShort(),r.macStyle=n.parseUShort(),r.lowestRecPPEM=n.parseUShort(),r.fontDirectionHint=n.parseShort(),r.indexToLocFormat=n.parseShort(),r.glyphDataFormat=n.parseShort(),r}function eq(t){var e=Math.round(new Date().getTime()/1e3)+2082844800,r=e;return t.createdTimestamp&&(r=t.createdTimestamp+2082844800),new Vt.Table("head",[{name:"version",type:"FIXED",value:65536},{name:"fontRevision",type:"FIXED",value:65536},{name:"checkSumAdjustment",type:"ULONG",value:0},{name:"magicNumber",type:"ULONG",value:1594834165},{name:"flags",type:"USHORT",value:0},{name:"unitsPerEm",type:"USHORT",value:1e3},{name:"created",type:"LONGDATETIME",value:r},{name:"modified",type:"LONGDATETIME",value:e},{name:"xMin",type:"SHORT",value:0},{name:"yMin",type:"SHORT",value:0},{name:"xMax",type:"SHORT",value:0},{name:"yMax",type:"SHORT",value:0},{name:"macStyle",type:"USHORT",value:0},{name:"lowestRecPPEM",type:"USHORT",value:0},{name:"fontDirectionHint",type:"SHORT",value:2},{name:"indexToLocFormat",type:"SHORT",value:0},{name:"glyphDataFormat",type:"SHORT",value:0}],t)}var tq={parse:JW,make:eq};function rq(t,e){var r={},n=new yr.Parser(t,e);return r.version=n.parseVersion(),r.ascender=n.parseShort(),r.descender=n.parseShort(),r.lineGap=n.parseShort(),r.advanceWidthMax=n.parseUShort(),r.minLeftSideBearing=n.parseShort(),r.minRightSideBearing=n.parseShort(),r.xMaxExtent=n.parseShort(),r.caretSlopeRise=n.parseShort(),r.caretSlopeRun=n.parseShort(),r.caretOffset=n.parseShort(),n.relativeOffset+=8,r.metricDataFormat=n.parseShort(),r.numberOfHMetrics=n.parseUShort(),r}function nq(t){return new Vt.Table("hhea",[{name:"version",type:"FIXED",value:65536},{name:"ascender",type:"FWORD",value:0},{name:"descender",type:"FWORD",value:0},{name:"lineGap",type:"FWORD",value:0},{name:"advanceWidthMax",type:"UFWORD",value:0},{name:"minLeftSideBearing",type:"FWORD",value:0},{name:"minRightSideBearing",type:"FWORD",value:0},{name:"xMaxExtent",type:"FWORD",value:0},{name:"caretSlopeRise",type:"SHORT",value:1},{name:"caretSlopeRun",type:"SHORT",value:0},{name:"caretOffset",type:"SHORT",value:0},{name:"reserved1",type:"SHORT",value:0},{name:"reserved2",type:"SHORT",value:0},{name:"reserved3",type:"SHORT",value:0},{name:"reserved4",type:"SHORT",value:0},{name:"metricDataFormat",type:"SHORT",value:0},{name:"numberOfHMetrics",type:"USHORT",value:0}],t)}var iq={parse:rq,make:nq};function aq(t,e,r,n,i){for(var a,s,o=new yr.Parser(t,e),l=0;l<n;l+=1){l<r&&(a=o.parseUShort(),s=o.parseShort());var u=i.get(l);u.advanceWidth=a,u.leftSideBearing=s}}function sq(t,e,r,n,i){t._hmtxTableData={};for(var a,s,o=new yr.Parser(e,r),l=0;l<i;l+=1)l<n&&(a=o.parseUShort(),s=o.parseShort()),t._hmtxTableData[l]={advanceWidth:a,leftSideBearing:s}}function oq(t,e,r,n,i,a,s){s.lowMemory?sq(t,e,r,n,i):aq(e,r,n,i,a)}function lq(t){for(var e=new Vt.Table("hmtx",[]),r=0;r<t.length;r+=1){var n=t.get(r),i=n.advanceWidth||0,a=n.leftSideBearing||0;e.fields.push({name:"advanceWidth_"+r,type:"USHORT",value:i}),e.fields.push({name:"leftSideBearing_"+r,type:"SHORT",value:a})}return e}var uq={parse:oq,make:lq};function cq(t){for(var e=new Vt.Table("ltag",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"numTags",type:"ULONG",value:t.length}]),r="",n=12+t.length*4,i=0;i<t.length;++i){var a=r.indexOf(t[i]);a<0&&(a=r.length,r+=t[i]),e.fields.push({name:"offset "+i,type:"USHORT",value:n+a}),e.fields.push({name:"length "+i,type:"USHORT",value:t[i].length})}return e.fields.push({name:"stringPool",type:"CHARARRAY",value:r}),e}function dq(t,e){var r=new yr.Parser(t,e),n=r.parseULong();mr.argument(n===1,"Unsupported ltag table version."),r.skip("uLong",1);for(var i=r.parseULong(),a=[],s=0;s<i;s++){for(var o="",l=e+r.parseUShort(),u=r.parseUShort(),c=l;c<l+u;++c)o+=String.fromCharCode(t.getInt8(c));a.push(o)}return a}var fq={make:cq,parse:dq};function hq(t,e){var r={},n=new yr.Parser(t,e);return r.version=n.parseVersion(),r.numGlyphs=n.parseUShort(),r.version===1&&(r.maxPoints=n.parseUShort(),r.maxContours=n.parseUShort(),r.maxCompositePoints=n.parseUShort(),r.maxCompositeContours=n.parseUShort(),r.maxZones=n.parseUShort(),r.maxTwilightPoints=n.parseUShort(),r.maxStorage=n.parseUShort(),r.maxFunctionDefs=n.parseUShort(),r.maxInstructionDefs=n.parseUShort(),r.maxStackElements=n.parseUShort(),r.maxSizeOfInstructions=n.parseUShort(),r.maxComponentElements=n.parseUShort(),r.maxComponentDepth=n.parseUShort()),r}function pq(t){return new Vt.Table("maxp",[{name:"version",type:"FIXED",value:20480},{name:"numGlyphs",type:"USHORT",value:t}])}var mq={parse:hq,make:pq},cR=["copyright","fontFamily","fontSubfamily","uniqueID","fullName","version","postScriptName","trademark","manufacturer","designer","description","manufacturerURL","designerURL","license","licenseURL","reserved","preferredFamily","preferredSubfamily","compatibleFullName","sampleText","postScriptFindFontName","wwsFamily","wwsSubfamily"],dR={0:"en",1:"fr",2:"de",3:"it",4:"nl",5:"sv",6:"es",7:"da",8:"pt",9:"no",10:"he",11:"ja",12:"ar",13:"fi",14:"el",15:"is",16:"mt",17:"tr",18:"hr",19:"zh-Hant",20:"ur",21:"hi",22:"th",23:"ko",24:"lt",25:"pl",26:"hu",27:"es",28:"lv",29:"se",30:"fo",31:"fa",32:"ru",33:"zh",34:"nl-BE",35:"ga",36:"sq",37:"ro",38:"cz",39:"sk",40:"si",41:"yi",42:"sr",43:"mk",44:"bg",45:"uk",46:"be",47:"uz",48:"kk",49:"az-Cyrl",50:"az-Arab",51:"hy",52:"ka",53:"mo",54:"ky",55:"tg",56:"tk",57:"mn-CN",58:"mn",59:"ps",60:"ks",61:"ku",62:"sd",63:"bo",64:"ne",65:"sa",66:"mr",67:"bn",68:"as",69:"gu",70:"pa",71:"or",72:"ml",73:"kn",74:"ta",75:"te",76:"si",77:"my",78:"km",79:"lo",80:"vi",81:"id",82:"tl",83:"ms",84:"ms-Arab",85:"am",86:"ti",87:"om",88:"so",89:"sw",90:"rw",91:"rn",92:"ny",93:"mg",94:"eo",128:"cy",129:"eu",130:"ca",131:"la",132:"qu",133:"gn",134:"ay",135:"tt",136:"ug",137:"dz",138:"jv",139:"su",140:"gl",141:"af",142:"br",143:"iu",144:"gd",145:"gv",146:"ga",147:"to",148:"el-polyton",149:"kl",150:"az",151:"nn"},gq={0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:5,11:1,12:4,13:0,14:6,15:0,16:0,17:0,18:0,19:2,20:4,21:9,22:21,23:3,24:29,25:29,26:29,27:29,28:29,29:0,30:0,31:4,32:7,33:25,34:0,35:0,36:0,37:0,38:29,39:29,40:0,41:5,42:7,43:7,44:7,45:7,46:7,47:7,48:7,49:7,50:4,51:24,52:23,53:7,54:7,55:7,56:7,57:27,58:7,59:4,60:4,61:4,62:4,63:26,64:9,65:9,66:9,67:13,68:13,69:11,70:10,71:12,72:17,73:16,74:14,75:15,76:18,77:19,78:20,79:22,80:30,81:0,82:0,83:0,84:4,85:28,86:28,87:28,88:0,89:0,90:0,91:0,92:0,93:0,94:0,128:0,129:0,130:0,131:0,132:0,133:0,134:0,135:7,136:4,137:26,138:0,139:0,140:0,141:0,142:0,143:28,144:0,145:0,146:0,147:0,148:6,149:0,150:0,151:0},fR={1078:"af",1052:"sq",1156:"gsw",1118:"am",5121:"ar-DZ",15361:"ar-BH",3073:"ar",2049:"ar-IQ",11265:"ar-JO",13313:"ar-KW",12289:"ar-LB",4097:"ar-LY",6145:"ary",8193:"ar-OM",16385:"ar-QA",1025:"ar-SA",10241:"ar-SY",7169:"aeb",14337:"ar-AE",9217:"ar-YE",1067:"hy",1101:"as",2092:"az-Cyrl",1068:"az",1133:"ba",1069:"eu",1059:"be",2117:"bn",1093:"bn-IN",8218:"bs-Cyrl",5146:"bs",1150:"br",1026:"bg",1027:"ca",3076:"zh-HK",5124:"zh-MO",2052:"zh",4100:"zh-SG",1028:"zh-TW",1155:"co",1050:"hr",4122:"hr-BA",1029:"cs",1030:"da",1164:"prs",1125:"dv",2067:"nl-BE",1043:"nl",3081:"en-AU",10249:"en-BZ",4105:"en-CA",9225:"en-029",16393:"en-IN",6153:"en-IE",8201:"en-JM",17417:"en-MY",5129:"en-NZ",13321:"en-PH",18441:"en-SG",7177:"en-ZA",11273:"en-TT",2057:"en-GB",1033:"en",12297:"en-ZW",1061:"et",1080:"fo",1124:"fil",1035:"fi",2060:"fr-BE",3084:"fr-CA",1036:"fr",5132:"fr-LU",6156:"fr-MC",4108:"fr-CH",1122:"fy",1110:"gl",1079:"ka",3079:"de-AT",1031:"de",5127:"de-LI",4103:"de-LU",2055:"de-CH",1032:"el",1135:"kl",1095:"gu",1128:"ha",1037:"he",1081:"hi",1038:"hu",1039:"is",1136:"ig",1057:"id",1117:"iu",2141:"iu-Latn",2108:"ga",1076:"xh",1077:"zu",1040:"it",2064:"it-CH",1041:"ja",1099:"kn",1087:"kk",1107:"km",1158:"quc",1159:"rw",1089:"sw",1111:"kok",1042:"ko",1088:"ky",1108:"lo",1062:"lv",1063:"lt",2094:"dsb",1134:"lb",1071:"mk",2110:"ms-BN",1086:"ms",1100:"ml",1082:"mt",1153:"mi",1146:"arn",1102:"mr",1148:"moh",1104:"mn",2128:"mn-CN",1121:"ne",1044:"nb",2068:"nn",1154:"oc",1096:"or",1123:"ps",1045:"pl",1046:"pt",2070:"pt-PT",1094:"pa",1131:"qu-BO",2155:"qu-EC",3179:"qu",1048:"ro",1047:"rm",1049:"ru",9275:"smn",4155:"smj-NO",5179:"smj",3131:"se-FI",1083:"se",2107:"se-SE",8251:"sms",6203:"sma-NO",7227:"sms",1103:"sa",7194:"sr-Cyrl-BA",3098:"sr",6170:"sr-Latn-BA",2074:"sr-Latn",1132:"nso",1074:"tn",1115:"si",1051:"sk",1060:"sl",11274:"es-AR",16394:"es-BO",13322:"es-CL",9226:"es-CO",5130:"es-CR",7178:"es-DO",12298:"es-EC",17418:"es-SV",4106:"es-GT",18442:"es-HN",2058:"es-MX",19466:"es-NI",6154:"es-PA",15370:"es-PY",10250:"es-PE",20490:"es-PR",3082:"es",1034:"es",21514:"es-US",14346:"es-UY",8202:"es-VE",2077:"sv-FI",1053:"sv",1114:"syr",1064:"tg",2143:"tzm",1097:"ta",1092:"tt",1098:"te",1054:"th",1105:"bo",1055:"tr",1090:"tk",1152:"ug",1058:"uk",1070:"hsb",1056:"ur",2115:"uz-Cyrl",1091:"uz",1066:"vi",1106:"cy",1160:"wo",1157:"sah",1144:"ii",1130:"yo"};function vq(t,e,r){switch(t){case 0:if(e===65535)return"und";if(r)return r[e];break;case 1:return dR[e];case 3:return fR[e]}}var hk="utf-16",yq={0:"macintosh",1:"x-mac-japanese",2:"x-mac-chinesetrad",3:"x-mac-korean",6:"x-mac-greek",7:"x-mac-cyrillic",9:"x-mac-devanagai",10:"x-mac-gurmukhi",11:"x-mac-gujarati",12:"x-mac-oriya",13:"x-mac-bengali",14:"x-mac-tamil",15:"x-mac-telugu",16:"x-mac-kannada",17:"x-mac-malayalam",18:"x-mac-sinhalese",19:"x-mac-burmese",20:"x-mac-khmer",21:"x-mac-thai",22:"x-mac-lao",23:"x-mac-georgian",24:"x-mac-armenian",25:"x-mac-chinesesimp",26:"x-mac-tibetan",27:"x-mac-mongolian",28:"x-mac-ethiopic",29:"x-mac-ce",30:"x-mac-vietnamese",31:"x-mac-extarabic"},xq={15:"x-mac-icelandic",17:"x-mac-turkish",18:"x-mac-croatian",24:"x-mac-ce",25:"x-mac-ce",26:"x-mac-ce",27:"x-mac-ce",28:"x-mac-ce",30:"x-mac-icelandic",37:"x-mac-romanian",38:"x-mac-ce",39:"x-mac-ce",40:"x-mac-ce",143:"x-mac-inuit",146:"x-mac-gaelic"};function hR(t,e,r){switch(t){case 0:return hk;case 1:return xq[r]||yq[e];case 3:if(e===1||e===10)return hk;break}}function bq(t,e,r){for(var n={},i=new yr.Parser(t,e),a=i.parseUShort(),s=i.parseUShort(),o=i.offset+i.parseUShort(),l=0;l<s;l++){var u=i.parseUShort(),c=i.parseUShort(),f=i.parseUShort(),p=i.parseUShort(),g=cR[p]||p,y=i.parseUShort(),S=i.parseUShort(),w=vq(u,f,r),C=hR(u,c,f);if(C!==void 0&&w!==void 0){var _=void 0;if(C===hk?_=$p.UTF16(t,o+S,y):_=$p.MACSTRING(t,o+S,y,C),_){var T=n[g];T===void 0&&(T=n[g]={}),T[w]=_}}}return a===1&&i.parseUShort(),n}function H2(t){var e={};for(var r in t)e[t[r]]=parseInt(r);return e}function G4(t,e,r,n,i,a){return new Vt.Record("NameRecord",[{name:"platformID",type:"USHORT",value:t},{name:"encodingID",type:"USHORT",value:e},{name:"languageID",type:"USHORT",value:r},{name:"nameID",type:"USHORT",value:n},{name:"length",type:"USHORT",value:i},{name:"offset",type:"USHORT",value:a}])}function wq(t,e){var r=t.length,n=e.length-r+1;e:for(var i=0;i<n;i++)for(;i<n;i++){for(var a=0;a<r;a++)if(e[i+a]!==t[a])continue e;return i}return-1}function V4(t,e){var r=wq(t,e);if(r<0){r=e.length;for(var n=0,i=t.length;n<i;++n)e.push(t[n])}return r}function Sq(t,e){var r,n=[],i={},a=H2(cR);for(var s in t){var o=a[s];if(o===void 0&&(o=s),r=parseInt(o),isNaN(r))throw new Error('Name table entry "'+s+'" does not exist, see nameTableNames for complete list.');i[r]=t[s],n.push(r)}for(var l=H2(dR),u=H2(fR),c=[],f=[],p=0;p<n.length;p++){r=n[p];var g=i[r];for(var y in g){var S=g[y],w=1,C=l[y],_=gq[C],T=hR(w,_,C),N=Pt.MACSTRING(S,T);N===void 0&&(w=0,C=e.indexOf(y),C<0&&(C=e.length,e.push(y)),_=4,N=Pt.UTF16(S));var R=V4(N,f);c.push(G4(w,_,C,r,N.length,R));var D=u[y];if(D!==void 0){var j=Pt.UTF16(S),O=V4(j,f);c.push(G4(3,1,D,r,j.length,O))}}}c.sort(function(G,Z){return G.platformID-Z.platformID||G.encodingID-Z.encodingID||G.languageID-Z.languageID||G.nameID-Z.nameID});for(var F=new Vt.Table("name",[{name:"format",type:"USHORT",value:0},{name:"count",type:"USHORT",value:c.length},{name:"stringOffset",type:"USHORT",value:6+c.length*12}]),z=0;z<c.length;z++)F.fields.push({name:"record_"+z,type:"RECORD",value:c[z]});return F.fields.push({name:"strings",type:"LITERAL",value:f}),F}var kq={parse:bq,make:Sq},pk=[{begin:0,end:127},{begin:128,end:255},{begin:256,end:383},{begin:384,end:591},{begin:592,end:687},{begin:688,end:767},{begin:768,end:879},{begin:880,end:1023},{begin:11392,end:11519},{begin:1024,end:1279},{begin:1328,end:1423},{begin:1424,end:1535},{begin:42240,end:42559},{begin:1536,end:1791},{begin:1984,end:2047},{begin:2304,end:2431},{begin:2432,end:2559},{begin:2560,end:2687},{begin:2688,end:2815},{begin:2816,end:2943},{begin:2944,end:3071},{begin:3072,end:3199},{begin:3200,end:3327},{begin:3328,end:3455},{begin:3584,end:3711},{begin:3712,end:3839},{begin:4256,end:4351},{begin:6912,end:7039},{begin:4352,end:4607},{begin:7680,end:7935},{begin:7936,end:8191},{begin:8192,end:8303},{begin:8304,end:8351},{begin:8352,end:8399},{begin:8400,end:8447},{begin:8448,end:8527},{begin:8528,end:8591},{begin:8592,end:8703},{begin:8704,end:8959},{begin:8960,end:9215},{begin:9216,end:9279},{begin:9280,end:9311},{begin:9312,end:9471},{begin:9472,end:9599},{begin:9600,end:9631},{begin:9632,end:9727},{begin:9728,end:9983},{begin:9984,end:10175},{begin:12288,end:12351},{begin:12352,end:12447},{begin:12448,end:12543},{begin:12544,end:12591},{begin:12592,end:12687},{begin:43072,end:43135},{begin:12800,end:13055},{begin:13056,end:13311},{begin:44032,end:55215},{begin:55296,end:57343},{begin:67840,end:67871},{begin:19968,end:40959},{begin:57344,end:63743},{begin:12736,end:12783},{begin:64256,end:64335},{begin:64336,end:65023},{begin:65056,end:65071},{begin:65040,end:65055},{begin:65104,end:65135},{begin:65136,end:65279},{begin:65280,end:65519},{begin:65520,end:65535},{begin:3840,end:4095},{begin:1792,end:1871},{begin:1920,end:1983},{begin:3456,end:3583},{begin:4096,end:4255},{begin:4608,end:4991},{begin:5024,end:5119},{begin:5120,end:5759},{begin:5760,end:5791},{begin:5792,end:5887},{begin:6016,end:6143},{begin:6144,end:6319},{begin:10240,end:10495},{begin:40960,end:42127},{begin:5888,end:5919},{begin:66304,end:66351},{begin:66352,end:66383},{begin:66560,end:66639},{begin:118784,end:119039},{begin:119808,end:120831},{begin:1044480,end:1048573},{begin:65024,end:65039},{begin:917504,end:917631},{begin:6400,end:6479},{begin:6480,end:6527},{begin:6528,end:6623},{begin:6656,end:6687},{begin:11264,end:11359},{begin:11568,end:11647},{begin:19904,end:19967},{begin:43008,end:43055},{begin:65536,end:65663},{begin:65856,end:65935},{begin:66432,end:66463},{begin:66464,end:66527},{begin:66640,end:66687},{begin:66688,end:66735},{begin:67584,end:67647},{begin:68096,end:68191},{begin:119552,end:119647},{begin:73728,end:74751},{begin:119648,end:119679},{begin:7040,end:7103},{begin:7168,end:7247},{begin:7248,end:7295},{begin:43136,end:43231},{begin:43264,end:43311},{begin:43312,end:43359},{begin:43520,end:43615},{begin:65936,end:65999},{begin:66e3,end:66047},{begin:66208,end:66271},{begin:127024,end:127135}];function _q(t){for(var e=0;e<pk.length;e+=1){var r=pk[e];if(t>=r.begin&&t<r.end)return e}return-1}function Cq(t,e){var r={},n=new yr.Parser(t,e);r.version=n.parseUShort(),r.xAvgCharWidth=n.parseShort(),r.usWeightClass=n.parseUShort(),r.usWidthClass=n.parseUShort(),r.fsType=n.parseUShort(),r.ySubscriptXSize=n.parseShort(),r.ySubscriptYSize=n.parseShort(),r.ySubscriptXOffset=n.parseShort(),r.ySubscriptYOffset=n.parseShort(),r.ySuperscriptXSize=n.parseShort(),r.ySuperscriptYSize=n.parseShort(),r.ySuperscriptXOffset=n.parseShort(),r.ySuperscriptYOffset=n.parseShort(),r.yStrikeoutSize=n.parseShort(),r.yStrikeoutPosition=n.parseShort(),r.sFamilyClass=n.parseShort(),r.panose=[];for(var i=0;i<10;i++)r.panose[i]=n.parseByte();return r.ulUnicodeRange1=n.parseULong(),r.ulUnicodeRange2=n.parseULong(),r.ulUnicodeRange3=n.parseULong(),r.ulUnicodeRange4=n.parseULong(),r.achVendID=String.fromCharCode(n.parseByte(),n.parseByte(),n.parseByte(),n.parseByte()),r.fsSelection=n.parseUShort(),r.usFirstCharIndex=n.parseUShort(),r.usLastCharIndex=n.parseUShort(),r.sTypoAscender=n.parseShort(),r.sTypoDescender=n.parseShort(),r.sTypoLineGap=n.parseShort(),r.usWinAscent=n.parseUShort(),r.usWinDescent=n.parseUShort(),r.version>=1&&(r.ulCodePageRange1=n.parseULong(),r.ulCodePageRange2=n.parseULong()),r.version>=2&&(r.sxHeight=n.parseShort(),r.sCapHeight=n.parseShort(),r.usDefaultChar=n.parseUShort(),r.usBreakChar=n.parseUShort(),r.usMaxContent=n.parseUShort()),r}function Eq(t){return new Vt.Table("OS/2",[{name:"version",type:"USHORT",value:3},{name:"xAvgCharWidth",type:"SHORT",value:0},{name:"usWeightClass",type:"USHORT",value:0},{name:"usWidthClass",type:"USHORT",value:0},{name:"fsType",type:"USHORT",value:0},{name:"ySubscriptXSize",type:"SHORT",value:650},{name:"ySubscriptYSize",type:"SHORT",value:699},{name:"ySubscriptXOffset",type:"SHORT",value:0},{name:"ySubscriptYOffset",type:"SHORT",value:140},{name:"ySuperscriptXSize",type:"SHORT",value:650},{name:"ySuperscriptYSize",type:"SHORT",value:699},{name:"ySuperscriptXOffset",type:"SHORT",value:0},{name:"ySuperscriptYOffset",type:"SHORT",value:479},{name:"yStrikeoutSize",type:"SHORT",value:49},{name:"yStrikeoutPosition",type:"SHORT",value:258},{name:"sFamilyClass",type:"SHORT",value:0},{name:"bFamilyType",type:"BYTE",value:0},{name:"bSerifStyle",type:"BYTE",value:0},{name:"bWeight",type:"BYTE",value:0},{name:"bProportion",type:"BYTE",value:0},{name:"bContrast",type:"BYTE",value:0},{name:"bStrokeVariation",type:"BYTE",value:0},{name:"bArmStyle",type:"BYTE",value:0},{name:"bLetterform",type:"BYTE",value:0},{name:"bMidline",type:"BYTE",value:0},{name:"bXHeight",type:"BYTE",value:0},{name:"ulUnicodeRange1",type:"ULONG",value:0},{name:"ulUnicodeRange2",type:"ULONG",value:0},{name:"ulUnicodeRange3",type:"ULONG",value:0},{name:"ulUnicodeRange4",type:"ULONG",value:0},{name:"achVendID",type:"CHARARRAY",value:"XXXX"},{name:"fsSelection",type:"USHORT",value:0},{name:"usFirstCharIndex",type:"USHORT",value:0},{name:"usLastCharIndex",type:"USHORT",value:0},{name:"sTypoAscender",type:"SHORT",value:0},{name:"sTypoDescender",type:"SHORT",value:0},{name:"sTypoLineGap",type:"SHORT",value:0},{name:"usWinAscent",type:"USHORT",value:0},{name:"usWinDescent",type:"USHORT",value:0},{name:"ulCodePageRange1",type:"ULONG",value:0},{name:"ulCodePageRange2",type:"ULONG",value:0},{name:"sxHeight",type:"SHORT",value:0},{name:"sCapHeight",type:"SHORT",value:0},{name:"usDefaultChar",type:"USHORT",value:0},{name:"usBreakChar",type:"USHORT",value:0},{name:"usMaxContext",type:"USHORT",value:0}],t)}var H4={parse:Cq,make:Eq,unicodeRanges:pk,getUnicodeRange:_q};function Tq(t,e){var r={},n=new yr.Parser(t,e);switch(r.version=n.parseVersion(),r.italicAngle=n.parseFixed(),r.underlinePosition=n.parseShort(),r.underlineThickness=n.parseShort(),r.isFixedPitch=n.parseULong(),r.minMemType42=n.parseULong(),r.maxMemType42=n.parseULong(),r.minMemType1=n.parseULong(),r.maxMemType1=n.parseULong(),r.version){case 1:r.names=j4.slice();break;case 2:r.numberOfGlyphs=n.parseUShort(),r.glyphNameIndex=new Array(r.numberOfGlyphs);for(var i=0;i<r.numberOfGlyphs;i++)r.glyphNameIndex[i]=n.parseUShort();r.names=[];for(var a=0;a<r.numberOfGlyphs;a++)if(r.glyphNameIndex[a]>=j4.length){var s=n.parseChar();r.names.push(n.parseString(s))}break;case 2.5:r.numberOfGlyphs=n.parseUShort(),r.offset=new Array(r.numberOfGlyphs);for(var o=0;o<r.numberOfGlyphs;o++)r.offset[o]=n.parseChar();break}return r}function Nq(){return new Vt.Table("post",[{name:"version",type:"FIXED",value:196608},{name:"italicAngle",type:"FIXED",value:0},{name:"underlinePosition",type:"FWORD",value:0},{name:"underlineThickness",type:"FWORD",value:0},{name:"isFixedPitch",type:"ULONG",value:0},{name:"minMemType42",type:"ULONG",value:0},{name:"maxMemType42",type:"ULONG",value:0},{name:"minMemType1",type:"ULONG",value:0},{name:"maxMemType1",type:"ULONG",value:0}])}var Pq={parse:Tq,make:Nq},Bl=new Array(9);Bl[1]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{substFormat:1,coverage:this.parsePointer(We.coverage),deltaGlyphId:this.parseUShort()};if(r===2)return{substFormat:2,coverage:this.parsePointer(We.coverage),substitute:this.parseOffset16List()};mr.assert(!1,"0x"+e.toString(16)+": lookup type 1 format must be 1 or 2.")};Bl[2]=function(){var e=this.parseUShort();return mr.argument(e===1,"GSUB Multiple Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(We.coverage),sequences:this.parseListOfLists()}};Bl[3]=function(){var e=this.parseUShort();return mr.argument(e===1,"GSUB Alternate Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(We.coverage),alternateSets:this.parseListOfLists()}};Bl[4]=function(){var e=this.parseUShort();return mr.argument(e===1,"GSUB ligature table identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(We.coverage),ligatureSets:this.parseListOfLists(function(){return{ligGlyph:this.parseUShort(),components:this.parseUShortList(this.parseUShort()-1)}})}};var zp={sequenceIndex:We.uShort,lookupListIndex:We.uShort};Bl[5]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{substFormat:r,coverage:this.parsePointer(We.coverage),ruleSets:this.parseListOfLists(function(){var a=this.parseUShort(),s=this.parseUShort();return{input:this.parseUShortList(a-1),lookupRecords:this.parseRecordList(s,zp)}})};if(r===2)return{substFormat:r,coverage:this.parsePointer(We.coverage),classDef:this.parsePointer(We.classDef),classSets:this.parseListOfLists(function(){var a=this.parseUShort(),s=this.parseUShort();return{classes:this.parseUShortList(a-1),lookupRecords:this.parseRecordList(s,zp)}})};if(r===3){var n=this.parseUShort(),i=this.parseUShort();return{substFormat:r,coverages:this.parseList(n,We.pointer(We.coverage)),lookupRecords:this.parseRecordList(i,zp)}}mr.assert(!1,"0x"+e.toString(16)+": lookup type 5 format must be 1, 2 or 3.")};Bl[6]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{substFormat:1,coverage:this.parsePointer(We.coverage),chainRuleSets:this.parseListOfLists(function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(zp)}})};if(r===2)return{substFormat:2,coverage:this.parsePointer(We.coverage),backtrackClassDef:this.parsePointer(We.classDef),inputClassDef:this.parsePointer(We.classDef),lookaheadClassDef:this.parsePointer(We.classDef),chainClassSet:this.parseListOfLists(function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(zp)}})};if(r===3)return{substFormat:3,backtrackCoverage:this.parseList(We.pointer(We.coverage)),inputCoverage:this.parseList(We.pointer(We.coverage)),lookaheadCoverage:this.parseList(We.pointer(We.coverage)),lookupRecords:this.parseRecordList(zp)};mr.assert(!1,"0x"+e.toString(16)+": lookup type 6 format must be 1, 2 or 3.")};Bl[7]=function(){var e=this.parseUShort();mr.argument(e===1,"GSUB Extension Substitution subtable identifier-format must be 1");var r=this.parseUShort(),n=new We(this.data,this.offset+this.parseULong());return{substFormat:1,lookupType:r,extension:Bl[r].call(n)}};Bl[8]=function(){var e=this.parseUShort();return mr.argument(e===1,"GSUB Reverse Chaining Contextual Single Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(We.coverage),backtrackCoverage:this.parseList(We.pointer(We.coverage)),lookaheadCoverage:this.parseList(We.pointer(We.coverage)),substitutes:this.parseUShortList()}};function Mq(t,e){e=e||0;var r=new We(t,e),n=r.parseVersion(1);return mr.argument(n===1||n===1.1,"Unsupported GSUB table version."),n===1?{version:n,scripts:r.parseScriptList(),features:r.parseFeatureList(),lookups:r.parseLookupList(Bl)}:{version:n,scripts:r.parseScriptList(),features:r.parseFeatureList(),lookups:r.parseLookupList(Bl),variations:r.parseFeatureVariationsList()}}var gm=new Array(9);gm[1]=function(e){return e.substFormat===1?new Vt.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new Vt.Coverage(e.coverage)},{name:"deltaGlyphID",type:"USHORT",value:e.deltaGlyphId}]):new Vt.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:2},{name:"coverage",type:"TABLE",value:new Vt.Coverage(e.coverage)}].concat(Vt.ushortList("substitute",e.substitute)))};gm[2]=function(e){return mr.assert(e.substFormat===1,"Lookup type 2 substFormat must be 1."),new Vt.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new Vt.Coverage(e.coverage)}].concat(Vt.tableList("seqSet",e.sequences,function(r){return new Vt.Table("sequenceSetTable",Vt.ushortList("sequence",r))})))};gm[3]=function(e){return mr.assert(e.substFormat===1,"Lookup type 3 substFormat must be 1."),new Vt.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new Vt.Coverage(e.coverage)}].concat(Vt.tableList("altSet",e.alternateSets,function(r){return new Vt.Table("alternateSetTable",Vt.ushortList("alternate",r))})))};gm[4]=function(e){return mr.assert(e.substFormat===1,"Lookup type 4 substFormat must be 1."),new Vt.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new Vt.Coverage(e.coverage)}].concat(Vt.tableList("ligSet",e.ligatureSets,function(r){return new Vt.Table("ligatureSetTable",Vt.tableList("ligature",r,function(n){return new Vt.Table("ligatureTable",[{name:"ligGlyph",type:"USHORT",value:n.ligGlyph}].concat(Vt.ushortList("component",n.components,n.components.length+1)))}))})))};gm[6]=function(e){if(e.substFormat===1){var r=new Vt.Table("chainContextTable",[{name:"substFormat",type:"USHORT",value:e.substFormat},{name:"coverage",type:"TABLE",value:new Vt.Coverage(e.coverage)}].concat(Vt.tableList("chainRuleSet",e.chainRuleSets,function(a){return new Vt.Table("chainRuleSetTable",Vt.tableList("chainRule",a,function(s){var o=Vt.ushortList("backtrackGlyph",s.backtrack,s.backtrack.length).concat(Vt.ushortList("inputGlyph",s.input,s.input.length+1)).concat(Vt.ushortList("lookaheadGlyph",s.lookahead,s.lookahead.length)).concat(Vt.ushortList("substitution",[],s.lookupRecords.length));return s.lookupRecords.forEach(function(l,u){o=o.concat({name:"sequenceIndex"+u,type:"USHORT",value:l.sequenceIndex}).concat({name:"lookupListIndex"+u,type:"USHORT",value:l.lookupListIndex})}),new Vt.Table("chainRuleTable",o)}))})));return r}else if(e.substFormat===2)mr.assert(!1,"lookup type 6 format 2 is not yet supported.");else if(e.substFormat===3){var n=[{name:"substFormat",type:"USHORT",value:e.substFormat}];n.push({name:"backtrackGlyphCount",type:"USHORT",value:e.backtrackCoverage.length}),e.backtrackCoverage.forEach(function(a,s){n.push({name:"backtrackCoverage"+s,type:"TABLE",value:new Vt.Coverage(a)})}),n.push({name:"inputGlyphCount",type:"USHORT",value:e.inputCoverage.length}),e.inputCoverage.forEach(function(a,s){n.push({name:"inputCoverage"+s,type:"TABLE",value:new Vt.Coverage(a)})}),n.push({name:"lookaheadGlyphCount",type:"USHORT",value:e.lookaheadCoverage.length}),e.lookaheadCoverage.forEach(function(a,s){n.push({name:"lookaheadCoverage"+s,type:"TABLE",value:new Vt.Coverage(a)})}),n.push({name:"substitutionCount",type:"USHORT",value:e.lookupRecords.length}),e.lookupRecords.forEach(function(a,s){n=n.concat({name:"sequenceIndex"+s,type:"USHORT",value:a.sequenceIndex}).concat({name:"lookupListIndex"+s,type:"USHORT",value:a.lookupListIndex})});var i=new Vt.Table("chainContextTable",n);return i}mr.assert(!1,"lookup type 6 format must be 1, 2 or 3.")};function Aq(t){return new Vt.Table("GSUB",[{name:"version",type:"ULONG",value:65536},{name:"scripts",type:"TABLE",value:new Vt.ScriptList(t.scripts)},{name:"features",type:"TABLE",value:new Vt.FeatureList(t.features)},{name:"lookups",type:"TABLE",value:new Vt.LookupList(t.lookups,gm)}])}var Lq={parse:Mq,make:Aq};function Rq(t,e){var r=new yr.Parser(t,e),n=r.parseULong();mr.argument(n===1,"Unsupported META table version."),r.parseULong(),r.parseULong();for(var i=r.parseULong(),a={},s=0;s<i;s++){var o=r.parseTag(),l=r.parseULong(),u=r.parseULong(),c=$p.UTF8(t,e+l,u);a[o]=c}return a}function Oq(t){var e=Object.keys(t).length,r="",n=16+e*12,i=new Vt.Table("meta",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"offset",type:"ULONG",value:n},{name:"numTags",type:"ULONG",value:e}]);for(var a in t){var s=r.length;r+=t[a],i.fields.push({name:"tag "+a,type:"TAG",value:a}),i.fields.push({name:"offset "+a,type:"ULONG",value:n+s}),i.fields.push({name:"length "+a,type:"ULONG",value:t[a].length})}return i.fields.push({name:"stringPool",type:"CHARARRAY",value:r}),i}var Dq={parse:Rq,make:Oq};function W4(t){return Math.log(t)/Math.log(2)|0}function B_(t){for(;t.length%4!==0;)t.push(0);for(var e=0,r=0;r<t.length;r+=4)e+=(t[r]<<24)+(t[r+1]<<16)+(t[r+2]<<8)+t[r+3];return e%=Math.pow(2,32),e}function q4(t,e,r,n){return new Vt.Record("Table Record",[{name:"tag",type:"TAG",value:t!==void 0?t:""},{name:"checkSum",type:"ULONG",value:e!==void 0?e:0},{name:"offset",type:"ULONG",value:r!==void 0?r:0},{name:"length",type:"ULONG",value:n!==void 0?n:0}])}function pR(t){var e=new Vt.Table("sfnt",[{name:"version",type:"TAG",value:"OTTO"},{name:"numTables",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);e.tables=t,e.numTables=t.length;var r=Math.pow(2,W4(e.numTables));e.searchRange=16*r,e.entrySelector=W4(r),e.rangeShift=e.numTables*16-e.searchRange;for(var n=[],i=[],a=e.sizeOf()+q4().sizeOf()*e.numTables;a%4!==0;)a+=1,i.push({name:"padding",type:"BYTE",value:0});for(var s=0;s<t.length;s+=1){var o=t[s];mr.argument(o.tableName.length===4,"Table name"+o.tableName+" is invalid.");var l=o.sizeOf(),u=q4(o.tableName,B_(o.encode()),a,l);for(n.push({name:u.tag+" Table Record",type:"RECORD",value:u}),i.push({name:o.tableName+" table",type:"RECORD",value:o}),a+=l,mr.argument(!isNaN(a),"Something went wrong calculating the offset.");a%4!==0;)a+=1,i.push({name:"padding",type:"BYTE",value:0})}return n.sort(function(c,f){return c.value.tag>f.value.tag?1:-1}),e.fields=e.fields.concat(n),e.fields=e.fields.concat(i),e}function $4(t,e,r){for(var n=0;n<e.length;n+=1){var i=t.charToGlyphIndex(e[n]);if(i>0){var a=t.glyphs.get(i);return a.getMetrics()}}return r}function Iq(t){for(var e=0,r=0;r<t.length;r+=1)e+=t[r];return e/t.length}function jq(t){for(var e=[],r=[],n=[],i=[],a=[],s=[],o=[],l,u=0,c=0,f=0,p=0,g=0,y=0;y<t.glyphs.length;y+=1){var S=t.glyphs.get(y),w=S.unicode|0;if(isNaN(S.advanceWidth))throw new Error("Glyph "+S.name+" ("+y+"): advanceWidth is not a number.");(l>w||l===void 0)&&w>0&&(l=w),u<w&&(u=w);var C=H4.getUnicodeRange(w);if(C<32)c|=1<<C;else if(C<64)f|=1<<C-32;else if(C<96)p|=1<<C-64;else if(C<123)g|=1<<C-96;else throw new Error("Unicode ranges bits > 123 are reserved for internal usage");if(S.name!==".notdef"){var _=S.getMetrics();e.push(_.xMin),r.push(_.yMin),n.push(_.xMax),i.push(_.yMax),s.push(_.leftSideBearing),o.push(_.rightSideBearing),a.push(S.advanceWidth)}}var T={xMin:Math.min.apply(null,e),yMin:Math.min.apply(null,r),xMax:Math.max.apply(null,n),yMax:Math.max.apply(null,i),advanceWidthMax:Math.max.apply(null,a),advanceWidthAvg:Iq(a),minLeftSideBearing:Math.min.apply(null,s),maxLeftSideBearing:Math.max.apply(null,s),minRightSideBearing:Math.min.apply(null,o)};T.ascender=t.ascender,T.descender=t.descender;var N=tq.make({flags:3,unitsPerEm:t.unitsPerEm,xMin:T.xMin,yMin:T.yMin,xMax:T.xMax,yMax:T.yMax,lowestRecPPEM:3,createdTimestamp:t.createdTimestamp}),R=iq.make({ascender:T.ascender,descender:T.descender,advanceWidthMax:T.advanceWidthMax,minLeftSideBearing:T.minLeftSideBearing,minRightSideBearing:T.minRightSideBearing,xMaxExtent:T.maxLeftSideBearing+(T.xMax-T.xMin),numberOfHMetrics:t.glyphs.length}),D=mq.make(t.glyphs.length),j=H4.make(Object.assign({xAvgCharWidth:Math.round(T.advanceWidthAvg),usFirstCharIndex:l,usLastCharIndex:u,ulUnicodeRange1:c,ulUnicodeRange2:f,ulUnicodeRange3:p,ulUnicodeRange4:g,sTypoAscender:T.ascender,sTypoDescender:T.descender,sTypoLineGap:0,usWinAscent:T.yMax,usWinDescent:Math.abs(T.yMin),ulCodePageRange1:1,sxHeight:$4(t,"xyvw",{yMax:Math.round(T.ascender/2)}).yMax,sCapHeight:$4(t,"HIKLEFJMNTZBDPRAGOQSUVWXY",T).yMax,usDefaultChar:t.hasChar(" ")?32:0,usBreakChar:t.hasChar(" ")?32:0},t.tables.os2)),O=uq.make(t.glyphs),F=_W.make(t.glyphs),z=t.getEnglishName("fontFamily"),G=t.getEnglishName("fontSubfamily"),Z=z+" "+G,I=t.getEnglishName("postScriptName");I||(I=z.replace(/\s/g,"")+"-"+G);var W={};for(var U in t.names)W[U]=t.names[U];W.uniqueID||(W.uniqueID={en:t.getEnglishName("manufacturer")+":"+Z}),W.postScriptName||(W.postScriptName={en:I}),W.preferredFamily||(W.preferredFamily=t.names.fontFamily),W.preferredSubfamily||(W.preferredSubfamily=t.names.fontSubfamily);var K=[],$=kq.make(W,K),Q=K.length>0?fq.make(K):void 0,ie=Pq.make(),te=QW.make(t.glyphs,{version:t.getEnglishName("version"),fullName:Z,familyName:z,weightName:G,postScriptName:I,unitsPerEm:t.unitsPerEm,fontBBox:[0,T.yMin,T.ascender,T.advanceWidthMax]}),X=t.metas&&Object.keys(t.metas).length>0?Dq.make(t.metas):void 0,re=[N,R,D,j,$,F,ie,te,O];Q&&re.push(Q),t.tables.gsub&&re.push(Lq.make(t.tables.gsub)),X&&re.push(X);for(var fe=pR(re),oe=fe.encode(),se=B_(oe),he=fe.fields,ae=!1,pe=0;pe<he.length;pe+=1)if(he[pe].name==="head table"){he[pe].value.checkSumAdjustment=2981146554-se,ae=!0;break}if(!ae)throw new Error("Could not find head table with checkSum to adjust.");return fe}var Fq={make:pR,fontToTable:jq,computeCheckSum:B_};function W2(t,e){for(var r=0,n=t.length-1;r<=n;){var i=r+n>>>1,a=t[i].tag;if(a===e)return i;a<e?r=i+1:n=i-1}return-r-1}function K4(t,e){for(var r=0,n=t.length-1;r<=n;){var i=r+n>>>1,a=t[i];if(a===e)return i;a<e?r=i+1:n=i-1}return-r-1}function Z4(t,e){for(var r,n=0,i=t.length-1;n<=i;){var a=n+i>>>1;r=t[a];var s=r.start;if(s===e)return r;s<e?n=a+1:i=a-1}if(n>0)return r=t[n-1],e>r.end?0:r}function u0(t,e){this.font=t,this.tableName=e}u0.prototype={searchTag:W2,binSearch:K4,getTable:function(t){var e=this.font.tables[this.tableName];return!e&&t&&(e=this.font.tables[this.tableName]=this.createDefaultTable()),e},getScriptNames:function(){var t=this.getTable();return t?t.scripts.map(function(e){return e.tag}):[]},getDefaultScriptName:function(){var t=this.getTable();if(t){for(var e=!1,r=0;r<t.scripts.length;r++){var n=t.scripts[r].tag;if(n==="DFLT")return n;n==="latn"&&(e=!0)}if(e)return"latn"}},getScriptTable:function(t,e){var r=this.getTable(e);if(r){t=t||"DFLT";var n=r.scripts,i=W2(r.scripts,t);if(i>=0)return n[i].script;if(e){var a={tag:t,script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}};return n.splice(-1-i,0,a),a.script}}},getLangSysTable:function(t,e,r){var n=this.getScriptTable(t,r);if(n){if(!e||e==="dflt"||e==="DFLT")return n.defaultLangSys;var i=W2(n.langSysRecords,e);if(i>=0)return n.langSysRecords[i].langSys;if(r){var a={tag:e,langSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]}};return n.langSysRecords.splice(-1-i,0,a),a.langSys}}},getFeatureTable:function(t,e,r,n){var i=this.getLangSysTable(t,e,n);if(i){for(var a,s=i.featureIndexes,o=this.font.tables[this.tableName].features,l=0;l<s.length;l++)if(a=o[s[l]],a.tag===r)return a.feature;if(n){var u=o.length;return mr.assert(u===0||r>=o[u-1].tag,"Features must be added in alphabetical order."),a={tag:r,feature:{params:0,lookupListIndexes:[]}},o.push(a),s.push(u),a.feature}}},getLookupTables:function(t,e,r,n,i){var a=this.getFeatureTable(t,e,r,i),s=[];if(a){for(var o,l=a.lookupListIndexes,u=this.font.tables[this.tableName].lookups,c=0;c<l.length;c++)o=u[l[c]],o.lookupType===n&&s.push(o);if(s.length===0&&i){o={lookupType:n,lookupFlag:0,subtables:[],markFilteringSet:void 0};var f=u.length;return u.push(o),l.push(f),[o]}}return s},getGlyphClass:function(t,e){switch(t.format){case 1:return t.startGlyph<=e&&e<t.startGlyph+t.classes.length?t.classes[e-t.startGlyph]:0;case 2:var r=Z4(t.ranges,e);return r?r.classId:0}},getCoverageIndex:function(t,e){switch(t.format){case 1:var r=K4(t.glyphs,e);return r>=0?r:-1;case 2:var n=Z4(t.ranges,e);return n?n.index+e-n.start:-1}},expandCoverage:function(t){if(t.format===1)return t.glyphs;for(var e=[],r=t.ranges,n=0;n<r.length;n++)for(var i=r[n],a=i.start,s=i.end,o=a;o<=s;o++)e.push(o);return e}};function c0(t){u0.call(this,t,"gpos")}c0.prototype=u0.prototype;c0.prototype.init=function(){var t=this.getDefaultScriptName();this.defaultKerningTables=this.getKerningTables(t)};c0.prototype.getKerningValue=function(t,e,r){for(var n=0;n<t.length;n++)for(var i=t[n].subtables,a=0;a<i.length;a++){var s=i[a],o=this.getCoverageIndex(s.coverage,e);if(!(o<0))switch(s.posFormat){case 1:for(var l=s.pairSets[o],u=0;u<l.length;u++){var c=l[u];if(c.secondGlyph===r)return c.value1&&c.value1.xAdvance||0}break;case 2:var f=this.getGlyphClass(s.classDef1,e),p=this.getGlyphClass(s.classDef2,r),g=s.classRecords[f][p];return g.value1&&g.value1.xAdvance||0}}return 0};c0.prototype.getKerningTables=function(t,e){if(this.font.tables.gpos)return this.getLookupTables(t,e,"kern",2)};function wo(t){u0.call(this,t,"gsub")}function Bq(t,e){var r=t.length;if(r!==e.length)return!1;for(var n=0;n<r;n++)if(t[n]!==e[n])return!1;return!0}function z_(t,e,r){for(var n=t.subtables,i=0;i<n.length;i++){var a=n[i];if(a.substFormat===e)return a}if(r)return n.push(r),r}wo.prototype=u0.prototype;wo.prototype.createDefaultTable=function(){return{version:1,scripts:[{tag:"DFLT",script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}}],features:[],lookups:[]}};wo.prototype.getSingle=function(t,e,r){for(var n=[],i=this.getLookupTables(e,r,t,1),a=0;a<i.length;a++)for(var s=i[a].subtables,o=0;o<s.length;o++){var l=s[o],u=this.expandCoverage(l.coverage),c=void 0;if(l.substFormat===1){var f=l.deltaGlyphId;for(c=0;c<u.length;c++){var p=u[c];n.push({sub:p,by:p+f})}}else{var g=l.substitute;for(c=0;c<u.length;c++)n.push({sub:u[c],by:g[c]})}}return n};wo.prototype.getMultiple=function(t,e,r){for(var n=[],i=this.getLookupTables(e,r,t,2),a=0;a<i.length;a++)for(var s=i[a].subtables,o=0;o<s.length;o++){var l=s[o],u=this.expandCoverage(l.coverage),c=void 0;for(c=0;c<u.length;c++){var f=u[c],p=l.sequences[c];n.push({sub:f,by:p})}}return n};wo.prototype.getAlternates=function(t,e,r){for(var n=[],i=this.getLookupTables(e,r,t,3),a=0;a<i.length;a++)for(var s=i[a].subtables,o=0;o<s.length;o++)for(var l=s[o],u=this.expandCoverage(l.coverage),c=l.alternateSets,f=0;f<u.length;f++)n.push({sub:u[f],by:c[f]});return n};wo.prototype.getLigatures=function(t,e,r){for(var n=[],i=this.getLookupTables(e,r,t,4),a=0;a<i.length;a++)for(var s=i[a].subtables,o=0;o<s.length;o++)for(var l=s[o],u=this.expandCoverage(l.coverage),c=l.ligatureSets,f=0;f<u.length;f++)for(var p=u[f],g=c[f],y=0;y<g.length;y++){var S=g[y];n.push({sub:[p].concat(S.components),by:S.ligGlyph})}return n};wo.prototype.addSingle=function(t,e,r,n){var i=this.getLookupTables(r,n,t,1,!0)[0],a=z_(i,2,{substFormat:2,coverage:{format:1,glyphs:[]},substitute:[]});mr.assert(a.coverage.format===1,"Single: unable to modify coverage table format "+a.coverage.format);var s=e.sub,o=this.binSearch(a.coverage.glyphs,s);o<0&&(o=-1-o,a.coverage.glyphs.splice(o,0,s),a.substitute.splice(o,0,0)),a.substitute[o]=e.by};wo.prototype.addMultiple=function(t,e,r,n){mr.assert(e.by instanceof Array&&e.by.length>1,'Multiple: "by" must be an array of two or more ids');var i=this.getLookupTables(r,n,t,2,!0)[0],a=z_(i,1,{substFormat:1,coverage:{format:1,glyphs:[]},sequences:[]});mr.assert(a.coverage.format===1,"Multiple: unable to modify coverage table format "+a.coverage.format);var s=e.sub,o=this.binSearch(a.coverage.glyphs,s);o<0&&(o=-1-o,a.coverage.glyphs.splice(o,0,s),a.sequences.splice(o,0,0)),a.sequences[o]=e.by};wo.prototype.addAlternate=function(t,e,r,n){var i=this.getLookupTables(r,n,t,3,!0)[0],a=z_(i,1,{substFormat:1,coverage:{format:1,glyphs:[]},alternateSets:[]});mr.assert(a.coverage.format===1,"Alternate: unable to modify coverage table format "+a.coverage.format);var s=e.sub,o=this.binSearch(a.coverage.glyphs,s);o<0&&(o=-1-o,a.coverage.glyphs.splice(o,0,s),a.alternateSets.splice(o,0,0)),a.alternateSets[o]=e.by};wo.prototype.addLigature=function(t,e,r,n){var i=this.getLookupTables(r,n,t,4,!0)[0],a=i.subtables[0];a||(a={substFormat:1,coverage:{format:1,glyphs:[]},ligatureSets:[]},i.subtables[0]=a),mr.assert(a.coverage.format===1,"Ligature: unable to modify coverage table format "+a.coverage.format);var s=e.sub[0],o=e.sub.slice(1),l={ligGlyph:e.by,components:o},u=this.binSearch(a.coverage.glyphs,s);if(u>=0){for(var c=a.ligatureSets[u],f=0;f<c.length;f++)if(Bq(c[f].components,o))return;c.push(l)}else u=-1-u,a.coverage.glyphs.splice(u,0,s),a.ligatureSets.splice(u,0,[l])};wo.prototype.getFeature=function(t,e,r){if(/ss\d\d/.test(t))return this.getSingle(t,e,r);switch(t){case"aalt":case"salt":return this.getSingle(t,e,r).concat(this.getAlternates(t,e,r));case"dlig":case"liga":case"rlig":return this.getLigatures(t,e,r);case"ccmp":return this.getMultiple(t,e,r).concat(this.getLigatures(t,e,r));case"stch":return this.getMultiple(t,e,r)}};wo.prototype.add=function(t,e,r,n){if(/ss\d\d/.test(t))return this.addSingle(t,e,r,n);switch(t){case"aalt":case"salt":return typeof e.by=="number"?this.addSingle(t,e,r,n):this.addAlternate(t,e,r,n);case"dlig":case"liga":case"rlig":return this.addLigature(t,e,r,n);case"ccmp":return e.by instanceof Array?this.addMultiple(t,e,r,n):this.addLigature(t,e,r,n)}};function zq(){return typeof window<"u"}function Uq(t){for(var e=new Buffer(t.byteLength),r=new Uint8Array(t),n=0;n<e.length;++n)e[n]=r[n];return e}function zg(t,e){if(!t)throw e}function Y4(t,e,r,n,i){var a;return(e&n)>0?(a=t.parseByte(),(e&i)===0&&(a=-a),a=r+a):(e&i)>0?a=r:a=r+t.parseShort(),a}function mR(t,e,r){var n=new yr.Parser(e,r);t.numberOfContours=n.parseShort(),t._xMin=n.parseShort(),t._yMin=n.parseShort(),t._xMax=n.parseShort(),t._yMax=n.parseShort();var i,a;if(t.numberOfContours>0){for(var s=t.endPointIndices=[],o=0;o<t.numberOfContours;o+=1)s.push(n.parseUShort());t.instructionLength=n.parseUShort(),t.instructions=[];for(var l=0;l<t.instructionLength;l+=1)t.instructions.push(n.parseByte());var u=s[s.length-1]+1;i=[];for(var c=0;c<u;c+=1)if(a=n.parseByte(),i.push(a),(a&8)>0)for(var f=n.parseByte(),p=0;p<f;p+=1)i.push(a),c+=1;if(mr.argument(i.length===u,"Bad flags."),s.length>0){var g=[],y;if(u>0){for(var S=0;S<u;S+=1)a=i[S],y={},y.onCurve=!!(a&1),y.lastPointOfContour=s.indexOf(S)>=0,g.push(y);for(var w=0,C=0;C<u;C+=1)a=i[C],y=g[C],y.x=Y4(n,a,w,2,16),w=y.x;for(var _=0,T=0;T<u;T+=1)a=i[T],y=g[T],y.y=Y4(n,a,_,4,32),_=y.y}t.points=g}else t.points=[]}else if(t.numberOfContours===0)t.points=[];else{t.isComposite=!0,t.points=[],t.components=[];for(var N=!0;N;){i=n.parseUShort();var R={glyphIndex:n.parseUShort(),xScale:1,scale01:0,scale10:0,yScale:1,dx:0,dy:0};(i&1)>0?(i&2)>0?(R.dx=n.parseShort(),R.dy=n.parseShort()):R.matchedPoints=[n.parseUShort(),n.parseUShort()]:(i&2)>0?(R.dx=n.parseChar(),R.dy=n.parseChar()):R.matchedPoints=[n.parseByte(),n.parseByte()],(i&8)>0?R.xScale=R.yScale=n.parseF2Dot14():(i&64)>0?(R.xScale=n.parseF2Dot14(),R.yScale=n.parseF2Dot14()):(i&128)>0&&(R.xScale=n.parseF2Dot14(),R.scale01=n.parseF2Dot14(),R.scale10=n.parseF2Dot14(),R.yScale=n.parseF2Dot14()),t.components.push(R),N=!!(i&32)}if(i&256){t.instructionLength=n.parseUShort(),t.instructions=[];for(var D=0;D<t.instructionLength;D+=1)t.instructions.push(n.parseByte())}}}function q2(t,e){for(var r=[],n=0;n<t.length;n+=1){var i=t[n],a={x:e.xScale*i.x+e.scale01*i.y+e.dx,y:e.scale10*i.x+e.yScale*i.y+e.dy,onCurve:i.onCurve,lastPointOfContour:i.lastPointOfContour};r.push(a)}return r}function Gq(t){for(var e=[],r=[],n=0;n<t.length;n+=1){var i=t[n];r.push(i),i.lastPointOfContour&&(e.push(r),r=[])}return mr.argument(r.length===0,"There are still points left in the current contour."),e}function gR(t){var e=new $i;if(!t)return e;for(var r=Gq(t),n=0;n<r.length;++n){var i=r[n],a=null,s=i[i.length-1],o=i[0];if(s.onCurve)e.moveTo(s.x,s.y);else if(o.onCurve)e.moveTo(o.x,o.y);else{var l={x:(s.x+o.x)*.5,y:(s.y+o.y)*.5};e.moveTo(l.x,l.y)}for(var u=0;u<i.length;++u)if(a=s,s=o,o=i[(u+1)%i.length],s.onCurve)e.lineTo(s.x,s.y);else{var c=o;a.onCurve||((s.x+a.x)*.5,(s.y+a.y)*.5),o.onCurve||(c={x:(s.x+o.x)*.5,y:(s.y+o.y)*.5}),e.quadraticCurveTo(s.x,s.y,c.x,c.y)}e.closePath()}return e}function vR(t,e){if(e.isComposite)for(var r=0;r<e.components.length;r+=1){var n=e.components[r],i=t.get(n.glyphIndex);if(i.getPath(),i.points){var a=void 0;if(n.matchedPoints===void 0)a=q2(i.points,n);else{if(n.matchedPoints[0]>e.points.length-1||n.matchedPoints[1]>i.points.length-1)throw Error("Matched points out of range in "+e.name);var s=e.points[n.matchedPoints[0]],o=i.points[n.matchedPoints[1]],l={xScale:n.xScale,scale01:n.scale01,scale10:n.scale10,yScale:n.yScale,dx:0,dy:0};o=q2([o],l)[0],l.dx=s.x-o.x,l.dy=s.y-o.y,a=q2(i.points,l)}e.points=e.points.concat(a)}}return gR(e.points)}function Vq(t,e,r,n){for(var i=new Eu.GlyphSet(n),a=0;a<r.length-1;a+=1){var s=r[a],o=r[a+1];s!==o?i.push(a,Eu.ttfGlyphLoader(n,a,mR,t,e+s,vR)):i.push(a,Eu.glyphLoader(n,a))}return i}function Hq(t,e,r,n){var i=new Eu.GlyphSet(n);return n._push=function(a){var s=r[a],o=r[a+1];s!==o?i.push(a,Eu.ttfGlyphLoader(n,a,mR,t,e+s,vR)):i.push(a,Eu.glyphLoader(n,a))},i}function Wq(t,e,r,n,i){return i.lowMemory?Hq(t,e,r,n):Vq(t,e,r,n)}var qq={getPath:gR,parse:Wq},yR,bh,xR,mk;function bR(t){this.font=t,this.getCommands=function(e){return qq.getPath(e).commands},this._fpgmState=this._prepState=void 0,this._errorState=0}function $q(t){return t}function wR(t){return Math.sign(t)*Math.round(Math.abs(t))}function Kq(t){return Math.sign(t)*Math.round(Math.abs(t*2))/2}function Zq(t){return Math.sign(t)*(Math.round(Math.abs(t)+.5)-.5)}function Yq(t){return Math.sign(t)*Math.ceil(Math.abs(t))}function Xq(t){return Math.sign(t)*Math.floor(Math.abs(t))}var SR=function(t){var e=this.srPeriod,r=this.srPhase,n=this.srThreshold,i=1;return t<0&&(t=-t,i=-1),t+=n-r,t=Math.trunc(t/e)*e,t+=r,t<0?r*i:t*i},Cu={x:1,y:0,axis:"x",distance:function(t,e,r,n){return(r?t.xo:t.x)-(n?e.xo:e.x)},interpolate:function(t,e,r,n){var i,a,s,o,l,u,c;if(!n||n===this){if(i=t.xo-e.xo,a=t.xo-r.xo,l=e.x-e.xo,u=r.x-r.xo,s=Math.abs(i),o=Math.abs(a),c=s+o,c===0){t.x=t.xo+(l+u)/2;return}t.x=t.xo+(l*o+u*s)/c;return}if(i=n.distance(t,e,!0,!0),a=n.distance(t,r,!0,!0),l=n.distance(e,e,!1,!0),u=n.distance(r,r,!1,!0),s=Math.abs(i),o=Math.abs(a),c=s+o,c===0){Cu.setRelative(t,t,(l+u)/2,n,!0);return}Cu.setRelative(t,t,(l*o+u*s)/c,n,!0)},normalSlope:Number.NEGATIVE_INFINITY,setRelative:function(t,e,r,n,i){if(!n||n===this){t.x=(i?e.xo:e.x)+r;return}var a=i?e.xo:e.x,s=i?e.yo:e.y,o=a+r*n.x,l=s+r*n.y;t.x=o+(t.y-l)/n.normalSlope},slope:0,touch:function(t){t.xTouched=!0},touched:function(t){return t.xTouched},untouch:function(t){t.xTouched=!1}},hc={x:0,y:1,axis:"y",distance:function(t,e,r,n){return(r?t.yo:t.y)-(n?e.yo:e.y)},interpolate:function(t,e,r,n){var i,a,s,o,l,u,c;if(!n||n===this){if(i=t.yo-e.yo,a=t.yo-r.yo,l=e.y-e.yo,u=r.y-r.yo,s=Math.abs(i),o=Math.abs(a),c=s+o,c===0){t.y=t.yo+(l+u)/2;return}t.y=t.yo+(l*o+u*s)/c;return}if(i=n.distance(t,e,!0,!0),a=n.distance(t,r,!0,!0),l=n.distance(e,e,!1,!0),u=n.distance(r,r,!1,!0),s=Math.abs(i),o=Math.abs(a),c=s+o,c===0){hc.setRelative(t,t,(l+u)/2,n,!0);return}hc.setRelative(t,t,(l*o+u*s)/c,n,!0)},normalSlope:0,setRelative:function(t,e,r,n,i){if(!n||n===this){t.y=(i?e.yo:e.y)+r;return}var a=i?e.xo:e.x,s=i?e.yo:e.y,o=a+r*n.x,l=s+r*n.y;t.y=l+n.normalSlope*(t.x-o)},slope:Number.POSITIVE_INFINITY,touch:function(t){t.yTouched=!0},touched:function(t){return t.yTouched},untouch:function(t){t.yTouched=!1}};Object.freeze(Cu);Object.freeze(hc);function d0(t,e){this.x=t,this.y=e,this.axis=void 0,this.slope=e/t,this.normalSlope=-t/e,Object.freeze(this)}d0.prototype.distance=function(t,e,r,n){return this.x*Cu.distance(t,e,r,n)+this.y*hc.distance(t,e,r,n)};d0.prototype.interpolate=function(t,e,r,n){var i,a,s,o,l,u,c;if(s=n.distance(t,e,!0,!0),o=n.distance(t,r,!0,!0),i=n.distance(e,e,!1,!0),a=n.distance(r,r,!1,!0),l=Math.abs(s),u=Math.abs(o),c=l+u,c===0){this.setRelative(t,t,(i+a)/2,n,!0);return}this.setRelative(t,t,(i*u+a*l)/c,n,!0)};d0.prototype.setRelative=function(t,e,r,n,i){n=n||this;var a=i?e.xo:e.x,s=i?e.yo:e.y,o=a+r*n.x,l=s+r*n.y,u=n.normalSlope,c=this.slope,f=t.x,p=t.y;t.x=(c*f-u*o+l-p)/(c-u),t.y=c*(t.x-f)+p};d0.prototype.touch=function(t){t.xTouched=!0,t.yTouched=!0};function f0(t,e){var r=Math.sqrt(t*t+e*e);return t/=r,e/=r,t===1&&e===0?Cu:t===0&&e===1?hc:new d0(t,e)}function mc(t,e,r,n){this.x=this.xo=Math.round(t*64)/64,this.y=this.yo=Math.round(e*64)/64,this.lastPointOfContour=r,this.onCurve=n,this.prevPointOnContour=void 0,this.nextPointOnContour=void 0,this.xTouched=!1,this.yTouched=!1,Object.preventExtensions(this)}mc.prototype.nextTouched=function(t){for(var e=this.nextPointOnContour;!t.touched(e)&&e!==this;)e=e.nextPointOnContour;return e};mc.prototype.prevTouched=function(t){for(var e=this.prevPointOnContour;!t.touched(e)&&e!==this;)e=e.prevPointOnContour;return e};var Ov=Object.freeze(new mc(0,0)),Qq={cvCutIn:17/16,deltaBase:9,deltaShift:.125,loop:1,minDis:1,autoFlip:!0};function Id(t,e){switch(this.env=t,this.stack=[],this.prog=e,t){case"glyf":this.zp0=this.zp1=this.zp2=1,this.rp0=this.rp1=this.rp2=0;case"prep":this.fv=this.pv=this.dpv=Cu,this.round=wR}}bR.prototype.exec=function(t,e){if(typeof e!="number")throw new Error("Point size is not a number!");if(!(this._errorState>2)){var r=this.font,n=this._prepState;if(!n||n.ppem!==e){var i=this._fpgmState;if(!i){Id.prototype=Qq,i=this._fpgmState=new Id("fpgm",r.tables.fpgm),i.funcs=[],i.font=r,Je.DEBUG&&(console.log("---EXEC FPGM---"),i.step=-1);try{bh(i)}catch(u){console.log("Hinting error in FPGM:"+u),this._errorState=3;return}}Id.prototype=i,n=this._prepState=new Id("prep",r.tables.prep),n.ppem=e;var a=r.tables.cvt;if(a)for(var s=n.cvt=new Array(a.length),o=e/r.unitsPerEm,l=0;l<a.length;l++)s[l]=a[l]*o;else n.cvt=[];Je.DEBUG&&(console.log("---EXEC PREP---"),n.step=-1);try{bh(n)}catch(u){this._errorState<2&&console.log("Hinting error in PREP:"+u),this._errorState=2}}if(!(this._errorState>1))try{return xR(t,n)}catch(u){this._errorState<1&&(console.log("Hinting error:"+u),console.log("Note: further hinting errors are silenced")),this._errorState=1;return}}};xR=function(t,e){var r=e.ppem/e.font.unitsPerEm,n=r,i=t.components,a,s,o;if(Id.prototype=e,!i)o=new Id("glyf",t.instructions),Je.DEBUG&&(console.log("---EXEC GLYPH---"),o.step=-1),mk(t,o,r,n),s=o.gZone;else{var l=e.font;s=[],a=[];for(var u=0;u<i.length;u++){var c=i[u],f=l.glyphs.get(c.glyphIndex);o=new Id("glyf",f.instructions),Je.DEBUG&&(console.log("---EXEC COMP "+u+"---"),o.step=-1),mk(f,o,r,n);for(var p=Math.round(c.dx*r),g=Math.round(c.dy*n),y=o.gZone,S=o.contours,w=0;w<y.length;w++){var C=y[w];C.xTouched=C.yTouched=!1,C.xo=C.x=C.x+p,C.yo=C.y=C.y+g}var _=s.length;s.push.apply(s,y);for(var T=0;T<S.length;T++)a.push(S[T]+_)}t.instructions&&!o.inhibitGridFit&&(o=new Id("glyf",t.instructions),o.gZone=o.z0=o.z1=o.z2=s,o.contours=a,s.push(new mc(0,0),new mc(Math.round(t.advanceWidth*r),0)),Je.DEBUG&&(console.log("---EXEC COMPOSITE---"),o.step=-1),bh(o),s.length-=2)}return s};mk=function(t,e,r,n){for(var i=t.points||[],a=i.length,s=e.gZone=e.z0=e.z1=e.z2=[],o=e.contours=[],l,u=0;u<a;u++)l=i[u],s[u]=new mc(l.x*r,l.y*n,l.lastPointOfContour,l.onCurve);for(var c,f,p=0;p<a;p++)l=s[p],c||(c=l,o.push(p)),l.lastPointOfContour?(l.nextPointOnContour=c,c.prevPointOnContour=l,c=void 0):(f=s[p+1],l.nextPointOnContour=f,f.prevPointOnContour=l);if(!e.inhibitGridFit){if(Je.DEBUG){console.log("PROCESSING GLYPH",e.stack);for(var g=0;g<a;g++)console.log(g,s[g].x,s[g].y)}if(s.push(new mc(0,0),new mc(Math.round(t.advanceWidth*r),0)),bh(e),s.length-=2,Je.DEBUG){console.log("FINISHED GLYPH",e.stack);for(var y=0;y<a;y++)console.log(y,s[y].x,s[y].y)}}};bh=function(t){var e=t.prog;if(e){var r=e.length,n;for(t.ip=0;t.ip<r;t.ip++){if(Je.DEBUG&&t.step++,n=yR[e[t.ip]],!n)throw new Error("unknown instruction: 0x"+Number(e[t.ip]).toString(16));n(t)}}};function K1(t){for(var e=t.tZone=new Array(t.gZone.length),r=0;r<e.length;r++)e[r]=new mc(0,0)}function kR(t,e){var r=t.prog,n=t.ip,i=1,a;do if(a=r[++n],a===88)i++;else if(a===89)i--;else if(a===64)n+=r[n+1]+1;else if(a===65)n+=2*r[n+1]+1;else if(a>=176&&a<=183)n+=a-176+1;else if(a>=184&&a<=191)n+=(a-184+1)*2;else if(e&&i===1&&a===27)break;while(i>0);t.ip=n}function X4(t,e){Je.DEBUG&&console.log(e.step,"SVTCA["+t.axis+"]"),e.fv=e.pv=e.dpv=t}function Q4(t,e){Je.DEBUG&&console.log(e.step,"SPVTCA["+t.axis+"]"),e.pv=e.dpv=t}function J4(t,e){Je.DEBUG&&console.log(e.step,"SFVTCA["+t.axis+"]"),e.fv=t}function e3(t,e){var r=e.stack,n=r.pop(),i=r.pop(),a=e.z2[n],s=e.z1[i];Je.DEBUG&&console.log("SPVTL["+t+"]",n,i);var o,l;t?(o=a.y-s.y,l=s.x-a.x):(o=s.x-a.x,l=s.y-a.y),e.pv=e.dpv=f0(o,l)}function t3(t,e){var r=e.stack,n=r.pop(),i=r.pop(),a=e.z2[n],s=e.z1[i];Je.DEBUG&&console.log("SFVTL["+t+"]",n,i);var o,l;t?(o=a.y-s.y,l=s.x-a.x):(o=s.x-a.x,l=s.y-a.y),e.fv=f0(o,l)}function Jq(t){var e=t.stack,r=e.pop(),n=e.pop();Je.DEBUG&&console.log(t.step,"SPVFS[]",r,n),t.pv=t.dpv=f0(n,r)}function e$(t){var e=t.stack,r=e.pop(),n=e.pop();Je.DEBUG&&console.log(t.step,"SPVFS[]",r,n),t.fv=f0(n,r)}function t$(t){var e=t.stack,r=t.pv;Je.DEBUG&&console.log(t.step,"GPV[]"),e.push(r.x*16384),e.push(r.y*16384)}function r$(t){var e=t.stack,r=t.fv;Je.DEBUG&&console.log(t.step,"GFV[]"),e.push(r.x*16384),e.push(r.y*16384)}function n$(t){t.fv=t.pv,Je.DEBUG&&console.log(t.step,"SFVTPV[]")}function i$(t){var e=t.stack,r=e.pop(),n=e.pop(),i=e.pop(),a=e.pop(),s=e.pop(),o=t.z0,l=t.z1,u=o[r],c=o[n],f=l[i],p=l[a],g=t.z2[s];Je.DEBUG&&console.log("ISECT[], ",r,n,i,a,s);var y=u.x,S=u.y,w=c.x,C=c.y,_=f.x,T=f.y,N=p.x,R=p.y,D=(y-w)*(T-R)-(S-C)*(_-N),j=y*C-S*w,O=_*R-T*N;g.x=(j*(_-N)-O*(y-w))/D,g.y=(j*(T-R)-O*(S-C))/D}function a$(t){t.rp0=t.stack.pop(),Je.DEBUG&&console.log(t.step,"SRP0[]",t.rp0)}function s$(t){t.rp1=t.stack.pop(),Je.DEBUG&&console.log(t.step,"SRP1[]",t.rp1)}function o$(t){t.rp2=t.stack.pop(),Je.DEBUG&&console.log(t.step,"SRP2[]",t.rp2)}function l$(t){var e=t.stack.pop();switch(Je.DEBUG&&console.log(t.step,"SZP0[]",e),t.zp0=e,e){case 0:t.tZone||K1(t),t.z0=t.tZone;break;case 1:t.z0=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function u$(t){var e=t.stack.pop();switch(Je.DEBUG&&console.log(t.step,"SZP1[]",e),t.zp1=e,e){case 0:t.tZone||K1(t),t.z1=t.tZone;break;case 1:t.z1=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function c$(t){var e=t.stack.pop();switch(Je.DEBUG&&console.log(t.step,"SZP2[]",e),t.zp2=e,e){case 0:t.tZone||K1(t),t.z2=t.tZone;break;case 1:t.z2=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function d$(t){var e=t.stack.pop();switch(Je.DEBUG&&console.log(t.step,"SZPS[]",e),t.zp0=t.zp1=t.zp2=e,e){case 0:t.tZone||K1(t),t.z0=t.z1=t.z2=t.tZone;break;case 1:t.z0=t.z1=t.z2=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function f$(t){t.loop=t.stack.pop(),Je.DEBUG&&console.log(t.step,"SLOOP[]",t.loop)}function h$(t){Je.DEBUG&&console.log(t.step,"RTG[]"),t.round=wR}function p$(t){Je.DEBUG&&console.log(t.step,"RTHG[]"),t.round=Zq}function m$(t){var e=t.stack.pop();Je.DEBUG&&console.log(t.step,"SMD[]",e),t.minDis=e/64}function g$(t){Je.DEBUG&&console.log(t.step,"ELSE[]"),kR(t,!1)}function v$(t){var e=t.stack.pop();Je.DEBUG&&console.log(t.step,"JMPR[]",e),t.ip+=e-1}function y$(t){var e=t.stack.pop();Je.DEBUG&&console.log(t.step,"SCVTCI[]",e),t.cvCutIn=e/64}function x$(t){var e=t.stack;Je.DEBUG&&console.log(t.step,"DUP[]"),e.push(e[e.length-1])}function $2(t){Je.DEBUG&&console.log(t.step,"POP[]"),t.stack.pop()}function b$(t){Je.DEBUG&&console.log(t.step,"CLEAR[]"),t.stack.length=0}function w$(t){var e=t.stack,r=e.pop(),n=e.pop();Je.DEBUG&&console.log(t.step,"SWAP[]"),e.push(r),e.push(n)}function S$(t){var e=t.stack;Je.DEBUG&&console.log(t.step,"DEPTH[]"),e.push(e.length)}function k$(t){var e=t.stack,r=e.pop(),n=e.pop();Je.DEBUG&&console.log(t.step,"LOOPCALL[]",r,n);var i=t.ip,a=t.prog;t.prog=t.funcs[r];for(var s=0;s<n;s++)bh(t),Je.DEBUG&&console.log(++t.step,s+1<n?"next loopcall":"done loopcall",s);t.ip=i,t.prog=a}function _$(t){var e=t.stack.pop();Je.DEBUG&&console.log(t.step,"CALL[]",e);var r=t.ip,n=t.prog;t.prog=t.funcs[e],bh(t),t.ip=r,t.prog=n,Je.DEBUG&&console.log(++t.step,"returning from",e)}function C$(t){var e=t.stack,r=e.pop();Je.DEBUG&&console.log(t.step,"CINDEX[]",r),e.push(e[e.length-r])}function E$(t){var e=t.stack,r=e.pop();Je.DEBUG&&console.log(t.step,"MINDEX[]",r),e.push(e.splice(e.length-r,1)[0])}function T$(t){if(t.env!=="fpgm")throw new Error("FDEF not allowed here");var e=t.stack,r=t.prog,n=t.ip,i=e.pop(),a=n;for(Je.DEBUG&&console.log(t.step,"FDEF[]",i);r[++n]!==45;);t.ip=n,t.funcs[i]=r.slice(a+1,n)}function r3(t,e){var r=e.stack.pop(),n=e.z0[r],i=e.fv,a=e.pv;Je.DEBUG&&console.log(e.step,"MDAP["+t+"]",r);var s=a.distance(n,Ov);t&&(s=e.round(s)),i.setRelative(n,Ov,s,a),i.touch(n),e.rp0=e.rp1=r}function n3(t,e){var r=e.z2,n=r.length-2,i,a,s;Je.DEBUG&&console.log(e.step,"IUP["+t.axis+"]");for(var o=0;o<n;o++)i=r[o],!t.touched(i)&&(a=i.prevTouched(t),a!==i&&(s=i.nextTouched(t),a===s&&t.setRelative(i,i,t.distance(a,a,!1,!0),t,!0),t.interpolate(i,a,s,t)))}function i3(t,e){for(var r=e.stack,n=t?e.rp1:e.rp2,i=(t?e.z0:e.z1)[n],a=e.fv,s=e.pv,o=e.loop,l=e.z2;o--;){var u=r.pop(),c=l[u],f=s.distance(i,i,!1,!0);a.setRelative(c,c,f,s),a.touch(c),Je.DEBUG&&console.log(e.step,(e.loop>1?"loop "+(e.loop-o)+": ":"")+"SHP["+(t?"rp1":"rp2")+"]",u)}e.loop=1}function a3(t,e){var r=e.stack,n=t?e.rp1:e.rp2,i=(t?e.z0:e.z1)[n],a=e.fv,s=e.pv,o=r.pop(),l=e.z2[e.contours[o]],u=l;Je.DEBUG&&console.log(e.step,"SHC["+t+"]",o);var c=s.distance(i,i,!1,!0);do u!==i&&a.setRelative(u,u,c,s),u=u.nextPointOnContour;while(u!==l)}function s3(t,e){var r=e.stack,n=t?e.rp1:e.rp2,i=(t?e.z0:e.z1)[n],a=e.fv,s=e.pv,o=r.pop();Je.DEBUG&&console.log(e.step,"SHZ["+t+"]",o);var l;switch(o){case 0:l=e.tZone;break;case 1:l=e.gZone;break;default:throw new Error("Invalid zone")}for(var u,c=s.distance(i,i,!1,!0),f=l.length-2,p=0;p<f;p++)u=l[p],a.setRelative(u,u,c,s)}function N$(t){for(var e=t.stack,r=t.loop,n=t.fv,i=e.pop()/64,a=t.z2;r--;){var s=e.pop(),o=a[s];Je.DEBUG&&console.log(t.step,(t.loop>1?"loop "+(t.loop-r)+": ":"")+"SHPIX[]",s,i),n.setRelative(o,o,i),n.touch(o)}t.loop=1}function P$(t){for(var e=t.stack,r=t.rp1,n=t.rp2,i=t.loop,a=t.z0[r],s=t.z1[n],o=t.fv,l=t.dpv,u=t.z2;i--;){var c=e.pop(),f=u[c];Je.DEBUG&&console.log(t.step,(t.loop>1?"loop "+(t.loop-i)+": ":"")+"IP[]",c,r,"<->",n),o.interpolate(f,a,s,l),o.touch(f)}t.loop=1}function o3(t,e){var r=e.stack,n=r.pop()/64,i=r.pop(),a=e.z1[i],s=e.z0[e.rp0],o=e.fv,l=e.pv;o.setRelative(a,s,n,l),o.touch(a),Je.DEBUG&&console.log(e.step,"MSIRP["+t+"]",n,i),e.rp1=e.rp0,e.rp2=i,t&&(e.rp0=i)}function M$(t){for(var e=t.stack,r=t.rp0,n=t.z0[r],i=t.loop,a=t.fv,s=t.pv,o=t.z1;i--;){var l=e.pop(),u=o[l];Je.DEBUG&&console.log(t.step,(t.loop>1?"loop "+(t.loop-i)+": ":"")+"ALIGNRP[]",l),a.setRelative(u,n,0,s),a.touch(u)}t.loop=1}function A$(t){Je.DEBUG&&console.log(t.step,"RTDG[]"),t.round=Kq}function l3(t,e){var r=e.stack,n=r.pop(),i=r.pop(),a=e.z0[i],s=e.fv,o=e.pv,l=e.cvt[n];Je.DEBUG&&console.log(e.step,"MIAP["+t+"]",n,"(",l,")",i);var u=o.distance(a,Ov);t&&(Math.abs(u-l)<e.cvCutIn&&(u=l),u=e.round(u)),s.setRelative(a,Ov,u,o),e.zp0===0&&(a.xo=a.x,a.yo=a.y),s.touch(a),e.rp0=e.rp1=i}function L$(t){var e=t.prog,r=t.ip,n=t.stack,i=e[++r];Je.DEBUG&&console.log(t.step,"NPUSHB[]",i);for(var a=0;a<i;a++)n.push(e[++r]);t.ip=r}function R$(t){var e=t.ip,r=t.prog,n=t.stack,i=r[++e];Je.DEBUG&&console.log(t.step,"NPUSHW[]",i);for(var a=0;a<i;a++){var s=r[++e]<<8|r[++e];s&32768&&(s=-((s^65535)+1)),n.push(s)}t.ip=e}function O$(t){var e=t.stack,r=t.store;r||(r=t.store=[]);var n=e.pop(),i=e.pop();Je.DEBUG&&console.log(t.step,"WS",n,i),r[i]=n}function D$(t){var e=t.stack,r=t.store,n=e.pop();Je.DEBUG&&console.log(t.step,"RS",n);var i=r&&r[n]||0;e.push(i)}function I$(t){var e=t.stack,r=e.pop(),n=e.pop();Je.DEBUG&&console.log(t.step,"WCVTP",r,n),t.cvt[n]=r/64}function j$(t){var e=t.stack,r=e.pop();Je.DEBUG&&console.log(t.step,"RCVT",r),e.push(t.cvt[r]*64)}function u3(t,e){var r=e.stack,n=r.pop(),i=e.z2[n];Je.DEBUG&&console.log(e.step,"GC["+t+"]",n),r.push(e.dpv.distance(i,Ov,t,!1)*64)}function c3(t,e){var r=e.stack,n=r.pop(),i=r.pop(),a=e.z1[n],s=e.z0[i],o=e.dpv.distance(s,a,t,t);Je.DEBUG&&console.log(e.step,"MD["+t+"]",n,i,"->",o),e.stack.push(Math.round(o*64))}function F$(t){Je.DEBUG&&console.log(t.step,"MPPEM[]"),t.stack.push(t.ppem)}function B$(t){Je.DEBUG&&console.log(t.step,"FLIPON[]"),t.autoFlip=!0}function z$(t){var e=t.stack,r=e.pop(),n=e.pop();Je.DEBUG&&console.log(t.step,"LT[]",r,n),e.push(n<r?1:0)}function U$(t){var e=t.stack,r=e.pop(),n=e.pop();Je.DEBUG&&console.log(t.step,"LTEQ[]",r,n),e.push(n<=r?1:0)}function G$(t){var e=t.stack,r=e.pop(),n=e.pop();Je.DEBUG&&console.log(t.step,"GT[]",r,n),e.push(n>r?1:0)}function V$(t){var e=t.stack,r=e.pop(),n=e.pop();Je.DEBUG&&console.log(t.step,"GTEQ[]",r,n),e.push(n>=r?1:0)}function H$(t){var e=t.stack,r=e.pop(),n=e.pop();Je.DEBUG&&console.log(t.step,"EQ[]",r,n),e.push(r===n?1:0)}function W$(t){var e=t.stack,r=e.pop(),n=e.pop();Je.DEBUG&&console.log(t.step,"NEQ[]",r,n),e.push(r!==n?1:0)}function q$(t){var e=t.stack,r=e.pop();Je.DEBUG&&console.log(t.step,"ODD[]",r),e.push(Math.trunc(r)%2?1:0)}function $$(t){var e=t.stack,r=e.pop();Je.DEBUG&&console.log(t.step,"EVEN[]",r),e.push(Math.trunc(r)%2?0:1)}function K$(t){var e=t.stack.pop();Je.DEBUG&&console.log(t.step,"IF[]",e),e||(kR(t,!0),Je.DEBUG&&console.log(t.step,"EIF[]"))}function Z$(t){Je.DEBUG&&console.log(t.step,"EIF[]")}function Y$(t){var e=t.stack,r=e.pop(),n=e.pop();Je.DEBUG&&console.log(t.step,"AND[]",r,n),e.push(r&&n?1:0)}function X$(t){var e=t.stack,r=e.pop(),n=e.pop();Je.DEBUG&&console.log(t.step,"OR[]",r,n),e.push(r||n?1:0)}function Q$(t){var e=t.stack,r=e.pop();Je.DEBUG&&console.log(t.step,"NOT[]",r),e.push(r?0:1)}function K2(t,e){var r=e.stack,n=r.pop(),i=e.fv,a=e.pv,s=e.ppem,o=e.deltaBase+(t-1)*16,l=e.deltaShift,u=e.z0;Je.DEBUG&&console.log(e.step,"DELTAP["+t+"]",n,r);for(var c=0;c<n;c++){var f=r.pop(),p=r.pop(),g=o+((p&240)>>4);if(g===s){var y=(p&15)-8;y>=0&&y++,Je.DEBUG&&console.log(e.step,"DELTAPFIX",f,"by",y*l);var S=u[f];i.setRelative(S,S,y*l,a)}}}function J$(t){var e=t.stack,r=e.pop();Je.DEBUG&&console.log(t.step,"SDB[]",r),t.deltaBase=r}function eK(t){var e=t.stack,r=e.pop();Je.DEBUG&&console.log(t.step,"SDS[]",r),t.deltaShift=Math.pow(.5,r)}function tK(t){var e=t.stack,r=e.pop(),n=e.pop();Je.DEBUG&&console.log(t.step,"ADD[]",r,n),e.push(n+r)}function rK(t){var e=t.stack,r=e.pop(),n=e.pop();Je.DEBUG&&console.log(t.step,"SUB[]",r,n),e.push(n-r)}function nK(t){var e=t.stack,r=e.pop(),n=e.pop();Je.DEBUG&&console.log(t.step,"DIV[]",r,n),e.push(n*64/r)}function iK(t){var e=t.stack,r=e.pop(),n=e.pop();Je.DEBUG&&console.log(t.step,"MUL[]",r,n),e.push(n*r/64)}function aK(t){var e=t.stack,r=e.pop();Je.DEBUG&&console.log(t.step,"ABS[]",r),e.push(Math.abs(r))}function sK(t){var e=t.stack,r=e.pop();Je.DEBUG&&console.log(t.step,"NEG[]",r),e.push(-r)}function oK(t){var e=t.stack,r=e.pop();Je.DEBUG&&console.log(t.step,"FLOOR[]",r),e.push(Math.floor(r/64)*64)}function lK(t){var e=t.stack,r=e.pop();Je.DEBUG&&console.log(t.step,"CEILING[]",r),e.push(Math.ceil(r/64)*64)}function Sy(t,e){var r=e.stack,n=r.pop();Je.DEBUG&&console.log(e.step,"ROUND[]"),r.push(e.round(n/64)*64)}function uK(t){var e=t.stack,r=e.pop(),n=e.pop();Je.DEBUG&&console.log(t.step,"WCVTF[]",r,n),t.cvt[n]=r*t.ppem/t.font.unitsPerEm}function Z2(t,e){var r=e.stack,n=r.pop(),i=e.ppem,a=e.deltaBase+(t-1)*16,s=e.deltaShift;Je.DEBUG&&console.log(e.step,"DELTAC["+t+"]",n,r);for(var o=0;o<n;o++){var l=r.pop(),u=r.pop(),c=a+((u&240)>>4);if(c===i){var f=(u&15)-8;f>=0&&f++;var p=f*s;Je.DEBUG&&console.log(e.step,"DELTACFIX",l,"by",p),e.cvt[l]+=p}}}function cK(t){var e=t.stack.pop();Je.DEBUG&&console.log(t.step,"SROUND[]",e),t.round=SR;var r;switch(e&192){case 0:r=.5;break;case 64:r=1;break;case 128:r=2;break;default:throw new Error("invalid SROUND value")}switch(t.srPeriod=r,e&48){case 0:t.srPhase=0;break;case 16:t.srPhase=.25*r;break;case 32:t.srPhase=.5*r;break;case 48:t.srPhase=.75*r;break;default:throw new Error("invalid SROUND value")}e&=15,e===0?t.srThreshold=0:t.srThreshold=(e/8-.5)*r}function dK(t){var e=t.stack.pop();Je.DEBUG&&console.log(t.step,"S45ROUND[]",e),t.round=SR;var r;switch(e&192){case 0:r=Math.sqrt(2)/2;break;case 64:r=Math.sqrt(2);break;case 128:r=2*Math.sqrt(2);break;default:throw new Error("invalid S45ROUND value")}switch(t.srPeriod=r,e&48){case 0:t.srPhase=0;break;case 16:t.srPhase=.25*r;break;case 32:t.srPhase=.5*r;break;case 48:t.srPhase=.75*r;break;default:throw new Error("invalid S45ROUND value")}e&=15,e===0?t.srThreshold=0:t.srThreshold=(e/8-.5)*r}function fK(t){Je.DEBUG&&console.log(t.step,"ROFF[]"),t.round=$q}function hK(t){Je.DEBUG&&console.log(t.step,"RUTG[]"),t.round=Yq}function pK(t){Je.DEBUG&&console.log(t.step,"RDTG[]"),t.round=Xq}function mK(t){var e=t.stack.pop();Je.DEBUG&&console.log(t.step,"SCANCTRL[]",e)}function d3(t,e){var r=e.stack,n=r.pop(),i=r.pop(),a=e.z2[n],s=e.z1[i];Je.DEBUG&&console.log(e.step,"SDPVTL["+t+"]",n,i);var o,l;t?(o=a.y-s.y,l=s.x-a.x):(o=s.x-a.x,l=s.y-a.y),e.dpv=f0(o,l)}function gK(t){var e=t.stack,r=e.pop(),n=0;Je.DEBUG&&console.log(t.step,"GETINFO[]",r),r&1&&(n=35),r&32&&(n|=4096),e.push(n)}function vK(t){var e=t.stack,r=e.pop(),n=e.pop(),i=e.pop();Je.DEBUG&&console.log(t.step,"ROLL[]"),e.push(n),e.push(r),e.push(i)}function yK(t){var e=t.stack,r=e.pop(),n=e.pop();Je.DEBUG&&console.log(t.step,"MAX[]",r,n),e.push(Math.max(n,r))}function xK(t){var e=t.stack,r=e.pop(),n=e.pop();Je.DEBUG&&console.log(t.step,"MIN[]",r,n),e.push(Math.min(n,r))}function bK(t){var e=t.stack.pop();Je.DEBUG&&console.log(t.step,"SCANTYPE[]",e)}function wK(t){var e=t.stack.pop(),r=t.stack.pop();switch(Je.DEBUG&&console.log(t.step,"INSTCTRL[]",e,r),e){case 1:t.inhibitGridFit=!!r;return;case 2:t.ignoreCvt=!!r;return;default:throw new Error("invalid INSTCTRL[] selector")}}function wd(t,e){var r=e.stack,n=e.prog,i=e.ip;Je.DEBUG&&console.log(e.step,"PUSHB["+t+"]");for(var a=0;a<t;a++)r.push(n[++i]);e.ip=i}function Sd(t,e){var r=e.ip,n=e.prog,i=e.stack;Je.DEBUG&&console.log(e.ip,"PUSHW["+t+"]");for(var a=0;a<t;a++){var s=n[++r]<<8|n[++r];s&32768&&(s=-((s^65535)+1)),i.push(s)}e.ip=r}function Gt(t,e,r,n,i,a){var s=a.stack,o=t&&s.pop(),l=s.pop(),u=a.rp0,c=a.z0[u],f=a.z1[l],p=a.minDis,g=a.fv,y=a.dpv,S,w,C,_;w=S=y.distance(f,c,!0,!0),C=w>=0?1:-1,w=Math.abs(w),t&&(_=a.cvt[o],n&&Math.abs(w-_)<a.cvCutIn&&(w=_)),r&&w<p&&(w=p),n&&(w=a.round(w)),g.setRelative(f,c,C*w,y),g.touch(f),Je.DEBUG&&console.log(a.step,(t?"MIRP[":"MDRP[")+(e?"M":"m")+(r?">":"_")+(n?"R":"_")+(i===0?"Gr":i===1?"Bl":i===2?"Wh":"")+"]",t?o+"("+a.cvt[o]+","+_+")":"",l,"(d =",S,"->",C*w,")"),a.rp1=a.rp0,a.rp2=l,e&&(a.rp0=l)}yR=[X4.bind(void 0,hc),X4.bind(void 0,Cu),Q4.bind(void 0,hc),Q4.bind(void 0,Cu),J4.bind(void 0,hc),J4.bind(void 0,Cu),e3.bind(void 0,0),e3.bind(void 0,1),t3.bind(void 0,0),t3.bind(void 0,1),Jq,e$,t$,r$,n$,i$,a$,s$,o$,l$,u$,c$,d$,f$,h$,p$,m$,g$,v$,y$,void 0,void 0,x$,$2,b$,w$,S$,C$,E$,void 0,void 0,void 0,k$,_$,T$,void 0,r3.bind(void 0,0),r3.bind(void 0,1),n3.bind(void 0,hc),n3.bind(void 0,Cu),i3.bind(void 0,0),i3.bind(void 0,1),a3.bind(void 0,0),a3.bind(void 0,1),s3.bind(void 0,0),s3.bind(void 0,1),N$,P$,o3.bind(void 0,0),o3.bind(void 0,1),M$,A$,l3.bind(void 0,0),l3.bind(void 0,1),L$,R$,O$,D$,I$,j$,u3.bind(void 0,0),u3.bind(void 0,1),void 0,c3.bind(void 0,0),c3.bind(void 0,1),F$,void 0,B$,void 0,void 0,z$,U$,G$,V$,H$,W$,q$,$$,K$,Z$,Y$,X$,Q$,K2.bind(void 0,1),J$,eK,tK,rK,nK,iK,aK,sK,oK,lK,Sy.bind(void 0,0),Sy.bind(void 0,1),Sy.bind(void 0,2),Sy.bind(void 0,3),void 0,void 0,void 0,void 0,uK,K2.bind(void 0,2),K2.bind(void 0,3),Z2.bind(void 0,1),Z2.bind(void 0,2),Z2.bind(void 0,3),cK,dK,void 0,void 0,fK,void 0,hK,pK,$2,$2,void 0,void 0,void 0,void 0,void 0,mK,d3.bind(void 0,0),d3.bind(void 0,1),gK,void 0,vK,yK,xK,bK,wK,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,wd.bind(void 0,1),wd.bind(void 0,2),wd.bind(void 0,3),wd.bind(void 0,4),wd.bind(void 0,5),wd.bind(void 0,6),wd.bind(void 0,7),wd.bind(void 0,8),Sd.bind(void 0,1),Sd.bind(void 0,2),Sd.bind(void 0,3),Sd.bind(void 0,4),Sd.bind(void 0,5),Sd.bind(void 0,6),Sd.bind(void 0,7),Sd.bind(void 0,8),Gt.bind(void 0,0,0,0,0,0),Gt.bind(void 0,0,0,0,0,1),Gt.bind(void 0,0,0,0,0,2),Gt.bind(void 0,0,0,0,0,3),Gt.bind(void 0,0,0,0,1,0),Gt.bind(void 0,0,0,0,1,1),Gt.bind(void 0,0,0,0,1,2),Gt.bind(void 0,0,0,0,1,3),Gt.bind(void 0,0,0,1,0,0),Gt.bind(void 0,0,0,1,0,1),Gt.bind(void 0,0,0,1,0,2),Gt.bind(void 0,0,0,1,0,3),Gt.bind(void 0,0,0,1,1,0),Gt.bind(void 0,0,0,1,1,1),Gt.bind(void 0,0,0,1,1,2),Gt.bind(void 0,0,0,1,1,3),Gt.bind(void 0,0,1,0,0,0),Gt.bind(void 0,0,1,0,0,1),Gt.bind(void 0,0,1,0,0,2),Gt.bind(void 0,0,1,0,0,3),Gt.bind(void 0,0,1,0,1,0),Gt.bind(void 0,0,1,0,1,1),Gt.bind(void 0,0,1,0,1,2),Gt.bind(void 0,0,1,0,1,3),Gt.bind(void 0,0,1,1,0,0),Gt.bind(void 0,0,1,1,0,1),Gt.bind(void 0,0,1,1,0,2),Gt.bind(void 0,0,1,1,0,3),Gt.bind(void 0,0,1,1,1,0),Gt.bind(void 0,0,1,1,1,1),Gt.bind(void 0,0,1,1,1,2),Gt.bind(void 0,0,1,1,1,3),Gt.bind(void 0,1,0,0,0,0),Gt.bind(void 0,1,0,0,0,1),Gt.bind(void 0,1,0,0,0,2),Gt.bind(void 0,1,0,0,0,3),Gt.bind(void 0,1,0,0,1,0),Gt.bind(void 0,1,0,0,1,1),Gt.bind(void 0,1,0,0,1,2),Gt.bind(void 0,1,0,0,1,3),Gt.bind(void 0,1,0,1,0,0),Gt.bind(void 0,1,0,1,0,1),Gt.bind(void 0,1,0,1,0,2),Gt.bind(void 0,1,0,1,0,3),Gt.bind(void 0,1,0,1,1,0),Gt.bind(void 0,1,0,1,1,1),Gt.bind(void 0,1,0,1,1,2),Gt.bind(void 0,1,0,1,1,3),Gt.bind(void 0,1,1,0,0,0),Gt.bind(void 0,1,1,0,0,1),Gt.bind(void 0,1,1,0,0,2),Gt.bind(void 0,1,1,0,0,3),Gt.bind(void 0,1,1,0,1,0),Gt.bind(void 0,1,1,0,1,1),Gt.bind(void 0,1,1,0,1,2),Gt.bind(void 0,1,1,0,1,3),Gt.bind(void 0,1,1,1,0,0),Gt.bind(void 0,1,1,1,0,1),Gt.bind(void 0,1,1,1,0,2),Gt.bind(void 0,1,1,1,0,3),Gt.bind(void 0,1,1,1,1,0),Gt.bind(void 0,1,1,1,1,1),Gt.bind(void 0,1,1,1,1,2),Gt.bind(void 0,1,1,1,1,3)];function vm(t){this.char=t,this.state={},this.activeState=null}function U_(t,e,r){this.contextName=r,this.startIndex=t,this.endOffset=e}function SK(t,e,r){this.contextName=t,this.openRange=null,this.ranges=[],this.checkStart=e,this.checkEnd=r}function zl(t,e){this.context=t,this.index=e,this.length=t.length,this.current=t[e],this.backtrack=t.slice(0,e),this.lookahead=t.slice(e+1)}function Z1(t){this.eventId=t,this.subscribers=[]}function kK(t){var e=this,r=["start","end","next","newToken","contextStart","contextEnd","insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD","updateContextsRanges"];r.forEach(function(i){Object.defineProperty(e.events,i,{value:new Z1(i)})}),t&&r.forEach(function(i){var a=t[i];typeof a=="function"&&e.events[i].subscribe(a)});var n=["insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD"];n.forEach(function(i){e.events[i].subscribe(e.updateContextsRanges)})}function mi(t){this.tokens=[],this.registeredContexts={},this.contextCheckers=[],this.events={},this.registeredModifiers=[],kK.call(this,t)}vm.prototype.setState=function(t,e){return this.state[t]=e,this.activeState={key:t,value:this.state[t]},this.activeState};vm.prototype.getState=function(t){return this.state[t]||null};mi.prototype.inboundIndex=function(t){return t>=0&&t<this.tokens.length};mi.prototype.composeRUD=function(t){var e=this,r=!0,n=t.map(function(a){return e[a[0]].apply(e,a.slice(1).concat(r))}),i=function(a){return typeof a=="object"&&a.hasOwnProperty("FAIL")};if(n.every(i))return{FAIL:"composeRUD: one or more operations hasn't completed successfully",report:n.filter(i)};this.dispatch("composeRUD",[n.filter(function(a){return!i(a)})])};mi.prototype.replaceRange=function(t,e,r,n){e=e!==null?e:this.tokens.length;var i=r.every(function(s){return s instanceof vm});if(!isNaN(t)&&this.inboundIndex(t)&&i){var a=this.tokens.splice.apply(this.tokens,[t,e].concat(r));return n||this.dispatch("replaceToken",[t,e,r]),[a,r]}else return{FAIL:"replaceRange: invalid tokens or startIndex."}};mi.prototype.replaceToken=function(t,e,r){if(!isNaN(t)&&this.inboundIndex(t)&&e instanceof vm){var n=this.tokens.splice(t,1,e);return r||this.dispatch("replaceToken",[t,e]),[n[0],e]}else return{FAIL:"replaceToken: invalid token or index."}};mi.prototype.removeRange=function(t,e,r){e=isNaN(e)?this.tokens.length:e;var n=this.tokens.splice(t,e);return r||this.dispatch("removeRange",[n,t,e]),n};mi.prototype.removeToken=function(t,e){if(!isNaN(t)&&this.inboundIndex(t)){var r=this.tokens.splice(t,1);return e||this.dispatch("removeToken",[r,t]),r}else return{FAIL:"removeToken: invalid token index."}};mi.prototype.insertToken=function(t,e,r){var n=t.every(function(i){return i instanceof vm});return n?(this.tokens.splice.apply(this.tokens,[e,0].concat(t)),r||this.dispatch("insertToken",[t,e]),t):{FAIL:"insertToken: invalid token(s)."}};mi.prototype.registerModifier=function(t,e,r){this.events.newToken.subscribe(function(n,i){var a=[n,i],s=e===null||e.apply(this,a)===!0,o=[n,i];if(s){var l=r.apply(this,o);n.setState(t,l)}}),this.registeredModifiers.push(t)};Z1.prototype.subscribe=function(t){return typeof t=="function"?this.subscribers.push(t)-1:{FAIL:"invalid '"+this.eventId+"' event handler"}};Z1.prototype.unsubscribe=function(t){this.subscribers.splice(t,1)};zl.prototype.setCurrentIndex=function(t){this.index=t,this.current=this.context[t],this.backtrack=this.context.slice(0,t),this.lookahead=this.context.slice(t+1)};zl.prototype.get=function(t){switch(!0){case t===0:return this.current;case(t<0&&Math.abs(t)<=this.backtrack.length):return this.backtrack.slice(t)[0];case(t>0&&t<=this.lookahead.length):return this.lookahead[t-1];default:return null}};mi.prototype.rangeToText=function(t){if(t instanceof U_)return this.getRangeTokens(t).map(function(e){return e.char}).join("")};mi.prototype.getText=function(){return this.tokens.map(function(t){return t.char}).join("")};mi.prototype.getContext=function(t){var e=this.registeredContexts[t];return e||null};mi.prototype.on=function(t,e){var r=this.events[t];return r?r.subscribe(e):null};mi.prototype.dispatch=function(t,e){var r=this,n=this.events[t];n instanceof Z1&&n.subscribers.forEach(function(i){i.apply(r,e||[])})};mi.prototype.registerContextChecker=function(t,e,r){if(this.getContext(t))return{FAIL:"context name '"+t+"' is already registered."};if(typeof e!="function")return{FAIL:"missing context start check."};if(typeof r!="function")return{FAIL:"missing context end check."};var n=new SK(t,e,r);return this.registeredContexts[t]=n,this.contextCheckers.push(n),n};mi.prototype.getRangeTokens=function(t){var e=t.startIndex+t.endOffset;return[].concat(this.tokens.slice(t.startIndex,e))};mi.prototype.getContextRanges=function(t){var e=this.getContext(t);return e?e.ranges:{FAIL:"context checker '"+t+"' is not registered."}};mi.prototype.resetContextsRanges=function(){var t=this.registeredContexts;for(var e in t)if(t.hasOwnProperty(e)){var r=t[e];r.ranges=[]}};mi.prototype.updateContextsRanges=function(){this.resetContextsRanges();for(var t=this.tokens.map(function(n){return n.char}),e=0;e<t.length;e++){var r=new zl(t,e);this.runContextCheck(r)}this.dispatch("updateContextsRanges",[this.registeredContexts])};mi.prototype.setEndOffset=function(t,e){var r=this.getContext(e).openRange.startIndex,n=new U_(r,t,e),i=this.getContext(e).ranges;return n.rangeId=e+"."+i.length,i.push(n),this.getContext(e).openRange=null,n};mi.prototype.runContextCheck=function(t){var e=this,r=t.index;this.contextCheckers.forEach(function(n){var i=n.contextName,a=e.getContext(i).openRange;if(!a&&n.checkStart(t)&&(a=new U_(r,null,i),e.getContext(i).openRange=a,e.dispatch("contextStart",[i,r])),a&&n.checkEnd(t)){var s=r-a.startIndex+1,o=e.setEndOffset(s,i);e.dispatch("contextEnd",[i,o])}})};mi.prototype.tokenize=function(t){this.tokens=[],this.resetContextsRanges();var e=Array.from(t);this.dispatch("start");for(var r=0;r<e.length;r++){var n=e[r],i=new zl(e,r);this.dispatch("next",[i]),this.runContextCheck(i);var a=new vm(n);this.tokens.push(a),this.dispatch("newToken",[a,i])}return this.dispatch("end",[this.tokens]),this.tokens};function Vd(t){return/[\u0600-\u065F\u066A-\u06D2\u06FA-\u06FF]/.test(t)}function _R(t){return/[\u0630\u0690\u0621\u0631\u0661\u0671\u0622\u0632\u0672\u0692\u06C2\u0623\u0673\u0693\u06C3\u0624\u0694\u06C4\u0625\u0675\u0695\u06C5\u06E5\u0676\u0696\u06C6\u0627\u0677\u0697\u06C7\u0648\u0688\u0698\u06C8\u0689\u0699\u06C9\u068A\u06CA\u066B\u068B\u06CB\u068C\u068D\u06CD\u06FD\u068E\u06EE\u06FE\u062F\u068F\u06CF\u06EF]/.test(t)}function ef(t){return/[\u0600-\u0605\u060C-\u060E\u0610-\u061B\u061E\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED]/.test(t)}function Xy(t){return/[A-z]/.test(t)}function _K(t){return/\s/.test(t)}function So(t){this.font=t,this.features={}}function Jf(t){this.id=t.id,this.tag=t.tag,this.substitution=t.substitution}function h0(t,e){if(!t)return-1;switch(e.format){case 1:return e.glyphs.indexOf(t);case 2:for(var r=e.ranges,n=0;n<r.length;n++){var i=r[n];if(t>=i.start&&t<=i.end){var a=t-i.start;return i.index+a}}break;default:return-1}return-1}function CK(t,e){var r=h0(t,e.coverage);return r===-1?null:t+e.deltaGlyphId}function EK(t,e){var r=h0(t,e.coverage);return r===-1?null:e.substitute[r]}function Y2(t,e){for(var r=[],n=0;n<t.length;n++){var i=t[n],a=e.current;a=Array.isArray(a)?a[0]:a;var s=h0(a,i);s!==-1&&r.push(s)}return r.length!==t.length?-1:r}function TK(t,e){var r=e.inputCoverage.length+e.lookaheadCoverage.length+e.backtrackCoverage.length;if(t.context.length<r)return[];var n=Y2(e.inputCoverage,t);if(n===-1)return[];var i=e.inputCoverage.length-1;if(t.lookahead.length<e.lookaheadCoverage.length)return[];for(var a=t.lookahead.slice(i);a.length&&ef(a[0].char);)a.shift();var s=new zl(a,0),o=Y2(e.lookaheadCoverage,s),l=[].concat(t.backtrack);for(l.reverse();l.length&&ef(l[0].char);)l.shift();if(l.length<e.backtrackCoverage.length)return[];var u=new zl(l,0),c=Y2(e.backtrackCoverage,u),f=n.length===e.inputCoverage.length&&o.length===e.lookaheadCoverage.length&&c.length===e.backtrackCoverage.length,p=[];if(f)for(var g=0;g<e.lookupRecords.length;g++)for(var y=e.lookupRecords[g],S=y.lookupListIndex,w=this.getLookupByIndex(S),C=0;C<w.subtables.length;C++){var _=w.subtables[C],T=this.getLookupMethod(w,_),N=this.getSubstitutionType(w,_);if(N==="12")for(var R=0;R<n.length;R++){var D=t.get(R),j=T(D);j&&p.push(j)}}return p}function NK(t,e){var r=t.current,n=h0(r,e.coverage);if(n===-1)return null;for(var i,a=e.ligatureSets[n],s=0;s<a.length;s++){i=a[s];for(var o=0;o<i.components.length;o++){var l=t.lookahead[o],u=i.components[o];if(l!==u)break;if(o===i.components.length-1)return i}}return null}function PK(t,e){var r=h0(t,e.coverage);return r===-1?null:e.sequences[r]}So.prototype.getDefaultScriptFeaturesIndexes=function(){for(var t=this.font.tables.gsub.scripts,e=0;e<t.length;e++){var r=t[e];if(r.tag==="DFLT")return r.script.defaultLangSys.featureIndexes}return[]};So.prototype.getScriptFeaturesIndexes=function(t){var e=this.font.tables;if(!e.gsub)return[];if(!t)return this.getDefaultScriptFeaturesIndexes();for(var r=this.font.tables.gsub.scripts,n=0;n<r.length;n++){var i=r[n];if(i.tag===t&&i.script.defaultLangSys)return i.script.defaultLangSys.featureIndexes;var a=i.langSysRecords;if(a)for(var s=0;s<a.length;s++){var o=a[s];if(o.tag===t){var l=o.langSys;return l.featureIndexes}}}return this.getDefaultScriptFeaturesIndexes()};So.prototype.mapTagsToFeatures=function(t,e){for(var r={},n=0;n<t.length;n++){var i=t[n].tag,a=t[n].feature;r[i]=a}this.features[e].tags=r};So.prototype.getScriptFeatures=function(t){var e=this.features[t];if(this.features.hasOwnProperty(t))return e;var r=this.getScriptFeaturesIndexes(t);if(!r)return null;var n=this.font.tables.gsub;return e=r.map(function(i){return n.features[i]}),this.features[t]=e,this.mapTagsToFeatures(e,t),e};So.prototype.getSubstitutionType=function(t,e){var r=t.lookupType.toString(),n=e.substFormat.toString();return r+n};So.prototype.getLookupMethod=function(t,e){var r=this,n=this.getSubstitutionType(t,e);switch(n){case"11":return function(i){return CK.apply(r,[i,e])};case"12":return function(i){return EK.apply(r,[i,e])};case"63":return function(i){return TK.apply(r,[i,e])};case"41":return function(i){return NK.apply(r,[i,e])};case"21":return function(i){return PK.apply(r,[i,e])};default:throw new Error("lookupType: "+t.lookupType+" - substFormat: "+e.substFormat+" is not yet supported")}};So.prototype.lookupFeature=function(t){var e=t.contextParams,r=e.index,n=this.getFeature({tag:t.tag,script:t.script});if(!n)return new Error("font '"+this.font.names.fullName.en+"' doesn't support feature '"+t.tag+"' for script '"+t.script+"'.");for(var i=this.getFeatureLookups(n),a=[].concat(e.context),s=0;s<i.length;s++)for(var o=i[s],l=this.getLookupSubtables(o),u=0;u<l.length;u++){var c=l[u],f=this.getSubstitutionType(o,c),p=this.getLookupMethod(o,c),g=void 0;switch(f){case"11":g=p(e.current),g&&a.splice(r,1,new Jf({id:11,tag:t.tag,substitution:g}));break;case"12":g=p(e.current),g&&a.splice(r,1,new Jf({id:12,tag:t.tag,substitution:g}));break;case"63":g=p(e),Array.isArray(g)&&g.length&&a.splice(r,1,new Jf({id:63,tag:t.tag,substitution:g}));break;case"41":g=p(e),g&&a.splice(r,1,new Jf({id:41,tag:t.tag,substitution:g}));break;case"21":g=p(e.current),g&&a.splice(r,1,new Jf({id:21,tag:t.tag,substitution:g}));break}e=new zl(a,r),!(Array.isArray(g)&&!g.length)&&(g=null)}return a.length?a:null};So.prototype.supports=function(t){if(!t.script)return!1;this.getScriptFeatures(t.script);var e=this.features.hasOwnProperty(t.script);if(!t.tag)return e;var r=this.features[t.script].some(function(n){return n.tag===t.tag});return e&&r};So.prototype.getLookupSubtables=function(t){return t.subtables||null};So.prototype.getLookupByIndex=function(t){var e=this.font.tables.gsub.lookups;return e[t]||null};So.prototype.getFeatureLookups=function(t){return t.lookupListIndexes.map(this.getLookupByIndex.bind(this))};So.prototype.getFeature=function(e){if(!this.font)return{FAIL:"No font was found"};this.features.hasOwnProperty(e.script)||this.getScriptFeatures(e.script);var r=this.features[e.script];return r?r.tags[e.tag]?this.features[e.script].tags[e.tag]:null:{FAIL:"No feature for script "+e.script}};function MK(t){var e=t.current,r=t.get(-1);return r===null&&Vd(e)||!Vd(r)&&Vd(e)}function AK(t){var e=t.get(1);return e===null||!Vd(e)}var LK={startCheck:MK,endCheck:AK};function RK(t){var e=t.current,r=t.get(-1);return(Vd(e)||ef(e))&&!Vd(r)}function OK(t){var e=t.get(1);switch(!0){case e===null:return!0;case(!Vd(e)&&!ef(e)):var r=_K(e);if(!r)return!0;if(r){var n=!1;if(n=t.lookahead.some(function(i){return Vd(i)||ef(i)}),!n)return!0}break;default:return!1}}var DK={startCheck:RK,endCheck:OK};function IK(t,e,r){e[r].setState(t.tag,t.substitution)}function jK(t,e,r){e[r].setState(t.tag,t.substitution)}function FK(t,e,r){t.substitution.forEach(function(n,i){var a=e[r+i];a.setState(t.tag,n)})}function BK(t,e,r){var n=e[r];n.setState(t.tag,t.substitution.ligGlyph);for(var i=t.substitution.components.length,a=0;a<i;a++)n=e[r+a+1],n.setState("deleted",!0)}var f3={11:IK,12:jK,63:FK,41:BK};function G_(t,e,r){t instanceof Jf&&f3[t.id]&&f3[t.id](t,e,r)}function zK(t){for(var e=[].concat(t.backtrack),r=e.length-1;r>=0;r--){var n=e[r],i=_R(n),a=ef(n);if(!i&&!a)return!0;if(i)return!1}return!1}function UK(t){if(_R(t.current))return!1;for(var e=0;e<t.lookahead.length;e++){var r=t.lookahead[e],n=ef(r);if(!n)return!0}return!1}function GK(t){var e=this,r="arab",n=this.featuresTags[r],i=this.tokenizer.getRangeTokens(t);if(i.length!==1){var a=new zl(i.map(function(o){return o.getState("glyphIndex")}),0),s=new zl(i.map(function(o){return o.char}),0);i.forEach(function(o,l){if(!ef(o.char)){a.setCurrentIndex(l),s.setCurrentIndex(l);var u=0;zK(s)&&(u|=1),UK(s)&&(u|=2);var c;switch(u){case 1:c="fina";break;case 2:c="init";break;case 3:c="medi";break}if(n.indexOf(c)!==-1){var f=e.query.lookupFeature({tag:c,script:r,contextParams:a});if(f instanceof Error)return console.info(f.message);f.forEach(function(p,g){p instanceof Jf&&(G_(p,i,g),a.context[g]=p.substitution)})}}})}}function h3(t,e){var r=t.map(function(n){return n.activeState.value});return new zl(r,0)}function VK(t){var e=this,r="arab",n=this.tokenizer.getRangeTokens(t),i=h3(n);i.context.forEach(function(a,s){i.setCurrentIndex(s);var o=e.query.lookupFeature({tag:"rlig",script:r,contextParams:i});o.length&&(o.forEach(function(l){return G_(l,n,s)}),i=h3(n))})}function HK(t){var e=t.current,r=t.get(-1);return r===null&&Xy(e)||!Xy(r)&&Xy(e)}function WK(t){var e=t.get(1);return e===null||!Xy(e)}var qK={startCheck:HK,endCheck:WK};function p3(t,e){var r=t.map(function(n){return n.activeState.value});return new zl(r,0)}function $K(t){var e=this,r="latn",n=this.tokenizer.getRangeTokens(t),i=p3(n);i.context.forEach(function(a,s){i.setCurrentIndex(s);var o=e.query.lookupFeature({tag:"liga",script:r,contextParams:i});o.length&&(o.forEach(function(l){return G_(l,n,s)}),i=p3(n))})}function Gl(t){this.baseDir=t||"ltr",this.tokenizer=new mi,this.featuresTags={}}Gl.prototype.setText=function(t){this.text=t};Gl.prototype.contextChecks={latinWordCheck:qK,arabicWordCheck:LK,arabicSentenceCheck:DK};function X2(t){var e=this.contextChecks[t+"Check"];return this.tokenizer.registerContextChecker(t,e.startCheck,e.endCheck)}function KK(){return X2.call(this,"latinWord"),X2.call(this,"arabicWord"),X2.call(this,"arabicSentence"),this.tokenizer.tokenize(this.text)}function ZK(){var t=this,e=this.tokenizer.getContextRanges("arabicSentence");e.forEach(function(r){var n=t.tokenizer.getRangeTokens(r);t.tokenizer.replaceRange(r.startIndex,r.endOffset,n.reverse())})}Gl.prototype.registerFeatures=function(t,e){var r=this,n=e.filter(function(i){return r.query.supports({script:t,tag:i})});this.featuresTags.hasOwnProperty(t)?this.featuresTags[t]=this.featuresTags[t].concat(n):this.featuresTags[t]=n};Gl.prototype.applyFeatures=function(t,e){if(!t)throw new Error("No valid font was provided to apply features");this.query||(this.query=new So(t));for(var r=0;r<e.length;r++){var n=e[r];this.query.supports({script:n.script})&&this.registerFeatures(n.script,n.tags)}};Gl.prototype.registerModifier=function(t,e,r){this.tokenizer.registerModifier(t,e,r)};function V_(){if(this.tokenizer.registeredModifiers.indexOf("glyphIndex")===-1)throw new Error("glyphIndex modifier is required to apply arabic presentation features.")}function YK(){var t=this,e="arab";if(this.featuresTags.hasOwnProperty(e)){V_.call(this);var r=this.tokenizer.getContextRanges("arabicWord");r.forEach(function(n){GK.call(t,n)})}}function XK(){var t=this,e="arab";if(this.featuresTags.hasOwnProperty(e)){var r=this.featuresTags[e];if(r.indexOf("rlig")!==-1){V_.call(this);var n=this.tokenizer.getContextRanges("arabicWord");n.forEach(function(i){VK.call(t,i)})}}}function QK(){var t=this,e="latn";if(this.featuresTags.hasOwnProperty(e)){var r=this.featuresTags[e];if(r.indexOf("liga")!==-1){V_.call(this);var n=this.tokenizer.getContextRanges("latinWord");n.forEach(function(i){$K.call(t,i)})}}}Gl.prototype.checkContextReady=function(t){return!!this.tokenizer.getContext(t)};Gl.prototype.applyFeaturesToContexts=function(){this.checkContextReady("arabicWord")&&(YK.call(this),XK.call(this)),this.checkContextReady("latinWord")&&QK.call(this),this.checkContextReady("arabicSentence")&&ZK.call(this)};Gl.prototype.processText=function(t){(!this.text||this.text!==t)&&(this.setText(t),KK.call(this),this.applyFeaturesToContexts())};Gl.prototype.getBidiText=function(t){return this.processText(t),this.tokenizer.getText()};Gl.prototype.getTextGlyphs=function(t){this.processText(t);for(var e=[],r=0;r<this.tokenizer.tokens.length;r++){var n=this.tokenizer.tokens[r];if(!n.state.deleted){var i=n.activeState.value;e.push(Array.isArray(i)?i[0]:i)}}return e};function An(t){t=t||{},t.tables=t.tables||{},t.empty||(zg(t.familyName,"When creating a new Font object, familyName is required."),zg(t.styleName,"When creating a new Font object, styleName is required."),zg(t.unitsPerEm,"When creating a new Font object, unitsPerEm is required."),zg(t.ascender,"When creating a new Font object, ascender is required."),zg(t.descender<=0,"When creating a new Font object, negative descender value is required."),this.names={fontFamily:{en:t.familyName||" "},fontSubfamily:{en:t.styleName||" "},fullName:{en:t.fullName||t.familyName+" "+t.styleName},postScriptName:{en:t.postScriptName||(t.familyName+t.styleName).replace(/\s/g,"")},designer:{en:t.designer||" "},designerURL:{en:t.designerURL||" "},manufacturer:{en:t.manufacturer||" "},manufacturerURL:{en:t.manufacturerURL||" "},license:{en:t.license||" "},licenseURL:{en:t.licenseURL||" "},version:{en:t.version||"Version 0.1"},description:{en:t.description||" "},copyright:{en:t.copyright||" "},trademark:{en:t.trademark||" "}},this.unitsPerEm=t.unitsPerEm||1e3,this.ascender=t.ascender,this.descender=t.descender,this.createdTimestamp=t.createdTimestamp,this.tables=Object.assign(t.tables,{os2:Object.assign({usWeightClass:t.weightClass||this.usWeightClasses.MEDIUM,usWidthClass:t.widthClass||this.usWidthClasses.MEDIUM,fsSelection:t.fsSelection||this.fsSelectionValues.REGULAR},t.tables.os2)})),this.supported=!0,this.glyphs=new Eu.GlyphSet(this,t.glyphs||[]),this.encoding=new tR(this),this.position=new c0(this),this.substitution=new wo(this),this.tables=this.tables||{},this._push=null,this._hmtxTableData={},Object.defineProperty(this,"hinting",{get:function(){if(this._hinting)return this._hinting;if(this.outlinesFormat==="truetype")return this._hinting=new bR(this)}})}An.prototype.hasChar=function(t){return this.encoding.charToGlyphIndex(t)!==null};An.prototype.charToGlyphIndex=function(t){return this.encoding.charToGlyphIndex(t)};An.prototype.charToGlyph=function(t){var e=this.charToGlyphIndex(t),r=this.glyphs.get(e);return r||(r=this.glyphs.get(0)),r};An.prototype.updateFeatures=function(t){return this.defaultRenderOptions.features.map(function(e){return e.script==="latn"?{script:"latn",tags:e.tags.filter(function(r){return t[r]})}:e})};An.prototype.stringToGlyphs=function(t,e){var r=this,n=new Gl,i=function(f){return r.charToGlyphIndex(f.char)};n.registerModifier("glyphIndex",null,i);var a=e?this.updateFeatures(e.features):this.defaultRenderOptions.features;n.applyFeatures(this,a);for(var s=n.getTextGlyphs(t),o=s.length,l=new Array(o),u=this.glyphs.get(0),c=0;c<o;c+=1)l[c]=this.glyphs.get(s[c])||u;return l};An.prototype.nameToGlyphIndex=function(t){return this.glyphNames.nameToGlyphIndex(t)};An.prototype.nameToGlyph=function(t){var e=this.nameToGlyphIndex(t),r=this.glyphs.get(e);return r||(r=this.glyphs.get(0)),r};An.prototype.glyphIndexToName=function(t){return this.glyphNames.glyphIndexToName?this.glyphNames.glyphIndexToName(t):""};An.prototype.getKerningValue=function(t,e){t=t.index||t,e=e.index||e;var r=this.position.defaultKerningTables;return r?this.position.getKerningValue(r,t,e):this.kerningPairs[t+","+e]||0};An.prototype.defaultRenderOptions={kerning:!0,features:[{script:"arab",tags:["init","medi","fina","rlig"]},{script:"latn",tags:["liga","rlig"]}]};An.prototype.forEachGlyph=function(t,e,r,n,i,a){e=e!==void 0?e:0,r=r!==void 0?r:0,n=n!==void 0?n:72,i=Object.assign({},this.defaultRenderOptions,i);var s=1/this.unitsPerEm*n,o=this.stringToGlyphs(t,i),l;if(i.kerning){var u=i.script||this.position.getDefaultScriptName();l=this.position.getKerningTables(u,i.language)}for(var c=0;c<o.length;c+=1){var f=o[c];if(a.call(this,f,e,r,n,i),f.advanceWidth&&(e+=f.advanceWidth*s),i.kerning&&c<o.length-1){var p=l?this.position.getKerningValue(l,f.index,o[c+1].index):this.getKerningValue(f,o[c+1]);e+=p*s}i.letterSpacing?e+=i.letterSpacing*n:i.tracking&&(e+=i.tracking/1e3*n)}return e};An.prototype.getPath=function(t,e,r,n,i){var a=new $i;return this.forEachGlyph(t,e,r,n,i,function(s,o,l,u){var c=s.getPath(o,l,u,i,this);a.extend(c)}),a};An.prototype.getPaths=function(t,e,r,n,i){var a=[];return this.forEachGlyph(t,e,r,n,i,function(s,o,l,u){var c=s.getPath(o,l,u,i,this);a.push(c)}),a};An.prototype.getAdvanceWidth=function(t,e,r){return this.forEachGlyph(t,0,0,e,r,function(){})};An.prototype.draw=function(t,e,r,n,i,a){this.getPath(e,r,n,i,a).draw(t)};An.prototype.drawPoints=function(t,e,r,n,i,a){this.forEachGlyph(e,r,n,i,a,function(s,o,l,u){s.drawPoints(t,o,l,u)})};An.prototype.drawMetrics=function(t,e,r,n,i,a){this.forEachGlyph(e,r,n,i,a,function(s,o,l,u){s.drawMetrics(t,o,l,u)})};An.prototype.getEnglishName=function(t){var e=this.names[t];if(e)return e.en};An.prototype.validate=function(){var t=this;function e(n,i){}function r(n){var i=t.getEnglishName(n);i&&i.trim().length>0}r("fontFamily"),r("weightName"),r("manufacturer"),r("copyright"),r("version"),this.unitsPerEm>0};An.prototype.toTables=function(){return Fq.fontToTable(this)};An.prototype.toBuffer=function(){return console.warn("Font.toBuffer is deprecated. Use Font.toArrayBuffer instead."),this.toArrayBuffer()};An.prototype.toArrayBuffer=function(){for(var t=this.toTables(),e=t.encode(),r=new ArrayBuffer(e.length),n=new Uint8Array(r),i=0;i<e.length;i++)n[i]=e[i];return r};An.prototype.download=function(t){var e=this.getEnglishName("fontFamily"),r=this.getEnglishName("fontSubfamily");t=t||e.replace(/\s/g,"")+"-"+r+".otf";var n=this.toArrayBuffer();if(zq())if(window.URL=window.URL||window.webkitURL,window.URL){var i=new DataView(n),a=new Blob([i],{type:"font/opentype"}),s=document.createElement("a");s.href=window.URL.createObjectURL(a),s.download=t;var o=document.createEvent("MouseEvents");o.initEvent("click",!0,!1),s.dispatchEvent(o)}else console.warn("Font file could not be downloaded. Try using a different browser.");else{var l=require("fs"),u=Uq(n);l.writeFileSync(t,u)}};An.prototype.fsSelectionValues={ITALIC:1,UNDERSCORE:2,NEGATIVE:4,OUTLINED:8,STRIKEOUT:16,BOLD:32,REGULAR:64,USER_TYPO_METRICS:128,WWS:256,OBLIQUE:512};An.prototype.usWidthClasses={ULTRA_CONDENSED:1,EXTRA_CONDENSED:2,CONDENSED:3,SEMI_CONDENSED:4,MEDIUM:5,SEMI_EXPANDED:6,EXPANDED:7,EXTRA_EXPANDED:8,ULTRA_EXPANDED:9};An.prototype.usWeightClasses={THIN:100,EXTRA_LIGHT:200,LIGHT:300,NORMAL:400,MEDIUM:500,SEMI_BOLD:600,BOLD:700,EXTRA_BOLD:800,BLACK:900};var _c=new Array(10);_c[1]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{posFormat:1,coverage:this.parsePointer(We.coverage),value:this.parseValueRecord()};if(r===2)return{posFormat:2,coverage:this.parsePointer(We.coverage),values:this.parseValueRecordList()};mr.assert(!1,"0x"+e.toString(16)+": GPOS lookup type 1 format must be 1 or 2.")};_c[2]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();mr.assert(r===1||r===2,"0x"+e.toString(16)+": GPOS lookup type 2 format must be 1 or 2.");var n=this.parsePointer(We.coverage),i=this.parseUShort(),a=this.parseUShort();if(r===1)return{posFormat:r,coverage:n,valueFormat1:i,valueFormat2:a,pairSets:this.parseList(We.pointer(We.list(function(){return{secondGlyph:this.parseUShort(),value1:this.parseValueRecord(i),value2:this.parseValueRecord(a)}})))};if(r===2){var s=this.parsePointer(We.classDef),o=this.parsePointer(We.classDef),l=this.parseUShort(),u=this.parseUShort();return{posFormat:r,coverage:n,valueFormat1:i,valueFormat2:a,classDef1:s,classDef2:o,class1Count:l,class2Count:u,classRecords:this.parseList(l,We.list(u,function(){return{value1:this.parseValueRecord(i),value2:this.parseValueRecord(a)}}))}}};_c[3]=function(){return{error:"GPOS Lookup 3 not supported"}};_c[4]=function(){return{error:"GPOS Lookup 4 not supported"}};_c[5]=function(){return{error:"GPOS Lookup 5 not supported"}};_c[6]=function(){return{error:"GPOS Lookup 6 not supported"}};_c[7]=function(){return{error:"GPOS Lookup 7 not supported"}};_c[8]=function(){return{error:"GPOS Lookup 8 not supported"}};_c[9]=function(){return{error:"GPOS Lookup 9 not supported"}};new Array(10);const JK=({stageRef:t,layers:e,selectedShapeId:r,onSelectShape:n,onChangeShape:i,tool:a,color:s,strokeWidth:o,lineCap:l,onDrawEnd:u})=>{const c=ne.useRef(!1),[f,p]=Qt.useState(null),g=N=>{const R=N.target.getStage(),D=R.getRelativePointerPosition();if(a==="select"){if(N.target===R)n(null),p({x1:D.x,y1:D.y,x2:D.x,y2:D.y});else{const O=N.target;O.name()==="shape"&&n(O.id())}return}c.current=!0,u("START",{tool:a,pos:D,stroke:s,strokeWidth:o,lineCap:l})},y=N=>{const D=N.target.getStage().getRelativePointerPosition();if(a==="select"&&f){p(j=>({...j,x2:D.x,y2:D.y}));return}c.current&&u("MOVE",{pos:D})},S=N=>{if(a==="select"&&f){const R=Math.min(f.x1,f.x2),D=Math.min(f.y1,f.y2),j=Math.abs(f.x1-f.x2),O=Math.abs(f.y1-f.y2);if(j>5&&O>5){const G=N.target.getStage().find(".shape").filter(Z=>{const I=Z.getClientRect();return I.x>=R&&I.y>=D&&I.x+I.width<=R+j&&I.y+I.height<=D+O});n(G.map(Z=>Z.id()))}p(null)}c.current=!1,u("END")},w=ne.useRef(null),[C,_]=Qt.useState({width:0,height:0});Qt.useLayoutEffect(()=>{const N=()=>{w.current&&_({width:w.current.offsetWidth,height:w.current.offsetHeight})};return window.addEventListener("resize",N),N(),()=>window.removeEventListener("resize",N)},[]);const T=Array.isArray(r);return m.jsxs("div",{ref:w,className:"w-full h-full bg-[#050B0D] relative overflow-hidden flex items-center justify-center",children:[m.jsx("div",{className:"absolute inset-0 opacity-10",style:{backgroundImage:"radial-gradient(#00E5FF 1px, transparent 1px)",backgroundSize:"20px 20px"}}),m.jsxs(GL,{width:C.width,height:C.height,ref:t,onMouseDown:g,onMouseMove:y,onMouseUp:S,className:"bg-black/20 shadow-2xl border border-white/5",children:[e.slice().reverse().map(N=>N.visible&&m.jsx(Sx,{children:N.shapes.map(R=>{T?r.includes(R.id):R.id;const D={...R,name:"shape",id:R.id,onClick:()=>a==="select"&&!N.locked&&n(R.id),onTap:()=>a==="select"&&!N.locked&&n(R.id),draggable:a==="select"&&!N.locked,onDragEnd:j=>{i(R.id,{x:j.target.x(),y:j.target.y()})},onTransformEnd:j=>{const O=j.target,F={x:O.x(),y:O.y(),scaleX:O.scaleX(),scaleY:O.scaleY(),rotation:O.rotation()};R.type==="rect"&&(F.width=O.width()*O.scaleX(),F.height=O.height()*O.scaleY(),F.scaleX=1,F.scaleY=1),i(R.id,F)}};return m.jsxs(Qt.Fragment,{children:[R.type==="line"&&m.jsx(zL,{...D,lineCap:R.lineCap||"round",lineJoin:R.lineJoin||"round",tension:R.tension||0}),R.type==="path"&&m.jsx(kH,{...D,data:R.data,fill:R.fill||"#00E5FF",stroke:R.stroke||"#00E5FF"}),R.type==="rect"&&m.jsx(kx,{...D}),R.type==="circle"&&m.jsx(bH,{...D})]},R.id)})},N.id)),m.jsxs(Sx,{children:[f&&m.jsx(kx,{x:Math.min(f.x1,f.x2),y:Math.min(f.y1,f.y2),width:Math.abs(f.x1-f.x2),height:Math.abs(f.y1-f.y2),fill:"rgba(0, 229, 255, 0.1)",stroke:"#00E5FF",strokeWidth:1,dash:[5,5]}),a==="select"&&r&&m.jsx(eZ,{selectedShapeIds:T?r:[r]})]})]})]})},eZ=({selectedShapeIds:t})=>{const e=ne.useRef();return ne.useEffect(()=>{if(e.current){const r=e.current.getStage(),n=t.map(i=>r.findOne("#"+i)).filter(Boolean);e.current.nodes(n),e.current.getLayer().batchDraw()}},[t]),m.jsx(UL,{ref:e,boundBoxFunc:(r,n)=>n.width<5||n.height<5?r:n,borderStroke:"#00E5FF",anchorStroke:"#00E5FF",anchorFill:"#050B0D",anchorSize:8})},tZ=({tool:t,setTool:e,strokeWidth:r,setStrokeWidth:n,color:i,setColor:a,opacity:s,setOpacity:o,lineCap:l,setLineCap:u,strokeStyle:c,setStrokeStyle:f,layers:p,activeLayerId:g,setActiveLayerId:y,onToggleLayerVisibility:S,onToggleLayerLock:w,onAddLayer:C,onDeleteLayer:_,activeShape:T,onSetProperty:N,onUndo:R,onRedo:D,onClear:j})=>m.jsxs("div",{className:"flex flex-col h-full gap-8 p-6 text-slate-300",children:[m.jsxs("section",{className:"bg-white/5 rounded-2xl p-4 grid grid-cols-4 gap-2",children:[[{id:"select",icon:"near_me",label:"Select"},{id:"brush",icon:"gesture",label:"Brush"},{id:"line",icon:"horizontal_rule",label:"Line"},{id:"rect",icon:"rectangle",label:"Box"},{id:"circle",icon:"circle",label:"Circle"},{id:"eraser",icon:"ink_eraser",label:"Erase"}].map(O=>m.jsx("button",{onClick:()=>e(O.id),className:`aspect-square rounded-xl flex flex-col items-center justify-center gap-1 transition-all ${t===O.id?"bg-primary text-white shadow-[0_0_15px_rgba(0,229,255,0.4)]":"text-slate-400 hover:text-white hover:bg-white/10"}`,title:O.label,children:m.jsx("span",{className:"material-symbols-outlined text-xl",children:O.icon})},O.id)),m.jsx("button",{onClick:R,className:"aspect-square rounded-xl flex items-center justify-center text-slate-500 hover:text-white hover:bg-white/10",title:"Undo",children:m.jsx("span",{className:"material-symbols-outlined text-xl",children:"undo"})}),m.jsx("button",{onClick:D,className:"aspect-square rounded-xl flex items-center justify-center text-slate-500 hover:text-white hover:bg-white/10",title:"Redo",children:m.jsx("span",{className:"material-symbols-outlined text-xl",children:"redo"})}),m.jsx("button",{onClick:j,className:"aspect-square rounded-xl flex items-center justify-center text-slate-500 hover:text-red-400 hover:bg-red-400/10",title:"Clear Canvas",children:m.jsx("span",{className:"material-symbols-outlined text-xl",children:"delete_sweep"})})]}),m.jsxs("section",{className:"space-y-6",children:[m.jsx("h3",{className:"text-xs font-black uppercase tracking-[0.2em] text-primary/60 border-b border-white/5 pb-2",children:"Propiedades"}),m.jsxs("div",{className:"space-y-3",children:[m.jsxs("div",{className:"flex justify-between text-[10px] uppercase font-bold text-slate-500",children:[m.jsx("span",{children:"Grosor de Trazo"}),m.jsxs("span",{children:[r,"px"]})]}),m.jsx("input",{type:"range",min:"1",max:"50",value:r,onChange:O=>n(parseInt(O.target.value)),className:"w-full accent-primary h-1 bg-white/10 rounded-full appearance-none cursor-pointer"})]}),m.jsxs("div",{className:"space-y-3",children:[m.jsxs("div",{className:"flex justify-between text-[10px] uppercase font-bold text-slate-500",children:[m.jsx("span",{children:"Opacidad"}),m.jsxs("span",{children:[Math.round(s*100),"%"]})]}),m.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:s,onChange:O=>o(parseFloat(O.target.value)),className:"w-full accent-primary h-1 bg-white/10 rounded-full appearance-none cursor-pointer"})]}),m.jsxs("div",{className:"space-y-3",children:[m.jsx("span",{className:"text-[10px] uppercase font-bold text-slate-500",children:"Color / Relleno"}),m.jsxs("div",{className:"flex items-center gap-3 p-2 bg-white/5 rounded-lg border border-white/5",children:[m.jsx("input",{type:"color",value:i,onChange:O=>a(O.target.value),className:"size-8 rounded cursor-pointer bg-transparent border-none"}),m.jsx("span",{className:"text-xs font-mono text-primary",children:i})]})]}),m.jsxs("div",{className:"space-y-3",children:[m.jsx("span",{className:"text-[10px] uppercase font-bold text-slate-500",children:"Terminacin (Cap)"}),m.jsx("div",{className:"flex bg-white/5 rounded-lg p-1",children:["butt","round","square"].map(O=>m.jsx("button",{onClick:()=>u(O),className:`flex-1 py-1 rounded text-[10px] uppercase transition-all ${l===O?"bg-primary text-white shadow-lg font-black":"hover:text-white text-slate-500"}`,children:O==="round"?"":O==="square"?"":"|"},O))})]}),m.jsxs("div",{className:"space-y-3",children:[m.jsx("span",{className:"text-[10px] uppercase font-bold text-slate-500",children:"Estilo de Trazo"}),m.jsx("div",{className:"flex bg-white/5 rounded-lg p-1",children:[{id:"linear",label:"Lnea",icon:"segment"},{id:"points",label:"Puntos",icon:"more_horiz"},{id:"quadratic",label:"Curva",icon:"conversion_path"}].map(O=>m.jsx("button",{onClick:()=>f(O.id),className:`flex-1 py-1.5 rounded flex items-center justify-center gap-2 text-[9px] uppercase transition-all ${c===O.id?"bg-primary text-white shadow-lg font-black":"hover:text-white text-slate-500"}`,title:O.label,children:m.jsx("span",{className:"material-symbols-outlined text-xs",children:O.icon})},O.id))})]})]}),m.jsxs("section",{className:"flex-1 flex flex-col min-h-0 space-y-4",children:[m.jsxs("div",{className:"flex items-center justify-between border-b border-white/5 pb-2",children:[m.jsx("h3",{className:"text-xs font-black uppercase tracking-[0.2em] text-primary/60",children:"Capas"}),m.jsx("button",{onClick:C,className:"size-6 flex items-center justify-center rounded bg-white/5 hover:bg-primary hover:text-white transition-colors",title:"Nueva Capa",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"add"})})]}),m.jsx("div",{className:"flex-1 overflow-y-auto space-y-2 pr-2 custom-scrollbar",children:p.slice().reverse().map(O=>m.jsxs("div",{onClick:()=>y(O.id),className:`group flex items-center gap-3 p-3 rounded-lg border transition-all cursor-pointer ${g===O.id?"bg-primary/10 border-primary/50":"bg-white/5 border-transparent hover:border-white/10"}`,children:[m.jsx("button",{onClick:F=>{F.stopPropagation(),S(O.id)},className:`text-slate-500 hover:text-white ${!O.visible&&"opacity-30"}`,children:m.jsx("span",{className:"material-symbols-outlined text-base",children:O.visible?"visibility":"visibility_off"})}),m.jsxs("div",{className:"flex-1 flex flex-col",children:[m.jsx("span",{className:`text-xs font-bold leading-none ${g===O.id?"text-white":"text-slate-400"}`,children:O.name}),m.jsxs("span",{className:"text-[9px] font-black uppercase text-slate-600 mt-1",children:[O.shapes.length," Objetos"]})]}),m.jsxs("div",{className:"flex items-center gap-1",children:[m.jsx("button",{onClick:F=>{F.stopPropagation(),w(O.id)},className:`text-slate-500 hover:text-white p-1 rounded hover:bg-white/5 ${O.locked?"text-red-400 opacity-100":"opacity-0 group-hover:opacity-100"}`,children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:O.locked?"lock":"lock_open"})}),m.jsx("button",{onClick:F=>{F.stopPropagation(),_(O.id)},className:"p-1 text-slate-500 hover:text-red-400 opacity-0 group-hover:opacity-100 rounded hover:bg-white/5",title:"Eliminar Capa",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})})]})]},O.id))})]})]}),rZ=({stats:t,langName:e,glyphs:r=[],rules:n=[],onEditGlyph:i,onCreateGlyph:a,onCreateRule:s,onViewAllGlyphs:o})=>{const{t:l}=Ps();return m.jsxs("div",{className:"h-full flex flex-col p-4 space-y-6 animate-in fade-in slide-in-from-right-4 overflow-y-auto custom-scrollbar",children:[m.jsxs("div",{className:"flex items-center gap-3 text-slate-400 shrink-0",children:[m.jsx("span",{className:"material-symbols-outlined",children:"translate"}),m.jsx("h3",{className:"text-xs font-black uppercase tracking-widest",children:e||"Language"})]}),m.jsxs("div",{className:"grid grid-cols-3 gap-2 shrink-0",children:[m.jsxs("div",{className:"bg-[#1a1a20] border border-white/5 p-2 rounded-xl text-center",children:[m.jsx("div",{className:"text-xl font-serif text-white font-bold",children:t?.words||0}),m.jsx("div",{className:"text-[8px] text-slate-500 uppercase tracking-widest",children:"Words"})]}),m.jsxs("div",{className:"bg-[#1a1a20] border border-white/5 p-2 rounded-xl text-center",children:[m.jsx("div",{className:"text-xl font-serif text-white font-bold",children:t?.rules||0}),m.jsx("div",{className:"text-[8px] text-slate-500 uppercase tracking-widest",children:"Rules"})]}),m.jsxs("div",{className:"bg-[#1a1a20] border border-white/5 p-2 rounded-xl text-center",children:[m.jsx("div",{className:"text-xl font-serif text-white font-bold",children:t?.glyphs||0}),m.jsx("div",{className:"text-[8px] text-slate-500 uppercase tracking-widest",children:"Glyphs"})]})]}),m.jsx("div",{className:"h-px bg-white/5 my-2 shrink-0"}),m.jsxs("section",{className:"space-y-4 shrink-0",children:[m.jsxs("div",{className:"flex justify-between items-center",children:[m.jsx("h4",{className:"text-[10px] font-black uppercase tracking-widest text-slate-500",children:l("linguistics.writing_system")||"WRITING SYSTEM"}),m.jsx("button",{onClick:a,className:"text-primary hover:text-white transition-colors",title:"Create New Glyph",children:m.jsx("span",{className:"material-symbols-outlined text-lg",children:"add_circle"})})]}),m.jsxs("div",{className:"p-4 bg-[#1a1a20] border border-white/5 rounded-2xl",children:[m.jsxs("div",{className:"grid grid-cols-4 gap-2",children:[r.slice(0,12).map(u=>m.jsx("div",{onClick:()=>i(u),className:"aspect-square rounded-lg bg-black/40 border border-white/5 flex items-center justify-center text-xl font-serif text-primary hover:border-primary/40 hover:bg-primary/5 transition-all cursor-pointer",title:u.lema,children:m.jsx("span",{children:u.lema})},u.id)),r.length===0&&m.jsx("div",{className:"col-span-4 py-8 flex items-center justify-center opacity-20",children:m.jsx("span",{className:"text-[8px] font-black uppercase font-mono",children:"No Glyphs"})})]}),m.jsx("div",{className:"mt-3 text-center",children:m.jsxs("button",{onClick:o,className:"text-[9px] font-bold text-primary hover:underline uppercase tracking-wide",children:["View all (",r.length,")"]})})]})]}),m.jsxs("section",{className:"space-y-4 shrink-0",children:[m.jsxs("div",{className:"flex justify-between items-center",children:[m.jsx("h4",{className:"text-[10px] font-black uppercase tracking-widest text-slate-500",children:l("linguistics.grammar")||"GRAMMAR"}),m.jsx("button",{onClick:s,className:"text-primary hover:text-white transition-colors",children:m.jsx("span",{className:"material-symbols-outlined text-lg",children:"add_circle"})})]}),m.jsx("div",{className:"space-y-2",children:n.length>0?n.map(u=>m.jsxs("div",{className:"p-3 bg-[#1a1a20] border border-white/5 rounded-xl hover:border-primary/30 transition-all cursor-pointer group",children:[m.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[m.jsx("div",{className:`size-1.5 rounded-full ${u.status==="complete"?"bg-emerald-500":"bg-amber-500"}`}),m.jsx("span",{className:"text-[10px] font-bold text-white group-hover:text-primary transition-colors",children:u.titulo})]}),m.jsx("p",{className:"text-[9px] text-slate-500 leading-tight line-clamp-2",children:u.descripcion})]},u.id)):m.jsx("div",{className:"p-4 text-center border border-dashed border-white/10 rounded-xl",children:m.jsx("p",{className:"text-[9px] text-slate-600 italic",children:"No rules defined."})})})]})]})},nZ=({onOpenEditor:t})=>{const{t:e}=Ps(),{projectName:r}=Va(),{setRightPanelTab:n,setRightOpen:i}=bo(),[a,s]=ne.useState("..."),[o,l]=ne.useState({words:0,rules:0,glyphs:0}),[u,c]=ne.useState("..."),[f,p]=ne.useState([]),[g,y]=ne.useState([]),[S,w]=ne.useState(null),[C,_]=ne.useState(""),[T,N]=ne.useState(""),[R,D]=ne.useState(!1),[j,O]=ne.useState("lexicon"),[F,z]=ne.useState(""),[G,Z]=ne.useState("MANAGEMENT"),[I,W]=ne.useState(!1),[U,K]=ne.useState(null),[$,Q]=ne.useState(!1),[ie,te]=ne.useState(null),[X,re]=ne.useState(null),[fe,oe]=ne.useState("CHRONOS_ATLAS_V1"),[se,he]=ne.useState("ARCHITECT_ID"),[ae,pe]=ne.useState("TTF"),[ye,ve]=ne.useState(!0),[ue,xe]=ne.useState(!0),[Se,Ae]=ne.useState([{msg:"Inicializando Bfer de Glifos...",type:"info"},{msg:"Sincronizacin de Diccionario Activa",type:"success"}]),Me={ALPHABET:{id:"ALPHABET"}},[st,rt]=ne.useState(Me.ALPHABET.id),[dt,Ct]=ne.useState(""),[Ke,ut]=ne.useState([]),[ct,xt]=ne.useState([]),ot=(Ue,Ye="info")=>{Ae(et=>[...et.slice(-4),{msg:Ue,type:Ye}])},[Lt,Bt]=ne.useState(!1),[Ne,qe]=ne.useState(null),[St,it]=ne.useState([{id:"layer1",name:"Trazo Principal",visible:!0,locked:!1,shapes:[]},{id:"layer2",name:"Guas",visible:!0,locked:!1,shapes:[]}]),[lt,Ie]=ne.useState("layer1"),[de,ge]=ne.useState(null),[ke,Ee]=ne.useState([]),[Re,Qe]=ne.useState([]),Ge=Ue=>{const Ye=JSON.parse(JSON.stringify(Ue));Ee(et=>[...et.slice(-19),Ye]),Qe([])},wt=()=>{if(ke.length===0)return;const Ue=ke[ke.length-1];Ee(Ye=>Ye.slice(0,-1)),Qe(Ye=>[St,...Ye]),it(Ue)},bt=()=>{if(Re.length===0)return;const Ue=Re[0];Qe(Ye=>Ye.slice(1)),Ee(Ye=>[...Ye,St]),it(Ue)},[pt,Kt]=ne.useState("brush"),[Wt,Ve]=ne.useState(4),[vt,Et]=ne.useState("#00E5FF"),[er,gr]=ne.useState(1),[Ir,zr]=ne.useState("round"),[Cr,fn]=ne.useState("linear"),xr=Qt.useRef(null);ne.useEffect(()=>{gi(),i(!0),n&&n("CONTEXT"),D(!0);const Ue=setInterval(()=>{const Ye=document.getElementById("global-right-panel-portal");Ye&&(console.log("[LinguisticsHub] Portal found, clearing before use"),Ye.innerHTML="",re(Ye),clearInterval(Ue))},100);return()=>{clearInterval(Ue),console.log("[LinguisticsHub] Cleanup: clearing portal");const Ye=document.getElementById("global-right-panel-portal");Ye&&(Ye.innerHTML=""),n&&n("NOTEBOOKS")}},[]),ne.useEffect(()=>{!de||Array.isArray(de)||it(Ue=>{const Ye=Ue.map(et=>({...et,shapes:et.shapes.map(ht=>{if(ht.id===de&&(ht.type==="line"||ht.type==="brush")){const Ze={...ht};return Cr==="points"?(Ze.dash=[2,10],delete Ze.tension):Cr==="quadratic"?(Ze.tension=.8,delete Ze.dash):(delete Ze.dash,delete Ze.tension),Ze}return ht})}));return Ge(Ye),Ye})},[Cr]),ne.useEffect(()=>{!de||Array.isArray(de)&&de.length===0||it(Ue=>Ue.map(et=>({...et,shapes:et.shapes.map(ht=>(Array.isArray(de)?de.includes(ht.id):ht.id===de)?{...ht,stroke:vt,strokeWidth:Wt,opacity:er,lineCap:Ir}:ht)})))},[vt,Wt,er,Ir]);const Tt=Ue=>{if(qe(Ue.id),Bt(!0),setRightPanelMode("LINGUISTICS"),Ue.rawEditorData)try{const et=JSON.parse(Ue.rawEditorData);if(Array.isArray(et)&&et.length>0){it(et),Ie(et[0].id);return}}catch(et){console.error("Error parsing rawEditorData:",et)}const Ye=[];Ue.svgPathData&&Ye.push({id:crypto.randomUUID(),type:"path",data:Ue.svgPathData,x:0,y:0,stroke:"#00E5FF",strokeWidth:2,fill:null,scaleX:1,scaleY:1}),it([{id:"layer1",name:"Trazo Principal",visible:!0,locked:!1,shapes:Ye},{id:"layer2",name:"Guas",visible:!0,locked:!1,shapes:[]}]),Ie("layer1")},Ur=()=>{Bt(!1),qe(null),ge(null)},Qn=async()=>{if(!Ne||!S)return;const Ue=St.filter(tr=>tr.visible&&!tr.name.toLowerCase().includes("gua")).flatMap(tr=>tr.shapes);if(Ue.length===0){ot("No hay trazos para guardar","warning");return}let Ye="",et=1/0,ht=1/0,Ze=-1/0,Dt=-1/0;const Pr=tr=>{const nr=tr.x||0,Rr=tr.y||0;if(tr.type==="line"&&tr.points)for(let rr=0;rr<tr.points.length;rr+=2){const en=tr.points[rr]+nr,yn=tr.points[rr+1]+Rr;et=Math.min(et,en),ht=Math.min(ht,yn),Dt=Math.max(Dt,en),Ze=Math.max(Ze,yn)}else if(tr.type==="rect")et=Math.min(et,nr),ht=Math.min(ht,Rr),Dt=Math.max(Dt,nr+(tr.width||0)),Ze=Math.max(Ze,Rr+(tr.height||0));else if(tr.type==="circle"){const rr=tr.radius||0;et=Math.min(et,nr-rr),ht=Math.min(ht,Rr-rr),Dt=Math.max(Dt,nr+rr),Ze=Math.max(Ze,Rr+rr)}};if(Ue.forEach(Pr),et===1/0)return;const Mr=(et+Dt)/2,Br=(ht+Ze)/2,vi=xr.current,zt=vi.width()/2-Mr,jr=vi.height()/2-Br,al=St.map(tr=>({...tr,shapes:tr.shapes.map(nr=>({...nr,x:(nr.x||0)+zt,y:(nr.y||0)+jr}))}));Ue.forEach(tr=>{const nr=(tr.x||0)+zt,Rr=(tr.y||0)+jr;if(tr.type==="line"&&tr.points&&tr.points.length>=4){if(tr.globalCompositeOperation==="destination-out")return;Ye+=`M ${tr.points[0]+nr} ${tr.points[1]+Rr} `;for(let rr=2;rr<tr.points.length;rr+=2)Ye+=`L ${tr.points[rr]+nr} ${tr.points[rr+1]+Rr} `}else if(tr.type==="rect"){const rr=tr.width||0,en=tr.height||0;Ye+=`M ${nr} ${Rr} L ${nr+rr} ${Rr} L ${nr+rr} ${Rr+en} L ${nr} ${Rr+en} Z `}else if(tr.type==="circle"){const rr=tr.radius||0,en=.5522847498*rr;Ye+=`M ${nr} ${Rr-rr} 
                             C ${nr+en} ${Rr-rr} ${nr+rr} ${Rr-en} ${nr+rr} ${Rr} 
                             C ${nr+rr} ${Rr+en} ${nr+en} ${Rr+rr} ${nr} ${Rr+rr} 
                             C ${nr-en} ${Rr+rr} ${nr-rr} ${Rr+en} ${nr-rr} ${Rr} 
                             C ${nr-rr} ${Rr-en} ${nr-en} ${Rr-rr} ${nr} ${Rr-rr} Z `}});try{const tr=f.find(Rr=>Rr.id===Ne)||{lema:"Nuevo Glifo",categoriaGramatical:"GLYPH",definicion:"Glifo dibujado manualmente"};f.some(Rr=>Rr.id===Ne)?await $e.put(`/conlang/${S}/palabra/${Ne}`,{...tr,svgPathData:Ye,rawEditorData:JSON.stringify(al)}):await $e.post(`/conlang/${S}/palabra`,{...tr,id:Ne,svgPathData:Ye,rawEditorData:JSON.stringify(al)}),qa(S),ot("Glifo guardado y centrado con xito","success")}catch(tr){throw console.error("Error saving glyph:",tr),ot("Error al guardar glifo","error"),tr}},Zi=Ue=>{te(Ue),Q(!0)},ds=async()=>{if(!(!ie||!S))try{await $e.delete(`/conlang/${S}/palabra/${ie}`),qa(S),ot("Palabra eliminada","success"),te(null),Q(!1)}catch(Ue){console.error("Error deleting word:",Ue),ot("Error al eliminar palabra","error")}},As=Ue=>{K(Ue),W(!0)},ni=async Ue=>{if(S)try{Ue.isNew?await $e.post(`/conlang/${S}/palabra`,Ue):await $e.put(`/conlang/${S}/palabra/${U.id}`,Ue),qa(S),ot("Cambios sincronizados","success"),W(!1),K(null)}catch(Ye){console.error("Error saving meaning:",Ye),ot("Error al sincronizar cambios","error")}},sn=f.filter(Ue=>{const Ye=F.toLowerCase(),et=(Ue.lema||"").toLowerCase(),ht=(Ue.traduccionEspanol||Ue.definicion||"").toLowerCase();return et.includes(Ye)||ht.includes(Ye)}),kn=(Ue,Ye)=>{if(Ue==="START"){const et=St.find(Ze=>Ze.id===lt);if(!et||et.locked||!et.visible){ot("Capa bloqueada u oculta","warning");return}const ht={id:crypto.randomUUID(),type:pt,stroke:vt,strokeWidth:Wt,opacity:er,lineCap:Ir,lineJoin:"round",x:pt==="brush"||pt==="eraser"||pt==="line"?0:Ye.pos.x,y:pt==="brush"||pt==="eraser"||pt==="line"?0:Ye.pos.y};pt==="brush"||pt==="eraser"?(ht.type="line",ht.points=[Ye.pos.x,Ye.pos.y,Ye.pos.x,Ye.pos.y],pt==="eraser"&&(ht.globalCompositeOperation="destination-out",ht.strokeWidth=Wt*2),Cr==="points"&&pt!=="eraser"&&(ht.dash=[2,10]),Cr==="quadratic"&&pt!=="eraser"&&(ht.tension=.8)):pt==="line"?(ht.type="line",ht.points=[Ye.pos.x,Ye.pos.y,Ye.pos.x,Ye.pos.y],Cr==="points"&&(ht.dash=[2,10]),Cr==="quadratic"&&(ht.tension=.8)):pt==="rect"?(ht.width=0,ht.height=0,Cr==="points"&&(ht.dash=[5,5])):pt==="circle"&&(ht.radius=0,Cr==="points"&&(ht.dash=[5,5])),it(Ze=>{const Dt=Ze.map(Pr=>Pr.id===lt?{...Pr,shapes:[...Pr.shapes,ht]}:Pr);return Ge(Dt),Dt}),ge(ht.id)}else Ue==="MOVE"?it(et=>et.map(ht=>{if(ht.id===lt){const Ze=[...ht.shapes],Dt={...Ze[Ze.length-1]};if(!Dt)return ht;if(pt==="brush"||pt==="eraser")Dt.points=[...Dt.points,Ye.pos.x,Ye.pos.y];else if(pt==="line")Dt.points=[Dt.points[0],Dt.points[1],Ye.pos.x,Ye.pos.y];else if(pt==="rect")Dt.width=Ye.pos.x-Dt.x,Dt.height=Ye.pos.y-Dt.y;else if(pt==="circle"){const Pr=Ye.pos.x-Dt.x,Mr=Ye.pos.y-Dt.y;Dt.radius=Math.sqrt(Pr*Pr+Mr*Mr)}return Ze[Ze.length-1]=Dt,{...ht,shapes:Ze}}return ht})):Ue==="END"&&Ge(St)},In=()=>{const Ue={id:crypto.randomUUID()};qe(Ue.id);const Ye=crypto.randomUUID();it([{id:Ye,name:"Capa 1",visible:!0,locked:!1,shapes:[]}]),Ie(Ye),Bt(!0),setRightPanelMode("LINGUISTICS")},Ls=(Ue,Ye)=>{it(et=>et.map(ht=>({...ht,shapes:ht.shapes.map(Ze=>Ze.id===Ue?{...Ze,...Ye}:Ze)})))},gi=async()=>{try{const Ue=await $e.get("/bd/proyecto-activo");s(Ue.nombreProyecto);const Ye=await $e.get("/conlang/stats");l(Ye);const et=await $e.get("/conlang/lenguas");et&&et.length>0&&(c(et[0].nombre),w(et[0].id),ko(et[0].id),qa(et[0].id))}catch(Ue){console.error("Error loading conlang data:",Ue),s("Default Project")}},ko=async Ue=>{try{const Ye=await $e.get(`/conlang/${Ue}/rules`);y(Ye)}catch(Ye){console.error("Error loading rules:",Ye)}},qa=async Ue=>{try{const Ye=await $e.get(`/conlang/${Ue}/diccionario`);p(Ye),xt(Ye.filter(et=>["GLYPH","GLYFO","GLIFO"].includes(et.categoriaGramatical)||et.svgPathData&&et.lema.length===1))}catch(Ye){console.error("Error loading lexicon:",Ye)}},Ou=async()=>{if(!S)return;const Ue=prompt("Enter rule title:");if(!Ue)return;const Ye=prompt("Enter rule description:"),et=prompt("Enter category (Grammar, Syntax, etc.):");try{await $e.post(`/conlang/${S}/rules`,{titulo:Ue,descripcion:Ye,categoria:et,status:"IN_PROGRESS"}),ko(S);const ht=await $e.get("/conlang/stats");l(ht)}catch(ht){console.error("Error adding rule:",ht)}},_o=Ue=>{_(Ue);const Ye=Ue.split("").map(et=>{const ht=ct.find(Ze=>Ze.lema.toLowerCase()===et.toLowerCase());return ht?ht.lema:et}).join(" ");N(Ye)},on=Ue=>{Ct(Ue);const Ye=Ue.split("").map(et=>ct.find(Ze=>Ze.lema.toLowerCase()===et.toLowerCase())||{lema:et,placeholder:!0});ut(Ye)},Co=async()=>{if(!(!S||!dt))try{await $e.post(`/conlang/${S}/palabra`,{lema:dt,definicion:`Entrada automtica (${new Date().toLocaleDateString()})`,categoriaGramatical:"COMPUESTA"}),qa(S),ot(`Palabra "${dt}" sincronizada automticamente`,"success")}catch(Ue){console.error("Error al guardar automticamente:",Ue)}},fs=()=>{const Ue=ct.map(et=>et.unicodeCode).filter(et=>et&&et.startsWith("U+")).map(et=>parseInt(et.replace("U+",""),16));return`U+${(Ue.length>0?Math.max(...Ue)+1:57344).toString(16).toUpperCase()}`},ro=ne.useRef(null),Yi=()=>{ro.current.click()},no=async Ue=>{const Ye=Ue.target.files[0];if(!Ye)return;const et=new FileReader;et.onload=async ht=>{const Dt=ht.target.result.match(/d="([^"]+)"/);if(Dt&&Dt[1]){const Pr=Dt[1],Mr=fs(),Br=String.fromCharCode(parseInt(Mr.replace("U+",""),16));try{await $e.post(`/conlang/${S}/palabra`,{lema:Br,categoriaGramatical:"GLYFO",definicion:`Glifo importado (${Ye.name})`,svgPathData:Pr,unicodeCode:Mr}),qa(S),ot(`Glifo ${Mr} importado con xito`,"success")}catch{ot("Error al importar glifo","error")}}else alert("SVG invlido para renderizado de glifos.")},et.readAsText(Ye),Ue.target.value=null};return m.jsxs("div",{className:"flex-1 flex flex-col h-full bg-[#050508] text-slate-300 font-sans overflow-hidden",children:[m.jsx("input",{type:"file",ref:ro,onChange:no,accept:".svg",className:"hidden"}),m.jsxs("div",{className:"h-16 border-b border-white/5 flex items-center justify-between px-8 bg-black/40",children:[m.jsx("div",{className:"flex items-center gap-4"}),!Lt&&m.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 flex bg-white/5 p-1 rounded-xl border border-white/5 backdrop-blur-md",children:[{id:"lexicon",label:e("linguistics.lexicon")},{id:"translator",label:e("linguistics.translator")},{id:"diccionario",label:"DICCIONARIO"}].map(Ue=>m.jsx("button",{onClick:()=>O(Ue.id),className:`px-6 py-1.5 rounded-lg text-[10px] font-black uppercase tracking-widest transition-all ${j===Ue.id?"bg-primary text-white shadow-lg":"text-slate-500 hover:text-slate-300"}`,children:Ue.label},Ue.id))}),Lt&&m.jsxs("div",{className:"flex items-center gap-3 bg-white/5 p-1 rounded-xl border border-white/5",children:[m.jsxs("button",{onClick:Ur,className:"flex items-center gap-2 px-4 py-1.5 rounded-lg text-[10px] font-black uppercase tracking-widest text-red-400 hover:bg-red-400/10 transition-all border border-transparent hover:border-red-400/20",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"close"}),"Descartar"]}),m.jsx("div",{className:"w-px h-4 bg-white/10 mx-1"}),m.jsxs("button",{onClick:async()=>{await Qn(),Ur()},className:"flex items-center gap-2 px-4 py-1.5 rounded-lg text-[10px] font-black uppercase tracking-widest bg-primary text-white shadow-lg hover:shadow-primary/20 transition-all",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"check"}),"Aplicar y Guardar"]})]})]}),m.jsx("main",{className:"flex-1 overflow-y-auto no-scrollbar p-8 lg:p-12 relative flex flex-col",children:Lt?m.jsx("div",{className:"flex-1 flex flex-col h-full relative",children:m.jsx(JK,{stageRef:xr,layers:St,selectedShapeId:de,onSelectShape:ge,onChangeShape:Ls,tool:pt,color:vt,strokeWidth:Wt,onDrawEnd:kn})}):j==="lexicon"?m.jsx("div",{className:"max-w-6xl mx-auto w-full animate-in fade-in slide-in-from-bottom-4 duration-700",children:m.jsxs("section",{className:"space-y-8",children:[m.jsxs("div",{className:"flex justify-between items-center px-4",children:[m.jsxs("div",{className:"flex flex-col",children:[m.jsx("h3",{className:"text-3xl font-black text-white tracking-tight italic",children:e("linguistics.lexicon")}),m.jsxs("p",{className:"text-[10px] text-slate-500 font-bold uppercase tracking-widest",children:[o.words," Palabras Mapeadas"]})]}),m.jsx(Pn,{variant:"primary",size:"md",onClick:In,icon:"draw",children:"Nuevo Glifo"})]}),m.jsxs(Kn,{className:"p-0 border-white/5 bg-surface-dark/40 overflow-hidden shadow-2xl rounded-[2.5rem]",children:[m.jsxs("div",{className:"p-6 border-b border-white/5 flex items-center gap-4 bg-black/20",children:[m.jsxs("div",{className:"flex-1 relative",children:[m.jsx("span",{className:"material-symbols-outlined absolute left-4 top-1/2 -translate-y-1/2 text-primary/60 text-lg",children:"search"}),m.jsx("input",{type:"text",placeholder:e("linguistics.search_lexicon"),value:F,onChange:Ue=>z(Ue.target.value),className:"w-full bg-white/5 border border-white/10 rounded-2xl py-4 pl-12 pr-4 text-xs font-bold text-white focus:ring-1 focus:ring-primary/30 outline-none transition-all placeholder-slate-600"})]}),m.jsx("button",{className:"size-12 rounded-2xl bg-white/5 border border-white/10 flex items-center justify-center text-slate-500 hover:text-white transition-all hover:bg-white/10",children:m.jsx("span",{className:"material-symbols-outlined text-xl",children:"tune"})})]}),m.jsxs("div",{className:"p-8 space-y-2 max-h-[70vh] overflow-y-auto no-scrollbar custom-scrollbar",children:[sn.map(Ue=>m.jsx(iZ,{word:Ue.lema||Ue.palabraOriginal,type:Ue.categoriaGramatical,gender:Ue.genero,def:Ue.definicion||Ue.traduccionEspanol,onEdit:()=>As(Ue),onDelete:()=>Zi(Ue.id)},Ue.id)),sn.length===0&&m.jsxs("div",{className:"py-20 flex flex-col items-center justify-center text-slate-600 opacity-20",children:[m.jsx("span",{className:"material-symbols-outlined text-8xl mb-4",children:"menu_book"}),m.jsx("p",{className:"text-[10px] uppercase tracking-[0.5em] font-black",children:F?"No se encontraron resultados":"Flujo de Datos Vaco"})]})]})]})]})}):j==="translator"?m.jsx("div",{className:"max-w-6xl mx-auto w-full animate-in fade-in slide-in-from-bottom-4 duration-700",children:m.jsxs("section",{className:"space-y-8",children:[m.jsxs("div",{className:"flex items-center gap-4 px-4",children:[m.jsx("span",{className:"material-symbols-outlined text-primary text-4xl",children:"sync_alt"}),m.jsx("h3",{className:"text-3xl font-black text-white tracking-tight italic",children:e("linguistics.translator")})]}),m.jsx(Kn,{className:"p-12 border-primary/20 bg-primary/5 rounded-[3rem] shadow-2xl shadow-primary/5",children:m.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-12 items-center",children:[m.jsxs("div",{className:"space-y-6",children:[m.jsx("label",{className:"text-[10px] font-black uppercase tracking-[0.4em] text-primary opacity-60",children:"Entrada de Origen"}),m.jsx("textarea",{value:C,onChange:Ue=>_o(Ue.target.value),placeholder:e("linguistics.source_text"),className:"w-full h-48 bg-black/40 border border-white/10 rounded-[2.5rem] p-8 text-lg font-bold text-white focus:border-primary/50 outline-none transition-all placeholder-slate-800 resize-none"})]}),m.jsxs("div",{className:"space-y-6",children:[m.jsx("label",{className:"text-[10px] font-black uppercase tracking-[0.4em] text-primary opacity-60",children:"Salida Visual"}),m.jsx("div",{className:"h-48 rounded-[2.5rem] bg-black/60 border border-white/5 flex items-center justify-center relative overflow-hidden group shadow-inner",children:m.jsx("span",{className:"text-7xl font-serif text-white opacity-40 group-hover:opacity-100 transition-all duration-1000 whitespace-pre drop-shadow-[0_0_20px_rgba(255,255,255,0.4)]",children:T||"   "})})]})]})})]})}):m.jsxs("section",{className:"max-w-7xl mx-auto w-full animate-in fade-in slide-in-from-bottom-8 duration-1000 flex flex-col gap-12",children:[m.jsxs("div",{className:"flex justify-between items-center px-4",children:[m.jsx("div",{className:"flex flex-col"}),m.jsx("div",{className:"px-6 py-2 rounded bg-[#00E5FF]/10 border border-[#00E5FF]/20 text-[10px] font-black text-[#00E5FF] uppercase tracking-[0.3em] animate-pulse",children:"Bfer de Sincronizacin Listo"})]}),m.jsxs("div",{className:"space-y-12",children:[m.jsxs("section",{className:"space-y-6",children:[m.jsxs("div",{className:"flex items-center justify-between px-2",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("div",{className:"size-2 bg-[#00E5FF] rounded-full shadow-[0_0_10px_#00E5FF]"}),m.jsx("h3",{className:"text-xs font-black uppercase tracking-[0.5em] text-[#00E5FF]/60",children:"Glifos Mapeados"})]}),m.jsxs("div",{className:"flex flex-col gap-3 items-end",children:[m.jsxs("span",{className:"text-[10px] font-bold text-[#00E5FF]/40",children:[ct.length," Smbolos Indexados"]}),m.jsxs("div",{className:"flex items-center gap-4 px-6 py-2.5 rounded-2xl bg-black/40 border border-[#00E5FF]/10 backdrop-blur-md",children:[m.jsx("span",{className:"text-[9px] font-black uppercase tracking-[0.2em] text-[#00E5FF]/60 font-mono",children:"Estado del Bfer"}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("span",{className:"text-[10px] font-bold text-white tracking-widest",children:"SINCRONIZADO"}),m.jsx("div",{className:"size-1.5 bg-[#00E5FF] rounded-full shadow-[0_0_10px_#00E5FF] animate-pulse"})]})]})]})]}),m.jsxs("div",{className:"p-10 rounded-[2.5rem] border border-[#00E5FF]/10 bg-[#00E5FF]/[0.02] grid grid-cols-4 md:grid-cols-6 lg:grid-cols-8 gap-6",children:[ct.map((Ue,Ye)=>m.jsx(aZ,{symbol:Ue.lema,svgPath:Ue.svgPathData,keyLabel:Ue.lema.length===1&&Ue.lema.match(/[a-z]/i)?Ue.lema.toUpperCase():"",active:!1,onClick:()=>Tt(Ue)},Ue.id||Ye)),m.jsxs("button",{onClick:In,className:"aspect-square rounded-2xl border-2 border-dashed border-[#00E5FF]/10 flex flex-col items-center justify-center text-[#00E5FF]/20 hover:text-[#00E5FF] hover:border-[#00E5FF]/40 transition-all cursor-pointer group gap-2",title:"Dibujar Nuevo Glifo",children:[m.jsx("span",{className:"material-symbols-outlined text-3xl group-hover:scale-110 transition-transform",children:"draw"}),m.jsx("span",{className:"text-[8px] font-black uppercase tracking-widest opacity-0 group-hover:opacity-100 transition-opacity",children:"Dibujar"})]}),m.jsxs("button",{onClick:Yi,className:"aspect-square rounded-2xl border-2 border-dashed border-[#00E5FF]/10 flex flex-col items-center justify-center text-[#00E5FF]/20 hover:text-[#00E5FF] hover:border-[#00E5FF]/40 transition-all cursor-pointer group gap-2",title:"Importar desde SVG",children:[m.jsx("span",{className:"material-symbols-outlined text-3xl group-hover:scale-110 transition-transform",children:"upload_file"}),m.jsx("span",{className:"text-[8px] font-black uppercase tracking-widest opacity-0 group-hover:opacity-100 transition-opacity",children:"Importar"})]})]})]}),m.jsx("div",{className:"px-10",children:m.jsx("div",{className:"w-full h-[2px] bg-white/5 overflow-hidden rounded-full",children:m.jsx("div",{className:"h-full bg-[#00E5FF] shadow-[0_0_10px_#00E5FF] transition-all duration-1000",style:{width:`${Math.min(100,ct.length/26*100)}%`}})})}),m.jsxs("section",{className:"space-y-6",children:[m.jsxs("div",{className:"flex items-center gap-4 px-2",children:[m.jsx("div",{className:"size-2 bg-primary rounded-full shadow-[0_0_10px_#7c3aed] opacity-60"}),m.jsx("h3",{className:"text-xs font-black uppercase tracking-[0.5em] text-primary/60",children:"Compositor de Palabras"})]}),m.jsxs(Kn,{className:"p-10 border-white/5 bg-black/40 rounded-[2.5rem] space-y-8",children:[m.jsxs("div",{className:"flex gap-8 items-start",children:[m.jsxs("div",{className:"flex-1 space-y-4",children:[m.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-slate-500",children:"Escritura Fontica"}),m.jsx("input",{type:"text",value:dt,onChange:Ue=>on(Ue.target.value),onBlur:()=>{dt&&Co()},onKeyDown:Ue=>{Ue.key==="Enter"&&Co()},placeholder:"Escribe para componer...",className:"w-full bg-white/5 border border-white/10 rounded-2xl py-6 px-8 text-2xl font-bold text-white outline-none focus:border-primary/40 transition-all placeholder:text-slate-800"})]}),m.jsxs("div",{className:"mt-10 px-6 py-4 rounded-xl bg-white/5 border border-white/10 flex items-center gap-3",children:[m.jsx("div",{className:"size-2 bg-emerald-500 rounded-full animate-pulse shadow-[0_0_10px_#10b981]"}),m.jsx("span",{className:"text-[9px] font-black uppercase tracking-widest text-slate-400",children:"Auto-Sincronizacin"})]})]}),m.jsxs("div",{className:"space-y-4",children:[m.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-slate-500",children:"Flujo de Renderizado Visual"}),m.jsx("div",{className:"min-h-32 p-8 rounded-2xl bg-black/60 border border-white/5 flex flex-wrap gap-4 items-center justify-center relative group",children:Ke.length>0?Ke.map((Ue,Ye)=>m.jsxs("div",{className:"flex flex-col items-center gap-1",children:[m.jsx("span",{className:`text-5xl font-serif ${Ue.placeholder?"text-slate-800 animate-pulse":"text-[#00E5FF] drop-shadow-[0_0_10px_rgba(0,229,255,0.4)]"}`,children:Ue.lema}),m.jsx("span",{className:"text-[8px] font-black text-slate-600 uppercase tracking-widest",children:Ue.lema})]},Ye)):m.jsx("span",{className:"text-slate-800 font-black uppercase tracking-[0.5em] text-[10px]",children:"Sin glifos detectados"})})]})]})]}),m.jsxs("section",{className:"space-y-6",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("div",{className:"size-2 bg-[#00E5FF] rounded-full shadow-[0_0_10px_#00E5FF] opacity-40"}),m.jsx("h3",{className:"text-xs font-black uppercase tracking-[0.5em] text-[#00E5FF]/60",children:"Previsualizacin de Transmisin"})]}),m.jsxs("div",{className:"h-64 rounded-[2.5rem] border border-[#00E5FF]/10 bg-black/40 flex flex-col p-12 items-center justify-center relative group shadow-inner",children:[m.jsx("div",{className:"absolute top-6 left-8 text-[8px] opacity-20 uppercase tracking-[0.3em] font-black",children:"Estado del Bfer: Activo"}),m.jsx("textarea",{className:"w-full bg-transparent border-none outline-none text-center text-7xl font-bold tracking-widest text-[#00E5FF]/10 group-hover:text-[#00E5FF]/40 transition-all placeholder:text-[#00E5FF]/5 resize-none italic font-serif",placeholder:"..."}),m.jsxs("div",{className:"absolute bottom-6 right-8 flex gap-6 text-[8px] font-black uppercase tracking-widest text-[#00E5FF]/20",children:[m.jsx("span",{children:"Motor_V4"}),m.jsx("span",{children:"ASCII/UTF-8"})]})]})]})]})]})}),X&&eo.createPortal(m.jsx("div",{className:"h-full flex flex-col bg-background relative overflow-hidden",children:Lt?m.jsx(tZ,{tool:pt,setTool:Kt,strokeWidth:Wt,setStrokeWidth:Ve,color:vt,setColor:Et,opacity:er,setOpacity:gr,lineCap:Ir,setLineCap:zr,strokeStyle:Cr,setStrokeStyle:fn,layers:St,activeLayerId:lt,setActiveLayerId:Ie,onToggleLayerVisibility:Ue=>it(Ye=>Ye.map(et=>et.id===Ue?{...et,visible:!et.visible}:et)),onToggleLayerLock:Ue=>it(Ye=>Ye.map(et=>et.id===Ue?{...et,locked:!et.locked}:et)),onAddLayer:()=>{const Ue=crypto.randomUUID();it(Ye=>[{id:Ue,name:`Capa ${Ye.length+1}`,visible:!0,locked:!1,shapes:[]},...Ye]),Ie(Ue)},onDeleteLayer:Ue=>{St.length!==1&&it(Ye=>{const et=Ye.filter(ht=>ht.id!==Ue);return lt===Ue&&Ie(et[0].id),et})},activeShape:de&&!Array.isArray(de)?St.flatMap(Ue=>Ue.shapes).find(Ue=>Ue.id===de):null,onUndo:wt,onRedo:bt,onClear:()=>{it(Ue=>Ue.map(Ye=>Ye.id===lt?{...Ye,shapes:[]}:Ye)),ot("Capa limpiada","info")}}):m.jsx(rZ,{stats:o,langName:u,glyphs:ct,rules:g,onEditGlyph:Tt,onCreateGlyph:In,onCreateRule:Ou,onViewAllGlyphs:()=>O("lexicon")})}),X),m.jsx(t_,{isOpen:$,onClose:()=>Q(!1),onConfirm:ds,title:"Eliminar Palabra",message:"Ests seguro de que quieres eliminar esta palabra? Esta accin no se puede deshacer.",confirmText:"Eliminar",cancelText:"Cancelar"}),I&&m.jsx(sZ,{word:U,onClose:()=>W(!1),onSave:ni,onEditSymbol:Ue=>{W(!1),Tt(Ue)}})]})},iZ=({word:t,type:e,gender:r,def:n,onEdit:i,onDelete:a})=>m.jsxs("div",{className:"p-4 rounded-2xl border border-transparent hover:bg-white/5 hover:border-white/5 transition-all group cursor-pointer relative",children:[m.jsxs("div",{className:"flex items-center gap-3 mb-1",children:[m.jsx("h4",{className:"text-xl font-manrope font-black text-white group-hover:text-primary transition-colors",children:t}),m.jsxs("div",{className:"flex gap-2",children:[m.jsx("span",{className:"text-[9px] font-bold text-slate-600 italic",children:e}),r&&m.jsxs("span",{className:"text-[9px] font-bold text-slate-700 uppercase",children:["(",r,")"]})]})]}),m.jsx("p",{className:"text-sm text-slate-400 leading-relaxed font-manrope line-clamp-2 pr-16",children:n}),m.jsxs("div",{className:"absolute right-4 top-1/2 -translate-y-1/2 flex gap-1",children:[m.jsx("button",{onClick:s=>{s.stopPropagation(),i?.()},className:"opacity-0 group-hover:opacity-100 transition-opacity p-2 bg-white/5 hover:bg-white/10 rounded-xl text-primary hover:text-white",title:"Editar Significado",children:m.jsx("span",{className:"material-symbols-outlined text-lg",children:"edit"})}),m.jsx("button",{onClick:s=>{s.stopPropagation(),a?.()},className:"opacity-0 group-hover:opacity-100 transition-opacity p-2 bg-white/5 hover:bg-red-400/20 rounded-xl text-slate-600 hover:text-red-400",title:"Eliminar Palabra",children:m.jsx("span",{className:"material-symbols-outlined text-lg",children:"delete"})})]})]}),aZ=({symbol:t,svgPath:e,keyLabel:r,active:n,onClick:i})=>m.jsxs("div",{onClick:i,className:`aspect-square rounded-2xl border transition-all cursor-pointer flex items-center justify-center relative group overflow-hidden ${n?"bg-[#00E5FF]/20 border-[#00E5FF] shadow-[0_0_20px_rgba(0,229,255,0.3)]":"bg-black/40 border-[#00E5FF]/10 hover:border-[#00E5FF]/40"}`,children:[e?m.jsx("svg",{viewBox:"0 0 1200 800",className:"w-[80%] h-[80%] opacity-80 group-hover:opacity-100 transition-opacity",children:m.jsx("path",{d:e,fill:"none",stroke:n?"#00E5FF":"white",strokeWidth:"15",strokeLinecap:"round",strokeLinejoin:"round",className:"group-hover:stroke-[#00E5FF] transition-colors"})}):m.jsx("span",{className:`text-4xl font-serif ${n||t?"text-[#00E5FF]":"opacity-20 group-hover:opacity-60 text-white"}`,children:t||"?"}),r&&m.jsx("span",{className:`absolute top-2 right-3 text-[8px] font-black uppercase ${n?"text-[#00E5FF]/80":"opacity-20"}`,children:r})]}),sZ=({word:t,onClose:e,onSave:r,onEditSymbol:n})=>{const[i,a]=ne.useState({lema:t?.lema||"",definicion:t?.definicion||t?.traduccionEspanol||"",categoriaGramatical:t?.categoriaGramatical||"Noun",notas:t?.notas||"",isNew:t?.isNew});return m.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-6 bg-black/60 backdrop-blur-sm animate-in fade-in duration-300",children:m.jsxs("div",{className:"w-full max-w-lg bg-[#0A0A0F] border border-white/10 rounded-[2.5rem] overflow-hidden shadow-2xl animate-in zoom-in-95 duration-500",children:[m.jsxs("div",{className:"p-8 border-b border-white/5 bg-white/[0.02] flex justify-between items-center",children:[m.jsxs("div",{className:"flex flex-col",children:[m.jsx("h2",{className:"text-xl font-black text-white italic tracking-tight",children:"Editar Significado"}),m.jsx("p",{className:"text-[10px] text-slate-500 font-bold uppercase tracking-widest",children:"Atributos del Lema"})]}),m.jsx("button",{onClick:e,className:"size-10 rounded-xl bg-white/5 flex items-center justify-center text-slate-500 hover:text-white transition-all",children:m.jsx("span",{className:"material-symbols-outlined",children:"close"})})]}),m.jsxs("div",{className:"p-8 space-y-6",children:[m.jsxs("div",{className:"space-y-2",children:[m.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-slate-600 ml-4",children:"Palabra / Lema"}),m.jsx("input",{type:"text",value:i.lema,onChange:s=>a(o=>({...o,lema:s.target.value})),className:"w-full bg-white/5 border border-white/10 rounded-2xl py-4 px-6 text-white text-sm font-bold focus:border-primary/40 outline-none transition-all"})]}),m.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[m.jsxs("div",{className:"space-y-2",children:[m.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-slate-600 ml-4",children:"Categora"}),m.jsxs("select",{value:i.categoriaGramatical,onChange:s=>a(o=>({...o,categoriaGramatical:s.target.value})),className:"w-full bg-[#1a1a20] border border-white/10 rounded-2xl py-4 px-6 text-white text-xs font-bold focus:border-primary/40 outline-none transition-all appearance-none",children:[m.jsx("option",{value:"Noun",className:"bg-[#1a1a20] text-white",children:"Sustantivo"}),m.jsx("option",{value:"Verb",className:"bg-[#1a1a20] text-white",children:"Verbo"}),m.jsx("option",{value:"Adj",className:"bg-[#1a1a20] text-white",children:"Adjetivo"}),m.jsx("option",{value:"Adv",className:"bg-[#1a1a20] text-white",children:"Adverbio"}),m.jsx("option",{value:"Conj",className:"bg-[#1a1a20] text-white",children:"Conjuncin"}),m.jsx("option",{value:"GLYPH",className:"bg-[#1a1a20] text-white",children:"Glifo / Smbolo"}),m.jsx("option",{value:"GLYFO",className:"bg-[#1a1a20] text-white",children:"Glifo / Smbolo (Alt)"}),m.jsx("option",{value:"GLIFO",className:"bg-[#1a1a20] text-white",children:"Glifo / Smbolo (ES)"})]})]}),m.jsx("div",{className:"flex items-end pb-1",children:m.jsxs("button",{onClick:()=>n(t),className:"w-full h-[52px] rounded-2xl border border-primary/20 bg-primary/5 hover:bg-primary/20 text-primary text-[10px] font-black uppercase tracking-widest transition-all flex items-center justify-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"draw"}),"Editar Smbolo"]})})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-slate-600 ml-4",children:"Definicin / Significado"}),m.jsx("textarea",{value:i.definicion,onChange:s=>a(o=>({...o,definicion:s.target.value})),className:"w-full bg-white/5 border border-white/10 rounded-2xl py-4 px-6 text-white text-sm font-bold focus:border-primary/40 outline-none transition-all h-24 resize-none"})]})]}),m.jsxs("div",{className:"p-8 bg-white/[0.02] border-t border-white/5 flex gap-4",children:[m.jsx("button",{onClick:e,className:"flex-1 py-4 rounded-2xl text-[10px] font-black uppercase tracking-widest text-slate-500 hover:text-white transition-all",children:"Cancelar"}),m.jsx("button",{onClick:()=>r(i),className:"flex-1 py-4 rounded-2xl bg-primary text-white text-[10px] font-black uppercase tracking-widest shadow-lg shadow-primary/20 transition-all hover:scale-105",children:"Guardar Cambios"})]})]})})},oZ=()=>{const[t,e]=ne.useState("hub"),[r,n]=ne.useState(null),i=a=>{n(a),console.log("Opening editor for",a)};return m.jsx("div",{className:"flex-1 flex flex-col h-full bg-[#050508] overflow-hidden",children:t==="hub"&&m.jsx(nZ,{onOpenEditor:i})})};var Q2={exports:{}},J2={};var m3;function lZ(){if(m3)return J2;m3=1;var t=am();function e(f,p){return f===p&&(f!==0||1/f===1/p)||f!==f&&p!==p}var r=typeof Object.is=="function"?Object.is:e,n=t.useState,i=t.useEffect,a=t.useLayoutEffect,s=t.useDebugValue;function o(f,p){var g=p(),y=n({inst:{value:g,getSnapshot:p}}),S=y[0].inst,w=y[1];return a(function(){S.value=g,S.getSnapshot=p,l(S)&&w({inst:S})},[f,g,p]),i(function(){return l(S)&&w({inst:S}),f(function(){l(S)&&w({inst:S})})},[f]),s(g),g}function l(f){var p=f.getSnapshot;f=f.value;try{var g=p();return!r(f,g)}catch{return!0}}function u(f,p){return p()}var c=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?u:o;return J2.useSyncExternalStore=t.useSyncExternalStore!==void 0?t.useSyncExternalStore:c,J2}var g3;function CR(){return g3||(g3=1,Q2.exports=lZ()),Q2.exports}var ER=CR();function Ia(t){this.content=t}Ia.prototype={constructor:Ia,find:function(t){for(var e=0;e<this.content.length;e+=2)if(this.content[e]===t)return e;return-1},get:function(t){var e=this.find(t);return e==-1?void 0:this.content[e+1]},update:function(t,e,r){var n=r&&r!=t?this.remove(r):this,i=n.find(t),a=n.content.slice();return i==-1?a.push(r||t,e):(a[i+1]=e,r&&(a[i]=r)),new Ia(a)},remove:function(t){var e=this.find(t);if(e==-1)return this;var r=this.content.slice();return r.splice(e,2),new Ia(r)},addToStart:function(t,e){return new Ia([t,e].concat(this.remove(t).content))},addToEnd:function(t,e){var r=this.remove(t).content.slice();return r.push(t,e),new Ia(r)},addBefore:function(t,e,r){var n=this.remove(e),i=n.content.slice(),a=n.find(t);return i.splice(a==-1?i.length:a,0,e,r),new Ia(i)},forEach:function(t){for(var e=0;e<this.content.length;e+=2)t(this.content[e],this.content[e+1])},prepend:function(t){return t=Ia.from(t),t.size?new Ia(t.content.concat(this.subtract(t).content)):this},append:function(t){return t=Ia.from(t),t.size?new Ia(this.subtract(t).content.concat(t.content)):this},subtract:function(t){var e=this;t=Ia.from(t);for(var r=0;r<t.content.length;r+=2)e=e.remove(t.content[r]);return e},toObject:function(){var t={};return this.forEach(function(e,r){t[e]=r}),t},get size(){return this.content.length>>1}};Ia.from=function(t){if(t instanceof Ia)return t;var e=[];if(t)for(var r in t)e.push(r,t[r]);return new Ia(e)};function TR(t,e,r){for(let n=0;;n++){if(n==t.childCount||n==e.childCount)return t.childCount==e.childCount?null:r;let i=t.child(n),a=e.child(n);if(i==a){r+=i.nodeSize;continue}if(!i.sameMarkup(a))return r;if(i.isText&&i.text!=a.text){for(let s=0;i.text[s]==a.text[s];s++)r++;return r}if(i.content.size||a.content.size){let s=TR(i.content,a.content,r+1);if(s!=null)return s}r+=i.nodeSize}}function NR(t,e,r,n){for(let i=t.childCount,a=e.childCount;;){if(i==0||a==0)return i==a?null:{a:r,b:n};let s=t.child(--i),o=e.child(--a),l=s.nodeSize;if(s==o){r-=l,n-=l;continue}if(!s.sameMarkup(o))return{a:r,b:n};if(s.isText&&s.text!=o.text){let u=0,c=Math.min(s.text.length,o.text.length);for(;u<c&&s.text[s.text.length-u-1]==o.text[o.text.length-u-1];)u++,r--,n--;return{a:r,b:n}}if(s.content.size||o.content.size){let u=NR(s.content,o.content,r-1,n-1);if(u)return u}r-=l,n-=l}}class at{constructor(e,r){if(this.content=e,this.size=r||0,r==null)for(let n=0;n<e.length;n++)this.size+=e[n].nodeSize}nodesBetween(e,r,n,i=0,a){for(let s=0,o=0;o<r;s++){let l=this.content[s],u=o+l.nodeSize;if(u>e&&n(l,i+o,a||null,s)!==!1&&l.content.size){let c=o+1;l.nodesBetween(Math.max(0,e-c),Math.min(l.content.size,r-c),n,i+c)}o=u}}descendants(e){this.nodesBetween(0,this.size,e)}textBetween(e,r,n,i){let a="",s=!0;return this.nodesBetween(e,r,(o,l)=>{let u=o.isText?o.text.slice(Math.max(e,l)-l,r-l):o.isLeaf?i?typeof i=="function"?i(o):i:o.type.spec.leafText?o.type.spec.leafText(o):"":"";o.isBlock&&(o.isLeaf&&u||o.isTextblock)&&n&&(s?s=!1:a+=n),a+=u},0),a}append(e){if(!e.size)return this;if(!this.size)return e;let r=this.lastChild,n=e.firstChild,i=this.content.slice(),a=0;for(r.isText&&r.sameMarkup(n)&&(i[i.length-1]=r.withText(r.text+n.text),a=1);a<e.content.length;a++)i.push(e.content[a]);return new at(i,this.size+e.size)}cut(e,r=this.size){if(e==0&&r==this.size)return this;let n=[],i=0;if(r>e)for(let a=0,s=0;s<r;a++){let o=this.content[a],l=s+o.nodeSize;l>e&&((s<e||l>r)&&(o.isText?o=o.cut(Math.max(0,e-s),Math.min(o.text.length,r-s)):o=o.cut(Math.max(0,e-s-1),Math.min(o.content.size,r-s-1))),n.push(o),i+=o.nodeSize),s=l}return new at(n,i)}cutByIndex(e,r){return e==r?at.empty:e==0&&r==this.content.length?this:new at(this.content.slice(e,r))}replaceChild(e,r){let n=this.content[e];if(n==r)return this;let i=this.content.slice(),a=this.size+r.nodeSize-n.nodeSize;return i[e]=r,new at(i,a)}addToStart(e){return new at([e].concat(this.content),this.size+e.nodeSize)}addToEnd(e){return new at(this.content.concat(e),this.size+e.nodeSize)}eq(e){if(this.content.length!=e.content.length)return!1;for(let r=0;r<this.content.length;r++)if(!this.content[r].eq(e.content[r]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(e){let r=this.content[e];if(!r)throw new RangeError("Index "+e+" out of range for "+this);return r}maybeChild(e){return this.content[e]||null}forEach(e){for(let r=0,n=0;r<this.content.length;r++){let i=this.content[r];e(i,n,r),n+=i.nodeSize}}findDiffStart(e,r=0){return TR(this,e,r)}findDiffEnd(e,r=this.size,n=e.size){return NR(this,e,r,n)}findIndex(e){if(e==0)return ky(0,e);if(e==this.size)return ky(this.content.length,e);if(e>this.size||e<0)throw new RangeError(`Position ${e} outside of fragment (${this})`);for(let r=0,n=0;;r++){let i=this.child(r),a=n+i.nodeSize;if(a>=e)return a==e?ky(r+1,a):ky(r,n);n=a}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(e=>e.toJSON()):null}static fromJSON(e,r){if(!r)return at.empty;if(!Array.isArray(r))throw new RangeError("Invalid input for Fragment.fromJSON");return new at(r.map(e.nodeFromJSON))}static fromArray(e){if(!e.length)return at.empty;let r,n=0;for(let i=0;i<e.length;i++){let a=e[i];n+=a.nodeSize,i&&a.isText&&e[i-1].sameMarkup(a)?(r||(r=e.slice(0,i)),r[r.length-1]=a.withText(r[r.length-1].text+a.text)):r&&r.push(a)}return new at(r||e,n)}static from(e){if(!e)return at.empty;if(e instanceof at)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new at([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}at.empty=new at([],0);const eS={index:0,offset:0};function ky(t,e){return eS.index=t,eS.offset=e,eS}function Mx(t,e){if(t===e)return!0;if(!(t&&typeof t=="object")||!(e&&typeof e=="object"))return!1;let r=Array.isArray(t);if(Array.isArray(e)!=r)return!1;if(r){if(t.length!=e.length)return!1;for(let n=0;n<t.length;n++)if(!Mx(t[n],e[n]))return!1}else{for(let n in t)if(!(n in e)||!Mx(t[n],e[n]))return!1;for(let n in e)if(!(n in t))return!1}return!0}let wn=class gk{constructor(e,r){this.type=e,this.attrs=r}addToSet(e){let r,n=!1;for(let i=0;i<e.length;i++){let a=e[i];if(this.eq(a))return e;if(this.type.excludes(a.type))r||(r=e.slice(0,i));else{if(a.type.excludes(this.type))return e;!n&&a.type.rank>this.type.rank&&(r||(r=e.slice(0,i)),r.push(this),n=!0),r&&r.push(a)}}return r||(r=e.slice()),n||r.push(this),r}removeFromSet(e){for(let r=0;r<e.length;r++)if(this.eq(e[r]))return e.slice(0,r).concat(e.slice(r+1));return e}isInSet(e){for(let r=0;r<e.length;r++)if(this.eq(e[r]))return!0;return!1}eq(e){return this==e||this.type==e.type&&Mx(this.attrs,e.attrs)}toJSON(){let e={type:this.type.name};for(let r in this.attrs){e.attrs=this.attrs;break}return e}static fromJSON(e,r){if(!r)throw new RangeError("Invalid input for Mark.fromJSON");let n=e.marks[r.type];if(!n)throw new RangeError(`There is no mark type ${r.type} in this schema`);let i=n.create(r.attrs);return n.checkAttrs(i.attrs),i}static sameSet(e,r){if(e==r)return!0;if(e.length!=r.length)return!1;for(let n=0;n<e.length;n++)if(!e[n].eq(r[n]))return!1;return!0}static setFrom(e){if(!e||Array.isArray(e)&&e.length==0)return gk.none;if(e instanceof gk)return[e];let r=e.slice();return r.sort((n,i)=>n.type.rank-i.type.rank),r}};wn.none=[];class Ax extends Error{}class Ot{constructor(e,r,n){this.content=e,this.openStart=r,this.openEnd=n}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(e,r){let n=MR(this.content,e+this.openStart,r);return n&&new Ot(n,this.openStart,this.openEnd)}removeBetween(e,r){return new Ot(PR(this.content,e+this.openStart,r+this.openStart),this.openStart,this.openEnd)}eq(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e}static fromJSON(e,r){if(!r)return Ot.empty;let n=r.openStart||0,i=r.openEnd||0;if(typeof n!="number"||typeof i!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new Ot(at.fromJSON(e,r.content),n,i)}static maxOpen(e,r=!0){let n=0,i=0;for(let a=e.firstChild;a&&!a.isLeaf&&(r||!a.type.spec.isolating);a=a.firstChild)n++;for(let a=e.lastChild;a&&!a.isLeaf&&(r||!a.type.spec.isolating);a=a.lastChild)i++;return new Ot(e,n,i)}}Ot.empty=new Ot(at.empty,0,0);function PR(t,e,r){let{index:n,offset:i}=t.findIndex(e),a=t.maybeChild(n),{index:s,offset:o}=t.findIndex(r);if(i==e||a.isText){if(o!=r&&!t.child(s).isText)throw new RangeError("Removing non-flat range");return t.cut(0,e).append(t.cut(r))}if(n!=s)throw new RangeError("Removing non-flat range");return t.replaceChild(n,a.copy(PR(a.content,e-i-1,r-i-1)))}function MR(t,e,r,n){let{index:i,offset:a}=t.findIndex(e),s=t.maybeChild(i);if(a==e||s.isText)return n&&!n.canReplace(i,i,r)?null:t.cut(0,e).append(r).append(t.cut(e));let o=MR(s.content,e-a-1,r,s);return o&&t.replaceChild(i,s.copy(o))}function uZ(t,e,r){if(r.openStart>t.depth)throw new Ax("Inserted content deeper than insertion position");if(t.depth-r.openStart!=e.depth-r.openEnd)throw new Ax("Inconsistent open depths");return AR(t,e,r,0)}function AR(t,e,r,n){let i=t.index(n),a=t.node(n);if(i==e.index(n)&&n<t.depth-r.openStart){let s=AR(t,e,r,n+1);return a.copy(a.content.replaceChild(i,s))}else if(r.content.size)if(!r.openStart&&!r.openEnd&&t.depth==n&&e.depth==n){let s=t.parent,o=s.content;return lh(s,o.cut(0,t.parentOffset).append(r.content).append(o.cut(e.parentOffset)))}else{let{start:s,end:o}=cZ(r,t);return lh(a,RR(t,s,o,e,n))}else return lh(a,Lx(t,e,n))}function LR(t,e){if(!e.type.compatibleContent(t.type))throw new Ax("Cannot join "+e.type.name+" onto "+t.type.name)}function vk(t,e,r){let n=t.node(r);return LR(n,e.node(r)),n}function oh(t,e){let r=e.length-1;r>=0&&t.isText&&t.sameMarkup(e[r])?e[r]=t.withText(e[r].text+t.text):e.push(t)}function sv(t,e,r,n){let i=(e||t).node(r),a=0,s=e?e.index(r):i.childCount;t&&(a=t.index(r),t.depth>r?a++:t.textOffset&&(oh(t.nodeAfter,n),a++));for(let o=a;o<s;o++)oh(i.child(o),n);e&&e.depth==r&&e.textOffset&&oh(e.nodeBefore,n)}function lh(t,e){return t.type.checkContent(e),t.copy(e)}function RR(t,e,r,n,i){let a=t.depth>i&&vk(t,e,i+1),s=n.depth>i&&vk(r,n,i+1),o=[];return sv(null,t,i,o),a&&s&&e.index(i)==r.index(i)?(LR(a,s),oh(lh(a,RR(t,e,r,n,i+1)),o)):(a&&oh(lh(a,Lx(t,e,i+1)),o),sv(e,r,i,o),s&&oh(lh(s,Lx(r,n,i+1)),o)),sv(n,null,i,o),new at(o)}function Lx(t,e,r){let n=[];if(sv(null,t,r,n),t.depth>r){let i=vk(t,e,r+1);oh(lh(i,Lx(t,e,r+1)),n)}return sv(e,null,r,n),new at(n)}function cZ(t,e){let r=e.depth-t.openStart,i=e.node(r).copy(t.content);for(let a=r-1;a>=0;a--)i=e.node(a).copy(at.from(i));return{start:i.resolveNoCache(t.openStart+r),end:i.resolveNoCache(i.content.size-t.openEnd-r)}}class Dv{constructor(e,r,n){this.pos=e,this.path=r,this.parentOffset=n,this.depth=r.length/3-1}resolveDepth(e){return e==null?this.depth:e<0?this.depth+e:e}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(e){return this.path[this.resolveDepth(e)*3]}index(e){return this.path[this.resolveDepth(e)*3+1]}indexAfter(e){return e=this.resolveDepth(e),this.index(e)+(e==this.depth&&!this.textOffset?0:1)}start(e){return e=this.resolveDepth(e),e==0?0:this.path[e*3-1]+1}end(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size}before(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]}after(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]+this.path[e*3].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let e=this.parent,r=this.index(this.depth);if(r==e.childCount)return null;let n=this.pos-this.path[this.path.length-1],i=e.child(r);return n?e.child(r).cut(n):i}get nodeBefore(){let e=this.index(this.depth),r=this.pos-this.path[this.path.length-1];return r?this.parent.child(e).cut(0,r):e==0?null:this.parent.child(e-1)}posAtIndex(e,r){r=this.resolveDepth(r);let n=this.path[r*3],i=r==0?0:this.path[r*3-1]+1;for(let a=0;a<e;a++)i+=n.child(a).nodeSize;return i}marks(){let e=this.parent,r=this.index();if(e.content.size==0)return wn.none;if(this.textOffset)return e.child(r).marks;let n=e.maybeChild(r-1),i=e.maybeChild(r);if(!n){let o=n;n=i,i=o}let a=n.marks;for(var s=0;s<a.length;s++)a[s].type.spec.inclusive===!1&&(!i||!a[s].isInSet(i.marks))&&(a=a[s--].removeFromSet(a));return a}marksAcross(e){let r=this.parent.maybeChild(this.index());if(!r||!r.isInline)return null;let n=r.marks,i=e.parent.maybeChild(e.index());for(var a=0;a<n.length;a++)n[a].type.spec.inclusive===!1&&(!i||!n[a].isInSet(i.marks))&&(n=n[a--].removeFromSet(n));return n}sharedDepth(e){for(let r=this.depth;r>0;r--)if(this.start(r)<=e&&this.end(r)>=e)return r;return 0}blockRange(e=this,r){if(e.pos<this.pos)return e.blockRange(this);for(let n=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);n>=0;n--)if(e.pos<=this.end(n)&&(!r||r(this.node(n))))return new Rx(this,e,n);return null}sameParent(e){return this.pos-this.parentOffset==e.pos-e.parentOffset}max(e){return e.pos>this.pos?e:this}min(e){return e.pos<this.pos?e:this}toString(){let e="";for(let r=1;r<=this.depth;r++)e+=(e?"/":"")+this.node(r).type.name+"_"+this.index(r-1);return e+":"+this.parentOffset}static resolve(e,r){if(!(r>=0&&r<=e.content.size))throw new RangeError("Position "+r+" out of range");let n=[],i=0,a=r;for(let s=e;;){let{index:o,offset:l}=s.content.findIndex(a),u=a-l;if(n.push(s,o,i+l),!u||(s=s.child(o),s.isText))break;a=u-1,i+=l+1}return new Dv(r,n,a)}static resolveCached(e,r){let n=v3.get(e);if(n)for(let a=0;a<n.elts.length;a++){let s=n.elts[a];if(s.pos==r)return s}else v3.set(e,n=new dZ);let i=n.elts[n.i]=Dv.resolve(e,r);return n.i=(n.i+1)%fZ,i}}class dZ{constructor(){this.elts=[],this.i=0}}const fZ=12,v3=new WeakMap;class Rx{constructor(e,r,n){this.$from=e,this.$to=r,this.depth=n}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}const hZ=Object.create(null);class Qo{constructor(e,r,n,i=wn.none){this.type=e,this.attrs=r,this.marks=i,this.content=n||at.empty}get children(){return this.content.content}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(e){return this.content.child(e)}maybeChild(e){return this.content.maybeChild(e)}forEach(e){this.content.forEach(e)}nodesBetween(e,r,n,i=0){this.content.nodesBetween(e,r,n,i,this)}descendants(e){this.nodesBetween(0,this.content.size,e)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(e,r,n,i){return this.content.textBetween(e,r,n,i)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)}sameMarkup(e){return this.hasMarkup(e.type,e.attrs,e.marks)}hasMarkup(e,r,n){return this.type==e&&Mx(this.attrs,r||e.defaultAttrs||hZ)&&wn.sameSet(this.marks,n||wn.none)}copy(e=null){return e==this.content?this:new Qo(this.type,this.attrs,e,this.marks)}mark(e){return e==this.marks?this:new Qo(this.type,this.attrs,this.content,e)}cut(e,r=this.content.size){return e==0&&r==this.content.size?this:this.copy(this.content.cut(e,r))}slice(e,r=this.content.size,n=!1){if(e==r)return Ot.empty;let i=this.resolve(e),a=this.resolve(r),s=n?0:i.sharedDepth(r),o=i.start(s),u=i.node(s).content.cut(i.pos-o,a.pos-o);return new Ot(u,i.depth-s,a.depth-s)}replace(e,r,n){return uZ(this.resolve(e),this.resolve(r),n)}nodeAt(e){for(let r=this;;){let{index:n,offset:i}=r.content.findIndex(e);if(r=r.maybeChild(n),!r)return null;if(i==e||r.isText)return r;e-=i+1}}childAfter(e){let{index:r,offset:n}=this.content.findIndex(e);return{node:this.content.maybeChild(r),index:r,offset:n}}childBefore(e){if(e==0)return{node:null,index:0,offset:0};let{index:r,offset:n}=this.content.findIndex(e);if(n<e)return{node:this.content.child(r),index:r,offset:n};let i=this.content.child(r-1);return{node:i,index:r-1,offset:n-i.nodeSize}}resolve(e){return Dv.resolveCached(this,e)}resolveNoCache(e){return Dv.resolve(this,e)}rangeHasMark(e,r,n){let i=!1;return r>e&&this.nodesBetween(e,r,a=>(n.isInSet(a.marks)&&(i=!0),!i)),i}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),OR(this.marks,e)}contentMatchAt(e){let r=this.type.contentMatch.matchFragment(this.content,0,e);if(!r)throw new Error("Called contentMatchAt on a node with invalid content");return r}canReplace(e,r,n=at.empty,i=0,a=n.childCount){let s=this.contentMatchAt(e).matchFragment(n,i,a),o=s&&s.matchFragment(this.content,r);if(!o||!o.validEnd)return!1;for(let l=i;l<a;l++)if(!this.type.allowsMarks(n.child(l).marks))return!1;return!0}canReplaceWith(e,r,n,i){if(i&&!this.type.allowsMarks(i))return!1;let a=this.contentMatchAt(e).matchType(n),s=a&&a.matchFragment(this.content,r);return s?s.validEnd:!1}canAppend(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let e=wn.none;for(let r=0;r<this.marks.length;r++){let n=this.marks[r];n.type.checkAttrs(n.attrs),e=n.addToSet(e)}if(!wn.sameSet(e,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(r=>r.type.name)}`);this.content.forEach(r=>r.check())}toJSON(){let e={type:this.type.name};for(let r in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map(r=>r.toJSON())),e}static fromJSON(e,r){if(!r)throw new RangeError("Invalid input for Node.fromJSON");let n;if(r.marks){if(!Array.isArray(r.marks))throw new RangeError("Invalid mark data for Node.fromJSON");n=r.marks.map(e.markFromJSON)}if(r.type=="text"){if(typeof r.text!="string")throw new RangeError("Invalid text node in JSON");return e.text(r.text,n)}let i=at.fromJSON(e,r.content),a=e.nodeType(r.type).create(r.attrs,i,n);return a.type.checkAttrs(a.attrs),a}}Qo.prototype.text=void 0;class Ox extends Qo{constructor(e,r,n,i){if(super(e,r,null,i),!n)throw new RangeError("Empty text nodes are not allowed");this.text=n}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):OR(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(e,r){return this.text.slice(e,r)}get nodeSize(){return this.text.length}mark(e){return e==this.marks?this:new Ox(this.type,this.attrs,this.text,e)}withText(e){return e==this.text?this:new Ox(this.type,this.attrs,e,this.marks)}cut(e=0,r=this.text.length){return e==0&&r==this.text.length?this:this.withText(this.text.slice(e,r))}eq(e){return this.sameMarkup(e)&&this.text==e.text}toJSON(){let e=super.toJSON();return e.text=this.text,e}}function OR(t,e){for(let r=t.length-1;r>=0;r--)e=t[r].type.name+"("+e+")";return e}class wh{constructor(e){this.validEnd=e,this.next=[],this.wrapCache=[]}static parse(e,r){let n=new pZ(e,r);if(n.next==null)return wh.empty;let i=DR(n);n.next&&n.err("Unexpected trailing text");let a=wZ(bZ(i));return SZ(a,n),a}matchType(e){for(let r=0;r<this.next.length;r++)if(this.next[r].type==e)return this.next[r].next;return null}matchFragment(e,r=0,n=e.childCount){let i=this;for(let a=r;i&&a<n;a++)i=i.matchType(e.child(a).type);return i}get inlineContent(){return this.next.length!=0&&this.next[0].type.isInline}get defaultType(){for(let e=0;e<this.next.length;e++){let{type:r}=this.next[e];if(!(r.isText||r.hasRequiredAttrs()))return r}return null}compatible(e){for(let r=0;r<this.next.length;r++)for(let n=0;n<e.next.length;n++)if(this.next[r].type==e.next[n].type)return!0;return!1}fillBefore(e,r=!1,n=0){let i=[this];function a(s,o){let l=s.matchFragment(e,n);if(l&&(!r||l.validEnd))return at.from(o.map(u=>u.createAndFill()));for(let u=0;u<s.next.length;u++){let{type:c,next:f}=s.next[u];if(!(c.isText||c.hasRequiredAttrs())&&i.indexOf(f)==-1){i.push(f);let p=a(f,o.concat(c));if(p)return p}}return null}return a(this,[])}findWrapping(e){for(let n=0;n<this.wrapCache.length;n+=2)if(this.wrapCache[n]==e)return this.wrapCache[n+1];let r=this.computeWrapping(e);return this.wrapCache.push(e,r),r}computeWrapping(e){let r=Object.create(null),n=[{match:this,type:null,via:null}];for(;n.length;){let i=n.shift(),a=i.match;if(a.matchType(e)){let s=[];for(let o=i;o.type;o=o.via)s.push(o.type);return s.reverse()}for(let s=0;s<a.next.length;s++){let{type:o,next:l}=a.next[s];!o.isLeaf&&!o.hasRequiredAttrs()&&!(o.name in r)&&(!i.type||l.validEnd)&&(n.push({match:o.contentMatch,type:o,via:i}),r[o.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(e){if(e>=this.next.length)throw new RangeError(`There's no ${e}th edge in this content match`);return this.next[e]}toString(){let e=[];function r(n){e.push(n);for(let i=0;i<n.next.length;i++)e.indexOf(n.next[i].next)==-1&&r(n.next[i].next)}return r(this),e.map((n,i)=>{let a=i+(n.validEnd?"*":" ")+" ";for(let s=0;s<n.next.length;s++)a+=(s?", ":"")+n.next[s].type.name+"->"+e.indexOf(n.next[s].next);return a}).join(`
`)}}wh.empty=new wh(!0);class pZ{constructor(e,r){this.string=e,this.nodeTypes=r,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(e){return this.next==e&&(this.pos++||!0)}err(e){throw new SyntaxError(e+" (in content expression '"+this.string+"')")}}function DR(t){let e=[];do e.push(mZ(t));while(t.eat("|"));return e.length==1?e[0]:{type:"choice",exprs:e}}function mZ(t){let e=[];do e.push(gZ(t));while(t.next&&t.next!=")"&&t.next!="|");return e.length==1?e[0]:{type:"seq",exprs:e}}function gZ(t){let e=xZ(t);for(;;)if(t.eat("+"))e={type:"plus",expr:e};else if(t.eat("*"))e={type:"star",expr:e};else if(t.eat("?"))e={type:"opt",expr:e};else if(t.eat("{"))e=vZ(t,e);else break;return e}function y3(t){/\D/.test(t.next)&&t.err("Expected number, got '"+t.next+"'");let e=Number(t.next);return t.pos++,e}function vZ(t,e){let r=y3(t),n=r;return t.eat(",")&&(t.next!="}"?n=y3(t):n=-1),t.eat("}")||t.err("Unclosed braced range"),{type:"range",min:r,max:n,expr:e}}function yZ(t,e){let r=t.nodeTypes,n=r[e];if(n)return[n];let i=[];for(let a in r){let s=r[a];s.isInGroup(e)&&i.push(s)}return i.length==0&&t.err("No node type or group '"+e+"' found"),i}function xZ(t){if(t.eat("(")){let e=DR(t);return t.eat(")")||t.err("Missing closing paren"),e}else if(/\W/.test(t.next))t.err("Unexpected token '"+t.next+"'");else{let e=yZ(t,t.next).map(r=>(t.inline==null?t.inline=r.isInline:t.inline!=r.isInline&&t.err("Mixing inline and block content"),{type:"name",value:r}));return t.pos++,e.length==1?e[0]:{type:"choice",exprs:e}}}function bZ(t){let e=[[]];return i(a(t,0),r()),e;function r(){return e.push([])-1}function n(s,o,l){let u={term:l,to:o};return e[s].push(u),u}function i(s,o){s.forEach(l=>l.to=o)}function a(s,o){if(s.type=="choice")return s.exprs.reduce((l,u)=>l.concat(a(u,o)),[]);if(s.type=="seq")for(let l=0;;l++){let u=a(s.exprs[l],o);if(l==s.exprs.length-1)return u;i(u,o=r())}else if(s.type=="star"){let l=r();return n(o,l),i(a(s.expr,l),l),[n(l)]}else if(s.type=="plus"){let l=r();return i(a(s.expr,o),l),i(a(s.expr,l),l),[n(l)]}else{if(s.type=="opt")return[n(o)].concat(a(s.expr,o));if(s.type=="range"){let l=o;for(let u=0;u<s.min;u++){let c=r();i(a(s.expr,l),c),l=c}if(s.max==-1)i(a(s.expr,l),l);else for(let u=s.min;u<s.max;u++){let c=r();n(l,c),i(a(s.expr,l),c),l=c}return[n(l)]}else{if(s.type=="name")return[n(o,void 0,s.value)];throw new Error("Unknown expr type")}}}}function IR(t,e){return e-t}function x3(t,e){let r=[];return n(e),r.sort(IR);function n(i){let a=t[i];if(a.length==1&&!a[0].term)return n(a[0].to);r.push(i);for(let s=0;s<a.length;s++){let{term:o,to:l}=a[s];!o&&r.indexOf(l)==-1&&n(l)}}}function wZ(t){let e=Object.create(null);return r(x3(t,0));function r(n){let i=[];n.forEach(s=>{t[s].forEach(({term:o,to:l})=>{if(!o)return;let u;for(let c=0;c<i.length;c++)i[c][0]==o&&(u=i[c][1]);x3(t,l).forEach(c=>{u||i.push([o,u=[]]),u.indexOf(c)==-1&&u.push(c)})})});let a=e[n.join(",")]=new wh(n.indexOf(t.length-1)>-1);for(let s=0;s<i.length;s++){let o=i[s][1].sort(IR);a.next.push({type:i[s][0],next:e[o.join(",")]||r(o)})}return a}}function SZ(t,e){for(let r=0,n=[t];r<n.length;r++){let i=n[r],a=!i.validEnd,s=[];for(let o=0;o<i.next.length;o++){let{type:l,next:u}=i.next[o];s.push(l.name),a&&!(l.isText||l.hasRequiredAttrs())&&(a=!1),n.indexOf(u)==-1&&n.push(u)}a&&e.err("Only non-generatable nodes ("+s.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function jR(t){let e=Object.create(null);for(let r in t){let n=t[r];if(!n.hasDefault)return null;e[r]=n.default}return e}function FR(t,e){let r=Object.create(null);for(let n in t){let i=e&&e[n];if(i===void 0){let a=t[n];if(a.hasDefault)i=a.default;else throw new RangeError("No value supplied for attribute "+n)}r[n]=i}return r}function BR(t,e,r,n){for(let i in e)if(!(i in t))throw new RangeError(`Unsupported attribute ${i} for ${r} of type ${i}`);for(let i in t){let a=t[i];a.validate&&a.validate(e[i])}}function zR(t,e){let r=Object.create(null);if(e)for(let n in e)r[n]=new _Z(t,n,e[n]);return r}let b3=class UR{constructor(e,r,n){this.name=e,this.schema=r,this.spec=n,this.markSet=null,this.groups=n.group?n.group.split(" "):[],this.attrs=zR(e,n.attrs),this.defaultAttrs=jR(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(n.inline||e=="text"),this.isText=e=="text"}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==wh.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}isInGroup(e){return this.groups.indexOf(e)>-1}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1}compatibleContent(e){return this==e||this.contentMatch.compatible(e.contentMatch)}computeAttrs(e){return!e&&this.defaultAttrs?this.defaultAttrs:FR(this.attrs,e)}create(e=null,r,n){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new Qo(this,this.computeAttrs(e),at.from(r),wn.setFrom(n))}createChecked(e=null,r,n){return r=at.from(r),this.checkContent(r),new Qo(this,this.computeAttrs(e),r,wn.setFrom(n))}createAndFill(e=null,r,n){if(e=this.computeAttrs(e),r=at.from(r),r.size){let s=this.contentMatch.fillBefore(r);if(!s)return null;r=s.append(r)}let i=this.contentMatch.matchFragment(r),a=i&&i.fillBefore(at.empty,!0);return a?new Qo(this,e,r.append(a),wn.setFrom(n)):null}validContent(e){let r=this.contentMatch.matchFragment(e);if(!r||!r.validEnd)return!1;for(let n=0;n<e.childCount;n++)if(!this.allowsMarks(e.child(n).marks))return!1;return!0}checkContent(e){if(!this.validContent(e))throw new RangeError(`Invalid content for node ${this.name}: ${e.toString().slice(0,50)}`)}checkAttrs(e){BR(this.attrs,e,"node",this.name)}allowsMarkType(e){return this.markSet==null||this.markSet.indexOf(e)>-1}allowsMarks(e){if(this.markSet==null)return!0;for(let r=0;r<e.length;r++)if(!this.allowsMarkType(e[r].type))return!1;return!0}allowedMarks(e){if(this.markSet==null)return e;let r;for(let n=0;n<e.length;n++)this.allowsMarkType(e[n].type)?r&&r.push(e[n]):r||(r=e.slice(0,n));return r?r.length?r:wn.none:e}static compile(e,r){let n=Object.create(null);e.forEach((a,s)=>n[a]=new UR(a,r,s));let i=r.spec.topNode||"doc";if(!n[i])throw new RangeError("Schema is missing its top node type ('"+i+"')");if(!n.text)throw new RangeError("Every schema needs a 'text' type");for(let a in n.text.attrs)throw new RangeError("The text node type should not have attributes");return n}};function kZ(t,e,r){let n=r.split("|");return i=>{let a=i===null?"null":typeof i;if(n.indexOf(a)<0)throw new RangeError(`Expected value of type ${n} for attribute ${e} on type ${t}, got ${a}`)}}class _Z{constructor(e,r,n){this.hasDefault=Object.prototype.hasOwnProperty.call(n,"default"),this.default=n.default,this.validate=typeof n.validate=="string"?kZ(e,r,n.validate):n.validate}get isRequired(){return!this.hasDefault}}class Y1{constructor(e,r,n,i){this.name=e,this.rank=r,this.schema=n,this.spec=i,this.attrs=zR(e,i.attrs),this.excluded=null;let a=jR(this.attrs);this.instance=a?new wn(this,a):null}create(e=null){return!e&&this.instance?this.instance:new wn(this,FR(this.attrs,e))}static compile(e,r){let n=Object.create(null),i=0;return e.forEach((a,s)=>n[a]=new Y1(a,i++,r,s)),n}removeFromSet(e){for(var r=0;r<e.length;r++)e[r].type==this&&(e=e.slice(0,r).concat(e.slice(r+1)),r--);return e}isInSet(e){for(let r=0;r<e.length;r++)if(e[r].type==this)return e[r]}checkAttrs(e){BR(this.attrs,e,"mark",this.name)}excludes(e){return this.excluded.indexOf(e)>-1}}class GR{constructor(e){this.linebreakReplacement=null,this.cached=Object.create(null);let r=this.spec={};for(let i in e)r[i]=e[i];r.nodes=Ia.from(e.nodes),r.marks=Ia.from(e.marks||{}),this.nodes=b3.compile(this.spec.nodes,this),this.marks=Y1.compile(this.spec.marks,this);let n=Object.create(null);for(let i in this.nodes){if(i in this.marks)throw new RangeError(i+" can not be both a node and a mark");let a=this.nodes[i],s=a.spec.content||"",o=a.spec.marks;if(a.contentMatch=n[s]||(n[s]=wh.parse(s,this.nodes)),a.inlineContent=a.contentMatch.inlineContent,a.spec.linebreakReplacement){if(this.linebreakReplacement)throw new RangeError("Multiple linebreak nodes defined");if(!a.isInline||!a.isLeaf)throw new RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=a}a.markSet=o=="_"?null:o?w3(this,o.split(" ")):o==""||!a.inlineContent?[]:null}for(let i in this.marks){let a=this.marks[i],s=a.spec.excludes;a.excluded=s==null?[a]:s==""?[]:w3(this,s.split(" "))}this.nodeFromJSON=i=>Qo.fromJSON(this,i),this.markFromJSON=i=>wn.fromJSON(this,i),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(e,r=null,n,i){if(typeof e=="string")e=this.nodeType(e);else if(e instanceof b3){if(e.schema!=this)throw new RangeError("Node type from different schema used ("+e.name+")")}else throw new RangeError("Invalid node type: "+e);return e.createChecked(r,n,i)}text(e,r){let n=this.nodes.text;return new Ox(n,n.defaultAttrs,e,wn.setFrom(r))}mark(e,r){return typeof e=="string"&&(e=this.marks[e]),e.create(r)}nodeType(e){let r=this.nodes[e];if(!r)throw new RangeError("Unknown node type: "+e);return r}}function w3(t,e){let r=[];for(let n=0;n<e.length;n++){let i=e[n],a=t.marks[i],s=a;if(a)r.push(a);else for(let o in t.marks){let l=t.marks[o];(i=="_"||l.spec.group&&l.spec.group.split(" ").indexOf(i)>-1)&&r.push(s=l)}if(!s)throw new SyntaxError("Unknown mark type: '"+e[n]+"'")}return r}function CZ(t){return t.tag!=null}function EZ(t){return t.style!=null}class Hd{constructor(e,r){this.schema=e,this.rules=r,this.tags=[],this.styles=[];let n=this.matchedStyles=[];r.forEach(i=>{if(CZ(i))this.tags.push(i);else if(EZ(i)){let a=/[^=]*/.exec(i.style)[0];n.indexOf(a)<0&&n.push(a),this.styles.push(i)}}),this.normalizeLists=!this.tags.some(i=>{if(!/^(ul|ol)\b/.test(i.tag)||!i.node)return!1;let a=e.nodes[i.node];return a.contentMatch.matchType(a)})}parse(e,r={}){let n=new k3(this,r,!1);return n.addAll(e,wn.none,r.from,r.to),n.finish()}parseSlice(e,r={}){let n=new k3(this,r,!0);return n.addAll(e,wn.none,r.from,r.to),Ot.maxOpen(n.finish())}matchTag(e,r,n){for(let i=n?this.tags.indexOf(n)+1:0;i<this.tags.length;i++){let a=this.tags[i];if(PZ(e,a.tag)&&(a.namespace===void 0||e.namespaceURI==a.namespace)&&(!a.context||r.matchesContext(a.context))){if(a.getAttrs){let s=a.getAttrs(e);if(s===!1)continue;a.attrs=s||void 0}return a}}}matchStyle(e,r,n,i){for(let a=i?this.styles.indexOf(i)+1:0;a<this.styles.length;a++){let s=this.styles[a],o=s.style;if(!(o.indexOf(e)!=0||s.context&&!n.matchesContext(s.context)||o.length>e.length&&(o.charCodeAt(e.length)!=61||o.slice(e.length+1)!=r))){if(s.getAttrs){let l=s.getAttrs(r);if(l===!1)continue;s.attrs=l||void 0}return s}}}static schemaRules(e){let r=[];function n(i){let a=i.priority==null?50:i.priority,s=0;for(;s<r.length;s++){let o=r[s];if((o.priority==null?50:o.priority)<a)break}r.splice(s,0,i)}for(let i in e.marks){let a=e.marks[i].spec.parseDOM;a&&a.forEach(s=>{n(s=_3(s)),s.mark||s.ignore||s.clearMark||(s.mark=i)})}for(let i in e.nodes){let a=e.nodes[i].spec.parseDOM;a&&a.forEach(s=>{n(s=_3(s)),s.node||s.ignore||s.mark||(s.node=i)})}return r}static fromSchema(e){return e.cached.domParser||(e.cached.domParser=new Hd(e,Hd.schemaRules(e)))}}const VR={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},TZ={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},HR={ol:!0,ul:!0},Iv=1,yk=2,ov=4;function S3(t,e,r){return e!=null?(e?Iv:0)|(e==="full"?yk:0):t&&t.whitespace=="pre"?Iv|yk:r&~ov}class _y{constructor(e,r,n,i,a,s){this.type=e,this.attrs=r,this.marks=n,this.solid=i,this.options=s,this.content=[],this.activeMarks=wn.none,this.match=a||(s&ov?null:e.contentMatch)}findWrapping(e){if(!this.match){if(!this.type)return[];let r=this.type.contentMatch.fillBefore(at.from(e));if(r)this.match=this.type.contentMatch.matchFragment(r);else{let n=this.type.contentMatch,i;return(i=n.findWrapping(e.type))?(this.match=n,i):null}}return this.match.findWrapping(e.type)}finish(e){if(!(this.options&Iv)){let n=this.content[this.content.length-1],i;if(n&&n.isText&&(i=/[ \t\r\n\u000c]+$/.exec(n.text))){let a=n;n.text.length==i[0].length?this.content.pop():this.content[this.content.length-1]=a.withText(a.text.slice(0,a.text.length-i[0].length))}}let r=at.from(this.content);return!e&&this.match&&(r=r.append(this.match.fillBefore(at.empty,!0))),this.type?this.type.create(this.attrs,r,this.marks):r}inlineContext(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!VR.hasOwnProperty(e.parentNode.nodeName.toLowerCase())}}class k3{constructor(e,r,n){this.parser=e,this.options=r,this.isOpen=n,this.open=0,this.localPreserveWS=!1;let i=r.topNode,a,s=S3(null,r.preserveWhitespace,0)|(n?ov:0);i?a=new _y(i.type,i.attrs,wn.none,!0,r.topMatch||i.type.contentMatch,s):n?a=new _y(null,null,wn.none,!0,null,s):a=new _y(e.schema.topNodeType,null,wn.none,!0,null,s),this.nodes=[a],this.find=r.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(e,r){e.nodeType==3?this.addTextNode(e,r):e.nodeType==1&&this.addElement(e,r)}addTextNode(e,r){let n=e.nodeValue,i=this.top,a=i.options&yk?"full":this.localPreserveWS||(i.options&Iv)>0,{schema:s}=this.parser;if(a==="full"||i.inlineContext(e)||/[^ \t\r\n\u000c]/.test(n)){if(a)if(a==="full")n=n.replace(/\r\n?/g,`
`);else if(s.linebreakReplacement&&/[\r\n]/.test(n)&&this.top.findWrapping(s.linebreakReplacement.create())){let o=n.split(/\r?\n|\r/);for(let l=0;l<o.length;l++)l&&this.insertNode(s.linebreakReplacement.create(),r,!0),o[l]&&this.insertNode(s.text(o[l]),r,!/\S/.test(o[l]));n=""}else n=n.replace(/\r?\n|\r/g," ");else if(n=n.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(n)&&this.open==this.nodes.length-1){let o=i.content[i.content.length-1],l=e.previousSibling;(!o||l&&l.nodeName=="BR"||o.isText&&/[ \t\r\n\u000c]$/.test(o.text))&&(n=n.slice(1))}n&&this.insertNode(s.text(n),r,!/\S/.test(n)),this.findInText(e)}else this.findInside(e)}addElement(e,r,n){let i=this.localPreserveWS,a=this.top;(e.tagName=="PRE"||/pre/.test(e.style&&e.style.whiteSpace))&&(this.localPreserveWS=!0);let s=e.nodeName.toLowerCase(),o;HR.hasOwnProperty(s)&&this.parser.normalizeLists&&NZ(e);let l=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(o=this.parser.matchTag(e,this,n));e:if(l?l.ignore:TZ.hasOwnProperty(s))this.findInside(e),this.ignoreFallback(e,r);else if(!l||l.skip||l.closeParent){l&&l.closeParent?this.open=Math.max(0,this.open-1):l&&l.skip.nodeType&&(e=l.skip);let u,c=this.needsBlock;if(VR.hasOwnProperty(s))a.content.length&&a.content[0].isInline&&this.open&&(this.open--,a=this.top),u=!0,a.type||(this.needsBlock=!0);else if(!e.firstChild){this.leafFallback(e,r);break e}let f=l&&l.skip?r:this.readStyles(e,r);f&&this.addAll(e,f),u&&this.sync(a),this.needsBlock=c}else{let u=this.readStyles(e,r);u&&this.addElementByRule(e,l,u,l.consuming===!1?o:void 0)}this.localPreserveWS=i}leafFallback(e,r){e.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode(`
`),r)}ignoreFallback(e,r){e.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"),r,!0)}readStyles(e,r){let n=e.style;if(n&&n.length)for(let i=0;i<this.parser.matchedStyles.length;i++){let a=this.parser.matchedStyles[i],s=n.getPropertyValue(a);if(s)for(let o=void 0;;){let l=this.parser.matchStyle(a,s,this,o);if(!l)break;if(l.ignore)return null;if(l.clearMark?r=r.filter(u=>!l.clearMark(u)):r=r.concat(this.parser.schema.marks[l.mark].create(l.attrs)),l.consuming===!1)o=l;else break}}return r}addElementByRule(e,r,n,i){let a,s;if(r.node)if(s=this.parser.schema.nodes[r.node],s.isLeaf)this.insertNode(s.create(r.attrs),n,e.nodeName=="BR")||this.leafFallback(e,n);else{let l=this.enter(s,r.attrs||null,n,r.preserveWhitespace);l&&(a=!0,n=l)}else{let l=this.parser.schema.marks[r.mark];n=n.concat(l.create(r.attrs))}let o=this.top;if(s&&s.isLeaf)this.findInside(e);else if(i)this.addElement(e,n,i);else if(r.getContent)this.findInside(e),r.getContent(e,this.parser.schema).forEach(l=>this.insertNode(l,n,!1));else{let l=e;typeof r.contentElement=="string"?l=e.querySelector(r.contentElement):typeof r.contentElement=="function"?l=r.contentElement(e):r.contentElement&&(l=r.contentElement),this.findAround(e,l,!0),this.addAll(l,n),this.findAround(e,l,!1)}a&&this.sync(o)&&this.open--}addAll(e,r,n,i){let a=n||0;for(let s=n?e.childNodes[n]:e.firstChild,o=i==null?null:e.childNodes[i];s!=o;s=s.nextSibling,++a)this.findAtPoint(e,a),this.addDOM(s,r);this.findAtPoint(e,a)}findPlace(e,r,n){let i,a;for(let s=this.open,o=0;s>=0;s--){let l=this.nodes[s],u=l.findWrapping(e);if(u&&(!i||i.length>u.length+o)&&(i=u,a=l,!u.length))break;if(l.solid){if(n)break;o+=2}}if(!i)return null;this.sync(a);for(let s=0;s<i.length;s++)r=this.enterInner(i[s],null,r,!1);return r}insertNode(e,r,n){if(e.isInline&&this.needsBlock&&!this.top.type){let a=this.textblockFromContext();a&&(r=this.enterInner(a,null,r))}let i=this.findPlace(e,r,n);if(i){this.closeExtra();let a=this.top;a.match&&(a.match=a.match.matchType(e.type));let s=wn.none;for(let o of i.concat(e.marks))(a.type?a.type.allowsMarkType(o.type):C3(o.type,e.type))&&(s=o.addToSet(s));return a.content.push(e.mark(s)),!0}return!1}enter(e,r,n,i){let a=this.findPlace(e.create(r),n,!1);return a&&(a=this.enterInner(e,r,n,!0,i)),a}enterInner(e,r,n,i=!1,a){this.closeExtra();let s=this.top;s.match=s.match&&s.match.matchType(e);let o=S3(e,a,s.options);s.options&ov&&s.content.length==0&&(o|=ov);let l=wn.none;return n=n.filter(u=>(s.type?s.type.allowsMarkType(u.type):C3(u.type,e))?(l=u.addToSet(l),!1):!0),this.nodes.push(new _y(e,r,l,i,null,o)),this.open++,n}closeExtra(e=!1){let r=this.nodes.length-1;if(r>this.open){for(;r>this.open;r--)this.nodes[r-1].content.push(this.nodes[r].finish(e));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(!!(this.isOpen||this.options.topOpen))}sync(e){for(let r=this.open;r>=0;r--){if(this.nodes[r]==e)return this.open=r,!0;this.localPreserveWS&&(this.nodes[r].options|=Iv)}return!1}get currentPos(){this.closeExtra();let e=0;for(let r=this.open;r>=0;r--){let n=this.nodes[r].content;for(let i=n.length-1;i>=0;i--)e+=n[i].nodeSize;r&&e++}return e}findAtPoint(e,r){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].node==e&&this.find[n].offset==r&&(this.find[n].pos=this.currentPos)}findInside(e){if(this.find)for(let r=0;r<this.find.length;r++)this.find[r].pos==null&&e.nodeType==1&&e.contains(this.find[r].node)&&(this.find[r].pos=this.currentPos)}findAround(e,r,n){if(e!=r&&this.find)for(let i=0;i<this.find.length;i++)this.find[i].pos==null&&e.nodeType==1&&e.contains(this.find[i].node)&&r.compareDocumentPosition(this.find[i].node)&(n?2:4)&&(this.find[i].pos=this.currentPos)}findInText(e){if(this.find)for(let r=0;r<this.find.length;r++)this.find[r].node==e&&(this.find[r].pos=this.currentPos-(e.nodeValue.length-this.find[r].offset))}matchesContext(e){if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);let r=e.split("/"),n=this.options.context,i=!this.isOpen&&(!n||n.parent.type==this.nodes[0].type),a=-(n?n.depth+1:0)+(i?0:1),s=(o,l)=>{for(;o>=0;o--){let u=r[o];if(u==""){if(o==r.length-1||o==0)continue;for(;l>=a;l--)if(s(o-1,l))return!0;return!1}else{let c=l>0||l==0&&i?this.nodes[l].type:n&&l>=a?n.node(l-a).type:null;if(!c||c.name!=u&&!c.isInGroup(u))return!1;l--}}return!0};return s(r.length-1,this.open)}textblockFromContext(){let e=this.options.context;if(e)for(let r=e.depth;r>=0;r--){let n=e.node(r).contentMatchAt(e.indexAfter(r)).defaultType;if(n&&n.isTextblock&&n.defaultAttrs)return n}for(let r in this.parser.schema.nodes){let n=this.parser.schema.nodes[r];if(n.isTextblock&&n.defaultAttrs)return n}}}function NZ(t){for(let e=t.firstChild,r=null;e;e=e.nextSibling){let n=e.nodeType==1?e.nodeName.toLowerCase():null;n&&HR.hasOwnProperty(n)&&r?(r.appendChild(e),e=r):n=="li"?r=e:n&&(r=null)}}function PZ(t,e){return(t.matches||t.msMatchesSelector||t.webkitMatchesSelector||t.mozMatchesSelector).call(t,e)}function _3(t){let e={};for(let r in t)e[r]=t[r];return e}function C3(t,e){let r=e.schema.nodes;for(let n in r){let i=r[n];if(!i.allowsMarkType(t))continue;let a=[],s=o=>{a.push(o);for(let l=0;l<o.edgeCount;l++){let{type:u,next:c}=o.edge(l);if(u==e||a.indexOf(c)<0&&s(c))return!0}};if(s(i.contentMatch))return!0}}class Mh{constructor(e,r){this.nodes=e,this.marks=r}serializeFragment(e,r={},n){n||(n=tS(r).createDocumentFragment());let i=n,a=[];return e.forEach(s=>{if(a.length||s.marks.length){let o=0,l=0;for(;o<a.length&&l<s.marks.length;){let u=s.marks[l];if(!this.marks[u.type.name]){l++;continue}if(!u.eq(a[o][0])||u.type.spec.spanning===!1)break;o++,l++}for(;o<a.length;)i=a.pop()[1];for(;l<s.marks.length;){let u=s.marks[l++],c=this.serializeMark(u,s.isInline,r);c&&(a.push([u,i]),i.appendChild(c.dom),i=c.contentDOM||c.dom)}}i.appendChild(this.serializeNodeInner(s,r))}),n}serializeNodeInner(e,r){let{dom:n,contentDOM:i}=Qy(tS(r),this.nodes[e.type.name](e),null,e.attrs);if(i){if(e.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(e.content,r,i)}return n}serializeNode(e,r={}){let n=this.serializeNodeInner(e,r);for(let i=e.marks.length-1;i>=0;i--){let a=this.serializeMark(e.marks[i],e.isInline,r);a&&((a.contentDOM||a.dom).appendChild(n),n=a.dom)}return n}serializeMark(e,r,n={}){let i=this.marks[e.type.name];return i&&Qy(tS(n),i(e,r),null,e.attrs)}static renderSpec(e,r,n=null,i){return Qy(e,r,n,i)}static fromSchema(e){return e.cached.domSerializer||(e.cached.domSerializer=new Mh(this.nodesFromSchema(e),this.marksFromSchema(e)))}static nodesFromSchema(e){let r=E3(e.nodes);return r.text||(r.text=n=>n.text),r}static marksFromSchema(e){return E3(e.marks)}}function E3(t){let e={};for(let r in t){let n=t[r].spec.toDOM;n&&(e[r]=n)}return e}function tS(t){return t.document||window.document}const T3=new WeakMap;function MZ(t){let e=T3.get(t);return e===void 0&&T3.set(t,e=AZ(t)),e}function AZ(t){let e=null;function r(n){if(n&&typeof n=="object")if(Array.isArray(n))if(typeof n[0]=="string")e||(e=[]),e.push(n);else for(let i=0;i<n.length;i++)r(n[i]);else for(let i in n)r(n[i])}return r(t),e}function Qy(t,e,r,n){if(typeof e=="string")return{dom:t.createTextNode(e)};if(e.nodeType!=null)return{dom:e};if(e.dom&&e.dom.nodeType!=null)return e;let i=e[0],a;if(typeof i!="string")throw new RangeError("Invalid array passed to renderSpec");if(n&&(a=MZ(n))&&a.indexOf(e)>-1)throw new RangeError("Using an array from an attribute object as a DOM spec. This may be an attempted cross site scripting attack.");let s=i.indexOf(" ");s>0&&(r=i.slice(0,s),i=i.slice(s+1));let o,l=r?t.createElementNS(r,i):t.createElement(i),u=e[1],c=1;if(u&&typeof u=="object"&&u.nodeType==null&&!Array.isArray(u)){c=2;for(let f in u)if(u[f]!=null){let p=f.indexOf(" ");p>0?l.setAttributeNS(f.slice(0,p),f.slice(p+1),u[f]):f=="style"&&l.style?l.style.cssText=u[f]:l.setAttribute(f,u[f])}}for(let f=c;f<e.length;f++){let p=e[f];if(p===0){if(f<e.length-1||f>c)throw new RangeError("Content hole must be the only child of its parent node");return{dom:l,contentDOM:l}}else{let{dom:g,contentDOM:y}=Qy(t,p,r,n);if(l.appendChild(g),y){if(o)throw new RangeError("Multiple content holes");o=y}}}return{dom:l,contentDOM:o}}const WR=65535,qR=Math.pow(2,16);function LZ(t,e){return t+e*qR}function N3(t){return t&WR}function RZ(t){return(t-(t&WR))/qR}const $R=1,KR=2,Jy=4,ZR=8;class xk{constructor(e,r,n){this.pos=e,this.delInfo=r,this.recover=n}get deleted(){return(this.delInfo&ZR)>0}get deletedBefore(){return(this.delInfo&($R|Jy))>0}get deletedAfter(){return(this.delInfo&(KR|Jy))>0}get deletedAcross(){return(this.delInfo&Jy)>0}}class go{constructor(e,r=!1){if(this.ranges=e,this.inverted=r,!e.length&&go.empty)return go.empty}recover(e){let r=0,n=N3(e);if(!this.inverted)for(let i=0;i<n;i++)r+=this.ranges[i*3+2]-this.ranges[i*3+1];return this.ranges[n*3]+r+RZ(e)}mapResult(e,r=1){return this._map(e,r,!1)}map(e,r=1){return this._map(e,r,!0)}_map(e,r,n){let i=0,a=this.inverted?2:1,s=this.inverted?1:2;for(let o=0;o<this.ranges.length;o+=3){let l=this.ranges[o]-(this.inverted?i:0);if(l>e)break;let u=this.ranges[o+a],c=this.ranges[o+s],f=l+u;if(e<=f){let p=u?e==l?-1:e==f?1:r:r,g=l+i+(p<0?0:c);if(n)return g;let y=e==(r<0?l:f)?null:LZ(o/3,e-l),S=e==l?KR:e==f?$R:Jy;return(r<0?e!=l:e!=f)&&(S|=ZR),new xk(g,S,y)}i+=c-u}return n?e+i:new xk(e+i,0,null)}touches(e,r){let n=0,i=N3(r),a=this.inverted?2:1,s=this.inverted?1:2;for(let o=0;o<this.ranges.length;o+=3){let l=this.ranges[o]-(this.inverted?n:0);if(l>e)break;let u=this.ranges[o+a],c=l+u;if(e<=c&&o==i*3)return!0;n+=this.ranges[o+s]-u}return!1}forEach(e){let r=this.inverted?2:1,n=this.inverted?1:2;for(let i=0,a=0;i<this.ranges.length;i+=3){let s=this.ranges[i],o=s-(this.inverted?a:0),l=s+(this.inverted?0:a),u=this.ranges[i+r],c=this.ranges[i+n];e(o,o+u,l,l+c),a+=c-u}}invert(){return new go(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(e){return e==0?go.empty:new go(e<0?[0,-e,0]:[0,0,e])}}go.empty=new go([]);class jv{constructor(e,r,n=0,i=e?e.length:0){this.mirror=r,this.from=n,this.to=i,this._maps=e||[],this.ownData=!(e||r)}get maps(){return this._maps}slice(e=0,r=this.maps.length){return new jv(this._maps,this.mirror,e,r)}appendMap(e,r){this.ownData||(this._maps=this._maps.slice(),this.mirror=this.mirror&&this.mirror.slice(),this.ownData=!0),this.to=this._maps.push(e),r!=null&&this.setMirror(this._maps.length-1,r)}appendMapping(e){for(let r=0,n=this._maps.length;r<e._maps.length;r++){let i=e.getMirror(r);this.appendMap(e._maps[r],i!=null&&i<r?n+i:void 0)}}getMirror(e){if(this.mirror){for(let r=0;r<this.mirror.length;r++)if(this.mirror[r]==e)return this.mirror[r+(r%2?-1:1)]}}setMirror(e,r){this.mirror||(this.mirror=[]),this.mirror.push(e,r)}appendMappingInverted(e){for(let r=e.maps.length-1,n=this._maps.length+e._maps.length;r>=0;r--){let i=e.getMirror(r);this.appendMap(e._maps[r].invert(),i!=null&&i>r?n-i-1:void 0)}}invert(){let e=new jv;return e.appendMappingInverted(this),e}map(e,r=1){if(this.mirror)return this._map(e,r,!0);for(let n=this.from;n<this.to;n++)e=this._maps[n].map(e,r);return e}mapResult(e,r=1){return this._map(e,r,!1)}_map(e,r,n){let i=0;for(let a=this.from;a<this.to;a++){let s=this._maps[a],o=s.mapResult(e,r);if(o.recover!=null){let l=this.getMirror(a);if(l!=null&&l>a&&l<this.to){a=l,e=this._maps[l].recover(o.recover);continue}}i|=o.delInfo,e=o.pos}return n?e:new xk(e,i,null)}}const rS=Object.create(null);class cs{getMap(){return go.empty}merge(e){return null}static fromJSON(e,r){if(!r||!r.stepType)throw new RangeError("Invalid input for Step.fromJSON");let n=rS[r.stepType];if(!n)throw new RangeError(`No step type ${r.stepType} defined`);return n.fromJSON(e,r)}static jsonID(e,r){if(e in rS)throw new RangeError("Duplicate use of step JSON ID "+e);return rS[e]=r,r.prototype.jsonID=e,r}}class Ii{constructor(e,r){this.doc=e,this.failed=r}static ok(e){return new Ii(e,null)}static fail(e){return new Ii(null,e)}static fromReplace(e,r,n,i){try{return Ii.ok(e.replace(r,n,i))}catch(a){if(a instanceof Ax)return Ii.fail(a.message);throw a}}}function H_(t,e,r){let n=[];for(let i=0;i<t.childCount;i++){let a=t.child(i);a.content.size&&(a=a.copy(H_(a.content,e,a))),a.isInline&&(a=e(a,r,i)),n.push(a)}return at.fromArray(n)}class jd extends cs{constructor(e,r,n){super(),this.from=e,this.to=r,this.mark=n}apply(e){let r=e.slice(this.from,this.to),n=e.resolve(this.from),i=n.node(n.sharedDepth(this.to)),a=new Ot(H_(r.content,(s,o)=>!s.isAtom||!o.type.allowsMarkType(this.mark.type)?s:s.mark(this.mark.addToSet(s.marks)),i),r.openStart,r.openEnd);return Ii.fromReplace(e,this.from,this.to,a)}invert(){return new Ol(this.from,this.to,this.mark)}map(e){let r=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return r.deleted&&n.deleted||r.pos>=n.pos?null:new jd(r.pos,n.pos,this.mark)}merge(e){return e instanceof jd&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new jd(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,r){if(typeof r.from!="number"||typeof r.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new jd(r.from,r.to,e.markFromJSON(r.mark))}}cs.jsonID("addMark",jd);class Ol extends cs{constructor(e,r,n){super(),this.from=e,this.to=r,this.mark=n}apply(e){let r=e.slice(this.from,this.to),n=new Ot(H_(r.content,i=>i.mark(this.mark.removeFromSet(i.marks)),e),r.openStart,r.openEnd);return Ii.fromReplace(e,this.from,this.to,n)}invert(){return new jd(this.from,this.to,this.mark)}map(e){let r=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return r.deleted&&n.deleted||r.pos>=n.pos?null:new Ol(r.pos,n.pos,this.mark)}merge(e){return e instanceof Ol&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new Ol(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,r){if(typeof r.from!="number"||typeof r.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new Ol(r.from,r.to,e.markFromJSON(r.mark))}}cs.jsonID("removeMark",Ol);class Fd extends cs{constructor(e,r){super(),this.pos=e,this.mark=r}apply(e){let r=e.nodeAt(this.pos);if(!r)return Ii.fail("No node at mark step's position");let n=r.type.create(r.attrs,null,this.mark.addToSet(r.marks));return Ii.fromReplace(e,this.pos,this.pos+1,new Ot(at.from(n),0,r.isLeaf?0:1))}invert(e){let r=e.nodeAt(this.pos);if(r){let n=this.mark.addToSet(r.marks);if(n.length==r.marks.length){for(let i=0;i<r.marks.length;i++)if(!r.marks[i].isInSet(n))return new Fd(this.pos,r.marks[i]);return new Fd(this.pos,this.mark)}}return new Sh(this.pos,this.mark)}map(e){let r=e.mapResult(this.pos,1);return r.deletedAfter?null:new Fd(r.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,r){if(typeof r.pos!="number")throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new Fd(r.pos,e.markFromJSON(r.mark))}}cs.jsonID("addNodeMark",Fd);class Sh extends cs{constructor(e,r){super(),this.pos=e,this.mark=r}apply(e){let r=e.nodeAt(this.pos);if(!r)return Ii.fail("No node at mark step's position");let n=r.type.create(r.attrs,null,this.mark.removeFromSet(r.marks));return Ii.fromReplace(e,this.pos,this.pos+1,new Ot(at.from(n),0,r.isLeaf?0:1))}invert(e){let r=e.nodeAt(this.pos);return!r||!this.mark.isInSet(r.marks)?this:new Fd(this.pos,this.mark)}map(e){let r=e.mapResult(this.pos,1);return r.deletedAfter?null:new Sh(r.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,r){if(typeof r.pos!="number")throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new Sh(r.pos,e.markFromJSON(r.mark))}}cs.jsonID("removeNodeMark",Sh);class fa extends cs{constructor(e,r,n,i=!1){super(),this.from=e,this.to=r,this.slice=n,this.structure=i}apply(e){return this.structure&&bk(e,this.from,this.to)?Ii.fail("Structure replace would overwrite content"):Ii.fromReplace(e,this.from,this.to,this.slice)}getMap(){return new go([this.from,this.to-this.from,this.slice.size])}invert(e){return new fa(this.from,this.from+this.slice.size,e.slice(this.from,this.to))}map(e){let r=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return r.deletedAcross&&n.deletedAcross?null:new fa(r.pos,Math.max(r.pos,n.pos),this.slice,this.structure)}merge(e){if(!(e instanceof fa)||e.structure||this.structure)return null;if(this.from+this.slice.size==e.from&&!this.slice.openEnd&&!e.slice.openStart){let r=this.slice.size+e.slice.size==0?Ot.empty:new Ot(this.slice.content.append(e.slice.content),this.slice.openStart,e.slice.openEnd);return new fa(this.from,this.to+(e.to-e.from),r,this.structure)}else if(e.to==this.from&&!this.slice.openStart&&!e.slice.openEnd){let r=this.slice.size+e.slice.size==0?Ot.empty:new Ot(e.slice.content.append(this.slice.content),e.slice.openStart,this.slice.openEnd);return new fa(e.from,this.to,r,this.structure)}else return null}toJSON(){let e={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,r){if(typeof r.from!="number"||typeof r.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new fa(r.from,r.to,Ot.fromJSON(e,r.slice),!!r.structure)}}cs.jsonID("replace",fa);class ga extends cs{constructor(e,r,n,i,a,s,o=!1){super(),this.from=e,this.to=r,this.gapFrom=n,this.gapTo=i,this.slice=a,this.insert=s,this.structure=o}apply(e){if(this.structure&&(bk(e,this.from,this.gapFrom)||bk(e,this.gapTo,this.to)))return Ii.fail("Structure gap-replace would overwrite content");let r=e.slice(this.gapFrom,this.gapTo);if(r.openStart||r.openEnd)return Ii.fail("Gap is not a flat range");let n=this.slice.insertAt(this.insert,r.content);return n?Ii.fromReplace(e,this.from,this.to,n):Ii.fail("Content does not fit in gap")}getMap(){return new go([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(e){let r=this.gapTo-this.gapFrom;return new ga(this.from,this.from+this.slice.size+r,this.from+this.insert,this.from+this.insert+r,e.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(e){let r=e.mapResult(this.from,1),n=e.mapResult(this.to,-1),i=this.from==this.gapFrom?r.pos:e.map(this.gapFrom,-1),a=this.to==this.gapTo?n.pos:e.map(this.gapTo,1);return r.deletedAcross&&n.deletedAcross||i<r.pos||a>n.pos?null:new ga(r.pos,n.pos,i,a,this.slice,this.insert,this.structure)}toJSON(){let e={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,r){if(typeof r.from!="number"||typeof r.to!="number"||typeof r.gapFrom!="number"||typeof r.gapTo!="number"||typeof r.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new ga(r.from,r.to,r.gapFrom,r.gapTo,Ot.fromJSON(e,r.slice),r.insert,!!r.structure)}}cs.jsonID("replaceAround",ga);function bk(t,e,r){let n=t.resolve(e),i=r-e,a=n.depth;for(;i>0&&a>0&&n.indexAfter(a)==n.node(a).childCount;)a--,i--;if(i>0){let s=n.node(a).maybeChild(n.indexAfter(a));for(;i>0;){if(!s||s.isLeaf)return!0;s=s.firstChild,i--}}return!1}function OZ(t,e,r,n){let i=[],a=[],s,o;t.doc.nodesBetween(e,r,(l,u,c)=>{if(!l.isInline)return;let f=l.marks;if(!n.isInSet(f)&&c.type.allowsMarkType(n.type)){let p=Math.max(u,e),g=Math.min(u+l.nodeSize,r),y=n.addToSet(f);for(let S=0;S<f.length;S++)f[S].isInSet(y)||(s&&s.to==p&&s.mark.eq(f[S])?s.to=g:i.push(s=new Ol(p,g,f[S])));o&&o.to==p?o.to=g:a.push(o=new jd(p,g,n))}}),i.forEach(l=>t.step(l)),a.forEach(l=>t.step(l))}function DZ(t,e,r,n){let i=[],a=0;t.doc.nodesBetween(e,r,(s,o)=>{if(!s.isInline)return;a++;let l=null;if(n instanceof Y1){let u=s.marks,c;for(;c=n.isInSet(u);)(l||(l=[])).push(c),u=c.removeFromSet(u)}else n?n.isInSet(s.marks)&&(l=[n]):l=s.marks;if(l&&l.length){let u=Math.min(o+s.nodeSize,r);for(let c=0;c<l.length;c++){let f=l[c],p;for(let g=0;g<i.length;g++){let y=i[g];y.step==a-1&&f.eq(i[g].style)&&(p=y)}p?(p.to=u,p.step=a):i.push({style:f,from:Math.max(o,e),to:u,step:a})}}}),i.forEach(s=>t.step(new Ol(s.from,s.to,s.style)))}function W_(t,e,r,n=r.contentMatch,i=!0){let a=t.doc.nodeAt(e),s=[],o=e+1;for(let l=0;l<a.childCount;l++){let u=a.child(l),c=o+u.nodeSize,f=n.matchType(u.type);if(!f)s.push(new fa(o,c,Ot.empty));else{n=f;for(let p=0;p<u.marks.length;p++)r.allowsMarkType(u.marks[p].type)||t.step(new Ol(o,c,u.marks[p]));if(i&&u.isText&&r.whitespace!="pre"){let p,g=/\r?\n|\r/g,y;for(;p=g.exec(u.text);)y||(y=new Ot(at.from(r.schema.text(" ",r.allowedMarks(u.marks))),0,0)),s.push(new fa(o+p.index,o+p.index+p[0].length,y))}}o=c}if(!n.validEnd){let l=n.fillBefore(at.empty,!0);t.replace(o,o,new Ot(l,0,0))}for(let l=s.length-1;l>=0;l--)t.step(s[l])}function IZ(t,e,r){return(e==0||t.canReplace(e,t.childCount))&&(r==t.childCount||t.canReplace(0,r))}function ym(t){let r=t.parent.content.cutByIndex(t.startIndex,t.endIndex);for(let n=t.depth,i=0,a=0;;--n){let s=t.$from.node(n),o=t.$from.index(n)+i,l=t.$to.indexAfter(n)-a;if(n<t.depth&&s.canReplace(o,l,r))return n;if(n==0||s.type.spec.isolating||!IZ(s,o,l))break;o&&(i=1),l<s.childCount&&(a=1)}return null}function jZ(t,e,r){let{$from:n,$to:i,depth:a}=e,s=n.before(a+1),o=i.after(a+1),l=s,u=o,c=at.empty,f=0;for(let y=a,S=!1;y>r;y--)S||n.index(y)>0?(S=!0,c=at.from(n.node(y).copy(c)),f++):l--;let p=at.empty,g=0;for(let y=a,S=!1;y>r;y--)S||i.after(y+1)<i.end(y)?(S=!0,p=at.from(i.node(y).copy(p)),g++):u++;t.step(new ga(l,u,s,o,new Ot(c.append(p),f,g),c.size-f,!0))}function q_(t,e,r=null,n=t){let i=FZ(t,e),a=i&&BZ(n,e);return a?i.map(P3).concat({type:e,attrs:r}).concat(a.map(P3)):null}function P3(t){return{type:t,attrs:null}}function FZ(t,e){let{parent:r,startIndex:n,endIndex:i}=t,a=r.contentMatchAt(n).findWrapping(e);if(!a)return null;let s=a.length?a[0]:e;return r.canReplaceWith(n,i,s)?a:null}function BZ(t,e){let{parent:r,startIndex:n,endIndex:i}=t,a=r.child(n),s=e.contentMatch.findWrapping(a.type);if(!s)return null;let l=(s.length?s[s.length-1]:e).contentMatch;for(let u=n;l&&u<i;u++)l=l.matchType(r.child(u).type);return!l||!l.validEnd?null:s}function zZ(t,e,r){let n=at.empty;for(let s=r.length-1;s>=0;s--){if(n.size){let o=r[s].type.contentMatch.matchFragment(n);if(!o||!o.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}n=at.from(r[s].type.create(r[s].attrs,n))}let i=e.start,a=e.end;t.step(new ga(i,a,i,a,new Ot(n,0,0),r.length,!0))}function UZ(t,e,r,n,i){if(!n.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let a=t.steps.length;t.doc.nodesBetween(e,r,(s,o)=>{let l=typeof i=="function"?i(s):i;if(s.isTextblock&&!s.hasMarkup(n,l)&&GZ(t.doc,t.mapping.slice(a).map(o),n)){let u=null;if(n.schema.linebreakReplacement){let g=n.whitespace=="pre",y=!!n.contentMatch.matchType(n.schema.linebreakReplacement);g&&!y?u=!1:!g&&y&&(u=!0)}u===!1&&XR(t,s,o,a),W_(t,t.mapping.slice(a).map(o,1),n,void 0,u===null);let c=t.mapping.slice(a),f=c.map(o,1),p=c.map(o+s.nodeSize,1);return t.step(new ga(f,p,f+1,p-1,new Ot(at.from(n.create(l,null,s.marks)),0,0),1,!0)),u===!0&&YR(t,s,o,a),!1}})}function YR(t,e,r,n){e.forEach((i,a)=>{if(i.isText){let s,o=/\r?\n|\r/g;for(;s=o.exec(i.text);){let l=t.mapping.slice(n).map(r+1+a+s.index);t.replaceWith(l,l+1,e.type.schema.linebreakReplacement.create())}}})}function XR(t,e,r,n){e.forEach((i,a)=>{if(i.type==i.type.schema.linebreakReplacement){let s=t.mapping.slice(n).map(r+1+a);t.replaceWith(s,s+1,e.type.schema.text(`
`))}})}function GZ(t,e,r){let n=t.resolve(e),i=n.index();return n.parent.canReplaceWith(i,i+1,r)}function VZ(t,e,r,n,i){let a=t.doc.nodeAt(e);if(!a)throw new RangeError("No node at given position");r||(r=a.type);let s=r.create(n,null,i||a.marks);if(a.isLeaf)return t.replaceWith(e,e+a.nodeSize,s);if(!r.validContent(a.content))throw new RangeError("Invalid content for node type "+r.name);t.step(new ga(e,e+a.nodeSize,e+1,e+a.nodeSize-1,new Ot(at.from(s),0,0),1,!0))}function gc(t,e,r=1,n){let i=t.resolve(e),a=i.depth-r,s=n&&n[n.length-1]||i.parent;if(a<0||i.parent.type.spec.isolating||!i.parent.canReplace(i.index(),i.parent.childCount)||!s.type.validContent(i.parent.content.cutByIndex(i.index(),i.parent.childCount)))return!1;for(let u=i.depth-1,c=r-2;u>a;u--,c--){let f=i.node(u),p=i.index(u);if(f.type.spec.isolating)return!1;let g=f.content.cutByIndex(p,f.childCount),y=n&&n[c+1];y&&(g=g.replaceChild(0,y.type.create(y.attrs)));let S=n&&n[c]||f;if(!f.canReplace(p+1,f.childCount)||!S.type.validContent(g))return!1}let o=i.indexAfter(a),l=n&&n[0];return i.node(a).canReplaceWith(o,o,l?l.type:i.node(a+1).type)}function HZ(t,e,r=1,n){let i=t.doc.resolve(e),a=at.empty,s=at.empty;for(let o=i.depth,l=i.depth-r,u=r-1;o>l;o--,u--){a=at.from(i.node(o).copy(a));let c=n&&n[u];s=at.from(c?c.type.create(c.attrs,s):i.node(o).copy(s))}t.step(new fa(e,e,new Ot(a.append(s),r,r),!0))}function hf(t,e){let r=t.resolve(e),n=r.index();return QR(r.nodeBefore,r.nodeAfter)&&r.parent.canReplace(n,n+1)}function WZ(t,e){e.content.size||t.type.compatibleContent(e.type);let r=t.contentMatchAt(t.childCount),{linebreakReplacement:n}=t.type.schema;for(let i=0;i<e.childCount;i++){let a=e.child(i),s=a.type==n?t.type.schema.nodes.text:a.type;if(r=r.matchType(s),!r||!t.type.allowsMarks(a.marks))return!1}return r.validEnd}function QR(t,e){return!!(t&&e&&!t.isLeaf&&WZ(t,e))}function X1(t,e,r=-1){let n=t.resolve(e);for(let i=n.depth;;i--){let a,s,o=n.index(i);if(i==n.depth?(a=n.nodeBefore,s=n.nodeAfter):r>0?(a=n.node(i+1),o++,s=n.node(i).maybeChild(o)):(a=n.node(i).maybeChild(o-1),s=n.node(i+1)),a&&!a.isTextblock&&QR(a,s)&&n.node(i).canReplace(o,o+1))return e;if(i==0)break;e=r<0?n.before(i):n.after(i)}}function qZ(t,e,r){let n=null,{linebreakReplacement:i}=t.doc.type.schema,a=t.doc.resolve(e-r),s=a.node().type;if(i&&s.inlineContent){let c=s.whitespace=="pre",f=!!s.contentMatch.matchType(i);c&&!f?n=!1:!c&&f&&(n=!0)}let o=t.steps.length;if(n===!1){let c=t.doc.resolve(e+r);XR(t,c.node(),c.before(),o)}s.inlineContent&&W_(t,e+r-1,s,a.node().contentMatchAt(a.index()),n==null);let l=t.mapping.slice(o),u=l.map(e-r);if(t.step(new fa(u,l.map(e+r,-1),Ot.empty,!0)),n===!0){let c=t.doc.resolve(u);YR(t,c.node(),c.before(),t.steps.length)}return t}function $Z(t,e,r){let n=t.resolve(e);if(n.parent.canReplaceWith(n.index(),n.index(),r))return e;if(n.parentOffset==0)for(let i=n.depth-1;i>=0;i--){let a=n.index(i);if(n.node(i).canReplaceWith(a,a,r))return n.before(i+1);if(a>0)return null}if(n.parentOffset==n.parent.content.size)for(let i=n.depth-1;i>=0;i--){let a=n.indexAfter(i);if(n.node(i).canReplaceWith(a,a,r))return n.after(i+1);if(a<n.node(i).childCount)return null}return null}function JR(t,e,r){let n=t.resolve(e);if(!r.content.size)return e;let i=r.content;for(let a=0;a<r.openStart;a++)i=i.firstChild.content;for(let a=1;a<=(r.openStart==0&&r.size?2:1);a++)for(let s=n.depth;s>=0;s--){let o=s==n.depth?0:n.pos<=(n.start(s+1)+n.end(s+1))/2?-1:1,l=n.index(s)+(o>0?1:0),u=n.node(s),c=!1;if(a==1)c=u.canReplace(l,l,i);else{let f=u.contentMatchAt(l).findWrapping(i.firstChild.type);c=f&&u.canReplaceWith(l,l,f[0])}if(c)return o==0?n.pos:o<0?n.before(s+1):n.after(s+1)}return null}function Q1(t,e,r=e,n=Ot.empty){if(e==r&&!n.size)return null;let i=t.resolve(e),a=t.resolve(r);return eO(i,a,n)?new fa(e,r,n):new KZ(i,a,n).fit()}function eO(t,e,r){return!r.openStart&&!r.openEnd&&t.start()==e.start()&&t.parent.canReplace(t.index(),e.index(),r.content)}class KZ{constructor(e,r,n){this.$from=e,this.$to=r,this.unplaced=n,this.frontier=[],this.placed=at.empty;for(let i=0;i<=e.depth;i++){let a=e.node(i);this.frontier.push({type:a.type,match:a.contentMatchAt(e.indexAfter(i))})}for(let i=e.depth;i>0;i--)this.placed=at.from(e.node(i).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let u=this.findFittable();u?this.placeNodes(u):this.openMore()||this.dropNode()}let e=this.mustMoveInline(),r=this.placed.size-this.depth-this.$from.depth,n=this.$from,i=this.close(e<0?this.$to:n.doc.resolve(e));if(!i)return null;let a=this.placed,s=n.depth,o=i.depth;for(;s&&o&&a.childCount==1;)a=a.firstChild.content,s--,o--;let l=new Ot(a,s,o);return e>-1?new ga(n.pos,e,this.$to.pos,this.$to.end(),l,r):l.size||n.pos!=this.$to.pos?new fa(n.pos,i.pos,l):null}findFittable(){let e=this.unplaced.openStart;for(let r=this.unplaced.content,n=0,i=this.unplaced.openEnd;n<e;n++){let a=r.firstChild;if(r.childCount>1&&(i=0),a.type.spec.isolating&&i<=n){e=n;break}r=a.content}for(let r=1;r<=2;r++)for(let n=r==1?e:this.unplaced.openStart;n>=0;n--){let i,a=null;n?(a=nS(this.unplaced.content,n-1).firstChild,i=a.content):i=this.unplaced.content;let s=i.firstChild;for(let o=this.depth;o>=0;o--){let{type:l,match:u}=this.frontier[o],c,f=null;if(r==1&&(s?u.matchType(s.type)||(f=u.fillBefore(at.from(s),!1)):a&&l.compatibleContent(a.type)))return{sliceDepth:n,frontierDepth:o,parent:a,inject:f};if(r==2&&s&&(c=u.findWrapping(s.type)))return{sliceDepth:n,frontierDepth:o,parent:a,wrap:c};if(a&&u.matchType(a.type))break}}}openMore(){let{content:e,openStart:r,openEnd:n}=this.unplaced,i=nS(e,r);return!i.childCount||i.firstChild.isLeaf?!1:(this.unplaced=new Ot(e,r+1,Math.max(n,i.size+r>=e.size-n?r+1:0)),!0)}dropNode(){let{content:e,openStart:r,openEnd:n}=this.unplaced,i=nS(e,r);if(i.childCount<=1&&r>0){let a=e.size-r<=r+i.size;this.unplaced=new Ot(Xg(e,r-1,1),r-1,a?r-1:n)}else this.unplaced=new Ot(Xg(e,r,1),r,n)}placeNodes({sliceDepth:e,frontierDepth:r,parent:n,inject:i,wrap:a}){for(;this.depth>r;)this.closeFrontierNode();if(a)for(let S=0;S<a.length;S++)this.openFrontierNode(a[S]);let s=this.unplaced,o=n?n.content:s.content,l=s.openStart-e,u=0,c=[],{match:f,type:p}=this.frontier[r];if(i){for(let S=0;S<i.childCount;S++)c.push(i.child(S));f=f.matchFragment(i)}let g=o.size+e-(s.content.size-s.openEnd);for(;u<o.childCount;){let S=o.child(u),w=f.matchType(S.type);if(!w)break;u++,(u>1||l==0||S.content.size)&&(f=w,c.push(tO(S.mark(p.allowedMarks(S.marks)),u==1?l:0,u==o.childCount?g:-1)))}let y=u==o.childCount;y||(g=-1),this.placed=Qg(this.placed,r,at.from(c)),this.frontier[r].match=f,y&&g<0&&n&&n.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let S=0,w=o;S<g;S++){let C=w.lastChild;this.frontier.push({type:C.type,match:C.contentMatchAt(C.childCount)}),w=C.content}this.unplaced=y?e==0?Ot.empty:new Ot(Xg(s.content,e-1,1),e-1,g<0?s.openEnd:e-1):new Ot(Xg(s.content,e,u),s.openStart,s.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let e=this.frontier[this.depth],r;if(!e.type.isTextblock||!iS(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(r=this.findCloseLevel(this.$to))&&r.depth==this.depth)return-1;let{depth:n}=this.$to,i=this.$to.after(n);for(;n>1&&i==this.$to.end(--n);)++i;return i}findCloseLevel(e){e:for(let r=Math.min(this.depth,e.depth);r>=0;r--){let{match:n,type:i}=this.frontier[r],a=r<e.depth&&e.end(r+1)==e.pos+(e.depth-(r+1)),s=iS(e,r,i,n,a);if(s){for(let o=r-1;o>=0;o--){let{match:l,type:u}=this.frontier[o],c=iS(e,o,u,l,!0);if(!c||c.childCount)continue e}return{depth:r,fit:s,move:a?e.doc.resolve(e.after(r+1)):e}}}}close(e){let r=this.findCloseLevel(e);if(!r)return null;for(;this.depth>r.depth;)this.closeFrontierNode();r.fit.childCount&&(this.placed=Qg(this.placed,r.depth,r.fit)),e=r.move;for(let n=r.depth+1;n<=e.depth;n++){let i=e.node(n),a=i.type.contentMatch.fillBefore(i.content,!0,e.index(n));this.openFrontierNode(i.type,i.attrs,a)}return e}openFrontierNode(e,r=null,n){let i=this.frontier[this.depth];i.match=i.match.matchType(e),this.placed=Qg(this.placed,this.depth,at.from(e.create(r,n))),this.frontier.push({type:e,match:e.contentMatch})}closeFrontierNode(){let r=this.frontier.pop().match.fillBefore(at.empty,!0);r.childCount&&(this.placed=Qg(this.placed,this.frontier.length,r))}}function Xg(t,e,r){return e==0?t.cutByIndex(r,t.childCount):t.replaceChild(0,t.firstChild.copy(Xg(t.firstChild.content,e-1,r)))}function Qg(t,e,r){return e==0?t.append(r):t.replaceChild(t.childCount-1,t.lastChild.copy(Qg(t.lastChild.content,e-1,r)))}function nS(t,e){for(let r=0;r<e;r++)t=t.firstChild.content;return t}function tO(t,e,r){if(e<=0)return t;let n=t.content;return e>1&&(n=n.replaceChild(0,tO(n.firstChild,e-1,n.childCount==1?r-1:0))),e>0&&(n=t.type.contentMatch.fillBefore(n).append(n),r<=0&&(n=n.append(t.type.contentMatch.matchFragment(n).fillBefore(at.empty,!0)))),t.copy(n)}function iS(t,e,r,n,i){let a=t.node(e),s=i?t.indexAfter(e):t.index(e);if(s==a.childCount&&!r.compatibleContent(a.type))return null;let o=n.fillBefore(a.content,!0,s);return o&&!ZZ(r,a.content,s)?o:null}function ZZ(t,e,r){for(let n=r;n<e.childCount;n++)if(!t.allowsMarks(e.child(n).marks))return!0;return!1}function YZ(t){return t.spec.defining||t.spec.definingForContent}function XZ(t,e,r,n){if(!n.size)return t.deleteRange(e,r);let i=t.doc.resolve(e),a=t.doc.resolve(r);if(eO(i,a,n))return t.step(new fa(e,r,n));let s=nO(i,a);s[s.length-1]==0&&s.pop();let o=-(i.depth+1);s.unshift(o);for(let p=i.depth,g=i.pos-1;p>0;p--,g--){let y=i.node(p).type.spec;if(y.defining||y.definingAsContext||y.isolating)break;s.indexOf(p)>-1?o=p:i.before(p)==g&&s.splice(1,0,-p)}let l=s.indexOf(o),u=[],c=n.openStart;for(let p=n.content,g=0;;g++){let y=p.firstChild;if(u.push(y),g==n.openStart)break;p=y.content}for(let p=c-1;p>=0;p--){let g=u[p],y=YZ(g.type);if(y&&!g.sameMarkup(i.node(Math.abs(o)-1)))c=p;else if(y||!g.type.isTextblock)break}for(let p=n.openStart;p>=0;p--){let g=(p+c+1)%(n.openStart+1),y=u[g];if(y)for(let S=0;S<s.length;S++){let w=s[(S+l)%s.length],C=!0;w<0&&(C=!1,w=-w);let _=i.node(w-1),T=i.index(w-1);if(_.canReplaceWith(T,T,y.type,y.marks))return t.replace(i.before(w),C?a.after(w):r,new Ot(rO(n.content,0,n.openStart,g),g,n.openEnd))}}let f=t.steps.length;for(let p=s.length-1;p>=0&&(t.replace(e,r,n),!(t.steps.length>f));p--){let g=s[p];g<0||(e=i.before(g),r=a.after(g))}}function rO(t,e,r,n,i){if(e<r){let a=t.firstChild;t=t.replaceChild(0,a.copy(rO(a.content,e+1,r,n,a)))}if(e>n){let a=i.contentMatchAt(0),s=a.fillBefore(t).append(t);t=s.append(a.matchFragment(s).fillBefore(at.empty,!0))}return t}function QZ(t,e,r,n){if(!n.isInline&&e==r&&t.doc.resolve(e).parent.content.size){let i=$Z(t.doc,e,n.type);i!=null&&(e=r=i)}t.replaceRange(e,r,new Ot(at.from(n),0,0))}function JZ(t,e,r){let n=t.doc.resolve(e),i=t.doc.resolve(r),a=nO(n,i);for(let s=0;s<a.length;s++){let o=a[s],l=s==a.length-1;if(l&&o==0||n.node(o).type.contentMatch.validEnd)return t.delete(n.start(o),i.end(o));if(o>0&&(l||n.node(o-1).canReplace(n.index(o-1),i.indexAfter(o-1))))return t.delete(n.before(o),i.after(o))}for(let s=1;s<=n.depth&&s<=i.depth;s++)if(e-n.start(s)==n.depth-s&&r>n.end(s)&&i.end(s)-r!=i.depth-s&&n.start(s-1)==i.start(s-1)&&n.node(s-1).canReplace(n.index(s-1),i.index(s-1)))return t.delete(n.before(s),r);t.delete(e,r)}function nO(t,e){let r=[],n=Math.min(t.depth,e.depth);for(let i=n;i>=0;i--){let a=t.start(i);if(a<t.pos-(t.depth-i)||e.end(i)>e.pos+(e.depth-i)||t.node(i).type.spec.isolating||e.node(i).type.spec.isolating)break;(a==e.start(i)||i==t.depth&&i==e.depth&&t.parent.inlineContent&&e.parent.inlineContent&&i&&e.start(i-1)==a-1)&&r.push(i)}return r}class Up extends cs{constructor(e,r,n){super(),this.pos=e,this.attr=r,this.value=n}apply(e){let r=e.nodeAt(this.pos);if(!r)return Ii.fail("No node at attribute step's position");let n=Object.create(null);for(let a in r.attrs)n[a]=r.attrs[a];n[this.attr]=this.value;let i=r.type.create(n,null,r.marks);return Ii.fromReplace(e,this.pos,this.pos+1,new Ot(at.from(i),0,r.isLeaf?0:1))}getMap(){return go.empty}invert(e){return new Up(this.pos,this.attr,e.nodeAt(this.pos).attrs[this.attr])}map(e){let r=e.mapResult(this.pos,1);return r.deletedAfter?null:new Up(r.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(e,r){if(typeof r.pos!="number"||typeof r.attr!="string")throw new RangeError("Invalid input for AttrStep.fromJSON");return new Up(r.pos,r.attr,r.value)}}cs.jsonID("attr",Up);class Fv extends cs{constructor(e,r){super(),this.attr=e,this.value=r}apply(e){let r=Object.create(null);for(let i in e.attrs)r[i]=e.attrs[i];r[this.attr]=this.value;let n=e.type.create(r,e.content,e.marks);return Ii.ok(n)}getMap(){return go.empty}invert(e){return new Fv(this.attr,e.attrs[this.attr])}map(e){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(e,r){if(typeof r.attr!="string")throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new Fv(r.attr,r.value)}}cs.jsonID("docAttr",Fv);let Kp=class extends Error{};Kp=function t(e){let r=Error.call(this,e);return r.__proto__=t.prototype,r};Kp.prototype=Object.create(Error.prototype);Kp.prototype.constructor=Kp;Kp.prototype.name="TransformError";class iO{constructor(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new jv}get before(){return this.docs.length?this.docs[0]:this.doc}step(e){let r=this.maybeStep(e);if(r.failed)throw new Kp(r.failed);return this}maybeStep(e){let r=e.apply(this.doc);return r.failed||this.addStep(e,r.doc),r}get docChanged(){return this.steps.length>0}changedRange(){let e=1e9,r=-1e9;for(let n=0;n<this.mapping.maps.length;n++){let i=this.mapping.maps[n];n&&(e=i.map(e,1),r=i.map(r,-1)),i.forEach((a,s,o,l)=>{e=Math.min(e,o),r=Math.max(r,l)})}return e==1e9?null:{from:e,to:r}}addStep(e,r){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=r}replace(e,r=e,n=Ot.empty){let i=Q1(this.doc,e,r,n);return i&&this.step(i),this}replaceWith(e,r,n){return this.replace(e,r,new Ot(at.from(n),0,0))}delete(e,r){return this.replace(e,r,Ot.empty)}insert(e,r){return this.replaceWith(e,e,r)}replaceRange(e,r,n){return XZ(this,e,r,n),this}replaceRangeWith(e,r,n){return QZ(this,e,r,n),this}deleteRange(e,r){return JZ(this,e,r),this}lift(e,r){return jZ(this,e,r),this}join(e,r=1){return qZ(this,e,r),this}wrap(e,r){return zZ(this,e,r),this}setBlockType(e,r=e,n,i=null){return UZ(this,e,r,n,i),this}setNodeMarkup(e,r,n=null,i){return VZ(this,e,r,n,i),this}setNodeAttribute(e,r,n){return this.step(new Up(e,r,n)),this}setDocAttribute(e,r){return this.step(new Fv(e,r)),this}addNodeMark(e,r){return this.step(new Fd(e,r)),this}removeNodeMark(e,r){let n=this.doc.nodeAt(e);if(!n)throw new RangeError("No node at position "+e);if(r instanceof wn)r.isInSet(n.marks)&&this.step(new Sh(e,r));else{let i=n.marks,a,s=[];for(;a=r.isInSet(i);)s.push(new Sh(e,a)),i=a.removeFromSet(i);for(let o=s.length-1;o>=0;o--)this.step(s[o])}return this}split(e,r=1,n){return HZ(this,e,r,n),this}addMark(e,r,n){return OZ(this,e,r,n),this}removeMark(e,r,n){return DZ(this,e,r,n),this}clearIncompatible(e,r,n){return W_(this,e,r,n),this}}const aS=Object.create(null);class _r{constructor(e,r,n){this.$anchor=e,this.$head=r,this.ranges=n||[new eY(e.min(r),e.max(r))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let r=0;r<e.length;r++)if(e[r].$from.pos!=e[r].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,r=Ot.empty){let n=r.content.lastChild,i=null;for(let o=0;o<r.openEnd;o++)i=n,n=n.lastChild;let a=e.steps.length,s=this.ranges;for(let o=0;o<s.length;o++){let{$from:l,$to:u}=s[o],c=e.mapping.slice(a);e.replaceRange(c.map(l.pos),c.map(u.pos),o?Ot.empty:r),o==0&&L3(e,a,(n?n.isInline:i&&i.isTextblock)?-1:1)}}replaceWith(e,r){let n=e.steps.length,i=this.ranges;for(let a=0;a<i.length;a++){let{$from:s,$to:o}=i[a],l=e.mapping.slice(n),u=l.map(s.pos),c=l.map(o.pos);a?e.deleteRange(u,c):(e.replaceRangeWith(u,c,r),L3(e,n,r.isInline?-1:1))}}static findFrom(e,r,n=!1){let i=e.parent.inlineContent?new fr(e):Ep(e.node(0),e.parent,e.pos,e.index(),r,n);if(i)return i;for(let a=e.depth-1;a>=0;a--){let s=r<0?Ep(e.node(0),e.node(a),e.before(a+1),e.index(a),r,n):Ep(e.node(0),e.node(a),e.after(a+1),e.index(a)+1,r,n);if(s)return s}return null}static near(e,r=1){return this.findFrom(e,r)||this.findFrom(e,-r)||new yo(e.node(0))}static atStart(e){return Ep(e,e,0,0,1)||new yo(e)}static atEnd(e){return Ep(e,e,e.content.size,e.childCount,-1)||new yo(e)}static fromJSON(e,r){if(!r||!r.type)throw new RangeError("Invalid input for Selection.fromJSON");let n=aS[r.type];if(!n)throw new RangeError(`No selection type ${r.type} defined`);return n.fromJSON(e,r)}static jsonID(e,r){if(e in aS)throw new RangeError("Duplicate use of selection JSON ID "+e);return aS[e]=r,r.prototype.jsonID=e,r}getBookmark(){return fr.between(this.$anchor,this.$head).getBookmark()}}_r.prototype.visible=!0;class eY{constructor(e,r){this.$from=e,this.$to=r}}let M3=!1;function A3(t){!M3&&!t.parent.inlineContent&&(M3=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+t.parent.type.name+")"))}class fr extends _r{constructor(e,r=e){A3(e),A3(r),super(e,r)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(e,r){let n=e.resolve(r.map(this.head));if(!n.parent.inlineContent)return _r.near(n);let i=e.resolve(r.map(this.anchor));return new fr(i.parent.inlineContent?i:n,n)}replace(e,r=Ot.empty){if(super.replace(e,r),r==Ot.empty){let n=this.$from.marksAcross(this.$to);n&&e.ensureMarks(n)}}eq(e){return e instanceof fr&&e.anchor==this.anchor&&e.head==this.head}getBookmark(){return new J1(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(e,r){if(typeof r.anchor!="number"||typeof r.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new fr(e.resolve(r.anchor),e.resolve(r.head))}static create(e,r,n=r){let i=e.resolve(r);return new this(i,n==r?i:e.resolve(n))}static between(e,r,n){let i=e.pos-r.pos;if((!n||i)&&(n=i>=0?1:-1),!r.parent.inlineContent){let a=_r.findFrom(r,n,!0)||_r.findFrom(r,-n,!0);if(a)r=a.$head;else return _r.near(r,n)}return e.parent.inlineContent||(i==0?e=r:(e=(_r.findFrom(e,-n,!0)||_r.findFrom(e,n,!0)).$anchor,e.pos<r.pos!=i<0&&(e=r))),new fr(e,r)}}_r.jsonID("text",fr);class J1{constructor(e,r){this.anchor=e,this.head=r}map(e){return new J1(e.map(this.anchor),e.map(this.head))}resolve(e){return fr.between(e.resolve(this.anchor),e.resolve(this.head))}}class Jt extends _r{constructor(e){let r=e.nodeAfter,n=e.node(0).resolve(e.pos+r.nodeSize);super(e,n),this.node=r}map(e,r){let{deleted:n,pos:i}=r.mapResult(this.anchor),a=e.resolve(i);return n?_r.near(a):new Jt(a)}content(){return new Ot(at.from(this.node),0,0)}eq(e){return e instanceof Jt&&e.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new $_(this.anchor)}static fromJSON(e,r){if(typeof r.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new Jt(e.resolve(r.anchor))}static create(e,r){return new Jt(e.resolve(r))}static isSelectable(e){return!e.isText&&e.type.spec.selectable!==!1}}Jt.prototype.visible=!1;_r.jsonID("node",Jt);class $_{constructor(e){this.anchor=e}map(e){let{deleted:r,pos:n}=e.mapResult(this.anchor);return r?new J1(n,n):new $_(n)}resolve(e){let r=e.resolve(this.anchor),n=r.nodeAfter;return n&&Jt.isSelectable(n)?new Jt(r):_r.near(r)}}class yo extends _r{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,r=Ot.empty){if(r==Ot.empty){e.delete(0,e.doc.content.size);let n=_r.atStart(e.doc);n.eq(e.selection)||e.setSelection(n)}else super.replace(e,r)}toJSON(){return{type:"all"}}static fromJSON(e){return new yo(e)}map(e){return new yo(e)}eq(e){return e instanceof yo}getBookmark(){return tY}}_r.jsonID("all",yo);const tY={map(){return this},resolve(t){return new yo(t)}};function Ep(t,e,r,n,i,a=!1){if(e.inlineContent)return fr.create(t,r);for(let s=n-(i>0?0:1);i>0?s<e.childCount:s>=0;s+=i){let o=e.child(s);if(o.isAtom){if(!a&&Jt.isSelectable(o))return Jt.create(t,r-(i<0?o.nodeSize:0))}else{let l=Ep(t,o,r+i,i<0?o.childCount:0,i,a);if(l)return l}r+=o.nodeSize*i}return null}function L3(t,e,r){let n=t.steps.length-1;if(n<e)return;let i=t.steps[n];if(!(i instanceof fa||i instanceof ga))return;let a=t.mapping.maps[n],s;a.forEach((o,l,u,c)=>{s==null&&(s=c)}),t.setSelection(_r.near(t.doc.resolve(s),r))}const R3=1,Cy=2,O3=4;class rY extends iO{constructor(e){super(e.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=e.selection,this.storedMarks=e.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(e){if(e.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=e,this.curSelectionFor=this.steps.length,this.updated=(this.updated|R3)&~Cy,this.storedMarks=null,this}get selectionSet(){return(this.updated&R3)>0}setStoredMarks(e){return this.storedMarks=e,this.updated|=Cy,this}ensureMarks(e){return wn.sameSet(this.storedMarks||this.selection.$from.marks(),e)||this.setStoredMarks(e),this}addStoredMark(e){return this.ensureMarks(e.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(e){return this.ensureMarks(e.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(this.updated&Cy)>0}addStep(e,r){super.addStep(e,r),this.updated=this.updated&~Cy,this.storedMarks=null}setTime(e){return this.time=e,this}replaceSelection(e){return this.selection.replace(this,e),this}replaceSelectionWith(e,r=!0){let n=this.selection;return r&&(e=e.mark(this.storedMarks||(n.empty?n.$from.marks():n.$from.marksAcross(n.$to)||wn.none))),n.replaceWith(this,e),this}deleteSelection(){return this.selection.replace(this),this}insertText(e,r,n){let i=this.doc.type.schema;if(r==null)return e?this.replaceSelectionWith(i.text(e),!0):this.deleteSelection();{if(n==null&&(n=r),!e)return this.deleteRange(r,n);let a=this.storedMarks;if(!a){let s=this.doc.resolve(r);a=n==r?s.marks():s.marksAcross(this.doc.resolve(n))}return this.replaceRangeWith(r,n,i.text(e,a)),!this.selection.empty&&this.selection.to==r+e.length&&this.setSelection(_r.near(this.selection.$to)),this}}setMeta(e,r){return this.meta[typeof e=="string"?e:e.key]=r,this}getMeta(e){return this.meta[typeof e=="string"?e:e.key]}get isGeneric(){for(let e in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=O3,this}get scrolledIntoView(){return(this.updated&O3)>0}}function D3(t,e){return!e||!t?t:t.bind(e)}class Jg{constructor(e,r,n){this.name=e,this.init=D3(r.init,n),this.apply=D3(r.apply,n)}}const nY=[new Jg("doc",{init(t){return t.doc||t.schema.topNodeType.createAndFill()},apply(t){return t.doc}}),new Jg("selection",{init(t,e){return t.selection||_r.atStart(e.doc)},apply(t){return t.selection}}),new Jg("storedMarks",{init(t){return t.storedMarks||null},apply(t,e,r,n){return n.selection.$cursor?t.storedMarks:null}}),new Jg("scrollToSelection",{init(){return 0},apply(t,e){return t.scrolledIntoView?e+1:e}})];class sS{constructor(e,r){this.schema=e,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=nY.slice(),r&&r.forEach(n=>{if(this.pluginsByKey[n.key])throw new RangeError("Adding different instances of a keyed plugin ("+n.key+")");this.plugins.push(n),this.pluginsByKey[n.key]=n,n.spec.state&&this.fields.push(new Jg(n.key,n.spec.state,n))})}}class Op{constructor(e){this.config=e}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(e){return this.applyTransaction(e).state}filterTransaction(e,r=-1){for(let n=0;n<this.config.plugins.length;n++)if(n!=r){let i=this.config.plugins[n];if(i.spec.filterTransaction&&!i.spec.filterTransaction.call(i,e,this))return!1}return!0}applyTransaction(e){if(!this.filterTransaction(e))return{state:this,transactions:[]};let r=[e],n=this.applyInner(e),i=null;for(;;){let a=!1;for(let s=0;s<this.config.plugins.length;s++){let o=this.config.plugins[s];if(o.spec.appendTransaction){let l=i?i[s].n:0,u=i?i[s].state:this,c=l<r.length&&o.spec.appendTransaction.call(o,l?r.slice(l):r,u,n);if(c&&n.filterTransaction(c,s)){if(c.setMeta("appendedTransaction",e),!i){i=[];for(let f=0;f<this.config.plugins.length;f++)i.push(f<s?{state:n,n:r.length}:{state:this,n:0})}r.push(c),n=n.applyInner(c),a=!0}i&&(i[s]={state:n,n:r.length})}}if(!a)return{state:n,transactions:r}}}applyInner(e){if(!e.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");let r=new Op(this.config),n=this.config.fields;for(let i=0;i<n.length;i++){let a=n[i];r[a.name]=a.apply(e,this[a.name],this,r)}return r}get tr(){return new rY(this)}static create(e){let r=new sS(e.doc?e.doc.type.schema:e.schema,e.plugins),n=new Op(r);for(let i=0;i<r.fields.length;i++)n[r.fields[i].name]=r.fields[i].init(e,n);return n}reconfigure(e){let r=new sS(this.schema,e.plugins),n=r.fields,i=new Op(r);for(let a=0;a<n.length;a++){let s=n[a].name;i[s]=this.hasOwnProperty(s)?this[s]:n[a].init(e,i)}return i}toJSON(e){let r={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(r.storedMarks=this.storedMarks.map(n=>n.toJSON())),e&&typeof e=="object")for(let n in e){if(n=="doc"||n=="selection")throw new RangeError("The JSON fields `doc` and `selection` are reserved");let i=e[n],a=i.spec.state;a&&a.toJSON&&(r[n]=a.toJSON.call(i,this[i.key]))}return r}static fromJSON(e,r,n){if(!r)throw new RangeError("Invalid input for EditorState.fromJSON");if(!e.schema)throw new RangeError("Required config field 'schema' missing");let i=new sS(e.schema,e.plugins),a=new Op(i);return i.fields.forEach(s=>{if(s.name=="doc")a.doc=Qo.fromJSON(e.schema,r.doc);else if(s.name=="selection")a.selection=_r.fromJSON(a.doc,r.selection);else if(s.name=="storedMarks")r.storedMarks&&(a.storedMarks=r.storedMarks.map(e.schema.markFromJSON));else{if(n)for(let o in n){let l=n[o],u=l.spec.state;if(l.key==s.name&&u&&u.fromJSON&&Object.prototype.hasOwnProperty.call(r,o)){a[s.name]=u.fromJSON.call(l,e,r[o],a);return}}a[s.name]=s.init(e,a)}}),a}}function aO(t,e,r){for(let n in t){let i=t[n];i instanceof Function?i=i.bind(e):n=="handleDOMEvents"&&(i=aO(i,e,{})),r[n]=i}return r}class Xn{constructor(e){this.spec=e,this.props={},e.props&&aO(e.props,this,this.props),this.key=e.key?e.key.key:sO("plugin")}getState(e){return e[this.key]}}const oS=Object.create(null);function sO(t){return t in oS?t+"$"+ ++oS[t]:(oS[t]=0,t+"$")}class Ti{constructor(e="key"){this.key=sO(e)}get(e){return e.config.pluginsByKey[this.key]}getState(e){return e[this.key]}}const K_=(t,e)=>t.selection.empty?!1:(e&&e(t.tr.deleteSelection().scrollIntoView()),!0);function oO(t,e){let{$cursor:r}=t.selection;return!r||(e?!e.endOfTextblock("backward",t):r.parentOffset>0)?null:r}const lO=(t,e,r)=>{let n=oO(t,r);if(!n)return!1;let i=Z_(n);if(!i){let s=n.blockRange(),o=s&&ym(s);return o==null?!1:(e&&e(t.tr.lift(s,o).scrollIntoView()),!0)}let a=i.nodeBefore;if(vO(t,i,e,-1))return!0;if(n.parent.content.size==0&&(Zp(a,"end")||Jt.isSelectable(a)))for(let s=n.depth;;s--){let o=Q1(t.doc,n.before(s),n.after(s),Ot.empty);if(o&&o.slice.size<o.to-o.from){if(e){let l=t.tr.step(o);l.setSelection(Zp(a,"end")?_r.findFrom(l.doc.resolve(l.mapping.map(i.pos,-1)),-1):Jt.create(l.doc,i.pos-a.nodeSize)),e(l.scrollIntoView())}return!0}if(s==1||n.node(s-1).childCount>1)break}return a.isAtom&&i.depth==n.depth-1?(e&&e(t.tr.delete(i.pos-a.nodeSize,i.pos).scrollIntoView()),!0):!1},iY=(t,e,r)=>{let n=oO(t,r);if(!n)return!1;let i=Z_(n);return i?uO(t,i,e):!1},aY=(t,e,r)=>{let n=dO(t,r);if(!n)return!1;let i=Y_(n);return i?uO(t,i,e):!1};function uO(t,e,r){let n=e.nodeBefore,i=n,a=e.pos-1;for(;!i.isTextblock;a--){if(i.type.spec.isolating)return!1;let c=i.lastChild;if(!c)return!1;i=c}let s=e.nodeAfter,o=s,l=e.pos+1;for(;!o.isTextblock;l++){if(o.type.spec.isolating)return!1;let c=o.firstChild;if(!c)return!1;o=c}let u=Q1(t.doc,a,l,Ot.empty);if(!u||u.from!=a||u instanceof fa&&u.slice.size>=l-a)return!1;if(r){let c=t.tr.step(u);c.setSelection(fr.create(c.doc,a)),r(c.scrollIntoView())}return!0}function Zp(t,e,r=!1){for(let n=t;n;n=e=="start"?n.firstChild:n.lastChild){if(n.isTextblock)return!0;if(r&&n.childCount!=1)return!1}return!1}const cO=(t,e,r)=>{let{$head:n,empty:i}=t.selection,a=n;if(!i)return!1;if(n.parent.isTextblock){if(r?!r.endOfTextblock("backward",t):n.parentOffset>0)return!1;a=Z_(n)}let s=a&&a.nodeBefore;return!s||!Jt.isSelectable(s)?!1:(e&&e(t.tr.setSelection(Jt.create(t.doc,a.pos-s.nodeSize)).scrollIntoView()),!0)};function Z_(t){if(!t.parent.type.spec.isolating)for(let e=t.depth-1;e>=0;e--){if(t.index(e)>0)return t.doc.resolve(t.before(e+1));if(t.node(e).type.spec.isolating)break}return null}function dO(t,e){let{$cursor:r}=t.selection;return!r||(e?!e.endOfTextblock("forward",t):r.parentOffset<r.parent.content.size)?null:r}const fO=(t,e,r)=>{let n=dO(t,r);if(!n)return!1;let i=Y_(n);if(!i)return!1;let a=i.nodeAfter;if(vO(t,i,e,1))return!0;if(n.parent.content.size==0&&(Zp(a,"start")||Jt.isSelectable(a))){let s=Q1(t.doc,n.before(),n.after(),Ot.empty);if(s&&s.slice.size<s.to-s.from){if(e){let o=t.tr.step(s);o.setSelection(Zp(a,"start")?_r.findFrom(o.doc.resolve(o.mapping.map(i.pos)),1):Jt.create(o.doc,o.mapping.map(i.pos))),e(o.scrollIntoView())}return!0}}return a.isAtom&&i.depth==n.depth-1?(e&&e(t.tr.delete(i.pos,i.pos+a.nodeSize).scrollIntoView()),!0):!1},hO=(t,e,r)=>{let{$head:n,empty:i}=t.selection,a=n;if(!i)return!1;if(n.parent.isTextblock){if(r?!r.endOfTextblock("forward",t):n.parentOffset<n.parent.content.size)return!1;a=Y_(n)}let s=a&&a.nodeAfter;return!s||!Jt.isSelectable(s)?!1:(e&&e(t.tr.setSelection(Jt.create(t.doc,a.pos)).scrollIntoView()),!0)};function Y_(t){if(!t.parent.type.spec.isolating)for(let e=t.depth-1;e>=0;e--){let r=t.node(e);if(t.index(e)+1<r.childCount)return t.doc.resolve(t.after(e+1));if(r.type.spec.isolating)break}return null}const sY=(t,e)=>{let r=t.selection,n=r instanceof Jt,i;if(n){if(r.node.isTextblock||!hf(t.doc,r.from))return!1;i=r.from}else if(i=X1(t.doc,r.from,-1),i==null)return!1;if(e){let a=t.tr.join(i);n&&a.setSelection(Jt.create(a.doc,i-t.doc.resolve(i).nodeBefore.nodeSize)),e(a.scrollIntoView())}return!0},oY=(t,e)=>{let r=t.selection,n;if(r instanceof Jt){if(r.node.isTextblock||!hf(t.doc,r.to))return!1;n=r.to}else if(n=X1(t.doc,r.to,1),n==null)return!1;return e&&e(t.tr.join(n).scrollIntoView()),!0},lY=(t,e)=>{let{$from:r,$to:n}=t.selection,i=r.blockRange(n),a=i&&ym(i);return a==null?!1:(e&&e(t.tr.lift(i,a).scrollIntoView()),!0)},pO=(t,e)=>{let{$head:r,$anchor:n}=t.selection;return!r.parent.type.spec.code||!r.sameParent(n)?!1:(e&&e(t.tr.insertText(`
`).scrollIntoView()),!0)};function X_(t){for(let e=0;e<t.edgeCount;e++){let{type:r}=t.edge(e);if(r.isTextblock&&!r.hasRequiredAttrs())return r}return null}const uY=(t,e)=>{let{$head:r,$anchor:n}=t.selection;if(!r.parent.type.spec.code||!r.sameParent(n))return!1;let i=r.node(-1),a=r.indexAfter(-1),s=X_(i.contentMatchAt(a));if(!s||!i.canReplaceWith(a,a,s))return!1;if(e){let o=r.after(),l=t.tr.replaceWith(o,o,s.createAndFill());l.setSelection(_r.near(l.doc.resolve(o),1)),e(l.scrollIntoView())}return!0},mO=(t,e)=>{let r=t.selection,{$from:n,$to:i}=r;if(r instanceof yo||n.parent.inlineContent||i.parent.inlineContent)return!1;let a=X_(i.parent.contentMatchAt(i.indexAfter()));if(!a||!a.isTextblock)return!1;if(e){let s=(!n.parentOffset&&i.index()<i.parent.childCount?n:i).pos,o=t.tr.insert(s,a.createAndFill());o.setSelection(fr.create(o.doc,s+1)),e(o.scrollIntoView())}return!0},gO=(t,e)=>{let{$cursor:r}=t.selection;if(!r||r.parent.content.size)return!1;if(r.depth>1&&r.after()!=r.end(-1)){let a=r.before();if(gc(t.doc,a))return e&&e(t.tr.split(a).scrollIntoView()),!0}let n=r.blockRange(),i=n&&ym(n);return i==null?!1:(e&&e(t.tr.lift(n,i).scrollIntoView()),!0)};function cY(t){return(e,r)=>{let{$from:n,$to:i}=e.selection;if(e.selection instanceof Jt&&e.selection.node.isBlock)return!n.parentOffset||!gc(e.doc,n.pos)?!1:(r&&r(e.tr.split(n.pos).scrollIntoView()),!0);if(!n.depth)return!1;let a=[],s,o,l=!1,u=!1;for(let g=n.depth;;g--)if(n.node(g).isBlock){l=n.end(g)==n.pos+(n.depth-g),u=n.start(g)==n.pos-(n.depth-g),o=X_(n.node(g-1).contentMatchAt(n.indexAfter(g-1))),a.unshift(l&&o?{type:o}:null),s=g;break}else{if(g==1)return!1;a.unshift(null)}let c=e.tr;(e.selection instanceof fr||e.selection instanceof yo)&&c.deleteSelection();let f=c.mapping.map(n.pos),p=gc(c.doc,f,a.length,a);if(p||(a[0]=o?{type:o}:null,p=gc(c.doc,f,a.length,a)),!p)return!1;if(c.split(f,a.length,a),!l&&u&&n.node(s).type!=o){let g=c.mapping.map(n.before(s)),y=c.doc.resolve(g);o&&n.node(s-1).canReplaceWith(y.index(),y.index()+1,o)&&c.setNodeMarkup(c.mapping.map(n.before(s)),o)}return r&&r(c.scrollIntoView()),!0}}const dY=cY(),fY=(t,e)=>{let{$from:r,to:n}=t.selection,i,a=r.sharedDepth(n);return a==0?!1:(i=r.before(a),e&&e(t.tr.setSelection(Jt.create(t.doc,i))),!0)};function hY(t,e,r){let n=e.nodeBefore,i=e.nodeAfter,a=e.index();return!n||!i||!n.type.compatibleContent(i.type)?!1:!n.content.size&&e.parent.canReplace(a-1,a)?(r&&r(t.tr.delete(e.pos-n.nodeSize,e.pos).scrollIntoView()),!0):!e.parent.canReplace(a,a+1)||!(i.isTextblock||hf(t.doc,e.pos))?!1:(r&&r(t.tr.join(e.pos).scrollIntoView()),!0)}function vO(t,e,r,n){let i=e.nodeBefore,a=e.nodeAfter,s,o,l=i.type.spec.isolating||a.type.spec.isolating;if(!l&&hY(t,e,r))return!0;let u=!l&&e.parent.canReplace(e.index(),e.index()+1);if(u&&(s=(o=i.contentMatchAt(i.childCount)).findWrapping(a.type))&&o.matchType(s[0]||a.type).validEnd){if(r){let g=e.pos+a.nodeSize,y=at.empty;for(let C=s.length-1;C>=0;C--)y=at.from(s[C].create(null,y));y=at.from(i.copy(y));let S=t.tr.step(new ga(e.pos-1,g,e.pos,g,new Ot(y,1,0),s.length,!0)),w=S.doc.resolve(g+2*s.length);w.nodeAfter&&w.nodeAfter.type==i.type&&hf(S.doc,w.pos)&&S.join(w.pos),r(S.scrollIntoView())}return!0}let c=a.type.spec.isolating||n>0&&l?null:_r.findFrom(e,1),f=c&&c.$from.blockRange(c.$to),p=f&&ym(f);if(p!=null&&p>=e.depth)return r&&r(t.tr.lift(f,p).scrollIntoView()),!0;if(u&&Zp(a,"start",!0)&&Zp(i,"end")){let g=i,y=[];for(;y.push(g),!g.isTextblock;)g=g.lastChild;let S=a,w=1;for(;!S.isTextblock;S=S.firstChild)w++;if(g.canReplace(g.childCount,g.childCount,S.content)){if(r){let C=at.empty;for(let T=y.length-1;T>=0;T--)C=at.from(y[T].copy(C));let _=t.tr.step(new ga(e.pos-y.length,e.pos+a.nodeSize,e.pos+w,e.pos+a.nodeSize-w,new Ot(C,y.length,0),0,!0));r(_.scrollIntoView())}return!0}}return!1}function yO(t){return function(e,r){let n=e.selection,i=t<0?n.$from:n.$to,a=i.depth;for(;i.node(a).isInline;){if(!a)return!1;a--}return i.node(a).isTextblock?(r&&r(e.tr.setSelection(fr.create(e.doc,t<0?i.start(a):i.end(a)))),!0):!1}}const pY=yO(-1),mY=yO(1);function gY(t,e=null){return function(r,n){let{$from:i,$to:a}=r.selection,s=i.blockRange(a),o=s&&q_(s,t,e);return o?(n&&n(r.tr.wrap(s,o).scrollIntoView()),!0):!1}}function I3(t,e=null){return function(r,n){let i=!1;for(let a=0;a<r.selection.ranges.length&&!i;a++){let{$from:{pos:s},$to:{pos:o}}=r.selection.ranges[a];r.doc.nodesBetween(s,o,(l,u)=>{if(i)return!1;if(!(!l.isTextblock||l.hasMarkup(t,e)))if(l.type==t)i=!0;else{let c=r.doc.resolve(u),f=c.index();i=c.parent.canReplaceWith(f,f+1,t)}})}if(!i)return!1;if(n){let a=r.tr;for(let s=0;s<r.selection.ranges.length;s++){let{$from:{pos:o},$to:{pos:l}}=r.selection.ranges[s];a.setBlockType(o,l,t,e)}n(a.scrollIntoView())}return!0}}function Q_(...t){return function(e,r,n){for(let i=0;i<t.length;i++)if(t[i](e,r,n))return!0;return!1}}Q_(K_,lO,cO);Q_(K_,fO,hO);Q_(pO,mO,gO,dY);typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):typeof os<"u"&&os.platform&&os.platform()=="darwin";function vY(t,e=null){return function(r,n){let{$from:i,$to:a}=r.selection,s=i.blockRange(a);if(!s)return!1;let o=n?r.tr:null;return yY(o,s,t,e)?(n&&n(o.scrollIntoView()),!0):!1}}function yY(t,e,r,n=null){let i=!1,a=e,s=e.$from.doc;if(e.depth>=2&&e.$from.node(e.depth-1).type.compatibleContent(r)&&e.startIndex==0){if(e.$from.index(e.depth-1)==0)return!1;let l=s.resolve(e.start-2);a=new Rx(l,l,e.depth),e.endIndex<e.parent.childCount&&(e=new Rx(e.$from,s.resolve(e.$to.end(e.depth)),e.depth)),i=!0}let o=q_(a,r,n,e);return o?(t&&xY(t,e,o,i,r),!0):!1}function xY(t,e,r,n,i){let a=at.empty;for(let c=r.length-1;c>=0;c--)a=at.from(r[c].type.create(r[c].attrs,a));t.step(new ga(e.start-(n?2:0),e.end,e.start,e.end,new Ot(a,0,0),r.length,!0));let s=0;for(let c=0;c<r.length;c++)r[c].type==i&&(s=c+1);let o=r.length-s,l=e.start+r.length-(n?2:0),u=e.parent;for(let c=e.startIndex,f=e.endIndex,p=!0;c<f;c++,p=!1)!p&&gc(t.doc,l,o)&&(t.split(l,o),l+=2*o),l+=u.child(c).nodeSize;return t}function bY(t){return function(e,r){let{$from:n,$to:i}=e.selection,a=n.blockRange(i,s=>s.childCount>0&&s.firstChild.type==t);return a?r?n.node(a.depth-1).type==t?wY(e,r,t,a):SY(e,r,a):!0:!1}}function wY(t,e,r,n){let i=t.tr,a=n.end,s=n.$to.end(n.depth);a<s&&(i.step(new ga(a-1,s,a,s,new Ot(at.from(r.create(null,n.parent.copy())),1,0),1,!0)),n=new Rx(i.doc.resolve(n.$from.pos),i.doc.resolve(s),n.depth));const o=ym(n);if(o==null)return!1;i.lift(n,o);let l=i.doc.resolve(i.mapping.map(a,-1)-1);return hf(i.doc,l.pos)&&l.nodeBefore.type==l.nodeAfter.type&&i.join(l.pos),e(i.scrollIntoView()),!0}function SY(t,e,r){let n=t.tr,i=r.parent;for(let g=r.end,y=r.endIndex-1,S=r.startIndex;y>S;y--)g-=i.child(y).nodeSize,n.delete(g-1,g+1);let a=n.doc.resolve(r.start),s=a.nodeAfter;if(n.mapping.map(r.end)!=r.start+a.nodeAfter.nodeSize)return!1;let o=r.startIndex==0,l=r.endIndex==i.childCount,u=a.node(-1),c=a.index(-1);if(!u.canReplace(c+(o?0:1),c+1,s.content.append(l?at.empty:at.from(i))))return!1;let f=a.pos,p=f+s.nodeSize;return n.step(new ga(f-(o?1:0),p+(l?1:0),f+1,p-1,new Ot((o?at.empty:at.from(i.copy(at.empty))).append(l?at.empty:at.from(i.copy(at.empty))),o?0:1,l?0:1),o?0:1)),e(n.scrollIntoView()),!0}function kY(t){return function(e,r){let{$from:n,$to:i}=e.selection,a=n.blockRange(i,u=>u.childCount>0&&u.firstChild.type==t);if(!a)return!1;let s=a.startIndex;if(s==0)return!1;let o=a.parent,l=o.child(s-1);if(l.type!=t)return!1;if(r){let u=l.lastChild&&l.lastChild.type==o.type,c=at.from(u?t.create():null),f=new Ot(at.from(t.create(null,at.from(o.type.create(null,c)))),u?3:1,0),p=a.start,g=a.end;r(e.tr.step(new ga(p-(u?3:1),g,p,g,f,1,!0)).scrollIntoView())}return!0}}const ja=function(t){for(var e=0;;e++)if(t=t.previousSibling,!t)return e},Yp=function(t){let e=t.assignedSlot||t.parentNode;return e&&e.nodeType==11?e.host:e};let wk=null;const cc=function(t,e,r){let n=wk||(wk=document.createRange());return n.setEnd(t,r??t.nodeValue.length),n.setStart(t,e||0),n},_Y=function(){wk=null},kh=function(t,e,r,n){return r&&(j3(t,e,r,n,-1)||j3(t,e,r,n,1))},CY=/^(img|br|input|textarea|hr)$/i;function j3(t,e,r,n,i){for(var a;;){if(t==r&&e==n)return!0;if(e==(i<0?0:Yo(t))){let s=t.parentNode;if(!s||s.nodeType!=1||p0(t)||CY.test(t.nodeName)||t.contentEditable=="false")return!1;e=ja(t)+(i<0?0:1),t=s}else if(t.nodeType==1){let s=t.childNodes[e+(i<0?-1:0)];if(s.nodeType==1&&s.contentEditable=="false")if(!((a=s.pmViewDesc)===null||a===void 0)&&a.ignoreForSelection)e+=i;else return!1;else t=s,e=i<0?Yo(t):0}else return!1}}function Yo(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}function EY(t,e){for(;;){if(t.nodeType==3&&e)return t;if(t.nodeType==1&&e>0){if(t.contentEditable=="false")return null;t=t.childNodes[e-1],e=Yo(t)}else if(t.parentNode&&!p0(t))e=ja(t),t=t.parentNode;else return null}}function TY(t,e){for(;;){if(t.nodeType==3&&e<t.nodeValue.length)return t;if(t.nodeType==1&&e<t.childNodes.length){if(t.contentEditable=="false")return null;t=t.childNodes[e],e=0}else if(t.parentNode&&!p0(t))e=ja(t)+1,t=t.parentNode;else return null}}function NY(t,e,r){for(let n=e==0,i=e==Yo(t);n||i;){if(t==r)return!0;let a=ja(t);if(t=t.parentNode,!t)return!1;n=n&&a==0,i=i&&a==Yo(t)}}function p0(t){let e;for(let r=t;r&&!(e=r.pmViewDesc);r=r.parentNode);return e&&e.node&&e.node.isBlock&&(e.dom==t||e.contentDOM==t)}const eb=function(t){return t.focusNode&&kh(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset)};function eh(t,e){let r=document.createEvent("Event");return r.initEvent("keydown",!0,!0),r.keyCode=t,r.key=r.code=e,r}function PY(t){let e=t.activeElement;for(;e&&e.shadowRoot;)e=e.shadowRoot.activeElement;return e}function MY(t,e,r){if(t.caretPositionFromPoint)try{let n=t.caretPositionFromPoint(e,r);if(n)return{node:n.offsetNode,offset:Math.min(Yo(n.offsetNode),n.offset)}}catch{}if(t.caretRangeFromPoint){let n=t.caretRangeFromPoint(e,r);if(n)return{node:n.startContainer,offset:Math.min(Yo(n.startContainer),n.startOffset)}}}const Pu=typeof navigator<"u"?navigator:null,F3=typeof document<"u"?document:null,pf=Pu&&Pu.userAgent||"",Sk=/Edge\/(\d+)/.exec(pf),xO=/MSIE \d/.exec(pf),kk=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(pf),Xs=!!(xO||kk||Sk),Wd=xO?document.documentMode:kk?+kk[1]:Sk?+Sk[1]:0,Jo=!Xs&&/gecko\/(\d+)/i.test(pf);Jo&&+(/Firefox\/(\d+)/.exec(pf)||[0,0])[1];const _k=!Xs&&/Chrome\/(\d+)/.exec(pf),pa=!!_k,bO=_k?+_k[1]:0,Ua=!Xs&&!!Pu&&/Apple Computer/.test(Pu.vendor),Xp=Ua&&(/Mobile\/\w+/.test(pf)||!!Pu&&Pu.maxTouchPoints>2),Ko=Xp||(Pu?/Mac/.test(Pu.platform):!1),wO=Pu?/Win/.test(Pu.platform):!1,pc=/Android \d/.test(pf),m0=!!F3&&"webkitFontSmoothing"in F3.documentElement.style,AY=m0?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function LY(t){let e=t.defaultView&&t.defaultView.visualViewport;return e?{left:0,right:e.width,top:0,bottom:e.height}:{left:0,right:t.documentElement.clientWidth,top:0,bottom:t.documentElement.clientHeight}}function sc(t,e){return typeof t=="number"?t:t[e]}function RY(t){let e=t.getBoundingClientRect(),r=e.width/t.offsetWidth||1,n=e.height/t.offsetHeight||1;return{left:e.left,right:e.left+t.clientWidth*r,top:e.top,bottom:e.top+t.clientHeight*n}}function B3(t,e,r){let n=t.someProp("scrollThreshold")||0,i=t.someProp("scrollMargin")||5,a=t.dom.ownerDocument;for(let s=r||t.dom;s;){if(s.nodeType!=1){s=Yp(s);continue}let o=s,l=o==a.body,u=l?LY(a):RY(o),c=0,f=0;if(e.top<u.top+sc(n,"top")?f=-(u.top-e.top+sc(i,"top")):e.bottom>u.bottom-sc(n,"bottom")&&(f=e.bottom-e.top>u.bottom-u.top?e.top+sc(i,"top")-u.top:e.bottom-u.bottom+sc(i,"bottom")),e.left<u.left+sc(n,"left")?c=-(u.left-e.left+sc(i,"left")):e.right>u.right-sc(n,"right")&&(c=e.right-u.right+sc(i,"right")),c||f)if(l)a.defaultView.scrollBy(c,f);else{let g=o.scrollLeft,y=o.scrollTop;f&&(o.scrollTop+=f),c&&(o.scrollLeft+=c);let S=o.scrollLeft-g,w=o.scrollTop-y;e={left:e.left-S,top:e.top-w,right:e.right-S,bottom:e.bottom-w}}let p=l?"fixed":getComputedStyle(s).position;if(/^(fixed|sticky)$/.test(p))break;s=p=="absolute"?s.offsetParent:Yp(s)}}function OY(t){let e=t.dom.getBoundingClientRect(),r=Math.max(0,e.top),n,i;for(let a=(e.left+e.right)/2,s=r+1;s<Math.min(innerHeight,e.bottom);s+=5){let o=t.root.elementFromPoint(a,s);if(!o||o==t.dom||!t.dom.contains(o))continue;let l=o.getBoundingClientRect();if(l.top>=r-20){n=o,i=l.top;break}}return{refDOM:n,refTop:i,stack:SO(t.dom)}}function SO(t){let e=[],r=t.ownerDocument;for(let n=t;n&&(e.push({dom:n,top:n.scrollTop,left:n.scrollLeft}),t!=r);n=Yp(n));return e}function DY({refDOM:t,refTop:e,stack:r}){let n=t?t.getBoundingClientRect().top:0;kO(r,n==0?0:n-e)}function kO(t,e){for(let r=0;r<t.length;r++){let{dom:n,top:i,left:a}=t[r];n.scrollTop!=i+e&&(n.scrollTop=i+e),n.scrollLeft!=a&&(n.scrollLeft=a)}}let Sp=null;function IY(t){if(t.setActive)return t.setActive();if(Sp)return t.focus(Sp);let e=SO(t);t.focus(Sp==null?{get preventScroll(){return Sp={preventScroll:!0},!0}}:void 0),Sp||(Sp=!1,kO(e,0))}function _O(t,e){let r,n=2e8,i,a=0,s=e.top,o=e.top,l,u;for(let c=t.firstChild,f=0;c;c=c.nextSibling,f++){let p;if(c.nodeType==1)p=c.getClientRects();else if(c.nodeType==3)p=cc(c).getClientRects();else continue;for(let g=0;g<p.length;g++){let y=p[g];if(y.top<=s&&y.bottom>=o){s=Math.max(y.bottom,s),o=Math.min(y.top,o);let S=y.left>e.left?y.left-e.left:y.right<e.left?e.left-y.right:0;if(S<n){r=c,n=S,i=S&&r.nodeType==3?{left:y.right<e.left?y.right:y.left,top:e.top}:e,c.nodeType==1&&S&&(a=f+(e.left>=(y.left+y.right)/2?1:0));continue}}else y.top>e.top&&!l&&y.left<=e.left&&y.right>=e.left&&(l=c,u={left:Math.max(y.left,Math.min(y.right,e.left)),top:y.top});!r&&(e.left>=y.right&&e.top>=y.top||e.left>=y.left&&e.top>=y.bottom)&&(a=f+1)}}return!r&&l&&(r=l,i=u,n=0),r&&r.nodeType==3?jY(r,i):!r||n&&r.nodeType==1?{node:t,offset:a}:_O(r,i)}function jY(t,e){let r=t.nodeValue.length,n=document.createRange(),i;for(let a=0;a<r;a++){n.setEnd(t,a+1),n.setStart(t,a);let s=Cd(n,1);if(s.top!=s.bottom&&J_(e,s)){i={node:t,offset:a+(e.left>=(s.left+s.right)/2?1:0)};break}}return n.detach(),i||{node:t,offset:0}}function J_(t,e){return t.left>=e.left-1&&t.left<=e.right+1&&t.top>=e.top-1&&t.top<=e.bottom+1}function FY(t,e){let r=t.parentNode;return r&&/^li$/i.test(r.nodeName)&&e.left<t.getBoundingClientRect().left?r:t}function BY(t,e,r){let{node:n,offset:i}=_O(e,r),a=-1;if(n.nodeType==1&&!n.firstChild){let s=n.getBoundingClientRect();a=s.left!=s.right&&r.left>(s.left+s.right)/2?1:-1}return t.docView.posFromDOM(n,i,a)}function zY(t,e,r,n){let i=-1;for(let a=e,s=!1;a!=t.dom;){let o=t.docView.nearestDesc(a,!0),l;if(!o)return null;if(o.dom.nodeType==1&&(o.node.isBlock&&o.parent||!o.contentDOM)&&((l=o.dom.getBoundingClientRect()).width||l.height)&&(o.node.isBlock&&o.parent&&!/^T(R|BODY|HEAD|FOOT)$/.test(o.dom.nodeName)&&(!s&&l.left>n.left||l.top>n.top?i=o.posBefore:(!s&&l.right<n.left||l.bottom<n.top)&&(i=o.posAfter),s=!0),!o.contentDOM&&i<0&&!o.node.isText))return(o.node.isBlock?n.top<(l.top+l.bottom)/2:n.left<(l.left+l.right)/2)?o.posBefore:o.posAfter;a=o.dom.parentNode}return i>-1?i:t.docView.posFromDOM(e,r,-1)}function CO(t,e,r){let n=t.childNodes.length;if(n&&r.top<r.bottom)for(let i=Math.max(0,Math.min(n-1,Math.floor(n*(e.top-r.top)/(r.bottom-r.top))-2)),a=i;;){let s=t.childNodes[a];if(s.nodeType==1){let o=s.getClientRects();for(let l=0;l<o.length;l++){let u=o[l];if(J_(e,u))return CO(s,e,u)}}if((a=(a+1)%n)==i)break}return t}function UY(t,e){let r=t.dom.ownerDocument,n,i=0,a=MY(r,e.left,e.top);a&&({node:n,offset:i}=a);let s=(t.root.elementFromPoint?t.root:r).elementFromPoint(e.left,e.top),o;if(!s||!t.dom.contains(s.nodeType!=1?s.parentNode:s)){let u=t.dom.getBoundingClientRect();if(!J_(e,u)||(s=CO(t.dom,e,u),!s))return null}if(Ua)for(let u=s;n&&u;u=Yp(u))u.draggable&&(n=void 0);if(s=FY(s,e),n){if(Jo&&n.nodeType==1&&(i=Math.min(i,n.childNodes.length),i<n.childNodes.length)){let c=n.childNodes[i],f;c.nodeName=="IMG"&&(f=c.getBoundingClientRect()).right<=e.left&&f.bottom>e.top&&i++}let u;m0&&i&&n.nodeType==1&&(u=n.childNodes[i-1]).nodeType==1&&u.contentEditable=="false"&&u.getBoundingClientRect().top>=e.top&&i--,n==t.dom&&i==n.childNodes.length-1&&n.lastChild.nodeType==1&&e.top>n.lastChild.getBoundingClientRect().bottom?o=t.state.doc.content.size:(i==0||n.nodeType!=1||n.childNodes[i-1].nodeName!="BR")&&(o=zY(t,n,i,e))}o==null&&(o=BY(t,s,e));let l=t.docView.nearestDesc(s,!0);return{pos:o,inside:l?l.posAtStart-l.border:-1}}function z3(t){return t.top<t.bottom||t.left<t.right}function Cd(t,e){let r=t.getClientRects();if(r.length){let n=r[e<0?0:r.length-1];if(z3(n))return n}return Array.prototype.find.call(r,z3)||t.getBoundingClientRect()}const GY=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function EO(t,e,r){let{node:n,offset:i,atom:a}=t.docView.domFromPos(e,r<0?-1:1),s=m0||Jo;if(n.nodeType==3)if(s&&(GY.test(n.nodeValue)||(r<0?!i:i==n.nodeValue.length))){let l=Cd(cc(n,i,i),r);if(Jo&&i&&/\s/.test(n.nodeValue[i-1])&&i<n.nodeValue.length){let u=Cd(cc(n,i-1,i-1),-1);if(u.top==l.top){let c=Cd(cc(n,i,i+1),-1);if(c.top!=l.top)return Ug(c,c.left<u.left)}}return l}else{let l=i,u=i,c=r<0?1:-1;return r<0&&!i?(u++,c=-1):r>=0&&i==n.nodeValue.length?(l--,c=1):r<0?l--:u++,Ug(Cd(cc(n,l,u),c),c<0)}if(!t.state.doc.resolve(e-(a||0)).parent.inlineContent){if(a==null&&i&&(r<0||i==Yo(n))){let l=n.childNodes[i-1];if(l.nodeType==1)return lS(l.getBoundingClientRect(),!1)}if(a==null&&i<Yo(n)){let l=n.childNodes[i];if(l.nodeType==1)return lS(l.getBoundingClientRect(),!0)}return lS(n.getBoundingClientRect(),r>=0)}if(a==null&&i&&(r<0||i==Yo(n))){let l=n.childNodes[i-1],u=l.nodeType==3?cc(l,Yo(l)-(s?0:1)):l.nodeType==1&&(l.nodeName!="BR"||!l.nextSibling)?l:null;if(u)return Ug(Cd(u,1),!1)}if(a==null&&i<Yo(n)){let l=n.childNodes[i];for(;l.pmViewDesc&&l.pmViewDesc.ignoreForCoords;)l=l.nextSibling;let u=l?l.nodeType==3?cc(l,0,s?0:1):l.nodeType==1?l:null:null;if(u)return Ug(Cd(u,-1),!0)}return Ug(Cd(n.nodeType==3?cc(n):n,-r),r>=0)}function Ug(t,e){if(t.width==0)return t;let r=e?t.left:t.right;return{top:t.top,bottom:t.bottom,left:r,right:r}}function lS(t,e){if(t.height==0)return t;let r=e?t.top:t.bottom;return{top:r,bottom:r,left:t.left,right:t.right}}function TO(t,e,r){let n=t.state,i=t.root.activeElement;n!=e&&t.updateState(e),i!=t.dom&&t.focus();try{return r()}finally{n!=e&&t.updateState(n),i!=t.dom&&i&&i.focus()}}function VY(t,e,r){let n=e.selection,i=r=="up"?n.$from:n.$to;return TO(t,e,()=>{let{node:a}=t.docView.domFromPos(i.pos,r=="up"?-1:1);for(;;){let o=t.docView.nearestDesc(a,!0);if(!o)break;if(o.node.isBlock){a=o.contentDOM||o.dom;break}a=o.dom.parentNode}let s=EO(t,i.pos,1);for(let o=a.firstChild;o;o=o.nextSibling){let l;if(o.nodeType==1)l=o.getClientRects();else if(o.nodeType==3)l=cc(o,0,o.nodeValue.length).getClientRects();else continue;for(let u=0;u<l.length;u++){let c=l[u];if(c.bottom>c.top+1&&(r=="up"?s.top-c.top>(c.bottom-s.top)*2:c.bottom-s.bottom>(s.bottom-c.top)*2))return!1}}return!0})}const HY=/[\u0590-\u08ac]/;function WY(t,e,r){let{$head:n}=e.selection;if(!n.parent.isTextblock)return!1;let i=n.parentOffset,a=!i,s=i==n.parent.content.size,o=t.domSelection();return o?!HY.test(n.parent.textContent)||!o.modify?r=="left"||r=="backward"?a:s:TO(t,e,()=>{let{focusNode:l,focusOffset:u,anchorNode:c,anchorOffset:f}=t.domSelectionRange(),p=o.caretBidiLevel;o.modify("move",r,"character");let g=n.depth?t.docView.domAfterPos(n.before()):t.dom,{focusNode:y,focusOffset:S}=t.domSelectionRange(),w=y&&!g.contains(y.nodeType==1?y:y.parentNode)||l==y&&u==S;try{o.collapse(c,f),l&&(l!=c||u!=f)&&o.extend&&o.extend(l,u)}catch{}return p!=null&&(o.caretBidiLevel=p),w}):n.pos==n.start()||n.pos==n.end()}let U3=null,G3=null,V3=!1;function qY(t,e,r){return U3==e&&G3==r?V3:(U3=e,G3=r,V3=r=="up"||r=="down"?VY(t,e,r):WY(t,e,r))}const el=0,H3=1,nh=2,Mu=3;class g0{constructor(e,r,n,i){this.parent=e,this.children=r,this.dom=n,this.contentDOM=i,this.dirty=el,n.pmViewDesc=this}matchesWidget(e){return!1}matchesMark(e){return!1}matchesNode(e,r,n){return!1}matchesHack(e){return!1}parseRule(){return null}stopEvent(e){return!1}get size(){let e=0;for(let r=0;r<this.children.length;r++)e+=this.children[r].size;return e}get border(){return 0}destroy(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(let e=0;e<this.children.length;e++)this.children[e].destroy()}posBeforeChild(e){for(let r=0,n=this.posAtStart;;r++){let i=this.children[r];if(i==e)return n;n+=i.size}}get posBefore(){return this.parent.posBeforeChild(this)}get posAtStart(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}get posAfter(){return this.posBefore+this.size}get posAtEnd(){return this.posAtStart+this.size-2*this.border}localPosFromDOM(e,r,n){if(this.contentDOM&&this.contentDOM.contains(e.nodeType==1?e:e.parentNode))if(n<0){let a,s;if(e==this.contentDOM)a=e.childNodes[r-1];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;a=e.previousSibling}for(;a&&!((s=a.pmViewDesc)&&s.parent==this);)a=a.previousSibling;return a?this.posBeforeChild(s)+s.size:this.posAtStart}else{let a,s;if(e==this.contentDOM)a=e.childNodes[r];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;a=e.nextSibling}for(;a&&!((s=a.pmViewDesc)&&s.parent==this);)a=a.nextSibling;return a?this.posBeforeChild(s):this.posAtEnd}let i;if(e==this.dom&&this.contentDOM)i=r>ja(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))i=e.compareDocumentPosition(this.contentDOM)&2;else if(this.dom.firstChild){if(r==0)for(let a=e;;a=a.parentNode){if(a==this.dom){i=!1;break}if(a.previousSibling)break}if(i==null&&r==e.childNodes.length)for(let a=e;;a=a.parentNode){if(a==this.dom){i=!0;break}if(a.nextSibling)break}}return i??n>0?this.posAtEnd:this.posAtStart}nearestDesc(e,r=!1){for(let n=!0,i=e;i;i=i.parentNode){let a=this.getDesc(i),s;if(a&&(!r||a.node))if(n&&(s=a.nodeDOM)&&!(s.nodeType==1?s.contains(e.nodeType==1?e:e.parentNode):s==e))n=!1;else return a}}getDesc(e){let r=e.pmViewDesc;for(let n=r;n;n=n.parent)if(n==this)return r}posFromDOM(e,r,n){for(let i=e;i;i=i.parentNode){let a=this.getDesc(i);if(a)return a.localPosFromDOM(e,r,n)}return-1}descAt(e){for(let r=0,n=0;r<this.children.length;r++){let i=this.children[r],a=n+i.size;if(n==e&&a!=n){for(;!i.border&&i.children.length;)for(let s=0;s<i.children.length;s++){let o=i.children[s];if(o.size){i=o;break}}return i}if(e<a)return i.descAt(e-n-i.border);n=a}}domFromPos(e,r){if(!this.contentDOM)return{node:this.dom,offset:0,atom:e+1};let n=0,i=0;for(let a=0;n<this.children.length;n++){let s=this.children[n],o=a+s.size;if(o>e||s instanceof PO){i=e-a;break}a=o}if(i)return this.children[n].domFromPos(i-this.children[n].border,r);for(let a;n&&!(a=this.children[n-1]).size&&a instanceof NO&&a.side>=0;n--);if(r<=0){let a,s=!0;for(;a=n?this.children[n-1]:null,!(!a||a.dom.parentNode==this.contentDOM);n--,s=!1);return a&&r&&s&&!a.border&&!a.domAtom?a.domFromPos(a.size,r):{node:this.contentDOM,offset:a?ja(a.dom)+1:0}}else{let a,s=!0;for(;a=n<this.children.length?this.children[n]:null,!(!a||a.dom.parentNode==this.contentDOM);n++,s=!1);return a&&s&&!a.border&&!a.domAtom?a.domFromPos(0,r):{node:this.contentDOM,offset:a?ja(a.dom):this.contentDOM.childNodes.length}}}parseRange(e,r,n=0){if(this.children.length==0)return{node:this.contentDOM,from:e,to:r,fromOffset:0,toOffset:this.contentDOM.childNodes.length};let i=-1,a=-1;for(let s=n,o=0;;o++){let l=this.children[o],u=s+l.size;if(i==-1&&e<=u){let c=s+l.border;if(e>=c&&r<=u-l.border&&l.node&&l.contentDOM&&this.contentDOM.contains(l.contentDOM))return l.parseRange(e,r,c);e=s;for(let f=o;f>0;f--){let p=this.children[f-1];if(p.size&&p.dom.parentNode==this.contentDOM&&!p.emptyChildAt(1)){i=ja(p.dom)+1;break}e-=p.size}i==-1&&(i=0)}if(i>-1&&(u>r||o==this.children.length-1)){r=u;for(let c=o+1;c<this.children.length;c++){let f=this.children[c];if(f.size&&f.dom.parentNode==this.contentDOM&&!f.emptyChildAt(-1)){a=ja(f.dom);break}r+=f.size}a==-1&&(a=this.contentDOM.childNodes.length);break}s=u}return{node:this.contentDOM,from:e,to:r,fromOffset:i,toOffset:a}}emptyChildAt(e){if(this.border||!this.contentDOM||!this.children.length)return!1;let r=this.children[e<0?0:this.children.length-1];return r.size==0||r.emptyChildAt(e)}domAfterPos(e){let{node:r,offset:n}=this.domFromPos(e,0);if(r.nodeType!=1||n==r.childNodes.length)throw new RangeError("No node after pos "+e);return r.childNodes[n]}setSelection(e,r,n,i=!1){let a=Math.min(e,r),s=Math.max(e,r);for(let g=0,y=0;g<this.children.length;g++){let S=this.children[g],w=y+S.size;if(a>y&&s<w)return S.setSelection(e-y-S.border,r-y-S.border,n,i);y=w}let o=this.domFromPos(e,e?-1:1),l=r==e?o:this.domFromPos(r,r?-1:1),u=n.root.getSelection(),c=n.domSelectionRange(),f=!1;if((Jo||Ua)&&e==r){let{node:g,offset:y}=o;if(g.nodeType==3){if(f=!!(y&&g.nodeValue[y-1]==`
`),f&&y==g.nodeValue.length)for(let S=g,w;S;S=S.parentNode){if(w=S.nextSibling){w.nodeName=="BR"&&(o=l={node:w.parentNode,offset:ja(w)+1});break}let C=S.pmViewDesc;if(C&&C.node&&C.node.isBlock)break}}else{let S=g.childNodes[y-1];f=S&&(S.nodeName=="BR"||S.contentEditable=="false")}}if(Jo&&c.focusNode&&c.focusNode!=l.node&&c.focusNode.nodeType==1){let g=c.focusNode.childNodes[c.focusOffset];g&&g.contentEditable=="false"&&(i=!0)}if(!(i||f&&Ua)&&kh(o.node,o.offset,c.anchorNode,c.anchorOffset)&&kh(l.node,l.offset,c.focusNode,c.focusOffset))return;let p=!1;if((u.extend||e==r)&&!(f&&Jo)){u.collapse(o.node,o.offset);try{e!=r&&u.extend(l.node,l.offset),p=!0}catch{}}if(!p){if(e>r){let y=o;o=l,l=y}let g=document.createRange();g.setEnd(l.node,l.offset),g.setStart(o.node,o.offset),u.removeAllRanges(),u.addRange(g)}}ignoreMutation(e){return!this.contentDOM&&e.type!="selection"}get contentLost(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}markDirty(e,r){for(let n=0,i=0;i<this.children.length;i++){let a=this.children[i],s=n+a.size;if(n==s?e<=s&&r>=n:e<s&&r>n){let o=n+a.border,l=s-a.border;if(e>=o&&r<=l){this.dirty=e==n||r==s?nh:H3,e==o&&r==l&&(a.contentLost||a.dom.parentNode!=this.contentDOM)?a.dirty=Mu:a.markDirty(e-o,r-o);return}else a.dirty=a.dom==a.contentDOM&&a.dom.parentNode==this.contentDOM&&!a.children.length?nh:Mu}n=s}this.dirty=nh}markParentsDirty(){let e=1;for(let r=this.parent;r;r=r.parent,e++){let n=e==1?nh:H3;r.dirty<n&&(r.dirty=n)}}get domAtom(){return!1}get ignoreForCoords(){return!1}get ignoreForSelection(){return!1}isText(e){return!1}}class NO extends g0{constructor(e,r,n,i){let a,s=r.type.toDOM;if(typeof s=="function"&&(s=s(n,()=>{if(!a)return i;if(a.parent)return a.parent.posBeforeChild(a)})),!r.type.spec.raw){if(s.nodeType!=1){let o=document.createElement("span");o.appendChild(s),s=o}s.contentEditable="false",s.classList.add("ProseMirror-widget")}super(e,[],s,null),this.widget=r,this.widget=r,a=this}matchesWidget(e){return this.dirty==el&&e.type.eq(this.widget.type)}parseRule(){return{ignore:!0}}stopEvent(e){let r=this.widget.spec.stopEvent;return r?r(e):!1}ignoreMutation(e){return e.type!="selection"||this.widget.spec.ignoreSelection}destroy(){this.widget.type.destroy(this.dom),super.destroy()}get domAtom(){return!0}get ignoreForSelection(){return!!this.widget.type.spec.relaxedSide}get side(){return this.widget.type.side}}class $Y extends g0{constructor(e,r,n,i){super(e,[],r,null),this.textDOM=n,this.text=i}get size(){return this.text.length}localPosFromDOM(e,r){return e!=this.textDOM?this.posAtStart+(r?this.size:0):this.posAtStart+r}domFromPos(e){return{node:this.textDOM,offset:e}}ignoreMutation(e){return e.type==="characterData"&&e.target.nodeValue==e.oldValue}}class _h extends g0{constructor(e,r,n,i,a){super(e,[],n,i),this.mark=r,this.spec=a}static create(e,r,n,i){let a=i.nodeViews[r.type.name],s=a&&a(r,i,n);return(!s||!s.dom)&&(s=Mh.renderSpec(document,r.type.spec.toDOM(r,n),null,r.attrs)),new _h(e,r,s.dom,s.contentDOM||s.dom,s)}parseRule(){return this.dirty&Mu||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}}matchesMark(e){return this.dirty!=Mu&&this.mark.eq(e)}markDirty(e,r){if(super.markDirty(e,r),this.dirty!=el){let n=this.parent;for(;!n.node;)n=n.parent;n.dirty<this.dirty&&(n.dirty=this.dirty),this.dirty=el}}slice(e,r,n){let i=_h.create(this.parent,this.mark,!0,n),a=this.children,s=this.size;r<s&&(a=Ek(a,r,s,n)),e>0&&(a=Ek(a,0,e,n));for(let o=0;o<a.length;o++)a[o].parent=i;return i.children=a,i}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}}class qd extends g0{constructor(e,r,n,i,a,s,o,l,u){super(e,[],a,s),this.node=r,this.outerDeco=n,this.innerDeco=i,this.nodeDOM=o}static create(e,r,n,i,a,s){let o=a.nodeViews[r.type.name],l,u=o&&o(r,a,()=>{if(!l)return s;if(l.parent)return l.parent.posBeforeChild(l)},n,i),c=u&&u.dom,f=u&&u.contentDOM;if(r.isText){if(!c)c=document.createTextNode(r.text);else if(c.nodeType!=3)throw new RangeError("Text must be rendered as a DOM text node")}else c||({dom:c,contentDOM:f}=Mh.renderSpec(document,r.type.spec.toDOM(r),null,r.attrs));!f&&!r.isText&&c.nodeName!="BR"&&(c.hasAttribute("contenteditable")||(c.contentEditable="false"),r.type.spec.draggable&&(c.draggable=!0));let p=c;return c=LO(c,n,r),u?l=new KY(e,r,n,i,c,f||null,p,u,a,s+1):r.isText?new tb(e,r,n,i,c,p,a):new qd(e,r,n,i,c,f||null,p,a,s+1)}parseRule(){if(this.node.type.spec.reparseInView)return null;let e={node:this.node.type.name,attrs:this.node.attrs};if(this.node.type.whitespace=="pre"&&(e.preserveWhitespace="full"),!this.contentDOM)e.getContent=()=>this.node.content;else if(!this.contentLost)e.contentElement=this.contentDOM;else{for(let r=this.children.length-1;r>=0;r--){let n=this.children[r];if(this.dom.contains(n.dom.parentNode)){e.contentElement=n.dom.parentNode;break}}e.contentElement||(e.getContent=()=>at.empty)}return e}matchesNode(e,r,n){return this.dirty==el&&e.eq(this.node)&&Dx(r,this.outerDeco)&&n.eq(this.innerDeco)}get size(){return this.node.nodeSize}get border(){return this.node.isLeaf?0:1}updateChildren(e,r){let n=this.node.inlineContent,i=r,a=e.composing?this.localCompositionInfo(e,r):null,s=a&&a.pos>-1?a:null,o=a&&a.pos<0,l=new YY(this,s&&s.node,e);JY(this.node,this.innerDeco,(u,c,f)=>{u.spec.marks?l.syncToMarks(u.spec.marks,n,e,c):u.type.side>=0&&!f&&l.syncToMarks(c==this.node.childCount?wn.none:this.node.child(c).marks,n,e,c),l.placeWidget(u,e,i)},(u,c,f,p)=>{l.syncToMarks(u.marks,n,e,p);let g;l.findNodeMatch(u,c,f,p)||o&&e.state.selection.from>i&&e.state.selection.to<i+u.nodeSize&&(g=l.findIndexWithChild(a.node))>-1&&l.updateNodeAt(u,c,f,g,e)||l.updateNextNode(u,c,f,e,p,i)||l.addNode(u,c,f,e,i),i+=u.nodeSize}),l.syncToMarks([],n,e,0),this.node.isTextblock&&l.addTextblockHacks(),l.destroyRest(),(l.changed||this.dirty==nh)&&(s&&this.protectLocalComposition(e,s),MO(this.contentDOM,this.children,e),Xp&&eX(this.dom))}localCompositionInfo(e,r){let{from:n,to:i}=e.state.selection;if(!(e.state.selection instanceof fr)||n<r||i>r+this.node.content.size)return null;let a=e.input.compositionNode;if(!a||!this.dom.contains(a.parentNode))return null;if(this.node.inlineContent){let s=a.nodeValue,o=tX(this.node.content,s,n-r,i-r);return o<0?null:{node:a,pos:o,text:s}}else return{node:a,pos:-1,text:""}}protectLocalComposition(e,{node:r,pos:n,text:i}){if(this.getDesc(r))return;let a=r;for(;a.parentNode!=this.contentDOM;a=a.parentNode){for(;a.previousSibling;)a.parentNode.removeChild(a.previousSibling);for(;a.nextSibling;)a.parentNode.removeChild(a.nextSibling);a.pmViewDesc&&(a.pmViewDesc=void 0)}let s=new $Y(this,a,r,i);e.input.compositionNodes.push(s),this.children=Ek(this.children,n,n+i.length,e,s)}update(e,r,n,i){return this.dirty==Mu||!e.sameMarkup(this.node)?!1:(this.updateInner(e,r,n,i),!0)}updateInner(e,r,n,i){this.updateOuterDeco(r),this.node=e,this.innerDeco=n,this.contentDOM&&this.updateChildren(i,this.posAtStart),this.dirty=el}updateOuterDeco(e){if(Dx(e,this.outerDeco))return;let r=this.nodeDOM.nodeType!=1,n=this.dom;this.dom=AO(this.dom,this.nodeDOM,Ck(this.outerDeco,this.node,r),Ck(e,this.node,r)),this.dom!=n&&(n.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=e}selectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.add("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&(this.nodeDOM.draggable=!0))}deselectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.remove("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&this.nodeDOM.removeAttribute("draggable"))}get domAtom(){return this.node.isAtom}}function W3(t,e,r,n,i){LO(n,e,t);let a=new qd(void 0,t,e,r,n,n,n,i,0);return a.contentDOM&&a.updateChildren(i,0),a}class tb extends qd{constructor(e,r,n,i,a,s,o){super(e,r,n,i,a,null,s,o,0)}parseRule(){let e=this.nodeDOM.parentNode;for(;e&&e!=this.dom&&!e.pmIsDeco;)e=e.parentNode;return{skip:e||!0}}update(e,r,n,i){return this.dirty==Mu||this.dirty!=el&&!this.inParent()||!e.sameMarkup(this.node)?!1:(this.updateOuterDeco(r),(this.dirty!=el||e.text!=this.node.text)&&e.text!=this.nodeDOM.nodeValue&&(this.nodeDOM.nodeValue=e.text,i.trackWrites==this.nodeDOM&&(i.trackWrites=null)),this.node=e,this.dirty=el,!0)}inParent(){let e=this.parent.contentDOM;for(let r=this.nodeDOM;r;r=r.parentNode)if(r==e)return!0;return!1}domFromPos(e){return{node:this.nodeDOM,offset:e}}localPosFromDOM(e,r,n){return e==this.nodeDOM?this.posAtStart+Math.min(r,this.node.text.length):super.localPosFromDOM(e,r,n)}ignoreMutation(e){return e.type!="characterData"&&e.type!="selection"}slice(e,r,n){let i=this.node.cut(e,r),a=document.createTextNode(i.text);return new tb(this.parent,i,this.outerDeco,this.innerDeco,a,a,n)}markDirty(e,r){super.markDirty(e,r),this.dom!=this.nodeDOM&&(e==0||r==this.nodeDOM.nodeValue.length)&&(this.dirty=Mu)}get domAtom(){return!1}isText(e){return this.node.text==e}}class PO extends g0{parseRule(){return{ignore:!0}}matchesHack(e){return this.dirty==el&&this.dom.nodeName==e}get domAtom(){return!0}get ignoreForCoords(){return this.dom.nodeName=="IMG"}}class KY extends qd{constructor(e,r,n,i,a,s,o,l,u,c){super(e,r,n,i,a,s,o,u,c),this.spec=l}update(e,r,n,i){if(this.dirty==Mu)return!1;if(this.spec.update&&(this.node.type==e.type||this.spec.multiType)){let a=this.spec.update(e,r,n);return a&&this.updateInner(e,r,n,i),a}else return!this.contentDOM&&!e.isLeaf?!1:super.update(e,r,n,i)}selectNode(){this.spec.selectNode?this.spec.selectNode():super.selectNode()}deselectNode(){this.spec.deselectNode?this.spec.deselectNode():super.deselectNode()}setSelection(e,r,n,i){this.spec.setSelection?this.spec.setSelection(e,r,n.root):super.setSelection(e,r,n,i)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}stopEvent(e){return this.spec.stopEvent?this.spec.stopEvent(e):!1}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}}function MO(t,e,r){let n=t.firstChild,i=!1;for(let a=0;a<e.length;a++){let s=e[a],o=s.dom;if(o.parentNode==t){for(;o!=n;)n=q3(n),i=!0;n=n.nextSibling}else i=!0,t.insertBefore(o,n);if(s instanceof _h){let l=n?n.previousSibling:t.lastChild;MO(s.contentDOM,s.children,r),n=l?l.nextSibling:t.firstChild}}for(;n;)n=q3(n),i=!0;i&&r.trackWrites==t&&(r.trackWrites=null)}const lv=function(t){t&&(this.nodeName=t)};lv.prototype=Object.create(null);const ih=[new lv];function Ck(t,e,r){if(t.length==0)return ih;let n=r?ih[0]:new lv,i=[n];for(let a=0;a<t.length;a++){let s=t[a].type.attrs;if(s){s.nodeName&&i.push(n=new lv(s.nodeName));for(let o in s){let l=s[o];l!=null&&(r&&i.length==1&&i.push(n=new lv(e.isInline?"span":"div")),o=="class"?n.class=(n.class?n.class+" ":"")+l:o=="style"?n.style=(n.style?n.style+";":"")+l:o!="nodeName"&&(n[o]=l))}}}return i}function AO(t,e,r,n){if(r==ih&&n==ih)return e;let i=e;for(let a=0;a<n.length;a++){let s=n[a],o=r[a];if(a){let l;o&&o.nodeName==s.nodeName&&i!=t&&(l=i.parentNode)&&l.nodeName.toLowerCase()==s.nodeName||(l=document.createElement(s.nodeName),l.pmIsDeco=!0,l.appendChild(i),o=ih[0]),i=l}ZY(i,o||ih[0],s)}return i}function ZY(t,e,r){for(let n in e)n!="class"&&n!="style"&&n!="nodeName"&&!(n in r)&&t.removeAttribute(n);for(let n in r)n!="class"&&n!="style"&&n!="nodeName"&&r[n]!=e[n]&&t.setAttribute(n,r[n]);if(e.class!=r.class){let n=e.class?e.class.split(" ").filter(Boolean):[],i=r.class?r.class.split(" ").filter(Boolean):[];for(let a=0;a<n.length;a++)i.indexOf(n[a])==-1&&t.classList.remove(n[a]);for(let a=0;a<i.length;a++)n.indexOf(i[a])==-1&&t.classList.add(i[a]);t.classList.length==0&&t.removeAttribute("class")}if(e.style!=r.style){if(e.style){let n=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g,i;for(;i=n.exec(e.style);)t.style.removeProperty(i[1])}r.style&&(t.style.cssText+=r.style)}}function LO(t,e,r){return AO(t,t,ih,Ck(e,r,t.nodeType!=1))}function Dx(t,e){if(t.length!=e.length)return!1;for(let r=0;r<t.length;r++)if(!t[r].type.eq(e[r].type))return!1;return!0}function q3(t){let e=t.nextSibling;return t.parentNode.removeChild(t),e}class YY{constructor(e,r,n){this.lock=r,this.view=n,this.index=0,this.stack=[],this.changed=!1,this.top=e,this.preMatch=XY(e.node.content,e)}destroyBetween(e,r){if(e!=r){for(let n=e;n<r;n++)this.top.children[n].destroy();this.top.children.splice(e,r-e),this.changed=!0}}destroyRest(){this.destroyBetween(this.index,this.top.children.length)}syncToMarks(e,r,n,i){let a=0,s=this.stack.length>>1,o=Math.min(s,e.length);for(;a<o&&(a==s-1?this.top:this.stack[a+1<<1]).matchesMark(e[a])&&e[a].type.spec.spanning!==!1;)a++;for(;a<s;)this.destroyRest(),this.top.dirty=el,this.index=this.stack.pop(),this.top=this.stack.pop(),s--;for(;s<e.length;){this.stack.push(this.top,this.index+1);let l=-1,u=this.top.children.length;i<this.preMatch.index&&(u=Math.min(this.index+3,u));for(let c=this.index;c<u;c++){let f=this.top.children[c];if(f.matchesMark(e[s])&&!this.isLocked(f.dom)){l=c;break}}if(l>-1)l>this.index&&(this.changed=!0,this.destroyBetween(this.index,l)),this.top=this.top.children[this.index];else{let c=_h.create(this.top,e[s],r,n);this.top.children.splice(this.index,0,c),this.top=c,this.changed=!0}this.index=0,s++}}findNodeMatch(e,r,n,i){let a=-1,s;if(i>=this.preMatch.index&&(s=this.preMatch.matches[i-this.preMatch.index]).parent==this.top&&s.matchesNode(e,r,n))a=this.top.children.indexOf(s,this.index);else for(let o=this.index,l=Math.min(this.top.children.length,o+5);o<l;o++){let u=this.top.children[o];if(u.matchesNode(e,r,n)&&!this.preMatch.matched.has(u)){a=o;break}}return a<0?!1:(this.destroyBetween(this.index,a),this.index++,!0)}updateNodeAt(e,r,n,i,a){let s=this.top.children[i];return s.dirty==Mu&&s.dom==s.contentDOM&&(s.dirty=nh),s.update(e,r,n,a)?(this.destroyBetween(this.index,i),this.index++,!0):!1}findIndexWithChild(e){for(;;){let r=e.parentNode;if(!r)return-1;if(r==this.top.contentDOM){let n=e.pmViewDesc;if(n){for(let i=this.index;i<this.top.children.length;i++)if(this.top.children[i]==n)return i}return-1}e=r}}updateNextNode(e,r,n,i,a,s){for(let o=this.index;o<this.top.children.length;o++){let l=this.top.children[o];if(l instanceof qd){let u=this.preMatch.matched.get(l);if(u!=null&&u!=a)return!1;let c=l.dom,f,p=this.isLocked(c)&&!(e.isText&&l.node&&l.node.isText&&l.nodeDOM.nodeValue==e.text&&l.dirty!=Mu&&Dx(r,l.outerDeco));if(!p&&l.update(e,r,n,i))return this.destroyBetween(this.index,o),l.dom!=c&&(this.changed=!0),this.index++,!0;if(!p&&(f=this.recreateWrapper(l,e,r,n,i,s)))return this.destroyBetween(this.index,o),this.top.children[this.index]=f,f.contentDOM&&(f.dirty=nh,f.updateChildren(i,s+1),f.dirty=el),this.changed=!0,this.index++,!0;break}}return!1}recreateWrapper(e,r,n,i,a,s){if(e.dirty||r.isAtom||!e.children.length||!e.node.content.eq(r.content)||!Dx(n,e.outerDeco)||!i.eq(e.innerDeco))return null;let o=qd.create(this.top,r,n,i,a,s);if(o.contentDOM){o.children=e.children,e.children=[];for(let l of o.children)l.parent=o}return e.destroy(),o}addNode(e,r,n,i,a){let s=qd.create(this.top,e,r,n,i,a);s.contentDOM&&s.updateChildren(i,a+1),this.top.children.splice(this.index++,0,s),this.changed=!0}placeWidget(e,r,n){let i=this.index<this.top.children.length?this.top.children[this.index]:null;if(i&&i.matchesWidget(e)&&(e==i.widget||!i.widget.type.toDOM.parentNode))this.index++;else{let a=new NO(this.top,e,r,n);this.top.children.splice(this.index++,0,a),this.changed=!0}}addTextblockHacks(){let e=this.top.children[this.index-1],r=this.top;for(;e instanceof _h;)r=e,e=r.children[r.children.length-1];(!e||!(e instanceof tb)||/\n$/.test(e.node.text)||this.view.requiresGeckoHackNode&&/\s$/.test(e.node.text))&&((Ua||pa)&&e&&e.dom.contentEditable=="false"&&this.addHackNode("IMG",r),this.addHackNode("BR",this.top))}addHackNode(e,r){if(r==this.top&&this.index<r.children.length&&r.children[this.index].matchesHack(e))this.index++;else{let n=document.createElement(e);e=="IMG"&&(n.className="ProseMirror-separator",n.alt=""),e=="BR"&&(n.className="ProseMirror-trailingBreak");let i=new PO(this.top,[],n,null);r!=this.top?r.children.push(i):r.children.splice(this.index++,0,i),this.changed=!0}}isLocked(e){return this.lock&&(e==this.lock||e.nodeType==1&&e.contains(this.lock.parentNode))}}function XY(t,e){let r=e,n=r.children.length,i=t.childCount,a=new Map,s=[];e:for(;i>0;){let o;for(;;)if(n){let u=r.children[n-1];if(u instanceof _h)r=u,n=u.children.length;else{o=u,n--;break}}else{if(r==e)break e;n=r.parent.children.indexOf(r),r=r.parent}let l=o.node;if(l){if(l!=t.child(i-1))break;--i,a.set(o,i),s.push(o)}}return{index:i,matched:a,matches:s.reverse()}}function QY(t,e){return t.type.side-e.type.side}function JY(t,e,r,n){let i=e.locals(t),a=0;if(i.length==0){for(let u=0;u<t.childCount;u++){let c=t.child(u);n(c,i,e.forChild(a,c),u),a+=c.nodeSize}return}let s=0,o=[],l=null;for(let u=0;;){let c,f;for(;s<i.length&&i[s].to==a;){let w=i[s++];w.widget&&(c?(f||(f=[c])).push(w):c=w)}if(c)if(f){f.sort(QY);for(let w=0;w<f.length;w++)r(f[w],u,!!l)}else r(c,u,!!l);let p,g;if(l)g=-1,p=l,l=null;else if(u<t.childCount)g=u,p=t.child(u++);else break;for(let w=0;w<o.length;w++)o[w].to<=a&&o.splice(w--,1);for(;s<i.length&&i[s].from<=a&&i[s].to>a;)o.push(i[s++]);let y=a+p.nodeSize;if(p.isText){let w=y;s<i.length&&i[s].from<w&&(w=i[s].from);for(let C=0;C<o.length;C++)o[C].to<w&&(w=o[C].to);w<y&&(l=p.cut(w-a),p=p.cut(0,w-a),y=w,g=-1)}else for(;s<i.length&&i[s].to<y;)s++;let S=p.isInline&&!p.isLeaf?o.filter(w=>!w.inline):o.slice();n(p,S,e.forChild(a,p),g),a=y}}function eX(t){if(t.nodeName=="UL"||t.nodeName=="OL"){let e=t.style.cssText;t.style.cssText=e+"; list-style: square !important",window.getComputedStyle(t).listStyle,t.style.cssText=e}}function tX(t,e,r,n){for(let i=0,a=0;i<t.childCount&&a<=n;){let s=t.child(i++),o=a;if(a+=s.nodeSize,!s.isText)continue;let l=s.text;for(;i<t.childCount;){let u=t.child(i++);if(a+=u.nodeSize,!u.isText)break;l+=u.text}if(a>=r){if(a>=n&&l.slice(n-e.length-o,n-o)==e)return n-e.length;let u=o<n?l.lastIndexOf(e,n-o-1):-1;if(u>=0&&u+e.length+o>=r)return o+u;if(r==n&&l.length>=n+e.length-o&&l.slice(n-o,n-o+e.length)==e)return n}}return-1}function Ek(t,e,r,n,i){let a=[];for(let s=0,o=0;s<t.length;s++){let l=t[s],u=o,c=o+=l.size;u>=r||c<=e?a.push(l):(u<e&&a.push(l.slice(0,e-u,n)),i&&(a.push(i),i=void 0),c>r&&a.push(l.slice(r-u,l.size,n)))}return a}function eC(t,e=null){let r=t.domSelectionRange(),n=t.state.doc;if(!r.focusNode)return null;let i=t.docView.nearestDesc(r.focusNode),a=i&&i.size==0,s=t.docView.posFromDOM(r.focusNode,r.focusOffset,1);if(s<0)return null;let o=n.resolve(s),l,u;if(eb(r)){for(l=s;i&&!i.node;)i=i.parent;let f=i.node;if(i&&f.isAtom&&Jt.isSelectable(f)&&i.parent&&!(f.isInline&&NY(r.focusNode,r.focusOffset,i.dom))){let p=i.posBefore;u=new Jt(s==p?o:n.resolve(p))}}else{if(r instanceof t.dom.ownerDocument.defaultView.Selection&&r.rangeCount>1){let f=s,p=s;for(let g=0;g<r.rangeCount;g++){let y=r.getRangeAt(g);f=Math.min(f,t.docView.posFromDOM(y.startContainer,y.startOffset,1)),p=Math.max(p,t.docView.posFromDOM(y.endContainer,y.endOffset,-1))}if(f<0)return null;[l,s]=p==t.state.selection.anchor?[p,f]:[f,p],o=n.resolve(s)}else l=t.docView.posFromDOM(r.anchorNode,r.anchorOffset,1);if(l<0)return null}let c=n.resolve(l);if(!u){let f=e=="pointer"||t.state.selection.head<o.pos&&!a?1:-1;u=tC(t,c,o,f)}return u}function RO(t){return t.editable?t.hasFocus():DO(t)&&document.activeElement&&document.activeElement.contains(t.dom)}function vc(t,e=!1){let r=t.state.selection;if(OO(t,r),!!RO(t)){if(!e&&t.input.mouseDown&&t.input.mouseDown.allowDefault&&pa){let n=t.domSelectionRange(),i=t.domObserver.currentSelection;if(n.anchorNode&&i.anchorNode&&kh(n.anchorNode,n.anchorOffset,i.anchorNode,i.anchorOffset)){t.input.mouseDown.delayedSelectionSync=!0,t.domObserver.setCurSelection();return}}if(t.domObserver.disconnectSelection(),t.cursorWrapper)nX(t);else{let{anchor:n,head:i}=r,a,s;$3&&!(r instanceof fr)&&(r.$from.parent.inlineContent||(a=K3(t,r.from)),!r.empty&&!r.$from.parent.inlineContent&&(s=K3(t,r.to))),t.docView.setSelection(n,i,t,e),$3&&(a&&Z3(a),s&&Z3(s)),r.visible?t.dom.classList.remove("ProseMirror-hideselection"):(t.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&rX(t))}t.domObserver.setCurSelection(),t.domObserver.connectSelection()}}const $3=Ua||pa&&bO<63;function K3(t,e){let{node:r,offset:n}=t.docView.domFromPos(e,0),i=n<r.childNodes.length?r.childNodes[n]:null,a=n?r.childNodes[n-1]:null;if(Ua&&i&&i.contentEditable=="false")return uS(i);if((!i||i.contentEditable=="false")&&(!a||a.contentEditable=="false")){if(i)return uS(i);if(a)return uS(a)}}function uS(t){return t.contentEditable="true",Ua&&t.draggable&&(t.draggable=!1,t.wasDraggable=!0),t}function Z3(t){t.contentEditable="false",t.wasDraggable&&(t.draggable=!0,t.wasDraggable=null)}function rX(t){let e=t.dom.ownerDocument;e.removeEventListener("selectionchange",t.input.hideSelectionGuard);let r=t.domSelectionRange(),n=r.anchorNode,i=r.anchorOffset;e.addEventListener("selectionchange",t.input.hideSelectionGuard=()=>{(r.anchorNode!=n||r.anchorOffset!=i)&&(e.removeEventListener("selectionchange",t.input.hideSelectionGuard),setTimeout(()=>{(!RO(t)||t.state.selection.visible)&&t.dom.classList.remove("ProseMirror-hideselection")},20))})}function nX(t){let e=t.domSelection();if(!e)return;let r=t.cursorWrapper.dom,n=r.nodeName=="IMG";n?e.collapse(r.parentNode,ja(r)+1):e.collapse(r,0),!n&&!t.state.selection.visible&&Xs&&Wd<=11&&(r.disabled=!0,r.disabled=!1)}function OO(t,e){if(e instanceof Jt){let r=t.docView.descAt(e.from);r!=t.lastSelectedViewDesc&&(Y3(t),r&&r.selectNode(),t.lastSelectedViewDesc=r)}else Y3(t)}function Y3(t){t.lastSelectedViewDesc&&(t.lastSelectedViewDesc.parent&&t.lastSelectedViewDesc.deselectNode(),t.lastSelectedViewDesc=void 0)}function tC(t,e,r,n){return t.someProp("createSelectionBetween",i=>i(t,e,r))||fr.between(e,r,n)}function X3(t){return t.editable&&!t.hasFocus()?!1:DO(t)}function DO(t){let e=t.domSelectionRange();if(!e.anchorNode)return!1;try{return t.dom.contains(e.anchorNode.nodeType==3?e.anchorNode.parentNode:e.anchorNode)&&(t.editable||t.dom.contains(e.focusNode.nodeType==3?e.focusNode.parentNode:e.focusNode))}catch{return!1}}function iX(t){let e=t.docView.domFromPos(t.state.selection.anchor,0),r=t.domSelectionRange();return kh(e.node,e.offset,r.anchorNode,r.anchorOffset)}function Tk(t,e){let{$anchor:r,$head:n}=t.selection,i=e>0?r.max(n):r.min(n),a=i.parent.inlineContent?i.depth?t.doc.resolve(e>0?i.after():i.before()):null:i;return a&&_r.findFrom(a,e)}function Td(t,e){return t.dispatch(t.state.tr.setSelection(e).scrollIntoView()),!0}function Q3(t,e,r){let n=t.state.selection;if(n instanceof fr)if(r.indexOf("s")>-1){let{$head:i}=n,a=i.textOffset?null:e<0?i.nodeBefore:i.nodeAfter;if(!a||a.isText||!a.isLeaf)return!1;let s=t.state.doc.resolve(i.pos+a.nodeSize*(e<0?-1:1));return Td(t,new fr(n.$anchor,s))}else if(n.empty){if(t.endOfTextblock(e>0?"forward":"backward")){let i=Tk(t.state,e);return i&&i instanceof Jt?Td(t,i):!1}else if(!(Ko&&r.indexOf("m")>-1)){let i=n.$head,a=i.textOffset?null:e<0?i.nodeBefore:i.nodeAfter,s;if(!a||a.isText)return!1;let o=e<0?i.pos-a.nodeSize:i.pos;return a.isAtom||(s=t.docView.descAt(o))&&!s.contentDOM?Jt.isSelectable(a)?Td(t,new Jt(e<0?t.state.doc.resolve(i.pos-a.nodeSize):i)):m0?Td(t,new fr(t.state.doc.resolve(e<0?o:o+a.nodeSize))):!1:!1}}else return!1;else{if(n instanceof Jt&&n.node.isInline)return Td(t,new fr(e>0?n.$to:n.$from));{let i=Tk(t.state,e);return i?Td(t,i):!1}}}function Ix(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}function uv(t,e){let r=t.pmViewDesc;return r&&r.size==0&&(e<0||t.nextSibling||t.nodeName!="BR")}function kp(t,e){return e<0?aX(t):sX(t)}function aX(t){let e=t.domSelectionRange(),r=e.focusNode,n=e.focusOffset;if(!r)return;let i,a,s=!1;for(Jo&&r.nodeType==1&&n<Ix(r)&&uv(r.childNodes[n],-1)&&(s=!0);;)if(n>0){if(r.nodeType!=1)break;{let o=r.childNodes[n-1];if(uv(o,-1))i=r,a=--n;else if(o.nodeType==3)r=o,n=r.nodeValue.length;else break}}else{if(IO(r))break;{let o=r.previousSibling;for(;o&&uv(o,-1);)i=r.parentNode,a=ja(o),o=o.previousSibling;if(o)r=o,n=Ix(r);else{if(r=r.parentNode,r==t.dom)break;n=0}}}s?Nk(t,r,n):i&&Nk(t,i,a)}function sX(t){let e=t.domSelectionRange(),r=e.focusNode,n=e.focusOffset;if(!r)return;let i=Ix(r),a,s;for(;;)if(n<i){if(r.nodeType!=1)break;let o=r.childNodes[n];if(uv(o,1))a=r,s=++n;else break}else{if(IO(r))break;{let o=r.nextSibling;for(;o&&uv(o,1);)a=o.parentNode,s=ja(o)+1,o=o.nextSibling;if(o)r=o,n=0,i=Ix(r);else{if(r=r.parentNode,r==t.dom)break;n=i=0}}}a&&Nk(t,a,s)}function IO(t){let e=t.pmViewDesc;return e&&e.node&&e.node.isBlock}function oX(t,e){for(;t&&e==t.childNodes.length&&!p0(t);)e=ja(t)+1,t=t.parentNode;for(;t&&e<t.childNodes.length;){let r=t.childNodes[e];if(r.nodeType==3)return r;if(r.nodeType==1&&r.contentEditable=="false")break;t=r,e=0}}function lX(t,e){for(;t&&!e&&!p0(t);)e=ja(t),t=t.parentNode;for(;t&&e;){let r=t.childNodes[e-1];if(r.nodeType==3)return r;if(r.nodeType==1&&r.contentEditable=="false")break;t=r,e=t.childNodes.length}}function Nk(t,e,r){if(e.nodeType!=3){let a,s;(s=oX(e,r))?(e=s,r=0):(a=lX(e,r))&&(e=a,r=a.nodeValue.length)}let n=t.domSelection();if(!n)return;if(eb(n)){let a=document.createRange();a.setEnd(e,r),a.setStart(e,r),n.removeAllRanges(),n.addRange(a)}else n.extend&&n.extend(e,r);t.domObserver.setCurSelection();let{state:i}=t;setTimeout(()=>{t.state==i&&vc(t)},50)}function J3(t,e){let r=t.state.doc.resolve(e);if(!(pa||wO)&&r.parent.inlineContent){let i=t.coordsAtPos(e);if(e>r.start()){let a=t.coordsAtPos(e-1),s=(a.top+a.bottom)/2;if(s>i.top&&s<i.bottom&&Math.abs(a.left-i.left)>1)return a.left<i.left?"ltr":"rtl"}if(e<r.end()){let a=t.coordsAtPos(e+1),s=(a.top+a.bottom)/2;if(s>i.top&&s<i.bottom&&Math.abs(a.left-i.left)>1)return a.left>i.left?"ltr":"rtl"}}return getComputedStyle(t.dom).direction=="rtl"?"rtl":"ltr"}function eP(t,e,r){let n=t.state.selection;if(n instanceof fr&&!n.empty||r.indexOf("s")>-1||Ko&&r.indexOf("m")>-1)return!1;let{$from:i,$to:a}=n;if(!i.parent.inlineContent||t.endOfTextblock(e<0?"up":"down")){let s=Tk(t.state,e);if(s&&s instanceof Jt)return Td(t,s)}if(!i.parent.inlineContent){let s=e<0?i:a,o=n instanceof yo?_r.near(s,e):_r.findFrom(s,e);return o?Td(t,o):!1}return!1}function tP(t,e){if(!(t.state.selection instanceof fr))return!0;let{$head:r,$anchor:n,empty:i}=t.state.selection;if(!r.sameParent(n))return!0;if(!i)return!1;if(t.endOfTextblock(e>0?"forward":"backward"))return!0;let a=!r.textOffset&&(e<0?r.nodeBefore:r.nodeAfter);if(a&&!a.isText){let s=t.state.tr;return e<0?s.delete(r.pos-a.nodeSize,r.pos):s.delete(r.pos,r.pos+a.nodeSize),t.dispatch(s),!0}return!1}function rP(t,e,r){t.domObserver.stop(),e.contentEditable=r,t.domObserver.start()}function uX(t){if(!Ua||t.state.selection.$head.parentOffset>0)return!1;let{focusNode:e,focusOffset:r}=t.domSelectionRange();if(e&&e.nodeType==1&&r==0&&e.firstChild&&e.firstChild.contentEditable=="false"){let n=e.firstChild;rP(t,n,"true"),setTimeout(()=>rP(t,n,"false"),20)}return!1}function cX(t){let e="";return t.ctrlKey&&(e+="c"),t.metaKey&&(e+="m"),t.altKey&&(e+="a"),t.shiftKey&&(e+="s"),e}function dX(t,e){let r=e.keyCode,n=cX(e);if(r==8||Ko&&r==72&&n=="c")return tP(t,-1)||kp(t,-1);if(r==46&&!e.shiftKey||Ko&&r==68&&n=="c")return tP(t,1)||kp(t,1);if(r==13||r==27)return!0;if(r==37||Ko&&r==66&&n=="c"){let i=r==37?J3(t,t.state.selection.from)=="ltr"?-1:1:-1;return Q3(t,i,n)||kp(t,i)}else if(r==39||Ko&&r==70&&n=="c"){let i=r==39?J3(t,t.state.selection.from)=="ltr"?1:-1:1;return Q3(t,i,n)||kp(t,i)}else{if(r==38||Ko&&r==80&&n=="c")return eP(t,-1,n)||kp(t,-1);if(r==40||Ko&&r==78&&n=="c")return uX(t)||eP(t,1,n)||kp(t,1);if(n==(Ko?"m":"c")&&(r==66||r==73||r==89||r==90))return!0}return!1}function rC(t,e){t.someProp("transformCopied",g=>{e=g(e,t)});let r=[],{content:n,openStart:i,openEnd:a}=e;for(;i>1&&a>1&&n.childCount==1&&n.firstChild.childCount==1;){i--,a--;let g=n.firstChild;r.push(g.type.name,g.attrs!=g.type.defaultAttrs?g.attrs:null),n=g.content}let s=t.someProp("clipboardSerializer")||Mh.fromSchema(t.state.schema),o=GO(),l=o.createElement("div");l.appendChild(s.serializeFragment(n,{document:o}));let u=l.firstChild,c,f=0;for(;u&&u.nodeType==1&&(c=UO[u.nodeName.toLowerCase()]);){for(let g=c.length-1;g>=0;g--){let y=o.createElement(c[g]);for(;l.firstChild;)y.appendChild(l.firstChild);l.appendChild(y),f++}u=l.firstChild}u&&u.nodeType==1&&u.setAttribute("data-pm-slice",`${i} ${a}${f?` -${f}`:""} ${JSON.stringify(r)}`);let p=t.someProp("clipboardTextSerializer",g=>g(e,t))||e.content.textBetween(0,e.content.size,`

`);return{dom:l,text:p,slice:e}}function jO(t,e,r,n,i){let a=i.parent.type.spec.code,s,o;if(!r&&!e)return null;let l=!!e&&(n||a||!r);if(l){if(t.someProp("transformPastedText",p=>{e=p(e,a||n,t)}),a)return o=new Ot(at.from(t.state.schema.text(e.replace(/\r\n?/g,`
`))),0,0),t.someProp("transformPasted",p=>{o=p(o,t,!0)}),o;let f=t.someProp("clipboardTextParser",p=>p(e,i,n,t));if(f)o=f;else{let p=i.marks(),{schema:g}=t.state,y=Mh.fromSchema(g);s=document.createElement("div"),e.split(/(?:\r\n?|\n)+/).forEach(S=>{let w=s.appendChild(document.createElement("p"));S&&w.appendChild(y.serializeNode(g.text(S,p)))})}}else t.someProp("transformPastedHTML",f=>{r=f(r,t)}),s=mX(r),m0&&gX(s);let u=s&&s.querySelector("[data-pm-slice]"),c=u&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(u.getAttribute("data-pm-slice")||"");if(c&&c[3])for(let f=+c[3];f>0;f--){let p=s.firstChild;for(;p&&p.nodeType!=1;)p=p.nextSibling;if(!p)break;s=p}if(o||(o=(t.someProp("clipboardParser")||t.someProp("domParser")||Hd.fromSchema(t.state.schema)).parseSlice(s,{preserveWhitespace:!!(l||c),context:i,ruleFromNode(p){return p.nodeName=="BR"&&!p.nextSibling&&p.parentNode&&!fX.test(p.parentNode.nodeName)?{ignore:!0}:null}})),c)o=vX(nP(o,+c[1],+c[2]),c[4]);else if(o=Ot.maxOpen(hX(o.content,i),!0),o.openStart||o.openEnd){let f=0,p=0;for(let g=o.content.firstChild;f<o.openStart&&!g.type.spec.isolating;f++,g=g.firstChild);for(let g=o.content.lastChild;p<o.openEnd&&!g.type.spec.isolating;p++,g=g.lastChild);o=nP(o,f,p)}return t.someProp("transformPasted",f=>{o=f(o,t,l)}),o}const fX=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function hX(t,e){if(t.childCount<2)return t;for(let r=e.depth;r>=0;r--){let i=e.node(r).contentMatchAt(e.index(r)),a,s=[];if(t.forEach(o=>{if(!s)return;let l=i.findWrapping(o.type),u;if(!l)return s=null;if(u=s.length&&a.length&&BO(l,a,o,s[s.length-1],0))s[s.length-1]=u;else{s.length&&(s[s.length-1]=zO(s[s.length-1],a.length));let c=FO(o,l);s.push(c),i=i.matchType(c.type),a=l}}),s)return at.from(s)}return t}function FO(t,e,r=0){for(let n=e.length-1;n>=r;n--)t=e[n].create(null,at.from(t));return t}function BO(t,e,r,n,i){if(i<t.length&&i<e.length&&t[i]==e[i]){let a=BO(t,e,r,n.lastChild,i+1);if(a)return n.copy(n.content.replaceChild(n.childCount-1,a));if(n.contentMatchAt(n.childCount).matchType(i==t.length-1?r.type:t[i+1]))return n.copy(n.content.append(at.from(FO(r,t,i+1))))}}function zO(t,e){if(e==0)return t;let r=t.content.replaceChild(t.childCount-1,zO(t.lastChild,e-1)),n=t.contentMatchAt(t.childCount).fillBefore(at.empty,!0);return t.copy(r.append(n))}function Pk(t,e,r,n,i,a){let s=e<0?t.firstChild:t.lastChild,o=s.content;return t.childCount>1&&(a=0),i<n-1&&(o=Pk(o,e,r,n,i+1,a)),i>=r&&(o=e<0?s.contentMatchAt(0).fillBefore(o,a<=i).append(o):o.append(s.contentMatchAt(s.childCount).fillBefore(at.empty,!0))),t.replaceChild(e<0?0:t.childCount-1,s.copy(o))}function nP(t,e,r){return e<t.openStart&&(t=new Ot(Pk(t.content,-1,e,t.openStart,0,t.openEnd),e,t.openEnd)),r<t.openEnd&&(t=new Ot(Pk(t.content,1,r,t.openEnd,0,0),t.openStart,r)),t}const UO={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};let iP=null;function GO(){return iP||(iP=document.implementation.createHTMLDocument("title"))}let cS=null;function pX(t){let e=window.trustedTypes;return e?(cS||(cS=e.defaultPolicy||e.createPolicy("ProseMirrorClipboard",{createHTML:r=>r})),cS.createHTML(t)):t}function mX(t){let e=/^(\s*<meta [^>]*>)*/.exec(t);e&&(t=t.slice(e[0].length));let r=GO().createElement("div"),n=/<([a-z][^>\s]+)/i.exec(t),i;if((i=n&&UO[n[1].toLowerCase()])&&(t=i.map(a=>"<"+a+">").join("")+t+i.map(a=>"</"+a+">").reverse().join("")),r.innerHTML=pX(t),i)for(let a=0;a<i.length;a++)r=r.querySelector(i[a])||r;return r}function gX(t){let e=t.querySelectorAll(pa?"span:not([class]):not([style])":"span.Apple-converted-space");for(let r=0;r<e.length;r++){let n=e[r];n.childNodes.length==1&&n.textContent==""&&n.parentNode&&n.parentNode.replaceChild(t.ownerDocument.createTextNode(" "),n)}}function vX(t,e){if(!t.size)return t;let r=t.content.firstChild.type.schema,n;try{n=JSON.parse(e)}catch{return t}let{content:i,openStart:a,openEnd:s}=t;for(let o=n.length-2;o>=0;o-=2){let l=r.nodes[n[o]];if(!l||l.hasRequiredAttrs())break;i=at.from(l.create(n[o+1],i)),a++,s++}return new Ot(i,a,s)}const Ts={},Ns={},yX={touchstart:!0,touchmove:!0};class xX{constructor(){this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:"",button:0},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastFocus=0,this.lastTouch=0,this.lastChromeDelete=0,this.composing=!1,this.compositionNode=null,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.compositionID=1,this.badSafariComposition=!1,this.compositionPendingChanges=0,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null}}function bX(t){for(let e in Ts){let r=Ts[e];t.dom.addEventListener(e,t.input.eventHandlers[e]=n=>{SX(t,n)&&!nC(t,n)&&(t.editable||!(n.type in Ns))&&r(t,n)},yX[e]?{passive:!0}:void 0)}Ua&&t.dom.addEventListener("input",()=>null),Mk(t)}function Bd(t,e){t.input.lastSelectionOrigin=e,t.input.lastSelectionTime=Date.now()}function wX(t){t.domObserver.stop();for(let e in t.input.eventHandlers)t.dom.removeEventListener(e,t.input.eventHandlers[e]);clearTimeout(t.input.composingTimeout),clearTimeout(t.input.lastIOSEnterFallbackTimeout)}function Mk(t){t.someProp("handleDOMEvents",e=>{for(let r in e)t.input.eventHandlers[r]||t.dom.addEventListener(r,t.input.eventHandlers[r]=n=>nC(t,n))})}function nC(t,e){return t.someProp("handleDOMEvents",r=>{let n=r[e.type];return n?n(t,e)||e.defaultPrevented:!1})}function SX(t,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let r=e.target;r!=t.dom;r=r.parentNode)if(!r||r.nodeType==11||r.pmViewDesc&&r.pmViewDesc.stopEvent(e))return!1;return!0}function kX(t,e){!nC(t,e)&&Ts[e.type]&&(t.editable||!(e.type in Ns))&&Ts[e.type](t,e)}Ns.keydown=(t,e)=>{let r=e;if(t.input.shiftKey=r.keyCode==16||r.shiftKey,!HO(t,r)&&(t.input.lastKeyCode=r.keyCode,t.input.lastKeyCodeTime=Date.now(),!(pc&&pa&&r.keyCode==13)))if(r.keyCode!=229&&t.domObserver.forceFlush(),Xp&&r.keyCode==13&&!r.ctrlKey&&!r.altKey&&!r.metaKey){let n=Date.now();t.input.lastIOSEnter=n,t.input.lastIOSEnterFallbackTimeout=setTimeout(()=>{t.input.lastIOSEnter==n&&(t.someProp("handleKeyDown",i=>i(t,eh(13,"Enter"))),t.input.lastIOSEnter=0)},200)}else t.someProp("handleKeyDown",n=>n(t,r))||dX(t,r)?r.preventDefault():Bd(t,"key")};Ns.keyup=(t,e)=>{e.keyCode==16&&(t.input.shiftKey=!1)};Ns.keypress=(t,e)=>{let r=e;if(HO(t,r)||!r.charCode||r.ctrlKey&&!r.altKey||Ko&&r.metaKey)return;if(t.someProp("handleKeyPress",i=>i(t,r))){r.preventDefault();return}let n=t.state.selection;if(!(n instanceof fr)||!n.$from.sameParent(n.$to)){let i=String.fromCharCode(r.charCode),a=()=>t.state.tr.insertText(i).scrollIntoView();!/[\r\n]/.test(i)&&!t.someProp("handleTextInput",s=>s(t,n.$from.pos,n.$to.pos,i,a))&&t.dispatch(a()),r.preventDefault()}};function rb(t){return{left:t.clientX,top:t.clientY}}function _X(t,e){let r=e.x-t.clientX,n=e.y-t.clientY;return r*r+n*n<100}function iC(t,e,r,n,i){if(n==-1)return!1;let a=t.state.doc.resolve(n);for(let s=a.depth+1;s>0;s--)if(t.someProp(e,o=>s>a.depth?o(t,r,a.nodeAfter,a.before(s),i,!0):o(t,r,a.node(s),a.before(s),i,!1)))return!0;return!1}function Gp(t,e,r){if(t.focused||t.focus(),t.state.selection.eq(e))return;let n=t.state.tr.setSelection(e);n.setMeta("pointer",!0),t.dispatch(n)}function CX(t,e){if(e==-1)return!1;let r=t.state.doc.resolve(e),n=r.nodeAfter;return n&&n.isAtom&&Jt.isSelectable(n)?(Gp(t,new Jt(r)),!0):!1}function EX(t,e){if(e==-1)return!1;let r=t.state.selection,n,i;r instanceof Jt&&(n=r.node);let a=t.state.doc.resolve(e);for(let s=a.depth+1;s>0;s--){let o=s>a.depth?a.nodeAfter:a.node(s);if(Jt.isSelectable(o)){n&&r.$from.depth>0&&s>=r.$from.depth&&a.before(r.$from.depth+1)==r.$from.pos?i=a.before(r.$from.depth):i=a.before(s);break}}return i!=null?(Gp(t,Jt.create(t.state.doc,i)),!0):!1}function TX(t,e,r,n,i){return iC(t,"handleClickOn",e,r,n)||t.someProp("handleClick",a=>a(t,e,n))||(i?EX(t,r):CX(t,r))}function NX(t,e,r,n){return iC(t,"handleDoubleClickOn",e,r,n)||t.someProp("handleDoubleClick",i=>i(t,e,n))}function PX(t,e,r,n){return iC(t,"handleTripleClickOn",e,r,n)||t.someProp("handleTripleClick",i=>i(t,e,n))||MX(t,r,n)}function MX(t,e,r){if(r.button!=0)return!1;let n=t.state.doc;if(e==-1)return n.inlineContent?(Gp(t,fr.create(n,0,n.content.size)),!0):!1;let i=n.resolve(e);for(let a=i.depth+1;a>0;a--){let s=a>i.depth?i.nodeAfter:i.node(a),o=i.before(a);if(s.inlineContent)Gp(t,fr.create(n,o+1,o+1+s.content.size));else if(Jt.isSelectable(s))Gp(t,Jt.create(n,o));else continue;return!0}}function aC(t){return jx(t)}const VO=Ko?"metaKey":"ctrlKey";Ts.mousedown=(t,e)=>{let r=e;t.input.shiftKey=r.shiftKey;let n=aC(t),i=Date.now(),a="singleClick";i-t.input.lastClick.time<500&&_X(r,t.input.lastClick)&&!r[VO]&&t.input.lastClick.button==r.button&&(t.input.lastClick.type=="singleClick"?a="doubleClick":t.input.lastClick.type=="doubleClick"&&(a="tripleClick")),t.input.lastClick={time:i,x:r.clientX,y:r.clientY,type:a,button:r.button};let s=t.posAtCoords(rb(r));s&&(a=="singleClick"?(t.input.mouseDown&&t.input.mouseDown.done(),t.input.mouseDown=new AX(t,s,r,!!n)):(a=="doubleClick"?NX:PX)(t,s.pos,s.inside,r)?r.preventDefault():Bd(t,"pointer"))};class AX{constructor(e,r,n,i){this.view=e,this.pos=r,this.event=n,this.flushed=i,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=e.state.doc,this.selectNode=!!n[VO],this.allowDefault=n.shiftKey;let a,s;if(r.inside>-1)a=e.state.doc.nodeAt(r.inside),s=r.inside;else{let c=e.state.doc.resolve(r.pos);a=c.parent,s=c.depth?c.before():0}const o=i?null:n.target,l=o?e.docView.nearestDesc(o,!0):null;this.target=l&&l.nodeDOM.nodeType==1?l.nodeDOM:null;let{selection:u}=e.state;(n.button==0&&a.type.spec.draggable&&a.type.spec.selectable!==!1||u instanceof Jt&&u.from<=s&&u.to>s)&&(this.mightDrag={node:a,pos:s,addAttr:!!(this.target&&!this.target.draggable),setUneditable:!!(this.target&&Jo&&!this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),e.root.addEventListener("mouseup",this.up=this.up.bind(this)),e.root.addEventListener("mousemove",this.move=this.move.bind(this)),Bd(e,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(()=>vc(this.view)),this.view.input.mouseDown=null}up(e){if(this.done(),!this.view.dom.contains(e.target))return;let r=this.pos;this.view.state.doc!=this.startDoc&&(r=this.view.posAtCoords(rb(e))),this.updateAllowDefault(e),this.allowDefault||!r?Bd(this.view,"pointer"):TX(this.view,r.pos,r.inside,e,this.selectNode)?e.preventDefault():e.button==0&&(this.flushed||Ua&&this.mightDrag&&!this.mightDrag.node.isAtom||pa&&!this.view.state.selection.visible&&Math.min(Math.abs(r.pos-this.view.state.selection.from),Math.abs(r.pos-this.view.state.selection.to))<=2)?(Gp(this.view,_r.near(this.view.state.doc.resolve(r.pos))),e.preventDefault()):Bd(this.view,"pointer")}move(e){this.updateAllowDefault(e),Bd(this.view,"pointer"),e.buttons==0&&this.done()}updateAllowDefault(e){!this.allowDefault&&(Math.abs(this.event.x-e.clientX)>4||Math.abs(this.event.y-e.clientY)>4)&&(this.allowDefault=!0)}}Ts.touchstart=t=>{t.input.lastTouch=Date.now(),aC(t),Bd(t,"pointer")};Ts.touchmove=t=>{t.input.lastTouch=Date.now(),Bd(t,"pointer")};Ts.contextmenu=t=>aC(t);function HO(t,e){return t.composing?!0:Ua&&Math.abs(e.timeStamp-t.input.compositionEndedAt)<500?(t.input.compositionEndedAt=-2e8,!0):!1}const LX=pc?5e3:-1;Ns.compositionstart=Ns.compositionupdate=t=>{if(!t.composing){t.domObserver.flush();let{state:e}=t,r=e.selection.$to;if(e.selection instanceof fr&&(e.storedMarks||!r.textOffset&&r.parentOffset&&r.nodeBefore.marks.some(n=>n.type.spec.inclusive===!1)||pa&&wO&&RX(t)))t.markCursor=t.state.storedMarks||r.marks(),jx(t,!0),t.markCursor=null;else if(jx(t,!e.selection.empty),Jo&&e.selection.empty&&r.parentOffset&&!r.textOffset&&r.nodeBefore.marks.length){let n=t.domSelectionRange();for(let i=n.focusNode,a=n.focusOffset;i&&i.nodeType==1&&a!=0;){let s=a<0?i.lastChild:i.childNodes[a-1];if(!s)break;if(s.nodeType==3){let o=t.domSelection();o&&o.collapse(s,s.nodeValue.length);break}else i=s,a=-1}}t.input.composing=!0}WO(t,LX)};function RX(t){let{focusNode:e,focusOffset:r}=t.domSelectionRange();if(!e||e.nodeType!=1||r>=e.childNodes.length)return!1;let n=e.childNodes[r];return n.nodeType==1&&n.contentEditable=="false"}Ns.compositionend=(t,e)=>{t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=e.timeStamp,t.input.compositionPendingChanges=t.domObserver.pendingRecords().length?t.input.compositionID:0,t.input.compositionNode=null,t.input.badSafariComposition?t.domObserver.forceFlush():t.input.compositionPendingChanges&&Promise.resolve().then(()=>t.domObserver.flush()),t.input.compositionID++,WO(t,20))};function WO(t,e){clearTimeout(t.input.composingTimeout),e>-1&&(t.input.composingTimeout=setTimeout(()=>jx(t),e))}function qO(t){for(t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=DX());t.input.compositionNodes.length>0;)t.input.compositionNodes.pop().markParentsDirty()}function OX(t){let e=t.domSelectionRange();if(!e.focusNode)return null;let r=EY(e.focusNode,e.focusOffset),n=TY(e.focusNode,e.focusOffset);if(r&&n&&r!=n){let i=n.pmViewDesc,a=t.domObserver.lastChangedTextNode;if(r==a||n==a)return a;if(!i||!i.isText(n.nodeValue))return n;if(t.input.compositionNode==n){let s=r.pmViewDesc;if(!(!s||!s.isText(r.nodeValue)))return n}}return r||n}function DX(){let t=document.createEvent("Event");return t.initEvent("event",!0,!0),t.timeStamp}function jx(t,e=!1){if(!(pc&&t.domObserver.flushingSoon>=0)){if(t.domObserver.forceFlush(),qO(t),e||t.docView&&t.docView.dirty){let r=eC(t),n=t.state.selection;return r&&!r.eq(n)?t.dispatch(t.state.tr.setSelection(r)):(t.markCursor||e)&&!n.$from.node(n.$from.sharedDepth(n.to)).inlineContent?t.dispatch(t.state.tr.deleteSelection()):t.updateState(t.state),!0}return!1}}function IX(t,e){if(!t.dom.parentNode)return;let r=t.dom.parentNode.appendChild(document.createElement("div"));r.appendChild(e),r.style.cssText="position: fixed; left: -10000px; top: 10px";let n=getSelection(),i=document.createRange();i.selectNodeContents(e),t.dom.blur(),n.removeAllRanges(),n.addRange(i),setTimeout(()=>{r.parentNode&&r.parentNode.removeChild(r),t.focus()},50)}const Bv=Xs&&Wd<15||Xp&&AY<604;Ts.copy=Ns.cut=(t,e)=>{let r=e,n=t.state.selection,i=r.type=="cut";if(n.empty)return;let a=Bv?null:r.clipboardData,s=n.content(),{dom:o,text:l}=rC(t,s);a?(r.preventDefault(),a.clearData(),a.setData("text/html",o.innerHTML),a.setData("text/plain",l)):IX(t,o),i&&t.dispatch(t.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))};function jX(t){return t.openStart==0&&t.openEnd==0&&t.content.childCount==1?t.content.firstChild:null}function FX(t,e){if(!t.dom.parentNode)return;let r=t.input.shiftKey||t.state.selection.$from.parent.type.spec.code,n=t.dom.parentNode.appendChild(document.createElement(r?"textarea":"div"));r||(n.contentEditable="true"),n.style.cssText="position: fixed; left: -10000px; top: 10px",n.focus();let i=t.input.shiftKey&&t.input.lastKeyCode!=45;setTimeout(()=>{t.focus(),n.parentNode&&n.parentNode.removeChild(n),r?zv(t,n.value,null,i,e):zv(t,n.textContent,n.innerHTML,i,e)},50)}function zv(t,e,r,n,i){let a=jO(t,e,r,n,t.state.selection.$from);if(t.someProp("handlePaste",l=>l(t,i,a||Ot.empty)))return!0;if(!a)return!1;let s=jX(a),o=s?t.state.tr.replaceSelectionWith(s,n):t.state.tr.replaceSelection(a);return t.dispatch(o.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}function $O(t){let e=t.getData("text/plain")||t.getData("Text");if(e)return e;let r=t.getData("text/uri-list");return r?r.replace(/\r?\n/g," "):""}Ns.paste=(t,e)=>{let r=e;if(t.composing&&!pc)return;let n=Bv?null:r.clipboardData,i=t.input.shiftKey&&t.input.lastKeyCode!=45;n&&zv(t,$O(n),n.getData("text/html"),i,r)?r.preventDefault():FX(t,r)};class KO{constructor(e,r,n){this.slice=e,this.move=r,this.node=n}}const BX=Ko?"altKey":"ctrlKey";function ZO(t,e){let r=t.someProp("dragCopies",n=>!n(e));return r??!e[BX]}Ts.dragstart=(t,e)=>{let r=e,n=t.input.mouseDown;if(n&&n.done(),!r.dataTransfer)return;let i=t.state.selection,a=i.empty?null:t.posAtCoords(rb(r)),s;if(!(a&&a.pos>=i.from&&a.pos<=(i instanceof Jt?i.to-1:i.to))){if(n&&n.mightDrag)s=Jt.create(t.state.doc,n.mightDrag.pos);else if(r.target&&r.target.nodeType==1){let f=t.docView.nearestDesc(r.target,!0);f&&f.node.type.spec.draggable&&f!=t.docView&&(s=Jt.create(t.state.doc,f.posBefore))}}let o=(s||t.state.selection).content(),{dom:l,text:u,slice:c}=rC(t,o);(!r.dataTransfer.files.length||!pa||bO>120)&&r.dataTransfer.clearData(),r.dataTransfer.setData(Bv?"Text":"text/html",l.innerHTML),r.dataTransfer.effectAllowed="copyMove",Bv||r.dataTransfer.setData("text/plain",u),t.dragging=new KO(c,ZO(t,r),s)};Ts.dragend=t=>{let e=t.dragging;window.setTimeout(()=>{t.dragging==e&&(t.dragging=null)},50)};Ns.dragover=Ns.dragenter=(t,e)=>e.preventDefault();Ns.drop=(t,e)=>{try{zX(t,e,t.dragging)}finally{t.dragging=null}};function zX(t,e,r){if(!e.dataTransfer)return;let n=t.posAtCoords(rb(e));if(!n)return;let i=t.state.doc.resolve(n.pos),a=r&&r.slice;a?t.someProp("transformPasted",g=>{a=g(a,t,!1)}):a=jO(t,$O(e.dataTransfer),Bv?null:e.dataTransfer.getData("text/html"),!1,i);let s=!!(r&&ZO(t,e));if(t.someProp("handleDrop",g=>g(t,e,a||Ot.empty,s))){e.preventDefault();return}if(!a)return;e.preventDefault();let o=a?JR(t.state.doc,i.pos,a):i.pos;o==null&&(o=i.pos);let l=t.state.tr;if(s){let{node:g}=r;g?g.replace(l):l.deleteSelection()}let u=l.mapping.map(o),c=a.openStart==0&&a.openEnd==0&&a.content.childCount==1,f=l.doc;if(c?l.replaceRangeWith(u,u,a.content.firstChild):l.replaceRange(u,u,a),l.doc.eq(f))return;let p=l.doc.resolve(u);if(c&&Jt.isSelectable(a.content.firstChild)&&p.nodeAfter&&p.nodeAfter.sameMarkup(a.content.firstChild))l.setSelection(new Jt(p));else{let g=l.mapping.map(o);l.mapping.maps[l.mapping.maps.length-1].forEach((y,S,w,C)=>g=C),l.setSelection(tC(t,p,l.doc.resolve(g)))}t.focus(),t.dispatch(l.setMeta("uiEvent","drop"))}Ts.focus=t=>{t.input.lastFocus=Date.now(),t.focused||(t.domObserver.stop(),t.dom.classList.add("ProseMirror-focused"),t.domObserver.start(),t.focused=!0,setTimeout(()=>{t.docView&&t.hasFocus()&&!t.domObserver.currentSelection.eq(t.domSelectionRange())&&vc(t)},20))};Ts.blur=(t,e)=>{let r=e;t.focused&&(t.domObserver.stop(),t.dom.classList.remove("ProseMirror-focused"),t.domObserver.start(),r.relatedTarget&&t.dom.contains(r.relatedTarget)&&t.domObserver.currentSelection.clear(),t.focused=!1)};Ts.beforeinput=(t,e)=>{if(pa&&pc&&e.inputType=="deleteContentBackward"){t.domObserver.flushSoon();let{domChangeCount:n}=t.input;setTimeout(()=>{if(t.input.domChangeCount!=n||(t.dom.blur(),t.focus(),t.someProp("handleKeyDown",a=>a(t,eh(8,"Backspace")))))return;let{$cursor:i}=t.state.selection;i&&i.pos>0&&t.dispatch(t.state.tr.delete(i.pos-1,i.pos).scrollIntoView())},50)}};for(let t in Ns)Ts[t]=Ns[t];function Uv(t,e){if(t==e)return!0;for(let r in t)if(t[r]!==e[r])return!1;for(let r in e)if(!(r in t))return!1;return!0}class Fx{constructor(e,r){this.toDOM=e,this.spec=r||uh,this.side=this.spec.side||0}map(e,r,n,i){let{pos:a,deleted:s}=e.mapResult(r.from+i,this.side<0?-1:1);return s?null:new as(a-n,a-n,this)}valid(){return!0}eq(e){return this==e||e instanceof Fx&&(this.spec.key&&this.spec.key==e.spec.key||this.toDOM==e.toDOM&&Uv(this.spec,e.spec))}destroy(e){this.spec.destroy&&this.spec.destroy(e)}}class $d{constructor(e,r){this.attrs=e,this.spec=r||uh}map(e,r,n,i){let a=e.map(r.from+i,this.spec.inclusiveStart?-1:1)-n,s=e.map(r.to+i,this.spec.inclusiveEnd?1:-1)-n;return a>=s?null:new as(a,s,this)}valid(e,r){return r.from<r.to}eq(e){return this==e||e instanceof $d&&Uv(this.attrs,e.attrs)&&Uv(this.spec,e.spec)}static is(e){return e.type instanceof $d}destroy(){}}class sC{constructor(e,r){this.attrs=e,this.spec=r||uh}map(e,r,n,i){let a=e.mapResult(r.from+i,1);if(a.deleted)return null;let s=e.mapResult(r.to+i,-1);return s.deleted||s.pos<=a.pos?null:new as(a.pos-n,s.pos-n,this)}valid(e,r){let{index:n,offset:i}=e.content.findIndex(r.from),a;return i==r.from&&!(a=e.child(n)).isText&&i+a.nodeSize==r.to}eq(e){return this==e||e instanceof sC&&Uv(this.attrs,e.attrs)&&Uv(this.spec,e.spec)}destroy(){}}class as{constructor(e,r,n){this.from=e,this.to=r,this.type=n}copy(e,r){return new as(e,r,this.type)}eq(e,r=0){return this.type.eq(e.type)&&this.from+r==e.from&&this.to+r==e.to}map(e,r,n){return this.type.map(e,this,r,n)}static widget(e,r,n){return new as(e,e,new Fx(r,n))}static inline(e,r,n,i){return new as(e,r,new $d(n,i))}static node(e,r,n,i){return new as(e,r,new sC(n,i))}get spec(){return this.type.spec}get inline(){return this.type instanceof $d}get widget(){return this.type instanceof Fx}}const Tp=[],uh={};class $n{constructor(e,r){this.local=e.length?e:Tp,this.children=r.length?r:Tp}static create(e,r){return r.length?Bx(r,e,0,uh):is}find(e,r,n){let i=[];return this.findInner(e??0,r??1e9,i,0,n),i}findInner(e,r,n,i,a){for(let s=0;s<this.local.length;s++){let o=this.local[s];o.from<=r&&o.to>=e&&(!a||a(o.spec))&&n.push(o.copy(o.from+i,o.to+i))}for(let s=0;s<this.children.length;s+=3)if(this.children[s]<r&&this.children[s+1]>e){let o=this.children[s]+1;this.children[s+2].findInner(e-o,r-o,n,i+o,a)}}map(e,r,n){return this==is||e.maps.length==0?this:this.mapInner(e,r,0,0,n||uh)}mapInner(e,r,n,i,a){let s;for(let o=0;o<this.local.length;o++){let l=this.local[o].map(e,n,i);l&&l.type.valid(r,l)?(s||(s=[])).push(l):a.onRemove&&a.onRemove(this.local[o].spec)}return this.children.length?UX(this.children,s||[],e,r,n,i,a):s?new $n(s.sort(ch),Tp):is}add(e,r){return r.length?this==is?$n.create(e,r):this.addInner(e,r,0):this}addInner(e,r,n){let i,a=0;e.forEach((o,l)=>{let u=l+n,c;if(c=XO(r,o,u)){for(i||(i=this.children.slice());a<i.length&&i[a]<l;)a+=3;i[a]==l?i[a+2]=i[a+2].addInner(o,c,u+1):i.splice(a,0,l,l+o.nodeSize,Bx(c,o,u+1,uh)),a+=3}});let s=YO(a?QO(r):r,-n);for(let o=0;o<s.length;o++)s[o].type.valid(e,s[o])||s.splice(o--,1);return new $n(s.length?this.local.concat(s).sort(ch):this.local,i||this.children)}remove(e){return e.length==0||this==is?this:this.removeInner(e,0)}removeInner(e,r){let n=this.children,i=this.local;for(let a=0;a<n.length;a+=3){let s,o=n[a]+r,l=n[a+1]+r;for(let c=0,f;c<e.length;c++)(f=e[c])&&f.from>o&&f.to<l&&(e[c]=null,(s||(s=[])).push(f));if(!s)continue;n==this.children&&(n=this.children.slice());let u=n[a+2].removeInner(s,o+1);u!=is?n[a+2]=u:(n.splice(a,3),a-=3)}if(i.length){for(let a=0,s;a<e.length;a++)if(s=e[a])for(let o=0;o<i.length;o++)i[o].eq(s,r)&&(i==this.local&&(i=this.local.slice()),i.splice(o--,1))}return n==this.children&&i==this.local?this:i.length||n.length?new $n(i,n):is}forChild(e,r){if(this==is)return this;if(r.isLeaf)return $n.empty;let n,i;for(let o=0;o<this.children.length;o+=3)if(this.children[o]>=e){this.children[o]==e&&(n=this.children[o+2]);break}let a=e+1,s=a+r.content.size;for(let o=0;o<this.local.length;o++){let l=this.local[o];if(l.from<s&&l.to>a&&l.type instanceof $d){let u=Math.max(a,l.from)-a,c=Math.min(s,l.to)-a;u<c&&(i||(i=[])).push(l.copy(u,c))}}if(i){let o=new $n(i.sort(ch),Tp);return n?new Md([o,n]):o}return n||is}eq(e){if(this==e)return!0;if(!(e instanceof $n)||this.local.length!=e.local.length||this.children.length!=e.children.length)return!1;for(let r=0;r<this.local.length;r++)if(!this.local[r].eq(e.local[r]))return!1;for(let r=0;r<this.children.length;r+=3)if(this.children[r]!=e.children[r]||this.children[r+1]!=e.children[r+1]||!this.children[r+2].eq(e.children[r+2]))return!1;return!0}locals(e){return oC(this.localsInner(e))}localsInner(e){if(this==is)return Tp;if(e.inlineContent||!this.local.some($d.is))return this.local;let r=[];for(let n=0;n<this.local.length;n++)this.local[n].type instanceof $d||r.push(this.local[n]);return r}forEachSet(e){e(this)}}$n.empty=new $n([],[]);$n.removeOverlap=oC;const is=$n.empty;class Md{constructor(e){this.members=e}map(e,r){const n=this.members.map(i=>i.map(e,r,uh));return Md.from(n)}forChild(e,r){if(r.isLeaf)return $n.empty;let n=[];for(let i=0;i<this.members.length;i++){let a=this.members[i].forChild(e,r);a!=is&&(a instanceof Md?n=n.concat(a.members):n.push(a))}return Md.from(n)}eq(e){if(!(e instanceof Md)||e.members.length!=this.members.length)return!1;for(let r=0;r<this.members.length;r++)if(!this.members[r].eq(e.members[r]))return!1;return!0}locals(e){let r,n=!0;for(let i=0;i<this.members.length;i++){let a=this.members[i].localsInner(e);if(a.length)if(!r)r=a;else{n&&(r=r.slice(),n=!1);for(let s=0;s<a.length;s++)r.push(a[s])}}return r?oC(n?r:r.sort(ch)):Tp}static from(e){switch(e.length){case 0:return is;case 1:return e[0];default:return new Md(e.every(r=>r instanceof $n)?e:e.reduce((r,n)=>r.concat(n instanceof $n?n:n.members),[]))}}forEachSet(e){for(let r=0;r<this.members.length;r++)this.members[r].forEachSet(e)}}function UX(t,e,r,n,i,a,s){let o=t.slice();for(let u=0,c=a;u<r.maps.length;u++){let f=0;r.maps[u].forEach((p,g,y,S)=>{let w=S-y-(g-p);for(let C=0;C<o.length;C+=3){let _=o[C+1];if(_<0||p>_+c-f)continue;let T=o[C]+c-f;g>=T?o[C+1]=p<=T?-2:-1:p>=c&&w&&(o[C]+=w,o[C+1]+=w)}f+=w}),c=r.maps[u].map(c,-1)}let l=!1;for(let u=0;u<o.length;u+=3)if(o[u+1]<0){if(o[u+1]==-2){l=!0,o[u+1]=-1;continue}let c=r.map(t[u]+a),f=c-i;if(f<0||f>=n.content.size){l=!0;continue}let p=r.map(t[u+1]+a,-1),g=p-i,{index:y,offset:S}=n.content.findIndex(f),w=n.maybeChild(y);if(w&&S==f&&S+w.nodeSize==g){let C=o[u+2].mapInner(r,w,c+1,t[u]+a+1,s);C!=is?(o[u]=f,o[u+1]=g,o[u+2]=C):(o[u+1]=-2,l=!0)}else l=!0}if(l){let u=GX(o,t,e,r,i,a,s),c=Bx(u,n,0,s);e=c.local;for(let f=0;f<o.length;f+=3)o[f+1]<0&&(o.splice(f,3),f-=3);for(let f=0,p=0;f<c.children.length;f+=3){let g=c.children[f];for(;p<o.length&&o[p]<g;)p+=3;o.splice(p,0,c.children[f],c.children[f+1],c.children[f+2])}}return new $n(e.sort(ch),o)}function YO(t,e){if(!e||!t.length)return t;let r=[];for(let n=0;n<t.length;n++){let i=t[n];r.push(new as(i.from+e,i.to+e,i.type))}return r}function GX(t,e,r,n,i,a,s){function o(l,u){for(let c=0;c<l.local.length;c++){let f=l.local[c].map(n,i,u);f?r.push(f):s.onRemove&&s.onRemove(l.local[c].spec)}for(let c=0;c<l.children.length;c+=3)o(l.children[c+2],l.children[c]+u+1)}for(let l=0;l<t.length;l+=3)t[l+1]==-1&&o(t[l+2],e[l]+a+1);return r}function XO(t,e,r){if(e.isLeaf)return null;let n=r+e.nodeSize,i=null;for(let a=0,s;a<t.length;a++)(s=t[a])&&s.from>r&&s.to<n&&((i||(i=[])).push(s),t[a]=null);return i}function QO(t){let e=[];for(let r=0;r<t.length;r++)t[r]!=null&&e.push(t[r]);return e}function Bx(t,e,r,n){let i=[],a=!1;e.forEach((o,l)=>{let u=XO(t,o,l+r);if(u){a=!0;let c=Bx(u,o,r+l+1,n);c!=is&&i.push(l,l+o.nodeSize,c)}});let s=YO(a?QO(t):t,-r).sort(ch);for(let o=0;o<s.length;o++)s[o].type.valid(e,s[o])||(n.onRemove&&n.onRemove(s[o].spec),s.splice(o--,1));return s.length||i.length?new $n(s,i):is}function ch(t,e){return t.from-e.from||t.to-e.to}function oC(t){let e=t;for(let r=0;r<e.length-1;r++){let n=e[r];if(n.from!=n.to)for(let i=r+1;i<e.length;i++){let a=e[i];if(a.from==n.from){a.to!=n.to&&(e==t&&(e=t.slice()),e[i]=a.copy(a.from,n.to),aP(e,i+1,a.copy(n.to,a.to)));continue}else{a.from<n.to&&(e==t&&(e=t.slice()),e[r]=n.copy(n.from,a.from),aP(e,i,n.copy(a.from,n.to)));break}}}return e}function aP(t,e,r){for(;e<t.length&&ch(r,t[e])>0;)e++;t.splice(e,0,r)}function dS(t){let e=[];return t.someProp("decorations",r=>{let n=r(t.state);n&&n!=is&&e.push(n)}),t.cursorWrapper&&e.push($n.create(t.state.doc,[t.cursorWrapper.deco])),Md.from(e)}const VX={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},HX=Xs&&Wd<=11;class WX{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}set(e){this.anchorNode=e.anchorNode,this.anchorOffset=e.anchorOffset,this.focusNode=e.focusNode,this.focusOffset=e.focusOffset}clear(){this.anchorNode=this.focusNode=null}eq(e){return e.anchorNode==this.anchorNode&&e.anchorOffset==this.anchorOffset&&e.focusNode==this.focusNode&&e.focusOffset==this.focusOffset}}class qX{constructor(e,r){this.view=e,this.handleDOMChange=r,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new WX,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.lastChangedTextNode=null,this.observer=window.MutationObserver&&new window.MutationObserver(n=>{for(let i=0;i<n.length;i++)this.queue.push(n[i]);Xs&&Wd<=11&&n.some(i=>i.type=="childList"&&i.removedNodes.length||i.type=="characterData"&&i.oldValue.length>i.target.nodeValue.length)?this.flushSoon():Ua&&e.composing&&n.some(i=>i.type=="childList"&&i.target.nodeName=="TR")?(e.input.badSafariComposition=!0,this.flushSoon()):this.flush()}),HX&&(this.onCharData=n=>{this.queue.push({target:n.target,type:"characterData",oldValue:n.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}flushSoon(){this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(()=>{this.flushingSoon=-1,this.flush()},20))}forceFlush(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}start(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,VX)),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()}stop(){if(this.observer){let e=this.observer.takeRecords();if(e.length){for(let r=0;r<e.length;r++)this.queue.push(e[r]);window.setTimeout(()=>this.flush(),20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()}connectSelection(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}disconnectSelection(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)}suppressSelectionUpdates(){this.suppressingSelectionUpdates=!0,setTimeout(()=>this.suppressingSelectionUpdates=!1,50)}onSelectionChange(){if(X3(this.view)){if(this.suppressingSelectionUpdates)return vc(this.view);if(Xs&&Wd<=11&&!this.view.state.selection.empty){let e=this.view.domSelectionRange();if(e.focusNode&&kh(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset))return this.flushSoon()}this.flush()}}setCurSelection(){this.currentSelection.set(this.view.domSelectionRange())}ignoreSelectionChange(e){if(!e.focusNode)return!0;let r=new Set,n;for(let a=e.focusNode;a;a=Yp(a))r.add(a);for(let a=e.anchorNode;a;a=Yp(a))if(r.has(a)){n=a;break}let i=n&&this.view.docView.nearestDesc(n);if(i&&i.ignoreMutation({type:"selection",target:n.nodeType==3?n.parentNode:n}))return this.setCurSelection(),!0}pendingRecords(){if(this.observer)for(let e of this.observer.takeRecords())this.queue.push(e);return this.queue}flush(){let{view:e}=this;if(!e.docView||this.flushingSoon>-1)return;let r=this.pendingRecords();r.length&&(this.queue=[]);let n=e.domSelectionRange(),i=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(n)&&X3(e)&&!this.ignoreSelectionChange(n),a=-1,s=-1,o=!1,l=[];if(e.editable)for(let c=0;c<r.length;c++){let f=this.registerMutation(r[c],l);f&&(a=a<0?f.from:Math.min(f.from,a),s=s<0?f.to:Math.max(f.to,s),f.typeOver&&(o=!0))}if(Jo&&l.length){let c=l.filter(f=>f.nodeName=="BR");if(c.length==2){let[f,p]=c;f.parentNode&&f.parentNode.parentNode==p.parentNode?p.remove():f.remove()}else{let{focusNode:f}=this.currentSelection;for(let p of c){let g=p.parentNode;g&&g.nodeName=="LI"&&(!f||ZX(e,f)!=g)&&p.remove()}}}else if((pa||Ua)&&l.some(c=>c.nodeName=="BR")&&(e.input.lastKeyCode==8||e.input.lastKeyCode==46)){for(let c of l)if(c.nodeName=="BR"&&c.parentNode){let f=c.nextSibling;f&&f.nodeType==1&&f.contentEditable=="false"&&c.parentNode.removeChild(c)}}let u=null;a<0&&i&&e.input.lastFocus>Date.now()-200&&Math.max(e.input.lastTouch,e.input.lastClick.time)<Date.now()-300&&eb(n)&&(u=eC(e))&&u.eq(_r.near(e.state.doc.resolve(0),1))?(e.input.lastFocus=0,vc(e),this.currentSelection.set(n),e.scrollToSelection()):(a>-1||i)&&(a>-1&&(e.docView.markDirty(a,s),$X(e)),e.input.badSafariComposition&&(e.input.badSafariComposition=!1,YX(e,l)),this.handleDOMChange(a,s,o,l),e.docView&&e.docView.dirty?e.updateState(e.state):this.currentSelection.eq(n)||vc(e),this.currentSelection.set(n))}registerMutation(e,r){if(r.indexOf(e.target)>-1)return null;let n=this.view.docView.nearestDesc(e.target);if(e.type=="attributes"&&(n==this.view.docView||e.attributeName=="contenteditable"||e.attributeName=="style"&&!e.oldValue&&!e.target.getAttribute("style"))||!n||n.ignoreMutation(e))return null;if(e.type=="childList"){for(let c=0;c<e.addedNodes.length;c++){let f=e.addedNodes[c];r.push(f),f.nodeType==3&&(this.lastChangedTextNode=f)}if(n.contentDOM&&n.contentDOM!=n.dom&&!n.contentDOM.contains(e.target))return{from:n.posBefore,to:n.posAfter};let i=e.previousSibling,a=e.nextSibling;if(Xs&&Wd<=11&&e.addedNodes.length)for(let c=0;c<e.addedNodes.length;c++){let{previousSibling:f,nextSibling:p}=e.addedNodes[c];(!f||Array.prototype.indexOf.call(e.addedNodes,f)<0)&&(i=f),(!p||Array.prototype.indexOf.call(e.addedNodes,p)<0)&&(a=p)}let s=i&&i.parentNode==e.target?ja(i)+1:0,o=n.localPosFromDOM(e.target,s,-1),l=a&&a.parentNode==e.target?ja(a):e.target.childNodes.length,u=n.localPosFromDOM(e.target,l,1);return{from:o,to:u}}else return e.type=="attributes"?{from:n.posAtStart-n.border,to:n.posAtEnd+n.border}:(this.lastChangedTextNode=e.target,{from:n.posAtStart,to:n.posAtEnd,typeOver:e.target.nodeValue==e.oldValue})}}let sP=new WeakMap,oP=!1;function $X(t){if(!sP.has(t)&&(sP.set(t,null),["normal","nowrap","pre-line"].indexOf(getComputedStyle(t.dom).whiteSpace)!==-1)){if(t.requiresGeckoHackNode=Jo,oP)return;console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."),oP=!0}}function lP(t,e){let r=e.startContainer,n=e.startOffset,i=e.endContainer,a=e.endOffset,s=t.domAtPos(t.state.selection.anchor);return kh(s.node,s.offset,i,a)&&([r,n,i,a]=[i,a,r,n]),{anchorNode:r,anchorOffset:n,focusNode:i,focusOffset:a}}function KX(t,e){if(e.getComposedRanges){let i=e.getComposedRanges(t.root)[0];if(i)return lP(t,i)}let r;function n(i){i.preventDefault(),i.stopImmediatePropagation(),r=i.getTargetRanges()[0]}return t.dom.addEventListener("beforeinput",n,!0),document.execCommand("indent"),t.dom.removeEventListener("beforeinput",n,!0),r?lP(t,r):null}function ZX(t,e){for(let r=e.parentNode;r&&r!=t.dom;r=r.parentNode){let n=t.docView.nearestDesc(r,!0);if(n&&n.node.isBlock)return r}return null}function YX(t,e){var r;let{focusNode:n,focusOffset:i}=t.domSelectionRange();for(let a of e)if(((r=a.parentNode)===null||r===void 0?void 0:r.nodeName)=="TR"){let s=a.nextSibling;for(;s&&s.nodeName!="TD"&&s.nodeName!="TH";)s=s.nextSibling;if(s){let o=s;for(;;){let l=o.firstChild;if(!l||l.nodeType!=1||l.contentEditable=="false"||/^(BR|IMG)$/.test(l.nodeName))break;o=l}o.insertBefore(a,o.firstChild),n==a&&t.domSelection().collapse(a,i)}else a.parentNode.removeChild(a)}}function XX(t,e,r){let{node:n,fromOffset:i,toOffset:a,from:s,to:o}=t.docView.parseRange(e,r),l=t.domSelectionRange(),u,c=l.anchorNode;if(c&&t.dom.contains(c.nodeType==1?c:c.parentNode)&&(u=[{node:c,offset:l.anchorOffset}],eb(l)||u.push({node:l.focusNode,offset:l.focusOffset})),pa&&t.input.lastKeyCode===8)for(let w=a;w>i;w--){let C=n.childNodes[w-1],_=C.pmViewDesc;if(C.nodeName=="BR"&&!_){a=w;break}if(!_||_.size)break}let f=t.state.doc,p=t.someProp("domParser")||Hd.fromSchema(t.state.schema),g=f.resolve(s),y=null,S=p.parse(n,{topNode:g.parent,topMatch:g.parent.contentMatchAt(g.index()),topOpen:!0,from:i,to:a,preserveWhitespace:g.parent.type.whitespace=="pre"?"full":!0,findPositions:u,ruleFromNode:QX,context:g});if(u&&u[0].pos!=null){let w=u[0].pos,C=u[1]&&u[1].pos;C==null&&(C=w),y={anchor:w+s,head:C+s}}return{doc:S,sel:y,from:s,to:o}}function QX(t){let e=t.pmViewDesc;if(e)return e.parseRule();if(t.nodeName=="BR"&&t.parentNode){if(Ua&&/^(ul|ol)$/i.test(t.parentNode.nodeName)){let r=document.createElement("div");return r.appendChild(document.createElement("li")),{skip:r}}else if(t.parentNode.lastChild==t||Ua&&/^(tr|table)$/i.test(t.parentNode.nodeName))return{ignore:!0}}else if(t.nodeName=="IMG"&&t.getAttribute("mark-placeholder"))return{ignore:!0};return null}const JX=/^(a|abbr|acronym|b|bd[io]|big|br|button|cite|code|data(list)?|del|dfn|em|i|img|ins|kbd|label|map|mark|meter|output|q|ruby|s|samp|small|span|strong|su[bp]|time|u|tt|var)$/i;function eQ(t,e,r,n,i){let a=t.input.compositionPendingChanges||(t.composing?t.input.compositionID:0);if(t.input.compositionPendingChanges=0,e<0){let j=t.input.lastSelectionTime>Date.now()-50?t.input.lastSelectionOrigin:null,O=eC(t,j);if(O&&!t.state.selection.eq(O)){if(pa&&pc&&t.input.lastKeyCode===13&&Date.now()-100<t.input.lastKeyCodeTime&&t.someProp("handleKeyDown",z=>z(t,eh(13,"Enter"))))return;let F=t.state.tr.setSelection(O);j=="pointer"?F.setMeta("pointer",!0):j=="key"&&F.scrollIntoView(),a&&F.setMeta("composition",a),t.dispatch(F)}return}let s=t.state.doc.resolve(e),o=s.sharedDepth(r);e=s.before(o+1),r=t.state.doc.resolve(r).after(o+1);let l=t.state.selection,u=XX(t,e,r),c=t.state.doc,f=c.slice(u.from,u.to),p,g;t.input.lastKeyCode===8&&Date.now()-100<t.input.lastKeyCodeTime?(p=t.state.selection.to,g="end"):(p=t.state.selection.from,g="start"),t.input.lastKeyCode=null;let y=nQ(f.content,u.doc.content,u.from,p,g);if(y&&t.input.domChangeCount++,(Xp&&t.input.lastIOSEnter>Date.now()-225||pc)&&i.some(j=>j.nodeType==1&&!JX.test(j.nodeName))&&(!y||y.endA>=y.endB)&&t.someProp("handleKeyDown",j=>j(t,eh(13,"Enter")))){t.input.lastIOSEnter=0;return}if(!y)if(n&&l instanceof fr&&!l.empty&&l.$head.sameParent(l.$anchor)&&!t.composing&&!(u.sel&&u.sel.anchor!=u.sel.head))y={start:l.from,endA:l.to,endB:l.to};else{if(u.sel){let j=uP(t,t.state.doc,u.sel);if(j&&!j.eq(t.state.selection)){let O=t.state.tr.setSelection(j);a&&O.setMeta("composition",a),t.dispatch(O)}}return}t.state.selection.from<t.state.selection.to&&y.start==y.endB&&t.state.selection instanceof fr&&(y.start>t.state.selection.from&&y.start<=t.state.selection.from+2&&t.state.selection.from>=u.from?y.start=t.state.selection.from:y.endA<t.state.selection.to&&y.endA>=t.state.selection.to-2&&t.state.selection.to<=u.to&&(y.endB+=t.state.selection.to-y.endA,y.endA=t.state.selection.to)),Xs&&Wd<=11&&y.endB==y.start+1&&y.endA==y.start&&y.start>u.from&&u.doc.textBetween(y.start-u.from-1,y.start-u.from+1)==" "&&(y.start--,y.endA--,y.endB--);let S=u.doc.resolveNoCache(y.start-u.from),w=u.doc.resolveNoCache(y.endB-u.from),C=c.resolve(y.start),_=S.sameParent(w)&&S.parent.inlineContent&&C.end()>=y.endA;if((Xp&&t.input.lastIOSEnter>Date.now()-225&&(!_||i.some(j=>j.nodeName=="DIV"||j.nodeName=="P"))||!_&&S.pos<u.doc.content.size&&(!S.sameParent(w)||!S.parent.inlineContent)&&S.pos<w.pos&&!/\S/.test(u.doc.textBetween(S.pos,w.pos,"","")))&&t.someProp("handleKeyDown",j=>j(t,eh(13,"Enter")))){t.input.lastIOSEnter=0;return}if(t.state.selection.anchor>y.start&&rQ(c,y.start,y.endA,S,w)&&t.someProp("handleKeyDown",j=>j(t,eh(8,"Backspace")))){pc&&pa&&t.domObserver.suppressSelectionUpdates();return}pa&&y.endB==y.start&&(t.input.lastChromeDelete=Date.now()),pc&&!_&&S.start()!=w.start()&&w.parentOffset==0&&S.depth==w.depth&&u.sel&&u.sel.anchor==u.sel.head&&u.sel.head==y.endA&&(y.endB-=2,w=u.doc.resolveNoCache(y.endB-u.from),setTimeout(()=>{t.someProp("handleKeyDown",function(j){return j(t,eh(13,"Enter"))})},20));let T=y.start,N=y.endA,R=j=>{let O=j||t.state.tr.replace(T,N,u.doc.slice(y.start-u.from,y.endB-u.from));if(u.sel){let F=uP(t,O.doc,u.sel);F&&!(pa&&t.composing&&F.empty&&(y.start!=y.endB||t.input.lastChromeDelete<Date.now()-100)&&(F.head==T||F.head==O.mapping.map(N)-1)||Xs&&F.empty&&F.head==T)&&O.setSelection(F)}return a&&O.setMeta("composition",a),O.scrollIntoView()},D;if(_)if(S.pos==w.pos){Xs&&Wd<=11&&S.parentOffset==0&&(t.domObserver.suppressSelectionUpdates(),setTimeout(()=>vc(t),20));let j=R(t.state.tr.delete(T,N)),O=c.resolve(y.start).marksAcross(c.resolve(y.endA));O&&j.ensureMarks(O),t.dispatch(j)}else if(y.endA==y.endB&&(D=tQ(S.parent.content.cut(S.parentOffset,w.parentOffset),C.parent.content.cut(C.parentOffset,y.endA-C.start())))){let j=R(t.state.tr);D.type=="add"?j.addMark(T,N,D.mark):j.removeMark(T,N,D.mark),t.dispatch(j)}else if(S.parent.child(S.index()).isText&&S.index()==w.index()-(w.textOffset?0:1)){let j=S.parent.textBetween(S.parentOffset,w.parentOffset),O=()=>R(t.state.tr.insertText(j,T,N));t.someProp("handleTextInput",F=>F(t,T,N,j,O))||t.dispatch(O())}else t.dispatch(R());else t.dispatch(R())}function uP(t,e,r){return Math.max(r.anchor,r.head)>e.content.size?null:tC(t,e.resolve(r.anchor),e.resolve(r.head))}function tQ(t,e){let r=t.firstChild.marks,n=e.firstChild.marks,i=r,a=n,s,o,l;for(let c=0;c<n.length;c++)i=n[c].removeFromSet(i);for(let c=0;c<r.length;c++)a=r[c].removeFromSet(a);if(i.length==1&&a.length==0)o=i[0],s="add",l=c=>c.mark(o.addToSet(c.marks));else if(i.length==0&&a.length==1)o=a[0],s="remove",l=c=>c.mark(o.removeFromSet(c.marks));else return null;let u=[];for(let c=0;c<e.childCount;c++)u.push(l(e.child(c)));if(at.from(u).eq(t))return{mark:o,type:s}}function rQ(t,e,r,n,i){if(r-e<=i.pos-n.pos||fS(n,!0,!1)<i.pos)return!1;let a=t.resolve(e);if(!n.parent.isTextblock){let o=a.nodeAfter;return o!=null&&r==e+o.nodeSize}if(a.parentOffset<a.parent.content.size||!a.parent.isTextblock)return!1;let s=t.resolve(fS(a,!0,!0));return!s.parent.isTextblock||s.pos>r||fS(s,!0,!1)<r?!1:n.parent.content.cut(n.parentOffset).eq(s.parent.content)}function fS(t,e,r){let n=t.depth,i=e?t.end():t.pos;for(;n>0&&(e||t.indexAfter(n)==t.node(n).childCount);)n--,i++,e=!1;if(r){let a=t.node(n).maybeChild(t.indexAfter(n));for(;a&&!a.isLeaf;)a=a.firstChild,i++}return i}function nQ(t,e,r,n,i){let a=t.findDiffStart(e,r);if(a==null)return null;let{a:s,b:o}=t.findDiffEnd(e,r+t.size,r+e.size);if(i=="end"){let l=Math.max(0,a-Math.min(s,o));n-=s+l-a}if(s<a&&t.size<e.size){let l=n<=a&&n>=s?a-n:0;a-=l,a&&a<e.size&&cP(e.textBetween(a-1,a+1))&&(a+=l?1:-1),o=a+(o-s),s=a}else if(o<a){let l=n<=a&&n>=o?a-n:0;a-=l,a&&a<t.size&&cP(t.textBetween(a-1,a+1))&&(a+=l?1:-1),s=a+(s-o),o=a}return{start:a,endA:s,endB:o}}function cP(t){if(t.length!=2)return!1;let e=t.charCodeAt(0),r=t.charCodeAt(1);return e>=56320&&e<=57343&&r>=55296&&r<=56319}class JO{constructor(e,r){this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new xX,this.prevDirectPlugins=[],this.pluginViews=[],this.requiresGeckoHackNode=!1,this.dragging=null,this._props=r,this.state=r.state,this.directPlugins=r.plugins||[],this.directPlugins.forEach(mP),this.dispatch=this.dispatch.bind(this),this.dom=e&&e.mount||document.createElement("div"),e&&(e.appendChild?e.appendChild(this.dom):typeof e=="function"?e(this.dom):e.mount&&(this.mounted=!0)),this.editable=hP(this),fP(this),this.nodeViews=pP(this),this.docView=W3(this.state.doc,dP(this),dS(this),this.dom,this),this.domObserver=new qX(this,(n,i,a,s)=>eQ(this,n,i,a,s)),this.domObserver.start(),bX(this),this.updatePluginViews()}get composing(){return this.input.composing}get props(){if(this._props.state!=this.state){let e=this._props;this._props={};for(let r in e)this._props[r]=e[r];this._props.state=this.state}return this._props}update(e){e.handleDOMEvents!=this._props.handleDOMEvents&&Mk(this);let r=this._props;this._props=e,e.plugins&&(e.plugins.forEach(mP),this.directPlugins=e.plugins),this.updateStateInner(e.state,r)}setProps(e){let r={};for(let n in this._props)r[n]=this._props[n];r.state=this.state;for(let n in e)r[n]=e[n];this.update(r)}updateState(e){this.updateStateInner(e,this._props)}updateStateInner(e,r){var n;let i=this.state,a=!1,s=!1;e.storedMarks&&this.composing&&(qO(this),s=!0),this.state=e;let o=i.plugins!=e.plugins||this._props.plugins!=r.plugins;if(o||this._props.plugins!=r.plugins||this._props.nodeViews!=r.nodeViews){let g=pP(this);aQ(g,this.nodeViews)&&(this.nodeViews=g,a=!0)}(o||r.handleDOMEvents!=this._props.handleDOMEvents)&&Mk(this),this.editable=hP(this),fP(this);let l=dS(this),u=dP(this),c=i.plugins!=e.plugins&&!i.doc.eq(e.doc)?"reset":e.scrollToSelection>i.scrollToSelection?"to selection":"preserve",f=a||!this.docView.matchesNode(e.doc,u,l);(f||!e.selection.eq(i.selection))&&(s=!0);let p=c=="preserve"&&s&&this.dom.style.overflowAnchor==null&&OY(this);if(s){this.domObserver.stop();let g=f&&(Xs||pa)&&!this.composing&&!i.selection.empty&&!e.selection.empty&&iQ(i.selection,e.selection);if(f){let y=pa?this.trackWrites=this.domSelectionRange().focusNode:null;this.composing&&(this.input.compositionNode=OX(this)),(a||!this.docView.update(e.doc,u,l,this))&&(this.docView.updateOuterDeco(u),this.docView.destroy(),this.docView=W3(e.doc,u,l,this.dom,this)),y&&(!this.trackWrites||!this.dom.contains(this.trackWrites))&&(g=!0)}g||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelectionRange())&&iX(this))?vc(this,g):(OO(this,e.selection),this.domObserver.setCurSelection()),this.domObserver.start()}this.updatePluginViews(i),!((n=this.dragging)===null||n===void 0)&&n.node&&!i.doc.eq(e.doc)&&this.updateDraggedNode(this.dragging,i),c=="reset"?this.dom.scrollTop=0:c=="to selection"?this.scrollToSelection():p&&DY(p)}scrollToSelection(){let e=this.domSelectionRange().focusNode;if(!(!e||!this.dom.contains(e.nodeType==1?e:e.parentNode))){if(!this.someProp("handleScrollToSelection",r=>r(this)))if(this.state.selection instanceof Jt){let r=this.docView.domAfterPos(this.state.selection.from);r.nodeType==1&&B3(this,r.getBoundingClientRect(),e)}else B3(this,this.coordsAtPos(this.state.selection.head,1),e)}}destroyPluginViews(){let e;for(;e=this.pluginViews.pop();)e.destroy&&e.destroy()}updatePluginViews(e){if(!e||e.plugins!=this.state.plugins||this.directPlugins!=this.prevDirectPlugins){this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(let r=0;r<this.directPlugins.length;r++){let n=this.directPlugins[r];n.spec.view&&this.pluginViews.push(n.spec.view(this))}for(let r=0;r<this.state.plugins.length;r++){let n=this.state.plugins[r];n.spec.view&&this.pluginViews.push(n.spec.view(this))}}else for(let r=0;r<this.pluginViews.length;r++){let n=this.pluginViews[r];n.update&&n.update(this,e)}}updateDraggedNode(e,r){let n=e.node,i=-1;if(this.state.doc.nodeAt(n.from)==n.node)i=n.from;else{let a=n.from+(this.state.doc.content.size-r.doc.content.size);(a>0&&this.state.doc.nodeAt(a))==n.node&&(i=a)}this.dragging=new KO(e.slice,e.move,i<0?void 0:Jt.create(this.state.doc,i))}someProp(e,r){let n=this._props&&this._props[e],i;if(n!=null&&(i=r?r(n):n))return i;for(let s=0;s<this.directPlugins.length;s++){let o=this.directPlugins[s].props[e];if(o!=null&&(i=r?r(o):o))return i}let a=this.state.plugins;if(a)for(let s=0;s<a.length;s++){let o=a[s].props[e];if(o!=null&&(i=r?r(o):o))return i}}hasFocus(){if(Xs){let e=this.root.activeElement;if(e==this.dom)return!0;if(!e||!this.dom.contains(e))return!1;for(;e&&this.dom!=e&&this.dom.contains(e);){if(e.contentEditable=="false")return!1;e=e.parentElement}return!0}return this.root.activeElement==this.dom}focus(){this.domObserver.stop(),this.editable&&IY(this.dom),vc(this),this.domObserver.start()}get root(){let e=this._root;if(e==null){for(let r=this.dom.parentNode;r;r=r.parentNode)if(r.nodeType==9||r.nodeType==11&&r.host)return r.getSelection||(Object.getPrototypeOf(r).getSelection=()=>r.ownerDocument.getSelection()),this._root=r}return e||document}updateRoot(){this._root=null}posAtCoords(e){return UY(this,e)}coordsAtPos(e,r=1){return EO(this,e,r)}domAtPos(e,r=0){return this.docView.domFromPos(e,r)}nodeDOM(e){let r=this.docView.descAt(e);return r?r.nodeDOM:null}posAtDOM(e,r,n=-1){let i=this.docView.posFromDOM(e,r,n);if(i==null)throw new RangeError("DOM position not inside the editor");return i}endOfTextblock(e,r){return qY(this,r||this.state,e)}pasteHTML(e,r){return zv(this,"",e,!1,r||new ClipboardEvent("paste"))}pasteText(e,r){return zv(this,e,null,!0,r||new ClipboardEvent("paste"))}serializeForClipboard(e){return rC(this,e)}destroy(){this.docView&&(wX(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],dS(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null,_Y())}get isDestroyed(){return this.docView==null}dispatchEvent(e){return kX(this,e)}domSelectionRange(){let e=this.domSelection();return e?Ua&&this.root.nodeType===11&&PY(this.dom.ownerDocument)==this.dom&&KX(this,e)||e:{focusNode:null,focusOffset:0,anchorNode:null,anchorOffset:0}}domSelection(){return this.root.getSelection()}}JO.prototype.dispatch=function(t){let e=this._props.dispatchTransaction;e?e.call(this,t):this.updateState(this.state.apply(t))};function dP(t){let e=Object.create(null);return e.class="ProseMirror",e.contenteditable=String(t.editable),t.someProp("attributes",r=>{if(typeof r=="function"&&(r=r(t.state)),r)for(let n in r)n=="class"?e.class+=" "+r[n]:n=="style"?e.style=(e.style?e.style+";":"")+r[n]:!e[n]&&n!="contenteditable"&&n!="nodeName"&&(e[n]=String(r[n]))}),e.translate||(e.translate="no"),[as.node(0,t.state.doc.content.size,e)]}function fP(t){if(t.markCursor){let e=document.createElement("img");e.className="ProseMirror-separator",e.setAttribute("mark-placeholder","true"),e.setAttribute("alt",""),t.cursorWrapper={dom:e,deco:as.widget(t.state.selection.from,e,{raw:!0,marks:t.markCursor})}}else t.cursorWrapper=null}function hP(t){return!t.someProp("editable",e=>e(t.state)===!1)}function iQ(t,e){let r=Math.min(t.$anchor.sharedDepth(t.head),e.$anchor.sharedDepth(e.head));return t.$anchor.start(r)!=e.$anchor.start(r)}function pP(t){let e=Object.create(null);function r(n){for(let i in n)Object.prototype.hasOwnProperty.call(e,i)||(e[i]=n[i])}return t.someProp("nodeViews",r),t.someProp("markViews",r),e}function aQ(t,e){let r=0,n=0;for(let i in t){if(t[i]!=e[i])return!0;r++}for(let i in e)n++;return r!=n}function mP(t){if(t.spec.state||t.spec.filterTransaction||t.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}var tf={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},zx={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},sQ=typeof navigator<"u"&&/Mac/.test(navigator.platform),oQ=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);for(var Fa=0;Fa<10;Fa++)tf[48+Fa]=tf[96+Fa]=String(Fa);for(var Fa=1;Fa<=24;Fa++)tf[Fa+111]="F"+Fa;for(var Fa=65;Fa<=90;Fa++)tf[Fa]=String.fromCharCode(Fa+32),zx[Fa]=String.fromCharCode(Fa);for(var hS in tf)zx.hasOwnProperty(hS)||(zx[hS]=tf[hS]);function lQ(t){var e=sQ&&t.metaKey&&t.shiftKey&&!t.ctrlKey&&!t.altKey||oQ&&t.shiftKey&&t.key&&t.key.length==1||t.key=="Unidentified",r=!e&&t.key||(t.shiftKey?zx:tf)[t.keyCode]||t.key||"Unidentified";return r=="Esc"&&(r="Escape"),r=="Del"&&(r="Delete"),r=="Left"&&(r="ArrowLeft"),r=="Up"&&(r="ArrowUp"),r=="Right"&&(r="ArrowRight"),r=="Down"&&(r="ArrowDown"),r}const uQ=typeof navigator<"u"&&/Mac|iP(hone|[oa]d)/.test(navigator.platform),cQ=typeof navigator<"u"&&/Win/.test(navigator.platform);function dQ(t){let e=t.split(/-(?!$)/),r=e[e.length-1];r=="Space"&&(r=" ");let n,i,a,s;for(let o=0;o<e.length-1;o++){let l=e[o];if(/^(cmd|meta|m)$/i.test(l))s=!0;else if(/^a(lt)?$/i.test(l))n=!0;else if(/^(c|ctrl|control)$/i.test(l))i=!0;else if(/^s(hift)?$/i.test(l))a=!0;else if(/^mod$/i.test(l))uQ?s=!0:i=!0;else throw new Error("Unrecognized modifier name: "+l)}return n&&(r="Alt-"+r),i&&(r="Ctrl-"+r),s&&(r="Meta-"+r),a&&(r="Shift-"+r),r}function fQ(t){let e=Object.create(null);for(let r in t)e[dQ(r)]=t[r];return e}function pS(t,e,r=!0){return e.altKey&&(t="Alt-"+t),e.ctrlKey&&(t="Ctrl-"+t),e.metaKey&&(t="Meta-"+t),r&&e.shiftKey&&(t="Shift-"+t),t}function hQ(t){return new Xn({props:{handleKeyDown:e6(t)}})}function e6(t){let e=fQ(t);return function(r,n){let i=lQ(n),a,s=e[pS(i,n)];if(s&&s(r.state,r.dispatch,r))return!0;if(i.length==1&&i!=" "){if(n.shiftKey){let o=e[pS(i,n,!1)];if(o&&o(r.state,r.dispatch,r))return!0}if((n.altKey||n.metaKey||n.ctrlKey)&&!(cQ&&n.ctrlKey&&n.altKey)&&(a=tf[n.keyCode])&&a!=i){let o=e[pS(a,n)];if(o&&o(r.state,r.dispatch,r))return!0}}return!1}}var pQ=Object.defineProperty,lC=(t,e)=>{for(var r in e)pQ(t,r,{get:e[r],enumerable:!0})};function nb(t){const{state:e,transaction:r}=t;let{selection:n}=r,{doc:i}=r,{storedMarks:a}=r;return{...e,apply:e.apply.bind(e),applyTransaction:e.applyTransaction.bind(e),plugins:e.plugins,schema:e.schema,reconfigure:e.reconfigure.bind(e),toJSON:e.toJSON.bind(e),get storedMarks(){return a},get selection(){return n},get doc(){return i},get tr(){return n=r.selection,i=r.doc,a=r.storedMarks,r}}}var ib=class{constructor(t){this.editor=t.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=t.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:t,editor:e,state:r}=this,{view:n}=e,{tr:i}=r,a=this.buildProps(i);return Object.fromEntries(Object.entries(t).map(([s,o])=>[s,(...u)=>{const c=o(...u)(a);return!i.getMeta("preventDispatch")&&!this.hasCustomState&&n.dispatch(i),c}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(t,e=!0){const{rawCommands:r,editor:n,state:i}=this,{view:a}=n,s=[],o=!!t,l=t||i.tr,u=()=>(!o&&e&&!l.getMeta("preventDispatch")&&!this.hasCustomState&&a.dispatch(l),s.every(f=>f===!0)),c={...Object.fromEntries(Object.entries(r).map(([f,p])=>[f,(...y)=>{const S=this.buildProps(l,e),w=p(...y)(S);return s.push(w),c}])),run:u};return c}createCan(t){const{rawCommands:e,state:r}=this,n=!1,i=t||r.tr,a=this.buildProps(i,n);return{...Object.fromEntries(Object.entries(e).map(([o,l])=>[o,(...u)=>l(...u)({...a,dispatch:void 0})])),chain:()=>this.createChain(i,n)}}buildProps(t,e=!0){const{rawCommands:r,editor:n,state:i}=this,{view:a}=n,s={tr:t,editor:n,view:a,state:nb({state:i,transaction:t}),dispatch:e?()=>{}:void 0,chain:()=>this.createChain(t,e),can:()=>this.createCan(t),get commands(){return Object.fromEntries(Object.entries(r).map(([o,l])=>[o,(...u)=>l(...u)(s)]))}};return s}},t6={};lC(t6,{blur:()=>mQ,clearContent:()=>gQ,clearNodes:()=>vQ,command:()=>yQ,createParagraphNear:()=>xQ,cut:()=>bQ,deleteCurrentNode:()=>wQ,deleteNode:()=>SQ,deleteRange:()=>kQ,deleteSelection:()=>_Q,enter:()=>CQ,exitCode:()=>EQ,extendMarkRange:()=>TQ,first:()=>NQ,focus:()=>MQ,forEach:()=>AQ,insertContent:()=>LQ,insertContentAt:()=>DQ,joinBackward:()=>FQ,joinDown:()=>jQ,joinForward:()=>BQ,joinItemBackward:()=>zQ,joinItemForward:()=>UQ,joinTextblockBackward:()=>GQ,joinTextblockForward:()=>VQ,joinUp:()=>IQ,keyboardShortcut:()=>WQ,lift:()=>qQ,liftEmptyBlock:()=>$Q,liftListItem:()=>KQ,newlineInCode:()=>ZQ,resetAttributes:()=>YQ,scrollIntoView:()=>XQ,selectAll:()=>QQ,selectNodeBackward:()=>JQ,selectNodeForward:()=>eJ,selectParentNode:()=>tJ,selectTextblockEnd:()=>rJ,selectTextblockStart:()=>nJ,setContent:()=>iJ,setMark:()=>_J,setMeta:()=>CJ,setNode:()=>EJ,setNodeSelection:()=>TJ,setTextDirection:()=>NJ,setTextSelection:()=>PJ,sinkListItem:()=>MJ,splitBlock:()=>AJ,splitListItem:()=>LJ,toggleList:()=>RJ,toggleMark:()=>OJ,toggleNode:()=>DJ,toggleWrap:()=>IJ,undoInputRule:()=>jJ,unsetAllMarks:()=>FJ,unsetMark:()=>BJ,unsetTextDirection:()=>zJ,updateAttributes:()=>UJ,wrapIn:()=>GJ,wrapInList:()=>VJ});var mQ=()=>({editor:t,view:e})=>(requestAnimationFrame(()=>{var r;t.isDestroyed||(e.dom.blur(),(r=window?.getSelection())==null||r.removeAllRanges())}),!0),gQ=(t=!0)=>({commands:e})=>e.setContent("",{emitUpdate:t}),vQ=()=>({state:t,tr:e,dispatch:r})=>{const{selection:n}=e,{ranges:i}=n;return r&&i.forEach(({$from:a,$to:s})=>{t.doc.nodesBetween(a.pos,s.pos,(o,l)=>{if(o.type.isText)return;const{doc:u,mapping:c}=e,f=u.resolve(c.map(l)),p=u.resolve(c.map(l+o.nodeSize)),g=f.blockRange(p);if(!g)return;const y=ym(g);if(o.type.isTextblock){const{defaultType:S}=f.parent.contentMatchAt(f.index());e.setNodeMarkup(g.start,S)}(y||y===0)&&e.lift(g,y)})}),!0},yQ=t=>e=>t(e),xQ=()=>({state:t,dispatch:e})=>mO(t,e),bQ=(t,e)=>({editor:r,tr:n})=>{const{state:i}=r,a=i.doc.slice(t.from,t.to);n.deleteRange(t.from,t.to);const s=n.mapping.map(e);return n.insert(s,a.content),n.setSelection(new fr(n.doc.resolve(Math.max(s-1,0)))),!0},wQ=()=>({tr:t,dispatch:e})=>{const{selection:r}=t,n=r.$anchor.node();if(n.content.size>0)return!1;const i=t.selection.$anchor;for(let a=i.depth;a>0;a-=1)if(i.node(a).type===n.type){if(e){const o=i.before(a),l=i.after(a);t.delete(o,l).scrollIntoView()}return!0}return!1};function ji(t,e){if(typeof t=="string"){if(!e.nodes[t])throw Error(`There is no node type named '${t}'. Maybe you forgot to add the extension?`);return e.nodes[t]}return t}var SQ=t=>({tr:e,state:r,dispatch:n})=>{const i=ji(t,r.schema),a=e.selection.$anchor;for(let s=a.depth;s>0;s-=1)if(a.node(s).type===i){if(n){const l=a.before(s),u=a.after(s);e.delete(l,u).scrollIntoView()}return!0}return!1},kQ=t=>({tr:e,dispatch:r})=>{const{from:n,to:i}=t;return r&&e.delete(n,i),!0},_Q=()=>({state:t,dispatch:e})=>K_(t,e),CQ=()=>({commands:t})=>t.keyboardShortcut("Enter"),EQ=()=>({state:t,dispatch:e})=>uY(t,e);function uC(t){return Object.prototype.toString.call(t)==="[object RegExp]"}function Ux(t,e,r={strict:!0}){const n=Object.keys(e);return n.length?n.every(i=>r.strict?e[i]===t[i]:uC(e[i])?e[i].test(t[i]):e[i]===t[i]):!0}function r6(t,e,r={}){return t.find(n=>n.type===e&&Ux(Object.fromEntries(Object.keys(r).map(i=>[i,n.attrs[i]])),r))}function gP(t,e,r={}){return!!r6(t,e,r)}function cC(t,e,r){var n;if(!t||!e)return;let i=t.parent.childAfter(t.parentOffset);if((!i.node||!i.node.marks.some(c=>c.type===e))&&(i=t.parent.childBefore(t.parentOffset)),!i.node||!i.node.marks.some(c=>c.type===e)||(r=r||((n=i.node.marks[0])==null?void 0:n.attrs),!r6([...i.node.marks],e,r)))return;let s=i.index,o=t.start()+i.offset,l=s+1,u=o+i.node.nodeSize;for(;s>0&&gP([...t.parent.child(s-1).marks],e,r);)s-=1,o-=t.parent.child(s).nodeSize;for(;l<t.parent.childCount&&gP([...t.parent.child(l).marks],e,r);)u+=t.parent.child(l).nodeSize,l+=1;return{from:o,to:u}}function Cc(t,e){if(typeof t=="string"){if(!e.marks[t])throw Error(`There is no mark type named '${t}'. Maybe you forgot to add the extension?`);return e.marks[t]}return t}var TQ=(t,e={})=>({tr:r,state:n,dispatch:i})=>{const a=Cc(t,n.schema),{doc:s,selection:o}=r,{$from:l,from:u,to:c}=o;if(i){const f=cC(l,a,e);if(f&&f.from<=u&&f.to>=c){const p=fr.create(s,f.from,f.to);r.setSelection(p)}}return!0},NQ=t=>e=>{const r=typeof t=="function"?t(e):t;for(let n=0;n<r.length;n+=1)if(r[n](e))return!0;return!1};function n6(t){return t instanceof fr}function ah(t=0,e=0,r=0){return Math.min(Math.max(t,e),r)}function i6(t,e=null){if(!e)return null;const r=_r.atStart(t),n=_r.atEnd(t);if(e==="start"||e===!0)return r;if(e==="end")return n;const i=r.from,a=n.to;return e==="all"?fr.create(t,ah(0,i,a),ah(t.content.size,i,a)):fr.create(t,ah(e,i,a),ah(e,i,a))}function vP(){return navigator.platform==="Android"||/android/i.test(navigator.userAgent)}function Gx(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}function PQ(){return typeof navigator<"u"?/^((?!chrome|android).)*safari/i.test(navigator.userAgent):!1}var MQ=(t=null,e={})=>({editor:r,view:n,tr:i,dispatch:a})=>{e={scrollIntoView:!0,...e};const s=()=>{(Gx()||vP())&&n.dom.focus(),PQ()&&!Gx()&&!vP()&&n.dom.focus({preventScroll:!0}),requestAnimationFrame(()=>{r.isDestroyed||(n.focus(),e?.scrollIntoView&&r.commands.scrollIntoView())})};if(n.hasFocus()&&t===null||t===!1)return!0;if(a&&t===null&&!n6(r.state.selection))return s(),!0;const o=i6(i.doc,t)||r.state.selection,l=r.state.selection.eq(o);return a&&(l||i.setSelection(o),l&&i.storedMarks&&i.setStoredMarks(i.storedMarks),s()),!0},AQ=(t,e)=>r=>t.every((n,i)=>e(n,{...r,index:i})),LQ=(t,e)=>({tr:r,commands:n})=>n.insertContentAt({from:r.selection.from,to:r.selection.to},t,e),a6=t=>{const e=t.childNodes;for(let r=e.length-1;r>=0;r-=1){const n=e[r];n.nodeType===3&&n.nodeValue&&/^(\n\s\s|\n)$/.test(n.nodeValue)?t.removeChild(n):n.nodeType===1&&a6(n)}return t};function Ey(t){if(typeof window>"u")throw new Error("[tiptap error]: there is no window object available, so this function cannot be used");const e=`<body>${t}</body>`,r=new window.DOMParser().parseFromString(e,"text/html").body;return a6(r)}function Gv(t,e,r){if(t instanceof Qo||t instanceof at)return t;r={slice:!0,parseOptions:{},...r};const n=typeof t=="object"&&t!==null,i=typeof t=="string";if(n)try{if(Array.isArray(t)&&t.length>0)return at.fromArray(t.map(o=>e.nodeFromJSON(o)));const s=e.nodeFromJSON(t);return r.errorOnInvalidContent&&s.check(),s}catch(a){if(r.errorOnInvalidContent)throw new Error("[tiptap error]: Invalid JSON content",{cause:a});return console.warn("[tiptap warn]: Invalid content.","Passed value:",t,"Error:",a),Gv("",e,r)}if(i){if(r.errorOnInvalidContent){let s=!1,o="";const l=new GR({topNode:e.spec.topNode,marks:e.spec.marks,nodes:e.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:u=>(s=!0,o=typeof u=="string"?u:u.outerHTML,null)}]}})});if(r.slice?Hd.fromSchema(l).parseSlice(Ey(t),r.parseOptions):Hd.fromSchema(l).parse(Ey(t),r.parseOptions),r.errorOnInvalidContent&&s)throw new Error("[tiptap error]: Invalid HTML content",{cause:new Error(`Invalid element found: ${o}`)})}const a=Hd.fromSchema(e);return r.slice?a.parseSlice(Ey(t),r.parseOptions).content:a.parse(Ey(t),r.parseOptions)}return Gv("",e,r)}function RQ(t,e,r){const n=t.steps.length-1;if(n<e)return;const i=t.steps[n];if(!(i instanceof fa||i instanceof ga))return;const a=t.mapping.maps[n];let s=0;a.forEach((o,l,u,c)=>{s===0&&(s=c)}),t.setSelection(_r.near(t.doc.resolve(s),r))}var OQ=t=>!("type"in t),DQ=(t,e,r)=>({tr:n,dispatch:i,editor:a})=>{var s;if(i){r={parseOptions:a.options.parseOptions,updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...r};let o;const l=w=>{a.emit("contentError",{editor:a,error:w,disableCollaboration:()=>{"collaboration"in a.storage&&typeof a.storage.collaboration=="object"&&a.storage.collaboration&&(a.storage.collaboration.isDisabled=!0)}})},u={preserveWhitespace:"full",...r.parseOptions};if(!r.errorOnInvalidContent&&!a.options.enableContentCheck&&a.options.emitContentError)try{Gv(e,a.schema,{parseOptions:u,errorOnInvalidContent:!0})}catch(w){l(w)}try{o=Gv(e,a.schema,{parseOptions:u,errorOnInvalidContent:(s=r.errorOnInvalidContent)!=null?s:a.options.enableContentCheck})}catch(w){return l(w),!1}let{from:c,to:f}=typeof t=="number"?{from:t,to:t}:{from:t.from,to:t.to},p=!0,g=!0;if((OQ(o)?o:[o]).forEach(w=>{w.check(),p=p?w.isText&&w.marks.length===0:!1,g=g?w.isBlock:!1}),c===f&&g){const{parent:w}=n.doc.resolve(c);w.isTextblock&&!w.type.spec.code&&!w.childCount&&(c-=1,f+=1)}let S;if(p){if(Array.isArray(e))S=e.map(w=>w.text||"").join("");else if(e instanceof at){let w="";e.forEach(C=>{C.text&&(w+=C.text)}),S=w}else typeof e=="object"&&e&&e.text?S=e.text:S=e;n.insertText(S,c,f)}else{S=o;const w=n.doc.resolve(c),C=w.node(),_=w.parentOffset===0,T=C.isText||C.isTextblock,N=C.content.size>0;_&&T&&N&&(c=Math.max(0,c-1)),n.replaceWith(c,f,S)}r.updateSelection&&RQ(n,n.steps.length-1,-1),r.applyInputRules&&n.setMeta("applyInputRules",{from:c,text:S}),r.applyPasteRules&&n.setMeta("applyPasteRules",{from:c,text:S})}return!0},IQ=()=>({state:t,dispatch:e})=>sY(t,e),jQ=()=>({state:t,dispatch:e})=>oY(t,e),FQ=()=>({state:t,dispatch:e})=>lO(t,e),BQ=()=>({state:t,dispatch:e})=>fO(t,e),zQ=()=>({state:t,dispatch:e,tr:r})=>{try{const n=X1(t.doc,t.selection.$from.pos,-1);return n==null?!1:(r.join(n,2),e&&e(r),!0)}catch{return!1}},UQ=()=>({state:t,dispatch:e,tr:r})=>{try{const n=X1(t.doc,t.selection.$from.pos,1);return n==null?!1:(r.join(n,2),e&&e(r),!0)}catch{return!1}},GQ=()=>({state:t,dispatch:e})=>iY(t,e),VQ=()=>({state:t,dispatch:e})=>aY(t,e);function s6(){return typeof navigator<"u"?/Mac/.test(navigator.platform):!1}function HQ(t){const e=t.split(/-(?!$)/);let r=e[e.length-1];r==="Space"&&(r=" ");let n,i,a,s;for(let o=0;o<e.length-1;o+=1){const l=e[o];if(/^(cmd|meta|m)$/i.test(l))s=!0;else if(/^a(lt)?$/i.test(l))n=!0;else if(/^(c|ctrl|control)$/i.test(l))i=!0;else if(/^s(hift)?$/i.test(l))a=!0;else if(/^mod$/i.test(l))Gx()||s6()?s=!0:i=!0;else throw new Error(`Unrecognized modifier name: ${l}`)}return n&&(r=`Alt-${r}`),i&&(r=`Ctrl-${r}`),s&&(r=`Meta-${r}`),a&&(r=`Shift-${r}`),r}var WQ=t=>({editor:e,view:r,tr:n,dispatch:i})=>{const a=HQ(t).split(/-(?!$)/),s=a.find(u=>!["Alt","Ctrl","Meta","Shift"].includes(u)),o=new KeyboardEvent("keydown",{key:s==="Space"?" ":s,altKey:a.includes("Alt"),ctrlKey:a.includes("Ctrl"),metaKey:a.includes("Meta"),shiftKey:a.includes("Shift"),bubbles:!0,cancelable:!0}),l=e.captureTransaction(()=>{r.someProp("handleKeyDown",u=>u(r,o))});return l?.steps.forEach(u=>{const c=u.map(n.mapping);c&&i&&n.maybeStep(c)}),!0};function rf(t,e,r={}){const{from:n,to:i,empty:a}=t.selection,s=e?ji(e,t.schema):null,o=[];t.doc.nodesBetween(n,i,(f,p)=>{if(f.isText)return;const g=Math.max(n,p),y=Math.min(i,p+f.nodeSize);o.push({node:f,from:g,to:y})});const l=i-n,u=o.filter(f=>s?s.name===f.node.type.name:!0).filter(f=>Ux(f.node.attrs,r,{strict:!1}));return a?!!u.length:u.reduce((f,p)=>f+p.to-p.from,0)>=l}var qQ=(t,e={})=>({state:r,dispatch:n})=>{const i=ji(t,r.schema);return rf(r,i,e)?lY(r,n):!1},$Q=()=>({state:t,dispatch:e})=>gO(t,e),KQ=t=>({state:e,dispatch:r})=>{const n=ji(t,e.schema);return bY(n)(e,r)},ZQ=()=>({state:t,dispatch:e})=>pO(t,e);function ab(t,e){return e.nodes[t]?"node":e.marks[t]?"mark":null}function yP(t,e){const r=typeof e=="string"?[e]:e;return Object.keys(t).reduce((n,i)=>(r.includes(i)||(n[i]=t[i]),n),{})}var YQ=(t,e)=>({tr:r,state:n,dispatch:i})=>{let a=null,s=null;const o=ab(typeof t=="string"?t:t.name,n.schema);if(!o)return!1;o==="node"&&(a=ji(t,n.schema)),o==="mark"&&(s=Cc(t,n.schema));let l=!1;return r.selection.ranges.forEach(u=>{n.doc.nodesBetween(u.$from.pos,u.$to.pos,(c,f)=>{a&&a===c.type&&(l=!0,i&&r.setNodeMarkup(f,void 0,yP(c.attrs,e))),s&&c.marks.length&&c.marks.forEach(p=>{s===p.type&&(l=!0,i&&r.addMark(f,f+c.nodeSize,s.create(yP(p.attrs,e))))})})}),l},XQ=()=>({tr:t,dispatch:e})=>(e&&t.scrollIntoView(),!0),QQ=()=>({tr:t,dispatch:e})=>{if(e){const r=new yo(t.doc);t.setSelection(r)}return!0},JQ=()=>({state:t,dispatch:e})=>cO(t,e),eJ=()=>({state:t,dispatch:e})=>hO(t,e),tJ=()=>({state:t,dispatch:e})=>fY(t,e),rJ=()=>({state:t,dispatch:e})=>mY(t,e),nJ=()=>({state:t,dispatch:e})=>pY(t,e);function Ak(t,e,r={},n={}){return Gv(t,e,{slice:!1,parseOptions:r,errorOnInvalidContent:n.errorOnInvalidContent})}var iJ=(t,{errorOnInvalidContent:e,emitUpdate:r=!0,parseOptions:n={}}={})=>({editor:i,tr:a,dispatch:s,commands:o})=>{const{doc:l}=a;if(n.preserveWhitespace!=="full"){const u=Ak(t,i.schema,n,{errorOnInvalidContent:e??i.options.enableContentCheck});return s&&a.replaceWith(0,l.content.size,u).setMeta("preventUpdate",!r),!0}return s&&a.setMeta("preventUpdate",!r),o.insertContentAt({from:0,to:l.content.size},t,{parseOptions:n,errorOnInvalidContent:e??i.options.enableContentCheck})};function o6(t,e){const r=Cc(e,t.schema),{from:n,to:i,empty:a}=t.selection,s=[];a?(t.storedMarks&&s.push(...t.storedMarks),s.push(...t.selection.$head.marks())):t.doc.nodesBetween(n,i,l=>{s.push(...l.marks)});const o=s.find(l=>l.type.name===r.name);return o?{...o.attrs}:{}}function l6(t,e){const r=new iO(t);return e.forEach(n=>{n.steps.forEach(i=>{r.step(i)})}),r}function aJ(t){for(let e=0;e<t.edgeCount;e+=1){const{type:r}=t.edge(e);if(r.isTextblock&&!r.hasRequiredAttrs())return r}return null}function sJ(t,e,r){const n=[];return t.nodesBetween(e.from,e.to,(i,a)=>{r(i)&&n.push({node:i,pos:a})}),n}function oJ(t,e){for(let r=t.depth;r>0;r-=1){const n=t.node(r);if(e(n))return{pos:r>0?t.before(r):0,start:t.start(r),depth:r,node:n}}}function sb(t){return e=>oJ(e.$from,t)}function Zt(t,e,r){return t.config[e]===void 0&&t.parent?Zt(t.parent,e,r):typeof t.config[e]=="function"?t.config[e].bind({...r,parent:t.parent?Zt(t.parent,e,r):null}):t.config[e]}function dC(t){return t.map(e=>{const r={name:e.name,options:e.options,storage:e.storage},n=Zt(e,"addExtensions",r);return n?[e,...dC(n())]:e}).flat(10)}function fC(t,e){const r=Mh.fromSchema(e).serializeFragment(t),i=document.implementation.createHTMLDocument().createElement("div");return i.appendChild(r),i.innerHTML}function u6(t){return typeof t=="function"}function dn(t,e=void 0,...r){return u6(t)?e?t.bind(e)(...r):t(...r):t}function lJ(t={}){return Object.keys(t).length===0&&t.constructor===Object}function Qp(t){const e=t.filter(i=>i.type==="extension"),r=t.filter(i=>i.type==="node"),n=t.filter(i=>i.type==="mark");return{baseExtensions:e,nodeExtensions:r,markExtensions:n}}function c6(t){const e=[],{nodeExtensions:r,markExtensions:n}=Qp(t),i=[...r,...n],a={default:null,validate:void 0,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0,isRequired:!1};return t.forEach(s=>{const o={name:s.name,options:s.options,storage:s.storage,extensions:i},l=Zt(s,"addGlobalAttributes",o);if(!l)return;l().forEach(c=>{c.types.forEach(f=>{Object.entries(c.attributes).forEach(([p,g])=>{e.push({type:f,name:p,attribute:{...a,...g}})})})})}),i.forEach(s=>{const o={name:s.name,options:s.options,storage:s.storage},l=Zt(s,"addAttributes",o);if(!l)return;const u=l();Object.entries(u).forEach(([c,f])=>{const p={...a,...f};typeof p?.default=="function"&&(p.default=p.default()),p?.isRequired&&p?.default===void 0&&delete p.default,e.push({type:s.name,name:c,attribute:p})})}),e}function Yn(...t){return t.filter(e=>!!e).reduce((e,r)=>{const n={...e};return Object.entries(r).forEach(([i,a])=>{if(!n[i]){n[i]=a;return}if(i==="class"){const o=a?String(a).split(" "):[],l=n[i]?n[i].split(" "):[],u=o.filter(c=>!l.includes(c));n[i]=[...l,...u].join(" ")}else if(i==="style"){const o=a?a.split(";").map(c=>c.trim()).filter(Boolean):[],l=n[i]?n[i].split(";").map(c=>c.trim()).filter(Boolean):[],u=new Map;l.forEach(c=>{const[f,p]=c.split(":").map(g=>g.trim());u.set(f,p)}),o.forEach(c=>{const[f,p]=c.split(":").map(g=>g.trim());u.set(f,p)}),n[i]=Array.from(u.entries()).map(([c,f])=>`${c}: ${f}`).join("; ")}else n[i]=a}),n},{})}function Vv(t,e){return e.filter(r=>r.type===t.type.name).filter(r=>r.attribute.rendered).map(r=>r.attribute.renderHTML?r.attribute.renderHTML(t.attrs)||{}:{[r.name]:t.attrs[r.name]}).reduce((r,n)=>Yn(r,n),{})}function uJ(t){return typeof t!="string"?t:t.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(t):t==="true"?!0:t==="false"?!1:t}function xP(t,e){return"style"in t?t:{...t,getAttrs:r=>{const n=t.getAttrs?t.getAttrs(r):t.attrs;if(n===!1)return!1;const i=e.reduce((a,s)=>{const o=s.attribute.parseHTML?s.attribute.parseHTML(r):uJ(r.getAttribute(s.name));return o==null?a:{...a,[s.name]:o}},{});return{...n,...i}}}}function bP(t){return Object.fromEntries(Object.entries(t).filter(([e,r])=>e==="attrs"&&lJ(r)?!1:r!=null))}function wP(t){var e,r;const n={};return!((e=t?.attribute)!=null&&e.isRequired)&&"default"in(t?.attribute||{})&&(n.default=t.attribute.default),((r=t?.attribute)==null?void 0:r.validate)!==void 0&&(n.validate=t.attribute.validate),[t.name,n]}function cJ(t,e){var r;const n=c6(t),{nodeExtensions:i,markExtensions:a}=Qp(t),s=(r=i.find(u=>Zt(u,"topNode")))==null?void 0:r.name,o=Object.fromEntries(i.map(u=>{const c=n.filter(C=>C.type===u.name),f={name:u.name,options:u.options,storage:u.storage,editor:e},p=t.reduce((C,_)=>{const T=Zt(_,"extendNodeSchema",f);return{...C,...T?T(u):{}}},{}),g=bP({...p,content:dn(Zt(u,"content",f)),marks:dn(Zt(u,"marks",f)),group:dn(Zt(u,"group",f)),inline:dn(Zt(u,"inline",f)),atom:dn(Zt(u,"atom",f)),selectable:dn(Zt(u,"selectable",f)),draggable:dn(Zt(u,"draggable",f)),code:dn(Zt(u,"code",f)),whitespace:dn(Zt(u,"whitespace",f)),linebreakReplacement:dn(Zt(u,"linebreakReplacement",f)),defining:dn(Zt(u,"defining",f)),isolating:dn(Zt(u,"isolating",f)),attrs:Object.fromEntries(c.map(wP))}),y=dn(Zt(u,"parseHTML",f));y&&(g.parseDOM=y.map(C=>xP(C,c)));const S=Zt(u,"renderHTML",f);S&&(g.toDOM=C=>S({node:C,HTMLAttributes:Vv(C,c)}));const w=Zt(u,"renderText",f);return w&&(g.toText=w),[u.name,g]})),l=Object.fromEntries(a.map(u=>{const c=n.filter(w=>w.type===u.name),f={name:u.name,options:u.options,storage:u.storage,editor:e},p=t.reduce((w,C)=>{const _=Zt(C,"extendMarkSchema",f);return{...w,..._?_(u):{}}},{}),g=bP({...p,inclusive:dn(Zt(u,"inclusive",f)),excludes:dn(Zt(u,"excludes",f)),group:dn(Zt(u,"group",f)),spanning:dn(Zt(u,"spanning",f)),code:dn(Zt(u,"code",f)),attrs:Object.fromEntries(c.map(wP))}),y=dn(Zt(u,"parseHTML",f));y&&(g.parseDOM=y.map(w=>xP(w,c)));const S=Zt(u,"renderHTML",f);return S&&(g.toDOM=w=>S({mark:w,HTMLAttributes:Vv(w,c)})),[u.name,g]}));return new GR({topNode:s,nodes:o,marks:l})}function dJ(t){const e=t.filter((r,n)=>t.indexOf(r)!==n);return Array.from(new Set(e))}function Vx(t){return t.sort((r,n)=>{const i=Zt(r,"priority")||100,a=Zt(n,"priority")||100;return i>a?-1:i<a?1:0})}function d6(t){const e=Vx(dC(t)),r=dJ(e.map(n=>n.name));return r.length&&console.warn(`[tiptap warn]: Duplicate extension names found: [${r.map(n=>`'${n}'`).join(", ")}]. This can lead to issues.`),e}function f6(t,e,r){const{from:n,to:i}=e,{blockSeparator:a=`

`,textSerializers:s={}}=r||{};let o="";return t.nodesBetween(n,i,(l,u,c,f)=>{var p;l.isBlock&&u>n&&(o+=a);const g=s?.[l.type.name];if(g)return c&&(o+=g({node:l,pos:u,parent:c,index:f,range:e})),!1;l.isText&&(o+=(p=l?.text)==null?void 0:p.slice(Math.max(n,u)-u,i-u))}),o}function fJ(t,e){const r={from:0,to:t.content.size};return f6(t,r,e)}function h6(t){return Object.fromEntries(Object.entries(t.nodes).filter(([,e])=>e.spec.toText).map(([e,r])=>[e,r.spec.toText]))}function hJ(t,e){const r=ji(e,t.schema),{from:n,to:i}=t.selection,a=[];t.doc.nodesBetween(n,i,o=>{a.push(o)});const s=a.reverse().find(o=>o.type.name===r.name);return s?{...s.attrs}:{}}function p6(t,e){const r=ab(typeof e=="string"?e:e.name,t.schema);return r==="node"?hJ(t,e):r==="mark"?o6(t,e):{}}function pJ(t,e=JSON.stringify){const r={};return t.filter(n=>{const i=e(n);return Object.prototype.hasOwnProperty.call(r,i)?!1:r[i]=!0})}function mJ(t){const e=pJ(t);return e.length===1?e:e.filter((r,n)=>!e.filter((a,s)=>s!==n).some(a=>r.oldRange.from>=a.oldRange.from&&r.oldRange.to<=a.oldRange.to&&r.newRange.from>=a.newRange.from&&r.newRange.to<=a.newRange.to))}function m6(t){const{mapping:e,steps:r}=t,n=[];return e.maps.forEach((i,a)=>{const s=[];if(i.ranges.length)i.forEach((o,l)=>{s.push({from:o,to:l})});else{const{from:o,to:l}=r[a];if(o===void 0||l===void 0)return;s.push({from:o,to:l})}s.forEach(({from:o,to:l})=>{const u=e.slice(a).map(o,-1),c=e.slice(a).map(l),f=e.invert().map(u,-1),p=e.invert().map(c);n.push({oldRange:{from:f,to:p},newRange:{from:u,to:c}})})}),mJ(n)}function hC(t,e,r){const n=[];return t===e?r.resolve(t).marks().forEach(i=>{const a=r.resolve(t),s=cC(a,i.type);s&&n.push({mark:i,...s})}):r.nodesBetween(t,e,(i,a)=>{!i||i?.nodeSize===void 0||n.push(...i.marks.map(s=>({from:a,to:a+i.nodeSize,mark:s})))}),n}var gJ=(t,e,r,n=20)=>{const i=t.doc.resolve(r);let a=n,s=null;for(;a>0&&s===null;){const o=i.node(a);o?.type.name===e?s=o:a-=1}return[s,a]};function Ty(t,e){return e.nodes[t]||e.marks[t]||null}function ex(t,e,r){return Object.fromEntries(Object.entries(r).filter(([n])=>{const i=t.find(a=>a.type===e&&a.name===n);return i?i.attribute.keepOnSplit:!1}))}var vJ=(t,e=500)=>{let r="";const n=t.parentOffset;return t.parent.nodesBetween(Math.max(0,n-e),n,(i,a,s,o)=>{var l,u;const c=((u=(l=i.type.spec).toText)==null?void 0:u.call(l,{node:i,pos:a,parent:s,index:o}))||i.textContent||"%leaf%";r+=i.isAtom&&!i.isText?c:c.slice(0,Math.max(0,n-a))}),r};function Lk(t,e,r={}){const{empty:n,ranges:i}=t.selection,a=e?Cc(e,t.schema):null;if(n)return!!(t.storedMarks||t.selection.$from.marks()).filter(f=>a?a.name===f.type.name:!0).find(f=>Ux(f.attrs,r,{strict:!1}));let s=0;const o=[];if(i.forEach(({$from:f,$to:p})=>{const g=f.pos,y=p.pos;t.doc.nodesBetween(g,y,(S,w)=>{if(!S.isText&&!S.marks.length)return;const C=Math.max(g,w),_=Math.min(y,w+S.nodeSize),T=_-C;s+=T,o.push(...S.marks.map(N=>({mark:N,from:C,to:_})))})}),s===0)return!1;const l=o.filter(f=>a?a.name===f.mark.type.name:!0).filter(f=>Ux(f.mark.attrs,r,{strict:!1})).reduce((f,p)=>f+p.to-p.from,0),u=o.filter(f=>a?f.mark.type!==a&&f.mark.type.excludes(a):!0).reduce((f,p)=>f+p.to-p.from,0);return(l>0?l+u:l)>=s}function yJ(t,e,r={}){if(!e)return rf(t,null,r)||Lk(t,null,r);const n=ab(e,t.schema);return n==="node"?rf(t,e,r):n==="mark"?Lk(t,e,r):!1}var xJ=(t,e)=>{const{$from:r,$to:n,$anchor:i}=t.selection;if(e){const a=sb(o=>o.type.name===e)(t.selection);if(!a)return!1;const s=t.doc.resolve(a.pos+1);return i.pos+1===s.end()}return!(n.parentOffset<n.parent.nodeSize-2||r.pos!==n.pos)},bJ=t=>{const{$from:e,$to:r}=t.selection;return!(e.parentOffset>0||e.pos!==r.pos)};function SP(t,e){return Array.isArray(e)?e.some(r=>(typeof r=="string"?r:r.name)===t.name):e}function kP(t,e){const{nodeExtensions:r}=Qp(e),n=r.find(s=>s.name===t);if(!n)return!1;const i={name:n.name,options:n.options,storage:n.storage},a=dn(Zt(n,"group",i));return typeof a!="string"?!1:a.split(" ").includes("list")}function ob(t,{checkChildren:e=!0,ignoreWhitespace:r=!1}={}){var n;if(r){if(t.type.name==="hardBreak")return!0;if(t.isText)return/^\s*$/m.test((n=t.text)!=null?n:"")}if(t.isText)return!t.text;if(t.isAtom||t.isLeaf)return!1;if(t.content.childCount===0)return!0;if(e){let i=!0;return t.content.forEach(a=>{i!==!1&&(ob(a,{ignoreWhitespace:r,checkChildren:e})||(i=!1))}),i}return!1}function g6(t){return t instanceof Jt}var v6=class y6{constructor(e){this.position=e}static fromJSON(e){return new y6(e.position)}toJSON(){return{position:this.position}}};function wJ(t,e){const r=e.mapping.mapResult(t.position);return{position:new v6(r.pos),mapResult:r}}function SJ(t){return new v6(t)}function kJ(t,e,r){var n;const{selection:i}=e;let a=null;if(n6(i)&&(a=i.$cursor),a){const o=(n=t.storedMarks)!=null?n:a.marks();return a.parent.type.allowsMarkType(r)&&(!!r.isInSet(o)||!o.some(u=>u.type.excludes(r)))}const{ranges:s}=i;return s.some(({$from:o,$to:l})=>{let u=o.depth===0?t.doc.inlineContent&&t.doc.type.allowsMarkType(r):!1;return t.doc.nodesBetween(o.pos,l.pos,(c,f,p)=>{if(u)return!1;if(c.isInline){const g=!p||p.type.allowsMarkType(r),y=!!r.isInSet(c.marks)||!c.marks.some(S=>S.type.excludes(r));u=g&&y}return!u}),u})}var _J=(t,e={})=>({tr:r,state:n,dispatch:i})=>{const{selection:a}=r,{empty:s,ranges:o}=a,l=Cc(t,n.schema);if(i)if(s){const u=o6(n,l);r.addStoredMark(l.create({...u,...e}))}else o.forEach(u=>{const c=u.$from.pos,f=u.$to.pos;n.doc.nodesBetween(c,f,(p,g)=>{const y=Math.max(g,c),S=Math.min(g+p.nodeSize,f);p.marks.find(C=>C.type===l)?p.marks.forEach(C=>{l===C.type&&r.addMark(y,S,l.create({...C.attrs,...e}))}):r.addMark(y,S,l.create(e))})});return kJ(n,r,l)},CJ=(t,e)=>({tr:r})=>(r.setMeta(t,e),!0),EJ=(t,e={})=>({state:r,dispatch:n,chain:i})=>{const a=ji(t,r.schema);let s;return r.selection.$anchor.sameParent(r.selection.$head)&&(s=r.selection.$anchor.parent.attrs),a.isTextblock?i().command(({commands:o})=>I3(a,{...s,...e})(r)?!0:o.clearNodes()).command(({state:o})=>I3(a,{...s,...e})(o,n)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},TJ=t=>({tr:e,dispatch:r})=>{if(r){const{doc:n}=e,i=ah(t,0,n.content.size),a=Jt.create(n,i);e.setSelection(a)}return!0},NJ=(t,e)=>({tr:r,state:n,dispatch:i})=>{const{selection:a}=n;let s,o;return typeof e=="number"?(s=e,o=e):e&&"from"in e&&"to"in e?(s=e.from,o=e.to):(s=a.from,o=a.to),i&&r.doc.nodesBetween(s,o,(l,u)=>{l.isText||r.setNodeMarkup(u,void 0,{...l.attrs,dir:t})}),!0},PJ=t=>({tr:e,dispatch:r})=>{if(r){const{doc:n}=e,{from:i,to:a}=typeof t=="number"?{from:t,to:t}:t,s=fr.atStart(n).from,o=fr.atEnd(n).to,l=ah(i,s,o),u=ah(a,s,o),c=fr.create(n,l,u);e.setSelection(c)}return!0},MJ=t=>({state:e,dispatch:r})=>{const n=ji(t,e.schema);return kY(n)(e,r)};function _P(t,e){const r=t.storedMarks||t.selection.$to.parentOffset&&t.selection.$from.marks();if(r){const n=r.filter(i=>e?.includes(i.type.name));t.tr.ensureMarks(n)}}var AJ=({keepMarks:t=!0}={})=>({tr:e,state:r,dispatch:n,editor:i})=>{const{selection:a,doc:s}=e,{$from:o,$to:l}=a,u=i.extensionManager.attributes,c=ex(u,o.node().type.name,o.node().attrs);if(a instanceof Jt&&a.node.isBlock)return!o.parentOffset||!gc(s,o.pos)?!1:(n&&(t&&_P(r,i.extensionManager.splittableMarks),e.split(o.pos).scrollIntoView()),!0);if(!o.parent.isBlock)return!1;const f=l.parentOffset===l.parent.content.size,p=o.depth===0?void 0:aJ(o.node(-1).contentMatchAt(o.indexAfter(-1)));let g=f&&p?[{type:p,attrs:c}]:void 0,y=gc(e.doc,e.mapping.map(o.pos),1,g);if(!g&&!y&&gc(e.doc,e.mapping.map(o.pos),1,p?[{type:p}]:void 0)&&(y=!0,g=p?[{type:p,attrs:c}]:void 0),n){if(y&&(a instanceof fr&&e.deleteSelection(),e.split(e.mapping.map(o.pos),1,g),p&&!f&&!o.parentOffset&&o.parent.type!==p)){const S=e.mapping.map(o.before()),w=e.doc.resolve(S);o.node(-1).canReplaceWith(w.index(),w.index()+1,p)&&e.setNodeMarkup(e.mapping.map(o.before()),p)}t&&_P(r,i.extensionManager.splittableMarks),e.scrollIntoView()}return y},LJ=(t,e={})=>({tr:r,state:n,dispatch:i,editor:a})=>{var s;const o=ji(t,n.schema),{$from:l,$to:u}=n.selection,c=n.selection.node;if(c&&c.isBlock||l.depth<2||!l.sameParent(u))return!1;const f=l.node(-1);if(f.type!==o)return!1;const p=a.extensionManager.attributes;if(l.parent.content.size===0&&l.node(-1).childCount===l.indexAfter(-1)){if(l.depth===2||l.node(-3).type!==o||l.index(-2)!==l.node(-2).childCount-1)return!1;if(i){let C=at.empty;const _=l.index(-1)?1:l.index(-2)?2:3;for(let O=l.depth-_;O>=l.depth-3;O-=1)C=at.from(l.node(O).copy(C));const T=l.indexAfter(-1)<l.node(-2).childCount?1:l.indexAfter(-2)<l.node(-3).childCount?2:3,N={...ex(p,l.node().type.name,l.node().attrs),...e},R=((s=o.contentMatch.defaultType)==null?void 0:s.createAndFill(N))||void 0;C=C.append(at.from(o.createAndFill(null,R)||void 0));const D=l.before(l.depth-(_-1));r.replace(D,l.after(-T),new Ot(C,4-_,0));let j=-1;r.doc.nodesBetween(D,r.doc.content.size,(O,F)=>{if(j>-1)return!1;O.isTextblock&&O.content.size===0&&(j=F+1)}),j>-1&&r.setSelection(fr.near(r.doc.resolve(j))),r.scrollIntoView()}return!0}const g=u.pos===l.end()?f.contentMatchAt(0).defaultType:null,y={...ex(p,f.type.name,f.attrs),...e},S={...ex(p,l.node().type.name,l.node().attrs),...e};r.delete(l.pos,u.pos);const w=g?[{type:o,attrs:y},{type:g,attrs:S}]:[{type:o,attrs:y}];if(!gc(r.doc,l.pos,2))return!1;if(i){const{selection:C,storedMarks:_}=n,{splittableMarks:T}=a.extensionManager,N=_||C.$to.parentOffset&&C.$from.marks();if(r.split(l.pos,2,w).scrollIntoView(),!N||!i)return!0;const R=N.filter(D=>T.includes(D.type.name));r.ensureMarks(R)}return!0},mS=(t,e)=>{const r=sb(s=>s.type===e)(t.selection);if(!r)return!0;const n=t.doc.resolve(Math.max(0,r.pos-1)).before(r.depth);if(n===void 0)return!0;const i=t.doc.nodeAt(n);return r.node.type===i?.type&&hf(t.doc,r.pos)&&t.join(r.pos),!0},gS=(t,e)=>{const r=sb(s=>s.type===e)(t.selection);if(!r)return!0;const n=t.doc.resolve(r.start).after(r.depth);if(n===void 0)return!0;const i=t.doc.nodeAt(n);return r.node.type===i?.type&&hf(t.doc,n)&&t.join(n),!0},RJ=(t,e,r,n={})=>({editor:i,tr:a,state:s,dispatch:o,chain:l,commands:u,can:c})=>{const{extensions:f,splittableMarks:p}=i.extensionManager,g=ji(t,s.schema),y=ji(e,s.schema),{selection:S,storedMarks:w}=s,{$from:C,$to:_}=S,T=C.blockRange(_),N=w||S.$to.parentOffset&&S.$from.marks();if(!T)return!1;const R=sb(D=>kP(D.type.name,f))(S);if(T.depth>=1&&R&&T.depth-R.depth<=1){if(R.node.type===g)return u.liftListItem(y);if(kP(R.node.type.name,f)&&g.validContent(R.node.content)&&o)return l().command(()=>(a.setNodeMarkup(R.pos,g),!0)).command(()=>mS(a,g)).command(()=>gS(a,g)).run()}return!r||!N||!o?l().command(()=>c().wrapInList(g,n)?!0:u.clearNodes()).wrapInList(g,n).command(()=>mS(a,g)).command(()=>gS(a,g)).run():l().command(()=>{const D=c().wrapInList(g,n),j=N.filter(O=>p.includes(O.type.name));return a.ensureMarks(j),D?!0:u.clearNodes()}).wrapInList(g,n).command(()=>mS(a,g)).command(()=>gS(a,g)).run()},OJ=(t,e={},r={})=>({state:n,commands:i})=>{const{extendEmptyMarkRange:a=!1}=r,s=Cc(t,n.schema);return Lk(n,s,e)?i.unsetMark(s,{extendEmptyMarkRange:a}):i.setMark(s,e)},DJ=(t,e,r={})=>({state:n,commands:i})=>{const a=ji(t,n.schema),s=ji(e,n.schema),o=rf(n,a,r);let l;return n.selection.$anchor.sameParent(n.selection.$head)&&(l=n.selection.$anchor.parent.attrs),o?i.setNode(s,l):i.setNode(a,{...l,...r})},IJ=(t,e={})=>({state:r,commands:n})=>{const i=ji(t,r.schema);return rf(r,i,e)?n.lift(i):n.wrapIn(i,e)},jJ=()=>({state:t,dispatch:e})=>{const r=t.plugins;for(let n=0;n<r.length;n+=1){const i=r[n];let a;if(i.spec.isInputRules&&(a=i.getState(t))){if(e){const s=t.tr,o=a.transform;for(let l=o.steps.length-1;l>=0;l-=1)s.step(o.steps[l].invert(o.docs[l]));if(a.text){const l=s.doc.resolve(a.from).marks();s.replaceWith(a.from,a.to,t.schema.text(a.text,l))}else s.delete(a.from,a.to)}return!0}}return!1},FJ=()=>({tr:t,dispatch:e})=>{const{selection:r}=t,{empty:n,ranges:i}=r;return n||e&&i.forEach(a=>{t.removeMark(a.$from.pos,a.$to.pos)}),!0},BJ=(t,e={})=>({tr:r,state:n,dispatch:i})=>{var a;const{extendEmptyMarkRange:s=!1}=e,{selection:o}=r,l=Cc(t,n.schema),{$from:u,empty:c,ranges:f}=o;if(!i)return!0;if(c&&s){let{from:p,to:g}=o;const y=(a=u.marks().find(w=>w.type===l))==null?void 0:a.attrs,S=cC(u,l,y);S&&(p=S.from,g=S.to),r.removeMark(p,g,l)}else f.forEach(p=>{r.removeMark(p.$from.pos,p.$to.pos,l)});return r.removeStoredMark(l),!0},zJ=t=>({tr:e,state:r,dispatch:n})=>{const{selection:i}=r;let a,s;return typeof t=="number"?(a=t,s=t):t&&"from"in t&&"to"in t?(a=t.from,s=t.to):(a=i.from,s=i.to),n&&e.doc.nodesBetween(a,s,(o,l)=>{if(o.isText)return;const u={...o.attrs};delete u.dir,e.setNodeMarkup(l,void 0,u)}),!0},UJ=(t,e={})=>({tr:r,state:n,dispatch:i})=>{let a=null,s=null;const o=ab(typeof t=="string"?t:t.name,n.schema);if(!o)return!1;o==="node"&&(a=ji(t,n.schema)),o==="mark"&&(s=Cc(t,n.schema));let l=!1;return r.selection.ranges.forEach(u=>{const c=u.$from.pos,f=u.$to.pos;let p,g,y,S;r.selection.empty?n.doc.nodesBetween(c,f,(w,C)=>{a&&a===w.type&&(l=!0,y=Math.max(C,c),S=Math.min(C+w.nodeSize,f),p=C,g=w)}):n.doc.nodesBetween(c,f,(w,C)=>{C<c&&a&&a===w.type&&(l=!0,y=Math.max(C,c),S=Math.min(C+w.nodeSize,f),p=C,g=w),C>=c&&C<=f&&(a&&a===w.type&&(l=!0,i&&r.setNodeMarkup(C,void 0,{...w.attrs,...e})),s&&w.marks.length&&w.marks.forEach(_=>{if(s===_.type&&(l=!0,i)){const T=Math.max(C,c),N=Math.min(C+w.nodeSize,f);r.addMark(T,N,s.create({..._.attrs,...e}))}}))}),g&&(p!==void 0&&i&&r.setNodeMarkup(p,void 0,{...g.attrs,...e}),s&&g.marks.length&&g.marks.forEach(w=>{s===w.type&&i&&r.addMark(y,S,s.create({...w.attrs,...e}))}))}),l},GJ=(t,e={})=>({state:r,dispatch:n})=>{const i=ji(t,r.schema);return gY(i,e)(r,n)},VJ=(t,e={})=>({state:r,dispatch:n})=>{const i=ji(t,r.schema);return vY(i,e)(r,n)},HJ=class{constructor(){this.callbacks={}}on(t,e){return this.callbacks[t]||(this.callbacks[t]=[]),this.callbacks[t].push(e),this}emit(t,...e){const r=this.callbacks[t];return r&&r.forEach(n=>n.apply(this,e)),this}off(t,e){const r=this.callbacks[t];return r&&(e?this.callbacks[t]=r.filter(n=>n!==e):delete this.callbacks[t]),this}once(t,e){const r=(...n)=>{this.off(t,r),e.apply(this,n)};return this.on(t,r)}removeAllListeners(){this.callbacks={}}},lb=class{constructor(t){var e;this.find=t.find,this.handler=t.handler,this.undoable=(e=t.undoable)!=null?e:!0}},WJ=(t,e)=>{if(uC(e))return e.exec(t);const r=e(t);if(!r)return null;const n=[r.text];return n.index=r.index,n.input=t,n.data=r.data,r.replaceWith&&(r.text.includes(r.replaceWith)||console.warn('[tiptap warn]: "inputRuleMatch.replaceWith" must be part of "inputRuleMatch.text".'),n.push(r.replaceWith)),n};function Ny(t){var e;const{editor:r,from:n,to:i,text:a,rules:s,plugin:o}=t,{view:l}=r;if(l.composing)return!1;const u=l.state.doc.resolve(n);if(u.parent.type.spec.code||(e=u.nodeBefore||u.nodeAfter)!=null&&e.marks.find(p=>p.type.spec.code))return!1;let c=!1;const f=vJ(u)+a;return s.forEach(p=>{if(c)return;const g=WJ(f,p.find);if(!g)return;const y=l.state.tr,S=nb({state:l.state,transaction:y}),w={from:n-(g[0].length-a.length),to:i},{commands:C,chain:_,can:T}=new ib({editor:r,state:S});p.handler({state:S,range:w,match:g,commands:C,chain:_,can:T})===null||!y.steps.length||(p.undoable&&y.setMeta(o,{transform:y,from:n,to:i,text:a}),l.dispatch(y),c=!0)}),c}function qJ(t){const{editor:e,rules:r}=t,n=new Xn({state:{init(){return null},apply(i,a,s){const o=i.getMeta(n);if(o)return o;const l=i.getMeta("applyInputRules");return l&&setTimeout(()=>{let{text:c}=l;typeof c=="string"?c=c:c=fC(at.from(c),s.schema);const{from:f}=l,p=f+c.length;Ny({editor:e,from:f,to:p,text:c,rules:r,plugin:n})}),i.selectionSet||i.docChanged?null:a}},props:{handleTextInput(i,a,s,o){return Ny({editor:e,from:a,to:s,text:o,rules:r,plugin:n})},handleDOMEvents:{compositionend:i=>(setTimeout(()=>{const{$cursor:a}=i.state.selection;a&&Ny({editor:e,from:a.pos,to:a.pos,text:"",rules:r,plugin:n})}),!1)},handleKeyDown(i,a){if(a.key!=="Enter")return!1;const{$cursor:s}=i.state.selection;return s?Ny({editor:e,from:s.pos,to:s.pos,text:`
`,rules:r,plugin:n}):!1}},isInputRules:!0});return n}function $J(t){return Object.prototype.toString.call(t).slice(8,-1)}function Py(t){return $J(t)!=="Object"?!1:t.constructor===Object&&Object.getPrototypeOf(t)===Object.prototype}function x6(t,e){const r={...t};return Py(t)&&Py(e)&&Object.keys(e).forEach(n=>{Py(e[n])&&Py(t[n])?r[n]=x6(t[n],e[n]):r[n]=e[n]}),r}var pC=class{constructor(t={}){this.type="extendable",this.parent=null,this.child=null,this.name="",this.config={name:this.name},this.config={...this.config,...t},this.name=this.config.name}get options(){return{...dn(Zt(this,"addOptions",{name:this.name}))||{}}}get storage(){return{...dn(Zt(this,"addStorage",{name:this.name,options:this.options}))||{}}}configure(t={}){const e=this.extend({...this.config,addOptions:()=>x6(this.options,t)});return e.name=this.name,e.parent=this.parent,e}extend(t={}){const e=new this.constructor({...this.config,...t});return e.parent=this,this.child=e,e.name="name"in t?t.name:e.parent.name,e}},Ah=class b6 extends pC{constructor(){super(...arguments),this.type="mark"}static create(e={}){const r=typeof e=="function"?e():e;return new b6(r)}static handleExit({editor:e,mark:r}){const{tr:n}=e.state,i=e.state.selection.$from;if(i.pos===i.end()){const s=i.marks();if(!!!s.find(u=>u?.type.name===r.name))return!1;const l=s.find(u=>u?.type.name===r.name);return l&&n.removeStoredMark(l),n.insertText(" ",i.pos),e.view.dispatch(n),!0}return!1}configure(e){return super.configure(e)}extend(e){const r=typeof e=="function"?e():e;return super.extend(r)}};function KJ(t){return typeof t=="number"}var ZJ=class{constructor(t){this.find=t.find,this.handler=t.handler}},YJ=(t,e,r)=>{if(uC(e))return[...t.matchAll(e)];const n=e(t,r);return n?n.map(i=>{const a=[i.text];return a.index=i.index,a.input=t,a.data=i.data,i.replaceWith&&(i.text.includes(i.replaceWith)||console.warn('[tiptap warn]: "pasteRuleMatch.replaceWith" must be part of "pasteRuleMatch.text".'),a.push(i.replaceWith)),a}):[]};function XJ(t){const{editor:e,state:r,from:n,to:i,rule:a,pasteEvent:s,dropEvent:o}=t,{commands:l,chain:u,can:c}=new ib({editor:e,state:r}),f=[];return r.doc.nodesBetween(n,i,(g,y)=>{var S,w,C,_,T;if((w=(S=g.type)==null?void 0:S.spec)!=null&&w.code||!(g.isText||g.isTextblock||g.isInline))return;const N=(T=(_=(C=g.content)==null?void 0:C.size)!=null?_:g.nodeSize)!=null?T:0,R=Math.max(n,y),D=Math.min(i,y+N);if(R>=D)return;const j=g.isText?g.text||"":g.textBetween(R-y,D-y,void 0,"");YJ(j,a.find,s).forEach(F=>{if(F.index===void 0)return;const z=R+F.index+1,G=z+F[0].length,Z={from:r.tr.mapping.map(z),to:r.tr.mapping.map(G)},I=a.handler({state:r,range:Z,match:F,commands:l,chain:u,can:c,pasteEvent:s,dropEvent:o});f.push(I)})}),f.every(g=>g!==null)}var My=null,QJ=t=>{var e;const r=new ClipboardEvent("paste",{clipboardData:new DataTransfer});return(e=r.clipboardData)==null||e.setData("text/html",t),r};function JJ(t){const{editor:e,rules:r}=t;let n=null,i=!1,a=!1,s=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,o;try{o=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{o=null}const l=({state:c,from:f,to:p,rule:g,pasteEvt:y})=>{const S=c.tr,w=nb({state:c,transaction:S});if(!(!XJ({editor:e,state:w,from:Math.max(f-1,0),to:p.b-1,rule:g,pasteEvent:y,dropEvent:o})||!S.steps.length)){try{o=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{o=null}return s=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,S}};return r.map(c=>new Xn({view(f){const p=y=>{var S;n=(S=f.dom.parentElement)!=null&&S.contains(y.target)?f.dom.parentElement:null,n&&(My=e)},g=()=>{My&&(My=null)};return window.addEventListener("dragstart",p),window.addEventListener("dragend",g),{destroy(){window.removeEventListener("dragstart",p),window.removeEventListener("dragend",g)}}},props:{handleDOMEvents:{drop:(f,p)=>{if(a=n===f.dom.parentElement,o=p,!a){const g=My;g?.isEditable&&setTimeout(()=>{const y=g.state.selection;y&&g.commands.deleteRange({from:y.from,to:y.to})},10)}return!1},paste:(f,p)=>{var g;const y=(g=p.clipboardData)==null?void 0:g.getData("text/html");return s=p,i=!!y?.includes("data-pm-slice"),!1}}},appendTransaction:(f,p,g)=>{const y=f[0],S=y.getMeta("uiEvent")==="paste"&&!i,w=y.getMeta("uiEvent")==="drop"&&!a,C=y.getMeta("applyPasteRules"),_=!!C;if(!S&&!w&&!_)return;if(_){let{text:R}=C;typeof R=="string"?R=R:R=fC(at.from(R),g.schema);const{from:D}=C,j=D+R.length,O=QJ(R);return l({rule:c,state:g,from:D,to:{b:j},pasteEvt:O})}const T=p.doc.content.findDiffStart(g.doc.content),N=p.doc.content.findDiffEnd(g.doc.content);if(!(!KJ(T)||!N||T===N.b))return l({rule:c,state:g,from:T,to:N,pasteEvt:s})}}))}var ub=class{constructor(t,e){this.splittableMarks=[],this.editor=e,this.baseExtensions=t,this.extensions=d6(t),this.schema=cJ(this.extensions,e),this.setupExtensions()}get commands(){return this.extensions.reduce((t,e)=>{const r={name:e.name,options:e.options,storage:this.editor.extensionStorage[e.name],editor:this.editor,type:Ty(e.name,this.schema)},n=Zt(e,"addCommands",r);return n?{...t,...n()}:t},{})}get plugins(){const{editor:t}=this;return Vx([...this.extensions].reverse()).flatMap(n=>{const i={name:n.name,options:n.options,storage:this.editor.extensionStorage[n.name],editor:t,type:Ty(n.name,this.schema)},a=[],s=Zt(n,"addKeyboardShortcuts",i);let o={};if(n.type==="mark"&&Zt(n,"exitable",i)&&(o.ArrowRight=()=>Ah.handleExit({editor:t,mark:n})),s){const p=Object.fromEntries(Object.entries(s()).map(([g,y])=>[g,()=>y({editor:t})]));o={...o,...p}}const l=hQ(o);a.push(l);const u=Zt(n,"addInputRules",i);if(SP(n,t.options.enableInputRules)&&u){const p=u();if(p&&p.length){const g=qJ({editor:t,rules:p}),y=Array.isArray(g)?g:[g];a.push(...y)}}const c=Zt(n,"addPasteRules",i);if(SP(n,t.options.enablePasteRules)&&c){const p=c();if(p&&p.length){const g=JJ({editor:t,rules:p});a.push(...g)}}const f=Zt(n,"addProseMirrorPlugins",i);if(f){const p=f();a.push(...p)}return a})}get attributes(){return c6(this.extensions)}get nodeViews(){const{editor:t}=this,{nodeExtensions:e}=Qp(this.extensions);return Object.fromEntries(e.filter(r=>!!Zt(r,"addNodeView")).map(r=>{const n=this.attributes.filter(l=>l.type===r.name),i={name:r.name,options:r.options,storage:this.editor.extensionStorage[r.name],editor:t,type:ji(r.name,this.schema)},a=Zt(r,"addNodeView",i);if(!a)return[];const s=a();if(!s)return[];const o=(l,u,c,f,p)=>{const g=Vv(l,n);return s({node:l,view:u,getPos:c,decorations:f,innerDecorations:p,editor:t,extension:r,HTMLAttributes:g})};return[r.name,o]}))}dispatchTransaction(t){const{editor:e}=this;return Vx([...this.extensions].reverse()).reduceRight((n,i)=>{const a={name:i.name,options:i.options,storage:this.editor.extensionStorage[i.name],editor:e,type:Ty(i.name,this.schema)},s=Zt(i,"dispatchTransaction",a);return s?o=>{s.call(a,{transaction:o,next:n})}:n},t)}get markViews(){const{editor:t}=this,{markExtensions:e}=Qp(this.extensions);return Object.fromEntries(e.filter(r=>!!Zt(r,"addMarkView")).map(r=>{const n=this.attributes.filter(o=>o.type===r.name),i={name:r.name,options:r.options,storage:this.editor.extensionStorage[r.name],editor:t,type:Cc(r.name,this.schema)},a=Zt(r,"addMarkView",i);if(!a)return[];const s=(o,l,u)=>{const c=Vv(o,n);return a()({mark:o,view:l,inline:u,editor:t,extension:r,HTMLAttributes:c,updateAttributes:f=>{hee(o,t,f)}})};return[r.name,s]}))}setupExtensions(){const t=this.extensions;this.editor.extensionStorage=Object.fromEntries(t.map(e=>[e.name,e.storage])),t.forEach(e=>{var r;const n={name:e.name,options:e.options,storage:this.editor.extensionStorage[e.name],editor:this.editor,type:Ty(e.name,this.schema)};e.type==="mark"&&((r=dn(Zt(e,"keepOnSplit",n)))==null||r)&&this.splittableMarks.push(e.name);const i=Zt(e,"onBeforeCreate",n),a=Zt(e,"onCreate",n),s=Zt(e,"onUpdate",n),o=Zt(e,"onSelectionUpdate",n),l=Zt(e,"onTransaction",n),u=Zt(e,"onFocus",n),c=Zt(e,"onBlur",n),f=Zt(e,"onDestroy",n);i&&this.editor.on("beforeCreate",i),a&&this.editor.on("create",a),s&&this.editor.on("update",s),o&&this.editor.on("selectionUpdate",o),l&&this.editor.on("transaction",l),u&&this.editor.on("focus",u),c&&this.editor.on("blur",c),f&&this.editor.on("destroy",f)})}};ub.resolve=d6;ub.sort=Vx;ub.flatten=dC;var eee={};lC(eee,{ClipboardTextSerializer:()=>S6,Commands:()=>k6,Delete:()=>_6,Drop:()=>C6,Editable:()=>E6,FocusEvents:()=>N6,Keymap:()=>P6,Paste:()=>M6,Tabindex:()=>A6,TextDirection:()=>L6,focusEventsPluginKey:()=>T6});var Ni=class w6 extends pC{constructor(){super(...arguments),this.type="extension"}static create(e={}){const r=typeof e=="function"?e():e;return new w6(r)}configure(e){return super.configure(e)}extend(e){const r=typeof e=="function"?e():e;return super.extend(r)}},S6=Ni.create({name:"clipboardTextSerializer",addOptions(){return{blockSeparator:void 0}},addProseMirrorPlugins(){return[new Xn({key:new Ti("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:t}=this,{state:e,schema:r}=t,{doc:n,selection:i}=e,{ranges:a}=i,s=Math.min(...a.map(c=>c.$from.pos)),o=Math.max(...a.map(c=>c.$to.pos)),l=h6(r);return f6(n,{from:s,to:o},{...this.options.blockSeparator!==void 0?{blockSeparator:this.options.blockSeparator}:{},textSerializers:l})}}})]}}),k6=Ni.create({name:"commands",addCommands(){return{...t6}}}),_6=Ni.create({name:"delete",onUpdate({transaction:t,appendedTransactions:e}){var r,n,i;const a=()=>{var s,o,l,u;if((u=(l=(o=(s=this.editor.options.coreExtensionOptions)==null?void 0:s.delete)==null?void 0:o.filterTransaction)==null?void 0:l.call(o,t))!=null?u:t.getMeta("y-sync$"))return;const c=l6(t.before,[t,...e]);m6(c).forEach(g=>{c.mapping.mapResult(g.oldRange.from).deletedAfter&&c.mapping.mapResult(g.oldRange.to).deletedBefore&&c.before.nodesBetween(g.oldRange.from,g.oldRange.to,(y,S)=>{const w=S+y.nodeSize-2,C=g.oldRange.from<=S&&w<=g.oldRange.to;this.editor.emit("delete",{type:"node",node:y,from:S,to:w,newFrom:c.mapping.map(S),newTo:c.mapping.map(w),deletedRange:g.oldRange,newRange:g.newRange,partial:!C,editor:this.editor,transaction:t,combinedTransform:c})})});const p=c.mapping;c.steps.forEach((g,y)=>{var S,w;if(g instanceof Ol){const C=p.slice(y).map(g.from,-1),_=p.slice(y).map(g.to),T=p.invert().map(C,-1),N=p.invert().map(_),R=(S=c.doc.nodeAt(C-1))==null?void 0:S.marks.some(j=>j.eq(g.mark)),D=(w=c.doc.nodeAt(_))==null?void 0:w.marks.some(j=>j.eq(g.mark));this.editor.emit("delete",{type:"mark",mark:g.mark,from:g.from,to:g.to,deletedRange:{from:T,to:N},newRange:{from:C,to:_},partial:!!(D||R),editor:this.editor,transaction:t,combinedTransform:c})}})};(i=(n=(r=this.editor.options.coreExtensionOptions)==null?void 0:r.delete)==null?void 0:n.async)==null||i?setTimeout(a,0):a()}}),C6=Ni.create({name:"drop",addProseMirrorPlugins(){return[new Xn({key:new Ti("tiptapDrop"),props:{handleDrop:(t,e,r,n)=>{this.editor.emit("drop",{editor:this.editor,event:e,slice:r,moved:n})}}})]}}),E6=Ni.create({name:"editable",addProseMirrorPlugins(){return[new Xn({key:new Ti("editable"),props:{editable:()=>this.editor.options.editable}})]}}),T6=new Ti("focusEvents"),N6=Ni.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:t}=this;return[new Xn({key:T6,props:{handleDOMEvents:{focus:(e,r)=>{t.isFocused=!0;const n=t.state.tr.setMeta("focus",{event:r}).setMeta("addToHistory",!1);return e.dispatch(n),!1},blur:(e,r)=>{t.isFocused=!1;const n=t.state.tr.setMeta("blur",{event:r}).setMeta("addToHistory",!1);return e.dispatch(n),!1}}}})]}}),P6=Ni.create({name:"keymap",addKeyboardShortcuts(){const t=()=>this.editor.commands.first(({commands:s})=>[()=>s.undoInputRule(),()=>s.command(({tr:o})=>{const{selection:l,doc:u}=o,{empty:c,$anchor:f}=l,{pos:p,parent:g}=f,y=f.parent.isTextblock&&p>0?o.doc.resolve(p-1):f,S=y.parent.type.spec.isolating,w=f.pos-f.parentOffset,C=S&&y.parent.childCount===1?w===f.pos:_r.atStart(u).from===p;return!c||!g.type.isTextblock||g.textContent.length||!C||C&&f.parent.type.name==="paragraph"?!1:s.clearNodes()}),()=>s.deleteSelection(),()=>s.joinBackward(),()=>s.selectNodeBackward()]),e=()=>this.editor.commands.first(({commands:s})=>[()=>s.deleteSelection(),()=>s.deleteCurrentNode(),()=>s.joinForward(),()=>s.selectNodeForward()]),n={Enter:()=>this.editor.commands.first(({commands:s})=>[()=>s.newlineInCode(),()=>s.createParagraphNear(),()=>s.liftEmptyBlock(),()=>s.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:t,"Mod-Backspace":t,"Shift-Backspace":t,Delete:e,"Mod-Delete":e,"Mod-a":()=>this.editor.commands.selectAll()},i={...n},a={...n,"Ctrl-h":t,"Alt-Backspace":t,"Ctrl-d":e,"Ctrl-Alt-Backspace":e,"Alt-Delete":e,"Alt-d":e,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return Gx()||s6()?a:i},addProseMirrorPlugins(){return[new Xn({key:new Ti("clearDocument"),appendTransaction:(t,e,r)=>{if(t.some(S=>S.getMeta("composition")))return;const n=t.some(S=>S.docChanged)&&!e.doc.eq(r.doc),i=t.some(S=>S.getMeta("preventClearDocument"));if(!n||i)return;const{empty:a,from:s,to:o}=e.selection,l=_r.atStart(e.doc).from,u=_r.atEnd(e.doc).to;if(a||!(s===l&&o===u)||!ob(r.doc))return;const p=r.tr,g=nb({state:r,transaction:p}),{commands:y}=new ib({editor:this.editor,state:g});if(y.clearNodes(),!!p.steps.length)return p}})]}}),M6=Ni.create({name:"paste",addProseMirrorPlugins(){return[new Xn({key:new Ti("tiptapPaste"),props:{handlePaste:(t,e,r)=>{this.editor.emit("paste",{editor:this.editor,event:e,slice:r})}}})]}}),A6=Ni.create({name:"tabindex",addProseMirrorPlugins(){return[new Xn({key:new Ti("tabindex"),props:{attributes:()=>this.editor.isEditable?{tabindex:"0"}:{}}})]}}),L6=Ni.create({name:"textDirection",addOptions(){return{direction:void 0}},addGlobalAttributes(){if(!this.options.direction)return[];const{nodeExtensions:t}=Qp(this.extensions);return[{types:t.filter(e=>e.name!=="text").map(e=>e.name),attributes:{dir:{default:this.options.direction,parseHTML:e=>{const r=e.getAttribute("dir");return r&&(r==="ltr"||r==="rtl"||r==="auto")?r:this.options.direction},renderHTML:e=>e.dir?{dir:e.dir}:{}}}}]},addProseMirrorPlugins(){return[new Xn({key:new Ti("textDirection"),props:{attributes:()=>{const t=this.options.direction;return t?{dir:t}:{}}}})]}}),tee=class Np{constructor(e,r,n=!1,i=null){this.currentNode=null,this.actualDepth=null,this.isBlock=n,this.resolvedPos=e,this.editor=r,this.currentNode=i}get name(){return this.node.type.name}get node(){return this.currentNode||this.resolvedPos.node()}get element(){return this.editor.view.domAtPos(this.pos).node}get depth(){var e;return(e=this.actualDepth)!=null?e:this.resolvedPos.depth}get pos(){return this.resolvedPos.pos}get content(){return this.node.content}set content(e){let r=this.from,n=this.to;if(this.isBlock){if(this.content.size===0){console.error(`You cant set content on a block node. Tried to set content on ${this.name} at ${this.pos}`);return}r=this.from+1,n=this.to-1}this.editor.commands.insertContentAt({from:r,to:n},e)}get attributes(){return this.node.attrs}get textContent(){return this.node.textContent}get size(){return this.node.nodeSize}get from(){return this.isBlock?this.pos:this.resolvedPos.start(this.resolvedPos.depth)}get range(){return{from:this.from,to:this.to}}get to(){return this.isBlock?this.pos+this.size:this.resolvedPos.end(this.resolvedPos.depth)+(this.node.isText?0:1)}get parent(){if(this.depth===0)return null;const e=this.resolvedPos.start(this.resolvedPos.depth-1),r=this.resolvedPos.doc.resolve(e);return new Np(r,this.editor)}get before(){let e=this.resolvedPos.doc.resolve(this.from-(this.isBlock?1:2));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.from-3)),new Np(e,this.editor)}get after(){let e=this.resolvedPos.doc.resolve(this.to+(this.isBlock?2:1));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.to+3)),new Np(e,this.editor)}get children(){const e=[];return this.node.content.forEach((r,n)=>{const i=r.isBlock&&!r.isTextblock,a=r.isAtom&&!r.isText,s=this.pos+n+(a?0:1);if(s<0||s>this.resolvedPos.doc.nodeSize-2)return;const o=this.resolvedPos.doc.resolve(s);if(!i&&o.depth<=this.depth)return;const l=new Np(o,this.editor,i,i?r:null);i&&(l.actualDepth=this.depth+1),e.push(new Np(o,this.editor,i,i?r:null))}),e}get firstChild(){return this.children[0]||null}get lastChild(){const e=this.children;return e[e.length-1]||null}closest(e,r={}){let n=null,i=this.parent;for(;i&&!n;){if(i.node.type.name===e)if(Object.keys(r).length>0){const a=i.node.attrs,s=Object.keys(r);for(let o=0;o<s.length;o+=1){const l=s[o];if(a[l]!==r[l])break}}else n=i;i=i.parent}return n}querySelector(e,r={}){return this.querySelectorAll(e,r,!0)[0]||null}querySelectorAll(e,r={},n=!1){let i=[];if(!this.children||this.children.length===0)return i;const a=Object.keys(r);return this.children.forEach(s=>{n&&i.length>0||(s.node.type.name===e&&a.every(l=>r[l]===s.node.attrs[l])&&i.push(s),!(n&&i.length>0)&&(i=i.concat(s.querySelectorAll(e,r,n))))}),i}setAttribute(e){const{tr:r}=this.editor.state;r.setNodeMarkup(this.from,void 0,{...this.node.attrs,...e}),this.editor.view.dispatch(r)}},ree=`.ProseMirror {
  position: relative;
}

.ProseMirror {
  word-wrap: break-word;
  white-space: pre-wrap;
  white-space: break-spaces;
  -webkit-font-variant-ligatures: none;
  font-variant-ligatures: none;
  font-feature-settings: "liga" 0; /* the above doesn't seem to work in Edge */
}

.ProseMirror [contenteditable="false"] {
  white-space: normal;
}

.ProseMirror [contenteditable="false"] [contenteditable="true"] {
  white-space: pre-wrap;
}

.ProseMirror pre {
  white-space: pre-wrap;
}

img.ProseMirror-separator {
  display: inline !important;
  border: none !important;
  margin: 0 !important;
  width: 0 !important;
  height: 0 !important;
}

.ProseMirror-gapcursor {
  display: none;
  pointer-events: none;
  position: absolute;
  margin: 0;
}

.ProseMirror-gapcursor:after {
  content: "";
  display: block;
  position: absolute;
  top: -2px;
  width: 20px;
  border-top: 1px solid black;
  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;
}

@keyframes ProseMirror-cursor-blink {
  to {
    visibility: hidden;
  }
}

.ProseMirror-hideselection *::selection {
  background: transparent;
}

.ProseMirror-hideselection *::-moz-selection {
  background: transparent;
}

.ProseMirror-hideselection * {
  caret-color: transparent;
}

.ProseMirror-focused .ProseMirror-gapcursor {
  display: block;
}`;function nee(t,e,r){const n=document.querySelector("style[data-tiptap-style]");if(n!==null)return n;const i=document.createElement("style");return e&&i.setAttribute("nonce",e),i.setAttribute("data-tiptap-style",""),i.innerHTML=t,document.getElementsByTagName("head")[0].appendChild(i),i}var iee=class extends HJ{constructor(t={}){super(),this.css=null,this.className="tiptap",this.editorView=null,this.isFocused=!1,this.isInitialized=!1,this.extensionStorage={},this.instanceId=Math.random().toString(36).slice(2,9),this.options={element:typeof document<"u"?document.createElement("div"):null,content:"",injectCSS:!0,injectNonce:void 0,extensions:[],autofocus:!1,editable:!0,textDirection:void 0,editorProps:{},parseOptions:{},coreExtensionOptions:{},enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!0,enableContentCheck:!1,emitContentError:!1,onBeforeCreate:()=>null,onCreate:()=>null,onMount:()=>null,onUnmount:()=>null,onUpdate:()=>null,onSelectionUpdate:()=>null,onTransaction:()=>null,onFocus:()=>null,onBlur:()=>null,onDestroy:()=>null,onContentError:({error:n})=>{throw n},onPaste:()=>null,onDrop:()=>null,onDelete:()=>null,enableExtensionDispatchTransaction:!0},this.isCapturingTransaction=!1,this.capturedTransaction=null,this.utils={getUpdatedPosition:wJ,createMappablePosition:SJ},this.setOptions(t),this.createExtensionManager(),this.createCommandManager(),this.createSchema(),this.on("beforeCreate",this.options.onBeforeCreate),this.emit("beforeCreate",{editor:this}),this.on("mount",this.options.onMount),this.on("unmount",this.options.onUnmount),this.on("contentError",this.options.onContentError),this.on("create",this.options.onCreate),this.on("update",this.options.onUpdate),this.on("selectionUpdate",this.options.onSelectionUpdate),this.on("transaction",this.options.onTransaction),this.on("focus",this.options.onFocus),this.on("blur",this.options.onBlur),this.on("destroy",this.options.onDestroy),this.on("drop",({event:n,slice:i,moved:a})=>this.options.onDrop(n,i,a)),this.on("paste",({event:n,slice:i})=>this.options.onPaste(n,i)),this.on("delete",this.options.onDelete);const e=this.createDoc(),r=i6(e,this.options.autofocus);this.editorState=Op.create({doc:e,schema:this.schema,selection:r||void 0}),this.options.element&&this.mount(this.options.element)}mount(t){if(typeof document>"u")throw new Error("[tiptap error]: The editor cannot be mounted because there is no 'document' defined in this environment.");this.createView(t),this.emit("mount",{editor:this}),this.css&&!document.head.contains(this.css)&&document.head.appendChild(this.css),window.setTimeout(()=>{this.isDestroyed||(this.options.autofocus!==!1&&this.options.autofocus!==null&&this.commands.focus(this.options.autofocus),this.emit("create",{editor:this}),this.isInitialized=!0)},0)}unmount(){if(this.editorView){const t=this.editorView.dom;t?.editor&&delete t.editor,this.editorView.destroy()}if(this.editorView=null,this.isInitialized=!1,this.css&&!document.querySelectorAll(`.${this.className}`).length)try{typeof this.css.remove=="function"?this.css.remove():this.css.parentNode&&this.css.parentNode.removeChild(this.css)}catch(t){console.warn("Failed to remove CSS element:",t)}this.css=null,this.emit("unmount",{editor:this})}get storage(){return this.extensionStorage}get commands(){return this.commandManager.commands}chain(){return this.commandManager.chain()}can(){return this.commandManager.can()}injectCSS(){this.options.injectCSS&&typeof document<"u"&&(this.css=nee(ree,this.options.injectNonce))}setOptions(t={}){this.options={...this.options,...t},!(!this.editorView||!this.state||this.isDestroyed)&&(this.options.editorProps&&this.view.setProps(this.options.editorProps),this.view.updateState(this.state))}setEditable(t,e=!0){this.setOptions({editable:t}),e&&this.emit("update",{editor:this,transaction:this.state.tr,appendedTransactions:[]})}get isEditable(){return this.options.editable&&this.view&&this.view.editable}get view(){return this.editorView?this.editorView:new Proxy({state:this.editorState,updateState:t=>{this.editorState=t},dispatch:t=>{this.dispatchTransaction(t)},composing:!1,dragging:null,editable:!0,isDestroyed:!1},{get:(t,e)=>{if(this.editorView)return this.editorView[e];if(e==="state")return this.editorState;if(e in t)return Reflect.get(t,e);throw new Error(`[tiptap error]: The editor view is not available. Cannot access view['${e}']. The editor may not be mounted yet.`)}})}get state(){return this.editorView&&(this.editorState=this.view.state),this.editorState}registerPlugin(t,e){const r=u6(e)?e(t,[...this.state.plugins]):[...this.state.plugins,t],n=this.state.reconfigure({plugins:r});return this.view.updateState(n),n}unregisterPlugin(t){if(this.isDestroyed)return;const e=this.state.plugins;let r=e;if([].concat(t).forEach(i=>{const a=typeof i=="string"?`${i}$`:i.key;r=r.filter(s=>!s.key.startsWith(a))}),e.length===r.length)return;const n=this.state.reconfigure({plugins:r});return this.view.updateState(n),n}createExtensionManager(){var t,e;const n=[...this.options.enableCoreExtensions?[E6,S6.configure({blockSeparator:(e=(t=this.options.coreExtensionOptions)==null?void 0:t.clipboardTextSerializer)==null?void 0:e.blockSeparator}),k6,N6,P6,A6,C6,M6,_6,L6.configure({direction:this.options.textDirection})].filter(i=>typeof this.options.enableCoreExtensions=="object"?this.options.enableCoreExtensions[i.name]!==!1:!0):[],...this.options.extensions].filter(i=>["extension","node","mark"].includes(i?.type));this.extensionManager=new ub(n,this)}createCommandManager(){this.commandManager=new ib({editor:this})}createSchema(){this.schema=this.extensionManager.schema}createDoc(){let t;try{t=Ak(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:this.options.enableContentCheck})}catch(e){if(!(e instanceof Error)||!["[tiptap error]: Invalid JSON content","[tiptap error]: Invalid HTML content"].includes(e.message))throw e;this.emit("contentError",{editor:this,error:e,disableCollaboration:()=>{"collaboration"in this.storage&&typeof this.storage.collaboration=="object"&&this.storage.collaboration&&(this.storage.collaboration.isDisabled=!0),this.options.extensions=this.options.extensions.filter(r=>r.name!=="collaboration"),this.createExtensionManager()}}),t=Ak(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:!1})}return t}createView(t){const{editorProps:e,enableExtensionDispatchTransaction:r}=this.options,n=e.dispatchTransaction||this.dispatchTransaction.bind(this),i=r?this.extensionManager.dispatchTransaction(n):n;this.editorView=new JO(t,{...e,attributes:{role:"textbox",...e?.attributes},dispatchTransaction:i,state:this.editorState,markViews:this.extensionManager.markViews,nodeViews:this.extensionManager.nodeViews});const a=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(a),this.prependClass(),this.injectCSS();const s=this.view.dom;s.editor=this}createNodeViews(){this.view.isDestroyed||this.view.setProps({markViews:this.extensionManager.markViews,nodeViews:this.extensionManager.nodeViews})}prependClass(){this.view.dom.className=`${this.className} ${this.view.dom.className}`}captureTransaction(t){this.isCapturingTransaction=!0,t(),this.isCapturingTransaction=!1;const e=this.capturedTransaction;return this.capturedTransaction=null,e}dispatchTransaction(t){if(this.view.isDestroyed)return;if(this.isCapturingTransaction){if(!this.capturedTransaction){this.capturedTransaction=t;return}t.steps.forEach(u=>{var c;return(c=this.capturedTransaction)==null?void 0:c.step(u)});return}const{state:e,transactions:r}=this.state.applyTransaction(t),n=!this.state.selection.eq(e.selection),i=r.includes(t),a=this.state;if(this.emit("beforeTransaction",{editor:this,transaction:t,nextState:e}),!i)return;this.view.updateState(e),this.emit("transaction",{editor:this,transaction:t,appendedTransactions:r.slice(1)}),n&&this.emit("selectionUpdate",{editor:this,transaction:t});const s=r.findLast(u=>u.getMeta("focus")||u.getMeta("blur")),o=s?.getMeta("focus"),l=s?.getMeta("blur");o&&this.emit("focus",{editor:this,event:o.event,transaction:s}),l&&this.emit("blur",{editor:this,event:l.event,transaction:s}),!(t.getMeta("preventUpdate")||!r.some(u=>u.docChanged)||a.doc.eq(e.doc))&&this.emit("update",{editor:this,transaction:t,appendedTransactions:r.slice(1)})}getAttributes(t){return p6(this.state,t)}isActive(t,e){const r=typeof t=="string"?t:null,n=typeof t=="string"?e:t;return yJ(this.state,r,n)}getJSON(){return this.state.doc.toJSON()}getHTML(){return fC(this.state.doc.content,this.schema)}getText(t){const{blockSeparator:e=`

`,textSerializers:r={}}=t||{};return fJ(this.state.doc,{blockSeparator:e,textSerializers:{...h6(this.schema),...r}})}get isEmpty(){return ob(this.state.doc)}destroy(){this.emit("destroy"),this.unmount(),this.removeAllListeners()}get isDestroyed(){var t,e;return(e=(t=this.editorView)==null?void 0:t.isDestroyed)!=null?e:!0}$node(t,e){var r;return((r=this.$doc)==null?void 0:r.querySelector(t,e))||null}$nodes(t,e){var r;return((r=this.$doc)==null?void 0:r.querySelectorAll(t,e))||null}$pos(t){const e=this.state.doc.resolve(t);return new tee(e,this)}get $doc(){return this.$pos(0)}};function Jp(t){return new lb({find:t.find,handler:({state:e,range:r,match:n})=>{const i=dn(t.getAttributes,void 0,n);if(i===!1||i===null)return null;const{tr:a}=e,s=n[n.length-1],o=n[0];if(s){const l=o.search(/\S/),u=r.from+o.indexOf(s),c=u+s.length;if(hC(r.from,r.to,e.doc).filter(g=>g.mark.type.excluded.find(S=>S===t.type&&S!==g.mark.type)).filter(g=>g.to>u).length)return null;c<r.to&&a.delete(c,r.to),u>r.from&&a.delete(r.from+l,u);const p=r.from+l+s.length;a.addMark(r.from+l,p,t.type.create(i||{})),a.removeStoredMark(t.type)}},undoable:t.undoable})}function aee(t){return new lb({find:t.find,handler:({state:e,range:r,match:n})=>{const i=dn(t.getAttributes,void 0,n)||{},{tr:a}=e,s=r.from;let o=r.to;const l=t.type.create(i);if(n[1]){const u=n[0].lastIndexOf(n[1]);let c=s+u;c>o?c=o:o=c+n[1].length;const f=n[0][n[0].length-1];a.insertText(f,s+n[0].length-1),a.replaceWith(c,o,l)}else if(n[0]){const u=t.type.isInline?s:s-1;a.insert(u,t.type.create(i)).delete(a.mapping.map(s),a.mapping.map(o))}a.scrollIntoView()},undoable:t.undoable})}function Rk(t){return new lb({find:t.find,handler:({state:e,range:r,match:n})=>{const i=e.doc.resolve(r.from),a=dn(t.getAttributes,void 0,n)||{};if(!i.node(-1).canReplaceWith(i.index(-1),i.indexAfter(-1),t.type))return null;e.tr.delete(r.from,r.to).setBlockType(r.from,r.from,t.type,a)},undoable:t.undoable})}function em(t){return new lb({find:t.find,handler:({state:e,range:r,match:n,chain:i})=>{const a=dn(t.getAttributes,void 0,n)||{},s=e.tr.delete(r.from,r.to),l=s.doc.resolve(r.from).blockRange(),u=l&&q_(l,t.type,a);if(!u)return null;if(s.wrap(l,u),t.keepMarks&&t.editor){const{selection:f,storedMarks:p}=e,{splittableMarks:g}=t.editor.extensionManager,y=p||f.$to.parentOffset&&f.$from.marks();if(y){const S=y.filter(w=>g.includes(w.type.name));s.ensureMarks(S)}}if(t.keepAttributes){const f=t.type.name==="bulletList"||t.type.name==="orderedList"?"listItem":"taskList";i().updateAttributes(f,a).run()}const c=s.doc.resolve(r.from-1).nodeBefore;c&&c.type===t.type&&hf(s.doc,r.from-1)&&(!t.joinPredicate||t.joinPredicate(n,c))&&s.join(r.from-1)},undoable:t.undoable})}function see(t,e){const{selection:r}=t,{$from:n}=r;if(r instanceof Jt){const a=n.index();return n.parent.canReplaceWith(a,a+1,e)}let i=n.depth;for(;i>=0;){const a=n.index(i);if(n.node(i).contentMatchAt(a).matchType(e))return!0;i-=1}return!1}function oee(t){return t.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&")}var lee={};lC(lee,{createAtomBlockMarkdownSpec:()=>uee,createBlockMarkdownSpec:()=>cee,createInlineMarkdownSpec:()=>R6,parseAttributes:()=>mC,parseIndentedBlocks:()=>Ok,renderNestedMarkdownContent:()=>vC,serializeAttributes:()=>gC});function mC(t){if(!t?.trim())return{};const e={},r=[],n=t.replace(/["']([^"']*)["']/g,u=>(r.push(u),`__QUOTED_${r.length-1}__`)),i=n.match(/(?:^|\s)\.([a-zA-Z][\w-]*)/g);if(i){const u=i.map(c=>c.trim().slice(1));e.class=u.join(" ")}const a=n.match(/(?:^|\s)#([a-zA-Z][\w-]*)/);a&&(e.id=a[1]);const s=/([a-zA-Z][\w-]*)\s*=\s*(__QUOTED_\d+__)/g;Array.from(n.matchAll(s)).forEach(([,u,c])=>{var f;const p=parseInt(((f=c.match(/__QUOTED_(\d+)__/))==null?void 0:f[1])||"0",10),g=r[p];g&&(e[u]=g.slice(1,-1))});const l=n.replace(/(?:^|\s)\.([a-zA-Z][\w-]*)/g,"").replace(/(?:^|\s)#([a-zA-Z][\w-]*)/g,"").replace(/([a-zA-Z][\w-]*)\s*=\s*__QUOTED_\d+__/g,"").trim();return l&&l.split(/\s+/).filter(Boolean).forEach(c=>{c.match(/^[a-zA-Z][\w-]*$/)&&(e[c]=!0)}),e}function gC(t){if(!t||Object.keys(t).length===0)return"";const e=[];return t.class&&String(t.class).split(/\s+/).filter(Boolean).forEach(n=>e.push(`.${n}`)),t.id&&e.push(`#${t.id}`),Object.entries(t).forEach(([r,n])=>{r==="class"||r==="id"||(n===!0?e.push(r):n!==!1&&n!=null&&e.push(`${r}="${String(n)}"`))}),e.join(" ")}function uee(t){const{nodeName:e,name:r,parseAttributes:n=mC,serializeAttributes:i=gC,defaultAttributes:a={},requiredAttributes:s=[],allowedAttributes:o}=t,l=r||e,u=c=>{if(!o)return c;const f={};return o.forEach(p=>{p in c&&(f[p]=c[p])}),f};return{parseMarkdown:(c,f)=>{const p={...a,...c.attributes};return f.createNode(e,p,[])},markdownTokenizer:{name:e,level:"block",start(c){var f;const p=new RegExp(`^:::${l}(?:\\s|$)`,"m"),g=(f=c.match(p))==null?void 0:f.index;return g!==void 0?g:-1},tokenize(c,f,p){const g=new RegExp(`^:::${l}(?:\\s+\\{([^}]*)\\})?\\s*:::(?:\\n|$)`),y=c.match(g);if(!y)return;const S=y[1]||"",w=n(S);if(!s.find(_=>!(_ in w)))return{type:e,raw:y[0],attributes:w}}},renderMarkdown:c=>{const f=u(c.attrs||{}),p=i(f),g=p?` {${p}}`:"";return`:::${l}${g} :::`}}}function cee(t){const{nodeName:e,name:r,getContent:n,parseAttributes:i=mC,serializeAttributes:a=gC,defaultAttributes:s={},content:o="block",allowedAttributes:l}=t,u=r||e,c=f=>{if(!l)return f;const p={};return l.forEach(g=>{g in f&&(p[g]=f[g])}),p};return{parseMarkdown:(f,p)=>{let g;if(n){const S=n(f);g=typeof S=="string"?[{type:"text",text:S}]:S}else o==="block"?g=p.parseChildren(f.tokens||[]):g=p.parseInline(f.tokens||[]);const y={...s,...f.attributes};return p.createNode(e,y,g)},markdownTokenizer:{name:e,level:"block",start(f){var p;const g=new RegExp(`^:::${u}`,"m"),y=(p=f.match(g))==null?void 0:p.index;return y!==void 0?y:-1},tokenize(f,p,g){var y;const S=new RegExp(`^:::${u}(?:\\s+\\{([^}]*)\\})?\\s*\\n`),w=f.match(S);if(!w)return;const[C,_=""]=w,T=i(_);let N=1;const R=C.length;let D="";const j=/^:::([\w-]*)(\s.*)?/gm,O=f.slice(R);for(j.lastIndex=0;;){const F=j.exec(O);if(F===null)break;const z=F.index,G=F[1];if(!((y=F[2])!=null&&y.endsWith(":::"))){if(G)N+=1;else if(N-=1,N===0){const Z=O.slice(0,z);D=Z.trim();const I=f.slice(0,R+z+F[0].length);let W=[];if(D)if(o==="block")for(W=g.blockTokens(Z),W.forEach(U=>{U.text&&(!U.tokens||U.tokens.length===0)&&(U.tokens=g.inlineTokens(U.text))});W.length>0;){const U=W[W.length-1];if(U.type==="paragraph"&&(!U.text||U.text.trim()===""))W.pop();else break}else W=g.inlineTokens(D);return{type:e,raw:I,attributes:T,content:D,tokens:W}}}}}},renderMarkdown:(f,p)=>{const g=c(f.attrs||{}),y=a(g),S=y?` {${y}}`:"",w=p.renderChildren(f.content||[],`

`);return`:::${u}${S}

${w}

:::`}}}function dee(t){if(!t.trim())return{};const e={},r=/(\w+)=(?:"([^"]*)"|'([^']*)')/g;let n=r.exec(t);for(;n!==null;){const[,i,a,s]=n;e[i]=a||s,n=r.exec(t)}return e}function fee(t){return Object.entries(t).filter(([,e])=>e!=null).map(([e,r])=>`${e}="${r}"`).join(" ")}function R6(t){const{nodeName:e,name:r,getContent:n,parseAttributes:i=dee,serializeAttributes:a=fee,defaultAttributes:s={},selfClosing:o=!1,allowedAttributes:l}=t,u=r||e,c=p=>{if(!l)return p;const g={};return l.forEach(y=>{const S=typeof y=="string"?y:y.name,w=typeof y=="string"?void 0:y.skipIfDefault;if(S in p){const C=p[S];if(w!==void 0&&C===w)return;g[S]=C}}),g},f=u.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return{parseMarkdown:(p,g)=>{const y={...s,...p.attributes};if(o)return g.createNode(e,y);const S=n?n(p):p.content||"";return S?g.createNode(e,y,[g.createTextNode(S)]):g.createNode(e,y,[])},markdownTokenizer:{name:e,level:"inline",start(p){const g=o?new RegExp(`\\[${f}\\s*[^\\]]*\\]`):new RegExp(`\\[${f}\\s*[^\\]]*\\][\\s\\S]*?\\[\\/${f}\\]`),y=p.match(g),S=y?.index;return S!==void 0?S:-1},tokenize(p,g,y){const S=o?new RegExp(`^\\[${f}\\s*([^\\]]*)\\]`):new RegExp(`^\\[${f}\\s*([^\\]]*)\\]([\\s\\S]*?)\\[\\/${f}\\]`),w=p.match(S);if(!w)return;let C="",_="";if(o){const[,N]=w;_=N}else{const[,N,R]=w;_=N,C=R||""}const T=i(_.trim());return{type:e,raw:w[0],content:C.trim(),attributes:T}}},renderMarkdown:p=>{let g="";n?g=n(p):p.content&&p.content.length>0&&(g=p.content.filter(C=>C.type==="text").map(C=>C.text).join(""));const y=c(p.attrs||{}),S=a(y),w=S?` ${S}`:"";return o?`[${u}${w}]`:`[${u}${w}]${g}[/${u}]`}}}function Ok(t,e,r){var n,i,a,s;const o=t.split(`
`),l=[];let u="",c=0;const f=e.baseIndentSize||2;for(;c<o.length;){const p=o[c],g=p.match(e.itemPattern);if(!g){if(l.length>0)break;if(p.trim()===""){c+=1,u=`${u}${p}
`;continue}else return}const y=e.extractItemData(g),{indentLevel:S,mainContent:w}=y;u=`${u}${p}
`;const C=[w];for(c+=1;c<o.length;){const R=o[c];if(R.trim()===""){const j=o.slice(c+1).findIndex(z=>z.trim()!=="");if(j===-1)break;if((((i=(n=o[c+1+j].match(/^(\s*)/))==null?void 0:n[1])==null?void 0:i.length)||0)>S){C.push(R),u=`${u}${R}
`,c+=1;continue}else break}if((((s=(a=R.match(/^(\s*)/))==null?void 0:a[1])==null?void 0:s.length)||0)>S)C.push(R),u=`${u}${R}
`,c+=1;else break}let _;const T=C.slice(1);if(T.length>0){const R=T.map(D=>D.slice(S+f)).join(`
`);R.trim()&&(e.customNestedParser?_=e.customNestedParser(R):_=r.blockTokens(R))}const N=e.createToken(y,_);l.push(N)}if(l.length!==0)return{items:l,raw:u}}function vC(t,e,r,n){if(!t||!Array.isArray(t.content))return"";const i=typeof r=="function"?r(n):r,[a,...s]=t.content,o=e.renderChildren([a]),l=[`${i}${o}`];return s&&s.length>0&&s.forEach(u=>{const c=e.renderChildren([u]);if(c){const f=c.split(`
`).map(p=>p?e.indent(p):"").join(`
`);l.push(f)}}),l.join(`
`)}function hee(t,e,r={}){const{state:n}=e,{doc:i,tr:a}=n,s=t;i.descendants((o,l)=>{const u=a.mapping.map(l),c=a.mapping.map(l)+o.nodeSize;let f=null;if(o.marks.forEach(g=>{if(g!==s)return!1;f=g}),!f)return;let p=!1;if(Object.keys(r).forEach(g=>{r[g]!==f.attrs[g]&&(p=!0)}),p){const g=t.type.create({...t.attrs,...r});a.removeMark(u,c,t.type),a.addMark(u,c,g)}}),a.docChanged&&e.view.dispatch(a)}var to=class O6 extends pC{constructor(){super(...arguments),this.type="node"}static create(e={}){const r=typeof e=="function"?e():e;return new O6(r)}configure(e){return super.configure(e)}extend(e){const r=typeof e=="function"?e():e;return super.extend(r)}};function Ch(t){return new ZJ({find:t.find,handler:({state:e,range:r,match:n,pasteEvent:i})=>{const a=dn(t.getAttributes,void 0,n,i);if(a===!1||a===null)return null;const{tr:s}=e,o=n[n.length-1],l=n[0];let u=r.to;if(o){const c=l.search(/\S/),f=r.from+l.indexOf(o),p=f+o.length;if(hC(r.from,r.to,e.doc).filter(y=>y.mark.type.excluded.find(w=>w===t.type&&w!==y.mark.type)).filter(y=>y.to>f).length)return null;p<r.to&&s.delete(p,r.to),f>r.from&&s.delete(r.from+c,f),u=r.from+c+o.length,s.addMark(r.from+c,u,t.type.create(a||{})),s.removeStoredMark(t.type)}}})}const{getOwnPropertyNames:pee,getOwnPropertySymbols:mee}=Object,{hasOwnProperty:gee}=Object.prototype;function vS(t,e){return function(n,i,a){return t(n,i,a)&&e(n,i,a)}}function Ay(t){return function(r,n,i){if(!r||!n||typeof r!="object"||typeof n!="object")return t(r,n,i);const{cache:a}=i,s=a.get(r),o=a.get(n);if(s&&o)return s===n&&o===r;a.set(r,n),a.set(n,r);const l=t(r,n,i);return a.delete(r),a.delete(n),l}}function vee(t){return t?.[Symbol.toStringTag]}function CP(t){return pee(t).concat(mee(t))}const yee=Object.hasOwn||((t,e)=>gee.call(t,e));function Lh(t,e){return t===e||!t&&!e&&t!==t&&e!==e}const xee="__v",bee="__o",wee="_owner",{getOwnPropertyDescriptor:EP,keys:TP}=Object;function See(t,e){return t.byteLength===e.byteLength&&Hx(new Uint8Array(t),new Uint8Array(e))}function kee(t,e,r){let n=t.length;if(e.length!==n)return!1;for(;n-- >0;)if(!r.equals(t[n],e[n],n,n,t,e,r))return!1;return!0}function _ee(t,e){return t.byteLength===e.byteLength&&Hx(new Uint8Array(t.buffer,t.byteOffset,t.byteLength),new Uint8Array(e.buffer,e.byteOffset,e.byteLength))}function Cee(t,e){return Lh(t.getTime(),e.getTime())}function Eee(t,e){return t.name===e.name&&t.message===e.message&&t.cause===e.cause&&t.stack===e.stack}function Tee(t,e){return t===e}function NP(t,e,r){const n=t.size;if(n!==e.size)return!1;if(!n)return!0;const i=new Array(n),a=t.entries();let s,o,l=0;for(;(s=a.next())&&!s.done;){const u=e.entries();let c=!1,f=0;for(;(o=u.next())&&!o.done;){if(i[f]){f++;continue}const p=s.value,g=o.value;if(r.equals(p[0],g[0],l,f,t,e,r)&&r.equals(p[1],g[1],p[0],g[0],t,e,r)){c=i[f]=!0;break}f++}if(!c)return!1;l++}return!0}const Nee=Lh;function Pee(t,e,r){const n=TP(t);let i=n.length;if(TP(e).length!==i)return!1;for(;i-- >0;)if(!D6(t,e,r,n[i]))return!1;return!0}function Gg(t,e,r){const n=CP(t);let i=n.length;if(CP(e).length!==i)return!1;let a,s,o;for(;i-- >0;)if(a=n[i],!D6(t,e,r,a)||(s=EP(t,a),o=EP(e,a),(s||o)&&(!s||!o||s.configurable!==o.configurable||s.enumerable!==o.enumerable||s.writable!==o.writable)))return!1;return!0}function Mee(t,e){return Lh(t.valueOf(),e.valueOf())}function Aee(t,e){return t.source===e.source&&t.flags===e.flags}function PP(t,e,r){const n=t.size;if(n!==e.size)return!1;if(!n)return!0;const i=new Array(n),a=t.values();let s,o;for(;(s=a.next())&&!s.done;){const l=e.values();let u=!1,c=0;for(;(o=l.next())&&!o.done;){if(!i[c]&&r.equals(s.value,o.value,s.value,o.value,t,e,r)){u=i[c]=!0;break}c++}if(!u)return!1}return!0}function Hx(t,e){let r=t.byteLength;if(e.byteLength!==r||t.byteOffset!==e.byteOffset)return!1;for(;r-- >0;)if(t[r]!==e[r])return!1;return!0}function Lee(t,e){return t.hostname===e.hostname&&t.pathname===e.pathname&&t.protocol===e.protocol&&t.port===e.port&&t.hash===e.hash&&t.username===e.username&&t.password===e.password}function D6(t,e,r,n){return(n===wee||n===bee||n===xee)&&(t.$$typeof||e.$$typeof)?!0:yee(e,n)&&r.equals(t[n],e[n],n,n,t,e,r)}const Ree="[object ArrayBuffer]",Oee="[object Arguments]",Dee="[object Boolean]",Iee="[object DataView]",jee="[object Date]",Fee="[object Error]",Bee="[object Map]",zee="[object Number]",Uee="[object Object]",Gee="[object RegExp]",Vee="[object Set]",Hee="[object String]",Wee={"[object Int8Array]":!0,"[object Uint8Array]":!0,"[object Uint8ClampedArray]":!0,"[object Int16Array]":!0,"[object Uint16Array]":!0,"[object Int32Array]":!0,"[object Uint32Array]":!0,"[object Float16Array]":!0,"[object Float32Array]":!0,"[object Float64Array]":!0,"[object BigInt64Array]":!0,"[object BigUint64Array]":!0},qee="[object URL]",$ee=Object.prototype.toString;function Kee({areArrayBuffersEqual:t,areArraysEqual:e,areDataViewsEqual:r,areDatesEqual:n,areErrorsEqual:i,areFunctionsEqual:a,areMapsEqual:s,areNumbersEqual:o,areObjectsEqual:l,arePrimitiveWrappersEqual:u,areRegExpsEqual:c,areSetsEqual:f,areTypedArraysEqual:p,areUrlsEqual:g,unknownTagComparators:y}){return function(w,C,_){if(w===C)return!0;if(w==null||C==null)return!1;const T=typeof w;if(T!==typeof C)return!1;if(T!=="object")return T==="number"?o(w,C,_):T==="function"?a(w,C,_):!1;const N=w.constructor;if(N!==C.constructor)return!1;if(N===Object)return l(w,C,_);if(Array.isArray(w))return e(w,C,_);if(N===Date)return n(w,C,_);if(N===RegExp)return c(w,C,_);if(N===Map)return s(w,C,_);if(N===Set)return f(w,C,_);const R=$ee.call(w);if(R===jee)return n(w,C,_);if(R===Gee)return c(w,C,_);if(R===Bee)return s(w,C,_);if(R===Vee)return f(w,C,_);if(R===Uee)return typeof w.then!="function"&&typeof C.then!="function"&&l(w,C,_);if(R===qee)return g(w,C,_);if(R===Fee)return i(w,C,_);if(R===Oee)return l(w,C,_);if(Wee[R])return p(w,C,_);if(R===Ree)return t(w,C,_);if(R===Iee)return r(w,C,_);if(R===Dee||R===zee||R===Hee)return u(w,C,_);if(y){let D=y[R];if(!D){const j=vee(w);j&&(D=y[j])}if(D)return D(w,C,_)}return!1}}function Zee({circular:t,createCustomConfig:e,strict:r}){let n={areArrayBuffersEqual:See,areArraysEqual:r?Gg:kee,areDataViewsEqual:_ee,areDatesEqual:Cee,areErrorsEqual:Eee,areFunctionsEqual:Tee,areMapsEqual:r?vS(NP,Gg):NP,areNumbersEqual:Nee,areObjectsEqual:r?Gg:Pee,arePrimitiveWrappersEqual:Mee,areRegExpsEqual:Aee,areSetsEqual:r?vS(PP,Gg):PP,areTypedArraysEqual:r?vS(Hx,Gg):Hx,areUrlsEqual:Lee,unknownTagComparators:void 0};if(e&&(n=Object.assign({},n,e(n))),t){const i=Ay(n.areArraysEqual),a=Ay(n.areMapsEqual),s=Ay(n.areObjectsEqual),o=Ay(n.areSetsEqual);n=Object.assign({},n,{areArraysEqual:i,areMapsEqual:a,areObjectsEqual:s,areSetsEqual:o})}return n}function Yee(t){return function(e,r,n,i,a,s,o){return t(e,r,o)}}function Xee({circular:t,comparator:e,createState:r,equals:n,strict:i}){if(r)return function(o,l){const{cache:u=t?new WeakMap:void 0,meta:c}=r();return e(o,l,{cache:u,equals:n,meta:c,strict:i})};if(t)return function(o,l){return e(o,l,{cache:new WeakMap,equals:n,meta:void 0,strict:i})};const a={cache:void 0,equals:n,meta:void 0,strict:i};return function(o,l){return e(o,l,a)}}const Qee=mf();mf({strict:!0});mf({circular:!0});mf({circular:!0,strict:!0});mf({createInternalComparator:()=>Lh});mf({strict:!0,createInternalComparator:()=>Lh});mf({circular:!0,createInternalComparator:()=>Lh});mf({circular:!0,createInternalComparator:()=>Lh,strict:!0});function mf(t={}){const{circular:e=!1,createInternalComparator:r,createState:n,strict:i=!1}=t,a=Zee(t),s=Kee(a),o=r?r(s):Yee(s);return Xee({circular:e,comparator:s,createState:n,equals:o,strict:i})}var yS={exports:{}},xS={};var MP;function Jee(){if(MP)return xS;MP=1;var t=am(),e=CR();function r(u,c){return u===c&&(u!==0||1/u===1/c)||u!==u&&c!==c}var n=typeof Object.is=="function"?Object.is:r,i=e.useSyncExternalStore,a=t.useRef,s=t.useEffect,o=t.useMemo,l=t.useDebugValue;return xS.useSyncExternalStoreWithSelector=function(u,c,f,p,g){var y=a(null);if(y.current===null){var S={hasValue:!1,value:null};y.current=S}else S=y.current;y=o(function(){function C(D){if(!_){if(_=!0,T=D,D=p(D),g!==void 0&&S.hasValue){var j=S.value;if(g(j,D))return N=j}return N=D}if(j=N,n(T,D))return j;var O=p(D);return g!==void 0&&g(j,O)?(T=D,j):(T=D,N=O)}var _=!1,T,N,R=f===void 0?null:f;return[function(){return C(c())},R===null?void 0:function(){return C(R())}]},[c,f,p,g]);var w=i(u,y[0],y[1]);return s(function(){S.hasValue=!0,S.value=w},[w]),l(w),w},xS}var AP;function ete(){return AP||(AP=1,yS.exports=Jee()),yS.exports}var tte=ete(),rte=(...t)=>e=>{t.forEach(r=>{typeof r=="function"?r(e):r&&(r.current=e)})},nte=({contentComponent:t})=>{const e=ER.useSyncExternalStore(t.subscribe,t.getSnapshot,t.getServerSnapshot);return m.jsx(m.Fragment,{children:Object.values(e)})};function ite(){const t=new Set;let e={};return{subscribe(r){return t.add(r),()=>{t.delete(r)}},getSnapshot(){return e},getServerSnapshot(){return e},setRenderer(r,n){e={...e,[r]:a8.createPortal(n.reactElement,n.element,r)},t.forEach(i=>i())},removeRenderer(r){const n={...e};delete n[r],e=n,t.forEach(i=>i())}}}var ate=class extends Qt.Component{constructor(t){var e;super(t),this.editorContentRef=Qt.createRef(),this.initialized=!1,this.state={hasContentComponentInitialized:!!((e=t.editor)!=null&&e.contentComponent)}}componentDidMount(){this.init()}componentDidUpdate(){this.init()}init(){var t;const e=this.props.editor;if(e&&!e.isDestroyed&&((t=e.view.dom)!=null&&t.parentNode)){if(e.contentComponent)return;const r=this.editorContentRef.current;r.append(...e.view.dom.parentNode.childNodes),e.setOptions({element:r}),e.contentComponent=ite(),this.state.hasContentComponentInitialized||(this.unsubscribeToContentComponent=e.contentComponent.subscribe(()=>{this.setState(n=>n.hasContentComponentInitialized?n:{hasContentComponentInitialized:!0}),this.unsubscribeToContentComponent&&this.unsubscribeToContentComponent()})),e.createNodeViews(),this.initialized=!0}}componentWillUnmount(){var t;const e=this.props.editor;if(e){this.initialized=!1,e.isDestroyed||e.view.setProps({nodeViews:{}}),this.unsubscribeToContentComponent&&this.unsubscribeToContentComponent(),e.contentComponent=null;try{if(!((t=e.view.dom)!=null&&t.parentNode))return;const r=document.createElement("div");r.append(...e.view.dom.parentNode.childNodes),e.setOptions({element:r})}catch{}}}render(){const{editor:t,innerRef:e,...r}=this.props;return m.jsxs(m.Fragment,{children:[m.jsx("div",{ref:rte(e,this.editorContentRef),...r}),t?.contentComponent&&m.jsx(nte,{contentComponent:t.contentComponent})]})}},ste=ne.forwardRef((t,e)=>{const r=Qt.useMemo(()=>Math.floor(Math.random()*4294967295).toString(),[t.editor]);return Qt.createElement(ate,{key:r,innerRef:e,...t})}),ote=Qt.memo(ste),lte=typeof window<"u"?ne.useLayoutEffect:ne.useEffect,ute=class{constructor(t){this.transactionNumber=0,this.lastTransactionNumber=0,this.subscribers=new Set,this.editor=t,this.lastSnapshot={editor:t,transactionNumber:0},this.getSnapshot=this.getSnapshot.bind(this),this.getServerSnapshot=this.getServerSnapshot.bind(this),this.watch=this.watch.bind(this),this.subscribe=this.subscribe.bind(this)}getSnapshot(){return this.transactionNumber===this.lastTransactionNumber?this.lastSnapshot:(this.lastTransactionNumber=this.transactionNumber,this.lastSnapshot={editor:this.editor,transactionNumber:this.transactionNumber},this.lastSnapshot)}getServerSnapshot(){return{editor:null,transactionNumber:0}}subscribe(t){return this.subscribers.add(t),()=>{this.subscribers.delete(t)}}watch(t){if(this.editor=t,this.editor){const e=()=>{this.transactionNumber+=1,this.subscribers.forEach(n=>n())},r=this.editor;return r.on("transaction",e),()=>{r.off("transaction",e)}}}};function cte(t){var e;const[r]=ne.useState(()=>new ute(t.editor)),n=tte.useSyncExternalStoreWithSelector(r.subscribe,r.getSnapshot,r.getServerSnapshot,t.selector,(e=t.equalityFn)!=null?e:Qee);return lte(()=>r.watch(t.editor),[t.editor,r]),ne.useDebugValue(n),n}var dte=!1,Dk=typeof window>"u",fte=Dk||!!(typeof window<"u"&&window.next),hte=class I6{constructor(e){this.editor=null,this.subscriptions=new Set,this.isComponentMounted=!1,this.previousDeps=null,this.instanceId="",this.options=e,this.subscriptions=new Set,this.setEditor(this.getInitialEditor()),this.scheduleDestroy(),this.getEditor=this.getEditor.bind(this),this.getServerSnapshot=this.getServerSnapshot.bind(this),this.subscribe=this.subscribe.bind(this),this.refreshEditorInstance=this.refreshEditorInstance.bind(this),this.scheduleDestroy=this.scheduleDestroy.bind(this),this.onRender=this.onRender.bind(this),this.createEditor=this.createEditor.bind(this)}setEditor(e){this.editor=e,this.instanceId=Math.random().toString(36).slice(2,9),this.subscriptions.forEach(r=>r())}getInitialEditor(){return this.options.current.immediatelyRender===void 0?Dk||fte?null:this.createEditor():(this.options.current.immediatelyRender,this.options.current.immediatelyRender?this.createEditor():null)}createEditor(){const e={...this.options.current,onBeforeCreate:(...n)=>{var i,a;return(a=(i=this.options.current).onBeforeCreate)==null?void 0:a.call(i,...n)},onBlur:(...n)=>{var i,a;return(a=(i=this.options.current).onBlur)==null?void 0:a.call(i,...n)},onCreate:(...n)=>{var i,a;return(a=(i=this.options.current).onCreate)==null?void 0:a.call(i,...n)},onDestroy:(...n)=>{var i,a;return(a=(i=this.options.current).onDestroy)==null?void 0:a.call(i,...n)},onFocus:(...n)=>{var i,a;return(a=(i=this.options.current).onFocus)==null?void 0:a.call(i,...n)},onSelectionUpdate:(...n)=>{var i,a;return(a=(i=this.options.current).onSelectionUpdate)==null?void 0:a.call(i,...n)},onTransaction:(...n)=>{var i,a;return(a=(i=this.options.current).onTransaction)==null?void 0:a.call(i,...n)},onUpdate:(...n)=>{var i,a;return(a=(i=this.options.current).onUpdate)==null?void 0:a.call(i,...n)},onContentError:(...n)=>{var i,a;return(a=(i=this.options.current).onContentError)==null?void 0:a.call(i,...n)},onDrop:(...n)=>{var i,a;return(a=(i=this.options.current).onDrop)==null?void 0:a.call(i,...n)},onPaste:(...n)=>{var i,a;return(a=(i=this.options.current).onPaste)==null?void 0:a.call(i,...n)},onDelete:(...n)=>{var i,a;return(a=(i=this.options.current).onDelete)==null?void 0:a.call(i,...n)}};return new iee(e)}getEditor(){return this.editor}getServerSnapshot(){return null}subscribe(e){return this.subscriptions.add(e),()=>{this.subscriptions.delete(e)}}static compareOptions(e,r){return Object.keys(e).every(n=>["onCreate","onBeforeCreate","onDestroy","onUpdate","onTransaction","onFocus","onBlur","onSelectionUpdate","onContentError","onDrop","onPaste"].includes(n)?!0:n==="extensions"&&e.extensions&&r.extensions?e.extensions.length!==r.extensions.length?!1:e.extensions.every((i,a)=>{var s;return i===((s=r.extensions)==null?void 0:s[a])}):e[n]===r[n])}onRender(e){return()=>(this.isComponentMounted=!0,clearTimeout(this.scheduledDestructionTimeout),this.editor&&!this.editor.isDestroyed&&e.length===0?I6.compareOptions(this.options.current,this.editor.options)||this.editor.setOptions({...this.options.current,editable:this.editor.isEditable}):this.refreshEditorInstance(e),()=>{this.isComponentMounted=!1,this.scheduleDestroy()})}refreshEditorInstance(e){if(this.editor&&!this.editor.isDestroyed){if(this.previousDeps===null){this.previousDeps=e;return}if(this.previousDeps.length===e.length&&this.previousDeps.every((n,i)=>n===e[i]))return}this.editor&&!this.editor.isDestroyed&&this.editor.destroy(),this.setEditor(this.createEditor()),this.previousDeps=e}scheduleDestroy(){const e=this.instanceId,r=this.editor;this.scheduledDestructionTimeout=setTimeout(()=>{if(this.isComponentMounted&&this.instanceId===e){r&&r.setOptions(this.options.current);return}r&&!r.isDestroyed&&(r.destroy(),this.instanceId===e&&this.setEditor(null))},1)}};function pte(t={},e=[]){const r=ne.useRef(t);r.current=t;const[n]=ne.useState(()=>new hte(r)),i=ER.useSyncExternalStore(n.subscribe,n.getEditor,n.getServerSnapshot);return ne.useDebugValue(i),ne.useEffect(n.onRender(e)),cte({editor:i,selector:({transactionNumber:a})=>t.shouldRerenderOnTransaction===!1||t.shouldRerenderOnTransaction===void 0?null:t.immediatelyRender&&a===0?0:a+1}),i}var mte=ne.createContext({editor:null});mte.Consumer;var gte=ne.createContext({onDragStart:()=>{},nodeViewContentChildren:void 0,nodeViewContentRef:()=>{}}),vte=()=>ne.useContext(gte);Qt.forwardRef((t,e)=>{const{onDragStart:r}=vte(),n=t.as||"div";return m.jsx(n,{...t,ref:e,"data-node-view-wrapper":"",onDragStart:r,style:{whiteSpace:"normal",...t.style}})});function LP(t){return!!(typeof t=="function"&&t.prototype&&t.prototype.isReactComponent)}function RP(t){return!!(typeof t=="object"&&t.$$typeof&&(t.$$typeof.toString()==="Symbol(react.forward_ref)"||t.$$typeof.description==="react.forward_ref"))}function yte(t){return!!(typeof t=="object"&&t.$$typeof&&(t.$$typeof.toString()==="Symbol(react.memo)"||t.$$typeof.description==="react.memo"))}function xte(t){if(LP(t)||RP(t))return!0;if(yte(t)){const e=t.type;if(e)return LP(e)||RP(e)}return!1}function bte(){try{if(ne.version)return parseInt(ne.version.split(".")[0],10)>=19}catch{}return!1}var wte=class{constructor(t,{editor:e,props:r={},as:n="div",className:i=""}){this.ref=null,this.destroyed=!1,this.id=Math.floor(Math.random()*4294967295).toString(),this.component=t,this.editor=e,this.props=r,this.element=document.createElement(n),this.element.classList.add("react-renderer"),i&&this.element.classList.add(...i.split(" ")),this.editor.isInitialized?eo.flushSync(()=>{this.render()}):queueMicrotask(()=>{this.destroyed||this.render()})}render(){var t;if(this.destroyed)return;const e=this.component,r=this.props,n=this.editor,i=bte(),a=xte(e),s={...r};s.ref&&!(i||a)&&delete s.ref,!s.ref&&(i||a)&&(s.ref=o=>{this.ref=o}),this.reactElement=m.jsx(e,{...s}),(t=n?.contentComponent)==null||t.setRenderer(this.id,this)}updateProps(t={}){this.destroyed||(this.props={...this.props,...t},this.render())}destroy(){var t;this.destroyed=!0;const e=this.editor;(t=e?.contentComponent)==null||t.removeRenderer(this.id);try{this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element)}catch{}}updateAttributes(t){Object.keys(t).forEach(e=>{this.element.setAttribute(e,t[e])})}};Qt.createContext({markViewContentRef:()=>{}});var Wx=(t,e)=>{if(t==="slot")return 0;if(t instanceof Function)return t(e);const{children:r,...n}=e??{};if(t==="svg")throw new Error("SVG elements are not supported in the JSX syntax, use the array syntax instead");return[t,n,r]},Ste=/^\s*>\s$/,kte=to.create({name:"blockquote",addOptions(){return{HTMLAttributes:{}}},content:"block+",group:"block",defining:!0,parseHTML(){return[{tag:"blockquote"}]},renderHTML({HTMLAttributes:t}){return Wx("blockquote",{...Yn(this.options.HTMLAttributes,t),children:Wx("slot",{})})},parseMarkdown:(t,e)=>e.createNode("blockquote",void 0,e.parseChildren(t.tokens||[])),renderMarkdown:(t,e)=>{if(!t.content)return"";const r=">",n=[];return t.content.forEach(i=>{const o=e.renderChildren([i]).split(`
`).map(l=>l.trim()===""?r:`${r} ${l}`);n.push(o.join(`
`))}),n.join(`
${r}
`)},addCommands(){return{setBlockquote:()=>({commands:t})=>t.wrapIn(this.name),toggleBlockquote:()=>({commands:t})=>t.toggleWrap(this.name),unsetBlockquote:()=>({commands:t})=>t.lift(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[em({find:Ste,type:this.type})]}}),_te=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))$/,Cte=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))/g,Ete=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))$/,Tte=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))/g,Nte=Ah.create({name:"bold",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"strong"},{tag:"b",getAttrs:t=>t.style.fontWeight!=="normal"&&null},{style:"font-weight=400",clearMark:t=>t.type.name===this.name},{style:"font-weight",getAttrs:t=>/^(bold(er)?|[5-9]\d{2,})$/.test(t)&&null}]},renderHTML({HTMLAttributes:t}){return Wx("strong",{...Yn(this.options.HTMLAttributes,t),children:Wx("slot",{})})},markdownTokenName:"strong",parseMarkdown:(t,e)=>e.applyMark("bold",e.parseInline(t.tokens||[])),renderMarkdown:(t,e)=>`**${e.renderChildren(t)}**`,addCommands(){return{setBold:()=>({commands:t})=>t.setMark(this.name),toggleBold:()=>({commands:t})=>t.toggleMark(this.name),unsetBold:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold(),"Mod-B":()=>this.editor.commands.toggleBold()}},addInputRules(){return[Jp({find:_te,type:this.type}),Jp({find:Ete,type:this.type})]},addPasteRules(){return[Ch({find:Cte,type:this.type}),Ch({find:Tte,type:this.type})]}}),Pte=/(^|[^`])`([^`]+)`(?!`)$/,Mte=/(^|[^`])`([^`]+)`(?!`)/g,Ate=Ah.create({name:"code",addOptions(){return{HTMLAttributes:{}}},excludes:"_",code:!0,exitable:!0,parseHTML(){return[{tag:"code"}]},renderHTML({HTMLAttributes:t}){return["code",Yn(this.options.HTMLAttributes,t),0]},markdownTokenName:"codespan",parseMarkdown:(t,e)=>e.applyMark("code",[{type:"text",text:t.text||""}]),renderMarkdown:(t,e)=>t.content?`\`${e.renderChildren(t.content)}\``:"",addCommands(){return{setCode:()=>({commands:t})=>t.setMark(this.name),toggleCode:()=>({commands:t})=>t.toggleMark(this.name),unsetCode:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[Jp({find:Pte,type:this.type})]},addPasteRules(){return[Ch({find:Mte,type:this.type})]}}),bS=4,Lte=/^```([a-z]+)?[\s\n]$/,Rte=/^~~~([a-z]+)?[\s\n]$/,Ote=to.create({name:"codeBlock",addOptions(){return{languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,defaultLanguage:null,enableTabIndentation:!1,tabSize:bS,HTMLAttributes:{}}},content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes(){return{language:{default:this.options.defaultLanguage,parseHTML:t=>{var e;const{languageClassPrefix:r}=this.options;if(!r)return null;const a=[...((e=t.firstElementChild)==null?void 0:e.classList)||[]].filter(s=>s.startsWith(r)).map(s=>s.replace(r,""))[0];return a||null},rendered:!1}}},parseHTML(){return[{tag:"pre",preserveWhitespace:"full"}]},renderHTML({node:t,HTMLAttributes:e}){return["pre",Yn(this.options.HTMLAttributes,e),["code",{class:t.attrs.language?this.options.languageClassPrefix+t.attrs.language:null},0]]},markdownTokenName:"code",parseMarkdown:(t,e)=>{var r;return((r=t.raw)==null?void 0:r.startsWith("```"))===!1&&t.codeBlockStyle!=="indented"?[]:e.createNode("codeBlock",{language:t.lang||null},t.text?[e.createTextNode(t.text)]:[])},renderMarkdown:(t,e)=>{var r;let n="";const i=((r=t.attrs)==null?void 0:r.language)||"";return t.content?n=[`\`\`\`${i}`,e.renderChildren(t.content),"```"].join(`
`):n=`\`\`\`${i}

\`\`\``,n},addCommands(){return{setCodeBlock:t=>({commands:e})=>e.setNode(this.name,t),toggleCodeBlock:t=>({commands:e})=>e.toggleNode(this.name,"paragraph",t)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{const{empty:t,$anchor:e}=this.editor.state.selection,r=e.pos===1;return!t||e.parent.type.name!==this.name?!1:r||!e.parent.textContent.length?this.editor.commands.clearNodes():!1},Tab:({editor:t})=>{var e;if(!this.options.enableTabIndentation)return!1;const r=(e=this.options.tabSize)!=null?e:bS,{state:n}=t,{selection:i}=n,{$from:a,empty:s}=i;if(a.parent.type!==this.type)return!1;const o=" ".repeat(r);return s?t.commands.insertContent(o):t.commands.command(({tr:l})=>{const{from:u,to:c}=i,g=n.doc.textBetween(u,c,`
`,`
`).split(`
`).map(y=>o+y).join(`
`);return l.replaceWith(u,c,n.schema.text(g)),!0})},"Shift-Tab":({editor:t})=>{var e;if(!this.options.enableTabIndentation)return!1;const r=(e=this.options.tabSize)!=null?e:bS,{state:n}=t,{selection:i}=n,{$from:a,empty:s}=i;return a.parent.type!==this.type?!1:s?t.commands.command(({tr:o})=>{var l;const{pos:u}=a,c=a.start(),f=a.end(),g=n.doc.textBetween(c,f,`
`,`
`).split(`
`);let y=0,S=0;const w=u-c;for(let D=0;D<g.length;D+=1){if(S+g[D].length>=w){y=D;break}S+=g[D].length+1}const _=((l=g[y].match(/^ */))==null?void 0:l[0])||"",T=Math.min(_.length,r);if(T===0)return!0;let N=c;for(let D=0;D<y;D+=1)N+=g[D].length+1;return o.delete(N,N+T),u-N<=T&&o.setSelection(fr.create(o.doc,N)),!0}):t.commands.command(({tr:o})=>{const{from:l,to:u}=i,p=n.doc.textBetween(l,u,`
`,`
`).split(`
`).map(g=>{var y;const S=((y=g.match(/^ */))==null?void 0:y[0])||"",w=Math.min(S.length,r);return g.slice(w)}).join(`
`);return o.replaceWith(l,u,n.schema.text(p)),!0})},Enter:({editor:t})=>{if(!this.options.exitOnTripleEnter)return!1;const{state:e}=t,{selection:r}=e,{$from:n,empty:i}=r;if(!i||n.parent.type!==this.type)return!1;const a=n.parentOffset===n.parent.nodeSize-2,s=n.parent.textContent.endsWith(`

`);return!a||!s?!1:t.chain().command(({tr:o})=>(o.delete(n.pos-2,n.pos),!0)).exitCode().run()},ArrowDown:({editor:t})=>{if(!this.options.exitOnArrowDown)return!1;const{state:e}=t,{selection:r,doc:n}=e,{$from:i,empty:a}=r;if(!a||i.parent.type!==this.type||!(i.parentOffset===i.parent.nodeSize-2))return!1;const o=i.after();return o===void 0?!1:n.nodeAt(o)?t.commands.command(({tr:u})=>(u.setSelection(_r.near(n.resolve(o))),!0)):t.commands.exitCode()}}},addInputRules(){return[Rk({find:Lte,type:this.type,getAttributes:t=>({language:t[1]})}),Rk({find:Rte,type:this.type,getAttributes:t=>({language:t[1]})})]},addProseMirrorPlugins(){return[new Xn({key:new Ti("codeBlockVSCodeHandler"),props:{handlePaste:(t,e)=>{if(!e.clipboardData||this.editor.isActive(this.type.name))return!1;const r=e.clipboardData.getData("text/plain"),n=e.clipboardData.getData("vscode-editor-data"),i=n?JSON.parse(n):void 0,a=i?.mode;if(!r||!a)return!1;const{tr:s,schema:o}=t.state,l=o.text(r.replace(/\r\n?/g,`
`));return s.replaceSelectionWith(this.type.create({language:a},l)),s.selection.$from.parent.type!==this.type&&s.setSelection(fr.near(s.doc.resolve(Math.max(0,s.selection.from-2)))),s.setMeta("paste",!0),t.dispatch(s),!0}}})]}}),Dte=to.create({name:"doc",topNode:!0,content:"block+",renderMarkdown:(t,e)=>t.content?e.renderChildren(t.content,`

`):""}),Ite=to.create({name:"hardBreak",markdownTokenName:"br",addOptions(){return{keepMarks:!0,HTMLAttributes:{}}},inline:!0,group:"inline",selectable:!1,linebreakReplacement:!0,parseHTML(){return[{tag:"br"}]},renderHTML({HTMLAttributes:t}){return["br",Yn(this.options.HTMLAttributes,t)]},renderText(){return`
`},renderMarkdown:()=>`  
`,parseMarkdown:()=>({type:"hardBreak"}),addCommands(){return{setHardBreak:()=>({commands:t,chain:e,state:r,editor:n})=>t.first([()=>t.exitCode(),()=>t.command(()=>{const{selection:i,storedMarks:a}=r;if(i.$from.parent.type.spec.isolating)return!1;const{keepMarks:s}=this.options,{splittableMarks:o}=n.extensionManager,l=a||i.$to.parentOffset&&i.$from.marks();return e().insertContent({type:this.name}).command(({tr:u,dispatch:c})=>{if(c&&l&&s){const f=l.filter(p=>o.includes(p.type.name));u.ensureMarks(f)}return!0}).run()})])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}}),jte=to.create({name:"heading",addOptions(){return{levels:[1,2,3,4,5,6],HTMLAttributes:{}}},content:"inline*",group:"block",defining:!0,addAttributes(){return{level:{default:1,rendered:!1}}},parseHTML(){return this.options.levels.map(t=>({tag:`h${t}`,attrs:{level:t}}))},renderHTML({node:t,HTMLAttributes:e}){return[`h${this.options.levels.includes(t.attrs.level)?t.attrs.level:this.options.levels[0]}`,Yn(this.options.HTMLAttributes,e),0]},parseMarkdown:(t,e)=>e.createNode("heading",{level:t.depth||1},e.parseInline(t.tokens||[])),renderMarkdown:(t,e)=>{var r;const n=(r=t.attrs)!=null&&r.level?parseInt(t.attrs.level,10):1,i="#".repeat(n);return t.content?`${i} ${e.renderChildren(t.content)}`:""},addCommands(){return{setHeading:t=>({commands:e})=>this.options.levels.includes(t.level)?e.setNode(this.name,t):!1,toggleHeading:t=>({commands:e})=>this.options.levels.includes(t.level)?e.toggleNode(this.name,"paragraph",t):!1}},addKeyboardShortcuts(){return this.options.levels.reduce((t,e)=>({...t,[`Mod-Alt-${e}`]:()=>this.editor.commands.toggleHeading({level:e})}),{})},addInputRules(){return this.options.levels.map(t=>Rk({find:new RegExp(`^(#{${Math.min(...this.options.levels)},${t}})\\s$`),type:this.type,getAttributes:{level:t}}))}}),Fte=to.create({name:"horizontalRule",addOptions(){return{HTMLAttributes:{},nextNodeType:"paragraph"}},group:"block",parseHTML(){return[{tag:"hr"}]},renderHTML({HTMLAttributes:t}){return["hr",Yn(this.options.HTMLAttributes,t)]},markdownTokenName:"hr",parseMarkdown:(t,e)=>e.createNode("horizontalRule"),renderMarkdown:()=>"---",addCommands(){return{setHorizontalRule:()=>({chain:t,state:e})=>{if(!see(e,e.schema.nodes[this.name]))return!1;const{selection:r}=e,{$to:n}=r,i=t();return g6(r)?i.insertContentAt(n.pos,{type:this.name}):i.insertContent({type:this.name}),i.command(({state:a,tr:s,dispatch:o})=>{if(o){const{$to:l}=s.selection,u=l.end();if(l.nodeAfter)l.nodeAfter.isTextblock?s.setSelection(fr.create(s.doc,l.pos+1)):l.nodeAfter.isBlock?s.setSelection(Jt.create(s.doc,l.pos)):s.setSelection(fr.create(s.doc,l.pos));else{const c=a.schema.nodes[this.options.nextNodeType]||l.parent.type.contentMatch.defaultType,f=c?.create();f&&(s.insert(u,f),s.setSelection(fr.create(s.doc,u+1)))}s.scrollIntoView()}return!0}).run()}}},addInputRules(){return[aee({find:/^(?:---|-|___\s|\*\*\*\s)$/,type:this.type})]}}),Bte=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))$/,zte=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))/g,Ute=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))$/,Gte=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))/g,Vte=Ah.create({name:"italic",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"em"},{tag:"i",getAttrs:t=>t.style.fontStyle!=="normal"&&null},{style:"font-style=normal",clearMark:t=>t.type.name===this.name},{style:"font-style=italic"}]},renderHTML({HTMLAttributes:t}){return["em",Yn(this.options.HTMLAttributes,t),0]},addCommands(){return{setItalic:()=>({commands:t})=>t.setMark(this.name),toggleItalic:()=>({commands:t})=>t.toggleMark(this.name),unsetItalic:()=>({commands:t})=>t.unsetMark(this.name)}},markdownTokenName:"em",parseMarkdown:(t,e)=>e.applyMark("italic",e.parseInline(t.tokens||[])),renderMarkdown:(t,e)=>`*${e.renderChildren(t)}*`,addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic(),"Mod-I":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[Jp({find:Bte,type:this.type}),Jp({find:Ute,type:this.type})]},addPasteRules(){return[Ch({find:zte,type:this.type}),Ch({find:Gte,type:this.type})]}});const Hte="aaa1rp3bb0ott3vie4c1le2ogado5udhabi7c0ademy5centure6ountant0s9o1tor4d0s1ult4e0g1ro2tna4f0l1rica5g0akhan5ency5i0g1rbus3force5tel5kdn3l0ibaba4pay4lfinanz6state5y2sace3tom5m0azon4ericanexpress7family11x2fam3ica3sterdam8nalytics7droid5quan4z2o0l2partments8p0le4q0uarelle8r0ab1mco4chi3my2pa2t0e3s0da2ia2sociates9t0hleta5torney7u0ction5di0ble3o3spost5thor3o0s4w0s2x0a2z0ure5ba0by2idu3namex4d1k2r0celona5laycard4s5efoot5gains6seball5ketball8uhaus5yern5b0c1t1va3cg1n2d1e0ats2uty4er2rlin4st0buy5t2f1g1h0arti5i0ble3d1ke2ng0o3o1z2j1lack0friday9ockbuster8g1omberg7ue3m0s1w2n0pparibas9o0ats3ehringer8fa2m1nd2o0k0ing5sch2tik2on4t1utique6x2r0adesco6idgestone9oadway5ker3ther5ussels7s1t1uild0ers6siness6y1zz3v1w1y1z0h3ca0b1fe2l0l1vinklein9m0era3p2non3petown5ital0one8r0avan4ds2e0er0s4s2sa1e1h1ino4t0ering5holic7ba1n1re3c1d1enter4o1rn3f0a1d2g1h0anel2nel4rity4se2t2eap3intai5ristmas6ome4urch5i0priani6rcle4sco3tadel4i0c2y3k1l0aims4eaning6ick2nic1que6othing5ud3ub0med6m1n1o0ach3des3ffee4llege4ogne5m0mbank4unity6pany2re3uter5sec4ndos3struction8ulting7tact3ractors9oking4l1p2rsica5untry4pon0s4rses6pa2r0edit0card4union9icket5own3s1uise0s6u0isinella9v1w1x1y0mru3ou3z2dad1nce3ta1e1ing3sun4y2clk3ds2e0al0er2s3gree4livery5l1oitte5ta3mocrat6ntal2ist5si0gn4v2hl2iamonds6et2gital5rect0ory7scount3ver5h2y2j1k1m1np2o0cs1tor4g1mains5t1wnload7rive4tv2ubai3nlop4pont4rban5vag2r2z2earth3t2c0o2deka3u0cation8e1g1mail3erck5nergy4gineer0ing9terprises10pson4quipment8r0icsson6ni3s0q1tate5t1u0rovision8s2vents5xchange6pert3osed4ress5traspace10fage2il1rwinds6th3mily4n0s2rm0ers5shion4t3edex3edback6rrari3ero6i0delity5o2lm2nal1nce1ial7re0stone6mdale6sh0ing5t0ness6j1k1lickr3ghts4r2orist4wers5y2m1o0o0d1tball6rd1ex2sale4um3undation8x2r0ee1senius7l1ogans4ntier7tr2ujitsu5n0d2rniture7tbol5yi3ga0l0lery3o1up4me0s3p1rden4y2b0iz3d0n2e0a1nt0ing5orge5f1g0ee3h1i0ft0s3ves2ing5l0ass3e1obal2o4m0ail3bh2o1x2n1odaddy5ld0point6f2o0dyear5g0le4p1t1v2p1q1r0ainger5phics5tis4een3ipe3ocery4up4s1t1u0cci3ge2ide2tars5ru3w1y2hair2mburg5ngout5us3bo2dfc0bank7ealth0care8lp1sinki6re1mes5iphop4samitsu7tachi5v2k0t2m1n1ockey4ldings5iday5medepot5goods5s0ense7nda3rse3spital5t0ing5t0els3mail5use3w2r1sbc3t1u0ghes5yatt3undai7ibm2cbc2e1u2d1e0ee3fm2kano4l1m0amat4db2mo0bilien9n0c1dustries8finiti5o2g1k1stitute6urance4e4t0ernational10uit4vestments10o1piranga7q1r0ish4s0maili5t0anbul7t0au2v3jaguar4va3cb2e0ep2tzt3welry6io2ll2m0p2nj2o0bs1urg4t1y2p0morgan6rs3uegos4niper7kaufen5ddi3e0rryhotels6properties14fh2g1h1i0a1ds2m1ndle4tchen5wi3m1n1oeln3matsu5sher5p0mg2n2r0d1ed3uokgroup8w1y0oto4z2la0caixa5mborghini8er3nd0rover6xess5salle5t0ino3robe5w0yer5b1c1ds2ease3clerc5frak4gal2o2xus4gbt3i0dl2fe0insurance9style7ghting6ke2lly3mited4o2ncoln4k2ve1ing5k1lc1p2oan0s3cker3us3l1ndon4tte1o3ve3pl0financial11r1s1t0d0a3u0ndbeck6xe1ury5v1y2ma0drid4if1son4keup4n0agement7go3p1rket0ing3s4riott5shalls7ttel5ba2c0kinsey7d1e0d0ia3et2lbourne7me1orial6n0u2rckmsd7g1h1iami3crosoft7l1ni1t2t0subishi9k1l0b1s2m0a2n1o0bi0le4da2e1i1m1nash3ey2ster5rmon3tgage6scow4to0rcycles9v0ie4p1q1r1s0d2t0n1r2u0seum3ic4v1w1x1y1z2na0b1goya4me2vy3ba2c1e0c1t0bank4flix4work5ustar5w0s2xt0direct7us4f0l2g0o2hk2i0co2ke1on3nja3ssan1y5l1o0kia3rton4w0ruz3tv4p1r0a1w2tt2u1yc2z2obi1server7ffice5kinawa6layan0group9lo3m0ega4ne1g1l0ine5oo2pen3racle3nge4g0anic5igins6saka4tsuka4t2vh3pa0ge2nasonic7ris2s1tners4s1y3y2ccw3e0t2f0izer5g1h0armacy6d1ilips5one2to0graphy6s4ysio5ics1tet2ures6d1n0g1k2oneer5zza4k1l0ace2y0station9umbing5s3m1n0c2ohl2ker3litie5rn2st3r0axi3ess3ime3o0d0uctions8f1gressive8mo2perties3y5tection8u0dential9s1t1ub2w0c2y2qa1pon3uebec3st5racing4dio4e0ad1lestate6tor2y4cipes5d0stone5umbrella9hab3ise0n3t2liance6n0t0als5pair3ort3ublican8st0aurant8view0s5xroth6ich0ardli6oh3l1o1p2o0cks3deo3gers4om3s0vp3u0gby3hr2n2w0e2yukyu6sa0arland6fe0ty4kura4le1on3msclub4ung5ndvik0coromant12ofi4p1rl2s1ve2xo3b0i1s2c0b1haeffler7midt4olarships8ol3ule3warz5ience5ot3d1e0arch3t2cure1ity6ek2lect4ner3rvices6ven3w1x0y3fr2g1h0angrila6rp3ell3ia1ksha5oes2p0ping5uji3w3i0lk2na1gles5te3j1k0i0n2y0pe4l0ing4m0art3ile4n0cf3o0ccer3ial4ftbank4ware6hu2lar2utions7ng1y2y2pa0ce3ort2t3r0l2s1t0ada2ples4r1tebank4farm7c0group6ockholm6rage3e3ream4udio2y3yle4u0cks3pplies3y2ort5rf1gery5zuki5v1watch4iss4x1y0dney4stems6z2tab1ipei4lk2obao4rget4tamotors6r2too4x0i3c0i2d0k2eam2ch0nology8l1masek5nnis4va3f1g1h0d1eater2re6iaa2ckets5enda4ps2res2ol4j0maxx4x2k0maxx5l1m0all4n1o0day3kyo3ols3p1ray3shiba5tal3urs3wn2yota3s3r0ade1ing4ining5vel0ers0insurance16ust3v2t1ube2i1nes3shu4v0s2w1z2ua1bank3s2g1k1nicom3versity8o2ol2ps2s1y1z2va0cations7na1guard7c1e0gas3ntures6risign5mgensberater2ung14sicherung10t2g1i0ajes4deo3g1king4llas4n1p1rgin4sa1ion4va1o3laanderen9n1odka3lvo3te1ing3o2yage5u2wales2mart4ter4ng0gou5tch0es6eather0channel12bcam3er2site5d0ding5ibo2r3f1hoswho6ien2ki2lliamhill9n0dows4e1ners6me2olterskluwer11odside6rk0s2ld3w2s1tc1f3xbox3erox4ihuan4n2xx2yz3yachts4hoo3maxun5ndex5e1odobashi7ga2kohama6u0tube6t1un3za0ppos4ra3ero3ip2m1one3uerich6w2",Wte="121342632165322333335355455655552435435422463632574574330355524444661154543332344423364211133222221212112052232222232212222223222241112222224322321222",Ik="numeric",jk="ascii",Fk="alpha",cv="asciinumeric",ev="alphanumeric",Bk="domain",j6="emoji",qte="scheme",$te="slashscheme",wS="whitespace";function Kte(t,e){return t in e||(e[t]=[]),e[t]}function sh(t,e,r){e[Ik]&&(e[cv]=!0,e[ev]=!0),e[jk]&&(e[cv]=!0,e[Fk]=!0),e[cv]&&(e[ev]=!0),e[Fk]&&(e[ev]=!0),e[ev]&&(e[Bk]=!0),e[j6]&&(e[Bk]=!0);for(const n in e){const i=Kte(n,r);i.indexOf(t)<0&&i.push(t)}}function Zte(t,e){const r={};for(const n in e)e[n].indexOf(t)>=0&&(r[n]=!0);return r}function Zs(t=null){this.j={},this.jr=[],this.jd=null,this.t=t}Zs.groups={};Zs.prototype={accepts(){return!!this.t},go(t){const e=this,r=e.j[t];if(r)return r;for(let n=0;n<e.jr.length;n++){const i=e.jr[n][0],a=e.jr[n][1];if(a&&i.test(t))return a}return e.jd},has(t,e=!1){return e?t in this.j:!!this.go(t)},ta(t,e,r,n){for(let i=0;i<t.length;i++)this.tt(t[i],e,r,n)},tr(t,e,r,n){n=n||Zs.groups;let i;return e&&e.j?i=e:(i=new Zs(e),r&&n&&sh(e,r,n)),this.jr.push([t,i]),i},ts(t,e,r,n){let i=this;const a=t.length;if(!a)return i;for(let s=0;s<a-1;s++)i=i.tt(t[s]);return i.tt(t[a-1],e,r,n)},tt(t,e,r,n){n=n||Zs.groups;const i=this;if(e&&e.j)return i.j[t]=e,e;const a=e;let s,o=i.go(t);if(o?(s=new Zs,Object.assign(s.j,o.j),s.jr.push.apply(s.jr,o.jr),s.jd=o.jd,s.t=o.t):s=new Zs,a){if(n)if(s.t&&typeof s.t=="string"){const l=Object.assign(Zte(s.t,n),r);sh(a,l,n)}else r&&sh(a,r,n);s.t=a}return i.j[t]=s,s}};const kr=(t,e,r,n,i)=>t.ta(e,r,n,i),ci=(t,e,r,n,i)=>t.tr(e,r,n,i),OP=(t,e,r,n,i)=>t.ts(e,r,n,i),mt=(t,e,r,n,i)=>t.tt(e,r,n,i),uc="WORD",zk="UWORD",F6="ASCIINUMERICAL",B6="ALPHANUMERICAL",Hv="LOCALHOST",Uk="TLD",Gk="UTLD",tx="SCHEME",Pp="SLASH_SCHEME",yC="NUM",Vk="WS",xC="NL",dv="OPENBRACE",fv="CLOSEBRACE",qx="OPENBRACKET",$x="CLOSEBRACKET",Kx="OPENPAREN",Zx="CLOSEPAREN",Yx="OPENANGLEBRACKET",Xx="CLOSEANGLEBRACKET",Qx="FULLWIDTHLEFTPAREN",Jx="FULLWIDTHRIGHTPAREN",e1="LEFTCORNERBRACKET",t1="RIGHTCORNERBRACKET",r1="LEFTWHITECORNERBRACKET",n1="RIGHTWHITECORNERBRACKET",i1="FULLWIDTHLESSTHAN",a1="FULLWIDTHGREATERTHAN",s1="AMPERSAND",o1="APOSTROPHE",l1="ASTERISK",Nd="AT",u1="BACKSLASH",c1="BACKTICK",d1="CARET",Ad="COLON",bC="COMMA",f1="DOLLAR",bu="DOT",h1="EQUALS",wC="EXCLAMATION",$o="HYPHEN",hv="PERCENT",p1="PIPE",m1="PLUS",g1="POUND",pv="QUERY",SC="QUOTE",z6="FULLWIDTHMIDDLEDOT",kC="SEMI",wu="SLASH",mv="TILDE",v1="UNDERSCORE",U6="EMOJI",y1="SYM";var G6=Object.freeze({__proto__:null,ALPHANUMERICAL:B6,AMPERSAND:s1,APOSTROPHE:o1,ASCIINUMERICAL:F6,ASTERISK:l1,AT:Nd,BACKSLASH:u1,BACKTICK:c1,CARET:d1,CLOSEANGLEBRACKET:Xx,CLOSEBRACE:fv,CLOSEBRACKET:$x,CLOSEPAREN:Zx,COLON:Ad,COMMA:bC,DOLLAR:f1,DOT:bu,EMOJI:U6,EQUALS:h1,EXCLAMATION:wC,FULLWIDTHGREATERTHAN:a1,FULLWIDTHLEFTPAREN:Qx,FULLWIDTHLESSTHAN:i1,FULLWIDTHMIDDLEDOT:z6,FULLWIDTHRIGHTPAREN:Jx,HYPHEN:$o,LEFTCORNERBRACKET:e1,LEFTWHITECORNERBRACKET:r1,LOCALHOST:Hv,NL:xC,NUM:yC,OPENANGLEBRACKET:Yx,OPENBRACE:dv,OPENBRACKET:qx,OPENPAREN:Kx,PERCENT:hv,PIPE:p1,PLUS:m1,POUND:g1,QUERY:pv,QUOTE:SC,RIGHTCORNERBRACKET:t1,RIGHTWHITECORNERBRACKET:n1,SCHEME:tx,SEMI:kC,SLASH:wu,SLASH_SCHEME:Pp,SYM:y1,TILDE:mv,TLD:Uk,UNDERSCORE:v1,UTLD:Gk,UWORD:zk,WORD:uc,WS:Vk});const oc=/[a-z]/,Vg=new RegExp("\\p{L}","u"),SS=new RegExp("\\p{Emoji}","u"),lc=/\d/,kS=/\s/,DP="\r",_S=`
`,Yte="",Xte="",CS="";let Ly=null,Ry=null;function Qte(t=[]){const e={};Zs.groups=e;const r=new Zs;Ly==null&&(Ly=IP(Hte)),Ry==null&&(Ry=IP(Wte)),mt(r,"'",o1),mt(r,"{",dv),mt(r,"}",fv),mt(r,"[",qx),mt(r,"]",$x),mt(r,"(",Kx),mt(r,")",Zx),mt(r,"<",Yx),mt(r,">",Xx),mt(r,"",Qx),mt(r,"",Jx),mt(r,"",e1),mt(r,"",t1),mt(r,"",r1),mt(r,"",n1),mt(r,"",i1),mt(r,"",a1),mt(r,"&",s1),mt(r,"*",l1),mt(r,"@",Nd),mt(r,"`",c1),mt(r,"^",d1),mt(r,":",Ad),mt(r,",",bC),mt(r,"$",f1),mt(r,".",bu),mt(r,"=",h1),mt(r,"!",wC),mt(r,"-",$o),mt(r,"%",hv),mt(r,"|",p1),mt(r,"+",m1),mt(r,"#",g1),mt(r,"?",pv),mt(r,'"',SC),mt(r,"/",wu),mt(r,";",kC),mt(r,"~",mv),mt(r,"_",v1),mt(r,"\\",u1),mt(r,"",z6);const n=ci(r,lc,yC,{[Ik]:!0});ci(n,lc,n);const i=ci(n,oc,F6,{[cv]:!0}),a=ci(n,Vg,B6,{[ev]:!0}),s=ci(r,oc,uc,{[jk]:!0});ci(s,lc,i),ci(s,oc,s),ci(i,lc,i),ci(i,oc,i);const o=ci(r,Vg,zk,{[Fk]:!0});ci(o,oc),ci(o,lc,a),ci(o,Vg,o),ci(a,lc,a),ci(a,oc),ci(a,Vg,a);const l=mt(r,_S,xC,{[wS]:!0}),u=mt(r,DP,Vk,{[wS]:!0}),c=ci(r,kS,Vk,{[wS]:!0});mt(r,CS,c),mt(u,_S,l),mt(u,CS,c),ci(u,kS,c),mt(c,DP),mt(c,_S),ci(c,kS,c),mt(c,CS,c);const f=ci(r,SS,U6,{[j6]:!0});mt(f,"#"),ci(f,SS,f),mt(f,Yte,f);const p=mt(f,Xte);mt(p,"#"),ci(p,SS,f);const g=[[oc,s],[lc,i]],y=[[oc,null],[Vg,o],[lc,a]];for(let S=0;S<Ly.length;S++)kd(r,Ly[S],Uk,uc,g);for(let S=0;S<Ry.length;S++)kd(r,Ry[S],Gk,zk,y);sh(Uk,{tld:!0,ascii:!0},e),sh(Gk,{utld:!0,alpha:!0},e),kd(r,"file",tx,uc,g),kd(r,"mailto",tx,uc,g),kd(r,"http",Pp,uc,g),kd(r,"https",Pp,uc,g),kd(r,"ftp",Pp,uc,g),kd(r,"ftps",Pp,uc,g),sh(tx,{scheme:!0,ascii:!0},e),sh(Pp,{slashscheme:!0,ascii:!0},e),t=t.sort((S,w)=>S[0]>w[0]?1:-1);for(let S=0;S<t.length;S++){const w=t[S][0],_=t[S][1]?{[qte]:!0}:{[$te]:!0};w.indexOf("-")>=0?_[Bk]=!0:oc.test(w)?lc.test(w)?_[cv]=!0:_[jk]=!0:_[Ik]=!0,OP(r,w,w,_)}return OP(r,"localhost",Hv,{ascii:!0}),r.jd=new Zs(y1),{start:r,tokens:Object.assign({groups:e},G6)}}function V6(t,e){const r=Jte(e.replace(/[A-Z]/g,o=>o.toLowerCase())),n=r.length,i=[];let a=0,s=0;for(;s<n;){let o=t,l=null,u=0,c=null,f=-1,p=-1;for(;s<n&&(l=o.go(r[s]));)o=l,o.accepts()?(f=0,p=0,c=o):f>=0&&(f+=r[s].length,p++),u+=r[s].length,a+=r[s].length,s++;a-=f,s-=p,u-=f,i.push({t:c.t,v:e.slice(a-u,a),s:a-u,e:a})}return i}function Jte(t){const e=[],r=t.length;let n=0;for(;n<r;){let i=t.charCodeAt(n),a,s=i<55296||i>56319||n+1===r||(a=t.charCodeAt(n+1))<56320||a>57343?t[n]:t.slice(n,n+2);e.push(s),n+=s.length}return e}function kd(t,e,r,n,i){let a;const s=e.length;for(let o=0;o<s-1;o++){const l=e[o];t.j[l]?a=t.j[l]:(a=new Zs(n),a.jr=i.slice(),t.j[l]=a),t=a}return a=new Zs(r),a.jr=i.slice(),t.j[e[s-1]]=a,a}function IP(t){const e=[],r=[];let n=0,i="0123456789";for(;n<t.length;){let a=0;for(;i.indexOf(t[n+a])>=0;)a++;if(a>0){e.push(r.join(""));for(let s=parseInt(t.substring(n,n+a),10);s>0;s--)r.pop();n+=a}else r.push(t[n]),n++}return e}const Wv={defaultProtocol:"http",events:null,format:jP,formatHref:jP,nl2br:!1,tagName:"a",target:null,rel:null,validate:!0,truncate:1/0,className:null,attributes:null,ignoreTags:[],render:null};function _C(t,e=null){let r=Object.assign({},Wv);t&&(r=Object.assign(r,t instanceof _C?t.o:t));const n=r.ignoreTags,i=[];for(let a=0;a<n.length;a++)i.push(n[a].toUpperCase());this.o=r,e&&(this.defaultRender=e),this.ignoreTags=i}_C.prototype={o:Wv,ignoreTags:[],defaultRender(t){return t},check(t){return this.get("validate",t.toString(),t)},get(t,e,r){const n=e!=null;let i=this.o[t];return i&&(typeof i=="object"?(i=r.t in i?i[r.t]:Wv[t],typeof i=="function"&&n&&(i=i(e,r))):typeof i=="function"&&n&&(i=i(e,r.t,r)),i)},getObj(t,e,r){let n=this.o[t];return typeof n=="function"&&e!=null&&(n=n(e,r.t,r)),n},render(t){const e=t.render(this);return(this.get("render",null,t)||this.defaultRender)(e,t.t,t)}};function jP(t){return t}function H6(t,e){this.t="token",this.v=t,this.tk=e}H6.prototype={isLink:!1,toString(){return this.v},toHref(t){return this.toString()},toFormattedString(t){const e=this.toString(),r=t.get("truncate",e,this),n=t.get("format",e,this);return r&&n.length>r?n.substring(0,r)+"":n},toFormattedHref(t){return t.get("formatHref",this.toHref(t.get("defaultProtocol")),this)},startIndex(){return this.tk[0].s},endIndex(){return this.tk[this.tk.length-1].e},toObject(t=Wv.defaultProtocol){return{type:this.t,value:this.toString(),isLink:this.isLink,href:this.toHref(t),start:this.startIndex(),end:this.endIndex()}},toFormattedObject(t){return{type:this.t,value:this.toFormattedString(t),isLink:this.isLink,href:this.toFormattedHref(t),start:this.startIndex(),end:this.endIndex()}},validate(t){return t.get("validate",this.toString(),this)},render(t){const e=this,r=this.toHref(t.get("defaultProtocol")),n=t.get("formatHref",r,this),i=t.get("tagName",r,e),a=this.toFormattedString(t),s={},o=t.get("className",r,e),l=t.get("target",r,e),u=t.get("rel",r,e),c=t.getObj("attributes",r,e),f=t.getObj("events",r,e);return s.href=n,o&&(s.class=o),l&&(s.target=l),u&&(s.rel=u),c&&Object.assign(s,c),{tagName:i,attributes:s,content:a,eventListeners:f}}};function cb(t,e){class r extends H6{constructor(i,a){super(i,a),this.t=t}}for(const n in e)r.prototype[n]=e[n];return r.t=t,r}const FP=cb("email",{isLink:!0,toHref(){return"mailto:"+this.toString()}}),BP=cb("text"),ere=cb("nl"),Oy=cb("url",{isLink:!0,toHref(t=Wv.defaultProtocol){return this.hasProtocol()?this.v:`${t}://${this.v}`},hasProtocol(){const t=this.tk;return t.length>=2&&t[0].t!==Hv&&t[1].t===Ad}}),Wo=t=>new Zs(t);function tre({groups:t}){const e=t.domain.concat([s1,l1,Nd,u1,c1,d1,f1,h1,$o,yC,hv,p1,m1,g1,wu,y1,mv,v1]),r=[o1,Ad,bC,bu,wC,hv,pv,SC,kC,Yx,Xx,dv,fv,$x,qx,Kx,Zx,Qx,Jx,e1,t1,r1,n1,i1,a1],n=[s1,o1,l1,u1,c1,d1,f1,h1,$o,dv,fv,hv,p1,m1,g1,pv,wu,y1,mv,v1],i=Wo(),a=mt(i,mv);kr(a,n,a),kr(a,t.domain,a);const s=Wo(),o=Wo(),l=Wo();kr(i,t.domain,s),kr(i,t.scheme,o),kr(i,t.slashscheme,l),kr(s,n,a),kr(s,t.domain,s);const u=mt(s,Nd);mt(a,Nd,u),mt(o,Nd,u),mt(l,Nd,u);const c=mt(a,bu);kr(c,n,a),kr(c,t.domain,a);const f=Wo();kr(u,t.domain,f),kr(f,t.domain,f);const p=mt(f,bu);kr(p,t.domain,f);const g=Wo(FP);kr(p,t.tld,g),kr(p,t.utld,g),mt(u,Hv,g);const y=mt(f,$o);mt(y,$o,y),kr(y,t.domain,f),kr(g,t.domain,f),mt(g,bu,p),mt(g,$o,y);const S=mt(g,Ad);kr(S,t.numeric,FP);const w=mt(s,$o),C=mt(s,bu);mt(w,$o,w),kr(w,t.domain,s),kr(C,n,a),kr(C,t.domain,s);const _=Wo(Oy);kr(C,t.tld,_),kr(C,t.utld,_),kr(_,t.domain,s),kr(_,n,a),mt(_,bu,C),mt(_,$o,w),mt(_,Nd,u);const T=mt(_,Ad),N=Wo(Oy);kr(T,t.numeric,N);const R=Wo(Oy),D=Wo();kr(R,e,R),kr(R,r,D),kr(D,e,R),kr(D,r,D),mt(_,wu,R),mt(N,wu,R);const j=mt(o,Ad),O=mt(l,Ad),F=mt(O,wu),z=mt(F,wu);kr(o,t.domain,s),mt(o,bu,C),mt(o,$o,w),kr(l,t.domain,s),mt(l,bu,C),mt(l,$o,w),kr(j,t.domain,R),mt(j,wu,R),mt(j,pv,R),kr(z,t.domain,R),kr(z,e,R),mt(z,wu,R);const G=[[dv,fv],[qx,$x],[Kx,Zx],[Yx,Xx],[Qx,Jx],[e1,t1],[r1,n1],[i1,a1]];for(let Z=0;Z<G.length;Z++){const[I,W]=G[Z],U=mt(R,I);mt(D,I,U),mt(U,W,R);const K=Wo(Oy);kr(U,e,K);const $=Wo();kr(U,r),kr(K,e,K),kr(K,r,$),kr($,e,K),kr($,r,$),mt(K,W,R),mt($,W,R)}return mt(i,Hv,_),mt(i,xC,ere),{start:i,tokens:G6}}function rre(t,e,r){let n=r.length,i=0,a=[],s=[];for(;i<n;){let o=t,l=null,u=null,c=0,f=null,p=-1;for(;i<n&&!(l=o.go(r[i].t));)s.push(r[i++]);for(;i<n&&(u=l||o.go(r[i].t));)l=null,o=u,o.accepts()?(p=0,f=o):p>=0&&p++,i++,c++;if(p<0)i-=c,i<n&&(s.push(r[i]),i++);else{s.length>0&&(a.push(ES(BP,e,s)),s=[]),i-=p,c-=p;const g=f.t,y=r.slice(i-c,i);a.push(ES(g,e,y))}}return s.length>0&&a.push(ES(BP,e,s)),a}function ES(t,e,r){const n=r[0].s,i=r[r.length-1].e,a=e.slice(n,i);return new t(a,r)}const nre=typeof console<"u"&&console&&console.warn||(()=>{}),ire="until manual call of linkify.init(). Register all schemes and plugins before invoking linkify the first time.",On={scanner:null,parser:null,tokenQueue:[],pluginQueue:[],customSchemes:[],initialized:!1};function are(){return Zs.groups={},On.scanner=null,On.parser=null,On.tokenQueue=[],On.pluginQueue=[],On.customSchemes=[],On.initialized=!1,On}function zP(t,e=!1){if(On.initialized&&nre(`linkifyjs: already initialized - will not register custom scheme "${t}" ${ire}`),!/^[0-9a-z]+(-[0-9a-z]+)*$/.test(t))throw new Error(`linkifyjs: incorrect scheme format.
1. Must only contain digits, lowercase ASCII letters or "-"
2. Cannot start or end with "-"
3. "-" cannot repeat`);On.customSchemes.push([t,e])}function sre(){On.scanner=Qte(On.customSchemes);for(let t=0;t<On.tokenQueue.length;t++)On.tokenQueue[t][1]({scanner:On.scanner});On.parser=tre(On.scanner.tokens);for(let t=0;t<On.pluginQueue.length;t++)On.pluginQueue[t][1]({scanner:On.scanner,parser:On.parser});return On.initialized=!0,On}function CC(t){return On.initialized||sre(),rre(On.parser.start,t,V6(On.scanner.start,t))}CC.scan=V6;function W6(t,e=null,r=null){if(e&&typeof e=="object"){if(r)throw Error(`linkifyjs: Invalid link type ${e}; must be a string`);r=e,e=null}const n=new _C(r),i=CC(t),a=[];for(let s=0;s<i.length;s++){const o=i[s];o.isLink&&(!e||o.t===e)&&n.check(o)&&a.push(o.toFormattedObject(n))}return a}var EC="[\0- -\u2029]",ore=new RegExp(EC),lre=new RegExp(`${EC}$`),ure=new RegExp(EC,"g");function cre(t){return t.length===1?t[0].isLink:t.length===3&&t[1].isLink?["()","[]"].includes(t[0].value+t[2].value):!1}function dre(t){return new Xn({key:new Ti("autolink"),appendTransaction:(e,r,n)=>{const i=e.some(u=>u.docChanged)&&!r.doc.eq(n.doc),a=e.some(u=>u.getMeta("preventAutolink"));if(!i||a)return;const{tr:s}=n,o=l6(r.doc,[...e]);if(m6(o).forEach(({newRange:u})=>{const c=sJ(n.doc,u,g=>g.isTextblock);let f,p;if(c.length>1)f=c[0],p=n.doc.textBetween(f.pos,f.pos+f.node.nodeSize,void 0," ");else if(c.length){const g=n.doc.textBetween(u.from,u.to," "," ");if(!lre.test(g))return;f=c[0],p=n.doc.textBetween(f.pos,u.to,void 0," ")}if(f&&p){const g=p.split(ore).filter(Boolean);if(g.length<=0)return!1;const y=g[g.length-1],S=f.pos+p.lastIndexOf(y);if(!y)return!1;const w=CC(y).map(C=>C.toObject(t.defaultProtocol));if(!cre(w))return!1;w.filter(C=>C.isLink).map(C=>({...C,from:S+C.start+1,to:S+C.end+1})).filter(C=>n.schema.marks.code?!n.doc.rangeHasMark(C.from,C.to,n.schema.marks.code):!0).filter(C=>t.validate(C.value)).filter(C=>t.shouldAutoLink(C.value)).forEach(C=>{hC(C.from,C.to,n.doc).some(_=>_.mark.type===t.type)||s.addMark(C.from,C.to,t.type.create({href:C.href}))})}}),!!s.steps.length)return s}})}function fre(t){return new Xn({key:new Ti("handleClickLink"),props:{handleClick:(e,r,n)=>{var i,a;if(n.button!==0||!e.editable)return!1;let s=null;if(n.target instanceof HTMLAnchorElement)s=n.target;else{const l=n.target;if(!l)return!1;const u=t.editor.view.dom;s=l.closest("a"),s&&!u.contains(s)&&(s=null)}if(!s)return!1;let o=!1;if(t.enableClickSelection&&(o=t.editor.commands.extendMarkRange(t.type.name)),t.openOnClick){const l=p6(e.state,t.type.name),u=(i=s.href)!=null?i:l.href,c=(a=s.target)!=null?a:l.target;u&&(window.open(u,c),o=!0)}return o}}})}function hre(t){return new Xn({key:new Ti("handlePasteLink"),props:{handlePaste:(e,r,n)=>{const{shouldAutoLink:i}=t,{state:a}=e,{selection:s}=a,{empty:o}=s;if(o)return!1;let l="";n.content.forEach(c=>{l+=c.textContent});const u=W6(l,{defaultProtocol:t.defaultProtocol}).find(c=>c.isLink&&c.value===l);return!l||!u||i!==void 0&&!i(u.value)?!1:t.editor.commands.setMark(t.type,{href:u.href})}}})}function $f(t,e){const r=["http","https","ftp","ftps","mailto","tel","callto","sms","cid","xmpp"];return e&&e.forEach(n=>{const i=typeof n=="string"?n:n.scheme;i&&r.push(i)}),!t||t.replace(ure,"").match(new RegExp(`^(?:(?:${r.join("|")}):|[^a-z]|[a-z0-9+.-]+(?:[^a-z+.-:]|$))`,"i"))}var pre=Ah.create({name:"link",priority:1e3,keepOnSplit:!1,exitable:!0,onCreate(){this.options.validate&&!this.options.shouldAutoLink&&(this.options.shouldAutoLink=this.options.validate,console.warn("The `validate` option is deprecated. Rename to the `shouldAutoLink` option instead.")),this.options.protocols.forEach(t=>{if(typeof t=="string"){zP(t);return}zP(t.scheme,t.optionalSlashes)})},onDestroy(){are()},inclusive(){return this.options.autolink},addOptions(){return{openOnClick:!0,enableClickSelection:!1,linkOnPaste:!0,autolink:!0,protocols:[],defaultProtocol:"http",HTMLAttributes:{target:"_blank",rel:"noopener noreferrer nofollow",class:null},isAllowedUri:(t,e)=>!!$f(t,e.protocols),validate:t=>!!t,shouldAutoLink:t=>{const e=/^[a-z][a-z0-9+.-]*:\/\//i.test(t),r=/^[a-z][a-z0-9+.-]*:/i.test(t);if(e||r&&!t.includes("@"))return!0;const i=(t.includes("@")?t.split("@").pop():t).split(/[/?#:]/)[0];return!(/^\d{1,3}(\.\d{1,3}){3}$/.test(i)||!/\./.test(i))}}},addAttributes(){return{href:{default:null,parseHTML(t){return t.getAttribute("href")}},target:{default:this.options.HTMLAttributes.target},rel:{default:this.options.HTMLAttributes.rel},class:{default:this.options.HTMLAttributes.class}}},parseHTML(){return[{tag:"a[href]",getAttrs:t=>{const e=t.getAttribute("href");return!e||!this.options.isAllowedUri(e,{defaultValidate:r=>!!$f(r,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?!1:null}}]},renderHTML({HTMLAttributes:t}){return this.options.isAllowedUri(t.href,{defaultValidate:e=>!!$f(e,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?["a",Yn(this.options.HTMLAttributes,t),0]:["a",Yn(this.options.HTMLAttributes,{...t,href:""}),0]},markdownTokenName:"link",parseMarkdown:(t,e)=>e.applyMark("link",e.parseInline(t.tokens||[]),{href:t.href,title:t.title||null}),renderMarkdown:(t,e)=>{var r;const n=((r=t.attrs)==null?void 0:r.href)||"";return`[${e.renderChildren(t)}](${n})`},addCommands(){return{setLink:t=>({chain:e})=>{const{href:r}=t;return this.options.isAllowedUri(r,{defaultValidate:n=>!!$f(n,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?e().setMark(this.name,t).setMeta("preventAutolink",!0).run():!1},toggleLink:t=>({chain:e})=>{const{href:r}=t||{};return r&&!this.options.isAllowedUri(r,{defaultValidate:n=>!!$f(n,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?!1:e().toggleMark(this.name,t,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()},unsetLink:()=>({chain:t})=>t().unsetMark(this.name,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()}},addPasteRules(){return[Ch({find:t=>{const e=[];if(t){const{protocols:r,defaultProtocol:n}=this.options,i=W6(t).filter(a=>a.isLink&&this.options.isAllowedUri(a.value,{defaultValidate:s=>!!$f(s,r),protocols:r,defaultProtocol:n}));i.length&&i.forEach(a=>{this.options.shouldAutoLink(a.value)&&e.push({text:a.value,data:{href:a.href},index:a.start})})}return e},type:this.type,getAttributes:t=>{var e;return{href:(e=t.data)==null?void 0:e.href}}})]},addProseMirrorPlugins(){const t=[],{protocols:e,defaultProtocol:r}=this.options;return this.options.autolink&&t.push(dre({type:this.type,defaultProtocol:this.options.defaultProtocol,validate:n=>this.options.isAllowedUri(n,{defaultValidate:i=>!!$f(i,e),protocols:e,defaultProtocol:r}),shouldAutoLink:this.options.shouldAutoLink})),t.push(fre({type:this.type,editor:this.editor,openOnClick:this.options.openOnClick==="whenNotEditable"?!0:this.options.openOnClick,enableClickSelection:this.options.enableClickSelection})),this.options.linkOnPaste&&t.push(hre({editor:this.editor,defaultProtocol:this.options.defaultProtocol,type:this.type,shouldAutoLink:this.options.shouldAutoLink})),t}}),mre=Object.defineProperty,gre=(t,e)=>{for(var r in e)mre(t,r,{get:e[r],enumerable:!0})},vre="listItem",UP="textStyle",GP=/^\s*([-+*])\s$/,q6=to.create({name:"bulletList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:"ul"}]},renderHTML({HTMLAttributes:t}){return["ul",Yn(this.options.HTMLAttributes,t),0]},markdownTokenName:"list",parseMarkdown:(t,e)=>t.type!=="list"||t.ordered?[]:{type:"bulletList",content:t.items?e.parseChildren(t.items):[]},renderMarkdown:(t,e)=>t.content?e.renderChildren(t.content,`
`):"",markdownOptions:{indentsContent:!0},addCommands(){return{toggleBulletList:()=>({commands:t,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(vre,this.editor.getAttributes(UP)).run():t.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){let t=em({find:GP,type:this.type});return(this.options.keepMarks||this.options.keepAttributes)&&(t=em({find:GP,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:()=>this.editor.getAttributes(UP),editor:this.editor})),[t]}}),$6=to.create({name:"listItem",addOptions(){return{HTMLAttributes:{},bulletListTypeName:"bulletList",orderedListTypeName:"orderedList"}},content:"paragraph block*",defining:!0,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:t}){return["li",Yn(this.options.HTMLAttributes,t),0]},markdownTokenName:"list_item",parseMarkdown:(t,e)=>{if(t.type!=="list_item")return[];let r=[];if(t.tokens&&t.tokens.length>0)if(t.tokens.some(i=>i.type==="paragraph"))r=e.parseChildren(t.tokens);else{const i=t.tokens[0];if(i&&i.type==="text"&&i.tokens&&i.tokens.length>0){if(r=[{type:"paragraph",content:e.parseInline(i.tokens)}],t.tokens.length>1){const s=t.tokens.slice(1),o=e.parseChildren(s);r.push(...o)}}else r=e.parseChildren(t.tokens)}return r.length===0&&(r=[{type:"paragraph",content:[]}]),{type:"listItem",content:r}},renderMarkdown:(t,e,r)=>vC(t,e,n=>n.parentType==="bulletList"?"- ":n.parentType==="orderedList"?`${n.index+1}. `:"- ",r),addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),yre={};gre(yre,{findListItemPos:()=>v0,getNextListDepth:()=>TC,handleBackspace:()=>Hk,handleDelete:()=>Wk,hasListBefore:()=>K6,hasListItemAfter:()=>xre,hasListItemBefore:()=>Z6,listItemHasSubList:()=>Y6,nextListIsDeeper:()=>X6,nextListIsHigher:()=>Q6});var v0=(t,e)=>{const{$from:r}=e.selection,n=ji(t,e.schema);let i=null,a=r.depth,s=r.pos,o=null;for(;a>0&&o===null;)i=r.node(a),i.type===n?o=a:(a-=1,s-=1);return o===null?null:{$pos:e.doc.resolve(s),depth:o}},TC=(t,e)=>{const r=v0(t,e);if(!r)return!1;const[,n]=gJ(e,t,r.$pos.pos+4);return n},K6=(t,e,r)=>{const{$anchor:n}=t.selection,i=Math.max(0,n.pos-2),a=t.doc.resolve(i).node();return!(!a||!r.includes(a.type.name))},Z6=(t,e)=>{var r;const{$anchor:n}=e.selection,i=e.doc.resolve(n.pos-2);return!(i.index()===0||((r=i.nodeBefore)==null?void 0:r.type.name)!==t)},Y6=(t,e,r)=>{if(!r)return!1;const n=ji(t,e.schema);let i=!1;return r.descendants(a=>{a.type===n&&(i=!0)}),i},Hk=(t,e,r)=>{if(t.commands.undoInputRule())return!0;if(t.state.selection.from!==t.state.selection.to)return!1;if(!rf(t.state,e)&&K6(t.state,e,r)){const{$anchor:o}=t.state.selection,l=t.state.doc.resolve(o.before()-1),u=[];l.node().descendants((p,g)=>{p.type.name===e&&u.push({node:p,pos:g})});const c=u.at(-1);if(!c)return!1;const f=t.state.doc.resolve(l.start()+c.pos+1);return t.chain().cut({from:o.start()-1,to:o.end()+1},f.end()).joinForward().run()}if(!rf(t.state,e)||!bJ(t.state))return!1;const n=v0(e,t.state);if(!n)return!1;const a=t.state.doc.resolve(n.$pos.pos-2).node(n.depth),s=Y6(e,t.state,a);return Z6(e,t.state)&&!s?t.commands.joinItemBackward():t.chain().liftListItem(e).run()},X6=(t,e)=>{const r=TC(t,e),n=v0(t,e);return!n||!r?!1:r>n.depth},Q6=(t,e)=>{const r=TC(t,e),n=v0(t,e);return!n||!r?!1:r<n.depth},Wk=(t,e)=>{if(!rf(t.state,e)||!xJ(t.state,e))return!1;const{selection:r}=t.state,{$from:n,$to:i}=r;return!r.empty&&n.sameParent(i)?!1:X6(e,t.state)?t.chain().focus(t.state.selection.from+4).lift(e).joinBackward().run():Q6(e,t.state)?t.chain().joinForward().joinBackward().run():t.commands.joinItemForward()},xre=(t,e)=>{var r;const{$anchor:n}=e.selection,i=e.doc.resolve(n.pos-n.parentOffset-2);return!(i.index()===i.parent.childCount-1||((r=i.nodeAfter)==null?void 0:r.type.name)!==t)},J6=Ni.create({name:"listKeymap",addOptions(){return{listTypes:[{itemName:"listItem",wrapperNames:["bulletList","orderedList"]},{itemName:"taskItem",wrapperNames:["taskList"]}]}},addKeyboardShortcuts(){return{Delete:({editor:t})=>{let e=!1;return this.options.listTypes.forEach(({itemName:r})=>{t.state.schema.nodes[r]!==void 0&&Wk(t,r)&&(e=!0)}),e},"Mod-Delete":({editor:t})=>{let e=!1;return this.options.listTypes.forEach(({itemName:r})=>{t.state.schema.nodes[r]!==void 0&&Wk(t,r)&&(e=!0)}),e},Backspace:({editor:t})=>{let e=!1;return this.options.listTypes.forEach(({itemName:r,wrapperNames:n})=>{t.state.schema.nodes[r]!==void 0&&Hk(t,r,n)&&(e=!0)}),e},"Mod-Backspace":({editor:t})=>{let e=!1;return this.options.listTypes.forEach(({itemName:r,wrapperNames:n})=>{t.state.schema.nodes[r]!==void 0&&Hk(t,r,n)&&(e=!0)}),e}}}}),VP=/^(\s*)(\d+)\.\s+(.*)$/,bre=/^\s/;function wre(t){const e=[];let r=0,n=0;for(;r<t.length;){const i=t[r],a=i.match(VP);if(!a)break;const[,s,o,l]=a,u=s.length;let c=l,f=r+1;const p=[i];for(;f<t.length;){const g=t[f];if(g.match(VP))break;if(g.trim()==="")p.push(g),c+=`
`,f+=1;else if(g.match(bre))p.push(g),c+=`
${g.slice(u+2)}`,f+=1;else break}e.push({indent:u,number:parseInt(o,10),content:c.trim(),raw:p.join(`
`)}),n=f,r=f}return[e,n]}function eD(t,e,r){var n;const i=[];let a=0;for(;a<t.length;){const s=t[a];if(s.indent===e){const o=s.content.split(`
`),l=((n=o[0])==null?void 0:n.trim())||"",u=[];l&&u.push({type:"paragraph",raw:l,tokens:r.inlineTokens(l)});const c=o.slice(1).join(`
`).trim();if(c){const g=r.blockTokens(c);u.push(...g)}let f=a+1;const p=[];for(;f<t.length&&t[f].indent>e;)p.push(t[f]),f+=1;if(p.length>0){const g=Math.min(...p.map(S=>S.indent)),y=eD(p,g,r);u.push({type:"list",ordered:!0,start:p[0].number,items:y,raw:p.map(S=>S.raw).join(`
`)})}i.push({type:"list_item",raw:s.raw,tokens:u}),a=f}else a+=1}return i}function Sre(t,e){return t.map(r=>{if(r.type!=="list_item")return e.parseChildren([r])[0];const n=[];return r.tokens&&r.tokens.length>0&&r.tokens.forEach(i=>{if(i.type==="paragraph"||i.type==="list"||i.type==="blockquote"||i.type==="code")n.push(...e.parseChildren([i]));else if(i.type==="text"&&i.tokens){const a=e.parseChildren([i]);n.push({type:"paragraph",content:a})}else{const a=e.parseChildren([i]);a.length>0&&n.push(...a)}}),{type:"listItem",content:n}})}var kre="listItem",HP="textStyle",WP=/^(\d+)\.\s$/,tD=to.create({name:"orderedList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},addAttributes(){return{start:{default:1,parseHTML:t=>t.hasAttribute("start")?parseInt(t.getAttribute("start")||"",10):1},type:{default:null,parseHTML:t=>t.getAttribute("type")}}},parseHTML(){return[{tag:"ol"}]},renderHTML({HTMLAttributes:t}){const{start:e,...r}=t;return e===1?["ol",Yn(this.options.HTMLAttributes,r),0]:["ol",Yn(this.options.HTMLAttributes,t),0]},markdownTokenName:"list",parseMarkdown:(t,e)=>{if(t.type!=="list"||!t.ordered)return[];const r=t.start||1,n=t.items?Sre(t.items,e):[];return r!==1?{type:"orderedList",attrs:{start:r},content:n}:{type:"orderedList",content:n}},renderMarkdown:(t,e)=>t.content?e.renderChildren(t.content,`
`):"",markdownTokenizer:{name:"orderedList",level:"block",start:t=>{const e=t.match(/^(\s*)(\d+)\.\s+/),r=e?.index;return r!==void 0?r:-1},tokenize:(t,e,r)=>{var n;const i=t.split(`
`),[a,s]=wre(i);if(a.length===0)return;const o=eD(a,0,r);return o.length===0?void 0:{type:"list",ordered:!0,start:((n=a[0])==null?void 0:n.number)||1,items:o,raw:i.slice(0,s).join(`
`)}}},markdownOptions:{indentsContent:!0},addCommands(){return{toggleOrderedList:()=>({commands:t,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(kre,this.editor.getAttributes(HP)).run():t.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){let t=em({find:WP,type:this.type,getAttributes:e=>({start:+e[1]}),joinPredicate:(e,r)=>r.childCount+r.attrs.start===+e[1]});return(this.options.keepMarks||this.options.keepAttributes)&&(t=em({find:WP,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:e=>({start:+e[1],...this.editor.getAttributes(HP)}),joinPredicate:(e,r)=>r.childCount+r.attrs.start===+e[1],editor:this.editor})),[t]}}),_re=/^\s*(\[([( |x])?\])\s$/,Cre=to.create({name:"taskItem",addOptions(){return{nested:!1,HTMLAttributes:{},taskListTypeName:"taskList",a11y:void 0}},content(){return this.options.nested?"paragraph block*":"paragraph+"},defining:!0,addAttributes(){return{checked:{default:!1,keepOnSplit:!1,parseHTML:t=>{const e=t.getAttribute("data-checked");return e===""||e==="true"},renderHTML:t=>({"data-checked":t.checked})}}},parseHTML(){return[{tag:`li[data-type="${this.name}"]`,priority:51}]},renderHTML({node:t,HTMLAttributes:e}){return["li",Yn(this.options.HTMLAttributes,e,{"data-type":this.name}),["label",["input",{type:"checkbox",checked:t.attrs.checked?"checked":null}],["span"]],["div",0]]},parseMarkdown:(t,e)=>{const r=[];if(t.tokens&&t.tokens.length>0?r.push(e.createNode("paragraph",{},e.parseInline(t.tokens))):t.text?r.push(e.createNode("paragraph",{},[e.createNode("text",{text:t.text})])):r.push(e.createNode("paragraph",{},[])),t.nestedTokens&&t.nestedTokens.length>0){const n=e.parseChildren(t.nestedTokens);r.push(...n)}return e.createNode("taskItem",{checked:t.checked||!1},r)},renderMarkdown:(t,e)=>{var r;const i=`- [${(r=t.attrs)!=null&&r.checked?"x":" "}] `;return vC(t,e,i)},addKeyboardShortcuts(){const t={Enter:()=>this.editor.commands.splitListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)};return this.options.nested?{...t,Tab:()=>this.editor.commands.sinkListItem(this.name)}:t},addNodeView(){return({node:t,HTMLAttributes:e,getPos:r,editor:n})=>{const i=document.createElement("li"),a=document.createElement("label"),s=document.createElement("span"),o=document.createElement("input"),l=document.createElement("div"),u=f=>{var p,g;o.ariaLabel=((g=(p=this.options.a11y)==null?void 0:p.checkboxLabel)==null?void 0:g.call(p,f,o.checked))||`Task item checkbox for ${f.textContent||"empty task item"}`};u(t),a.contentEditable="false",o.type="checkbox",o.addEventListener("mousedown",f=>f.preventDefault()),o.addEventListener("change",f=>{if(!n.isEditable&&!this.options.onReadOnlyChecked){o.checked=!o.checked;return}const{checked:p}=f.target;n.isEditable&&typeof r=="function"&&n.chain().focus(void 0,{scrollIntoView:!1}).command(({tr:g})=>{const y=r();if(typeof y!="number")return!1;const S=g.doc.nodeAt(y);return g.setNodeMarkup(y,void 0,{...S?.attrs,checked:p}),!0}).run(),!n.isEditable&&this.options.onReadOnlyChecked&&(this.options.onReadOnlyChecked(t,p)||(o.checked=!o.checked))}),Object.entries(this.options.HTMLAttributes).forEach(([f,p])=>{i.setAttribute(f,p)}),i.dataset.checked=t.attrs.checked,o.checked=t.attrs.checked,a.append(o,s),i.append(a,l),Object.entries(e).forEach(([f,p])=>{i.setAttribute(f,p)});let c=new Set(Object.keys(e));return{dom:i,contentDOM:l,update:f=>{if(f.type!==this.type)return!1;i.dataset.checked=f.attrs.checked,o.checked=f.attrs.checked,u(f);const p=n.extensionManager.attributes,g=Vv(f,p),y=new Set(Object.keys(g)),S=this.options.HTMLAttributes;return c.forEach(w=>{y.has(w)||(w in S?i.setAttribute(w,S[w]):i.removeAttribute(w))}),Object.entries(g).forEach(([w,C])=>{C==null?w in S?i.setAttribute(w,S[w]):i.removeAttribute(w):i.setAttribute(w,C)}),c=y,!0}}}},addInputRules(){return[em({find:_re,type:this.type,getAttributes:t=>({checked:t[t.length-1]==="x"})})]}}),Ere=to.create({name:"taskList",addOptions(){return{itemTypeName:"taskItem",HTMLAttributes:{}}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:`ul[data-type="${this.name}"]`,priority:51}]},renderHTML({HTMLAttributes:t}){return["ul",Yn(this.options.HTMLAttributes,t,{"data-type":this.name}),0]},parseMarkdown:(t,e)=>e.createNode("taskList",{},e.parseChildren(t.items||[])),renderMarkdown:(t,e)=>t.content?e.renderChildren(t.content,`
`):"",markdownTokenizer:{name:"taskList",level:"block",start(t){var e;const r=(e=t.match(/^\s*[-+*]\s+\[([ xX])\]\s+/))==null?void 0:e.index;return r!==void 0?r:-1},tokenize(t,e,r){const n=a=>{const s=Ok(a,{itemPattern:/^(\s*)([-+*])\s+\[([ xX])\]\s+(.*)$/,extractItemData:o=>({indentLevel:o[1].length,mainContent:o[4],checked:o[3].toLowerCase()==="x"}),createToken:(o,l)=>({type:"taskItem",raw:"",mainContent:o.mainContent,indentLevel:o.indentLevel,checked:o.checked,text:o.mainContent,tokens:r.inlineTokens(o.mainContent),nestedTokens:l}),customNestedParser:n},r);return s?[{type:"taskList",raw:s.raw,items:s.items}]:r.blockTokens(a)},i=Ok(t,{itemPattern:/^(\s*)([-+*])\s+\[([ xX])\]\s+(.*)$/,extractItemData:a=>({indentLevel:a[1].length,mainContent:a[4],checked:a[3].toLowerCase()==="x"}),createToken:(a,s)=>({type:"taskItem",raw:"",mainContent:a.mainContent,indentLevel:a.indentLevel,checked:a.checked,text:a.mainContent,tokens:r.inlineTokens(a.mainContent),nestedTokens:s}),customNestedParser:n},r);if(i)return{type:"taskList",raw:i.raw,items:i.items}}},markdownOptions:{indentsContent:!0},addCommands(){return{toggleTaskList:()=>({commands:t})=>t.toggleList(this.name,this.options.itemTypeName)}},addKeyboardShortcuts(){return{"Mod-Shift-9":()=>this.editor.commands.toggleTaskList()}}});Ni.create({name:"listKit",addExtensions(){const t=[];return this.options.bulletList!==!1&&t.push(q6.configure(this.options.bulletList)),this.options.listItem!==!1&&t.push($6.configure(this.options.listItem)),this.options.listKeymap!==!1&&t.push(J6.configure(this.options.listKeymap)),this.options.orderedList!==!1&&t.push(tD.configure(this.options.orderedList)),this.options.taskItem!==!1&&t.push(Cre.configure(this.options.taskItem)),this.options.taskList!==!1&&t.push(Ere.configure(this.options.taskList)),t}});var Tre=to.create({name:"paragraph",priority:1e3,addOptions(){return{HTMLAttributes:{}}},group:"block",content:"inline*",parseHTML(){return[{tag:"p"}]},renderHTML({HTMLAttributes:t}){return["p",Yn(this.options.HTMLAttributes,t),0]},parseMarkdown:(t,e)=>{const r=t.tokens||[];return r.length===1&&r[0].type==="image"?e.parseChildren([r[0]]):e.createNode("paragraph",void 0,e.parseInline(r))},renderMarkdown:(t,e)=>!t||!Array.isArray(t.content)?"":e.renderChildren(t.content),addCommands(){return{setParagraph:()=>({commands:t})=>t.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),Nre=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))$/,Pre=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))/g,Mre=Ah.create({name:"strike",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:t=>t.includes("line-through")?{}:!1}]},renderHTML({HTMLAttributes:t}){return["s",Yn(this.options.HTMLAttributes,t),0]},markdownTokenName:"del",parseMarkdown:(t,e)=>e.applyMark("strike",e.parseInline(t.tokens||[])),renderMarkdown:(t,e)=>`~~${e.renderChildren(t)}~~`,addCommands(){return{setStrike:()=>({commands:t})=>t.setMark(this.name),toggleStrike:()=>({commands:t})=>t.toggleMark(this.name),unsetStrike:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-s":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[Jp({find:Nre,type:this.type})]},addPasteRules(){return[Ch({find:Pre,type:this.type})]}}),Are=to.create({name:"text",group:"inline",parseMarkdown:t=>({type:"text",text:t.text||""}),renderMarkdown:t=>t.text||""}),Lre=Ah.create({name:"underline",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"u"},{style:"text-decoration",consuming:!1,getAttrs:t=>t.includes("underline")?{}:!1}]},renderHTML({HTMLAttributes:t}){return["u",Yn(this.options.HTMLAttributes,t),0]},parseMarkdown(t,e){return e.applyMark(this.name||"underline",e.parseInline(t.tokens||[]))},renderMarkdown(t,e){return`++${e.renderChildren(t)}++`},markdownTokenizer:{name:"underline",level:"inline",start(t){return t.indexOf("++")},tokenize(t,e,r){const i=/^(\+\+)([\s\S]+?)(\+\+)/.exec(t);if(!i)return;const a=i[2].trim();return{type:"underline",raw:i[0],text:a,tokens:r.inlineTokens(a)}}},addCommands(){return{setUnderline:()=>({commands:t})=>t.setMark(this.name),toggleUnderline:()=>({commands:t})=>t.toggleMark(this.name),unsetUnderline:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-u":()=>this.editor.commands.toggleUnderline(),"Mod-U":()=>this.editor.commands.toggleUnderline()}}});function Rre(t={}){return new Xn({view(e){return new Ore(e,t)}})}class Ore{constructor(e,r){var n;this.editorView=e,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=(n=r.width)!==null&&n!==void 0?n:1,this.color=r.color===!1?void 0:r.color||"black",this.class=r.class,this.handlers=["dragover","dragend","drop","dragleave"].map(i=>{let a=s=>{this[i](s)};return e.dom.addEventListener(i,a),{name:i,handler:a}})}destroy(){this.handlers.forEach(({name:e,handler:r})=>this.editorView.dom.removeEventListener(e,r))}update(e,r){this.cursorPos!=null&&r.doc!=e.state.doc&&(this.cursorPos>e.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(e){e!=this.cursorPos&&(this.cursorPos=e,e==null?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let e=this.editorView.state.doc.resolve(this.cursorPos),r=!e.parent.inlineContent,n,i=this.editorView.dom,a=i.getBoundingClientRect(),s=a.width/i.offsetWidth,o=a.height/i.offsetHeight;if(r){let f=e.nodeBefore,p=e.nodeAfter;if(f||p){let g=this.editorView.nodeDOM(this.cursorPos-(f?f.nodeSize:0));if(g){let y=g.getBoundingClientRect(),S=f?y.bottom:y.top;f&&p&&(S=(S+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2);let w=this.width/2*o;n={left:y.left,right:y.right,top:S-w,bottom:S+w}}}}if(!n){let f=this.editorView.coordsAtPos(this.cursorPos),p=this.width/2*s;n={left:f.left-p,right:f.left+p,top:f.top,bottom:f.bottom}}let l=this.editorView.dom.offsetParent;this.element||(this.element=l.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",r),this.element.classList.toggle("prosemirror-dropcursor-inline",!r);let u,c;if(!l||l==document.body&&getComputedStyle(l).position=="static")u=-pageXOffset,c=-pageYOffset;else{let f=l.getBoundingClientRect(),p=f.width/l.offsetWidth,g=f.height/l.offsetHeight;u=f.left-l.scrollLeft*p,c=f.top-l.scrollTop*g}this.element.style.left=(n.left-u)/s+"px",this.element.style.top=(n.top-c)/o+"px",this.element.style.width=(n.right-n.left)/s+"px",this.element.style.height=(n.bottom-n.top)/o+"px"}scheduleRemoval(e){clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.setCursor(null),e)}dragover(e){if(!this.editorView.editable)return;let r=this.editorView.posAtCoords({left:e.clientX,top:e.clientY}),n=r&&r.inside>=0&&this.editorView.state.doc.nodeAt(r.inside),i=n&&n.type.spec.disableDropCursor,a=typeof i=="function"?i(this.editorView,r,e):i;if(r&&!a){let s=r.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let o=JR(this.editorView.state.doc,s,this.editorView.dragging.slice);o!=null&&(s=o)}this.setCursor(s),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(e){this.editorView.dom.contains(e.relatedTarget)||this.setCursor(null)}}class di extends _r{constructor(e){super(e,e)}map(e,r){let n=e.resolve(r.map(this.head));return di.valid(n)?new di(n):_r.near(n)}content(){return Ot.empty}eq(e){return e instanceof di&&e.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(e,r){if(typeof r.pos!="number")throw new RangeError("Invalid input for GapCursor.fromJSON");return new di(e.resolve(r.pos))}getBookmark(){return new NC(this.anchor)}static valid(e){let r=e.parent;if(r.isTextblock||!Dre(e)||!Ire(e))return!1;let n=r.type.spec.allowGapCursor;if(n!=null)return n;let i=r.contentMatchAt(e.index()).defaultType;return i&&i.isTextblock}static findGapCursorFrom(e,r,n=!1){e:for(;;){if(!n&&di.valid(e))return e;let i=e.pos,a=null;for(let s=e.depth;;s--){let o=e.node(s);if(r>0?e.indexAfter(s)<o.childCount:e.index(s)>0){a=o.child(r>0?e.indexAfter(s):e.index(s)-1);break}else if(s==0)return null;i+=r;let l=e.doc.resolve(i);if(di.valid(l))return l}for(;;){let s=r>0?a.firstChild:a.lastChild;if(!s){if(a.isAtom&&!a.isText&&!Jt.isSelectable(a)){e=e.doc.resolve(i+a.nodeSize*r),n=!1;continue e}break}a=s,i+=r;let o=e.doc.resolve(i);if(di.valid(o))return o}return null}}}di.prototype.visible=!1;di.findFrom=di.findGapCursorFrom;_r.jsonID("gapcursor",di);class NC{constructor(e){this.pos=e}map(e){return new NC(e.map(this.pos))}resolve(e){let r=e.resolve(this.pos);return di.valid(r)?new di(r):_r.near(r)}}function rD(t){return t.isAtom||t.spec.isolating||t.spec.createGapCursor}function Dre(t){for(let e=t.depth;e>=0;e--){let r=t.index(e),n=t.node(e);if(r==0){if(n.type.spec.isolating)return!0;continue}for(let i=n.child(r-1);;i=i.lastChild){if(i.childCount==0&&!i.inlineContent||rD(i.type))return!0;if(i.inlineContent)return!1}}return!0}function Ire(t){for(let e=t.depth;e>=0;e--){let r=t.indexAfter(e),n=t.node(e);if(r==n.childCount){if(n.type.spec.isolating)return!0;continue}for(let i=n.child(r);;i=i.firstChild){if(i.childCount==0&&!i.inlineContent||rD(i.type))return!0;if(i.inlineContent)return!1}}return!0}function jre(){return new Xn({props:{decorations:Ure,createSelectionBetween(t,e,r){return e.pos==r.pos&&di.valid(r)?new di(r):null},handleClick:Bre,handleKeyDown:Fre,handleDOMEvents:{beforeinput:zre}}})}const Fre=e6({ArrowLeft:Dy("horiz",-1),ArrowRight:Dy("horiz",1),ArrowUp:Dy("vert",-1),ArrowDown:Dy("vert",1)});function Dy(t,e){const r=t=="vert"?e>0?"down":"up":e>0?"right":"left";return function(n,i,a){let s=n.selection,o=e>0?s.$to:s.$from,l=s.empty;if(s instanceof fr){if(!a.endOfTextblock(r)||o.depth==0)return!1;l=!1,o=n.doc.resolve(e>0?o.after():o.before())}let u=di.findGapCursorFrom(o,e,l);return u?(i&&i(n.tr.setSelection(new di(u))),!0):!1}}function Bre(t,e,r){if(!t||!t.editable)return!1;let n=t.state.doc.resolve(e);if(!di.valid(n))return!1;let i=t.posAtCoords({left:r.clientX,top:r.clientY});return i&&i.inside>-1&&Jt.isSelectable(t.state.doc.nodeAt(i.inside))?!1:(t.dispatch(t.state.tr.setSelection(new di(n))),!0)}function zre(t,e){if(e.inputType!="insertCompositionText"||!(t.state.selection instanceof di))return!1;let{$from:r}=t.state.selection,n=r.parent.contentMatchAt(r.index()).findWrapping(t.state.schema.nodes.text);if(!n)return!1;let i=at.empty;for(let s=n.length-1;s>=0;s--)i=at.from(n[s].createAndFill(null,i));let a=t.state.tr.replace(r.pos,r.pos,new Ot(i,0,0));return a.setSelection(fr.near(a.doc.resolve(r.pos+1))),t.dispatch(a),!1}function Ure(t){if(!(t.selection instanceof di))return null;let e=document.createElement("div");return e.className="ProseMirror-gapcursor",$n.create(t.doc,[as.widget(t.selection.head,e,{key:"gapcursor"})])}var x1=200,va=function(){};va.prototype.append=function(e){return e.length?(e=va.from(e),!this.length&&e||e.length<x1&&this.leafAppend(e)||this.length<x1&&e.leafPrepend(this)||this.appendInner(e)):this};va.prototype.prepend=function(e){return e.length?va.from(e).append(this):this};va.prototype.appendInner=function(e){return new Gre(this,e)};va.prototype.slice=function(e,r){return e===void 0&&(e=0),r===void 0&&(r=this.length),e>=r?va.empty:this.sliceInner(Math.max(0,e),Math.min(this.length,r))};va.prototype.get=function(e){if(!(e<0||e>=this.length))return this.getInner(e)};va.prototype.forEach=function(e,r,n){r===void 0&&(r=0),n===void 0&&(n=this.length),r<=n?this.forEachInner(e,r,n,0):this.forEachInvertedInner(e,r,n,0)};va.prototype.map=function(e,r,n){r===void 0&&(r=0),n===void 0&&(n=this.length);var i=[];return this.forEach(function(a,s){return i.push(e(a,s))},r,n),i};va.from=function(e){return e instanceof va?e:e&&e.length?new nD(e):va.empty};var nD=(function(t){function e(n){t.call(this),this.values=n}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={length:{configurable:!0},depth:{configurable:!0}};return e.prototype.flatten=function(){return this.values},e.prototype.sliceInner=function(i,a){return i==0&&a==this.length?this:new e(this.values.slice(i,a))},e.prototype.getInner=function(i){return this.values[i]},e.prototype.forEachInner=function(i,a,s,o){for(var l=a;l<s;l++)if(i(this.values[l],o+l)===!1)return!1},e.prototype.forEachInvertedInner=function(i,a,s,o){for(var l=a-1;l>=s;l--)if(i(this.values[l],o+l)===!1)return!1},e.prototype.leafAppend=function(i){if(this.length+i.length<=x1)return new e(this.values.concat(i.flatten()))},e.prototype.leafPrepend=function(i){if(this.length+i.length<=x1)return new e(i.flatten().concat(this.values))},r.length.get=function(){return this.values.length},r.depth.get=function(){return 0},Object.defineProperties(e.prototype,r),e})(va);va.empty=new nD([]);var Gre=(function(t){function e(r,n){t.call(this),this.left=r,this.right=n,this.length=r.length+n.length,this.depth=Math.max(r.depth,n.depth)+1}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},e.prototype.getInner=function(n){return n<this.left.length?this.left.get(n):this.right.get(n-this.left.length)},e.prototype.forEachInner=function(n,i,a,s){var o=this.left.length;if(i<o&&this.left.forEachInner(n,i,Math.min(a,o),s)===!1||a>o&&this.right.forEachInner(n,Math.max(i-o,0),Math.min(this.length,a)-o,s+o)===!1)return!1},e.prototype.forEachInvertedInner=function(n,i,a,s){var o=this.left.length;if(i>o&&this.right.forEachInvertedInner(n,i-o,Math.max(a,o)-o,s+o)===!1||a<o&&this.left.forEachInvertedInner(n,Math.min(i,o),a,s)===!1)return!1},e.prototype.sliceInner=function(n,i){if(n==0&&i==this.length)return this;var a=this.left.length;return i<=a?this.left.slice(n,i):n>=a?this.right.slice(n-a,i-a):this.left.slice(n,a).append(this.right.slice(0,i-a))},e.prototype.leafAppend=function(n){var i=this.right.leafAppend(n);if(i)return new e(this.left,i)},e.prototype.leafPrepend=function(n){var i=this.left.leafPrepend(n);if(i)return new e(i,this.right)},e.prototype.appendInner=function(n){return this.left.depth>=Math.max(this.right.depth,n.depth)+1?new e(this.left,new e(this.right,n)):new e(this,n)},e})(va);const Vre=500;class Rl{constructor(e,r){this.items=e,this.eventCount=r}popEvent(e,r){if(this.eventCount==0)return null;let n=this.items.length;for(;;n--)if(this.items.get(n-1).selection){--n;break}let i,a;r&&(i=this.remapping(n,this.items.length),a=i.maps.length);let s=e.tr,o,l,u=[],c=[];return this.items.forEach((f,p)=>{if(!f.step){i||(i=this.remapping(n,p+1),a=i.maps.length),a--,c.push(f);return}if(i){c.push(new Su(f.map));let g=f.step.map(i.slice(a)),y;g&&s.maybeStep(g).doc&&(y=s.mapping.maps[s.mapping.maps.length-1],u.push(new Su(y,void 0,void 0,u.length+c.length))),a--,y&&i.appendMap(y,a)}else s.maybeStep(f.step);if(f.selection)return o=i?f.selection.map(i.slice(a)):f.selection,l=new Rl(this.items.slice(0,n).append(c.reverse().concat(u)),this.eventCount-1),!1},this.items.length,0),{remaining:l,transform:s,selection:o}}addTransform(e,r,n,i){let a=[],s=this.eventCount,o=this.items,l=!i&&o.length?o.get(o.length-1):null;for(let c=0;c<e.steps.length;c++){let f=e.steps[c].invert(e.docs[c]),p=new Su(e.mapping.maps[c],f,r),g;(g=l&&l.merge(p))&&(p=g,c?a.pop():o=o.slice(0,o.length-1)),a.push(p),r&&(s++,r=void 0),i||(l=p)}let u=s-n.depth;return u>Wre&&(o=Hre(o,u),s-=u),new Rl(o.append(a),s)}remapping(e,r){let n=new jv;return this.items.forEach((i,a)=>{let s=i.mirrorOffset!=null&&a-i.mirrorOffset>=e?n.maps.length-i.mirrorOffset:void 0;n.appendMap(i.map,s)},e,r),n}addMaps(e){return this.eventCount==0?this:new Rl(this.items.append(e.map(r=>new Su(r))),this.eventCount)}rebased(e,r){if(!this.eventCount)return this;let n=[],i=Math.max(0,this.items.length-r),a=e.mapping,s=e.steps.length,o=this.eventCount;this.items.forEach(p=>{p.selection&&o--},i);let l=r;this.items.forEach(p=>{let g=a.getMirror(--l);if(g==null)return;s=Math.min(s,g);let y=a.maps[g];if(p.step){let S=e.steps[g].invert(e.docs[g]),w=p.selection&&p.selection.map(a.slice(l+1,g));w&&o++,n.push(new Su(y,S,w))}else n.push(new Su(y))},i);let u=[];for(let p=r;p<s;p++)u.push(new Su(a.maps[p]));let c=this.items.slice(0,i).append(u).append(n),f=new Rl(c,o);return f.emptyItemCount()>Vre&&(f=f.compress(this.items.length-n.length)),f}emptyItemCount(){let e=0;return this.items.forEach(r=>{r.step||e++}),e}compress(e=this.items.length){let r=this.remapping(0,e),n=r.maps.length,i=[],a=0;return this.items.forEach((s,o)=>{if(o>=e)i.push(s),s.selection&&a++;else if(s.step){let l=s.step.map(r.slice(n)),u=l&&l.getMap();if(n--,u&&r.appendMap(u,n),l){let c=s.selection&&s.selection.map(r.slice(n));c&&a++;let f=new Su(u.invert(),l,c),p,g=i.length-1;(p=i.length&&i[g].merge(f))?i[g]=p:i.push(f)}}else s.map&&n--},this.items.length,0),new Rl(va.from(i.reverse()),a)}}Rl.empty=new Rl(va.empty,0);function Hre(t,e){let r;return t.forEach((n,i)=>{if(n.selection&&e--==0)return r=i,!1}),t.slice(r)}class Su{constructor(e,r,n,i){this.map=e,this.step=r,this.selection=n,this.mirrorOffset=i}merge(e){if(this.step&&e.step&&!e.selection){let r=e.step.merge(this.step);if(r)return new Su(r.getMap().invert(),r,this.selection)}}}class Pd{constructor(e,r,n,i,a){this.done=e,this.undone=r,this.prevRanges=n,this.prevTime=i,this.prevComposition=a}}const Wre=20;function qre(t,e,r,n){let i=r.getMeta(dh),a;if(i)return i.historyState;r.getMeta(Zre)&&(t=new Pd(t.done,t.undone,null,0,-1));let s=r.getMeta("appendedTransaction");if(r.steps.length==0)return t;if(s&&s.getMeta(dh))return s.getMeta(dh).redo?new Pd(t.done.addTransform(r,void 0,n,rx(e)),t.undone,qP(r.mapping.maps),t.prevTime,t.prevComposition):new Pd(t.done,t.undone.addTransform(r,void 0,n,rx(e)),null,t.prevTime,t.prevComposition);if(r.getMeta("addToHistory")!==!1&&!(s&&s.getMeta("addToHistory")===!1)){let o=r.getMeta("composition"),l=t.prevTime==0||!s&&t.prevComposition!=o&&(t.prevTime<(r.time||0)-n.newGroupDelay||!$re(r,t.prevRanges)),u=s?TS(t.prevRanges,r.mapping):qP(r.mapping.maps);return new Pd(t.done.addTransform(r,l?e.selection.getBookmark():void 0,n,rx(e)),Rl.empty,u,r.time,o??t.prevComposition)}else return(a=r.getMeta("rebased"))?new Pd(t.done.rebased(r,a),t.undone.rebased(r,a),TS(t.prevRanges,r.mapping),t.prevTime,t.prevComposition):new Pd(t.done.addMaps(r.mapping.maps),t.undone.addMaps(r.mapping.maps),TS(t.prevRanges,r.mapping),t.prevTime,t.prevComposition)}function $re(t,e){if(!e)return!1;if(!t.docChanged)return!0;let r=!1;return t.mapping.maps[0].forEach((n,i)=>{for(let a=0;a<e.length;a+=2)n<=e[a+1]&&i>=e[a]&&(r=!0)}),r}function qP(t){let e=[];for(let r=t.length-1;r>=0&&e.length==0;r--)t[r].forEach((n,i,a,s)=>e.push(a,s));return e}function TS(t,e){if(!t)return null;let r=[];for(let n=0;n<t.length;n+=2){let i=e.map(t[n],1),a=e.map(t[n+1],-1);i<=a&&r.push(i,a)}return r}function Kre(t,e,r){let n=rx(e),i=dh.get(e).spec.config,a=(r?t.undone:t.done).popEvent(e,n);if(!a)return null;let s=a.selection.resolve(a.transform.doc),o=(r?t.done:t.undone).addTransform(a.transform,e.selection.getBookmark(),i,n),l=new Pd(r?o:a.remaining,r?a.remaining:o,null,0,-1);return a.transform.setSelection(s).setMeta(dh,{redo:r,historyState:l})}let NS=!1,$P=null;function rx(t){let e=t.plugins;if($P!=e){NS=!1,$P=e;for(let r=0;r<e.length;r++)if(e[r].spec.historyPreserveItems){NS=!0;break}}return NS}const dh=new Ti("history"),Zre=new Ti("closeHistory");function Yre(t={}){return t={depth:t.depth||100,newGroupDelay:t.newGroupDelay||500},new Xn({key:dh,state:{init(){return new Pd(Rl.empty,Rl.empty,null,0,-1)},apply(e,r,n){return qre(r,n,e,t)}},config:t,props:{handleDOMEvents:{beforeinput(e,r){let n=r.inputType,i=n=="historyUndo"?aD:n=="historyRedo"?sD:null;return!i||!e.editable?!1:(r.preventDefault(),i(e.state,e.dispatch))}}}})}function iD(t,e){return(r,n)=>{let i=dh.getState(r);if(!i||(t?i.undone:i.done).eventCount==0)return!1;if(n){let a=Kre(i,r,t);a&&n(e?a.scrollIntoView():a)}return!0}}const aD=iD(!1,!0),sD=iD(!0,!0);Ni.create({name:"characterCount",addOptions(){return{limit:null,mode:"textSize",textCounter:t=>t.length,wordCounter:t=>t.split(" ").filter(e=>e!=="").length}},addStorage(){return{characters:()=>0,words:()=>0}},onBeforeCreate(){this.storage.characters=t=>{const e=t?.node||this.editor.state.doc;if((t?.mode||this.options.mode)==="textSize"){const n=e.textBetween(0,e.content.size,void 0," ");return this.options.textCounter(n)}return e.nodeSize},this.storage.words=t=>{const e=t?.node||this.editor.state.doc,r=e.textBetween(0,e.content.size," "," ");return this.options.wordCounter(r)}},addProseMirrorPlugins(){let t=!1;return[new Xn({key:new Ti("characterCount"),appendTransaction:(e,r,n)=>{if(t)return;const i=this.options.limit;if(i==null||i===0){t=!0;return}const a=this.storage.characters({node:n.doc});if(a>i){const s=a-i,o=0,l=s;console.warn(`[CharacterCount] Initial content exceeded limit of ${i} characters. Content was automatically trimmed.`);const u=n.tr.deleteRange(o,l);return t=!0,u}t=!0},filterTransaction:(e,r)=>{const n=this.options.limit;if(!e.docChanged||n===0||n===null||n===void 0)return!0;const i=this.storage.characters({node:r.doc}),a=this.storage.characters({node:e.doc});if(a<=n||i>n&&a>n&&a<=i)return!0;if(i>n&&a>n&&a>i||!e.getMeta("paste"))return!1;const o=e.selection.$head.pos,l=a-n,u=o-l,c=o;return e.deleteRange(u,c),!(this.storage.characters({node:e.doc})>n)}})]}});var Xre=Ni.create({name:"dropCursor",addOptions(){return{color:"currentColor",width:1,class:void 0}},addProseMirrorPlugins(){return[Rre(this.options)]}});Ni.create({name:"focus",addOptions(){return{className:"has-focus",mode:"all"}},addProseMirrorPlugins(){return[new Xn({key:new Ti("focus"),props:{decorations:({doc:t,selection:e})=>{const{isEditable:r,isFocused:n}=this.editor,{anchor:i}=e,a=[];if(!r||!n)return $n.create(t,[]);let s=0;this.options.mode==="deepest"&&t.descendants((l,u)=>{if(l.isText)return;if(!(i>=u&&i<=u+l.nodeSize-1))return!1;s+=1});let o=0;return t.descendants((l,u)=>{if(l.isText||!(i>=u&&i<=u+l.nodeSize-1))return!1;if(o+=1,this.options.mode==="deepest"&&s-o>0||this.options.mode==="shallowest"&&o>1)return this.options.mode==="deepest";a.push(as.node(u,u+l.nodeSize,{class:this.options.className}))}),$n.create(t,a)}}})]}});var Qre=Ni.create({name:"gapCursor",addProseMirrorPlugins(){return[jre()]},extendNodeSchema(t){var e;const r={name:t.name,options:t.options,storage:t.storage};return{allowGapCursor:(e=dn(Zt(t,"allowGapCursor",r)))!=null?e:null}}}),Jre=Ni.create({name:"placeholder",addOptions(){return{emptyEditorClass:"is-editor-empty",emptyNodeClass:"is-empty",placeholder:"Write something ",showOnlyWhenEditable:!0,showOnlyCurrent:!0,includeChildren:!1}},addProseMirrorPlugins(){return[new Xn({key:new Ti("placeholder"),props:{decorations:({doc:t,selection:e})=>{const r=this.editor.isEditable||!this.options.showOnlyWhenEditable,{anchor:n}=e,i=[];if(!r)return null;const a=this.editor.isEmpty;return t.descendants((s,o)=>{const l=n>=o&&n<=o+s.nodeSize,u=!s.isLeaf&&ob(s);if((l||!this.options.showOnlyCurrent)&&u){const c=[this.options.emptyNodeClass];a&&c.push(this.options.emptyEditorClass);const f=as.node(o,o+s.nodeSize,{class:c.join(" "),"data-placeholder":typeof this.options.placeholder=="function"?this.options.placeholder({editor:this.editor,node:s,pos:o,hasAnchor:l}):this.options.placeholder});i.push(f)}return this.options.includeChildren}),$n.create(t,i)}}})]}});Ni.create({name:"selection",addOptions(){return{className:"selection"}},addProseMirrorPlugins(){const{editor:t,options:e}=this;return[new Xn({key:new Ti("selection"),props:{decorations(r){return r.selection.empty||t.isFocused||!t.isEditable||g6(r.selection)||t.view.dragging?null:$n.create(r.doc,[as.inline(r.selection.from,r.selection.to,{class:e.className})])}}})]}});function KP({types:t,node:e}){return e&&Array.isArray(t)&&t.includes(e.type)||e?.type===t}var ene=Ni.create({name:"trailingNode",addOptions(){return{node:void 0,notAfter:[]}},addProseMirrorPlugins(){var t;const e=new Ti(this.name),r=this.options.node||((t=this.editor.schema.topNodeType.contentMatch.defaultType)==null?void 0:t.name)||"paragraph",n=Object.entries(this.editor.schema.nodes).map(([,i])=>i).filter(i=>(this.options.notAfter||[]).concat(r).includes(i.name));return[new Xn({key:e,appendTransaction:(i,a,s)=>{const{doc:o,tr:l,schema:u}=s,c=e.getState(s),f=o.content.size,p=u.nodes[r];if(c)return l.insert(f,p.create())},state:{init:(i,a)=>{const s=a.tr.doc.lastChild;return!KP({node:s,types:n})},apply:(i,a)=>{if(!i.docChanged||i.getMeta("__uniqueIDTransaction"))return a;const s=i.doc.lastChild;return!KP({node:s,types:n})}}})]}}),tne=Ni.create({name:"undoRedo",addOptions(){return{depth:100,newGroupDelay:500}},addCommands(){return{undo:()=>({state:t,dispatch:e})=>aD(t,e),redo:()=>({state:t,dispatch:e})=>sD(t,e)}},addProseMirrorPlugins(){return[Yre(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-y":()=>this.editor.commands.redo(),"Mod-":()=>this.editor.commands.undo(),"Shift-Mod-":()=>this.editor.commands.redo()}}}),rne=Ni.create({name:"starterKit",addExtensions(){var t,e,r,n;const i=[];return this.options.bold!==!1&&i.push(Nte.configure(this.options.bold)),this.options.blockquote!==!1&&i.push(kte.configure(this.options.blockquote)),this.options.bulletList!==!1&&i.push(q6.configure(this.options.bulletList)),this.options.code!==!1&&i.push(Ate.configure(this.options.code)),this.options.codeBlock!==!1&&i.push(Ote.configure(this.options.codeBlock)),this.options.document!==!1&&i.push(Dte.configure(this.options.document)),this.options.dropcursor!==!1&&i.push(Xre.configure(this.options.dropcursor)),this.options.gapcursor!==!1&&i.push(Qre.configure(this.options.gapcursor)),this.options.hardBreak!==!1&&i.push(Ite.configure(this.options.hardBreak)),this.options.heading!==!1&&i.push(jte.configure(this.options.heading)),this.options.undoRedo!==!1&&i.push(tne.configure(this.options.undoRedo)),this.options.horizontalRule!==!1&&i.push(Fte.configure(this.options.horizontalRule)),this.options.italic!==!1&&i.push(Vte.configure(this.options.italic)),this.options.listItem!==!1&&i.push($6.configure(this.options.listItem)),this.options.listKeymap!==!1&&i.push(J6.configure((t=this.options)==null?void 0:t.listKeymap)),this.options.link!==!1&&i.push(pre.configure((e=this.options)==null?void 0:e.link)),this.options.orderedList!==!1&&i.push(tD.configure(this.options.orderedList)),this.options.paragraph!==!1&&i.push(Tre.configure(this.options.paragraph)),this.options.strike!==!1&&i.push(Mre.configure(this.options.strike)),this.options.text!==!1&&i.push(Are.configure(this.options.text)),this.options.underline!==!1&&i.push(Lre.configure((r=this.options)==null?void 0:r.underline)),this.options.trailingNode!==!1&&i.push(ene.configure((n=this.options)==null?void 0:n.trailingNode)),i}}),nne=rne,ine=Jre;function ane(t){var e;const{char:r,allowSpaces:n,allowToIncludeChar:i,allowedPrefixes:a,startOfLine:s,$position:o}=t,l=n&&!i,u=oee(r),c=new RegExp(`\\s${u}$`),f=s?"^":"",p=i?"":u,g=l?new RegExp(`${f}${u}.*?(?=\\s${p}|$)`,"gm"):new RegExp(`${f}(?:^)?${u}[^\\s${p}]*`,"gm"),y=((e=o.nodeBefore)==null?void 0:e.isText)&&o.nodeBefore.text;if(!y)return null;const S=o.pos-y.length,w=Array.from(y.matchAll(g)).pop();if(!w||w.input===void 0||w.index===void 0)return null;const C=w.input.slice(Math.max(0,w.index-1),w.index),_=new RegExp(`^[${a?.join("")}\0]?$`).test(C);if(a!==null&&!_)return null;const T=S+w.index;let N=T+w[0].length;return l&&c.test(y.slice(N-1,N+1))&&(w[0]+=" ",N+=1),T<o.pos&&N>=o.pos?{range:{from:T,to:N},query:w[0].slice(r.length),text:w[0]}:null}var sne=new Ti("suggestion");function one({pluginKey:t=sne,editor:e,char:r="@",allowSpaces:n=!1,allowToIncludeChar:i=!1,allowedPrefixes:a=[" "],startOfLine:s=!1,decorationTag:o="span",decorationClass:l="suggestion",decorationContent:u="",decorationEmptyClass:c="is-empty",command:f=()=>null,items:p=()=>[],render:g=()=>({}),allow:y=()=>!0,findSuggestionMatch:S=ane,shouldShow:w}){let C;const _=g?.(),T=()=>{const j=e.state.selection.$anchor.pos,O=e.view.coordsAtPos(j),{top:F,right:z,bottom:G,left:Z}=O;try{return new DOMRect(Z,F,z-Z,G-F)}catch{return null}},N=(j,O)=>O?()=>{const F=t.getState(e.state),z=F?.decorationId,G=j.dom.querySelector(`[data-decoration-id="${z}"]`);return G?.getBoundingClientRect()||null}:T;function R(j,O){var F;try{const G=t.getState(j.state),Z=G?.decorationId?j.dom.querySelector(`[data-decoration-id="${G.decorationId}"]`):null,I={editor:e,range:G?.range||{from:0,to:0},query:G?.query||null,text:G?.text||null,items:[],command:W=>f({editor:e,range:G?.range||{from:0,to:0},props:W}),decorationNode:Z,clientRect:N(j,Z)};(F=_?.onExit)==null||F.call(_,I)}catch{}const z=j.state.tr.setMeta(O,{exit:!0});j.dispatch(z)}const D=new Xn({key:t,view(){return{update:async(j,O)=>{var F,z,G,Z,I,W,U;const K=(F=this.key)==null?void 0:F.getState(O),$=(z=this.key)==null?void 0:z.getState(j.state),Q=K.active&&$.active&&K.range.from!==$.range.from,ie=!K.active&&$.active,te=K.active&&!$.active,X=!ie&&!te&&K.query!==$.query,re=ie||Q&&X,fe=X||Q,oe=te||Q&&X;if(!re&&!fe&&!oe)return;const se=oe&&!re?K:$,he=j.dom.querySelector(`[data-decoration-id="${se.decorationId}"]`);C={editor:e,range:se.range,query:se.query,text:se.text,items:[],command:ae=>f({editor:e,range:se.range,props:ae}),decorationNode:he,clientRect:N(j,he)},re&&((G=_?.onBeforeStart)==null||G.call(_,C)),fe&&((Z=_?.onBeforeUpdate)==null||Z.call(_,C)),(fe||re)&&(C.items=await p({editor:e,query:se.query})),oe&&((I=_?.onExit)==null||I.call(_,C)),fe&&((W=_?.onUpdate)==null||W.call(_,C)),re&&((U=_?.onStart)==null||U.call(_,C))},destroy:()=>{var j;C&&((j=_?.onExit)==null||j.call(_,C))}}},state:{init(){return{active:!1,range:{from:0,to:0},query:null,text:null,composing:!1}},apply(j,O,F,z){const{isEditable:G}=e,{composing:Z}=e.view,{selection:I}=j,{empty:W,from:U}=I,K={...O},$=j.getMeta(t);if($&&$.exit)return K.active=!1,K.decorationId=null,K.range={from:0,to:0},K.query=null,K.text=null,K;if(K.composing=Z,G&&(W||e.view.composing)){(U<O.range.from||U>O.range.to)&&!Z&&!O.composing&&(K.active=!1);const Q=S({char:r,allowSpaces:n,allowToIncludeChar:i,allowedPrefixes:a,startOfLine:s,$position:I.$from}),ie=`id_${Math.floor(Math.random()*4294967295)}`;Q&&y({editor:e,state:z,range:Q.range,isActive:O.active})&&(!w||w({editor:e,range:Q.range,query:Q.query,text:Q.text,transaction:j}))?(K.active=!0,K.decorationId=O.decorationId?O.decorationId:ie,K.range=Q.range,K.query=Q.query,K.text=Q.text):K.active=!1}else K.active=!1;return K.active||(K.decorationId=null,K.range={from:0,to:0},K.query=null,K.text=null),K}},props:{handleKeyDown(j,O){var F,z,G,Z;const{active:I,range:W}=D.getState(j.state);if(!I)return!1;if(O.key==="Escape"||O.key==="Esc"){const K=D.getState(j.state),$=(F=C?.decorationNode)!=null?F:null,Q=$??(K?.decorationId?j.dom.querySelector(`[data-decoration-id="${K.decorationId}"]`):null);if(((z=_?.onKeyDown)==null?void 0:z.call(_,{view:j,event:O,range:K.range}))||!1)return!0;const te={editor:e,range:K.range,query:K.query,text:K.text,items:[],command:X=>f({editor:e,range:K.range,props:X}),decorationNode:Q,clientRect:Q?()=>Q.getBoundingClientRect()||null:null};return(G=_?.onExit)==null||G.call(_,te),R(j,t),!0}return((Z=_?.onKeyDown)==null?void 0:Z.call(_,{view:j,event:O,range:W}))||!1},decorations(j){const{active:O,range:F,decorationId:z,query:G}=D.getState(j);if(!O)return null;const Z=!G?.length,I=[l];return Z&&I.push(c),$n.create(j.doc,[as.inline(F.from,F.to,{nodeName:o,class:I.join(" "),"data-decoration-id":z,"data-decoration-content":u})])}}});return D}function lne({editor:t,overrideSuggestionOptions:e,extensionName:r,char:n="@"}){const i=new Ti;return{editor:t,char:n,pluginKey:i,command:({editor:a,range:s,props:o})=>{var l,u,c;const f=a.view.state.selection.$to.nodeAfter;(l=f?.text)!=null&&l.startsWith(" ")&&(s.to+=1),a.chain().focus().insertContentAt(s,[{type:r,attrs:{...o,mentionSuggestionChar:n}},{type:"text",text:" "}]).run(),(c=(u=a.view.dom.ownerDocument.defaultView)==null?void 0:u.getSelection())==null||c.collapseToEnd()},allow:({state:a,range:s})=>{const o=a.doc.resolve(s.from),l=a.schema.nodes[r];return!!o.parent.type.contentMatch.matchType(l)},...e}}function oD(t){return(t.options.suggestions.length?t.options.suggestions:[t.options.suggestion]).map(e=>lne({editor:t.editor,overrideSuggestionOptions:e,extensionName:t.name,char:e.char}))}function ZP(t,e){const r=oD(t),n=r.find(i=>i.char===e);return n||(r.length?r[0]:null)}var une=to.create({name:"mention",priority:101,addOptions(){return{HTMLAttributes:{},renderText({node:t,suggestion:e}){var r,n;return`${(r=e?.char)!=null?r:"@"}${(n=t.attrs.label)!=null?n:t.attrs.id}`},deleteTriggerWithBackspace:!1,renderHTML({options:t,node:e,suggestion:r}){var n,i;return["span",Yn(this.HTMLAttributes,t.HTMLAttributes),`${(n=r?.char)!=null?n:"@"}${(i=e.attrs.label)!=null?i:e.attrs.id}`]},suggestions:[],suggestion:{}}},group:"inline",inline:!0,selectable:!1,atom:!0,addAttributes(){return{id:{default:null,parseHTML:t=>t.getAttribute("data-id"),renderHTML:t=>t.id?{"data-id":t.id}:{}},label:{default:null,parseHTML:t=>t.getAttribute("data-label"),renderHTML:t=>t.label?{"data-label":t.label}:{}},mentionSuggestionChar:{default:"@",parseHTML:t=>t.getAttribute("data-mention-suggestion-char"),renderHTML:t=>({"data-mention-suggestion-char":t.mentionSuggestionChar})}}},parseHTML(){return[{tag:`span[data-type="${this.name}"]`}]},renderHTML({node:t,HTMLAttributes:e}){const r=ZP(this,t.attrs.mentionSuggestionChar);if(this.options.renderLabel!==void 0)return console.warn("renderLabel is deprecated use renderText and renderHTML instead"),["span",Yn({"data-type":this.name},this.options.HTMLAttributes,e),this.options.renderLabel({options:this.options,node:t,suggestion:r})];const n={...this.options};n.HTMLAttributes=Yn({"data-type":this.name},this.options.HTMLAttributes,e);const i=this.options.renderHTML({options:n,node:t,suggestion:r});return typeof i=="string"?["span",Yn({"data-type":this.name},this.options.HTMLAttributes,e),i]:i},...R6({nodeName:"mention",name:"@",selfClosing:!0,allowedAttributes:["id","label",{name:"mentionSuggestionChar",skipIfDefault:"@"}],parseAttributes:t=>{const e={},r=/(\w+)=(?:"([^"]*)"|'([^']*)')/g;let n=r.exec(t);for(;n!==null;){const[,i,a,s]=n,o=a??s;e[i==="char"?"mentionSuggestionChar":i]=o,n=r.exec(t)}return e},serializeAttributes:t=>Object.entries(t).filter(([,e])=>e!=null).map(([e,r])=>`${e==="mentionSuggestionChar"?"char":e}="${r}"`).join(" ")}),renderText({node:t}){const e={options:this.options,node:t,suggestion:ZP(this,t.attrs.mentionSuggestionChar)};return this.options.renderLabel!==void 0?(console.warn("renderLabel is deprecated use renderText and renderHTML instead"),this.options.renderLabel(e)):this.options.renderText(e)},addKeyboardShortcuts(){return{Backspace:()=>this.editor.commands.command(({tr:t,state:e})=>{let r=!1;const{selection:n}=e,{empty:i,anchor:a}=n;if(!i)return!1;let s=new Qo,o=0;return e.doc.nodesBetween(a-1,a,(l,u)=>{if(l.type.name===this.name)return r=!0,s=l,o=u,!1}),r&&t.insertText(this.options.deleteTriggerWithBackspace?"":s.attrs.mentionSuggestionChar,o,o+s.nodeSize),r})}},addProseMirrorPlugins(){return oD(this).map(one)}}),cne=une,Qs="top",rl="bottom",nl="right",Js="left",PC="auto",y0=[Qs,rl,nl,Js],tm="start",qv="end",dne="clippingParents",lD="viewport",Hg="popper",fne="reference",YP=y0.reduce(function(t,e){return t.concat([e+"-"+tm,e+"-"+qv])},[]),uD=[].concat(y0,[PC]).reduce(function(t,e){return t.concat([e,e+"-"+tm,e+"-"+qv])},[]),hne="beforeRead",pne="read",mne="afterRead",gne="beforeMain",vne="main",yne="afterMain",xne="beforeWrite",bne="write",wne="afterWrite",Sne=[hne,pne,mne,gne,vne,yne,xne,bne,wne];function Au(t){return t?(t.nodeName||"").toLowerCase():null}function xo(t){if(t==null)return window;if(t.toString()!=="[object Window]"){var e=t.ownerDocument;return e&&e.defaultView||window}return t}function Eh(t){var e=xo(t).Element;return t instanceof e||t instanceof Element}function tl(t){var e=xo(t).HTMLElement;return t instanceof e||t instanceof HTMLElement}function MC(t){if(typeof ShadowRoot>"u")return!1;var e=xo(t).ShadowRoot;return t instanceof e||t instanceof ShadowRoot}function kne(t){var e=t.state;Object.keys(e.elements).forEach(function(r){var n=e.styles[r]||{},i=e.attributes[r]||{},a=e.elements[r];!tl(a)||!Au(a)||(Object.assign(a.style,n),Object.keys(i).forEach(function(s){var o=i[s];o===!1?a.removeAttribute(s):a.setAttribute(s,o===!0?"":o)}))})}function _ne(t){var e=t.state,r={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,r.popper),e.styles=r,e.elements.arrow&&Object.assign(e.elements.arrow.style,r.arrow),function(){Object.keys(e.elements).forEach(function(n){var i=e.elements[n],a=e.attributes[n]||{},s=Object.keys(e.styles.hasOwnProperty(n)?e.styles[n]:r[n]),o=s.reduce(function(l,u){return l[u]="",l},{});!tl(i)||!Au(i)||(Object.assign(i.style,o),Object.keys(a).forEach(function(l){i.removeAttribute(l)}))})}}const cD={name:"applyStyles",enabled:!0,phase:"write",fn:kne,effect:_ne,requires:["computeStyles"]};function Tu(t){return t.split("-")[0]}var fh=Math.max,b1=Math.min,rm=Math.round;function qk(){var t=navigator.userAgentData;return t!=null&&t.brands&&Array.isArray(t.brands)?t.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function dD(){return!/^((?!chrome|android).)*safari/i.test(qk())}function nm(t,e,r){e===void 0&&(e=!1),r===void 0&&(r=!1);var n=t.getBoundingClientRect(),i=1,a=1;e&&tl(t)&&(i=t.offsetWidth>0&&rm(n.width)/t.offsetWidth||1,a=t.offsetHeight>0&&rm(n.height)/t.offsetHeight||1);var s=Eh(t)?xo(t):window,o=s.visualViewport,l=!dD()&&r,u=(n.left+(l&&o?o.offsetLeft:0))/i,c=(n.top+(l&&o?o.offsetTop:0))/a,f=n.width/i,p=n.height/a;return{width:f,height:p,top:c,right:u+f,bottom:c+p,left:u,x:u,y:c}}function AC(t){var e=nm(t),r=t.offsetWidth,n=t.offsetHeight;return Math.abs(e.width-r)<=1&&(r=e.width),Math.abs(e.height-n)<=1&&(n=e.height),{x:t.offsetLeft,y:t.offsetTop,width:r,height:n}}function fD(t,e){var r=e.getRootNode&&e.getRootNode();if(t.contains(e))return!0;if(r&&MC(r)){var n=e;do{if(n&&t.isSameNode(n))return!0;n=n.parentNode||n.host}while(n)}return!1}function bc(t){return xo(t).getComputedStyle(t)}function Cne(t){return["table","td","th"].indexOf(Au(t))>=0}function gf(t){return((Eh(t)?t.ownerDocument:t.document)||window.document).documentElement}function db(t){return Au(t)==="html"?t:t.assignedSlot||t.parentNode||(MC(t)?t.host:null)||gf(t)}function XP(t){return!tl(t)||bc(t).position==="fixed"?null:t.offsetParent}function Ene(t){var e=/firefox/i.test(qk()),r=/Trident/i.test(qk());if(r&&tl(t)){var n=bc(t);if(n.position==="fixed")return null}var i=db(t);for(MC(i)&&(i=i.host);tl(i)&&["html","body"].indexOf(Au(i))<0;){var a=bc(i);if(a.transform!=="none"||a.perspective!=="none"||a.contain==="paint"||["transform","perspective"].indexOf(a.willChange)!==-1||e&&a.willChange==="filter"||e&&a.filter&&a.filter!=="none")return i;i=i.parentNode}return null}function x0(t){for(var e=xo(t),r=XP(t);r&&Cne(r)&&bc(r).position==="static";)r=XP(r);return r&&(Au(r)==="html"||Au(r)==="body"&&bc(r).position==="static")?e:r||Ene(t)||e}function LC(t){return["top","bottom"].indexOf(t)>=0?"x":"y"}function gv(t,e,r){return fh(t,b1(e,r))}function Tne(t,e,r){var n=gv(t,e,r);return n>r?r:n}function hD(){return{top:0,right:0,bottom:0,left:0}}function pD(t){return Object.assign({},hD(),t)}function mD(t,e){return e.reduce(function(r,n){return r[n]=t,r},{})}var Nne=function(e,r){return e=typeof e=="function"?e(Object.assign({},r.rects,{placement:r.placement})):e,pD(typeof e!="number"?e:mD(e,y0))};function Pne(t){var e,r=t.state,n=t.name,i=t.options,a=r.elements.arrow,s=r.modifiersData.popperOffsets,o=Tu(r.placement),l=LC(o),u=[Js,nl].indexOf(o)>=0,c=u?"height":"width";if(!(!a||!s)){var f=Nne(i.padding,r),p=AC(a),g=l==="y"?Qs:Js,y=l==="y"?rl:nl,S=r.rects.reference[c]+r.rects.reference[l]-s[l]-r.rects.popper[c],w=s[l]-r.rects.reference[l],C=x0(a),_=C?l==="y"?C.clientHeight||0:C.clientWidth||0:0,T=S/2-w/2,N=f[g],R=_-p[c]-f[y],D=_/2-p[c]/2+T,j=gv(N,D,R),O=l;r.modifiersData[n]=(e={},e[O]=j,e.centerOffset=j-D,e)}}function Mne(t){var e=t.state,r=t.options,n=r.element,i=n===void 0?"[data-popper-arrow]":n;i!=null&&(typeof i=="string"&&(i=e.elements.popper.querySelector(i),!i)||fD(e.elements.popper,i)&&(e.elements.arrow=i))}const Ane={name:"arrow",enabled:!0,phase:"main",fn:Pne,effect:Mne,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function im(t){return t.split("-")[1]}var Lne={top:"auto",right:"auto",bottom:"auto",left:"auto"};function Rne(t,e){var r=t.x,n=t.y,i=e.devicePixelRatio||1;return{x:rm(r*i)/i||0,y:rm(n*i)/i||0}}function QP(t){var e,r=t.popper,n=t.popperRect,i=t.placement,a=t.variation,s=t.offsets,o=t.position,l=t.gpuAcceleration,u=t.adaptive,c=t.roundOffsets,f=t.isFixed,p=s.x,g=p===void 0?0:p,y=s.y,S=y===void 0?0:y,w=typeof c=="function"?c({x:g,y:S}):{x:g,y:S};g=w.x,S=w.y;var C=s.hasOwnProperty("x"),_=s.hasOwnProperty("y"),T=Js,N=Qs,R=window;if(u){var D=x0(r),j="clientHeight",O="clientWidth";if(D===xo(r)&&(D=gf(r),bc(D).position!=="static"&&o==="absolute"&&(j="scrollHeight",O="scrollWidth")),D=D,i===Qs||(i===Js||i===nl)&&a===qv){N=rl;var F=f&&D===R&&R.visualViewport?R.visualViewport.height:D[j];S-=F-n.height,S*=l?1:-1}if(i===Js||(i===Qs||i===rl)&&a===qv){T=nl;var z=f&&D===R&&R.visualViewport?R.visualViewport.width:D[O];g-=z-n.width,g*=l?1:-1}}var G=Object.assign({position:o},u&&Lne),Z=c===!0?Rne({x:g,y:S},xo(r)):{x:g,y:S};if(g=Z.x,S=Z.y,l){var I;return Object.assign({},G,(I={},I[N]=_?"0":"",I[T]=C?"0":"",I.transform=(R.devicePixelRatio||1)<=1?"translate("+g+"px, "+S+"px)":"translate3d("+g+"px, "+S+"px, 0)",I))}return Object.assign({},G,(e={},e[N]=_?S+"px":"",e[T]=C?g+"px":"",e.transform="",e))}function One(t){var e=t.state,r=t.options,n=r.gpuAcceleration,i=n===void 0?!0:n,a=r.adaptive,s=a===void 0?!0:a,o=r.roundOffsets,l=o===void 0?!0:o,u={placement:Tu(e.placement),variation:im(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:i,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,QP(Object.assign({},u,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:s,roundOffsets:l})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,QP(Object.assign({},u,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:l})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}const Dne={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:One,data:{}};var Iy={passive:!0};function Ine(t){var e=t.state,r=t.instance,n=t.options,i=n.scroll,a=i===void 0?!0:i,s=n.resize,o=s===void 0?!0:s,l=xo(e.elements.popper),u=[].concat(e.scrollParents.reference,e.scrollParents.popper);return a&&u.forEach(function(c){c.addEventListener("scroll",r.update,Iy)}),o&&l.addEventListener("resize",r.update,Iy),function(){a&&u.forEach(function(c){c.removeEventListener("scroll",r.update,Iy)}),o&&l.removeEventListener("resize",r.update,Iy)}}const jne={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:Ine,data:{}};var Fne={left:"right",right:"left",bottom:"top",top:"bottom"};function nx(t){return t.replace(/left|right|bottom|top/g,function(e){return Fne[e]})}var Bne={start:"end",end:"start"};function JP(t){return t.replace(/start|end/g,function(e){return Bne[e]})}function RC(t){var e=xo(t),r=e.pageXOffset,n=e.pageYOffset;return{scrollLeft:r,scrollTop:n}}function OC(t){return nm(gf(t)).left+RC(t).scrollLeft}function zne(t,e){var r=xo(t),n=gf(t),i=r.visualViewport,a=n.clientWidth,s=n.clientHeight,o=0,l=0;if(i){a=i.width,s=i.height;var u=dD();(u||!u&&e==="fixed")&&(o=i.offsetLeft,l=i.offsetTop)}return{width:a,height:s,x:o+OC(t),y:l}}function Une(t){var e,r=gf(t),n=RC(t),i=(e=t.ownerDocument)==null?void 0:e.body,a=fh(r.scrollWidth,r.clientWidth,i?i.scrollWidth:0,i?i.clientWidth:0),s=fh(r.scrollHeight,r.clientHeight,i?i.scrollHeight:0,i?i.clientHeight:0),o=-n.scrollLeft+OC(t),l=-n.scrollTop;return bc(i||r).direction==="rtl"&&(o+=fh(r.clientWidth,i?i.clientWidth:0)-a),{width:a,height:s,x:o,y:l}}function DC(t){var e=bc(t),r=e.overflow,n=e.overflowX,i=e.overflowY;return/auto|scroll|overlay|hidden/.test(r+i+n)}function gD(t){return["html","body","#document"].indexOf(Au(t))>=0?t.ownerDocument.body:tl(t)&&DC(t)?t:gD(db(t))}function vv(t,e){var r;e===void 0&&(e=[]);var n=gD(t),i=n===((r=t.ownerDocument)==null?void 0:r.body),a=xo(n),s=i?[a].concat(a.visualViewport||[],DC(n)?n:[]):n,o=e.concat(s);return i?o:o.concat(vv(db(s)))}function $k(t){return Object.assign({},t,{left:t.x,top:t.y,right:t.x+t.width,bottom:t.y+t.height})}function Gne(t,e){var r=nm(t,!1,e==="fixed");return r.top=r.top+t.clientTop,r.left=r.left+t.clientLeft,r.bottom=r.top+t.clientHeight,r.right=r.left+t.clientWidth,r.width=t.clientWidth,r.height=t.clientHeight,r.x=r.left,r.y=r.top,r}function eM(t,e,r){return e===lD?$k(zne(t,r)):Eh(e)?Gne(e,r):$k(Une(gf(t)))}function Vne(t){var e=vv(db(t)),r=["absolute","fixed"].indexOf(bc(t).position)>=0,n=r&&tl(t)?x0(t):t;return Eh(n)?e.filter(function(i){return Eh(i)&&fD(i,n)&&Au(i)!=="body"}):[]}function Hne(t,e,r,n){var i=e==="clippingParents"?Vne(t):[].concat(e),a=[].concat(i,[r]),s=a[0],o=a.reduce(function(l,u){var c=eM(t,u,n);return l.top=fh(c.top,l.top),l.right=b1(c.right,l.right),l.bottom=b1(c.bottom,l.bottom),l.left=fh(c.left,l.left),l},eM(t,s,n));return o.width=o.right-o.left,o.height=o.bottom-o.top,o.x=o.left,o.y=o.top,o}function vD(t){var e=t.reference,r=t.element,n=t.placement,i=n?Tu(n):null,a=n?im(n):null,s=e.x+e.width/2-r.width/2,o=e.y+e.height/2-r.height/2,l;switch(i){case Qs:l={x:s,y:e.y-r.height};break;case rl:l={x:s,y:e.y+e.height};break;case nl:l={x:e.x+e.width,y:o};break;case Js:l={x:e.x-r.width,y:o};break;default:l={x:e.x,y:e.y}}var u=i?LC(i):null;if(u!=null){var c=u==="y"?"height":"width";switch(a){case tm:l[u]=l[u]-(e[c]/2-r[c]/2);break;case qv:l[u]=l[u]+(e[c]/2-r[c]/2);break}}return l}function $v(t,e){e===void 0&&(e={});var r=e,n=r.placement,i=n===void 0?t.placement:n,a=r.strategy,s=a===void 0?t.strategy:a,o=r.boundary,l=o===void 0?dne:o,u=r.rootBoundary,c=u===void 0?lD:u,f=r.elementContext,p=f===void 0?Hg:f,g=r.altBoundary,y=g===void 0?!1:g,S=r.padding,w=S===void 0?0:S,C=pD(typeof w!="number"?w:mD(w,y0)),_=p===Hg?fne:Hg,T=t.rects.popper,N=t.elements[y?_:p],R=Hne(Eh(N)?N:N.contextElement||gf(t.elements.popper),l,c,s),D=nm(t.elements.reference),j=vD({reference:D,element:T,placement:i}),O=$k(Object.assign({},T,j)),F=p===Hg?O:D,z={top:R.top-F.top+C.top,bottom:F.bottom-R.bottom+C.bottom,left:R.left-F.left+C.left,right:F.right-R.right+C.right},G=t.modifiersData.offset;if(p===Hg&&G){var Z=G[i];Object.keys(z).forEach(function(I){var W=[nl,rl].indexOf(I)>=0?1:-1,U=[Qs,rl].indexOf(I)>=0?"y":"x";z[I]+=Z[U]*W})}return z}function Wne(t,e){e===void 0&&(e={});var r=e,n=r.placement,i=r.boundary,a=r.rootBoundary,s=r.padding,o=r.flipVariations,l=r.allowedAutoPlacements,u=l===void 0?uD:l,c=im(n),f=c?o?YP:YP.filter(function(y){return im(y)===c}):y0,p=f.filter(function(y){return u.indexOf(y)>=0});p.length===0&&(p=f);var g=p.reduce(function(y,S){return y[S]=$v(t,{placement:S,boundary:i,rootBoundary:a,padding:s})[Tu(S)],y},{});return Object.keys(g).sort(function(y,S){return g[y]-g[S]})}function qne(t){if(Tu(t)===PC)return[];var e=nx(t);return[JP(t),e,JP(e)]}function $ne(t){var e=t.state,r=t.options,n=t.name;if(!e.modifiersData[n]._skip){for(var i=r.mainAxis,a=i===void 0?!0:i,s=r.altAxis,o=s===void 0?!0:s,l=r.fallbackPlacements,u=r.padding,c=r.boundary,f=r.rootBoundary,p=r.altBoundary,g=r.flipVariations,y=g===void 0?!0:g,S=r.allowedAutoPlacements,w=e.options.placement,C=Tu(w),_=C===w,T=l||(_||!y?[nx(w)]:qne(w)),N=[w].concat(T).reduce(function(oe,se){return oe.concat(Tu(se)===PC?Wne(e,{placement:se,boundary:c,rootBoundary:f,padding:u,flipVariations:y,allowedAutoPlacements:S}):se)},[]),R=e.rects.reference,D=e.rects.popper,j=new Map,O=!0,F=N[0],z=0;z<N.length;z++){var G=N[z],Z=Tu(G),I=im(G)===tm,W=[Qs,rl].indexOf(Z)>=0,U=W?"width":"height",K=$v(e,{placement:G,boundary:c,rootBoundary:f,altBoundary:p,padding:u}),$=W?I?nl:Js:I?rl:Qs;R[U]>D[U]&&($=nx($));var Q=nx($),ie=[];if(a&&ie.push(K[Z]<=0),o&&ie.push(K[$]<=0,K[Q]<=0),ie.every(function(oe){return oe})){F=G,O=!1;break}j.set(G,ie)}if(O)for(var te=y?3:1,X=function(se){var he=N.find(function(ae){var pe=j.get(ae);if(pe)return pe.slice(0,se).every(function(ye){return ye})});if(he)return F=he,"break"},re=te;re>0;re--){var fe=X(re);if(fe==="break")break}e.placement!==F&&(e.modifiersData[n]._skip=!0,e.placement=F,e.reset=!0)}}const Kne={name:"flip",enabled:!0,phase:"main",fn:$ne,requiresIfExists:["offset"],data:{_skip:!1}};function tM(t,e,r){return r===void 0&&(r={x:0,y:0}),{top:t.top-e.height-r.y,right:t.right-e.width+r.x,bottom:t.bottom-e.height+r.y,left:t.left-e.width-r.x}}function rM(t){return[Qs,nl,rl,Js].some(function(e){return t[e]>=0})}function Zne(t){var e=t.state,r=t.name,n=e.rects.reference,i=e.rects.popper,a=e.modifiersData.preventOverflow,s=$v(e,{elementContext:"reference"}),o=$v(e,{altBoundary:!0}),l=tM(s,n),u=tM(o,i,a),c=rM(l),f=rM(u);e.modifiersData[r]={referenceClippingOffsets:l,popperEscapeOffsets:u,isReferenceHidden:c,hasPopperEscaped:f},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":c,"data-popper-escaped":f})}const Yne={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:Zne};function Xne(t,e,r){var n=Tu(t),i=[Js,Qs].indexOf(n)>=0?-1:1,a=typeof r=="function"?r(Object.assign({},e,{placement:t})):r,s=a[0],o=a[1];return s=s||0,o=(o||0)*i,[Js,nl].indexOf(n)>=0?{x:o,y:s}:{x:s,y:o}}function Qne(t){var e=t.state,r=t.options,n=t.name,i=r.offset,a=i===void 0?[0,0]:i,s=uD.reduce(function(c,f){return c[f]=Xne(f,e.rects,a),c},{}),o=s[e.placement],l=o.x,u=o.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=l,e.modifiersData.popperOffsets.y+=u),e.modifiersData[n]=s}const Jne={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:Qne};function eie(t){var e=t.state,r=t.name;e.modifiersData[r]=vD({reference:e.rects.reference,element:e.rects.popper,placement:e.placement})}const tie={name:"popperOffsets",enabled:!0,phase:"read",fn:eie,data:{}};function rie(t){return t==="x"?"y":"x"}function nie(t){var e=t.state,r=t.options,n=t.name,i=r.mainAxis,a=i===void 0?!0:i,s=r.altAxis,o=s===void 0?!1:s,l=r.boundary,u=r.rootBoundary,c=r.altBoundary,f=r.padding,p=r.tether,g=p===void 0?!0:p,y=r.tetherOffset,S=y===void 0?0:y,w=$v(e,{boundary:l,rootBoundary:u,padding:f,altBoundary:c}),C=Tu(e.placement),_=im(e.placement),T=!_,N=LC(C),R=rie(N),D=e.modifiersData.popperOffsets,j=e.rects.reference,O=e.rects.popper,F=typeof S=="function"?S(Object.assign({},e.rects,{placement:e.placement})):S,z=typeof F=="number"?{mainAxis:F,altAxis:F}:Object.assign({mainAxis:0,altAxis:0},F),G=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,Z={x:0,y:0};if(D){if(a){var I,W=N==="y"?Qs:Js,U=N==="y"?rl:nl,K=N==="y"?"height":"width",$=D[N],Q=$+w[W],ie=$-w[U],te=g?-O[K]/2:0,X=_===tm?j[K]:O[K],re=_===tm?-O[K]:-j[K],fe=e.elements.arrow,oe=g&&fe?AC(fe):{width:0,height:0},se=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:hD(),he=se[W],ae=se[U],pe=gv(0,j[K],oe[K]),ye=T?j[K]/2-te-pe-he-z.mainAxis:X-pe-he-z.mainAxis,ve=T?-j[K]/2+te+pe+ae+z.mainAxis:re+pe+ae+z.mainAxis,ue=e.elements.arrow&&x0(e.elements.arrow),xe=ue?N==="y"?ue.clientTop||0:ue.clientLeft||0:0,Se=(I=G?.[N])!=null?I:0,Ae=$+ye-Se-xe,Me=$+ve-Se,st=gv(g?b1(Q,Ae):Q,$,g?fh(ie,Me):ie);D[N]=st,Z[N]=st-$}if(o){var rt,dt=N==="x"?Qs:Js,Ct=N==="x"?rl:nl,Ke=D[R],ut=R==="y"?"height":"width",ct=Ke+w[dt],xt=Ke-w[Ct],ot=[Qs,Js].indexOf(C)!==-1,Lt=(rt=G?.[R])!=null?rt:0,Bt=ot?ct:Ke-j[ut]-O[ut]-Lt+z.altAxis,Ne=ot?Ke+j[ut]+O[ut]-Lt-z.altAxis:xt,qe=g&&ot?Tne(Bt,Ke,Ne):gv(g?Bt:ct,Ke,g?Ne:xt);D[R]=qe,Z[R]=qe-Ke}e.modifiersData[n]=Z}}const iie={name:"preventOverflow",enabled:!0,phase:"main",fn:nie,requiresIfExists:["offset"]};function aie(t){return{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}}function sie(t){return t===xo(t)||!tl(t)?RC(t):aie(t)}function oie(t){var e=t.getBoundingClientRect(),r=rm(e.width)/t.offsetWidth||1,n=rm(e.height)/t.offsetHeight||1;return r!==1||n!==1}function lie(t,e,r){r===void 0&&(r=!1);var n=tl(e),i=tl(e)&&oie(e),a=gf(e),s=nm(t,i,r),o={scrollLeft:0,scrollTop:0},l={x:0,y:0};return(n||!n&&!r)&&((Au(e)!=="body"||DC(a))&&(o=sie(e)),tl(e)?(l=nm(e,!0),l.x+=e.clientLeft,l.y+=e.clientTop):a&&(l.x=OC(a))),{x:s.left+o.scrollLeft-l.x,y:s.top+o.scrollTop-l.y,width:s.width,height:s.height}}function uie(t){var e=new Map,r=new Set,n=[];t.forEach(function(a){e.set(a.name,a)});function i(a){r.add(a.name);var s=[].concat(a.requires||[],a.requiresIfExists||[]);s.forEach(function(o){if(!r.has(o)){var l=e.get(o);l&&i(l)}}),n.push(a)}return t.forEach(function(a){r.has(a.name)||i(a)}),n}function cie(t){var e=uie(t);return Sne.reduce(function(r,n){return r.concat(e.filter(function(i){return i.phase===n}))},[])}function die(t){var e;return function(){return e||(e=new Promise(function(r){Promise.resolve().then(function(){e=void 0,r(t())})})),e}}function fie(t){var e=t.reduce(function(r,n){var i=r[n.name];return r[n.name]=i?Object.assign({},i,n,{options:Object.assign({},i.options,n.options),data:Object.assign({},i.data,n.data)}):n,r},{});return Object.keys(e).map(function(r){return e[r]})}var nM={placement:"bottom",modifiers:[],strategy:"absolute"};function iM(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return!e.some(function(n){return!(n&&typeof n.getBoundingClientRect=="function")})}function hie(t){t===void 0&&(t={});var e=t,r=e.defaultModifiers,n=r===void 0?[]:r,i=e.defaultOptions,a=i===void 0?nM:i;return function(o,l,u){u===void 0&&(u=a);var c={placement:"bottom",orderedModifiers:[],options:Object.assign({},nM,a),modifiersData:{},elements:{reference:o,popper:l},attributes:{},styles:{}},f=[],p=!1,g={state:c,setOptions:function(C){var _=typeof C=="function"?C(c.options):C;S(),c.options=Object.assign({},a,c.options,_),c.scrollParents={reference:Eh(o)?vv(o):o.contextElement?vv(o.contextElement):[],popper:vv(l)};var T=cie(fie([].concat(n,c.options.modifiers)));return c.orderedModifiers=T.filter(function(N){return N.enabled}),y(),g.update()},forceUpdate:function(){if(!p){var C=c.elements,_=C.reference,T=C.popper;if(iM(_,T)){c.rects={reference:lie(_,x0(T),c.options.strategy==="fixed"),popper:AC(T)},c.reset=!1,c.placement=c.options.placement,c.orderedModifiers.forEach(function(z){return c.modifiersData[z.name]=Object.assign({},z.data)});for(var N=0;N<c.orderedModifiers.length;N++){if(c.reset===!0){c.reset=!1,N=-1;continue}var R=c.orderedModifiers[N],D=R.fn,j=R.options,O=j===void 0?{}:j,F=R.name;typeof D=="function"&&(c=D({state:c,options:O,name:F,instance:g})||c)}}}},update:die(function(){return new Promise(function(w){g.forceUpdate(),w(c)})}),destroy:function(){S(),p=!0}};if(!iM(o,l))return g;g.setOptions(u).then(function(w){!p&&u.onFirstUpdate&&u.onFirstUpdate(w)});function y(){c.orderedModifiers.forEach(function(w){var C=w.name,_=w.options,T=_===void 0?{}:_,N=w.effect;if(typeof N=="function"){var R=N({state:c,name:C,instance:g,options:T}),D=function(){};f.push(R||D)}})}function S(){f.forEach(function(w){return w()}),f=[]}return g}}var pie=[jne,tie,Dne,cD,Jne,Kne,iie,Ane,Yne],mie=hie({defaultModifiers:pie}),gie="tippy-box",yD="tippy-content",vie="tippy-backdrop",xD="tippy-arrow",bD="tippy-svg-arrow",Yf={passive:!0,capture:!0},wD=function(){return document.body};function PS(t,e,r){if(Array.isArray(t)){var n=t[e];return n??(Array.isArray(r)?r[e]:r)}return t}function IC(t,e){var r={}.toString.call(t);return r.indexOf("[object")===0&&r.indexOf(e+"]")>-1}function SD(t,e){return typeof t=="function"?t.apply(void 0,e):t}function aM(t,e){if(e===0)return t;var r;return function(n){clearTimeout(r),r=setTimeout(function(){t(n)},e)}}function yie(t){return t.split(/\s+/).filter(Boolean)}function Mp(t){return[].concat(t)}function sM(t,e){t.indexOf(e)===-1&&t.push(e)}function xie(t){return t.filter(function(e,r){return t.indexOf(e)===r})}function bie(t){return t.split("-")[0]}function w1(t){return[].slice.call(t)}function oM(t){return Object.keys(t).reduce(function(e,r){return t[r]!==void 0&&(e[r]=t[r]),e},{})}function yv(){return document.createElement("div")}function fb(t){return["Element","Fragment"].some(function(e){return IC(t,e)})}function wie(t){return IC(t,"NodeList")}function Sie(t){return IC(t,"MouseEvent")}function kie(t){return!!(t&&t._tippy&&t._tippy.reference===t)}function _ie(t){return fb(t)?[t]:wie(t)?w1(t):Array.isArray(t)?t:w1(document.querySelectorAll(t))}function MS(t,e){t.forEach(function(r){r&&(r.style.transitionDuration=e+"ms")})}function lM(t,e){t.forEach(function(r){r&&r.setAttribute("data-state",e)})}function Cie(t){var e,r=Mp(t),n=r[0];return n!=null&&(e=n.ownerDocument)!=null&&e.body?n.ownerDocument:document}function Eie(t,e){var r=e.clientX,n=e.clientY;return t.every(function(i){var a=i.popperRect,s=i.popperState,o=i.props,l=o.interactiveBorder,u=bie(s.placement),c=s.modifiersData.offset;if(!c)return!0;var f=u==="bottom"?c.top.y:0,p=u==="top"?c.bottom.y:0,g=u==="right"?c.left.x:0,y=u==="left"?c.right.x:0,S=a.top-n+f>l,w=n-a.bottom-p>l,C=a.left-r+g>l,_=r-a.right-y>l;return S||w||C||_})}function AS(t,e,r){var n=e+"EventListener";["transitionend","webkitTransitionEnd"].forEach(function(i){t[n](i,r)})}function uM(t,e){for(var r=e;r;){var n;if(t.contains(r))return!0;r=r.getRootNode==null||(n=r.getRootNode())==null?void 0:n.host}return!1}var ku={isTouch:!1},cM=0;function Tie(){ku.isTouch||(ku.isTouch=!0,window.performance&&document.addEventListener("mousemove",kD))}function kD(){var t=performance.now();t-cM<20&&(ku.isTouch=!1,document.removeEventListener("mousemove",kD)),cM=t}function Nie(){var t=document.activeElement;if(kie(t)){var e=t._tippy;t.blur&&!e.state.isVisible&&t.blur()}}function Pie(){document.addEventListener("touchstart",Tie,Yf),window.addEventListener("blur",Nie)}var Mie=typeof window<"u"&&typeof document<"u",Aie=Mie?!!window.msCrypto:!1,Lie={animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},Rie={allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999},Dl=Object.assign({appendTo:wD,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},Lie,Rie),Oie=Object.keys(Dl),Die=function(e){var r=Object.keys(e);r.forEach(function(n){Dl[n]=e[n]})};function _D(t){var e=t.plugins||[],r=e.reduce(function(n,i){var a=i.name,s=i.defaultValue;if(a){var o;n[a]=t[a]!==void 0?t[a]:(o=Dl[a])!=null?o:s}return n},{});return Object.assign({},t,r)}function Iie(t,e){var r=e?Object.keys(_D(Object.assign({},Dl,{plugins:e}))):Oie,n=r.reduce(function(i,a){var s=(t.getAttribute("data-tippy-"+a)||"").trim();if(!s)return i;if(a==="content")i[a]=s;else try{i[a]=JSON.parse(s)}catch{i[a]=s}return i},{});return n}function dM(t,e){var r=Object.assign({},e,{content:SD(e.content,[t])},e.ignoreAttributes?{}:Iie(t,e.plugins));return r.aria=Object.assign({},Dl.aria,r.aria),r.aria={expanded:r.aria.expanded==="auto"?e.interactive:r.aria.expanded,content:r.aria.content==="auto"?e.interactive?null:"describedby":r.aria.content},r}var jie=function(){return"innerHTML"};function Kk(t,e){t[jie()]=e}function fM(t){var e=yv();return t===!0?e.className=xD:(e.className=bD,fb(t)?e.appendChild(t):Kk(e,t)),e}function hM(t,e){fb(e.content)?(Kk(t,""),t.appendChild(e.content)):typeof e.content!="function"&&(e.allowHTML?Kk(t,e.content):t.textContent=e.content)}function Zk(t){var e=t.firstElementChild,r=w1(e.children);return{box:e,content:r.find(function(n){return n.classList.contains(yD)}),arrow:r.find(function(n){return n.classList.contains(xD)||n.classList.contains(bD)}),backdrop:r.find(function(n){return n.classList.contains(vie)})}}function CD(t){var e=yv(),r=yv();r.className=gie,r.setAttribute("data-state","hidden"),r.setAttribute("tabindex","-1");var n=yv();n.className=yD,n.setAttribute("data-state","hidden"),hM(n,t.props),e.appendChild(r),r.appendChild(n),i(t.props,t.props);function i(a,s){var o=Zk(e),l=o.box,u=o.content,c=o.arrow;s.theme?l.setAttribute("data-theme",s.theme):l.removeAttribute("data-theme"),typeof s.animation=="string"?l.setAttribute("data-animation",s.animation):l.removeAttribute("data-animation"),s.inertia?l.setAttribute("data-inertia",""):l.removeAttribute("data-inertia"),l.style.maxWidth=typeof s.maxWidth=="number"?s.maxWidth+"px":s.maxWidth,s.role?l.setAttribute("role",s.role):l.removeAttribute("role"),(a.content!==s.content||a.allowHTML!==s.allowHTML)&&hM(u,t.props),s.arrow?c?a.arrow!==s.arrow&&(l.removeChild(c),l.appendChild(fM(s.arrow))):l.appendChild(fM(s.arrow)):c&&l.removeChild(c)}return{popper:e,onUpdate:i}}CD.$$tippy=!0;var Fie=1,jy=[],LS=[];function Bie(t,e){var r=dM(t,Object.assign({},Dl,_D(oM(e)))),n,i,a,s=!1,o=!1,l=!1,u=!1,c,f,p,g=[],y=aM(Ae,r.interactiveDebounce),S,w=Fie++,C=null,_=xie(r.plugins),T={isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},N={id:w,reference:t,popper:yv(),popperInstance:C,props:r,state:T,plugins:_,clearDelayTimeouts:Bt,setProps:Ne,setContent:qe,show:St,hide:it,hideWithInteractivity:lt,enable:ot,disable:Lt,unmount:Ie,destroy:de};if(!r.render)return N;var R=r.render(N),D=R.popper,j=R.onUpdate;D.setAttribute("data-tippy-root",""),D.id="tippy-"+N.id,N.popper=D,t._tippy=N,D._tippy=N;var O=_.map(function(ge){return ge.fn(N)}),F=t.hasAttribute("aria-expanded");return ue(),te(),$(),Q("onCreate",[N]),r.showOnCreate&&ct(),D.addEventListener("mouseenter",function(){N.props.interactive&&N.state.isVisible&&N.clearDelayTimeouts()}),D.addEventListener("mouseleave",function(){N.props.interactive&&N.props.trigger.indexOf("mouseenter")>=0&&W().addEventListener("mousemove",y)}),N;function z(){var ge=N.props.touch;return Array.isArray(ge)?ge:[ge,0]}function G(){return z()[0]==="hold"}function Z(){var ge;return!!((ge=N.props.render)!=null&&ge.$$tippy)}function I(){return S||t}function W(){var ge=I().parentNode;return ge?Cie(ge):document}function U(){return Zk(D)}function K(ge){return N.state.isMounted&&!N.state.isVisible||ku.isTouch||c&&c.type==="focus"?0:PS(N.props.delay,ge?0:1,Dl.delay)}function $(ge){ge===void 0&&(ge=!1),D.style.pointerEvents=N.props.interactive&&!ge?"":"none",D.style.zIndex=""+N.props.zIndex}function Q(ge,ke,Ee){if(Ee===void 0&&(Ee=!0),O.forEach(function(Qe){Qe[ge]&&Qe[ge].apply(Qe,ke)}),Ee){var Re;(Re=N.props)[ge].apply(Re,ke)}}function ie(){var ge=N.props.aria;if(ge.content){var ke="aria-"+ge.content,Ee=D.id,Re=Mp(N.props.triggerTarget||t);Re.forEach(function(Qe){var Ge=Qe.getAttribute(ke);if(N.state.isVisible)Qe.setAttribute(ke,Ge?Ge+" "+Ee:Ee);else{var wt=Ge&&Ge.replace(Ee,"").trim();wt?Qe.setAttribute(ke,wt):Qe.removeAttribute(ke)}})}}function te(){if(!(F||!N.props.aria.expanded)){var ge=Mp(N.props.triggerTarget||t);ge.forEach(function(ke){N.props.interactive?ke.setAttribute("aria-expanded",N.state.isVisible&&ke===I()?"true":"false"):ke.removeAttribute("aria-expanded")})}}function X(){W().removeEventListener("mousemove",y),jy=jy.filter(function(ge){return ge!==y})}function re(ge){if(!(ku.isTouch&&(l||ge.type==="mousedown"))){var ke=ge.composedPath&&ge.composedPath()[0]||ge.target;if(!(N.props.interactive&&uM(D,ke))){if(Mp(N.props.triggerTarget||t).some(function(Ee){return uM(Ee,ke)})){if(ku.isTouch||N.state.isVisible&&N.props.trigger.indexOf("click")>=0)return}else Q("onClickOutside",[N,ge]);N.props.hideOnClick===!0&&(N.clearDelayTimeouts(),N.hide(),o=!0,setTimeout(function(){o=!1}),N.state.isMounted||he())}}}function fe(){l=!0}function oe(){l=!1}function se(){var ge=W();ge.addEventListener("mousedown",re,!0),ge.addEventListener("touchend",re,Yf),ge.addEventListener("touchstart",oe,Yf),ge.addEventListener("touchmove",fe,Yf)}function he(){var ge=W();ge.removeEventListener("mousedown",re,!0),ge.removeEventListener("touchend",re,Yf),ge.removeEventListener("touchstart",oe,Yf),ge.removeEventListener("touchmove",fe,Yf)}function ae(ge,ke){ye(ge,function(){!N.state.isVisible&&D.parentNode&&D.parentNode.contains(D)&&ke()})}function pe(ge,ke){ye(ge,ke)}function ye(ge,ke){var Ee=U().box;function Re(Qe){Qe.target===Ee&&(AS(Ee,"remove",Re),ke())}if(ge===0)return ke();AS(Ee,"remove",f),AS(Ee,"add",Re),f=Re}function ve(ge,ke,Ee){Ee===void 0&&(Ee=!1);var Re=Mp(N.props.triggerTarget||t);Re.forEach(function(Qe){Qe.addEventListener(ge,ke,Ee),g.push({node:Qe,eventType:ge,handler:ke,options:Ee})})}function ue(){G()&&(ve("touchstart",Se,{passive:!0}),ve("touchend",Me,{passive:!0})),yie(N.props.trigger).forEach(function(ge){if(ge!=="manual")switch(ve(ge,Se),ge){case"mouseenter":ve("mouseleave",Me);break;case"focus":ve(Aie?"focusout":"blur",st);break;case"focusin":ve("focusout",st);break}})}function xe(){g.forEach(function(ge){var ke=ge.node,Ee=ge.eventType,Re=ge.handler,Qe=ge.options;ke.removeEventListener(Ee,Re,Qe)}),g=[]}function Se(ge){var ke,Ee=!1;if(!(!N.state.isEnabled||rt(ge)||o)){var Re=((ke=c)==null?void 0:ke.type)==="focus";c=ge,S=ge.currentTarget,te(),!N.state.isVisible&&Sie(ge)&&jy.forEach(function(Qe){return Qe(ge)}),ge.type==="click"&&(N.props.trigger.indexOf("mouseenter")<0||s)&&N.props.hideOnClick!==!1&&N.state.isVisible?Ee=!0:ct(ge),ge.type==="click"&&(s=!Ee),Ee&&!Re&&xt(ge)}}function Ae(ge){var ke=ge.target,Ee=I().contains(ke)||D.contains(ke);if(!(ge.type==="mousemove"&&Ee)){var Re=ut().concat(D).map(function(Qe){var Ge,wt=Qe._tippy,bt=(Ge=wt.popperInstance)==null?void 0:Ge.state;return bt?{popperRect:Qe.getBoundingClientRect(),popperState:bt,props:r}:null}).filter(Boolean);Eie(Re,ge)&&(X(),xt(ge))}}function Me(ge){var ke=rt(ge)||N.props.trigger.indexOf("click")>=0&&s;if(!ke){if(N.props.interactive){N.hideWithInteractivity(ge);return}xt(ge)}}function st(ge){N.props.trigger.indexOf("focusin")<0&&ge.target!==I()||N.props.interactive&&ge.relatedTarget&&D.contains(ge.relatedTarget)||xt(ge)}function rt(ge){return ku.isTouch?G()!==ge.type.indexOf("touch")>=0:!1}function dt(){Ct();var ge=N.props,ke=ge.popperOptions,Ee=ge.placement,Re=ge.offset,Qe=ge.getReferenceClientRect,Ge=ge.moveTransition,wt=Z()?Zk(D).arrow:null,bt=Qe?{getBoundingClientRect:Qe,contextElement:Qe.contextElement||I()}:t,pt={name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(Ve){var vt=Ve.state;if(Z()){var Et=U(),er=Et.box;["placement","reference-hidden","escaped"].forEach(function(gr){gr==="placement"?er.setAttribute("data-placement",vt.placement):vt.attributes.popper["data-popper-"+gr]?er.setAttribute("data-"+gr,""):er.removeAttribute("data-"+gr)}),vt.attributes.popper={}}}},Kt=[{name:"offset",options:{offset:Re}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!Ge}},pt];Z()&&wt&&Kt.push({name:"arrow",options:{element:wt,padding:3}}),Kt.push.apply(Kt,ke?.modifiers||[]),N.popperInstance=mie(bt,D,Object.assign({},ke,{placement:Ee,onFirstUpdate:p,modifiers:Kt}))}function Ct(){N.popperInstance&&(N.popperInstance.destroy(),N.popperInstance=null)}function Ke(){var ge=N.props.appendTo,ke,Ee=I();N.props.interactive&&ge===wD||ge==="parent"?ke=Ee.parentNode:ke=SD(ge,[Ee]),ke.contains(D)||ke.appendChild(D),N.state.isMounted=!0,dt()}function ut(){return w1(D.querySelectorAll("[data-tippy-root]"))}function ct(ge){N.clearDelayTimeouts(),ge&&Q("onTrigger",[N,ge]),se();var ke=K(!0),Ee=z(),Re=Ee[0],Qe=Ee[1];ku.isTouch&&Re==="hold"&&Qe&&(ke=Qe),ke?n=setTimeout(function(){N.show()},ke):N.show()}function xt(ge){if(N.clearDelayTimeouts(),Q("onUntrigger",[N,ge]),!N.state.isVisible){he();return}if(!(N.props.trigger.indexOf("mouseenter")>=0&&N.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(ge.type)>=0&&s)){var ke=K(!1);ke?i=setTimeout(function(){N.state.isVisible&&N.hide()},ke):a=requestAnimationFrame(function(){N.hide()})}}function ot(){N.state.isEnabled=!0}function Lt(){N.hide(),N.state.isEnabled=!1}function Bt(){clearTimeout(n),clearTimeout(i),cancelAnimationFrame(a)}function Ne(ge){if(!N.state.isDestroyed){Q("onBeforeUpdate",[N,ge]),xe();var ke=N.props,Ee=dM(t,Object.assign({},ke,oM(ge),{ignoreAttributes:!0}));N.props=Ee,ue(),ke.interactiveDebounce!==Ee.interactiveDebounce&&(X(),y=aM(Ae,Ee.interactiveDebounce)),ke.triggerTarget&&!Ee.triggerTarget?Mp(ke.triggerTarget).forEach(function(Re){Re.removeAttribute("aria-expanded")}):Ee.triggerTarget&&t.removeAttribute("aria-expanded"),te(),$(),j&&j(ke,Ee),N.popperInstance&&(dt(),ut().forEach(function(Re){requestAnimationFrame(Re._tippy.popperInstance.forceUpdate)})),Q("onAfterUpdate",[N,ge])}}function qe(ge){N.setProps({content:ge})}function St(){var ge=N.state.isVisible,ke=N.state.isDestroyed,Ee=!N.state.isEnabled,Re=ku.isTouch&&!N.props.touch,Qe=PS(N.props.duration,0,Dl.duration);if(!(ge||ke||Ee||Re)&&!I().hasAttribute("disabled")&&(Q("onShow",[N],!1),N.props.onShow(N)!==!1)){if(N.state.isVisible=!0,Z()&&(D.style.visibility="visible"),$(),se(),N.state.isMounted||(D.style.transition="none"),Z()){var Ge=U(),wt=Ge.box,bt=Ge.content;MS([wt,bt],0)}p=function(){var Kt;if(!(!N.state.isVisible||u)){if(u=!0,D.offsetHeight,D.style.transition=N.props.moveTransition,Z()&&N.props.animation){var Wt=U(),Ve=Wt.box,vt=Wt.content;MS([Ve,vt],Qe),lM([Ve,vt],"visible")}ie(),te(),sM(LS,N),(Kt=N.popperInstance)==null||Kt.forceUpdate(),Q("onMount",[N]),N.props.animation&&Z()&&pe(Qe,function(){N.state.isShown=!0,Q("onShown",[N])})}},Ke()}}function it(){var ge=!N.state.isVisible,ke=N.state.isDestroyed,Ee=!N.state.isEnabled,Re=PS(N.props.duration,1,Dl.duration);if(!(ge||ke||Ee)&&(Q("onHide",[N],!1),N.props.onHide(N)!==!1)){if(N.state.isVisible=!1,N.state.isShown=!1,u=!1,s=!1,Z()&&(D.style.visibility="hidden"),X(),he(),$(!0),Z()){var Qe=U(),Ge=Qe.box,wt=Qe.content;N.props.animation&&(MS([Ge,wt],Re),lM([Ge,wt],"hidden"))}ie(),te(),N.props.animation?Z()&&ae(Re,N.unmount):N.unmount()}}function lt(ge){W().addEventListener("mousemove",y),sM(jy,y),y(ge)}function Ie(){N.state.isVisible&&N.hide(),N.state.isMounted&&(Ct(),ut().forEach(function(ge){ge._tippy.unmount()}),D.parentNode&&D.parentNode.removeChild(D),LS=LS.filter(function(ge){return ge!==N}),N.state.isMounted=!1,Q("onHidden",[N]))}function de(){N.state.isDestroyed||(N.clearDelayTimeouts(),N.unmount(),xe(),delete t._tippy,N.state.isDestroyed=!0,Q("onDestroy",[N]))}}function b0(t,e){e===void 0&&(e={});var r=Dl.plugins.concat(e.plugins||[]);Pie();var n=Object.assign({},e,{plugins:r}),i=_ie(t),a=i.reduce(function(s,o){var l=o&&Bie(o,n);return l&&s.push(l),s},[]);return fb(t)?a[0]:a}b0.defaultProps=Dl;b0.setDefaultProps=Die;b0.currentInput=ku;Object.assign({},cD,{effect:function(e){var r=e.state,n={popper:{position:r.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(r.elements.popper.style,n.popper),r.styles=n,r.elements.arrow&&Object.assign(r.elements.arrow.style,n.arrow)}});b0.setDefaultProps({render:CD});const zie=ne.forwardRef((t,e)=>{const[r,n]=ne.useState(0),i=l=>{const u=t.items[l];u&&t.command({id:u.id,label:u.label,type:u.type,desc:u.description})},a=()=>{n((r+t.items.length-1)%t.items.length)},s=()=>{n((r+1)%t.items.length)},o=()=>{i(r)};return ne.useEffect(()=>n(0),[t.items]),ne.useImperativeHandle(e,()=>({onKeyDown:({event:l})=>l.key==="ArrowUp"?(a(),!0):l.key==="ArrowDown"?(s(),!0):l.key==="Enter"?(o(),!0):!1})),m.jsx("div",{className:"items bg-white border border-slate-200 rounded-xl shadow-2xl overflow-hidden min-w-[200px] p-2 animate-in zoom-in-95 duration-200",children:t.items.length?t.items.map((l,u)=>{const f=(p=>{switch(p?.toLowerCase()){case"individual":return{icon:"person",color:"text-indigo-400",bg:"bg-indigo-500/10"};case"location":return{icon:"public",color:"text-emerald-400",bg:"bg-emerald-500/10"};case"group":return{icon:"groups",color:"text-purple-400",bg:"bg-purple-500/10"};case"timeline":return{icon:"history",color:"text-orange-400",bg:"bg-orange-500/10"};case"event":return{icon:"event",color:"text-red-400",bg:"bg-red-500/10"};case"item":return{icon:"token",color:"text-amber-400",bg:"bg-amber-500/10"};default:return{icon:"auto_stories",color:"text-slate-400",bg:"bg-slate-500/10"}}})(l.type);return m.jsxs("button",{className:`flex w-full items-center text-xs px-3 py-2 rounded-lg outline-none text-left transition-all gap-3 ${u===r?"bg-primary text-white shadow-lg scale-[1.02]":"text-slate-300 hover:bg-white/5"}`,onClick:()=>i(u),children:[m.jsx("div",{className:`p-1 rounded flex items-center justify-center ${u===r?"bg-white/20":f.bg}`,children:m.jsx("span",{className:`material-symbols-outlined text-[14px] ${u===r?"text-white":f.color}`,children:f.icon})}),m.jsxs("div",{className:"flex flex-col",children:[m.jsx("span",{className:"font-serif font-bold text-sm",children:l.label}),m.jsx("span",{className:"text-[9px] uppercase tracking-wider opacity-60 font-medium",children:l.type})]})]},u)}):m.jsx("div",{className:"item text-xs px-4 py-3 text-slate-500 italic text-center",children:"No results found"})})}),Uie={items:async({query:t})=>{try{return(await $e.get("/world-bible/entities")).filter(r=>r.nombre.toLowerCase().includes(t.toLowerCase())).slice(0,10).map(r=>({id:r.id,label:r.nombre,type:r.categoria||"Generic",subtype:r.tipoEspecial||null,description:r.descripcion}))}catch(e){return console.error(e),[]}},render:()=>{let t,e;return{onStart:r=>{t=new wte(zie,{props:r,editor:r.editor}),r.clientRect&&(e=b0("body",{getReferenceClientRect:r.clientRect,appendTo:()=>document.body,content:t.element,showOnCreate:!0,interactive:!0,trigger:"manual",placement:"bottom-start"}))},onUpdate(r){t.updateProps(r),r.clientRect&&e[0].setProps({getReferenceClientRect:r.clientRect})},onKeyDown(r){return r.event.key==="Escape"?(e[0].hide(),!0):t.ref?.onKeyDown(r)},onExit(){e[0].destroy(),t.destroy()}}}},Gie=({x:t,y:e,data:r,onClose:n})=>{const i=ne.useRef(null),[a,s]=ne.useState({top:e,left:t,opacity:0});if(ne.useEffect(()=>{if(i.current){const u=i.current.getBoundingClientRect(),c=window.innerWidth,f=window.innerHeight;let p=e+20,g=t;g+u.width>c-20&&(g=c-u.width-20),p+u.height>f-20&&(p=e-u.height-10),s({top:p,left:g,opacity:1,transform:"translateY(0)"})}},[t,e]),!r)return null;const l=(u=>{switch((u||"generic").toLowerCase()){case"individual":return{border:"border-indigo-500/50",text:"text-indigo-400",bg:"bg-indigo-950/90"};case"location":return{border:"border-emerald-500/50",text:"text-emerald-400",bg:"bg-emerald-950/90"};case"group":return{border:"border-purple-500/50",text:"text-purple-400",bg:"bg-purple-950/90"};case"timeline":return{border:"border-orange-500/50",text:"text-orange-400",bg:"bg-orange-950/90"};case"event":return{border:"border-red-500/50",text:"text-red-400",bg:"bg-red-950/90"};case"item":return{border:"border-amber-500/50",text:"text-amber-400",bg:"bg-amber-950/90"};default:return{border:"border-slate-500/50",text:"text-slate-400",bg:"bg-slate-950/90"}}})(r.type);return eo.createPortal(m.jsxs("div",{ref:i,className:`mention-card-portal fixed z-[9999] pointer-events-auto p-4 rounded-xl backdrop-blur-md shadow-2xl border flex flex-col gap-2 w-64 transition-all duration-300 ${l.bg} ${l.border}`,style:{top:a.top,left:a.left,opacity:a.opacity,transform:a.opacity===0?"translateY(10px)":"translateY(0)"},children:[m.jsxs("div",{className:"flex items-center justify-between border-b border-white/10 pb-2",children:[m.jsx("span",{className:`text-[10px] font-black uppercase tracking-widest ${l.text}`,children:r.type||"ENTITY"}),m.jsx("span",{className:"material-symbols-outlined text-[14px] opacity-50 text-white",children:"info"})]}),m.jsx("h4",{className:"text-lg font-serif font-bold text-white leading-tight",children:r.label}),r.desc&&m.jsx("p",{className:"text-xs text-slate-300 leading-relaxed font-sans line-clamp-4",children:r.desc}),!r.desc&&m.jsx("p",{className:"text-[10px] text-slate-500 italic",children:"No additional details available."})]}),document.body)},Vie=({content:t,onUpdate:e,editable:r=!0,paperMode:n=!1})=>{const[i,a]=Qt.useState({font:"Cormorant Garamond",fontSize:18});Qt.useEffect(()=>{const u=localStorage.getItem("app_settings");u&&a(JSON.parse(u))},[]);const s=pte({extensions:[nne,ine.configure({placeholder:"Escribe tu historia aqu... Usa @ para mencionar entidades."}),cne.configure({HTMLAttributes:{class:"mention"},suggestion:Uie,renderLabel({options:u,node:c}){return`${c.attrs.label??c.attrs.id}`}}).extend({parseHTML(){return[{tag:"span[data-type]"},{tag:"span.mention"}]},addAttributes(){return{id:{default:null,parseHTML:u=>u.getAttribute("data-id"),renderHTML:u=>({"data-id":u.id})},label:{default:null,parseHTML:u=>u.getAttribute("data-label"),renderHTML:u=>({"data-label":u.label})},type:{default:"generic",parseHTML:u=>u.getAttribute("data-type"),renderHTML:u=>({"data-type":u.type,class:`mention mention-${u.type?.toLowerCase()||"generic"}`})},desc:{default:null,parseHTML:u=>u.getAttribute("data-desc"),renderHTML:u=>({"data-desc":u.desc})}}}})],content:t,editable:r,onUpdate:({editor:u})=>{e(u.getHTML())},editorProps:{attributes:{class:`prose prose-invert max-w-none focus:outline-none min-h-[300px] p-8 ${n?"text-slate-100":"text-foreground/90"} leading-relaxed text-lg transition-all`,style:`font-family: "${i.font}", serif; font-size: ${i.fontSize}px;`}}});if(ne.useEffect(()=>{s&&t!==s.getHTML()&&s.commands.setContent(t)},[t,s]),!s)return null;const[o,l]=Qt.useState(null);return ne.useEffect(()=>{const u=p=>{const g=p.target.closest(".mention");if(g){p.preventDefault();const y=g.getBoundingClientRect();l({x:y.left,y:y.bottom,data:{label:g.getAttribute("data-label")||g.innerText.replace("@",""),type:g.getAttribute("data-type"),desc:g.getAttribute("data-desc"),id:g.getAttribute("data-id")}});return}},c=p=>{if(o){const g=p.target.closest(".mention"),y=p.target.closest(".mention-card-portal");!g&&!y&&l(null)}},f=document.querySelector(".zen-editor-container");return f&&f.addEventListener("click",u),window.addEventListener("mousedown",c),()=>{f&&f.removeEventListener("click",u),window.removeEventListener("mousedown",c)}},[o]),m.jsxs("div",{className:`zen-editor-container w-full h-full overflow-y-auto no-scrollbar ${n?"bg-transparent border-none shadow-none":"bg-card/20 rounded-lg border border-border/50"}`,children:[m.jsx(ote,{editor:s,className:"h-full"}),o&&m.jsx(Gie,{x:o.x,y:o.y,data:o.data,onClose:()=>l(null)})]})},Hie=()=>{const{notebookId:t}=Va(),e=Ga(),{setRightPanelTab:r,setRightOpen:n}=bo(),{t:i}=Ps(),[a,s]=ne.useState(null),[o,l]=ne.useState([]),[u,c]=ne.useState(0),[f,p]=ne.useState(!1),[g,y]=ne.useState(!0),[S,w]=ne.useState(!1),[C,_]=ne.useState(null),T=ne.useRef(null),N=ne.useRef(o),R=ne.useRef(u),D=ne.useRef(!0);ne.useEffect(()=>{N.current=o},[o]),ne.useEffect(()=>{R.current=u},[u]);const[j,O]=ne.useState(null),[F,z]=ne.useState("index");ne.useEffect(()=>{r&&r("CONTEXT"),n(!0),t&&G(t)},[t,r]),ne.useEffect(()=>{const X=setInterval(()=>{const re=document.getElementById("global-right-panel-portal");re&&(O(re),clearInterval(X))},100);return()=>{clearInterval(X),r&&r("NOTEBOOKS")}},[r]),ne.useEffect(()=>{D.current=!0;const X=re=>{T.current&&(re.preventDefault(),re.returnValue="")};return window.addEventListener("beforeunload",X),()=>{if(D.current=!1,window.removeEventListener("beforeunload",X),T.current){clearTimeout(T.current);const re=N.current[R.current];re&&(console.log("Saving on unmount (keepalive):",re.id),$e.request(`/escritura/hoja/${re.id}`,{method:"PUT",body:JSON.stringify({contenido:re.contenido}),keepalive:!0}).catch(fe=>console.error("Error preventing data loss:",fe)))}}},[]);const G=async X=>{try{y(!0);const re=await $e.get(`/escritura/cuaderno/${X}`);s(re);const fe=await $e.get(`/escritura/cuaderno/${X}/hojas`);if(fe&&fe.length>0)l(fe),c(0);else{const oe=await $e.post(`/escritura/cuaderno/${X}/hoja`,{});l([oe]),c(0)}}catch(re){console.error("Error loading notebook/pages:",re),e(-1)}finally{y(!1)}},Z=X=>{if(!o[u])return;const re=[...o];re[u].contenido=X,l(re),T.current&&clearTimeout(T.current),T.current=setTimeout(()=>{W(re[u])},800)},I=X=>{if(!o[u])return;const re=[...o];re[u]={...re[u],titulo:X},l(re),T.current&&clearTimeout(T.current),T.current=setTimeout(()=>{W(re[u])},800)},W=async X=>{D.current&&p(!0);try{await $e.put(`/escritura/hoja/${X.id}`,{contenido:X.contenido,titulo:X.titulo})}catch(re){console.error("Error saving page:",re)}finally{D.current&&p(!1)}};ne.useEffect(()=>{const X=re=>{if(T.current){re.preventDefault(),re.returnValue="";const fe=o[u];fe&&$e.request(`/escritura/hoja/${fe.id}`,{method:"PUT",body:JSON.stringify({contenido:fe.contenido,titulo:fe.titulo}),keepalive:!0}).catch(console.error)}};return window.addEventListener("beforeunload",X),()=>window.removeEventListener("beforeunload",X)},[o,u]);const U=async()=>{if(a)try{const X=await $e.post(`/escritura/cuaderno/${a.id}/hoja`,{});l([...o,X]),c(o.length)}catch(X){console.error("Error creating page:",X)}},K=async X=>{T.current&&clearTimeout(T.current);const re=o[u];if(re)try{await $e.put(`/escritura/hoja/${re.id}`,{contenido:re.contenido})}catch(fe){console.error("Error saving before page switch:",fe)}c(X)},$=(X,re,fe)=>{if(X.stopPropagation(),o.length<=1){_({id:re,index:fe,error:"one_page"}),w(!0);return}_({id:re,index:fe}),w(!0)},Q=async()=>{if(!C)return;const{id:X,index:re}=C;try{await $e.delete(`/escritura/hoja/${X}`);const fe=o.filter(se=>se.id!==X);let oe=u;u===re?oe=Math.max(0,re-1):u>re&&(oe=u-1),l(fe),c(oe)}catch(fe){console.error("Error deleting page:",fe)}finally{w(!1),_(null)}},ie=()=>m.jsxs("div",{className:"flex flex-col h-full bg-surface-dark/95",children:[m.jsxs("div",{className:"p-4 border-b border-white/5 flex items-center justify-center bg-black/60 relative",children:[m.jsx("h3",{className:"text-[10px] font-black uppercase tracking-[0.3em] text-slate-500",children:"Chronicle Hub"}),f&&m.jsx("div",{className:"absolute right-4 animate-pulse",children:m.jsx("span",{className:"material-symbols-outlined text-xs text-amber-500",children:"sync"})})]}),m.jsxs("div",{className:"flex p-2 gap-2 border-b border-white/5 bg-black/20",children:[m.jsx("button",{onClick:()=>z("index"),className:`flex-1 py-2 rounded-xl text-[10px] font-black uppercase tracking-widest transition-all ${F==="index"?"bg-primary text-white shadow-lg":"text-slate-500 hover:text-white"}`,children:i("writing.index")}),m.jsx("button",{onClick:()=>z("format"),className:`flex-1 py-2 rounded-xl text-[10px] font-black uppercase tracking-widest transition-all ${F==="format"?"bg-primary text-white shadow-lg":"text-slate-500 hover:text-white"}`,children:i("writing.format")})]}),m.jsx("div",{className:"flex-1 overflow-hidden",children:F==="index"?m.jsxs("div",{className:"flex flex-col h-full",children:[m.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-2 custom-scrollbar",children:o.map((X,re)=>m.jsxs("div",{className:"group relative",children:[m.jsxs("button",{onClick:()=>K(re),className:`w-full text-left p-4 rounded-2xl border transition-all ${re===u?"bg-primary/10 border-primary/30 text-primary":"bg-white/5 border-transparent hover:bg-white/10 text-slate-400"}`,children:[m.jsxs("div",{className:"flex justify-between items-center mb-1",children:[m.jsxs("span",{className:"font-serif font-bold text-sm truncate",children:[i("writing.page")," ",re+1]}),re===u&&m.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-primary shrink-0 ml-2"})]}),m.jsx("p",{className:"text-[10px] line-clamp-2 opacity-50 font-mono break-words leading-relaxed",children:X.contenido?.replace(/<[^>]+>/g,"").substring(0,40)||i("writing.empty")})]}),m.jsx("button",{onClick:fe=>$(fe,X.id,re),className:"absolute top-2 right-2 p-1.5 rounded-lg text-slate-600 hover:text-red-400 hover:bg-red-400/10 transition-all opacity-0 group-hover:opacity-100",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})})]},X.id))}),m.jsx("div",{className:"p-4 bg-black/20 border-t border-white/5",children:m.jsxs("button",{onClick:U,className:"w-full py-3 bg-primary text-white rounded-2xl text-[10px] font-black uppercase tracking-widest flex items-center justify-center gap-2 transition-all hover:scale-[1.02] shadow-xl shadow-primary/20",children:[m.jsx("span",{className:"material-symbols-outlined text-base",children:"add"}),m.jsx("span",{children:i("writing.new_page")})]})})]}):m.jsx("div",{className:"p-6 space-y-8 animate-in fade-in slide-in-from-right-4",children:m.jsxs("div",{className:"space-y-4",children:[m.jsx("h3",{className:"text-xs font-black uppercase text-primary mb-4 tracking-widest",children:i("writing.format")}),m.jsxs("div",{className:"space-y-3",children:[m.jsx("p",{className:"text-[9px] text-slate-500 uppercase font-bold mb-3",children:"Atajos de Teclado"}),m.jsxs("div",{className:"space-y-2 text-[11px] text-slate-400",children:[m.jsxs("div",{className:"flex justify-between items-center p-2 bg-black/20 rounded",children:[m.jsx("span",{children:"Negrita"}),m.jsx("kbd",{className:"px-2 py-1 bg-slate-800 rounded text-[9px] font-mono",children:"Ctrl+B"})]}),m.jsxs("div",{className:"flex justify-between items-center p-2 bg-black/20 rounded",children:[m.jsx("span",{children:"Cursiva"}),m.jsx("kbd",{className:"px-2 py-1 bg-slate-800 rounded text-[9px] font-mono",children:"Ctrl+I"})]}),m.jsxs("div",{className:"flex justify-between items-center p-2 bg-black/20 rounded",children:[m.jsx("span",{children:"Mencionar entidad"}),m.jsx("kbd",{className:"px-2 py-1 bg-slate-800 rounded text-[9px] font-mono",children:"@"})]}),m.jsxs("div",{className:"flex justify-between items-center p-2 bg-black/20 rounded",children:[m.jsx("span",{children:"Deshacer"}),m.jsx("kbd",{className:"px-2 py-1 bg-slate-800 rounded text-[9px] font-mono",children:"Ctrl+Z"})]}),m.jsxs("div",{className:"flex justify-between items-center p-2 bg-black/20 rounded",children:[m.jsx("span",{children:"Rehacer"}),m.jsx("kbd",{className:"px-2 py-1 bg-slate-800 rounded text-[9px] font-mono",children:"Ctrl+Y"})]})]})]})]})})})]}),te=o[u];return g?m.jsx("div",{className:"flex-1 flex items-center justify-center bg-background-dark",children:m.jsx("div",{className:"animate-pulse text-slate-500 font-serif text-2xl italic tracking-widest",children:i("writing.opening_chronicle")})}):m.jsxs(m.Fragment,{children:[m.jsxs("div",{className:"flex-1 flex w-full h-full bg-[#111] relative overflow-hidden font-sans text-slate-200",children:[j&&eo.createPortal(ie(),j),m.jsx("div",{className:"flex-1 flex flex-col relative z-10 overflow-hidden",children:m.jsx("main",{className:"flex-1 flex flex-col relative no-scrollbar",children:te&&m.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden animate-in slide-in-from-bottom-8 duration-700",children:[m.jsx("div",{className:"h-10 flex items-end px-2 bg-[#0d1117] border-b border-[#1e1e1e] select-none shrink-0",children:m.jsxs("div",{className:"flex items-center h-9 px-4 border-t-[3px] border-[#007acc] bg-[#1e1e1e] text-slate-200 text-sm gap-2 min-w-[200px] max-w-[300px]",children:[m.jsx("span",{className:"material-symbols-outlined text-[14px] text-blue-400",children:"history_edu"}),m.jsx("input",{type:"text",className:"w-full bg-transparent font-sans text-sm text-slate-200 placeholder:text-slate-600 border-none outline-none focus:ring-0 p-0 truncate",value:te.titulo||"",onChange:X=>I(X.target.value),placeholder:`${i("writing.chapter")} ${u+1}`}),m.jsx("span",{className:`material-symbols-outlined text-[14px] transition-opacity ml-2 ${f?"opacity-100 text-blue-400 animate-spin":"opacity-0"}`,children:"sync"})]})}),m.jsx("div",{className:"flex-1 bg-[#1e1e1e] overflow-y-auto custom-scrollbar flex justify-center",children:m.jsx("div",{className:"w-full max-w-4xl px-8 py-12",children:m.jsx(Vie,{content:te.contenido,onUpdate:Z,paperMode:!0})})})]})})})]}),m.jsx(t_,{isOpen:S,onClose:()=>{w(!1),_(null)},onConfirm:C?.error==="one_page"?()=>{w(!1),_(null)}:Q,title:C?.error==="one_page"?i("common.error"):i("writing.delete_page"),message:C?.error==="one_page"?i("writing.one_page_error"):i("writing.delete_page_confirm"),confirmText:C?.error==="one_page"?i("common.ok"):i("common.confirm_delete"),isDestructive:C?.error!=="one_page"})]})},Wie=()=>{const{username:t,projectName:e}=Va(),r=Ga(),{t:n}=Ps(),{setRightPanelTab:i,setRightOpen:a}=bo(),[s,o]=ne.useState([]),[l,u]=ne.useState(!0),[c,f]=ne.useState(!1),[p,g]=ne.useState("");ne.useEffect(()=>{i&&i("NOTEBOOKS"),y()},[i]);const y=async()=>{try{u(!0);const C=await $e.get("/escritura/cuadernos");o(C||[])}catch(C){console.error("Error loading notebooks:",C)}finally{u(!1)}},S=async C=>{C.preventDefault();try{const _=await $e.post("/escritura/cuaderno",{titulo:p||n("writing.new_notebook")});o([...s,_]),f(!1),g(""),r(`/${t}/${e}/writing/${_.id}`)}catch(_){console.error("Error creating notebook:",_)}},w=async(C,_)=>{if(C.stopPropagation(),!!window.confirm(n("writing.delete_confirm")))try{await $e.delete(`/escritura/cuaderno/${_}`),o(s.filter(T=>T.id!==_))}catch(T){console.error("Error deleting notebook:",T)}};return l?m.jsx("div",{className:"flex-1 flex items-center justify-center bg-background-dark",children:m.jsx("div",{className:"animate-spin text-primary material-symbols-outlined text-4xl",children:"sync"})}):m.jsxs("div",{className:"flex-1 flex flex-col bg-background-dark overflow-y-auto no-scrollbar p-12",children:[m.jsxs("header",{className:"mb-12 flex justify-between items-end",children:[m.jsxs("div",{children:[m.jsx("h1",{className:"text-4xl font-serif font-bold text-white mb-2",children:n("writing.library")}),m.jsx("p",{className:"text-slate-500 uppercase text-[10px] font-black tracking-[0.2em]",children:n("writing.library_desc")})]}),m.jsx("button",{onClick:()=>f(!0),className:"group relative px-6 py-3 bg-primary/10 hover:bg-primary/20 border border-primary/30 rounded-2xl transition-all overflow-hidden",children:m.jsxs("div",{className:"flex items-center gap-2 text-primary",children:[m.jsx("span",{className:"material-symbols-outlined text-sm transition-transform group-hover:rotate-90",children:"add"}),m.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest",children:n("writing.new_notebook")})]})})]}),m.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:s.map(C=>m.jsxs("div",{onClick:()=>r(`/${t}/${e}/writing/${C.id}`),className:"group relative h-64 bg-surface-dark border border-white/5 rounded-3xl p-6 cursor-pointer hover:border-primary/50 hover:bg-white/[0.02] transition-all hover:-translate-y-2 flex flex-col justify-between overflow-hidden shadow-2xl",children:[m.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-1.5 bg-primary/40 group-hover:bg-primary transition-colors"}),m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{className:"flex justify-between items-start",children:[m.jsx("div",{className:"size-10 rounded-xl bg-primary/10 flex items-center justify-center text-primary group-hover:scale-110 transition-transform",children:m.jsx("span",{className:"material-symbols-outlined",children:"folder_open"})}),m.jsx("button",{onClick:_=>w(_,C.id),className:"p-1.5 rounded-lg text-slate-600 hover:text-red-400 hover:bg-red-400/10 transition-all opacity-0 group-hover:opacity-100",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})})]}),m.jsxs("div",{children:[m.jsx("h3",{className:"text-xl font-serif font-bold text-slate-100 group-hover:text-primary transition-colors line-clamp-2",children:C.titulo||n("common.no_results")}),m.jsxs("p",{className:"text-[10px] text-slate-500 font-mono mt-1",children:["ID: #",C.id]})]})]}),m.jsxs("div",{className:"flex items-center gap-2 pt-4 border-t border-white/5 opacity-50 group-hover:opacity-100 transition-opacity",children:[m.jsx("span",{className:"material-symbols-outlined text-sm text-primary",children:"auto_stories"}),m.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest text-slate-400",children:n("writing.open_archivador")})]})]},C.id))}),c&&m.jsx("div",{className:"fixed inset-0 z-[100] bg-black/80 backdrop-blur-sm flex items-center justify-center p-4",children:m.jsxs("div",{className:"bg-surface-dark border border-white/10 rounded-[2rem] p-10 w-full max-w-lg shadow-2xl animate-in zoom-in-95 duration-300",children:[m.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[m.jsx("div",{className:"size-12 rounded-2xl bg-primary flex items-center justify-center text-white shadow-xl shadow-primary/30",children:m.jsx("span",{className:"material-symbols-outlined",children:"create_new_folder"})}),m.jsxs("div",{children:[m.jsx("h2",{className:"text-2xl font-serif font-bold text-white",children:n("writing.new_archivador_title")}),m.jsx("p",{className:"text-[10px] text-slate-500 uppercase font-black tracking-widest",children:n("writing.library_expansion")})]})]}),m.jsxs("form",{onSubmit:S,className:"space-y-6",children:[m.jsxs("div",{className:"space-y-2",children:[m.jsx("label",{className:"text-[10px] uppercase font-black text-slate-500 tracking-[0.2em] ml-2",children:n("writing.book_title_label")}),m.jsx("input",{autoFocus:!0,className:"w-full bg-white/5 border border-white/10 rounded-2xl px-6 py-4 text-white focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all placeholder:text-slate-700",placeholder:n("writing.placeholder_title"),value:p,onChange:C=>g(C.target.value),required:!0})]}),m.jsxs("div",{className:"flex gap-4 pt-4",children:[m.jsx("button",{type:"button",onClick:()=>f(!1),className:"flex-1 py-4 text-slate-400 hover:text-white font-black uppercase text-[10px] tracking-widest transition-colors",children:n("writing.cancel_btn")}),m.jsx("button",{type:"submit",className:"flex-[2] py-4 bg-primary hover:bg-primary-dark text-white rounded-2xl font-black uppercase text-[10px] tracking-widest shadow-xl shadow-primary/20 hover:scale-[1.02] active:scale-95 transition-all",children:n("writing.create_and_open_btn")})]})]})]})})]})};function qie(){const{id:t}=Va();Ga();const[e,r]=ne.useState([]),[n,i]=ne.useState(!0),[a,s]=ne.useState(null);ne.useEffect(()=>{o()},[t]);const o=async()=>{try{i(!0);const c=await $e.get("/api/papelera/items");r(c),s(null)}catch(c){console.error("Error loading trash:",c),s("Failed to load trash items.")}finally{i(!1)}},l=async(c,f)=>{try{await $e.post(`/api/papelera/restaurar/${c}/${f}`),o()}catch(p){console.error("Restoration failed",p)}},u=async(c,f)=>{if(window.confirm("Are you sure you want to PERMANENTLY delete this item? This cannot be undone."))try{await $e.delete(`/api/papelera/eliminar/${c}/${f}`),o()}catch(p){console.error("Deletion failed",p)}};return n?m.jsx("div",{className:"text-white p-8",children:"Loading Trash Bin..."}):m.jsxs("div",{className:"flex flex-col h-full bg-[#09090b] text-white p-8 overflow-y-auto",children:[m.jsx("h1",{className:"text-3xl font-light mb-2 text-white/90",children:"Trash Bin"}),m.jsx("p",{className:"text-white/50 mb-8 font-light text-sm",children:"Items are automatically deleted after 30 days."}),a&&m.jsx("div",{className:"bg-red-500/10 border border-red-500/20 text-red-400 p-4 rounded mb-6",children:a}),e.length===0?m.jsxs("div",{className:"flex flex-col items-center justify-center py-20 opacity-50 border border-dashed border-white/10 rounded-xl",children:[m.jsx("span",{className:"material-symbols-outlined text-4xl mb-2",children:"delete_outline"}),m.jsx("p",{children:"Trash is empty"})]}):m.jsx("div",{className:"bg-zinc-900/50 rounded-xl border border-white/5 overflow-hidden",children:m.jsxs("table",{className:"w-full text-left border-collapse",children:[m.jsx("thead",{children:m.jsxs("tr",{className:"border-b border-white/5 text-xs text-white/40 uppercase tracking-wider",children:[m.jsx("th",{className:"p-4 font-normal",children:"Name"}),m.jsx("th",{className:"p-4 font-normal",children:"Type"}),m.jsx("th",{className:"p-4 font-normal",children:"Deleted Date"}),m.jsx("th",{className:"p-4 font-normal text-right",children:"Actions"})]})}),m.jsx("tbody",{className:"divide-y divide-white/5",children:e.map(c=>m.jsxs("tr",{className:"hover:bg-white/5 transition-colors",children:[m.jsx("td",{className:"p-4 text-white/80 font-medium",children:c.nombre||"Untitled"}),m.jsx("td",{className:"p-4 text-white/50 text-sm",children:c.tipo}),m.jsx("td",{className:"p-4 text-white/50 text-sm font-mono",children:c.deleted_date?new Date(c.deleted_date).toLocaleDateString():"-"}),m.jsxs("td",{className:"p-4 text-right space-x-2",children:[m.jsx("button",{onClick:()=>l(c.tipo,c.id),className:"px-3 py-1.5 text-xs bg-emerald-500/10 text-emerald-400 hover:bg-emerald-500/20 rounded-md transition-colors border border-emerald-500/20",children:"RESTORE"}),m.jsx("button",{onClick:()=>u(c.tipo,c.id),className:"px-3 py-1.5 text-xs bg-red-500/10 text-red-400 hover:bg-red-500/20 rounded-md transition-colors border border-red-500/20",children:"DELETE"})]})]},`${c.tipo}-${c.id}`))})]})})]})}const $ie=({attribute:t,value:e,onChange:r,onRemove:n,linkableEntities:i=[]})=>{const a=t.plantilla||t,s=()=>{switch(a.tipo){case"text":return m.jsx("textarea",{className:"w-full bg-transparent text-white text-sm font-medium focus:outline-none resize-none no-scrollbar h-auto min-h-[100px]",value:e||"",onChange:p=>r(p.target.value),placeholder:"..."});case"short_text":return m.jsx("input",{type:"text",className:"w-full bg-transparent text-white text-sm font-medium focus:outline-none",value:e||"",onChange:p=>r(p.target.value),placeholder:"..."});case"number":return m.jsx("input",{type:"number",className:"w-full bg-transparent text-white text-sm font-medium focus:outline-none",value:e||"",onChange:p=>r(p.target.value)});case"boolean":return m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsx("button",{onClick:()=>r(e==="true"?"false":"true"),className:`size-6 rounded-lg border flex items-center justify-center transition-all ${e==="true"?"bg-primary border-primary text-white":"border-glass-border text-transparent hover:border-primary/50"}`,children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"check"})}),m.jsx("span",{className:"text-xs text-text-muted",children:e==="true"?"Enabled":"Disabled"})]});case"select":let o=[];try{o=(typeof a.metadata=="string"?JSON.parse(a.metadata||"{}"):a.metadata||{}).options||[]}catch{}return m.jsxs("div",{className:"relative",children:[m.jsxs("select",{className:"w-full bg-black/30 border border-white/5 rounded-xl px-4 py-2.5 text-sm text-white focus:outline-none focus:border-primary/50 appearance-none cursor-pointer",value:e||"",onChange:p=>r(p.target.value),children:[m.jsx("option",{value:"",className:"bg-[#1a1a20] text-white",children:"Select an option..."}),o.map((p,g)=>m.jsx("option",{value:p,className:"bg-surface-dark text-white p-2",children:p},g))]}),m.jsx("div",{className:"absolute right-4 top-1/2 -translate-y-1/2 pointer-events-none text-white/50",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"unfold_more"})})]});case"multi_select":let l=[];try{l=(typeof a.metadata=="string"?JSON.parse(a.metadata||"{}"):a.metadata||{}).options||[]}catch{}let u=[];try{u=e?JSON.parse(e):[],Array.isArray(u)||(u=[])}catch(p){console.error("Error parsing select values",p)}const c=p=>{const g=u.includes(p)?u.filter(y=>y!==p):[...u,p];r(JSON.stringify(g))};return m.jsxs("div",{className:"bg-black/20 border border-white/5 rounded-xl p-2 space-y-1 max-h-40 overflow-y-auto custom-scrollbar",children:[l.map((p,g)=>m.jsxs("label",{onClick:y=>{y.preventDefault(),c(p)},className:"flex items-center gap-3 p-2 hover:bg-white/5 rounded-lg cursor-pointer group transition-colors",children:[m.jsx("div",{className:`size-4 rounded border flex items-center justify-center transition-all ${u.includes(p)?"bg-primary border-primary":"border-white/10 group-hover:border-white/30"}`,children:u.includes(p)&&m.jsx("span",{className:"material-symbols-outlined text-[10px] text-white",children:"check"})}),m.jsx("span",{className:`text-xs font-medium ${u.includes(p)?"text-white":"text-slate-400 group-hover:text-slate-200"}`,children:p})]},g)),l.length===0&&m.jsx("div",{className:"text-xs text-slate-500 p-2 italic",children:"No options defined."})]});case"date":return m.jsx("input",{type:"date",className:"w-full bg-transparent text-white text-sm font-medium focus:outline-none [color-scheme:dark]",value:e||"",onChange:p=>r(p.target.value)});case"entity_link":return m.jsxs("div",{className:"relative",children:[m.jsxs("select",{className:"w-full bg-black/30 border border-white/5 rounded-xl px-4 py-2.5 text-sm text-white focus:outline-none focus:border-primary/50 appearance-none cursor-pointer",value:e||"",onChange:p=>r(p.target.value),children:[m.jsx("option",{value:"",className:"bg-[#1a1a20] text-white",children:"Select an Entity Link..."}),i.map(p=>m.jsx("option",{value:p.id,className:"bg-surface-dark text-white p-2",children:p.nombre},p.id))]}),m.jsx("div",{className:"absolute right-4 top-1/2 -translate-y-1/2 pointer-events-none text-white/50",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"link"})})]});case"image":return m.jsxs("div",{className:"space-y-2",children:[m.jsx("div",{className:"flex gap-2",children:m.jsx("input",{type:"text",className:"flex-1 bg-black/30 border border-white/5 rounded-xl px-4 py-2 text-xs text-text-muted focus:text-white focus:outline-none",placeholder:"Image URL...",value:e||"",onChange:p=>r(p.target.value)})}),e&&m.jsx("div",{className:"w-full aspect-video rounded-xl bg-black/40 border border-white/5 overflow-hidden relative group",children:m.jsx("img",{src:e,alt:"Preview",className:"w-full h-full object-cover opacity-80 group-hover:opacity-100 transition-opacity"})}),!e&&m.jsx("div",{className:"w-full h-20 rounded-xl bg-white/5 border border-dashed border-white/10 flex items-center justify-center text-text-muted/30",children:m.jsx("span",{className:"material-symbols-outlined",children:"image"})})]});case"table":const f=e||"[]";return m.jsxs("div",{className:"space-y-2",children:[m.jsx("textarea",{className:"w-full h-32 bg-black/30 border border-white/5 rounded-xl p-3 text-xs font-mono text-white/70 focus:outline-none focus:border-primary/50",value:f,onChange:p=>r(p.target.value),placeholder:'[{"Item": "Sword", "Qty": 1}, ...]'}),m.jsxs("div",{className:"text-[10px] text-text-muted flex justify-between",children:[m.jsx("span",{children:"JSON Format supported"}),m.jsx("span",{className:"material-symbols-outlined text-xs",children:"data_array"})]})]});default:return m.jsxs("div",{className:"text-sm font-medium text-white/70 italic p-2 rounded-lg bg-white/5 border border-white/5",children:[m.jsx("span",{className:"text-[10px] uppercase font-bold text-slate-500 mr-2",children:a.tipo}),e]})}};return m.jsxs("div",{className:"p-4 border border-white/5 rounded-2xl bg-surface-dark/50 backdrop-blur-sm relative overflow-hidden h-full flex flex-col group hover:border-primary/20 transition-all",children:[m.jsxs("label",{className:"text-[10px] font-black uppercase tracking-widest text-text-muted mb-3 flex items-center justify-between gap-2",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-xs opacity-50",children:"label"}),a.nombre]}),n&&m.jsx("button",{onClick:o=>{o.preventDefault(),n()},className:"text-white/20 hover:text-red-400 transition-colors",title:"Remove Attribute",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"close"})})]}),m.jsx("div",{className:"flex-1 nodrag",children:s()}),m.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-primary/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none"})]})},Kie=({templates:t,onAddTemplate:e,currentFields:r=[]})=>{const{t:n}=Ps(),[i,a]=ne.useState(""),[s,o]=ne.useState(!1),[l,u]=ne.useState({label:"",tipo:"text"}),c=(t||[]).filter(g=>g.label?.toLowerCase().includes(i.toLowerCase())||g.code?.toLowerCase().includes(i.toLowerCase())),f=(g,y)=>{g.dataTransfer.setData("application/reactflow/type","attribute"),g.dataTransfer.setData("templateId",y.id.toString()),g.dataTransfer.setData("templateData",JSON.stringify(y)),g.dataTransfer.effectAllowed="copy"},p=()=>{l.label.trim()&&(e({...l,id:Date.now(),code:l.label.toLowerCase().replace(/\s+/g,"_")}),u({label:"",tipo:"text"}),o(!1))};return m.jsxs("div",{className:"flex flex-col h-full bg-surface-dark border-l border-glass-border w-full animate-in slide-in-from-right duration-500",children:[m.jsxs("div",{className:"p-6 border-b border-white/5 bg-gradient-to-br from-primary/10 to-transparent",children:[m.jsxs("div",{className:"flex items-center justify-between mb-2",children:[m.jsxs("h3",{className:"text-xs font-black uppercase tracking-widest text-primary flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"schema"})," ",n("builder.templates")||"Templates"]}),m.jsx("button",{onClick:()=>o(!s),className:`size-8 rounded-full flex items-center justify-center transition-all ${s?"bg-red-500 text-white rotate-45":"bg-white/5 text-primary hover:bg-primary hover:text-white"}`,children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"add"})})]}),s?m.jsxs("div",{className:"space-y-3 p-4 rounded-2xl bg-black/40 border border-primary/20 animate-in fade-in zoom-in-95",children:[m.jsx("input",{autoFocus:!0,placeholder:"Nombre del atributo...",className:"w-full bg-transparent border-b border-white/10 py-1 text-xs text-white outline-none focus:border-primary",value:l.label,onChange:g=>u({...l,label:g.target.value})}),m.jsxs("select",{className:"w-full bg-black/50 border border-white/10 rounded-lg px-2 py-1.5 text-[10px] text-white/70 outline-none",value:l.tipo,onChange:g=>u({...l,tipo:g.target.value}),children:[m.jsx("option",{value:"text",children:"Texto Largo"}),m.jsx("option",{value:"short_text",children:"Texto Corto"}),m.jsx("option",{value:"number",children:"Nmero"}),m.jsx("option",{value:"boolean",children:"Booleano"}),m.jsx("option",{value:"date",children:"Fecha"}),m.jsx("option",{value:"select",children:"Seleccin nica"})]}),m.jsx("button",{onClick:p,className:"w-full py-2 bg-primary text-white rounded-lg text-[10px] font-black uppercase tracking-widest shadow-lg shadow-primary/20",children:"Crear Plantilla"})]}):m.jsxs("div",{className:"relative",children:[m.jsx("span",{className:"material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-xs text-text-muted",children:"search"}),m.jsx("input",{type:"text",placeholder:n("common.search"),className:"w-full bg-black/20 border border-white/5 rounded-xl pl-9 pr-4 py-2 text-xs text-white focus:border-primary/50 outline-none transition-all placeholder:text-white/10",value:i,onChange:g=>a(g.target.value)})]})]}),r.length>0&&m.jsxs("div",{className:"space-y-2 p-6 pt-0",children:[m.jsxs("div",{className:"flex items-center gap-2 text-slate-500 px-1",children:[m.jsx("span",{className:"material-symbols-outlined text-xs",children:"summary"}),m.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest",children:"Active Attributes"})]}),m.jsx("div",{className:"max-h-48 overflow-y-auto custom-scrollbar space-y-1 bg-white/[0.02] rounded-xl p-2 border border-white/5",children:r.map(g=>m.jsxs("div",{className:"flex flex-col p-1.5 rounded bg-white/5 border border-white/5",children:[m.jsx("span",{className:"text-[9px] font-bold text-primary uppercase tracking-tighter truncate",children:g.attribute?.nombre||"Unnamed"}),m.jsx("span",{className:"text-[10px] text-slate-300 truncate",children:typeof g.value=="string"&&g.value.startsWith("[")?"Multiple Values":g.value||"---"})]},g.id))})]}),m.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar space-y-2 pr-1",children:c.length===0?m.jsx("div",{className:"text-center py-8 text-slate-600 text-xs italic",children:"No templates found."}):c.map(g=>m.jsxs("div",{draggable:!0,onDragStart:y=>f(y,g),className:"bg-[#1a1a20] hover:bg-white/5 border border-white/5 hover:border-white/20 rounded-lg p-3 cursor-grab active:cursor-grabbing transition-all group",children:[m.jsxs("div",{className:"flex items-center justify-between mb-1",children:[m.jsx("span",{className:"text-xs font-bold text-slate-200 group-hover:text-primary",children:g.label}),m.jsx("span",{className:"material-symbols-outlined text-slate-600 text-xs",children:"drag_pan"})]}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("div",{className:`text-[8px] font-black px-1.5 py-0.5 rounded uppercase tracking-wider ${g.tipoDato==="text"?"bg-blue-500/20 text-blue-300":g.tipoDato==="number"?"bg-emerald-500/20 text-emerald-300":g.tipoDato==="boolean"?"bg-purple-500/20 text-purple-300":"bg-slate-500/20 text-slate-300"}`,children:g.tipoDato}),g.esObligatorio&&m.jsx("span",{className:"text-[8px] font-black text-rose-400 uppercase",children:"*Req"})]})]},g.id))}),m.jsx("div",{className:"pt-2 border-t border-white/5 text-center",children:m.jsx("p",{className:"text-[10px] text-slate-600",children:"Manage templates in Bible Settings"})})]})},Wg=({mode:t})=>{const{username:e,projectName:r,entitySlug:n,folderSlug:i,type:a}=Va(),s=Ga(),o=t==="creation",{setRightOpen:l,setRightPanelTab:u,setAvailableTemplates:c,setAddAttributeHandler:f}=bo(),[p,g]=ne.useState({nombre:"",tipo:"entidadindividual",descripcion:"",color:"#6366f1",apariencia:"",notas:"",iconUrl:null,tipoEspecial:a||null,carpeta:null,categoria:"Individual"}),[y,S]=ne.useState([]),[w,C]=ne.useState(!0),[_,T]=ne.useState(!1),[N,R]=ne.useState([]),[D,j]=ne.useState([]),[O,F]=ne.useState("identity"),[z,G]=ne.useState(!1),[Z,I]=ne.useState(null),[W,U]=ne.useState(null);ne.useEffect(()=>{l(!0),u&&u("CONTEXT");const se=setInterval(()=>{const he=document.getElementById("global-right-panel-portal");he&&(U(he),clearInterval(se))},100);return()=>{clearInterval(se),u&&u("NOTEBOOKS")}},[]),ne.useEffect(()=>{o?$():Q()},[n,i,o]);const K=se=>{c(se),j(se),f(he=>{const ae=se.find(pe=>pe.id===he);ae&&S(pe=>[...pe,{id:`temp-${ae.id}-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,attribute:ae,value:ae.valorDefecto||"",isTemp:!0}])})},$=async()=>{C(!0);try{const se=await $e.get(`/world-bible/folders/${i}`),he=await $e.get(`/world-bible/folders/${i}/templates`);K(he),g(pe=>({...pe,nombre:`Nuevo ${a==="map"?"Mapa":a==="timeline"?"Cronograma":"Ente"}`,carpeta:se,tipoEspecial:a||"entidadindividual",tipo:a||"entidadindividual"}));const ae=he.filter(pe=>pe.esObligatorio).map(pe=>({id:`temp-${pe.id}-${Math.random().toString(36).substr(2,9)}`,attribute:pe,value:pe.valorDefecto||"",isTemp:!0}));S(ae)}catch(se){console.error("Error creating draft:",se)}finally{C(!1)}},Q=async()=>{C(!0);try{const se=await $e.get(`/world-bible/entities/${n}`);if(g({...se,apariencia:se.apariencia||"",notas:se.notas||"",iconUrl:se.iconUrl||null,tags:se.tags||"",tipo:se.tipoEspecial||Zie(se.tipo).id,color:se.color||"#6366f1",categoria:se.categoria||"Individual",attributes:se.attributes||{}}),se.carpeta?.id){const ae=await $e.get(`/world-bible/folders/${se.carpeta.id}/templates`);K(ae)}const he=(se.valores||[]).filter(ae=>ae.plantilla).map(ae=>({id:ae.id.toString(),attribute:ae.plantilla,value:ae.valor,isTemp:!1}));S(he)}catch(se){console.error("Error loading entity:",se)}finally{C(!1)}},ie=se=>{const he=Array.from(se.target.files);he.length!==0&&(he.forEach(ae=>{const pe=new FileReader;pe.onload=ye=>{const ve=ye.target.result,ue=p.attributes?.images||[];g(xe=>({...xe,attributes:{...xe.attributes,images:[...ue,ve]}}))},pe.readAsDataURL(ae)}),se.target.value=null)},te=se=>{const he=[...p.attributes?.images||[]];he.splice(se,1),g(ae=>({...ae,attributes:{...ae.attributes,images:he}}))},X=(se,he)=>{g(ae=>({...ae,[se]:he}))},re=(se,he)=>{S(ae=>ae.map(pe=>pe.id===se?{...pe,value:he}:pe))},fe=se=>{se.toString().startsWith("temp-")||R(he=>[...he,se]),S(he=>he.filter(ae=>ae.id!==se))},oe=async(se=!0)=>{T(!0);try{const he={nombre:p.nombre,descripcion:p.descripcion,tags:p.tags,apariencia:p.apariencia,notas:p.notas,iconUrl:p.iconUrl,tipoEspecial:p.tipoEspecial||"entidadindividual",color:p.color,categoria:p.categoria,attributes:p.attributes};let ae=p.id;if(o){if(!p.carpeta&&!i){alert("Error: Missing context (no folder). Redirecting."),s(`/${e}/${r}/bible`);return}if(he.carpetaId=p.carpeta?.id,!he.carpetaId&&i)try{const Se=await $e.get(`/world-bible/folders/${i}`);he.carpetaId=Se.id}catch(Se){console.error("Could not resolve folder",Se)}const ue=await $e.post("/world-bible/entities",he);ae=ue.id;const xe=[...y];for(let Se=0;Se<xe.length;Se++){const Ae=xe[Se];if(Ae.isTemp)try{const Me=await $e.post(`/world-bible/entities/${ue.id}/attributes`,{plantillaId:Ae.attribute.id});await $e.patch(`/world-bible/entities/${ue.id}/values`,[{valorId:Me.id,nuevoValor:Ae.value}]),xe[Se]={...Ae,id:Me.id.toString(),isTemp:!1}}catch(Me){console.error("Attr save failed",Me)}}if(S(xe),T(!1),se){const Se=ue.carpeta?ue.carpeta.slug||ue.carpeta.id:i;s(`/${e}/${r}/bible/folder/${Se}`)}else{const Se=ue.carpeta?ue.carpeta.slug||ue.carpeta.id:i;s(`/${e}/${r}/bible/folder/${Se}/entity/${ue.slug||ue.id}`,{replace:!0})}return}await $e.put(`/world-bible/entities/${ae}`,{nombre:he.nombre,color:he.color,iconUrl:he.iconUrl}),await $e.patch(`/world-bible/entities/${ae}/details`,{descripcion:he.descripcion,tags:he.tags,apariencia:he.apariencia,notas:he.notas,iconUrl:he.iconUrl,attributes:he.attributes}),N.length>0&&(await Promise.all(N.map(ue=>$e.delete(`/world-bible/values/${ue}`))),R([]));const pe=y.filter(ue=>!ue.isTemp).map(ue=>({valorId:parseInt(ue.id),nuevoValor:ue.value}));pe.length>0&&await $e.patch(`/world-bible/entities/${ae}/values`,pe);let ye=!1;const ve=[...y];for(let ue=0;ue<ve.length;ue++){const xe=ve[ue];if(xe.isTemp)try{const Se=await $e.post(`/world-bible/entities/${ae}/attributes`,{plantillaId:xe.attribute.id});await $e.patch(`/world-bible/entities/${ae}/values`,[{valorId:Se.id,nuevoValor:xe.value}]),ve[ue]={...xe,id:Se.id.toString(),isTemp:!1},ye=!0}catch(Se){console.error("Error saving field:",xe,Se)}}if(ye&&S(ve),T(!1),se){const xe=i||(p.carpeta?p.carpeta.slug||p.carpeta.id:"root")||"root";s(`/${e}/${r}/bible/folder/${xe}`)}}catch(he){console.error("Save error",he),T(!1)}};return w?m.jsx("div",{className:"p-20 text-center animate-pulse",children:"Loading Builder..."}):m.jsx("div",{className:"flex h-full w-full bg-background-dark overflow-hidden",children:m.jsxs("div",{className:"flex-1 flex flex-col min-w-0 overflow-y-auto custom-scrollbar relative",children:[m.jsxs("div",{className:"border-b border-white/5 p-4 flex justify-between items-center bg-background-dark/80 backdrop-blur sticky top-0 z-30",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx(e_,{url:p.iconUrl,name:p.nombre,className:"size-10 rounded-lg border border-white/10"}),m.jsxs("div",{children:[m.jsx("h1",{className:"text-lg font-bold text-white leading-tight",children:p.nombre||"Sin Nombre"}),m.jsx("span",{className:"text-[10px] uppercase font-black tracking-widest text-slate-500",children:o?"Creando Nueva Entidad":"Editando Entidad"})]})]}),m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsx("button",{onClick:()=>s(`/${e}/${r}/bible/folder/${i}`),className:"px-4 py-2 rounded-xl text-slate-400 hover:text-primary hover:bg-primary/5 text-xs font-bold uppercase tracking-widest transition-all",children:"Cancelar"}),m.jsxs("div",{className:"flex bg-white/5 rounded-xl p-1 gap-1 border border-white/10",children:[m.jsxs("button",{onClick:()=>oe(!0),disabled:_,className:"h-9 px-4 rounded-lg bg-primary hover:bg-primary-light text-white text-[10px] font-black uppercase tracking-widest transition-all flex items-center gap-2 disabled:opacity-50",children:[_?m.jsx("span",{className:"material-symbols-outlined animate-spin text-sm",children:"refresh"}):m.jsx("span",{className:"material-symbols-outlined text-sm",children:"save"}),"Guardar"]}),m.jsx("div",{className:"w-px bg-white/10 my-1"}),m.jsx("button",{onClick:()=>oe(!1),disabled:_,className:"h-9 px-3 rounded-lg bg-transparent hover:bg-white/10 text-white transition-all flex items-center justify-center disabled:opacity-50",title:"Guardar y Seguir Editando",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"edit_document"})})]})]})]}),W&&eo.createPortal(m.jsx(Kie,{templates:D,currentFields:y,onAddTemplate:se=>{S(he=>[...he,{id:`temp-${se.id}-${Date.now()}`,attribute:se,value:se.valorDefecto||"",isTemp:!0}])}}),W),m.jsx("div",{className:"flex border-b border-white/5 px-8 gap-6 bg-background-dark/80 backdrop-blur sticky top-[73px] z-20",children:["identity","narrative","attributes"].map(se=>m.jsx("button",{onClick:()=>F(se),className:`py-4 text-[10px] font-black uppercase tracking-widest border-b-2 transition-colors ${O===se?"border-primary text-primary":"border-transparent text-slate-500 hover:text-primary"}`,children:se},se))}),m.jsxs("div",{className:"p-8 pb-32 max-w-5xl mx-auto w-full",children:[O==="identity"&&m.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 items-start",children:[m.jsxs("div",{className:"space-y-6",children:[m.jsx(Kn,{title:"IDENTITY",icon:"fingerprint",children:m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{children:[m.jsxs("label",{className:"text-xs font-black uppercase text-primary mb-3 block tracking-wider flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-base",children:"badge"}),"Nombre Principal"]}),m.jsx("input",{type:"text",className:"w-full bg-gradient-to-br from-indigo-950/90 to-purple-950/90 border-2 border-indigo-500/50 rounded-2xl p-5 text-2xl font-black text-white focus:border-indigo-400 focus:from-indigo-950 focus:to-purple-950 outline-none transition-all placeholder:text-slate-500 shadow-lg shadow-indigo-900/20",placeholder:"Entiende el nombre...",value:p.nombre,onChange:se=>g({...p,nombre:se.target.value})})]}),m.jsxs("div",{children:[m.jsxs("label",{className:"text-xs font-black uppercase text-purple-400 mb-3 block tracking-wider flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-base",children:"category"}),"Categora / Tags"]}),m.jsxs("select",{className:"w-full bg-gradient-to-r from-purple-950/90 to-indigo-950/90 border-2 border-purple-500/50 rounded-xl px-4 py-3 text-sm text-white font-bold focus:border-purple-400 focus:from-purple-950 focus:to-indigo-950 outline-none transition-all cursor-pointer shadow-md",value:p.categoria,onChange:se=>g({...p,categoria:se.target.value}),children:[m.jsx("option",{value:"Individual",className:"bg-slate-900",children:" Individual"}),m.jsx("option",{value:"Lugar",className:"bg-slate-900",children:" Lugar"}),m.jsx("option",{value:"Organizacin",className:"bg-slate-900",children:" Organizacin"}),m.jsx("option",{value:"Objeto",className:"bg-slate-900",children:" Objeto"}),m.jsx("option",{value:"Concepto",className:"bg-slate-900",children:" Concepto"}),m.jsx("option",{value:"Evento",className:"bg-slate-900",children:" Evento"}),m.jsx("option",{value:"Criatura",className:"bg-slate-900",children:" Criatura"}),m.jsx("option",{value:"Faccin",className:"bg-slate-900",children:" Faccin"})]})]}),m.jsxs("div",{children:[m.jsxs("label",{className:"text-xs font-black uppercase text-slate-400 mb-3 block tracking-wider flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-base",children:"description"}),"Resumen Breve"]}),m.jsx("textarea",{className:"w-full bg-slate-950/90 border-2 border-slate-600/60 rounded-xl p-5 text-sm text-slate-100 leading-relaxed min-h-[120px] outline-none focus:border-slate-500 focus:bg-slate-950 transition-all resize-none custom-scrollbar shadow-inner",placeholder:"Describe brevemente quin o qu es...",value:p.descripcion,onChange:se=>g({...p,descripcion:se.target.value})})]})]})}),m.jsx(Kn,{title:"APARIENCIA FSICA",icon:"accessibility_new",children:m.jsx("textarea",{className:"w-full bg-slate-950/90 border-2 border-slate-600/60 rounded-xl p-6 text-sm text-slate-100 leading-relaxed min-h-[280px] outline-none focus:border-slate-500 focus:bg-slate-950 transition-all resize-none custom-scrollbar shadow-inner",placeholder:"Detalles de su aspecto fsico, vestimenta, rasgos distintivos...",value:p.attributes?.appearance||"",onChange:se=>g({...p,attributes:{...p.attributes,appearance:se.target.value}})})})]}),m.jsxs("div",{className:"space-y-6",children:[m.jsx(Kn,{title:"GALLERY",icon:"photo_library",children:m.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[p.attributes?.images?.map((se,he)=>m.jsxs("div",{className:"aspect-square rounded-xl bg-black/40 border border-white/5 overflow-hidden relative group cursor-pointer",onClick:()=>I(se),children:[m.jsx("img",{src:se,className:"w-full h-full object-cover opacity-80 group-hover:opacity-100 group-hover:scale-110 transition-all duration-500",alt:"Gallery"}),m.jsx("button",{onClick:ae=>{ae.stopPropagation(),te(he)},className:"absolute top-1 right-1 size-6 bg-red-500 text-white rounded-lg flex items-center justify-center translate-y-[-120%] group-hover:translate-y-0 transition-transform shadow-lg",children:m.jsx("span",{className:"material-symbols-outlined text-xs",children:"close"})})]},he)),m.jsxs("label",{className:"aspect-square rounded-xl border-2 border-dashed border-white/10 flex flex-col items-center justify-center gap-2 hover:bg-white/5 hover:border-primary/50 transition-all cursor-pointer group",children:[m.jsx("span",{className:"material-symbols-outlined text-text-muted group-hover:text-primary transition-colors",children:"add_photo_alternate"}),m.jsx("span",{className:"text-[8px] font-black uppercase text-text-muted group-hover:text-primary",children:"Upload Photos"}),m.jsx("input",{type:"file",multiple:!0,className:"hidden",onChange:ie,accept:"image/*"})]})]})}),m.jsx(Kn,{title:"NOTES",icon:"sticky_note_2",children:m.jsx("textarea",{className:"w-full bg-amber-950/90 border-2 border-amber-700/60 rounded-xl p-5 text-sm text-amber-100 leading-relaxed min-h-[200px] outline-none focus:border-amber-600 focus:bg-amber-950 transition-all resize-none custom-scrollbar shadow-inner",placeholder:"Apuntes rpidos, secretos o ideas sueltas...",value:p.attributes?.notes||"",onChange:se=>g({...p,attributes:{...p.attributes,notes:se.target.value}})})})]})]}),O==="narrative"&&m.jsxs("div",{className:"animate-in fade-in duration-500 space-y-8",children:[m.jsxs(Kn,{className:"min-h-[40vh] flex flex-col p-8",children:[m.jsxs("div",{className:"flex items-center justify-between mb-6",children:[m.jsxs("h3",{className:"text-xs font-black uppercase tracking-widest text-primary flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"history_edu"})," Biography"]}),m.jsx("span",{className:"text-[10px] text-slate-500 bg-white/5 px-2 py-1 rounded",children:"Markdown Supported"})]}),m.jsx("textarea",{className:"flex-1 w-full bg-slate-950/90 border-2 border-slate-600/60 rounded-xl p-6 text-slate-100 leading-relaxed resize-none focus:border-slate-500 focus:bg-slate-950 outline-none placeholder:text-slate-600 custom-scrollbar text-base min-h-[320px] shadow-inner",placeholder:"Write the origin story...",value:p.descripcion||"",onChange:se=>X("descripcion",se.target.value)})]}),m.jsxs(Kn,{className:"min-h-[40vh]",children:[m.jsxs("h3",{className:"text-xs font-black uppercase tracking-widest text-primary p-6 pb-0 flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"hub"})," Relationships"]}),o?m.jsxs("div",{className:"p-12 text-center text-slate-500",children:[m.jsx("span",{className:"material-symbols-outlined text-4xl mb-4",children:"save_as"}),m.jsx("p",{className:"text-sm font-bold",children:"Please save the entity first to manage relationships."})]}):m.jsx(vG,{entityId:p.id,entityType:p.tipo||"entidadindividual"})]})]}),O==="attributes"&&m.jsxs("div",{className:`animate-in fade-in duration-500 space-y-6 min-h-[50vh] transition-colors rounded-2xl p-4 ${window.isDraggingOver?"bg-primary/10 border-2 border-dashed border-primary":""}`,onDragOver:se=>{se.preventDefault(),se.dataTransfer.dropEffect="copy",se.currentTarget.classList.add("bg-primary/10","border-primary","border-dashed","border-2")},onDragLeave:se=>{se.preventDefault(),se.currentTarget.classList.remove("bg-primary/10","border-primary","border-dashed","border-2")},onDrop:se=>{if(se.preventDefault(),se.currentTarget.classList.remove("bg-primary/10","border-primary","border-dashed","border-2"),se.dataTransfer.getData("application/reactflow/type")!=="attribute")return;let ae=null;try{const pe=se.dataTransfer.getData("templateData");if(pe)ae=JSON.parse(pe);else{const ye=parseInt(se.dataTransfer.getData("templateId"));ae=D.find(ve=>ve.id===ye)}}catch(pe){console.error("Drop error",pe)}ae&&S(pe=>[...pe,{id:`temp-${ae.id}-${Date.now()}`,attribute:ae,value:ae.valorDefecto||"",isTemp:!0}])},children:[m.jsxs("h3",{className:"text-xs font-black uppercase tracking-widest text-primary border-b border-white/5 pb-4 flex items-center justify-between",children:[m.jsx("span",{children:"Atributos especiales"}),m.jsx("span",{className:"text-[10px] text-slate-500 font-normal normal-case opacity-50 hidden md:block",children:"Arraste atributos desde el panel derecho"})]}),m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 p-4 border-2 border-dashed border-white/5 rounded-2xl hover:border-primary/20 transition-colors bg-white/[0.01]",children:[y.length===0&&m.jsxs("div",{className:"col-span-full py-12 text-center text-slate-500 text-sm pointer-events-none",children:[m.jsx("span",{className:"material-symbols-outlined text-4xl mb-2 opacity-50",children:"drag_indicator"}),m.jsx("p",{children:"Arrastra plantillas aqu para aadir atributos"})]}),y.filter(se=>se.attribute).map(se=>m.jsx($ie,{attribute:se.attribute,value:se.value,onChange:he=>re(se.id,he),onRemove:()=>fe(se.id)},se.id))]})]})]}),z&&p.iconUrl&&m.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/90 backdrop-blur-sm animate-in fade-in duration-300",onClick:()=>G(!1),children:m.jsxs("div",{className:"relative max-w-[90vw] max-h-[90vh] p-2",children:[m.jsx("button",{onClick:()=>G(!1),className:"absolute -top-12 right-0 p-2 text-white hover:text-primary transition-colors",children:m.jsx("span",{className:"material-symbols-outlined text-3xl",children:"close"})}),m.jsx("img",{src:p.iconUrl,alt:p.nombre,className:"max-w-full max-h-[85vh] object-contain rounded-lg shadow-2xl border border-white/10",onClick:se=>se.stopPropagation()})]})}),Z&&m.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/95 backdrop-blur-md animate-in fade-in duration-300",onClick:()=>I(null),children:m.jsxs("div",{className:"relative max-w-[95vw] max-h-[95vh] p-4",children:[m.jsx("button",{onClick:()=>I(null),className:"absolute -top-14 right-0 p-3 text-white/80 hover:text-white hover:bg-white/10 rounded-xl transition-all",children:m.jsx("span",{className:"material-symbols-outlined text-3xl",children:"close"})}),m.jsx("img",{src:Z,alt:"Gallery Preview",className:"max-w-full max-h-[90vh] object-contain rounded-2xl shadow-2xl border-2 border-white/20",onClick:se=>se.stopPropagation()})]})})]})})},Zie=t=>({id:t,label:t}),Yie=t=>{switch(t?.toLowerCase()){case"text":return"notes";case"short_text":return"short_text";case"number":return"pin";case"date":return"calendar_today";case"select":return"list";case"boolean":return"check_box";case"map":return"map";case"timeline":return"timeline";case"character":case"entidadindividual":return"person";case"location":case"zona":case"construccion":return"location_on";case"culture":case"entidadcolectiva":return"groups";case"universe":case"galaxy":case"system":case"planet":return"public";case"entity_link":return"link";default:return"description"}},ix=({item:t,type:e,linkTo:r,onContextMenu:n,onDelete:i})=>{const a=e==="folder";return m.jsxs(hh,{to:r,onContextMenu:n,className:"group relative flex flex-col p-4 rounded-3xl bg-surface-dark border border-glass-border hover:border-primary/50 hover:bg-white/5 transition-all duration-300 backdrop-blur-sm overflow-hidden",children:[t.iconUrl&&m.jsxs(m.Fragment,{children:[m.jsx("div",{className:"absolute inset-0 z-0",children:m.jsx("img",{src:t.iconUrl,alt:"",className:"w-full h-full object-cover opacity-60 group-hover:scale-105 transition-transform duration-700"})}),m.jsx("div",{className:"absolute inset-0 z-0 bg-gradient-to-t from-[#0a0a0c] via-[#0a0a0c]/80 to-transparent"})]}),m.jsxs("div",{className:"relative z-10 flex items-start justify-between mb-4",children:[m.jsx("div",{className:`
                    size-12 rounded-2xl flex items-center justify-center text-xl transition-transform group-hover:scale-110 
                    ${a?"bg-primary/20 text-primary":"bg-white/5 text-text-muted group-hover:text-white backdrop-blur-md border border-white/5"}
                `,children:m.jsx("span",{className:"material-symbols-outlined",children:a?"folder":Yie(t.tipoEspecial)})}),a&&m.jsx("div",{className:"px-2 py-1 rounded-lg bg-surface-light/50 border border-glass-border text-[10px] font-black text-white shadow-sm backdrop-blur-md",children:t.itemCount||0})]}),m.jsxs("div",{className:"relative z-10 mt-auto",children:[m.jsx("h3",{className:"text-sm font-bold text-white truncate group-hover:text-primary transition-colors drop-shadow-md",children:t.nombre}),m.jsx("p",{className:"text-[10px] font-bold uppercase tracking-widest text-text-muted mt-1 opacity-70 group-hover:opacity-100 transition-opacity",children:a?"Folder":t.tipoEspecial||"Entity"})]}),m.jsxs("div",{className:"absolute top-4 right-4 z-20 flex items-center gap-2 opacity-0 group-hover:opacity-100 transition-opacity duration-300",children:[i&&m.jsx("button",{onClick:s=>{s.preventDefault(),s.stopPropagation(),i(t)},className:"p-1.5 rounded-lg bg-red-500/10 hover:bg-red-500 text-red-500 hover:text-white transition-all border border-red-500/20 shadow-lg shadow-red-500/5 group/del backdrop-blur-md",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})}),m.jsx("span",{className:"material-symbols-outlined text-primary text-sm transform group-hover:translate-x-1 transition-transform drop-shadow-md",children:"arrow_forward"})]})]})},Xie=({path:t,currentFolder:e})=>{const{username:r,projectName:n}=Va(),i=`/${r}/${n}/bible`;return!t&&!e?null:m.jsxs("nav",{className:"flex items-center gap-2 text-[10px] uppercase font-bold tracking-wider text-slate-500 mb-4 overflow-x-auto no-scrollbar whitespace-nowrap",children:[m.jsxs(hh,{to:i,className:"hover:text-primary transition-colors flex items-center gap-1",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"home"}),"Bible"]}),t&&t.map((a,s)=>m.jsxs(Qt.Fragment,{children:[m.jsx("span",{className:"text-slate-700",children:"/"}),m.jsx(hh,{to:`${i}/folder/${a.slug||a.id}`,className:"hover:text-primary transition-colors",children:a.nombre})]},a.id)),e&&m.jsxs(m.Fragment,{children:[m.jsx("span",{className:"text-slate-700",children:"/"}),m.jsx("span",{className:"text-white bg-white/5 px-2 py-0.5 rounded",children:e.nombre})]})]})},Qie=({entities:t=[],onAddEvent:e})=>{const r=[...t].sort((n,i)=>n.id-i.id);return m.jsx("div",{className:"w-full max-w-3xl mx-auto p-4 animate-slide-up",children:m.jsxs("div",{className:"relative border-l-2 border-white/10 ml-6 space-y-12 py-8",children:[r.length===0&&m.jsx("div",{className:"pl-12 opacity-50",children:m.jsx("p",{className:"text-white text-sm",children:"No events recorded in this timeline yet."})}),r.map((n,i)=>m.jsxs("div",{className:"relative pl-12 group",children:[m.jsx("div",{className:"absolute left-[-9px] top-0 size-4 rounded-full bg-background-dark border-2 border-primary group-hover:scale-125 group-hover:bg-primary transition-all shadow-[0_0_10px_rgba(99,102,241,0.3)]"}),m.jsxs(Kn,{className:"p-6 border-white/5 hover:border-primary/30 transition-all hover:-translate-y-1 cursor-pointer",children:[m.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:n.nombre}),m.jsx("p",{className:"text-sm text-text-muted leading-relaxed line-clamp-3",children:n.descripcion||"No description provided."})]})]},n.id)),m.jsxs("div",{onClick:e,className:"relative pl-12 group cursor-pointer opacity-50 hover:opacity-100 transition-opacity",children:[m.jsx("div",{className:"absolute left-[-9px] top-2 size-4 rounded-full bg-background-dark border-2 border-dashed border-white/30"}),m.jsxs("div",{className:"p-4 border-2 border-dashed border-white/10 rounded-2xl flex items-center justify-center text-text-muted hover:border-primary/50 hover:text-white transition-all",children:[m.jsx("span",{className:"material-symbols-outlined mr-2",children:"add_circle"}),m.jsx("span",{className:"text-xs font-black uppercase tracking-widest",children:"Add Historical Event"})]})]})]})})},Jie=()=>{const{username:t,projectName:e,folderSlug:r}=Va(),n=Ga(),{handleCreateEntity:i,handleDeleteEntity:a,handleDeleteFolder:s,handleCreateSimpleFolder:o,folderSearchTerm:l,folderFilterType:u}=bo(),[c,f]=ne.useState([]),[p,g]=ne.useState(null),[y,S]=ne.useState([]),[w,C]=ne.useState(!0),[_,T]=ne.useState(!1),N={folders:(p?.subfolders||[]).filter(O=>{const F=O.nombre.toLowerCase().includes((l||"").toLowerCase()),z=u==="ALL"||u==="MAP"&&O.tipoEspecial==="map"||u==="TIMELINE"&&O.tipoEspecial==="timeline";return F&&z}),entities:c.filter(O=>{const F=O.nombre.toLowerCase().includes((l||"").toLowerCase()),z=u==="ALL"||u==="ENTITY"&&(!O.tipoEspecial||O.tipoEspecial==="entidadindividual")||u==="individual"&&O.tipoEspecial==="individual"||O.tipoEspecial==="entidadindividual"||u==="location"&&O.tipoEspecial==="location"||O.tipoEspecial==="zona"||u==="culture"&&O.tipoEspecial==="culture"||O.tipoEspecial==="entidadcolectiva"||u==="MAP"&&O.tipoEspecial==="map"||u==="TIMELINE"&&O.tipoEspecial==="timeline";return F&&z})};ne.useEffect(()=>{const O=F=>{const{folderId:z,removeId:G,type:Z,item:I}=F.detail||{};z===(p?.id||r)&&(G?Z==="entity"&&f(W=>W.filter(U=>U.id!==G)):I&&I.slug&&I.slug!==r?n(`/${t}/${e}/bible/folder/${I.slug}`,{replace:!0}):R())};return window.addEventListener("folder-update",O),()=>window.removeEventListener("folder-update",O)},[r,p?.id]),ne.useEffect(()=>{R()},[r]);const R=async()=>{C(!0);try{const[O,F]=await Promise.all([$e.get(`/world-bible/folders/${r}/entities`),$e.get(`/world-bible/folders/${r}`)]);f(O||[]),F.folder?(g({...F.folder,subfolders:F.subfolders||[]}),S(F.path||[])):(g({...F||{nombre:"Folder"},subfolders:F.subfolders||[]}),S([]))}catch(O){console.error("Error loading folder content:",O),g(null),S([])}finally{C(!1)}};if(w)return m.jsx("div",{className:"p-20 text-center animate-pulse text-text-muted",children:"Loading sector..."});if(!p)return m.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-20 text-text-muted",children:[m.jsx("span",{className:"material-symbols-outlined text-6xl mb-4 opacity-20",children:"folder_off"}),m.jsx("h2",{className:"text-xl font-bold opacity-50",children:"Folder Not Found"}),m.jsx("p",{className:"text-sm opacity-30 mt-2",children:"The sector you are looking for does not exist or has been moved."}),m.jsx(hh,{to:`/${t}/${e}/bible`,className:"mt-6 px-6 py-2 bg-white/5 hover:bg-white/10 rounded-full text-xs font-bold transition-colors",children:"Return to Root"})]});const D=p&&p.tipo&&(["UNIVERSE","GALAXY","SYSTEM","PLANET"].includes(p.tipo)||p.tipo==="MAGIC"),j=p?BS(p.tipo):th.FOLDER;return D?m.jsxs("div",{className:"flex-1 overflow-y-auto bg-[#0a0a0c] text-white w-full h-full relative",children:[m.jsxs("div",{className:`w-full min-h-[300px] ${j.bgColor} relative flex items-end p-10 border-b border-white/5`,children:[m.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-[#0a0a0c] to-transparent opacity-80 pointer-events-none"}),m.jsx("div",{className:"absolute top-6 left-10 z-20",children:m.jsx(Xie,{path:y,currentFolder:p})}),m.jsxs("div",{className:"relative z-10 flex gap-8 items-end w-full max-w-7xl mx-auto",children:[m.jsx("div",{className:`w-32 h-32 rounded-3xl ${j.bgColor} border border-white/10 flex items-center justify-center shadow-2xl`,children:m.jsx("span",{className:`material-symbols-outlined text-6xl ${j.color}`,children:j.icon})}),m.jsxs("div",{className:"flex-1 mb-2",children:[m.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[m.jsx("div",{className:`px-3 py-1 rounded-full text-[10px] font-black uppercase tracking-widest border border-white/10 ${j.bgColor} ${j.color}`,children:j.label}),m.jsxs("span",{className:"text-white/30 text-xs font-mono tracking-widest uppercase",children:["ID: ",p.id]})]}),m.jsx("h1",{className:"text-6xl font-black tracking-tighter text-white mb-2",children:p.nombre}),m.jsx("p",{className:"text-lg text-white/50 max-w-2xl font-light leading-relaxed",children:p.descripcion||"Sin descripcin definida para este sector cosmolgico."})]}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsxs("button",{onClick:()=>n(`/${t}/${e}/bible/folder/${r}/entity/new/entidadindividual`),className:"px-4 py-2 bg-primary/20 hover:bg-primary/30 text-primary rounded-xl text-[10px] font-black uppercase tracking-widest flex items-center gap-2 transition-all",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"person_add"})," Nueva Entidad"]}),m.jsxs("button",{onClick:()=>n(`/${t}/${e}/map-editor/create/${r}`,{state:{folderId:p?.id}}),className:"px-4 py-2 bg-white/5 hover:bg-white/10 text-white rounded-xl text-[10px] font-black uppercase tracking-widest flex items-center gap-2 transition-all border border-glass-border",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"map"})," Mapa"]})]})]})]}),m.jsxs("div",{className:"max-w-7xl mx-auto p-10 grid grid-cols-1 lg:grid-cols-3 gap-8",children:[m.jsxs("div",{className:"space-y-6",children:[m.jsxs("div",{className:"bg-[#13141f] border border-white/5 rounded-2xl p-6",children:[m.jsx("h3",{className:"text-xs font-bold text-white/40 uppercase tracking-widest mb-4",children:"Estadsticas"}),m.jsx("div",{className:"grid grid-cols-2 gap-4",children:m.jsxs("div",{children:[m.jsx("div",{className:"text-2xl font-black text-white",children:c.length}),m.jsx("div",{className:"text-[10px] text-white/40 uppercase",children:"Elementos"})]})})]}),m.jsxs("div",{className:"bg-[#13141f] border border-white/5 rounded-2xl p-6 h-64 flex flex-col",children:[m.jsx("h3",{className:"text-xs font-bold text-white/40 uppercase tracking-widest mb-4",children:"Notas Rpidas"}),m.jsx("textarea",{className:"flex-1 bg-transparent resize-none outline-none text-sm text-white/70 placeholder-white/20",placeholder:"Escribir notas de la zona..."})]})]}),m.jsxs("div",{className:"lg:col-span-2",children:[m.jsx("h3",{className:"text-xs font-bold text-white/40 uppercase tracking-widest mb-4",children:"Contenido Interno"}),c.length===0&&m.jsxs("div",{className:"p-12 border border-dashed border-white/10 rounded-2xl text-center",children:[m.jsx("span",{className:"material-symbols-outlined text-4xl text-white/20 mb-2",children:"folder_open"}),m.jsx("p",{className:"text-white/30 text-sm",children:"Este sector est vaco."})]}),m.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:N.entities.map(O=>m.jsx(ix,{item:O,type:"entity",linkTo:`/${t}/${e}/bible/folder/${p.slug||r}/entity/${O.slug||O.id}`,onDelete:()=>a(O.id,p?.id||r)},O.id))})]})]})]}):m.jsxs("div",{className:"flex-1 p-8 max-w-[1600px] mx-auto w-full h-full overflow-y-auto",children:[m.jsxs("header",{className:"mb-8 flex items-end justify-between",children:[m.jsxs("div",{children:[m.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[m.jsxs(hh,{to:`/${t}/${e}/bible`,className:"text-xs font-bold text-text-muted hover:text-primary transition-colors flex items-center gap-1",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"arrow_back"})," Root"]}),p&&m.jsx("span",{className:`px-2 py-0.5 rounded text-[10px] bg-white/5 border border-white/10 ${j.color}`,children:j.label})]}),m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsx("span",{className:`material-symbols-outlined text-3xl ${j.color}`,children:j.icon}),m.jsx("h1",{className:"text-4xl font-black text-white tracking-tighter",children:p?.nombre||"Unnamed Folder"})]}),m.jsx("p",{className:"text-white/50 text-sm mt-2 max-w-xl",children:p?.descripcion})]}),m.jsxs("div",{className:"flex items-center gap-3 relative",children:[m.jsxs("button",{onClick:()=>T(!_),className:"h-10 px-6 rounded-xl bg-primary hover:bg-primary-light transition flex items-center gap-2 text-xs font-bold text-white shadow-lg shadow-primary/20",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"add"}),m.jsx("span",{children:"Aadir Elemento"})]}),_&&m.jsxs("div",{className:"absolute top-full right-0 mt-2 w-56 bg-surface-dark border border-glass-border rounded-2xl shadow-2xl py-2 z-50 animate-in fade-in slide-in-from-top-2",children:[m.jsxs("button",{onClick:()=>{n(`/${t}/${e}/bible/folder/${r}/entity/new/entidadindividual`),T(!1)},className:"w-full px-4 py-2.5 hover:bg-white/5 text-left text-xs font-bold flex items-center gap-3 text-white/70 hover:text-white",children:[m.jsx("span",{className:"material-symbols-outlined text-sm text-primary",children:"person"})," Personaje"]}),m.jsxs("button",{onClick:()=>{n(`/${t}/${e}/bible/folder/${r}/entity/new/entidadcolectiva`),T(!1)},className:"w-full px-4 py-2.5 hover:bg-white/5 text-left text-xs font-bold flex items-center gap-3 text-white/70 hover:text-white",children:[m.jsx("span",{className:"material-symbols-outlined text-sm text-blue-400",children:"groups"})," Cultura / Grupo"]}),m.jsxs("button",{onClick:()=>{n(`/${t}/${e}/bible/folder/${r}/entity/new/zona`),T(!1)},className:"w-full px-4 py-2.5 hover:bg-white/5 text-left text-xs font-bold flex items-center gap-3 text-white/70 hover:text-white",children:[m.jsx("span",{className:"material-symbols-outlined text-sm text-green-400",children:"location_on"})," Lugar / Geografa"]}),m.jsxs("button",{onClick:()=>{n(`/${t}/${e}/bible/folder/${r}/entity/new/interaccion`),T(!1)},className:"w-full px-4 py-2.5 hover:bg-white/5 text-left text-xs font-bold flex items-center gap-3 text-white/70 hover:text-white",children:[m.jsx("span",{className:"material-symbols-outlined text-sm text-amber-400",children:"history_edu"})," Lore / Interaccin"]}),m.jsxs("button",{onClick:()=>{n(`/${t}/${e}/bible/folder/${r}/entity/new/efectos`),T(!1)},className:"w-full px-4 py-2.5 hover:bg-white/5 text-left text-xs font-bold flex items-center gap-3 text-white/70 hover:text-white",children:[m.jsx("span",{className:"material-symbols-outlined text-sm text-purple-400",children:"magic_button"})," Objeto / Efecto"]}),m.jsx("div",{className:"h-px bg-white/5 my-1"}),m.jsxs("button",{onClick:()=>{n(`/${t}/${e}/map-editor/create/${r}`,{state:{folderId:p?.id}}),T(!1)},className:"w-full px-4 py-2.5 hover:bg-white/5 text-left text-xs font-bold flex items-center gap-3 text-white/70 hover:text-white",children:[m.jsx("span",{className:"material-symbols-outlined text-sm text-red-400",children:"map"})," Nuevo Mapa"]}),m.jsxs("button",{onClick:()=>{o(p,"TIMELINE"),T(!1)},className:"w-full px-4 py-2.5 hover:bg-white/5 text-left text-xs font-bold flex items-center gap-3 text-white/70 hover:text-white",children:[m.jsx("span",{className:"material-symbols-outlined text-sm text-cyan-400",children:"timeline"})," Timeline"]})]})]})]}),p?.tipo==="TIMELINE"?m.jsx(Qie,{entities:N.entities,folderId:r,onAddEvent:()=>n(`/${t}/${e}/bible/folder/${r}/entity/new/evento`)}):m.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4",children:[N.folders.map(O=>m.jsx(ix,{item:O,type:"folder",linkTo:`/${t}/${e}/bible/folder/${O.slug||O.id}`,onDelete:()=>s(O.id,p?.id||r)},O.id)),N.entities.map(O=>{const F=O.tipoEspecial==="map"||O.tipoEspecial==="timeline"?O.tipoEspecial:"entity";return m.jsx(ix,{item:O,type:"entity",linkTo:`/${t}/${e}/bible/folder/${p?.slug||r}/${F}/${O.slug||O.id}`,onDelete:()=>a(O.id,p?.id||r)},O.id)})]}),c.length===0&&m.jsx("div",{className:"p-20 text-center border-2 border-dashed border-glass-border rounded-[3rem] opacity-30 mt-8",children:m.jsx("p",{className:"text-text-muted font-bold uppercase tracking-widest",children:"Empty Folder"})})]})},eae=({isOpen:t,onClose:e,onCreate:r,parentFolder:n})=>{const[i,a]=ne.useState({nombre:"",descripcion:"",tipo:"FOLDER",canvasType:"BLANK"});if(!t)return null;const s=()=>{r(i),e(),a({nombre:"",descripcion:"",tipo:"FOLDER",canvasType:"BLANK"})},o=[th.UNIVERSE,th.GALAXY,th.SYSTEM,th.PLANET];return m.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm",children:m.jsxs("div",{className:"bg-[#1a1b26] w-full max-w-4xl rounded-2xl shadow-2xl border border-white/10 overflow-hidden flex flex-col max-h-[90vh]",children:[m.jsxs("div",{className:"p-6 border-b border-white/5 flex justify-between items-center bg-[#1f202e]",children:[m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsx("div",{className:"w-8 h-8 rounded-full bg-indigo-500/20 flex items-center justify-center text-indigo-400",children:m.jsx("span",{className:"material-icons text-sm",children:"add"})}),m.jsx("h2",{className:"text-xl font-semibold text-white",children:n?"Crear Nuevo Espacio":"Crear Nuevo Mapa"})]}),m.jsx("button",{onClick:e,className:"text-gray-400 hover:text-white transition",children:m.jsx("span",{className:"material-icons",children:"close"})})]}),m.jsx("div",{className:"p-8 overflow-y-auto flex-1",children:m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[m.jsxs("div",{className:"space-y-6",children:[m.jsx("h3",{className:"text-sm font-black uppercase tracking-widest text-indigo-400",children:"Identidad"}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-[10px] font-black text-white/30 uppercase mb-2",children:"Nombre del Espacio"}),m.jsx("input",{autoFocus:!0,type:"text",value:i.nombre,onChange:l=>a({...i,nombre:l.target.value}),className:"w-full bg-black/40 border border-white/5 rounded-2xl px-5 py-4 text-white focus:outline-none focus:border-indigo-500/50 transition-all shadow-inner",placeholder:"ej. Sistema Solar"})]}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-[10px] font-black text-white/30 uppercase mb-2",children:"Descripcin"}),m.jsx("textarea",{value:i.descripcion,onChange:l=>a({...i,descripcion:l.target.value}),className:"w-full h-32 bg-black/40 border border-white/5 rounded-2xl px-5 py-4 text-white focus:outline-none focus:border-indigo-500/50 resize-none transition-all",placeholder:"Detalles sobre este nivel jerrquico..."})]})]}),m.jsxs("div",{className:"space-y-6",children:[m.jsx("h3",{className:"text-sm font-black uppercase tracking-widest text-indigo-400",children:"Configuracin"}),m.jsxs("div",{className:"space-y-3",children:[m.jsx("label",{className:"block text-[10px] font-black text-white/30 uppercase mb-1",children:"Tipo de Jerarqua"}),m.jsx("div",{className:"grid grid-cols-2 gap-2",children:o.concat([{id:"FOLDER",label:"Carpeta",icon:"folder",color:"text-white/50"}]).map(l=>m.jsxs("div",{onClick:()=>a({...i,tipo:l.id}),className:`flex items-center gap-3 p-3 rounded-xl border cursor-pointer transition-all ${i.tipo===l.id?"bg-indigo-500/10 border-indigo-500/50":"bg-white/5 border-white/5 hover:bg-white/10"}`,children:[m.jsx("span",{className:`material-icons text-lg ${l.color||""}`,children:l.icon}),m.jsx("span",{className:"text-xs font-bold text-white/80",children:l.label})]},l.id||"FOLDER"))})]}),m.jsx("div",{className:"p-4 rounded-2xl bg-indigo-500/5 border border-indigo-500/10",children:m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("div",{className:"w-10 h-10 rounded-full bg-indigo-500/20 flex items-center justify-center text-indigo-400",children:m.jsx("span",{className:"material-icons",children:"info"})}),m.jsxs("div",{children:[m.jsx("p",{className:"text-[10px] uppercase font-black text-indigo-300",children:"Ubicacin Actual"}),m.jsx("p",{className:"text-xs text-indigo-100/50",children:n?n.nombre:"Raz del Mundo"})]})]})})]})]})}),m.jsxs("div",{className:"p-6 border-t border-white/5 flex justify-end gap-3 bg-[#1f202e]",children:[m.jsx("button",{onClick:e,className:"px-6 py-3 rounded-xl text-xs font-black uppercase tracking-widest text-text-muted hover:text-white transition",children:"Cancelar"}),m.jsx("button",{onClick:s,disabled:!i.nombre,className:"px-8 py-3 rounded-xl bg-indigo-600 hover:bg-indigo-500 text-white text-xs font-black uppercase tracking-widest shadow-lg shadow-indigo-500/20 transition-all disabled:opacity-30 disabled:pointer-events-none",children:"Confirmar y Crear"})]})]})})},tae=()=>{const{username:t,projectName:e}=Va(),r=Ga(),{handleCreateEntity:n,...i}=bo()||{},{t:a}=Ps(),[s,o]=ne.useState([]),[l,u]=ne.useState(!1),[c,f]=ne.useState(null),[p,g]=ne.useState(""),[y,S]=ne.useState("ALL"),[w,C]=ne.useState(!1),[_,T]=ne.useState(null),N=`/${t}/${e}/bible`;ne.useEffect(()=>{R()},[e]),ne.useEffect(()=>{i?.setBibleExplorerState&&i.setBibleExplorerState({folders:s,searchTerm:p,setSearchTerm:g,filterType:y,setFilterType:S,handleCreateSimpleFolder:j,handleRenameFolder:Z,handleDeleteFolder:I,handleMoveEntity:F,handleDuplicateEntity:z,handleCreateEntity:G,handleConfirmCreate:K})},[s,p,y]);const R=async()=>{try{const $=await $e.get("/world-bible/folders");o($)}catch($){console.error("Error loading folders:",$)}},D=($=null)=>{f($),u(!0),setCreationMenuOpen(!1)},j=async($=null,Q="FOLDER")=>{try{const ie=$?typeof $=="object"?$.id:$:null,te=await $e.post("/world-bible/folders",{nombre:a(Q==="TIMELINE"?"bible.new_timeline":"bible.new_folder"),padreId:ie,tipo:Q});if(ie===null){const X=await $e.get("/world-bible/folders");o(X),window.dispatchEvent(new CustomEvent("folder-update",{detail:{folderId:null}}))}else window.dispatchEvent(new CustomEvent("folder-update",{detail:{folderId:ie,optimisticType:"folder",item:te,expand:!0}}))}catch(ie){console.error("Error creating simple folder:",ie)}},O=async $=>{try{const Q=c?c.id:null,ie=await $e.post("/world-bible/folders",{nombre:$.nombre,descripcion:$.descripcion,padreId:Q,tipo:$.tipo});if(Q===null){const te=await $e.get("/world-bible/folders");o(te),window.dispatchEvent(new CustomEvent("folder-update",{detail:{folderId:null}}))}else ie.id||console.error("CRITICAL: Created folder has no ID!",ie),window.dispatchEvent(new CustomEvent("folder-update",{detail:{folderId:Q,optimisticType:"folder",item:ie,expand:!0}}))}catch(Q){console.error(Q),alert("Error creating folder/zone.")}},F=async($,Q,ie)=>{try{await $e.put(`/world-bible/entities/${$}`,{carpetaId:Q}),window.dispatchEvent(new CustomEvent("folder-update",{detail:{folderId:ie,removeId:$,type:"entity"}})),window.dispatchEvent(new CustomEvent("folder-update",{detail:{folderId:Q,type:"move-in",entityId:$}}))}catch(te){console.error("Move failed:",te)}},z=async($,Q)=>{try{const ie=await $e.get(`/world-bible/entities/${$}`),te=await $e.post("/world-bible/entities",{...ie,id:void 0,nombre:`${ie.nombre} (Copia)`,carpetaId:Q});window.dispatchEvent(new CustomEvent("folder-update",{detail:{folderId:Q,type:"entity",item:te}}))}catch(ie){console.error("Duplicate failed:",ie)}},G=async($,Q="entidadindividual")=>{const ie=typeof $=="object"?$.slug||$.id:$;r(`${N}/folder/${ie}/entity/new/${Q}`)},Z=async($,Q)=>{try{await $e.put(`/world-bible/folders/${$}`,{nombre:Q}),o(ie=>ie.map(te=>te.id===$?{...te,nombre:Q}:te))}catch(ie){throw ie}},I=($,Q=null)=>{T({id:$,parentId:Q,type:"folder"}),C(!0)},W=async()=>{if(!_)return;const{id:$,parentId:Q,type:ie,folderId:te}=_;try{ie==="folder"?(await $e.delete(`/world-bible/folders/${$}`),Q===null&&o(X=>X.filter(re=>re.id!==$)),window.dispatchEvent(new CustomEvent("folder-update",{detail:{folderId:Q,removeId:$,type:"folder"}}))):ie==="entity"&&(await $e.delete(`/world-bible/entities/${$}`),window.dispatchEvent(new CustomEvent("folder-update",{detail:{folderId:te,removeId:$,type:"entity"}})))}catch(X){console.error("Deletion failed:",X),alert("Error trying to delete item.")}finally{T(null)}},U=($,Q)=>{T({id:$,folderId:Q,type:"entity"}),C(!0)},K=async($,Q,ie,te,X)=>{try{if(ie==="folder")typeof $=="number"&&!$.toString().startsWith("temp")&&(await $e.put(`/world-bible/folders/${$}`,{nombre:Q}),window.dispatchEvent(new CustomEvent("folder-update",{detail:{folderId:te,confirmedType:"folder",oldId:$,item:{id:$,nombre:Q,parentId:te,tipo:X,uiKey:Date.now()}}})),te||o(re=>re.map(fe=>fe.id===$?{...fe,nombre:Q}:fe)));else if(ie==="entity")if(typeof $=="string"&&$.startsWith("new-")){const re=await $e.post("/world-bible/entities",{nombre:Q,carpetaId:te,tipoEspecial:X||"entidadindividual"});window.dispatchEvent(new CustomEvent("folder-update",{detail:{folderId:te,confirmedType:"entity",oldId:$,item:re}}))}else await $e.put(`/world-bible/entities/${$}`,{nombre:Q}),window.dispatchEvent(new CustomEvent("folder-update",{detail:{folderId:te,confirmedType:"entity",oldId:$,item:{id:$,nombre:Q,carpeta:{id:te},tipoEspecial:X,slug:$}}})),window.dispatchEvent(new CustomEvent("folder-update",{detail:{folderId:te}}))}catch(re){console.error("Creation/Rename failed",re),ie==="folder"&&I($,te)}};return m.jsxs("div",{className:"flex h-full w-full bg-background-dark max-w-[1920px] mx-auto",children:[m.jsx("main",{className:"flex-1 overflow-hidden relative bg-gradient-to-br from-background-dark to-surface-dark/20",children:m.jsx(sx,{context:{...i,folders:s,searchTerm:p,setSearchTerm:g,filterType:y,setFilterType:S,handleCreateEntity:G,handleOpenCreateModal:D,handleDeleteFolder:I,handleRenameFolder:Z,handleDeleteEntity:U,handleMoveEntity:F,handleDuplicateEntity:z,handleCreateSimpleFolder:j,handleConfirmCreate:K}})}),m.jsx(eae,{isOpen:l,onClose:()=>u(!1),onCreate:O,parentFolder:c}),m.jsx(Zv,{isOpen:w,onClose:()=>C(!1),onConfirm:W,title:_?.type==="folder"?a("bible.delete_folder"):a("bible.delete_entity"),message:_?.type==="folder"?a("bible.delete_folder_msg"):a("bible.delete_entity_msg"),confirmText:a("common.confirm_delete")})]})},rae=()=>{const{username:t,projectName:e}=Va();Ga();const{handleOpenCreateModal:r,handleDeleteFolder:n,handleCreateSimpleFolder:i,handleRenameFolder:a,folders:s=[]}=bo(),{t:o}=Ps(),[l,u]=ne.useState(null),[c,f]=ne.useState(null),[p,g]=ne.useState(""),y=(C,_)=>{C.preventDefault(),C.stopPropagation(),u({x:C.clientX,y:C.clientY,folder:_})},S=()=>u(null);ne.useEffect(()=>{if(l){const C=()=>S();return window.addEventListener("click",C),()=>window.removeEventListener("click",C)}},[l]);const w=async(C,_)=>{_.trim()&&a&&await a(C,_.trim()),f(null),g("")};return s===void 0?m.jsx("div",{className:"p-20 text-center animate-pulse text-text-muted",children:o("common.loading")}):m.jsxs("div",{className:"flex-1 p-8 max-w-[1600px] mx-auto w-full h-full overflow-y-auto",children:[m.jsxs("header",{className:"mb-8 flex items-end justify-between",children:[m.jsxs("div",{children:[m.jsxs("div",{className:"flex items-center gap-3 text-xs font-black uppercase tracking-widest text-primary italic mb-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"auto_stories"}),o("nav.bible")]}),m.jsx("h1",{className:"text-4xl font-black text-white tracking-tighter",children:o("bible.root_index")}),m.jsx("p",{className:"text-text-muted mt-2 max-w-lg text-sm",children:o("bible.central_archive")})]}),m.jsx("div",{className:"flex items-center gap-2",children:m.jsxs("button",{onClick:()=>i(null,"FOLDER"),className:"px-6 py-2 bg-primary hover:bg-primary-light text-white rounded-xl text-xs font-bold flex items-center gap-2 transition-all shadow-lg shadow-primary/20",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"create_new_folder"})," ",o("bible.new_folder")]})})]}),m.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4",children:s.map(C=>c===C.id?m.jsx("div",{className:"p-4 rounded-3xl bg-surface-dark border border-primary/50",children:m.jsx("input",{autoFocus:!0,type:"text",value:p,onChange:_=>g(_.target.value),onKeyDown:_=>{_.key==="Enter"&&w(C.id,p),_.key==="Escape"&&(f(null),g(""))},onBlur:()=>w(C.id,p),className:"w-full bg-black/30 border border-white/10 rounded-xl p-3 text-sm text-white focus:border-primary/50 outline-none",placeholder:o("common.rename")})},C.id):m.jsx(ix,{item:C,type:"folder",linkTo:`/${t}/${e}/bible/folder/${C.slug||C.id}`,onDelete:()=>n(C.id),onContextMenu:_=>y(_,C)},C.id))}),s.length===0&&m.jsxs("div",{className:"p-20 text-center border-2 border-dashed border-glass-border rounded-[3rem] opacity-30 mt-8",children:[m.jsx("span",{className:"material-symbols-outlined text-6xl mb-4 text-text-muted",children:"library_books"}),m.jsx("h3",{className:"text-xl font-bold text-white uppercase tracking-widest",children:o("bible.empty_archive")}),m.jsx("p",{className:"text-text-muted mt-2",children:o("bible.empty_archive_desc")})]}),l&&m.jsxs("div",{className:"fixed bg-surface-dark border border-glass-border shadow-2xl rounded-xl py-2 z-50 w-52 text-xs font-medium flex flex-col animate-in fade-in zoom-in-95 duration-150",style:{top:l.y,left:l.x},onClick:C=>C.stopPropagation(),children:[m.jsxs("div",{className:"px-4 py-2 border-b border-white/5 font-bold text-text-muted truncate flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm text-primary",children:"folder"}),l.folder.nombre]}),m.jsxs("button",{className:"px-4 py-2.5 hover:bg-white/5 text-left flex items-center gap-3 text-white/80 hover:text-white transition-colors",onClick:()=>{f(l.folder.id),g(l.folder.nombre),S()},children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"edit"})," ",o("common.rename")]}),m.jsxs("button",{className:"px-4 py-2.5 hover:bg-red-500/10 text-red-400 text-left flex items-center gap-3 transition-colors",onClick:()=>{n(l.folder.id),S()},children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})," ",o("bible.delete_folder")]})]})]})};function nae(){const[t,e]=ne.useState("deep_space"),[r,n]=ne.useState(null);return ne.useEffect(()=>{const i=localStorage.getItem("app_settings");if(i){const o=JSON.parse(i);o.theme&&e(o.theme)}const a=localStorage.getItem("user");a&&a!=="undefined"&&n(JSON.parse(a));const s=()=>{const o=localStorage.getItem("app_settings");if(o){const u=JSON.parse(o);u.theme&&e(u.theme)}const l=localStorage.getItem("user");l&&l!=="undefined"&&n(JSON.parse(l))};return window.addEventListener("storage_update",s),()=>window.removeEventListener("storage_update",s)},[]),ne.useEffect(()=>{document.body.classList.forEach(i=>{i.startsWith("theme-")&&document.body.classList.remove(i)}),document.body.classList.add(`theme-${t}`)},[t]),m.jsx(yj,{children:m.jsx("div",{className:`app-container theme-${t} h-screen w-screen overflow-hidden`,children:m.jsx(aI,{children:m.jsxs(Y8,{children:[m.jsx(qn,{path:"/",element:m.jsx(YI,{})}),m.jsxs(qn,{element:m.jsx(HI,{}),children:[m.jsx(qn,{path:"/settings",element:m.jsx(bj,{})}),m.jsxs(qn,{path:"/:username/:projectName",element:m.jsx(wG,{}),children:[m.jsx(qn,{index:!0,element:m.jsx(xj,{})}),m.jsx(qn,{path:"writing",element:m.jsx(Wie,{})}),m.jsx(qn,{path:"writing/:notebookId",element:m.jsx(Hie,{})}),m.jsx(qn,{path:"entities/:type/:entityId",element:m.jsx(EG,{})}),m.jsx(qn,{path:"map-editor/create/:folderId",element:m.jsx(ok,{mode:"create"})}),m.jsx(qn,{path:"map-editor/edit/:entityId",element:m.jsx(ok,{mode:"edit"})}),m.jsxs(qn,{path:"bible",element:m.jsx(tae,{}),children:[m.jsx(qn,{index:!0,element:m.jsx(rae,{})}),m.jsx(qn,{path:"folder/:folderSlug/entity/new/:type",element:m.jsx(Wg,{mode:"creation"})}),m.jsx(qn,{path:"folder/:folderSlug",element:m.jsx(Jie,{})}),m.jsx(qn,{path:"entity/:entitySlug",element:m.jsx(Wg,{})}),m.jsx(qn,{path:"folder/:folderSlug/entity/:entitySlug",element:m.jsx(Wg,{})}),m.jsx(qn,{path:"folder/:folderSlug/map/:entitySlug",element:m.jsx(Wg,{})}),m.jsx(qn,{path:"folder/:folderSlug/timeline/:entitySlug",element:m.jsx(Wg,{})})]}),m.jsx(qn,{path:"map",element:m.jsx(rW,{})}),m.jsx(qn,{path:"timeline",element:m.jsx(TG,{})}),m.jsx(qn,{path:"languages",element:m.jsx(oZ,{})}),m.jsx(qn,{path:"trash",element:m.jsx(qie,{})}),m.jsx(qn,{path:"graph",element:m.jsx(bG,{})})]})]})]})})})})}setInterval(()=>{fetch("/api/system/heartbeat",{method:"POST"}).catch(()=>{})},2e3);const jC=(t,e,r,n="")=>{fetch("/api/logs/error",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({source:t,message:e,stack:r,componentStack:n})}).catch(i=>console.error("Failed to send error log:",i))};window.onerror=(t,e,r,n,i)=>{jC("Global Window Error",t,i?i.stack:`${e}:${r}:${n}`)};window.onunhandledrejection=t=>{jC("Unhandled Promise Rejection",t.reason?t.reason.message:"Unknown reason",t.reason?t.reason.stack:"")};class iae extends Qt.Component{constructor(e){super(e),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(e){return{hasError:!0}}componentDidCatch(e,r){this.setState({error:e,errorInfo:r}),console.error("Uncaught Error:",e,r),jC("React ErrorBoundary",e.message,e.stack,r.componentStack)}render(){return this.state.hasError?m.jsxs("div",{style:{padding:20,background:"#222",color:"red",height:"100vh"},children:[m.jsx("h1",{children:"Something went wrong."}),m.jsxs("details",{style:{whiteSpace:"pre-wrap"},children:[this.state.error&&this.state.error.toString(),m.jsx("br",{}),this.state.errorInfo&&this.state.errorInfo.componentStack]})]}):this.props.children}}const pM=document.getElementById("root");pM?i8.createRoot(pM).render(m.jsx(Qt.StrictMode,{children:m.jsx(iae,{children:m.jsx(nae,{})})})):console.error("React root element not found (looked for #root)")});export default aae();
