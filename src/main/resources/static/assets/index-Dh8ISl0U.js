var WD=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var Uie=WD(Ye=>{function qD(t,e){for(var r=0;r<e.length;r++){const n=e[r];if(typeof n!="string"&&!Array.isArray(n)){for(const i in n)if(i!=="default"&&!(i in t)){const a=Object.getOwnPropertyDescriptor(n,i);a&&Object.defineProperty(t,i,a.get?a:{enumerable:!0,get:()=>n[i]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function r(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(i){if(i.ep)return;i.ep=!0;const a=r(i);fetch(i.href,a)}})();var aE=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Tf(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Lb={exports:{}},Fm={},Ob={exports:{}},Nr={};var sE;function $D(){if(sE)return Nr;sE=1;var t=Symbol.for("react.element"),e=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),a=Symbol.for("react.provider"),s=Symbol.for("react.context"),o=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),c=Symbol.for("react.lazy"),h=Symbol.iterator;function p(q){return q===null||typeof q!="object"?null:(q=h&&q[h]||q["@@iterator"],typeof q=="function"?q:null)}var v={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},y=Object.assign,S={};function w(q,te,ae){this.props=q,this.context=te,this.refs=S,this.updater=ae||v}w.prototype.isReactComponent={},w.prototype.setState=function(q,te){if(typeof q!="object"&&typeof q!="function"&&q!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,q,te,"setState")},w.prototype.forceUpdate=function(q){this.updater.enqueueForceUpdate(this,q,"forceUpdate")};function T(){}T.prototype=w.prototype;function _(q,te,ae){this.props=q,this.context=te,this.refs=S,this.updater=ae||v}var C=_.prototype=new T;C.constructor=_,y(C,w.prototype),C.isPureReactComponent=!0;var N=Array.isArray,A=Object.prototype.hasOwnProperty,I={current:null},j={key:!0,ref:!0,__self:!0,__source:!0};function O(q,te,ae){var de,ge={},ye=null,se=null;if(te!=null)for(de in te.ref!==void 0&&(se=te.ref),te.key!==void 0&&(ye=""+te.key),te)A.call(te,de)&&!j.hasOwnProperty(de)&&(ge[de]=te[de]);var fe=arguments.length-2;if(fe===1)ge.children=ae;else if(1<fe){for(var le=Array(fe),pe=0;pe<fe;pe++)le[pe]=arguments[pe+2];ge.children=le}if(q&&q.defaultProps)for(de in fe=q.defaultProps,fe)ge[de]===void 0&&(ge[de]=fe[de]);return{$$typeof:t,type:q,key:ye,ref:se,props:ge,_owner:I.current}}function F(q,te){return{$$typeof:t,type:q.type,key:te,ref:q.ref,props:q.props,_owner:q._owner}}function B(q){return typeof q=="object"&&q!==null&&q.$$typeof===t}function $(q){var te={"=":"=0",":":"=2"};return"$"+q.replace(/[=:]/g,function(ae){return te[ae]})}var Z=/\/+/g;function D(q,te){return typeof q=="object"&&q!==null&&q.key!=null?$(""+q.key):te.toString(36)}function H(q,te,ae,de,ge){var ye=typeof q;(ye==="undefined"||ye==="boolean")&&(q=null);var se=!1;if(q===null)se=!0;else switch(ye){case"string":case"number":se=!0;break;case"object":switch(q.$$typeof){case t:case e:se=!0}}if(se)return se=q,ge=ge(se),q=de===""?"."+D(se,0):de,N(ge)?(ae="",q!=null&&(ae=q.replace(Z,"$&/")+"/"),H(ge,te,ae,"",function(pe){return pe})):ge!=null&&(B(ge)&&(ge=F(ge,ae+(!ge.key||se&&se.key===ge.key?"":(""+ge.key).replace(Z,"$&/")+"/")+q)),te.push(ge)),1;if(se=0,de=de===""?".":de+":",N(q))for(var fe=0;fe<q.length;fe++){ye=q[fe];var le=de+D(ye,fe);se+=H(ye,te,ae,le,ge)}else if(le=p(q),typeof le=="function")for(q=le.call(q),fe=0;!(ye=q.next()).done;)ye=ye.value,le=de+D(ye,fe++),se+=H(ye,te,ae,le,ge);else if(ye==="object")throw te=String(q),Error("Objects are not valid as a React child (found: "+(te==="[object Object]"?"object with keys {"+Object.keys(q).join(", ")+"}":te)+"). If you meant to render a collection of children, use an array instead.");return se}function U(q,te,ae){if(q==null)return q;var de=[],ge=0;return H(q,de,"","",function(ye){return te.call(ae,ye,ge++)}),de}function W(q){if(q._status===-1){var te=q._result;te=te(),te.then(function(ae){(q._status===0||q._status===-1)&&(q._status=1,q._result=ae)},function(ae){(q._status===0||q._status===-1)&&(q._status=2,q._result=ae)}),q._status===-1&&(q._status=0,q._result=te)}if(q._status===1)return q._result.default;throw q._result}var Y={current:null},Q={transition:null},ne={ReactCurrentDispatcher:Y,ReactCurrentBatchConfig:Q,ReactCurrentOwner:I};function re(){throw Error("act(...) is not supported in production builds of React.")}return Nr.Children={map:U,forEach:function(q,te,ae){U(q,function(){te.apply(this,arguments)},ae)},count:function(q){var te=0;return U(q,function(){te++}),te},toArray:function(q){return U(q,function(te){return te})||[]},only:function(q){if(!B(q))throw Error("React.Children.only expected to receive a single React element child.");return q}},Nr.Component=w,Nr.Fragment=r,Nr.Profiler=i,Nr.PureComponent=_,Nr.StrictMode=n,Nr.Suspense=l,Nr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ne,Nr.act=re,Nr.cloneElement=function(q,te,ae){if(q==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+q+".");var de=y({},q.props),ge=q.key,ye=q.ref,se=q._owner;if(te!=null){if(te.ref!==void 0&&(ye=te.ref,se=I.current),te.key!==void 0&&(ge=""+te.key),q.type&&q.type.defaultProps)var fe=q.type.defaultProps;for(le in te)A.call(te,le)&&!j.hasOwnProperty(le)&&(de[le]=te[le]===void 0&&fe!==void 0?fe[le]:te[le])}var le=arguments.length-2;if(le===1)de.children=ae;else if(1<le){fe=Array(le);for(var pe=0;pe<le;pe++)fe[pe]=arguments[pe+2];de.children=fe}return{$$typeof:t,type:q.type,key:ge,ref:ye,props:de,_owner:se}},Nr.createContext=function(q){return q={$$typeof:s,_currentValue:q,_currentValue2:q,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},q.Provider={$$typeof:a,_context:q},q.Consumer=q},Nr.createElement=O,Nr.createFactory=function(q){var te=O.bind(null,q);return te.type=q,te},Nr.createRef=function(){return{current:null}},Nr.forwardRef=function(q){return{$$typeof:o,render:q}},Nr.isValidElement=B,Nr.lazy=function(q){return{$$typeof:c,_payload:{_status:-1,_result:q},_init:W}},Nr.memo=function(q,te){return{$$typeof:u,type:q,compare:te===void 0?null:te}},Nr.startTransition=function(q){var te=Q.transition;Q.transition={};try{q()}finally{Q.transition=te}},Nr.unstable_act=re,Nr.useCallback=function(q,te){return Y.current.useCallback(q,te)},Nr.useContext=function(q){return Y.current.useContext(q)},Nr.useDebugValue=function(){},Nr.useDeferredValue=function(q){return Y.current.useDeferredValue(q)},Nr.useEffect=function(q,te){return Y.current.useEffect(q,te)},Nr.useId=function(){return Y.current.useId()},Nr.useImperativeHandle=function(q,te,ae){return Y.current.useImperativeHandle(q,te,ae)},Nr.useInsertionEffect=function(q,te){return Y.current.useInsertionEffect(q,te)},Nr.useLayoutEffect=function(q,te){return Y.current.useLayoutEffect(q,te)},Nr.useMemo=function(q,te){return Y.current.useMemo(q,te)},Nr.useReducer=function(q,te,ae){return Y.current.useReducer(q,te,ae)},Nr.useRef=function(q){return Y.current.useRef(q)},Nr.useState=function(q){return Y.current.useState(q)},Nr.useSyncExternalStore=function(q,te,ae){return Y.current.useSyncExternalStore(q,te,ae)},Nr.useTransition=function(){return Y.current.useTransition()},Nr.version="18.3.1",Nr}var oE;function sm(){return oE||(oE=1,Ob.exports=$D()),Ob.exports}var lE;function KD(){if(lE)return Fm;lE=1;var t=sm(),e=Symbol.for("react.element"),r=Symbol.for("react.fragment"),n=Object.prototype.hasOwnProperty,i=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,a={key:!0,ref:!0,__self:!0,__source:!0};function s(o,l,u){var c,h={},p=null,v=null;u!==void 0&&(p=""+u),l.key!==void 0&&(p=""+l.key),l.ref!==void 0&&(v=l.ref);for(c in l)n.call(l,c)&&!a.hasOwnProperty(c)&&(h[c]=l[c]);if(o&&o.defaultProps)for(c in l=o.defaultProps,l)h[c]===void 0&&(h[c]=l[c]);return{$$typeof:e,type:o,key:p,ref:v,props:h,_owner:i.current}}return Fm.Fragment=r,Fm.jsx=s,Fm.jsxs=s,Fm}var uE;function ZD(){return uE||(uE=1,Lb.exports=KD()),Lb.exports}var m=ZD(),ie=sm();const nr=Tf(ie),YD=qD({__proto__:null,default:nr},[ie]);var K0={},Db={exports:{}},Ws={},Ib={exports:{}},jb={};var cE;function XD(){return cE||(cE=1,(function(t){function e(Q,ne){var re=Q.length;Q.push(ne);e:for(;0<re;){var q=re-1>>>1,te=Q[q];if(0<i(te,ne))Q[q]=ne,Q[re]=te,re=q;else break e}}function r(Q){return Q.length===0?null:Q[0]}function n(Q){if(Q.length===0)return null;var ne=Q[0],re=Q.pop();if(re!==ne){Q[0]=re;e:for(var q=0,te=Q.length,ae=te>>>1;q<ae;){var de=2*(q+1)-1,ge=Q[de],ye=de+1,se=Q[ye];if(0>i(ge,re))ye<te&&0>i(se,ge)?(Q[q]=se,Q[ye]=re,q=ye):(Q[q]=ge,Q[de]=re,q=de);else if(ye<te&&0>i(se,re))Q[q]=se,Q[ye]=re,q=ye;else break e}}return ne}function i(Q,ne){var re=Q.sortIndex-ne.sortIndex;return re!==0?re:Q.id-ne.id}if(typeof performance=="object"&&typeof performance.now=="function"){var a=performance;t.unstable_now=function(){return a.now()}}else{var s=Date,o=s.now();t.unstable_now=function(){return s.now()-o}}var l=[],u=[],c=1,h=null,p=3,v=!1,y=!1,S=!1,w=typeof setTimeout=="function"?setTimeout:null,T=typeof clearTimeout=="function"?clearTimeout:null,_=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function C(Q){for(var ne=r(u);ne!==null;){if(ne.callback===null)n(u);else if(ne.startTime<=Q)n(u),ne.sortIndex=ne.expirationTime,e(l,ne);else break;ne=r(u)}}function N(Q){if(S=!1,C(Q),!y)if(r(l)!==null)y=!0,W(A);else{var ne=r(u);ne!==null&&Y(N,ne.startTime-Q)}}function A(Q,ne){y=!1,S&&(S=!1,T(O),O=-1),v=!0;var re=p;try{for(C(ne),h=r(l);h!==null&&(!(h.expirationTime>ne)||Q&&!$());){var q=h.callback;if(typeof q=="function"){h.callback=null,p=h.priorityLevel;var te=q(h.expirationTime<=ne);ne=t.unstable_now(),typeof te=="function"?h.callback=te:h===r(l)&&n(l),C(ne)}else n(l);h=r(l)}if(h!==null)var ae=!0;else{var de=r(u);de!==null&&Y(N,de.startTime-ne),ae=!1}return ae}finally{h=null,p=re,v=!1}}var I=!1,j=null,O=-1,F=5,B=-1;function $(){return!(t.unstable_now()-B<F)}function Z(){if(j!==null){var Q=t.unstable_now();B=Q;var ne=!0;try{ne=j(!0,Q)}finally{ne?D():(I=!1,j=null)}}else I=!1}var D;if(typeof _=="function")D=function(){_(Z)};else if(typeof MessageChannel<"u"){var H=new MessageChannel,U=H.port2;H.port1.onmessage=Z,D=function(){U.postMessage(null)}}else D=function(){w(Z,0)};function W(Q){j=Q,I||(I=!0,D())}function Y(Q,ne){O=w(function(){Q(t.unstable_now())},ne)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(Q){Q.callback=null},t.unstable_continueExecution=function(){y||v||(y=!0,W(A))},t.unstable_forceFrameRate=function(Q){0>Q||125<Q?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):F=0<Q?Math.floor(1e3/Q):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_getFirstCallbackNode=function(){return r(l)},t.unstable_next=function(Q){switch(p){case 1:case 2:case 3:var ne=3;break;default:ne=p}var re=p;p=ne;try{return Q()}finally{p=re}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(Q,ne){switch(Q){case 1:case 2:case 3:case 4:case 5:break;default:Q=3}var re=p;p=Q;try{return ne()}finally{p=re}},t.unstable_scheduleCallback=function(Q,ne,re){var q=t.unstable_now();switch(typeof re=="object"&&re!==null?(re=re.delay,re=typeof re=="number"&&0<re?q+re:q):re=q,Q){case 1:var te=-1;break;case 2:te=250;break;case 5:te=1073741823;break;case 4:te=1e4;break;default:te=5e3}return te=re+te,Q={id:c++,callback:ne,priorityLevel:Q,startTime:re,expirationTime:te,sortIndex:-1},re>q?(Q.sortIndex=re,e(u,Q),r(l)===null&&Q===r(u)&&(S?(T(O),O=-1):S=!0,Y(N,re-q))):(Q.sortIndex=te,e(l,Q),y||v||(y=!0,W(A))),Q},t.unstable_shouldYield=$,t.unstable_wrapCallback=function(Q){var ne=p;return function(){var re=p;p=ne;try{return Q.apply(this,arguments)}finally{p=re}}}})(jb)),jb}var dE;function Wk(){return dE||(dE=1,Ib.exports=XD()),Ib.exports}var hE;function QD(){if(hE)return Ws;hE=1;var t=sm(),e=Wk();function r(d){for(var g="https://reactjs.org/docs/error-decoder.html?invariant="+d,E=1;E<arguments.length;E++)g+="&args[]="+encodeURIComponent(arguments[E]);return"Minified React error #"+d+"; visit "+g+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var n=new Set,i={};function a(d,g){s(d,g),s(d+"Capture",g)}function s(d,g){for(i[d]=g,d=0;d<g.length;d++)n.add(g[d])}var o=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),l=Object.prototype.hasOwnProperty,u=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,c={},h={};function p(d){return l.call(h,d)?!0:l.call(c,d)?!1:u.test(d)?h[d]=!0:(c[d]=!0,!1)}function v(d,g,E,R){if(E!==null&&E.type===0)return!1;switch(typeof g){case"function":case"symbol":return!0;case"boolean":return R?!1:E!==null?!E.acceptsBooleans:(d=d.toLowerCase().slice(0,5),d!=="data-"&&d!=="aria-");default:return!1}}function y(d,g,E,R){if(g===null||typeof g>"u"||v(d,g,E,R))return!0;if(R)return!1;if(E!==null)switch(E.type){case 3:return!g;case 4:return g===!1;case 5:return isNaN(g);case 6:return isNaN(g)||1>g}return!1}function S(d,g,E,R,V,X,oe){this.acceptsBooleans=g===2||g===3||g===4,this.attributeName=R,this.attributeNamespace=V,this.mustUseProperty=E,this.propertyName=d,this.type=g,this.sanitizeURL=X,this.removeEmptyString=oe}var w={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(d){w[d]=new S(d,0,!1,d,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(d){var g=d[0];w[g]=new S(g,1,!1,d[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(d){w[d]=new S(d,2,!1,d.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(d){w[d]=new S(d,2,!1,d,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(d){w[d]=new S(d,3,!1,d.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(d){w[d]=new S(d,3,!0,d,null,!1,!1)}),["capture","download"].forEach(function(d){w[d]=new S(d,4,!1,d,null,!1,!1)}),["cols","rows","size","span"].forEach(function(d){w[d]=new S(d,6,!1,d,null,!1,!1)}),["rowSpan","start"].forEach(function(d){w[d]=new S(d,5,!1,d.toLowerCase(),null,!1,!1)});var T=/[\-:]([a-z])/g;function _(d){return d[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(d){var g=d.replace(T,_);w[g]=new S(g,1,!1,d,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(d){var g=d.replace(T,_);w[g]=new S(g,1,!1,d,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(d){var g=d.replace(T,_);w[g]=new S(g,1,!1,d,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(d){w[d]=new S(d,1,!1,d.toLowerCase(),null,!1,!1)}),w.xlinkHref=new S("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(d){w[d]=new S(d,1,!1,d.toLowerCase(),null,!0,!0)});function C(d,g,E,R){var V=w.hasOwnProperty(g)?w[g]:null;(V!==null?V.type!==0:R||!(2<g.length)||g[0]!=="o"&&g[0]!=="O"||g[1]!=="n"&&g[1]!=="N")&&(y(g,E,V,R)&&(E=null),R||V===null?p(g)&&(E===null?d.removeAttribute(g):d.setAttribute(g,""+E)):V.mustUseProperty?d[V.propertyName]=E===null?V.type===3?!1:"":E:(g=V.attributeName,R=V.attributeNamespace,E===null?d.removeAttribute(g):(V=V.type,E=V===3||V===4&&E===!0?"":""+E,R?d.setAttributeNS(R,g,E):d.setAttribute(g,E))))}var N=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,A=Symbol.for("react.element"),I=Symbol.for("react.portal"),j=Symbol.for("react.fragment"),O=Symbol.for("react.strict_mode"),F=Symbol.for("react.profiler"),B=Symbol.for("react.provider"),$=Symbol.for("react.context"),Z=Symbol.for("react.forward_ref"),D=Symbol.for("react.suspense"),H=Symbol.for("react.suspense_list"),U=Symbol.for("react.memo"),W=Symbol.for("react.lazy"),Y=Symbol.for("react.offscreen"),Q=Symbol.iterator;function ne(d){return d===null||typeof d!="object"?null:(d=Q&&d[Q]||d["@@iterator"],typeof d=="function"?d:null)}var re=Object.assign,q;function te(d){if(q===void 0)try{throw Error()}catch(E){var g=E.stack.trim().match(/\n( *(at )?)/);q=g&&g[1]||""}return`
`+q+d}var ae=!1;function de(d,g){if(!d||ae)return"";ae=!0;var E=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(g)if(g=function(){throw Error()},Object.defineProperty(g.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(g,[])}catch(Ue){var R=Ue}Reflect.construct(d,[],g)}else{try{g.call()}catch(Ue){R=Ue}d.call(g.prototype)}else{try{throw Error()}catch(Ue){R=Ue}d()}}catch(Ue){if(Ue&&R&&typeof Ue.stack=="string"){for(var V=Ue.stack.split(`
`),X=R.stack.split(`
`),oe=V.length-1,be=X.length-1;1<=oe&&0<=be&&V[oe]!==X[be];)be--;for(;1<=oe&&0<=be;oe--,be--)if(V[oe]!==X[be]){if(oe!==1||be!==1)do if(oe--,be--,0>be||V[oe]!==X[be]){var _e=`
`+V[oe].replace(" at new "," at ");return d.displayName&&_e.includes("<anonymous>")&&(_e=_e.replace("<anonymous>",d.displayName)),_e}while(1<=oe&&0<=be);break}}}finally{ae=!1,Error.prepareStackTrace=E}return(d=d?d.displayName||d.name:"")?te(d):""}function ge(d){switch(d.tag){case 5:return te(d.type);case 16:return te("Lazy");case 13:return te("Suspense");case 19:return te("SuspenseList");case 0:case 2:case 15:return d=de(d.type,!1),d;case 11:return d=de(d.type.render,!1),d;case 1:return d=de(d.type,!0),d;default:return""}}function ye(d){if(d==null)return null;if(typeof d=="function")return d.displayName||d.name||null;if(typeof d=="string")return d;switch(d){case j:return"Fragment";case I:return"Portal";case F:return"Profiler";case O:return"StrictMode";case D:return"Suspense";case H:return"SuspenseList"}if(typeof d=="object")switch(d.$$typeof){case $:return(d.displayName||"Context")+".Consumer";case B:return(d._context.displayName||"Context")+".Provider";case Z:var g=d.render;return d=d.displayName,d||(d=g.displayName||g.name||"",d=d!==""?"ForwardRef("+d+")":"ForwardRef"),d;case U:return g=d.displayName||null,g!==null?g:ye(d.type)||"Memo";case W:g=d._payload,d=d._init;try{return ye(d(g))}catch{}}return null}function se(d){var g=d.type;switch(d.tag){case 24:return"Cache";case 9:return(g.displayName||"Context")+".Consumer";case 10:return(g._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return d=g.render,d=d.displayName||d.name||"",g.displayName||(d!==""?"ForwardRef("+d+")":"ForwardRef");case 7:return"Fragment";case 5:return g;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return ye(g);case 8:return g===O?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof g=="function")return g.displayName||g.name||null;if(typeof g=="string")return g}return null}function fe(d){switch(typeof d){case"boolean":case"number":case"string":case"undefined":return d;case"object":return d;default:return""}}function le(d){var g=d.type;return(d=d.nodeName)&&d.toLowerCase()==="input"&&(g==="checkbox"||g==="radio")}function pe(d){var g=le(d)?"checked":"value",E=Object.getOwnPropertyDescriptor(d.constructor.prototype,g),R=""+d[g];if(!d.hasOwnProperty(g)&&typeof E<"u"&&typeof E.get=="function"&&typeof E.set=="function"){var V=E.get,X=E.set;return Object.defineProperty(d,g,{configurable:!0,get:function(){return V.call(this)},set:function(oe){R=""+oe,X.call(this,oe)}}),Object.defineProperty(d,g,{enumerable:E.enumerable}),{getValue:function(){return R},setValue:function(oe){R=""+oe},stopTracking:function(){d._valueTracker=null,delete d[g]}}}}function me(d){d._valueTracker||(d._valueTracker=pe(d))}function xe(d){if(!d)return!1;var g=d._valueTracker;if(!g)return!0;var E=g.getValue(),R="";return d&&(R=le(d)?d.checked?"true":"false":d.value),d=R,d!==E?(g.setValue(d),!0):!1}function Se(d){if(d=d||(typeof document<"u"?document:void 0),typeof d>"u")return null;try{return d.activeElement||d.body}catch{return d.body}}function Ve(d,g){var E=g.checked;return re({},g,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:E??d._wrapperState.initialChecked})}function $e(d,g){var E=g.defaultValue==null?"":g.defaultValue,R=g.checked!=null?g.checked:g.defaultChecked;E=fe(g.value!=null?g.value:E),d._wrapperState={initialChecked:R,initialValue:E,controlled:g.type==="checkbox"||g.type==="radio"?g.checked!=null:g.value!=null}}function St(d,g){g=g.checked,g!=null&&C(d,"checked",g,!1)}function rt(d,g){St(d,g);var E=fe(g.value),R=g.type;if(E!=null)R==="number"?(E===0&&d.value===""||d.value!=E)&&(d.value=""+E):d.value!==""+E&&(d.value=""+E);else if(R==="submit"||R==="reset"){d.removeAttribute("value");return}g.hasOwnProperty("value")?De(d,g.type,E):g.hasOwnProperty("defaultValue")&&De(d,g.type,fe(g.defaultValue)),g.checked==null&&g.defaultChecked!=null&&(d.defaultChecked=!!g.defaultChecked)}function lt(d,g,E){if(g.hasOwnProperty("value")||g.hasOwnProperty("defaultValue")){var R=g.type;if(!(R!=="submit"&&R!=="reset"||g.value!==void 0&&g.value!==null))return;g=""+d._wrapperState.initialValue,E||g===d.value||(d.value=g),d.defaultValue=g}E=d.name,E!==""&&(d.name=""),d.defaultChecked=!!d._wrapperState.initialChecked,E!==""&&(d.name=E)}function De(d,g,E){(g!=="number"||Se(d.ownerDocument)!==d)&&(E==null?d.defaultValue=""+d._wrapperState.initialValue:d.defaultValue!==""+E&&(d.defaultValue=""+E))}var Le=Array.isArray;function Qe(d,g,E,R){if(d=d.options,g){g={};for(var V=0;V<E.length;V++)g["$"+E[V]]=!0;for(E=0;E<d.length;E++)V=g.hasOwnProperty("$"+d[E].value),d[E].selected!==V&&(d[E].selected=V),V&&R&&(d[E].defaultSelected=!0)}else{for(E=""+fe(E),g=null,V=0;V<d.length;V++){if(d[V].value===E){d[V].selected=!0,R&&(d[V].defaultSelected=!0);return}g!==null||d[V].disabled||(g=d[V])}g!==null&&(g.selected=!0)}}function Ce(d,g){if(g.dangerouslySetInnerHTML!=null)throw Error(r(91));return re({},g,{value:void 0,defaultValue:void 0,children:""+d._wrapperState.initialValue})}function Fe(d,g){var E=g.value;if(E==null){if(E=g.children,g=g.defaultValue,E!=null){if(g!=null)throw Error(r(92));if(Le(E)){if(1<E.length)throw Error(r(93));E=E[0]}g=E}g==null&&(g=""),E=g}d._wrapperState={initialValue:fe(E)}}function Ke(d,g){var E=fe(g.value),R=fe(g.defaultValue);E!=null&&(E=""+E,E!==d.value&&(d.value=E),g.defaultValue==null&&d.defaultValue!==E&&(d.defaultValue=E)),R!=null&&(d.defaultValue=""+R)}function mt(d){var g=d.textContent;g===d._wrapperState.initialValue&&g!==""&&g!==null&&(d.value=g)}function gt(d){switch(d){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function yt(d,g){return d==null||d==="http://www.w3.org/1999/xhtml"?gt(g):d==="http://www.w3.org/2000/svg"&&g==="foreignObject"?"http://www.w3.org/1999/xhtml":d}var jt,qt=(function(d){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(g,E,R,V){MSApp.execUnsafeLocalFunction(function(){return d(g,E,R,V)})}:d})(function(d,g){if(d.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in d)d.innerHTML=g;else{for(jt=jt||document.createElement("div"),jt.innerHTML="<svg>"+g.valueOf().toString()+"</svg>",g=jt.firstChild;d.firstChild;)d.removeChild(d.firstChild);for(;g.firstChild;)d.appendChild(g.firstChild)}});function wt(d,g){if(g){var E=d.firstChild;if(E&&E===d.lastChild&&E.nodeType===3){E.nodeValue=g;return}}d.textContent=g}var ft={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},qe=["Webkit","ms","Moz","O"];Object.keys(ft).forEach(function(d){qe.forEach(function(g){g=g+d.charAt(0).toUpperCase()+d.substring(1),ft[g]=ft[d]})});function ce(d,g,E){return g==null||typeof g=="boolean"||g===""?"":E||typeof g!="number"||g===0||ft.hasOwnProperty(d)&&ft[d]?(""+g).trim():g+"px"}function ve(d,g){d=d.style;for(var E in g)if(g.hasOwnProperty(E)){var R=E.indexOf("--")===0,V=ce(E,g[E],R);E==="float"&&(E="cssFloat"),R?d.setProperty(E,V):d[E]=V}}var ke=re({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Te(d,g){if(g){if(ke[d]&&(g.children!=null||g.dangerouslySetInnerHTML!=null))throw Error(r(137,d));if(g.dangerouslySetInnerHTML!=null){if(g.children!=null)throw Error(r(60));if(typeof g.dangerouslySetInnerHTML!="object"||!("__html"in g.dangerouslySetInnerHTML))throw Error(r(61))}if(g.style!=null&&typeof g.style!="object")throw Error(r(62))}}function Re(d,g){if(d.indexOf("-")===-1)return typeof g.is=="string";switch(d){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Je=null;function ze(d){return d=d.target||d.srcElement||window,d.correspondingUseElement&&(d=d.correspondingUseElement),d.nodeType===3?d.parentNode:d}var vt=null,pt=null,At=null;function Ut(d){if(d=vl(d)){if(typeof vt!="function")throw Error(r(280));var g=d.stateNode;g&&(g=oi(g),vt(d.stateNode,d.type,g))}}function Kt(d){pt?At?At.push(d):At=[d]:pt=d}function Ct(){if(pt){var d=pt,g=At;if(At=pt=null,Ut(d),g)for(d=0;d<g.length;d++)Ut(g[d])}}function Yt(d,g){return d(g)}function Xt(){}var Lr=!1;function ar(d,g,E){if(Lr)return d(g,E);Lr=!0;try{return Yt(d,g,E)}finally{Lr=!1,(pt!==null||At!==null)&&(Xt(),Ct())}}function mn(d,g){var E=d.stateNode;if(E===null)return null;var R=oi(E);if(R===null)return null;E=R[g];e:switch(g){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(R=!R.disabled)||(d=d.type,R=!(d==="button"||d==="input"||d==="select"||d==="textarea")),d=!R;break e;default:d=!1}if(d)return null;if(E&&typeof E!="function")throw Error(r(231,g,typeof E));return E}var Wr=!1;if(o)try{var Br={};Object.defineProperty(Br,"passive",{get:function(){Wr=!0}}),window.addEventListener("test",Br,Br),window.removeEventListener("test",Br,Br)}catch{Wr=!1}function nn(d,g,E,R,V,X,oe,be,_e){var Ue=Array.prototype.slice.call(arguments,3);try{g.apply(E,Ue)}catch(nt){this.onError(nt)}}var br=!1,Tt=null,zr=!1,Qn=null,Ji={onError:function(d){br=!0,Tt=d}};function Ka(d,g,E,R,V,X,oe,be,_e){br=!1,Tt=null,nn.apply(Ji,arguments)}function Rs(d,g,E,R,V,X,oe,be,_e){if(Ka.apply(this,arguments),br){if(br){var Ue=Tt;br=!1,Tt=null}else throw Error(r(198));zr||(zr=!0,Qn=Ue)}}function Ln(d){var g=d,E=d;if(d.alternate)for(;g.return;)g=g.return;else{d=g;do g=d,(g.flags&4098)!==0&&(E=g.return),d=g.return;while(d)}return g.tag===3?E:null}function un(d){if(d.tag===13){var g=d.memoizedState;if(g===null&&(d=d.alternate,d!==null&&(g=d.memoizedState)),g!==null)return g.dehydrated}return null}function bn(d){if(Ln(d)!==d)throw Error(r(188))}function Jn(d){var g=d.alternate;if(!g){if(g=Ln(d),g===null)throw Error(r(188));return g!==d?null:d}for(var E=d,R=g;;){var V=E.return;if(V===null)break;var X=V.alternate;if(X===null){if(R=V.return,R!==null){E=R;continue}break}if(V.child===X.child){for(X=V.child;X;){if(X===E)return bn(V),d;if(X===R)return bn(V),g;X=X.sibling}throw Error(r(188))}if(E.return!==R.return)E=V,R=X;else{for(var oe=!1,be=V.child;be;){if(be===E){oe=!0,E=V,R=X;break}if(be===R){oe=!0,R=V,E=X;break}be=be.sibling}if(!oe){for(be=X.child;be;){if(be===E){oe=!0,E=X,R=V;break}if(be===R){oe=!0,R=X,E=V;break}be=be.sibling}if(!oe)throw Error(r(189))}}if(E.alternate!==R)throw Error(r(190))}if(E.tag!==3)throw Error(r(188));return E.stateNode.current===E?d:g}function zi(d){return d=Jn(d),d!==null?vi(d):null}function vi(d){if(d.tag===5||d.tag===6)return d;for(d=d.child;d!==null;){var g=vi(d);if(g!==null)return g;d=d.sibling}return null}var Jo=e.unstable_scheduleCallback,el=e.unstable_cancelCallback,zl=e.unstable_shouldYield,xo=e.unstable_requestPaint,Xr=e.unstable_now,tl=e.unstable_getCurrentPriorityLevel,fs=e.unstable_ImmediatePriority,Be=e.unstable_UserBlockingPriority,Xe=e.unstable_NormalPriority,ot=e.unstable_LowPriority,Vt=e.unstable_IdlePriority,ir=null,tr=null;function gr(d){if(tr&&typeof tr.onCommitFiberRoot=="function")try{tr.onCommitFiberRoot(ir,d,void 0,(d.current.flags&128)===128)}catch{}}var ct=Math.clz32?Math.clz32:Ur,mr=Math.log,Qr=Math.LN2;function Ur(d){return d>>>=0,d===0?32:31-(mr(d)/Qr|0)|0}var Or=64,ii=4194304;function it(d){switch(d&-d){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return d&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return d&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return d}}function sr(d,g){var E=d.pendingLanes;if(E===0)return 0;var R=0,V=d.suspendedLanes,X=d.pingedLanes,oe=E&268435455;if(oe!==0){var be=oe&~V;be!==0?R=it(be):(X&=oe,X!==0&&(R=it(X)))}else oe=E&~V,oe!==0?R=it(oe):X!==0&&(R=it(X));if(R===0)return 0;if(g!==0&&g!==R&&(g&V)===0&&(V=R&-R,X=g&-g,V>=X||V===16&&(X&4194240)!==0))return g;if((R&4)!==0&&(R|=E&16),g=d.entangledLanes,g!==0)for(d=d.entanglements,g&=R;0<g;)E=31-ct(g),V=1<<E,R|=d[E],g&=~V;return R}function yi(d,g){switch(d){case 1:case 2:case 4:return g+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return g+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function On(d,g){for(var E=d.suspendedLanes,R=d.pingedLanes,V=d.expirationTimes,X=d.pendingLanes;0<X;){var oe=31-ct(X),be=1<<oe,_e=V[oe];_e===-1?((be&E)===0||(be&R)!==0)&&(V[oe]=yi(be,g)):_e<=g&&(d.expiredLanes|=be),X&=~be}}function Dn(d){return d=d.pendingLanes&-1073741825,d!==0?d:d&1073741824?1073741824:0}function Ul(){var d=Or;return Or<<=1,(Or&4194240)===0&&(Or=64),d}function Mi(d){for(var g=[],E=0;31>E;E++)g.push(d);return g}function ps(d,g,E){d.pendingLanes|=g,g!==536870912&&(d.suspendedLanes=0,d.pingedLanes=0),d=d.eventTimes,g=31-ct(g),d[g]=E}function In(d,g){var E=d.pendingLanes&~g;d.pendingLanes=g,d.suspendedLanes=0,d.pingedLanes=0,d.expiredLanes&=g,d.mutableReadLanes&=g,d.entangledLanes&=g,g=d.entanglements;var R=d.eventTimes;for(d=d.expirationTimes;0<E;){var V=31-ct(E),X=1<<V;g[V]=0,R[V]=-1,d[V]=-1,E&=~X}}function to(d,g){var E=d.entangledLanes|=g;for(d=d.entanglements;E;){var R=31-ct(E),V=1<<R;V&g|d[R]&g&&(d[R]|=g),E&=~V}}var wr=0;function ro(d){return d&=-d,1<d?4<d?(d&268435455)!==0?16:536870912:4:1}var bo,Ls,Cc,Ec,rl,Gl=!1,wo=[],Ui=null,no=null,Za=null,Sr=new Map,rr=new Map,ei=[],qr="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function gh(d,g){switch(d){case"focusin":case"focusout":Ui=null;break;case"dragenter":case"dragleave":no=null;break;case"mouseover":case"mouseout":Za=null;break;case"pointerover":case"pointerout":Sr.delete(g.pointerId);break;case"gotpointercapture":case"lostpointercapture":rr.delete(g.pointerId)}}function nl(d,g,E,R,V,X){return d===null||d.nativeEvent!==X?(d={blockedOn:g,domEventName:E,eventSystemFlags:R,nativeEvent:X,targetContainers:[V]},g!==null&&(g=vl(g),g!==null&&Ls(g)),d):(d.eventSystemFlags|=R,g=d.targetContainers,V!==null&&g.indexOf(V)===-1&&g.push(V),d)}function jn(d,g,E,R,V){switch(g){case"focusin":return Ui=nl(Ui,d,g,E,R,V),!0;case"dragenter":return no=nl(no,d,g,E,R,V),!0;case"mouseover":return Za=nl(Za,d,g,E,R,V),!0;case"pointerover":var X=V.pointerId;return Sr.set(X,nl(Sr.get(X)||null,d,g,E,R,V)),!0;case"gotpointercapture":return X=V.pointerId,rr.set(X,nl(rr.get(X)||null,d,g,E,R,V)),!0}return!1}function Vl(d){var g=Po(d.target);if(g!==null){var E=Ln(g);if(E!==null){if(g=E.tag,g===13){if(g=un(E),g!==null){d.blockedOn=g,rl(d.priority,function(){Cc(E)});return}}else if(g===3&&E.stateNode.current.memoizedState.isDehydrated){d.blockedOn=E.tag===3?E.stateNode.containerInfo:null;return}}}d.blockedOn=null}function Os(d){if(d.blockedOn!==null)return!1;for(var g=d.targetContainers;0<g.length;){var E=Du(d.domEventName,d.eventSystemFlags,g[0],d.nativeEvent);if(E===null){E=d.nativeEvent;var R=new E.constructor(E.type,E);Je=R,E.target.dispatchEvent(R),Je=null}else return g=vl(E),g!==null&&Ls(g),d.blockedOn=E,!1;g.shift()}return!0}function Hl(d,g,E){Os(d)&&E.delete(g)}function Lu(){Gl=!1,Ui!==null&&Os(Ui)&&(Ui=null),no!==null&&Os(no)&&(no=null),Za!==null&&Os(Za)&&(Za=null),Sr.forEach(Hl),rr.forEach(Hl)}function cn(d,g){d.blockedOn===g&&(d.blockedOn=null,Gl||(Gl=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,Lu)))}function Fn(d){function g(V){return cn(V,d)}if(0<wo.length){cn(wo[0],d);for(var E=1;E<wo.length;E++){var R=wo[E];R.blockedOn===d&&(R.blockedOn=null)}}for(Ui!==null&&cn(Ui,d),no!==null&&cn(no,d),Za!==null&&cn(Za,d),Sr.forEach(g),rr.forEach(g),E=0;E<ei.length;E++)R=ei[E],R.blockedOn===d&&(R.blockedOn=null);for(;0<ei.length&&(E=ei[0],E.blockedOn===null);)Vl(E),E.blockedOn===null&&ei.shift()}var il=N.ReactCurrentBatchConfig,Ou=!0;function ms(d,g,E,R){var V=wr,X=il.transition;il.transition=null;try{wr=1,So(d,g,E,R)}finally{wr=V,il.transition=X}}function Ds(d,g,E,R){var V=wr,X=il.transition;il.transition=null;try{wr=4,So(d,g,E,R)}finally{wr=V,il.transition=X}}function So(d,g,E,R){if(Ou){var V=Du(d,g,E,R);if(V===null)f(d,g,R,Wl,E),gh(d,R);else if(jn(V,d,g,E,R))R.stopPropagation();else if(gh(d,R),g&4&&-1<qr.indexOf(d)){for(;V!==null;){var X=vl(V);if(X!==null&&bo(X),X=Du(d,g,E,R),X===null&&f(d,g,R,Wl,E),X===V)break;V=X}V!==null&&R.stopPropagation()}else f(d,g,R,null,E)}}var Wl=null;function Du(d,g,E,R){if(Wl=null,d=ze(R),d=Po(d),d!==null)if(g=Ln(d),g===null)d=null;else if(E=g.tag,E===13){if(d=un(g),d!==null)return d;d=null}else if(E===3){if(g.stateNode.current.memoizedState.isDehydrated)return g.tag===3?g.stateNode.containerInfo:null;d=null}else g!==d&&(d=null);return Wl=d,null}function Cr(d){switch(d){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(tl()){case fs:return 1;case Be:return 4;case Xe:case ot:return 16;case Vt:return 536870912;default:return 16}default:return 16}}var xi=null,ai=null,ka=null;function ql(){if(ka)return ka;var d,g=ai,E=g.length,R,V="value"in xi?xi.value:xi.textContent,X=V.length;for(d=0;d<E&&g[d]===V[d];d++);var oe=E-d;for(R=1;R<=oe&&g[E-R]===V[X-R];R++);return ka=V.slice(d,1<R?1-R:void 0)}function al(d){var g=d.keyCode;return"charCode"in d?(d=d.charCode,d===0&&g===13&&(d=13)):d=g,d===10&&(d=13),32<=d||d===13?d:0}function bi(){return!0}function _a(){return!1}function Bn(d){function g(E,R,V,X,oe){this._reactName=E,this._targetInst=V,this.type=R,this.nativeEvent=X,this.target=oe,this.currentTarget=null;for(var be in d)d.hasOwnProperty(be)&&(E=d[be],this[be]=E?E(X):X[be]);return this.isDefaultPrevented=(X.defaultPrevented!=null?X.defaultPrevented:X.returnValue===!1)?bi:_a,this.isPropagationStopped=_a,this}return re(g.prototype,{preventDefault:function(){this.defaultPrevented=!0;var E=this.nativeEvent;E&&(E.preventDefault?E.preventDefault():typeof E.returnValue!="unknown"&&(E.returnValue=!1),this.isDefaultPrevented=bi)},stopPropagation:function(){var E=this.nativeEvent;E&&(E.stopPropagation?E.stopPropagation():typeof E.cancelBubble!="unknown"&&(E.cancelBubble=!0),this.isPropagationStopped=bi)},persist:function(){},isPersistent:bi}),g}var ea={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(d){return d.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},gs=Bn(ea),Ca=re({},ea,{view:0,detail:0}),Of=Bn(Ca),ta,Iu,si,wn=re({},Ca,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:vs,button:0,buttons:0,relatedTarget:function(d){return d.relatedTarget===void 0?d.fromElement===d.srcElement?d.toElement:d.fromElement:d.relatedTarget},movementX:function(d){return"movementX"in d?d.movementX:(d!==si&&(si&&d.type==="mousemove"?(ta=d.screenX-si.screenX,Iu=d.screenY-si.screenY):Iu=ta=0,si=d),ta)},movementY:function(d){return"movementY"in d?d.movementY:Iu}}),Jr=Bn(wn),$l=re({},wn,{dataTransfer:0}),Ea=Bn($l),Df=re({},Ca,{relatedTarget:0}),ju=Bn(Df),Tc=re({},ea,{animationName:0,elapsedTime:0,pseudoElement:0}),vh=Bn(Tc),If=re({},ea,{clipboardData:function(d){return"clipboardData"in d?d.clipboardData:window.clipboardData}}),Kl=Bn(If),jf=re({},ea,{data:0}),ko=Bn(jf),Nc={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Pc={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Is={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function ym(d){var g=this.nativeEvent;return g.getModifierState?g.getModifierState(d):(d=Is[d])?!!g[d]:!1}function vs(){return ym}var Gi=re({},Ca,{key:function(d){if(d.key){var g=Nc[d.key]||d.key;if(g!=="Unidentified")return g}return d.type==="keypress"?(d=al(d),d===13?"Enter":String.fromCharCode(d)):d.type==="keydown"||d.type==="keyup"?Pc[d.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:vs,charCode:function(d){return d.type==="keypress"?al(d):0},keyCode:function(d){return d.type==="keydown"||d.type==="keyup"?d.keyCode:0},which:function(d){return d.type==="keypress"?al(d):d.type==="keydown"||d.type==="keyup"?d.keyCode:0}}),yh=Bn(Gi),xh=re({},wn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),sl=Bn(xh),Mc=re({},Ca,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:vs}),Zl=Bn(Mc),Ac=re({},ea,{propertyName:0,elapsedTime:0,pseudoElement:0}),Yl=Bn(Ac),Rc=re({},wn,{deltaX:function(d){return"deltaX"in d?d.deltaX:"wheelDeltaX"in d?-d.wheelDeltaX:0},deltaY:function(d){return"deltaY"in d?d.deltaY:"wheelDeltaY"in d?-d.wheelDeltaY:"wheelDelta"in d?-d.wheelDelta:0},deltaZ:0,deltaMode:0}),bh=Bn(Rc),Ya=[9,13,27,32],js=o&&"CompositionEvent"in window,ol=null;o&&"documentMode"in document&&(ol=document.documentMode);var ra=o&&"TextEvent"in window&&!ol,Ta=o&&(!js||ol&&8<ol&&11>=ol),Na=" ",Lc=!1;function ll(d,g){switch(d){case"keyup":return Ya.indexOf(g.keyCode)!==-1;case"keydown":return g.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Xa(d){return d=d.detail,typeof d=="object"&&"data"in d?d.data:null}var Ai=!1;function wh(d,g){switch(d){case"compositionend":return Xa(g);case"keypress":return g.which!==32?null:(Lc=!0,Na);case"textInput":return d=g.data,d===Na&&Lc?null:d;default:return null}}function io(d,g){if(Ai)return d==="compositionend"||!js&&ll(d,g)?(d=ql(),ka=ai=xi=null,Ai=!1,d):null;switch(d){case"paste":return null;case"keypress":if(!(g.ctrlKey||g.altKey||g.metaKey)||g.ctrlKey&&g.altKey){if(g.char&&1<g.char.length)return g.char;if(g.which)return String.fromCharCode(g.which)}return null;case"compositionend":return Ta&&g.locale!=="ko"?null:g.data;default:return null}}var Qa={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function ao(d){var g=d&&d.nodeName&&d.nodeName.toLowerCase();return g==="input"?!!Qa[d.type]:g==="textarea"}function ul(d,g,E,R){Kt(R),g=P(g,"onChange"),0<g.length&&(E=new gs("onChange","change",null,E,R),d.push({event:E,listeners:g}))}var Xl=null,Ri=null;function Ff(d){Bc(d,0)}function Pa(d){var g=Vn(d);if(xe(g))return d}function Ja(d,g){if(d==="change")return g}var na=!1;if(o){var ys;if(o){var Ma="oninput"in document;if(!Ma){var Ql=document.createElement("div");Ql.setAttribute("oninput","return;"),Ma=typeof Ql.oninput=="function"}ys=Ma}else ys=!1;na=ys&&(!document.documentMode||9<document.documentMode)}function Fs(){Xl&&(Xl.detachEvent("onpropertychange",Fu),Ri=Xl=null)}function Fu(d){if(d.propertyName==="value"&&Pa(Ri)){var g=[];ul(g,Ri,d,ze(d)),ar(Ff,g)}}function Jl(d,g,E){d==="focusin"?(Fs(),Xl=g,Ri=E,Xl.attachEvent("onpropertychange",Fu)):d==="focusout"&&Fs()}function Gr(d){if(d==="selectionchange"||d==="keyup"||d==="keydown")return Pa(Ri)}function cl(d,g){if(d==="click")return Pa(g)}function Bu(d,g){if(d==="input"||d==="change")return Pa(g)}function Oc(d,g){return d===g&&(d!==0||1/d===1/g)||d!==d&&g!==g}var ia=typeof Object.is=="function"?Object.is:Oc;function Bs(d,g){if(ia(d,g))return!0;if(typeof d!="object"||d===null||typeof g!="object"||g===null)return!1;var E=Object.keys(d),R=Object.keys(g);if(E.length!==R.length)return!1;for(R=0;R<E.length;R++){var V=E[R];if(!l.call(g,V)||!ia(d[V],g[V]))return!1}return!0}function _o(d){for(;d&&d.firstChild;)d=d.firstChild;return d}function an(d,g){var E=_o(d);d=0;for(var R;E;){if(E.nodeType===3){if(R=d+E.textContent.length,d<=g&&R>=g)return{node:E,offset:g-d};d=R}e:{for(;E;){if(E.nextSibling){E=E.nextSibling;break e}E=E.parentNode}E=void 0}E=_o(E)}}function zn(d,g){return d&&g?d===g?!0:d&&d.nodeType===3?!1:g&&g.nodeType===3?zn(d,g.parentNode):"contains"in d?d.contains(g):d.compareDocumentPosition?!!(d.compareDocumentPosition(g)&16):!1:!1}function Un(){for(var d=window,g=Se();g instanceof d.HTMLIFrameElement;){try{var E=typeof g.contentWindow.location.href=="string"}catch{E=!1}if(E)d=g.contentWindow;else break;g=Se(d.document)}return g}function eu(d){var g=d&&d.nodeName&&d.nodeName.toLowerCase();return g&&(g==="input"&&(d.type==="text"||d.type==="search"||d.type==="tel"||d.type==="url"||d.type==="password")||g==="textarea"||d.contentEditable==="true")}function aa(d){var g=Un(),E=d.focusedElem,R=d.selectionRange;if(g!==E&&E&&E.ownerDocument&&zn(E.ownerDocument.documentElement,E)){if(R!==null&&eu(E)){if(g=R.start,d=R.end,d===void 0&&(d=g),"selectionStart"in E)E.selectionStart=g,E.selectionEnd=Math.min(d,E.value.length);else if(d=(g=E.ownerDocument||document)&&g.defaultView||window,d.getSelection){d=d.getSelection();var V=E.textContent.length,X=Math.min(R.start,V);R=R.end===void 0?X:Math.min(R.end,V),!d.extend&&X>R&&(V=R,R=X,X=V),V=an(E,X);var oe=an(E,R);V&&oe&&(d.rangeCount!==1||d.anchorNode!==V.node||d.anchorOffset!==V.offset||d.focusNode!==oe.node||d.focusOffset!==oe.offset)&&(g=g.createRange(),g.setStart(V.node,V.offset),d.removeAllRanges(),X>R?(d.addRange(g),d.extend(oe.node,oe.offset)):(g.setEnd(oe.node,oe.offset),d.addRange(g)))}}for(g=[],d=E;d=d.parentNode;)d.nodeType===1&&g.push({element:d,left:d.scrollLeft,top:d.scrollTop});for(typeof E.focus=="function"&&E.focus(),E=0;E<g.length;E++)d=g[E],d.element.scrollLeft=d.left,d.element.scrollTop=d.top}}var Co=o&&"documentMode"in document&&11>=document.documentMode,tu=null,Nn=null,dl=null,ru=!1;function Dc(d,g,E){var R=E.window===E?E.document:E.nodeType===9?E:E.ownerDocument;ru||tu==null||tu!==Se(R)||(R=tu,"selectionStart"in R&&eu(R)?R={start:R.selectionStart,end:R.selectionEnd}:(R=(R.ownerDocument&&R.ownerDocument.defaultView||window).getSelection(),R={anchorNode:R.anchorNode,anchorOffset:R.anchorOffset,focusNode:R.focusNode,focusOffset:R.focusOffset}),dl&&Bs(dl,R)||(dl=R,R=P(Nn,"onSelect"),0<R.length&&(g=new gs("onSelect","select",null,g,E),d.push({event:g,listeners:R}),g.target=tu)))}function wi(d,g){var E={};return E[d.toLowerCase()]=g.toLowerCase(),E["Webkit"+d]="webkit"+g,E["Moz"+d]="moz"+g,E}var Si={animationend:wi("Animation","AnimationEnd"),animationiteration:wi("Animation","AnimationIteration"),animationstart:wi("Animation","AnimationStart"),transitionend:wi("Transition","TransitionEnd")},es={},zu={};o&&(zu=document.createElement("div").style,"AnimationEvent"in window||(delete Si.animationend.animation,delete Si.animationiteration.animation,delete Si.animationstart.animation),"TransitionEvent"in window||delete Si.transitionend.transition);function hl(d){if(es[d])return es[d];if(!Si[d])return d;var g=Si[d],E;for(E in g)if(g.hasOwnProperty(E)&&E in zu)return es[d]=g[E];return d}var Sh=hl("animationend"),xs=hl("animationiteration"),Ic=hl("animationstart"),jc=hl("transitionend"),fl=new Map,kh="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ts(d,g){fl.set(d,g),a(g,[d])}for(var Eo=0;Eo<kh.length;Eo++){var To=kh[Eo],_h=To.toLowerCase(),Fc=To[0].toUpperCase()+To.slice(1);ts(_h,"on"+Fc)}ts(Sh,"onAnimationEnd"),ts(xs,"onAnimationIteration"),ts(Ic,"onAnimationStart"),ts("dblclick","onDoubleClick"),ts("focusin","onFocus"),ts("focusout","onBlur"),ts(jc,"onTransitionEnd"),s("onMouseEnter",["mouseout","mouseover"]),s("onMouseLeave",["mouseout","mouseover"]),s("onPointerEnter",["pointerout","pointerover"]),s("onPointerLeave",["pointerout","pointerover"]),a("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),a("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),a("onBeforeInput",["compositionend","keypress","textInput","paste"]),a("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),a("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),a("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var so="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Ch=new Set("cancel close invalid load scroll toggle".split(" ").concat(so));function Uu(d,g,E){var R=d.type||"unknown-event";d.currentTarget=E,Rs(R,g,void 0,d),d.currentTarget=null}function Bc(d,g){g=(g&4)!==0;for(var E=0;E<d.length;E++){var R=d[E],V=R.event;R=R.listeners;e:{var X=void 0;if(g)for(var oe=R.length-1;0<=oe;oe--){var be=R[oe],_e=be.instance,Ue=be.currentTarget;if(be=be.listener,_e!==X&&V.isPropagationStopped())break e;Uu(V,be,Ue),X=_e}else for(oe=0;oe<R.length;oe++){if(be=R[oe],_e=be.instance,Ue=be.currentTarget,be=be.listener,_e!==X&&V.isPropagationStopped())break e;Uu(V,be,Ue),X=_e}}}if(zr)throw d=Qn,zr=!1,Qn=null,d}function $r(d,g){var E=g[gl];E===void 0&&(E=g[gl]=new Set);var R=d+"__bubble";E.has(R)||(Eh(g,d,2,!1),E.add(R))}function zc(d,g,E){var R=0;g&&(R|=4),Eh(E,d,R,g)}var nu="_reactListening"+Math.random().toString(36).slice(2);function No(d){if(!d[nu]){d[nu]=!0,n.forEach(function(E){E!=="selectionchange"&&(Ch.has(E)||zc(E,!1,d),zc(E,!0,d))});var g=d.nodeType===9?d:d.ownerDocument;g===null||g[nu]||(g[nu]=!0,zc("selectionchange",!1,g))}}function Eh(d,g,E,R){switch(Cr(g)){case 1:var V=ms;break;case 4:V=Ds;break;default:V=So}E=V.bind(null,g,E,d),V=void 0,!Wr||g!=="touchstart"&&g!=="touchmove"&&g!=="wheel"||(V=!0),R?V!==void 0?d.addEventListener(g,E,{capture:!0,passive:V}):d.addEventListener(g,E,!0):V!==void 0?d.addEventListener(g,E,{passive:V}):d.addEventListener(g,E,!1)}function f(d,g,E,R,V){var X=R;if((g&1)===0&&(g&2)===0&&R!==null)e:for(;;){if(R===null)return;var oe=R.tag;if(oe===3||oe===4){var be=R.stateNode.containerInfo;if(be===V||be.nodeType===8&&be.parentNode===V)break;if(oe===4)for(oe=R.return;oe!==null;){var _e=oe.tag;if((_e===3||_e===4)&&(_e=oe.stateNode.containerInfo,_e===V||_e.nodeType===8&&_e.parentNode===V))return;oe=oe.return}for(;be!==null;){if(oe=Po(be),oe===null)return;if(_e=oe.tag,_e===5||_e===6){R=X=oe;continue e}be=be.parentNode}}R=R.return}ar(function(){var Ue=X,nt=ze(E),st=[];e:{var tt=fl.get(d);if(tt!==void 0){var Pt=gs,Dt=d;switch(d){case"keypress":if(al(E)===0)break e;case"keydown":case"keyup":Pt=yh;break;case"focusin":Dt="focus",Pt=ju;break;case"focusout":Dt="blur",Pt=ju;break;case"beforeblur":case"afterblur":Pt=ju;break;case"click":if(E.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Pt=Jr;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Pt=Ea;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Pt=Zl;break;case Sh:case xs:case Ic:Pt=vh;break;case jc:Pt=Yl;break;case"scroll":Pt=Of;break;case"wheel":Pt=bh;break;case"copy":case"cut":case"paste":Pt=Kl;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Pt=sl}var Bt=(g&4)!==0,Ei=!Bt&&d==="scroll",Ae=Bt?tt!==null?tt+"Capture":null:tt;Bt=[];for(var Ee=Ue,Oe;Ee!==null;){Oe=Ee;var ht=Oe.stateNode;if(Oe.tag===5&&ht!==null&&(Oe=ht,Ae!==null&&(ht=mn(Ee,Ae),ht!=null&&Bt.push(k(Ee,ht,Oe)))),Ei)break;Ee=Ee.return}0<Bt.length&&(tt=new Pt(tt,Dt,null,E,nt),st.push({event:tt,listeners:Bt}))}}if((g&7)===0){e:{if(tt=d==="mouseover"||d==="pointerover",Pt=d==="mouseout"||d==="pointerout",tt&&E!==Je&&(Dt=E.relatedTarget||E.fromElement)&&(Po(Dt)||Dt[Dr]))break e;if((Pt||tt)&&(tt=nt.window===nt?nt:(tt=nt.ownerDocument)?tt.defaultView||tt.parentWindow:window,Pt?(Dt=E.relatedTarget||E.toElement,Pt=Ue,Dt=Dt?Po(Dt):null,Dt!==null&&(Ei=Ln(Dt),Dt!==Ei||Dt.tag!==5&&Dt.tag!==6)&&(Dt=null)):(Pt=null,Dt=Ue),Pt!==Dt)){if(Bt=Jr,ht="onMouseLeave",Ae="onMouseEnter",Ee="mouse",(d==="pointerout"||d==="pointerover")&&(Bt=sl,ht="onPointerLeave",Ae="onPointerEnter",Ee="pointer"),Ei=Pt==null?tt:Vn(Pt),Oe=Dt==null?tt:Vn(Dt),tt=new Bt(ht,Ee+"leave",Pt,E,nt),tt.target=Ei,tt.relatedTarget=Oe,ht=null,Po(nt)===Ue&&(Bt=new Bt(Ae,Ee+"enter",Dt,E,nt),Bt.target=Oe,Bt.relatedTarget=Ei,ht=Bt),Ei=ht,Pt&&Dt)t:{for(Bt=Pt,Ae=Dt,Ee=0,Oe=Bt;Oe;Oe=G(Oe))Ee++;for(Oe=0,ht=Ae;ht;ht=G(ht))Oe++;for(;0<Ee-Oe;)Bt=G(Bt),Ee--;for(;0<Oe-Ee;)Ae=G(Ae),Oe--;for(;Ee--;){if(Bt===Ae||Ae!==null&&Bt===Ae.alternate)break t;Bt=G(Bt),Ae=G(Ae)}Bt=null}else Bt=null;Pt!==null&&J(st,tt,Pt,Bt,!1),Dt!==null&&Ei!==null&&J(st,Ei,Dt,Bt,!0)}}e:{if(tt=Ue?Vn(Ue):window,Pt=tt.nodeName&&tt.nodeName.toLowerCase(),Pt==="select"||Pt==="input"&&tt.type==="file")var zt=Ja;else if(ao(tt))if(na)zt=Bu;else{zt=Gr;var Qt=Jl}else(Pt=tt.nodeName)&&Pt.toLowerCase()==="input"&&(tt.type==="checkbox"||tt.type==="radio")&&(zt=cl);if(zt&&(zt=zt(d,Ue))){ul(st,zt,E,nt);break e}Qt&&Qt(d,tt,Ue),d==="focusout"&&(Qt=tt._wrapperState)&&Qt.controlled&&tt.type==="number"&&De(tt,"number",tt.value)}switch(Qt=Ue?Vn(Ue):window,d){case"focusin":(ao(Qt)||Qt.contentEditable==="true")&&(tu=Qt,Nn=Ue,dl=null);break;case"focusout":dl=Nn=tu=null;break;case"mousedown":ru=!0;break;case"contextmenu":case"mouseup":case"dragend":ru=!1,Dc(st,E,nt);break;case"selectionchange":if(Co)break;case"keydown":case"keyup":Dc(st,E,nt)}var Jt;if(js)e:{switch(d){case"compositionstart":var or="onCompositionStart";break e;case"compositionend":or="onCompositionEnd";break e;case"compositionupdate":or="onCompositionUpdate";break e}or=void 0}else Ai?ll(d,E)&&(or="onCompositionEnd"):d==="keydown"&&E.keyCode===229&&(or="onCompositionStart");or&&(Ta&&E.locale!=="ko"&&(Ai||or!=="onCompositionStart"?or==="onCompositionEnd"&&Ai&&(Jt=ql()):(xi=nt,ai="value"in xi?xi.value:xi.textContent,Ai=!0)),Qt=P(Ue,or),0<Qt.length&&(or=new ko(or,d,null,E,nt),st.push({event:or,listeners:Qt}),Jt?or.data=Jt:(Jt=Xa(E),Jt!==null&&(or.data=Jt)))),(Jt=ra?wh(d,E):io(d,E))&&(Ue=P(Ue,"onBeforeInput"),0<Ue.length&&(nt=new ko("onBeforeInput","beforeinput",null,E,nt),st.push({event:nt,listeners:Ue}),nt.data=Jt))}Bc(st,g)})}function k(d,g,E){return{instance:d,listener:g,currentTarget:E}}function P(d,g){for(var E=g+"Capture",R=[];d!==null;){var V=d,X=V.stateNode;V.tag===5&&X!==null&&(V=X,X=mn(d,E),X!=null&&R.unshift(k(d,X,V)),X=mn(d,g),X!=null&&R.push(k(d,X,V))),d=d.return}return R}function G(d){if(d===null)return null;do d=d.return;while(d&&d.tag!==5);return d||null}function J(d,g,E,R,V){for(var X=g._reactName,oe=[];E!==null&&E!==R;){var be=E,_e=be.alternate,Ue=be.stateNode;if(_e!==null&&_e===R)break;be.tag===5&&Ue!==null&&(be=Ue,V?(_e=mn(E,X),_e!=null&&oe.unshift(k(E,_e,be))):V||(_e=mn(E,X),_e!=null&&oe.push(k(E,_e,be)))),E=E.return}oe.length!==0&&d.push({event:g,listeners:oe})}var ue=/\r\n?/g,we=/\u0000|\uFFFD/g;function Me(d){return(typeof d=="string"?d:""+d).replace(ue,`
`).replace(we,"")}function Ie(d,g,E){if(g=Me(g),Me(d)!==g&&E)throw Error(r(425))}function Ze(){}var kt=null,$t=null;function hr(d,g){return d==="textarea"||d==="noscript"||typeof g.children=="string"||typeof g.children=="number"||typeof g.dangerouslySetInnerHTML=="object"&&g.dangerouslySetInnerHTML!==null&&g.dangerouslySetInnerHTML.__html!=null}var Kr=typeof setTimeout=="function"?setTimeout:void 0,Gn=typeof clearTimeout=="function"?clearTimeout:void 0,Li=typeof Promise=="function"?Promise:void 0,Vi=typeof queueMicrotask=="function"?queueMicrotask:typeof Li<"u"?function(d){return Li.resolve(null).then(d).catch(pl)}:Kr;function pl(d){setTimeout(function(){throw d})}function Uc(d,g){var E=g,R=0;do{var V=E.nextSibling;if(d.removeChild(E),V&&V.nodeType===8)if(E=V.data,E==="/$"){if(R===0){d.removeChild(V),Fn(g);return}R--}else E!=="$"&&E!=="$?"&&E!=="$!"||R++;E=V}while(E);Fn(g)}function zs(d){for(;d!=null;d=d.nextSibling){var g=d.nodeType;if(g===1||g===3)break;if(g===8){if(g=d.data,g==="$"||g==="$!"||g==="$?")break;if(g==="/$")return null}}return d}function ml(d){d=d.previousSibling;for(var g=0;d;){if(d.nodeType===8){var E=d.data;if(E==="$"||E==="$!"||E==="$?"){if(g===0)return d;g--}else E==="/$"&&g++}d=d.previousSibling}return null}var oo=Math.random().toString(36).slice(2),rs="__reactFiber$"+oo,iu="__reactProps$"+oo,Dr="__reactContainer$"+oo,gl="__reactEvents$"+oo,Bf="__reactListeners$"+oo,zf="__reactHandles$"+oo;function Po(d){var g=d[rs];if(g)return g;for(var E=d.parentNode;E;){if(g=E[Dr]||E[rs]){if(E=g.alternate,g.child!==null||E!==null&&E.child!==null)for(d=ml(d);d!==null;){if(E=d[rs])return E;d=ml(d)}return g}d=E,E=d.parentNode}return null}function vl(d){return d=d[rs]||d[Dr],!d||d.tag!==5&&d.tag!==6&&d.tag!==13&&d.tag!==3?null:d}function Vn(d){if(d.tag===5||d.tag===6)return d.stateNode;throw Error(r(33))}function oi(d){return d[iu]||null}var Uf=[],Gu=-1;function yl(d){return{current:d}}function dn(d){0>Gu||(d.current=Uf[Gu],Uf[Gu]=null,Gu--)}function sn(d,g){Gu++,Uf[Gu]=d.current,d.current=g}var Mo={},Hi=yl(Mo),sa=yl(!1),au=Mo;function Vu(d,g){var E=d.type.contextTypes;if(!E)return Mo;var R=d.stateNode;if(R&&R.__reactInternalMemoizedUnmaskedChildContext===g)return R.__reactInternalMemoizedMaskedChildContext;var V={},X;for(X in E)V[X]=g[X];return R&&(d=d.stateNode,d.__reactInternalMemoizedUnmaskedChildContext=g,d.__reactInternalMemoizedMaskedChildContext=V),V}function oa(d){return d=d.childContextTypes,d!=null}function Gc(){dn(sa),dn(Hi)}function xm(d,g,E){if(Hi.current!==Mo)throw Error(r(168));sn(Hi,g),sn(sa,E)}function Gf(d,g,E){var R=d.stateNode;if(g=g.childContextTypes,typeof R.getChildContext!="function")return E;R=R.getChildContext();for(var V in R)if(!(V in g))throw Error(r(108,se(d)||"Unknown",V));return re({},E,R)}function Hu(d){return d=(d=d.stateNode)&&d.__reactInternalMemoizedMergedChildContext||Mo,au=Hi.current,sn(Hi,d),sn(sa,sa.current),!0}function v0(d,g,E){var R=d.stateNode;if(!R)throw Error(r(169));E?(d=Gf(d,g,au),R.__reactInternalMemoizedMergedChildContext=d,dn(sa),dn(Hi),sn(Hi,d)):dn(sa),sn(sa,E)}var Ao=null,Vc=!1,Vf=!1;function Th(d){Ao===null?Ao=[d]:Ao.push(d)}function xl(d){Vc=!0,Th(d)}function su(){if(!Vf&&Ao!==null){Vf=!0;var d=0,g=wr;try{var E=Ao;for(wr=1;d<E.length;d++){var R=E[d];do R=R(!0);while(R!==null)}Ao=null,Vc=!1}catch(V){throw Ao!==null&&(Ao=Ao.slice(d+1)),Jo(fs,su),V}finally{wr=g,Vf=!1}}return null}var Aa=[],Wu=0,ou=null,lu=0,Ra=[],La=0,uu=null,bs=1,Sn="";function qu(d,g){Aa[Wu++]=lu,Aa[Wu++]=ou,ou=d,lu=g}function y0(d,g,E){Ra[La++]=bs,Ra[La++]=Sn,Ra[La++]=uu,uu=d;var R=bs;d=Sn;var V=32-ct(R)-1;R&=~(1<<V),E+=1;var X=32-ct(g)+V;if(30<X){var oe=V-V%5;X=(R&(1<<oe)-1).toString(32),R>>=oe,V-=oe,bs=1<<32-ct(g)+V|E<<V|R,Sn=X+d}else bs=1<<X|E<<V|R,Sn=d}function Hc(d){d.return!==null&&(qu(d,1),y0(d,1,0))}function Oi(d){for(;d===ou;)ou=Aa[--Wu],Aa[Wu]=null,lu=Aa[--Wu],Aa[Wu]=null;for(;d===uu;)uu=Ra[--La],Ra[La]=null,Sn=Ra[--La],Ra[La]=null,bs=Ra[--La],Ra[La]=null}var ws=null,xt=null,Zr=!1,Ss=null;function bm(d,g){var E=Fo(5,null,null,0);E.elementType="DELETED",E.stateNode=g,E.return=d,g=d.deletions,g===null?(d.deletions=[E],d.flags|=16):g.push(E)}function x0(d,g){switch(d.tag){case 5:var E=d.type;return g=g.nodeType!==1||E.toLowerCase()!==g.nodeName.toLowerCase()?null:g,g!==null?(d.stateNode=g,ws=d,xt=zs(g.firstChild),!0):!1;case 6:return g=d.pendingProps===""||g.nodeType!==3?null:g,g!==null?(d.stateNode=g,ws=d,xt=null,!0):!1;case 13:return g=g.nodeType!==8?null:g,g!==null?(E=uu!==null?{id:bs,overflow:Sn}:null,d.memoizedState={dehydrated:g,treeContext:E,retryLane:1073741824},E=Fo(18,null,null,0),E.stateNode=g,E.return=d,d.child=E,ws=d,xt=null,!0):!1;default:return!1}}function $u(d){return(d.mode&1)!==0&&(d.flags&128)===0}function Wc(d){if(Zr){var g=xt;if(g){var E=g;if(!x0(d,g)){if($u(d))throw Error(r(418));g=zs(E.nextSibling);var R=ws;g&&x0(d,g)?bm(R,E):(d.flags=d.flags&-4097|2,Zr=!1,ws=d)}}else{if($u(d))throw Error(r(418));d.flags=d.flags&-4097|2,Zr=!1,ws=d}}}function Hf(d){for(d=d.return;d!==null&&d.tag!==5&&d.tag!==3&&d.tag!==13;)d=d.return;ws=d}function Nh(d){if(d!==ws)return!1;if(!Zr)return Hf(d),Zr=!0,!1;var g;if((g=d.tag!==3)&&!(g=d.tag!==5)&&(g=d.type,g=g!=="head"&&g!=="body"&&!hr(d.type,d.memoizedProps)),g&&(g=xt)){if($u(d))throw wm(),Error(r(418));for(;g;)bm(d,g),g=zs(g.nextSibling)}if(Hf(d),d.tag===13){if(d=d.memoizedState,d=d!==null?d.dehydrated:null,!d)throw Error(r(317));e:{for(d=d.nextSibling,g=0;d;){if(d.nodeType===8){var E=d.data;if(E==="/$"){if(g===0){xt=zs(d.nextSibling);break e}g--}else E!=="$"&&E!=="$!"&&E!=="$?"||g++}d=d.nextSibling}xt=null}}else xt=ws?zs(d.stateNode.nextSibling):null;return!0}function wm(){for(var d=xt;d;)d=zs(d.nextSibling)}function Ku(){xt=ws=null,Zr=!1}function Ph(d){Ss===null?Ss=[d]:Ss.push(d)}var Sm=N.ReactCurrentBatchConfig;function ti(d,g,E){if(d=E.ref,d!==null&&typeof d!="function"&&typeof d!="object"){if(E._owner){if(E=E._owner,E){if(E.tag!==1)throw Error(r(309));var R=E.stateNode}if(!R)throw Error(r(147,d));var V=R,X=""+d;return g!==null&&g.ref!==null&&typeof g.ref=="function"&&g.ref._stringRef===X?g.ref:(g=function(oe){var be=V.refs;oe===null?delete be[X]:be[X]=oe},g._stringRef=X,g)}if(typeof d!="string")throw Error(r(284));if(!E._owner)throw Error(r(290,d))}return d}function ns(d,g){throw d=Object.prototype.toString.call(g),Error(r(31,d==="[object Object]"?"object with keys {"+Object.keys(g).join(", ")+"}":d))}function lo(d){var g=d._init;return g(d._payload)}function Wf(d){function g(Ae,Ee){if(d){var Oe=Ae.deletions;Oe===null?(Ae.deletions=[Ee],Ae.flags|=16):Oe.push(Ee)}}function E(Ae,Ee){if(!d)return null;for(;Ee!==null;)g(Ae,Ee),Ee=Ee.sibling;return null}function R(Ae,Ee){for(Ae=new Map;Ee!==null;)Ee.key!==null?Ae.set(Ee.key,Ee):Ae.set(Ee.index,Ee),Ee=Ee.sibling;return Ae}function V(Ae,Ee){return Ae=hd(Ae,Ee),Ae.index=0,Ae.sibling=null,Ae}function X(Ae,Ee,Oe){return Ae.index=Oe,d?(Oe=Ae.alternate,Oe!==null?(Oe=Oe.index,Oe<Ee?(Ae.flags|=2,Ee):Oe):(Ae.flags|=2,Ee)):(Ae.flags|=1048576,Ee)}function oe(Ae){return d&&Ae.alternate===null&&(Ae.flags|=2),Ae}function be(Ae,Ee,Oe,ht){return Ee===null||Ee.tag!==6?(Ee=Tb(Oe,Ae.mode,ht),Ee.return=Ae,Ee):(Ee=V(Ee,Oe),Ee.return=Ae,Ee)}function _e(Ae,Ee,Oe,ht){var zt=Oe.type;return zt===j?nt(Ae,Ee,Oe.props.children,ht,Oe.key):Ee!==null&&(Ee.elementType===zt||typeof zt=="object"&&zt!==null&&zt.$$typeof===W&&lo(zt)===Ee.type)?(ht=V(Ee,Oe.props),ht.ref=ti(Ae,Ee,Oe),ht.return=Ae,ht):(ht=z0(Oe.type,Oe.key,Oe.props,null,Ae.mode,ht),ht.ref=ti(Ae,Ee,Oe),ht.return=Ae,ht)}function Ue(Ae,Ee,Oe,ht){return Ee===null||Ee.tag!==4||Ee.stateNode.containerInfo!==Oe.containerInfo||Ee.stateNode.implementation!==Oe.implementation?(Ee=Nb(Oe,Ae.mode,ht),Ee.return=Ae,Ee):(Ee=V(Ee,Oe.children||[]),Ee.return=Ae,Ee)}function nt(Ae,Ee,Oe,ht,zt){return Ee===null||Ee.tag!==7?(Ee=zh(Oe,Ae.mode,ht,zt),Ee.return=Ae,Ee):(Ee=V(Ee,Oe),Ee.return=Ae,Ee)}function st(Ae,Ee,Oe){if(typeof Ee=="string"&&Ee!==""||typeof Ee=="number")return Ee=Tb(""+Ee,Ae.mode,Oe),Ee.return=Ae,Ee;if(typeof Ee=="object"&&Ee!==null){switch(Ee.$$typeof){case A:return Oe=z0(Ee.type,Ee.key,Ee.props,null,Ae.mode,Oe),Oe.ref=ti(Ae,null,Ee),Oe.return=Ae,Oe;case I:return Ee=Nb(Ee,Ae.mode,Oe),Ee.return=Ae,Ee;case W:var ht=Ee._init;return st(Ae,ht(Ee._payload),Oe)}if(Le(Ee)||ne(Ee))return Ee=zh(Ee,Ae.mode,Oe,null),Ee.return=Ae,Ee;ns(Ae,Ee)}return null}function tt(Ae,Ee,Oe,ht){var zt=Ee!==null?Ee.key:null;if(typeof Oe=="string"&&Oe!==""||typeof Oe=="number")return zt!==null?null:be(Ae,Ee,""+Oe,ht);if(typeof Oe=="object"&&Oe!==null){switch(Oe.$$typeof){case A:return Oe.key===zt?_e(Ae,Ee,Oe,ht):null;case I:return Oe.key===zt?Ue(Ae,Ee,Oe,ht):null;case W:return zt=Oe._init,tt(Ae,Ee,zt(Oe._payload),ht)}if(Le(Oe)||ne(Oe))return zt!==null?null:nt(Ae,Ee,Oe,ht,null);ns(Ae,Oe)}return null}function Pt(Ae,Ee,Oe,ht,zt){if(typeof ht=="string"&&ht!==""||typeof ht=="number")return Ae=Ae.get(Oe)||null,be(Ee,Ae,""+ht,zt);if(typeof ht=="object"&&ht!==null){switch(ht.$$typeof){case A:return Ae=Ae.get(ht.key===null?Oe:ht.key)||null,_e(Ee,Ae,ht,zt);case I:return Ae=Ae.get(ht.key===null?Oe:ht.key)||null,Ue(Ee,Ae,ht,zt);case W:var Qt=ht._init;return Pt(Ae,Ee,Oe,Qt(ht._payload),zt)}if(Le(ht)||ne(ht))return Ae=Ae.get(Oe)||null,nt(Ee,Ae,ht,zt,null);ns(Ee,ht)}return null}function Dt(Ae,Ee,Oe,ht){for(var zt=null,Qt=null,Jt=Ee,or=Ee=0,fa=null;Jt!==null&&or<Oe.length;or++){Jt.index>or?(fa=Jt,Jt=null):fa=Jt.sibling;var Vr=tt(Ae,Jt,Oe[or],ht);if(Vr===null){Jt===null&&(Jt=fa);break}d&&Jt&&Vr.alternate===null&&g(Ae,Jt),Ee=X(Vr,Ee,or),Qt===null?zt=Vr:Qt.sibling=Vr,Qt=Vr,Jt=fa}if(or===Oe.length)return E(Ae,Jt),Zr&&qu(Ae,or),zt;if(Jt===null){for(;or<Oe.length;or++)Jt=st(Ae,Oe[or],ht),Jt!==null&&(Ee=X(Jt,Ee,or),Qt===null?zt=Jt:Qt.sibling=Jt,Qt=Jt);return Zr&&qu(Ae,or),zt}for(Jt=R(Ae,Jt);or<Oe.length;or++)fa=Pt(Jt,Ae,or,Oe[or],ht),fa!==null&&(d&&fa.alternate!==null&&Jt.delete(fa.key===null?or:fa.key),Ee=X(fa,Ee,or),Qt===null?zt=fa:Qt.sibling=fa,Qt=fa);return d&&Jt.forEach(function(fd){return g(Ae,fd)}),Zr&&qu(Ae,or),zt}function Bt(Ae,Ee,Oe,ht){var zt=ne(Oe);if(typeof zt!="function")throw Error(r(150));if(Oe=zt.call(Oe),Oe==null)throw Error(r(151));for(var Qt=zt=null,Jt=Ee,or=Ee=0,fa=null,Vr=Oe.next();Jt!==null&&!Vr.done;or++,Vr=Oe.next()){Jt.index>or?(fa=Jt,Jt=null):fa=Jt.sibling;var fd=tt(Ae,Jt,Vr.value,ht);if(fd===null){Jt===null&&(Jt=fa);break}d&&Jt&&fd.alternate===null&&g(Ae,Jt),Ee=X(fd,Ee,or),Qt===null?zt=fd:Qt.sibling=fd,Qt=fd,Jt=fa}if(Vr.done)return E(Ae,Jt),Zr&&qu(Ae,or),zt;if(Jt===null){for(;!Vr.done;or++,Vr=Oe.next())Vr=st(Ae,Vr.value,ht),Vr!==null&&(Ee=X(Vr,Ee,or),Qt===null?zt=Vr:Qt.sibling=Vr,Qt=Vr);return Zr&&qu(Ae,or),zt}for(Jt=R(Ae,Jt);!Vr.done;or++,Vr=Oe.next())Vr=Pt(Jt,Ae,or,Vr.value,ht),Vr!==null&&(d&&Vr.alternate!==null&&Jt.delete(Vr.key===null?or:Vr.key),Ee=X(Vr,Ee,or),Qt===null?zt=Vr:Qt.sibling=Vr,Qt=Vr);return d&&Jt.forEach(function(HD){return g(Ae,HD)}),Zr&&qu(Ae,or),zt}function Ei(Ae,Ee,Oe,ht){if(typeof Oe=="object"&&Oe!==null&&Oe.type===j&&Oe.key===null&&(Oe=Oe.props.children),typeof Oe=="object"&&Oe!==null){switch(Oe.$$typeof){case A:e:{for(var zt=Oe.key,Qt=Ee;Qt!==null;){if(Qt.key===zt){if(zt=Oe.type,zt===j){if(Qt.tag===7){E(Ae,Qt.sibling),Ee=V(Qt,Oe.props.children),Ee.return=Ae,Ae=Ee;break e}}else if(Qt.elementType===zt||typeof zt=="object"&&zt!==null&&zt.$$typeof===W&&lo(zt)===Qt.type){E(Ae,Qt.sibling),Ee=V(Qt,Oe.props),Ee.ref=ti(Ae,Qt,Oe),Ee.return=Ae,Ae=Ee;break e}E(Ae,Qt);break}else g(Ae,Qt);Qt=Qt.sibling}Oe.type===j?(Ee=zh(Oe.props.children,Ae.mode,ht,Oe.key),Ee.return=Ae,Ae=Ee):(ht=z0(Oe.type,Oe.key,Oe.props,null,Ae.mode,ht),ht.ref=ti(Ae,Ee,Oe),ht.return=Ae,Ae=ht)}return oe(Ae);case I:e:{for(Qt=Oe.key;Ee!==null;){if(Ee.key===Qt)if(Ee.tag===4&&Ee.stateNode.containerInfo===Oe.containerInfo&&Ee.stateNode.implementation===Oe.implementation){E(Ae,Ee.sibling),Ee=V(Ee,Oe.children||[]),Ee.return=Ae,Ae=Ee;break e}else{E(Ae,Ee);break}else g(Ae,Ee);Ee=Ee.sibling}Ee=Nb(Oe,Ae.mode,ht),Ee.return=Ae,Ae=Ee}return oe(Ae);case W:return Qt=Oe._init,Ei(Ae,Ee,Qt(Oe._payload),ht)}if(Le(Oe))return Dt(Ae,Ee,Oe,ht);if(ne(Oe))return Bt(Ae,Ee,Oe,ht);ns(Ae,Oe)}return typeof Oe=="string"&&Oe!==""||typeof Oe=="number"?(Oe=""+Oe,Ee!==null&&Ee.tag===6?(E(Ae,Ee.sibling),Ee=V(Ee,Oe),Ee.return=Ae,Ae=Ee):(E(Ae,Ee),Ee=Tb(Oe,Ae.mode,ht),Ee.return=Ae,Ae=Ee),oe(Ae)):E(Ae,Ee)}return Ei}var Zu=Wf(!0),Us=Wf(!1),Mh=yl(null),ks=null,qc=null,qf=null;function $f(){qf=qc=ks=null}function Kf(d){var g=Mh.current;dn(Mh),d._currentValue=g}function Zf(d,g,E){for(;d!==null;){var R=d.alternate;if((d.childLanes&g)!==g?(d.childLanes|=g,R!==null&&(R.childLanes|=g)):R!==null&&(R.childLanes&g)!==g&&(R.childLanes|=g),d===E)break;d=d.return}}function bl(d,g){ks=d,qf=qc=null,d=d.dependencies,d!==null&&d.firstContext!==null&&((d.lanes&g)!==0&&(ee=!0),d.firstContext=null)}function Oa(d){var g=d._currentValue;if(qf!==d)if(d={context:d,memoizedValue:g,next:null},qc===null){if(ks===null)throw Error(r(308));qc=d,ks.dependencies={lanes:0,firstContext:d}}else qc=qc.next=d;return g}var Ro=null;function $c(d){Ro===null?Ro=[d]:Ro.push(d)}function Ah(d,g,E,R){var V=g.interleaved;return V===null?(E.next=E,$c(g)):(E.next=V.next,V.next=E),g.interleaved=E,_s(d,R)}function _s(d,g){d.lanes|=g;var E=d.alternate;for(E!==null&&(E.lanes|=g),E=d,d=d.return;d!==null;)d.childLanes|=g,E=d.alternate,E!==null&&(E.childLanes|=g),E=d,d=d.return;return E.tag===3?E.stateNode:null}var Lo=!1;function Rh(d){d.updateQueue={baseState:d.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Yf(d,g){d=d.updateQueue,g.updateQueue===d&&(g.updateQueue={baseState:d.baseState,firstBaseUpdate:d.firstBaseUpdate,lastBaseUpdate:d.lastBaseUpdate,shared:d.shared,effects:d.effects})}function Oo(d,g){return{eventTime:d,lane:g,tag:0,payload:null,callback:null,next:null}}function Do(d,g,E){var R=d.updateQueue;if(R===null)return null;if(R=R.shared,(Ir&2)!==0){var V=R.pending;return V===null?g.next=g:(g.next=V.next,V.next=g),R.pending=g,_s(d,E)}return V=R.interleaved,V===null?(g.next=g,$c(R)):(g.next=V.next,V.next=g),R.interleaved=g,_s(d,E)}function Xf(d,g,E){if(g=g.updateQueue,g!==null&&(g=g.shared,(E&4194240)!==0)){var R=g.lanes;R&=d.pendingLanes,E|=R,g.lanes=E,to(d,E)}}function Lh(d,g){var E=d.updateQueue,R=d.alternate;if(R!==null&&(R=R.updateQueue,E===R)){var V=null,X=null;if(E=E.firstBaseUpdate,E!==null){do{var oe={eventTime:E.eventTime,lane:E.lane,tag:E.tag,payload:E.payload,callback:E.callback,next:null};X===null?V=X=oe:X=X.next=oe,E=E.next}while(E!==null);X===null?V=X=g:X=X.next=g}else V=X=g;E={baseState:R.baseState,firstBaseUpdate:V,lastBaseUpdate:X,shared:R.shared,effects:R.effects},d.updateQueue=E;return}d=E.lastBaseUpdate,d===null?E.firstBaseUpdate=g:d.next=g,E.lastBaseUpdate=g}function Kc(d,g,E,R){var V=d.updateQueue;Lo=!1;var X=V.firstBaseUpdate,oe=V.lastBaseUpdate,be=V.shared.pending;if(be!==null){V.shared.pending=null;var _e=be,Ue=_e.next;_e.next=null,oe===null?X=Ue:oe.next=Ue,oe=_e;var nt=d.alternate;nt!==null&&(nt=nt.updateQueue,be=nt.lastBaseUpdate,be!==oe&&(be===null?nt.firstBaseUpdate=Ue:be.next=Ue,nt.lastBaseUpdate=_e))}if(X!==null){var st=V.baseState;oe=0,nt=Ue=_e=null,be=X;do{var tt=be.lane,Pt=be.eventTime;if((R&tt)===tt){nt!==null&&(nt=nt.next={eventTime:Pt,lane:0,tag:be.tag,payload:be.payload,callback:be.callback,next:null});e:{var Dt=d,Bt=be;switch(tt=g,Pt=E,Bt.tag){case 1:if(Dt=Bt.payload,typeof Dt=="function"){st=Dt.call(Pt,st,tt);break e}st=Dt;break e;case 3:Dt.flags=Dt.flags&-65537|128;case 0:if(Dt=Bt.payload,tt=typeof Dt=="function"?Dt.call(Pt,st,tt):Dt,tt==null)break e;st=re({},st,tt);break e;case 2:Lo=!0}}be.callback!==null&&be.lane!==0&&(d.flags|=64,tt=V.effects,tt===null?V.effects=[be]:tt.push(be))}else Pt={eventTime:Pt,lane:tt,tag:be.tag,payload:be.payload,callback:be.callback,next:null},nt===null?(Ue=nt=Pt,_e=st):nt=nt.next=Pt,oe|=tt;if(be=be.next,be===null){if(be=V.shared.pending,be===null)break;tt=be,be=tt.next,tt.next=null,V.lastBaseUpdate=tt,V.shared.pending=null}}while(!0);if(nt===null&&(_e=st),V.baseState=_e,V.firstBaseUpdate=Ue,V.lastBaseUpdate=nt,g=V.shared.interleaved,g!==null){V=g;do oe|=V.lane,V=V.next;while(V!==g)}else X===null&&(V.shared.lanes=0);Ih|=oe,d.lanes=oe,d.memoizedState=st}}function Hn(d,g,E){if(d=g.effects,g.effects=null,d!==null)for(g=0;g<d.length;g++){var R=d[g],V=R.callback;if(V!==null){if(R.callback=null,R=E,typeof V!="function")throw Error(r(191,V));V.call(R)}}}var fr={},on=yl(fr),kn=yl(fr),ri=yl(fr);function ki(d){if(d===fr)throw Error(r(174));return d}function cu(d,g){switch(sn(ri,g),sn(kn,d),sn(on,fr),d=g.nodeType,d){case 9:case 11:g=(g=g.documentElement)?g.namespaceURI:yt(null,"");break;default:d=d===8?g.parentNode:g,g=d.namespaceURI||null,d=d.tagName,g=yt(g,d)}dn(on),sn(on,g)}function _n(){dn(on),dn(kn),dn(ri)}function Zc(d){ki(ri.current);var g=ki(on.current),E=yt(g,d.type);g!==E&&(sn(kn,d),sn(on,E))}function wl(d){kn.current===d&&(dn(on),dn(kn))}var hn=yl(0);function Yc(d){for(var g=d;g!==null;){if(g.tag===13){var E=g.memoizedState;if(E!==null&&(E=E.dehydrated,E===null||E.data==="$?"||E.data==="$!"))return g}else if(g.tag===19&&g.memoizedProps.revealOrder!==void 0){if((g.flags&128)!==0)return g}else if(g.child!==null){g.child.return=g,g=g.child;continue}if(g===d)break;for(;g.sibling===null;){if(g.return===null||g.return===d)return null;g=g.return}g.sibling.return=g.return,g=g.sibling}return null}var Yu=[];function la(){for(var d=0;d<Yu.length;d++)Yu[d]._workInProgressVersionPrimary=null;Yu.length=0}var Xc=N.ReactCurrentDispatcher,Oh=N.ReactCurrentBatchConfig,Da=0,en=null,Wn=null,li=null,uo=!1,du=!1,Gs=0,Qf=0;function ui(){throw Error(r(321))}function Dh(d,g){if(g===null)return!1;for(var E=0;E<g.length&&E<d.length;E++)if(!ia(d[E],g[E]))return!1;return!0}function Qc(d,g,E,R,V,X){if(Da=X,en=g,g.memoizedState=null,g.updateQueue=null,g.lanes=0,Xc.current=d===null||d.memoizedState===null?lb:pu,d=E(R,V),du){X=0;do{if(du=!1,Gs=0,25<=X)throw Error(r(301));X+=1,li=Wn=null,g.updateQueue=null,Xc.current=np,d=E(R,V)}while(du)}if(Xc.current=rd,g=Wn!==null&&Wn.next!==null,Da=0,li=Wn=en=null,uo=!1,g)throw Error(r(300));return d}function Jc(){var d=Gs!==0;return Gs=0,d}function gn(){var d={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return li===null?en.memoizedState=li=d:li=li.next=d,li}function _i(){if(Wn===null){var d=en.alternate;d=d!==null?d.memoizedState:null}else d=Wn.next;var g=li===null?en.memoizedState:li.next;if(g!==null)li=g,Wn=d;else{if(d===null)throw Error(r(310));Wn=d,d={memoizedState:Wn.memoizedState,baseState:Wn.baseState,baseQueue:Wn.baseQueue,queue:Wn.queue,next:null},li===null?en.memoizedState=li=d:li=li.next=d}return li}function ua(d,g){return typeof g=="function"?g(d):g}function ca(d){var g=_i(),E=g.queue;if(E===null)throw Error(r(311));E.lastRenderedReducer=d;var R=Wn,V=R.baseQueue,X=E.pending;if(X!==null){if(V!==null){var oe=V.next;V.next=X.next,X.next=oe}R.baseQueue=V=X,E.pending=null}if(V!==null){X=V.next,R=R.baseState;var be=oe=null,_e=null,Ue=X;do{var nt=Ue.lane;if((Da&nt)===nt)_e!==null&&(_e=_e.next={lane:0,action:Ue.action,hasEagerState:Ue.hasEagerState,eagerState:Ue.eagerState,next:null}),R=Ue.hasEagerState?Ue.eagerState:d(R,Ue.action);else{var st={lane:nt,action:Ue.action,hasEagerState:Ue.hasEagerState,eagerState:Ue.eagerState,next:null};_e===null?(be=_e=st,oe=R):_e=_e.next=st,en.lanes|=nt,Ih|=nt}Ue=Ue.next}while(Ue!==null&&Ue!==X);_e===null?oe=R:_e.next=be,ia(R,g.memoizedState)||(ee=!0),g.memoizedState=R,g.baseState=oe,g.baseQueue=_e,E.lastRenderedState=R}if(d=E.interleaved,d!==null){V=d;do X=V.lane,en.lanes|=X,Ih|=X,V=V.next;while(V!==d)}else V===null&&(E.lanes=0);return[g.memoizedState,E.dispatch]}function Jf(d){var g=_i(),E=g.queue;if(E===null)throw Error(r(311));E.lastRenderedReducer=d;var R=E.dispatch,V=E.pending,X=g.memoizedState;if(V!==null){E.pending=null;var oe=V=V.next;do X=d(X,oe.action),oe=oe.next;while(oe!==V);ia(X,g.memoizedState)||(ee=!0),g.memoizedState=X,g.baseQueue===null&&(g.baseState=X),E.lastRenderedState=X}return[X,R]}function ep(){}function tp(d,g){var E=en,R=_i(),V=g(),X=!ia(R.memoizedState,V);if(X&&(R.memoizedState=V,ee=!0),R=R.queue,Em(km.bind(null,E,R,d),[d]),R.getSnapshot!==g||X||li!==null&&li.memoizedState.tag&1){if(E.flags|=2048,ed(9,Sl.bind(null,E,R,V,g),void 0,null),ha===null)throw Error(r(349));(Da&30)!==0||b0(E,g,V)}return V}function b0(d,g,E){d.flags|=16384,d={getSnapshot:g,value:E},g=en.updateQueue,g===null?(g={lastEffect:null,stores:null},en.updateQueue=g,g.stores=[d]):(E=g.stores,E===null?g.stores=[d]:E.push(d))}function Sl(d,g,E,R){g.value=E,g.getSnapshot=R,_m(g)&&rp(d)}function km(d,g,E){return E(function(){_m(g)&&rp(d)})}function _m(d){var g=d.getSnapshot;d=d.value;try{var E=g();return!ia(d,E)}catch{return!0}}function rp(d){var g=_s(d,1);g!==null&&El(g,d,1,-1)}function hu(d){var g=gn();return typeof d=="function"&&(d=d()),g.memoizedState=g.baseState=d,d={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ua,lastRenderedState:d},g.queue=d,d=d.dispatch=E0.bind(null,en,d),[g.memoizedState,d]}function ed(d,g,E,R){return d={tag:d,create:g,destroy:E,deps:R,next:null},g=en.updateQueue,g===null?(g={lastEffect:null,stores:null},en.updateQueue=g,g.lastEffect=d.next=d):(E=g.lastEffect,E===null?g.lastEffect=d.next=d:(R=E.next,E.next=d,d.next=R,g.lastEffect=d)),d}function Cm(){return _i().memoizedState}function td(d,g,E,R){var V=gn();en.flags|=d,V.memoizedState=ed(1|g,E,void 0,R===void 0?null:R)}function Xu(d,g,E,R){var V=_i();R=R===void 0?null:R;var X=void 0;if(Wn!==null){var oe=Wn.memoizedState;if(X=oe.destroy,R!==null&&Dh(R,oe.deps)){V.memoizedState=ed(g,E,X,R);return}}en.flags|=d,V.memoizedState=ed(1|g,E,X,R)}function w0(d,g){return td(8390656,8,d,g)}function Em(d,g){return Xu(2048,8,d,g)}function Tm(d,g){return Xu(4,2,d,g)}function Nm(d,g){return Xu(4,4,d,g)}function fu(d,g){if(typeof g=="function")return d=d(),g(d),function(){g(null)};if(g!=null)return d=d(),g.current=d,function(){g.current=null}}function S0(d,g,E){return E=E!=null?E.concat([d]):null,Xu(4,4,fu.bind(null,g,d),E)}function kl(){}function Pm(d,g){var E=_i();g=g===void 0?null:g;var R=E.memoizedState;return R!==null&&g!==null&&Dh(g,R[1])?R[0]:(E.memoizedState=[d,g],d)}function vn(d,g){var E=_i();g=g===void 0?null:g;var R=E.memoizedState;return R!==null&&g!==null&&Dh(g,R[1])?R[0]:(d=d(),E.memoizedState=[d,g],d)}function k0(d,g,E){return(Da&21)===0?(d.baseState&&(d.baseState=!1,ee=!0),d.memoizedState=E):(ia(E,g)||(E=Ul(),en.lanes|=E,Ih|=E,d.baseState=!0),g)}function _0(d,g){var E=wr;wr=E!==0&&4>E?E:4,d(!0);var R=Oh.transition;Oh.transition={};try{d(!1),g()}finally{wr=E,Oh.transition=R}}function C0(){return _i().memoizedState}function ob(d,g,E){var R=cd(d);if(E={lane:R,action:E,hasEagerState:!1,eagerState:null,next:null},Mm(d))T0(g,E);else if(E=Ah(d,g,E,R),E!==null){var V=Es();El(E,d,R,V),Cs(E,g,R)}}function E0(d,g,E){var R=cd(d),V={lane:R,action:E,hasEagerState:!1,eagerState:null,next:null};if(Mm(d))T0(g,V);else{var X=d.alternate;if(d.lanes===0&&(X===null||X.lanes===0)&&(X=g.lastRenderedReducer,X!==null))try{var oe=g.lastRenderedState,be=X(oe,E);if(V.hasEagerState=!0,V.eagerState=be,ia(be,oe)){var _e=g.interleaved;_e===null?(V.next=V,$c(g)):(V.next=_e.next,_e.next=V),g.interleaved=V;return}}catch{}E=Ah(d,g,V,R),E!==null&&(V=Es(),El(E,d,R,V),Cs(E,g,R))}}function Mm(d){var g=d.alternate;return d===en||g!==null&&g===en}function T0(d,g){du=uo=!0;var E=d.pending;E===null?g.next=g:(g.next=E.next,E.next=g),d.pending=g}function Cs(d,g,E){if((E&4194240)!==0){var R=g.lanes;R&=d.pendingLanes,E|=R,g.lanes=E,to(d,E)}}var rd={readContext:Oa,useCallback:ui,useContext:ui,useEffect:ui,useImperativeHandle:ui,useInsertionEffect:ui,useLayoutEffect:ui,useMemo:ui,useReducer:ui,useRef:ui,useState:ui,useDebugValue:ui,useDeferredValue:ui,useTransition:ui,useMutableSource:ui,useSyncExternalStore:ui,useId:ui,unstable_isNewReconciler:!1},lb={readContext:Oa,useCallback:function(d,g){return gn().memoizedState=[d,g===void 0?null:g],d},useContext:Oa,useEffect:w0,useImperativeHandle:function(d,g,E){return E=E!=null?E.concat([d]):null,td(4194308,4,fu.bind(null,g,d),E)},useLayoutEffect:function(d,g){return td(4194308,4,d,g)},useInsertionEffect:function(d,g){return td(4,2,d,g)},useMemo:function(d,g){var E=gn();return g=g===void 0?null:g,d=d(),E.memoizedState=[d,g],d},useReducer:function(d,g,E){var R=gn();return g=E!==void 0?E(g):g,R.memoizedState=R.baseState=g,d={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:d,lastRenderedState:g},R.queue=d,d=d.dispatch=ob.bind(null,en,d),[R.memoizedState,d]},useRef:function(d){var g=gn();return d={current:d},g.memoizedState=d},useState:hu,useDebugValue:kl,useDeferredValue:function(d){return gn().memoizedState=d},useTransition:function(){var d=hu(!1),g=d[0];return d=_0.bind(null,d[1]),gn().memoizedState=d,[g,d]},useMutableSource:function(){},useSyncExternalStore:function(d,g,E){var R=en,V=gn();if(Zr){if(E===void 0)throw Error(r(407));E=E()}else{if(E=g(),ha===null)throw Error(r(349));(Da&30)!==0||b0(R,g,E)}V.memoizedState=E;var X={value:E,getSnapshot:g};return V.queue=X,w0(km.bind(null,R,X,d),[d]),R.flags|=2048,ed(9,Sl.bind(null,R,X,E,g),void 0,null),E},useId:function(){var d=gn(),g=ha.identifierPrefix;if(Zr){var E=Sn,R=bs;E=(R&~(1<<32-ct(R)-1)).toString(32)+E,g=":"+g+"R"+E,E=Gs++,0<E&&(g+="H"+E.toString(32)),g+=":"}else E=Qf++,g=":"+g+"r"+E.toString(32)+":";return d.memoizedState=g},unstable_isNewReconciler:!1},pu={readContext:Oa,useCallback:Pm,useContext:Oa,useEffect:Em,useImperativeHandle:S0,useInsertionEffect:Tm,useLayoutEffect:Nm,useMemo:vn,useReducer:ca,useRef:Cm,useState:function(){return ca(ua)},useDebugValue:kl,useDeferredValue:function(d){var g=_i();return k0(g,Wn.memoizedState,d)},useTransition:function(){var d=ca(ua)[0],g=_i().memoizedState;return[d,g]},useMutableSource:ep,useSyncExternalStore:tp,useId:C0,unstable_isNewReconciler:!1},np={readContext:Oa,useCallback:Pm,useContext:Oa,useEffect:Em,useImperativeHandle:S0,useInsertionEffect:Tm,useLayoutEffect:Nm,useMemo:vn,useReducer:Jf,useRef:Cm,useState:function(){return Jf(ua)},useDebugValue:kl,useDeferredValue:function(d){var g=_i();return Wn===null?g.memoizedState=d:k0(g,Wn.memoizedState,d)},useTransition:function(){var d=Jf(ua)[0],g=_i().memoizedState;return[d,g]},useMutableSource:ep,useSyncExternalStore:tp,useId:C0,unstable_isNewReconciler:!1};function Wi(d,g){if(d&&d.defaultProps){g=re({},g),d=d.defaultProps;for(var E in d)g[E]===void 0&&(g[E]=d[E]);return g}return g}function nd(d,g,E,R){g=d.memoizedState,E=E(R,g),E=E==null?g:re({},g,E),d.memoizedState=E,d.lanes===0&&(d.updateQueue.baseState=E)}var ad={isMounted:function(d){return(d=d._reactInternals)?Ln(d)===d:!1},enqueueSetState:function(d,g,E){d=d._reactInternals;var R=Es(),V=cd(d),X=Oo(R,V);X.payload=g,E!=null&&(X.callback=E),g=Do(d,X,V),g!==null&&(El(g,d,V,R),Xf(g,d,V))},enqueueReplaceState:function(d,g,E){d=d._reactInternals;var R=Es(),V=cd(d),X=Oo(R,V);X.tag=1,X.payload=g,E!=null&&(X.callback=E),g=Do(d,X,V),g!==null&&(El(g,d,V,R),Xf(g,d,V))},enqueueForceUpdate:function(d,g){d=d._reactInternals;var E=Es(),R=cd(d),V=Oo(E,R);V.tag=2,g!=null&&(V.callback=g),g=Do(d,V,R),g!==null&&(El(g,d,R,E),Xf(g,d,R))}};function ip(d,g,E,R,V,X,oe){return d=d.stateNode,typeof d.shouldComponentUpdate=="function"?d.shouldComponentUpdate(R,X,oe):g.prototype&&g.prototype.isPureReactComponent?!Bs(E,R)||!Bs(V,X):!0}function N0(d,g,E){var R=!1,V=Mo,X=g.contextType;return typeof X=="object"&&X!==null?X=Oa(X):(V=oa(g)?au:Hi.current,R=g.contextTypes,X=(R=R!=null)?Vu(d,V):Mo),g=new g(E,X),d.memoizedState=g.state!==null&&g.state!==void 0?g.state:null,g.updater=ad,d.stateNode=g,g._reactInternals=d,R&&(d=d.stateNode,d.__reactInternalMemoizedUnmaskedChildContext=V,d.__reactInternalMemoizedMaskedChildContext=X),g}function Am(d,g,E,R){d=g.state,typeof g.componentWillReceiveProps=="function"&&g.componentWillReceiveProps(E,R),typeof g.UNSAFE_componentWillReceiveProps=="function"&&g.UNSAFE_componentWillReceiveProps(E,R),g.state!==d&&ad.enqueueReplaceState(g,g.state,null)}function ap(d,g,E,R){var V=d.stateNode;V.props=E,V.state=d.memoizedState,V.refs={},Rh(d);var X=g.contextType;typeof X=="object"&&X!==null?V.context=Oa(X):(X=oa(g)?au:Hi.current,V.context=Vu(d,X)),V.state=d.memoizedState,X=g.getDerivedStateFromProps,typeof X=="function"&&(nd(d,g,X,E),V.state=d.memoizedState),typeof g.getDerivedStateFromProps=="function"||typeof V.getSnapshotBeforeUpdate=="function"||typeof V.UNSAFE_componentWillMount!="function"&&typeof V.componentWillMount!="function"||(g=V.state,typeof V.componentWillMount=="function"&&V.componentWillMount(),typeof V.UNSAFE_componentWillMount=="function"&&V.UNSAFE_componentWillMount(),g!==V.state&&ad.enqueueReplaceState(V,V.state,null),Kc(d,E,V,R),V.state=d.memoizedState),typeof V.componentDidMount=="function"&&(d.flags|=4194308)}function Qu(d,g){try{var E="",R=g;do E+=ge(R),R=R.return;while(R);var V=E}catch(X){V=`
Error generating stack: `+X.message+`
`+X.stack}return{value:d,source:g,stack:V,digest:null}}function sp(d,g,E){return{value:d,source:null,stack:E??null,digest:g??null}}function sd(d,g){try{console.error(g.value)}catch(E){setTimeout(function(){throw E})}}var ub=typeof WeakMap=="function"?WeakMap:Map;function P0(d,g,E){E=Oo(-1,E),E.tag=3,E.payload={element:null};var R=g.value;return E.callback=function(){O0||(O0=!0,xb=R),sd(d,g)},E}function x(d,g,E){E=Oo(-1,E),E.tag=3;var R=d.type.getDerivedStateFromError;if(typeof R=="function"){var V=g.value;E.payload=function(){return R(V)},E.callback=function(){sd(d,g)}}var X=d.stateNode;return X!==null&&typeof X.componentDidCatch=="function"&&(E.callback=function(){sd(d,g),typeof R!="function"&&(ld===null?ld=new Set([this]):ld.add(this));var oe=g.stack;this.componentDidCatch(g.value,{componentStack:oe!==null?oe:""})}),E}function b(d,g,E){var R=d.pingCache;if(R===null){R=d.pingCache=new ub;var V=new Set;R.set(g,V)}else V=R.get(g),V===void 0&&(V=new Set,R.set(g,V));V.has(E)||(V.add(E),d=LD.bind(null,d,g,E),g.then(d,d))}function M(d){do{var g;if((g=d.tag===13)&&(g=d.memoizedState,g=g!==null?g.dehydrated!==null:!0),g)return d;d=d.return}while(d!==null);return null}function z(d,g,E,R,V){return(d.mode&1)===0?(d===g?d.flags|=65536:(d.flags|=128,E.flags|=131072,E.flags&=-52805,E.tag===1&&(E.alternate===null?E.tag=17:(g=Oo(-1,1),g.tag=2,Do(E,g,1))),E.lanes|=1),d):(d.flags|=65536,d.lanes=V,d)}var K=N.ReactCurrentOwner,ee=!1;function he(d,g,E,R){g.child=d===null?Us(g,null,E,R):Zu(g,d.child,E,R)}function Ne(d,g,E,R,V){E=E.render;var X=g.ref;return bl(g,V),R=Qc(d,g,E,R,X,V),E=Jc(),d!==null&&!ee?(g.updateQueue=d.updateQueue,g.flags&=-2053,d.lanes&=~V,da(d,g,V)):(Zr&&E&&Hc(g),g.flags|=1,he(d,g,R,V),g.child)}function Ge(d,g,E,R,V){if(d===null){var X=E.type;return typeof X=="function"&&!Eb(X)&&X.defaultProps===void 0&&E.compare===null&&E.defaultProps===void 0?(g.tag=15,g.type=X,dt(d,g,X,R,V)):(d=z0(E.type,null,R,g,g.mode,V),d.ref=g.ref,d.return=g,g.child=d)}if(X=d.child,(d.lanes&V)===0){var oe=X.memoizedProps;if(E=E.compare,E=E!==null?E:Bs,E(oe,R)&&d.ref===g.ref)return da(d,g,V)}return g.flags|=1,d=hd(X,R),d.ref=g.ref,d.return=g,g.child=d}function dt(d,g,E,R,V){if(d!==null){var X=d.memoizedProps;if(Bs(X,R)&&d.ref===g.ref)if(ee=!1,g.pendingProps=R=X,(d.lanes&V)!==0)(d.flags&131072)!==0&&(ee=!0);else return g.lanes=d.lanes,da(d,g,V)}return Et(d,g,E,R,V)}function Rt(d,g,E){var R=g.pendingProps,V=R.children,X=d!==null?d.memoizedState:null;if(R.mode==="hidden")if((g.mode&1)===0)g.memoizedState={baseLanes:0,cachePool:null,transitions:null},sn(lp,co),co|=E;else{if((E&1073741824)===0)return d=X!==null?X.baseLanes|E:E,g.lanes=g.childLanes=1073741824,g.memoizedState={baseLanes:d,cachePool:null,transitions:null},g.updateQueue=null,sn(lp,co),co|=d,null;g.memoizedState={baseLanes:0,cachePool:null,transitions:null},R=X!==null?X.baseLanes:E,sn(lp,co),co|=R}else X!==null?(R=X.baseLanes|E,g.memoizedState=null):R=E,sn(lp,co),co|=R;return he(d,g,V,E),g.child}function ur(d,g){var E=g.ref;(d===null&&E!==null||d!==null&&d.ref!==E)&&(g.flags|=512,g.flags|=2097152)}function Et(d,g,E,R,V){var X=oa(E)?au:Hi.current;return X=Vu(g,X),bl(g,V),E=Qc(d,g,E,R,X,V),R=Jc(),d!==null&&!ee?(g.updateQueue=d.updateQueue,g.flags&=-2053,d.lanes&=~V,da(d,g,V)):(Zr&&R&&Hc(g),g.flags|=1,he(d,g,E,V),g.child)}function fn(d,g,E,R,V){if(oa(E)){var X=!0;Hu(g)}else X=!1;if(bl(g,V),g.stateNode===null)Mr(d,g),N0(g,E,R),ap(g,E,R,V),R=!0;else if(d===null){var oe=g.stateNode,be=g.memoizedProps;oe.props=be;var _e=oe.context,Ue=E.contextType;typeof Ue=="object"&&Ue!==null?Ue=Oa(Ue):(Ue=oa(E)?au:Hi.current,Ue=Vu(g,Ue));var nt=E.getDerivedStateFromProps,st=typeof nt=="function"||typeof oe.getSnapshotBeforeUpdate=="function";st||typeof oe.UNSAFE_componentWillReceiveProps!="function"&&typeof oe.componentWillReceiveProps!="function"||(be!==R||_e!==Ue)&&Am(g,oe,R,Ue),Lo=!1;var tt=g.memoizedState;oe.state=tt,Kc(g,R,oe,V),_e=g.memoizedState,be!==R||tt!==_e||sa.current||Lo?(typeof nt=="function"&&(nd(g,E,nt,R),_e=g.memoizedState),(be=Lo||ip(g,E,be,R,tt,_e,Ue))?(st||typeof oe.UNSAFE_componentWillMount!="function"&&typeof oe.componentWillMount!="function"||(typeof oe.componentWillMount=="function"&&oe.componentWillMount(),typeof oe.UNSAFE_componentWillMount=="function"&&oe.UNSAFE_componentWillMount()),typeof oe.componentDidMount=="function"&&(g.flags|=4194308)):(typeof oe.componentDidMount=="function"&&(g.flags|=4194308),g.memoizedProps=R,g.memoizedState=_e),oe.props=R,oe.state=_e,oe.context=Ue,R=be):(typeof oe.componentDidMount=="function"&&(g.flags|=4194308),R=!1)}else{oe=g.stateNode,Yf(d,g),be=g.memoizedProps,Ue=g.type===g.elementType?be:Wi(g.type,be),oe.props=Ue,st=g.pendingProps,tt=oe.context,_e=E.contextType,typeof _e=="object"&&_e!==null?_e=Oa(_e):(_e=oa(E)?au:Hi.current,_e=Vu(g,_e));var Pt=E.getDerivedStateFromProps;(nt=typeof Pt=="function"||typeof oe.getSnapshotBeforeUpdate=="function")||typeof oe.UNSAFE_componentWillReceiveProps!="function"&&typeof oe.componentWillReceiveProps!="function"||(be!==st||tt!==_e)&&Am(g,oe,R,_e),Lo=!1,tt=g.memoizedState,oe.state=tt,Kc(g,R,oe,V);var Dt=g.memoizedState;be!==st||tt!==Dt||sa.current||Lo?(typeof Pt=="function"&&(nd(g,E,Pt,R),Dt=g.memoizedState),(Ue=Lo||ip(g,E,Ue,R,tt,Dt,_e)||!1)?(nt||typeof oe.UNSAFE_componentWillUpdate!="function"&&typeof oe.componentWillUpdate!="function"||(typeof oe.componentWillUpdate=="function"&&oe.componentWillUpdate(R,Dt,_e),typeof oe.UNSAFE_componentWillUpdate=="function"&&oe.UNSAFE_componentWillUpdate(R,Dt,_e)),typeof oe.componentDidUpdate=="function"&&(g.flags|=4),typeof oe.getSnapshotBeforeUpdate=="function"&&(g.flags|=1024)):(typeof oe.componentDidUpdate!="function"||be===d.memoizedProps&&tt===d.memoizedState||(g.flags|=4),typeof oe.getSnapshotBeforeUpdate!="function"||be===d.memoizedProps&&tt===d.memoizedState||(g.flags|=1024),g.memoizedProps=R,g.memoizedState=Dt),oe.props=R,oe.state=Dt,oe.context=_e,R=Ue):(typeof oe.componentDidUpdate!="function"||be===d.memoizedProps&&tt===d.memoizedState||(g.flags|=4),typeof oe.getSnapshotBeforeUpdate!="function"||be===d.memoizedProps&&tt===d.memoizedState||(g.flags|=1024),R=!1)}return Yr(d,g,E,R,X,V)}function Yr(d,g,E,R,V,X){ur(d,g);var oe=(g.flags&128)!==0;if(!R&&!oe)return V&&v0(g,E,!1),da(d,g,X);R=g.stateNode,K.current=g;var be=oe&&typeof E.getDerivedStateFromError!="function"?null:R.render();return g.flags|=1,d!==null&&oe?(g.child=Zu(g,d.child,null,X),g.child=Zu(g,null,be,X)):he(d,g,be,X),g.memoizedState=R.state,V&&v0(g,E,!0),g.child}function Ia(d){var g=d.stateNode;g.pendingContext?xm(d,g.pendingContext,g.pendingContext!==g.context):g.context&&xm(d,g.context,!1),cu(d,g.containerInfo)}function Io(d,g,E,R,V){return Ku(),Ph(V),g.flags|=256,he(d,g,E,R),g.child}var je={dehydrated:null,treeContext:null,retryLane:0};function Pe(d){return{baseLanes:d,cachePool:null,transitions:null}}function He(d,g,E){var R=g.pendingProps,V=hn.current,X=!1,oe=(g.flags&128)!==0,be;if((be=oe)||(be=d!==null&&d.memoizedState===null?!1:(V&2)!==0),be?(X=!0,g.flags&=-129):(d===null||d.memoizedState!==null)&&(V|=1),sn(hn,V&1),d===null)return Wc(g),d=g.memoizedState,d!==null&&(d=d.dehydrated,d!==null)?((g.mode&1)===0?g.lanes=1:d.data==="$!"?g.lanes=8:g.lanes=1073741824,null):(oe=R.children,d=R.fallback,X?(R=g.mode,X=g.child,oe={mode:"hidden",children:oe},(R&1)===0&&X!==null?(X.childLanes=0,X.pendingProps=oe):X=U0(oe,R,0,null),d=zh(d,R,E,null),X.return=g,d.return=g,X.sibling=d,g.child=X,g.child.memoizedState=Pe(E),g.memoizedState=je,d):Nt(g,oe));if(V=d.memoizedState,V!==null&&(be=V.dehydrated,be!==null))return vr(d,g,oe,R,be,V,E);if(X){X=R.fallback,oe=g.mode,V=d.child,be=V.sibling;var _e={mode:"hidden",children:R.children};return(oe&1)===0&&g.child!==V?(R=g.child,R.childLanes=0,R.pendingProps=_e,g.deletions=null):(R=hd(V,_e),R.subtreeFlags=V.subtreeFlags&14680064),be!==null?X=hd(be,X):(X=zh(X,oe,E,null),X.flags|=2),X.return=g,R.return=g,R.sibling=X,g.child=R,R=X,X=g.child,oe=d.child.memoizedState,oe=oe===null?Pe(E):{baseLanes:oe.baseLanes|E,cachePool:null,transitions:oe.transitions},X.memoizedState=oe,X.childLanes=d.childLanes&~E,g.memoizedState=je,R}return X=d.child,d=X.sibling,R=hd(X,{mode:"visible",children:R.children}),(g.mode&1)===0&&(R.lanes=E),R.return=g,R.sibling=null,d!==null&&(E=g.deletions,E===null?(g.deletions=[d],g.flags|=16):E.push(d)),g.child=R,g.memoizedState=null,R}function Nt(d,g){return g=U0({mode:"visible",children:g},d.mode,0,null),g.return=d,d.child=g}function Gt(d,g,E,R){return R!==null&&Ph(R),Zu(g,d.child,null,E),d=Nt(g,g.pendingProps.children),d.flags|=2,g.memoizedState=null,d}function vr(d,g,E,R,V,X,oe){if(E)return g.flags&256?(g.flags&=-257,R=sp(Error(r(422))),Gt(d,g,oe,R)):g.memoizedState!==null?(g.child=d.child,g.flags|=128,null):(X=R.fallback,V=g.mode,R=U0({mode:"visible",children:R.children},V,0,null),X=zh(X,V,oe,null),X.flags|=2,R.return=g,X.return=g,R.sibling=X,g.child=R,(g.mode&1)!==0&&Zu(g,d.child,null,oe),g.child.memoizedState=Pe(oe),g.memoizedState=je,X);if((g.mode&1)===0)return Gt(d,g,oe,null);if(V.data==="$!"){if(R=V.nextSibling&&V.nextSibling.dataset,R)var be=R.dgst;return R=be,X=Error(r(419)),R=sp(X,R,void 0),Gt(d,g,oe,R)}if(be=(oe&d.childLanes)!==0,ee||be){if(R=ha,R!==null){switch(oe&-oe){case 4:V=2;break;case 16:V=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:V=32;break;case 536870912:V=268435456;break;default:V=0}V=(V&(R.suspendedLanes|oe))!==0?0:V,V!==0&&V!==X.retryLane&&(X.retryLane=V,_s(d,V),El(R,d,V,-1))}return Cb(),R=sp(Error(r(421))),Gt(d,g,oe,R)}return V.data==="$?"?(g.flags|=128,g.child=d.child,g=OD.bind(null,d),V._reactRetry=g,null):(d=X.treeContext,xt=zs(V.nextSibling),ws=g,Zr=!0,Ss=null,d!==null&&(Ra[La++]=bs,Ra[La++]=Sn,Ra[La++]=uu,bs=d.id,Sn=d.overflow,uu=g),g=Nt(g,R.children),g.flags|=4096,g)}function cr(d,g,E){d.lanes|=g;var R=d.alternate;R!==null&&(R.lanes|=g),Zf(d.return,g,E)}function Rr(d,g,E,R,V){var X=d.memoizedState;X===null?d.memoizedState={isBackwards:g,rendering:null,renderingStartTime:0,last:R,tail:E,tailMode:V}:(X.isBackwards=g,X.rendering=null,X.renderingStartTime=0,X.last=R,X.tail=E,X.tailMode=V)}function Ci(d,g,E){var R=g.pendingProps,V=R.revealOrder,X=R.tail;if(he(d,g,R.children,E),R=hn.current,(R&2)!==0)R=R&1|2,g.flags|=128;else{if(d!==null&&(d.flags&128)!==0)e:for(d=g.child;d!==null;){if(d.tag===13)d.memoizedState!==null&&cr(d,E,g);else if(d.tag===19)cr(d,E,g);else if(d.child!==null){d.child.return=d,d=d.child;continue}if(d===g)break e;for(;d.sibling===null;){if(d.return===null||d.return===g)break e;d=d.return}d.sibling.return=d.return,d=d.sibling}R&=1}if(sn(hn,R),(g.mode&1)===0)g.memoizedState=null;else switch(V){case"forwards":for(E=g.child,V=null;E!==null;)d=E.alternate,d!==null&&Yc(d)===null&&(V=E),E=E.sibling;E=V,E===null?(V=g.child,g.child=null):(V=E.sibling,E.sibling=null),Rr(g,!1,V,E,X);break;case"backwards":for(E=null,V=g.child,g.child=null;V!==null;){if(d=V.alternate,d!==null&&Yc(d)===null){g.child=V;break}d=V.sibling,V.sibling=E,E=V,V=d}Rr(g,!0,E,null,X);break;case"together":Rr(g,!1,null,null,void 0);break;default:g.memoizedState=null}return g.child}function Mr(d,g){(g.mode&1)===0&&d!==null&&(d.alternate=null,g.alternate=null,g.flags|=2)}function da(d,g,E){if(d!==null&&(g.dependencies=d.dependencies),Ih|=g.lanes,(E&g.childLanes)===0)return null;if(d!==null&&g.child!==d.child)throw Error(r(153));if(g.child!==null){for(d=g.child,E=hd(d,d.pendingProps),g.child=E,E.return=g;d.sibling!==null;)d=d.sibling,E=E.sibling=hd(d,d.pendingProps),E.return=g;E.sibling=null}return g.child}function cb(d,g,E){switch(g.tag){case 3:Ia(g),Ku();break;case 5:Zc(g);break;case 1:oa(g.type)&&Hu(g);break;case 4:cu(g,g.stateNode.containerInfo);break;case 10:var R=g.type._context,V=g.memoizedProps.value;sn(Mh,R._currentValue),R._currentValue=V;break;case 13:if(R=g.memoizedState,R!==null)return R.dehydrated!==null?(sn(hn,hn.current&1),g.flags|=128,null):(E&g.child.childLanes)!==0?He(d,g,E):(sn(hn,hn.current&1),d=da(d,g,E),d!==null?d.sibling:null);sn(hn,hn.current&1);break;case 19:if(R=(E&g.childLanes)!==0,(d.flags&128)!==0){if(R)return Ci(d,g,E);g.flags|=128}if(V=g.memoizedState,V!==null&&(V.rendering=null,V.tail=null,V.lastEffect=null),sn(hn,hn.current),R)break;return null;case 22:case 23:return g.lanes=0,Rt(d,g,E)}return da(d,g,E)}var MC,db,AC,RC;MC=function(d,g){for(var E=g.child;E!==null;){if(E.tag===5||E.tag===6)d.appendChild(E.stateNode);else if(E.tag!==4&&E.child!==null){E.child.return=E,E=E.child;continue}if(E===g)break;for(;E.sibling===null;){if(E.return===null||E.return===g)return;E=E.return}E.sibling.return=E.return,E=E.sibling}},db=function(){},AC=function(d,g,E,R){var V=d.memoizedProps;if(V!==R){d=g.stateNode,ki(on.current);var X=null;switch(E){case"input":V=Ve(d,V),R=Ve(d,R),X=[];break;case"select":V=re({},V,{value:void 0}),R=re({},R,{value:void 0}),X=[];break;case"textarea":V=Ce(d,V),R=Ce(d,R),X=[];break;default:typeof V.onClick!="function"&&typeof R.onClick=="function"&&(d.onclick=Ze)}Te(E,R);var oe;E=null;for(Ue in V)if(!R.hasOwnProperty(Ue)&&V.hasOwnProperty(Ue)&&V[Ue]!=null)if(Ue==="style"){var be=V[Ue];for(oe in be)be.hasOwnProperty(oe)&&(E||(E={}),E[oe]="")}else Ue!=="dangerouslySetInnerHTML"&&Ue!=="children"&&Ue!=="suppressContentEditableWarning"&&Ue!=="suppressHydrationWarning"&&Ue!=="autoFocus"&&(i.hasOwnProperty(Ue)?X||(X=[]):(X=X||[]).push(Ue,null));for(Ue in R){var _e=R[Ue];if(be=V?.[Ue],R.hasOwnProperty(Ue)&&_e!==be&&(_e!=null||be!=null))if(Ue==="style")if(be){for(oe in be)!be.hasOwnProperty(oe)||_e&&_e.hasOwnProperty(oe)||(E||(E={}),E[oe]="");for(oe in _e)_e.hasOwnProperty(oe)&&be[oe]!==_e[oe]&&(E||(E={}),E[oe]=_e[oe])}else E||(X||(X=[]),X.push(Ue,E)),E=_e;else Ue==="dangerouslySetInnerHTML"?(_e=_e?_e.__html:void 0,be=be?be.__html:void 0,_e!=null&&be!==_e&&(X=X||[]).push(Ue,_e)):Ue==="children"?typeof _e!="string"&&typeof _e!="number"||(X=X||[]).push(Ue,""+_e):Ue!=="suppressContentEditableWarning"&&Ue!=="suppressHydrationWarning"&&(i.hasOwnProperty(Ue)?(_e!=null&&Ue==="onScroll"&&$r("scroll",d),X||be===_e||(X=[])):(X=X||[]).push(Ue,_e))}E&&(X=X||[]).push("style",E);var Ue=X;(g.updateQueue=Ue)&&(g.flags|=4)}},RC=function(d,g,E,R){E!==R&&(g.flags|=4)};function Rm(d,g){if(!Zr)switch(d.tailMode){case"hidden":g=d.tail;for(var E=null;g!==null;)g.alternate!==null&&(E=g),g=g.sibling;E===null?d.tail=null:E.sibling=null;break;case"collapsed":E=d.tail;for(var R=null;E!==null;)E.alternate!==null&&(R=E),E=E.sibling;R===null?g||d.tail===null?d.tail=null:d.tail.sibling=null:R.sibling=null}}function is(d){var g=d.alternate!==null&&d.alternate.child===d.child,E=0,R=0;if(g)for(var V=d.child;V!==null;)E|=V.lanes|V.childLanes,R|=V.subtreeFlags&14680064,R|=V.flags&14680064,V.return=d,V=V.sibling;else for(V=d.child;V!==null;)E|=V.lanes|V.childLanes,R|=V.subtreeFlags,R|=V.flags,V.return=d,V=V.sibling;return d.subtreeFlags|=R,d.childLanes=E,g}function kD(d,g,E){var R=g.pendingProps;switch(Oi(g),g.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return is(g),null;case 1:return oa(g.type)&&Gc(),is(g),null;case 3:return R=g.stateNode,_n(),dn(sa),dn(Hi),la(),R.pendingContext&&(R.context=R.pendingContext,R.pendingContext=null),(d===null||d.child===null)&&(Nh(g)?g.flags|=4:d===null||d.memoizedState.isDehydrated&&(g.flags&256)===0||(g.flags|=1024,Ss!==null&&(Sb(Ss),Ss=null))),db(d,g),is(g),null;case 5:wl(g);var V=ki(ri.current);if(E=g.type,d!==null&&g.stateNode!=null)AC(d,g,E,R,V),d.ref!==g.ref&&(g.flags|=512,g.flags|=2097152);else{if(!R){if(g.stateNode===null)throw Error(r(166));return is(g),null}if(d=ki(on.current),Nh(g)){R=g.stateNode,E=g.type;var X=g.memoizedProps;switch(R[rs]=g,R[iu]=X,d=(g.mode&1)!==0,E){case"dialog":$r("cancel",R),$r("close",R);break;case"iframe":case"object":case"embed":$r("load",R);break;case"video":case"audio":for(V=0;V<so.length;V++)$r(so[V],R);break;case"source":$r("error",R);break;case"img":case"image":case"link":$r("error",R),$r("load",R);break;case"details":$r("toggle",R);break;case"input":$e(R,X),$r("invalid",R);break;case"select":R._wrapperState={wasMultiple:!!X.multiple},$r("invalid",R);break;case"textarea":Fe(R,X),$r("invalid",R)}Te(E,X),V=null;for(var oe in X)if(X.hasOwnProperty(oe)){var be=X[oe];oe==="children"?typeof be=="string"?R.textContent!==be&&(X.suppressHydrationWarning!==!0&&Ie(R.textContent,be,d),V=["children",be]):typeof be=="number"&&R.textContent!==""+be&&(X.suppressHydrationWarning!==!0&&Ie(R.textContent,be,d),V=["children",""+be]):i.hasOwnProperty(oe)&&be!=null&&oe==="onScroll"&&$r("scroll",R)}switch(E){case"input":me(R),lt(R,X,!0);break;case"textarea":me(R),mt(R);break;case"select":case"option":break;default:typeof X.onClick=="function"&&(R.onclick=Ze)}R=V,g.updateQueue=R,R!==null&&(g.flags|=4)}else{oe=V.nodeType===9?V:V.ownerDocument,d==="http://www.w3.org/1999/xhtml"&&(d=gt(E)),d==="http://www.w3.org/1999/xhtml"?E==="script"?(d=oe.createElement("div"),d.innerHTML="<script><\/script>",d=d.removeChild(d.firstChild)):typeof R.is=="string"?d=oe.createElement(E,{is:R.is}):(d=oe.createElement(E),E==="select"&&(oe=d,R.multiple?oe.multiple=!0:R.size&&(oe.size=R.size))):d=oe.createElementNS(d,E),d[rs]=g,d[iu]=R,MC(d,g,!1,!1),g.stateNode=d;e:{switch(oe=Re(E,R),E){case"dialog":$r("cancel",d),$r("close",d),V=R;break;case"iframe":case"object":case"embed":$r("load",d),V=R;break;case"video":case"audio":for(V=0;V<so.length;V++)$r(so[V],d);V=R;break;case"source":$r("error",d),V=R;break;case"img":case"image":case"link":$r("error",d),$r("load",d),V=R;break;case"details":$r("toggle",d),V=R;break;case"input":$e(d,R),V=Ve(d,R),$r("invalid",d);break;case"option":V=R;break;case"select":d._wrapperState={wasMultiple:!!R.multiple},V=re({},R,{value:void 0}),$r("invalid",d);break;case"textarea":Fe(d,R),V=Ce(d,R),$r("invalid",d);break;default:V=R}Te(E,V),be=V;for(X in be)if(be.hasOwnProperty(X)){var _e=be[X];X==="style"?ve(d,_e):X==="dangerouslySetInnerHTML"?(_e=_e?_e.__html:void 0,_e!=null&&qt(d,_e)):X==="children"?typeof _e=="string"?(E!=="textarea"||_e!=="")&&wt(d,_e):typeof _e=="number"&&wt(d,""+_e):X!=="suppressContentEditableWarning"&&X!=="suppressHydrationWarning"&&X!=="autoFocus"&&(i.hasOwnProperty(X)?_e!=null&&X==="onScroll"&&$r("scroll",d):_e!=null&&C(d,X,_e,oe))}switch(E){case"input":me(d),lt(d,R,!1);break;case"textarea":me(d),mt(d);break;case"option":R.value!=null&&d.setAttribute("value",""+fe(R.value));break;case"select":d.multiple=!!R.multiple,X=R.value,X!=null?Qe(d,!!R.multiple,X,!1):R.defaultValue!=null&&Qe(d,!!R.multiple,R.defaultValue,!0);break;default:typeof V.onClick=="function"&&(d.onclick=Ze)}switch(E){case"button":case"input":case"select":case"textarea":R=!!R.autoFocus;break e;case"img":R=!0;break e;default:R=!1}}R&&(g.flags|=4)}g.ref!==null&&(g.flags|=512,g.flags|=2097152)}return is(g),null;case 6:if(d&&g.stateNode!=null)RC(d,g,d.memoizedProps,R);else{if(typeof R!="string"&&g.stateNode===null)throw Error(r(166));if(E=ki(ri.current),ki(on.current),Nh(g)){if(R=g.stateNode,E=g.memoizedProps,R[rs]=g,(X=R.nodeValue!==E)&&(d=ws,d!==null))switch(d.tag){case 3:Ie(R.nodeValue,E,(d.mode&1)!==0);break;case 5:d.memoizedProps.suppressHydrationWarning!==!0&&Ie(R.nodeValue,E,(d.mode&1)!==0)}X&&(g.flags|=4)}else R=(E.nodeType===9?E:E.ownerDocument).createTextNode(R),R[rs]=g,g.stateNode=R}return is(g),null;case 13:if(dn(hn),R=g.memoizedState,d===null||d.memoizedState!==null&&d.memoizedState.dehydrated!==null){if(Zr&&xt!==null&&(g.mode&1)!==0&&(g.flags&128)===0)wm(),Ku(),g.flags|=98560,X=!1;else if(X=Nh(g),R!==null&&R.dehydrated!==null){if(d===null){if(!X)throw Error(r(318));if(X=g.memoizedState,X=X!==null?X.dehydrated:null,!X)throw Error(r(317));X[rs]=g}else Ku(),(g.flags&128)===0&&(g.memoizedState=null),g.flags|=4;is(g),X=!1}else Ss!==null&&(Sb(Ss),Ss=null),X=!0;if(!X)return g.flags&65536?g:null}return(g.flags&128)!==0?(g.lanes=E,g):(R=R!==null,R!==(d!==null&&d.memoizedState!==null)&&R&&(g.child.flags|=8192,(g.mode&1)!==0&&(d===null||(hn.current&1)!==0?qi===0&&(qi=3):Cb())),g.updateQueue!==null&&(g.flags|=4),is(g),null);case 4:return _n(),db(d,g),d===null&&No(g.stateNode.containerInfo),is(g),null;case 10:return Kf(g.type._context),is(g),null;case 17:return oa(g.type)&&Gc(),is(g),null;case 19:if(dn(hn),X=g.memoizedState,X===null)return is(g),null;if(R=(g.flags&128)!==0,oe=X.rendering,oe===null)if(R)Rm(X,!1);else{if(qi!==0||d!==null&&(d.flags&128)!==0)for(d=g.child;d!==null;){if(oe=Yc(d),oe!==null){for(g.flags|=128,Rm(X,!1),R=oe.updateQueue,R!==null&&(g.updateQueue=R,g.flags|=4),g.subtreeFlags=0,R=E,E=g.child;E!==null;)X=E,d=R,X.flags&=14680066,oe=X.alternate,oe===null?(X.childLanes=0,X.lanes=d,X.child=null,X.subtreeFlags=0,X.memoizedProps=null,X.memoizedState=null,X.updateQueue=null,X.dependencies=null,X.stateNode=null):(X.childLanes=oe.childLanes,X.lanes=oe.lanes,X.child=oe.child,X.subtreeFlags=0,X.deletions=null,X.memoizedProps=oe.memoizedProps,X.memoizedState=oe.memoizedState,X.updateQueue=oe.updateQueue,X.type=oe.type,d=oe.dependencies,X.dependencies=d===null?null:{lanes:d.lanes,firstContext:d.firstContext}),E=E.sibling;return sn(hn,hn.current&1|2),g.child}d=d.sibling}X.tail!==null&&Xr()>up&&(g.flags|=128,R=!0,Rm(X,!1),g.lanes=4194304)}else{if(!R)if(d=Yc(oe),d!==null){if(g.flags|=128,R=!0,E=d.updateQueue,E!==null&&(g.updateQueue=E,g.flags|=4),Rm(X,!0),X.tail===null&&X.tailMode==="hidden"&&!oe.alternate&&!Zr)return is(g),null}else 2*Xr()-X.renderingStartTime>up&&E!==1073741824&&(g.flags|=128,R=!0,Rm(X,!1),g.lanes=4194304);X.isBackwards?(oe.sibling=g.child,g.child=oe):(E=X.last,E!==null?E.sibling=oe:g.child=oe,X.last=oe)}return X.tail!==null?(g=X.tail,X.rendering=g,X.tail=g.sibling,X.renderingStartTime=Xr(),g.sibling=null,E=hn.current,sn(hn,R?E&1|2:E&1),g):(is(g),null);case 22:case 23:return _b(),R=g.memoizedState!==null,d!==null&&d.memoizedState!==null!==R&&(g.flags|=8192),R&&(g.mode&1)!==0?(co&1073741824)!==0&&(is(g),g.subtreeFlags&6&&(g.flags|=8192)):is(g),null;case 24:return null;case 25:return null}throw Error(r(156,g.tag))}function _D(d,g){switch(Oi(g),g.tag){case 1:return oa(g.type)&&Gc(),d=g.flags,d&65536?(g.flags=d&-65537|128,g):null;case 3:return _n(),dn(sa),dn(Hi),la(),d=g.flags,(d&65536)!==0&&(d&128)===0?(g.flags=d&-65537|128,g):null;case 5:return wl(g),null;case 13:if(dn(hn),d=g.memoizedState,d!==null&&d.dehydrated!==null){if(g.alternate===null)throw Error(r(340));Ku()}return d=g.flags,d&65536?(g.flags=d&-65537|128,g):null;case 19:return dn(hn),null;case 4:return _n(),null;case 10:return Kf(g.type._context),null;case 22:case 23:return _b(),null;case 24:return null;default:return null}}var M0=!1,as=!1,CD=typeof WeakSet=="function"?WeakSet:Set,Lt=null;function op(d,g){var E=d.ref;if(E!==null)if(typeof E=="function")try{E(null)}catch(R){ci(d,g,R)}else E.current=null}function hb(d,g,E){try{E()}catch(R){ci(d,g,R)}}var LC=!1;function ED(d,g){if(kt=Ou,d=Un(),eu(d)){if("selectionStart"in d)var E={start:d.selectionStart,end:d.selectionEnd};else e:{E=(E=d.ownerDocument)&&E.defaultView||window;var R=E.getSelection&&E.getSelection();if(R&&R.rangeCount!==0){E=R.anchorNode;var V=R.anchorOffset,X=R.focusNode;R=R.focusOffset;try{E.nodeType,X.nodeType}catch{E=null;break e}var oe=0,be=-1,_e=-1,Ue=0,nt=0,st=d,tt=null;t:for(;;){for(var Pt;st!==E||V!==0&&st.nodeType!==3||(be=oe+V),st!==X||R!==0&&st.nodeType!==3||(_e=oe+R),st.nodeType===3&&(oe+=st.nodeValue.length),(Pt=st.firstChild)!==null;)tt=st,st=Pt;for(;;){if(st===d)break t;if(tt===E&&++Ue===V&&(be=oe),tt===X&&++nt===R&&(_e=oe),(Pt=st.nextSibling)!==null)break;st=tt,tt=st.parentNode}st=Pt}E=be===-1||_e===-1?null:{start:be,end:_e}}else E=null}E=E||{start:0,end:0}}else E=null;for($t={focusedElem:d,selectionRange:E},Ou=!1,Lt=g;Lt!==null;)if(g=Lt,d=g.child,(g.subtreeFlags&1028)!==0&&d!==null)d.return=g,Lt=d;else for(;Lt!==null;){g=Lt;try{var Dt=g.alternate;if((g.flags&1024)!==0)switch(g.tag){case 0:case 11:case 15:break;case 1:if(Dt!==null){var Bt=Dt.memoizedProps,Ei=Dt.memoizedState,Ae=g.stateNode,Ee=Ae.getSnapshotBeforeUpdate(g.elementType===g.type?Bt:Wi(g.type,Bt),Ei);Ae.__reactInternalSnapshotBeforeUpdate=Ee}break;case 3:var Oe=g.stateNode.containerInfo;Oe.nodeType===1?Oe.textContent="":Oe.nodeType===9&&Oe.documentElement&&Oe.removeChild(Oe.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(r(163))}}catch(ht){ci(g,g.return,ht)}if(d=g.sibling,d!==null){d.return=g.return,Lt=d;break}Lt=g.return}return Dt=LC,LC=!1,Dt}function Lm(d,g,E){var R=g.updateQueue;if(R=R!==null?R.lastEffect:null,R!==null){var V=R=R.next;do{if((V.tag&d)===d){var X=V.destroy;V.destroy=void 0,X!==void 0&&hb(g,E,X)}V=V.next}while(V!==R)}}function A0(d,g){if(g=g.updateQueue,g=g!==null?g.lastEffect:null,g!==null){var E=g=g.next;do{if((E.tag&d)===d){var R=E.create;E.destroy=R()}E=E.next}while(E!==g)}}function fb(d){var g=d.ref;if(g!==null){var E=d.stateNode;d.tag,d=E,typeof g=="function"?g(d):g.current=d}}function OC(d){var g=d.alternate;g!==null&&(d.alternate=null,OC(g)),d.child=null,d.deletions=null,d.sibling=null,d.tag===5&&(g=d.stateNode,g!==null&&(delete g[rs],delete g[iu],delete g[gl],delete g[Bf],delete g[zf])),d.stateNode=null,d.return=null,d.dependencies=null,d.memoizedProps=null,d.memoizedState=null,d.pendingProps=null,d.stateNode=null,d.updateQueue=null}function DC(d){return d.tag===5||d.tag===3||d.tag===4}function IC(d){e:for(;;){for(;d.sibling===null;){if(d.return===null||DC(d.return))return null;d=d.return}for(d.sibling.return=d.return,d=d.sibling;d.tag!==5&&d.tag!==6&&d.tag!==18;){if(d.flags&2||d.child===null||d.tag===4)continue e;d.child.return=d,d=d.child}if(!(d.flags&2))return d.stateNode}}function pb(d,g,E){var R=d.tag;if(R===5||R===6)d=d.stateNode,g?E.nodeType===8?E.parentNode.insertBefore(d,g):E.insertBefore(d,g):(E.nodeType===8?(g=E.parentNode,g.insertBefore(d,E)):(g=E,g.appendChild(d)),E=E._reactRootContainer,E!=null||g.onclick!==null||(g.onclick=Ze));else if(R!==4&&(d=d.child,d!==null))for(pb(d,g,E),d=d.sibling;d!==null;)pb(d,g,E),d=d.sibling}function mb(d,g,E){var R=d.tag;if(R===5||R===6)d=d.stateNode,g?E.insertBefore(d,g):E.appendChild(d);else if(R!==4&&(d=d.child,d!==null))for(mb(d,g,E),d=d.sibling;d!==null;)mb(d,g,E),d=d.sibling}var ja=null,_l=!1;function od(d,g,E){for(E=E.child;E!==null;)jC(d,g,E),E=E.sibling}function jC(d,g,E){if(tr&&typeof tr.onCommitFiberUnmount=="function")try{tr.onCommitFiberUnmount(ir,E)}catch{}switch(E.tag){case 5:as||op(E,g);case 6:var R=ja,V=_l;ja=null,od(d,g,E),ja=R,_l=V,ja!==null&&(_l?(d=ja,E=E.stateNode,d.nodeType===8?d.parentNode.removeChild(E):d.removeChild(E)):ja.removeChild(E.stateNode));break;case 18:ja!==null&&(_l?(d=ja,E=E.stateNode,d.nodeType===8?Uc(d.parentNode,E):d.nodeType===1&&Uc(d,E),Fn(d)):Uc(ja,E.stateNode));break;case 4:R=ja,V=_l,ja=E.stateNode.containerInfo,_l=!0,od(d,g,E),ja=R,_l=V;break;case 0:case 11:case 14:case 15:if(!as&&(R=E.updateQueue,R!==null&&(R=R.lastEffect,R!==null))){V=R=R.next;do{var X=V,oe=X.destroy;X=X.tag,oe!==void 0&&((X&2)!==0||(X&4)!==0)&&hb(E,g,oe),V=V.next}while(V!==R)}od(d,g,E);break;case 1:if(!as&&(op(E,g),R=E.stateNode,typeof R.componentWillUnmount=="function"))try{R.props=E.memoizedProps,R.state=E.memoizedState,R.componentWillUnmount()}catch(be){ci(E,g,be)}od(d,g,E);break;case 21:od(d,g,E);break;case 22:E.mode&1?(as=(R=as)||E.memoizedState!==null,od(d,g,E),as=R):od(d,g,E);break;default:od(d,g,E)}}function FC(d){var g=d.updateQueue;if(g!==null){d.updateQueue=null;var E=d.stateNode;E===null&&(E=d.stateNode=new CD),g.forEach(function(R){var V=DD.bind(null,d,R);E.has(R)||(E.add(R),R.then(V,V))})}}function Cl(d,g){var E=g.deletions;if(E!==null)for(var R=0;R<E.length;R++){var V=E[R];try{var X=d,oe=g,be=oe;e:for(;be!==null;){switch(be.tag){case 5:ja=be.stateNode,_l=!1;break e;case 3:ja=be.stateNode.containerInfo,_l=!0;break e;case 4:ja=be.stateNode.containerInfo,_l=!0;break e}be=be.return}if(ja===null)throw Error(r(160));jC(X,oe,V),ja=null,_l=!1;var _e=V.alternate;_e!==null&&(_e.return=null),V.return=null}catch(Ue){ci(V,g,Ue)}}if(g.subtreeFlags&12854)for(g=g.child;g!==null;)BC(g,d),g=g.sibling}function BC(d,g){var E=d.alternate,R=d.flags;switch(d.tag){case 0:case 11:case 14:case 15:if(Cl(g,d),mu(d),R&4){try{Lm(3,d,d.return),A0(3,d)}catch(Bt){ci(d,d.return,Bt)}try{Lm(5,d,d.return)}catch(Bt){ci(d,d.return,Bt)}}break;case 1:Cl(g,d),mu(d),R&512&&E!==null&&op(E,E.return);break;case 5:if(Cl(g,d),mu(d),R&512&&E!==null&&op(E,E.return),d.flags&32){var V=d.stateNode;try{wt(V,"")}catch(Bt){ci(d,d.return,Bt)}}if(R&4&&(V=d.stateNode,V!=null)){var X=d.memoizedProps,oe=E!==null?E.memoizedProps:X,be=d.type,_e=d.updateQueue;if(d.updateQueue=null,_e!==null)try{be==="input"&&X.type==="radio"&&X.name!=null&&St(V,X),Re(be,oe);var Ue=Re(be,X);for(oe=0;oe<_e.length;oe+=2){var nt=_e[oe],st=_e[oe+1];nt==="style"?ve(V,st):nt==="dangerouslySetInnerHTML"?qt(V,st):nt==="children"?wt(V,st):C(V,nt,st,Ue)}switch(be){case"input":rt(V,X);break;case"textarea":Ke(V,X);break;case"select":var tt=V._wrapperState.wasMultiple;V._wrapperState.wasMultiple=!!X.multiple;var Pt=X.value;Pt!=null?Qe(V,!!X.multiple,Pt,!1):tt!==!!X.multiple&&(X.defaultValue!=null?Qe(V,!!X.multiple,X.defaultValue,!0):Qe(V,!!X.multiple,X.multiple?[]:"",!1))}V[iu]=X}catch(Bt){ci(d,d.return,Bt)}}break;case 6:if(Cl(g,d),mu(d),R&4){if(d.stateNode===null)throw Error(r(162));V=d.stateNode,X=d.memoizedProps;try{V.nodeValue=X}catch(Bt){ci(d,d.return,Bt)}}break;case 3:if(Cl(g,d),mu(d),R&4&&E!==null&&E.memoizedState.isDehydrated)try{Fn(g.containerInfo)}catch(Bt){ci(d,d.return,Bt)}break;case 4:Cl(g,d),mu(d);break;case 13:Cl(g,d),mu(d),V=d.child,V.flags&8192&&(X=V.memoizedState!==null,V.stateNode.isHidden=X,!X||V.alternate!==null&&V.alternate.memoizedState!==null||(yb=Xr())),R&4&&FC(d);break;case 22:if(nt=E!==null&&E.memoizedState!==null,d.mode&1?(as=(Ue=as)||nt,Cl(g,d),as=Ue):Cl(g,d),mu(d),R&8192){if(Ue=d.memoizedState!==null,(d.stateNode.isHidden=Ue)&&!nt&&(d.mode&1)!==0)for(Lt=d,nt=d.child;nt!==null;){for(st=Lt=nt;Lt!==null;){switch(tt=Lt,Pt=tt.child,tt.tag){case 0:case 11:case 14:case 15:Lm(4,tt,tt.return);break;case 1:op(tt,tt.return);var Dt=tt.stateNode;if(typeof Dt.componentWillUnmount=="function"){R=tt,E=tt.return;try{g=R,Dt.props=g.memoizedProps,Dt.state=g.memoizedState,Dt.componentWillUnmount()}catch(Bt){ci(R,E,Bt)}}break;case 5:op(tt,tt.return);break;case 22:if(tt.memoizedState!==null){GC(st);continue}}Pt!==null?(Pt.return=tt,Lt=Pt):GC(st)}nt=nt.sibling}e:for(nt=null,st=d;;){if(st.tag===5){if(nt===null){nt=st;try{V=st.stateNode,Ue?(X=V.style,typeof X.setProperty=="function"?X.setProperty("display","none","important"):X.display="none"):(be=st.stateNode,_e=st.memoizedProps.style,oe=_e!=null&&_e.hasOwnProperty("display")?_e.display:null,be.style.display=ce("display",oe))}catch(Bt){ci(d,d.return,Bt)}}}else if(st.tag===6){if(nt===null)try{st.stateNode.nodeValue=Ue?"":st.memoizedProps}catch(Bt){ci(d,d.return,Bt)}}else if((st.tag!==22&&st.tag!==23||st.memoizedState===null||st===d)&&st.child!==null){st.child.return=st,st=st.child;continue}if(st===d)break e;for(;st.sibling===null;){if(st.return===null||st.return===d)break e;nt===st&&(nt=null),st=st.return}nt===st&&(nt=null),st.sibling.return=st.return,st=st.sibling}}break;case 19:Cl(g,d),mu(d),R&4&&FC(d);break;case 21:break;default:Cl(g,d),mu(d)}}function mu(d){var g=d.flags;if(g&2){try{e:{for(var E=d.return;E!==null;){if(DC(E)){var R=E;break e}E=E.return}throw Error(r(160))}switch(R.tag){case 5:var V=R.stateNode;R.flags&32&&(wt(V,""),R.flags&=-33);var X=IC(d);mb(d,X,V);break;case 3:case 4:var oe=R.stateNode.containerInfo,be=IC(d);pb(d,be,oe);break;default:throw Error(r(161))}}catch(_e){ci(d,d.return,_e)}d.flags&=-3}g&4096&&(d.flags&=-4097)}function TD(d,g,E){Lt=d,zC(d)}function zC(d,g,E){for(var R=(d.mode&1)!==0;Lt!==null;){var V=Lt,X=V.child;if(V.tag===22&&R){var oe=V.memoizedState!==null||M0;if(!oe){var be=V.alternate,_e=be!==null&&be.memoizedState!==null||as;be=M0;var Ue=as;if(M0=oe,(as=_e)&&!Ue)for(Lt=V;Lt!==null;)oe=Lt,_e=oe.child,oe.tag===22&&oe.memoizedState!==null?VC(V):_e!==null?(_e.return=oe,Lt=_e):VC(V);for(;X!==null;)Lt=X,zC(X),X=X.sibling;Lt=V,M0=be,as=Ue}UC(d)}else(V.subtreeFlags&8772)!==0&&X!==null?(X.return=V,Lt=X):UC(d)}}function UC(d){for(;Lt!==null;){var g=Lt;if((g.flags&8772)!==0){var E=g.alternate;try{if((g.flags&8772)!==0)switch(g.tag){case 0:case 11:case 15:as||A0(5,g);break;case 1:var R=g.stateNode;if(g.flags&4&&!as)if(E===null)R.componentDidMount();else{var V=g.elementType===g.type?E.memoizedProps:Wi(g.type,E.memoizedProps);R.componentDidUpdate(V,E.memoizedState,R.__reactInternalSnapshotBeforeUpdate)}var X=g.updateQueue;X!==null&&Hn(g,X,R);break;case 3:var oe=g.updateQueue;if(oe!==null){if(E=null,g.child!==null)switch(g.child.tag){case 5:E=g.child.stateNode;break;case 1:E=g.child.stateNode}Hn(g,oe,E)}break;case 5:var be=g.stateNode;if(E===null&&g.flags&4){E=be;var _e=g.memoizedProps;switch(g.type){case"button":case"input":case"select":case"textarea":_e.autoFocus&&E.focus();break;case"img":_e.src&&(E.src=_e.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(g.memoizedState===null){var Ue=g.alternate;if(Ue!==null){var nt=Ue.memoizedState;if(nt!==null){var st=nt.dehydrated;st!==null&&Fn(st)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(r(163))}as||g.flags&512&&fb(g)}catch(tt){ci(g,g.return,tt)}}if(g===d){Lt=null;break}if(E=g.sibling,E!==null){E.return=g.return,Lt=E;break}Lt=g.return}}function GC(d){for(;Lt!==null;){var g=Lt;if(g===d){Lt=null;break}var E=g.sibling;if(E!==null){E.return=g.return,Lt=E;break}Lt=g.return}}function VC(d){for(;Lt!==null;){var g=Lt;try{switch(g.tag){case 0:case 11:case 15:var E=g.return;try{A0(4,g)}catch(_e){ci(g,E,_e)}break;case 1:var R=g.stateNode;if(typeof R.componentDidMount=="function"){var V=g.return;try{R.componentDidMount()}catch(_e){ci(g,V,_e)}}var X=g.return;try{fb(g)}catch(_e){ci(g,X,_e)}break;case 5:var oe=g.return;try{fb(g)}catch(_e){ci(g,oe,_e)}}}catch(_e){ci(g,g.return,_e)}if(g===d){Lt=null;break}var be=g.sibling;if(be!==null){be.return=g.return,Lt=be;break}Lt=g.return}}var ND=Math.ceil,R0=N.ReactCurrentDispatcher,gb=N.ReactCurrentOwner,jo=N.ReactCurrentBatchConfig,Ir=0,ha=null,Di=null,Fa=0,co=0,lp=yl(0),qi=0,Om=null,Ih=0,L0=0,vb=0,Dm=null,Vs=null,yb=0,up=1/0,Ju=null,O0=!1,xb=null,ld=null,D0=!1,ud=null,I0=0,Im=0,bb=null,j0=-1,F0=0;function Es(){return(Ir&6)!==0?Xr():j0!==-1?j0:j0=Xr()}function cd(d){return(d.mode&1)===0?1:(Ir&2)!==0&&Fa!==0?Fa&-Fa:Sm.transition!==null?(F0===0&&(F0=Ul()),F0):(d=wr,d!==0||(d=window.event,d=d===void 0?16:Cr(d.type)),d)}function El(d,g,E,R){if(50<Im)throw Im=0,bb=null,Error(r(185));ps(d,E,R),((Ir&2)===0||d!==ha)&&(d===ha&&((Ir&2)===0&&(L0|=E),qi===4&&dd(d,Fa)),Hs(d,R),E===1&&Ir===0&&(g.mode&1)===0&&(up=Xr()+500,Vc&&su()))}function Hs(d,g){var E=d.callbackNode;On(d,g);var R=sr(d,d===ha?Fa:0);if(R===0)E!==null&&el(E),d.callbackNode=null,d.callbackPriority=0;else if(g=R&-R,d.callbackPriority!==g){if(E!=null&&el(E),g===1)d.tag===0?xl(WC.bind(null,d)):Th(WC.bind(null,d)),Vi(function(){(Ir&6)===0&&su()}),E=null;else{switch(ro(R)){case 1:E=fs;break;case 4:E=Be;break;case 16:E=Xe;break;case 536870912:E=Vt;break;default:E=Xe}E=JC(E,HC.bind(null,d))}d.callbackPriority=g,d.callbackNode=E}}function HC(d,g){if(j0=-1,F0=0,(Ir&6)!==0)throw Error(r(327));var E=d.callbackNode;if(cp()&&d.callbackNode!==E)return null;var R=sr(d,d===ha?Fa:0);if(R===0)return null;if((R&30)!==0||(R&d.expiredLanes)!==0||g)g=B0(d,R);else{g=R;var V=Ir;Ir|=2;var X=$C();(ha!==d||Fa!==g)&&(Ju=null,up=Xr()+500,Fh(d,g));do try{AD();break}catch(be){qC(d,be)}while(!0);$f(),R0.current=X,Ir=V,Di!==null?g=0:(ha=null,Fa=0,g=qi)}if(g!==0){if(g===2&&(V=Dn(d),V!==0&&(R=V,g=wb(d,V))),g===1)throw E=Om,Fh(d,0),dd(d,R),Hs(d,Xr()),E;if(g===6)dd(d,R);else{if(V=d.current.alternate,(R&30)===0&&!PD(V)&&(g=B0(d,R),g===2&&(X=Dn(d),X!==0&&(R=X,g=wb(d,X))),g===1))throw E=Om,Fh(d,0),dd(d,R),Hs(d,Xr()),E;switch(d.finishedWork=V,d.finishedLanes=R,g){case 0:case 1:throw Error(r(345));case 2:Bh(d,Vs,Ju);break;case 3:if(dd(d,R),(R&130023424)===R&&(g=yb+500-Xr(),10<g)){if(sr(d,0)!==0)break;if(V=d.suspendedLanes,(V&R)!==R){Es(),d.pingedLanes|=d.suspendedLanes&V;break}d.timeoutHandle=Kr(Bh.bind(null,d,Vs,Ju),g);break}Bh(d,Vs,Ju);break;case 4:if(dd(d,R),(R&4194240)===R)break;for(g=d.eventTimes,V=-1;0<R;){var oe=31-ct(R);X=1<<oe,oe=g[oe],oe>V&&(V=oe),R&=~X}if(R=V,R=Xr()-R,R=(120>R?120:480>R?480:1080>R?1080:1920>R?1920:3e3>R?3e3:4320>R?4320:1960*ND(R/1960))-R,10<R){d.timeoutHandle=Kr(Bh.bind(null,d,Vs,Ju),R);break}Bh(d,Vs,Ju);break;case 5:Bh(d,Vs,Ju);break;default:throw Error(r(329))}}}return Hs(d,Xr()),d.callbackNode===E?HC.bind(null,d):null}function wb(d,g){var E=Dm;return d.current.memoizedState.isDehydrated&&(Fh(d,g).flags|=256),d=B0(d,g),d!==2&&(g=Vs,Vs=E,g!==null&&Sb(g)),d}function Sb(d){Vs===null?Vs=d:Vs.push.apply(Vs,d)}function PD(d){for(var g=d;;){if(g.flags&16384){var E=g.updateQueue;if(E!==null&&(E=E.stores,E!==null))for(var R=0;R<E.length;R++){var V=E[R],X=V.getSnapshot;V=V.value;try{if(!ia(X(),V))return!1}catch{return!1}}}if(E=g.child,g.subtreeFlags&16384&&E!==null)E.return=g,g=E;else{if(g===d)break;for(;g.sibling===null;){if(g.return===null||g.return===d)return!0;g=g.return}g.sibling.return=g.return,g=g.sibling}}return!0}function dd(d,g){for(g&=~vb,g&=~L0,d.suspendedLanes|=g,d.pingedLanes&=~g,d=d.expirationTimes;0<g;){var E=31-ct(g),R=1<<E;d[E]=-1,g&=~R}}function WC(d){if((Ir&6)!==0)throw Error(r(327));cp();var g=sr(d,0);if((g&1)===0)return Hs(d,Xr()),null;var E=B0(d,g);if(d.tag!==0&&E===2){var R=Dn(d);R!==0&&(g=R,E=wb(d,R))}if(E===1)throw E=Om,Fh(d,0),dd(d,g),Hs(d,Xr()),E;if(E===6)throw Error(r(345));return d.finishedWork=d.current.alternate,d.finishedLanes=g,Bh(d,Vs,Ju),Hs(d,Xr()),null}function kb(d,g){var E=Ir;Ir|=1;try{return d(g)}finally{Ir=E,Ir===0&&(up=Xr()+500,Vc&&su())}}function jh(d){ud!==null&&ud.tag===0&&(Ir&6)===0&&cp();var g=Ir;Ir|=1;var E=jo.transition,R=wr;try{if(jo.transition=null,wr=1,d)return d()}finally{wr=R,jo.transition=E,Ir=g,(Ir&6)===0&&su()}}function _b(){co=lp.current,dn(lp)}function Fh(d,g){d.finishedWork=null,d.finishedLanes=0;var E=d.timeoutHandle;if(E!==-1&&(d.timeoutHandle=-1,Gn(E)),Di!==null)for(E=Di.return;E!==null;){var R=E;switch(Oi(R),R.tag){case 1:R=R.type.childContextTypes,R!=null&&Gc();break;case 3:_n(),dn(sa),dn(Hi),la();break;case 5:wl(R);break;case 4:_n();break;case 13:dn(hn);break;case 19:dn(hn);break;case 10:Kf(R.type._context);break;case 22:case 23:_b()}E=E.return}if(ha=d,Di=d=hd(d.current,null),Fa=co=g,qi=0,Om=null,vb=L0=Ih=0,Vs=Dm=null,Ro!==null){for(g=0;g<Ro.length;g++)if(E=Ro[g],R=E.interleaved,R!==null){E.interleaved=null;var V=R.next,X=E.pending;if(X!==null){var oe=X.next;X.next=V,R.next=oe}E.pending=R}Ro=null}return d}function qC(d,g){do{var E=Di;try{if($f(),Xc.current=rd,uo){for(var R=en.memoizedState;R!==null;){var V=R.queue;V!==null&&(V.pending=null),R=R.next}uo=!1}if(Da=0,li=Wn=en=null,du=!1,Gs=0,gb.current=null,E===null||E.return===null){qi=1,Om=g,Di=null;break}e:{var X=d,oe=E.return,be=E,_e=g;if(g=Fa,be.flags|=32768,_e!==null&&typeof _e=="object"&&typeof _e.then=="function"){var Ue=_e,nt=be,st=nt.tag;if((nt.mode&1)===0&&(st===0||st===11||st===15)){var tt=nt.alternate;tt?(nt.updateQueue=tt.updateQueue,nt.memoizedState=tt.memoizedState,nt.lanes=tt.lanes):(nt.updateQueue=null,nt.memoizedState=null)}var Pt=M(oe);if(Pt!==null){Pt.flags&=-257,z(Pt,oe,be,X,g),Pt.mode&1&&b(X,Ue,g),g=Pt,_e=Ue;var Dt=g.updateQueue;if(Dt===null){var Bt=new Set;Bt.add(_e),g.updateQueue=Bt}else Dt.add(_e);break e}else{if((g&1)===0){b(X,Ue,g),Cb();break e}_e=Error(r(426))}}else if(Zr&&be.mode&1){var Ei=M(oe);if(Ei!==null){(Ei.flags&65536)===0&&(Ei.flags|=256),z(Ei,oe,be,X,g),Ph(Qu(_e,be));break e}}X=_e=Qu(_e,be),qi!==4&&(qi=2),Dm===null?Dm=[X]:Dm.push(X),X=oe;do{switch(X.tag){case 3:X.flags|=65536,g&=-g,X.lanes|=g;var Ae=P0(X,_e,g);Lh(X,Ae);break e;case 1:be=_e;var Ee=X.type,Oe=X.stateNode;if((X.flags&128)===0&&(typeof Ee.getDerivedStateFromError=="function"||Oe!==null&&typeof Oe.componentDidCatch=="function"&&(ld===null||!ld.has(Oe)))){X.flags|=65536,g&=-g,X.lanes|=g;var ht=x(X,be,g);Lh(X,ht);break e}}X=X.return}while(X!==null)}ZC(E)}catch(zt){g=zt,Di===E&&E!==null&&(Di=E=E.return);continue}break}while(!0)}function $C(){var d=R0.current;return R0.current=rd,d===null?rd:d}function Cb(){(qi===0||qi===3||qi===2)&&(qi=4),ha===null||(Ih&268435455)===0&&(L0&268435455)===0||dd(ha,Fa)}function B0(d,g){var E=Ir;Ir|=2;var R=$C();(ha!==d||Fa!==g)&&(Ju=null,Fh(d,g));do try{MD();break}catch(V){qC(d,V)}while(!0);if($f(),Ir=E,R0.current=R,Di!==null)throw Error(r(261));return ha=null,Fa=0,qi}function MD(){for(;Di!==null;)KC(Di)}function AD(){for(;Di!==null&&!zl();)KC(Di)}function KC(d){var g=QC(d.alternate,d,co);d.memoizedProps=d.pendingProps,g===null?ZC(d):Di=g,gb.current=null}function ZC(d){var g=d;do{var E=g.alternate;if(d=g.return,(g.flags&32768)===0){if(E=kD(E,g,co),E!==null){Di=E;return}}else{if(E=_D(E,g),E!==null){E.flags&=32767,Di=E;return}if(d!==null)d.flags|=32768,d.subtreeFlags=0,d.deletions=null;else{qi=6,Di=null;return}}if(g=g.sibling,g!==null){Di=g;return}Di=g=d}while(g!==null);qi===0&&(qi=5)}function Bh(d,g,E){var R=wr,V=jo.transition;try{jo.transition=null,wr=1,RD(d,g,E,R)}finally{jo.transition=V,wr=R}return null}function RD(d,g,E,R){do cp();while(ud!==null);if((Ir&6)!==0)throw Error(r(327));E=d.finishedWork;var V=d.finishedLanes;if(E===null)return null;if(d.finishedWork=null,d.finishedLanes=0,E===d.current)throw Error(r(177));d.callbackNode=null,d.callbackPriority=0;var X=E.lanes|E.childLanes;if(In(d,X),d===ha&&(Di=ha=null,Fa=0),(E.subtreeFlags&2064)===0&&(E.flags&2064)===0||D0||(D0=!0,JC(Xe,function(){return cp(),null})),X=(E.flags&15990)!==0,(E.subtreeFlags&15990)!==0||X){X=jo.transition,jo.transition=null;var oe=wr;wr=1;var be=Ir;Ir|=4,gb.current=null,ED(d,E),BC(E,d),aa($t),Ou=!!kt,$t=kt=null,d.current=E,TD(E),xo(),Ir=be,wr=oe,jo.transition=X}else d.current=E;if(D0&&(D0=!1,ud=d,I0=V),X=d.pendingLanes,X===0&&(ld=null),gr(E.stateNode),Hs(d,Xr()),g!==null)for(R=d.onRecoverableError,E=0;E<g.length;E++)V=g[E],R(V.value,{componentStack:V.stack,digest:V.digest});if(O0)throw O0=!1,d=xb,xb=null,d;return(I0&1)!==0&&d.tag!==0&&cp(),X=d.pendingLanes,(X&1)!==0?d===bb?Im++:(Im=0,bb=d):Im=0,su(),null}function cp(){if(ud!==null){var d=ro(I0),g=jo.transition,E=wr;try{if(jo.transition=null,wr=16>d?16:d,ud===null)var R=!1;else{if(d=ud,ud=null,I0=0,(Ir&6)!==0)throw Error(r(331));var V=Ir;for(Ir|=4,Lt=d.current;Lt!==null;){var X=Lt,oe=X.child;if((Lt.flags&16)!==0){var be=X.deletions;if(be!==null){for(var _e=0;_e<be.length;_e++){var Ue=be[_e];for(Lt=Ue;Lt!==null;){var nt=Lt;switch(nt.tag){case 0:case 11:case 15:Lm(8,nt,X)}var st=nt.child;if(st!==null)st.return=nt,Lt=st;else for(;Lt!==null;){nt=Lt;var tt=nt.sibling,Pt=nt.return;if(OC(nt),nt===Ue){Lt=null;break}if(tt!==null){tt.return=Pt,Lt=tt;break}Lt=Pt}}}var Dt=X.alternate;if(Dt!==null){var Bt=Dt.child;if(Bt!==null){Dt.child=null;do{var Ei=Bt.sibling;Bt.sibling=null,Bt=Ei}while(Bt!==null)}}Lt=X}}if((X.subtreeFlags&2064)!==0&&oe!==null)oe.return=X,Lt=oe;else e:for(;Lt!==null;){if(X=Lt,(X.flags&2048)!==0)switch(X.tag){case 0:case 11:case 15:Lm(9,X,X.return)}var Ae=X.sibling;if(Ae!==null){Ae.return=X.return,Lt=Ae;break e}Lt=X.return}}var Ee=d.current;for(Lt=Ee;Lt!==null;){oe=Lt;var Oe=oe.child;if((oe.subtreeFlags&2064)!==0&&Oe!==null)Oe.return=oe,Lt=Oe;else e:for(oe=Ee;Lt!==null;){if(be=Lt,(be.flags&2048)!==0)try{switch(be.tag){case 0:case 11:case 15:A0(9,be)}}catch(zt){ci(be,be.return,zt)}if(be===oe){Lt=null;break e}var ht=be.sibling;if(ht!==null){ht.return=be.return,Lt=ht;break e}Lt=be.return}}if(Ir=V,su(),tr&&typeof tr.onPostCommitFiberRoot=="function")try{tr.onPostCommitFiberRoot(ir,d)}catch{}R=!0}return R}finally{wr=E,jo.transition=g}}return!1}function YC(d,g,E){g=Qu(E,g),g=P0(d,g,1),d=Do(d,g,1),g=Es(),d!==null&&(ps(d,1,g),Hs(d,g))}function ci(d,g,E){if(d.tag===3)YC(d,d,E);else for(;g!==null;){if(g.tag===3){YC(g,d,E);break}else if(g.tag===1){var R=g.stateNode;if(typeof g.type.getDerivedStateFromError=="function"||typeof R.componentDidCatch=="function"&&(ld===null||!ld.has(R))){d=Qu(E,d),d=x(g,d,1),g=Do(g,d,1),d=Es(),g!==null&&(ps(g,1,d),Hs(g,d));break}}g=g.return}}function LD(d,g,E){var R=d.pingCache;R!==null&&R.delete(g),g=Es(),d.pingedLanes|=d.suspendedLanes&E,ha===d&&(Fa&E)===E&&(qi===4||qi===3&&(Fa&130023424)===Fa&&500>Xr()-yb?Fh(d,0):vb|=E),Hs(d,g)}function XC(d,g){g===0&&((d.mode&1)===0?g=1:(g=ii,ii<<=1,(ii&130023424)===0&&(ii=4194304)));var E=Es();d=_s(d,g),d!==null&&(ps(d,g,E),Hs(d,E))}function OD(d){var g=d.memoizedState,E=0;g!==null&&(E=g.retryLane),XC(d,E)}function DD(d,g){var E=0;switch(d.tag){case 13:var R=d.stateNode,V=d.memoizedState;V!==null&&(E=V.retryLane);break;case 19:R=d.stateNode;break;default:throw Error(r(314))}R!==null&&R.delete(g),XC(d,E)}var QC;QC=function(d,g,E){if(d!==null)if(d.memoizedProps!==g.pendingProps||sa.current)ee=!0;else{if((d.lanes&E)===0&&(g.flags&128)===0)return ee=!1,cb(d,g,E);ee=(d.flags&131072)!==0}else ee=!1,Zr&&(g.flags&1048576)!==0&&y0(g,lu,g.index);switch(g.lanes=0,g.tag){case 2:var R=g.type;Mr(d,g),d=g.pendingProps;var V=Vu(g,Hi.current);bl(g,E),V=Qc(null,g,R,d,V,E);var X=Jc();return g.flags|=1,typeof V=="object"&&V!==null&&typeof V.render=="function"&&V.$$typeof===void 0?(g.tag=1,g.memoizedState=null,g.updateQueue=null,oa(R)?(X=!0,Hu(g)):X=!1,g.memoizedState=V.state!==null&&V.state!==void 0?V.state:null,Rh(g),V.updater=ad,g.stateNode=V,V._reactInternals=g,ap(g,R,d,E),g=Yr(null,g,R,!0,X,E)):(g.tag=0,Zr&&X&&Hc(g),he(null,g,V,E),g=g.child),g;case 16:R=g.elementType;e:{switch(Mr(d,g),d=g.pendingProps,V=R._init,R=V(R._payload),g.type=R,V=g.tag=jD(R),d=Wi(R,d),V){case 0:g=Et(null,g,R,d,E);break e;case 1:g=fn(null,g,R,d,E);break e;case 11:g=Ne(null,g,R,d,E);break e;case 14:g=Ge(null,g,R,Wi(R.type,d),E);break e}throw Error(r(306,R,""))}return g;case 0:return R=g.type,V=g.pendingProps,V=g.elementType===R?V:Wi(R,V),Et(d,g,R,V,E);case 1:return R=g.type,V=g.pendingProps,V=g.elementType===R?V:Wi(R,V),fn(d,g,R,V,E);case 3:e:{if(Ia(g),d===null)throw Error(r(387));R=g.pendingProps,X=g.memoizedState,V=X.element,Yf(d,g),Kc(g,R,null,E);var oe=g.memoizedState;if(R=oe.element,X.isDehydrated)if(X={element:R,isDehydrated:!1,cache:oe.cache,pendingSuspenseBoundaries:oe.pendingSuspenseBoundaries,transitions:oe.transitions},g.updateQueue.baseState=X,g.memoizedState=X,g.flags&256){V=Qu(Error(r(423)),g),g=Io(d,g,R,E,V);break e}else if(R!==V){V=Qu(Error(r(424)),g),g=Io(d,g,R,E,V);break e}else for(xt=zs(g.stateNode.containerInfo.firstChild),ws=g,Zr=!0,Ss=null,E=Us(g,null,R,E),g.child=E;E;)E.flags=E.flags&-3|4096,E=E.sibling;else{if(Ku(),R===V){g=da(d,g,E);break e}he(d,g,R,E)}g=g.child}return g;case 5:return Zc(g),d===null&&Wc(g),R=g.type,V=g.pendingProps,X=d!==null?d.memoizedProps:null,oe=V.children,hr(R,V)?oe=null:X!==null&&hr(R,X)&&(g.flags|=32),ur(d,g),he(d,g,oe,E),g.child;case 6:return d===null&&Wc(g),null;case 13:return He(d,g,E);case 4:return cu(g,g.stateNode.containerInfo),R=g.pendingProps,d===null?g.child=Zu(g,null,R,E):he(d,g,R,E),g.child;case 11:return R=g.type,V=g.pendingProps,V=g.elementType===R?V:Wi(R,V),Ne(d,g,R,V,E);case 7:return he(d,g,g.pendingProps,E),g.child;case 8:return he(d,g,g.pendingProps.children,E),g.child;case 12:return he(d,g,g.pendingProps.children,E),g.child;case 10:e:{if(R=g.type._context,V=g.pendingProps,X=g.memoizedProps,oe=V.value,sn(Mh,R._currentValue),R._currentValue=oe,X!==null)if(ia(X.value,oe)){if(X.children===V.children&&!sa.current){g=da(d,g,E);break e}}else for(X=g.child,X!==null&&(X.return=g);X!==null;){var be=X.dependencies;if(be!==null){oe=X.child;for(var _e=be.firstContext;_e!==null;){if(_e.context===R){if(X.tag===1){_e=Oo(-1,E&-E),_e.tag=2;var Ue=X.updateQueue;if(Ue!==null){Ue=Ue.shared;var nt=Ue.pending;nt===null?_e.next=_e:(_e.next=nt.next,nt.next=_e),Ue.pending=_e}}X.lanes|=E,_e=X.alternate,_e!==null&&(_e.lanes|=E),Zf(X.return,E,g),be.lanes|=E;break}_e=_e.next}}else if(X.tag===10)oe=X.type===g.type?null:X.child;else if(X.tag===18){if(oe=X.return,oe===null)throw Error(r(341));oe.lanes|=E,be=oe.alternate,be!==null&&(be.lanes|=E),Zf(oe,E,g),oe=X.sibling}else oe=X.child;if(oe!==null)oe.return=X;else for(oe=X;oe!==null;){if(oe===g){oe=null;break}if(X=oe.sibling,X!==null){X.return=oe.return,oe=X;break}oe=oe.return}X=oe}he(d,g,V.children,E),g=g.child}return g;case 9:return V=g.type,R=g.pendingProps.children,bl(g,E),V=Oa(V),R=R(V),g.flags|=1,he(d,g,R,E),g.child;case 14:return R=g.type,V=Wi(R,g.pendingProps),V=Wi(R.type,V),Ge(d,g,R,V,E);case 15:return dt(d,g,g.type,g.pendingProps,E);case 17:return R=g.type,V=g.pendingProps,V=g.elementType===R?V:Wi(R,V),Mr(d,g),g.tag=1,oa(R)?(d=!0,Hu(g)):d=!1,bl(g,E),N0(g,R,V),ap(g,R,V,E),Yr(null,g,R,!0,d,E);case 19:return Ci(d,g,E);case 22:return Rt(d,g,E)}throw Error(r(156,g.tag))};function JC(d,g){return Jo(d,g)}function ID(d,g,E,R){this.tag=d,this.key=E,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=g,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=R,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Fo(d,g,E,R){return new ID(d,g,E,R)}function Eb(d){return d=d.prototype,!(!d||!d.isReactComponent)}function jD(d){if(typeof d=="function")return Eb(d)?1:0;if(d!=null){if(d=d.$$typeof,d===Z)return 11;if(d===U)return 14}return 2}function hd(d,g){var E=d.alternate;return E===null?(E=Fo(d.tag,g,d.key,d.mode),E.elementType=d.elementType,E.type=d.type,E.stateNode=d.stateNode,E.alternate=d,d.alternate=E):(E.pendingProps=g,E.type=d.type,E.flags=0,E.subtreeFlags=0,E.deletions=null),E.flags=d.flags&14680064,E.childLanes=d.childLanes,E.lanes=d.lanes,E.child=d.child,E.memoizedProps=d.memoizedProps,E.memoizedState=d.memoizedState,E.updateQueue=d.updateQueue,g=d.dependencies,E.dependencies=g===null?null:{lanes:g.lanes,firstContext:g.firstContext},E.sibling=d.sibling,E.index=d.index,E.ref=d.ref,E}function z0(d,g,E,R,V,X){var oe=2;if(R=d,typeof d=="function")Eb(d)&&(oe=1);else if(typeof d=="string")oe=5;else e:switch(d){case j:return zh(E.children,V,X,g);case O:oe=8,V|=8;break;case F:return d=Fo(12,E,g,V|2),d.elementType=F,d.lanes=X,d;case D:return d=Fo(13,E,g,V),d.elementType=D,d.lanes=X,d;case H:return d=Fo(19,E,g,V),d.elementType=H,d.lanes=X,d;case Y:return U0(E,V,X,g);default:if(typeof d=="object"&&d!==null)switch(d.$$typeof){case B:oe=10;break e;case $:oe=9;break e;case Z:oe=11;break e;case U:oe=14;break e;case W:oe=16,R=null;break e}throw Error(r(130,d==null?d:typeof d,""))}return g=Fo(oe,E,g,V),g.elementType=d,g.type=R,g.lanes=X,g}function zh(d,g,E,R){return d=Fo(7,d,R,g),d.lanes=E,d}function U0(d,g,E,R){return d=Fo(22,d,R,g),d.elementType=Y,d.lanes=E,d.stateNode={isHidden:!1},d}function Tb(d,g,E){return d=Fo(6,d,null,g),d.lanes=E,d}function Nb(d,g,E){return g=Fo(4,d.children!==null?d.children:[],d.key,g),g.lanes=E,g.stateNode={containerInfo:d.containerInfo,pendingChildren:null,implementation:d.implementation},g}function FD(d,g,E,R,V){this.tag=g,this.containerInfo=d,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Mi(0),this.expirationTimes=Mi(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Mi(0),this.identifierPrefix=R,this.onRecoverableError=V,this.mutableSourceEagerHydrationData=null}function Pb(d,g,E,R,V,X,oe,be,_e){return d=new FD(d,g,E,be,_e),g===1?(g=1,X===!0&&(g|=8)):g=0,X=Fo(3,null,null,g),d.current=X,X.stateNode=d,X.memoizedState={element:R,isDehydrated:E,cache:null,transitions:null,pendingSuspenseBoundaries:null},Rh(X),d}function BD(d,g,E){var R=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:I,key:R==null?null:""+R,children:d,containerInfo:g,implementation:E}}function eE(d){if(!d)return Mo;d=d._reactInternals;e:{if(Ln(d)!==d||d.tag!==1)throw Error(r(170));var g=d;do{switch(g.tag){case 3:g=g.stateNode.context;break e;case 1:if(oa(g.type)){g=g.stateNode.__reactInternalMemoizedMergedChildContext;break e}}g=g.return}while(g!==null);throw Error(r(171))}if(d.tag===1){var E=d.type;if(oa(E))return Gf(d,E,g)}return g}function tE(d,g,E,R,V,X,oe,be,_e){return d=Pb(E,R,!0,d,V,X,oe,be,_e),d.context=eE(null),E=d.current,R=Es(),V=cd(E),X=Oo(R,V),X.callback=g??null,Do(E,X,V),d.current.lanes=V,ps(d,V,R),Hs(d,R),d}function G0(d,g,E,R){var V=g.current,X=Es(),oe=cd(V);return E=eE(E),g.context===null?g.context=E:g.pendingContext=E,g=Oo(X,oe),g.payload={element:d},R=R===void 0?null:R,R!==null&&(g.callback=R),d=Do(V,g,oe),d!==null&&(El(d,V,oe,X),Xf(d,V,oe)),oe}function V0(d){return d=d.current,d.child?(d.child.tag===5,d.child.stateNode):null}function rE(d,g){if(d=d.memoizedState,d!==null&&d.dehydrated!==null){var E=d.retryLane;d.retryLane=E!==0&&E<g?E:g}}function Mb(d,g){rE(d,g),(d=d.alternate)&&rE(d,g)}function zD(){return null}var nE=typeof reportError=="function"?reportError:function(d){console.error(d)};function Ab(d){this._internalRoot=d}H0.prototype.render=Ab.prototype.render=function(d){var g=this._internalRoot;if(g===null)throw Error(r(409));G0(d,g,null,null)},H0.prototype.unmount=Ab.prototype.unmount=function(){var d=this._internalRoot;if(d!==null){this._internalRoot=null;var g=d.containerInfo;jh(function(){G0(null,d,null,null)}),g[Dr]=null}};function H0(d){this._internalRoot=d}H0.prototype.unstable_scheduleHydration=function(d){if(d){var g=Ec();d={blockedOn:null,target:d,priority:g};for(var E=0;E<ei.length&&g!==0&&g<ei[E].priority;E++);ei.splice(E,0,d),E===0&&Vl(d)}};function Rb(d){return!(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11)}function W0(d){return!(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11&&(d.nodeType!==8||d.nodeValue!==" react-mount-point-unstable "))}function iE(){}function UD(d,g,E,R,V){if(V){if(typeof R=="function"){var X=R;R=function(){var Ue=V0(oe);X.call(Ue)}}var oe=tE(g,R,d,0,null,!1,!1,"",iE);return d._reactRootContainer=oe,d[Dr]=oe.current,No(d.nodeType===8?d.parentNode:d),jh(),oe}for(;V=d.lastChild;)d.removeChild(V);if(typeof R=="function"){var be=R;R=function(){var Ue=V0(_e);be.call(Ue)}}var _e=Pb(d,0,!1,null,null,!1,!1,"",iE);return d._reactRootContainer=_e,d[Dr]=_e.current,No(d.nodeType===8?d.parentNode:d),jh(function(){G0(g,_e,E,R)}),_e}function q0(d,g,E,R,V){var X=E._reactRootContainer;if(X){var oe=X;if(typeof V=="function"){var be=V;V=function(){var _e=V0(oe);be.call(_e)}}G0(g,oe,d,V)}else oe=UD(E,g,d,V,R);return V0(oe)}bo=function(d){switch(d.tag){case 3:var g=d.stateNode;if(g.current.memoizedState.isDehydrated){var E=it(g.pendingLanes);E!==0&&(to(g,E|1),Hs(g,Xr()),(Ir&6)===0&&(up=Xr()+500,su()))}break;case 13:jh(function(){var R=_s(d,1);if(R!==null){var V=Es();El(R,d,1,V)}}),Mb(d,1)}},Ls=function(d){if(d.tag===13){var g=_s(d,134217728);if(g!==null){var E=Es();El(g,d,134217728,E)}Mb(d,134217728)}},Cc=function(d){if(d.tag===13){var g=cd(d),E=_s(d,g);if(E!==null){var R=Es();El(E,d,g,R)}Mb(d,g)}},Ec=function(){return wr},rl=function(d,g){var E=wr;try{return wr=d,g()}finally{wr=E}},vt=function(d,g,E){switch(g){case"input":if(rt(d,E),g=E.name,E.type==="radio"&&g!=null){for(E=d;E.parentNode;)E=E.parentNode;for(E=E.querySelectorAll("input[name="+JSON.stringify(""+g)+'][type="radio"]'),g=0;g<E.length;g++){var R=E[g];if(R!==d&&R.form===d.form){var V=oi(R);if(!V)throw Error(r(90));xe(R),rt(R,V)}}}break;case"textarea":Ke(d,E);break;case"select":g=E.value,g!=null&&Qe(d,!!E.multiple,g,!1)}},Yt=kb,Xt=jh;var GD={usingClientEntryPoint:!1,Events:[vl,Vn,oi,Kt,Ct,kb]},jm={findFiberByHostInstance:Po,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},VD={bundleType:jm.bundleType,version:jm.version,rendererPackageName:jm.rendererPackageName,rendererConfig:jm.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:N.ReactCurrentDispatcher,findHostInstanceByFiber:function(d){return d=zi(d),d===null?null:d.stateNode},findFiberByHostInstance:jm.findFiberByHostInstance||zD,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var $0=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!$0.isDisabled&&$0.supportsFiber)try{ir=$0.inject(VD),tr=$0}catch{}}return Ws.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=GD,Ws.createPortal=function(d,g){var E=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Rb(g))throw Error(r(200));return BD(d,g,null,E)},Ws.createRoot=function(d,g){if(!Rb(d))throw Error(r(299));var E=!1,R="",V=nE;return g!=null&&(g.unstable_strictMode===!0&&(E=!0),g.identifierPrefix!==void 0&&(R=g.identifierPrefix),g.onRecoverableError!==void 0&&(V=g.onRecoverableError)),g=Pb(d,1,!1,null,null,E,!1,R,V),d[Dr]=g.current,No(d.nodeType===8?d.parentNode:d),new Ab(g)},Ws.findDOMNode=function(d){if(d==null)return null;if(d.nodeType===1)return d;var g=d._reactInternals;if(g===void 0)throw typeof d.render=="function"?Error(r(188)):(d=Object.keys(d).join(","),Error(r(268,d)));return d=zi(g),d=d===null?null:d.stateNode,d},Ws.flushSync=function(d){return jh(d)},Ws.hydrate=function(d,g,E){if(!W0(g))throw Error(r(200));return q0(null,d,g,!0,E)},Ws.hydrateRoot=function(d,g,E){if(!Rb(d))throw Error(r(405));var R=E!=null&&E.hydratedSources||null,V=!1,X="",oe=nE;if(E!=null&&(E.unstable_strictMode===!0&&(V=!0),E.identifierPrefix!==void 0&&(X=E.identifierPrefix),E.onRecoverableError!==void 0&&(oe=E.onRecoverableError)),g=tE(g,null,d,1,E??null,V,!1,X,oe),d[Dr]=g.current,No(d),R)for(d=0;d<R.length;d++)E=R[d],V=E._getVersion,V=V(E._source),g.mutableSourceEagerHydrationData==null?g.mutableSourceEagerHydrationData=[E,V]:g.mutableSourceEagerHydrationData.push(E,V);return new H0(g)},Ws.render=function(d,g,E){if(!W0(g))throw Error(r(200));return q0(null,d,g,!1,E)},Ws.unmountComponentAtNode=function(d){if(!W0(d))throw Error(r(40));return d._reactRootContainer?(jh(function(){q0(null,null,d,!1,function(){d._reactRootContainer=null,d[Dr]=null})}),!0):!1},Ws.unstable_batchedUpdates=kb,Ws.unstable_renderSubtreeIntoContainer=function(d,g,E,R){if(!W0(E))throw Error(r(200));if(d==null||d._reactInternals===void 0)throw Error(r(38));return q0(d,g,E,!1,R)},Ws.version="18.3.1-next-f1338f8080-20240426",Ws}var fE;function uM(){if(fE)return Db.exports;fE=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),Db.exports=QD(),Db.exports}var pE;function JD(){if(pE)return K0;pE=1;var t=uM();return K0.createRoot=t.createRoot,K0.hydrateRoot=t.hydrateRoot,K0}var e8=JD();const t8=Tf(e8);var Il=uM();const r8=Tf(Il);function gv(){return gv=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},gv.apply(this,arguments)}var Rd;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(Rd||(Rd={}));const mE="popstate";function n8(t){t===void 0&&(t={});function e(n,i){let{pathname:a,search:s,hash:o}=n.location;return TS("",{pathname:a,search:s,hash:o},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function r(n,i){return typeof i=="string"?i:ex(i)}return a8(e,r,null,t)}function fi(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function qk(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function i8(){return Math.random().toString(36).substr(2,8)}function gE(t,e){return{usr:t.state,key:t.key,idx:e}}function TS(t,e,r,n){return r===void 0&&(r=null),gv({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof e=="string"?om(e):e,{state:r,key:e&&e.key||n||i8()})}function ex(t){let{pathname:e="/",search:r="",hash:n=""}=t;return r&&r!=="?"&&(e+=r.charAt(0)==="?"?r:"?"+r),n&&n!=="#"&&(e+=n.charAt(0)==="#"?n:"#"+n),e}function om(t){let e={};if(t){let r=t.indexOf("#");r>=0&&(e.hash=t.substr(r),t=t.substr(0,r));let n=t.indexOf("?");n>=0&&(e.search=t.substr(n),t=t.substr(0,n)),t&&(e.pathname=t)}return e}function a8(t,e,r,n){n===void 0&&(n={});let{window:i=document.defaultView,v5Compat:a=!1}=n,s=i.history,o=Rd.Pop,l=null,u=c();u==null&&(u=0,s.replaceState(gv({},s.state,{idx:u}),""));function c(){return(s.state||{idx:null}).idx}function h(){o=Rd.Pop;let w=c(),T=w==null?null:w-u;u=w,l&&l({action:o,location:S.location,delta:T})}function p(w,T){o=Rd.Push;let _=TS(S.location,w,T);u=c()+1;let C=gE(_,u),N=S.createHref(_);try{s.pushState(C,"",N)}catch(A){if(A instanceof DOMException&&A.name==="DataCloneError")throw A;i.location.assign(N)}a&&l&&l({action:o,location:S.location,delta:1})}function v(w,T){o=Rd.Replace;let _=TS(S.location,w,T);u=c();let C=gE(_,u),N=S.createHref(_);s.replaceState(C,"",N),a&&l&&l({action:o,location:S.location,delta:0})}function y(w){let T=i.location.origin!=="null"?i.location.origin:i.location.href,_=typeof w=="string"?w:ex(w);return _=_.replace(/ $/,"%20"),fi(T,"No window.location.(origin|href) available to create URL for href: "+_),new URL(_,T)}let S={get action(){return o},get location(){return t(i,s)},listen(w){if(l)throw new Error("A history only accepts one active listener");return i.addEventListener(mE,h),l=w,()=>{i.removeEventListener(mE,h),l=null}},createHref(w){return e(i,w)},createURL:y,encodeLocation(w){let T=y(w);return{pathname:T.pathname,search:T.search,hash:T.hash}},push:p,replace:v,go(w){return s.go(w)}};return S}var vE;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(vE||(vE={}));function s8(t,e,r){return r===void 0&&(r="/"),o8(t,e,r)}function o8(t,e,r,n){let i=typeof e=="string"?om(e):e,a=Hp(i.pathname||"/",r);if(a==null)return null;let s=cM(t);l8(s);let o=null;for(let l=0;o==null&&l<s.length;++l){let u=x8(a);o=v8(s[l],u)}return o}function cM(t,e,r,n){e===void 0&&(e=[]),r===void 0&&(r=[]),n===void 0&&(n="");let i=(a,s,o)=>{let l={relativePath:o===void 0?a.path||"":o,caseSensitive:a.caseSensitive===!0,childrenIndex:s,route:a};l.relativePath.startsWith("/")&&(fi(l.relativePath.startsWith(n),'Absolute route path "'+l.relativePath+'" nested under path '+('"'+n+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),l.relativePath=l.relativePath.slice(n.length));let u=zd([n,l.relativePath]),c=r.concat(l);a.children&&a.children.length>0&&(fi(a.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+u+'".')),cM(a.children,e,c,u)),!(a.path==null&&!a.index)&&e.push({path:u,score:m8(u,a.index),routesMeta:c})};return t.forEach((a,s)=>{var o;if(a.path===""||!((o=a.path)!=null&&o.includes("?")))i(a,s);else for(let l of dM(a.path))i(a,s,l)}),e}function dM(t){let e=t.split("/");if(e.length===0)return[];let[r,...n]=e,i=r.endsWith("?"),a=r.replace(/\?$/,"");if(n.length===0)return i?[a,""]:[a];let s=dM(n.join("/")),o=[];return o.push(...s.map(l=>l===""?a:[a,l].join("/"))),i&&o.push(...s),o.map(l=>t.startsWith("/")&&l===""?"/":l)}function l8(t){t.sort((e,r)=>e.score!==r.score?r.score-e.score:g8(e.routesMeta.map(n=>n.childrenIndex),r.routesMeta.map(n=>n.childrenIndex)))}const u8=/^:[\w-]+$/,c8=3,d8=2,h8=1,f8=10,p8=-2,yE=t=>t==="*";function m8(t,e){let r=t.split("/"),n=r.length;return r.some(yE)&&(n+=p8),e&&(n+=d8),r.filter(i=>!yE(i)).reduce((i,a)=>i+(u8.test(a)?c8:a===""?h8:f8),n)}function g8(t,e){return t.length===e.length&&t.slice(0,-1).every((n,i)=>n===e[i])?t[t.length-1]-e[e.length-1]:0}function v8(t,e,r){let{routesMeta:n}=t,i={},a="/",s=[];for(let o=0;o<n.length;++o){let l=n[o],u=o===n.length-1,c=a==="/"?e:e.slice(a.length)||"/",h=NS({path:l.relativePath,caseSensitive:l.caseSensitive,end:u},c),p=l.route;if(!h)return null;Object.assign(i,h.params),s.push({params:i,pathname:zd([a,h.pathname]),pathnameBase:_8(zd([a,h.pathnameBase])),route:p}),h.pathnameBase!=="/"&&(a=zd([a,h.pathnameBase]))}return s}function NS(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[r,n]=y8(t.path,t.caseSensitive,t.end),i=e.match(r);if(!i)return null;let a=i[0],s=a.replace(/(.)\/+$/,"$1"),o=i.slice(1);return{params:n.reduce((u,c,h)=>{let{paramName:p,isOptional:v}=c;if(p==="*"){let S=o[h]||"";s=a.slice(0,a.length-S.length).replace(/(.)\/+$/,"$1")}const y=o[h];return v&&!y?u[p]=void 0:u[p]=(y||"").replace(/%2F/g,"/"),u},{}),pathname:a,pathnameBase:s,pattern:t}}function y8(t,e,r){e===void 0&&(e=!1),r===void 0&&(r=!0),qk(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let n=[],i="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(s,o,l)=>(n.push({paramName:o,isOptional:l!=null}),l?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(n.push({paramName:"*"}),i+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):r?i+="\\/*$":t!==""&&t!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,e?void 0:"i"),n]}function x8(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return qk(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),t}}function Hp(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let r=e.endsWith("/")?e.length-1:e.length,n=t.charAt(r);return n&&n!=="/"?null:t.slice(r)||"/"}const b8=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,w8=t=>b8.test(t);function S8(t,e){e===void 0&&(e="/");let{pathname:r,search:n="",hash:i=""}=typeof t=="string"?om(t):t,a;if(r)if(w8(r))a=r;else{if(r.includes("//")){let s=r;r=r.replace(/\/\/+/g,"/"),qk(!1,"Pathnames cannot have embedded double slashes - normalizing "+(s+" -> "+r))}r.startsWith("/")?a=xE(r.substring(1),"/"):a=xE(r,e)}else a=e;return{pathname:a,search:C8(n),hash:E8(i)}}function xE(t,e){let r=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(i=>{i===".."?r.length>1&&r.pop():i!=="."&&r.push(i)}),r.length>1?r.join("/"):"/"}function Fb(t,e,r,n){return"Cannot include a '"+t+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(n)+"].  Please separate it out to the ")+("`to."+r+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function k8(t){return t.filter((e,r)=>r===0||e.route.path&&e.route.path.length>0)}function hM(t,e){let r=k8(t);return e?r.map((n,i)=>i===r.length-1?n.pathname:n.pathnameBase):r.map(n=>n.pathnameBase)}function fM(t,e,r,n){n===void 0&&(n=!1);let i;typeof t=="string"?i=om(t):(i=gv({},t),fi(!i.pathname||!i.pathname.includes("?"),Fb("?","pathname","search",i)),fi(!i.pathname||!i.pathname.includes("#"),Fb("#","pathname","hash",i)),fi(!i.search||!i.search.includes("#"),Fb("#","search","hash",i)));let a=t===""||i.pathname==="",s=a?"/":i.pathname,o;if(s==null)o=r;else{let h=e.length-1;if(!n&&s.startsWith("..")){let p=s.split("/");for(;p[0]==="..";)p.shift(),h-=1;i.pathname=p.join("/")}o=h>=0?e[h]:"/"}let l=S8(i,o),u=s&&s!=="/"&&s.endsWith("/"),c=(a||s===".")&&r.endsWith("/");return!l.pathname.endsWith("/")&&(u||c)&&(l.pathname+="/"),l}const zd=t=>t.join("/").replace(/\/\/+/g,"/"),_8=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),C8=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,E8=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function T8(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}const pM=["post","put","patch","delete"];new Set(pM);const N8=["get",...pM];new Set(N8);function vv(){return vv=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},vv.apply(this,arguments)}const v1=ie.createContext(null),mM=ie.createContext(null),ih=ie.createContext(null),y1=ie.createContext(null),xc=ie.createContext({outlet:null,matches:[],isDataRoute:!1}),gM=ie.createContext(null);function P8(t,e){let{relative:r}=e===void 0?{}:e;Wv()||fi(!1);let{basename:n,navigator:i}=ie.useContext(ih),{hash:a,pathname:s,search:o}=x1(t,{relative:r}),l=s;return n!=="/"&&(l=s==="/"?n:zd([n,s])),i.createHref({pathname:l,search:o,hash:a})}function Wv(){return ie.useContext(y1)!=null}function Nf(){return Wv()||fi(!1),ie.useContext(y1).location}function vM(t){ie.useContext(ih).static||ie.useLayoutEffect(t)}function Wa(){let{isDataRoute:t}=ie.useContext(xc);return t?V8():M8()}function M8(){Wv()||fi(!1);let t=ie.useContext(v1),{basename:e,future:r,navigator:n}=ie.useContext(ih),{matches:i}=ie.useContext(xc),{pathname:a}=Nf(),s=JSON.stringify(hM(i,r.v7_relativeSplatPath)),o=ie.useRef(!1);return vM(()=>{o.current=!0}),ie.useCallback(function(u,c){if(c===void 0&&(c={}),!o.current)return;if(typeof u=="number"){n.go(u);return}let h=fM(u,JSON.parse(s),a,c.relative==="path");t==null&&e!=="/"&&(h.pathname=h.pathname==="/"?e:zd([e,h.pathname])),(c.replace?n.replace:n.push)(h,c.state,c)},[e,n,s,a,t])}const yM=ie.createContext(null);function jl(){return ie.useContext(yM)}function A8(t){let e=ie.useContext(xc).outlet;return e&&ie.createElement(yM.Provider,{value:t},e)}function Zi(){let{matches:t}=ie.useContext(xc),e=t[t.length-1];return e?e.params:{}}function x1(t,e){let{relative:r}=e===void 0?{}:e,{future:n}=ie.useContext(ih),{matches:i}=ie.useContext(xc),{pathname:a}=Nf(),s=JSON.stringify(hM(i,n.v7_relativeSplatPath));return ie.useMemo(()=>fM(t,JSON.parse(s),a,r==="path"),[t,s,a,r])}function R8(t,e){return L8(t,e)}function L8(t,e,r,n){Wv()||fi(!1);let{navigator:i}=ie.useContext(ih),{matches:a}=ie.useContext(xc),s=a[a.length-1],o=s?s.params:{};s&&s.pathname;let l=s?s.pathnameBase:"/";s&&s.route;let u=Nf(),c;if(e){var h;let w=typeof e=="string"?om(e):e;l==="/"||(h=w.pathname)!=null&&h.startsWith(l)||fi(!1),c=w}else c=u;let p=c.pathname||"/",v=p;if(l!=="/"){let w=l.replace(/^\//,"").split("/");v="/"+p.replace(/^\//,"").split("/").slice(w.length).join("/")}let y=s8(t,{pathname:v}),S=F8(y&&y.map(w=>Object.assign({},w,{params:Object.assign({},o,w.params),pathname:zd([l,i.encodeLocation?i.encodeLocation(w.pathname).pathname:w.pathname]),pathnameBase:w.pathnameBase==="/"?l:zd([l,i.encodeLocation?i.encodeLocation(w.pathnameBase).pathname:w.pathnameBase])})),a,r,n);return e&&S?ie.createElement(y1.Provider,{value:{location:vv({pathname:"/",search:"",hash:"",state:null,key:"default"},c),navigationType:Rd.Pop}},S):S}function O8(){let t=G8(),e=T8(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),r=t instanceof Error?t.stack:null,i={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return ie.createElement(ie.Fragment,null,ie.createElement("h2",null,"Unexpected Application Error!"),ie.createElement("h3",{style:{fontStyle:"italic"}},e),r?ie.createElement("pre",{style:i},r):null,null)}const D8=ie.createElement(O8,null);class I8 extends ie.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,r){return r.location!==e.location||r.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:r.error,location:r.location,revalidation:e.revalidation||r.revalidation}}componentDidCatch(e,r){console.error("React Router caught the following error during render",e,r)}render(){return this.state.error!==void 0?ie.createElement(xc.Provider,{value:this.props.routeContext},ie.createElement(gM.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function j8(t){let{routeContext:e,match:r,children:n}=t,i=ie.useContext(v1);return i&&i.static&&i.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=r.route.id),ie.createElement(xc.Provider,{value:e},n)}function F8(t,e,r,n){var i;if(e===void 0&&(e=[]),r===void 0&&(r=null),n===void 0&&(n=null),t==null){var a;if(!r)return null;if(r.errors)t=r.matches;else if((a=n)!=null&&a.v7_partialHydration&&e.length===0&&!r.initialized&&r.matches.length>0)t=r.matches;else return null}let s=t,o=(i=r)==null?void 0:i.errors;if(o!=null){let c=s.findIndex(h=>h.route.id&&o?.[h.route.id]!==void 0);c>=0||fi(!1),s=s.slice(0,Math.min(s.length,c+1))}let l=!1,u=-1;if(r&&n&&n.v7_partialHydration)for(let c=0;c<s.length;c++){let h=s[c];if((h.route.HydrateFallback||h.route.hydrateFallbackElement)&&(u=c),h.route.id){let{loaderData:p,errors:v}=r,y=h.route.loader&&p[h.route.id]===void 0&&(!v||v[h.route.id]===void 0);if(h.route.lazy||y){l=!0,u>=0?s=s.slice(0,u+1):s=[s[0]];break}}}return s.reduceRight((c,h,p)=>{let v,y=!1,S=null,w=null;r&&(v=o&&h.route.id?o[h.route.id]:void 0,S=h.route.errorElement||D8,l&&(u<0&&p===0?(H8("route-fallback"),y=!0,w=null):u===p&&(y=!0,w=h.route.hydrateFallbackElement||null)));let T=e.concat(s.slice(0,p+1)),_=()=>{let C;return v?C=S:y?C=w:h.route.Component?C=ie.createElement(h.route.Component,null):h.route.element?C=h.route.element:C=c,ie.createElement(j8,{match:h,routeContext:{outlet:c,matches:T,isDataRoute:r!=null},children:C})};return r&&(h.route.ErrorBoundary||h.route.errorElement||p===0)?ie.createElement(I8,{location:r.location,revalidation:r.revalidation,component:S,error:v,children:_(),routeContext:{outlet:null,matches:T,isDataRoute:!0}}):_()},null)}var xM=(function(t){return t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t})(xM||{}),bM=(function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t})(bM||{});function B8(t){let e=ie.useContext(v1);return e||fi(!1),e}function z8(t){let e=ie.useContext(mM);return e||fi(!1),e}function U8(t){let e=ie.useContext(xc);return e||fi(!1),e}function wM(t){let e=U8(),r=e.matches[e.matches.length-1];return r.route.id||fi(!1),r.route.id}function G8(){var t;let e=ie.useContext(gM),r=z8(),n=wM();return e!==void 0?e:(t=r.errors)==null?void 0:t[n]}function V8(){let{router:t}=B8(xM.UseNavigateStable),e=wM(bM.UseNavigateStable),r=ie.useRef(!1);return vM(()=>{r.current=!0}),ie.useCallback(function(i,a){a===void 0&&(a={}),r.current&&(typeof i=="number"?t.navigate(i):t.navigate(i,vv({fromRouteId:e},a)))},[t,e])}const bE={};function H8(t,e,r){bE[t]||(bE[t]=!0)}function W8(t,e){t?.v7_startTransition,t?.v7_relativeSplatPath}function $k(t){return A8(t.context)}function qn(t){fi(!1)}function q8(t){let{basename:e="/",children:r=null,location:n,navigationType:i=Rd.Pop,navigator:a,static:s=!1,future:o}=t;Wv()&&fi(!1);let l=e.replace(/^\/*/,"/"),u=ie.useMemo(()=>({basename:l,navigator:a,static:s,future:vv({v7_relativeSplatPath:!1},o)}),[l,o,a,s]);typeof n=="string"&&(n=om(n));let{pathname:c="/",search:h="",hash:p="",state:v=null,key:y="default"}=n,S=ie.useMemo(()=>{let w=Hp(c,l);return w==null?null:{location:{pathname:w,search:h,hash:p,state:v,key:y},navigationType:i}},[l,c,h,p,v,y,i]);return S==null?null:ie.createElement(ih.Provider,{value:u},ie.createElement(y1.Provider,{children:r,value:S}))}function $8(t){let{children:e,location:r}=t;return R8(PS(e),r)}new Promise(()=>{});function PS(t,e){e===void 0&&(e=[]);let r=[];return ie.Children.forEach(t,(n,i)=>{if(!ie.isValidElement(n))return;let a=[...e,i];if(n.type===ie.Fragment){r.push.apply(r,PS(n.props.children,a));return}n.type!==qn&&fi(!1),!n.props.index||!n.props.children||fi(!1);let s={id:n.props.id||a.join("-"),caseSensitive:n.props.caseSensitive,element:n.props.element,Component:n.props.Component,index:n.props.index,path:n.props.path,loader:n.props.loader,action:n.props.action,errorElement:n.props.errorElement,ErrorBoundary:n.props.ErrorBoundary,hasErrorBoundary:n.props.ErrorBoundary!=null||n.props.errorElement!=null,shouldRevalidate:n.props.shouldRevalidate,handle:n.props.handle,lazy:n.props.lazy};n.props.children&&(s.children=PS(n.props.children,a)),r.push(s)}),r}function tx(){return tx=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},tx.apply(this,arguments)}function SM(t,e){if(t==null)return{};var r={},n=Object.keys(t),i,a;for(a=0;a<n.length;a++)i=n[a],!(e.indexOf(i)>=0)&&(r[i]=t[i]);return r}function K8(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function Z8(t,e){return t.button===0&&(!e||e==="_self")&&!K8(t)}const Y8=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],X8=["aria-current","caseSensitive","className","end","style","to","viewTransition","children"],Q8="6";try{window.__reactRouterVersion=Q8}catch{}const J8=ie.createContext({isTransitioning:!1}),eI="startTransition",wE=YD[eI];function tI(t){let{basename:e,children:r,future:n,window:i}=t,a=ie.useRef();a.current==null&&(a.current=n8({window:i,v5Compat:!0}));let s=a.current,[o,l]=ie.useState({action:s.action,location:s.location}),{v7_startTransition:u}=n||{},c=ie.useCallback(h=>{u&&wE?wE(()=>l(h)):l(h)},[l,u]);return ie.useLayoutEffect(()=>s.listen(c),[s,c]),ie.useEffect(()=>W8(n),[n]),ie.createElement(q8,{basename:e,children:r,location:o.location,navigationType:o.action,navigator:s,future:n})}const rI=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",nI=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,ff=ie.forwardRef(function(e,r){let{onClick:n,relative:i,reloadDocument:a,replace:s,state:o,target:l,to:u,preventScrollReset:c,viewTransition:h}=e,p=SM(e,Y8),{basename:v}=ie.useContext(ih),y,S=!1;if(typeof u=="string"&&nI.test(u)&&(y=u,rI))try{let C=new URL(window.location.href),N=u.startsWith("//")?new URL(C.protocol+u):new URL(u),A=Hp(N.pathname,v);N.origin===C.origin&&A!=null?u=A+N.search+N.hash:S=!0}catch{}let w=P8(u,{relative:i}),T=sI(u,{replace:s,state:o,target:l,preventScrollReset:c,relative:i,viewTransition:h});function _(C){n&&n(C),C.defaultPrevented||T(C)}return ie.createElement("a",tx({},p,{href:y||w,onClick:S||a?n:_,ref:r,target:l}))}),iI=ie.forwardRef(function(e,r){let{"aria-current":n="page",caseSensitive:i=!1,className:a="",end:s=!1,style:o,to:l,viewTransition:u,children:c}=e,h=SM(e,X8),p=x1(l,{relative:h.relative}),v=Nf(),y=ie.useContext(mM),{navigator:S,basename:w}=ie.useContext(ih),T=y!=null&&oI(p)&&u===!0,_=S.encodeLocation?S.encodeLocation(p).pathname:p.pathname,C=v.pathname,N=y&&y.navigation&&y.navigation.location?y.navigation.location.pathname:null;i||(C=C.toLowerCase(),N=N?N.toLowerCase():null,_=_.toLowerCase()),N&&w&&(N=Hp(N,w)||N);const A=_!=="/"&&_.endsWith("/")?_.length-1:_.length;let I=C===_||!s&&C.startsWith(_)&&C.charAt(A)==="/",j=N!=null&&(N===_||!s&&N.startsWith(_)&&N.charAt(_.length)==="/"),O={isActive:I,isPending:j,isTransitioning:T},F=I?n:void 0,B;typeof a=="function"?B=a(O):B=[a,I?"active":null,j?"pending":null,T?"transitioning":null].filter(Boolean).join(" ");let $=typeof o=="function"?o(O):o;return ie.createElement(ff,tx({},h,{"aria-current":F,className:B,ref:r,style:$,to:l,viewTransition:u}),typeof c=="function"?c(O):c)});var MS;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher",t.useViewTransitionState="useViewTransitionState"})(MS||(MS={}));var SE;(function(t){t.UseFetcher="useFetcher",t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(SE||(SE={}));function aI(t){let e=ie.useContext(v1);return e||fi(!1),e}function sI(t,e){let{target:r,replace:n,state:i,preventScrollReset:a,relative:s,viewTransition:o}=e===void 0?{}:e,l=Wa(),u=Nf(),c=x1(t,{relative:s});return ie.useCallback(h=>{if(Z8(h,r)){h.preventDefault();let p=n!==void 0?n:ex(u)===ex(c);l(t,{replace:p,state:i,preventScrollReset:a,relative:s,viewTransition:o})}},[u,l,c,n,i,r,t,a,s,o])}function oI(t,e){e===void 0&&(e={});let r=ie.useContext(J8);r==null&&fi(!1);let{basename:n}=aI(MS.useViewTransitionState),i=x1(t,{relative:e.relative});if(!r.isTransitioning)return!1;let a=Hp(r.currentLocation.pathname,n)||r.currentLocation.pathname,s=Hp(r.nextLocation.pathname,n)||r.nextLocation.pathname;return NS(i.pathname,s)!=null||NS(i.pathname,a)!=null}const Kk="-",lI=t=>{const e=cI(t),{conflictingClassGroups:r,conflictingClassGroupModifiers:n}=t;return{getClassGroupId:s=>{const o=s.split(Kk);return o[0]===""&&o.length!==1&&o.shift(),kM(o,e)||uI(s)},getConflictingClassGroupIds:(s,o)=>{const l=r[s]||[];return o&&n[s]?[...l,...n[s]]:l}}},kM=(t,e)=>{if(t.length===0)return e.classGroupId;const r=t[0],n=e.nextPart.get(r),i=n?kM(t.slice(1),n):void 0;if(i)return i;if(e.validators.length===0)return;const a=t.join(Kk);return e.validators.find(({validator:s})=>s(a))?.classGroupId},kE=/^\[(.+)\]$/,uI=t=>{if(kE.test(t)){const e=kE.exec(t)[1],r=e?.substring(0,e.indexOf(":"));if(r)return"arbitrary.."+r}},cI=t=>{const{theme:e,prefix:r}=t,n={nextPart:new Map,validators:[]};return hI(Object.entries(t.classGroups),r).forEach(([a,s])=>{AS(s,n,a,e)}),n},AS=(t,e,r,n)=>{t.forEach(i=>{if(typeof i=="string"){const a=i===""?e:_E(e,i);a.classGroupId=r;return}if(typeof i=="function"){if(dI(i)){AS(i(n),e,r,n);return}e.validators.push({validator:i,classGroupId:r});return}Object.entries(i).forEach(([a,s])=>{AS(s,_E(e,a),r,n)})})},_E=(t,e)=>{let r=t;return e.split(Kk).forEach(n=>{r.nextPart.has(n)||r.nextPart.set(n,{nextPart:new Map,validators:[]}),r=r.nextPart.get(n)}),r},dI=t=>t.isThemeGetter,hI=(t,e)=>e?t.map(([r,n])=>{const i=n.map(a=>typeof a=="string"?e+a:typeof a=="object"?Object.fromEntries(Object.entries(a).map(([s,o])=>[e+s,o])):a);return[r,i]}):t,fI=t=>{if(t<1)return{get:()=>{},set:()=>{}};let e=0,r=new Map,n=new Map;const i=(a,s)=>{r.set(a,s),e++,e>t&&(e=0,n=r,r=new Map)};return{get(a){let s=r.get(a);if(s!==void 0)return s;if((s=n.get(a))!==void 0)return i(a,s),s},set(a,s){r.has(a)?r.set(a,s):i(a,s)}}},_M="!",pI=t=>{const{separator:e,experimentalParseClassName:r}=t,n=e.length===1,i=e[0],a=e.length,s=o=>{const l=[];let u=0,c=0,h;for(let w=0;w<o.length;w++){let T=o[w];if(u===0){if(T===i&&(n||o.slice(w,w+a)===e)){l.push(o.slice(c,w)),c=w+a;continue}if(T==="/"){h=w;continue}}T==="["?u++:T==="]"&&u--}const p=l.length===0?o:o.substring(c),v=p.startsWith(_M),y=v?p.substring(1):p,S=h&&h>c?h-c:void 0;return{modifiers:l,hasImportantModifier:v,baseClassName:y,maybePostfixModifierPosition:S}};return r?o=>r({className:o,parseClassName:s}):s},mI=t=>{if(t.length<=1)return t;const e=[];let r=[];return t.forEach(n=>{n[0]==="["?(e.push(...r.sort(),n),r=[]):r.push(n)}),e.push(...r.sort()),e},gI=t=>({cache:fI(t.cacheSize),parseClassName:pI(t),...lI(t)}),vI=/\s+/,yI=(t,e)=>{const{parseClassName:r,getClassGroupId:n,getConflictingClassGroupIds:i}=e,a=[],s=t.trim().split(vI);let o="";for(let l=s.length-1;l>=0;l-=1){const u=s[l],{modifiers:c,hasImportantModifier:h,baseClassName:p,maybePostfixModifierPosition:v}=r(u);let y=!!v,S=n(y?p.substring(0,v):p);if(!S){if(!y){o=u+(o.length>0?" "+o:o);continue}if(S=n(p),!S){o=u+(o.length>0?" "+o:o);continue}y=!1}const w=mI(c).join(":"),T=h?w+_M:w,_=T+S;if(a.includes(_))continue;a.push(_);const C=i(S,y);for(let N=0;N<C.length;++N){const A=C[N];a.push(T+A)}o=u+(o.length>0?" "+o:o)}return o};function xI(){let t=0,e,r,n="";for(;t<arguments.length;)(e=arguments[t++])&&(r=CM(e))&&(n&&(n+=" "),n+=r);return n}const CM=t=>{if(typeof t=="string")return t;let e,r="";for(let n=0;n<t.length;n++)t[n]&&(e=CM(t[n]))&&(r&&(r+=" "),r+=e);return r};function bI(t,...e){let r,n,i,a=s;function s(l){const u=e.reduce((c,h)=>h(c),t());return r=gI(u),n=r.cache.get,i=r.cache.set,a=o,o(l)}function o(l){const u=n(l);if(u)return u;const c=yI(l,r);return i(l,c),c}return function(){return a(xI.apply(null,arguments))}}const Pn=t=>{const e=r=>r[t]||[];return e.isThemeGetter=!0,e},EM=/^\[(?:([a-z-]+):)?(.+)\]$/i,wI=/^\d+\/\d+$/,SI=new Set(["px","full","screen"]),kI=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,_I=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,CI=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,EI=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,TI=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,ec=t=>Ip(t)||SI.has(t)||wI.test(t),pd=t=>lm(t,"length",DI),Ip=t=>!!t&&!Number.isNaN(Number(t)),Bb=t=>lm(t,"number",Ip),Bm=t=>!!t&&Number.isInteger(Number(t)),NI=t=>t.endsWith("%")&&Ip(t.slice(0,-1)),xr=t=>EM.test(t),md=t=>kI.test(t),PI=new Set(["length","size","percentage"]),MI=t=>lm(t,PI,TM),AI=t=>lm(t,"position",TM),RI=new Set(["image","url"]),LI=t=>lm(t,RI,jI),OI=t=>lm(t,"",II),zm=()=>!0,lm=(t,e,r)=>{const n=EM.exec(t);return n?n[1]?typeof e=="string"?n[1]===e:e.has(n[1]):r(n[2]):!1},DI=t=>_I.test(t)&&!CI.test(t),TM=()=>!1,II=t=>EI.test(t),jI=t=>TI.test(t),FI=()=>{const t=Pn("colors"),e=Pn("spacing"),r=Pn("blur"),n=Pn("brightness"),i=Pn("borderColor"),a=Pn("borderRadius"),s=Pn("borderSpacing"),o=Pn("borderWidth"),l=Pn("contrast"),u=Pn("grayscale"),c=Pn("hueRotate"),h=Pn("invert"),p=Pn("gap"),v=Pn("gradientColorStops"),y=Pn("gradientColorStopPositions"),S=Pn("inset"),w=Pn("margin"),T=Pn("opacity"),_=Pn("padding"),C=Pn("saturate"),N=Pn("scale"),A=Pn("sepia"),I=Pn("skew"),j=Pn("space"),O=Pn("translate"),F=()=>["auto","contain","none"],B=()=>["auto","hidden","clip","visible","scroll"],$=()=>["auto",xr,e],Z=()=>[xr,e],D=()=>["",ec,pd],H=()=>["auto",Ip,xr],U=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],W=()=>["solid","dashed","dotted","double","none"],Y=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],Q=()=>["start","end","center","between","around","evenly","stretch"],ne=()=>["","0",xr],re=()=>["auto","avoid","all","avoid-page","page","left","right","column"],q=()=>[Ip,xr];return{cacheSize:500,separator:":",theme:{colors:[zm],spacing:[ec,pd],blur:["none","",md,xr],brightness:q(),borderColor:[t],borderRadius:["none","","full",md,xr],borderSpacing:Z(),borderWidth:D(),contrast:q(),grayscale:ne(),hueRotate:q(),invert:ne(),gap:Z(),gradientColorStops:[t],gradientColorStopPositions:[NI,pd],inset:$(),margin:$(),opacity:q(),padding:Z(),saturate:q(),scale:q(),sepia:ne(),skew:q(),space:Z(),translate:Z()},classGroups:{aspect:[{aspect:["auto","square","video",xr]}],container:["container"],columns:[{columns:[md]}],"break-after":[{"break-after":re()}],"break-before":[{"break-before":re()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...U(),xr]}],overflow:[{overflow:B()}],"overflow-x":[{"overflow-x":B()}],"overflow-y":[{"overflow-y":B()}],overscroll:[{overscroll:F()}],"overscroll-x":[{"overscroll-x":F()}],"overscroll-y":[{"overscroll-y":F()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[S]}],"inset-x":[{"inset-x":[S]}],"inset-y":[{"inset-y":[S]}],start:[{start:[S]}],end:[{end:[S]}],top:[{top:[S]}],right:[{right:[S]}],bottom:[{bottom:[S]}],left:[{left:[S]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",Bm,xr]}],basis:[{basis:$()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",xr]}],grow:[{grow:ne()}],shrink:[{shrink:ne()}],order:[{order:["first","last","none",Bm,xr]}],"grid-cols":[{"grid-cols":[zm]}],"col-start-end":[{col:["auto",{span:["full",Bm,xr]},xr]}],"col-start":[{"col-start":H()}],"col-end":[{"col-end":H()}],"grid-rows":[{"grid-rows":[zm]}],"row-start-end":[{row:["auto",{span:[Bm,xr]},xr]}],"row-start":[{"row-start":H()}],"row-end":[{"row-end":H()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",xr]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",xr]}],gap:[{gap:[p]}],"gap-x":[{"gap-x":[p]}],"gap-y":[{"gap-y":[p]}],"justify-content":[{justify:["normal",...Q()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...Q(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...Q(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[_]}],px:[{px:[_]}],py:[{py:[_]}],ps:[{ps:[_]}],pe:[{pe:[_]}],pt:[{pt:[_]}],pr:[{pr:[_]}],pb:[{pb:[_]}],pl:[{pl:[_]}],m:[{m:[w]}],mx:[{mx:[w]}],my:[{my:[w]}],ms:[{ms:[w]}],me:[{me:[w]}],mt:[{mt:[w]}],mr:[{mr:[w]}],mb:[{mb:[w]}],ml:[{ml:[w]}],"space-x":[{"space-x":[j]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[j]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",xr,e]}],"min-w":[{"min-w":[xr,e,"min","max","fit"]}],"max-w":[{"max-w":[xr,e,"none","full","min","max","fit","prose",{screen:[md]},md]}],h:[{h:[xr,e,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[xr,e,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[xr,e,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[xr,e,"auto","min","max","fit"]}],"font-size":[{text:["base",md,pd]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",Bb]}],"font-family":[{font:[zm]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",xr]}],"line-clamp":[{"line-clamp":["none",Ip,Bb]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",ec,xr]}],"list-image":[{"list-image":["none",xr]}],"list-style-type":[{list:["none","disc","decimal",xr]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[t]}],"placeholder-opacity":[{"placeholder-opacity":[T]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[t]}],"text-opacity":[{"text-opacity":[T]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...W(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",ec,pd]}],"underline-offset":[{"underline-offset":["auto",ec,xr]}],"text-decoration-color":[{decoration:[t]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:Z()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",xr]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",xr]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[T]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...U(),AI]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",MI]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},LI]}],"bg-color":[{bg:[t]}],"gradient-from-pos":[{from:[y]}],"gradient-via-pos":[{via:[y]}],"gradient-to-pos":[{to:[y]}],"gradient-from":[{from:[v]}],"gradient-via":[{via:[v]}],"gradient-to":[{to:[v]}],rounded:[{rounded:[a]}],"rounded-s":[{"rounded-s":[a]}],"rounded-e":[{"rounded-e":[a]}],"rounded-t":[{"rounded-t":[a]}],"rounded-r":[{"rounded-r":[a]}],"rounded-b":[{"rounded-b":[a]}],"rounded-l":[{"rounded-l":[a]}],"rounded-ss":[{"rounded-ss":[a]}],"rounded-se":[{"rounded-se":[a]}],"rounded-ee":[{"rounded-ee":[a]}],"rounded-es":[{"rounded-es":[a]}],"rounded-tl":[{"rounded-tl":[a]}],"rounded-tr":[{"rounded-tr":[a]}],"rounded-br":[{"rounded-br":[a]}],"rounded-bl":[{"rounded-bl":[a]}],"border-w":[{border:[o]}],"border-w-x":[{"border-x":[o]}],"border-w-y":[{"border-y":[o]}],"border-w-s":[{"border-s":[o]}],"border-w-e":[{"border-e":[o]}],"border-w-t":[{"border-t":[o]}],"border-w-r":[{"border-r":[o]}],"border-w-b":[{"border-b":[o]}],"border-w-l":[{"border-l":[o]}],"border-opacity":[{"border-opacity":[T]}],"border-style":[{border:[...W(),"hidden"]}],"divide-x":[{"divide-x":[o]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[o]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[T]}],"divide-style":[{divide:W()}],"border-color":[{border:[i]}],"border-color-x":[{"border-x":[i]}],"border-color-y":[{"border-y":[i]}],"border-color-s":[{"border-s":[i]}],"border-color-e":[{"border-e":[i]}],"border-color-t":[{"border-t":[i]}],"border-color-r":[{"border-r":[i]}],"border-color-b":[{"border-b":[i]}],"border-color-l":[{"border-l":[i]}],"divide-color":[{divide:[i]}],"outline-style":[{outline:["",...W()]}],"outline-offset":[{"outline-offset":[ec,xr]}],"outline-w":[{outline:[ec,pd]}],"outline-color":[{outline:[t]}],"ring-w":[{ring:D()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[t]}],"ring-opacity":[{"ring-opacity":[T]}],"ring-offset-w":[{"ring-offset":[ec,pd]}],"ring-offset-color":[{"ring-offset":[t]}],shadow:[{shadow:["","inner","none",md,OI]}],"shadow-color":[{shadow:[zm]}],opacity:[{opacity:[T]}],"mix-blend":[{"mix-blend":[...Y(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":Y()}],filter:[{filter:["","none"]}],blur:[{blur:[r]}],brightness:[{brightness:[n]}],contrast:[{contrast:[l]}],"drop-shadow":[{"drop-shadow":["","none",md,xr]}],grayscale:[{grayscale:[u]}],"hue-rotate":[{"hue-rotate":[c]}],invert:[{invert:[h]}],saturate:[{saturate:[C]}],sepia:[{sepia:[A]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[r]}],"backdrop-brightness":[{"backdrop-brightness":[n]}],"backdrop-contrast":[{"backdrop-contrast":[l]}],"backdrop-grayscale":[{"backdrop-grayscale":[u]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[c]}],"backdrop-invert":[{"backdrop-invert":[h]}],"backdrop-opacity":[{"backdrop-opacity":[T]}],"backdrop-saturate":[{"backdrop-saturate":[C]}],"backdrop-sepia":[{"backdrop-sepia":[A]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[s]}],"border-spacing-x":[{"border-spacing-x":[s]}],"border-spacing-y":[{"border-spacing-y":[s]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",xr]}],duration:[{duration:q()}],ease:[{ease:["linear","in","out","in-out",xr]}],delay:[{delay:q()}],animate:[{animate:["none","spin","ping","pulse","bounce",xr]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[N]}],"scale-x":[{"scale-x":[N]}],"scale-y":[{"scale-y":[N]}],rotate:[{rotate:[Bm,xr]}],"translate-x":[{"translate-x":[O]}],"translate-y":[{"translate-y":[O]}],"skew-x":[{"skew-x":[I]}],"skew-y":[{"skew-y":[I]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",xr]}],accent:[{accent:["auto",t]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",xr]}],"caret-color":[{caret:[t]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":Z()}],"scroll-mx":[{"scroll-mx":Z()}],"scroll-my":[{"scroll-my":Z()}],"scroll-ms":[{"scroll-ms":Z()}],"scroll-me":[{"scroll-me":Z()}],"scroll-mt":[{"scroll-mt":Z()}],"scroll-mr":[{"scroll-mr":Z()}],"scroll-mb":[{"scroll-mb":Z()}],"scroll-ml":[{"scroll-ml":Z()}],"scroll-p":[{"scroll-p":Z()}],"scroll-px":[{"scroll-px":Z()}],"scroll-py":[{"scroll-py":Z()}],"scroll-ps":[{"scroll-ps":Z()}],"scroll-pe":[{"scroll-pe":Z()}],"scroll-pt":[{"scroll-pt":Z()}],"scroll-pr":[{"scroll-pr":Z()}],"scroll-pb":[{"scroll-pb":Z()}],"scroll-pl":[{"scroll-pl":Z()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",xr]}],fill:[{fill:[t,"none"]}],"stroke-w":[{stroke:[ec,pd,Bb]}],stroke:[{stroke:[t,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},Zk=bI(FI),An=({children:t,className:e,...r})=>m.jsx("div",{className:Zk("bg-glass backdrop-blur-xl border border-glass-border rounded-xl",e),...r,children:t}),rx=({url:t,name:e,alt:r="User",size:n="md",className:i})=>{const a={sm:"size-8 text-xs",md:"size-10 text-sm",lg:"size-16 text-lg",xl:"size-32 text-2xl"},s=e?e.charAt(0).toUpperCase():r?r.charAt(0).toUpperCase():"?";return m.jsx("div",{className:Zk("rounded-full bg-surface-light border border-white/10 flex items-center justify-center overflow-hidden shrink-0 text-slate-400 font-bold select-none",a[n],i),children:t?m.jsx("img",{src:t,alt:e||r,className:"w-full h-full object-cover"}):m.jsx("span",{children:s})})},BI=()=>m.jsx("div",{className:"flex h-screen w-full overflow-hidden bg-background-dark relative",children:m.jsx("main",{className:"flex-1 min-w-0 relative overflow-hidden flex flex-col",children:m.jsx($k,{})})}),zI="/api",et={async request(t,e={}){const r=`${zI}${t}`,i={...e.body instanceof FormData?{}:{"Content-Type":"application/json"},...e.headers},a=await fetch(r,{...e,headers:i,credentials:"include"});if(!a.ok){const s=await a.json().catch(()=>({}));throw new Error(s.error||`HTTP error! status: ${a.status}`)}return a.status===204||a.headers.get("content-length")==="0"?null:a.json()},get(t,e={}){return this.request(t,{method:"GET",headers:e})},post(t,e,r={}){return this.request(t,{method:"POST",body:e instanceof FormData?e:JSON.stringify(e),headers:r})},put(t,e,r={}){return this.request(t,{method:"PUT",body:e instanceof FormData?e:JSON.stringify(e),headers:r})},patch(t,e,r={}){return this.request(t,{method:"PATCH",body:e instanceof FormData?e:JSON.stringify(e),headers:r})},delete(t,e={}){return this.request(t,{method:"DELETE",headers:e})}},Uh={list:()=>et.get("/workspaces"),create:(t,e,r,n)=>et.post("/workspaces",{name:t,title:e,genre:r,imageUrl:n}),delete:t=>et.delete("/workspaces/"+t),update:(t,e)=>et.put("/workspaces/"+t,e),select:t=>et.post("/workspaces/select",{projectName:t}),restartBackend:()=>et.post("/system/restart",{}),healthCheck:()=>et.get("/system/health")},UI=["FANTASA","SCI-FI","HORROR","LORE","MISTERIO","HISTRICO","CYBERPUNK","STEAMPUNK"],GI=({isOpen:t,onClose:e,onCreate:r})=>{if(!t)return null;const[n,i]=ie.useState(!1),[a,s]=ie.useState({name:"",title:"",genre:"FANTASA",imageUrl:"https://images.unsplash.com/photo-1518709268805-4e9042af9f23?auto=format&fit=crop&q=80&w=800"}),o=u=>{const{name:c,value:h}=u.target;s(p=>({...p,[c]:h}))},l=u=>{u.preventDefault();let c=a.name;if(!c&&a.title&&(c=a.title.toLowerCase().replace(/[^a-z0-9]/g,"-")),!c){alert("Project ID/Name is required");return}r({...a,name:c}),e(),s({name:"",title:"",genre:"FANTASA",imageUrl:"https://images.unsplash.com/photo-1518709268805-4e9042af9f23?auto=format&fit=crop&q=80&w=800"})};return Il.createPortal(m.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[m.jsx("div",{className:"absolute inset-0 bg-black/80 backdrop-blur-sm animate-in fade-in duration-200",onClick:e}),m.jsxs("div",{className:"relative w-full max-w-2xl bg-[#0a0a0c] border border-white/10 rounded-3xl shadow-2xl overflow-hidden flex animate-in zoom-in-95 duration-200",children:[m.jsxs("div",{className:"w-1/3 bg-black relative hidden sm:block",children:[m.jsx("img",{src:a.imageUrl,onError:()=>i(!0),className:`absolute inset-0 w-full h-full object-cover opacity-60 transition-opacity duration-500 ${n?"hidden":""}`,alt:"Preview"}),m.jsxs("div",{className:"absolute inset-x-0 bottom-0 p-6 bg-gradient-to-t from-black to-transparent",children:[m.jsx("h4",{className:"text-white font-black text-xl leading-none",children:a.title||"Untitled"}),m.jsx("span",{className:"text-[10px] font-bold text-primary uppercase tracking-widest mt-2 block",children:a.genre})]})]}),m.jsxs("div",{className:"flex-1 p-8",children:[m.jsx("h2",{className:"text-2xl font-black text-white mb-6",children:"Nuevo Cuaderno"}),m.jsxs("form",{onSubmit:l,className:"space-y-5",children:[m.jsxs("div",{className:"space-y-1.5",children:[m.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-text-muted",children:"Ttulo del Proyecto"}),m.jsx("input",{type:"text",name:"title",value:a.title,onChange:o,placeholder:"e.g. Las Crnicas de Etheria",className:"w-full bg-[#13141f] border border-white/10 rounded-xl px-4 py-3 text-white text-sm focus:border-primary/50 focus:ring-1 focus:ring-primary/50 outline-none transition-all",autoFocus:!0})]}),m.jsxs("div",{className:"space-y-1.5",children:[m.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-text-muted",children:"ID de Archivo (Slug)"}),m.jsx("input",{type:"text",name:"name",value:a.name,onChange:o,placeholder:"e.g. etheria-v1",className:"w-full bg-[#13141f] border border-white/10 rounded-xl px-4 py-3 text-white font-mono text-xs focus:border-primary/50 focus:ring-1 focus:ring-primary/50 outline-none transition-all placeholder:text-white/10"}),m.jsx("p",{className:"text-[10px] text-white/20",children:"Se usar como nombre del archivo .db"})]}),m.jsxs("div",{className:"space-y-1.5",children:[m.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-text-muted",children:"Gnero"}),m.jsx("div",{className:"grid grid-cols-2 gap-2",children:UI.slice(0,4).map(u=>m.jsx("button",{type:"button",onClick:()=>s(c=>({...c,genre:u})),className:`px-3 py-2 rounded-lg text-[10px] font-bold border transition-all ${a.genre===u?"bg-primary text-white border-primary":"bg-[#13141f] border-white/10 text-text-muted hover:border-white/20"}`,children:u},u))})]}),m.jsxs("div",{className:"space-y-1.5",children:[m.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-text-muted",children:"Imagen de Portada (URL)"}),m.jsx("input",{type:"text",name:"imageUrl",value:a.imageUrl,onChange:u=>{s(c=>({...c,imageUrl:u.target.value})),i(!1)},className:"w-full bg-[#13141f] border border-white/10 rounded-xl px-4 py-3 text-white text-xs focus:border-primary/50 focus:ring-1 focus:ring-primary/50 outline-none transition-all truncate"})]}),m.jsxs("div",{className:"pt-4 flex gap-3",children:[m.jsx("button",{type:"button",onClick:e,className:"flex-1 px-4 py-3 bg-[#13141f] hover:bg-white/5 border border-white/10 rounded-xl text-xs font-bold text-text-muted transition-all",children:"Cancelar"}),m.jsxs("button",{type:"submit",className:"flex-1 px-4 py-3 bg-primary hover:bg-primary-light text-white rounded-xl text-xs font-bold transition-all shadow-lg shadow-primary/20 flex items-center justify-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"rocket_launch"}),"Crear Universo"]})]})]})]})]})]}),document.body)},VI=["FANTASA","SCI-FI","HORROR","LORE","MISTERIO","HISTRICO","CYBERPUNK","STEAMPUNK"],HI=({isOpen:t,onClose:e,onUpdate:r,project:n})=>{if(!t||!n)return null;const[i,a]=ie.useState(!1),[s,o]=ie.useState({name:n,title:n,genre:"FANTASA",imageUrl:"https://images.unsplash.com/photo-1518709268805-4e9042af9f23?auto=format&fit=crop&q=80&w=800"});ie.useEffect(()=>{n&&o(u=>({...u,name:n,title:n}))},[n]);const l=u=>{u.preventDefault(),r(s.name,{title:s.title,genre:s.genre,imageUrl:s.imageUrl}),e()};return Il.createPortal(m.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[m.jsx("div",{className:"absolute inset-0 bg-black/80 backdrop-blur-sm animate-in fade-in duration-200",onClick:e}),m.jsxs("div",{className:"relative w-full max-w-2xl bg-[#0a0a0c] border border-white/10 rounded-3xl shadow-2xl overflow-hidden flex animate-in zoom-in-95 duration-200",children:[m.jsxs("div",{className:"w-1/3 bg-black relative hidden sm:block",children:[m.jsx("img",{src:s.imageUrl,onError:()=>a(!0),className:`absolute inset-0 w-full h-full object-cover opacity-60 transition-opacity duration-500 ${i?"hidden":""}`,alt:"Preview"}),m.jsxs("div",{className:"absolute inset-x-0 bottom-0 p-6 bg-gradient-to-t from-black to-transparent",children:[m.jsx("h4",{className:"text-white font-black text-xl leading-none",children:s.title||"Untitled"}),m.jsx("span",{className:"text-[10px] font-bold text-primary uppercase tracking-widest mt-2 block",children:s.genre})]})]}),m.jsxs("div",{className:"flex-1 p-8",children:[m.jsx("h2",{className:"text-2xl font-black text-white mb-6",children:"Editar Cuaderno"}),m.jsxs("form",{onSubmit:l,className:"space-y-5",children:[m.jsxs("div",{className:"space-y-1.5",children:[m.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-text-muted",children:"Ttulo del Proyecto"}),m.jsx("input",{type:"text",name:"title",value:s.title,onChange:u=>o(c=>({...c,title:u.target.value})),className:"w-full bg-[#13141f] border border-white/10 rounded-xl px-4 py-3 text-white text-sm focus:border-primary/50 focus:ring-1 focus:ring-primary/50 outline-none transition-all",autoFocus:!0})]}),m.jsxs("div",{className:"space-y-1.5 opacity-50",children:[m.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-text-muted",children:"ID de Archivo (Inmutable)"}),m.jsx("input",{type:"text",value:s.name,readOnly:!0,className:"w-full bg-[#0a0a0c] border border-white/5 rounded-xl px-4 py-3 text-white/50 font-mono text-xs outline-none cursor-not-allowed"})]}),m.jsxs("div",{className:"space-y-1.5",children:[m.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-text-muted",children:"Gnero"}),m.jsx("div",{className:"grid grid-cols-2 gap-2",children:VI.slice(0,4).map(u=>m.jsx("button",{type:"button",onClick:()=>o(c=>({...c,genre:u})),className:`px-3 py-2 rounded-lg text-[10px] font-bold border transition-all ${s.genre===u?"bg-primary text-white border-primary":"bg-[#13141f] border-white/10 text-text-muted hover:border-white/20"}`,children:u},u))})]}),m.jsxs("div",{className:"space-y-1.5",children:[m.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-text-muted",children:"Imagen de Portada (URL)"}),m.jsx("input",{type:"text",value:s.imageUrl,onChange:u=>{o(c=>({...c,imageUrl:u.target.value})),a(!1)},className:"w-full bg-[#13141f] border border-white/10 rounded-xl px-4 py-3 text-white text-xs focus:border-primary/50 focus:ring-1 focus:ring-primary/50 outline-none transition-all truncate"})]}),m.jsxs("div",{className:"pt-4 flex gap-3",children:[m.jsx("button",{type:"button",onClick:e,className:"flex-1 px-4 py-3 bg-[#13141f] hover:bg-white/5 border border-white/10 rounded-xl text-xs font-bold text-text-muted transition-all",children:"Cancelar"}),m.jsxs("button",{type:"submit",className:"flex-1 px-4 py-3 bg-primary hover:bg-primary-light text-white rounded-xl text-xs font-bold transition-all shadow-lg shadow-primary/20 flex items-center justify-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"save"}),"Guardar Cambios"]})]})]})]})]})]}),document.body)},Yn=ie.forwardRef(({children:t,variant:e="primary",size:r="md",className:n,icon:i,isLoading:a,...s},o)=>{const l="inline-flex items-center justify-center rounded-lg font-medium transition-all focus:outline-none disabled:opacity-50 disabled:cursor-not-allowed active:scale-95",u={primary:"bg-primary text-white shadow-lg shadow-primary/25 hover:bg-primary-light hover:shadow-primary/40 border border-transparent",secondary:"bg-surface-light text-slate-200 border border-white/10 hover:bg-white/5 hover:text-white hover:border-white/20",ghost:"bg-transparent text-slate-400 hover:text-white hover:bg-white/5",danger:"bg-red-500/10 text-red-500 border border-red-500/20 hover:bg-red-500/20 hover:border-red-500/50 hover:shadow-lg hover:shadow-red-500/10",outline:"bg-transparent border border-primary/50 text-primary hover:bg-primary/10"},c={xs:"px-2.5 py-1 text-xs gap-1.5",sm:"px-3 py-1.5 text-xs gap-1.5",md:"px-4 py-2 text-sm gap-2",lg:"px-6 py-3 text-base gap-3",icon:"size-9 p-0"};return m.jsxs("button",{ref:o,className:Zk(l,u[e],c[r],n),disabled:a,...s,children:[a?m.jsx("span",{className:"material-symbols-outlined animate-spin text-[18px]",children:"progress_activity"}):i?m.jsx("span",{className:"material-symbols-outlined text-[18px]",children:i}):null,t]})});Yn.displayName="Button";const NM=({isOpen:t,onClose:e,onConfirm:r,title:n,message:i,confirmText:a="Confirm",cancelText:s="Cancel",isDestructive:o=!0})=>t?m.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[m.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm animate-in fade-in duration-300",onClick:e}),m.jsx("div",{className:"relative z-10 w-full max-w-md animate-in zoom-in-95 duration-300",children:m.jsxs(An,{className:"p-6 border-red-500/20 shadow-2xl shadow-black/50",children:[m.jsxs("div",{className:"flex items-start gap-4 mb-6",children:[m.jsx("div",{className:`
                            size-12 rounded-xl flex items-center justify-center shrink-0
                            ${o?"bg-red-500/10 text-red-500":"bg-primary/10 text-primary"}
                        `,children:m.jsx("span",{className:"material-symbols-outlined text-2xl",children:o?"warning":"help"})}),m.jsxs("div",{children:[m.jsx("h3",{className:"text-lg font-black text-white mb-2 leading-tight",children:n}),m.jsx("p",{className:"text-sm text-slate-400 leading-relaxed",children:i})]})]}),m.jsxs("div",{className:"flex items-center justify-end gap-3",children:[m.jsx(Yn,{variant:"ghost",onClick:e,children:s}),m.jsx(Yn,{variant:o?"danger":"primary",onClick:()=>{r(),e()},icon:o?"delete":"check",children:a})]})]})})]}):null,WI=()=>{const t=Wa(),[e,r]=ie.useState([]),[n,i]=ie.useState(!0),[a,s]=ie.useState(null),[o,l]=ie.useState(""),[u,c]=ie.useState(!1),[h,p]=ie.useState(null),[v,y]=ie.useState(null),[S,w]=ie.useState(!1),[T,_]=ie.useState(0),[C,N]=ie.useState("idle");ie.useEffect(()=>{A()},[]);const A=async()=>{try{i(!0);const D=await Uh.list();r(D)}catch(D){console.error("Failed to load workspaces",D),s("Error al cargar cuadernos. Est el servidor encendido?")}finally{i(!1)}},I=async D=>{try{i(!0);const H=await Uh.select(D);H.success&&H.redirect&&(localStorage.setItem("user",JSON.stringify({username:"local",success:!0})),t(H.redirect))}catch(H){s(H.message||"Fallo al entrar al cuaderno"),i(!1)}},j=async D=>{try{i(!0),(await Uh.create(D.name,D.title,D.genre,D.imageUrl)).success&&await I(D.name)}catch{s("Error al crear cuaderno"),i(!1)}},O=async()=>{if(h)try{i(!0),await Uh.delete(h),await A(),p(null)}catch{s("Error al borrar el cuaderno"),i(!1)}},F=async(D,H)=>{try{i(!0),await Uh.update(D,H),await A(),y(null)}catch{s("Error al actualizar cuaderno"),i(!1)}},B=()=>{window.location.href="/api/backup/download"},$=async()=>{w(!0),N("restarting"),_(10);try{await Uh.restartBackend(),_(30),await new Promise(W=>setTimeout(W,2e3)),_(50),N("checking");let D=0;const H=30,U=async()=>{try{await Uh.healthCheck(),_(100),N("complete"),setTimeout(()=>{w(!1),N("idle"),_(0),A()},1500)}catch{D++,D>=H?(N("error"),_(0)):(_(50+D/H*50),setTimeout(U,1e3))}};U()}catch{N("error"),_(0)}},Z=e.filter(D=>(D.title||D.filename||"").toLowerCase().includes(o.toLowerCase()));return m.jsxs("div",{className:"h-screen w-full bg-[#0a0b14] text-white flex flex-col items-center font-sans selection:bg-indigo-500/30 overflow-hidden",children:[m.jsxs("div",{className:"w-full max-w-6xl flex-1 flex flex-col overflow-y-auto custom-scrollbar p-8",children:[m.jsxs("header",{className:"w-full mt-24 mb-12 flex flex-col lg:flex-row lg:items-end justify-between gap-8 flex-shrink-0",children:[m.jsx("div",{className:"space-y-4",children:m.jsx("div",{className:"flex items-center gap-4",children:m.jsxs("h1",{className:"text-6xl font-black tracking-tighter leading-none",children:[m.jsx("span",{className:"block text-indigo-400",children:"Mis"}),m.jsx("span",{className:"block text-white",children:"Cuadernos"})]})})}),m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsxs("button",{onClick:()=>t("/settings"),className:"flex items-center gap-2 px-5 py-3 bg-white/5 hover:bg-white/10 border border-white/10 rounded-2xl transition-all text-xs font-bold text-slate-400 hover:text-white group",title:"Configuracin Global",children:[m.jsx("span",{className:"material-symbols-outlined text-lg group-hover:rotate-90 transition-transform duration-500",children:"settings"}),m.jsx("span",{className:"hidden sm:inline",children:"Ajustes"})]}),m.jsxs("button",{onClick:B,className:"flex items-center gap-2 px-5 py-3 bg-white/5 hover:bg-white/10 border border-white/10 rounded-2xl transition-all text-xs font-bold text-slate-400 hover:text-white group",title:"Descargar copia de seguridad de todos los universos",children:[m.jsx("span",{className:"material-symbols-outlined text-lg group-hover:scale-110 transition-transform",children:"cloud_download"}),m.jsx("span",{className:"hidden sm:inline",children:"Backup Global"})]}),m.jsxs("button",{onClick:$,className:"flex items-center gap-2 px-5 py-3 bg-orange-500/10 hover:bg-orange-500/20 border border-orange-500/20 rounded-2xl transition-all text-xs font-bold text-orange-400 hover:text-orange-300 group",title:"Reiniciar servidor backend (til tras migraciones)",children:[m.jsx("span",{className:"material-symbols-outlined text-lg group-hover:rotate-180 transition-transform duration-500",children:"refresh"}),m.jsx("span",{className:"hidden sm:inline",children:"Reiniciar Backend"})]}),m.jsxs("div",{className:"relative group min-w-[300px]",children:[m.jsx("span",{className:"material-symbols-outlined absolute left-4 top-1/2 -translate-y-1/2 text-white/20 text-xl group-focus-within:text-indigo-400 transition-colors pointer-events-none",children:"search"}),m.jsx("input",{type:"text",placeholder:"Buscar...",value:o,onChange:D=>l(D.target.value),className:"w-full bg-[#13141f] border border-white/5 rounded-2xl py-3 pl-12 pr-4 text-sm text-white focus:outline-none focus:border-indigo-500/50 transition-all placeholder:text-white/10"})]})]})]}),m.jsx("section",{className:"w-full max-w-6xl",children:n?m.jsxs("div",{className:"flex flex-col items-center gap-6 py-20 opacity-20",children:[m.jsx("div",{className:"w-12 h-12 border-4 border-indigo-500 border-t-transparent rounded-full animate-spin"}),m.jsx("p",{className:"text-[10px] font-black uppercase tracking-[0.3em]",children:"Accediendo al Sector Local..."})]}):m.jsxs("div",{className:"flex flex-wrap gap-6 justify-start pb-20",children:[m.jsxs("div",{onClick:()=>c(!0),className:"group relative h-[380px] rounded-[2.5rem] border-2 border-dashed border-white/5 flex flex-col items-center justify-center gap-6 hover:bg-white/5 hover:border-indigo-500/30 transition-all cursor-pointer overflow-hidden animate-in fade-in duration-700 w-full md:w-[calc(50%-0.75rem)] lg:w-[calc(33.333%-1rem)]",children:[m.jsx("div",{className:"w-20 h-20 rounded-full bg-[#13141f] border border-white/5 flex items-center justify-center text-4xl text-white/20 group-hover:scale-110 group-hover:text-indigo-400 transition-all",children:m.jsx("span",{className:"material-symbols-outlined text-4xl",children:"add"})}),m.jsxs("div",{className:"text-center",children:[m.jsx("h3",{className:"text-xl font-black tracking-tight text-white/50 group-hover:text-white transition-colors",children:"Nuevo Cuaderno"}),m.jsx("p",{className:"text-[10px] font-bold text-white/20 uppercase tracking-widest mt-2 group-hover:text-white/40",children:"Inicia un nuevo universo"})]})]}),Z.map(D=>{const H=D.imageUrl||"https://images.unsplash.com/photo-1451187580459-43490279c0fa?auto=format&fit=crop&q=80&w=800";return m.jsxs("div",{onClick:()=>I(D.filename),className:"group relative h-[380px] rounded-[2.5rem] bg-[#13141f] border border-white/5 overflow-hidden transition-all hover:-translate-y-2 hover:shadow-2xl hover:shadow-indigo-500/10 cursor-pointer animate-in fade-in slide-in-from-bottom-4 w-full md:w-[calc(50%-0.75rem)] lg:w-[calc(33.333%-1rem)]",children:[m.jsxs("div",{className:"absolute inset-x-0 top-0 h-2/3",children:[m.jsx("img",{src:H,className:"w-full h-full object-cover opacity-40 group-hover:opacity-60 transition-opacity",alt:""}),m.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-[#13141f] via-transparent to-transparent"})]}),m.jsxs("div",{className:"absolute top-6 right-6 flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity duration-300 z-20",children:[m.jsx("button",{onClick:U=>{U.stopPropagation(),y(D.filename)},className:"w-10 h-10 rounded-full bg-black/50 backdrop-blur-md border border-white/10 flex items-center justify-center text-white/70 hover:text-white hover:bg-indigo-500 hover:border-indigo-400 transition-all",title:"Editar",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"edit"})}),m.jsx("button",{onClick:U=>{U.stopPropagation(),p(D.filename)},className:"w-10 h-10 rounded-full bg-black/50 backdrop-blur-md border border-white/10 flex items-center justify-center text-white/70 hover:text-white hover:bg-red-500 hover:border-red-400 transition-all",title:"Eliminar",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})})]}),m.jsx("div",{className:"absolute inset-0 flex flex-col justify-end p-8",children:m.jsxs("div",{className:"mt-auto space-y-3",children:[m.jsx("span",{className:"inline-block px-3 py-1 bg-red-500/20 border border-red-500/30 text-[9px] font-black text-red-100 rounded-lg tracking-widest uppercase",children:D.tag}),m.jsx("h3",{className:"text-3xl font-black text-white tracking-tighter leading-tight group-hover:text-indigo-400 transition-colors",children:D.title}),D.title!==D.filename&&m.jsx("p",{className:"text-[10px] text-white/30 font-mono mb-1",children:D.filename}),m.jsx("p",{className:"text-xs text-white/40 line-clamp-2 leading-relaxed",children:"Una tierra dividida por la magia y la tecnologa antigua..."}),m.jsxs("div",{className:"flex items-center justify-between pt-6 border-t border-white/5 mt-4",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-emerald-500 shadow-[0_0_8px_rgba(16,185,129,0.5)]"}),m.jsxs("span",{className:"text-[9px] font-black uppercase tracking-widest text-white/20",children:["ltima edicin: ",m.jsx("span",{className:"text-white/40",children:D.lastModified})]})]}),m.jsx("div",{className:"w-8 h-8 rounded-full bg-white/5 border border-white/10 flex items-center justify-center text-[10px] font-black text-indigo-300",children:D.initials})]})]})})]},D.filename)})]})})]}),a&&m.jsx("div",{className:"fixed bottom-8 left-1/2 -translate-x-1/2 px-6 py-3 bg-red-500/20 border border-red-500/30 text-red-200 rounded-2xl text-xs font-bold shadow-2xl animate-bounce",children:a}),m.jsx(GI,{isOpen:u,onClose:()=>c(!1),onCreate:j}),m.jsx(HI,{isOpen:!!v,onClose:()=>y(null),project:v,onUpdate:F}),m.jsx(NM,{isOpen:!!h,onClose:()=>p(null),onConfirm:O,title:"Eliminar Proyecto?",message:`Ests a punto de borrar "${h}" y todo su contenido permanentemente. Esta accin no se puede deshacer.`,confirmText:"Eliminar Universo",isDestructive:!0}),S&&m.jsx("div",{className:"fixed inset-0 z-[200] flex items-center justify-center p-6 bg-black/80 backdrop-blur-sm animate-in fade-in duration-300",children:m.jsxs("div",{className:"w-full max-w-md bg-[#0A0A0F] border border-orange-500/20 rounded-[2.5rem] overflow-hidden shadow-2xl shadow-orange-500/10 animate-in zoom-in-95 duration-500",children:[m.jsx("div",{className:"p-8 border-b border-white/5 bg-gradient-to-r from-orange-500/10 to-transparent",children:m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("div",{className:"w-12 h-12 rounded-full bg-orange-500/20 border border-orange-500/30 flex items-center justify-center",children:m.jsx("span",{className:"material-symbols-outlined text-2xl text-orange-400 animate-spin",children:"refresh"})}),m.jsxs("div",{children:[m.jsx("h2",{className:"text-xl font-black text-white",children:"Reiniciando Backend"}),m.jsxs("p",{className:"text-[10px] text-slate-500 font-bold uppercase tracking-widest",children:[C==="restarting"&&"Deteniendo servidor...",C==="checking"&&"Esperando reconexin...",C==="complete"&&"Reinicio completado!",C==="error"&&"Error en el reinicio"]})]})]})}),m.jsxs("div",{className:"p-8 space-y-6",children:[m.jsxs("div",{className:"space-y-2",children:[m.jsxs("div",{className:"flex justify-between text-xs",children:[m.jsx("span",{className:"text-slate-500 font-bold",children:"Progreso"}),m.jsxs("span",{className:"text-orange-400 font-black",children:[Math.round(T),"%"]})]}),m.jsx("div",{className:"h-2 bg-white/5 rounded-full overflow-hidden",children:m.jsx("div",{className:"h-full bg-gradient-to-r from-orange-500 to-orange-400 transition-all duration-500 ease-out",style:{width:`${T}%`}})})]}),m.jsxs("div",{className:"space-y-2 text-xs text-slate-400",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("div",{className:`w-2 h-2 rounded-full ${T>=30?"bg-green-500":"bg-slate-700"}`}),m.jsx("span",{children:"Seal de reinicio enviada"})]}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("div",{className:`w-2 h-2 rounded-full ${T>=50?"bg-green-500":"bg-slate-700"}`}),m.jsx("span",{children:"Servidor detenido"})]}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("div",{className:`w-2 h-2 rounded-full ${T>=100?"bg-green-500":T>50?"bg-orange-500 animate-pulse":"bg-slate-700"}`}),m.jsx("span",{children:"Servidor iniciado y listo"})]})]}),C==="error"&&m.jsxs("div",{className:"p-4 bg-red-500/10 border border-red-500/20 rounded-xl text-xs text-red-400",children:[m.jsx("p",{className:"font-bold",children:"Error: El servidor no respondi despus de 30 segundos."}),m.jsx("p",{className:"mt-2 text-red-300/70",children:"Por favor, reinicia manualmente desde la terminal."})]})]}),C==="complete"&&m.jsxs("div",{className:"p-6 bg-green-500/10 border-t border-green-500/20 flex items-center justify-center gap-2 text-green-400 text-sm font-bold",children:[m.jsx("span",{className:"material-symbols-outlined",children:"check_circle"}),m.jsx("span",{children:"Backend reiniciado correctamente"})]}),C==="error"&&m.jsx("div",{className:"p-6 border-t border-white/5 flex justify-end",children:m.jsx("button",{onClick:()=>{w(!1),N("idle"),_(0)},className:"px-6 py-3 rounded-2xl bg-white/5 hover:bg-white/10 text-white text-xs font-bold transition-all",children:"Cerrar"})})]})})]})},qI={save:"Guardar",saved:"Guardado",saving:"Guardando...",cancel:"Cancelar",delete:"Borrar",edit:"Editar",create:"Crear",back:"Volver",loading:"Cargando...",search:"Buscar...",no_results:"Sin resultados",confirm_delete:"Eliminar",are_you_sure:"Ests seguro de que quieres eliminar este elemento? Esta accin no se puede deshacer.",architect:"Arquitecto",confirm_delete_btn:"S, borrar",view_all:"Ver todos",rename:"Renombrar",error_delete:"Error al eliminar el elemento"},$I={dashboard:"Panel de Control",bible:"Biblia del Mundo",atlas:"Atlas",writing:"Escritura",settings:"Ajustes",logout:"Salir al Hub",chronology:"Cronologa",graph:"Grafo",languages:"Lingstica"},KI={title:"Ajustes",general:"General",appearance:"Apariencia",language:"Idioma",theme:"Tema",font:"Tipografa",font_size:"Tamao del Texto",unauthorized:"No autorizado",sync:"Sincronizacin",backup:"Respaldo",edit_template:"Editar Plantilla",available_templates:"Plantillas Disponibles",no_templates:"Sin Plantillas",is_global:"Es Global?",name:"Nombre",type:"Tipo"},ZI={title:"Escritura",library:"Biblioteca del Arquitecto",library_desc:"Gestiona tus Archivadores y Crnicas",new_notebook:"Nuevo Archivador",new_page:"Nueva Hoja",index:"ndice",notes:"Notas",format:"Formato",empty:"Pgina vaca...",active_notebook:"Archivador Activo",open_archivador:"Abrir Archivador",book_title:"Ttulo del Libro",placeholder_title:"Las Crnicas del Vaco...",create_and_open:"Crear y Abrir",expansion:"Expansin de la Biblioteca",delete_confirm:"Seguro que quieres borrar este archivador? Se perdern todas sus hojas."},YI={grid_system:"Sistema de Rejilla",size:"Tamao",canvas_data:"Datos del Lienzo",width:"Ancho (px)",height:"Alto (px)",background_image:"Imagen de Fondo",upload_image:"Subir Nueva Imagen",remove_image:"Eliminar Imagen",explorer:"Explorador de Mundo",not_found:"Imagen del Mapa no Encontrada",upload_desc:"Sube una imagen del mapa en el editor para comenzar",fullscreen:"Pantalla Completa",share:"Compartir",inhabitants:"Habitantes Clave",related_events:"Eventos Relacionados",open_bible:"Abrir en la Biblia",place:"Lugar",capital:"Capital",new_map:"Nuevo Mapa"},XI={explore:"Explorar",explorer:"Explorador",templates:"Plantillas",drag_attributes:"Arrastrar Atributos",search_entity:"Buscar entidad...",filter_type:"Filtrar por Tipo",all:"Todos",entities:"Entidades",maps:"Mapas",timelines:"Lneas de Tiempo",new_folder:"Nueva Carpeta",new_timeline:"Nueva Lnea de Tiempo",delete_folder:"Borrar Carpeta",delete_folder_msg:"Seguro que quieres borrar esta carpeta y todo su contenido?",delete_entity:"Borrar Entidad",delete_entity_msg:"Seguro que quieres borrar esta entidad de la Biblia?",no_favorites:"Sin favoritos an",favorites:"Favoritos",root_index:"ndice Raz",central_archive:"Archivo central de todas las entidades, cronologas y registros geogrficos del mundo.",empty_archive:"Archivo Vaco",empty_archive_desc:"Comienza creando tu primera carpeta o lnea de tiempo para organizar el conocimiento."},QI={title:"Lnea de Tiempo",add_event:"Aadir Evento",add_line:"Nueva Lnea de Tiempo",edit_event:"Editar Evento",edit_line:"Editar Lnea de Tiempo",delete_event:"Eliminar Evento",delete_line:"Eliminar Lnea de Tiempo",events_tab:"Eventos",annexes_tab:"Anexos",linked_timelines:"Lneas de Tiempo Vinculadas",available_timelines:"Lneas de Tiempo Disponibles",multiverse:"Multiverso",new_universe:"Nuevo Universo",universe_settings:"Ajustes del Universo",delete_universe_confirm:"Eliminar este universo y TODAS sus lneas de tiempo? Esta accin no se puede deshacer.",select_timeline:"Seleccionar Lnea",no_events:"Sin eventos an. Usa el panel derecho para aadir uno.",event_name:"Nombre del Evento",date_label:"Etiqueta de Fecha",order:"Orden (Sorteo)",description:"Descripcin",save_changes:"Guardar Cambios",create_event:"Crear Evento",delete_event_btn:"Eliminar Evento",annexed_desc:"Vincula otras lneas de tiempo localizadas a esta para verificar la consistencia cronolgica.",no_linked:"Sin lneas vinculadas.",available_to_link:"Disponibles para Vincular",no_available:"No hay otras lneas disponibles.",universe_name:"Nombre del Universo",universe_desc:"Contexto para este universo...",add_timeline_here:"Aadir Lnea de Tiempo aqu",no_timelines:"No hay lneas aqu"},JI={title:"Lingstica",lexicon:"Lxico",grammar:"Reglas de Gramtica",writing_system:"Sistema de Escritura",phonology:"Fonologa",translator:"Traductor",new_word:"Aadir Nueva Palabra",new_rule:"Definir Nueva Regla",open_editor:"Abrir Editor",auto_saved:"Auto-guardado",desc:"Una lengua perteneciente a {{projectName}}. Gestiona su lxico, reglas gramaticales y sistemas de escritura aqu.",stats:{words:"Palabras",rules:"Reglas",glyphs:"Glifos"},search_lexicon:"Buscar palabra o significado...",manage:"Gestionar",moon_script:"Escritura Lunar",inventory:"Inventario de Vocales",vectors:"Smbolos Vectoriales",upload_svg:"Subir SVG",live_stream:"Flujo Logogrfico en Vivo",rendered_output:"Salida Renderizada",source_text:"Texto de origen aqu..."},ej={dashboard_desc:"Panel de Control del Proyecto",welcome:"Bienvenido,",welcome_desc:"Tu mundo est esperando ser esculpido. Utiliza el Codex para documentar entidades, el Atlas para trazar geografas o las Crnicas para escribir su historia.",codex_title:"Codex",codex_desc:"Biblia del Mundo y Base de Datos de Entidades",atlas_title:"Atlas",atlas_desc:"Cartografa y Geografa Interactiva",chronicles_title:"Crnicas",chronicles_desc:"Escritura Narrativa y Gestin de Cuadernos",graph_title:"Grafo",graph_desc:"Visualizacin de Conexiones y Relaciones",timeline_title:"Cronologa",timeline_desc:"Lneas de Tiempo y Eventos Histricos",linguistics_title:"Lingstica",linguistics_desc:"Creacin de Lenguas y Glifos",explore_tool:"Explorar Herramienta"},tj={common:qI,nav:$I,settings:KI,writing:ZI,atlas:YI,bible:XI,timeline:QI,linguistics:JI,project:ej},rj={save:"Save",saved:"Saved",saving:"Saving...",cancel:"Cancel",delete:"Delete",edit:"Edit",create:"Create",back:"Back",loading:"Loading...",search:"Search...",no_results:"No results",confirm_delete:"Delete",are_you_sure:"Are you sure you want to delete this item? This action cannot be undone.",architect:"Architect",confirm_delete_btn:"Yes, delete",view_all:"View All",rename:"Rename",error_delete:"Error deleting item"},nj={dashboard:"Dashboard",bible:"World Bible",atlas:"Atlas",writing:"Writing",settings:"Settings",logout:"Exit to Hub",chronology:"Chronology",graph:"Graph",languages:"Linguistics"},ij={title:"Settings",general:"General",appearance:"Appearance",language:"Language",theme:"Theme",font:"Typography",font_size:"Font Size",unauthorized:"Unauthorized",sync:"Synchronization",backup:"Backup",edit_template:"Edit Template",available_templates:"Available Templates",no_templates:"No Templates",is_global:"Is Global?",name:"Name",type:"Type"},aj={title:"Writing",library:"Architect's Library",library_desc:"Manage your Archives and Chronicles",new_notebook:"New Archivador",new_page:"New Page",index:"Index",notes:"Notes",format:"Format",empty:"Empty page...",active_notebook:"Active Archivador",open_archivador:"Open Archivador",book_title:"Book Title",placeholder_title:"The Chronicles of the Void...",create_and_open:"Create and Open",expansion:"Library Expansion",delete_confirm:"Are you sure you want to delete this archivador? All its pages will be lost."},sj={grid_system:"Grid System",size:"Size",canvas_data:"Canvas Data",width:"Width (px)",height:"Height (px)",background_image:"Background Image",upload_image:"Upload New Image",remove_image:"Remove Image",explorer:"World Explorer",not_found:"Map Image Not Found",upload_desc:"Upload a map image in the editor to get started",fullscreen:"Fullscreen",share:"Share",inhabitants:"Key Inhabitants",related_events:"Related Events",open_bible:"Open in Bible",place:"Place",capital:"Capital",new_map:"New Map"},oj={explore:"Explore",explorer:"Explorer",templates:"Templates",drag_attributes:"Drag Attributes",search_entity:"Search entity...",filter_type:"Filter by Type",all:"All",entities:"Entities",maps:"Maps",timelines:"Timelines",new_folder:"New Folder",new_timeline:"New Timeline",delete_folder:"Delete Folder",delete_folder_msg:"Are you sure you want to delete this folder and all its contents?",delete_entity:"Delete Entity",delete_entity_msg:"Are you sure you want to delete this entity from the Bible?",no_favorites:"No favorites yet",favorites:"Favorites",root_index:"Root Index",central_archive:"Central archive of all entities, timelines, and world geographical records.",empty_archive:"Empty Archive",empty_archive_desc:"Start by creating your first folder or timeline to organize knowledge."},lj={title:"Timeline",add_event:"Add Event",add_line:"New Timeline",edit_event:"Edit Event",edit_line:"Edit Timeline",delete_event:"Delete Event",delete_line:"Delete Timeline",events_tab:"Events",annexes_tab:"Annexes",linked_timelines:"Linked Timelines",available_timelines:"Available Timelines",multiverse:"Multiverse",new_universe:"New Universe",universe_settings:"Universe Settings",delete_universe_confirm:"Delete this universe and ALL its timelines? This cannot be undone.",select_timeline:"Select Timeline",no_events:"No events yet. Use the right panel to add one.",event_name:"Event Name",date_label:"Date Label",order:"Order (Sort)",description:"Description",save_changes:"Save Changes",create_event:"Create Event",delete_event_btn:"Delete Event",annexed_desc:"Link other localized timelines to this one to verify chronological consistency.",no_linked:"No linked timelines.",available_to_link:"Available to Link",no_available:"No other timelines available.",universe_name:"Universe Name",universe_desc:"Context for this universe...",add_timeline_here:"Add Timeline here",no_timelines:"No timelines here"},uj={title:"Linguistics",lexicon:"Lexicon",grammar:"Grammar Rules",writing_system:"Writing System",phonology:"Phonology",translator:"Translator",new_word:"Add New Word",new_rule:"Define New Rule",open_editor:"Open Editor",auto_saved:"Auto-Saved",desc:"A conlang belonging to {{projectName}}. Manage its lexicon, grammar rules, and writing systems here.",stats:{words:"Words",rules:"Rules",glyphs:"Glyphs"},search_lexicon:"Search word or meaning...",manage:"Manage",moon_script:"Moon Script",inventory:"Vowel Inventory",vectors:"Vector Symbols",upload_svg:"Upload SVG",live_stream:"Live Logographic Stream",rendered_output:"Rendered Output",source_text:"Source text here..."},cj={dashboard_desc:"Project Dashboard",welcome:"Welcome,",welcome_desc:"Your world is waiting to be shaped. Use the Codex to document entities, the Atlas to map out geographies, or the Chronicles to write its history.",codex_title:"Codex",codex_desc:"World Bible and Entity Database",atlas_title:"Atlas",atlas_desc:"Interactive Cartography and Geography",chronicles_title:"Chronicles",chronicles_desc:"Narrative Writing and Notebook Management",graph_title:"Graph",graph_desc:"Visualization of Connections and Relations",timeline_title:"Chronology",timeline_desc:"Timelines and Historical Events",linguistics_title:"Linguistics",linguistics_desc:"Conlang Creation and Glyphs",explore_tool:"Explore Tool"},dj={common:rj,nav:nj,settings:ij,writing:aj,atlas:sj,bible:oj,timeline:lj,linguistics:uj,project:cj},PM=ie.createContext(),hj={es:tj,en:dj},fj=({children:t})=>{const[e,r]=ie.useState(()=>{const a=localStorage.getItem("app_settings");if(a)try{return JSON.parse(a).language||"es"}catch{return"es"}return"es"}),n=a=>{const s=a.split(".");let o=hj[e];for(const l of s)if(o&&o[l])o=o[l];else return a;return o},i=a=>{r(a);const s=localStorage.getItem("app_settings");let o={};if(s)try{o=JSON.parse(s)}catch{}localStorage.setItem("app_settings",JSON.stringify({...o,language:a}))};return m.jsx(PM.Provider,{value:{language:e,t:n,changeLanguage:i},children:t})},bc=()=>{const t=ie.useContext(PM);if(!t)throw new Error("useLanguage must be used within a LanguageProvider");return t},dp=({icon:t,title:e,desc:r,color:n,onClick:i,t:a})=>m.jsxs("div",{onClick:i,className:"group relative p-8 rounded-[32px] bg-surface-dark border border-white/5 hover:border-white/10 transition-all cursor-pointer flex flex-col h-full gap-6 hover:shadow-2xl hover:shadow-black/40",children:[m.jsx("div",{className:`size-14 rounded-2xl ${n} flex items-center justify-center text-white shadow-lg group-hover:scale-110 transition-all duration-500`,children:m.jsx("span",{className:"material-symbols-outlined text-3xl",children:t})}),m.jsxs("div",{className:"space-y-4",children:[m.jsx("h3",{className:"text-2xl font-bold text-white tracking-tight",children:e}),m.jsx("p",{className:"text-slate-500 text-sm leading-relaxed",children:r})]}),m.jsxs("div",{className:"mt-auto pt-6 border-t border-white/5 flex items-center justify-between text-[10px] font-black uppercase tracking-widest text-slate-500 group-hover:text-white transition-colors",children:[m.jsx("span",{children:a("project.explore_tool")}),m.jsx("span",{className:"material-symbols-outlined text-sm group-hover:translate-x-1 transition-transform",children:"arrow_forward"})]})]}),pj=()=>{const{projectName:t}=jl(),e=Wa(),{username:r}=Zi(),{t:n}=bc(),i=`/${r}/${t}`,[a,s]=nr.useState(null);return nr.useEffect(()=>{const o=localStorage.getItem("user");o&&o!=="undefined"&&s(JSON.parse(o))},[]),m.jsxs("div",{className:"flex-1 flex flex-col h-screen overflow-hidden bg-background-dark",children:[m.jsxs("div",{className:"h-20 border-b border-white/5 flex items-center justify-between px-12 bg-surface-dark/20 backdrop-blur-xl shrink-0",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("div",{className:"size-10 rounded-xl bg-primary/20 flex items-center justify-center text-primary shadow-lg shadow-primary/10",children:m.jsx("span",{className:"material-symbols-outlined",children:"auto_stories"})}),m.jsxs("div",{children:[m.jsx("h1",{className:"text-xl font-black text-white tracking-tight uppercase",children:t}),m.jsx("p",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:n("project.dashboard_desc")})]})]}),m.jsx("div",{className:"flex items-center gap-4",children:m.jsx("div",{className:"flex -space-x-2",children:m.jsx("div",{className:"size-8 rounded-full border-2 border-surface-dark bg-indigo-500 overflow-hidden flex items-center justify-center text-[10px] font-black text-white shadow-lg",children:a?.avatarUrl?m.jsx("img",{src:a.avatarUrl,alt:"Me",className:"w-full h-full object-cover"}):m.jsx("span",{children:(a?.displayName||r)?.substring(0,2).toUpperCase()})})})})]}),m.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar",children:m.jsxs("div",{className:"max-w-7xl mx-auto p-12 space-y-16 animate-in fade-in slide-in-from-bottom-8 duration-700",children:[m.jsxs("div",{className:"space-y-4 max-w-2xl",children:[m.jsxs("h2",{className:"text-4xl font-black text-white tracking-tighter leading-tight",children:[n("project.welcome")," ",m.jsx("span",{className:"text-indigo-400",children:a?.displayName||n("common.architect")}),"."]}),m.jsx("p",{className:"text-slate-400 text-lg font-serif italic leading-relaxed opacity-80",children:n("project.welcome_desc")})]}),m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:[m.jsx(dp,{icon:"menu_book",title:n("project.codex_title"),desc:n("project.codex_desc"),color:"bg-indigo-600 shadow-indigo-500/20",onClick:()=>e(`${i}/bible`),t:n}),m.jsx(dp,{icon:"map",title:n("project.atlas_title"),desc:n("project.atlas_desc"),color:"bg-emerald-600 shadow-emerald-500/20",onClick:()=>e(`${i}/map`),t:n}),m.jsx(dp,{icon:"edit_note",title:n("project.chronicles_title"),desc:n("project.chronicles_desc"),color:"bg-amber-600 shadow-amber-500/20",onClick:()=>e(`${i}/writing`),t:n}),m.jsx(dp,{icon:"hub",title:n("project.graph_title"),desc:n("project.graph_desc"),color:"bg-purple-600 shadow-purple-500/20",onClick:()=>e(`${i}/graph`),t:n}),m.jsx(dp,{icon:"calendar_month",title:n("project.timeline_title"),desc:n("project.timeline_desc"),color:"bg-rose-600 shadow-rose-500/20",onClick:()=>e(`${i}/timeline`),t:n}),m.jsx(dp,{icon:"translate",title:n("project.linguistics_title"),desc:n("project.linguistics_desc"),color:"bg-blue-600 shadow-blue-500/20",onClick:()=>e(`${i}/linguistics`),t:n})]})]})})]})},mj=()=>{const t=Wa(),[e,r]=ie.useState(null),[n,i]=ie.useState([]),[a,s]=ie.useState([]),[o,l]=ie.useState("general"),[u,c]=ie.useState([]),[h,p]=ie.useState({theme:"deep_space",font:"Outfit",fontSize:16});ie.useEffect(()=>{try{const O=localStorage.getItem("user");O&&O!=="undefined"&&r(JSON.parse(O));const F=localStorage.getItem("app_settings");F&&p(JSON.parse(F));const B=localStorage.getItem("sync_projects");B&&s(JSON.parse(B)),v()}catch(O){console.error("Failed to parse user settings",O)}},[]);const v=async()=>{try{const O=await et.get("/workspaces");O&&i(O)}catch(O){console.error("Error loading projects for sync",O)}},y=(O,F="success")=>{const B=Date.now();c($=>[...$,{id:B,message:O,type:F}]),setTimeout(()=>{c($=>$.filter(Z=>Z.id!==B))},3e3)},S=(O,F)=>{const B={...h,[O]:F};p(B),localStorage.setItem("app_settings",JSON.stringify(B)),window.dispatchEvent(new Event("storage_update")),y(`Ajuste actualizado: ${O}`)},w=O=>{const F=a.includes(O),B=F?a.filter($=>$!==O):[...a,O];s(B),localStorage.setItem("sync_projects",JSON.stringify(B)),y(F?"Universo desmarcado de sincronizacin":"Universo incluido en sincronizacin")},T=()=>{y("Iniciando descarga de backup...","info");const O=document.createElement("a"),F="/api/backup/download",B=a.length>0?`?projects=${a.join(",")}`:"";O.href=F+B,O.setAttribute("download",`worldbuilding_backup_${Date.now()}.zip`),document.body.appendChild(O),O.click(),document.body.removeChild(O)},_=nr.useRef(null),C=async O=>{const F=O.target.files[0];if(!F)return;if(!F.name.endsWith(".db")){y("Solo se permiten archivos .db","error");return}const B=new FormData;B.append("file",F),y("Importando universo...","info");try{const $=await et.post("/import/database",B);y($.message||"Universo importado con xito"),v()}catch($){console.error("Import error",$);const Z=$.response?.data?.error||"Error al importar el archivo";y(Z,"error")}_.current&&(_.current.value="")},N=O=>{const F=O.target.files[0];if(!F)return;if(F.size>1024*1024){y("Imagen demasiado grande (mx 1MB)","error");return}const B=new FileReader;B.onload=$=>{const Z=$.target.result,D={...e||{},avatarUrl:Z};r(D);try{localStorage.setItem("user",JSON.stringify(D)),y("Foto de perfil actualizada","success")}catch(H){y("Error al guardar imagen (memoria llena)","error"),console.error("Storage error",H)}},B.readAsDataURL(F)},A=(O,F)=>{const B={...e||{},[O]:F};r(B),localStorage.setItem("user",JSON.stringify(B)),window.dispatchEvent(new Event("storage_update"))},I=[{id:"general",label:"General / Sincro",icon:"person"},{id:"appearance",label:"Apariencia y Editor",icon:"palette"}],j=[{id:"deep_space",label:"Deep Space",color:"#0f172a"},{id:"nebula",label:"Nebula",color:"#312e81"},{id:"high_contrast",label:"High Contrast",color:"#000000"}];return m.jsxs("div",{className:"flex flex-col w-full h-full bg-[#050508] text-white font-sans overflow-hidden relative",children:[m.jsxs("div",{className:"absolute inset-0 pointer-events-none overflow-hidden opacity-50",children:[m.jsx("div",{className:"absolute -top-[10%] -left-[10%] size-[40%] bg-indigo-500/10 blur-[120px] rounded-full animate-pulse"}),m.jsx("div",{className:"absolute -bottom-[10%] -right-[10%] size-[40%] bg-purple-500/5 blur-[120px] rounded-full animate-pulse",style:{animationDelay:"1s"}})]}),m.jsx("div",{className:"fixed top-24 right-8 z-[100] flex flex-col gap-3",children:u.map(O=>m.jsxs("div",{className:"flex items-center gap-3 px-6 py-4 bg-surface-dark border border-white/10 rounded-2xl shadow-2xl animate-slide-in-right",children:[m.jsx("span",{className:`material-symbols-outlined ${O.type==="success"?"text-green-400":"text-indigo-400"}`,children:O.type==="success"?"check_circle":"info"}),m.jsx("span",{className:"text-sm font-bold",children:O.message})]},O.id))}),m.jsxs("header",{className:"h-20 flex-none flex items-center justify-between px-12 border-b border-white/5 bg-[#0a0a0e] z-30",children:[m.jsxs("div",{className:"flex items-center gap-8",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("div",{className:"size-10 rounded-xl bg-indigo-500 flex items-center justify-center text-white shadow-lg shadow-indigo-500/20",children:m.jsx("span",{className:"material-symbols-outlined text-2xl",children:"settings"})}),m.jsx("h1",{className:"text-xl font-bold tracking-tight hidden sm:block",children:"Ajustes"})]}),m.jsx("nav",{className:"flex items-center gap-2 p-1 bg-white/5 rounded-2xl",children:I.map(O=>m.jsxs("button",{onClick:()=>l(O.id),className:`flex items-center gap-2 px-5 py-2.5 rounded-xl text-xs font-bold transition-all ${o===O.id?"bg-indigo-500 text-white shadow-lg shadow-indigo-500/20":"text-slate-400 hover:text-white hover:bg-white/5"}`,children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:O.icon}),O.label]},O.id))})]}),m.jsxs("button",{onClick:()=>t(-1),className:"flex items-center gap-2 px-6 py-2.5 bg-white/5 hover:bg-white/10 border border-white/10 rounded-2xl transition-all text-xs font-bold text-slate-400 hover:text-white",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"arrow_back"}),m.jsx("span",{children:"Volver"})]})]}),m.jsx("main",{className:"flex-1 overflow-y-auto p-12 custom-scrollbar",children:m.jsxs("div",{className:"max-w-3xl mx-auto pb-24 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[o==="general"&&m.jsxs("div",{className:"space-y-6",children:[m.jsxs("section",{className:"bg-[#0f0f13] border border-white/5 rounded-3xl p-8",children:[m.jsxs("h3",{className:"text-lg font-bold mb-6 flex items-center gap-2 text-indigo-400",children:[m.jsx("span",{className:"material-symbols-outlined",children:"person"}),"Perfil de Arquitecto"]}),m.jsxs("div",{className:"flex items-center gap-6 p-6 bg-white/5 rounded-3xl border border-white/5 group relative overflow-hidden",children:[m.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-indigo-500/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none"}),m.jsxs("div",{className:"relative",children:[m.jsx("div",{className:"size-20 rounded-full bg-indigo-500 flex items-center justify-center text-white text-3xl font-black shadow-2xl border-4 border-white/10 overflow-hidden",children:e?.avatarUrl?m.jsx("img",{src:e.avatarUrl,alt:"Profile",className:"w-full h-full object-cover"}):e?.displayName?.substring(0,2).toUpperCase()||e?.username?.substring(0,2).toUpperCase()||"AR"}),m.jsxs("label",{className:"absolute -bottom-1 -right-1 size-8 bg-indigo-500 rounded-full flex items-center justify-center text-white cursor-pointer hover:scale-110 transition-all border-4 border-[#0f0f13] shadow-lg",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"photo_camera"}),m.jsx("input",{type:"file",accept:"image/*",onChange:N,className:"hidden"})]})]}),m.jsxs("div",{className:"flex-1 space-y-2",children:[m.jsx("input",{type:"text",value:e?.displayName??"",onChange:O=>A("displayName",O.target.value),placeholder:e?.username||"Tu nombre de arquitecto...",className:"bg-transparent border-none text-2xl font-black text-white outline-none focus:ring-0 w-full p-0 placeholder-white/20"}),m.jsx("p",{className:"text-[10px] font-black uppercase tracking-widest text-indigo-400",children:"Architect Rank  Local Session"})]})]})]}),m.jsxs("section",{className:"bg-[#0f0f13] border border-white/5 rounded-3xl p-8 space-y-6",children:[m.jsxs("div",{className:"flex justify-between items-center",children:[m.jsxs("h3",{className:"text-lg font-bold flex items-center gap-2 text-indigo-400",children:[m.jsx("span",{className:"material-symbols-outlined",children:"sync_lock"}),"Sincronizacin y Respaldo"]}),m.jsxs("div",{className:"flex gap-3",children:[m.jsx("input",{type:"file",ref:_,onChange:C,accept:".db",className:"hidden"}),m.jsxs("button",{onClick:()=>_.current?.click(),className:"flex items-center gap-2 px-6 py-3 border border-white/5 bg-white/5 hover:bg-white/10 text-white rounded-2xl text-xs font-black uppercase tracking-widest transition-all",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"upload_file"}),"Importar Universo"]}),m.jsxs("button",{onClick:T,className:"flex items-center gap-2 px-6 py-3 bg-indigo-500 hover:bg-indigo-600 text-white rounded-2xl text-xs font-black uppercase tracking-widest transition-all shadow-lg shadow-indigo-500/30",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"cloud_download"}),"Descargar Backup ZIP"]})]})]}),m.jsxs("div",{className:"space-y-4",children:[m.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-slate-500 block",children:"Universos para sincronizacin"}),m.jsx("div",{className:"grid grid-cols-2 gap-3",children:n.length>0?n.map(O=>m.jsxs("button",{onClick:()=>w(O.filename),className:`flex items-center gap-3 p-4 rounded-2xl border transition-all text-left ${a.includes(O.filename)?"border-indigo-500 bg-indigo-500/10 text-white":"border-white/5 bg-black/20 text-slate-400 hover:border-white/10"}`,children:[m.jsx("span",{className:"material-symbols-outlined text-lg",children:a.includes(O.filename)?"check_circle":"circle"}),m.jsx("div",{className:"truncate",children:m.jsx("p",{className:"text-xs font-bold truncate",children:O.title})})]},O.filename)):m.jsx("div",{className:"col-span-2 p-8 border border-dashed border-white/5 rounded-2xl text-center text-slate-600 text-xs italic text-glass-muted",children:"No hay universos detectados..."})})]})]})]}),o==="appearance"&&m.jsxs("div",{className:"space-y-6",children:[m.jsxs("section",{className:"bg-[#0f0f13] border border-white/5 rounded-3xl p-8",children:[m.jsxs("h3",{className:"text-lg font-bold mb-6 flex items-center gap-2 text-indigo-400",children:[m.jsx("span",{className:"material-symbols-outlined",children:"palette"}),"Esttica del Sistema"]}),m.jsx("div",{className:"grid grid-cols-3 gap-6",children:j.map(O=>m.jsxs("button",{onClick:()=>S("theme",O.id),className:`relative flex flex-col gap-3 group text-left transition-all p-3 rounded-2xl border ${h.theme===O.id?"border-indigo-500 bg-indigo-500/5 ring-1 ring-indigo-500/50":"border-white/5 bg-black/20 hover:border-white/20"}`,children:[m.jsx("div",{className:"h-24 rounded-xl flex items-center justify-center overflow-hidden",style:{backgroundColor:O.color},children:m.jsx("div",{className:"size-10 rounded-full bg-white/10 backdrop-blur-xl border border-white/10"})}),m.jsx("span",{className:"text-xs font-bold text-center",children:O.label})]},O.id))})]}),m.jsxs("section",{className:"bg-[#0f0f13] border border-white/5 rounded-3xl p-8",children:[m.jsxs("h3",{className:"text-lg font-bold mb-6 flex items-center gap-2 text-indigo-400",children:[m.jsx("span",{className:"material-symbols-outlined",children:"text_fields"}),"Tipografa y Lectura"]}),m.jsxs("div",{className:"grid grid-cols-2 gap-12",children:[m.jsxs("div",{className:"space-y-4",children:[m.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-slate-500",children:"Fuente del Codex"}),m.jsxs("div",{className:"relative",children:[m.jsxs("select",{value:h.font,onChange:O=>S("font",O.target.value),className:"w-full bg-black/40 border border-white/10 rounded-xl px-5 py-3.5 text-sm text-white appearance-none outline-none focus:border-indigo-500 transition-all",style:{fontFamily:h.font},children:[m.jsx("option",{value:"Lexend",children:"Lexend (UI Moderna)"}),m.jsx("option",{value:"Outfit",children:"Outfit (Sleek)"}),m.jsx("option",{value:"Cormorant Garamond",children:"Cormorant (Legendaria)"}),m.jsx("option",{value:"Playfair Display",children:"Playfair (Elegante)"}),m.jsx("option",{value:"JetBrains Mono",children:"JetBrains Mono (Codex)"})]}),m.jsx("span",{className:"material-symbols-outlined absolute right-4 top-1/2 -translate-y-1/2 pointer-events-none text-slate-500",children:"expand_more"})]})]}),m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{className:"flex justify-between items-center",children:[m.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-slate-500",children:"Tamao del Texto"}),m.jsxs("span",{className:"text-xs font-bold text-indigo-400",children:[h.fontSize,"px"]})]}),m.jsx("div",{className:"flex items-center gap-4 py-3",children:m.jsx("input",{type:"range",min:"12",max:"24",value:h.fontSize,onChange:O=>S("fontSize",parseInt(O.target.value)),className:"flex-1 accent-indigo-500 h-1 bg-white/10 rounded-full appearance-none cursor-pointer"})})]})]}),m.jsxs("div",{className:"mt-12 space-y-4 border-t border-white/5 pt-8",children:[m.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-slate-500",children:"Preferencia de Idioma / Language"}),m.jsxs("div",{className:"flex gap-4",children:[m.jsxs("button",{onClick:()=>S("language","es"),className:`flex-1 py-4 rounded-2xl border transition-all flex items-center justify-center gap-3 font-bold text-xs ${h.language==="es"||!h.language?"border-primary bg-primary/10 text-white shadow-lg":"border-white/5 bg-black/20 text-slate-400"}`,children:[m.jsx("span",{className:"text-xl",children:""}),"Castellano"]}),m.jsxs("button",{onClick:()=>S("language","en"),className:`flex-1 py-4 rounded-2xl border transition-all flex items-center justify-center gap-3 font-bold text-xs ${h.language==="en"?"border-primary bg-primary/10 text-white shadow-lg":"border-white/5 bg-black/20 text-slate-400"}`,children:[m.jsx("span",{className:"text-xl",children:""}),"English"]})]})]}),m.jsx("div",{className:"mt-8 p-6 bg-black/40 rounded-2xl border border-white/5 text-center shadow-inner",children:m.jsx("p",{style:{fontFamily:h.font,fontSize:`${h.fontSize}px`},className:"text-slate-200 transition-all duration-300",children:'"El universo es un libro escrito en el lenguaje de las historias."'})})]})]})]})})]})},qv=({isOpen:t,onClose:e,onConfirm:r,title:n,message:i,confirmText:a="Confirmar",cancelText:s="Cancelar",type:o="danger"})=>t?Il.createPortal(m.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[m.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",onClick:e}),m.jsxs("div",{className:"relative w-full max-w-md bg-[#0a0a0c] border border-white/10 rounded-3xl shadow-2xl p-6 animate-in zoom-in-95 duration-200 overflow-hidden",children:[m.jsx("div",{className:"absolute top-0 left-0 right-0 h-32 bg-gradient-to-b from-white/5 to-transparent pointer-events-none"}),m.jsxs("div",{className:"relative z-10 text-center",children:[m.jsx("div",{className:`mx-auto mb-4 size-16 rounded-2xl flex items-center justify-center ${o==="danger"?"bg-red-500/10 text-red-500":"bg-yellow-500/10 text-yellow-500"}`,children:m.jsx("span",{className:"material-symbols-outlined text-3xl",children:o==="danger"?"delete_forever":"warning"})}),m.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:n}),m.jsx("p",{className:"text-text-muted text-sm mb-8 leading-relaxed",children:i}),m.jsxs("div",{className:"flex gap-3",children:[m.jsx("button",{onClick:e,className:"flex-1 px-4 py-3 rounded-xl bg-surface-light hover:bg-white/10 text-text-muted hover:text-white text-xs font-bold transition-all border border-white/5",children:s}),m.jsx("button",{onClick:()=>{r(),e()},className:`flex-1 px-4 py-3 rounded-xl text-white text-xs font-bold transition-all shadow-lg flex items-center justify-center gap-2
                                ${o==="danger"?"bg-red-500 hover:bg-red-600 shadow-red-500/20":"bg-primary hover:bg-primary-light shadow-primary/20"}`,children:m.jsx("span",{children:a})})]})]})]})]}),document.body):null,CE=({compact:t=!1})=>{const[e,r]=ie.useState(null),[n,i]=ie.useState([]),[a,s]=ie.useState(!1),[o,l]=ie.useState(null);ie.useEffect(()=>{u()},[]);const u=async()=>{try{const v=await et.get("/world-bible/folders");v.length>0&&r(v[0].id),c()}catch(v){console.error("Init error:",v)}},c=async()=>{s(!0);try{const v=await et.get("/world-bible/templates/global");i(v)}catch(v){console.error("Error loading templates:",v)}finally{s(!1)}},h=async v=>{if(e)try{await et.post(`/world-bible/folders/${e}/templates`,{nombre:v.label,tipo:v.type,required:v.required,metadata:v.metadata?JSON.stringify(v.metadata):null,global:!0}),c()}catch(y){console.error("Error creating template:",y)}},p=async()=>{if(o)try{await et.delete(`/world-bible/templates/${o}`),i(v=>v.filter(y=>y.id!==o))}catch(v){console.error("Error deleting template:",v)}finally{l(null)}};return m.jsxs("div",{className:"space-y-8 animate-in fade-in slide-in-from-right-4 duration-500",children:[m.jsxs(An,{className:`${t?"p-4 bg-transparent border-none shadow-none":"p-8 space-y-8"}`,children:[m.jsx("header",{className:`flex ${t?"flex-col gap-4":"justify-between items-center"}`,children:m.jsxs("div",{children:[m.jsx("h3",{className:`${t?"text-sm":"text-xl"} font-bold text-white`,children:"Atributos Globales"}),m.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Define atributos disponibles para todas las entidades."})]})}),m.jsxs("div",{className:"space-y-4",children:[a?m.jsx("div",{className:"text-center p-4 text-slate-500",children:"Cargando plantillas..."}):n.map((v,y)=>m.jsxs("div",{className:"flex items-center gap-4 p-4 rounded-2xl bg-white/[0.02] border border-white/5 hover:border-primary/50 hover:bg-white/5 transition-all cursor-grab active:cursor-grabbing group select-none",draggable:!0,onDragStart:S=>{S.dataTransfer.setData("application/reactflow/type","attribute"),S.dataTransfer.setData("templateId",v.id),S.dataTransfer.setData("templateData",JSON.stringify(v)),S.dataTransfer.effectAllowed="copy"},children:[m.jsxs("span",{className:"text-[10px] font-black text-slate-700 w-6 group-hover:text-primary transition-colors",children:["0",y+1]}),m.jsxs("div",{className:"flex-1 pointer-events-none",children:[m.jsx("div",{className:"text-sm font-bold text-white",children:v.nombre}),m.jsxs("div",{className:"text-[10px] text-slate-500 uppercase tracking-widest",children:[v.tipo," ",v.esObligatorio&&" Required"]}),v.metadata&&m.jsx("div",{className:"text-[10px] text-slate-600 font-mono mt-1 truncate",children:v.metadata})]}),m.jsx("button",{onClick:()=>l(v.id),className:"p-1.5 text-slate-500 hover:text-red-500 hover:bg-red-500/10 rounded-lg transition-colors",title:"Eliminar Plantilla Global",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})})]},v.id)),m.jsx(gj,{onAdd:h})]})]}),m.jsx(qv,{isOpen:!!o,onClose:()=>l(null),onConfirm:p,title:"Eliminar Plantilla",message:"Ests seguro de que quieres eliminar esta plantilla? Esta accin es irreversible.",confirmText:"Eliminar",type:"danger"})]})},gj=({onAdd:t})=>{const[e,r]=ie.useState(""),[n,i]=ie.useState("text"),[a,s]=ie.useState(!1),[o,l]=ie.useState([""]),u=()=>l([...o,""]),c=v=>l(o.filter((y,S)=>S!==v)),h=(v,y)=>{const S=[...o];S[v]=y,l(S)},p=()=>{if(!e)return;let v=null;["select","multi_select"].includes(n)&&(v={options:o.filter(y=>y.trim())}),t({label:e,type:n,required:a,metadata:v}),r(""),l([""])};return m.jsxs("div",{className:"p-4 rounded-2xl border-2 border-dashed border-white/10 bg-white/[0.01] space-y-4",children:[m.jsx("h4",{className:"text-xs font-black uppercase tracking-widest text-primary",children:"Add New Attribute"}),m.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[m.jsx("input",{placeholder:"Field Name",value:e,onChange:v=>r(v.target.value),className:"bg-black/20 border border-white/5 rounded-xl px-4 py-2 text-xs text-white outline-none focus:border-primary/30 min-w-0"}),m.jsxs("select",{value:n,onChange:v=>i(v.target.value),className:"bg-black/20 border border-white/5 rounded-xl px-4 py-2 text-xs text-white outline-none",children:[m.jsx("option",{value:"text",children:"Text (Long)"}),m.jsx("option",{value:"short_text",children:"Text (Short)"}),m.jsx("option",{value:"number",children:"Number"}),m.jsx("option",{value:"date",children:"Date"}),m.jsx("option",{value:"select",children:"Single Selection (Dropdown)"}),m.jsx("option",{value:"multi_select",children:"Multiple Selection"}),m.jsx("option",{value:"boolean",children:"Switch (True/False)"})]})]}),["select","multi_select"].includes(n)&&m.jsxs("div",{className:"space-y-2",children:[m.jsx("label",{className:"text-[10px] font-bold text-slate-500 uppercase",children:"Options"}),m.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto pr-2 custom-scrollbar",children:o.map((v,y)=>m.jsxs("div",{className:"flex gap-2",children:[m.jsx("input",{placeholder:`Option ${y+1}`,value:v,onChange:S=>h(y,S.target.value),className:"flex-1 bg-black/20 border border-white/5 rounded-lg px-3 py-1.5 text-xs text-white outline-none focus:border-primary/30"}),m.jsx("button",{onClick:()=>c(y),className:"p-1.5 hover:bg-red-500/20 text-slate-500 hover:text-red-400 rounded-lg transition-colors",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"close"})})]},y))}),m.jsx("button",{onClick:u,className:"w-full py-1.5 text-[10px] font-bold uppercase tracking-widest text-primary hover:bg-primary/5 rounded-lg border border-dashed border-primary/20 transition-all",children:"+ Add Custom Option"})]}),m.jsxs("div",{className:"flex justify-between items-center",children:[m.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[m.jsx("input",{type:"checkbox",checked:a,onChange:v=>s(v.target.checked),className:"size-4 rounded border-white/10 bg-white/5 accent-primary"}),m.jsx("span",{className:"text-[10px] font-bold text-slate-500",children:"Required Field"})]}),m.jsx("button",{onClick:p,className:"px-4 py-2 bg-primary/20 text-primary rounded-lg text-xs font-bold hover:bg-primary/30 transition-all",children:"+ Add Field"})]})]})},RS=({projectName:t,storageKey:e})=>{const[r,n]=ie.useState([]),[i,a]=ie.useState(!1),[s,o]=ie.useState(null),l=()=>e||`notes_v2_${t}`;ie.useEffect(()=>{const _=l();if(!_)return;const C=localStorage.getItem(_);if(C)n(JSON.parse(C));else if(!e){const N=localStorage.getItem(`notes_${t}`);if(N){const A={id:Date.now(),title:"Nota General",content:N};n([A]),localStorage.setItem(_,JSON.stringify([A]))}}},[t,e]);const u=_=>{n(_);const C=l();C&&localStorage.setItem(C,JSON.stringify(_))},c=()=>{const _={id:Date.now(),title:"Nueva Nota",content:""};u([...r,_]),o(_.id)},[h,p]=ie.useState(null),v=_=>{p(_)},y=()=>{h&&(u(r.filter(_=>_.id!==h)),p(null))},S=(_,C,N)=>{u(r.map(A=>A.id===_?{...A,[C]:N}:A))},w=()=>a(!i),T=()=>m.jsxs("div",{className:`flex flex-col h-full bg-surface-dark/40 ${i?"":"max-h-[25vh]"}`,children:[m.jsxs("div",{className:"flex items-center justify-between p-3 border-b border-glass-border bg-white/5",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm text-primary",children:"edit_note"}),m.jsxs("h3",{className:"text-[10px] font-black uppercase tracking-widest text-white",children:["Notas (",r.length,")"]})]}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("button",{onClick:c,className:"p-1 hover:text-primary text-text-muted transition-colors",title:"Aadir Nota",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"add"})}),m.jsx("button",{onClick:w,className:"p-1 hover:text-white text-text-muted transition-colors",title:"Pantalla Completa",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:i?"fullscreen_exit":"fullscreen"})})]})]}),m.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-2 space-y-2",children:r.length===0?m.jsx("div",{className:"py-8 text-center opacity-30 italic text-[10px] uppercase font-bold",children:"Sin notas"}):r.map(_=>m.jsxs("div",{className:"group bg-white/5 border border-glass-border rounded-xl overflow-hidden hover:border-primary/30 transition-all",children:[m.jsxs("div",{className:"flex items-center justify-between px-3 py-2 bg-white/5",children:[m.jsx("input",{className:"bg-transparent border-none text-[11px] font-bold text-white outline-none w-full",value:_.title,onChange:C=>S(_.id,"title",C.target.value),placeholder:"Ttulo..."}),m.jsx("button",{onClick:()=>v(_.id),className:"opacity-0 group-hover:opacity-100 p-1 text-text-muted hover:text-red-400 transition-all",children:m.jsx("span",{className:"material-symbols-outlined text-xs",children:"delete"})})]}),m.jsx("textarea",{className:"w-full bg-transparent p-3 text-xs text-white/70 outline-none resize-none min-h-[80px] custom-scrollbar",value:_.content,onChange:C=>S(_.id,"content",C.target.value),placeholder:"Escribe el contenido aqu..."})]},_.id))}),m.jsx(qv,{isOpen:!!h,onClose:()=>p(null),onConfirm:y,title:"Eliminar Nota",message:"Ests seguro de que quieres eliminar esta nota? No se podr recuperar.",confirmText:"Eliminar",type:"danger"})]});return i?m.jsx("div",{className:"fixed inset-0 z-[100] bg-background-dark/95 backdrop-blur-md p-8 flex flex-col items-center",children:m.jsx("div",{className:"w-full max-w-4xl h-full flex flex-col border border-glass-border rounded-3xl overflow-hidden shadow-2xl bg-surface-dark",children:m.jsx(T,{})})}):m.jsx("div",{className:"h-full border border-glass-border rounded-2xl overflow-hidden",children:m.jsx(T,{})})},gd=({to:t,icon:e,label:r,collapsed:n,end:i})=>m.jsxs(iI,{to:t,end:i,className:({isActive:a})=>`
            flex items-center gap-3 px-3 py-2.5 rounded-xl transition-all group
            ${a?"bg-primary text-white shadow-lg shadow-primary/20":"text-text-muted hover:text-white hover:bg-white/5"}
            ${n?"justify-center":""}
        `,title:n?r:"",children:[m.jsx("span",{className:"material-symbols-outlined text-xl",children:e}),!n&&m.jsx("span",{className:"text-sm font-bold tracking-wide",children:r})]}),EE=t=>{switch(t?.toLowerCase()){case"text":return"notes";case"short_text":return"short_text";case"number":return"pin";case"date":return"calendar_today";case"select":return"list";case"boolean":return"check_box";case"map":return"map";case"timeline":return"timeline";case"character":case"entidadindividual":return"person";case"location":case"zona":case"construccion":return"location_on";case"culture":case"entidadcolectiva":return"groups";case"universe":case"galaxy":case"system":case"planet":return"public";case"entity_link":return"link";default:return"description"}},vj=()=>{console.log("ArchitectLayout Mounting");const{username:t,projectName:e,folderSlug:r}=Zi(),n=Wa(),{t:i}=bc(),a=Nf(),[s,o]=ie.useState(!0),[l,u]=ie.useState(!1),[c,h]=ie.useState("Loading..."),[p,v]=ie.useState(null),[y,S]=ie.useState("NOTES"),[w,T]=ie.useState(""),[_,C]=ie.useState([]),[N,A]=ie.useState(null),[I,j]=ie.useState(null),[O,F]=ie.useState({name:"",description:"",type:"regional",showGrid:!0,gridSize:50,width:800,height:600,bgImage:null}),[B,$]=ie.useState(null),[Z,D]=ie.useState("identity"),[H,U]=ie.useState("notes"),[W,Y]=ie.useState(""),[Q,ne]=ie.useState("ALL"),re=a.pathname.includes("/bible"),q=a.pathname.includes("/writing"),[te,ae]=ie.useState("index");a.pathname.includes("/languages");const[de,ge]=ie.useState(null),[ye,se]=ie.useState([]),[fe,le]=ie.useState("identity"),[pe,me]=ie.useState(null),xe=(De,Le)=>{De.stopPropagation(),me(Le)},Se=async()=>{if(pe){try{await et.delete(`/world-bible/templates/${pe}`),C(De=>De.filter(Le=>Le.id!==pe))}catch(De){console.error("Delete failed",De)}me(null)}},Ve=async De=>{De.preventDefault();try{await et.put(`/world-bible/templates/${de.id}`,de),C(Le=>Le.map(Qe=>Qe.id===de.id?de:Qe)),ge(null)}catch(Le){console.error("Update failed",Le)}},$e=`/${t}/${e}`;ie.useEffect(()=>{e&&St(e);const De=()=>{e&&St(e)};return window.addEventListener("focus",De),()=>window.removeEventListener("focus",De)},[e]);const St=async De=>{try{const Le=await et.get(`/proyectos/${De}`);Le&&(h(Le.nombreProyecto),v(Le.id))}catch(Le){console.error("Error loading project:",Le),h("Error"),n("/")}},[rt,lt]=ie.useState(null);return ie.useEffect(()=>{const De=localStorage.getItem("user");De&&De!=="undefined"&&lt(JSON.parse(De))},[]),m.jsxs("div",{className:"flex h-screen w-full overflow-hidden bg-background-dark text-text-main font-sans selection:bg-primary/30",children:[m.jsxs("aside",{className:`
                    flex-none bg-surface-dark border-r border-glass-border transition-all duration-500 relative flex flex-col z-30
                    ${s?"w-80":"w-20"}
                `,children:[m.jsxs("div",{className:"h-16 flex items-center justify-center border-b border-glass-border relative",children:[s?m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("div",{className:"size-8 rounded-lg bg-surface-light flex items-center justify-center text-primary shadow-inner",children:m.jsx("span",{className:"material-symbols-outlined",children:a.pathname.includes("/writing")?"edit_note":a.pathname.includes("/graph")?"hub":a.pathname.includes("/bible")?"auto_stories":a.pathname.includes("/map")?"map":a.pathname.includes("/timeline")?"timeline":a.pathname.includes("/languages")?"translate":"auto_stories"})}),m.jsx("h2",{className:"text-sm font-black uppercase tracking-widest text-white truncate max-w-[150px]",children:c})]}):m.jsx("button",{onClick:()=>o(!0),className:"size-10 rounded-xl hover:bg-white/5 flex items-center justify-center text-text-muted hover:text-white transition-all",children:m.jsx("span",{className:"material-symbols-outlined",children:"menu"})}),s&&m.jsx("button",{onClick:()=>o(!1),className:"absolute right-4 text-text-muted hover:text-white transition-colors",children:m.jsx("span",{className:"material-symbols-outlined text-lg",children:"dock_to_left"})})]}),m.jsx("div",{className:"flex-1 overflow-y-auto no-scrollbar flex flex-col",children:m.jsxs("div",{className:"p-3 space-y-1",children:[m.jsx(gd,{to:$e,icon:"home",label:i("nav.dashboard"),collapsed:!s,end:!0}),m.jsx(gd,{to:`${$e}/bible`,icon:"menu_book",label:i("nav.bible"),collapsed:!s}),m.jsx(gd,{to:`${$e}/map`,icon:"map",label:i("nav.atlas"),collapsed:!s}),m.jsx(gd,{to:`${$e}/timeline`,icon:"calendar_month",label:i("nav.chronology"),collapsed:!s}),m.jsx(gd,{to:`${$e}/languages`,icon:"translate",label:i("nav.languages"),collapsed:!s}),m.jsx(gd,{to:`${$e}/graph`,icon:"hub",label:i("nav.graph"),collapsed:!s}),m.jsx("div",{className:"h-px bg-glass-border my-2 mx-2 opacity-50"}),m.jsx(gd,{to:`${$e}/writing`,icon:"edit_note",label:i("nav.writing"),collapsed:!s}),m.jsx("div",{className:"h-px bg-glass-border my-2 mx-2 opacity-10"}),m.jsx(gd,{to:"/",icon:"logout",label:i("nav.logout"),collapsed:!s})]})}),m.jsx("footer",{className:"p-4 border-t border-glass-border",children:m.jsxs("div",{className:`flex items-center gap-3 ${!s&&"justify-center"}`,children:[m.jsx("div",{className:"size-10 rounded-full border border-glass-border p-1 bg-surface-light relative overflow-hidden",children:rt?.avatarUrl?m.jsx("img",{src:rt.avatarUrl,alt:"Me",className:"w-full h-full rounded-full object-cover"}):m.jsx("div",{className:"w-full h-full rounded-full bg-gradient-to-br from-primary to-purple-500 flex items-center justify-center text-white font-black text-xs",children:(rt?.displayName||t)?.substring(0,2).toUpperCase()||"US"})}),s&&m.jsxs("div",{className:"overflow-hidden",children:[m.jsx("h4",{className:"text-xs font-bold text-white truncate",children:rt?.displayName||t||"User"}),m.jsx("p",{className:"text-[10px] text-text-muted uppercase font-black tracking-tighter",children:i("common.architect")})]})]})})]}),m.jsxs("main",{className:"flex-1 flex flex-col min-w-0 bg-background-dark relative",children:[m.jsx("div",{className:"h-16 w-full absolute top-0 left-0 bg-gradient-to-b from-background-dark to-transparent pointer-events-none"}),m.jsx("div",{className:"flex-1 flex overflow-hidden relative",children:m.jsx($k,{context:{setRightPanelMode:S,setRightOpen:u,setRightPanelTitle:T,projectName:c,projectId:p,availableTemplates:_,setAvailableTemplates:C,setAddAttributeHandler:A,setCreateTemplateHandler:j,mapSettings:O,setMapSettings:F,setOnMapSettingsChange:$,entityTabs:ye,setEntityTabs:se,activeEntityTab:fe,setActiveEntityTab:le,folderSearchTerm:W,setFolderSearchTerm:Y,folderFilterType:Q,setFolderFilterType:ne}})})]}),m.jsxs("aside",{className:`
                    flex-none bg-surface-dark border-l border-glass-border transition-all duration-500 relative flex flex-col z-30 shrink-0
                    ${l?"w-80":"w-20"}
                `,children:[m.jsx("header",{className:"h-16 flex items-center px-6 border-b border-glass-border justify-between shrink-0",children:l?m.jsxs(m.Fragment,{children:[y==="CUSTOM"&&!q?m.jsx("h2",{className:"text-xs font-black uppercase tracking-widest text-primary",children:w||"Panel"}):y==="LINGUISTICS"?m.jsx("div",{className:"flex bg-white/5 rounded-lg p-1 gap-1 w-full mr-4",children:m.jsxs("button",{className:"flex-1 py-1 rounded-md text-[10px] uppercase font-bold bg-primary text-white shadow transition-all",children:[m.jsx("span",{className:"material-symbols-outlined text-sm align-middle mr-1",children:"draw"}),"Herramientas"]})}):q?m.jsxs("div",{className:"flex bg-white/5 rounded-lg p-1 gap-1 w-full mr-4",children:[m.jsx("button",{onClick:()=>ae("index"),className:`flex-1 py-1 rounded-md text-[10px] uppercase font-bold transition-all ${te==="index"?"bg-primary text-white shadow":"text-slate-500 hover:text-white"}`,children:i("writing.index")}),m.jsx("button",{onClick:()=>ae("notes"),className:`flex-1 py-1 rounded-md text-[10px] uppercase font-bold transition-all ${te==="notes"?"bg-primary text-white shadow":"text-slate-500 hover:text-white"}`,children:i("writing.notes")})]}):re&&y==="NOTES"?m.jsxs("div",{className:"flex bg-white/5 rounded-lg p-1 gap-1",children:[m.jsx("button",{onClick:()=>U("notes"),className:`px-3 py-1 rounded-md text-[10px] uppercase font-bold transition-all ${H==="notes"?"bg-primary text-white shadow":"text-slate-500 hover:text-white"}`,children:i("writing.notes")}),m.jsx("button",{onClick:()=>U("templates"),className:`px-3 py-1 rounded-md text-[10px] uppercase font-bold transition-all ${H==="templates"?"bg-primary text-white shadow":"text-slate-500 hover:text-white"}`,children:i("bible.templates")}),m.jsx("button",{onClick:()=>U("filters"),className:`px-3 py-1 rounded-md text-[10px] uppercase font-bold transition-all ${H==="filters"?"bg-primary text-white shadow":"text-slate-500 hover:text-white"}`,children:i("bible.explore")})]}):m.jsx("h2",{className:"text-xs font-black uppercase tracking-widest text-white",children:w||i(y==="NOTES"?"settings.notes_global":"common.architect")}),m.jsx("button",{onClick:()=>u(!1),className:"text-text-muted hover:text-white transition-colors shrink-0",children:m.jsx("span",{className:"material-symbols-outlined text-lg",children:"dock_to_right"})})]}):m.jsx("button",{onClick:()=>u(!0),className:"w-full h-full flex items-center justify-center text-text-muted hover:text-white transition-colors",children:m.jsx("span",{className:"material-symbols-outlined",children:y==="NOTES"||q?"edit_note":y==="MAP"?"map":y==="LINGUISTICS"?"draw":y==="CUSTOM"?"build":"handyman"})})}),m.jsxs("div",{className:"flex-1 overflow-y-auto no-scrollbar p-0 relative",children:[m.jsx("div",{id:"architect-right-panel-portal",className:`
                            ${(q||y==="CUSTOM"||y==="LINGUISTICS")&&l?"flex flex-col h-full relative":"hidden"}
                        `}),l?q?m.jsx(m.Fragment,{children:m.jsx("div",{className:`h-full p-4 overflow-hidden ${te==="notes"?"block":"hidden"}`,children:m.jsx(RS,{projectName:e})})}):y==="CUSTOM"?m.jsx(m.Fragment,{}):y==="NOTES"?H==="templates"&&re?m.jsx("div",{className:"h-full overflow-y-auto no-scrollbar",children:m.jsx(CE,{compact:!0})}):H==="filters"&&re?m.jsxs("div",{className:"h-full p-6 space-y-6 animate-in fade-in slide-in-from-right-4",children:[m.jsxs("div",{className:"space-y-4",children:[m.jsx("h3",{className:"text-xs font-black uppercase tracking-widest text-text-muted",children:"Bsqueda"}),m.jsxs("div",{className:"bg-black/20 border border-white/10 rounded-xl p-3 flex items-center gap-2 focus-within:border-primary transition-colors",children:[m.jsx("span",{className:"material-symbols-outlined text-slate-500",children:"search"}),m.jsx("input",{value:W,onChange:De=>Y(De.target.value),placeholder:i("bible.search_entity"),className:"bg-transparent border-none outline-none text-sm text-white w-full placeholder-slate-600"}),W&&m.jsx("button",{onClick:()=>Y(""),className:"text-slate-500 hover:text-white",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"close"})})]})]}),m.jsx("div",{className:"h-px bg-glass-border"}),m.jsxs("div",{className:"space-y-4",children:[m.jsx("h3",{className:"text-xs font-black uppercase tracking-widest text-text-muted",children:"Filtrar por Tipo"}),m.jsx("div",{className:"grid grid-cols-2 gap-2",children:[{id:"ALL",label:i("bible.all"),icon:"grid_view"},{id:"ENTITY",label:i("bible.entities"),icon:"person"},{id:"MAP",label:i("bible.maps"),icon:"map"},{id:"TIMELINE",label:i("bible.timelines"),icon:"timeline"}].map(De=>m.jsxs("button",{onClick:()=>ne(De.id),className:`
                                                        p-3 rounded-xl border flex flex-col items-center gap-2 transition-all
                                                        ${Q===De.id?"bg-primary text-white border-primary shadow-lg shadow-primary/20":"bg-white/5 border-transparent text-slate-500 hover:bg-white/10 hover:text-white"}
                                                    `,children:[m.jsx("span",{className:"material-symbols-outlined",children:De.icon}),m.jsx("span",{className:"text-[10px] font-bold uppercase",children:De.label})]},De.id))})]})]}):m.jsx("div",{className:"h-full p-4 overflow-hidden",children:m.jsx(RS,{projectName:e})}):y==="MAP"?m.jsxs("div",{className:"p-6 space-y-8 animate-in fade-in slide-in-from-right-4",children:[m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsx("h3",{className:"text-xs font-black uppercase tracking-widest text-text-muted",children:"Grid System"}),m.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[m.jsx("input",{type:"checkbox",checked:O.showGrid,onChange:De=>{const Le={...O,showGrid:De.target.checked};F(Le),B&&B(Le)},className:"sr-only peer"}),m.jsx("div",{className:"w-9 h-5 bg-white/10 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-primary"})]})]}),m.jsxs("div",{className:`space-y-2 transition-opacity ${O.showGrid?"opacity-100":"opacity-30 pointer-events-none"}`,children:[m.jsxs("div",{className:"flex justify-between text-xs font-bold text-white",children:[m.jsx("span",{children:"Size"}),m.jsxs("span",{className:"font-mono text-primary",children:[O.gridSize,"px"]})]}),m.jsx("input",{type:"range",min:"10",max:"200",step:"10",value:O.gridSize,onChange:De=>{const Le={...O,gridSize:parseInt(De.target.value)};F(Le),B&&B(Le)},className:"w-full h-1 bg-white/10 rounded-lg appearance-none cursor-pointer accent-primary"})]})]}),m.jsx("div",{className:"h-px bg-glass-border"}),m.jsxs("div",{className:"space-y-4",children:[m.jsx("h3",{className:"text-xs font-black uppercase tracking-widest text-text-muted",children:i("atlas.canvas_data")}),m.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[m.jsxs("div",{className:"space-y-1",children:[m.jsx("label",{className:"text-[10px] uppercase font-bold text-slate-500",children:i("atlas.width")}),m.jsx("input",{type:"number",value:O.width,onChange:De=>{const Le={...O,width:parseInt(De.target.value)};F(Le),B&&B(Le)},className:"w-full bg-black/20 border border-white/10 rounded-lg p-2 text-white text-right font-mono text-sm focus:border-primary outline-none"})]}),m.jsxs("div",{className:"space-y-1",children:[m.jsx("label",{className:"text-[10px] uppercase font-bold text-slate-500",children:i("atlas.height")}),m.jsx("input",{type:"number",value:O.height,onChange:De=>{const Le={...O,height:parseInt(De.target.value)};F(Le),B&&B(Le)},className:"w-full bg-black/20 border border-white/10 rounded-lg p-2 text-white text-right font-mono text-sm focus:border-primary outline-none"})]})]})]}),m.jsx("div",{className:"h-px bg-glass-border"}),m.jsxs("div",{className:"space-y-4",children:[m.jsx("h3",{className:"text-xs font-black uppercase tracking-widest text-text-muted",children:i("atlas.background_image")}),m.jsxs("div",{className:"space-y-2",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsxs("label",{className:"cursor-pointer bg-white/5 hover:bg-white/10 text-white rounded-lg px-3 py-2 text-xs font-bold transition-colors border border-glass-border flex items-center gap-2 flex-1",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"upload"}),m.jsx("span",{children:i("atlas.upload_image")}),m.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:De=>{const Le=De.target.files[0];if(Le){const Qe=new FileReader;Qe.onload=Ce=>{const Fe=new Image;Fe.onload=()=>{const Ke={...O,bgImage:Ce.target.result,width:Fe.width,height:Fe.height};F(Ke),B&&B(Ke)},Fe.src=Ce.target.result},Qe.readAsDataURL(Le)}}})]}),O.bgImage&&m.jsx("button",{onClick:()=>{const De={...O,bgImage:null};F(De),B&&B(De)},className:"p-2 bg-red-500/10 text-red-400 hover:bg-red-500/20 rounded-lg border border-red-500/20",title:"Remove Image",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})})]}),O.bgImage&&m.jsxs("div",{className:"rounded-lg overflow-hidden border border-glass-border bg-black/20 h-32 relative group",children:[m.jsx("img",{src:O.bgImage,alt:"Background",className:"w-full h-full object-cover opacity-70"}),m.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:m.jsxs("span",{className:"text-[10px] font-mono bg-black/50 px-2 py-1 rounded text-white backdrop-blur-sm",children:[O.width," x ",O.height]})})]})]})]})]}):y==="ENTITY"?m.jsxs("div",{className:"flex flex-col h-full animate-in fade-in slide-in-from-right-4",children:[m.jsx("div",{className:"p-4 border-b border-glass-border",children:m.jsx("div",{className:"bg-black/40 p-1 rounded-xl flex",children:ye.map(De=>{const Le=Qe=>{switch(Qe.toLowerCase()){case"identity":return"badge";case"narrative":return"auto_stories";case"attributes":return"tune";case"notes":return"edit_note";default:return"circle"}};return m.jsxs("button",{onClick:()=>le(De),className:`
                                                        flex-1 py-2 rounded-lg transition-all group relative flex items-center justify-center
                                                        ${fe===De?"bg-primary text-white shadow-lg":"text-text-muted hover:text-white hover:bg-white/5"}
                                                    `,title:De,children:[m.jsx("span",{className:"material-symbols-outlined text-lg",children:Le(De)}),m.jsx("span",{className:"absolute -bottom-8 left-1/2 -translate-x-1/2 bg-black/90 text-white text-[10px] uppercase font-bold px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none whitespace-nowrap z-50",children:De})]},De)})})}),fe==="attributes"&&m.jsxs("div",{className:"flex-1 overflow-hidden flex flex-col bg-black/20",children:[m.jsxs("div",{className:"px-6 py-4 text-[10px] font-black uppercase text-slate-500 tracking-widest flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"drag_indicator"})," ",i("bible.drag_attributes")]}),m.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar px-2",children:m.jsx(CE,{compact:!0,initialFolderSlug:r})})]})]}):y==="TOOLBOX"?m.jsx("div",{className:"p-4 space-y-6",children:m.jsxs("div",{className:"space-y-3",children:[m.jsxs("h3",{className:"text-[10px] font-black uppercase tracking-widest text-text-muted px-2 flex justify-between items-center",children:[m.jsx("span",{children:i("settings.available_templates")}),m.jsx("button",{className:"text-primary hover:text-white transition-colors",title:"Crear Nueva Plantilla",onClick:()=>I&&I(),children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"add"})})]}),_.length===0?m.jsx("div",{className:"p-6 text-center border border-dashed border-glass-border rounded-2xl opacity-30",children:m.jsx("p",{className:"text-[10px] uppercase font-bold",children:i("settings.no_templates")})}):_.map(De=>m.jsxs("button",{className:"w-full flex items-center gap-3 p-3 rounded-2xl bg-white/5 border border-glass-border hover:border-primary/50 hover:bg-primary/5 transition-all text-left group relative",draggable:!0,onDragStart:Le=>{Le.dataTransfer.setData("application/reactflow/type","attribute"),Le.dataTransfer.setData("templateId",De.id),Le.dataTransfer.effectAllowed="move"},onClick:()=>N&&N(De.id),children:[De.global&&m.jsx("span",{className:"absolute top-2 right-2 flex size-2 bg-blue-500 rounded-full shadow-lg shadow-blue-500/50",title:"Global"}),m.jsx("div",{className:"size-8 rounded-lg bg-surface-light flex items-center justify-center text-primary group-hover:scale-110 transition-transform",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:EE(De.tipo)})}),m.jsxs("div",{className:"overflow-hidden",children:[m.jsx("p",{className:"text-xs font-bold text-white truncate",children:De.nombre}),m.jsx("p",{className:"text-[10px] text-text-muted uppercase font-black tracking-tighter",children:De.tipo})]}),m.jsxs("div",{className:"absolute right-2 top-1/2 -translate-y-1/2 flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[m.jsx("div",{onClick:Le=>{Le.stopPropagation(),ge(De)},className:"p-1 hover:text-white text-text-muted hover:bg-white/10 rounded cursor-pointer",title:"Edit",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"edit"})}),m.jsx("div",{onClick:Le=>xe(Le,De.id),className:"p-1 hover:text-red-400 text-text-muted hover:bg-white/10 rounded cursor-pointer",title:"Delete",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})})]})]},De.id))]})}):null:m.jsx("div",{className:"flex flex-col items-center gap-4 py-4 w-full",children:y==="NOTES"||q?m.jsx("button",{onClick:()=>u(!0),className:"size-10 rounded-xl bg-white/5 flex items-center justify-center text-text-muted hover:text-white",title:"Notas Globales",children:m.jsx("span",{className:"material-symbols-outlined text-lg",children:"edit_note"})}):y==="MAP"?m.jsx("button",{onClick:()=>u(!0),className:"size-10 rounded-xl bg-white/5 flex items-center justify-center text-text-muted hover:text-white",title:"Ajustes de Mapa",children:m.jsx("span",{className:"material-symbols-outlined text-lg",children:"tune"})}):y==="ENTITY"?m.jsx("button",{onClick:()=>u(!0),className:"size-10 rounded-xl bg-white/5 flex items-center justify-center text-text-muted hover:text-white",title:"Atributos",children:m.jsx("span",{className:"material-symbols-outlined text-lg",children:"fact_check"})}):y==="CUSTOM"?m.jsx("button",{onClick:()=>u(!0),className:"size-10 rounded-xl bg-primary/10 border border-primary/20 flex items-center justify-center text-primary hover:bg-primary/20 transition-all",title:w||"Panel",children:m.jsx("span",{className:"material-symbols-outlined text-lg",children:"extension"})}):_.slice(0,5).map(De=>m.jsxs("button",{className:"size-10 rounded-xl bg-white/5 flex items-center justify-center text-text-muted hover:text-white hover:bg-primary/20 transition-all relative",draggable:!0,onDragStart:Le=>{Le.dataTransfer.setData("application/reactflow/type","attribute"),Le.dataTransfer.setData("templateId",De.id)},title:De.nombre,children:[De.global&&m.jsx("span",{className:"absolute top-0 right-0 size-2 bg-blue-500 rounded-full border border-surface-dark"}),m.jsx("span",{className:"material-symbols-outlined text-lg",children:EE(De.tipo)})]},De.id))})]})]}),de&&m.jsx("div",{className:"fixed inset-0 z-[100] bg-black/60 backdrop-blur-sm flex items-center justify-center p-4",children:m.jsxs("div",{className:"bg-surface-dark border border-glass-border rounded-2xl p-6 w-full max-w-md shadow-2xl animate-scale-in",children:[m.jsx("h3",{className:"text-xl font-black text-white mb-4",children:i("settings.edit_template")}),m.jsxs("form",{onSubmit:Ve,className:"space-y-4",children:[m.jsxs("div",{children:[m.jsx("label",{className:"text-xs uppercase font-bold text-text-muted block mb-1",children:i("settings.name")}),m.jsx("input",{autoFocus:!0,className:"w-full bg-black/30 border border-white/10 rounded-xl p-3 text-white focus:border-primary outline-none",value:de.nombre,onChange:De=>ge({...de,nombre:De.target.value}),required:!0})]}),m.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[m.jsxs("div",{children:[m.jsx("label",{className:"text-xs uppercase font-bold text-text-muted block mb-1",children:i("settings.type")}),m.jsxs("select",{className:"w-full bg-black/30 border border-white/10 rounded-xl p-3 text-white focus:border-primary outline-none",value:de.tipo,onChange:De=>ge({...de,tipo:De.target.value}),children:[m.jsx("option",{value:"text",children:"Texto Largo"}),m.jsx("option",{value:"short_text",children:"Texto Corto"}),m.jsx("option",{value:"number",children:"Nmero"}),m.jsx("option",{value:"boolean",children:"Si/No"}),m.jsx("option",{value:"date",children:"Fecha"}),m.jsx("option",{value:"entity_link",children:"Vnculo Entidad"}),m.jsx("option",{value:"image",children:"Imagen URL"})]})]}),m.jsx("div",{className:"flex items-center",children:m.jsxs("label",{className:"flex items-center gap-2 cursor-pointer p-3 bg-white/5 rounded-xl w-full hover:bg-white/10 transition-colors",children:[m.jsx("input",{type:"checkbox",checked:de.global,onChange:De=>ge({...de,global:De.target.checked}),className:"accent-primary size-4"}),m.jsx("span",{className:"text-sm font-bold text-white",children:i("settings.is_global")})]})})]}),m.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[m.jsx("button",{type:"button",onClick:()=>ge(null),className:"px-4 py-2 text-text-muted hover:text-white font-bold transition-colors",children:i("common.cancel")}),m.jsx("button",{type:"submit",className:"px-6 py-2 bg-primary text-white rounded-xl font-bold shadow-lg shadow-primary/20 hover:scale-105 transition-transform",children:i("common.save")})]})]})]})}),m.jsx(qv,{isOpen:!!pe,onClose:()=>me(null),onConfirm:Se,title:i("settings.delete_template"),message:i("common.are_you_sure"),confirmText:i("common.confirm_delete"),type:"danger"})]})};var zb={exports:{}},Ub,TE;function yj(){if(TE)return Ub;TE=1;var t="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return Ub=t,Ub}var Gb,NE;function xj(){if(NE)return Gb;NE=1;var t=yj();function e(){}function r(){}return r.resetWarningCache=e,Gb=function(){function n(s,o,l,u,c,h){if(h!==t){var p=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw p.name="Invariant Violation",p}}n.isRequired=n;function i(){return n}var a={array:n,bigint:n,bool:n,func:n,number:n,object:n,string:n,symbol:n,any:n,arrayOf:i,element:n,elementType:n,instanceOf:i,node:n,objectOf:i,oneOf:i,oneOfType:i,shape:i,exact:i,checkPropTypes:r,resetWarningCache:e};return a.PropTypes=a,a},Gb}var PE;function bj(){return PE||(PE=1,zb.exports=xj()()),zb.exports}var wj=bj();const Sj=Tf(wj);function LS(t,e){(e==null||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function kj(t){if(Array.isArray(t))return t}function _j(t){if(Array.isArray(t))return LS(t)}function ah(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Cj(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,AM(n.key),n)}}function sh(t,e,r){return e&&Cj(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function Ys(t,e){var r=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=Yk(t))||e){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a,s=!0,o=!1;return{s:function(){r=r.call(t)},n:function(){var l=r.next();return s=l.done,l},e:function(l){o=!0,a=l},f:function(){try{s||r.return==null||r.return()}finally{if(o)throw a}}}}function MM(t,e,r){return(e=AM(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Ej(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function Tj(t,e){var r=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(r!=null){var n,i,a,s,o=[],l=!0,u=!1;try{if(a=(r=r.call(t)).next,e===0){if(Object(r)!==r)return;l=!1}else for(;!(l=(n=a.call(r)).done)&&(o.push(n.value),o.length!==e);l=!0);}catch(c){u=!0,i=c}finally{try{if(!l&&r.return!=null&&(s=r.return(),Object(s)!==s))return}finally{if(u)throw i}}return o}}function Nj(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Pj(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ji(t,e){return kj(t)||Tj(t,e)||Yk(t,e)||Nj()}function nx(t){return _j(t)||Ej(t)||Yk(t)||Pj()}function Mj(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}function AM(t){var e=Mj(t,"string");return typeof e=="symbol"?e:e+""}function Yi(t){"@babel/helpers - typeof";return Yi=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Yi(t)}function Yk(t,e){if(t){if(typeof t=="string")return LS(t,e);var r={}.toString.call(t).slice(8,-1);return r==="Object"&&t.constructor&&(r=t.constructor.name),r==="Map"||r==="Set"?Array.from(t):r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?LS(t,e):void 0}}var $i=typeof window>"u"?null:window,ME=$i?$i.navigator:null;$i&&$i.document;var Aj=Yi(""),RM=Yi({}),Rj=Yi(function(){}),Lj=typeof HTMLElement>"u"?"undefined":Yi(HTMLElement),$v=function(e){return e&&e.instanceString&&ni(e.instanceString)?e.instanceString():null},Wt=function(e){return e!=null&&Yi(e)==Aj},ni=function(e){return e!=null&&Yi(e)===Rj},xn=function(e){return!po(e)&&(Array.isArray?Array.isArray(e):e!=null&&e instanceof Array)},Fr=function(e){return e!=null&&Yi(e)===RM&&!xn(e)&&e.constructor===Object},Oj=function(e){return e!=null&&Yi(e)===RM},bt=function(e){return e!=null&&Yi(e)===Yi(1)&&!isNaN(e)},Dj=function(e){return bt(e)&&Math.floor(e)===e},ix=function(e){if(Lj!=="undefined")return e!=null&&e instanceof HTMLElement},po=function(e){return Kv(e)||LM(e)},Kv=function(e){return $v(e)==="collection"&&e._private.single},LM=function(e){return $v(e)==="collection"&&!e._private.single},Xk=function(e){return $v(e)==="core"},OM=function(e){return $v(e)==="stylesheet"},Ij=function(e){return $v(e)==="event"},Zd=function(e){return e==null?!0:!!(e===""||e.match(/^\s+$/))},jj=function(e){return typeof HTMLElement>"u"?!1:e instanceof HTMLElement},Fj=function(e){return Fr(e)&&bt(e.x1)&&bt(e.x2)&&bt(e.y1)&&bt(e.y2)},Bj=function(e){return Oj(e)&&ni(e.then)},zj=function(){return ME&&ME.userAgent.match(/msie|trident|edge/i)},Wp=function(e,r){r||(r=function(){if(arguments.length===1)return arguments[0];if(arguments.length===0)return"undefined";for(var a=[],s=0;s<arguments.length;s++)a.push(arguments[s]);return a.join("$")});var n=function(){var a=this,s=arguments,o,l=r.apply(a,s),u=n.cache;return(o=u[l])||(o=u[l]=e.apply(a,s)),o};return n.cache={},n},Qk=Wp(function(t){return t.replace(/([A-Z])/g,function(e){return"-"+e.toLowerCase()})}),b1=Wp(function(t){return t.replace(/(-\w)/g,function(e){return e[1].toUpperCase()})}),DM=Wp(function(t,e){return t+e[0].toUpperCase()+e.substring(1)},function(t,e){return t+"$"+e}),AE=function(e){return Zd(e)?e:e.charAt(0).toUpperCase()+e.substring(1)},Ld=function(e,r){return e.slice(-1*r.length)===r},Ki="(?:[-+]?(?:(?:\\d+|\\d*\\.\\d+)(?:[Ee][+-]?\\d+)?))",Uj="rgb[a]?\\(("+Ki+"[%]?)\\s*,\\s*("+Ki+"[%]?)\\s*,\\s*("+Ki+"[%]?)(?:\\s*,\\s*("+Ki+"))?\\)",Gj="rgb[a]?\\((?:"+Ki+"[%]?)\\s*,\\s*(?:"+Ki+"[%]?)\\s*,\\s*(?:"+Ki+"[%]?)(?:\\s*,\\s*(?:"+Ki+"))?\\)",Vj="hsl[a]?\\(("+Ki+")\\s*,\\s*("+Ki+"[%])\\s*,\\s*("+Ki+"[%])(?:\\s*,\\s*("+Ki+"))?\\)",Hj="hsl[a]?\\((?:"+Ki+")\\s*,\\s*(?:"+Ki+"[%])\\s*,\\s*(?:"+Ki+"[%])(?:\\s*,\\s*(?:"+Ki+"))?\\)",Wj="\\#[0-9a-fA-F]{3}",qj="\\#[0-9a-fA-F]{6}",IM=function(e,r){return e<r?-1:e>r?1:0},$j=function(e,r){return-1*IM(e,r)},er=Object.assign!=null?Object.assign.bind(Object):function(t){for(var e=arguments,r=1;r<e.length;r++){var n=e[r];if(n!=null)for(var i=Object.keys(n),a=0;a<i.length;a++){var s=i[a];t[s]=n[s]}}return t},Kj=function(e){if(!(!(e.length===4||e.length===7)||e[0]!=="#")){var r=e.length===4,n,i,a,s=16;return r?(n=parseInt(e[1]+e[1],s),i=parseInt(e[2]+e[2],s),a=parseInt(e[3]+e[3],s)):(n=parseInt(e[1]+e[2],s),i=parseInt(e[3]+e[4],s),a=parseInt(e[5]+e[6],s)),[n,i,a]}},Zj=function(e){var r,n,i,a,s,o,l,u;function c(y,S,w){return w<0&&(w+=1),w>1&&(w-=1),w<1/6?y+(S-y)*6*w:w<1/2?S:w<2/3?y+(S-y)*(2/3-w)*6:y}var h=new RegExp("^"+Vj+"$").exec(e);if(h){if(n=parseInt(h[1]),n<0?n=(360- -1*n%360)%360:n>360&&(n=n%360),n/=360,i=parseFloat(h[2]),i<0||i>100||(i=i/100,a=parseFloat(h[3]),a<0||a>100)||(a=a/100,s=h[4],s!==void 0&&(s=parseFloat(s),s<0||s>1)))return;if(i===0)o=l=u=Math.round(a*255);else{var p=a<.5?a*(1+i):a+i-a*i,v=2*a-p;o=Math.round(255*c(v,p,n+1/3)),l=Math.round(255*c(v,p,n)),u=Math.round(255*c(v,p,n-1/3))}r=[o,l,u,s]}return r},Yj=function(e){var r,n=new RegExp("^"+Uj+"$").exec(e);if(n){r=[];for(var i=[],a=1;a<=3;a++){var s=n[a];if(s[s.length-1]==="%"&&(i[a]=!0),s=parseFloat(s),i[a]&&(s=s/100*255),s<0||s>255)return;r.push(Math.floor(s))}var o=i[1]||i[2]||i[3],l=i[1]&&i[2]&&i[3];if(o&&!l)return;var u=n[4];if(u!==void 0){if(u=parseFloat(u),u<0||u>1)return;r.push(u)}}return r},Xj=function(e){return Qj[e.toLowerCase()]},jM=function(e){return(xn(e)?e:null)||Xj(e)||Kj(e)||Yj(e)||Zj(e)},Qj={transparent:[0,0,0,0],aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],grey:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},FM=function(e){for(var r=e.map,n=e.keys,i=n.length,a=0;a<i;a++){var s=n[a];if(Fr(s))throw Error("Tried to set map with object key");a<n.length-1?(r[s]==null&&(r[s]={}),r=r[s]):r[s]=e.value}},BM=function(e){for(var r=e.map,n=e.keys,i=n.length,a=0;a<i;a++){var s=n[a];if(Fr(s))throw Error("Tried to get map with object key");if(r=r[s],r==null)return r}return r},Z0=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Zv(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Vb,RE;function Yv(){if(RE)return Vb;RE=1;function t(e){var r=typeof e;return e!=null&&(r=="object"||r=="function")}return Vb=t,Vb}var Hb,LE;function Jj(){if(LE)return Hb;LE=1;var t=typeof Z0=="object"&&Z0&&Z0.Object===Object&&Z0;return Hb=t,Hb}var Wb,OE;function w1(){if(OE)return Wb;OE=1;var t=Jj(),e=typeof self=="object"&&self&&self.Object===Object&&self,r=t||e||Function("return this")();return Wb=r,Wb}var qb,DE;function e9(){if(DE)return qb;DE=1;var t=w1(),e=function(){return t.Date.now()};return qb=e,qb}var $b,IE;function t9(){if(IE)return $b;IE=1;var t=/\s/;function e(r){for(var n=r.length;n--&&t.test(r.charAt(n)););return n}return $b=e,$b}var Kb,jE;function r9(){if(jE)return Kb;jE=1;var t=t9(),e=/^\s+/;function r(n){return n&&n.slice(0,t(n)+1).replace(e,"")}return Kb=r,Kb}var Zb,FE;function Jk(){if(FE)return Zb;FE=1;var t=w1(),e=t.Symbol;return Zb=e,Zb}var Yb,BE;function n9(){if(BE)return Yb;BE=1;var t=Jk(),e=Object.prototype,r=e.hasOwnProperty,n=e.toString,i=t?t.toStringTag:void 0;function a(s){var o=r.call(s,i),l=s[i];try{s[i]=void 0;var u=!0}catch{}var c=n.call(s);return u&&(o?s[i]=l:delete s[i]),c}return Yb=a,Yb}var Xb,zE;function i9(){if(zE)return Xb;zE=1;var t=Object.prototype,e=t.toString;function r(n){return e.call(n)}return Xb=r,Xb}var Qb,UE;function zM(){if(UE)return Qb;UE=1;var t=Jk(),e=n9(),r=i9(),n="[object Null]",i="[object Undefined]",a=t?t.toStringTag:void 0;function s(o){return o==null?o===void 0?i:n:a&&a in Object(o)?e(o):r(o)}return Qb=s,Qb}var Jb,GE;function a9(){if(GE)return Jb;GE=1;function t(e){return e!=null&&typeof e=="object"}return Jb=t,Jb}var ew,VE;function Xv(){if(VE)return ew;VE=1;var t=zM(),e=a9(),r="[object Symbol]";function n(i){return typeof i=="symbol"||e(i)&&t(i)==r}return ew=n,ew}var tw,HE;function s9(){if(HE)return tw;HE=1;var t=r9(),e=Yv(),r=Xv(),n=NaN,i=/^[-+]0x[0-9a-f]+$/i,a=/^0b[01]+$/i,s=/^0o[0-7]+$/i,o=parseInt;function l(u){if(typeof u=="number")return u;if(r(u))return n;if(e(u)){var c=typeof u.valueOf=="function"?u.valueOf():u;u=e(c)?c+"":c}if(typeof u!="string")return u===0?u:+u;u=t(u);var h=a.test(u);return h||s.test(u)?o(u.slice(2),h?2:8):i.test(u)?n:+u}return tw=l,tw}var rw,WE;function o9(){if(WE)return rw;WE=1;var t=Yv(),e=e9(),r=s9(),n="Expected a function",i=Math.max,a=Math.min;function s(o,l,u){var c,h,p,v,y,S,w=0,T=!1,_=!1,C=!0;if(typeof o!="function")throw new TypeError(n);l=r(l)||0,t(u)&&(T=!!u.leading,_="maxWait"in u,p=_?i(r(u.maxWait)||0,l):p,C="trailing"in u?!!u.trailing:C);function N(D){var H=c,U=h;return c=h=void 0,w=D,v=o.apply(U,H),v}function A(D){return w=D,y=setTimeout(O,l),T?N(D):v}function I(D){var H=D-S,U=D-w,W=l-H;return _?a(W,p-U):W}function j(D){var H=D-S,U=D-w;return S===void 0||H>=l||H<0||_&&U>=p}function O(){var D=e();if(j(D))return F(D);y=setTimeout(O,I(D))}function F(D){return y=void 0,C&&c?N(D):(c=h=void 0,v)}function B(){y!==void 0&&clearTimeout(y),w=0,c=S=h=y=void 0}function $(){return y===void 0?v:F(e())}function Z(){var D=e(),H=j(D);if(c=arguments,h=this,S=D,H){if(y===void 0)return A(S);if(_)return clearTimeout(y),y=setTimeout(O,l),N(S)}return y===void 0&&(y=setTimeout(O,l)),v}return Z.cancel=B,Z.flush=$,Z}return rw=s,rw}var l9=o9(),Qv=Zv(l9),nw=$i?$i.performance:null,UM=nw&&nw.now?function(){return nw.now()}:function(){return Date.now()},u9=(function(){if($i){if($i.requestAnimationFrame)return function(t){$i.requestAnimationFrame(t)};if($i.mozRequestAnimationFrame)return function(t){$i.mozRequestAnimationFrame(t)};if($i.webkitRequestAnimationFrame)return function(t){$i.webkitRequestAnimationFrame(t)};if($i.msRequestAnimationFrame)return function(t){$i.msRequestAnimationFrame(t)}}return function(t){t&&setTimeout(function(){t(UM())},1e3/60)}})(),ax=function(e){return u9(e)},gc=UM,Yh=9261,GM=65599,Cp=5381,VM=function(e){for(var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Yh,n=r,i;i=e.next(),!i.done;)n=n*GM+i.value|0;return n},yv=function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Yh;return r*GM+e|0},xv=function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Cp;return(r<<5)+r+e|0},c9=function(e,r){return e*2097152+r},vd=function(e){return e[0]*2097152+e[1]},Y0=function(e,r){return[yv(e[0],r[0]),xv(e[1],r[1])]},qE=function(e,r){var n={value:0,done:!1},i=0,a=e.length,s={next:function(){return i<a?n.value=e[i++]:n.done=!0,n}};return VM(s,r)},pf=function(e,r){var n={value:0,done:!1},i=0,a=e.length,s={next:function(){return i<a?n.value=e.charCodeAt(i++):n.done=!0,n}};return VM(s,r)},HM=function(){return d9(arguments)},d9=function(e){for(var r,n=0;n<e.length;n++){var i=e[n];n===0?r=pf(i):r=pf(i,r)}return r};function h9(t,e,r,n,i){var a=i*Math.PI/180,s=Math.cos(a)*(t-r)-Math.sin(a)*(e-n)+r,o=Math.sin(a)*(t-r)+Math.cos(a)*(e-n)+n;return{x:s,y:o}}var f9=function(e,r,n,i,a,s){return{x:(e-n)*a+n,y:(r-i)*s+i}};function p9(t,e,r){if(r===0)return t;var n=(e.x1+e.x2)/2,i=(e.y1+e.y2)/2,a=e.w/e.h,s=1/a,o=h9(t.x,t.y,n,i,r),l=f9(o.x,o.y,n,i,a,s);return{x:l.x,y:l.y}}var $E=!0,m9=console.warn!=null,g9=console.trace!=null,e_=Number.MAX_SAFE_INTEGER||9007199254740991,WM=function(){return!0},sx=function(){return!1},KE=function(){return 0},t_=function(){},Kn=function(e){throw new Error(e)},qM=function(e){if(e!==void 0)$E=!!e;else return $E},rn=function(e){qM()&&(m9?console.warn(e):(console.log(e),g9&&console.trace()))},v9=function(e){return er({},e)},ku=function(e){return e==null?e:xn(e)?e.slice():Fr(e)?v9(e):e},y9=function(e){return e.slice()},$M=function(e,r){for(r=e="";e++<36;r+=e*51&52?(e^15?8^Math.random()*(e^20?16:4):4).toString(16):"-");return r},x9={},KM=function(){return x9},qa=function(e){var r=Object.keys(e);return function(n){for(var i={},a=0;a<r.length;a++){var s=r[a],o=n?.[s];i[s]=o===void 0?e[s]:o}return i}},Yd=function(e,r,n){for(var i=e.length-1;i>=0;i--)e[i]===r&&e.splice(i,1)},r_=function(e){e.splice(0,e.length)},b9=function(e,r){for(var n=0;n<r.length;n++){var i=r[n];e.push(i)}},$s=function(e,r,n){return n&&(r=DM(n,r)),e[r]},uc=function(e,r,n,i){n&&(r=DM(n,r)),e[r]=i},w9=(function(){function t(){ah(this,t),this._obj={}}return sh(t,[{key:"set",value:function(r,n){return this._obj[r]=n,this}},{key:"delete",value:function(r){return this._obj[r]=void 0,this}},{key:"clear",value:function(){this._obj={}}},{key:"has",value:function(r){return this._obj[r]!==void 0}},{key:"get",value:function(r){return this._obj[r]}}])})(),cc=typeof Map<"u"?Map:w9,S9="undefined",k9=(function(){function t(e){if(ah(this,t),this._obj=Object.create(null),this.size=0,e!=null){var r;e.instanceString!=null&&e.instanceString()===this.instanceString()?r=e.toArray():r=e;for(var n=0;n<r.length;n++)this.add(r[n])}}return sh(t,[{key:"instanceString",value:function(){return"set"}},{key:"add",value:function(r){var n=this._obj;n[r]!==1&&(n[r]=1,this.size++)}},{key:"delete",value:function(r){var n=this._obj;n[r]===1&&(n[r]=0,this.size--)}},{key:"clear",value:function(){this._obj=Object.create(null)}},{key:"has",value:function(r){return this._obj[r]===1}},{key:"toArray",value:function(){var r=this;return Object.keys(this._obj).filter(function(n){return r.has(n)})}},{key:"forEach",value:function(r,n){return this.toArray().forEach(r,n)}}])})(),um=(typeof Set>"u"?"undefined":Yi(Set))!==S9?Set:k9,S1=function(e,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(e===void 0||r===void 0||!Xk(e)){Kn("An element must have a core reference and parameters set");return}var i=r.group;if(i==null&&(r.data&&r.data.source!=null&&r.data.target!=null?i="edges":i="nodes"),i!=="nodes"&&i!=="edges"){Kn("An element must be of type `nodes` or `edges`; you specified `"+i+"`");return}this.length=1,this[0]=this;var a=this._private={cy:e,single:!0,data:r.data||{},position:r.position||{x:0,y:0},autoWidth:void 0,autoHeight:void 0,autoPadding:void 0,compoundBoundsClean:!1,listeners:[],group:i,style:{},rstyle:{},styleCxts:[],styleKeys:{},removed:!0,selected:!!r.selected,selectable:r.selectable===void 0?!0:!!r.selectable,locked:!!r.locked,grabbed:!1,grabbable:r.grabbable===void 0?!0:!!r.grabbable,pannable:r.pannable===void 0?i==="edges":!!r.pannable,active:!1,classes:new um,animation:{current:[],queue:[]},rscratch:{},scratch:r.scratch||{},edges:[],children:[],parent:r.parent&&r.parent.isNode()?r.parent:null,traversalCache:{},backgrounding:!1,bbCache:null,bbCacheShift:{x:0,y:0},bodyBounds:null,overlayBounds:null,labelBounds:{all:null,source:null,target:null,main:null},arrowBounds:{source:null,target:null,"mid-source":null,"mid-target":null}};if(a.position.x==null&&(a.position.x=0),a.position.y==null&&(a.position.y=0),r.renderedPosition){var s=r.renderedPosition,o=e.pan(),l=e.zoom();a.position={x:(s.x-o.x)/l,y:(s.y-o.y)/l}}var u=[];xn(r.classes)?u=r.classes:Wt(r.classes)&&(u=r.classes.split(/\s+/));for(var c=0,h=u.length;c<h;c++){var p=u[c];!p||p===""||a.classes.add(p)}this.createEmitter(),(n===void 0||n)&&this.restore();var v=r.style||r.css;v&&(rn("Setting a `style` bypass at element creation should be done only when absolutely necessary.  Try to use the stylesheet instead."),this.style(v))},ZE=function(e){return e={bfs:e.bfs||!e.dfs,dfs:e.dfs||!e.bfs},function(n,i,a){var s;Fr(n)&&!po(n)&&(s=n,n=s.roots||s.root,i=s.visit,a=s.directed),a=arguments.length===2&&!ni(i)?i:a,i=ni(i)?i:function(){};for(var o=this._private.cy,l=n=Wt(n)?this.filter(n):n,u=[],c=[],h={},p={},v={},y=0,S,w=this.byGroup(),T=w.nodes,_=w.edges,C=0;C<l.length;C++){var N=l[C],A=N.id();N.isNode()&&(u.unshift(N),e.bfs&&(v[A]=!0,c.push(N)),p[A]=0)}for(var I=function(){var D=e.bfs?u.shift():u.pop(),H=D.id();if(e.dfs){if(v[H])return 0;v[H]=!0,c.push(D)}var U=p[H],W=h[H],Y=W!=null?W.source():null,Q=W!=null?W.target():null,ne=W==null?void 0:D.same(Y)?Q[0]:Y[0],re;if(re=i(D,W,ne,y++,U),re===!0)return S=D,1;if(re===!1)return 1;for(var q=D.connectedEdges().filter(function(ye){return(!a||ye.source().same(D))&&_.has(ye)}),te=0;te<q.length;te++){var ae=q[te],de=ae.connectedNodes().filter(function(ye){return!ye.same(D)&&T.has(ye)}),ge=de.id();de.length!==0&&!v[ge]&&(de=de[0],u.push(de),e.bfs&&(v[ge]=!0,c.push(de)),h[ge]=ae,p[ge]=p[H]+1)}},j;u.length!==0&&(j=I(),!(j!==0&&j===1)););for(var O=o.collection(),F=0;F<c.length;F++){var B=c[F],$=h[B.id()];$!=null&&O.push($),O.push(B)}return{path:o.collection(O),found:o.collection(S)}}},bv={breadthFirstSearch:ZE({bfs:!0}),depthFirstSearch:ZE({dfs:!0})};bv.bfs=bv.breadthFirstSearch;bv.dfs=bv.depthFirstSearch;var Oy={exports:{}},_9=Oy.exports,YE;function C9(){return YE||(YE=1,(function(t,e){(function(){var r,n,i,a,s,o,l,u,c,h,p,v,y,S,w;i=Math.floor,h=Math.min,n=function(T,_){return T<_?-1:T>_?1:0},c=function(T,_,C,N,A){var I;if(C==null&&(C=0),A==null&&(A=n),C<0)throw new Error("lo must be non-negative");for(N==null&&(N=T.length);C<N;)I=i((C+N)/2),A(_,T[I])<0?N=I:C=I+1;return[].splice.apply(T,[C,C-C].concat(_)),_},o=function(T,_,C){return C==null&&(C=n),T.push(_),S(T,0,T.length-1,C)},s=function(T,_){var C,N;return _==null&&(_=n),C=T.pop(),T.length?(N=T[0],T[0]=C,w(T,0,_)):N=C,N},u=function(T,_,C){var N;return C==null&&(C=n),N=T[0],T[0]=_,w(T,0,C),N},l=function(T,_,C){var N;return C==null&&(C=n),T.length&&C(T[0],_)<0&&(N=[T[0],_],_=N[0],T[0]=N[1],w(T,0,C)),_},a=function(T,_){var C,N,A,I,j,O;for(_==null&&(_=n),I=(function(){O=[];for(var F=0,B=i(T.length/2);0<=B?F<B:F>B;0<=B?F++:F--)O.push(F);return O}).apply(this).reverse(),j=[],N=0,A=I.length;N<A;N++)C=I[N],j.push(w(T,C,_));return j},y=function(T,_,C){var N;if(C==null&&(C=n),N=T.indexOf(_),N!==-1)return S(T,0,N,C),w(T,N,C)},p=function(T,_,C){var N,A,I,j,O;if(C==null&&(C=n),A=T.slice(0,_),!A.length)return A;for(a(A,C),O=T.slice(_),I=0,j=O.length;I<j;I++)N=O[I],l(A,N,C);return A.sort(C).reverse()},v=function(T,_,C){var N,A,I,j,O,F,B,$,Z;if(C==null&&(C=n),_*10<=T.length){if(I=T.slice(0,_).sort(C),!I.length)return I;for(A=I[I.length-1],B=T.slice(_),j=0,F=B.length;j<F;j++)N=B[j],C(N,A)<0&&(c(I,N,0,null,C),I.pop(),A=I[I.length-1]);return I}for(a(T,C),Z=[],O=0,$=h(_,T.length);0<=$?O<$:O>$;0<=$?++O:--O)Z.push(s(T,C));return Z},S=function(T,_,C,N){var A,I,j;for(N==null&&(N=n),A=T[C];C>_;){if(j=C-1>>1,I=T[j],N(A,I)<0){T[C]=I,C=j;continue}break}return T[C]=A},w=function(T,_,C){var N,A,I,j,O;for(C==null&&(C=n),A=T.length,O=_,I=T[_],N=2*_+1;N<A;)j=N+1,j<A&&!(C(T[N],T[j])<0)&&(N=j),T[_]=T[N],_=N,N=2*_+1;return T[_]=I,S(T,O,_,C)},r=(function(){T.push=o,T.pop=s,T.replace=u,T.pushpop=l,T.heapify=a,T.updateItem=y,T.nlargest=p,T.nsmallest=v;function T(_){this.cmp=_??n,this.nodes=[]}return T.prototype.push=function(_){return o(this.nodes,_,this.cmp)},T.prototype.pop=function(){return s(this.nodes,this.cmp)},T.prototype.peek=function(){return this.nodes[0]},T.prototype.contains=function(_){return this.nodes.indexOf(_)!==-1},T.prototype.replace=function(_){return u(this.nodes,_,this.cmp)},T.prototype.pushpop=function(_){return l(this.nodes,_,this.cmp)},T.prototype.heapify=function(){return a(this.nodes,this.cmp)},T.prototype.updateItem=function(_){return y(this.nodes,_,this.cmp)},T.prototype.clear=function(){return this.nodes=[]},T.prototype.empty=function(){return this.nodes.length===0},T.prototype.size=function(){return this.nodes.length},T.prototype.clone=function(){var _;return _=new T,_.nodes=this.nodes.slice(0),_},T.prototype.toArray=function(){return this.nodes.slice(0)},T.prototype.insert=T.prototype.push,T.prototype.top=T.prototype.peek,T.prototype.front=T.prototype.peek,T.prototype.has=T.prototype.contains,T.prototype.copy=T.prototype.clone,T})(),(function(T,_){return t.exports=_()})(this,function(){return r})}).call(_9)})(Oy)),Oy.exports}var iw,XE;function E9(){return XE||(XE=1,iw=C9()),iw}var T9=E9(),Jv=Zv(T9),N9=qa({root:null,weight:function(e){return 1},directed:!1}),P9={dijkstra:function(e){if(!Fr(e)){var r=arguments;e={root:r[0],weight:r[1],directed:r[2]}}var n=N9(e),i=n.root,a=n.weight,s=n.directed,o=this,l=a,u=Wt(i)?this.filter(i)[0]:i[0],c={},h={},p={},v=this.byGroup(),y=v.nodes,S=v.edges;S.unmergeBy(function(U){return U.isLoop()});for(var w=function(W){return c[W.id()]},T=function(W,Y){c[W.id()]=Y,_.updateItem(W)},_=new Jv(function(U,W){return w(U)-w(W)}),C=0;C<y.length;C++){var N=y[C];c[N.id()]=N.same(u)?0:1/0,_.push(N)}for(var A=function(W,Y){for(var Q=(s?W.edgesTo(Y):W.edgesWith(Y)).intersect(S),ne=1/0,re,q=0;q<Q.length;q++){var te=Q[q],ae=l(te);(ae<ne||!re)&&(ne=ae,re=te)}return{edge:re,dist:ne}};_.size()>0;){var I=_.pop(),j=w(I),O=I.id();if(p[O]=j,j!==1/0)for(var F=I.neighborhood().intersect(y),B=0;B<F.length;B++){var $=F[B],Z=$.id(),D=A(I,$),H=j+D.dist;H<w($)&&(T($,H),h[Z]={node:I,edge:D.edge})}}return{distanceTo:function(W){var Y=Wt(W)?y.filter(W)[0]:W[0];return p[Y.id()]},pathTo:function(W){var Y=Wt(W)?y.filter(W)[0]:W[0],Q=[],ne=Y,re=ne.id();if(Y.length>0)for(Q.unshift(Y);h[re];){var q=h[re];Q.unshift(q.edge),Q.unshift(q.node),ne=q.node,re=ne.id()}return o.spawn(Q)}}}},M9={kruskal:function(e){e=e||function(C){return 1};for(var r=this.byGroup(),n=r.nodes,i=r.edges,a=n.length,s=new Array(a),o=n,l=function(N){for(var A=0;A<s.length;A++){var I=s[A];if(I.has(N))return A}},u=0;u<a;u++)s[u]=this.spawn(n[u]);for(var c=i.sort(function(C,N){return e(C)-e(N)}),h=0;h<c.length;h++){var p=c[h],v=p.source()[0],y=p.target()[0],S=l(v),w=l(y),T=s[S],_=s[w];S!==w&&(o.merge(p),T.merge(_),s.splice(w,1))}return o}},A9=qa({root:null,goal:null,weight:function(e){return 1},heuristic:function(e){return 0},directed:!1}),R9={aStar:function(e){var r=this.cy(),n=A9(e),i=n.root,a=n.goal,s=n.heuristic,o=n.directed,l=n.weight;i=r.collection(i)[0],a=r.collection(a)[0];var u=i.id(),c=a.id(),h={},p={},v={},y=new Jv(function(re,q){return p[re.id()]-p[q.id()]}),S=new um,w={},T={},_=function(q,te){y.push(q),S.add(te)},C,N,A=function(){C=y.pop(),N=C.id(),S.delete(N)},I=function(q){return S.has(q)};_(i,u),h[u]=0,p[u]=s(i);for(var j=0;y.size()>0;){if(A(),j++,N===c){for(var O=[],F=a,B=c,$=T[B];O.unshift(F),$!=null&&O.unshift($),F=w[B],F!=null;)B=F.id(),$=T[B];return{found:!0,distance:h[N],path:this.spawn(O),steps:j}}v[N]=!0;for(var Z=C._private.edges,D=0;D<Z.length;D++){var H=Z[D];if(this.hasElementWithId(H.id())&&!(o&&H.data("source")!==N)){var U=H.source(),W=H.target(),Y=U.id()!==N?U:W,Q=Y.id();if(this.hasElementWithId(Q)&&!v[Q]){var ne=h[N]+l(H);if(!I(Q)){h[Q]=ne,p[Q]=ne+s(Y),_(Y,Q),w[Q]=C,T[Q]=H;continue}ne<h[Q]&&(h[Q]=ne,p[Q]=ne+s(Y),w[Q]=C,T[Q]=H)}}}}return{found:!1,distance:void 0,path:void 0,steps:j}}},L9=qa({weight:function(e){return 1},directed:!1}),O9={floydWarshall:function(e){for(var r=this.cy(),n=L9(e),i=n.weight,a=n.directed,s=i,o=this.byGroup(),l=o.nodes,u=o.edges,c=l.length,h=c*c,p=function(ae){return l.indexOf(ae)},v=function(ae){return l[ae]},y=new Array(h),S=0;S<h;S++){var w=S%c,T=(S-w)/c;T===w?y[S]=0:y[S]=1/0}for(var _=new Array(h),C=new Array(h),N=0;N<u.length;N++){var A=u[N],I=A.source()[0],j=A.target()[0];if(I!==j){var O=p(I),F=p(j),B=O*c+F,$=s(A);if(y[B]>$&&(y[B]=$,_[B]=F,C[B]=A),!a){var Z=F*c+O;!a&&y[Z]>$&&(y[Z]=$,_[Z]=O,C[Z]=A)}}}for(var D=0;D<c;D++)for(var H=0;H<c;H++)for(var U=H*c+D,W=0;W<c;W++){var Y=H*c+W,Q=D*c+W;y[U]+y[Q]<y[Y]&&(y[Y]=y[U]+y[Q],_[Y]=_[U])}var ne=function(ae){return(Wt(ae)?r.filter(ae):ae)[0]},re=function(ae){return p(ne(ae))},q={distance:function(ae,de){var ge=re(ae),ye=re(de);return y[ge*c+ye]},path:function(ae,de){var ge=re(ae),ye=re(de),se=v(ge);if(ge===ye)return se.collection();if(_[ge*c+ye]==null)return r.collection();var fe=r.collection(),le=ge,pe;for(fe.merge(se);ge!==ye;)le=ge,ge=_[ge*c+ye],pe=C[le*c+ge],fe.merge(pe),fe.merge(v(ge));return fe}};return q}},D9=qa({weight:function(e){return 1},directed:!1,root:null}),I9={bellmanFord:function(e){var r=this,n=D9(e),i=n.weight,a=n.directed,s=n.root,o=i,l=this,u=this.cy(),c=this.byGroup(),h=c.edges,p=c.nodes,v=p.length,y=new cc,S=!1,w=[];s=u.collection(s)[0],h.unmergeBy(function(rt){return rt.isLoop()});for(var T=h.length,_=function(lt){var De=y.get(lt.id());return De||(De={},y.set(lt.id(),De)),De},C=function(lt){return(Wt(lt)?u.$(lt):lt)[0]},N=function(lt){return _(C(lt)).dist},A=function(lt){for(var De=arguments.length>1&&arguments[1]!==void 0?arguments[1]:s,Le=C(lt),Qe=[],Ce=Le;;){if(Ce==null)return r.spawn();var Fe=_(Ce),Ke=Fe.edge,mt=Fe.pred;if(Qe.unshift(Ce[0]),Ce.same(De)&&Qe.length>0)break;Ke!=null&&Qe.unshift(Ke),Ce=mt}return l.spawn(Qe)},I=0;I<v;I++){var j=p[I],O=_(j);j.same(s)?O.dist=0:O.dist=1/0,O.pred=null,O.edge=null}for(var F=!1,B=function(lt,De,Le,Qe,Ce,Fe){var Ke=Qe.dist+Fe;Ke<Ce.dist&&!Le.same(Qe.edge)&&(Ce.dist=Ke,Ce.pred=lt,Ce.edge=Le,F=!0)},$=1;$<v;$++){F=!1;for(var Z=0;Z<T;Z++){var D=h[Z],H=D.source(),U=D.target(),W=o(D),Y=_(H),Q=_(U);B(H,U,D,Y,Q,W),a||B(U,H,D,Q,Y,W)}if(!F)break}if(F)for(var ne=[],re=0;re<T;re++){var q=h[re],te=q.source(),ae=q.target(),de=o(q),ge=_(te).dist,ye=_(ae).dist;if(ge+de<ye||!a&&ye+de<ge)if(S||(rn("Graph contains a negative weight cycle for Bellman-Ford"),S=!0),e.findNegativeWeightCycles!==!1){var se=[];ge+de<ye&&se.push(te),!a&&ye+de<ge&&se.push(ae);for(var fe=se.length,le=0;le<fe;le++){var pe=se[le],me=[pe];me.push(_(pe).edge);for(var xe=_(pe).pred;me.indexOf(xe)===-1;)me.push(xe),me.push(_(xe).edge),xe=_(xe).pred;me=me.slice(me.indexOf(xe));for(var Se=me[0].id(),Ve=0,$e=2;$e<me.length;$e+=2)me[$e].id()<Se&&(Se=me[$e].id(),Ve=$e);me=me.slice(Ve).concat(me.slice(0,Ve)),me.push(me[0]);var St=me.map(function(rt){return rt.id()}).join(",");ne.indexOf(St)===-1&&(w.push(l.spawn(me)),ne.push(St))}}else break}return{distanceTo:N,pathTo:A,hasNegativeWeightCycle:S,negativeWeightCycles:w}}},j9=Math.sqrt(2),F9=function(e,r,n){n.length===0&&Kn("Karger-Stein must be run on a connected (sub)graph");for(var i=n[e],a=i[1],s=i[2],o=r[a],l=r[s],u=n,c=u.length-1;c>=0;c--){var h=u[c],p=h[1],v=h[2];(r[p]===o&&r[v]===l||r[p]===l&&r[v]===o)&&u.splice(c,1)}for(var y=0;y<u.length;y++){var S=u[y];S[1]===l?(u[y]=S.slice(),u[y][1]=o):S[2]===l&&(u[y]=S.slice(),u[y][2]=o)}for(var w=0;w<r.length;w++)r[w]===l&&(r[w]=o);return u},aw=function(e,r,n,i){for(;n>i;){var a=Math.floor(Math.random()*r.length);r=F9(a,e,r),n--}return r},B9={kargerStein:function(){var e=this,r=this.byGroup(),n=r.nodes,i=r.edges;i.unmergeBy(function(Q){return Q.isLoop()});var a=n.length,s=i.length,o=Math.ceil(Math.pow(Math.log(a)/Math.LN2,2)),l=Math.floor(a/j9);if(a<2){Kn("At least 2 nodes are required for Karger-Stein algorithm");return}for(var u=[],c=0;c<s;c++){var h=i[c];u.push([c,n.indexOf(h.source()),n.indexOf(h.target())])}for(var p=1/0,v=[],y=new Array(a),S=new Array(a),w=new Array(a),T=function(ne,re){for(var q=0;q<a;q++)re[q]=ne[q]},_=0;_<=o;_++){for(var C=0;C<a;C++)S[C]=C;var N=aw(S,u.slice(),a,l),A=N.slice();T(S,w);var I=aw(S,N,l,2),j=aw(w,A,l,2);I.length<=j.length&&I.length<p?(p=I.length,v=I,T(S,y)):j.length<=I.length&&j.length<p&&(p=j.length,v=j,T(w,y))}for(var O=this.spawn(v.map(function(Q){return i[Q[0]]})),F=this.spawn(),B=this.spawn(),$=y[0],Z=0;Z<y.length;Z++){var D=y[Z],H=n[Z];D===$?F.merge(H):B.merge(H)}var U=function(ne){var re=e.spawn();return ne.forEach(function(q){re.merge(q),q.connectedEdges().forEach(function(te){e.contains(te)&&!O.contains(te)&&re.merge(te)})}),re},W=[U(F),U(B)],Y={cut:O,components:W,partition1:F,partition2:B};return Y}},sw,z9=function(e){return{x:e.x,y:e.y}},k1=function(e,r,n){return{x:e.x*r+n.x,y:e.y*r+n.y}},ZM=function(e,r,n){return{x:(e.x-n.x)/r,y:(e.y-n.y)/r}},Rp=function(e){return{x:e[0],y:e[1]}},U9=function(e){for(var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:e.length,i=1/0,a=r;a<n;a++){var s=e[a];isFinite(s)&&(i=Math.min(s,i))}return i},G9=function(e){for(var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:e.length,i=-1/0,a=r;a<n;a++){var s=e[a];isFinite(s)&&(i=Math.max(s,i))}return i},V9=function(e){for(var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:e.length,i=0,a=0,s=r;s<n;s++){var o=e[s];isFinite(o)&&(i+=o,a++)}return i/a},H9=function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:e.length,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0,a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!0;i?e=e.slice(r,n):(n<e.length&&e.splice(n,e.length-n),r>0&&e.splice(0,r));for(var o=0,l=e.length-1;l>=0;l--){var u=e[l];s?isFinite(u)||(e[l]=-1/0,o++):e.splice(l,1)}a&&e.sort(function(p,v){return p-v});var c=e.length,h=Math.floor(c/2);return c%2!==0?e[h+1+o]:(e[h-1+o]+e[h+o])/2},W9=function(e){return Math.PI*e/180},X0=function(e,r){return Math.atan2(r,e)-Math.PI/2},n_=Math.log2||function(t){return Math.log(t)/Math.log(2)},i_=function(e){return e>0?1:e<0?-1:0},mf=function(e,r){return Math.sqrt($h(e,r))},$h=function(e,r){var n=r.x-e.x,i=r.y-e.y;return n*n+i*i},q9=function(e){for(var r=e.length,n=0,i=0;i<r;i++)n+=e[i];for(var a=0;a<r;a++)e[a]=e[a]/n;return e},pa=function(e,r,n,i){return(1-i)*(1-i)*e+2*(1-i)*i*r+i*i*n},jp=function(e,r,n,i){return{x:pa(e.x,r.x,n.x,i),y:pa(e.y,r.y,n.y,i)}},$9=function(e,r,n,i){var a={x:r.x-e.x,y:r.y-e.y},s=mf(e,r),o={x:a.x/s,y:a.y/s};return n=n??0,i=i??n*s,{x:e.x+o.x*i,y:e.y+o.y*i}},wv=function(e,r,n){return Math.max(e,Math.min(n,r))},Ns=function(e){if(e==null)return{x1:1/0,y1:1/0,x2:-1/0,y2:-1/0,w:0,h:0};if(e.x1!=null&&e.y1!=null){if(e.x2!=null&&e.y2!=null&&e.x2>=e.x1&&e.y2>=e.y1)return{x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,w:e.x2-e.x1,h:e.y2-e.y1};if(e.w!=null&&e.h!=null&&e.w>=0&&e.h>=0)return{x1:e.x1,y1:e.y1,x2:e.x1+e.w,y2:e.y1+e.h,w:e.w,h:e.h}}},K9=function(e){return{x1:e.x1,x2:e.x2,w:e.w,y1:e.y1,y2:e.y2,h:e.h}},Z9=function(e){e.x1=1/0,e.y1=1/0,e.x2=-1/0,e.y2=-1/0,e.w=0,e.h=0},Y9=function(e,r){e.x1=Math.min(e.x1,r.x1),e.x2=Math.max(e.x2,r.x2),e.w=e.x2-e.x1,e.y1=Math.min(e.y1,r.y1),e.y2=Math.max(e.y2,r.y2),e.h=e.y2-e.y1},YM=function(e,r,n){e.x1=Math.min(e.x1,r),e.x2=Math.max(e.x2,r),e.w=e.x2-e.x1,e.y1=Math.min(e.y1,n),e.y2=Math.max(e.y2,n),e.h=e.y2-e.y1},Dy=function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return e.x1-=r,e.x2+=r,e.y1-=r,e.y2+=r,e.w=e.x2-e.x1,e.h=e.y2-e.y1,e},Iy=function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0],n,i,a,s;if(r.length===1)n=i=a=s=r[0];else if(r.length===2)n=a=r[0],s=i=r[1];else if(r.length===4){var o=ji(r,4);n=o[0],i=o[1],a=o[2],s=o[3]}return e.x1-=s,e.x2+=i,e.y1-=n,e.y2+=a,e.w=e.x2-e.x1,e.h=e.y2-e.y1,e},QE=function(e,r){e.x1=r.x1,e.y1=r.y1,e.x2=r.x2,e.y2=r.y2,e.w=e.x2-e.x1,e.h=e.y2-e.y1},a_=function(e,r){return!(e.x1>r.x2||r.x1>e.x2||e.x2<r.x1||r.x2<e.x1||e.y2<r.y1||r.y2<e.y1||e.y1>r.y2||r.y1>e.y2)},Od=function(e,r,n){return e.x1<=r&&r<=e.x2&&e.y1<=n&&n<=e.y2},JE=function(e,r){return Od(e,r.x,r.y)},XM=function(e,r){return Od(e,r.x1,r.y1)&&Od(e,r.x2,r.y2)},X9=(sw=Math.hypot)!==null&&sw!==void 0?sw:function(t,e){return Math.sqrt(t*t+e*e)};function Q9(t,e){if(t.length<3)throw new Error("Need at least 3 vertices");var r=function(O,F){return{x:O.x+F.x,y:O.y+F.y}},n=function(O,F){return{x:O.x-F.x,y:O.y-F.y}},i=function(O,F){return{x:O.x*F,y:O.y*F}},a=function(O,F){return O.x*F.y-O.y*F.x},s=function(O){var F=X9(O.x,O.y);return F===0?{x:0,y:0}:{x:O.x/F,y:O.y/F}},o=function(O){for(var F=0,B=0;B<O.length;B++){var $=O[B],Z=O[(B+1)%O.length];F+=$.x*Z.y-Z.x*$.y}return F/2},l=function(O,F,B,$){var Z=n(F,O),D=n($,B),H=a(Z,D);if(Math.abs(H)<1e-9)return r(O,i(Z,.5));var U=a(n(B,O),D)/H;return r(O,i(Z,U))},u=t.map(function(j){return{x:j.x,y:j.y}});o(u)<0&&u.reverse();for(var c=u.length,h=[],p=0;p<c;p++){var v=u[p],y=u[(p+1)%c],S=n(y,v),w=s({x:S.y,y:-S.x});h.push(w)}for(var T=h.map(function(j,O){var F=r(u[O],i(j,e)),B=r(u[(O+1)%c],i(j,e));return{p1:F,p2:B}}),_=[],C=0;C<c;C++){var N=T[(C-1+c)%c],A=T[C],I=l(N.p1,N.p2,A.p1,A.p2);_.push(I)}return _}function J9(t,e,r,n,i,a){var s=lF(t,e,r,n,i),o=Q9(s,a),l=Ns();return o.forEach(function(u){return YM(l,u.x,u.y)}),l}var QM=function(e,r,n,i,a,s,o){var l=arguments.length>7&&arguments[7]!==void 0?arguments[7]:"auto",u=l==="auto"?Xd(a,s):l,c=a/2,h=s/2;u=Math.min(u,c,h);var p=u!==c,v=u!==h,y;if(p){var S=n-c+u-o,w=i-h-o,T=n+c-u+o,_=w;if(y=Dd(e,r,n,i,S,w,T,_,!1),y.length>0)return y}if(v){var C=n+c+o,N=i-h+u-o,A=C,I=i+h-u+o;if(y=Dd(e,r,n,i,C,N,A,I,!1),y.length>0)return y}if(p){var j=n-c+u-o,O=i+h+o,F=n+c-u+o,B=O;if(y=Dd(e,r,n,i,j,O,F,B,!1),y.length>0)return y}if(v){var $=n-c-o,Z=i-h+u-o,D=$,H=i+h-u+o;if(y=Dd(e,r,n,i,$,Z,D,H,!1),y.length>0)return y}var U;{var W=n-c+u,Y=i-h+u;if(U=Hg(e,r,n,i,W,Y,u+o),U.length>0&&U[0]<=W&&U[1]<=Y)return[U[0],U[1]]}{var Q=n+c-u,ne=i-h+u;if(U=Hg(e,r,n,i,Q,ne,u+o),U.length>0&&U[0]>=Q&&U[1]<=ne)return[U[0],U[1]]}{var re=n+c-u,q=i+h-u;if(U=Hg(e,r,n,i,re,q,u+o),U.length>0&&U[0]>=re&&U[1]>=q)return[U[0],U[1]]}{var te=n-c+u,ae=i+h-u;if(U=Hg(e,r,n,i,te,ae,u+o),U.length>0&&U[0]<=te&&U[1]>=ae)return[U[0],U[1]]}return[]},eF=function(e,r,n,i,a,s,o){var l=o,u=Math.min(n,a),c=Math.max(n,a),h=Math.min(i,s),p=Math.max(i,s);return u-l<=e&&e<=c+l&&h-l<=r&&r<=p+l},tF=function(e,r,n,i,a,s,o,l,u){var c={x1:Math.min(n,o,a)-u,x2:Math.max(n,o,a)+u,y1:Math.min(i,l,s)-u,y2:Math.max(i,l,s)+u};return!(e<c.x1||e>c.x2||r<c.y1||r>c.y2)},rF=function(e,r,n,i){n-=i;var a=r*r-4*e*n;if(a<0)return[];var s=Math.sqrt(a),o=2*e,l=(-r+s)/o,u=(-r-s)/o;return[l,u]},nF=function(e,r,n,i,a){var s=1e-5;e===0&&(e=s),r/=e,n/=e,i/=e;var o,l,u,c,h,p,v,y;if(l=(3*n-r*r)/9,u=-(27*i)+r*(9*n-2*(r*r)),u/=54,o=l*l*l+u*u,a[1]=0,v=r/3,o>0){h=u+Math.sqrt(o),h=h<0?-Math.pow(-h,1/3):Math.pow(h,1/3),p=u-Math.sqrt(o),p=p<0?-Math.pow(-p,1/3):Math.pow(p,1/3),a[0]=-v+h+p,v+=(h+p)/2,a[4]=a[2]=-v,v=Math.sqrt(3)*(-p+h)/2,a[3]=v,a[5]=-v;return}if(a[5]=a[3]=0,o===0){y=u<0?-Math.pow(-u,1/3):Math.pow(u,1/3),a[0]=-v+2*y,a[4]=a[2]=-(y+v);return}l=-l,c=l*l*l,c=Math.acos(u/Math.sqrt(c)),y=2*Math.sqrt(l),a[0]=-v+y*Math.cos(c/3),a[2]=-v+y*Math.cos((c+2*Math.PI)/3),a[4]=-v+y*Math.cos((c+4*Math.PI)/3)},iF=function(e,r,n,i,a,s,o,l){var u=1*n*n-4*n*a+2*n*o+4*a*a-4*a*o+o*o+i*i-4*i*s+2*i*l+4*s*s-4*s*l+l*l,c=9*n*a-3*n*n-3*n*o-6*a*a+3*a*o+9*i*s-3*i*i-3*i*l-6*s*s+3*s*l,h=3*n*n-6*n*a+n*o-n*e+2*a*a+2*a*e-o*e+3*i*i-6*i*s+i*l-i*r+2*s*s+2*s*r-l*r,p=1*n*a-n*n+n*e-a*e+i*s-i*i+i*r-s*r,v=[];nF(u,c,h,p,v);for(var y=1e-7,S=[],w=0;w<6;w+=2)Math.abs(v[w+1])<y&&v[w]>=0&&v[w]<=1&&S.push(v[w]);S.push(1),S.push(0);for(var T=-1,_,C,N,A=0;A<S.length;A++)_=Math.pow(1-S[A],2)*n+2*(1-S[A])*S[A]*a+S[A]*S[A]*o,C=Math.pow(1-S[A],2)*i+2*(1-S[A])*S[A]*s+S[A]*S[A]*l,N=Math.pow(_-e,2)+Math.pow(C-r,2),T>=0?N<T&&(T=N):T=N;return T},aF=function(e,r,n,i,a,s){var o=[e-n,r-i],l=[a-n,s-i],u=l[0]*l[0]+l[1]*l[1],c=o[0]*o[0]+o[1]*o[1],h=o[0]*l[0]+o[1]*l[1],p=h*h/u;return h<0?c:p>u?(e-a)*(e-a)+(r-s)*(r-s):c-p},Ks=function(e,r,n){for(var i,a,s,o,l,u=0,c=0;c<n.length/2;c++)if(i=n[c*2],a=n[c*2+1],c+1<n.length/2?(s=n[(c+1)*2],o=n[(c+1)*2+1]):(s=n[(c+1-n.length/2)*2],o=n[(c+1-n.length/2)*2+1]),!(i==e&&s==e))if(i>=e&&e>=s||i<=e&&e<=s)l=(e-i)/(s-i)*(o-a)+a,l>r&&u++;else continue;return u%2!==0},vc=function(e,r,n,i,a,s,o,l,u){var c=new Array(n.length),h;l[0]!=null?(h=Math.atan(l[1]/l[0]),l[0]<0?h=h+Math.PI/2:h=-h-Math.PI/2):h=l;for(var p=Math.cos(-h),v=Math.sin(-h),y=0;y<c.length/2;y++)c[y*2]=s/2*(n[y*2]*p-n[y*2+1]*v),c[y*2+1]=o/2*(n[y*2+1]*p+n[y*2]*v),c[y*2]+=i,c[y*2+1]+=a;var S;if(u>0){var w=lx(c,-u);S=ox(w)}else S=c;return Ks(e,r,S)},sF=function(e,r,n,i,a,s,o,l){for(var u=new Array(n.length*2),c=0;c<l.length;c++){var h=l[c];u[c*4+0]=h.startX,u[c*4+1]=h.startY,u[c*4+2]=h.stopX,u[c*4+3]=h.stopY;var p=Math.pow(h.cx-e,2)+Math.pow(h.cy-r,2);if(p<=Math.pow(h.radius,2))return!0}return Ks(e,r,u)},ox=function(e){for(var r=new Array(e.length/2),n,i,a,s,o,l,u,c,h=0;h<e.length/4;h++){n=e[h*4],i=e[h*4+1],a=e[h*4+2],s=e[h*4+3],h<e.length/4-1?(o=e[(h+1)*4],l=e[(h+1)*4+1],u=e[(h+1)*4+2],c=e[(h+1)*4+3]):(o=e[0],l=e[1],u=e[2],c=e[3]);var p=Dd(n,i,a,s,o,l,u,c,!0);r[h*2]=p[0],r[h*2+1]=p[1]}return r},lx=function(e,r){for(var n=new Array(e.length*2),i,a,s,o,l=0;l<e.length/2;l++){i=e[l*2],a=e[l*2+1],l<e.length/2-1?(s=e[(l+1)*2],o=e[(l+1)*2+1]):(s=e[0],o=e[1]);var u=o-a,c=-(s-i),h=Math.sqrt(u*u+c*c),p=u/h,v=c/h;n[l*4]=i+p*r,n[l*4+1]=a+v*r,n[l*4+2]=s+p*r,n[l*4+3]=o+v*r}return n},oF=function(e,r,n,i,a,s){var o=n-e,l=i-r;o/=a,l/=s;var u=Math.sqrt(o*o+l*l),c=u-1;if(c<0)return[];var h=c/u;return[(n-e)*h+e,(i-r)*h+r]},ef=function(e,r,n,i,a,s,o){return e-=a,r-=s,e/=n/2+o,r/=i/2+o,e*e+r*r<=1},Hg=function(e,r,n,i,a,s,o){var l=[n-e,i-r],u=[e-a,r-s],c=l[0]*l[0]+l[1]*l[1],h=2*(u[0]*l[0]+u[1]*l[1]),p=u[0]*u[0]+u[1]*u[1]-o*o,v=h*h-4*c*p;if(v<0)return[];var y=(-h+Math.sqrt(v))/(2*c),S=(-h-Math.sqrt(v))/(2*c),w=Math.min(y,S),T=Math.max(y,S),_=[];if(w>=0&&w<=1&&_.push(w),T>=0&&T<=1&&_.push(T),_.length===0)return[];var C=_[0]*l[0]+e,N=_[0]*l[1]+r;if(_.length>1){if(_[0]==_[1])return[C,N];var A=_[1]*l[0]+e,I=_[1]*l[1]+r;return[C,N,A,I]}else return[C,N]},ow=function(e,r,n){return r<=e&&e<=n||n<=e&&e<=r?e:e<=r&&r<=n||n<=r&&r<=e?r:n},Dd=function(e,r,n,i,a,s,o,l,u){var c=e-a,h=n-e,p=o-a,v=r-s,y=i-r,S=l-s,w=p*v-S*c,T=h*v-y*c,_=S*h-p*y;if(_!==0){var C=w/_,N=T/_,A=.001,I=0-A,j=1+A;return I<=C&&C<=j&&I<=N&&N<=j?[e+C*h,r+C*y]:u?[e+C*h,r+C*y]:[]}else return w===0||T===0?ow(e,n,o)===o?[o,l]:ow(e,n,a)===a?[a,s]:ow(a,o,n)===n?[n,i]:[]:[]},lF=function(e,r,n,i,a){var s=[],o=i/2,l=a/2,u=r,c=n;s.push({x:u+o*e[0],y:c+l*e[1]});for(var h=1;h<e.length/2;h++)s.push({x:u+o*e[h*2],y:c+l*e[h*2+1]});return s},Sv=function(e,r,n,i,a,s,o,l){var u=[],c,h=new Array(n.length),p=!0;s==null&&(p=!1);var v;if(p){for(var y=0;y<h.length/2;y++)h[y*2]=n[y*2]*s+i,h[y*2+1]=n[y*2+1]*o+a;if(l>0){var S=lx(h,-l);v=ox(S)}else v=h}else v=n;for(var w,T,_,C,N=0;N<v.length/2;N++)w=v[N*2],T=v[N*2+1],N<v.length/2-1?(_=v[(N+1)*2],C=v[(N+1)*2+1]):(_=v[0],C=v[1]),c=Dd(e,r,i,a,w,T,_,C),c.length!==0&&u.push(c[0],c[1]);return u},uF=function(e,r,n,i,a,s,o,l,u){var c=[],h,p=new Array(n.length*2);u.forEach(function(_,C){C===0?(p[p.length-2]=_.startX,p[p.length-1]=_.startY):(p[C*4-2]=_.startX,p[C*4-1]=_.startY),p[C*4]=_.stopX,p[C*4+1]=_.stopY,h=Hg(e,r,i,a,_.cx,_.cy,_.radius),h.length!==0&&c.push(h[0],h[1])});for(var v=0;v<p.length/4;v++)h=Dd(e,r,i,a,p[v*4],p[v*4+1],p[v*4+2],p[v*4+3],!1),h.length!==0&&c.push(h[0],h[1]);if(c.length>2){for(var y=[c[0],c[1]],S=Math.pow(y[0]-e,2)+Math.pow(y[1]-r,2),w=1;w<c.length/2;w++){var T=Math.pow(c[w*2]-e,2)+Math.pow(c[w*2+1]-r,2);T<=S&&(y[0]=c[w*2],y[1]=c[w*2+1],S=T)}return y}return c},Q0=function(e,r,n){var i=[e[0]-r[0],e[1]-r[1]],a=Math.sqrt(i[0]*i[0]+i[1]*i[1]),s=(a-n)/a;return s<0&&(s=1e-5),[r[0]+s*i[0],r[1]+s*i[1]]},Ts=function(e,r){var n=OS(e,r);return n=JM(n),n},JM=function(e){for(var r,n,i=e.length/2,a=1/0,s=1/0,o=-1/0,l=-1/0,u=0;u<i;u++)r=e[2*u],n=e[2*u+1],a=Math.min(a,r),o=Math.max(o,r),s=Math.min(s,n),l=Math.max(l,n);for(var c=2/(o-a),h=2/(l-s),p=0;p<i;p++)r=e[2*p]=e[2*p]*c,n=e[2*p+1]=e[2*p+1]*h,a=Math.min(a,r),o=Math.max(o,r),s=Math.min(s,n),l=Math.max(l,n);if(s<-1)for(var v=0;v<i;v++)n=e[2*v+1]=e[2*v+1]+(-1-s);return e},OS=function(e,r){var n=1/e*2*Math.PI,i=e%2===0?Math.PI/2+n/2:Math.PI/2;i+=r;for(var a=new Array(e*2),s,o=0;o<e;o++)s=o*n+i,a[2*o]=Math.cos(s),a[2*o+1]=Math.sin(-s);return a},Xd=function(e,r){return Math.min(e/4,r/4,8)},eA=function(e,r){return Math.min(e/10,r/10,8)},s_=function(){return 8},cF=function(e,r,n){return[e-2*r+n,2*(r-e),e]},DS=function(e,r){return{heightOffset:Math.min(15,.05*r),widthOffset:Math.min(100,.25*e),ctrlPtOffsetPct:.05}};function lw(t,e){function r(h){for(var p=[],v=0;v<h.length;v++){var y=h[v],S=h[(v+1)%h.length],w={x:S.x-y.x,y:S.y-y.y},T={x:-w.y,y:w.x},_=Math.sqrt(T.x*T.x+T.y*T.y);p.push({x:T.x/_,y:T.y/_})}return p}function n(h,p){var v=1/0,y=-1/0,S=Ys(h),w;try{for(S.s();!(w=S.n()).done;){var T=w.value,_=T.x*p.x+T.y*p.y;v=Math.min(v,_),y=Math.max(y,_)}}catch(C){S.e(C)}finally{S.f()}return{min:v,max:y}}function i(h,p){return!(h.max<p.min||p.max<h.min)}var a=[].concat(nx(r(t)),nx(r(e))),s=Ys(a),o;try{for(s.s();!(o=s.n()).done;){var l=o.value,u=n(t,l),c=n(e,l);if(!i(u,c))return!1}}catch(h){s.e(h)}finally{s.f()}return!0}var dF=qa({dampingFactor:.8,precision:1e-6,iterations:200,weight:function(e){return 1}}),hF={pageRank:function(e){for(var r=dF(e),n=r.dampingFactor,i=r.precision,a=r.iterations,s=r.weight,o=this._private.cy,l=this.byGroup(),u=l.nodes,c=l.edges,h=u.length,p=h*h,v=c.length,y=new Array(p),S=new Array(h),w=(1-n)/h,T=0;T<h;T++){for(var _=0;_<h;_++){var C=T*h+_;y[C]=0}S[T]=0}for(var N=0;N<v;N++){var A=c[N],I=A.data("source"),j=A.data("target");if(I!==j){var O=u.indexOfId(I),F=u.indexOfId(j),B=s(A),$=F*h+O;y[$]+=B,S[O]+=B}}for(var Z=1/h+w,D=0;D<h;D++)if(S[D]===0)for(var H=0;H<h;H++){var U=H*h+D;y[U]=Z}else for(var W=0;W<h;W++){var Y=W*h+D;y[Y]=y[Y]/S[D]+w}for(var Q=new Array(h),ne=new Array(h),re,q=0;q<h;q++)Q[q]=1;for(var te=0;te<a;te++){for(var ae=0;ae<h;ae++)ne[ae]=0;for(var de=0;de<h;de++)for(var ge=0;ge<h;ge++){var ye=de*h+ge;ne[de]+=y[ye]*Q[ge]}q9(ne),re=Q,Q=ne,ne=re;for(var se=0,fe=0;fe<h;fe++){var le=re[fe]-Q[fe];se+=le*le}if(se<i)break}var pe={rank:function(xe){return xe=o.collection(xe)[0],Q[u.indexOf(xe)]}};return pe}},eT=qa({root:null,weight:function(e){return 1},directed:!1,alpha:0}),Fp={degreeCentralityNormalized:function(e){e=eT(e);var r=this.cy(),n=this.nodes(),i=n.length;if(e.directed){for(var c={},h={},p=0,v=0,y=0;y<i;y++){var S=n[y],w=S.id();e.root=S;var T=this.degreeCentrality(e);p<T.indegree&&(p=T.indegree),v<T.outdegree&&(v=T.outdegree),c[w]=T.indegree,h[w]=T.outdegree}return{indegree:function(C){return p==0?0:(Wt(C)&&(C=r.filter(C)),c[C.id()]/p)},outdegree:function(C){return v===0?0:(Wt(C)&&(C=r.filter(C)),h[C.id()]/v)}}}else{for(var a={},s=0,o=0;o<i;o++){var l=n[o];e.root=l;var u=this.degreeCentrality(e);s<u.degree&&(s=u.degree),a[l.id()]=u.degree}return{degree:function(C){return s===0?0:(Wt(C)&&(C=r.filter(C)),a[C.id()]/s)}}}},degreeCentrality:function(e){e=eT(e);var r=this.cy(),n=this,i=e,a=i.root,s=i.weight,o=i.directed,l=i.alpha;if(a=r.collection(a)[0],o){for(var v=a.connectedEdges(),y=v.filter(function(I){return I.target().same(a)&&n.has(I)}),S=v.filter(function(I){return I.source().same(a)&&n.has(I)}),w=y.length,T=S.length,_=0,C=0,N=0;N<y.length;N++)_+=s(y[N]);for(var A=0;A<S.length;A++)C+=s(S[A]);return{indegree:Math.pow(w,1-l)*Math.pow(_,l),outdegree:Math.pow(T,1-l)*Math.pow(C,l)}}else{for(var u=a.connectedEdges().intersection(n),c=u.length,h=0,p=0;p<u.length;p++)h+=s(u[p]);return{degree:Math.pow(c,1-l)*Math.pow(h,l)}}}};Fp.dc=Fp.degreeCentrality;Fp.dcn=Fp.degreeCentralityNormalised=Fp.degreeCentralityNormalized;var tT=qa({harmonic:!0,weight:function(){return 1},directed:!1,root:null}),Bp={closenessCentralityNormalized:function(e){for(var r=tT(e),n=r.harmonic,i=r.weight,a=r.directed,s=this.cy(),o={},l=0,u=this.nodes(),c=this.floydWarshall({weight:i,directed:a}),h=0;h<u.length;h++){for(var p=0,v=u[h],y=0;y<u.length;y++)if(h!==y){var S=c.distance(v,u[y]);n?p+=1/S:p+=S}n||(p=1/p),l<p&&(l=p),o[v.id()]=p}return{closeness:function(T){return l==0?0:(Wt(T)?T=s.filter(T)[0].id():T=T.id(),o[T]/l)}}},closenessCentrality:function(e){var r=tT(e),n=r.root,i=r.weight,a=r.directed,s=r.harmonic;n=this.filter(n)[0];for(var o=this.dijkstra({root:n,weight:i,directed:a}),l=0,u=this.nodes(),c=0;c<u.length;c++){var h=u[c];if(!h.same(n)){var p=o.distanceTo(h);s?l+=1/p:l+=p}}return s?l:1/l}};Bp.cc=Bp.closenessCentrality;Bp.ccn=Bp.closenessCentralityNormalised=Bp.closenessCentralityNormalized;var fF=qa({weight:null,directed:!1}),IS={betweennessCentrality:function(e){for(var r=fF(e),n=r.directed,i=r.weight,a=i!=null,s=this.cy(),o=this.nodes(),l={},u={},c=0,h={set:function(C,N){u[C]=N,N>c&&(c=N)},get:function(C){return u[C]}},p=0;p<o.length;p++){var v=o[p],y=v.id();n?l[y]=v.outgoers().nodes():l[y]=v.openNeighborhood().nodes(),h.set(y,0)}for(var S=function(){for(var C=o[w].id(),N=[],A={},I={},j={},O=new Jv(function(de,ge){return j[de]-j[ge]}),F=0;F<o.length;F++){var B=o[F].id();A[B]=[],I[B]=0,j[B]=1/0}for(I[C]=1,j[C]=0,O.push(C);!O.empty();){var $=O.pop();if(N.push($),a)for(var Z=0;Z<l[$].length;Z++){var D=l[$][Z],H=s.getElementById($),U=void 0;H.edgesTo(D).length>0?U=H.edgesTo(D)[0]:U=D.edgesTo(H)[0];var W=i(U);D=D.id(),j[D]>j[$]+W&&(j[D]=j[$]+W,O.nodes.indexOf(D)<0?O.push(D):O.updateItem(D),I[D]=0,A[D]=[]),j[D]==j[$]+W&&(I[D]=I[D]+I[$],A[D].push($))}else for(var Y=0;Y<l[$].length;Y++){var Q=l[$][Y].id();j[Q]==1/0&&(O.push(Q),j[Q]=j[$]+1),j[Q]==j[$]+1&&(I[Q]=I[Q]+I[$],A[Q].push($))}}for(var ne={},re=0;re<o.length;re++)ne[o[re].id()]=0;for(;N.length>0;){for(var q=N.pop(),te=0;te<A[q].length;te++){var ae=A[q][te];ne[ae]=ne[ae]+I[ae]/I[q]*(1+ne[q])}q!=o[w].id()&&h.set(q,h.get(q)+ne[q])}},w=0;w<o.length;w++)S();var T={betweenness:function(C){var N=s.collection(C).id();return h.get(N)},betweennessNormalized:function(C){if(c==0)return 0;var N=s.collection(C).id();return h.get(N)/c}};return T.betweennessNormalised=T.betweennessNormalized,T}};IS.bc=IS.betweennessCentrality;var pF=qa({expandFactor:2,inflateFactor:2,multFactor:1,maxIterations:20,attributes:[function(t){return 1}]}),mF=function(e){return pF(e)},gF=function(e,r){for(var n=0,i=0;i<r.length;i++)n+=r[i](e);return n},vF=function(e,r,n){for(var i=0;i<r;i++)e[i*r+i]=n},tA=function(e,r){for(var n,i=0;i<r;i++){n=0;for(var a=0;a<r;a++)n+=e[a*r+i];for(var s=0;s<r;s++)e[s*r+i]=e[s*r+i]/n}},yF=function(e,r,n){for(var i=new Array(n*n),a=0;a<n;a++){for(var s=0;s<n;s++)i[a*n+s]=0;for(var o=0;o<n;o++)for(var l=0;l<n;l++)i[a*n+l]+=e[a*n+o]*r[o*n+l]}return i},xF=function(e,r,n){for(var i=e.slice(0),a=1;a<n;a++)e=yF(e,i,r);return e},bF=function(e,r,n){for(var i=new Array(r*r),a=0;a<r*r;a++)i[a]=Math.pow(e[a],n);return tA(i,r),i},wF=function(e,r,n,i){for(var a=0;a<n;a++){var s=Math.round(e[a]*Math.pow(10,i))/Math.pow(10,i),o=Math.round(r[a]*Math.pow(10,i))/Math.pow(10,i);if(s!==o)return!1}return!0},SF=function(e,r,n,i){for(var a=[],s=0;s<r;s++){for(var o=[],l=0;l<r;l++)Math.round(e[s*r+l]*1e3)/1e3>0&&o.push(n[l]);o.length!==0&&a.push(i.collection(o))}return a},kF=function(e,r){for(var n=0;n<e.length;n++)if(!r[n]||e[n].id()!==r[n].id())return!1;return!0},_F=function(e){for(var r=0;r<e.length;r++)for(var n=0;n<e.length;n++)r!=n&&kF(e[r],e[n])&&e.splice(n,1);return e},rT=function(e){for(var r=this.nodes(),n=this.edges(),i=this.cy(),a=mF(e),s={},o=0;o<r.length;o++)s[r[o].id()]=o;for(var l=r.length,u=l*l,c=new Array(u),h,p=0;p<u;p++)c[p]=0;for(var v=0;v<n.length;v++){var y=n[v],S=s[y.source().id()],w=s[y.target().id()],T=gF(y,a.attributes);c[S*l+w]+=T,c[w*l+S]+=T}vF(c,l,a.multFactor),tA(c,l);for(var _=!0,C=0;_&&C<a.maxIterations;)_=!1,h=xF(c,l,a.expandFactor),c=bF(h,l,a.inflateFactor),wF(c,h,u,4)||(_=!0),C++;var N=SF(c,l,r,i);return N=_F(N),N},CF={markovClustering:rT,mcl:rT},EF=function(e){return e},rA=function(e,r){return Math.abs(r-e)},nT=function(e,r,n){return e+rA(r,n)},iT=function(e,r,n){return e+Math.pow(n-r,2)},TF=function(e){return Math.sqrt(e)},NF=function(e,r,n){return Math.max(e,rA(r,n))},Um=function(e,r,n,i,a){for(var s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:EF,o=i,l,u,c=0;c<e;c++)l=r(c),u=n(c),o=a(o,l,u);return s(o)},qp={euclidean:function(e,r,n){return e>=2?Um(e,r,n,0,iT,TF):Um(e,r,n,0,nT)},squaredEuclidean:function(e,r,n){return Um(e,r,n,0,iT)},manhattan:function(e,r,n){return Um(e,r,n,0,nT)},max:function(e,r,n){return Um(e,r,n,-1/0,NF)}};qp["squared-euclidean"]=qp.squaredEuclidean;qp.squaredeuclidean=qp.squaredEuclidean;function _1(t,e,r,n,i,a){var s;return ni(t)?s=t:s=qp[t]||qp.euclidean,e===0&&ni(t)?s(i,a):s(e,r,n,i,a)}var PF=qa({k:2,m:2,sensitivityThreshold:1e-4,distance:"euclidean",maxIterations:10,attributes:[],testMode:!1,testCentroids:null}),o_=function(e){return PF(e)},ux=function(e,r,n,i,a){var s=a!=="kMedoids",o=s?function(h){return n[h]}:function(h){return i[h](n)},l=function(p){return i[p](r)},u=n,c=r;return _1(e,i.length,o,l,u,c)},uw=function(e,r,n){for(var i=n.length,a=new Array(i),s=new Array(i),o=new Array(r),l=null,u=0;u<i;u++)a[u]=e.min(n[u]).value,s[u]=e.max(n[u]).value;for(var c=0;c<r;c++){l=[];for(var h=0;h<i;h++)l[h]=Math.random()*(s[h]-a[h])+a[h];o[c]=l}return o},nA=function(e,r,n,i,a){for(var s=1/0,o=0,l=0;l<r.length;l++){var u=ux(n,e,r[l],i,a);u<s&&(s=u,o=l)}return o},iA=function(e,r,n){for(var i=[],a=null,s=0;s<r.length;s++)a=r[s],n[a.id()]===e&&i.push(a);return i},MF=function(e,r,n){return Math.abs(r-e)<=n},AF=function(e,r,n){for(var i=0;i<e.length;i++)for(var a=0;a<e[i].length;a++){var s=Math.abs(e[i][a]-r[i][a]);if(s>n)return!1}return!0},RF=function(e,r,n){for(var i=0;i<n;i++)if(e===r[i])return!0;return!1},aT=function(e,r){var n=new Array(r);if(e.length<50)for(var i=0;i<r;i++){for(var a=e[Math.floor(Math.random()*e.length)];RF(a,n,i);)a=e[Math.floor(Math.random()*e.length)];n[i]=a}else for(var s=0;s<r;s++)n[s]=e[Math.floor(Math.random()*e.length)];return n},sT=function(e,r,n){for(var i=0,a=0;a<r.length;a++)i+=ux("manhattan",r[a],e,n,"kMedoids");return i},LF=function(e){var r=this.cy(),n=this.nodes(),i=null,a=o_(e),s=new Array(a.k),o={},l;a.testMode?typeof a.testCentroids=="number"?(a.testCentroids,l=uw(n,a.k,a.attributes)):Yi(a.testCentroids)==="object"?l=a.testCentroids:l=uw(n,a.k,a.attributes):l=uw(n,a.k,a.attributes);for(var u=!0,c=0;u&&c<a.maxIterations;){for(var h=0;h<n.length;h++)i=n[h],o[i.id()]=nA(i,l,a.distance,a.attributes,"kMeans");u=!1;for(var p=0;p<a.k;p++){var v=iA(p,n,o);if(v.length!==0){for(var y=a.attributes.length,S=l[p],w=new Array(y),T=new Array(y),_=0;_<y;_++){T[_]=0;for(var C=0;C<v.length;C++)i=v[C],T[_]+=a.attributes[_](i);w[_]=T[_]/v.length,MF(w[_],S[_],a.sensitivityThreshold)||(u=!0)}l[p]=w,s[p]=r.collection(v)}}c++}return s},OF=function(e){var r=this.cy(),n=this.nodes(),i=null,a=o_(e),s=new Array(a.k),o,l={},u,c=new Array(a.k);a.testMode?typeof a.testCentroids=="number"||(Yi(a.testCentroids)==="object"?o=a.testCentroids:o=aT(n,a.k)):o=aT(n,a.k);for(var h=!0,p=0;h&&p<a.maxIterations;){for(var v=0;v<n.length;v++)i=n[v],l[i.id()]=nA(i,o,a.distance,a.attributes,"kMedoids");h=!1;for(var y=0;y<o.length;y++){var S=iA(y,n,l);if(S.length!==0){c[y]=sT(o[y],S,a.attributes);for(var w=0;w<S.length;w++)u=sT(S[w],S,a.attributes),u<c[y]&&(c[y]=u,o[y]=S[w],h=!0);s[y]=r.collection(S)}}p++}return s},DF=function(e,r,n,i,a){for(var s,o,l=0;l<r.length;l++)for(var u=0;u<e.length;u++)i[l][u]=Math.pow(n[l][u],a.m);for(var c=0;c<e.length;c++)for(var h=0;h<a.attributes.length;h++){s=0,o=0;for(var p=0;p<r.length;p++)s+=i[p][c]*a.attributes[h](r[p]),o+=i[p][c];e[c][h]=s/o}},IF=function(e,r,n,i,a){for(var s=0;s<e.length;s++)r[s]=e[s].slice();for(var o,l,u,c=2/(a.m-1),h=0;h<n.length;h++)for(var p=0;p<i.length;p++){o=0;for(var v=0;v<n.length;v++)l=ux(a.distance,i[p],n[h],a.attributes,"cmeans"),u=ux(a.distance,i[p],n[v],a.attributes,"cmeans"),o+=Math.pow(l/u,c);e[p][h]=1/o}},jF=function(e,r,n,i){for(var a=new Array(n.k),s=0;s<a.length;s++)a[s]=[];for(var o,l,u=0;u<r.length;u++){o=-1/0,l=-1;for(var c=0;c<r[0].length;c++)r[u][c]>o&&(o=r[u][c],l=c);a[l].push(e[u])}for(var h=0;h<a.length;h++)a[h]=i.collection(a[h]);return a},oT=function(e){var r=this.cy(),n=this.nodes(),i=o_(e),a,s,o,l,u;l=new Array(n.length);for(var c=0;c<n.length;c++)l[c]=new Array(i.k);o=new Array(n.length);for(var h=0;h<n.length;h++)o[h]=new Array(i.k);for(var p=0;p<n.length;p++){for(var v=0,y=0;y<i.k;y++)o[p][y]=Math.random(),v+=o[p][y];for(var S=0;S<i.k;S++)o[p][S]=o[p][S]/v}s=new Array(i.k);for(var w=0;w<i.k;w++)s[w]=new Array(i.attributes.length);u=new Array(n.length);for(var T=0;T<n.length;T++)u[T]=new Array(i.k);for(var _=!0,C=0;_&&C<i.maxIterations;)_=!1,DF(s,n,o,u,i),IF(o,l,s,n,i),AF(o,l,i.sensitivityThreshold)||(_=!0),C++;return a=jF(n,o,i,r),{clusters:a,degreeOfMembership:o}},FF={kMeans:LF,kMedoids:OF,fuzzyCMeans:oT,fcm:oT},BF=qa({distance:"euclidean",linkage:"min",mode:"threshold",threshold:1/0,addDendrogram:!1,dendrogramDepth:0,attributes:[]}),zF={single:"min",complete:"max"},UF=function(e){var r=BF(e),n=zF[r.linkage];return n!=null&&(r.linkage=n),r},lT=function(e,r,n,i,a){for(var s=0,o=1/0,l,u=a.attributes,c=function(F,B){return _1(a.distance,u.length,function($){return u[$](F)},function($){return u[$](B)},F,B)},h=0;h<e.length;h++){var p=e[h].key,v=n[p][i[p]];v<o&&(s=p,o=v)}if(a.mode==="threshold"&&o>=a.threshold||a.mode==="dendrogram"&&e.length===1)return!1;var y=r[s],S=r[i[s]],w;a.mode==="dendrogram"?w={left:y,right:S,key:y.key}:w={value:y.value.concat(S.value),key:y.key},e[y.index]=w,e.splice(S.index,1),r[y.key]=w;for(var T=0;T<e.length;T++){var _=e[T];y.key===_.key?l=1/0:a.linkage==="min"?(l=n[y.key][_.key],n[y.key][_.key]>n[S.key][_.key]&&(l=n[S.key][_.key])):a.linkage==="max"?(l=n[y.key][_.key],n[y.key][_.key]<n[S.key][_.key]&&(l=n[S.key][_.key])):a.linkage==="mean"?l=(n[y.key][_.key]*y.size+n[S.key][_.key]*S.size)/(y.size+S.size):a.mode==="dendrogram"?l=c(_.value,y.value):l=c(_.value[0],y.value[0]),n[y.key][_.key]=n[_.key][y.key]=l}for(var C=0;C<e.length;C++){var N=e[C].key;if(i[N]===y.key||i[N]===S.key){for(var A=N,I=0;I<e.length;I++){var j=e[I].key;n[N][j]<n[N][A]&&(A=j)}i[N]=A}e[C].index=C}return y.key=S.key=y.index=S.index=null,!0},Lp=function(e,r,n){e&&(e.value?r.push(e.value):(e.left&&Lp(e.left,r),e.right&&Lp(e.right,r)))},jS=function(e,r){if(!e)return"";if(e.left&&e.right){var n=jS(e.left,r),i=jS(e.right,r),a=r.add({group:"nodes",data:{id:n+","+i}});return r.add({group:"edges",data:{source:n,target:a.id()}}),r.add({group:"edges",data:{source:i,target:a.id()}}),a.id()}else if(e.value)return e.value.id()},FS=function(e,r,n){if(!e)return[];var i=[],a=[],s=[];return r===0?(e.left&&Lp(e.left,i),e.right&&Lp(e.right,a),s=i.concat(a),[n.collection(s)]):r===1?e.value?[n.collection(e.value)]:(e.left&&Lp(e.left,i),e.right&&Lp(e.right,a),[n.collection(i),n.collection(a)]):e.value?[n.collection(e.value)]:(e.left&&(i=FS(e.left,r-1,n)),e.right&&(a=FS(e.right,r-1,n)),i.concat(a))},uT=function(e){for(var r=this.cy(),n=this.nodes(),i=UF(e),a=i.attributes,s=function(C,N){return _1(i.distance,a.length,function(A){return a[A](C)},function(A){return a[A](N)},C,N)},o=[],l=[],u=[],c=[],h=0;h<n.length;h++){var p={value:i.mode==="dendrogram"?n[h]:[n[h]],key:h,index:h};o[h]=p,c[h]=p,l[h]=[],u[h]=0}for(var v=0;v<o.length;v++)for(var y=0;y<=v;y++){var S=void 0;i.mode==="dendrogram"?S=v===y?1/0:s(o[v].value,o[y].value):S=v===y?1/0:s(o[v].value[0],o[y].value[0]),l[v][y]=S,l[y][v]=S,S<l[v][u[v]]&&(u[v]=y)}for(var w=lT(o,c,l,u,i);w;)w=lT(o,c,l,u,i);var T;return i.mode==="dendrogram"?(T=FS(o[0],i.dendrogramDepth,r),i.addDendrogram&&jS(o[0],r)):(T=new Array(o.length),o.forEach(function(_,C){_.key=_.index=null,T[C]=r.collection(_.value)})),T},GF={hierarchicalClustering:uT,hca:uT},VF=qa({distance:"euclidean",preference:"median",damping:.8,maxIterations:1e3,minIterations:100,attributes:[]}),HF=function(e){var r=e.damping,n=e.preference;.5<=r&&r<1||Kn("Damping must range on [0.5, 1).  Got: ".concat(r));var i=["median","mean","min","max"];return i.some(function(a){return a===n})||bt(n)||Kn("Preference must be one of [".concat(i.map(function(a){return"'".concat(a,"'")}).join(", "),"] or a number.  Got: ").concat(n)),VF(e)},WF=function(e,r,n,i){var a=function(o,l){return i[l](o)};return-_1(e,i.length,function(s){return a(r,s)},function(s){return a(n,s)},r,n)},qF=function(e,r){var n=null;return r==="median"?n=H9(e):r==="mean"?n=V9(e):r==="min"?n=U9(e):r==="max"?n=G9(e):n=r,n},$F=function(e,r,n){for(var i=[],a=0;a<e;a++)r[a*e+a]+n[a*e+a]>0&&i.push(a);return i},cT=function(e,r,n){for(var i=[],a=0;a<e;a++){for(var s=-1,o=-1/0,l=0;l<n.length;l++){var u=n[l];r[a*e+u]>o&&(s=u,o=r[a*e+u])}s>0&&i.push(s)}for(var c=0;c<n.length;c++)i[n[c]]=n[c];return i},KF=function(e,r,n){for(var i=cT(e,r,n),a=0;a<n.length;a++){for(var s=[],o=0;o<i.length;o++)i[o]===n[a]&&s.push(o);for(var l=-1,u=-1/0,c=0;c<s.length;c++){for(var h=0,p=0;p<s.length;p++)h+=r[s[p]*e+s[c]];h>u&&(l=c,u=h)}n[a]=s[l]}return i=cT(e,r,n),i},dT=function(e){for(var r=this.cy(),n=this.nodes(),i=HF(e),a={},s=0;s<n.length;s++)a[n[s].id()]=s;var o,l,u,c,h,p;o=n.length,l=o*o,u=new Array(l);for(var v=0;v<l;v++)u[v]=-1/0;for(var y=0;y<o;y++)for(var S=0;S<o;S++)y!==S&&(u[y*o+S]=WF(i.distance,n[y],n[S],i.attributes));c=qF(u,i.preference);for(var w=0;w<o;w++)u[w*o+w]=c;h=new Array(l);for(var T=0;T<l;T++)h[T]=0;p=new Array(l);for(var _=0;_<l;_++)p[_]=0;for(var C=new Array(o),N=new Array(o),A=new Array(o),I=0;I<o;I++)C[I]=0,N[I]=0,A[I]=0;for(var j=new Array(o*i.minIterations),O=0;O<j.length;O++)j[O]=0;var F;for(F=0;F<i.maxIterations;F++){for(var B=0;B<o;B++){for(var $=-1/0,Z=-1/0,D=-1,H=0,U=0;U<o;U++)C[U]=h[B*o+U],H=p[B*o+U]+u[B*o+U],H>=$?(Z=$,$=H,D=U):H>Z&&(Z=H);for(var W=0;W<o;W++)h[B*o+W]=(1-i.damping)*(u[B*o+W]-$)+i.damping*C[W];h[B*o+D]=(1-i.damping)*(u[B*o+D]-Z)+i.damping*C[D]}for(var Y=0;Y<o;Y++){for(var Q=0,ne=0;ne<o;ne++)C[ne]=p[ne*o+Y],N[ne]=Math.max(0,h[ne*o+Y]),Q+=N[ne];Q-=N[Y],N[Y]=h[Y*o+Y],Q+=N[Y];for(var re=0;re<o;re++)p[re*o+Y]=(1-i.damping)*Math.min(0,Q-N[re])+i.damping*C[re];p[Y*o+Y]=(1-i.damping)*(Q-N[Y])+i.damping*C[Y]}for(var q=0,te=0;te<o;te++){var ae=p[te*o+te]+h[te*o+te]>0?1:0;j[F%i.minIterations*o+te]=ae,q+=ae}if(q>0&&(F>=i.minIterations-1||F==i.maxIterations-1)){for(var de=0,ge=0;ge<o;ge++){A[ge]=0;for(var ye=0;ye<i.minIterations;ye++)A[ge]+=j[ye*o+ge];(A[ge]===0||A[ge]===i.minIterations)&&de++}if(de===o)break}}for(var se=$F(o,h,p),fe=KF(o,u,se),le={},pe=0;pe<se.length;pe++)le[se[pe]]=[];for(var me=0;me<n.length;me++){var xe=a[n[me].id()],Se=fe[xe];Se!=null&&le[Se].push(n[me])}for(var Ve=new Array(se.length),$e=0;$e<se.length;$e++)Ve[$e]=r.collection(le[se[$e]]);return Ve},ZF={affinityPropagation:dT,ap:dT},YF=qa({root:void 0,directed:!1}),XF={hierholzer:function(e){if(!Fr(e)){var r=arguments;e={root:r[0],directed:r[1]}}var n=YF(e),i=n.root,a=n.directed,s=this,o=!1,l,u,c;i&&(c=Wt(i)?this.filter(i)[0].id():i[0].id());var h={},p={};a?s.forEach(function(_){var C=_.id();if(_.isNode()){var N=_.indegree(!0),A=_.outdegree(!0),I=N-A,j=A-N;I==1?l?o=!0:l=C:j==1?u?o=!0:u=C:(j>1||I>1)&&(o=!0),h[C]=[],_.outgoers().forEach(function(O){O.isEdge()&&h[C].push(O.id())})}else p[C]=[void 0,_.target().id()]}):s.forEach(function(_){var C=_.id();if(_.isNode()){var N=_.degree(!0);N%2&&(l?u?o=!0:u=C:l=C),h[C]=[],_.connectedEdges().forEach(function(A){return h[C].push(A.id())})}else p[C]=[_.source().id(),_.target().id()]});var v={found:!1,trail:void 0};if(o)return v;if(u&&l)if(a){if(c&&u!=c)return v;c=u}else{if(c&&u!=c&&l!=c)return v;c||(c=u)}else c||(c=s[0].id());var y=function(C){for(var N=C,A=[C],I,j,O;h[N].length;)I=h[N].shift(),j=p[I][0],O=p[I][1],N!=O?(h[O]=h[O].filter(function(F){return F!=I}),N=O):!a&&N!=j&&(h[j]=h[j].filter(function(F){return F!=I}),N=j),A.unshift(I),A.unshift(N);return A},S=[],w=[];for(w=y(c);w.length!=1;)h[w[0]].length==0?(S.unshift(s.getElementById(w.shift())),S.unshift(s.getElementById(w.shift()))):w=y(w.shift()).concat(w);S.unshift(s.getElementById(w.shift()));for(var T in h)if(h[T].length)return v;return v.found=!0,v.trail=this.spawn(S,!0),v}},J0=function(){var e=this,r={},n=0,i=0,a=[],s=[],o={},l=function(p,v){for(var y=s.length-1,S=[],w=e.spawn();s[y].x!=p||s[y].y!=v;)S.push(s.pop().edge),y--;S.push(s.pop().edge),S.forEach(function(T){var _=T.connectedNodes().intersection(e);w.merge(T),_.forEach(function(C){var N=C.id(),A=C.connectedEdges().intersection(e);w.merge(C),r[N].cutVertex?w.merge(A.filter(function(I){return I.isLoop()})):w.merge(A)})}),a.push(w)},u=function(p,v,y){p===y&&(i+=1),r[v]={id:n,low:n++,cutVertex:!1};var S=e.getElementById(v).connectedEdges().intersection(e);if(S.size()===0)a.push(e.spawn(e.getElementById(v)));else{var w,T,_,C;S.forEach(function(N){w=N.source().id(),T=N.target().id(),_=w===v?T:w,_!==y&&(C=N.id(),o[C]||(o[C]=!0,s.push({x:v,y:_,edge:N})),_ in r?r[v].low=Math.min(r[v].low,r[_].id):(u(p,_,v),r[v].low=Math.min(r[v].low,r[_].low),r[v].id<=r[_].low&&(r[v].cutVertex=!0,l(v,_))))})}};e.forEach(function(h){if(h.isNode()){var p=h.id();p in r||(i=0,u(p,p),r[p].cutVertex=i>1)}});var c=Object.keys(r).filter(function(h){return r[h].cutVertex}).map(function(h){return e.getElementById(h)});return{cut:e.spawn(c),components:a}},QF={hopcroftTarjanBiconnected:J0,htbc:J0,htb:J0,hopcroftTarjanBiconnectedComponents:J0},ey=function(){var e=this,r={},n=0,i=[],a=[],s=e.spawn(e),o=function(u){a.push(u),r[u]={index:n,low:n++,explored:!1};var c=e.getElementById(u).connectedEdges().intersection(e);if(c.forEach(function(S){var w=S.target().id();w!==u&&(w in r||o(w),r[w].explored||(r[u].low=Math.min(r[u].low,r[w].low)))}),r[u].index===r[u].low){for(var h=e.spawn();;){var p=a.pop();if(h.merge(e.getElementById(p)),r[p].low=r[u].index,r[p].explored=!0,p===u)break}var v=h.edgesWith(h),y=h.merge(v);i.push(y),s=s.difference(y)}};return e.forEach(function(l){if(l.isNode()){var u=l.id();u in r||o(u)}}),{cut:s,components:i}},JF={tarjanStronglyConnected:ey,tsc:ey,tscc:ey,tarjanStronglyConnectedComponents:ey},aA={};[bv,P9,M9,R9,O9,I9,B9,hF,Fp,Bp,IS,CF,FF,GF,ZF,XF,QF,JF].forEach(function(t){er(aA,t)});var sA=0,oA=1,lA=2,Ll=function(e){if(!(this instanceof Ll))return new Ll(e);this.id="Thenable/1.0.7",this.state=sA,this.fulfillValue=void 0,this.rejectReason=void 0,this.onFulfilled=[],this.onRejected=[],this.proxy={then:this.then.bind(this)},typeof e=="function"&&e.call(this,this.fulfill.bind(this),this.reject.bind(this))};Ll.prototype={fulfill:function(e){return hT(this,oA,"fulfillValue",e)},reject:function(e){return hT(this,lA,"rejectReason",e)},then:function(e,r){var n=this,i=new Ll;return n.onFulfilled.push(pT(e,i,"fulfill")),n.onRejected.push(pT(r,i,"reject")),uA(n),i.proxy}};var hT=function(e,r,n,i){return e.state===sA&&(e.state=r,e[n]=i,uA(e)),e},uA=function(e){e.state===oA?fT(e,"onFulfilled",e.fulfillValue):e.state===lA&&fT(e,"onRejected",e.rejectReason)},fT=function(e,r,n){if(e[r].length!==0){var i=e[r];e[r]=[];var a=function(){for(var o=0;o<i.length;o++)i[o](n)};typeof setImmediate=="function"?setImmediate(a):setTimeout(a,0)}},pT=function(e,r,n){return function(i){if(typeof e!="function")r[n].call(r,i);else{var a;try{a=e(i)}catch(s){r.reject(s);return}cA(r,a)}}},cA=function(e,r){if(e===r||e.proxy===r){e.reject(new TypeError("cannot resolve promise with itself"));return}var n;if(Yi(r)==="object"&&r!==null||typeof r=="function")try{n=r.then}catch(a){e.reject(a);return}if(typeof n=="function"){var i=!1;try{n.call(r,function(a){i||(i=!0,a===r?e.reject(new TypeError("circular thenable chain")):cA(e,a))},function(a){i||(i=!0,e.reject(a))})}catch(a){i||e.reject(a)}return}e.fulfill(r)};Ll.all=function(t){return new Ll(function(e,r){for(var n=new Array(t.length),i=0,a=function(l,u){n[l]=u,i++,i===t.length&&e(n)},s=0;s<t.length;s++)(function(o){var l=t[o],u=l!=null&&l.then!=null;if(u)l.then(function(h){a(o,h)},function(h){r(h)});else{var c=l;a(o,c)}})(s)})};Ll.resolve=function(t){return new Ll(function(e,r){e(t)})};Ll.reject=function(t){return new Ll(function(e,r){r(t)})};var cm=typeof Promise<"u"?Promise:Ll,BS=function(e,r,n){var i=Xk(e),a=!i,s=this._private=er({duration:1e3},r,n);if(s.target=e,s.style=s.style||s.css,s.started=!1,s.playing=!1,s.hooked=!1,s.applying=!1,s.progress=0,s.completes=[],s.frames=[],s.complete&&ni(s.complete)&&s.completes.push(s.complete),a){var o=e.position();s.startPosition=s.startPosition||{x:o.x,y:o.y},s.startStyle=s.startStyle||e.cy().style().getAnimationStartStyle(e,s.style)}if(i){var l=e.pan();s.startPan={x:l.x,y:l.y},s.startZoom=e.zoom()}this.length=1,this[0]=this},gf=BS.prototype;er(gf,{instanceString:function(){return"animation"},hook:function(){var e=this._private;if(!e.hooked){var r,n=e.target._private.animation;e.queue?r=n.queue:r=n.current,r.push(this),po(e.target)&&e.target.cy().addToAnimationPool(e.target),e.hooked=!0}return this},play:function(){var e=this._private;return e.progress===1&&(e.progress=0),e.playing=!0,e.started=!1,e.stopped=!1,this.hook(),this},playing:function(){return this._private.playing},apply:function(){var e=this._private;return e.applying=!0,e.started=!1,e.stopped=!1,this.hook(),this},applying:function(){return this._private.applying},pause:function(){var e=this._private;return e.playing=!1,e.started=!1,this},stop:function(){var e=this._private;return e.playing=!1,e.started=!1,e.stopped=!0,this},rewind:function(){return this.progress(0)},fastforward:function(){return this.progress(1)},time:function(e){var r=this._private;return e===void 0?r.progress*r.duration:this.progress(e/r.duration)},progress:function(e){var r=this._private,n=r.playing;return e===void 0?r.progress:(n&&this.pause(),r.progress=e,r.started=!1,n&&this.play(),this)},completed:function(){return this._private.progress===1},reverse:function(){var e=this._private,r=e.playing;r&&this.pause(),e.progress=1-e.progress,e.started=!1;var n=function(u,c){var h=e[u];h!=null&&(e[u]=e[c],e[c]=h)};if(n("zoom","startZoom"),n("pan","startPan"),n("position","startPosition"),e.style)for(var i=0;i<e.style.length;i++){var a=e.style[i],s=a.name,o=e.startStyle[s];e.startStyle[s]=a,e.style[i]=o}return r&&this.play(),this},promise:function(e){var r=this._private,n;switch(e){case"frame":n=r.frames;break;default:case"complete":case"completed":n=r.completes}return new cm(function(i,a){n.push(function(){i()})})}});gf.complete=gf.completed;gf.run=gf.play;gf.running=gf.playing;var eB={animated:function(){return function(){var r=this,n=r.length!==void 0,i=n?r:[r],a=this._private.cy||this;if(!a.styleEnabled())return!1;var s=i[0];if(s)return s._private.animation.current.length>0}},clearQueue:function(){return function(){var r=this,n=r.length!==void 0,i=n?r:[r],a=this._private.cy||this;if(!a.styleEnabled())return this;for(var s=0;s<i.length;s++){var o=i[s];o._private.animation.queue=[]}return this}},delay:function(){return function(r,n){var i=this._private.cy||this;return i.styleEnabled()?this.animate({delay:r,duration:r,complete:n}):this}},delayAnimation:function(){return function(r,n){var i=this._private.cy||this;return i.styleEnabled()?this.animation({delay:r,duration:r,complete:n}):this}},animation:function(){return function(r,n){var i=this,a=i.length!==void 0,s=a?i:[i],o=this._private.cy||this,l=!a,u=!l;if(!o.styleEnabled())return this;var c=o.style();r=er({},r,n);var h=Object.keys(r).length===0;if(h)return new BS(s[0],r);switch(r.duration===void 0&&(r.duration=400),r.duration){case"slow":r.duration=600;break;case"fast":r.duration=200;break}if(u&&(r.style=c.getPropsList(r.style||r.css),r.css=void 0),u&&r.renderedPosition!=null){var p=r.renderedPosition,v=o.pan(),y=o.zoom();r.position=ZM(p,y,v)}if(l&&r.panBy!=null){var S=r.panBy,w=o.pan();r.pan={x:w.x+S.x,y:w.y+S.y}}var T=r.center||r.centre;if(l&&T!=null){var _=o.getCenterPan(T.eles,r.zoom);_!=null&&(r.pan=_)}if(l&&r.fit!=null){var C=r.fit,N=o.getFitViewport(C.eles||C.boundingBox,C.padding);N!=null&&(r.pan=N.pan,r.zoom=N.zoom)}if(l&&Fr(r.zoom)){var A=o.getZoomedViewport(r.zoom);A!=null?(A.zoomed&&(r.zoom=A.zoom),A.panned&&(r.pan=A.pan)):r.zoom=null}return new BS(s[0],r)}},animate:function(){return function(r,n){var i=this,a=i.length!==void 0,s=a?i:[i],o=this._private.cy||this;if(!o.styleEnabled())return this;n&&(r=er({},r,n));for(var l=0;l<s.length;l++){var u=s[l],c=u.animated()&&(r.queue===void 0||r.queue),h=u.animation(r,c?{queue:!0}:void 0);h.play()}return this}},stop:function(){return function(r,n){var i=this,a=i.length!==void 0,s=a?i:[i],o=this._private.cy||this;if(!o.styleEnabled())return this;for(var l=0;l<s.length;l++){for(var u=s[l],c=u._private,h=c.animation.current,p=0;p<h.length;p++){var v=h[p],y=v._private;n&&(y.duration=0)}r&&(c.animation.queue=[]),n||(c.animation.current=[])}return o.notify("draw"),this}}},cw,mT;function C1(){if(mT)return cw;mT=1;var t=Array.isArray;return cw=t,cw}var dw,gT;function tB(){if(gT)return dw;gT=1;var t=C1(),e=Xv(),r=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,n=/^\w*$/;function i(a,s){if(t(a))return!1;var o=typeof a;return o=="number"||o=="symbol"||o=="boolean"||a==null||e(a)?!0:n.test(a)||!r.test(a)||s!=null&&a in Object(s)}return dw=i,dw}var hw,vT;function rB(){if(vT)return hw;vT=1;var t=zM(),e=Yv(),r="[object AsyncFunction]",n="[object Function]",i="[object GeneratorFunction]",a="[object Proxy]";function s(o){if(!e(o))return!1;var l=t(o);return l==n||l==i||l==r||l==a}return hw=s,hw}var fw,yT;function nB(){if(yT)return fw;yT=1;var t=w1(),e=t["__core-js_shared__"];return fw=e,fw}var pw,xT;function iB(){if(xT)return pw;xT=1;var t=nB(),e=(function(){var n=/[^.]+$/.exec(t&&t.keys&&t.keys.IE_PROTO||"");return n?"Symbol(src)_1."+n:""})();function r(n){return!!e&&e in n}return pw=r,pw}var mw,bT;function aB(){if(bT)return mw;bT=1;var t=Function.prototype,e=t.toString;function r(n){if(n!=null){try{return e.call(n)}catch{}try{return n+""}catch{}}return""}return mw=r,mw}var gw,wT;function sB(){if(wT)return gw;wT=1;var t=rB(),e=iB(),r=Yv(),n=aB(),i=/[\\^$.*+?()[\]{}|]/g,a=/^\[object .+?Constructor\]$/,s=Function.prototype,o=Object.prototype,l=s.toString,u=o.hasOwnProperty,c=RegExp("^"+l.call(u).replace(i,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function h(p){if(!r(p)||e(p))return!1;var v=t(p)?c:a;return v.test(n(p))}return gw=h,gw}var vw,ST;function oB(){if(ST)return vw;ST=1;function t(e,r){return e?.[r]}return vw=t,vw}var yw,kT;function l_(){if(kT)return yw;kT=1;var t=sB(),e=oB();function r(n,i){var a=e(n,i);return t(a)?a:void 0}return yw=r,yw}var xw,_T;function E1(){if(_T)return xw;_T=1;var t=l_(),e=t(Object,"create");return xw=e,xw}var bw,CT;function lB(){if(CT)return bw;CT=1;var t=E1();function e(){this.__data__=t?t(null):{},this.size=0}return bw=e,bw}var ww,ET;function uB(){if(ET)return ww;ET=1;function t(e){var r=this.has(e)&&delete this.__data__[e];return this.size-=r?1:0,r}return ww=t,ww}var Sw,TT;function cB(){if(TT)return Sw;TT=1;var t=E1(),e="__lodash_hash_undefined__",r=Object.prototype,n=r.hasOwnProperty;function i(a){var s=this.__data__;if(t){var o=s[a];return o===e?void 0:o}return n.call(s,a)?s[a]:void 0}return Sw=i,Sw}var kw,NT;function dB(){if(NT)return kw;NT=1;var t=E1(),e=Object.prototype,r=e.hasOwnProperty;function n(i){var a=this.__data__;return t?a[i]!==void 0:r.call(a,i)}return kw=n,kw}var _w,PT;function hB(){if(PT)return _w;PT=1;var t=E1(),e="__lodash_hash_undefined__";function r(n,i){var a=this.__data__;return this.size+=this.has(n)?0:1,a[n]=t&&i===void 0?e:i,this}return _w=r,_w}var Cw,MT;function fB(){if(MT)return Cw;MT=1;var t=lB(),e=uB(),r=cB(),n=dB(),i=hB();function a(s){var o=-1,l=s==null?0:s.length;for(this.clear();++o<l;){var u=s[o];this.set(u[0],u[1])}}return a.prototype.clear=t,a.prototype.delete=e,a.prototype.get=r,a.prototype.has=n,a.prototype.set=i,Cw=a,Cw}var Ew,AT;function pB(){if(AT)return Ew;AT=1;function t(){this.__data__=[],this.size=0}return Ew=t,Ew}var Tw,RT;function dA(){if(RT)return Tw;RT=1;function t(e,r){return e===r||e!==e&&r!==r}return Tw=t,Tw}var Nw,LT;function T1(){if(LT)return Nw;LT=1;var t=dA();function e(r,n){for(var i=r.length;i--;)if(t(r[i][0],n))return i;return-1}return Nw=e,Nw}var Pw,OT;function mB(){if(OT)return Pw;OT=1;var t=T1(),e=Array.prototype,r=e.splice;function n(i){var a=this.__data__,s=t(a,i);if(s<0)return!1;var o=a.length-1;return s==o?a.pop():r.call(a,s,1),--this.size,!0}return Pw=n,Pw}var Mw,DT;function gB(){if(DT)return Mw;DT=1;var t=T1();function e(r){var n=this.__data__,i=t(n,r);return i<0?void 0:n[i][1]}return Mw=e,Mw}var Aw,IT;function vB(){if(IT)return Aw;IT=1;var t=T1();function e(r){return t(this.__data__,r)>-1}return Aw=e,Aw}var Rw,jT;function yB(){if(jT)return Rw;jT=1;var t=T1();function e(r,n){var i=this.__data__,a=t(i,r);return a<0?(++this.size,i.push([r,n])):i[a][1]=n,this}return Rw=e,Rw}var Lw,FT;function xB(){if(FT)return Lw;FT=1;var t=pB(),e=mB(),r=gB(),n=vB(),i=yB();function a(s){var o=-1,l=s==null?0:s.length;for(this.clear();++o<l;){var u=s[o];this.set(u[0],u[1])}}return a.prototype.clear=t,a.prototype.delete=e,a.prototype.get=r,a.prototype.has=n,a.prototype.set=i,Lw=a,Lw}var Ow,BT;function bB(){if(BT)return Ow;BT=1;var t=l_(),e=w1(),r=t(e,"Map");return Ow=r,Ow}var Dw,zT;function wB(){if(zT)return Dw;zT=1;var t=fB(),e=xB(),r=bB();function n(){this.size=0,this.__data__={hash:new t,map:new(r||e),string:new t}}return Dw=n,Dw}var Iw,UT;function SB(){if(UT)return Iw;UT=1;function t(e){var r=typeof e;return r=="string"||r=="number"||r=="symbol"||r=="boolean"?e!=="__proto__":e===null}return Iw=t,Iw}var jw,GT;function N1(){if(GT)return jw;GT=1;var t=SB();function e(r,n){var i=r.__data__;return t(n)?i[typeof n=="string"?"string":"hash"]:i.map}return jw=e,jw}var Fw,VT;function kB(){if(VT)return Fw;VT=1;var t=N1();function e(r){var n=t(this,r).delete(r);return this.size-=n?1:0,n}return Fw=e,Fw}var Bw,HT;function _B(){if(HT)return Bw;HT=1;var t=N1();function e(r){return t(this,r).get(r)}return Bw=e,Bw}var zw,WT;function CB(){if(WT)return zw;WT=1;var t=N1();function e(r){return t(this,r).has(r)}return zw=e,zw}var Uw,qT;function EB(){if(qT)return Uw;qT=1;var t=N1();function e(r,n){var i=t(this,r),a=i.size;return i.set(r,n),this.size+=i.size==a?0:1,this}return Uw=e,Uw}var Gw,$T;function TB(){if($T)return Gw;$T=1;var t=wB(),e=kB(),r=_B(),n=CB(),i=EB();function a(s){var o=-1,l=s==null?0:s.length;for(this.clear();++o<l;){var u=s[o];this.set(u[0],u[1])}}return a.prototype.clear=t,a.prototype.delete=e,a.prototype.get=r,a.prototype.has=n,a.prototype.set=i,Gw=a,Gw}var Vw,KT;function NB(){if(KT)return Vw;KT=1;var t=TB(),e="Expected a function";function r(n,i){if(typeof n!="function"||i!=null&&typeof i!="function")throw new TypeError(e);var a=function(){var s=arguments,o=i?i.apply(this,s):s[0],l=a.cache;if(l.has(o))return l.get(o);var u=n.apply(this,s);return a.cache=l.set(o,u)||l,u};return a.cache=new(r.Cache||t),a}return r.Cache=t,Vw=r,Vw}var Hw,ZT;function PB(){if(ZT)return Hw;ZT=1;var t=NB(),e=500;function r(n){var i=t(n,function(s){return a.size===e&&a.clear(),s}),a=i.cache;return i}return Hw=r,Hw}var Ww,YT;function hA(){if(YT)return Ww;YT=1;var t=PB(),e=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,r=/\\(\\)?/g,n=t(function(i){var a=[];return i.charCodeAt(0)===46&&a.push(""),i.replace(e,function(s,o,l,u){a.push(l?u.replace(r,"$1"):o||s)}),a});return Ww=n,Ww}var qw,XT;function fA(){if(XT)return qw;XT=1;function t(e,r){for(var n=-1,i=e==null?0:e.length,a=Array(i);++n<i;)a[n]=r(e[n],n,e);return a}return qw=t,qw}var $w,QT;function MB(){if(QT)return $w;QT=1;var t=Jk(),e=fA(),r=C1(),n=Xv(),i=t?t.prototype:void 0,a=i?i.toString:void 0;function s(o){if(typeof o=="string")return o;if(r(o))return e(o,s)+"";if(n(o))return a?a.call(o):"";var l=o+"";return l=="0"&&1/o==-1/0?"-0":l}return $w=s,$w}var Kw,JT;function pA(){if(JT)return Kw;JT=1;var t=MB();function e(r){return r==null?"":t(r)}return Kw=e,Kw}var Zw,eN;function mA(){if(eN)return Zw;eN=1;var t=C1(),e=tB(),r=hA(),n=pA();function i(a,s){return t(a)?a:e(a,s)?[a]:r(n(a))}return Zw=i,Zw}var Yw,tN;function u_(){if(tN)return Yw;tN=1;var t=Xv();function e(r){if(typeof r=="string"||t(r))return r;var n=r+"";return n=="0"&&1/r==-1/0?"-0":n}return Yw=e,Yw}var Xw,rN;function AB(){if(rN)return Xw;rN=1;var t=mA(),e=u_();function r(n,i){i=t(i,n);for(var a=0,s=i.length;n!=null&&a<s;)n=n[e(i[a++])];return a&&a==s?n:void 0}return Xw=r,Xw}var Qw,nN;function RB(){if(nN)return Qw;nN=1;var t=AB();function e(r,n,i){var a=r==null?void 0:t(r,n);return a===void 0?i:a}return Qw=e,Qw}var LB=RB(),OB=Zv(LB),Jw,iN;function DB(){if(iN)return Jw;iN=1;var t=l_(),e=(function(){try{var r=t(Object,"defineProperty");return r({},"",{}),r}catch{}})();return Jw=e,Jw}var e2,aN;function IB(){if(aN)return e2;aN=1;var t=DB();function e(r,n,i){n=="__proto__"&&t?t(r,n,{configurable:!0,enumerable:!0,value:i,writable:!0}):r[n]=i}return e2=e,e2}var t2,sN;function jB(){if(sN)return t2;sN=1;var t=IB(),e=dA(),r=Object.prototype,n=r.hasOwnProperty;function i(a,s,o){var l=a[s];(!(n.call(a,s)&&e(l,o))||o===void 0&&!(s in a))&&t(a,s,o)}return t2=i,t2}var r2,oN;function FB(){if(oN)return r2;oN=1;var t=9007199254740991,e=/^(?:0|[1-9]\d*)$/;function r(n,i){var a=typeof n;return i=i??t,!!i&&(a=="number"||a!="symbol"&&e.test(n))&&n>-1&&n%1==0&&n<i}return r2=r,r2}var n2,lN;function BB(){if(lN)return n2;lN=1;var t=jB(),e=mA(),r=FB(),n=Yv(),i=u_();function a(s,o,l,u){if(!n(s))return s;o=e(o,s);for(var c=-1,h=o.length,p=h-1,v=s;v!=null&&++c<h;){var y=i(o[c]),S=l;if(y==="__proto__"||y==="constructor"||y==="prototype")return s;if(c!=p){var w=v[y];S=u?u(w,y,v):void 0,S===void 0&&(S=n(w)?w:r(o[c+1])?[]:{})}t(v,y,S),v=v[y]}return s}return n2=a,n2}var i2,uN;function zB(){if(uN)return i2;uN=1;var t=BB();function e(r,n,i){return r==null?r:t(r,n,i)}return i2=e,i2}var UB=zB(),GB=Zv(UB),a2,cN;function VB(){if(cN)return a2;cN=1;function t(e,r){var n=-1,i=e.length;for(r||(r=Array(i));++n<i;)r[n]=e[n];return r}return a2=t,a2}var s2,dN;function HB(){if(dN)return s2;dN=1;var t=fA(),e=VB(),r=C1(),n=Xv(),i=hA(),a=u_(),s=pA();function o(l){return r(l)?t(l,a):n(l)?[l]:e(i(s(l)))}return s2=o,s2}var WB=HB(),qB=Zv(WB),$B={data:function(e){var r={field:"data",bindingEvent:"data",allowBinding:!1,allowSetting:!1,allowGetting:!1,settingEvent:"data",settingTriggersEvent:!1,triggerFnName:"trigger",immutableKeys:{},updateStyle:!1,beforeGet:function(i){},beforeSet:function(i,a){},onSet:function(i){},canSet:function(i){return!0}};return e=er({},r,e),function(i,a){var s=e,o=this,l=o.length!==void 0,u=l?o:[o],c=l?o[0]:o;if(Wt(i)){var h=i.indexOf(".")!==-1,p=h&&qB(i);if(s.allowGetting&&a===void 0){var v;return c&&(s.beforeGet(c),p&&c._private[s.field][i]===void 0?v=OB(c._private[s.field],p):v=c._private[s.field][i]),v}else if(s.allowSetting&&a!==void 0){var y=!s.immutableKeys[i];if(y){var S=MM({},i,a);s.beforeSet(o,S);for(var w=0,T=u.length;w<T;w++){var _=u[w];s.canSet(_)&&(p&&c._private[s.field][i]===void 0?GB(_._private[s.field],p,a):_._private[s.field][i]=a)}s.updateStyle&&o.updateStyle(),s.onSet(o),s.settingTriggersEvent&&o[s.triggerFnName](s.settingEvent)}}}else if(s.allowSetting&&Fr(i)){var C=i,N,A,I=Object.keys(C);s.beforeSet(o,C);for(var j=0;j<I.length;j++){N=I[j],A=C[N];var O=!s.immutableKeys[N];if(O)for(var F=0;F<u.length;F++){var B=u[F];s.canSet(B)&&(B._private[s.field][N]=A)}}s.updateStyle&&o.updateStyle(),s.onSet(o),s.settingTriggersEvent&&o[s.triggerFnName](s.settingEvent)}else if(s.allowBinding&&ni(i)){var $=i;o.on(s.bindingEvent,$)}else if(s.allowGetting&&i===void 0){var Z;return c&&(s.beforeGet(c),Z=c._private[s.field]),Z}return o}},removeData:function(e){var r={field:"data",event:"data",triggerFnName:"trigger",triggerEvent:!1,immutableKeys:{}};return e=er({},r,e),function(i){var a=e,s=this,o=s.length!==void 0,l=o?s:[s];if(Wt(i)){for(var u=i.split(/\s+/),c=u.length,h=0;h<c;h++){var p=u[h];if(!Zd(p)){var v=!a.immutableKeys[p];if(v)for(var y=0,S=l.length;y<S;y++)l[y]._private[a.field][p]=void 0}}a.triggerEvent&&s[a.triggerFnName](a.event)}else if(i===void 0){for(var w=0,T=l.length;w<T;w++)for(var _=l[w]._private[a.field],C=Object.keys(_),N=0;N<C.length;N++){var A=C[N],I=!a.immutableKeys[A];I&&(_[A]=void 0)}a.triggerEvent&&s[a.triggerFnName](a.event)}return s}}},KB={eventAliasesOn:function(e){var r=e;r.addListener=r.listen=r.bind=r.on,r.unlisten=r.unbind=r.off=r.removeListener,r.trigger=r.emit,r.pon=r.promiseOn=function(n,i){var a=this,s=Array.prototype.slice.call(arguments,0);return new cm(function(o,l){var u=function(v){a.off.apply(a,h),o(v)},c=s.concat([u]),h=c.concat([]);a.on.apply(a,c)})}}},tn={};[eB,$B,KB].forEach(function(t){er(tn,t)});var ZB={animate:tn.animate(),animation:tn.animation(),animated:tn.animated(),clearQueue:tn.clearQueue(),delay:tn.delay(),delayAnimation:tn.delayAnimation(),stop:tn.stop()},jy={classes:function(e){var r=this;if(e===void 0){var n=[];return r[0]._private.classes.forEach(function(y){return n.push(y)}),n}else xn(e)||(e=(e||"").match(/\S+/g)||[]);for(var i=[],a=new um(e),s=0;s<r.length;s++){for(var o=r[s],l=o._private,u=l.classes,c=!1,h=0;h<e.length;h++){var p=e[h],v=u.has(p);if(!v){c=!0;break}}c||(c=u.size!==e.length),c&&(l.classes=a,i.push(o))}return i.length>0&&this.spawn(i).updateStyle().emit("class"),r},addClass:function(e){return this.toggleClass(e,!0)},hasClass:function(e){var r=this[0];return r!=null&&r._private.classes.has(e)},toggleClass:function(e,r){xn(e)||(e=e.match(/\S+/g)||[]);for(var n=this,i=r===void 0,a=[],s=0,o=n.length;s<o;s++)for(var l=n[s],u=l._private.classes,c=!1,h=0;h<e.length;h++){var p=e[h],v=u.has(p),y=!1;r||i&&!v?(u.add(p),y=!0):(!r||i&&v)&&(u.delete(p),y=!0),!c&&y&&(a.push(l),c=!0)}return a.length>0&&this.spawn(a).updateStyle().emit("class"),n},removeClass:function(e){return this.toggleClass(e,!1)},flashClass:function(e,r){var n=this;if(r==null)r=250;else if(r===0)return n;return n.addClass(e),setTimeout(function(){n.removeClass(e)},r),n}};jy.className=jy.classNames=jy.classes;var jr={metaChar:"[\\!\\\"\\#\\$\\%\\&\\'\\(\\)\\*\\+\\,\\.\\/\\:\\;\\<\\=\\>\\?\\@\\[\\]\\^\\`\\{\\|\\}\\~]",comparatorOp:"=|\\!=|>|>=|<|<=|\\$=|\\^=|\\*=",boolOp:"\\?|\\!|\\^",string:`"(?:\\\\"|[^"])*"|'(?:\\\\'|[^'])*'`,number:Ki,meta:"degree|indegree|outdegree",separator:"\\s*,\\s*",descendant:"\\s+",child:"\\s+>\\s+",subject:"\\$",group:"node|edge|\\*",directedEdge:"\\s+->\\s+",undirectedEdge:"\\s+<->\\s+"};jr.variable="(?:[\\w-.]|(?:\\\\"+jr.metaChar+"))+";jr.className="(?:[\\w-]|(?:\\\\"+jr.metaChar+"))+";jr.value=jr.string+"|"+jr.number;jr.id=jr.variable;(function(){var t,e,r;for(t=jr.comparatorOp.split("|"),r=0;r<t.length;r++)e=t[r],jr.comparatorOp+="|@"+e;for(t=jr.comparatorOp.split("|"),r=0;r<t.length;r++)e=t[r],!(e.indexOf("!")>=0)&&e!=="="&&(jr.comparatorOp+="|\\!"+e)})();var pn=function(){return{checks:[]}},Ot={GROUP:0,COLLECTION:1,FILTER:2,DATA_COMPARE:3,DATA_EXIST:4,DATA_BOOL:5,META_COMPARE:6,STATE:7,ID:8,CLASS:9,UNDIRECTED_EDGE:10,DIRECTED_EDGE:11,NODE_SOURCE:12,NODE_TARGET:13,NODE_NEIGHBOR:14,CHILD:15,DESCENDANT:16,PARENT:17,ANCESTOR:18,COMPOUND_SPLIT:19,TRUE:20},zS=[{selector:":selected",matches:function(e){return e.selected()}},{selector:":unselected",matches:function(e){return!e.selected()}},{selector:":selectable",matches:function(e){return e.selectable()}},{selector:":unselectable",matches:function(e){return!e.selectable()}},{selector:":locked",matches:function(e){return e.locked()}},{selector:":unlocked",matches:function(e){return!e.locked()}},{selector:":visible",matches:function(e){return e.visible()}},{selector:":hidden",matches:function(e){return!e.visible()}},{selector:":transparent",matches:function(e){return e.transparent()}},{selector:":grabbed",matches:function(e){return e.grabbed()}},{selector:":free",matches:function(e){return!e.grabbed()}},{selector:":removed",matches:function(e){return e.removed()}},{selector:":inside",matches:function(e){return!e.removed()}},{selector:":grabbable",matches:function(e){return e.grabbable()}},{selector:":ungrabbable",matches:function(e){return!e.grabbable()}},{selector:":animated",matches:function(e){return e.animated()}},{selector:":unanimated",matches:function(e){return!e.animated()}},{selector:":parent",matches:function(e){return e.isParent()}},{selector:":childless",matches:function(e){return e.isChildless()}},{selector:":child",matches:function(e){return e.isChild()}},{selector:":orphan",matches:function(e){return e.isOrphan()}},{selector:":nonorphan",matches:function(e){return e.isChild()}},{selector:":compound",matches:function(e){return e.isNode()?e.isParent():e.source().isParent()||e.target().isParent()}},{selector:":loop",matches:function(e){return e.isLoop()}},{selector:":simple",matches:function(e){return e.isSimple()}},{selector:":active",matches:function(e){return e.active()}},{selector:":inactive",matches:function(e){return!e.active()}},{selector:":backgrounding",matches:function(e){return e.backgrounding()}},{selector:":nonbackgrounding",matches:function(e){return!e.backgrounding()}}].sort(function(t,e){return $j(t.selector,e.selector)}),YB=(function(){for(var t={},e,r=0;r<zS.length;r++)e=zS[r],t[e.selector]=e.matches;return t})(),XB=function(e,r){return YB[e](r)},QB="("+zS.map(function(t){return t.selector}).join("|")+")",hp=function(e){return e.replace(new RegExp("\\\\("+jr.metaChar+")","g"),function(r,n){return n})},yd=function(e,r,n){e[e.length-1]=n},US=[{name:"group",query:!0,regex:"("+jr.group+")",populate:function(e,r,n){var i=ji(n,1),a=i[0];r.checks.push({type:Ot.GROUP,value:a==="*"?a:a+"s"})}},{name:"state",query:!0,regex:QB,populate:function(e,r,n){var i=ji(n,1),a=i[0];r.checks.push({type:Ot.STATE,value:a})}},{name:"id",query:!0,regex:"\\#("+jr.id+")",populate:function(e,r,n){var i=ji(n,1),a=i[0];r.checks.push({type:Ot.ID,value:hp(a)})}},{name:"className",query:!0,regex:"\\.("+jr.className+")",populate:function(e,r,n){var i=ji(n,1),a=i[0];r.checks.push({type:Ot.CLASS,value:hp(a)})}},{name:"dataExists",query:!0,regex:"\\[\\s*("+jr.variable+")\\s*\\]",populate:function(e,r,n){var i=ji(n,1),a=i[0];r.checks.push({type:Ot.DATA_EXIST,field:hp(a)})}},{name:"dataCompare",query:!0,regex:"\\[\\s*("+jr.variable+")\\s*("+jr.comparatorOp+")\\s*("+jr.value+")\\s*\\]",populate:function(e,r,n){var i=ji(n,3),a=i[0],s=i[1],o=i[2],l=new RegExp("^"+jr.string+"$").exec(o)!=null;l?o=o.substring(1,o.length-1):o=parseFloat(o),r.checks.push({type:Ot.DATA_COMPARE,field:hp(a),operator:s,value:o})}},{name:"dataBool",query:!0,regex:"\\[\\s*("+jr.boolOp+")\\s*("+jr.variable+")\\s*\\]",populate:function(e,r,n){var i=ji(n,2),a=i[0],s=i[1];r.checks.push({type:Ot.DATA_BOOL,field:hp(s),operator:a})}},{name:"metaCompare",query:!0,regex:"\\[\\[\\s*("+jr.meta+")\\s*("+jr.comparatorOp+")\\s*("+jr.number+")\\s*\\]\\]",populate:function(e,r,n){var i=ji(n,3),a=i[0],s=i[1],o=i[2];r.checks.push({type:Ot.META_COMPARE,field:hp(a),operator:s,value:parseFloat(o)})}},{name:"nextQuery",separator:!0,regex:jr.separator,populate:function(e,r){var n=e.currentSubject,i=e.edgeCount,a=e.compoundCount,s=e[e.length-1];n!=null&&(s.subject=n,e.currentSubject=null),s.edgeCount=i,s.compoundCount=a,e.edgeCount=0,e.compoundCount=0;var o=e[e.length++]=pn();return o}},{name:"directedEdge",separator:!0,regex:jr.directedEdge,populate:function(e,r){if(e.currentSubject==null){var n=pn(),i=r,a=pn();return n.checks.push({type:Ot.DIRECTED_EDGE,source:i,target:a}),yd(e,r,n),e.edgeCount++,a}else{var s=pn(),o=r,l=pn();return s.checks.push({type:Ot.NODE_SOURCE,source:o,target:l}),yd(e,r,s),e.edgeCount++,l}}},{name:"undirectedEdge",separator:!0,regex:jr.undirectedEdge,populate:function(e,r){if(e.currentSubject==null){var n=pn(),i=r,a=pn();return n.checks.push({type:Ot.UNDIRECTED_EDGE,nodes:[i,a]}),yd(e,r,n),e.edgeCount++,a}else{var s=pn(),o=r,l=pn();return s.checks.push({type:Ot.NODE_NEIGHBOR,node:o,neighbor:l}),yd(e,r,s),l}}},{name:"child",separator:!0,regex:jr.child,populate:function(e,r){if(e.currentSubject==null){var n=pn(),i=pn(),a=e[e.length-1];return n.checks.push({type:Ot.CHILD,parent:a,child:i}),yd(e,r,n),e.compoundCount++,i}else if(e.currentSubject===r){var s=pn(),o=e[e.length-1],l=pn(),u=pn(),c=pn(),h=pn();return s.checks.push({type:Ot.COMPOUND_SPLIT,left:o,right:l,subject:u}),u.checks=r.checks,r.checks=[{type:Ot.TRUE}],h.checks.push({type:Ot.TRUE}),l.checks.push({type:Ot.PARENT,parent:h,child:c}),yd(e,o,s),e.currentSubject=u,e.compoundCount++,c}else{var p=pn(),v=pn(),y=[{type:Ot.PARENT,parent:p,child:v}];return p.checks=r.checks,r.checks=y,e.compoundCount++,v}}},{name:"descendant",separator:!0,regex:jr.descendant,populate:function(e,r){if(e.currentSubject==null){var n=pn(),i=pn(),a=e[e.length-1];return n.checks.push({type:Ot.DESCENDANT,ancestor:a,descendant:i}),yd(e,r,n),e.compoundCount++,i}else if(e.currentSubject===r){var s=pn(),o=e[e.length-1],l=pn(),u=pn(),c=pn(),h=pn();return s.checks.push({type:Ot.COMPOUND_SPLIT,left:o,right:l,subject:u}),u.checks=r.checks,r.checks=[{type:Ot.TRUE}],h.checks.push({type:Ot.TRUE}),l.checks.push({type:Ot.ANCESTOR,ancestor:h,descendant:c}),yd(e,o,s),e.currentSubject=u,e.compoundCount++,c}else{var p=pn(),v=pn(),y=[{type:Ot.ANCESTOR,ancestor:p,descendant:v}];return p.checks=r.checks,r.checks=y,e.compoundCount++,v}}},{name:"subject",modifier:!0,regex:jr.subject,populate:function(e,r){if(e.currentSubject!=null&&e.currentSubject!==r)return rn("Redefinition of subject in selector `"+e.toString()+"`"),!1;e.currentSubject=r;var n=e[e.length-1],i=n.checks[0],a=i==null?null:i.type;a===Ot.DIRECTED_EDGE?i.type=Ot.NODE_TARGET:a===Ot.UNDIRECTED_EDGE&&(i.type=Ot.NODE_NEIGHBOR,i.node=i.nodes[1],i.neighbor=i.nodes[0],i.nodes=null)}}];US.forEach(function(t){return t.regexObj=new RegExp("^"+t.regex)});var JB=function(e){for(var r,n,i,a=0;a<US.length;a++){var s=US[a],o=s.name,l=e.match(s.regexObj);if(l!=null){n=l,r=s,i=o;var u=l[0];e=e.substring(u.length);break}}return{expr:r,match:n,name:i,remaining:e}},e7=function(e){var r=e.match(/^\s+/);if(r){var n=r[0];e=e.substring(n.length)}return e},t7=function(e){var r=this,n=r.inputText=e,i=r[0]=pn();for(r.length=1,n=e7(n);;){var a=JB(n);if(a.expr==null)return rn("The selector `"+e+"`is invalid"),!1;var s=a.match.slice(1),o=a.expr.populate(r,i,s);if(o===!1)return!1;if(o!=null&&(i=o),n=a.remaining,n.match(/^\s*$/))break}var l=r[r.length-1];r.currentSubject!=null&&(l.subject=r.currentSubject),l.edgeCount=r.edgeCount,l.compoundCount=r.compoundCount;for(var u=0;u<r.length;u++){var c=r[u];if(c.compoundCount>0&&c.edgeCount>0)return rn("The selector `"+e+"` is invalid because it uses both a compound selector and an edge selector"),!1;if(c.edgeCount>1)return rn("The selector `"+e+"` is invalid because it uses multiple edge selectors"),!1;c.edgeCount===1&&rn("The selector `"+e+"` is deprecated.  Edge selectors do not take effect on changes to source and target nodes after an edge is added, for performance reasons.  Use a class or data selector on edges instead, updating the class or data of an edge when your app detects a change in source or target nodes.")}return!0},r7=function(){if(this.toStringCache!=null)return this.toStringCache;for(var e=function(c){return c??""},r=function(c){return Wt(c)?'"'+c+'"':e(c)},n=function(c){return" "+c+" "},i=function(c,h){var p=c.type,v=c.value;switch(p){case Ot.GROUP:{var y=e(v);return y.substring(0,y.length-1)}case Ot.DATA_COMPARE:{var S=c.field,w=c.operator;return"["+S+n(e(w))+r(v)+"]"}case Ot.DATA_BOOL:{var T=c.operator,_=c.field;return"["+e(T)+_+"]"}case Ot.DATA_EXIST:{var C=c.field;return"["+C+"]"}case Ot.META_COMPARE:{var N=c.operator,A=c.field;return"[["+A+n(e(N))+r(v)+"]]"}case Ot.STATE:return v;case Ot.ID:return"#"+v;case Ot.CLASS:return"."+v;case Ot.PARENT:case Ot.CHILD:return a(c.parent,h)+n(">")+a(c.child,h);case Ot.ANCESTOR:case Ot.DESCENDANT:return a(c.ancestor,h)+" "+a(c.descendant,h);case Ot.COMPOUND_SPLIT:{var I=a(c.left,h),j=a(c.subject,h),O=a(c.right,h);return I+(I.length>0?" ":"")+j+O}case Ot.TRUE:return""}},a=function(c,h){return c.checks.reduce(function(p,v,y){return p+(h===c&&y===0?"$":"")+i(v,h)},"")},s="",o=0;o<this.length;o++){var l=this[o];s+=a(l,l.subject),this.length>1&&o<this.length-1&&(s+=", ")}return this.toStringCache=s,s},n7={parse:t7,toString:r7},gA=function(e,r,n){var i,a=Wt(e),s=bt(e),o=Wt(n),l,u,c=!1,h=!1,p=!1;switch(r.indexOf("!")>=0&&(r=r.replace("!",""),h=!0),r.indexOf("@")>=0&&(r=r.replace("@",""),c=!0),(a||o||c)&&(l=!a&&!s?"":""+e,u=""+n),c&&(e=l=l.toLowerCase(),n=u=u.toLowerCase()),r){case"*=":i=l.indexOf(u)>=0;break;case"$=":i=l.indexOf(u,l.length-u.length)>=0;break;case"^=":i=l.indexOf(u)===0;break;case"=":i=e===n;break;case">":p=!0,i=e>n;break;case">=":p=!0,i=e>=n;break;case"<":p=!0,i=e<n;break;case"<=":p=!0,i=e<=n;break;default:i=!1;break}return h&&(e!=null||!p)&&(i=!i),i},i7=function(e,r){switch(r){case"?":return!!e;case"!":return!e;case"^":return e===void 0}},a7=function(e){return e!==void 0},c_=function(e,r){return e.data(r)},s7=function(e,r){return e[r]()},pi=[],Rn=function(e,r){return e.checks.every(function(n){return pi[n.type](n,r)})};pi[Ot.GROUP]=function(t,e){var r=t.value;return r==="*"||r===e.group()};pi[Ot.STATE]=function(t,e){var r=t.value;return XB(r,e)};pi[Ot.ID]=function(t,e){var r=t.value;return e.id()===r};pi[Ot.CLASS]=function(t,e){var r=t.value;return e.hasClass(r)};pi[Ot.META_COMPARE]=function(t,e){var r=t.field,n=t.operator,i=t.value;return gA(s7(e,r),n,i)};pi[Ot.DATA_COMPARE]=function(t,e){var r=t.field,n=t.operator,i=t.value;return gA(c_(e,r),n,i)};pi[Ot.DATA_BOOL]=function(t,e){var r=t.field,n=t.operator;return i7(c_(e,r),n)};pi[Ot.DATA_EXIST]=function(t,e){var r=t.field;return t.operator,a7(c_(e,r))};pi[Ot.UNDIRECTED_EDGE]=function(t,e){var r=t.nodes[0],n=t.nodes[1],i=e.source(),a=e.target();return Rn(r,i)&&Rn(n,a)||Rn(n,i)&&Rn(r,a)};pi[Ot.NODE_NEIGHBOR]=function(t,e){return Rn(t.node,e)&&e.neighborhood().some(function(r){return r.isNode()&&Rn(t.neighbor,r)})};pi[Ot.DIRECTED_EDGE]=function(t,e){return Rn(t.source,e.source())&&Rn(t.target,e.target())};pi[Ot.NODE_SOURCE]=function(t,e){return Rn(t.source,e)&&e.outgoers().some(function(r){return r.isNode()&&Rn(t.target,r)})};pi[Ot.NODE_TARGET]=function(t,e){return Rn(t.target,e)&&e.incomers().some(function(r){return r.isNode()&&Rn(t.source,r)})};pi[Ot.CHILD]=function(t,e){return Rn(t.child,e)&&Rn(t.parent,e.parent())};pi[Ot.PARENT]=function(t,e){return Rn(t.parent,e)&&e.children().some(function(r){return Rn(t.child,r)})};pi[Ot.DESCENDANT]=function(t,e){return Rn(t.descendant,e)&&e.ancestors().some(function(r){return Rn(t.ancestor,r)})};pi[Ot.ANCESTOR]=function(t,e){return Rn(t.ancestor,e)&&e.descendants().some(function(r){return Rn(t.descendant,r)})};pi[Ot.COMPOUND_SPLIT]=function(t,e){return Rn(t.subject,e)&&Rn(t.left,e)&&Rn(t.right,e)};pi[Ot.TRUE]=function(){return!0};pi[Ot.COLLECTION]=function(t,e){var r=t.value;return r.has(e)};pi[Ot.FILTER]=function(t,e){var r=t.value;return r(e)};var o7=function(e){var r=this;if(r.length===1&&r[0].checks.length===1&&r[0].checks[0].type===Ot.ID)return e.getElementById(r[0].checks[0].value).collection();var n=function(a){for(var s=0;s<r.length;s++){var o=r[s];if(Rn(o,a))return!0}return!1};return r.text()==null&&(n=function(){return!0}),e.filter(n)},l7=function(e){for(var r=this,n=0;n<r.length;n++){var i=r[n];if(Rn(i,e))return!0}return!1},u7={matches:l7,filter:o7},Qd=function(e){this.inputText=e,this.currentSubject=null,this.compoundCount=0,this.edgeCount=0,this.length=0,e==null||Wt(e)&&e.match(/^\s*$/)||(po(e)?this.addQuery({checks:[{type:Ot.COLLECTION,value:e.collection()}]}):ni(e)?this.addQuery({checks:[{type:Ot.FILTER,value:e}]}):Wt(e)?this.parse(e)||(this.invalid=!0):Kn("A selector must be created from a string; found "))},Jd=Qd.prototype;[n7,u7].forEach(function(t){return er(Jd,t)});Jd.text=function(){return this.inputText};Jd.size=function(){return this.length};Jd.eq=function(t){return this[t]};Jd.sameText=function(t){return!this.invalid&&!t.invalid&&this.text()===t.text()};Jd.addQuery=function(t){this[this.length++]=t};Jd.selector=Jd.toString;var Ud={allAre:function(e){var r=new Qd(e);return this.every(function(n){return r.matches(n)})},is:function(e){var r=new Qd(e);return this.some(function(n){return r.matches(n)})},some:function(e,r){for(var n=0;n<this.length;n++){var i=r?e.apply(r,[this[n],n,this]):e(this[n],n,this);if(i)return!0}return!1},every:function(e,r){for(var n=0;n<this.length;n++){var i=r?e.apply(r,[this[n],n,this]):e(this[n],n,this);if(!i)return!1}return!0},same:function(e){if(this===e)return!0;e=this.cy().collection(e);var r=this.length,n=e.length;return r!==n?!1:r===1?this[0]===e[0]:this.every(function(i){return e.hasElementWithId(i.id())})},anySame:function(e){return e=this.cy().collection(e),this.some(function(r){return e.hasElementWithId(r.id())})},allAreNeighbors:function(e){e=this.cy().collection(e);var r=this.neighborhood();return e.every(function(n){return r.hasElementWithId(n.id())})},contains:function(e){e=this.cy().collection(e);var r=this;return e.every(function(n){return r.hasElementWithId(n.id())})}};Ud.allAreNeighbours=Ud.allAreNeighbors;Ud.has=Ud.contains;Ud.equal=Ud.equals=Ud.same;var Wo=function(e,r){return function(i,a,s,o){var l=i,u=this,c;if(l==null?c="":po(l)&&l.length===1&&(c=l.id()),u.length===1&&c){var h=u[0]._private,p=h.traversalCache=h.traversalCache||{},v=p[r]=p[r]||[],y=pf(c),S=v[y];return S||(v[y]=e.call(u,i,a,s,o))}else return e.call(u,i,a,s,o)}},$p={parent:function(e){var r=[];if(this.length===1){var n=this[0]._private.parent;if(n)return n}for(var i=0;i<this.length;i++){var a=this[i],s=a._private.parent;s&&r.push(s)}return this.spawn(r,!0).filter(e)},parents:function(e){for(var r=[],n=this.parent();n.nonempty();){for(var i=0;i<n.length;i++){var a=n[i];r.push(a)}n=n.parent()}return this.spawn(r,!0).filter(e)},commonAncestors:function(e){for(var r,n=0;n<this.length;n++){var i=this[n],a=i.parents();r=r||a,r=r.intersect(a)}return r.filter(e)},orphans:function(e){return this.stdFilter(function(r){return r.isOrphan()}).filter(e)},nonorphans:function(e){return this.stdFilter(function(r){return r.isChild()}).filter(e)},children:Wo(function(t){for(var e=[],r=0;r<this.length;r++)for(var n=this[r],i=n._private.children,a=0;a<i.length;a++)e.push(i[a]);return this.spawn(e,!0).filter(t)},"children"),siblings:function(e){return this.parent().children().not(this).filter(e)},isParent:function(){var e=this[0];if(e)return e.isNode()&&e._private.children.length!==0},isChildless:function(){var e=this[0];if(e)return e.isNode()&&e._private.children.length===0},isChild:function(){var e=this[0];if(e)return e.isNode()&&e._private.parent!=null},isOrphan:function(){var e=this[0];if(e)return e.isNode()&&e._private.parent==null},descendants:function(e){var r=[];function n(i){for(var a=0;a<i.length;a++){var s=i[a];r.push(s),s.children().nonempty()&&n(s.children())}}return n(this.children()),this.spawn(r,!0).filter(e)}};function d_(t,e,r,n){for(var i=[],a=new um,s=t.cy(),o=s.hasCompoundNodes(),l=0;l<t.length;l++){var u=t[l];r?i.push(u):o&&n(i,a,u)}for(;i.length>0;){var c=i.shift();e(c),a.add(c.id()),o&&n(i,a,c)}return t}function vA(t,e,r){if(r.isParent())for(var n=r._private.children,i=0;i<n.length;i++){var a=n[i];e.has(a.id())||t.push(a)}}$p.forEachDown=function(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return d_(this,t,e,vA)};function yA(t,e,r){if(r.isChild()){var n=r._private.parent;e.has(n.id())||t.push(n)}}$p.forEachUp=function(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return d_(this,t,e,yA)};function c7(t,e,r){yA(t,e,r),vA(t,e,r)}$p.forEachUpAndDown=function(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return d_(this,t,e,c7)};$p.ancestors=$p.parents;var kv,xA;kv=xA={data:tn.data({field:"data",bindingEvent:"data",allowBinding:!0,allowSetting:!0,settingEvent:"data",settingTriggersEvent:!0,triggerFnName:"trigger",allowGetting:!0,immutableKeys:{id:!0,source:!0,target:!0,parent:!0},updateStyle:!0}),removeData:tn.removeData({field:"data",event:"data",triggerFnName:"trigger",triggerEvent:!0,immutableKeys:{id:!0,source:!0,target:!0,parent:!0},updateStyle:!0}),scratch:tn.data({field:"scratch",bindingEvent:"scratch",allowBinding:!0,allowSetting:!0,settingEvent:"scratch",settingTriggersEvent:!0,triggerFnName:"trigger",allowGetting:!0,updateStyle:!0}),removeScratch:tn.removeData({field:"scratch",event:"scratch",triggerFnName:"trigger",triggerEvent:!0,updateStyle:!0}),rscratch:tn.data({field:"rscratch",allowBinding:!1,allowSetting:!0,settingTriggersEvent:!1,allowGetting:!0}),removeRscratch:tn.removeData({field:"rscratch",triggerEvent:!1}),id:function(){var e=this[0];if(e)return e._private.data.id}};kv.attr=kv.data;kv.removeAttr=kv.removeData;var d7=xA,P1={};function o2(t){return function(e){var r=this;if(e===void 0&&(e=!0),r.length!==0)if(r.isNode()&&!r.removed()){for(var n=0,i=r[0],a=i._private.edges,s=0;s<a.length;s++){var o=a[s];!e&&o.isLoop()||(n+=t(i,o))}return n}else return}}er(P1,{degree:o2(function(t,e){return e.source().same(e.target())?2:1}),indegree:o2(function(t,e){return e.target().same(t)?1:0}),outdegree:o2(function(t,e){return e.source().same(t)?1:0})});function fp(t,e){return function(r){for(var n,i=this.nodes(),a=0;a<i.length;a++){var s=i[a],o=s[t](r);o!==void 0&&(n===void 0||e(o,n))&&(n=o)}return n}}er(P1,{minDegree:fp("degree",function(t,e){return t<e}),maxDegree:fp("degree",function(t,e){return t>e}),minIndegree:fp("indegree",function(t,e){return t<e}),maxIndegree:fp("indegree",function(t,e){return t>e}),minOutdegree:fp("outdegree",function(t,e){return t<e}),maxOutdegree:fp("outdegree",function(t,e){return t>e})});er(P1,{totalDegree:function(e){for(var r=0,n=this.nodes(),i=0;i<n.length;i++)r+=n[i].degree(e);return r}});var Rl,bA,wA=function(e,r,n){for(var i=0;i<e.length;i++){var a=e[i];if(!a.locked()){var s=a._private.position,o={x:r.x!=null?r.x-s.x:0,y:r.y!=null?r.y-s.y:0};a.isParent()&&!(o.x===0&&o.y===0)&&a.children().shift(o,n),a.dirtyBoundingBoxCache()}}},hN={field:"position",bindingEvent:"position",allowBinding:!0,allowSetting:!0,settingEvent:"position",settingTriggersEvent:!0,triggerFnName:"emitAndNotify",allowGetting:!0,validKeys:["x","y"],beforeGet:function(e){e.updateCompoundBounds()},beforeSet:function(e,r){wA(e,r,!1)},onSet:function(e){e.dirtyCompoundBoundsCache()},canSet:function(e){return!e.locked()}};Rl=bA={position:tn.data(hN),silentPosition:tn.data(er({},hN,{allowBinding:!1,allowSetting:!0,settingTriggersEvent:!1,allowGetting:!1,beforeSet:function(e,r){wA(e,r,!0)},onSet:function(e){e.dirtyCompoundBoundsCache()}})),positions:function(e,r){if(Fr(e))r?this.silentPosition(e):this.position(e);else if(ni(e)){var n=e,i=this.cy();i.startBatch();for(var a=0;a<this.length;a++){var s=this[a],o=void 0;(o=n(s,a))&&(r?s.silentPosition(o):s.position(o))}i.endBatch()}return this},silentPositions:function(e){return this.positions(e,!0)},shift:function(e,r,n){var i;if(Fr(e)?(i={x:bt(e.x)?e.x:0,y:bt(e.y)?e.y:0},n=r):Wt(e)&&bt(r)&&(i={x:0,y:0},i[e]=r),i!=null){var a=this.cy();a.startBatch();for(var s=0;s<this.length;s++){var o=this[s];if(!(a.hasCompoundNodes()&&o.isChild()&&o.ancestors().anySame(this))){var l=o.position(),u={x:l.x+i.x,y:l.y+i.y};n?o.silentPosition(u):o.position(u)}}a.endBatch()}return this},silentShift:function(e,r){return Fr(e)?this.shift(e,!0):Wt(e)&&bt(r)&&this.shift(e,r,!0),this},renderedPosition:function(e,r){var n=this[0],i=this.cy(),a=i.zoom(),s=i.pan(),o=Fr(e)?e:void 0,l=o!==void 0||r!==void 0&&Wt(e);if(n&&n.isNode())if(l)for(var u=0;u<this.length;u++){var c=this[u];r!==void 0?c.position(e,(r-s[e])/a):o!==void 0&&c.position(ZM(o,a,s))}else{var h=n.position();return o=k1(h,a,s),e===void 0?o:o[e]}else if(!l)return;return this},relativePosition:function(e,r){var n=this[0],i=this.cy(),a=Fr(e)?e:void 0,s=a!==void 0||r!==void 0&&Wt(e),o=i.hasCompoundNodes();if(n&&n.isNode())if(s)for(var l=0;l<this.length;l++){var u=this[l],c=o?u.parent():null,h=c&&c.length>0,p=h;h&&(c=c[0]);var v=p?c.position():{x:0,y:0};r!==void 0?u.position(e,r+v[e]):a!==void 0&&u.position({x:a.x+v.x,y:a.y+v.y})}else{var y=n.position(),S=o?n.parent():null,w=S&&S.length>0,T=w;w&&(S=S[0]);var _=T?S.position():{x:0,y:0};return a={x:y.x-_.x,y:y.y-_.y},e===void 0?a:a[e]}else if(!s)return;return this}};Rl.modelPosition=Rl.point=Rl.position;Rl.modelPositions=Rl.points=Rl.positions;Rl.renderedPoint=Rl.renderedPosition;Rl.relativePoint=Rl.relativePosition;var h7=bA,zp,oh;zp=oh={};oh.renderedBoundingBox=function(t){var e=this.boundingBox(t),r=this.cy(),n=r.zoom(),i=r.pan(),a=e.x1*n+i.x,s=e.x2*n+i.x,o=e.y1*n+i.y,l=e.y2*n+i.y;return{x1:a,x2:s,y1:o,y2:l,w:s-a,h:l-o}};oh.dirtyCompoundBoundsCache=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,e=this.cy();return!e.styleEnabled()||!e.hasCompoundNodes()?this:(this.forEachUp(function(r){if(r.isParent()){var n=r._private;n.compoundBoundsClean=!1,n.bbCache=null,t||r.emitAndNotify("bounds")}}),this)};oh.updateCompoundBounds=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,e=this.cy();if(!e.styleEnabled()||!e.hasCompoundNodes())return this;if(!t&&e.batching())return this;function r(s){if(!s.isParent())return;var o=s._private,l=s.children(),u=s.pstyle("compound-sizing-wrt-labels").value==="include",c={width:{val:s.pstyle("min-width").pfValue,left:s.pstyle("min-width-bias-left"),right:s.pstyle("min-width-bias-right")},height:{val:s.pstyle("min-height").pfValue,top:s.pstyle("min-height-bias-top"),bottom:s.pstyle("min-height-bias-bottom")}},h=l.boundingBox({includeLabels:u,includeOverlays:!1,useCache:!1}),p=o.position;(h.w===0||h.h===0)&&(h={w:s.pstyle("width").pfValue,h:s.pstyle("height").pfValue},h.x1=p.x-h.w/2,h.x2=p.x+h.w/2,h.y1=p.y-h.h/2,h.y2=p.y+h.h/2);function v(F,B,$){var Z=0,D=0,H=B+$;return F>0&&H>0&&(Z=B/H*F,D=$/H*F),{biasDiff:Z,biasComplementDiff:D}}function y(F,B,$,Z){if($.units==="%")switch(Z){case"width":return F>0?$.pfValue*F:0;case"height":return B>0?$.pfValue*B:0;case"average":return F>0&&B>0?$.pfValue*(F+B)/2:0;case"min":return F>0&&B>0?F>B?$.pfValue*B:$.pfValue*F:0;case"max":return F>0&&B>0?F>B?$.pfValue*F:$.pfValue*B:0;default:return 0}else return $.units==="px"?$.pfValue:0}var S=c.width.left.value;c.width.left.units==="px"&&c.width.val>0&&(S=S*100/c.width.val);var w=c.width.right.value;c.width.right.units==="px"&&c.width.val>0&&(w=w*100/c.width.val);var T=c.height.top.value;c.height.top.units==="px"&&c.height.val>0&&(T=T*100/c.height.val);var _=c.height.bottom.value;c.height.bottom.units==="px"&&c.height.val>0&&(_=_*100/c.height.val);var C=v(c.width.val-h.w,S,w),N=C.biasDiff,A=C.biasComplementDiff,I=v(c.height.val-h.h,T,_),j=I.biasDiff,O=I.biasComplementDiff;o.autoPadding=y(h.w,h.h,s.pstyle("padding"),s.pstyle("padding-relative-to").value),o.autoWidth=Math.max(h.w,c.width.val),p.x=(-N+h.x1+h.x2+A)/2,o.autoHeight=Math.max(h.h,c.height.val),p.y=(-j+h.y1+h.y2+O)/2}for(var n=0;n<this.length;n++){var i=this[n],a=i._private;(!a.compoundBoundsClean||t)&&(r(i),e.batching()||(a.compoundBoundsClean=!0))}return this};var Vo=function(e){return e===1/0||e===-1/0?0:e},Nl=function(e,r,n,i,a){i-r===0||a-n===0||r==null||n==null||i==null||a==null||(e.x1=r<e.x1?r:e.x1,e.x2=i>e.x2?i:e.x2,e.y1=n<e.y1?n:e.y1,e.y2=a>e.y2?a:e.y2,e.w=e.x2-e.x1,e.h=e.y2-e.y1)},Ed=function(e,r){return r==null?e:Nl(e,r.x1,r.y1,r.x2,r.y2)},Gm=function(e,r,n){return $s(e,r,n)},ty=function(e,r,n){if(!r.cy().headless()){var i=r._private,a=i.rstyle,s=a.arrowWidth/2,o=r.pstyle(n+"-arrow-shape").value,l,u;if(o!=="none"){n==="source"?(l=a.srcX,u=a.srcY):n==="target"?(l=a.tgtX,u=a.tgtY):(l=a.midX,u=a.midY);var c=i.arrowBounds=i.arrowBounds||{},h=c[n]=c[n]||{};h.x1=l-s,h.y1=u-s,h.x2=l+s,h.y2=u+s,h.w=h.x2-h.x1,h.h=h.y2-h.y1,Dy(h,1),Nl(e,h.x1,h.y1,h.x2,h.y2)}}},l2=function(e,r,n){if(!r.cy().headless()){var i;n?i=n+"-":i="";var a=r._private,s=a.rstyle,o=r.pstyle(i+"label").strValue;if(o){var l=r.pstyle("text-halign"),u=r.pstyle("text-valign"),c=Gm(s,"labelWidth",n),h=Gm(s,"labelHeight",n),p=Gm(s,"labelX",n),v=Gm(s,"labelY",n),y=r.pstyle(i+"text-margin-x").pfValue,S=r.pstyle(i+"text-margin-y").pfValue,w=r.isEdge(),T=r.pstyle(i+"text-rotation"),_=r.pstyle("text-outline-width").pfValue,C=r.pstyle("text-border-width").pfValue,N=C/2,A=r.pstyle("text-background-padding").pfValue,I=2,j=h,O=c,F=O/2,B=j/2,$,Z,D,H;if(w)$=p-F,Z=p+F,D=v-B,H=v+B;else{switch(l.value){case"left":$=p-O,Z=p;break;case"center":$=p-F,Z=p+F;break;case"right":$=p,Z=p+O;break}switch(u.value){case"top":D=v-j,H=v;break;case"center":D=v-B,H=v+B;break;case"bottom":D=v,H=v+j;break}}var U=y-Math.max(_,N)-A-I,W=y+Math.max(_,N)+A+I,Y=S-Math.max(_,N)-A-I,Q=S+Math.max(_,N)+A+I;$+=U,Z+=W,D+=Y,H+=Q;var ne=n||"main",re=a.labelBounds,q=re[ne]=re[ne]||{};q.x1=$,q.y1=D,q.x2=Z,q.y2=H,q.w=Z-$,q.h=H-D,q.leftPad=U,q.rightPad=W,q.topPad=Y,q.botPad=Q;var te=w&&T.strValue==="autorotate",ae=T.pfValue!=null&&T.pfValue!==0;if(te||ae){var de=te?Gm(a.rstyle,"labelAngle",n):T.pfValue,ge=Math.cos(de),ye=Math.sin(de),se=($+Z)/2,fe=(D+H)/2;if(!w){switch(l.value){case"left":se=Z;break;case"right":se=$;break}switch(u.value){case"top":fe=H;break;case"bottom":fe=D;break}}var le=function(rt,lt){return rt=rt-se,lt=lt-fe,{x:rt*ge-lt*ye+se,y:rt*ye+lt*ge+fe}},pe=le($,D),me=le($,H),xe=le(Z,D),Se=le(Z,H);$=Math.min(pe.x,me.x,xe.x,Se.x),Z=Math.max(pe.x,me.x,xe.x,Se.x),D=Math.min(pe.y,me.y,xe.y,Se.y),H=Math.max(pe.y,me.y,xe.y,Se.y)}var Ve=ne+"Rot",$e=re[Ve]=re[Ve]||{};$e.x1=$,$e.y1=D,$e.x2=Z,$e.y2=H,$e.w=Z-$,$e.h=H-D,Nl(e,$,D,Z,H),Nl(a.labelBounds.all,$,D,Z,H)}return e}},fN=function(e,r){if(!r.cy().headless()){var n=r.pstyle("outline-opacity").value,i=r.pstyle("outline-width").value,a=r.pstyle("outline-offset").value,s=i+a;SA(e,r,n,s,"outside",s/2)}},SA=function(e,r,n,i,a,s){if(!(n===0||i<=0||a==="inside")){var o=r.cy(),l=r.pstyle("shape").value,u=o.renderer().nodeShapes[l],c=r.position(),h=c.x,p=c.y,v=r.width(),y=r.height();if(u.hasMiterBounds){a==="center"&&(i/=2);var S=u.miterBounds(h,p,v,y,i);Ed(e,S)}else s!=null&&s>0&&Iy(e,[s,s,s,s])}},f7=function(e,r){if(!r.cy().headless()){var n=r.pstyle("border-opacity").value,i=r.pstyle("border-width").pfValue,a=r.pstyle("border-position").value;SA(e,r,n,i,a)}},p7=function(e,r){var n=e._private.cy,i=n.styleEnabled(),a=n.headless(),s=Ns(),o=e._private,l=e.isNode(),u=e.isEdge(),c,h,p,v,y,S,w=o.rstyle,T=l&&i?e.pstyle("bounds-expansion").pfValue:[0],_=function(St){return St.pstyle("display").value!=="none"},C=!i||_(e)&&(!u||_(e.source())&&_(e.target()));if(C){var N=0,A=0;i&&r.includeOverlays&&(N=e.pstyle("overlay-opacity").value,N!==0&&(A=e.pstyle("overlay-padding").value));var I=0,j=0;i&&r.includeUnderlays&&(I=e.pstyle("underlay-opacity").value,I!==0&&(j=e.pstyle("underlay-padding").value));var O=Math.max(A,j),F=0,B=0;if(i&&(F=e.pstyle("width").pfValue,B=F/2),l&&r.includeNodes){var $=e.position();y=$.x,S=$.y;var Z=e.outerWidth(),D=Z/2,H=e.outerHeight(),U=H/2;c=y-D,h=y+D,p=S-U,v=S+U,Nl(s,c,p,h,v),i&&fN(s,e),i&&r.includeOutlines&&!a&&fN(s,e),i&&f7(s,e)}else if(u&&r.includeEdges)if(i&&!a){var W=e.pstyle("curve-style").strValue;if(c=Math.min(w.srcX,w.midX,w.tgtX),h=Math.max(w.srcX,w.midX,w.tgtX),p=Math.min(w.srcY,w.midY,w.tgtY),v=Math.max(w.srcY,w.midY,w.tgtY),c-=B,h+=B,p-=B,v+=B,Nl(s,c,p,h,v),W==="haystack"){var Y=w.haystackPts;if(Y&&Y.length===2){if(c=Y[0].x,p=Y[0].y,h=Y[1].x,v=Y[1].y,c>h){var Q=c;c=h,h=Q}if(p>v){var ne=p;p=v,v=ne}Nl(s,c-B,p-B,h+B,v+B)}}else if(W==="bezier"||W==="unbundled-bezier"||Ld(W,"segments")||Ld(W,"taxi")){var re;switch(W){case"bezier":case"unbundled-bezier":re=w.bezierPts;break;case"segments":case"taxi":case"round-segments":case"round-taxi":re=w.linePts;break}if(re!=null)for(var q=0;q<re.length;q++){var te=re[q];c=te.x-B,h=te.x+B,p=te.y-B,v=te.y+B,Nl(s,c,p,h,v)}}}else{var ae=e.source(),de=ae.position(),ge=e.target(),ye=ge.position();if(c=de.x,h=ye.x,p=de.y,v=ye.y,c>h){var se=c;c=h,h=se}if(p>v){var fe=p;p=v,v=fe}c-=B,h+=B,p-=B,v+=B,Nl(s,c,p,h,v)}if(i&&r.includeEdges&&u&&(ty(s,e,"mid-source"),ty(s,e,"mid-target"),ty(s,e,"source"),ty(s,e,"target")),i){var le=e.pstyle("ghost").value==="yes";if(le){var pe=e.pstyle("ghost-offset-x").pfValue,me=e.pstyle("ghost-offset-y").pfValue;Nl(s,s.x1+pe,s.y1+me,s.x2+pe,s.y2+me)}}var xe=o.bodyBounds=o.bodyBounds||{};QE(xe,s),Iy(xe,T),Dy(xe,1),i&&(c=s.x1,h=s.x2,p=s.y1,v=s.y2,Nl(s,c-O,p-O,h+O,v+O));var Se=o.overlayBounds=o.overlayBounds||{};QE(Se,s),Iy(Se,T),Dy(Se,1);var Ve=o.labelBounds=o.labelBounds||{};Ve.all!=null?Z9(Ve.all):Ve.all=Ns(),i&&r.includeLabels&&(r.includeMainLabels&&l2(s,e,null),u&&(r.includeSourceLabels&&l2(s,e,"source"),r.includeTargetLabels&&l2(s,e,"target")))}return s.x1=Vo(s.x1),s.y1=Vo(s.y1),s.x2=Vo(s.x2),s.y2=Vo(s.y2),s.w=Vo(s.x2-s.x1),s.h=Vo(s.y2-s.y1),s.w>0&&s.h>0&&C&&(Iy(s,T),Dy(s,1)),s},kA=function(e){var r=0,n=function(s){return(s?1:0)<<r++},i=0;return i+=n(e.incudeNodes),i+=n(e.includeEdges),i+=n(e.includeLabels),i+=n(e.includeMainLabels),i+=n(e.includeSourceLabels),i+=n(e.includeTargetLabels),i+=n(e.includeOverlays),i+=n(e.includeOutlines),i},_A=function(e){var r=function(o){return Math.round(o)};if(e.isEdge()){var n=e.source().position(),i=e.target().position();return qE([r(n.x),r(n.y),r(i.x),r(i.y)])}else{var a=e.position();return qE([r(a.x),r(a.y)])}},pN=function(e,r){var n=e._private,i,a=e.isEdge(),s=r==null?mN:kA(r),o=s===mN;if(n.bbCache==null?(i=p7(e,_v),n.bbCache=i,n.bbCachePosKey=_A(e)):i=n.bbCache,!o){var l=e.isNode();i=Ns(),(r.includeNodes&&l||r.includeEdges&&!l)&&(r.includeOverlays?Ed(i,n.overlayBounds):Ed(i,n.bodyBounds)),r.includeLabels&&(r.includeMainLabels&&(!a||r.includeSourceLabels&&r.includeTargetLabels)?Ed(i,n.labelBounds.all):(r.includeMainLabels&&Ed(i,n.labelBounds.mainRot),r.includeSourceLabels&&Ed(i,n.labelBounds.sourceRot),r.includeTargetLabels&&Ed(i,n.labelBounds.targetRot))),i.w=i.x2-i.x1,i.h=i.y2-i.y1}return i},_v={includeNodes:!0,includeEdges:!0,includeLabels:!0,includeMainLabels:!0,includeSourceLabels:!0,includeTargetLabels:!0,includeOverlays:!0,includeUnderlays:!0,includeOutlines:!0,useCache:!0},mN=kA(_v),gN=qa(_v);oh.boundingBox=function(t){var e,r=t===void 0||t.useCache===void 0||t.useCache===!0,n=Wp(function(c){var h=c._private;return h.bbCache==null||h.styleDirty||h.bbCachePosKey!==_A(c)},function(c){return c.id()});if(r&&this.length===1&&!n(this[0]))t===void 0?t=_v:t=gN(t),e=pN(this[0],t);else{e=Ns(),t=t||_v;var i=gN(t),a=this,s=a.cy(),o=s.styleEnabled();this.edges().forEach(n),this.nodes().forEach(n),o&&this.recalculateRenderedStyle(r),this.updateCompoundBounds(!r);for(var l=0;l<a.length;l++){var u=a[l];n(u)&&u.dirtyBoundingBoxCache(),Ed(e,pN(u,i))}}return e.x1=Vo(e.x1),e.y1=Vo(e.y1),e.x2=Vo(e.x2),e.y2=Vo(e.y2),e.w=Vo(e.x2-e.x1),e.h=Vo(e.y2-e.y1),e};oh.dirtyBoundingBoxCache=function(){for(var t=0;t<this.length;t++){var e=this[t]._private;e.bbCache=null,e.bbCachePosKey=null,e.bodyBounds=null,e.overlayBounds=null,e.labelBounds.all=null,e.labelBounds.source=null,e.labelBounds.target=null,e.labelBounds.main=null,e.labelBounds.sourceRot=null,e.labelBounds.targetRot=null,e.labelBounds.mainRot=null,e.arrowBounds.source=null,e.arrowBounds.target=null,e.arrowBounds["mid-source"]=null,e.arrowBounds["mid-target"]=null}return this.emitAndNotify("bounds"),this};oh.boundingBoxAt=function(t){var e=this.nodes(),r=this.cy(),n=r.hasCompoundNodes(),i=r.collection();if(n&&(i=e.filter(function(u){return u.isParent()}),e=e.not(i)),Fr(t)){var a=t;t=function(){return a}}var s=function(c,h){return c._private.bbAtOldPos=t(c,h)},o=function(c){return c._private.bbAtOldPos};r.startBatch(),e.forEach(s).silentPositions(t),n&&(i.dirtyCompoundBoundsCache(),i.dirtyBoundingBoxCache(),i.updateCompoundBounds(!0));var l=K9(this.boundingBox({useCache:!1}));return e.silentPositions(o),n&&(i.dirtyCompoundBoundsCache(),i.dirtyBoundingBoxCache(),i.updateCompoundBounds(!0)),r.endBatch(),l};zp.boundingbox=zp.bb=zp.boundingBox;zp.renderedBoundingbox=zp.renderedBoundingBox;var m7=oh,Wg,e0;Wg=e0={};var CA=function(e){e.uppercaseName=AE(e.name),e.autoName="auto"+e.uppercaseName,e.labelName="label"+e.uppercaseName,e.outerName="outer"+e.uppercaseName,e.uppercaseOuterName=AE(e.outerName),Wg[e.name]=function(){var n=this[0],i=n._private,a=i.cy,s=a._private.styleEnabled;if(n)if(s){if(n.isParent())return n.updateCompoundBounds(),i[e.autoName]||0;var o=n.pstyle(e.name);return o.strValue==="label"?(n.recalculateRenderedStyle(),i.rstyle[e.labelName]||0):o.pfValue}else return 1},Wg["outer"+e.uppercaseName]=function(){var n=this[0],i=n._private,a=i.cy,s=a._private.styleEnabled;if(n)if(s){var o=n[e.name](),l=n.pstyle("border-position").value,u;l==="center"?u=n.pstyle("border-width").pfValue:l==="outside"?u=2*n.pstyle("border-width").pfValue:u=0;var c=2*n.padding();return o+u+c}else return 1},Wg["rendered"+e.uppercaseName]=function(){var n=this[0];if(n){var i=n[e.name]();return i*this.cy().zoom()}},Wg["rendered"+e.uppercaseOuterName]=function(){var n=this[0];if(n){var i=n[e.outerName]();return i*this.cy().zoom()}}};CA({name:"width"});CA({name:"height"});e0.padding=function(){var t=this[0],e=t._private;return t.isParent()?(t.updateCompoundBounds(),e.autoPadding!==void 0?e.autoPadding:t.pstyle("padding").pfValue):t.pstyle("padding").pfValue};e0.paddedHeight=function(){var t=this[0];return t.height()+2*t.padding()};e0.paddedWidth=function(){var t=this[0];return t.width()+2*t.padding()};var g7=e0,v7=function(e,r){if(e.isEdge()&&e.takesUpSpace())return r(e)},y7=function(e,r){if(e.isEdge()&&e.takesUpSpace()){var n=e.cy();return k1(r(e),n.zoom(),n.pan())}},x7=function(e,r){if(e.isEdge()&&e.takesUpSpace()){var n=e.cy(),i=n.pan(),a=n.zoom();return r(e).map(function(s){return k1(s,a,i)})}},b7=function(e){return e.renderer().getControlPoints(e)},w7=function(e){return e.renderer().getSegmentPoints(e)},S7=function(e){return e.renderer().getSourceEndpoint(e)},k7=function(e){return e.renderer().getTargetEndpoint(e)},_7=function(e){return e.renderer().getEdgeMidpoint(e)},vN={controlPoints:{get:b7,mult:!0},segmentPoints:{get:w7,mult:!0},sourceEndpoint:{get:S7},targetEndpoint:{get:k7},midpoint:{get:_7}},C7=function(e){return"rendered"+e[0].toUpperCase()+e.substr(1)},E7=Object.keys(vN).reduce(function(t,e){var r=vN[e],n=C7(e);return t[e]=function(){return v7(this,r.get)},r.mult?t[n]=function(){return x7(this,r.get)}:t[n]=function(){return y7(this,r.get)},t},{}),T7=er({},h7,m7,g7,E7);var EA=function(e,r){this.recycle(e,r)};function Vm(){return!1}function ry(){return!0}EA.prototype={instanceString:function(){return"event"},recycle:function(e,r){if(this.isImmediatePropagationStopped=this.isPropagationStopped=this.isDefaultPrevented=Vm,e!=null&&e.preventDefault?(this.type=e.type,this.isDefaultPrevented=e.defaultPrevented?ry:Vm):e!=null&&e.type?r=e:this.type=e,r!=null&&(this.originalEvent=r.originalEvent,this.type=r.type!=null?r.type:this.type,this.cy=r.cy,this.target=r.target,this.position=r.position,this.renderedPosition=r.renderedPosition,this.namespace=r.namespace,this.layout=r.layout),this.cy!=null&&this.position!=null&&this.renderedPosition==null){var n=this.position,i=this.cy.zoom(),a=this.cy.pan();this.renderedPosition={x:n.x*i+a.x,y:n.y*i+a.y}}this.timeStamp=e&&e.timeStamp||Date.now()},preventDefault:function(){this.isDefaultPrevented=ry;var e=this.originalEvent;e&&e.preventDefault&&e.preventDefault()},stopPropagation:function(){this.isPropagationStopped=ry;var e=this.originalEvent;e&&e.stopPropagation&&e.stopPropagation()},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=ry,this.stopPropagation()},isDefaultPrevented:Vm,isPropagationStopped:Vm,isImmediatePropagationStopped:Vm};var TA=/^([^.]+)(\.(?:[^.]+))?$/,N7=".*",NA={qualifierCompare:function(e,r){return e===r},eventMatches:function(){return!0},addEventFields:function(){},callbackContext:function(e){return e},beforeEmit:function(){},afterEmit:function(){},bubble:function(){return!1},parent:function(){return null},context:null},yN=Object.keys(NA),P7={};function M1(){for(var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:P7,e=arguments.length>1?arguments[1]:void 0,r=0;r<yN.length;r++){var n=yN[r];this[n]=t[n]||NA[n]}this.context=e||this.context,this.listeners=[],this.emitting=0}var eh=M1.prototype,PA=function(e,r,n,i,a,s,o){ni(i)&&(a=i,i=null),o&&(s==null?s=o:s=er({},s,o));for(var l=xn(n)?n:n.split(/\s+/),u=0;u<l.length;u++){var c=l[u];if(!Zd(c)){var h=c.match(TA);if(h){var p=h[1],v=h[2]?h[2]:null,y=r(e,c,p,v,i,a,s);if(y===!1)break}}}},xN=function(e,r){return e.addEventFields(e.context,r),new EA(r.type,r)},M7=function(e,r,n){if(Ij(n)){r(e,n);return}else if(Fr(n)){r(e,xN(e,n));return}for(var i=xn(n)?n:n.split(/\s+/),a=0;a<i.length;a++){var s=i[a];if(!Zd(s)){var o=s.match(TA);if(o){var l=o[1],u=o[2]?o[2]:null,c=xN(e,{type:l,namespace:u,target:e.context});r(e,c)}}}};eh.on=eh.addListener=function(t,e,r,n,i){return PA(this,function(a,s,o,l,u,c,h){ni(c)&&a.listeners.push({event:s,callback:c,type:o,namespace:l,qualifier:u,conf:h})},t,e,r,n,i),this};eh.one=function(t,e,r,n){return this.on(t,e,r,n,{one:!0})};eh.removeListener=eh.off=function(t,e,r,n){var i=this;this.emitting!==0&&(this.listeners=y9(this.listeners));for(var a=this.listeners,s=function(u){var c=a[u];PA(i,function(h,p,v,y,S,w){if((c.type===v||t==="*")&&(!y&&c.namespace!==".*"||c.namespace===y)&&(!S||h.qualifierCompare(c.qualifier,S))&&(!w||c.callback===w))return a.splice(u,1),!1},t,e,r,n)},o=a.length-1;o>=0;o--)s(o);return this};eh.removeAllListeners=function(){return this.removeListener("*")};eh.emit=eh.trigger=function(t,e,r){var n=this.listeners,i=n.length;return this.emitting++,xn(e)||(e=[e]),M7(this,function(a,s){r!=null&&(n=[{event:s.event,type:s.type,namespace:s.namespace,callback:r}],i=n.length);for(var o=function(){var c=n[l];if(c.type===s.type&&(!c.namespace||c.namespace===s.namespace||c.namespace===N7)&&a.eventMatches(a.context,c,s)){var h=[s];e!=null&&b9(h,e),a.beforeEmit(a.context,c,s),c.conf&&c.conf.one&&(a.listeners=a.listeners.filter(function(y){return y!==c}));var p=a.callbackContext(a.context,c,s),v=c.callback.apply(p,h);a.afterEmit(a.context,c,s),v===!1&&(s.stopPropagation(),s.preventDefault())}},l=0;l<i;l++)o();a.bubble(a.context)&&!s.isPropagationStopped()&&a.parent(a.context).emit(s,e)},t),this.emitting--,this};var A7={qualifierCompare:function(e,r){return e==null||r==null?e==null&&r==null:e.sameText(r)},eventMatches:function(e,r,n){var i=r.qualifier;return i!=null?e!==n.target&&Kv(n.target)&&i.matches(n.target):!0},addEventFields:function(e,r){r.cy=e.cy(),r.target=e},callbackContext:function(e,r,n){return r.qualifier!=null?n.target:e},beforeEmit:function(e,r){r.conf&&r.conf.once&&r.conf.onceCollection.removeListener(r.event,r.qualifier,r.callback)},bubble:function(){return!0},parent:function(e){return e.isChild()?e.parent():e.cy()}},ny=function(e){return Wt(e)?new Qd(e):e},MA={createEmitter:function(){for(var e=0;e<this.length;e++){var r=this[e],n=r._private;n.emitter||(n.emitter=new M1(A7,r))}return this},emitter:function(){return this._private.emitter},on:function(e,r,n){for(var i=ny(r),a=0;a<this.length;a++){var s=this[a];s.emitter().on(e,i,n)}return this},removeListener:function(e,r,n){for(var i=ny(r),a=0;a<this.length;a++){var s=this[a];s.emitter().removeListener(e,i,n)}return this},removeAllListeners:function(){for(var e=0;e<this.length;e++){var r=this[e];r.emitter().removeAllListeners()}return this},one:function(e,r,n){for(var i=ny(r),a=0;a<this.length;a++){var s=this[a];s.emitter().one(e,i,n)}return this},once:function(e,r,n){for(var i=ny(r),a=0;a<this.length;a++){var s=this[a];s.emitter().on(e,i,n,{once:!0,onceCollection:this})}},emit:function(e,r){for(var n=0;n<this.length;n++){var i=this[n];i.emitter().emit(e,r)}return this},emitAndNotify:function(e,r){if(this.length!==0)return this.cy().notify(e,this),this.emit(e,r),this}};tn.eventAliasesOn(MA);var AA={nodes:function(e){return this.filter(function(r){return r.isNode()}).filter(e)},edges:function(e){return this.filter(function(r){return r.isEdge()}).filter(e)},byGroup:function(){for(var e=this.spawn(),r=this.spawn(),n=0;n<this.length;n++){var i=this[n];i.isNode()?e.push(i):r.push(i)}return{nodes:e,edges:r}},filter:function(e,r){if(e===void 0)return this;if(Wt(e)||po(e))return new Qd(e).filter(this);if(ni(e)){for(var n=this.spawn(),i=this,a=0;a<i.length;a++){var s=i[a],o=r?e.apply(r,[s,a,i]):e(s,a,i);o&&n.push(s)}return n}return this.spawn()},not:function(e){if(e){Wt(e)&&(e=this.filter(e));for(var r=this.spawn(),n=0;n<this.length;n++){var i=this[n],a=e.has(i);a||r.push(i)}return r}else return this},absoluteComplement:function(){var e=this.cy();return e.mutableElements().not(this)},intersect:function(e){if(Wt(e)){var r=e;return this.filter(r)}for(var n=this.spawn(),i=this,a=e,s=this.length<e.length,o=s?i:a,l=s?a:i,u=0;u<o.length;u++){var c=o[u];l.has(c)&&n.push(c)}return n},xor:function(e){var r=this._private.cy;Wt(e)&&(e=r.$(e));var n=this.spawn(),i=this,a=e,s=function(l,u){for(var c=0;c<l.length;c++){var h=l[c],p=h._private.data.id,v=u.hasElementWithId(p);v||n.push(h)}};return s(i,a),s(a,i),n},diff:function(e){var r=this._private.cy;Wt(e)&&(e=r.$(e));var n=this.spawn(),i=this.spawn(),a=this.spawn(),s=this,o=e,l=function(c,h,p){for(var v=0;v<c.length;v++){var y=c[v],S=y._private.data.id,w=h.hasElementWithId(S);w?a.merge(y):p.push(y)}};return l(s,o,n),l(o,s,i),{left:n,right:i,both:a}},add:function(e){var r=this._private.cy;if(!e)return this;if(Wt(e)){var n=e;e=r.mutableElements().filter(n)}for(var i=this.spawnSelf(),a=0;a<e.length;a++){var s=e[a],o=!this.has(s);o&&i.push(s)}return i},merge:function(e){var r=this._private,n=r.cy;if(!e)return this;if(e&&Wt(e)){var i=e;e=n.mutableElements().filter(i)}for(var a=r.map,s=0;s<e.length;s++){var o=e[s],l=o._private.data.id,u=!a.has(l);if(u){var c=this.length++;this[c]=o,a.set(l,{ele:o,index:c})}}return this},unmergeAt:function(e){var r=this[e],n=r.id(),i=this._private,a=i.map;this[e]=void 0,a.delete(n);var s=e===this.length-1;if(this.length>1&&!s){var o=this.length-1,l=this[o],u=l._private.data.id;this[o]=void 0,this[e]=l,a.set(u,{ele:l,index:e})}return this.length--,this},unmergeOne:function(e){e=e[0];var r=this._private,n=e._private.data.id,i=r.map,a=i.get(n);if(!a)return this;var s=a.index;return this.unmergeAt(s),this},unmerge:function(e){var r=this._private.cy;if(!e)return this;if(e&&Wt(e)){var n=e;e=r.mutableElements().filter(n)}for(var i=0;i<e.length;i++)this.unmergeOne(e[i]);return this},unmergeBy:function(e){for(var r=this.length-1;r>=0;r--){var n=this[r];e(n)&&this.unmergeAt(r)}return this},map:function(e,r){for(var n=[],i=this,a=0;a<i.length;a++){var s=i[a],o=r?e.apply(r,[s,a,i]):e(s,a,i);n.push(o)}return n},reduce:function(e,r){for(var n=r,i=this,a=0;a<i.length;a++)n=e(n,i[a],a,i);return n},max:function(e,r){for(var n=-1/0,i,a=this,s=0;s<a.length;s++){var o=a[s],l=r?e.apply(r,[o,s,a]):e(o,s,a);l>n&&(n=l,i=o)}return{value:n,ele:i}},min:function(e,r){for(var n=1/0,i,a=this,s=0;s<a.length;s++){var o=a[s],l=r?e.apply(r,[o,s,a]):e(o,s,a);l<n&&(n=l,i=o)}return{value:n,ele:i}}},Hr=AA;Hr.u=Hr["|"]=Hr["+"]=Hr.union=Hr.or=Hr.add;Hr["\\"]=Hr["!"]=Hr["-"]=Hr.difference=Hr.relativeComplement=Hr.subtract=Hr.not;Hr.n=Hr["&"]=Hr["."]=Hr.and=Hr.intersection=Hr.intersect;Hr["^"]=Hr["(+)"]=Hr["(-)"]=Hr.symmetricDifference=Hr.symdiff=Hr.xor;Hr.fnFilter=Hr.filterFn=Hr.stdFilter=Hr.filter;Hr.complement=Hr.abscomp=Hr.absoluteComplement;var R7={isNode:function(){return this.group()==="nodes"},isEdge:function(){return this.group()==="edges"},isLoop:function(){return this.isEdge()&&this.source()[0]===this.target()[0]},isSimple:function(){return this.isEdge()&&this.source()[0]!==this.target()[0]},group:function(){var e=this[0];if(e)return e._private.group}},RA=function(e,r){var n=e.cy(),i=n.hasCompoundNodes();function a(c){var h=c.pstyle("z-compound-depth");return h.value==="auto"?i?c.zDepth():0:h.value==="bottom"?-1:h.value==="top"?e_:0}var s=a(e)-a(r);if(s!==0)return s;function o(c){var h=c.pstyle("z-index-compare");return h.value==="auto"&&c.isNode()?1:0}var l=o(e)-o(r);if(l!==0)return l;var u=e.pstyle("z-index").value-r.pstyle("z-index").value;return u!==0?u:e.poolIndex()-r.poolIndex()},cx={forEach:function(e,r){if(ni(e))for(var n=this.length,i=0;i<n;i++){var a=this[i],s=r?e.apply(r,[a,i,this]):e(a,i,this);if(s===!1)break}return this},toArray:function(){for(var e=[],r=0;r<this.length;r++)e.push(this[r]);return e},slice:function(e,r){var n=[],i=this.length;r==null&&(r=i),e==null&&(e=0),e<0&&(e=i+e),r<0&&(r=i+r);for(var a=e;a>=0&&a<r&&a<i;a++)n.push(this[a]);return this.spawn(n)},size:function(){return this.length},eq:function(e){return this[e]||this.spawn()},first:function(){return this[0]||this.spawn()},last:function(){return this[this.length-1]||this.spawn()},empty:function(){return this.length===0},nonempty:function(){return!this.empty()},sort:function(e){if(!ni(e))return this;var r=this.toArray().sort(e);return this.spawn(r)},sortByZIndex:function(){return this.sort(RA)},zDepth:function(){var e=this[0];if(e){var r=e._private,n=r.group;if(n==="nodes"){var i=r.data.parent?e.parents().size():0;return e.isParent()?i:e_-1}else{var a=r.source,s=r.target,o=a.zDepth(),l=s.zDepth();return Math.max(o,l,0)}}}};cx.each=cx.forEach;var L7=function(){var e="undefined",r=(typeof Symbol>"u"?"undefined":Yi(Symbol))!=e&&Yi(Symbol.iterator)!=e;r&&(cx[Symbol.iterator]=function(){var n=this,i={value:void 0,done:!1},a=0,s=this.length;return MM({next:function(){return a<s?i.value=n[a++]:(i.value=void 0,i.done=!0),i}},Symbol.iterator,function(){return this})})};L7();var O7=qa({nodeDimensionsIncludeLabels:!1}),Fy={layoutDimensions:function(e){e=O7(e);var r;if(!this.takesUpSpace())r={w:0,h:0};else if(e.nodeDimensionsIncludeLabels){var n=this.boundingBox();r={w:n.w,h:n.h}}else r={w:this.outerWidth(),h:this.outerHeight()};return(r.w===0||r.h===0)&&(r.w=r.h=1),r},layoutPositions:function(e,r,n){var i=this.nodes().filter(function(A){return!A.isParent()}),a=this.cy(),s=r.eles,o=function(I){return I.id()},l=Wp(n,o);e.emit({type:"layoutstart",layout:e}),e.animations=[];var u=function(I,j,O){var F={x:j.x1+j.w/2,y:j.y1+j.h/2},B={x:(O.x-F.x)*I,y:(O.y-F.y)*I};return{x:F.x+B.x,y:F.y+B.y}},c=r.spacingFactor&&r.spacingFactor!==1,h=function(){if(!c)return null;for(var I=Ns(),j=0;j<i.length;j++){var O=i[j],F=l(O,j);YM(I,F.x,F.y)}return I},p=h(),v=Wp(function(A,I){var j=l(A,I);if(c){var O=Math.abs(r.spacingFactor);j=u(O,p,j)}return r.transform!=null&&(j=r.transform(A,j)),j},o);if(r.animate){for(var y=0;y<i.length;y++){var S=i[y],w=v(S,y),T=r.animateFilter==null||r.animateFilter(S,y);if(T){var _=S.animation({position:w,duration:r.animationDuration,easing:r.animationEasing});e.animations.push(_)}else S.position(w)}if(r.fit){var C=a.animation({fit:{boundingBox:s.boundingBoxAt(v),padding:r.padding},duration:r.animationDuration,easing:r.animationEasing});e.animations.push(C)}else if(r.zoom!==void 0&&r.pan!==void 0){var N=a.animation({zoom:r.zoom,pan:r.pan,duration:r.animationDuration,easing:r.animationEasing});e.animations.push(N)}e.animations.forEach(function(A){return A.play()}),e.one("layoutready",r.ready),e.emit({type:"layoutready",layout:e}),cm.all(e.animations.map(function(A){return A.promise()})).then(function(){e.one("layoutstop",r.stop),e.emit({type:"layoutstop",layout:e})})}else i.positions(v),r.fit&&a.fit(r.eles,r.padding),r.zoom!=null&&a.zoom(r.zoom),r.pan&&a.pan(r.pan),e.one("layoutready",r.ready),e.emit({type:"layoutready",layout:e}),e.one("layoutstop",r.stop),e.emit({type:"layoutstop",layout:e});return this},layout:function(e){var r=this.cy();return r.makeLayout(er({},e,{eles:this}))}};Fy.createLayout=Fy.makeLayout=Fy.layout;function LA(t,e,r){var n=r._private,i=n.styleCache=n.styleCache||[],a;return(a=i[t])!=null||(a=i[t]=e(r)),a}function A1(t,e){return t=pf(t),function(n){return LA(t,e,n)}}function R1(t,e){t=pf(t);var r=function(i){return e.call(i)};return function(){var i=this[0];if(i)return LA(t,r,i)}}var Ga={recalculateRenderedStyle:function(e){var r=this.cy(),n=r.renderer(),i=r.styleEnabled();return n&&i&&n.recalculateRenderedStyle(this,e),this},dirtyStyleCache:function(){var e=this.cy(),r=function(a){return a._private.styleCache=null};if(e.hasCompoundNodes()){var n;n=this.spawnSelf().merge(this.descendants()).merge(this.parents()),n.merge(n.connectedEdges()),n.forEach(r)}else this.forEach(function(i){r(i),i.connectedEdges().forEach(r)});return this},updateStyle:function(e){var r=this._private.cy;if(!r.styleEnabled())return this;if(r.batching()){var n=r._private.batchStyleEles;return n.merge(this),this}var i=r.hasCompoundNodes(),a=this;e=!!(e||e===void 0),i&&(a=this.spawnSelf().merge(this.descendants()).merge(this.parents()));var s=a;return e?s.emitAndNotify("style"):s.emit("style"),a.forEach(function(o){return o._private.styleDirty=!0}),this},cleanStyle:function(){var e=this.cy();if(e.styleEnabled())for(var r=0;r<this.length;r++){var n=this[r];n._private.styleDirty&&(n._private.styleDirty=!1,e.style().apply(n))}},parsedStyle:function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,n=this[0],i=n.cy();if(i.styleEnabled()&&n){n._private.styleDirty&&(n._private.styleDirty=!1,i.style().apply(n));var a=n._private.style[e];return a??(r?i.style().getDefaultProperty(e):null)}},numericStyle:function(e){var r=this[0];if(r.cy().styleEnabled()&&r){var n=r.pstyle(e);return n.pfValue!==void 0?n.pfValue:n.value}},numericStyleUnits:function(e){var r=this[0];if(r.cy().styleEnabled()&&r)return r.pstyle(e).units},renderedStyle:function(e){var r=this.cy();if(!r.styleEnabled())return this;var n=this[0];if(n)return r.style().getRenderedStyle(n,e)},style:function(e,r){var n=this.cy();if(!n.styleEnabled())return this;var i=!1,a=n.style();if(Fr(e)){var s=e;a.applyBypass(this,s,i),this.emitAndNotify("style")}else if(Wt(e))if(r===void 0){var o=this[0];return o?a.getStylePropertyValue(o,e):void 0}else a.applyBypass(this,e,r,i),this.emitAndNotify("style");else if(e===void 0){var l=this[0];return l?a.getRawStyle(l):void 0}return this},removeStyle:function(e){var r=this.cy();if(!r.styleEnabled())return this;var n=!1,i=r.style(),a=this;if(e===void 0)for(var s=0;s<a.length;s++){var o=a[s];i.removeAllBypasses(o,n)}else{e=e.split(/\s+/);for(var l=0;l<a.length;l++){var u=a[l];i.removeBypasses(u,e,n)}}return this.emitAndNotify("style"),this},show:function(){return this.css("display","element"),this},hide:function(){return this.css("display","none"),this},effectiveOpacity:function(){var e=this.cy();if(!e.styleEnabled())return 1;var r=e.hasCompoundNodes(),n=this[0];if(n){var i=n._private,a=n.pstyle("opacity").value;if(!r)return a;var s=i.data.parent?n.parents():null;if(s)for(var o=0;o<s.length;o++){var l=s[o],u=l.pstyle("opacity").value;a=u*a}return a}},transparent:function(){var e=this.cy();if(!e.styleEnabled())return!1;var r=this[0],n=r.cy().hasCompoundNodes();if(r)return n?r.effectiveOpacity()===0:r.pstyle("opacity").value===0},backgrounding:function(){var e=this.cy();if(!e.styleEnabled())return!1;var r=this[0];return!!r._private.backgrounding}};function u2(t,e){var r=t._private,n=r.data.parent?t.parents():null;if(n)for(var i=0;i<n.length;i++){var a=n[i];if(!e(a))return!1}return!0}function h_(t){var e=t.ok,r=t.edgeOkViaNode||t.ok,n=t.parentOk||t.ok;return function(){var i=this.cy();if(!i.styleEnabled())return!0;var a=this[0],s=i.hasCompoundNodes();if(a){var o=a._private;if(!e(a))return!1;if(a.isNode())return!s||u2(a,n);var l=o.source,u=o.target;return r(l)&&(!s||u2(l,r))&&(l===u||r(u)&&(!s||u2(u,r)))}}}var dm=A1("eleTakesUpSpace",function(t){return t.pstyle("display").value==="element"&&t.width()!==0&&(t.isNode()?t.height()!==0:!0)});Ga.takesUpSpace=R1("takesUpSpace",h_({ok:dm}));var D7=A1("eleInteractive",function(t){return t.pstyle("events").value==="yes"&&t.pstyle("visibility").value==="visible"&&dm(t)}),I7=A1("parentInteractive",function(t){return t.pstyle("visibility").value==="visible"&&dm(t)});Ga.interactive=R1("interactive",h_({ok:D7,parentOk:I7,edgeOkViaNode:dm}));Ga.noninteractive=function(){var t=this[0];if(t)return!t.interactive()};var j7=A1("eleVisible",function(t){return t.pstyle("visibility").value==="visible"&&t.pstyle("opacity").pfValue!==0&&dm(t)}),F7=dm;Ga.visible=R1("visible",h_({ok:j7,edgeOkViaNode:F7}));Ga.hidden=function(){var t=this[0];if(t)return!t.visible()};Ga.isBundledBezier=R1("isBundledBezier",function(){return this.cy().styleEnabled()?!this.removed()&&this.pstyle("curve-style").value==="bezier"&&this.takesUpSpace():!1});Ga.bypass=Ga.css=Ga.style;Ga.renderedCss=Ga.renderedStyle;Ga.removeBypass=Ga.removeCss=Ga.removeStyle;Ga.pstyle=Ga.parsedStyle;var Gd={};function bN(t){return function(){var e=arguments,r=[];if(e.length===2){var n=e[0],i=e[1];this.on(t.event,n,i)}else if(e.length===1&&ni(e[0])){var a=e[0];this.on(t.event,a)}else if(e.length===0||e.length===1&&xn(e[0])){for(var s=e.length===1?e[0]:null,o=0;o<this.length;o++){var l=this[o],u=!t.ableField||l._private[t.ableField],c=l._private[t.field]!=t.value;if(t.overrideAble){var h=t.overrideAble(l);if(h!==void 0&&(u=h,!h))return this}u&&(l._private[t.field]=t.value,c&&r.push(l))}var p=this.spawn(r);p.updateStyle(),p.emit(t.event),s&&p.emit(s)}return this}}function hm(t){Gd[t.field]=function(){var e=this[0];if(e){if(t.overrideField){var r=t.overrideField(e);if(r!==void 0)return r}return e._private[t.field]}},Gd[t.on]=bN({event:t.on,field:t.field,ableField:t.ableField,overrideAble:t.overrideAble,value:!0}),Gd[t.off]=bN({event:t.off,field:t.field,ableField:t.ableField,overrideAble:t.overrideAble,value:!1})}hm({field:"locked",overrideField:function(e){return e.cy().autolock()?!0:void 0},on:"lock",off:"unlock"});hm({field:"grabbable",overrideField:function(e){return e.cy().autoungrabify()||e.pannable()?!1:void 0},on:"grabify",off:"ungrabify"});hm({field:"selected",ableField:"selectable",overrideAble:function(e){return e.cy().autounselectify()?!1:void 0},on:"select",off:"unselect"});hm({field:"selectable",overrideField:function(e){return e.cy().autounselectify()?!1:void 0},on:"selectify",off:"unselectify"});Gd.deselect=Gd.unselect;Gd.grabbed=function(){var t=this[0];if(t)return t._private.grabbed};hm({field:"active",on:"activate",off:"unactivate"});hm({field:"pannable",on:"panify",off:"unpanify"});Gd.inactive=function(){var t=this[0];if(t)return!t._private.active};var us={},wN=function(e){return function(n){for(var i=this,a=[],s=0;s<i.length;s++){var o=i[s];if(o.isNode()){for(var l=!1,u=o.connectedEdges(),c=0;c<u.length;c++){var h=u[c],p=h.source(),v=h.target();if(e.noIncomingEdges&&v===o&&p!==o||e.noOutgoingEdges&&p===o&&v!==o){l=!0;break}}l||a.push(o)}}return this.spawn(a,!0).filter(n)}},SN=function(e){return function(r){for(var n=this,i=[],a=0;a<n.length;a++){var s=n[a];if(s.isNode())for(var o=s.connectedEdges(),l=0;l<o.length;l++){var u=o[l],c=u.source(),h=u.target();e.outgoing&&c===s?(i.push(u),i.push(h)):e.incoming&&h===s&&(i.push(u),i.push(c))}}return this.spawn(i,!0).filter(r)}},kN=function(e){return function(r){for(var n=this,i=[],a={};;){var s=e.outgoing?n.outgoers():n.incomers();if(s.length===0)break;for(var o=!1,l=0;l<s.length;l++){var u=s[l],c=u.id();a[c]||(a[c]=!0,i.push(u),o=!0)}if(!o)break;n=s}return this.spawn(i,!0).filter(r)}};us.clearTraversalCache=function(){for(var t=0;t<this.length;t++)this[t]._private.traversalCache=null};er(us,{roots:wN({noIncomingEdges:!0}),leaves:wN({noOutgoingEdges:!0}),outgoers:Wo(SN({outgoing:!0}),"outgoers"),successors:kN({outgoing:!0}),incomers:Wo(SN({incoming:!0}),"incomers"),predecessors:kN({})});er(us,{neighborhood:Wo(function(t){for(var e=[],r=this.nodes(),n=0;n<r.length;n++)for(var i=r[n],a=i.connectedEdges(),s=0;s<a.length;s++){var o=a[s],l=o.source(),u=o.target(),c=i===l?u:l;c.length>0&&e.push(c[0]),e.push(o[0])}return this.spawn(e,!0).filter(t)},"neighborhood"),closedNeighborhood:function(e){return this.neighborhood().add(this).filter(e)},openNeighborhood:function(e){return this.neighborhood(e)}});us.neighbourhood=us.neighborhood;us.closedNeighbourhood=us.closedNeighborhood;us.openNeighbourhood=us.openNeighborhood;er(us,{source:Wo(function(e){var r=this[0],n;return r&&(n=r._private.source||r.cy().collection()),n&&e?n.filter(e):n},"source"),target:Wo(function(e){var r=this[0],n;return r&&(n=r._private.target||r.cy().collection()),n&&e?n.filter(e):n},"target"),sources:_N({attr:"source"}),targets:_N({attr:"target"})});function _N(t){return function(r){for(var n=[],i=0;i<this.length;i++){var a=this[i],s=a._private[t.attr];s&&n.push(s)}return this.spawn(n,!0).filter(r)}}er(us,{edgesWith:Wo(CN(),"edgesWith"),edgesTo:Wo(CN({thisIsSrc:!0}),"edgesTo")});function CN(t){return function(r){var n=[],i=this._private.cy,a=t||{};Wt(r)&&(r=i.$(r));for(var s=0;s<r.length;s++)for(var o=r[s]._private.edges,l=0;l<o.length;l++){var u=o[l],c=u._private.data,h=this.hasElementWithId(c.source)&&r.hasElementWithId(c.target),p=r.hasElementWithId(c.source)&&this.hasElementWithId(c.target),v=h||p;v&&((a.thisIsSrc||a.thisIsTgt)&&(a.thisIsSrc&&!h||a.thisIsTgt&&!p)||n.push(u))}return this.spawn(n,!0)}}er(us,{connectedEdges:Wo(function(t){for(var e=[],r=this,n=0;n<r.length;n++){var i=r[n];if(i.isNode())for(var a=i._private.edges,s=0;s<a.length;s++){var o=a[s];e.push(o)}}return this.spawn(e,!0).filter(t)},"connectedEdges"),connectedNodes:Wo(function(t){for(var e=[],r=this,n=0;n<r.length;n++){var i=r[n];i.isEdge()&&(e.push(i.source()[0]),e.push(i.target()[0]))}return this.spawn(e,!0).filter(t)},"connectedNodes"),parallelEdges:Wo(EN(),"parallelEdges"),codirectedEdges:Wo(EN({codirected:!0}),"codirectedEdges")});function EN(t){var e={codirected:!1};return t=er({},e,t),function(n){for(var i=[],a=this.edges(),s=t,o=0;o<a.length;o++)for(var l=a[o],u=l._private,c=u.source,h=c._private.data.id,p=u.data.target,v=c._private.edges,y=0;y<v.length;y++){var S=v[y],w=S._private.data,T=w.target,_=w.source,C=T===p&&_===h,N=h===T&&p===_;(s.codirected&&C||!s.codirected&&(C||N))&&i.push(S)}return this.spawn(i,!0).filter(n)}}er(us,{components:function(e){var r=this,n=r.cy(),i=n.collection(),a=e==null?r.nodes():e.nodes(),s=[];e!=null&&a.empty()&&(a=e.sources());var o=function(c,h){i.merge(c),a.unmerge(c),h.merge(c)};if(a.empty())return r.spawn();var l=function(){var c=n.collection();s.push(c);var h=a[0];o(h,c),r.bfs({directed:!1,roots:h,visit:function(v){return o(v,c)}}),c.forEach(function(p){p.connectedEdges().forEach(function(v){r.has(v)&&c.has(v.source())&&c.has(v.target())&&c.merge(v)})})};do l();while(a.length>0);return s},component:function(){var e=this[0];return e.cy().mutableElements().components(e)[0]}});us.componentsOf=us.components;var Va=function(e,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(e===void 0){Kn("A collection must have a reference to the core");return}var a=new cc,s=!1;if(!r)r=[];else if(r.length>0&&Fr(r[0])&&!Kv(r[0])){s=!0;for(var o=[],l=new um,u=0,c=r.length;u<c;u++){var h=r[u];h.data==null&&(h.data={});var p=h.data;if(p.id==null)p.id=$M();else if(e.hasElementWithId(p.id)||l.has(p.id))continue;var v=new S1(e,h,!1);o.push(v),l.add(p.id)}r=o}this.length=0;for(var y=0,S=r.length;y<S;y++){var w=r[y][0];if(w!=null){var T=w._private.data.id;(!n||!a.has(T))&&(n&&a.set(T,{index:this.length,ele:w}),this[this.length]=w,this.length++)}}this._private={eles:this,cy:e,get map(){return this.lazyMap==null&&this.rebuildMap(),this.lazyMap},set map(_){this.lazyMap=_},rebuildMap:function(){for(var C=this.lazyMap=new cc,N=this.eles,A=0;A<N.length;A++){var I=N[A];C.set(I.id(),{index:A,ele:I})}}},n&&(this._private.map=a),s&&!i&&this.restore()},En=S1.prototype=Va.prototype=Object.create(Array.prototype);En.instanceString=function(){return"collection"};En.spawn=function(t,e){return new Va(this.cy(),t,e)};En.spawnSelf=function(){return this.spawn(this)};En.cy=function(){return this._private.cy};En.renderer=function(){return this._private.cy.renderer()};En.element=function(){return this[0]};En.collection=function(){return LM(this)?this:new Va(this._private.cy,[this])};En.unique=function(){return new Va(this._private.cy,this,!0)};En.hasElementWithId=function(t){return t=""+t,this._private.map.has(t)};En.getElementById=function(t){t=""+t;var e=this._private.cy,r=this._private.map.get(t);return r?r.ele:new Va(e)};En.$id=En.getElementById;En.poolIndex=function(){var t=this._private.cy,e=t._private.elements,r=this[0]._private.data.id;return e._private.map.get(r).index};En.indexOf=function(t){var e=t[0]._private.data.id;return this._private.map.get(e).index};En.indexOfId=function(t){return t=""+t,this._private.map.get(t).index};En.json=function(t){var e=this.element(),r=this.cy();if(e==null&&t)return this;if(e!=null){var n=e._private;if(Fr(t)){if(r.startBatch(),t.data){e.data(t.data);var i=n.data;if(e.isEdge()){var a=!1,s={},o=t.data.source,l=t.data.target;o!=null&&o!=i.source&&(s.source=""+o,a=!0),l!=null&&l!=i.target&&(s.target=""+l,a=!0),a&&(e=e.move(s))}else{var u="parent"in t.data,c=t.data.parent;u&&(c!=null||i.parent!=null)&&c!=i.parent&&(c===void 0&&(c=null),c!=null&&(c=""+c),e=e.move({parent:c}))}}t.position&&e.position(t.position);var h=function(S,w,T){var _=t[S];_!=null&&_!==n[S]&&(_?e[w]():e[T]())};return h("removed","remove","restore"),h("selected","select","unselect"),h("selectable","selectify","unselectify"),h("locked","lock","unlock"),h("grabbable","grabify","ungrabify"),h("pannable","panify","unpanify"),t.classes!=null&&e.classes(t.classes),r.endBatch(),this}else if(t===void 0){var p={data:ku(n.data),position:ku(n.position),group:n.group,removed:n.removed,selected:n.selected,selectable:n.selectable,locked:n.locked,grabbable:n.grabbable,pannable:n.pannable,classes:null};p.classes="";var v=0;return n.classes.forEach(function(y){return p.classes+=v++===0?y:" "+y}),p}}};En.jsons=function(){for(var t=[],e=0;e<this.length;e++){var r=this[e],n=r.json();t.push(n)}return t};En.clone=function(){for(var t=this.cy(),e=[],r=0;r<this.length;r++){var n=this[r],i=n.json(),a=new S1(t,i,!1);e.push(a)}return new Va(t,e)};En.copy=En.clone;En.restore=function(){for(var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=this,n=r.cy(),i=n._private,a=[],s=[],o,l=0,u=r.length;l<u;l++){var c=r[l];e&&!c.removed()||(c.isNode()?a.push(c):s.push(c))}o=a.concat(s);var h,p=function(){o.splice(h,1),h--};for(h=0;h<o.length;h++){var v=o[h],y=v._private,S=y.data;if(v.clearTraversalCache(),!(!e&&!y.removed)){if(S.id===void 0)S.id=$M();else if(bt(S.id))S.id=""+S.id;else if(Zd(S.id)||!Wt(S.id)){Kn("Can not create element with invalid string ID `"+S.id+"`"),p();continue}else if(n.hasElementWithId(S.id)){Kn("Can not create second element with ID `"+S.id+"`"),p();continue}}var w=S.id;if(v.isNode()){var T=y.position;T.x==null&&(T.x=0),T.y==null&&(T.y=0)}if(v.isEdge()){for(var _=v,C=["source","target"],N=C.length,A=!1,I=0;I<N;I++){var j=C[I],O=S[j];bt(O)&&(O=S[j]=""+S[j]),O==null||O===""?(Kn("Can not create edge `"+w+"` with unspecified "+j),A=!0):n.hasElementWithId(O)||(Kn("Can not create edge `"+w+"` with nonexistant "+j+" `"+O+"`"),A=!0)}if(A){p();continue}var F=n.getElementById(S.source),B=n.getElementById(S.target);F.same(B)?F._private.edges.push(_):(F._private.edges.push(_),B._private.edges.push(_)),_._private.source=F,_._private.target=B}y.map=new cc,y.map.set(w,{ele:v,index:0}),y.removed=!1,e&&n.addToPool(v)}for(var $=0;$<a.length;$++){var Z=a[$],D=Z._private.data;bt(D.parent)&&(D.parent=""+D.parent);var H=D.parent,U=H!=null;if(U||Z._private.parent){var W=Z._private.parent?n.collection().merge(Z._private.parent):n.getElementById(H);if(W.empty())D.parent=void 0;else if(W[0].removed())rn("Node added with missing parent, reference to parent removed"),D.parent=void 0,Z._private.parent=null;else{for(var Y=!1,Q=W;!Q.empty();){if(Z.same(Q)){Y=!0,D.parent=void 0;break}Q=Q.parent()}Y||(W[0]._private.children.push(Z),Z._private.parent=W[0],i.hasCompoundNodes=!0)}}}if(o.length>0){for(var ne=o.length===r.length?r:new Va(n,o),re=0;re<ne.length;re++){var q=ne[re];q.isNode()||(q.parallelEdges().clearTraversalCache(),q.source().clearTraversalCache(),q.target().clearTraversalCache())}var te;i.hasCompoundNodes?te=n.collection().merge(ne).merge(ne.connectedNodes()).merge(ne.parent()):te=ne,te.dirtyCompoundBoundsCache().dirtyBoundingBoxCache().updateStyle(t),t?ne.emitAndNotify("add"):e&&ne.emit("add")}return r};En.removed=function(){var t=this[0];return t&&t._private.removed};En.inside=function(){var t=this[0];return t&&!t._private.removed};En.remove=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=this,n=[],i={},a=r._private.cy;function s(H){for(var U=H._private.edges,W=0;W<U.length;W++)l(U[W])}function o(H){for(var U=H._private.children,W=0;W<U.length;W++)l(U[W])}function l(H){var U=i[H.id()];e&&H.removed()||U||(i[H.id()]=!0,H.isNode()?(n.push(H),s(H),o(H)):n.unshift(H))}for(var u=0,c=r.length;u<c;u++){var h=r[u];l(h)}function p(H,U){var W=H._private.edges;Yd(W,U),H.clearTraversalCache()}function v(H){H.clearTraversalCache()}var y=[];y.ids={};function S(H,U){U=U[0],H=H[0];var W=H._private.children,Y=H.id();Yd(W,U),U._private.parent=null,y.ids[Y]||(y.ids[Y]=!0,y.push(H))}r.dirtyCompoundBoundsCache(),e&&a.removeFromPool(n);for(var w=0;w<n.length;w++){var T=n[w];if(T.isEdge()){var _=T.source()[0],C=T.target()[0];p(_,T),p(C,T);for(var N=T.parallelEdges(),A=0;A<N.length;A++){var I=N[A];v(I),I.isBundledBezier()&&I.dirtyBoundingBoxCache()}}else{var j=T.parent();j.length!==0&&S(j,T)}e&&(T._private.removed=!0)}var O=a._private.elements;a._private.hasCompoundNodes=!1;for(var F=0;F<O.length;F++){var B=O[F];if(B.isParent()){a._private.hasCompoundNodes=!0;break}}var $=new Va(this.cy(),n);$.size()>0&&(t?$.emitAndNotify("remove"):e&&$.emit("remove"));for(var Z=0;Z<y.length;Z++){var D=y[Z];(!e||!D.removed())&&D.updateStyle()}return $};En.move=function(t){var e=this._private.cy,r=this,n=!1,i=!1,a=function(y){return y==null?y:""+y};if(t.source!==void 0||t.target!==void 0){var s=a(t.source),o=a(t.target),l=s!=null&&e.hasElementWithId(s),u=o!=null&&e.hasElementWithId(o);(l||u)&&(e.batch(function(){r.remove(n,i),r.emitAndNotify("moveout");for(var v=0;v<r.length;v++){var y=r[v],S=y._private.data;y.isEdge()&&(l&&(S.source=s),u&&(S.target=o))}r.restore(n,i)}),r.emitAndNotify("move"))}else if(t.parent!==void 0){var c=a(t.parent),h=c===null||e.hasElementWithId(c);if(h){var p=c===null?void 0:c;e.batch(function(){var v=r.remove(n,i);v.emitAndNotify("moveout");for(var y=0;y<r.length;y++){var S=r[y],w=S._private.data;S.isNode()&&(w.parent=p)}v.restore(n,i)}),r.emitAndNotify("move")}}return this};[aA,ZB,jy,Ud,$p,d7,P1,T7,MA,AA,R7,cx,Fy,Ga,Gd,us].forEach(function(t){er(En,t)});var B7={add:function(e){var r,n=this;if(po(e)){var i=e;if(i._private.cy===n)r=i.restore();else{for(var a=[],s=0;s<i.length;s++){var o=i[s];a.push(o.json())}r=new Va(n,a)}}else if(xn(e)){var l=e;r=new Va(n,l)}else if(Fr(e)&&(xn(e.nodes)||xn(e.edges))){for(var u=e,c=[],h=["nodes","edges"],p=0,v=h.length;p<v;p++){var y=h[p],S=u[y];if(xn(S))for(var w=0,T=S.length;w<T;w++){var _=er({group:y},S[w]);c.push(_)}}r=new Va(n,c)}else{var C=e;r=new S1(n,C).collection()}return r},remove:function(e){if(!po(e)){if(Wt(e)){var r=e;e=this.$(r)}}return e.remove()}};function z7(t,e,r,n){var i=4,a=.001,s=1e-7,o=10,l=11,u=1/(l-1),c=typeof Float32Array<"u";if(arguments.length!==4)return!1;for(var h=0;h<4;++h)if(typeof arguments[h]!="number"||isNaN(arguments[h])||!isFinite(arguments[h]))return!1;t=Math.min(t,1),r=Math.min(r,1),t=Math.max(t,0),r=Math.max(r,0);var p=c?new Float32Array(l):new Array(l);function v(B,$){return 1-3*$+3*B}function y(B,$){return 3*$-6*B}function S(B){return 3*B}function w(B,$,Z){return((v($,Z)*B+y($,Z))*B+S($))*B}function T(B,$,Z){return 3*v($,Z)*B*B+2*y($,Z)*B+S($)}function _(B,$){for(var Z=0;Z<i;++Z){var D=T($,t,r);if(D===0)return $;var H=w($,t,r)-B;$-=H/D}return $}function C(){for(var B=0;B<l;++B)p[B]=w(B*u,t,r)}function N(B,$,Z){var D,H,U=0;do H=$+(Z-$)/2,D=w(H,t,r)-B,D>0?Z=H:$=H;while(Math.abs(D)>s&&++U<o);return H}function A(B){for(var $=0,Z=1,D=l-1;Z!==D&&p[Z]<=B;++Z)$+=u;--Z;var H=(B-p[Z])/(p[Z+1]-p[Z]),U=$+H*u,W=T(U,t,r);return W>=a?_(B,U):W===0?U:N(B,$,$+u)}var I=!1;function j(){I=!0,(t!==e||r!==n)&&C()}var O=function($){return I||j(),t===e&&r===n?$:$===0?0:$===1?1:w(A($),e,n)};O.getControlPoints=function(){return[{x:t,y:e},{x:r,y:n}]};var F="generateBezier("+[t,e,r,n]+")";return O.toString=function(){return F},O}var U7=(function(){function t(n){return-n.tension*n.x-n.friction*n.v}function e(n,i,a){var s={x:n.x+a.dx*i,v:n.v+a.dv*i,tension:n.tension,friction:n.friction};return{dx:s.v,dv:t(s)}}function r(n,i){var a={dx:n.v,dv:t(n)},s=e(n,i*.5,a),o=e(n,i*.5,s),l=e(n,i,o),u=1/6*(a.dx+2*(s.dx+o.dx)+l.dx),c=1/6*(a.dv+2*(s.dv+o.dv)+l.dv);return n.x=n.x+u*i,n.v=n.v+c*i,n}return function n(i,a,s){var o={x:-1,v:0,tension:null,friction:null},l=[0],u=0,c=1/1e4,h=16/1e3,p,v,y;for(i=parseFloat(i)||500,a=parseFloat(a)||20,s=s||null,o.tension=i,o.friction=a,p=s!==null,p?(u=n(i,a),v=u/s*h):v=h;y=r(y||o,v),l.push(1+y.x),u+=16,Math.abs(y.x)>c&&Math.abs(y.v)>c;);return p?function(S){return l[S*(l.length-1)|0]}:u}})(),Cn=function(e,r,n,i){var a=z7(e,r,n,i);return function(s,o,l){return s+(o-s)*a(l)}},By={linear:function(e,r,n){return e+(r-e)*n},ease:Cn(.25,.1,.25,1),"ease-in":Cn(.42,0,1,1),"ease-out":Cn(0,0,.58,1),"ease-in-out":Cn(.42,0,.58,1),"ease-in-sine":Cn(.47,0,.745,.715),"ease-out-sine":Cn(.39,.575,.565,1),"ease-in-out-sine":Cn(.445,.05,.55,.95),"ease-in-quad":Cn(.55,.085,.68,.53),"ease-out-quad":Cn(.25,.46,.45,.94),"ease-in-out-quad":Cn(.455,.03,.515,.955),"ease-in-cubic":Cn(.55,.055,.675,.19),"ease-out-cubic":Cn(.215,.61,.355,1),"ease-in-out-cubic":Cn(.645,.045,.355,1),"ease-in-quart":Cn(.895,.03,.685,.22),"ease-out-quart":Cn(.165,.84,.44,1),"ease-in-out-quart":Cn(.77,0,.175,1),"ease-in-quint":Cn(.755,.05,.855,.06),"ease-out-quint":Cn(.23,1,.32,1),"ease-in-out-quint":Cn(.86,0,.07,1),"ease-in-expo":Cn(.95,.05,.795,.035),"ease-out-expo":Cn(.19,1,.22,1),"ease-in-out-expo":Cn(1,0,0,1),"ease-in-circ":Cn(.6,.04,.98,.335),"ease-out-circ":Cn(.075,.82,.165,1),"ease-in-out-circ":Cn(.785,.135,.15,.86),spring:function(e,r,n){if(n===0)return By.linear;var i=U7(e,r,n);return function(a,s,o){return a+(s-a)*i(o)}},"cubic-bezier":Cn};function TN(t,e,r,n,i){if(n===1||e===r)return r;var a=i(e,r,n);return t==null||((t.roundValue||t.color)&&(a=Math.round(a)),t.min!==void 0&&(a=Math.max(a,t.min)),t.max!==void 0&&(a=Math.min(a,t.max))),a}function NN(t,e){return t.pfValue!=null||t.value!=null?t.pfValue!=null&&(e==null||e.type.units!=="%")?t.pfValue:t.value:t}function pp(t,e,r,n,i){var a=i!=null?i.type:null;r<0?r=0:r>1&&(r=1);var s=NN(t,i),o=NN(e,i);if(bt(s)&&bt(o))return TN(a,s,o,r,n);if(xn(s)&&xn(o)){for(var l=[],u=0;u<o.length;u++){var c=s[u],h=o[u];if(c!=null&&h!=null){var p=TN(a,c,h,r,n);l.push(p)}else l.push(h)}return l}}function G7(t,e,r,n){var i=!n,a=t._private,s=e._private,o=s.easing,l=s.startTime,u=n?t:t.cy(),c=u.style();if(!s.easingImpl)if(o==null)s.easingImpl=By.linear;else{var h;if(Wt(o)){var p=c.parse("transition-timing-function",o);h=p.value}else h=o;var v,y;Wt(h)?(v=h,y=[]):(v=h[1],y=h.slice(2).map(function(ne){return+ne})),y.length>0?(v==="spring"&&y.push(s.duration),s.easingImpl=By[v].apply(null,y)):s.easingImpl=By[v]}var S=s.easingImpl,w;if(s.duration===0?w=1:w=(r-l)/s.duration,s.applying&&(w=s.progress),w<0?w=0:w>1&&(w=1),s.delay==null){var T=s.startPosition,_=s.position;if(_&&i&&!t.locked()){var C={};Hm(T.x,_.x)&&(C.x=pp(T.x,_.x,w,S)),Hm(T.y,_.y)&&(C.y=pp(T.y,_.y,w,S)),t.position(C)}var N=s.startPan,A=s.pan,I=a.pan,j=A!=null&&n;j&&(Hm(N.x,A.x)&&(I.x=pp(N.x,A.x,w,S)),Hm(N.y,A.y)&&(I.y=pp(N.y,A.y,w,S)),t.emit("pan"));var O=s.startZoom,F=s.zoom,B=F!=null&&n;B&&(Hm(O,F)&&(a.zoom=wv(a.minZoom,pp(O,F,w,S),a.maxZoom)),t.emit("zoom")),(j||B)&&t.emit("viewport");var $=s.style;if($&&$.length>0&&i){for(var Z=0;Z<$.length;Z++){var D=$[Z],H=D.name,U=D,W=s.startStyle[H],Y=c.properties[W.name],Q=pp(W,U,w,S,Y);c.overrideBypass(t,H,Q)}t.emit("style")}}return s.progress=w,w}function Hm(t,e){return t==null||e==null?!1:bt(t)&&bt(e)?!0:!!(t&&e)}function V7(t,e,r,n){var i=e._private;i.started=!0,i.startTime=r-i.progress*i.duration}function PN(t,e){var r=e._private.aniEles,n=[];function i(c,h){var p=c._private,v=p.animation.current,y=p.animation.queue,S=!1;if(v.length===0){var w=y.shift();w&&v.push(w)}for(var T=function(I){for(var j=I.length-1;j>=0;j--){var O=I[j];O()}I.splice(0,I.length)},_=v.length-1;_>=0;_--){var C=v[_],N=C._private;if(N.stopped){v.splice(_,1),N.hooked=!1,N.playing=!1,N.started=!1,T(N.frames);continue}!N.playing&&!N.applying||(N.playing&&N.applying&&(N.applying=!1),N.started||V7(c,C,t),G7(c,C,t,h),N.applying&&(N.applying=!1),T(N.frames),N.step!=null&&N.step(t),C.completed()&&(v.splice(_,1),N.hooked=!1,N.playing=!1,N.started=!1,T(N.completes)),S=!0)}return!h&&v.length===0&&y.length===0&&n.push(c),S}for(var a=!1,s=0;s<r.length;s++){var o=r[s],l=i(o);a=a||l}var u=i(e,!0);(a||u)&&(r.length>0?e.notify("draw",r):e.notify("draw")),r.unmerge(n),e.emit("step")}var H7={animate:tn.animate(),animation:tn.animation(),animated:tn.animated(),clearQueue:tn.clearQueue(),delay:tn.delay(),delayAnimation:tn.delayAnimation(),stop:tn.stop(),addToAnimationPool:function(e){var r=this;r.styleEnabled()&&r._private.aniEles.merge(e)},stopAnimationLoop:function(){this._private.animationsRunning=!1},startAnimationLoop:function(){var e=this;if(e._private.animationsRunning=!0,!e.styleEnabled())return;function r(){e._private.animationsRunning&&ax(function(a){PN(a,e),r()})}var n=e.renderer();n&&n.beforeRender?n.beforeRender(function(a,s){PN(s,e)},n.beforeRenderPriorities.animations):r()}},W7={qualifierCompare:function(e,r){return e==null||r==null?e==null&&r==null:e.sameText(r)},eventMatches:function(e,r,n){var i=r.qualifier;return i!=null?e!==n.target&&Kv(n.target)&&i.matches(n.target):!0},addEventFields:function(e,r){r.cy=e,r.target=e},callbackContext:function(e,r,n){return r.qualifier!=null?n.target:e}},iy=function(e){return Wt(e)?new Qd(e):e},OA={createEmitter:function(){var e=this._private;return e.emitter||(e.emitter=new M1(W7,this)),this},emitter:function(){return this._private.emitter},on:function(e,r,n){return this.emitter().on(e,iy(r),n),this},removeListener:function(e,r,n){return this.emitter().removeListener(e,iy(r),n),this},removeAllListeners:function(){return this.emitter().removeAllListeners(),this},one:function(e,r,n){return this.emitter().one(e,iy(r),n),this},once:function(e,r,n){return this.emitter().one(e,iy(r),n),this},emit:function(e,r){return this.emitter().emit(e,r),this},emitAndNotify:function(e,r){return this.emit(e),this.notify(e,r),this}};tn.eventAliasesOn(OA);var GS={png:function(e){var r=this._private.renderer;return e=e||{},r.png(e)},jpg:function(e){var r=this._private.renderer;return e=e||{},e.bg=e.bg||"#fff",r.jpg(e)}};GS.jpeg=GS.jpg;var zy={layout:function(e){var r=this;if(e==null){Kn("Layout options must be specified to make a layout");return}if(e.name==null){Kn("A `name` must be specified to make a layout");return}var n=e.name,i=r.extension("layout",n);if(i==null){Kn("No such layout `"+n+"` found.  Did you forget to import it and `cytoscape.use()` it?");return}var a;Wt(e.eles)?a=r.$(e.eles):a=e.eles!=null?e.eles:r.$();var s=new i(er({},e,{cy:r,eles:a}));return s}};zy.createLayout=zy.makeLayout=zy.layout;var q7={notify:function(e,r){var n=this._private;if(this.batching()){n.batchNotifications=n.batchNotifications||{};var i=n.batchNotifications[e]=n.batchNotifications[e]||this.collection();r!=null&&i.merge(r);return}if(n.notificationsEnabled){var a=this.renderer();this.destroyed()||!a||a.notify(e,r)}},notifications:function(e){var r=this._private;return e===void 0?r.notificationsEnabled:(r.notificationsEnabled=!!e,this)},noNotifications:function(e){this.notifications(!1),e(),this.notifications(!0)},batching:function(){return this._private.batchCount>0},startBatch:function(){var e=this._private;return e.batchCount==null&&(e.batchCount=0),e.batchCount===0&&(e.batchStyleEles=this.collection(),e.batchNotifications={}),e.batchCount++,this},endBatch:function(){var e=this._private;if(e.batchCount===0)return this;if(e.batchCount--,e.batchCount===0){e.batchStyleEles.updateStyle();var r=this.renderer();Object.keys(e.batchNotifications).forEach(function(n){var i=e.batchNotifications[n];i.empty()?r.notify(n):r.notify(n,i)})}return this},batch:function(e){return this.startBatch(),e(),this.endBatch(),this},batchData:function(e){var r=this;return this.batch(function(){for(var n=Object.keys(e),i=0;i<n.length;i++){var a=n[i],s=e[a],o=r.getElementById(a);o.data(s)}})}},$7=qa({hideEdgesOnViewport:!1,textureOnViewport:!1,motionBlur:!1,motionBlurOpacity:.05,pixelRatio:void 0,desktopTapThreshold:4,touchTapThreshold:8,wheelSensitivity:1,debug:!1,showFps:!1,webgl:!1,webglDebug:!1,webglDebugShowAtlases:!1,webglTexSize:2048,webglTexRows:36,webglTexRowsNodes:18,webglBatchSize:2048,webglTexPerBatch:14,webglBgColor:[255,255,255]}),VS={renderTo:function(e,r,n,i){var a=this._private.renderer;return a.renderTo(e,r,n,i),this},renderer:function(){return this._private.renderer},forceRender:function(){return this.notify("draw"),this},resize:function(){return this.invalidateSize(),this.emitAndNotify("resize"),this},initRenderer:function(e){var r=this,n=r.extension("renderer",e.name);if(n==null){Kn("Can not initialise: No such renderer `".concat(e.name,"` found. Did you forget to import it and `cytoscape.use()` it?"));return}e.wheelSensitivity!==void 0&&rn("You have set a custom wheel sensitivity.  This will make your app zoom unnaturally when using mainstream mice.  You should change this value from the default only if you can guarantee that all your users will use the same hardware and OS configuration as your current machine.");var i=$7(e);i.cy=r,r._private.renderer=new n(i),this.notify("init")},destroyRenderer:function(){var e=this;e.notify("destroy");var r=e.container();if(r)for(r._cyreg=null;r.childNodes.length>0;)r.removeChild(r.childNodes[0]);e._private.renderer=null,e.mutableElements().forEach(function(n){var i=n._private;i.rscratch={},i.rstyle={},i.animation.current=[],i.animation.queue=[]})},onRender:function(e){return this.on("render",e)},offRender:function(e){return this.off("render",e)}};VS.invalidateDimensions=VS.resize;var Uy={collection:function(e,r){return Wt(e)?this.$(e):po(e)?e.collection():xn(e)?(r||(r={}),new Va(this,e,r.unique,r.removed)):new Va(this)},nodes:function(e){var r=this.$(function(n){return n.isNode()});return e?r.filter(e):r},edges:function(e){var r=this.$(function(n){return n.isEdge()});return e?r.filter(e):r},$:function(e){var r=this._private.elements;return e?r.filter(e):r.spawnSelf()},mutableElements:function(){return this._private.elements}};Uy.elements=Uy.filter=Uy.$;var wa={},Jg="t",K7="f";wa.apply=function(t){for(var e=this,r=e._private,n=r.cy,i=n.collection(),a=0;a<t.length;a++){var s=t[a],o=e.getContextMeta(s);if(!o.empty){var l=e.getContextStyle(o),u=e.applyContextStyle(o,l,s);s._private.appliedInitStyle?e.updateTransitions(s,u.diffProps):s._private.appliedInitStyle=!0;var c=e.updateStyleHints(s);c&&i.push(s)}}return i};wa.getPropertiesDiff=function(t,e){var r=this,n=r._private.propDiffs=r._private.propDiffs||{},i=t+"-"+e,a=n[i];if(a)return a;for(var s=[],o={},l=0;l<r.length;l++){var u=r[l],c=t[l]===Jg,h=e[l]===Jg,p=c!==h,v=u.mappedProperties.length>0;if(p||h&&v){var y=void 0;p&&v||p?y=u.properties:v&&(y=u.mappedProperties);for(var S=0;S<y.length;S++){for(var w=y[S],T=w.name,_=!1,C=l+1;C<r.length;C++){var N=r[C],A=e[C]===Jg;if(A&&(_=N.properties[w.name]!=null,_))break}!o[T]&&!_&&(o[T]=!0,s.push(T))}}}return n[i]=s,s};wa.getContextMeta=function(t){for(var e=this,r="",n,i=t._private.styleCxtKey||"",a=0;a<e.length;a++){var s=e[a],o=s.selector&&s.selector.matches(t);o?r+=Jg:r+=K7}return n=e.getPropertiesDiff(i,r),t._private.styleCxtKey=r,{key:r,diffPropNames:n,empty:n.length===0}};wa.getContextStyle=function(t){var e=t.key,r=this,n=this._private.contextStyles=this._private.contextStyles||{};if(n[e])return n[e];for(var i={_private:{key:e}},a=0;a<r.length;a++){var s=r[a],o=e[a]===Jg;if(o)for(var l=0;l<s.properties.length;l++){var u=s.properties[l];i[u.name]=u}}return n[e]=i,i};wa.applyContextStyle=function(t,e,r){for(var n=this,i=t.diffPropNames,a={},s=n.types,o=0;o<i.length;o++){var l=i[o],u=e[l],c=r.pstyle(l);if(!u)if(c)c.bypass?u={name:l,deleteBypassed:!0}:u={name:l,delete:!0};else continue;if(c!==u){if(u.mapped===s.fn&&c!=null&&c.mapping!=null&&c.mapping.value===u.value){var h=c.mapping,p=h.fnValue=u.value(r);if(p===h.prevFnValue)continue}var v=a[l]={prev:c};n.applyParsedProperty(r,u),v.next=r.pstyle(l),v.next&&v.next.bypass&&(v.next=v.next.bypassed)}}return{diffProps:a}};wa.updateStyleHints=function(t){var e=t._private,r=this,n=r.propertyGroupNames,i=r.propertyGroupKeys,a=function(xe,Se,Ve){return r.getPropertiesHash(xe,Se,Ve)},s=e.styleKey;if(t.removed())return!1;var o=e.group==="nodes",l=t._private.style;n=Object.keys(l);for(var u=0;u<i.length;u++){var c=i[u];e.styleKeys[c]=[Yh,Cp]}for(var h=function(xe,Se){return e.styleKeys[Se][0]=yv(xe,e.styleKeys[Se][0])},p=function(xe,Se){return e.styleKeys[Se][1]=xv(xe,e.styleKeys[Se][1])},v=function(xe,Se){h(xe,Se),p(xe,Se)},y=function(xe,Se){for(var Ve=0;Ve<xe.length;Ve++){var $e=xe.charCodeAt(Ve);h($e,Se),p($e,Se)}},S=2e9,w=function(xe){return-128<xe&&xe<128&&Math.floor(xe)!==xe?S-(xe*1024|0):xe},T=0;T<n.length;T++){var _=n[T],C=l[_];if(C!=null){var N=this.properties[_],A=N.type,I=N.groupKey,j=void 0;N.hashOverride!=null?j=N.hashOverride(t,C):C.pfValue!=null&&(j=C.pfValue);var O=N.enums==null?C.value:null,F=j!=null,B=O!=null,$=F||B,Z=C.units;if(A.number&&$&&!A.multiple){var D=F?j:O;v(w(D),I),!F&&Z!=null&&y(Z,I)}else y(C.strValue,I)}}for(var H=[Yh,Cp],U=0;U<i.length;U++){var W=i[U],Y=e.styleKeys[W];H[0]=yv(Y[0],H[0]),H[1]=xv(Y[1],H[1])}e.styleKey=c9(H[0],H[1]);var Q=e.styleKeys;e.labelDimsKey=vd(Q.labelDimensions);var ne=a(t,["label"],Q.labelDimensions);if(e.labelKey=vd(ne),e.labelStyleKey=vd(Y0(Q.commonLabel,ne)),!o){var re=a(t,["source-label"],Q.labelDimensions);e.sourceLabelKey=vd(re),e.sourceLabelStyleKey=vd(Y0(Q.commonLabel,re));var q=a(t,["target-label"],Q.labelDimensions);e.targetLabelKey=vd(q),e.targetLabelStyleKey=vd(Y0(Q.commonLabel,q))}if(o){var te=e.styleKeys,ae=te.nodeBody,de=te.nodeBorder,ge=te.nodeOutline,ye=te.backgroundImage,se=te.compound,fe=te.pie,le=te.stripe,pe=[ae,de,ge,ye,se,fe,le].filter(function(me){return me!=null}).reduce(Y0,[Yh,Cp]);e.nodeKey=vd(pe),e.hasPie=fe!=null&&fe[0]!==Yh&&fe[1]!==Cp,e.hasStripe=le!=null&&le[0]!==Yh&&le[1]!==Cp}return s!==e.styleKey};wa.clearStyleHints=function(t){var e=t._private;e.styleCxtKey="",e.styleKeys={},e.styleKey=null,e.labelKey=null,e.labelStyleKey=null,e.sourceLabelKey=null,e.sourceLabelStyleKey=null,e.targetLabelKey=null,e.targetLabelStyleKey=null,e.nodeKey=null,e.hasPie=null,e.hasStripe=null};wa.applyParsedProperty=function(t,e){var r=this,n=e,i=t._private.style,a,s=r.types,o=r.properties[n.name].type,l=n.bypass,u=i[n.name],c=u&&u.bypass,h=t._private,p="mapping",v=function(ae){return ae==null?null:ae.pfValue!=null?ae.pfValue:ae.value},y=function(){var ae=v(u),de=v(n);r.checkTriggers(t,n.name,ae,de)};if(e.name==="curve-style"&&t.isEdge()&&(e.value!=="bezier"&&t.isLoop()||e.value==="haystack"&&(t.source().isParent()||t.target().isParent()))&&(n=e=this.parse(e.name,"bezier",l)),n.delete)return i[n.name]=void 0,y(),!0;if(n.deleteBypassed)return u?u.bypass?(u.bypassed=void 0,y(),!0):!1:(y(),!0);if(n.deleteBypass)return u?u.bypass?(i[n.name]=u.bypassed,y(),!0):!1:(y(),!0);var S=function(){rn("Do not assign mappings to elements without corresponding data (i.e. ele `"+t.id()+"` has no mapping for property `"+n.name+"` with data field `"+n.field+"`); try a `["+n.field+"]` selector to limit scope to elements with `"+n.field+"` defined")};switch(n.mapped){case s.mapData:{for(var w=n.field.split("."),T=h.data,_=0;_<w.length&&T;_++){var C=w[_];T=T[C]}if(T==null)return S(),!1;var N;if(bt(T)){var A=n.fieldMax-n.fieldMin;A===0?N=0:N=(T-n.fieldMin)/A}else return rn("Do not use continuous mappers without specifying numeric data (i.e. `"+n.field+": "+T+"` for `"+t.id()+"` is non-numeric)"),!1;if(N<0?N=0:N>1&&(N=1),o.color){var I=n.valueMin[0],j=n.valueMax[0],O=n.valueMin[1],F=n.valueMax[1],B=n.valueMin[2],$=n.valueMax[2],Z=n.valueMin[3]==null?1:n.valueMin[3],D=n.valueMax[3]==null?1:n.valueMax[3],H=[Math.round(I+(j-I)*N),Math.round(O+(F-O)*N),Math.round(B+($-B)*N),Math.round(Z+(D-Z)*N)];a={bypass:n.bypass,name:n.name,value:H,strValue:"rgb("+H[0]+", "+H[1]+", "+H[2]+")"}}else if(o.number){var U=n.valueMin+(n.valueMax-n.valueMin)*N;a=this.parse(n.name,U,n.bypass,p)}else return!1;if(!a)return S(),!1;a.mapping=n,n=a;break}case s.data:{for(var W=n.field.split("."),Y=h.data,Q=0;Q<W.length&&Y;Q++){var ne=W[Q];Y=Y[ne]}if(Y!=null&&(a=this.parse(n.name,Y,n.bypass,p)),!a)return S(),!1;a.mapping=n,n=a;break}case s.fn:{var re=n.value,q=n.fnValue!=null?n.fnValue:re(t);if(n.prevFnValue=q,q==null)return rn("Custom function mappers may not return null (i.e. `"+n.name+"` for ele `"+t.id()+"` is null)"),!1;if(a=this.parse(n.name,q,n.bypass,p),!a)return rn("Custom function mappers may not return invalid values for the property type (i.e. `"+n.name+"` for ele `"+t.id()+"` is invalid)"),!1;a.mapping=ku(n),n=a;break}case void 0:break;default:return!1}return l?(c?n.bypassed=u.bypassed:n.bypassed=u,i[n.name]=n):c?u.bypassed=n:i[n.name]=n,y(),!0};wa.cleanElements=function(t,e){for(var r=0;r<t.length;r++){var n=t[r];if(this.clearStyleHints(n),n.dirtyCompoundBoundsCache(),n.dirtyBoundingBoxCache(),!e)n._private.style={};else for(var i=n._private.style,a=Object.keys(i),s=0;s<a.length;s++){var o=a[s],l=i[o];l!=null&&(l.bypass?l.bypassed=null:i[o]=null)}}};wa.update=function(){var t=this._private.cy,e=t.mutableElements();e.updateStyle()};wa.updateTransitions=function(t,e){var r=this,n=t._private,i=t.pstyle("transition-property").value,a=t.pstyle("transition-duration").pfValue,s=t.pstyle("transition-delay").pfValue;if(i.length>0&&a>0){for(var o={},l=!1,u=0;u<i.length;u++){var c=i[u],h=t.pstyle(c),p=e[c];if(p){var v=p.prev,y=v,S=p.next!=null?p.next:h,w=!1,T=void 0,_=1e-6;y&&(bt(y.pfValue)&&bt(S.pfValue)?(w=S.pfValue-y.pfValue,T=y.pfValue+_*w):bt(y.value)&&bt(S.value)?(w=S.value-y.value,T=y.value+_*w):xn(y.value)&&xn(S.value)&&(w=y.value[0]!==S.value[0]||y.value[1]!==S.value[1]||y.value[2]!==S.value[2],T=y.strValue),w&&(o[c]=S.strValue,this.applyBypass(t,c,T),l=!0))}}if(!l)return;n.transitioning=!0,new cm(function(C){s>0?t.delayAnimation(s).play().promise().then(C):C()}).then(function(){return t.animation({style:o,duration:a,easing:t.pstyle("transition-timing-function").value,queue:!1}).play().promise()}).then(function(){r.removeBypasses(t,i),t.emitAndNotify("style"),n.transitioning=!1})}else n.transitioning&&(this.removeBypasses(t,i),t.emitAndNotify("style"),n.transitioning=!1)};wa.checkTrigger=function(t,e,r,n,i,a){var s=this.properties[e],o=i(s);t.removed()||o!=null&&o(r,n,t)&&a(s)};wa.checkZOrderTrigger=function(t,e,r,n){var i=this;this.checkTrigger(t,e,r,n,function(a){return a.triggersZOrder},function(){i._private.cy.notify("zorder",t)})};wa.checkBoundsTrigger=function(t,e,r,n){this.checkTrigger(t,e,r,n,function(i){return i.triggersBounds},function(i){t.dirtyCompoundBoundsCache(),t.dirtyBoundingBoxCache()})};wa.checkConnectedEdgesBoundsTrigger=function(t,e,r,n){this.checkTrigger(t,e,r,n,function(i){return i.triggersBoundsOfConnectedEdges},function(i){t.connectedEdges().forEach(function(a){a.dirtyBoundingBoxCache()})})};wa.checkParallelEdgesBoundsTrigger=function(t,e,r,n){this.checkTrigger(t,e,r,n,function(i){return i.triggersBoundsOfParallelEdges},function(i){t.parallelEdges().forEach(function(a){a.dirtyBoundingBoxCache()})})};wa.checkTriggers=function(t,e,r,n){t.dirtyStyleCache(),this.checkZOrderTrigger(t,e,r,n),this.checkBoundsTrigger(t,e,r,n),this.checkConnectedEdgesBoundsTrigger(t,e,r,n),this.checkParallelEdgesBoundsTrigger(t,e,r,n)};var t0={};t0.applyBypass=function(t,e,r,n){var i=this,a=[],s=!0;if(e==="*"||e==="**"){if(r!==void 0)for(var o=0;o<i.properties.length;o++){var l=i.properties[o],u=l.name,c=this.parse(u,r,!0);c&&a.push(c)}}else if(Wt(e)){var h=this.parse(e,r,!0);h&&a.push(h)}else if(Fr(e)){var p=e;n=r;for(var v=Object.keys(p),y=0;y<v.length;y++){var S=v[y],w=p[S];if(w===void 0&&(w=p[b1(S)]),w!==void 0){var T=this.parse(S,w,!0);T&&a.push(T)}}}else return!1;if(a.length===0)return!1;for(var _=!1,C=0;C<t.length;C++){for(var N=t[C],A={},I=void 0,j=0;j<a.length;j++){var O=a[j];if(n){var F=N.pstyle(O.name);I=A[O.name]={prev:F}}_=this.applyParsedProperty(N,ku(O))||_,n&&(I.next=N.pstyle(O.name))}_&&this.updateStyleHints(N),n&&this.updateTransitions(N,A,s)}return _};t0.overrideBypass=function(t,e,r){e=Qk(e);for(var n=0;n<t.length;n++){var i=t[n],a=i._private.style[e],s=this.properties[e].type,o=s.color,l=s.mutiple,u=a?a.pfValue!=null?a.pfValue:a.value:null;!a||!a.bypass?this.applyBypass(i,e,r):(a.value=r,a.pfValue!=null&&(a.pfValue=r),o?a.strValue="rgb("+r.join(",")+")":l?a.strValue=r.join(" "):a.strValue=""+r,this.updateStyleHints(i)),this.checkTriggers(i,e,u,r)}};t0.removeAllBypasses=function(t,e){return this.removeBypasses(t,this.propertyNames,e)};t0.removeBypasses=function(t,e,r){for(var n=!0,i=0;i<t.length;i++){for(var a=t[i],s={},o=0;o<e.length;o++){var l=e[o],u=this.properties[l],c=a.pstyle(u.name);if(!(!c||!c.bypass)){var h="",p=this.parse(l,h,!0),v=s[u.name]={prev:c};this.applyParsedProperty(a,p),v.next=a.pstyle(u.name)}}this.updateStyleHints(a),r&&this.updateTransitions(a,s,n)}};var f_={};f_.getEmSizeInPixels=function(){var t=this.containerCss("font-size");return t!=null?parseFloat(t):1};f_.containerCss=function(t){var e=this._private.cy,r=e.container(),n=e.window();if(n&&r&&n.getComputedStyle)return n.getComputedStyle(r).getPropertyValue(t)};var Tu={};Tu.getRenderedStyle=function(t,e){return e?this.getStylePropertyValue(t,e,!0):this.getRawStyle(t,!0)};Tu.getRawStyle=function(t,e){var r=this;if(t=t[0],t){for(var n={},i=0;i<r.properties.length;i++){var a=r.properties[i],s=r.getStylePropertyValue(t,a.name,e);s!=null&&(n[a.name]=s,n[b1(a.name)]=s)}return n}};Tu.getIndexedStyle=function(t,e,r,n){var i=t.pstyle(e)[r][n];return i??t.cy().style().getDefaultProperty(e)[r][0]};Tu.getStylePropertyValue=function(t,e,r){var n=this;if(t=t[0],t){var i=n.properties[e];i.alias&&(i=i.pointsTo);var a=i.type,s=t.pstyle(i.name);if(s){var o=s.value,l=s.units,u=s.strValue;if(r&&a.number&&o!=null&&bt(o)){var c=t.cy().zoom(),h=function(w){return w*c},p=function(w,T){return h(w)+T},v=xn(o),y=v?l.every(function(S){return S!=null}):l!=null;return y?v?o.map(function(S,w){return p(S,l[w])}).join(" "):p(o,l):v?o.map(function(S){return Wt(S)?S:""+h(S)}).join(" "):""+h(o)}else if(u!=null)return u}return null}};Tu.getAnimationStartStyle=function(t,e){for(var r={},n=0;n<e.length;n++){var i=e[n],a=i.name,s=t.pstyle(a);s!==void 0&&(Fr(s)?s=this.parse(a,s.strValue):s=this.parse(a,s)),s&&(r[a]=s)}return r};Tu.getPropsList=function(t){var e=this,r=[],n=t,i=e.properties;if(n)for(var a=Object.keys(n),s=0;s<a.length;s++){var o=a[s],l=n[o],u=i[o]||i[Qk(o)],c=this.parse(u.name,l);c&&r.push(c)}return r};Tu.getNonDefaultPropertiesHash=function(t,e,r){var n=r.slice(),i,a,s,o,l,u;for(l=0;l<e.length;l++)if(i=e[l],a=t.pstyle(i,!1),a!=null)if(a.pfValue!=null)n[0]=yv(o,n[0]),n[1]=xv(o,n[1]);else for(s=a.strValue,u=0;u<s.length;u++)o=s.charCodeAt(u),n[0]=yv(o,n[0]),n[1]=xv(o,n[1]);return n};Tu.getPropertiesHash=Tu.getNonDefaultPropertiesHash;var L1={};L1.appendFromJson=function(t){for(var e=this,r=0;r<t.length;r++){var n=t[r],i=n.selector,a=n.style||n.css,s=Object.keys(a);e.selector(i);for(var o=0;o<s.length;o++){var l=s[o],u=a[l];e.css(l,u)}}return e};L1.fromJson=function(t){var e=this;return e.resetToDefault(),e.appendFromJson(t),e};L1.json=function(){for(var t=[],e=this.defaultLength;e<this.length;e++){for(var r=this[e],n=r.selector,i=r.properties,a={},s=0;s<i.length;s++){var o=i[s];a[o.name]=o.strValue}t.push({selector:n?n.toString():"core",style:a})}return t};var p_={};p_.appendFromString=function(t){var e=this,r=this,n=""+t,i,a,s;n=n.replace(/[/][*](\s|.)+?[*][/]/g,"");function o(){n.length>i.length?n=n.substr(i.length):n=""}function l(){a.length>s.length?a=a.substr(s.length):a=""}for(;;){var u=n.match(/^\s*$/);if(u)break;var c=n.match(/^\s*((?:.|\s)+?)\s*\{((?:.|\s)+?)\}/);if(!c){rn("Halting stylesheet parsing: String stylesheet contains more to parse but no selector and block found in: "+n);break}i=c[0];var h=c[1];if(h!=="core"){var p=new Qd(h);if(p.invalid){rn("Skipping parsing of block: Invalid selector found in string stylesheet: "+h),o();continue}}var v=c[2],y=!1;a=v;for(var S=[];;){var w=a.match(/^\s*$/);if(w)break;var T=a.match(/^\s*(.+?)\s*:\s*(.+?)(?:\s*;|\s*$)/);if(!T){rn("Skipping parsing of block: Invalid formatting of style property and value definitions found in:"+v),y=!0;break}s=T[0];var _=T[1],C=T[2],N=e.properties[_];if(!N){rn("Skipping property: Invalid property name in: "+s),l();continue}var A=r.parse(_,C);if(!A){rn("Skipping property: Invalid property definition in: "+s),l();continue}S.push({name:_,val:C}),l()}if(y){o();break}r.selector(h);for(var I=0;I<S.length;I++){var j=S[I];r.css(j.name,j.val)}o()}return r};p_.fromString=function(t){var e=this;return e.resetToDefault(),e.appendFromString(t),e};var Ii={};(function(){var t=Ki,e=Gj,r=Hj,n=Wj,i=qj,a=function(me){return"^"+me+"\\s*\\(\\s*([\\w\\.]+)\\s*\\)$"},s=function(me){var xe=t+"|\\w+|"+e+"|"+r+"|"+n+"|"+i;return"^"+me+"\\s*\\(([\\w\\.]+)\\s*\\,\\s*("+t+")\\s*\\,\\s*("+t+")\\s*,\\s*("+xe+")\\s*\\,\\s*("+xe+")\\)$"},o=[`^url\\s*\\(\\s*['"]?(.+?)['"]?\\s*\\)$`,"^(none)$","^(.+)$"];Ii.types={time:{number:!0,min:0,units:"s|ms",implicitUnits:"ms"},percent:{number:!0,min:0,max:100,units:"%",implicitUnits:"%"},percentages:{number:!0,min:0,max:100,units:"%",implicitUnits:"%",multiple:!0},zeroOneNumber:{number:!0,min:0,max:1,unitless:!0},zeroOneNumbers:{number:!0,min:0,max:1,unitless:!0,multiple:!0},nOneOneNumber:{number:!0,min:-1,max:1,unitless:!0},nonNegativeInt:{number:!0,min:0,integer:!0,unitless:!0},nonNegativeNumber:{number:!0,min:0,unitless:!0},position:{enums:["parent","origin"]},nodeSize:{number:!0,min:0,enums:["label"]},number:{number:!0,unitless:!0},numbers:{number:!0,unitless:!0,multiple:!0},positiveNumber:{number:!0,unitless:!0,min:0,strictMin:!0},size:{number:!0,min:0},bidirectionalSize:{number:!0},bidirectionalSizeMaybePercent:{number:!0,allowPercent:!0},bidirectionalSizes:{number:!0,multiple:!0},sizeMaybePercent:{number:!0,min:0,allowPercent:!0},axisDirection:{enums:["horizontal","leftward","rightward","vertical","upward","downward","auto"]},axisDirectionExplicit:{enums:["leftward","rightward","upward","downward"]},axisDirectionPrimary:{enums:["horizontal","vertical"]},paddingRelativeTo:{enums:["width","height","average","min","max"]},bgWH:{number:!0,min:0,allowPercent:!0,enums:["auto"],multiple:!0},bgPos:{number:!0,allowPercent:!0,multiple:!0},bgRelativeTo:{enums:["inner","include-padding"],multiple:!0},bgRepeat:{enums:["repeat","repeat-x","repeat-y","no-repeat"],multiple:!0},bgFit:{enums:["none","contain","cover"],multiple:!0},bgCrossOrigin:{enums:["anonymous","use-credentials","null"],multiple:!0},bgClip:{enums:["none","node"],multiple:!0},bgContainment:{enums:["inside","over"],multiple:!0},boxSelection:{enums:["contain","overlap","none"]},color:{color:!0},colors:{color:!0,multiple:!0},fill:{enums:["solid","linear-gradient","radial-gradient"]},bool:{enums:["yes","no"]},bools:{enums:["yes","no"],multiple:!0},lineStyle:{enums:["solid","dotted","dashed"]},lineCap:{enums:["butt","round","square"]},linePosition:{enums:["center","inside","outside"]},lineJoin:{enums:["round","bevel","miter"]},borderStyle:{enums:["solid","dotted","dashed","double"]},curveStyle:{enums:["bezier","unbundled-bezier","haystack","segments","straight","straight-triangle","taxi","round-segments","round-taxi"]},radiusType:{enums:["arc-radius","influence-radius"],multiple:!0},fontFamily:{regex:'^([\\w- \\"]+(?:\\s*,\\s*[\\w- \\"]+)*)$'},fontStyle:{enums:["italic","normal","oblique"]},fontWeight:{enums:["normal","bold","bolder","lighter","100","200","300","400","500","600","800","900",100,200,300,400,500,600,700,800,900]},textDecoration:{enums:["none","underline","overline","line-through"]},textTransform:{enums:["none","uppercase","lowercase"]},textWrap:{enums:["none","wrap","ellipsis"]},textOverflowWrap:{enums:["whitespace","anywhere"]},textBackgroundShape:{enums:["rectangle","roundrectangle","round-rectangle","circle"]},nodeShape:{enums:["rectangle","roundrectangle","round-rectangle","cutrectangle","cut-rectangle","bottomroundrectangle","bottom-round-rectangle","barrel","ellipse","triangle","round-triangle","square","pentagon","round-pentagon","hexagon","round-hexagon","concavehexagon","concave-hexagon","heptagon","round-heptagon","octagon","round-octagon","tag","round-tag","star","diamond","round-diamond","vee","rhomboid","right-rhomboid","polygon"]},overlayShape:{enums:["roundrectangle","round-rectangle","ellipse"]},cornerRadius:{number:!0,min:0,units:"px|em",implicitUnits:"px",enums:["auto"]},compoundIncludeLabels:{enums:["include","exclude"]},arrowShape:{enums:["tee","triangle","triangle-tee","circle-triangle","triangle-cross","triangle-backcurve","vee","square","circle","diamond","chevron","none"]},arrowFill:{enums:["filled","hollow"]},arrowWidth:{number:!0,units:"%|px|em",implicitUnits:"px",enums:["match-line"]},display:{enums:["element","none"]},visibility:{enums:["hidden","visible"]},zCompoundDepth:{enums:["bottom","orphan","auto","top"]},zIndexCompare:{enums:["auto","manual"]},valign:{enums:["top","center","bottom"]},halign:{enums:["left","center","right"]},justification:{enums:["left","center","right","auto"]},text:{string:!0},data:{mapping:!0,regex:a("data")},layoutData:{mapping:!0,regex:a("layoutData")},scratch:{mapping:!0,regex:a("scratch")},mapData:{mapping:!0,regex:s("mapData")},mapLayoutData:{mapping:!0,regex:s("mapLayoutData")},mapScratch:{mapping:!0,regex:s("mapScratch")},fn:{mapping:!0,fn:!0},url:{regexes:o,singleRegexMatchValue:!0},urls:{regexes:o,singleRegexMatchValue:!0,multiple:!0},propList:{propList:!0},angle:{number:!0,units:"deg|rad",implicitUnits:"rad"},textRotation:{number:!0,units:"deg|rad",implicitUnits:"rad",enums:["none","autorotate"]},polygonPointList:{number:!0,multiple:!0,evenMultiple:!0,min:-1,max:1,unitless:!0},edgeDistances:{enums:["intersection","node-position","endpoints"]},edgeEndpoint:{number:!0,multiple:!0,units:"%|px|em|deg|rad",implicitUnits:"px",enums:["inside-to-node","outside-to-node","outside-to-node-or-label","outside-to-line","outside-to-line-or-label"],singleEnum:!0,validate:function(me,xe){switch(me.length){case 2:return xe[0]!=="deg"&&xe[0]!=="rad"&&xe[1]!=="deg"&&xe[1]!=="rad";case 1:return Wt(me[0])||xe[0]==="deg"||xe[0]==="rad";default:return!1}}},easing:{regexes:["^(spring)\\s*\\(\\s*("+t+")\\s*,\\s*("+t+")\\s*\\)$","^(cubic-bezier)\\s*\\(\\s*("+t+")\\s*,\\s*("+t+")\\s*,\\s*("+t+")\\s*,\\s*("+t+")\\s*\\)$"],enums:["linear","ease","ease-in","ease-out","ease-in-out","ease-in-sine","ease-out-sine","ease-in-out-sine","ease-in-quad","ease-out-quad","ease-in-out-quad","ease-in-cubic","ease-out-cubic","ease-in-out-cubic","ease-in-quart","ease-out-quart","ease-in-out-quart","ease-in-quint","ease-out-quint","ease-in-out-quint","ease-in-expo","ease-out-expo","ease-in-out-expo","ease-in-circ","ease-out-circ","ease-in-out-circ"]},gradientDirection:{enums:["to-bottom","to-top","to-left","to-right","to-bottom-right","to-bottom-left","to-top-right","to-top-left","to-right-bottom","to-left-bottom","to-right-top","to-left-top"]},boundsExpansion:{number:!0,multiple:!0,min:0,validate:function(me){var xe=me.length;return xe===1||xe===2||xe===4}}};var l={zeroNonZero:function(me,xe){return(me==null||xe==null)&&me!==xe||me==0&&xe!=0?!0:me!=0&&xe==0},any:function(me,xe){return me!=xe},emptyNonEmpty:function(me,xe){var Se=Zd(me),Ve=Zd(xe);return Se&&!Ve||!Se&&Ve}},u=Ii.types,c=[{name:"label",type:u.text,triggersBounds:l.any,triggersZOrder:l.emptyNonEmpty},{name:"text-rotation",type:u.textRotation,triggersBounds:l.any},{name:"text-margin-x",type:u.bidirectionalSize,triggersBounds:l.any},{name:"text-margin-y",type:u.bidirectionalSize,triggersBounds:l.any}],h=[{name:"source-label",type:u.text,triggersBounds:l.any},{name:"source-text-rotation",type:u.textRotation,triggersBounds:l.any},{name:"source-text-margin-x",type:u.bidirectionalSize,triggersBounds:l.any},{name:"source-text-margin-y",type:u.bidirectionalSize,triggersBounds:l.any},{name:"source-text-offset",type:u.size,triggersBounds:l.any}],p=[{name:"target-label",type:u.text,triggersBounds:l.any},{name:"target-text-rotation",type:u.textRotation,triggersBounds:l.any},{name:"target-text-margin-x",type:u.bidirectionalSize,triggersBounds:l.any},{name:"target-text-margin-y",type:u.bidirectionalSize,triggersBounds:l.any},{name:"target-text-offset",type:u.size,triggersBounds:l.any}],v=[{name:"font-family",type:u.fontFamily,triggersBounds:l.any},{name:"font-style",type:u.fontStyle,triggersBounds:l.any},{name:"font-weight",type:u.fontWeight,triggersBounds:l.any},{name:"font-size",type:u.size,triggersBounds:l.any},{name:"text-transform",type:u.textTransform,triggersBounds:l.any},{name:"text-wrap",type:u.textWrap,triggersBounds:l.any},{name:"text-overflow-wrap",type:u.textOverflowWrap,triggersBounds:l.any},{name:"text-max-width",type:u.size,triggersBounds:l.any},{name:"text-outline-width",type:u.size,triggersBounds:l.any},{name:"line-height",type:u.positiveNumber,triggersBounds:l.any}],y=[{name:"text-valign",type:u.valign,triggersBounds:l.any},{name:"text-halign",type:u.halign,triggersBounds:l.any},{name:"color",type:u.color},{name:"text-outline-color",type:u.color},{name:"text-outline-opacity",type:u.zeroOneNumber},{name:"text-background-color",type:u.color},{name:"text-background-opacity",type:u.zeroOneNumber},{name:"text-background-padding",type:u.size,triggersBounds:l.any},{name:"text-border-opacity",type:u.zeroOneNumber},{name:"text-border-color",type:u.color},{name:"text-border-width",type:u.size,triggersBounds:l.any},{name:"text-border-style",type:u.borderStyle,triggersBounds:l.any},{name:"text-background-shape",type:u.textBackgroundShape,triggersBounds:l.any},{name:"text-justification",type:u.justification},{name:"box-select-labels",type:u.bool,triggersBounds:l.any}],S=[{name:"events",type:u.bool,triggersZOrder:l.any},{name:"text-events",type:u.bool,triggersZOrder:l.any},{name:"box-selection",type:u.boxSelection,triggersZOrder:l.any}],w=[{name:"display",type:u.display,triggersZOrder:l.any,triggersBounds:l.any,triggersBoundsOfConnectedEdges:l.any,triggersBoundsOfParallelEdges:function(me,xe,Se){return me===xe?!1:Se.pstyle("curve-style").value==="bezier"}},{name:"visibility",type:u.visibility,triggersZOrder:l.any},{name:"opacity",type:u.zeroOneNumber,triggersZOrder:l.zeroNonZero},{name:"text-opacity",type:u.zeroOneNumber},{name:"min-zoomed-font-size",type:u.size},{name:"z-compound-depth",type:u.zCompoundDepth,triggersZOrder:l.any},{name:"z-index-compare",type:u.zIndexCompare,triggersZOrder:l.any},{name:"z-index",type:u.number,triggersZOrder:l.any}],T=[{name:"overlay-padding",type:u.size,triggersBounds:l.any},{name:"overlay-color",type:u.color},{name:"overlay-opacity",type:u.zeroOneNumber,triggersBounds:l.zeroNonZero},{name:"overlay-shape",type:u.overlayShape,triggersBounds:l.any},{name:"overlay-corner-radius",type:u.cornerRadius}],_=[{name:"underlay-padding",type:u.size,triggersBounds:l.any},{name:"underlay-color",type:u.color},{name:"underlay-opacity",type:u.zeroOneNumber,triggersBounds:l.zeroNonZero},{name:"underlay-shape",type:u.overlayShape,triggersBounds:l.any},{name:"underlay-corner-radius",type:u.cornerRadius}],C=[{name:"transition-property",type:u.propList},{name:"transition-duration",type:u.time},{name:"transition-delay",type:u.time},{name:"transition-timing-function",type:u.easing}],N=function(me,xe){return xe.value==="label"?-me.poolIndex():xe.pfValue},A=[{name:"height",type:u.nodeSize,triggersBounds:l.any,hashOverride:N},{name:"width",type:u.nodeSize,triggersBounds:l.any,hashOverride:N},{name:"shape",type:u.nodeShape,triggersBounds:l.any},{name:"shape-polygon-points",type:u.polygonPointList,triggersBounds:l.any},{name:"corner-radius",type:u.cornerRadius},{name:"background-color",type:u.color},{name:"background-fill",type:u.fill},{name:"background-opacity",type:u.zeroOneNumber},{name:"background-blacken",type:u.nOneOneNumber},{name:"background-gradient-stop-colors",type:u.colors},{name:"background-gradient-stop-positions",type:u.percentages},{name:"background-gradient-direction",type:u.gradientDirection},{name:"padding",type:u.sizeMaybePercent,triggersBounds:l.any},{name:"padding-relative-to",type:u.paddingRelativeTo,triggersBounds:l.any},{name:"bounds-expansion",type:u.boundsExpansion,triggersBounds:l.any}],I=[{name:"border-color",type:u.color},{name:"border-opacity",type:u.zeroOneNumber},{name:"border-width",type:u.size,triggersBounds:l.any},{name:"border-style",type:u.borderStyle},{name:"border-cap",type:u.lineCap},{name:"border-join",type:u.lineJoin},{name:"border-dash-pattern",type:u.numbers},{name:"border-dash-offset",type:u.number},{name:"border-position",type:u.linePosition}],j=[{name:"outline-color",type:u.color},{name:"outline-opacity",type:u.zeroOneNumber},{name:"outline-width",type:u.size,triggersBounds:l.any},{name:"outline-style",type:u.borderStyle},{name:"outline-offset",type:u.size,triggersBounds:l.any}],O=[{name:"background-image",type:u.urls},{name:"background-image-crossorigin",type:u.bgCrossOrigin},{name:"background-image-opacity",type:u.zeroOneNumbers},{name:"background-image-containment",type:u.bgContainment},{name:"background-image-smoothing",type:u.bools},{name:"background-position-x",type:u.bgPos},{name:"background-position-y",type:u.bgPos},{name:"background-width-relative-to",type:u.bgRelativeTo},{name:"background-height-relative-to",type:u.bgRelativeTo},{name:"background-repeat",type:u.bgRepeat},{name:"background-fit",type:u.bgFit},{name:"background-clip",type:u.bgClip},{name:"background-width",type:u.bgWH},{name:"background-height",type:u.bgWH},{name:"background-offset-x",type:u.bgPos},{name:"background-offset-y",type:u.bgPos}],F=[{name:"position",type:u.position,triggersBounds:l.any},{name:"compound-sizing-wrt-labels",type:u.compoundIncludeLabels,triggersBounds:l.any},{name:"min-width",type:u.size,triggersBounds:l.any},{name:"min-width-bias-left",type:u.sizeMaybePercent,triggersBounds:l.any},{name:"min-width-bias-right",type:u.sizeMaybePercent,triggersBounds:l.any},{name:"min-height",type:u.size,triggersBounds:l.any},{name:"min-height-bias-top",type:u.sizeMaybePercent,triggersBounds:l.any},{name:"min-height-bias-bottom",type:u.sizeMaybePercent,triggersBounds:l.any}],B=[{name:"line-style",type:u.lineStyle},{name:"line-color",type:u.color},{name:"line-fill",type:u.fill},{name:"line-cap",type:u.lineCap},{name:"line-opacity",type:u.zeroOneNumber},{name:"line-dash-pattern",type:u.numbers},{name:"line-dash-offset",type:u.number},{name:"line-outline-width",type:u.size},{name:"line-outline-color",type:u.color},{name:"line-gradient-stop-colors",type:u.colors},{name:"line-gradient-stop-positions",type:u.percentages},{name:"curve-style",type:u.curveStyle,triggersBounds:l.any,triggersBoundsOfParallelEdges:function(me,xe){return me===xe?!1:me==="bezier"||xe==="bezier"}},{name:"haystack-radius",type:u.zeroOneNumber,triggersBounds:l.any},{name:"source-endpoint",type:u.edgeEndpoint,triggersBounds:l.any},{name:"target-endpoint",type:u.edgeEndpoint,triggersBounds:l.any},{name:"control-point-step-size",type:u.size,triggersBounds:l.any},{name:"control-point-distances",type:u.bidirectionalSizes,triggersBounds:l.any},{name:"control-point-weights",type:u.numbers,triggersBounds:l.any},{name:"segment-distances",type:u.bidirectionalSizes,triggersBounds:l.any},{name:"segment-weights",type:u.numbers,triggersBounds:l.any},{name:"segment-radii",type:u.numbers,triggersBounds:l.any},{name:"radius-type",type:u.radiusType,triggersBounds:l.any},{name:"taxi-turn",type:u.bidirectionalSizeMaybePercent,triggersBounds:l.any},{name:"taxi-turn-min-distance",type:u.size,triggersBounds:l.any},{name:"taxi-direction",type:u.axisDirection,triggersBounds:l.any},{name:"taxi-radius",type:u.number,triggersBounds:l.any},{name:"edge-distances",type:u.edgeDistances,triggersBounds:l.any},{name:"arrow-scale",type:u.positiveNumber,triggersBounds:l.any},{name:"loop-direction",type:u.angle,triggersBounds:l.any},{name:"loop-sweep",type:u.angle,triggersBounds:l.any},{name:"source-distance-from-node",type:u.size,triggersBounds:l.any},{name:"target-distance-from-node",type:u.size,triggersBounds:l.any}],$=[{name:"ghost",type:u.bool,triggersBounds:l.any},{name:"ghost-offset-x",type:u.bidirectionalSize,triggersBounds:l.any},{name:"ghost-offset-y",type:u.bidirectionalSize,triggersBounds:l.any},{name:"ghost-opacity",type:u.zeroOneNumber}],Z=[{name:"selection-box-color",type:u.color},{name:"selection-box-opacity",type:u.zeroOneNumber},{name:"selection-box-border-color",type:u.color},{name:"selection-box-border-width",type:u.size},{name:"active-bg-color",type:u.color},{name:"active-bg-opacity",type:u.zeroOneNumber},{name:"active-bg-size",type:u.size},{name:"outside-texture-bg-color",type:u.color},{name:"outside-texture-bg-opacity",type:u.zeroOneNumber}],D=[];Ii.pieBackgroundN=16,D.push({name:"pie-size",type:u.sizeMaybePercent}),D.push({name:"pie-hole",type:u.sizeMaybePercent}),D.push({name:"pie-start-angle",type:u.angle});for(var H=1;H<=Ii.pieBackgroundN;H++)D.push({name:"pie-"+H+"-background-color",type:u.color}),D.push({name:"pie-"+H+"-background-size",type:u.percent}),D.push({name:"pie-"+H+"-background-opacity",type:u.zeroOneNumber});var U=[];Ii.stripeBackgroundN=16,U.push({name:"stripe-size",type:u.sizeMaybePercent}),U.push({name:"stripe-direction",type:u.axisDirectionPrimary});for(var W=1;W<=Ii.stripeBackgroundN;W++)U.push({name:"stripe-"+W+"-background-color",type:u.color}),U.push({name:"stripe-"+W+"-background-size",type:u.percent}),U.push({name:"stripe-"+W+"-background-opacity",type:u.zeroOneNumber});var Y=[],Q=Ii.arrowPrefixes=["source","mid-source","target","mid-target"];[{name:"arrow-shape",type:u.arrowShape,triggersBounds:l.any},{name:"arrow-color",type:u.color},{name:"arrow-fill",type:u.arrowFill},{name:"arrow-width",type:u.arrowWidth}].forEach(function(pe){Q.forEach(function(me){var xe=me+"-"+pe.name,Se=pe.type,Ve=pe.triggersBounds;Y.push({name:xe,type:Se,triggersBounds:Ve})})},{});var ne=Ii.properties=[].concat(S,C,w,T,_,$,y,v,c,h,p,A,I,j,O,D,U,F,B,Y,Z),re=Ii.propertyGroups={behavior:S,transition:C,visibility:w,overlay:T,underlay:_,ghost:$,commonLabel:y,labelDimensions:v,mainLabel:c,sourceLabel:h,targetLabel:p,nodeBody:A,nodeBorder:I,nodeOutline:j,backgroundImage:O,pie:D,stripe:U,compound:F,edgeLine:B,edgeArrow:Y,core:Z},q=Ii.propertyGroupNames={},te=Ii.propertyGroupKeys=Object.keys(re);te.forEach(function(pe){q[pe]=re[pe].map(function(me){return me.name}),re[pe].forEach(function(me){return me.groupKey=pe})});var ae=Ii.aliases=[{name:"content",pointsTo:"label"},{name:"control-point-distance",pointsTo:"control-point-distances"},{name:"control-point-weight",pointsTo:"control-point-weights"},{name:"segment-distance",pointsTo:"segment-distances"},{name:"segment-weight",pointsTo:"segment-weights"},{name:"segment-radius",pointsTo:"segment-radii"},{name:"edge-text-rotation",pointsTo:"text-rotation"},{name:"padding-left",pointsTo:"padding"},{name:"padding-right",pointsTo:"padding"},{name:"padding-top",pointsTo:"padding"},{name:"padding-bottom",pointsTo:"padding"}];Ii.propertyNames=ne.map(function(pe){return pe.name});for(var de=0;de<ne.length;de++){var ge=ne[de];ne[ge.name]=ge}for(var ye=0;ye<ae.length;ye++){var se=ae[ye],fe=ne[se.pointsTo],le={name:se.name,alias:!0,pointsTo:fe};ne.push(le),ne[se.name]=le}})();Ii.getDefaultProperty=function(t){return this.getDefaultProperties()[t]};Ii.getDefaultProperties=function(){var t=this._private;if(t.defaultProperties!=null)return t.defaultProperties;for(var e=er({"selection-box-color":"#ddd","selection-box-opacity":.65,"selection-box-border-color":"#aaa","selection-box-border-width":1,"active-bg-color":"black","active-bg-opacity":.15,"active-bg-size":30,"outside-texture-bg-color":"#000","outside-texture-bg-opacity":.125,events:"yes","text-events":"no","text-valign":"top","text-halign":"center","text-justification":"auto","line-height":1,color:"#000","box-selection":"contain","text-outline-color":"#000","text-outline-width":0,"text-outline-opacity":1,"text-opacity":1,"text-decoration":"none","text-transform":"none","text-wrap":"none","text-overflow-wrap":"whitespace","text-max-width":9999,"text-background-color":"#000","text-background-opacity":0,"text-background-shape":"rectangle","text-background-padding":0,"text-border-opacity":0,"text-border-width":0,"text-border-style":"solid","text-border-color":"#000","font-family":"Helvetica Neue, Helvetica, sans-serif","font-style":"normal","font-weight":"normal","font-size":16,"min-zoomed-font-size":0,"text-rotation":"none","source-text-rotation":"none","target-text-rotation":"none",visibility:"visible",display:"element",opacity:1,"z-compound-depth":"auto","z-index-compare":"auto","z-index":0,label:"","text-margin-x":0,"text-margin-y":0,"source-label":"","source-text-offset":0,"source-text-margin-x":0,"source-text-margin-y":0,"target-label":"","target-text-offset":0,"target-text-margin-x":0,"target-text-margin-y":0,"overlay-opacity":0,"overlay-color":"#000","overlay-padding":10,"overlay-shape":"round-rectangle","overlay-corner-radius":"auto","underlay-opacity":0,"underlay-color":"#000","underlay-padding":10,"underlay-shape":"round-rectangle","underlay-corner-radius":"auto","transition-property":"none","transition-duration":0,"transition-delay":0,"transition-timing-function":"linear","box-select-labels":"no","background-blacken":0,"background-color":"#999","background-fill":"solid","background-opacity":1,"background-image":"none","background-image-crossorigin":"anonymous","background-image-opacity":1,"background-image-containment":"inside","background-image-smoothing":"yes","background-position-x":"50%","background-position-y":"50%","background-offset-x":0,"background-offset-y":0,"background-width-relative-to":"include-padding","background-height-relative-to":"include-padding","background-repeat":"no-repeat","background-fit":"none","background-clip":"node","background-width":"auto","background-height":"auto","border-color":"#000","border-opacity":1,"border-width":0,"border-style":"solid","border-dash-pattern":[4,2],"border-dash-offset":0,"border-cap":"butt","border-join":"miter","border-position":"center","outline-color":"#999","outline-opacity":1,"outline-width":0,"outline-offset":0,"outline-style":"solid",height:30,width:30,shape:"ellipse","shape-polygon-points":"-1, -1,   1, -1,   1, 1,   -1, 1","corner-radius":"auto","bounds-expansion":0,"background-gradient-direction":"to-bottom","background-gradient-stop-colors":"#999","background-gradient-stop-positions":"0%",ghost:"no","ghost-offset-y":0,"ghost-offset-x":0,"ghost-opacity":0,padding:0,"padding-relative-to":"width",position:"origin","compound-sizing-wrt-labels":"include","min-width":0,"min-width-bias-left":0,"min-width-bias-right":0,"min-height":0,"min-height-bias-top":0,"min-height-bias-bottom":0},{"pie-size":"100%","pie-hole":0,"pie-start-angle":"0deg"},[{name:"pie-{{i}}-background-color",value:"black"},{name:"pie-{{i}}-background-size",value:"0%"},{name:"pie-{{i}}-background-opacity",value:1}].reduce(function(l,u){for(var c=1;c<=Ii.pieBackgroundN;c++){var h=u.name.replace("{{i}}",c),p=u.value;l[h]=p}return l},{}),{"stripe-size":"100%","stripe-direction":"horizontal"},[{name:"stripe-{{i}}-background-color",value:"black"},{name:"stripe-{{i}}-background-size",value:"0%"},{name:"stripe-{{i}}-background-opacity",value:1}].reduce(function(l,u){for(var c=1;c<=Ii.stripeBackgroundN;c++){var h=u.name.replace("{{i}}",c),p=u.value;l[h]=p}return l},{}),{"line-style":"solid","line-color":"#999","line-fill":"solid","line-cap":"butt","line-opacity":1,"line-outline-width":0,"line-outline-color":"#000","line-gradient-stop-colors":"#999","line-gradient-stop-positions":"0%","control-point-step-size":40,"control-point-weights":.5,"segment-weights":.5,"segment-distances":20,"segment-radii":15,"radius-type":"arc-radius","taxi-turn":"50%","taxi-radius":15,"taxi-turn-min-distance":10,"taxi-direction":"auto","edge-distances":"intersection","curve-style":"haystack","haystack-radius":0,"arrow-scale":1,"loop-direction":"-45deg","loop-sweep":"-90deg","source-distance-from-node":0,"target-distance-from-node":0,"source-endpoint":"outside-to-node","target-endpoint":"outside-to-node","line-dash-pattern":[6,3],"line-dash-offset":0},[{name:"arrow-shape",value:"none"},{name:"arrow-color",value:"#999"},{name:"arrow-fill",value:"filled"},{name:"arrow-width",value:1}].reduce(function(l,u){return Ii.arrowPrefixes.forEach(function(c){var h=c+"-"+u.name,p=u.value;l[h]=p}),l},{})),r={},n=0;n<this.properties.length;n++){var i=this.properties[n];if(!i.pointsTo){var a=i.name,s=e[a],o=this.parse(a,s);r[a]=o}}return t.defaultProperties=r,t.defaultProperties};Ii.addDefaultStylesheet=function(){this.selector(":parent").css({shape:"rectangle",padding:10,"background-color":"#eee","border-color":"#ccc","border-width":1}).selector("edge").css({width:3}).selector(":loop").css({"curve-style":"bezier"}).selector("edge:compound").css({"curve-style":"bezier","source-endpoint":"outside-to-line","target-endpoint":"outside-to-line"}).selector(":selected").css({"background-color":"#0169D9","line-color":"#0169D9","source-arrow-color":"#0169D9","target-arrow-color":"#0169D9","mid-source-arrow-color":"#0169D9","mid-target-arrow-color":"#0169D9"}).selector(":parent:selected").css({"background-color":"#CCE1F9","border-color":"#aec8e5"}).selector(":active").css({"overlay-color":"black","overlay-padding":10,"overlay-opacity":.25}),this.defaultLength=this.length};var O1={};O1.parse=function(t,e,r,n){var i=this;if(ni(e))return i.parseImplWarn(t,e,r,n);var a=n==="mapping"||n===!0||n===!1||n==null?"dontcare":n,s=r?"t":"f",o=""+e,l=HM(t,o,s,a),u=i.propCache=i.propCache||[],c;return(c=u[l])||(c=u[l]=i.parseImplWarn(t,e,r,n)),(r||n==="mapping")&&(c=ku(c),c&&(c.value=ku(c.value))),c};O1.parseImplWarn=function(t,e,r,n){var i=this.parseImpl(t,e,r,n);return!i&&e!=null&&rn("The style property `".concat(t,": ").concat(e,"` is invalid")),i&&(i.name==="width"||i.name==="height")&&e==="label"&&rn("The style value of `label` is deprecated for `"+i.name+"`"),i};O1.parseImpl=function(t,e,r,n){var i=this;t=Qk(t);var a=i.properties[t],s=e,o=i.types;if(!a||e===void 0)return null;a.alias&&(a=a.pointsTo,t=a.name);var l=Wt(e);l&&(e=e.trim());var u=a.type;if(!u)return null;if(r&&(e===""||e===null))return{name:t,value:e,bypass:!0,deleteBypass:!0};if(ni(e))return{name:t,value:e,strValue:"fn",mapped:o.fn,bypass:r};var c,h;if(!(!l||n||e.length<7||e[1]!=="a")){if(e.length>=7&&e[0]==="d"&&(c=new RegExp(o.data.regex).exec(e))){if(r)return!1;var p=o.data;return{name:t,value:c,strValue:""+e,mapped:p,field:c[1],bypass:r}}else if(e.length>=10&&e[0]==="m"&&(h=new RegExp(o.mapData.regex).exec(e))){if(r||u.multiple)return!1;var v=o.mapData;if(!(u.color||u.number))return!1;var y=this.parse(t,h[4]);if(!y||y.mapped)return!1;var S=this.parse(t,h[5]);if(!S||S.mapped)return!1;if(y.pfValue===S.pfValue||y.strValue===S.strValue)return rn("`"+t+": "+e+"` is not a valid mapper because the output range is zero; converting to `"+t+": "+y.strValue+"`"),this.parse(t,y.strValue);if(u.color){var w=y.value,T=S.value,_=w[0]===T[0]&&w[1]===T[1]&&w[2]===T[2]&&(w[3]===T[3]||(w[3]==null||w[3]===1)&&(T[3]==null||T[3]===1));if(_)return!1}return{name:t,value:h,strValue:""+e,mapped:v,field:h[1],fieldMin:parseFloat(h[2]),fieldMax:parseFloat(h[3]),valueMin:y.value,valueMax:S.value,bypass:r}}}if(u.multiple&&n!=="multiple"){var C;if(l?C=e.split(/\s+/):xn(e)?C=e:C=[e],u.evenMultiple&&C.length%2!==0)return null;for(var N=[],A=[],I=[],j="",O=!1,F=0;F<C.length;F++){var B=i.parse(t,C[F],r,"multiple");O=O||Wt(B.value),N.push(B.value),I.push(B.pfValue!=null?B.pfValue:B.value),A.push(B.units),j+=(F>0?" ":"")+B.strValue}return u.validate&&!u.validate(N,A)?null:u.singleEnum&&O?N.length===1&&Wt(N[0])?{name:t,value:N[0],strValue:N[0],bypass:r}:null:{name:t,value:N,pfValue:I,strValue:j,bypass:r,units:A}}var $=function(){for(var le=0;le<u.enums.length;le++){var pe=u.enums[le];if(pe===e)return{name:t,value:e,strValue:""+e,bypass:r}}return null};if(u.number){var Z,D="px";if(u.units&&(Z=u.units),u.implicitUnits&&(D=u.implicitUnits),!u.unitless)if(l){var H="px|em"+(u.allowPercent?"|\\%":"");Z&&(H=Z);var U=e.match("^("+Ki+")("+H+")?$");U&&(e=U[1],Z=U[2]||D)}else(!Z||u.implicitUnits)&&(Z=D);if(e=parseFloat(e),isNaN(e)&&u.enums===void 0)return null;if(isNaN(e)&&u.enums!==void 0)return e=s,$();if(u.integer&&!Dj(e)||u.min!==void 0&&(e<u.min||u.strictMin&&e===u.min)||u.max!==void 0&&(e>u.max||u.strictMax&&e===u.max))return null;var W={name:t,value:e,strValue:""+e+(Z||""),units:Z,bypass:r};return u.unitless||Z!=="px"&&Z!=="em"?W.pfValue=e:W.pfValue=Z==="px"||!Z?e:this.getEmSizeInPixels()*e,(Z==="ms"||Z==="s")&&(W.pfValue=Z==="ms"?e:1e3*e),(Z==="deg"||Z==="rad")&&(W.pfValue=Z==="rad"?e:W9(e)),Z==="%"&&(W.pfValue=e/100),W}else if(u.propList){var Y=[],Q=""+e;if(Q!=="none"){for(var ne=Q.split(/\s*,\s*|\s+/),re=0;re<ne.length;re++){var q=ne[re].trim();i.properties[q]?Y.push(q):rn("`"+q+"` is not a valid property name")}if(Y.length===0)return null}return{name:t,value:Y,strValue:Y.length===0?"none":Y.join(" "),bypass:r}}else if(u.color){var te=jM(e);return te?{name:t,value:te,pfValue:te,strValue:"rgb("+te[0]+","+te[1]+","+te[2]+")",bypass:r}:null}else if(u.regex||u.regexes){if(u.enums){var ae=$();if(ae)return ae}for(var de=u.regexes?u.regexes:[u.regex],ge=0;ge<de.length;ge++){var ye=new RegExp(de[ge]),se=ye.exec(e);if(se)return{name:t,value:u.singleRegexMatchValue?se[1]:se,strValue:""+e,bypass:r}}return null}else return u.string?{name:t,value:""+e,strValue:""+e,bypass:r}:u.enums?$():null};var ya=function(e){if(!(this instanceof ya))return new ya(e);if(!Xk(e)){Kn("A style must have a core reference");return}this._private={cy:e,coreStyle:{}},this.length=0,this.resetToDefault()},cs=ya.prototype;cs.instanceString=function(){return"style"};cs.clear=function(){for(var t=this._private,e=t.cy,r=e.elements(),n=0;n<this.length;n++)this[n]=void 0;return this.length=0,t.contextStyles={},t.propDiffs={},this.cleanElements(r,!0),r.forEach(function(i){var a=i[0]._private;a.styleDirty=!0,a.appliedInitStyle=!1}),this};cs.resetToDefault=function(){return this.clear(),this.addDefaultStylesheet(),this};cs.core=function(t){return this._private.coreStyle[t]||this.getDefaultProperty(t)};cs.selector=function(t){var e=t==="core"?null:new Qd(t),r=this.length++;return this[r]={selector:e,properties:[],mappedProperties:[],index:r},this};cs.css=function(){var t=this,e=arguments;if(e.length===1)for(var r=e[0],n=0;n<t.properties.length;n++){var i=t.properties[n],a=r[i.name];a===void 0&&(a=r[b1(i.name)]),a!==void 0&&this.cssRule(i.name,a)}else e.length===2&&this.cssRule(e[0],e[1]);return this};cs.style=cs.css;cs.cssRule=function(t,e){var r=this.parse(t,e);if(r){var n=this.length-1;this[n].properties.push(r),this[n].properties[r.name]=r,r.name.match(/pie-(\d+)-background-size/)&&r.value&&(this._private.hasPie=!0),r.name.match(/stripe-(\d+)-background-size/)&&r.value&&(this._private.hasStripe=!0),r.mapped&&this[n].mappedProperties.push(r);var i=!this[n].selector;i&&(this._private.coreStyle[r.name]=r)}return this};cs.append=function(t){return OM(t)?t.appendToStyle(this):xn(t)?this.appendFromJson(t):Wt(t)&&this.appendFromString(t),this};ya.fromJson=function(t,e){var r=new ya(t);return r.fromJson(e),r};ya.fromString=function(t,e){return new ya(t).fromString(e)};[wa,t0,f_,Tu,L1,p_,Ii,O1].forEach(function(t){er(cs,t)});ya.types=cs.types;ya.properties=cs.properties;ya.propertyGroups=cs.propertyGroups;ya.propertyGroupNames=cs.propertyGroupNames;ya.propertyGroupKeys=cs.propertyGroupKeys;var Z7={style:function(e){if(e){var r=this.setStyle(e);r.update()}return this._private.style},setStyle:function(e){var r=this._private;return OM(e)?r.style=e.generateStyle(this):xn(e)?r.style=ya.fromJson(this,e):Wt(e)?r.style=ya.fromString(this,e):r.style=ya(this),r.style},updateStyle:function(){this.mutableElements().updateStyle()}},Y7="single",vf={autolock:function(e){if(e!==void 0)this._private.autolock=!!e;else return this._private.autolock;return this},autoungrabify:function(e){if(e!==void 0)this._private.autoungrabify=!!e;else return this._private.autoungrabify;return this},autounselectify:function(e){if(e!==void 0)this._private.autounselectify=!!e;else return this._private.autounselectify;return this},selectionType:function(e){var r=this._private;if(r.selectionType==null&&(r.selectionType=Y7),e!==void 0)(e==="additive"||e==="single")&&(r.selectionType=e);else return r.selectionType;return this},panningEnabled:function(e){if(e!==void 0)this._private.panningEnabled=!!e;else return this._private.panningEnabled;return this},userPanningEnabled:function(e){if(e!==void 0)this._private.userPanningEnabled=!!e;else return this._private.userPanningEnabled;return this},zoomingEnabled:function(e){if(e!==void 0)this._private.zoomingEnabled=!!e;else return this._private.zoomingEnabled;return this},userZoomingEnabled:function(e){if(e!==void 0)this._private.userZoomingEnabled=!!e;else return this._private.userZoomingEnabled;return this},boxSelectionEnabled:function(e){if(e!==void 0)this._private.boxSelectionEnabled=!!e;else return this._private.boxSelectionEnabled;return this},pan:function(){var e=arguments,r=this._private.pan,n,i,a,s,o;switch(e.length){case 0:return r;case 1:if(Wt(e[0]))return n=e[0],r[n];if(Fr(e[0])){if(!this._private.panningEnabled)return this;a=e[0],s=a.x,o=a.y,bt(s)&&(r.x=s),bt(o)&&(r.y=o),this.emit("pan viewport")}break;case 2:if(!this._private.panningEnabled)return this;n=e[0],i=e[1],(n==="x"||n==="y")&&bt(i)&&(r[n]=i),this.emit("pan viewport");break}return this.notify("viewport"),this},panBy:function(e,r){var n=arguments,i=this._private.pan,a,s,o,l,u;if(!this._private.panningEnabled)return this;switch(n.length){case 1:Fr(e)&&(o=n[0],l=o.x,u=o.y,bt(l)&&(i.x+=l),bt(u)&&(i.y+=u),this.emit("pan viewport"));break;case 2:a=e,s=r,(a==="x"||a==="y")&&bt(s)&&(i[a]+=s),this.emit("pan viewport");break}return this.notify("viewport"),this},gc:function(){this.notify("gc")},fit:function(e,r){var n=this.getFitViewport(e,r);if(n){var i=this._private;i.zoom=n.zoom,i.pan=n.pan,this.emit("pan zoom viewport"),this.notify("viewport")}return this},getFitViewport:function(e,r){if(bt(e)&&r===void 0&&(r=e,e=void 0),!(!this._private.panningEnabled||!this._private.zoomingEnabled)){var n;if(Wt(e)){var i=e;e=this.$(i)}else if(Fj(e)){var a=e;n={x1:a.x1,y1:a.y1,x2:a.x2,y2:a.y2},n.w=n.x2-n.x1,n.h=n.y2-n.y1}else po(e)||(e=this.mutableElements());if(!(po(e)&&e.empty())){n=n||e.boundingBox();var s=this.width(),o=this.height(),l;if(r=bt(r)?r:0,!isNaN(s)&&!isNaN(o)&&s>0&&o>0&&!isNaN(n.w)&&!isNaN(n.h)&&n.w>0&&n.h>0){l=Math.min((s-2*r)/n.w,(o-2*r)/n.h),l=l>this._private.maxZoom?this._private.maxZoom:l,l=l<this._private.minZoom?this._private.minZoom:l;var u={x:(s-l*(n.x1+n.x2))/2,y:(o-l*(n.y1+n.y2))/2};return{zoom:l,pan:u}}}}},zoomRange:function(e,r){var n=this._private;if(r==null){var i=e;e=i.min,r=i.max}return bt(e)&&bt(r)&&e<=r?(n.minZoom=e,n.maxZoom=r):bt(e)&&r===void 0&&e<=n.maxZoom?n.minZoom=e:bt(r)&&e===void 0&&r>=n.minZoom&&(n.maxZoom=r),this},minZoom:function(e){return e===void 0?this._private.minZoom:this.zoomRange({min:e})},maxZoom:function(e){return e===void 0?this._private.maxZoom:this.zoomRange({max:e})},getZoomedViewport:function(e){var r=this._private,n=r.pan,i=r.zoom,a,s,o=!1;if(r.zoomingEnabled||(o=!0),bt(e)?s=e:Fr(e)&&(s=e.level,e.position!=null?a=k1(e.position,i,n):e.renderedPosition!=null&&(a=e.renderedPosition),a!=null&&!r.panningEnabled&&(o=!0)),s=s>r.maxZoom?r.maxZoom:s,s=s<r.minZoom?r.minZoom:s,o||!bt(s)||s===i||a!=null&&(!bt(a.x)||!bt(a.y)))return null;if(a!=null){var l=n,u=i,c=s,h={x:-c/u*(a.x-l.x)+a.x,y:-c/u*(a.y-l.y)+a.y};return{zoomed:!0,panned:!0,zoom:c,pan:h}}else return{zoomed:!0,panned:!1,zoom:s,pan:n}},zoom:function(e){if(e===void 0)return this._private.zoom;var r=this.getZoomedViewport(e),n=this._private;return r==null||!r.zoomed?this:(n.zoom=r.zoom,r.panned&&(n.pan.x=r.pan.x,n.pan.y=r.pan.y),this.emit("zoom"+(r.panned?" pan":"")+" viewport"),this.notify("viewport"),this)},viewport:function(e){var r=this._private,n=!0,i=!0,a=[],s=!1,o=!1;if(!e)return this;if(bt(e.zoom)||(n=!1),Fr(e.pan)||(i=!1),!n&&!i)return this;if(n){var l=e.zoom;l<r.minZoom||l>r.maxZoom||!r.zoomingEnabled?s=!0:(r.zoom=l,a.push("zoom"))}if(i&&(!s||!e.cancelOnFailedZoom)&&r.panningEnabled){var u=e.pan;bt(u.x)&&(r.pan.x=u.x,o=!1),bt(u.y)&&(r.pan.y=u.y,o=!1),o||a.push("pan")}return a.length>0&&(a.push("viewport"),this.emit(a.join(" ")),this.notify("viewport")),this},center:function(e){var r=this.getCenterPan(e);return r&&(this._private.pan=r,this.emit("pan viewport"),this.notify("viewport")),this},getCenterPan:function(e,r){if(this._private.panningEnabled){if(Wt(e)){var n=e;e=this.mutableElements().filter(n)}else po(e)||(e=this.mutableElements());if(e.length!==0){var i=e.boundingBox(),a=this.width(),s=this.height();r=r===void 0?this._private.zoom:r;var o={x:(a-r*(i.x1+i.x2))/2,y:(s-r*(i.y1+i.y2))/2};return o}}},reset:function(){return!this._private.panningEnabled||!this._private.zoomingEnabled?this:(this.viewport({pan:{x:0,y:0},zoom:1}),this)},invalidateSize:function(){this._private.sizeCache=null},size:function(){var e=this._private,r=e.container,n=this;return e.sizeCache=e.sizeCache||(r?(function(){var i=n.window().getComputedStyle(r),a=function(o){return parseFloat(i.getPropertyValue(o))};return{width:r.clientWidth-a("padding-left")-a("padding-right"),height:r.clientHeight-a("padding-top")-a("padding-bottom")}})():{width:1,height:1})},width:function(){return this.size().width},height:function(){return this.size().height},extent:function(){var e=this._private.pan,r=this._private.zoom,n=this.renderedExtent(),i={x1:(n.x1-e.x)/r,x2:(n.x2-e.x)/r,y1:(n.y1-e.y)/r,y2:(n.y2-e.y)/r};return i.w=i.x2-i.x1,i.h=i.y2-i.y1,i},renderedExtent:function(){var e=this.width(),r=this.height();return{x1:0,y1:0,x2:e,y2:r,w:e,h:r}},multiClickDebounceTime:function(e){if(e)this._private.multiClickDebounceTime=e;else return this._private.multiClickDebounceTime;return this}};vf.centre=vf.center;vf.autolockNodes=vf.autolock;vf.autoungrabifyNodes=vf.autoungrabify;var Cv={data:tn.data({field:"data",bindingEvent:"data",allowBinding:!0,allowSetting:!0,settingEvent:"data",settingTriggersEvent:!0,triggerFnName:"trigger",allowGetting:!0,updateStyle:!0}),removeData:tn.removeData({field:"data",event:"data",triggerFnName:"trigger",triggerEvent:!0,updateStyle:!0}),scratch:tn.data({field:"scratch",bindingEvent:"scratch",allowBinding:!0,allowSetting:!0,settingEvent:"scratch",settingTriggersEvent:!0,triggerFnName:"trigger",allowGetting:!0,updateStyle:!0}),removeScratch:tn.removeData({field:"scratch",event:"scratch",triggerFnName:"trigger",triggerEvent:!0,updateStyle:!0})};Cv.attr=Cv.data;Cv.removeAttr=Cv.removeData;var Ev=function(e){var r=this;e=er({},e);var n=e.container;n&&!ix(n)&&ix(n[0])&&(n=n[0]);var i=n?n._cyreg:null;i=i||{},i&&i.cy&&(i.cy.destroy(),i={});var a=i.readies=i.readies||[];n&&(n._cyreg=i),i.cy=r;var s=$i!==void 0&&n!==void 0&&!e.headless,o=e;o.layout=er({name:s?"grid":"null"},o.layout),o.renderer=er({name:s?"canvas":"null"},o.renderer);var l=function(y,S,w){return S!==void 0?S:w!==void 0?w:y},u=this._private={container:n,ready:!1,options:o,elements:new Va(this),listeners:[],aniEles:new Va(this),data:o.data||{},scratch:{},layout:null,renderer:null,destroyed:!1,notificationsEnabled:!0,minZoom:1e-50,maxZoom:1e50,zoomingEnabled:l(!0,o.zoomingEnabled),userZoomingEnabled:l(!0,o.userZoomingEnabled),panningEnabled:l(!0,o.panningEnabled),userPanningEnabled:l(!0,o.userPanningEnabled),boxSelectionEnabled:l(!0,o.boxSelectionEnabled),autolock:l(!1,o.autolock,o.autolockNodes),autoungrabify:l(!1,o.autoungrabify,o.autoungrabifyNodes),autounselectify:l(!1,o.autounselectify),styleEnabled:o.styleEnabled===void 0?s:o.styleEnabled,zoom:bt(o.zoom)?o.zoom:1,pan:{x:Fr(o.pan)&&bt(o.pan.x)?o.pan.x:0,y:Fr(o.pan)&&bt(o.pan.y)?o.pan.y:0},animation:{current:[],queue:[]},hasCompoundNodes:!1,multiClickDebounceTime:l(250,o.multiClickDebounceTime)};this.createEmitter(),this.selectionType(o.selectionType),this.zoomRange({min:o.minZoom,max:o.maxZoom});var c=function(y,S){var w=y.some(Bj);if(w)return cm.all(y).then(S);S(y)};u.styleEnabled&&r.setStyle([]);var h=er({},o,o.renderer);r.initRenderer(h);var p=function(y,S,w){r.notifications(!1);var T=r.mutableElements();T.length>0&&T.remove(),y!=null&&(Fr(y)||xn(y))&&r.add(y),r.one("layoutready",function(C){r.notifications(!0),r.emit(C),r.one("load",S),r.emitAndNotify("load")}).one("layoutstop",function(){r.one("done",w),r.emit("done")});var _=er({},r._private.options.layout);_.eles=r.elements(),r.layout(_).run()};c([o.style,o.elements],function(v){var y=v[0],S=v[1];u.styleEnabled&&r.style().append(y),p(S,function(){r.startAnimationLoop(),u.ready=!0,ni(o.ready)&&r.on("ready",o.ready);for(var w=0;w<a.length;w++){var T=a[w];r.on("ready",T)}i&&(i.readies=[]),r.emit("ready")},o.done)})},dx=Ev.prototype;er(dx,{instanceString:function(){return"core"},isReady:function(){return this._private.ready},destroyed:function(){return this._private.destroyed},ready:function(e){return this.isReady()?this.emitter().emit("ready",[],e):this.on("ready",e),this},destroy:function(){var e=this;if(!e.destroyed())return e.stopAnimationLoop(),e.destroyRenderer(),this.emit("destroy"),e._private.destroyed=!0,e},hasElementWithId:function(e){return this._private.elements.hasElementWithId(e)},getElementById:function(e){return this._private.elements.getElementById(e)},hasCompoundNodes:function(){return this._private.hasCompoundNodes},headless:function(){return this._private.renderer.isHeadless()},styleEnabled:function(){return this._private.styleEnabled},addToPool:function(e){return this._private.elements.merge(e),this},removeFromPool:function(e){return this._private.elements.unmerge(e),this},container:function(){return this._private.container||null},window:function(){var e=this._private.container;if(e==null)return $i;var r=this._private.container.ownerDocument;return r===void 0||r==null?$i:r.defaultView||$i},mount:function(e){if(e!=null){var r=this,n=r._private,i=n.options;return!ix(e)&&ix(e[0])&&(e=e[0]),r.stopAnimationLoop(),r.destroyRenderer(),n.container=e,n.styleEnabled=!0,r.invalidateSize(),r.initRenderer(er({},i,i.renderer,{name:i.renderer.name==="null"?"canvas":i.renderer.name})),r.startAnimationLoop(),r.style(i.style),r.emit("mount"),r}},unmount:function(){var e=this;return e.stopAnimationLoop(),e.destroyRenderer(),e.initRenderer({name:"null"}),e.emit("unmount"),e},options:function(){return ku(this._private.options)},json:function(e){var r=this,n=r._private,i=r.mutableElements(),a=function(N){return r.getElementById(N.id())};if(Fr(e)){if(r.startBatch(),e.elements){var s={},o=function(N,A){for(var I=[],j=[],O=0;O<N.length;O++){var F=N[O];if(!F.data.id){rn("cy.json() cannot handle elements without an ID attribute");continue}var B=""+F.data.id,$=r.getElementById(B);s[B]=!0,$.length!==0?j.push({ele:$,json:F}):(A&&(F.group=A),I.push(F))}r.add(I);for(var Z=0;Z<j.length;Z++){var D=j[Z],H=D.ele,U=D.json;H.json(U)}};if(xn(e.elements))o(e.elements);else for(var l=["nodes","edges"],u=0;u<l.length;u++){var c=l[u],h=e.elements[c];xn(h)&&o(h,c)}var p=r.collection();i.filter(function(C){return!s[C.id()]}).forEach(function(C){C.isParent()?p.merge(C):C.remove()}),p.forEach(function(C){return C.children().move({parent:null})}),p.forEach(function(C){return a(C).remove()})}e.style&&r.style(e.style),e.zoom!=null&&e.zoom!==n.zoom&&r.zoom(e.zoom),e.pan&&(e.pan.x!==n.pan.x||e.pan.y!==n.pan.y)&&r.pan(e.pan),e.data&&r.data(e.data);for(var v=["minZoom","maxZoom","zoomingEnabled","userZoomingEnabled","panningEnabled","userPanningEnabled","boxSelectionEnabled","autolock","autoungrabify","autounselectify","multiClickDebounceTime"],y=0;y<v.length;y++){var S=v[y];e[S]!=null&&r[S](e[S])}return r.endBatch(),this}else{var w=!!e,T={};w?T.elements=this.elements().map(function(C){return C.json()}):(T.elements={},i.forEach(function(C){var N=C.group();T.elements[N]||(T.elements[N]=[]),T.elements[N].push(C.json())})),this._private.styleEnabled&&(T.style=r.style().json()),T.data=ku(r.data());var _=n.options;return T.zoomingEnabled=n.zoomingEnabled,T.userZoomingEnabled=n.userZoomingEnabled,T.zoom=n.zoom,T.minZoom=n.minZoom,T.maxZoom=n.maxZoom,T.panningEnabled=n.panningEnabled,T.userPanningEnabled=n.userPanningEnabled,T.pan=ku(n.pan),T.boxSelectionEnabled=n.boxSelectionEnabled,T.renderer=ku(_.renderer),T.hideEdgesOnViewport=_.hideEdgesOnViewport,T.textureOnViewport=_.textureOnViewport,T.wheelSensitivity=_.wheelSensitivity,T.motionBlur=_.motionBlur,T.multiClickDebounceTime=_.multiClickDebounceTime,T}}});dx.$id=dx.getElementById;[B7,H7,OA,GS,zy,q7,VS,Uy,Z7,vf,Cv].forEach(function(t){er(dx,t)});var X7={fit:!0,directed:!1,direction:"downward",padding:30,circle:!1,grid:!1,spacingFactor:1.75,boundingBox:void 0,avoidOverlap:!0,nodeDimensionsIncludeLabels:!1,roots:void 0,depthSort:void 0,animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function(e,r){return!0},ready:void 0,stop:void 0,transform:function(e,r){return r}},Q7={maximal:!1,acyclic:!1},mp=function(e){return e.scratch("breadthfirst")},MN=function(e,r){return e.scratch("breadthfirst",r)};function DA(t){this.options=er({},X7,Q7,t)}DA.prototype.run=function(){var t=this.options,e=t.cy,r=t.eles,n=r.nodes().filter(function(De){return De.isChildless()}),i=r,a=t.directed,s=t.acyclic||t.maximal||t.maximalAdjustments>0,o=!!t.boundingBox,l=Ns(o?t.boundingBox:structuredClone(e.extent())),u;if(po(t.roots))u=t.roots;else if(xn(t.roots)){for(var c=[],h=0;h<t.roots.length;h++){var p=t.roots[h],v=e.getElementById(p);c.push(v)}u=e.collection(c)}else if(Wt(t.roots))u=e.$(t.roots);else if(a)u=n.roots();else{var y=r.components();u=e.collection();for(var S=function(){var Le=y[w],Qe=Le.maxDegree(!1),Ce=Le.filter(function(Fe){return Fe.degree(!1)===Qe});u=u.add(Ce)},w=0;w<y.length;w++)S()}var T=[],_={},C=function(Le,Qe){T[Qe]==null&&(T[Qe]=[]);var Ce=T[Qe].length;T[Qe].push(Le),MN(Le,{index:Ce,depth:Qe})},N=function(Le,Qe){var Ce=mp(Le),Fe=Ce.depth,Ke=Ce.index;T[Fe][Ke]=null,Le.isChildless()&&C(Le,Qe)};i.bfs({roots:u,directed:t.directed,visit:function(Le,Qe,Ce,Fe,Ke){var mt=Le[0],gt=mt.id();mt.isChildless()&&C(mt,Ke),_[gt]=!0}});for(var A=[],I=0;I<n.length;I++){var j=n[I];_[j.id()]||A.push(j)}var O=function(Le){for(var Qe=T[Le],Ce=0;Ce<Qe.length;Ce++){var Fe=Qe[Ce];if(Fe==null){Qe.splice(Ce,1),Ce--;continue}MN(Fe,{depth:Le,index:Ce})}},F=function(Le,Qe){for(var Ce=mp(Le),Fe=Le.incomers().filter(function(wt){return wt.isNode()&&r.has(wt)}),Ke=-1,mt=Le.id(),gt=0;gt<Fe.length;gt++){var yt=Fe[gt],jt=mp(yt);Ke=Math.max(Ke,jt.depth)}if(Ce.depth<=Ke){if(!t.acyclic&&Qe[mt])return null;var qt=Ke+1;return N(Le,qt),Qe[mt]=qt,!0}return!1};if(a&&s){var B=[],$={},Z=function(Le){return B.push(Le)},D=function(){return B.shift()};for(n.forEach(function(De){return B.push(De)});B.length>0;){var H=D(),U=F(H,$);if(U)H.outgoers().filter(function(De){return De.isNode()&&r.has(De)}).forEach(Z);else if(U===null){rn("Detected double maximal shift for node `"+H.id()+"`.  Bailing maximal adjustment due to cycle.  Use `options.maximal: true` only on DAGs.");break}}}var W=0;if(t.avoidOverlap)for(var Y=0;Y<n.length;Y++){var Q=n[Y],ne=Q.layoutDimensions(t),re=ne.w,q=ne.h;W=Math.max(W,re,q)}var te={},ae=function(Le){if(te[Le.id()])return te[Le.id()];for(var Qe=mp(Le).depth,Ce=Le.neighborhood(),Fe=0,Ke=0,mt=0;mt<Ce.length;mt++){var gt=Ce[mt];if(!(gt.isEdge()||gt.isParent()||!n.has(gt))){var yt=mp(gt);if(yt!=null){var jt=yt.index,qt=yt.depth;if(!(jt==null||qt==null)){var wt=T[qt].length;qt<Qe&&(Fe+=jt/wt,Ke++)}}}}return Ke=Math.max(1,Ke),Fe=Fe/Ke,Ke===0&&(Fe=0),te[Le.id()]=Fe,Fe},de=function(Le,Qe){var Ce=ae(Le),Fe=ae(Qe),Ke=Ce-Fe;return Ke===0?IM(Le.id(),Qe.id()):Ke};t.depthSort!==void 0&&(de=t.depthSort);for(var ge=T.length,ye=0;ye<ge;ye++)T[ye].sort(de),O(ye);for(var se=[],fe=0;fe<A.length;fe++)se.push(A[fe]);var le=function(){for(var Le=0;Le<ge;Le++)O(Le)};se.length&&(T.unshift(se),ge=T.length,le());for(var pe=0,me=0;me<ge;me++)pe=Math.max(T[me].length,pe);var xe={x:l.x1+l.w/2,y:l.y1+l.h/2},Se=n.reduce(function(De,Le){return(function(Qe){return{w:De.w===-1?Qe.w:(De.w+Qe.w)/2,h:De.h===-1?Qe.h:(De.h+Qe.h)/2}})(Le.boundingBox({includeLabels:t.nodeDimensionsIncludeLabels}))},{w:-1,h:-1}),Ve=Math.max(ge===1?0:o?(l.h-t.padding*2-Se.h)/(ge-1):(l.h-t.padding*2-Se.h)/(ge+1),W),$e=T.reduce(function(De,Le){return Math.max(De,Le.length)},0),St=function(Le){var Qe=mp(Le),Ce=Qe.depth,Fe=Qe.index;if(t.circle){var Ke=Math.min(l.w/2/ge,l.h/2/ge);Ke=Math.max(Ke,W);var mt=Ke*Ce+Ke-(ge>0&&T[0].length<=3?Ke/2:0),gt=2*Math.PI/T[Ce].length*Fe;return Ce===0&&T[0].length===1&&(mt=1),{x:xe.x+mt*Math.cos(gt),y:xe.y+mt*Math.sin(gt)}}else{var yt=T[Ce].length,jt=Math.max(yt===1?0:o?(l.w-t.padding*2-Se.w)/((t.grid?$e:yt)-1):(l.w-t.padding*2-Se.w)/((t.grid?$e:yt)+1),W),qt={x:xe.x+(Fe+1-(yt+1)/2)*jt,y:xe.y+(Ce+1-(ge+1)/2)*Ve};return qt}},rt={downward:0,leftward:90,upward:180,rightward:-90};Object.keys(rt).indexOf(t.direction)===-1&&Kn("Invalid direction '".concat(t.direction,"' specified for breadthfirst layout. Valid values are: ").concat(Object.keys(rt).join(", ")));var lt=function(Le){return p9(St(Le),l,rt[t.direction])};return r.nodes().layoutPositions(this,t,lt),this};var J7={fit:!0,padding:30,boundingBox:void 0,avoidOverlap:!0,nodeDimensionsIncludeLabels:!1,spacingFactor:void 0,radius:void 0,startAngle:3/2*Math.PI,sweep:void 0,clockwise:!0,sort:void 0,animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function(e,r){return!0},ready:void 0,stop:void 0,transform:function(e,r){return r}};function IA(t){this.options=er({},J7,t)}IA.prototype.run=function(){var t=this.options,e=t,r=t.cy,n=e.eles,i=e.counterclockwise!==void 0?!e.counterclockwise:e.clockwise,a=n.nodes().not(":parent");e.sort&&(a=a.sort(e.sort));for(var s=Ns(e.boundingBox?e.boundingBox:{x1:0,y1:0,w:r.width(),h:r.height()}),o={x:s.x1+s.w/2,y:s.y1+s.h/2},l=e.sweep===void 0?2*Math.PI-2*Math.PI/a.length:e.sweep,u=l/Math.max(1,a.length-1),c,h=0,p=0;p<a.length;p++){var v=a[p],y=v.layoutDimensions(e),S=y.w,w=y.h;h=Math.max(h,S,w)}if(bt(e.radius)?c=e.radius:a.length<=1?c=0:c=Math.min(s.h,s.w)/2-h,a.length>1&&e.avoidOverlap){h*=1.75;var T=Math.cos(u)-Math.cos(0),_=Math.sin(u)-Math.sin(0),C=Math.sqrt(h*h/(T*T+_*_));c=Math.max(C,c)}var N=function(I,j){var O=e.startAngle+j*u*(i?1:-1),F=c*Math.cos(O),B=c*Math.sin(O),$={x:o.x+F,y:o.y+B};return $};return n.nodes().layoutPositions(this,e,N),this};var ez={fit:!0,padding:30,startAngle:3/2*Math.PI,sweep:void 0,clockwise:!0,equidistant:!1,minNodeSpacing:10,boundingBox:void 0,avoidOverlap:!0,nodeDimensionsIncludeLabels:!1,height:void 0,width:void 0,spacingFactor:void 0,concentric:function(e){return e.degree()},levelWidth:function(e){return e.maxDegree()/4},animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function(e,r){return!0},ready:void 0,stop:void 0,transform:function(e,r){return r}};function jA(t){this.options=er({},ez,t)}jA.prototype.run=function(){for(var t=this.options,e=t,r=e.counterclockwise!==void 0?!e.counterclockwise:e.clockwise,n=t.cy,i=e.eles,a=i.nodes().not(":parent"),s=Ns(e.boundingBox?e.boundingBox:{x1:0,y1:0,w:n.width(),h:n.height()}),o={x:s.x1+s.w/2,y:s.y1+s.h/2},l=[],u=0,c=0;c<a.length;c++){var h=a[c],p=void 0;p=e.concentric(h),l.push({value:p,node:h}),h._private.scratch.concentric=p}a.updateStyle();for(var v=0;v<a.length;v++){var y=a[v],S=y.layoutDimensions(e);u=Math.max(u,S.w,S.h)}l.sort(function(Ve,$e){return $e.value-Ve.value});for(var w=e.levelWidth(a),T=[[]],_=T[0],C=0;C<l.length;C++){var N=l[C];if(_.length>0){var A=Math.abs(_[0].value-N.value);A>=w&&(_=[],T.push(_))}_.push(N)}var I=u+e.minNodeSpacing;if(!e.avoidOverlap){var j=T.length>0&&T[0].length>1,O=Math.min(s.w,s.h)/2-I,F=O/(T.length+j?1:0);I=Math.min(I,F)}for(var B=0,$=0;$<T.length;$++){var Z=T[$],D=e.sweep===void 0?2*Math.PI-2*Math.PI/Z.length:e.sweep,H=Z.dTheta=D/Math.max(1,Z.length-1);if(Z.length>1&&e.avoidOverlap){var U=Math.cos(H)-Math.cos(0),W=Math.sin(H)-Math.sin(0),Y=Math.sqrt(I*I/(U*U+W*W));B=Math.max(Y,B)}Z.r=B,B+=I}if(e.equidistant){for(var Q=0,ne=0,re=0;re<T.length;re++){var q=T[re],te=q.r-ne;Q=Math.max(Q,te)}ne=0;for(var ae=0;ae<T.length;ae++){var de=T[ae];ae===0&&(ne=de.r),de.r=ne,ne+=Q}}for(var ge={},ye=0;ye<T.length;ye++)for(var se=T[ye],fe=se.dTheta,le=se.r,pe=0;pe<se.length;pe++){var me=se[pe],xe=e.startAngle+(r?1:-1)*fe*pe,Se={x:o.x+le*Math.cos(xe),y:o.y+le*Math.sin(xe)};ge[me.node.id()]=Se}return i.nodes().layoutPositions(this,e,function(Ve){var $e=Ve.id();return ge[$e]}),this};var c2,tz={ready:function(){},stop:function(){},animate:!0,animationEasing:void 0,animationDuration:void 0,animateFilter:function(e,r){return!0},animationThreshold:250,refresh:20,fit:!0,padding:30,boundingBox:void 0,nodeDimensionsIncludeLabels:!1,randomize:!1,componentSpacing:40,nodeRepulsion:function(e){return 2048},nodeOverlap:4,idealEdgeLength:function(e){return 32},edgeElasticity:function(e){return 32},nestingFactor:1.2,gravity:1,numIter:1e3,initialTemp:1e3,coolingFactor:.99,minTemp:1};function D1(t){this.options=er({},tz,t),this.options.layout=this;var e=this.options.eles.nodes(),r=this.options.eles.edges(),n=r.filter(function(i){var a=i.source().data("id"),s=i.target().data("id"),o=e.some(function(u){return u.data("id")===a}),l=e.some(function(u){return u.data("id")===s});return!o||!l});this.options.eles=this.options.eles.not(n)}D1.prototype.run=function(){var t=this.options,e=t.cy,r=this;r.stopped=!1,(t.animate===!0||t.animate===!1)&&r.emit({type:"layoutstart",layout:r}),t.debug===!0?c2=!0:c2=!1;var n=rz(e,r,t);c2&&iz(n),t.randomize&&az(n);var i=gc(),a=function(){sz(n,e,t),t.fit===!0&&e.fit(t.padding)},s=function(p){return!(r.stopped||p>=t.numIter||(oz(n,t),n.temperature=n.temperature*t.coolingFactor,n.temperature<t.minTemp))},o=function(){if(t.animate===!0||t.animate===!1)a(),r.one("layoutstop",t.stop),r.emit({type:"layoutstop",layout:r});else{var p=t.eles.nodes(),v=BA(n,t,p);p.layoutPositions(r,t,v)}},l=0,u=!0;if(t.animate===!0){var c=function(){for(var p=0;u&&p<t.refresh;)u=s(l),l++,p++;if(!u)RN(n,t),o();else{var v=gc();v-i>=t.animationThreshold&&a(),ax(c)}};c()}else{for(;u;)u=s(l),l++;RN(n,t),o()}return this};D1.prototype.stop=function(){return this.stopped=!0,this.thread&&this.thread.stop(),this.emit("layoutstop"),this};D1.prototype.destroy=function(){return this.thread&&this.thread.stop(),this};var rz=function(e,r,n){for(var i=n.eles.edges(),a=n.eles.nodes(),s=Ns(n.boundingBox?n.boundingBox:{x1:0,y1:0,w:e.width(),h:e.height()}),o={isCompound:e.hasCompoundNodes(),layoutNodes:[],idToIndex:{},nodeSize:a.size(),graphSet:[],indexToGraph:[],layoutEdges:[],edgeSize:i.size(),temperature:n.initialTemp,clientWidth:s.w,clientHeight:s.h,boundingBox:s},l=n.eles.components(),u={},c=0;c<l.length;c++)for(var h=l[c],p=0;p<h.length;p++){var v=h[p];u[v.id()]=c}for(var c=0;c<o.nodeSize;c++){var y=a[c],S=y.layoutDimensions(n),w={};w.isLocked=y.locked(),w.id=y.data("id"),w.parentId=y.data("parent"),w.cmptId=u[y.id()],w.children=[],w.positionX=y.position("x"),w.positionY=y.position("y"),w.offsetX=0,w.offsetY=0,w.height=S.w,w.width=S.h,w.maxX=w.positionX+w.width/2,w.minX=w.positionX-w.width/2,w.maxY=w.positionY+w.height/2,w.minY=w.positionY-w.height/2,w.padLeft=parseFloat(y.style("padding")),w.padRight=parseFloat(y.style("padding")),w.padTop=parseFloat(y.style("padding")),w.padBottom=parseFloat(y.style("padding")),w.nodeRepulsion=ni(n.nodeRepulsion)?n.nodeRepulsion(y):n.nodeRepulsion,o.layoutNodes.push(w),o.idToIndex[w.id]=c}for(var T=[],_=0,C=-1,N=[],c=0;c<o.nodeSize;c++){var y=o.layoutNodes[c],A=y.parentId;A!=null?o.layoutNodes[o.idToIndex[A]].children.push(y.id):(T[++C]=y.id,N.push(y.id))}for(o.graphSet.push(N);_<=C;){var I=T[_++],j=o.idToIndex[I],v=o.layoutNodes[j],O=v.children;if(O.length>0){o.graphSet.push(O);for(var c=0;c<O.length;c++)T[++C]=O[c]}}for(var c=0;c<o.graphSet.length;c++)for(var F=o.graphSet[c],p=0;p<F.length;p++){var B=o.idToIndex[F[p]];o.indexToGraph[B]=c}for(var c=0;c<o.edgeSize;c++){var $=i[c],Z={};Z.id=$.data("id"),Z.sourceId=$.data("source"),Z.targetId=$.data("target");var D=ni(n.idealEdgeLength)?n.idealEdgeLength($):n.idealEdgeLength,H=ni(n.edgeElasticity)?n.edgeElasticity($):n.edgeElasticity,U=o.idToIndex[Z.sourceId],W=o.idToIndex[Z.targetId],Y=o.indexToGraph[U],Q=o.indexToGraph[W];if(Y!=Q){for(var ne=nz(Z.sourceId,Z.targetId,o),re=o.graphSet[ne],q=0,w=o.layoutNodes[U];re.indexOf(w.id)===-1;)w=o.layoutNodes[o.idToIndex[w.parentId]],q++;for(w=o.layoutNodes[W];re.indexOf(w.id)===-1;)w=o.layoutNodes[o.idToIndex[w.parentId]],q++;D*=q*n.nestingFactor}Z.idealLength=D,Z.elasticity=H,o.layoutEdges.push(Z)}return o},nz=function(e,r,n){var i=FA(e,r,0,n);return 2>i.count?0:i.graph},FA=function(e,r,n,i){var a=i.graphSet[n];if(-1<a.indexOf(e)&&-1<a.indexOf(r))return{count:2,graph:n};for(var s=0,o=0;o<a.length;o++){var l=a[o],u=i.idToIndex[l],c=i.layoutNodes[u].children;if(c.length!==0){var h=i.indexToGraph[i.idToIndex[c[0]]],p=FA(e,r,h,i);if(p.count!==0)if(p.count===1){if(s++,s===2)break}else return p}}return{count:s,graph:n}},iz,az=function(e,r){for(var n=e.clientWidth,i=e.clientHeight,a=0;a<e.nodeSize;a++){var s=e.layoutNodes[a];s.children.length===0&&!s.isLocked&&(s.positionX=Math.random()*n,s.positionY=Math.random()*i)}},BA=function(e,r,n){var i=e.boundingBox,a={x1:1/0,x2:-1/0,y1:1/0,y2:-1/0};return r.boundingBox&&(n.forEach(function(s){var o=e.layoutNodes[e.idToIndex[s.data("id")]];a.x1=Math.min(a.x1,o.positionX),a.x2=Math.max(a.x2,o.positionX),a.y1=Math.min(a.y1,o.positionY),a.y2=Math.max(a.y2,o.positionY)}),a.w=a.x2-a.x1,a.h=a.y2-a.y1),function(s,o){var l=e.layoutNodes[e.idToIndex[s.data("id")]];if(r.boundingBox){var u=a.w===0?.5:(l.positionX-a.x1)/a.w,c=a.h===0?.5:(l.positionY-a.y1)/a.h;return{x:i.x1+u*i.w,y:i.y1+c*i.h}}else return{x:l.positionX,y:l.positionY}}},sz=function(e,r,n){var i=n.layout,a=n.eles.nodes(),s=BA(e,n,a);a.positions(s),e.ready!==!0&&(e.ready=!0,i.one("layoutready",n.ready),i.emit({type:"layoutready",layout:this}))},oz=function(e,r,n){lz(e,r),dz(e),hz(e,r),fz(e),pz(e)},lz=function(e,r){for(var n=0;n<e.graphSet.length;n++)for(var i=e.graphSet[n],a=i.length,s=0;s<a;s++)for(var o=e.layoutNodes[e.idToIndex[i[s]]],l=s+1;l<a;l++){var u=e.layoutNodes[e.idToIndex[i[l]]];uz(o,u,e,r)}},AN=function(e){return-1+2*e*Math.random()},uz=function(e,r,n,i){var a=e.cmptId,s=r.cmptId;if(!(a!==s&&!n.isCompound)){var o=r.positionX-e.positionX,l=r.positionY-e.positionY,u=1;o===0&&l===0&&(o=AN(u),l=AN(u));var c=cz(e,r,o,l);if(c>0)var h=i.nodeOverlap*c,p=Math.sqrt(o*o+l*l),v=h*o/p,y=h*l/p;else var S=hx(e,o,l),w=hx(r,-1*o,-1*l),T=w.x-S.x,_=w.y-S.y,C=T*T+_*_,p=Math.sqrt(C),h=(e.nodeRepulsion+r.nodeRepulsion)/C,v=h*T/p,y=h*_/p;e.isLocked||(e.offsetX-=v,e.offsetY-=y),r.isLocked||(r.offsetX+=v,r.offsetY+=y)}},cz=function(e,r,n,i){if(n>0)var a=e.maxX-r.minX;else var a=r.maxX-e.minX;if(i>0)var s=e.maxY-r.minY;else var s=r.maxY-e.minY;return a>=0&&s>=0?Math.sqrt(a*a+s*s):0},hx=function(e,r,n){var i=e.positionX,a=e.positionY,s=e.height||1,o=e.width||1,l=n/r,u=s/o,c={};return r===0&&0<n||r===0&&0>n?(c.x=i,c.y=a+s/2,c):0<r&&-1*u<=l&&l<=u?(c.x=i+o/2,c.y=a+o*n/2/r,c):0>r&&-1*u<=l&&l<=u?(c.x=i-o/2,c.y=a-o*n/2/r,c):0<n&&(l<=-1*u||l>=u)?(c.x=i+s*r/2/n,c.y=a+s/2,c):(0>n&&(l<=-1*u||l>=u)&&(c.x=i-s*r/2/n,c.y=a-s/2),c)},dz=function(e,r){for(var n=0;n<e.edgeSize;n++){var i=e.layoutEdges[n],a=e.idToIndex[i.sourceId],s=e.layoutNodes[a],o=e.idToIndex[i.targetId],l=e.layoutNodes[o],u=l.positionX-s.positionX,c=l.positionY-s.positionY;if(!(u===0&&c===0)){var h=hx(s,u,c),p=hx(l,-1*u,-1*c),v=p.x-h.x,y=p.y-h.y,S=Math.sqrt(v*v+y*y),w=Math.pow(i.idealLength-S,2)/i.elasticity;if(S!==0)var T=w*v/S,_=w*y/S;else var T=0,_=0;s.isLocked||(s.offsetX+=T,s.offsetY+=_),l.isLocked||(l.offsetX-=T,l.offsetY-=_)}}},hz=function(e,r){if(r.gravity!==0)for(var n=1,i=0;i<e.graphSet.length;i++){var a=e.graphSet[i],s=a.length;if(i===0)var o=e.clientHeight/2,l=e.clientWidth/2;else var u=e.layoutNodes[e.idToIndex[a[0]]],c=e.layoutNodes[e.idToIndex[u.parentId]],o=c.positionX,l=c.positionY;for(var h=0;h<s;h++){var p=e.layoutNodes[e.idToIndex[a[h]]];if(!p.isLocked){var v=o-p.positionX,y=l-p.positionY,S=Math.sqrt(v*v+y*y);if(S>n){var w=r.gravity*v/S,T=r.gravity*y/S;p.offsetX+=w,p.offsetY+=T}}}}},fz=function(e,r){var n=[],i=0,a=-1;for(n.push.apply(n,e.graphSet[0]),a+=e.graphSet[0].length;i<=a;){var s=n[i++],o=e.idToIndex[s],l=e.layoutNodes[o],u=l.children;if(0<u.length&&!l.isLocked){for(var c=l.offsetX,h=l.offsetY,p=0;p<u.length;p++){var v=e.layoutNodes[e.idToIndex[u[p]]];v.offsetX+=c,v.offsetY+=h,n[++a]=u[p]}l.offsetX=0,l.offsetY=0}}},pz=function(e,r){for(var n=0;n<e.nodeSize;n++){var i=e.layoutNodes[n];0<i.children.length&&(i.maxX=void 0,i.minX=void 0,i.maxY=void 0,i.minY=void 0)}for(var n=0;n<e.nodeSize;n++){var i=e.layoutNodes[n];if(!(0<i.children.length||i.isLocked)){var a=mz(i.offsetX,i.offsetY,e.temperature);i.positionX+=a.x,i.positionY+=a.y,i.offsetX=0,i.offsetY=0,i.minX=i.positionX-i.width,i.maxX=i.positionX+i.width,i.minY=i.positionY-i.height,i.maxY=i.positionY+i.height,zA(i,e)}}for(var n=0;n<e.nodeSize;n++){var i=e.layoutNodes[n];0<i.children.length&&!i.isLocked&&(i.positionX=(i.maxX+i.minX)/2,i.positionY=(i.maxY+i.minY)/2,i.width=i.maxX-i.minX,i.height=i.maxY-i.minY)}},mz=function(e,r,n){var i=Math.sqrt(e*e+r*r);if(i>n)var a={x:n*e/i,y:n*r/i};else var a={x:e,y:r};return a},zA=function(e,r){var n=e.parentId;if(n!=null){var i=r.layoutNodes[r.idToIndex[n]],a=!1;if((i.maxX==null||e.maxX+i.padRight>i.maxX)&&(i.maxX=e.maxX+i.padRight,a=!0),(i.minX==null||e.minX-i.padLeft<i.minX)&&(i.minX=e.minX-i.padLeft,a=!0),(i.maxY==null||e.maxY+i.padBottom>i.maxY)&&(i.maxY=e.maxY+i.padBottom,a=!0),(i.minY==null||e.minY-i.padTop<i.minY)&&(i.minY=e.minY-i.padTop,a=!0),a)return zA(i,r)}},RN=function(e,r){for(var n=e.layoutNodes,i=[],a=0;a<n.length;a++){var s=n[a],o=s.cmptId,l=i[o]=i[o]||[];l.push(s)}for(var u=0,a=0;a<i.length;a++){var c=i[a];if(c){c.x1=1/0,c.x2=-1/0,c.y1=1/0,c.y2=-1/0;for(var h=0;h<c.length;h++){var p=c[h];c.x1=Math.min(c.x1,p.positionX-p.width/2),c.x2=Math.max(c.x2,p.positionX+p.width/2),c.y1=Math.min(c.y1,p.positionY-p.height/2),c.y2=Math.max(c.y2,p.positionY+p.height/2)}c.w=c.x2-c.x1,c.h=c.y2-c.y1,u+=c.w*c.h}}i.sort(function(_,C){return C.w*C.h-_.w*_.h});for(var v=0,y=0,S=0,w=0,T=Math.sqrt(u)*e.clientWidth/e.clientHeight,a=0;a<i.length;a++){var c=i[a];if(c){for(var h=0;h<c.length;h++){var p=c[h];p.isLocked||(p.positionX+=v-c.x1,p.positionY+=y-c.y1)}v+=c.w+r.componentSpacing,S+=c.w+r.componentSpacing,w=Math.max(w,c.h),S>T&&(y+=w+r.componentSpacing,v=0,S=0,w=0)}}},gz={fit:!0,padding:30,boundingBox:void 0,avoidOverlap:!0,avoidOverlapPadding:10,nodeDimensionsIncludeLabels:!1,spacingFactor:void 0,condense:!1,rows:void 0,cols:void 0,position:function(e){},sort:void 0,animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function(e,r){return!0},ready:void 0,stop:void 0,transform:function(e,r){return r}};function UA(t){this.options=er({},gz,t)}UA.prototype.run=function(){var t=this.options,e=t,r=t.cy,n=e.eles,i=n.nodes().not(":parent");e.sort&&(i=i.sort(e.sort));var a=Ns(e.boundingBox?e.boundingBox:{x1:0,y1:0,w:r.width(),h:r.height()});if(a.h===0||a.w===0)n.nodes().layoutPositions(this,e,function(ae){return{x:a.x1,y:a.y1}});else{var s=i.size(),o=Math.sqrt(s*a.h/a.w),l=Math.round(o),u=Math.round(a.w/a.h*o),c=function(de){if(de==null)return Math.min(l,u);var ge=Math.min(l,u);ge==l?l=de:u=de},h=function(de){if(de==null)return Math.max(l,u);var ge=Math.max(l,u);ge==l?l=de:u=de},p=e.rows,v=e.cols!=null?e.cols:e.columns;if(p!=null&&v!=null)l=p,u=v;else if(p!=null&&v==null)l=p,u=Math.ceil(s/l);else if(p==null&&v!=null)u=v,l=Math.ceil(s/u);else if(u*l>s){var y=c(),S=h();(y-1)*S>=s?c(y-1):(S-1)*y>=s&&h(S-1)}else for(;u*l<s;){var w=c(),T=h();(T+1)*w>=s?h(T+1):c(w+1)}var _=a.w/u,C=a.h/l;if(e.condense&&(_=0,C=0),e.avoidOverlap)for(var N=0;N<i.length;N++){var A=i[N],I=A._private.position;(I.x==null||I.y==null)&&(I.x=0,I.y=0);var j=A.layoutDimensions(e),O=e.avoidOverlapPadding,F=j.w+O,B=j.h+O;_=Math.max(_,F),C=Math.max(C,B)}for(var $={},Z=function(de,ge){return!!$["c-"+de+"-"+ge]},D=function(de,ge){$["c-"+de+"-"+ge]=!0},H=0,U=0,W=function(){U++,U>=u&&(U=0,H++)},Y={},Q=0;Q<i.length;Q++){var ne=i[Q],re=e.position(ne);if(re&&(re.row!==void 0||re.col!==void 0)){var q={row:re.row,col:re.col};if(q.col===void 0)for(q.col=0;Z(q.row,q.col);)q.col++;else if(q.row===void 0)for(q.row=0;Z(q.row,q.col);)q.row++;Y[ne.id()]=q,D(q.row,q.col)}}var te=function(de,ge){var ye,se;if(de.locked()||de.isParent())return!1;var fe=Y[de.id()];if(fe)ye=fe.col*_+_/2+a.x1,se=fe.row*C+C/2+a.y1;else{for(;Z(H,U);)W();ye=U*_+_/2+a.x1,se=H*C+C/2+a.y1,D(H,U),W()}return{x:ye,y:se}};i.layoutPositions(this,e,te)}return this};var vz={ready:function(){},stop:function(){}};function m_(t){this.options=er({},vz,t)}m_.prototype.run=function(){var t=this.options,e=t.eles,r=this;return t.cy,r.emit("layoutstart"),e.nodes().positions(function(){return{x:0,y:0}}),r.one("layoutready",t.ready),r.emit("layoutready"),r.one("layoutstop",t.stop),r.emit("layoutstop"),this};m_.prototype.stop=function(){return this};var yz={positions:void 0,zoom:void 0,pan:void 0,fit:!0,padding:30,spacingFactor:void 0,animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function(e,r){return!0},ready:void 0,stop:void 0,transform:function(e,r){return r}};function GA(t){this.options=er({},yz,t)}GA.prototype.run=function(){var t=this.options,e=t.eles,r=e.nodes(),n=ni(t.positions);function i(a){if(t.positions==null)return z9(a.position());if(n)return t.positions(a);var s=t.positions[a._private.data.id];return s??null}return r.layoutPositions(this,t,function(a,s){var o=i(a);return a.locked()||o==null?!1:o}),this};var xz={fit:!0,padding:30,boundingBox:void 0,animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function(e,r){return!0},ready:void 0,stop:void 0,transform:function(e,r){return r}};function VA(t){this.options=er({},xz,t)}VA.prototype.run=function(){var t=this.options,e=t.cy,r=t.eles,n=Ns(t.boundingBox?t.boundingBox:{x1:0,y1:0,w:e.width(),h:e.height()}),i=function(s,o){return{x:n.x1+Math.round(Math.random()*n.w),y:n.y1+Math.round(Math.random()*n.h)}};return r.nodes().layoutPositions(this,t,i),this};var bz=[{name:"breadthfirst",impl:DA},{name:"circle",impl:IA},{name:"concentric",impl:jA},{name:"cose",impl:D1},{name:"grid",impl:UA},{name:"null",impl:m_},{name:"preset",impl:GA},{name:"random",impl:VA}];function HA(t){this.options=t,this.notifications=0}var LN=function(){},ON=function(){throw new Error("A headless instance can not render images")};HA.prototype={recalculateRenderedStyle:LN,notify:function(){this.notifications++},init:LN,isHeadless:function(){return!0},png:ON,jpg:ON};var g_={};g_.arrowShapeWidth=.3;g_.registerArrowShapes=function(){var t=this.arrowShapes={},e=this,r=function(u,c,h,p,v,y,S){var w=v.x-h/2-S,T=v.x+h/2+S,_=v.y-h/2-S,C=v.y+h/2+S,N=w<=u&&u<=T&&_<=c&&c<=C;return N},n=function(u,c,h,p,v){var y=u*Math.cos(p)-c*Math.sin(p),S=u*Math.sin(p)+c*Math.cos(p),w=y*h,T=S*h,_=w+v.x,C=T+v.y;return{x:_,y:C}},i=function(u,c,h,p){for(var v=[],y=0;y<u.length;y+=2){var S=u[y],w=u[y+1];v.push(n(S,w,c,h,p))}return v},a=function(u){for(var c=[],h=0;h<u.length;h++){var p=u[h];c.push(p.x,p.y)}return c},s=function(u){return u.pstyle("width").pfValue*u.pstyle("arrow-scale").pfValue*2},o=function(u,c){Wt(c)&&(c=t[c]),t[u]=er({name:u,points:[-.15,-.3,.15,-.3,.15,.3,-.15,.3],collide:function(p,v,y,S,w,T){var _=a(i(this.points,y+2*T,S,w)),C=Ks(p,v,_);return C},roughCollide:r,draw:function(p,v,y,S){var w=i(this.points,v,y,S);e.arrowShapeImpl("polygon")(p,w)},spacing:function(p){return 0},gap:s},c)};o("none",{collide:sx,roughCollide:sx,draw:t_,spacing:KE,gap:KE}),o("triangle",{points:[-.15,-.3,0,0,.15,-.3]}),o("arrow","triangle"),o("triangle-backcurve",{points:t.triangle.points,controlPoint:[0,-.15],roughCollide:r,draw:function(u,c,h,p,v){var y=i(this.points,c,h,p),S=this.controlPoint,w=n(S[0],S[1],c,h,p);e.arrowShapeImpl(this.name)(u,y,w)},gap:function(u){return s(u)*.8}}),o("triangle-tee",{points:[0,0,.15,-.3,-.15,-.3,0,0],pointsTee:[-.15,-.4,-.15,-.5,.15,-.5,.15,-.4],collide:function(u,c,h,p,v,y,S){var w=a(i(this.points,h+2*S,p,v)),T=a(i(this.pointsTee,h+2*S,p,v)),_=Ks(u,c,w)||Ks(u,c,T);return _},draw:function(u,c,h,p,v){var y=i(this.points,c,h,p),S=i(this.pointsTee,c,h,p);e.arrowShapeImpl(this.name)(u,y,S)}}),o("circle-triangle",{radius:.15,pointsTr:[0,-.15,.15,-.45,-.15,-.45,0,-.15],collide:function(u,c,h,p,v,y,S){var w=v,T=Math.pow(w.x-u,2)+Math.pow(w.y-c,2)<=Math.pow((h+2*S)*this.radius,2),_=a(i(this.points,h+2*S,p,v));return Ks(u,c,_)||T},draw:function(u,c,h,p,v){var y=i(this.pointsTr,c,h,p);e.arrowShapeImpl(this.name)(u,y,p.x,p.y,this.radius*c)},spacing:function(u){return e.getArrowWidth(u.pstyle("width").pfValue,u.pstyle("arrow-scale").value)*this.radius}}),o("triangle-cross",{points:[0,0,.15,-.3,-.15,-.3,0,0],baseCrossLinePts:[-.15,-.4,-.15,-.4,.15,-.4,.15,-.4],crossLinePts:function(u,c){var h=this.baseCrossLinePts.slice(),p=c/u,v=3,y=5;return h[v]=h[v]-p,h[y]=h[y]-p,h},collide:function(u,c,h,p,v,y,S){var w=a(i(this.points,h+2*S,p,v)),T=a(i(this.crossLinePts(h,y),h+2*S,p,v)),_=Ks(u,c,w)||Ks(u,c,T);return _},draw:function(u,c,h,p,v){var y=i(this.points,c,h,p),S=i(this.crossLinePts(c,v),c,h,p);e.arrowShapeImpl(this.name)(u,y,S)}}),o("vee",{points:[-.15,-.3,0,0,.15,-.3,0,-.15],gap:function(u){return s(u)*.525}}),o("circle",{radius:.15,collide:function(u,c,h,p,v,y,S){var w=v,T=Math.pow(w.x-u,2)+Math.pow(w.y-c,2)<=Math.pow((h+2*S)*this.radius,2);return T},draw:function(u,c,h,p,v){e.arrowShapeImpl(this.name)(u,p.x,p.y,this.radius*c)},spacing:function(u){return e.getArrowWidth(u.pstyle("width").pfValue,u.pstyle("arrow-scale").value)*this.radius}}),o("tee",{points:[-.15,0,-.15,-.1,.15,-.1,.15,0],spacing:function(u){return 1},gap:function(u){return 1}}),o("square",{points:[-.15,0,.15,0,.15,-.3,-.15,-.3]}),o("diamond",{points:[-.15,-.15,0,-.3,.15,-.15,0,0],gap:function(u){return u.pstyle("width").pfValue*u.pstyle("arrow-scale").value}}),o("chevron",{points:[0,0,-.15,-.15,-.1,-.2,0,-.1,.1,-.2,.15,-.15],gap:function(u){return .95*u.pstyle("width").pfValue*u.pstyle("arrow-scale").value}})};var Pf={};Pf.projectIntoViewport=function(t,e){var r=this.cy,n=this.findContainerClientCoords(),i=n[0],a=n[1],s=n[4],o=r.pan(),l=r.zoom(),u=((t-i)/s-o.x)/l,c=((e-a)/s-o.y)/l;return[u,c]};Pf.findContainerClientCoords=function(){if(this.containerBB)return this.containerBB;var t=this.container,e=t.getBoundingClientRect(),r=this.cy.window().getComputedStyle(t),n=function(T){return parseFloat(r.getPropertyValue(T))},i={left:n("padding-left"),right:n("padding-right"),top:n("padding-top"),bottom:n("padding-bottom")},a={left:n("border-left-width"),right:n("border-right-width"),top:n("border-top-width"),bottom:n("border-bottom-width")},s=t.clientWidth,o=t.clientHeight,l=i.left+i.right,u=i.top+i.bottom,c=a.left+a.right,h=e.width/(s+c),p=s-l,v=o-u,y=e.left+i.left+a.left,S=e.top+i.top+a.top;return this.containerBB=[y,S,p,v,h]};Pf.invalidateContainerClientCoordsCache=function(){this.containerBB=null};Pf.findNearestElement=function(t,e,r,n){return this.findNearestElements(t,e,r,n)[0]};Pf.findNearestElements=function(t,e,r,n){var i=this,a=this,s=a.getCachedZSortedEles(),o=[],l=a.cy.zoom(),u=a.cy.hasCompoundNodes(),c=(n?24:8)/l,h=(n?8:2)/l,p=(n?8:2)/l,v=1/0,y,S;r&&(s=s.interactive);function w(j,O){if(j.isNode()){if(S)return;S=j,o.push(j)}if(j.isEdge()&&(O==null||O<v))if(y){if(y.pstyle("z-compound-depth").value===j.pstyle("z-compound-depth").value&&y.pstyle("z-compound-depth").value===j.pstyle("z-compound-depth").value){for(var F=0;F<o.length;F++)if(o[F].isEdge()){o[F]=j,y=j,v=O??v;break}}}else o.push(j),y=j,v=O??v}function T(j){var O=j.outerWidth()+2*h,F=j.outerHeight()+2*h,B=O/2,$=F/2,Z=j.position(),D=j.pstyle("corner-radius").value==="auto"?"auto":j.pstyle("corner-radius").pfValue,H=j._private.rscratch;if(Z.x-B<=t&&t<=Z.x+B&&Z.y-$<=e&&e<=Z.y+$){var U=a.nodeShapes[i.getNodeShape(j)];if(U.checkPoint(t,e,0,O,F,Z.x,Z.y,D,H))return w(j,0),!0}}function _(j){var O=j._private,F=O.rscratch,B=j.pstyle("width").pfValue,$=j.pstyle("arrow-scale").value,Z=B/2+c,D=Z*Z,H=Z*2,Q=O.source,ne=O.target,U;if(F.edgeType==="segments"||F.edgeType==="straight"||F.edgeType==="haystack"){for(var W=F.allpts,Y=0;Y+3<W.length;Y+=2)if(eF(t,e,W[Y],W[Y+1],W[Y+2],W[Y+3],H)&&D>(U=aF(t,e,W[Y],W[Y+1],W[Y+2],W[Y+3])))return w(j,U),!0}else if(F.edgeType==="bezier"||F.edgeType==="multibezier"||F.edgeType==="self"||F.edgeType==="compound"){for(var W=F.allpts,Y=0;Y+5<F.allpts.length;Y+=4)if(tF(t,e,W[Y],W[Y+1],W[Y+2],W[Y+3],W[Y+4],W[Y+5],H)&&D>(U=iF(t,e,W[Y],W[Y+1],W[Y+2],W[Y+3],W[Y+4],W[Y+5])))return w(j,U),!0}for(var Q=Q||O.source,ne=ne||O.target,re=i.getArrowWidth(B,$),q=[{name:"source",x:F.arrowStartX,y:F.arrowStartY,angle:F.srcArrowAngle},{name:"target",x:F.arrowEndX,y:F.arrowEndY,angle:F.tgtArrowAngle},{name:"mid-source",x:F.midX,y:F.midY,angle:F.midsrcArrowAngle},{name:"mid-target",x:F.midX,y:F.midY,angle:F.midtgtArrowAngle}],Y=0;Y<q.length;Y++){var te=q[Y],ae=a.arrowShapes[j.pstyle(te.name+"-arrow-shape").value],de=j.pstyle("width").pfValue;if(ae.roughCollide(t,e,re,te.angle,{x:te.x,y:te.y},de,c)&&ae.collide(t,e,re,te.angle,{x:te.x,y:te.y},de,c))return w(j),!0}u&&o.length>0&&(T(Q),T(ne))}function C(j,O,F){return $s(j,O,F)}function N(j,O){var F=j._private,B=p,$;O?$=O+"-":$="",j.boundingBox();var Z=F.labelBounds[O||"main"],D=j.pstyle($+"label").value,H=j.pstyle("text-events").strValue==="yes";if(!(!H||!D)){var U=C(F.rscratch,"labelX",O),W=C(F.rscratch,"labelY",O),Y=C(F.rscratch,"labelAngle",O),Q=j.pstyle($+"text-margin-x").pfValue,ne=j.pstyle($+"text-margin-y").pfValue,re=Z.x1-B-Q,q=Z.x2+B-Q,te=Z.y1-B-ne,ae=Z.y2+B-ne;if(Y){var de=Math.cos(Y),ge=Math.sin(Y),ye=function(Se,Ve){return Se=Se-U,Ve=Ve-W,{x:Se*de-Ve*ge+U,y:Se*ge+Ve*de+W}},se=ye(re,te),fe=ye(re,ae),le=ye(q,te),pe=ye(q,ae),me=[se.x+Q,se.y+ne,le.x+Q,le.y+ne,pe.x+Q,pe.y+ne,fe.x+Q,fe.y+ne];if(Ks(t,e,me))return w(j),!0}else if(Od(Z,t,e))return w(j),!0}}for(var A=s.length-1;A>=0;A--){var I=s[A];I.isNode()?T(I)||N(I):_(I)||N(I)||N(I,"source")||N(I,"target")}return o};Pf.getAllInBox=function(t,e,r,n){var i=this.getCachedZSortedEles().interactive,a=this.cy.zoom(),s=2/a,o=[],l=Math.min(t,r),u=Math.max(t,r),c=Math.min(e,n),h=Math.max(e,n);t=l,r=u,e=c,n=h;var p=Ns({x1:t,y1:e,x2:r,y2:n}),v=[{x:p.x1,y:p.y1},{x:p.x2,y:p.y1},{x:p.x2,y:p.y2},{x:p.x1,y:p.y2}],y=[[v[0],v[1]],[v[1],v[2]],[v[2],v[3]],[v[3],v[0]]];function S(Se,Ve,$e){return $s(Se,Ve,$e)}function w(Se,Ve){var $e=Se._private,St=s,rt="";Se.boundingBox();var lt=$e.labelBounds.main;if(!lt)return null;var De=S($e.rscratch,"labelX",Ve),Le=S($e.rscratch,"labelY",Ve),Qe=S($e.rscratch,"labelAngle",Ve),Ce=Se.pstyle(rt+"text-margin-x").pfValue,Fe=Se.pstyle(rt+"text-margin-y").pfValue,Ke=lt.x1-St-Ce,mt=lt.x2+St-Ce,gt=lt.y1-St-Fe,yt=lt.y2+St-Fe;if(Qe){var jt=Math.cos(Qe),qt=Math.sin(Qe),wt=function(qe,ce){return qe=qe-De,ce=ce-Le,{x:qe*jt-ce*qt+De,y:qe*qt+ce*jt+Le}};return[wt(Ke,gt),wt(mt,gt),wt(mt,yt),wt(Ke,yt)]}else return[{x:Ke,y:gt},{x:mt,y:gt},{x:mt,y:yt},{x:Ke,y:yt}]}function T(Se,Ve,$e,St){function rt(lt,De,Le){return(Le.y-lt.y)*(De.x-lt.x)>(De.y-lt.y)*(Le.x-lt.x)}return rt(Se,$e,St)!==rt(Ve,$e,St)&&rt(Se,Ve,$e)!==rt(Se,Ve,St)}for(var _=0;_<i.length;_++){var C=i[_];if(C.isNode()){var N=C,A=N.pstyle("text-events").strValue==="yes",I=N.pstyle("box-selection").strValue,j=N.pstyle("box-select-labels").strValue==="yes";if(I==="none")continue;var O=(I==="overlap"||j)&&A,F=N.boundingBox({includeNodes:!0,includeEdges:!1,includeLabels:O});if(I==="contain"){var B=!1;if(j&&A){var $=w(N);$&&lw($,v)&&(o.push(N),B=!0)}!B&&XM(p,F)&&o.push(N)}else if(I==="overlap"&&a_(p,F)){var Z=N.boundingBox({includeNodes:!0,includeEdges:!0,includeLabels:!1,includeMainLabels:!1,includeSourceLabels:!1,includeTargetLabels:!1}),D=[{x:Z.x1,y:Z.y1},{x:Z.x2,y:Z.y1},{x:Z.x2,y:Z.y2},{x:Z.x1,y:Z.y2}];if(lw(D,v))o.push(N);else{var H=w(N);H&&lw(H,v)&&o.push(N)}}}else{var U=C,W=U._private,Y=W.rscratch,Q=U.pstyle("box-selection").strValue;if(Q==="none")continue;if(Q==="contain"){if(Y.startX!=null&&Y.startY!=null&&!Od(p,Y.startX,Y.startY)||Y.endX!=null&&Y.endY!=null&&!Od(p,Y.endX,Y.endY))continue;if(Y.edgeType==="bezier"||Y.edgeType==="multibezier"||Y.edgeType==="self"||Y.edgeType==="compound"||Y.edgeType==="segments"||Y.edgeType==="haystack"){for(var ne=W.rstyle.bezierPts||W.rstyle.linePts||W.rstyle.haystackPts,re=!0,q=0;q<ne.length;q++)if(!JE(p,ne[q])){re=!1;break}re&&o.push(U)}else Y.edgeType==="straight"&&o.push(U)}else if(Q==="overlap"){var te=!1;if(Y.startX!=null&&Y.startY!=null&&Y.endX!=null&&Y.endY!=null&&(Od(p,Y.startX,Y.startY)||Od(p,Y.endX,Y.endY)))o.push(U),te=!0;else if(!te&&Y.edgeType==="haystack"){for(var ae=W.rstyle.haystackPts,de=0;de<ae.length;de++)if(JE(p,ae[de])){o.push(U),te=!0;break}}if(!te){var ge=W.rstyle.bezierPts||W.rstyle.linePts||W.rstyle.haystackPts;if((!ge||ge.length<2)&&Y.edgeType==="straight"&&Y.startX!=null&&Y.startY!=null&&Y.endX!=null&&Y.endY!=null&&(ge=[{x:Y.startX,y:Y.startY},{x:Y.endX,y:Y.endY}]),!ge||ge.length<2)continue;for(var ye=0;ye<ge.length-1;ye++){for(var se=ge[ye],fe=ge[ye+1],le=0;le<y.length;le++){var pe=ji(y[le],2),me=pe[0],xe=pe[1];if(T(se,fe,me,xe)){o.push(U),te=!0;break}}if(te)break}}}}}return o};var fx={};fx.calculateArrowAngles=function(t){var e=t._private.rscratch,r=e.edgeType==="haystack",n=e.edgeType==="bezier",i=e.edgeType==="multibezier",a=e.edgeType==="segments",s=e.edgeType==="compound",o=e.edgeType==="self",l,u,c,h,p,v,T,_;if(r?(c=e.haystackPts[0],h=e.haystackPts[1],p=e.haystackPts[2],v=e.haystackPts[3]):(c=e.arrowStartX,h=e.arrowStartY,p=e.arrowEndX,v=e.arrowEndY),T=e.midX,_=e.midY,a)l=c-e.segpts[0],u=h-e.segpts[1];else if(i||s||o||n){var y=e.allpts,S=pa(y[0],y[2],y[4],.1),w=pa(y[1],y[3],y[5],.1);l=c-S,u=h-w}else l=c-T,u=h-_;e.srcArrowAngle=X0(l,u);var T=e.midX,_=e.midY;if(r&&(T=(c+p)/2,_=(h+v)/2),l=p-c,u=v-h,a){var y=e.allpts;if(y.length/2%2===0){var C=y.length/2,N=C-2;l=y[C]-y[N],u=y[C+1]-y[N+1]}else if(e.isRound)l=e.midVector[1],u=-e.midVector[0];else{var C=y.length/2-1,N=C-2;l=y[C]-y[N],u=y[C+1]-y[N+1]}}else if(i||s||o){var y=e.allpts,A=e.ctrlpts,I,j,O,F;if(A.length/2%2===0){var B=y.length/2-1,$=B+2,Z=$+2;I=pa(y[B],y[$],y[Z],0),j=pa(y[B+1],y[$+1],y[Z+1],0),O=pa(y[B],y[$],y[Z],1e-4),F=pa(y[B+1],y[$+1],y[Z+1],1e-4)}else{var $=y.length/2-1,B=$-2,Z=$+2;I=pa(y[B],y[$],y[Z],.4999),j=pa(y[B+1],y[$+1],y[Z+1],.4999),O=pa(y[B],y[$],y[Z],.5),F=pa(y[B+1],y[$+1],y[Z+1],.5)}l=O-I,u=F-j}if(e.midtgtArrowAngle=X0(l,u),e.midDispX=l,e.midDispY=u,l*=-1,u*=-1,a){var y=e.allpts;if(y.length/2%2!==0){if(!e.isRound){var C=y.length/2-1,D=C+2;l=-(y[D]-y[C]),u=-(y[D+1]-y[C+1])}}}if(e.midsrcArrowAngle=X0(l,u),a)l=p-e.segpts[e.segpts.length-2],u=v-e.segpts[e.segpts.length-1];else if(i||s||o||n){var y=e.allpts,H=y.length,S=pa(y[H-6],y[H-4],y[H-2],.9),w=pa(y[H-5],y[H-3],y[H-1],.9);l=p-S,u=v-w}else l=p-T,u=v-_;e.tgtArrowAngle=X0(l,u)};fx.getArrowWidth=fx.getArrowHeight=function(t,e){var r=this.arrowWidthCache=this.arrowWidthCache||{},n=r[t+", "+e];return n||(n=Math.max(Math.pow(t*13.37,.9),29)*e,r[t+", "+e]=n,n)};var HS,WS,yu={},zo={},DN,IN,Xh,Gy,tc,Gh,Kh,gu,gp,ay,WA,qA,qS,$S,jN,FN=function(e,r,n){n.x=r.x-e.x,n.y=r.y-e.y,n.len=Math.sqrt(n.x*n.x+n.y*n.y),n.nx=n.x/n.len,n.ny=n.y/n.len,n.ang=Math.atan2(n.ny,n.nx)},wz=function(e,r){r.x=e.x*-1,r.y=e.y*-1,r.nx=e.nx*-1,r.ny=e.ny*-1,r.ang=e.ang>0?-(Math.PI-e.ang):Math.PI+e.ang},Sz=function(e,r,n,i,a){if(e!==jN?FN(r,e,yu):wz(zo,yu),FN(r,n,zo),DN=yu.nx*zo.ny-yu.ny*zo.nx,IN=yu.nx*zo.nx-yu.ny*-zo.ny,tc=Math.asin(Math.max(-1,Math.min(1,DN))),Math.abs(tc)<1e-6){HS=r.x,WS=r.y,Kh=gp=0;return}Xh=1,Gy=!1,IN<0?tc<0?tc=Math.PI+tc:(tc=Math.PI-tc,Xh=-1,Gy=!0):tc>0&&(Xh=-1,Gy=!0),r.radius!==void 0?gp=r.radius:gp=i,Gh=tc/2,ay=Math.min(yu.len/2,zo.len/2),a?(gu=Math.abs(Math.cos(Gh)*gp/Math.sin(Gh)),gu>ay?(gu=ay,Kh=Math.abs(gu*Math.sin(Gh)/Math.cos(Gh))):Kh=gp):(gu=Math.min(ay,gp),Kh=Math.abs(gu*Math.sin(Gh)/Math.cos(Gh))),qS=r.x+zo.nx*gu,$S=r.y+zo.ny*gu,HS=qS-zo.ny*Kh*Xh,WS=$S+zo.nx*Kh*Xh,WA=r.x+yu.nx*gu,qA=r.y+yu.ny*gu,jN=r};function $A(t,e){e.radius===0?t.lineTo(e.cx,e.cy):t.arc(e.cx,e.cy,e.radius,e.startAngle,e.endAngle,e.counterClockwise)}function v_(t,e,r,n){var i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0;return n===0||e.radius===0?{cx:e.x,cy:e.y,radius:0,startX:e.x,startY:e.y,stopX:e.x,stopY:e.y,startAngle:void 0,endAngle:void 0,counterClockwise:void 0}:(Sz(t,e,r,n,i),{cx:HS,cy:WS,radius:Kh,startX:WA,startY:qA,stopX:qS,stopY:$S,startAngle:yu.ang+Math.PI/2*Xh,endAngle:zo.ang-Math.PI/2*Xh,counterClockwise:Gy})}var Tv=.01,kz=Math.sqrt(2*Tv),ds={};ds.findMidptPtsEtc=function(t,e){var r=e.posPts,n=e.intersectionPts,i=e.vectorNormInverse,a,s=t.pstyle("source-endpoint"),o=t.pstyle("target-endpoint"),l=s.units!=null&&o.units!=null,u=function(A,I,j,O){var F=O-I,B=j-A,$=Math.sqrt(B*B+F*F);return{x:-F/$,y:B/$}},c=t.pstyle("edge-distances").value;switch(c){case"node-position":a=r;break;case"intersection":a=n;break;case"endpoints":{if(l){var h=this.manualEndptToPx(t.source()[0],s),p=ji(h,2),v=p[0],y=p[1],S=this.manualEndptToPx(t.target()[0],o),w=ji(S,2),T=w[0],_=w[1],C={x1:v,y1:y,x2:T,y2:_};i=u(v,y,T,_),a=C}else rn("Edge ".concat(t.id()," has edge-distances:endpoints specified without manual endpoints specified via source-endpoint and target-endpoint.  Falling back on edge-distances:intersection (default).")),a=n;break}}return{midptPts:a,vectorNormInverse:i}};ds.findHaystackPoints=function(t){for(var e=0;e<t.length;e++){var r=t[e],n=r._private,i=n.rscratch;if(!i.haystack){var a=Math.random()*2*Math.PI;i.source={x:Math.cos(a),y:Math.sin(a)},a=Math.random()*2*Math.PI,i.target={x:Math.cos(a),y:Math.sin(a)}}var s=n.source,o=n.target,l=s.position(),u=o.position(),c=s.width(),h=o.width(),p=s.height(),v=o.height(),y=r.pstyle("haystack-radius").value,S=y/2;i.haystackPts=i.allpts=[i.source.x*c*S+l.x,i.source.y*p*S+l.y,i.target.x*h*S+u.x,i.target.y*v*S+u.y],i.midX=(i.allpts[0]+i.allpts[2])/2,i.midY=(i.allpts[1]+i.allpts[3])/2,i.edgeType="haystack",i.haystack=!0,this.storeEdgeProjections(r),this.calculateArrowAngles(r),this.recalculateEdgeLabelProjections(r),this.calculateLabelAngles(r)}};ds.findSegmentsPoints=function(t,e){var r=t._private.rscratch,n=t.pstyle("segment-weights"),i=t.pstyle("segment-distances"),a=t.pstyle("segment-radii"),s=t.pstyle("radius-type"),o=Math.min(n.pfValue.length,i.pfValue.length),l=a.pfValue[a.pfValue.length-1],u=s.pfValue[s.pfValue.length-1];r.edgeType="segments",r.segpts=[],r.radii=[],r.isArcRadius=[];for(var c=0;c<o;c++){var h=n.pfValue[c],p=i.pfValue[c],v=1-h,y=h,S=this.findMidptPtsEtc(t,e),w=S.midptPts,T=S.vectorNormInverse,_={x:w.x1*v+w.x2*y,y:w.y1*v+w.y2*y};r.segpts.push(_.x+T.x*p,_.y+T.y*p),r.radii.push(a.pfValue[c]!==void 0?a.pfValue[c]:l),r.isArcRadius.push((s.pfValue[c]!==void 0?s.pfValue[c]:u)==="arc-radius")}};ds.findLoopPoints=function(t,e,r,n){var i=t._private.rscratch,a=e.dirCounts,s=e.srcPos,o=t.pstyle("control-point-distances"),l=o?o.pfValue[0]:void 0,u=t.pstyle("loop-direction").pfValue,c=t.pstyle("loop-sweep").pfValue,h=t.pstyle("control-point-step-size").pfValue;i.edgeType="self";var p=r,v=h;n&&(p=0,v=l);var y=u-Math.PI/2,S=y-c/2,w=y+c/2,T=u+"_"+c;p=a[T]===void 0?a[T]=0:++a[T],i.ctrlpts=[s.x+Math.cos(S)*1.4*v*(p/3+1),s.y+Math.sin(S)*1.4*v*(p/3+1),s.x+Math.cos(w)*1.4*v*(p/3+1),s.y+Math.sin(w)*1.4*v*(p/3+1)]};ds.findCompoundLoopPoints=function(t,e,r,n){var i=t._private.rscratch;i.edgeType="compound";var a=e.srcPos,s=e.tgtPos,o=e.srcW,l=e.srcH,u=e.tgtW,c=e.tgtH,h=t.pstyle("control-point-step-size").pfValue,p=t.pstyle("control-point-distances"),v=p?p.pfValue[0]:void 0,y=r,S=h;n&&(y=0,S=v);var w=50,T={x:a.x-o/2,y:a.y-l/2},_={x:s.x-u/2,y:s.y-c/2},C={x:Math.min(T.x,_.x),y:Math.min(T.y,_.y)},N=.5,A=Math.max(N,Math.log(o*Tv)),I=Math.max(N,Math.log(u*Tv));i.ctrlpts=[C.x,C.y-(1+Math.pow(w,1.12)/100)*S*(y/3+1)*A,C.x-(1+Math.pow(w,1.12)/100)*S*(y/3+1)*I,C.y]};ds.findStraightEdgePoints=function(t){t._private.rscratch.edgeType="straight"};ds.findBezierPoints=function(t,e,r,n,i){var a=t._private.rscratch,s=t.pstyle("control-point-step-size").pfValue,o=t.pstyle("control-point-distances"),l=t.pstyle("control-point-weights"),u=o&&l?Math.min(o.value.length,l.value.length):1,c=o?o.pfValue[0]:void 0,h=l.value[0],p=n;a.edgeType=p?"multibezier":"bezier",a.ctrlpts=[];for(var v=0;v<u;v++){var y=(.5-e.eles.length/2+r)*s*(i?-1:1),S=void 0,w=i_(y);p&&(c=o?o.pfValue[v]:s,h=l.value[v]),n?S=c:S=c!==void 0?w*c:void 0;var T=S!==void 0?S:y,_=1-h,C=h,N=this.findMidptPtsEtc(t,e),A=N.midptPts,I=N.vectorNormInverse,j={x:A.x1*_+A.x2*C,y:A.y1*_+A.y2*C};a.ctrlpts.push(j.x+I.x*T,j.y+I.y*T)}};ds.findTaxiPoints=function(t,e){var r=t._private.rscratch;r.edgeType="segments";var n="vertical",i="horizontal",a="leftward",s="rightward",o="downward",l="upward",u="auto",c=e.posPts,h=e.srcW,p=e.srcH,v=e.tgtW,y=e.tgtH,S=t.pstyle("edge-distances").value,w=S!=="node-position",T=t.pstyle("taxi-direction").value,_=T,C=t.pstyle("taxi-turn"),N=C.units==="%",A=C.pfValue,I=A<0,j=t.pstyle("taxi-turn-min-distance").pfValue,O=w?(h+v)/2:0,F=w?(p+y)/2:0,B=c.x2-c.x1,$=c.y2-c.y1,Z=function(ce,ve){return ce>0?Math.max(ce-ve,0):Math.min(ce+ve,0)},D=Z(B,O),H=Z($,F),U=!1;_===u?T=Math.abs(D)>Math.abs(H)?i:n:_===l||_===o?(T=n,U=!0):(_===a||_===s)&&(T=i,U=!0);var W=T===n,Y=W?H:D,Q=W?$:B,ne=i_(Q),re=!1;!(U&&(N||I))&&(_===o&&Q<0||_===l&&Q>0||_===a&&Q>0||_===s&&Q<0)&&(ne*=-1,Y=ne*Math.abs(Y),re=!0);var q;if(N){var te=A<0?1+A:A;q=te*Y}else{var ae=A<0?Y:0;q=ae+A*ne}var de=function(ce){return Math.abs(ce)<j||Math.abs(ce)>=Math.abs(Y)},ge=de(q),ye=de(Math.abs(Y)-Math.abs(q)),se=ge||ye;if(se&&!re)if(W){var fe=Math.abs(Q)<=p/2,le=Math.abs(B)<=v/2;if(fe){var pe=(c.x1+c.x2)/2,me=c.y1,xe=c.y2;r.segpts=[pe,me,pe,xe]}else if(le){var Se=(c.y1+c.y2)/2,Ve=c.x1,$e=c.x2;r.segpts=[Ve,Se,$e,Se]}else r.segpts=[c.x1,c.y2]}else{var St=Math.abs(Q)<=h/2,rt=Math.abs($)<=y/2;if(St){var lt=(c.y1+c.y2)/2,De=c.x1,Le=c.x2;r.segpts=[De,lt,Le,lt]}else if(rt){var Qe=(c.x1+c.x2)/2,Ce=c.y1,Fe=c.y2;r.segpts=[Qe,Ce,Qe,Fe]}else r.segpts=[c.x2,c.y1]}else if(W){var Ke=c.y1+q+(w?p/2*ne:0),mt=c.x1,gt=c.x2;r.segpts=[mt,Ke,gt,Ke]}else{var yt=c.x1+q+(w?h/2*ne:0),jt=c.y1,qt=c.y2;r.segpts=[yt,jt,yt,qt]}if(r.isRound){var wt=t.pstyle("taxi-radius").value,ft=t.pstyle("radius-type").value[0]==="arc-radius";r.radii=new Array(r.segpts.length/2).fill(wt),r.isArcRadius=new Array(r.segpts.length/2).fill(ft)}};ds.tryToCorrectInvalidPoints=function(t,e){var r=t._private.rscratch;if(r.edgeType==="bezier"){var n=e.srcPos,i=e.tgtPos,a=e.srcW,s=e.srcH,o=e.tgtW,l=e.tgtH,u=e.srcShape,c=e.tgtShape,h=e.srcCornerRadius,p=e.tgtCornerRadius,v=e.srcRs,y=e.tgtRs,S=!bt(r.startX)||!bt(r.startY),w=!bt(r.arrowStartX)||!bt(r.arrowStartY),T=!bt(r.endX)||!bt(r.endY),_=!bt(r.arrowEndX)||!bt(r.arrowEndY),C=3,N=this.getArrowWidth(t.pstyle("width").pfValue,t.pstyle("arrow-scale").value)*this.arrowShapeWidth,A=C*N,I=mf({x:r.ctrlpts[0],y:r.ctrlpts[1]},{x:r.startX,y:r.startY}),j=I<A,O=mf({x:r.ctrlpts[0],y:r.ctrlpts[1]},{x:r.endX,y:r.endY}),F=O<A,B=!1;if(S||w||j){B=!0;var $={x:r.ctrlpts[0]-n.x,y:r.ctrlpts[1]-n.y},Z=Math.sqrt($.x*$.x+$.y*$.y),D={x:$.x/Z,y:$.y/Z},H=Math.max(a,s),U={x:r.ctrlpts[0]+D.x*2*H,y:r.ctrlpts[1]+D.y*2*H},W=u.intersectLine(n.x,n.y,a,s,U.x,U.y,0,h,v);j?(r.ctrlpts[0]=r.ctrlpts[0]+D.x*(A-I),r.ctrlpts[1]=r.ctrlpts[1]+D.y*(A-I)):(r.ctrlpts[0]=W[0]+D.x*A,r.ctrlpts[1]=W[1]+D.y*A)}if(T||_||F){B=!0;var Y={x:r.ctrlpts[0]-i.x,y:r.ctrlpts[1]-i.y},Q=Math.sqrt(Y.x*Y.x+Y.y*Y.y),ne={x:Y.x/Q,y:Y.y/Q},re=Math.max(a,s),q={x:r.ctrlpts[0]+ne.x*2*re,y:r.ctrlpts[1]+ne.y*2*re},te=c.intersectLine(i.x,i.y,o,l,q.x,q.y,0,p,y);F?(r.ctrlpts[0]=r.ctrlpts[0]+ne.x*(A-O),r.ctrlpts[1]=r.ctrlpts[1]+ne.y*(A-O)):(r.ctrlpts[0]=te[0]+ne.x*A,r.ctrlpts[1]=te[1]+ne.y*A)}B&&this.findEndpoints(t)}};ds.storeAllpts=function(t){var e=t._private.rscratch;if(e.edgeType==="multibezier"||e.edgeType==="bezier"||e.edgeType==="self"||e.edgeType==="compound"){e.allpts=[],e.allpts.push(e.startX,e.startY);for(var r=0;r+1<e.ctrlpts.length;r+=2)e.allpts.push(e.ctrlpts[r],e.ctrlpts[r+1]),r+3<e.ctrlpts.length&&e.allpts.push((e.ctrlpts[r]+e.ctrlpts[r+2])/2,(e.ctrlpts[r+1]+e.ctrlpts[r+3])/2);e.allpts.push(e.endX,e.endY);var n,i;e.ctrlpts.length/2%2===0?(n=e.allpts.length/2-1,e.midX=e.allpts[n],e.midY=e.allpts[n+1]):(n=e.allpts.length/2-3,i=.5,e.midX=pa(e.allpts[n],e.allpts[n+2],e.allpts[n+4],i),e.midY=pa(e.allpts[n+1],e.allpts[n+3],e.allpts[n+5],i))}else if(e.edgeType==="straight")e.allpts=[e.startX,e.startY,e.endX,e.endY],e.midX=(e.startX+e.endX+e.arrowStartX+e.arrowEndX)/4,e.midY=(e.startY+e.endY+e.arrowStartY+e.arrowEndY)/4;else if(e.edgeType==="segments"){if(e.allpts=[],e.allpts.push(e.startX,e.startY),e.allpts.push.apply(e.allpts,e.segpts),e.allpts.push(e.endX,e.endY),e.isRound){e.roundCorners=[];for(var a=2;a+3<e.allpts.length;a+=2){var s=e.radii[a/2-1],o=e.isArcRadius[a/2-1];e.roundCorners.push(v_({x:e.allpts[a-2],y:e.allpts[a-1]},{x:e.allpts[a],y:e.allpts[a+1],radius:s},{x:e.allpts[a+2],y:e.allpts[a+3]},s,o))}}if(e.segpts.length%4===0){var l=e.segpts.length/2,u=l-2;e.midX=(e.segpts[u]+e.segpts[l])/2,e.midY=(e.segpts[u+1]+e.segpts[l+1])/2}else{var c=e.segpts.length/2-1;if(!e.isRound)e.midX=e.segpts[c],e.midY=e.segpts[c+1];else{var h={x:e.segpts[c],y:e.segpts[c+1]},p=e.roundCorners[c/2];if(p.radius===0){var v={x:e.segpts[c+2],y:e.segpts[c+3]};e.midX=h.x,e.midY=h.y,e.midVector=[h.y-v.y,v.x-h.x]}else{var y=[h.x-p.cx,h.y-p.cy],S=p.radius/Math.sqrt(Math.pow(y[0],2)+Math.pow(y[1],2));y=y.map(function(w){return w*S}),e.midX=p.cx+y[0],e.midY=p.cy+y[1],e.midVector=y}}}}};ds.checkForInvalidEdgeWarning=function(t){var e=t[0]._private.rscratch;e.nodesOverlap||bt(e.startX)&&bt(e.startY)&&bt(e.endX)&&bt(e.endY)?e.loggedErr=!1:e.loggedErr||(e.loggedErr=!0,rn("Edge `"+t.id()+"` has invalid endpoints and so it is impossible to draw.  Adjust your edge style (e.g. control points) accordingly or use an alternative edge type.  This is expected behaviour when the source node and the target node overlap."))};ds.findEdgeControlPoints=function(t){var e=this;if(!(!t||t.length===0)){for(var r=this,n=r.cy,i=n.hasCompoundNodes(),a=new cc,s=function(F,B){return[].concat(nx(F),[B?1:0]).join("-")},o=[],l=[],u=0;u<t.length;u++){var c=t[u],h=c._private,p=c.pstyle("curve-style").value;if(!(c.removed()||!c.takesUpSpace())){if(p==="haystack"){l.push(c);continue}var v=p==="unbundled-bezier"||Ld(p,"segments")||p==="straight"||p==="straight-triangle"||Ld(p,"taxi"),y=p==="unbundled-bezier"||p==="bezier",S=h.source,w=h.target,T=S.poolIndex(),_=w.poolIndex(),C=[T,_].sort(),N=s(C,v),A=a.get(N);A==null&&(A={eles:[]},o.push({pairId:C,edgeIsUnbundled:v}),a.set(N,A)),A.eles.push(c),v&&(A.hasUnbundled=!0),y&&(A.hasBezier=!0)}}for(var I=function(){var F=o[j],B=F.pairId,$=F.edgeIsUnbundled,Z=s(B,$),D=a.get(Z),H;if(!D.hasUnbundled){var U=D.eles[0].parallelEdges().filter(function(ft){return ft.isBundledBezier()});r_(D.eles),U.forEach(function(ft){return D.eles.push(ft)}),D.eles.sort(function(ft,qe){return ft.poolIndex()-qe.poolIndex()})}var W=D.eles[0],Y=W.source(),Q=W.target();if(Y.poolIndex()>Q.poolIndex()){var ne=Y;Y=Q,Q=ne}var re=D.srcPos=Y.position(),q=D.tgtPos=Q.position(),te=D.srcW=Y.outerWidth(),ae=D.srcH=Y.outerHeight(),de=D.tgtW=Q.outerWidth(),ge=D.tgtH=Q.outerHeight(),ye=D.srcShape=r.nodeShapes[e.getNodeShape(Y)],se=D.tgtShape=r.nodeShapes[e.getNodeShape(Q)],fe=D.srcCornerRadius=Y.pstyle("corner-radius").value==="auto"?"auto":Y.pstyle("corner-radius").pfValue,le=D.tgtCornerRadius=Q.pstyle("corner-radius").value==="auto"?"auto":Q.pstyle("corner-radius").pfValue,pe=D.tgtRs=Q._private.rscratch,me=D.srcRs=Y._private.rscratch;D.dirCounts={north:0,west:0,south:0,east:0,northwest:0,southwest:0,northeast:0,southeast:0};for(var xe=0;xe<D.eles.length;xe++){var Se=D.eles[xe],Ve=Se[0]._private.rscratch,$e=Se.pstyle("curve-style").value,St=$e==="unbundled-bezier"||Ld($e,"segments")||Ld($e,"taxi"),rt=!Y.same(Se.source());if(!D.calculatedIntersection&&Y!==Q&&(D.hasBezier||D.hasUnbundled)){D.calculatedIntersection=!0;var lt=ye.intersectLine(re.x,re.y,te,ae,q.x,q.y,0,fe,me),De=D.srcIntn=lt,Le=se.intersectLine(q.x,q.y,de,ge,re.x,re.y,0,le,pe),Qe=D.tgtIntn=Le,Ce=D.intersectionPts={x1:lt[0],x2:Le[0],y1:lt[1],y2:Le[1]},Fe=D.posPts={x1:re.x,x2:q.x,y1:re.y,y2:q.y},Ke=Le[1]-lt[1],mt=Le[0]-lt[0],gt=Math.sqrt(mt*mt+Ke*Ke);bt(gt)&&gt>=kz||(gt=Math.sqrt(Math.max(mt*mt,Tv)+Math.max(Ke*Ke,Tv)));var yt=D.vector={x:mt,y:Ke},jt=D.vectorNorm={x:yt.x/gt,y:yt.y/gt},qt={x:-jt.y,y:jt.x};D.nodesOverlap=!bt(gt)||se.checkPoint(lt[0],lt[1],0,de,ge,q.x,q.y,le,pe)||ye.checkPoint(Le[0],Le[1],0,te,ae,re.x,re.y,fe,me),D.vectorNormInverse=qt,H={nodesOverlap:D.nodesOverlap,dirCounts:D.dirCounts,calculatedIntersection:!0,hasBezier:D.hasBezier,hasUnbundled:D.hasUnbundled,eles:D.eles,srcPos:q,srcRs:pe,tgtPos:re,tgtRs:me,srcW:de,srcH:ge,tgtW:te,tgtH:ae,srcIntn:Qe,tgtIntn:De,srcShape:se,tgtShape:ye,posPts:{x1:Fe.x2,y1:Fe.y2,x2:Fe.x1,y2:Fe.y1},intersectionPts:{x1:Ce.x2,y1:Ce.y2,x2:Ce.x1,y2:Ce.y1},vector:{x:-yt.x,y:-yt.y},vectorNorm:{x:-jt.x,y:-jt.y},vectorNormInverse:{x:-qt.x,y:-qt.y}}}var wt=rt?H:D;Ve.nodesOverlap=wt.nodesOverlap,Ve.srcIntn=wt.srcIntn,Ve.tgtIntn=wt.tgtIntn,Ve.isRound=$e.startsWith("round"),i&&(Y.isParent()||Y.isChild()||Q.isParent()||Q.isChild())&&(Y.parents().anySame(Q)||Q.parents().anySame(Y)||Y.same(Q)&&Y.isParent())?e.findCompoundLoopPoints(Se,wt,xe,St):Y===Q?e.findLoopPoints(Se,wt,xe,St):$e.endsWith("segments")?e.findSegmentsPoints(Se,wt):$e.endsWith("taxi")?e.findTaxiPoints(Se,wt):$e==="straight"||!St&&D.eles.length%2===1&&xe===Math.floor(D.eles.length/2)?e.findStraightEdgePoints(Se):e.findBezierPoints(Se,wt,xe,St,rt),e.findEndpoints(Se),e.tryToCorrectInvalidPoints(Se,wt),e.checkForInvalidEdgeWarning(Se),e.storeAllpts(Se),e.storeEdgeProjections(Se),e.calculateArrowAngles(Se),e.recalculateEdgeLabelProjections(Se),e.calculateLabelAngles(Se)}},j=0;j<o.length;j++)I();this.findHaystackPoints(l)}};function KA(t){var e=[];if(t!=null){for(var r=0;r<t.length;r+=2){var n=t[r],i=t[r+1];e.push({x:n,y:i})}return e}}ds.getSegmentPoints=function(t){var e=t[0]._private.rscratch;this.recalculateRenderedStyle(t);var r=e.edgeType;if(r==="segments")return KA(e.segpts)};ds.getControlPoints=function(t){var e=t[0]._private.rscratch;this.recalculateRenderedStyle(t);var r=e.edgeType;if(r==="bezier"||r==="multibezier"||r==="self"||r==="compound")return KA(e.ctrlpts)};ds.getEdgeMidpoint=function(t){var e=t[0]._private.rscratch;return this.recalculateRenderedStyle(t),{x:e.midX,y:e.midY}};var r0={};r0.manualEndptToPx=function(t,e){var r=this,n=t.position(),i=t.outerWidth(),a=t.outerHeight(),s=t._private.rscratch;if(e.value.length===2){var o=[e.pfValue[0],e.pfValue[1]];return e.units[0]==="%"&&(o[0]=o[0]*i),e.units[1]==="%"&&(o[1]=o[1]*a),o[0]+=n.x,o[1]+=n.y,o}else{var l=e.pfValue[0];l=-Math.PI/2+l;var u=2*Math.max(i,a),c=[n.x+Math.cos(l)*u,n.y+Math.sin(l)*u];return r.nodeShapes[this.getNodeShape(t)].intersectLine(n.x,n.y,i,a,c[0],c[1],0,t.pstyle("corner-radius").value==="auto"?"auto":t.pstyle("corner-radius").pfValue,s)}};r0.findEndpoints=function(t){var e,r,n,i,a=this,s,o=t.source()[0],l=t.target()[0],u=o.position(),c=l.position(),h=t.pstyle("target-arrow-shape").value,p=t.pstyle("source-arrow-shape").value,v=t.pstyle("target-distance-from-node").pfValue,y=t.pstyle("source-distance-from-node").pfValue,S=o._private.rscratch,w=l._private.rscratch,T=t.pstyle("curve-style").value,_=t._private.rscratch,C=_.edgeType,N=Ld(T,"taxi"),A=C==="self"||C==="compound",I=C==="bezier"||C==="multibezier"||A,j=C!=="bezier",O=C==="straight"||C==="segments",F=C==="segments",B=I||j||O,$=A||N,Z=t.pstyle("source-endpoint"),D=$?"outside-to-node":Z.value,H=o.pstyle("corner-radius").value==="auto"?"auto":o.pstyle("corner-radius").pfValue,U=t.pstyle("target-endpoint"),W=$?"outside-to-node":U.value,Y=l.pstyle("corner-radius").value==="auto"?"auto":l.pstyle("corner-radius").pfValue;_.srcManEndpt=Z,_.tgtManEndpt=U;var Q,ne,re,q,te=(e=(U==null||(r=U.pfValue)===null||r===void 0?void 0:r.length)===2?U.pfValue:null)!==null&&e!==void 0?e:[0,0],ae=(n=(Z==null||(i=Z.pfValue)===null||i===void 0?void 0:i.length)===2?Z.pfValue:null)!==null&&n!==void 0?n:[0,0];if(I){var de=[_.ctrlpts[0],_.ctrlpts[1]],ge=j?[_.ctrlpts[_.ctrlpts.length-2],_.ctrlpts[_.ctrlpts.length-1]]:de;Q=ge,ne=de}else if(O){var ye=F?_.segpts.slice(0,2):[c.x+te[0],c.y+te[1]],se=F?_.segpts.slice(_.segpts.length-2):[u.x+ae[0],u.y+ae[1]];Q=se,ne=ye}if(W==="inside-to-node")s=[c.x,c.y];else if(U.units)s=this.manualEndptToPx(l,U);else if(W==="outside-to-line")s=_.tgtIntn;else if(W==="outside-to-node"||W==="outside-to-node-or-label"?re=Q:(W==="outside-to-line"||W==="outside-to-line-or-label")&&(re=[u.x,u.y]),s=a.nodeShapes[this.getNodeShape(l)].intersectLine(c.x,c.y,l.outerWidth(),l.outerHeight(),re[0],re[1],0,Y,w),W==="outside-to-node-or-label"||W==="outside-to-line-or-label"){var fe=l._private.rscratch,le=fe.labelWidth,pe=fe.labelHeight,me=fe.labelX,xe=fe.labelY,Se=le/2,Ve=pe/2,$e=l.pstyle("text-valign").value;$e==="top"?xe-=Ve:$e==="bottom"&&(xe+=Ve);var St=l.pstyle("text-halign").value;St==="left"?me-=Se:St==="right"&&(me+=Se);var rt=Sv(re[0],re[1],[me-Se,xe-Ve,me+Se,xe-Ve,me+Se,xe+Ve,me-Se,xe+Ve],c.x,c.y);if(rt.length>0){var lt=u,De=$h(lt,Rp(s)),Le=$h(lt,Rp(rt)),Qe=De;if(Le<De&&(s=rt,Qe=Le),rt.length>2){var Ce=$h(lt,{x:rt[2],y:rt[3]});Ce<Qe&&(s=[rt[2],rt[3]])}}}var Fe=Q0(s,Q,a.arrowShapes[h].spacing(t)+v),Ke=Q0(s,Q,a.arrowShapes[h].gap(t)+v);if(_.endX=Ke[0],_.endY=Ke[1],_.arrowEndX=Fe[0],_.arrowEndY=Fe[1],D==="inside-to-node")s=[u.x,u.y];else if(Z.units)s=this.manualEndptToPx(o,Z);else if(D==="outside-to-line")s=_.srcIntn;else if(D==="outside-to-node"||D==="outside-to-node-or-label"?q=ne:(D==="outside-to-line"||D==="outside-to-line-or-label")&&(q=[c.x,c.y]),s=a.nodeShapes[this.getNodeShape(o)].intersectLine(u.x,u.y,o.outerWidth(),o.outerHeight(),q[0],q[1],0,H,S),D==="outside-to-node-or-label"||D==="outside-to-line-or-label"){var mt=o._private.rscratch,gt=mt.labelWidth,yt=mt.labelHeight,jt=mt.labelX,qt=mt.labelY,wt=gt/2,ft=yt/2,qe=o.pstyle("text-valign").value;qe==="top"?qt-=ft:qe==="bottom"&&(qt+=ft);var ce=o.pstyle("text-halign").value;ce==="left"?jt-=wt:ce==="right"&&(jt+=wt);var ve=Sv(q[0],q[1],[jt-wt,qt-ft,jt+wt,qt-ft,jt+wt,qt+ft,jt-wt,qt+ft],u.x,u.y);if(ve.length>0){var ke=c,Te=$h(ke,Rp(s)),Re=$h(ke,Rp(ve)),Je=Te;if(Re<Te&&(s=[ve[0],ve[1]],Je=Re),ve.length>2){var ze=$h(ke,{x:ve[2],y:ve[3]});ze<Je&&(s=[ve[2],ve[3]])}}}var vt=Q0(s,ne,a.arrowShapes[p].spacing(t)+y),pt=Q0(s,ne,a.arrowShapes[p].gap(t)+y);_.startX=pt[0],_.startY=pt[1],_.arrowStartX=vt[0],_.arrowStartY=vt[1],B&&(!bt(_.startX)||!bt(_.startY)||!bt(_.endX)||!bt(_.endY)?_.badLine=!0:_.badLine=!1)};r0.getSourceEndpoint=function(t){var e=t[0]._private.rscratch;return this.recalculateRenderedStyle(t),e.edgeType==="haystack"?{x:e.haystackPts[0],y:e.haystackPts[1]}:{x:e.arrowStartX,y:e.arrowStartY}};r0.getTargetEndpoint=function(t){var e=t[0]._private.rscratch;return this.recalculateRenderedStyle(t),e.edgeType==="haystack"?{x:e.haystackPts[2],y:e.haystackPts[3]}:{x:e.arrowEndX,y:e.arrowEndY}};var y_={};function _z(t,e,r){for(var n=function(u,c,h,p){return pa(u,c,h,p)},i=e._private,a=i.rstyle.bezierPts,s=0;s<t.bezierProjPcts.length;s++){var o=t.bezierProjPcts[s];a.push({x:n(r[0],r[2],r[4],o),y:n(r[1],r[3],r[5],o)})}}y_.storeEdgeProjections=function(t){var e=t._private,r=e.rscratch,n=r.edgeType;if(e.rstyle.bezierPts=null,e.rstyle.linePts=null,e.rstyle.haystackPts=null,n==="multibezier"||n==="bezier"||n==="self"||n==="compound"){e.rstyle.bezierPts=[];for(var i=0;i+5<r.allpts.length;i+=4)_z(this,t,r.allpts.slice(i,i+6))}else if(n==="segments")for(var a=e.rstyle.linePts=[],i=0;i+1<r.allpts.length;i+=2)a.push({x:r.allpts[i],y:r.allpts[i+1]});else if(n==="haystack"){var s=r.haystackPts;e.rstyle.haystackPts=[{x:s[0],y:s[1]},{x:s[2],y:s[3]}]}e.rstyle.arrowWidth=this.getArrowWidth(t.pstyle("width").pfValue,t.pstyle("arrow-scale").value)*this.arrowShapeWidth};y_.recalculateEdgeProjections=function(t){this.findEdgeControlPoints(t)};var Au={};Au.recalculateNodeLabelProjection=function(t){var e=t.pstyle("label").strValue;if(!Zd(e)){var r,n,i=t._private,a=t.width(),s=t.height(),o=t.padding(),l=t.position(),u=t.pstyle("text-halign").strValue,c=t.pstyle("text-valign").strValue,h=i.rscratch,p=i.rstyle;switch(u){case"left":r=l.x-a/2-o;break;case"right":r=l.x+a/2+o;break;default:r=l.x}switch(c){case"top":n=l.y-s/2-o;break;case"bottom":n=l.y+s/2+o;break;default:n=l.y}h.labelX=r,h.labelY=n,p.labelX=r,p.labelY=n,this.calculateLabelAngles(t),this.applyLabelDimensions(t)}};var ZA=function(e,r){var n=Math.atan(r/e);return e===0&&n<0&&(n=n*-1),n},YA=function(e,r){var n=r.x-e.x,i=r.y-e.y;return ZA(n,i)},Cz=function(e,r,n,i){var a=wv(0,i-.001,1),s=wv(0,i+.001,1),o=jp(e,r,n,a),l=jp(e,r,n,s);return YA(o,l)};Au.recalculateEdgeLabelProjections=function(t){var e,r=t._private,n=r.rscratch,i=this,a={mid:t.pstyle("label").strValue,source:t.pstyle("source-label").strValue,target:t.pstyle("target-label").strValue};if(a.mid||a.source||a.target){e={x:n.midX,y:n.midY};var s=function(h,p,v){uc(r.rscratch,h,p,v),uc(r.rstyle,h,p,v)};s("labelX",null,e.x),s("labelY",null,e.y);var o=ZA(n.midDispX,n.midDispY);s("labelAutoAngle",null,o);var l=function(){if(l.cache)return l.cache;for(var h=[],p=0;p+5<n.allpts.length;p+=4){var v={x:n.allpts[p],y:n.allpts[p+1]},y={x:n.allpts[p+2],y:n.allpts[p+3]},S={x:n.allpts[p+4],y:n.allpts[p+5]};h.push({p0:v,p1:y,p2:S,startDist:0,length:0,segments:[]})}var w=r.rstyle.bezierPts,T=i.bezierProjPcts.length;function _(j,O,F,B,$){var Z=mf(O,F),D=j.segments[j.segments.length-1],H={p0:O,p1:F,t0:B,t1:$,startDist:D?D.startDist+D.length:0,length:Z};j.segments.push(H),j.length+=Z}for(var C=0;C<h.length;C++){var N=h[C],A=h[C-1];A&&(N.startDist=A.startDist+A.length),_(N,N.p0,w[C*T],0,i.bezierProjPcts[0]);for(var I=0;I<T-1;I++)_(N,w[C*T+I],w[C*T+I+1],i.bezierProjPcts[I],i.bezierProjPcts[I+1]);_(N,w[C*T+T-1],N.p2,i.bezierProjPcts[T-1],1)}return l.cache=h},u=function(h){var p,v=h==="source";if(a[h]){var y=t.pstyle(h+"-text-offset").pfValue;switch(n.edgeType){case"self":case"compound":case"bezier":case"multibezier":{for(var S=l(),w,T=0,_=0,C=0;C<S.length;C++){for(var N=S[v?C:S.length-1-C],A=0;A<N.segments.length;A++){var I=N.segments[v?A:N.segments.length-1-A],j=C===S.length-1&&A===N.segments.length-1;if(T=_,_+=I.length,_>=y||j){w={cp:N,segment:I};break}}if(w)break}var O=w.cp,F=w.segment,B=(y-T)/F.length,$=F.t1-F.t0,Z=v?F.t0+$*B:F.t1-$*B;Z=wv(0,Z,1),e=jp(O.p0,O.p1,O.p2,Z),p=Cz(O.p0,O.p1,O.p2,Z);break}case"straight":case"segments":case"haystack":{for(var D=0,H,U,W,Y,Q=n.allpts.length,ne=0;ne+3<Q&&(v?(W={x:n.allpts[ne],y:n.allpts[ne+1]},Y={x:n.allpts[ne+2],y:n.allpts[ne+3]}):(W={x:n.allpts[Q-2-ne],y:n.allpts[Q-1-ne]},Y={x:n.allpts[Q-4-ne],y:n.allpts[Q-3-ne]}),H=mf(W,Y),U=D,D+=H,!(D>=y));ne+=2);var re=y-U,q=re/H;q=wv(0,q,1),e=$9(W,Y,q),p=YA(W,Y);break}}s("labelX",h,e.x),s("labelY",h,e.y),s("labelAutoAngle",h,p)}};u("source"),u("target"),this.applyLabelDimensions(t)}};Au.applyLabelDimensions=function(t){this.applyPrefixedLabelDimensions(t),t.isEdge()&&(this.applyPrefixedLabelDimensions(t,"source"),this.applyPrefixedLabelDimensions(t,"target"))};Au.applyPrefixedLabelDimensions=function(t,e){var r=t._private,n=this.getLabelText(t,e),i=pf(n,t._private.labelDimsKey);if($s(r.rscratch,"prefixedLabelDimsKey",e)!==i){uc(r.rscratch,"prefixedLabelDimsKey",e,i);var a=this.calculateLabelDimensions(t,n),s=t.pstyle("line-height").pfValue,o=t.pstyle("text-wrap").strValue,l=$s(r.rscratch,"labelWrapCachedLines",e)||[],u=o!=="wrap"?1:Math.max(l.length,1),c=a.height/u,h=c*s,p=a.width,v=a.height+(u-1)*(s-1)*c;uc(r.rstyle,"labelWidth",e,p),uc(r.rscratch,"labelWidth",e,p),uc(r.rstyle,"labelHeight",e,v),uc(r.rscratch,"labelHeight",e,v),uc(r.rscratch,"labelLineHeight",e,h)}};Au.getLabelText=function(t,e){var r=t._private,n=e?e+"-":"",i=t.pstyle(n+"label").strValue,a=t.pstyle("text-transform").value,s=function(ae,de){return de?(uc(r.rscratch,ae,e,de),de):$s(r.rscratch,ae,e)};if(!i)return"";a=="none"||(a=="uppercase"?i=i.toUpperCase():a=="lowercase"&&(i=i.toLowerCase()));var o=t.pstyle("text-wrap").value;if(o==="wrap"){var l=s("labelKey");if(l!=null&&s("labelWrapKey")===l)return s("labelWrapCachedText");for(var u="",c=i.split(`
`),h=t.pstyle("text-max-width").pfValue,p=t.pstyle("text-overflow-wrap").value,v=p==="anywhere",y=[],S=/[\s\u200b]+|$/g,w=0;w<c.length;w++){var T=c[w],_=this.calculateLabelDimensions(t,T),C=_.width;if(v){var N=T.split("").join(u);T=N}if(C>h){var A=T.matchAll(S),I="",j=0,O=Ys(A),F;try{for(O.s();!(F=O.n()).done;){var B=F.value,$=B[0],Z=T.substring(j,B.index);j=B.index+$.length;var D=I.length===0?Z:I+Z+$,H=this.calculateLabelDimensions(t,D),U=H.width;U<=h?I+=Z+$:(I&&y.push(I),I=Z+$)}}catch(te){O.e(te)}finally{O.f()}I.match(/^[\s\u200b]+$/)||y.push(I)}else y.push(T)}s("labelWrapCachedLines",y),i=s("labelWrapCachedText",y.join(`
`)),s("labelWrapKey",l)}else if(o==="ellipsis"){var W=t.pstyle("text-max-width").pfValue,Y="",Q="",ne=!1;if(this.calculateLabelDimensions(t,i).width<W)return i;for(var re=0;re<i.length;re++){var q=this.calculateLabelDimensions(t,Y+i[re]+Q).width;if(q>W)break;Y+=i[re],re===i.length-1&&(ne=!0)}return ne||(Y+=Q),Y}return i};Au.getLabelJustification=function(t){var e=t.pstyle("text-justification").strValue,r=t.pstyle("text-halign").strValue;if(e==="auto")if(t.isNode())switch(r){case"left":return"right";case"right":return"left";default:return"center"}else return"center";else return e};Au.calculateLabelDimensions=function(t,e){var r=this,n=r.cy.window(),i=n.document,a=0,s=t.pstyle("font-style").strValue,o=t.pstyle("font-size").pfValue,l=t.pstyle("font-family").strValue,u=t.pstyle("font-weight").strValue,c=this.labelCalcCanvas,h=this.labelCalcCanvasContext;if(!c){c=this.labelCalcCanvas=i.createElement("canvas"),h=this.labelCalcCanvasContext=c.getContext("2d");var p=c.style;p.position="absolute",p.left="-9999px",p.top="-9999px",p.zIndex="-1",p.visibility="hidden",p.pointerEvents="none"}h.font="".concat(s," ").concat(u," ").concat(o,"px ").concat(l);for(var v=0,y=0,S=e.split(`
`),w=0;w<S.length;w++){var T=S[w],_=h.measureText(T),C=Math.ceil(_.width),N=o;v=Math.max(C,v),y+=N}return v+=a,y+=a,{width:v,height:y}};Au.calculateLabelAngle=function(t,e){var r=t._private,n=r.rscratch,i=t.isEdge(),a=e?e+"-":"",s=t.pstyle(a+"text-rotation"),o=s.strValue;return o==="none"?0:i&&o==="autorotate"?n.labelAutoAngle:o==="autorotate"?0:s.pfValue};Au.calculateLabelAngles=function(t){var e=this,r=t.isEdge(),n=t._private,i=n.rscratch;i.labelAngle=e.calculateLabelAngle(t),r&&(i.sourceLabelAngle=e.calculateLabelAngle(t,"source"),i.targetLabelAngle=e.calculateLabelAngle(t,"target"))};var XA={},BN=28,zN=!1;XA.getNodeShape=function(t){var e=this,r=t.pstyle("shape").value;if(r==="cutrectangle"&&(t.width()<BN||t.height()<BN))return zN||(rn("The `cutrectangle` node shape can not be used at small sizes so `rectangle` is used instead"),zN=!0),"rectangle";if(t.isParent())return r==="rectangle"||r==="roundrectangle"||r==="round-rectangle"||r==="cutrectangle"||r==="cut-rectangle"||r==="barrel"?r:"rectangle";if(r==="polygon"){var n=t.pstyle("shape-polygon-points").value;return e.nodeShapes.makePolygon(n).name}return r};var I1={};I1.registerCalculationListeners=function(){var t=this.cy,e=t.collection(),r=this,n=function(s){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(e.merge(s),o)for(var l=0;l<s.length;l++){var u=s[l],c=u._private,h=c.rstyle;h.clean=!1,h.cleanConnected=!1}};r.binder(t).on("bounds.* dirty.*",function(s){var o=s.target;n(o)}).on("style.* background.*",function(s){var o=s.target;n(o,!1)});var i=function(s){if(s){var o=r.onUpdateEleCalcsFns;e.cleanStyle();for(var l=0;l<e.length;l++){var u=e[l],c=u._private.rstyle;u.isNode()&&!c.cleanConnected&&(n(u.connectedEdges()),c.cleanConnected=!0)}if(o)for(var h=0;h<o.length;h++){var p=o[h];p(s,e)}r.recalculateRenderedStyle(e),e=t.collection()}};r.flushRenderedStyleQueue=function(){i(!0)},r.beforeRender(i,r.beforeRenderPriorities.eleCalcs)};I1.onUpdateEleCalcs=function(t){var e=this.onUpdateEleCalcsFns=this.onUpdateEleCalcsFns||[];e.push(t)};I1.recalculateRenderedStyle=function(t,e){var r=function(N){return N._private.rstyle.cleanConnected};if(t.length!==0){var n=[],i=[];if(!this.destroyed){e===void 0&&(e=!0);for(var a=0;a<t.length;a++){var s=t[a],o=s._private,l=o.rstyle;s.isEdge()&&(!r(s.source())||!r(s.target()))&&(l.clean=!1),s.isEdge()&&s.isBundledBezier()&&s.parallelEdges().some(function(C){return!C._private.rstyle.clean&&C.isBundledBezier()})&&(l.clean=!1),!(e&&l.clean||s.removed())&&s.pstyle("display").value!=="none"&&(o.group==="nodes"?i.push(s):n.push(s),l.clean=!0)}for(var u=0;u<i.length;u++){var c=i[u],h=c._private,p=h.rstyle,v=c.position();this.recalculateNodeLabelProjection(c),p.nodeX=v.x,p.nodeY=v.y,p.nodeW=c.pstyle("width").pfValue,p.nodeH=c.pstyle("height").pfValue}this.recalculateEdgeProjections(n);for(var y=0;y<n.length;y++){var S=n[y],w=S._private,T=w.rstyle,_=w.rscratch;T.srcX=_.arrowStartX,T.srcY=_.arrowStartY,T.tgtX=_.arrowEndX,T.tgtY=_.arrowEndY,T.midX=_.midX,T.midY=_.midY,T.labelAngle=_.labelAngle,T.sourceLabelAngle=_.sourceLabelAngle,T.targetLabelAngle=_.targetLabelAngle}}}};var j1={};j1.updateCachedGrabbedEles=function(){var t=this.cachedZSortedEles;if(t){t.drag=[],t.nondrag=[];for(var e=[],r=0;r<t.length;r++){var n=t[r],i=n._private.rscratch;n.grabbed()&&!n.isParent()?e.push(n):i.inDragLayer?t.drag.push(n):t.nondrag.push(n)}for(var r=0;r<e.length;r++){var n=e[r];t.drag.push(n)}}};j1.invalidateCachedZSortedEles=function(){this.cachedZSortedEles=null};j1.getCachedZSortedEles=function(t){if(t||!this.cachedZSortedEles){var e=this.cy.mutableElements().toArray();e.sort(RA),e.interactive=e.filter(function(r){return r.interactive()}),this.cachedZSortedEles=e,this.updateCachedGrabbedEles()}else e=this.cachedZSortedEles;return e};var QA={};[Pf,fx,ds,r0,y_,Au,XA,I1,j1].forEach(function(t){er(QA,t)});var JA={};JA.getCachedImage=function(t,e,r){var n=this,i=n.imageCache=n.imageCache||{},a=i[t];if(a)return a.image.complete||a.image.addEventListener("load",r),a.image;a=i[t]=i[t]||{};var s=a.image=new Image;s.addEventListener("load",r),s.addEventListener("error",function(){s.error=!0});var o="data:",l=t.substring(0,o.length).toLowerCase()===o;return l||(e=e==="null"?null:e,s.crossOrigin=e),s.src=t,s};var fm={};fm.registerBinding=function(t,e,r,n){var i=Array.prototype.slice.apply(arguments,[1]);if(Array.isArray(t)){for(var a=[],s=0;s<t.length;s++){var o=t[s];if(o!==void 0){var l=this.binder(o);a.push(l.on.apply(l,i))}}return a}var l=this.binder(t);return l.on.apply(l,i)};fm.binder=function(t){var e=this,r=e.cy.window(),n=t===r||t===r.document||t===r.document.body||jj(t);if(e.supportsPassiveEvents==null){var i=!1;try{var a=Object.defineProperty({},"passive",{get:function(){return i=!0,!0}});r.addEventListener("test",null,a)}catch{}e.supportsPassiveEvents=i}var s=function(l,u,c){var h=Array.prototype.slice.call(arguments);return n&&e.supportsPassiveEvents&&(h[2]={capture:c??!1,passive:!1,once:!1}),e.bindings.push({target:t,args:h}),(t.addEventListener||t.on).apply(t,h),this};return{on:s,addEventListener:s,addListener:s,bind:s}};fm.nodeIsDraggable=function(t){return t&&t.isNode()&&!t.locked()&&t.grabbable()};fm.nodeIsGrabbable=function(t){return this.nodeIsDraggable(t)&&t.interactive()};fm.load=function(){var t=this,e=t.cy.window(),r=function(ce){return ce.selected()},n=function(ce){var ve=ce.getRootNode();if(ve&&ve.nodeType===11&&ve.host!==void 0)return ve},i=function(ce,ve,ke,Te){ce==null&&(ce=t.cy);for(var Re=0;Re<ve.length;Re++){var Je=ve[Re];ce.emit({originalEvent:ke,type:Je,position:Te})}},a=function(ce){return ce.shiftKey||ce.metaKey||ce.ctrlKey},s=function(ce,ve){var ke=!0;if(t.cy.hasCompoundNodes()&&ce&&ce.pannable())for(var Te=0;ve&&Te<ve.length;Te++){var ce=ve[Te];if(ce.isNode()&&ce.isParent()&&!ce.pannable()){ke=!1;break}}else ke=!0;return ke},o=function(ce){ce[0]._private.grabbed=!0},l=function(ce){ce[0]._private.grabbed=!1},u=function(ce){ce[0]._private.rscratch.inDragLayer=!0},c=function(ce){ce[0]._private.rscratch.inDragLayer=!1},h=function(ce){ce[0]._private.rscratch.isGrabTarget=!0},p=function(ce){ce[0]._private.rscratch.isGrabTarget=!1},v=function(ce,ve){var ke=ve.addToList,Te=ke.has(ce);!Te&&ce.grabbable()&&!ce.locked()&&(ke.merge(ce),o(ce))},y=function(ce,ve){if(ce.cy().hasCompoundNodes()&&!(ve.inDragLayer==null&&ve.addToList==null)){var ke=ce.descendants();ve.inDragLayer&&(ke.forEach(u),ke.connectedEdges().forEach(u)),ve.addToList&&v(ke,ve)}},S=function(ce,ve){ve=ve||{};var ke=ce.cy().hasCompoundNodes();ve.inDragLayer&&(ce.forEach(u),ce.neighborhood().stdFilter(function(Te){return!ke||Te.isEdge()}).forEach(u)),ve.addToList&&ce.forEach(function(Te){v(Te,ve)}),y(ce,ve),_(ce,{inDragLayer:ve.inDragLayer}),t.updateCachedGrabbedEles()},w=S,T=function(ce){ce&&(t.getCachedZSortedEles().forEach(function(ve){l(ve),c(ve),p(ve)}),t.updateCachedGrabbedEles())},_=function(ce,ve){if(!(ve.inDragLayer==null&&ve.addToList==null)&&ce.cy().hasCompoundNodes()){var ke=ce.ancestors().orphans();if(!ke.same(ce)){var Te=ke.descendants().spawnSelf().merge(ke).unmerge(ce).unmerge(ce.descendants()),Re=Te.connectedEdges();ve.inDragLayer&&(Re.forEach(u),Te.forEach(u)),ve.addToList&&Te.forEach(function(Je){v(Je,ve)})}}},C=function(){document.activeElement!=null&&document.activeElement.blur!=null&&document.activeElement.blur()},N=typeof MutationObserver<"u",A=typeof ResizeObserver<"u";N?(t.removeObserver=new MutationObserver(function(qe){for(var ce=0;ce<qe.length;ce++){var ve=qe[ce],ke=ve.removedNodes;if(ke)for(var Te=0;Te<ke.length;Te++){var Re=ke[Te];if(Re===t.container){t.destroy();break}}}}),t.container.parentNode&&t.removeObserver.observe(t.container.parentNode,{childList:!0})):t.registerBinding(t.container,"DOMNodeRemoved",function(qe){t.destroy()});var I=Qv(function(){t.cy.resize()},100);N&&(t.styleObserver=new MutationObserver(I),t.styleObserver.observe(t.container,{attributes:!0})),t.registerBinding(e,"resize",I),A&&(t.resizeObserver=new ResizeObserver(I),t.resizeObserver.observe(t.container));var j=function(ce,ve){for(;ce!=null;)ve(ce),ce=ce.parentNode},O=function(){t.invalidateContainerClientCoordsCache()};j(t.container,function(qe){t.registerBinding(qe,"transitionend",O),t.registerBinding(qe,"animationend",O),t.registerBinding(qe,"scroll",O)}),t.registerBinding(t.container,"contextmenu",function(qe){qe.preventDefault()});var F=function(){return t.selection[4]!==0},B=function(ce){for(var ve=t.findContainerClientCoords(),ke=ve[0],Te=ve[1],Re=ve[2],Je=ve[3],ze=ce.touches?ce.touches:[ce],vt=!1,pt=0;pt<ze.length;pt++){var At=ze[pt];if(ke<=At.clientX&&At.clientX<=ke+Re&&Te<=At.clientY&&At.clientY<=Te+Je){vt=!0;break}}if(!vt)return!1;for(var Ut=t.container,Kt=ce.target,Ct=Kt.parentNode,Yt=!1;Ct;){if(Ct===Ut){Yt=!0;break}Ct=Ct.parentNode}return!!Yt};t.registerBinding(t.container,"mousedown",function(ce){if(B(ce)&&!(t.hoverData.which===1&&ce.which!==1)){ce.preventDefault(),C(),t.hoverData.capture=!0,t.hoverData.which=ce.which;var ve=t.cy,ke=[ce.clientX,ce.clientY],Te=t.projectIntoViewport(ke[0],ke[1]),Re=t.selection,Je=t.findNearestElements(Te[0],Te[1],!0,!1),ze=Je[0],vt=t.dragData.possibleDragElements;t.hoverData.mdownPos=Te,t.hoverData.mdownGPos=ke;var pt=function(Xt){return{originalEvent:ce,type:Xt,position:{x:Te[0],y:Te[1]}}},At=function(){t.hoverData.tapholdCancelled=!1,clearTimeout(t.hoverData.tapholdTimeout),t.hoverData.tapholdTimeout=setTimeout(function(){if(!t.hoverData.tapholdCancelled){var Xt=t.hoverData.down;Xt?Xt.emit(pt("taphold")):ve.emit(pt("taphold"))}},t.tapholdDuration)};if(ce.which==3){t.hoverData.cxtStarted=!0;var Ut={originalEvent:ce,type:"cxttapstart",position:{x:Te[0],y:Te[1]}};ze?(ze.activate(),ze.emit(Ut),t.hoverData.down=ze):ve.emit(Ut),t.hoverData.downTime=new Date().getTime(),t.hoverData.cxtDragged=!1}else if(ce.which==1){ze&&ze.activate();{if(ze!=null&&t.nodeIsGrabbable(ze)){var Kt=function(Xt){Xt.emit(pt("grab"))};if(h(ze),!ze.selected())vt=t.dragData.possibleDragElements=ve.collection(),w(ze,{addToList:vt}),ze.emit(pt("grabon")).emit(pt("grab"));else{vt=t.dragData.possibleDragElements=ve.collection();var Ct=ve.$(function(Yt){return Yt.isNode()&&Yt.selected()&&t.nodeIsGrabbable(Yt)});S(Ct,{addToList:vt}),ze.emit(pt("grabon")),Ct.forEach(Kt)}t.redrawHint("eles",!0),t.redrawHint("drag",!0)}t.hoverData.down=ze,t.hoverData.downs=Je,t.hoverData.downTime=new Date().getTime()}i(ze,["mousedown","tapstart","vmousedown"],ce,{x:Te[0],y:Te[1]}),ze==null?(Re[4]=1,t.data.bgActivePosistion={x:Te[0],y:Te[1]},t.redrawHint("select",!0),t.redraw()):ze.pannable()&&(Re[4]=1),At()}Re[0]=Re[2]=Te[0],Re[1]=Re[3]=Te[1]}},!1);var $=n(t.container);t.registerBinding([e,$],"mousemove",function(ce){var ve=t.hoverData.capture;if(!(!ve&&!B(ce))){var ke=!1,Te=t.cy,Re=Te.zoom(),Je=[ce.clientX,ce.clientY],ze=t.projectIntoViewport(Je[0],Je[1]),vt=t.hoverData.mdownPos,pt=t.hoverData.mdownGPos,At=t.selection,Ut=null;!t.hoverData.draggingEles&&!t.hoverData.dragging&&!t.hoverData.selecting&&(Ut=t.findNearestElement(ze[0],ze[1],!0,!1));var Kt=t.hoverData.last,Ct=t.hoverData.down,Yt=[ze[0]-At[2],ze[1]-At[3]],Xt=t.dragData.possibleDragElements,Lr;if(pt){var ar=Je[0]-pt[0],mn=ar*ar,Wr=Je[1]-pt[1],Br=Wr*Wr,nn=mn+Br;t.hoverData.isOverThresholdDrag=Lr=nn>=t.desktopTapThreshold2}var br=a(ce);Lr&&(t.hoverData.tapholdCancelled=!0);var Tt=function(){var vi=t.hoverData.dragDelta=t.hoverData.dragDelta||[];vi.length===0?(vi.push(Yt[0]),vi.push(Yt[1])):(vi[0]+=Yt[0],vi[1]+=Yt[1])};ke=!0,i(Ut,["mousemove","vmousemove","tapdrag"],ce,{x:ze[0],y:ze[1]});var zr=function(vi){return{originalEvent:ce,type:vi,position:{x:ze[0],y:ze[1]}}},Qn=function(){t.data.bgActivePosistion=void 0,t.hoverData.selecting||Te.emit(zr("boxstart")),At[4]=1,t.hoverData.selecting=!0,t.redrawHint("select",!0),t.redraw()};if(t.hoverData.which===3){if(Lr){var Ji=zr("cxtdrag");Ct?Ct.emit(Ji):Te.emit(Ji),t.hoverData.cxtDragged=!0,(!t.hoverData.cxtOver||Ut!==t.hoverData.cxtOver)&&(t.hoverData.cxtOver&&t.hoverData.cxtOver.emit(zr("cxtdragout")),t.hoverData.cxtOver=Ut,Ut&&Ut.emit(zr("cxtdragover")))}}else if(t.hoverData.dragging){if(ke=!0,Te.panningEnabled()&&Te.userPanningEnabled()){var Ka;if(t.hoverData.justStartedPan){var Rs=t.hoverData.mdownPos;Ka={x:(ze[0]-Rs[0])*Re,y:(ze[1]-Rs[1])*Re},t.hoverData.justStartedPan=!1}else Ka={x:Yt[0]*Re,y:Yt[1]*Re};Te.panBy(Ka),Te.emit(zr("dragpan")),t.hoverData.dragged=!0}ze=t.projectIntoViewport(ce.clientX,ce.clientY)}else if(At[4]==1&&(Ct==null||Ct.pannable())){if(Lr){if(!t.hoverData.dragging&&Te.boxSelectionEnabled()&&(br||!Te.panningEnabled()||!Te.userPanningEnabled()))Qn();else if(!t.hoverData.selecting&&Te.panningEnabled()&&Te.userPanningEnabled()){var Ln=s(Ct,t.hoverData.downs);Ln&&(t.hoverData.dragging=!0,t.hoverData.justStartedPan=!0,At[4]=0,t.data.bgActivePosistion=Rp(vt),t.redrawHint("select",!0),t.redraw())}Ct&&Ct.pannable()&&Ct.active()&&Ct.unactivate()}}else{if(Ct&&Ct.pannable()&&Ct.active()&&Ct.unactivate(),(!Ct||!Ct.grabbed())&&Ut!=Kt&&(Kt&&i(Kt,["mouseout","tapdragout"],ce,{x:ze[0],y:ze[1]}),Ut&&i(Ut,["mouseover","tapdragover"],ce,{x:ze[0],y:ze[1]}),t.hoverData.last=Ut),Ct)if(Lr){if(Te.boxSelectionEnabled()&&br)Ct&&Ct.grabbed()&&(T(Xt),Ct.emit(zr("freeon")),Xt.emit(zr("free")),t.dragData.didDrag&&(Ct.emit(zr("dragfreeon")),Xt.emit(zr("dragfree")))),Qn();else if(Ct&&Ct.grabbed()&&t.nodeIsDraggable(Ct)){var un=!t.dragData.didDrag;un&&t.redrawHint("eles",!0),t.dragData.didDrag=!0,t.hoverData.draggingEles||S(Xt,{inDragLayer:!0});var bn={x:0,y:0};if(bt(Yt[0])&&bt(Yt[1])&&(bn.x+=Yt[0],bn.y+=Yt[1],un)){var Jn=t.hoverData.dragDelta;Jn&&bt(Jn[0])&&bt(Jn[1])&&(bn.x+=Jn[0],bn.y+=Jn[1])}t.hoverData.draggingEles=!0,Xt.silentShift(bn).emit(zr("position")).emit(zr("drag")),t.redrawHint("drag",!0),t.redraw()}}else Tt();ke=!0}if(At[2]=ze[0],At[3]=ze[1],ke)return ce.stopPropagation&&ce.stopPropagation(),ce.preventDefault&&ce.preventDefault(),!1}},!1);var Z,D,H;t.registerBinding(e,"mouseup",function(ce){if(!(t.hoverData.which===1&&ce.which!==1&&t.hoverData.capture)){var ve=t.hoverData.capture;if(ve){t.hoverData.capture=!1;var ke=t.cy,Te=t.projectIntoViewport(ce.clientX,ce.clientY),Re=t.selection,Je=t.findNearestElement(Te[0],Te[1],!0,!1),ze=t.dragData.possibleDragElements,vt=t.hoverData.down,pt=a(ce);t.data.bgActivePosistion&&(t.redrawHint("select",!0),t.redraw()),t.hoverData.tapholdCancelled=!0,t.data.bgActivePosistion=void 0,vt&&vt.unactivate();var At=function(ar){return{originalEvent:ce,type:ar,position:{x:Te[0],y:Te[1]}}};if(t.hoverData.which===3){var Ut=At("cxttapend");if(vt?vt.emit(Ut):ke.emit(Ut),!t.hoverData.cxtDragged){var Kt=At("cxttap");vt?vt.emit(Kt):ke.emit(Kt)}t.hoverData.cxtDragged=!1,t.hoverData.which=null}else if(t.hoverData.which===1){if(i(Je,["mouseup","tapend","vmouseup"],ce,{x:Te[0],y:Te[1]}),!t.dragData.didDrag&&!t.hoverData.dragged&&!t.hoverData.selecting&&!t.hoverData.isOverThresholdDrag&&(i(vt,["click","tap","vclick"],ce,{x:Te[0],y:Te[1]}),D=!1,ce.timeStamp-H<=ke.multiClickDebounceTime()?(Z&&clearTimeout(Z),D=!0,H=null,i(vt,["dblclick","dbltap","vdblclick"],ce,{x:Te[0],y:Te[1]})):(Z=setTimeout(function(){D||i(vt,["oneclick","onetap","voneclick"],ce,{x:Te[0],y:Te[1]})},ke.multiClickDebounceTime()),H=ce.timeStamp)),vt==null&&!t.dragData.didDrag&&!t.hoverData.selecting&&!t.hoverData.dragged&&!a(ce)&&(ke.$(r).unselect(["tapunselect"]),ze.length>0&&t.redrawHint("eles",!0),t.dragData.possibleDragElements=ze=ke.collection()),Je==vt&&!t.dragData.didDrag&&!t.hoverData.selecting&&Je!=null&&Je._private.selectable&&(t.hoverData.dragging||(ke.selectionType()==="additive"||pt?Je.selected()?Je.unselect(["tapunselect"]):Je.select(["tapselect"]):pt||(ke.$(r).unmerge(Je).unselect(["tapunselect"]),Je.select(["tapselect"]))),t.redrawHint("eles",!0)),t.hoverData.selecting){var Ct=ke.collection(t.getAllInBox(Re[0],Re[1],Re[2],Re[3]));t.redrawHint("select",!0),Ct.length>0&&t.redrawHint("eles",!0),ke.emit(At("boxend"));var Yt=function(ar){return ar.selectable()&&!ar.selected()};ke.selectionType()==="additive"||pt||ke.$(r).unmerge(Ct).unselect(),Ct.emit(At("box")).stdFilter(Yt).select().emit(At("boxselect")),t.redraw()}if(t.hoverData.dragging&&(t.hoverData.dragging=!1,t.redrawHint("select",!0),t.redrawHint("eles",!0),t.redraw()),!Re[4]){t.redrawHint("drag",!0),t.redrawHint("eles",!0);var Xt=vt&&vt.grabbed();T(ze),Xt&&(vt.emit(At("freeon")),ze.emit(At("free")),t.dragData.didDrag&&(vt.emit(At("dragfreeon")),ze.emit(At("dragfree"))))}}Re[4]=0,t.hoverData.down=null,t.hoverData.cxtStarted=!1,t.hoverData.draggingEles=!1,t.hoverData.selecting=!1,t.hoverData.isOverThresholdDrag=!1,t.dragData.didDrag=!1,t.hoverData.dragged=!1,t.hoverData.dragDelta=[],t.hoverData.mdownPos=null,t.hoverData.mdownGPos=null,t.hoverData.which=null}}},!1);var U=[],W=4,Y,Q=1e5,ne=function(ce,ve){for(var ke=0;ke<ce.length;ke++)if(ce[ke]%ve!==0)return!1;return!0},re=function(ce){for(var ve=Math.abs(ce[0]),ke=1;ke<ce.length;ke++)if(Math.abs(ce[ke])!==ve)return!1;return!0},q=function(ce){var ve=!1,ke=ce.deltaY;if(ke==null&&(ce.wheelDeltaY!=null?ke=ce.wheelDeltaY/4:ce.wheelDelta!=null&&(ke=ce.wheelDelta/4)),ke!==0){if(Y==null)if(U.length>=W){var Te=U;if(Y=ne(Te,5),!Y){var Re=Math.abs(Te[0]);Y=re(Te)&&Re>5}if(Y)for(var Je=0;Je<Te.length;Je++)Q=Math.min(Math.abs(Te[Je]),Q)}else U.push(ke),ve=!0;else Y&&(Q=Math.min(Math.abs(ke),Q));if(!t.scrollingPage){var ze=t.cy,vt=ze.zoom(),pt=ze.pan(),At=t.projectIntoViewport(ce.clientX,ce.clientY),Ut=[At[0]*vt+pt.x,At[1]*vt+pt.y];if(t.hoverData.draggingEles||t.hoverData.dragging||t.hoverData.cxtStarted||F()){ce.preventDefault();return}if(ze.panningEnabled()&&ze.userPanningEnabled()&&ze.zoomingEnabled()&&ze.userZoomingEnabled()){ce.preventDefault(),t.data.wheelZooming=!0,clearTimeout(t.data.wheelTimeout),t.data.wheelTimeout=setTimeout(function(){t.data.wheelZooming=!1,t.redrawHint("eles",!0),t.redraw()},150);var Kt;ve&&Math.abs(ke)>5&&(ke=i_(ke)*5),Kt=ke/-250,Y&&(Kt/=Q,Kt*=3),Kt=Kt*t.wheelSensitivity;var Ct=ce.deltaMode===1;Ct&&(Kt*=33);var Yt=ze.zoom()*Math.pow(10,Kt);ce.type==="gesturechange"&&(Yt=t.gestureStartZoom*ce.scale),ze.zoom({level:Yt,renderedPosition:{x:Ut[0],y:Ut[1]}}),ze.emit({type:ce.type==="gesturechange"?"pinchzoom":"scrollzoom",originalEvent:ce,position:{x:At[0],y:At[1]}})}}}};t.registerBinding(t.container,"wheel",q,!0),t.registerBinding(e,"scroll",function(ce){t.scrollingPage=!0,clearTimeout(t.scrollingPageTimeout),t.scrollingPageTimeout=setTimeout(function(){t.scrollingPage=!1},250)},!0),t.registerBinding(t.container,"gesturestart",function(ce){t.gestureStartZoom=t.cy.zoom(),t.hasTouchStarted||ce.preventDefault()},!0),t.registerBinding(t.container,"gesturechange",function(qe){t.hasTouchStarted||q(qe)},!0),t.registerBinding(t.container,"mouseout",function(ce){var ve=t.projectIntoViewport(ce.clientX,ce.clientY);t.cy.emit({originalEvent:ce,type:"mouseout",position:{x:ve[0],y:ve[1]}})},!1),t.registerBinding(t.container,"mouseover",function(ce){var ve=t.projectIntoViewport(ce.clientX,ce.clientY);t.cy.emit({originalEvent:ce,type:"mouseover",position:{x:ve[0],y:ve[1]}})},!1);var te,ae,de,ge,ye,se,fe,le,pe,me,xe,Se,Ve,$e=function(ce,ve,ke,Te){return Math.sqrt((ke-ce)*(ke-ce)+(Te-ve)*(Te-ve))},St=function(ce,ve,ke,Te){return(ke-ce)*(ke-ce)+(Te-ve)*(Te-ve)},rt;t.registerBinding(t.container,"touchstart",rt=function(ce){if(t.hasTouchStarted=!0,!!B(ce)){C(),t.touchData.capture=!0,t.data.bgActivePosistion=void 0;var ve=t.cy,ke=t.touchData.now,Te=t.touchData.earlier;if(ce.touches[0]){var Re=t.projectIntoViewport(ce.touches[0].clientX,ce.touches[0].clientY);ke[0]=Re[0],ke[1]=Re[1]}if(ce.touches[1]){var Re=t.projectIntoViewport(ce.touches[1].clientX,ce.touches[1].clientY);ke[2]=Re[0],ke[3]=Re[1]}if(ce.touches[2]){var Re=t.projectIntoViewport(ce.touches[2].clientX,ce.touches[2].clientY);ke[4]=Re[0],ke[5]=Re[1]}var Je=function(br){return{originalEvent:ce,type:br,position:{x:ke[0],y:ke[1]}}};if(ce.touches[1]){t.touchData.singleTouchMoved=!0,T(t.dragData.touchDragEles);var ze=t.findContainerClientCoords();pe=ze[0],me=ze[1],xe=ze[2],Se=ze[3],te=ce.touches[0].clientX-pe,ae=ce.touches[0].clientY-me,de=ce.touches[1].clientX-pe,ge=ce.touches[1].clientY-me,Ve=0<=te&&te<=xe&&0<=de&&de<=xe&&0<=ae&&ae<=Se&&0<=ge&&ge<=Se;var vt=ve.pan(),pt=ve.zoom();ye=$e(te,ae,de,ge),se=St(te,ae,de,ge),fe=[(te+de)/2,(ae+ge)/2],le=[(fe[0]-vt.x)/pt,(fe[1]-vt.y)/pt];var At=200,Ut=At*At;if(se<Ut&&!ce.touches[2]){var Kt=t.findNearestElement(ke[0],ke[1],!0,!0),Ct=t.findNearestElement(ke[2],ke[3],!0,!0);Kt&&Kt.isNode()?(Kt.activate().emit(Je("cxttapstart")),t.touchData.start=Kt):Ct&&Ct.isNode()?(Ct.activate().emit(Je("cxttapstart")),t.touchData.start=Ct):ve.emit(Je("cxttapstart")),t.touchData.start&&(t.touchData.start._private.grabbed=!1),t.touchData.cxt=!0,t.touchData.cxtDragged=!1,t.data.bgActivePosistion=void 0,t.redraw();return}}if(ce.touches[2])ve.boxSelectionEnabled()&&ce.preventDefault();else if(!ce.touches[1]){if(ce.touches[0]){var Yt=t.findNearestElements(ke[0],ke[1],!0,!0),Xt=Yt[0];if(Xt!=null&&(Xt.activate(),t.touchData.start=Xt,t.touchData.starts=Yt,t.nodeIsGrabbable(Xt))){var Lr=t.dragData.touchDragEles=ve.collection(),ar=null;t.redrawHint("eles",!0),t.redrawHint("drag",!0),Xt.selected()?(ar=ve.$(function(nn){return nn.selected()&&t.nodeIsGrabbable(nn)}),S(ar,{addToList:Lr})):w(Xt,{addToList:Lr}),h(Xt),Xt.emit(Je("grabon")),ar?ar.forEach(function(nn){nn.emit(Je("grab"))}):Xt.emit(Je("grab"))}i(Xt,["touchstart","tapstart","vmousedown"],ce,{x:ke[0],y:ke[1]}),Xt==null&&(t.data.bgActivePosistion={x:Re[0],y:Re[1]},t.redrawHint("select",!0),t.redraw()),t.touchData.singleTouchMoved=!1,t.touchData.singleTouchStartTime=+new Date,clearTimeout(t.touchData.tapholdTimeout),t.touchData.tapholdTimeout=setTimeout(function(){t.touchData.singleTouchMoved===!1&&!t.pinching&&!t.touchData.selecting&&i(t.touchData.start,["taphold"],ce,{x:ke[0],y:ke[1]})},t.tapholdDuration)}}if(ce.touches.length>=1){for(var mn=t.touchData.startPosition=[null,null,null,null,null,null],Wr=0;Wr<ke.length;Wr++)mn[Wr]=Te[Wr]=ke[Wr];var Br=ce.touches[0];t.touchData.startGPosition=[Br.clientX,Br.clientY]}}},!1);var lt;t.registerBinding(e,"touchmove",lt=function(ce){var ve=t.touchData.capture;if(!(!ve&&!B(ce))){var ke=t.selection,Te=t.cy,Re=t.touchData.now,Je=t.touchData.earlier,ze=Te.zoom();if(ce.touches[0]){var vt=t.projectIntoViewport(ce.touches[0].clientX,ce.touches[0].clientY);Re[0]=vt[0],Re[1]=vt[1]}if(ce.touches[1]){var vt=t.projectIntoViewport(ce.touches[1].clientX,ce.touches[1].clientY);Re[2]=vt[0],Re[3]=vt[1]}if(ce.touches[2]){var vt=t.projectIntoViewport(ce.touches[2].clientX,ce.touches[2].clientY);Re[4]=vt[0],Re[5]=vt[1]}var pt=function(sr){return{originalEvent:ce,type:sr,position:{x:Re[0],y:Re[1]}}},At=t.touchData.startGPosition,Ut;if(ve&&ce.touches[0]&&At){for(var Kt=[],Ct=0;Ct<Re.length;Ct++)Kt[Ct]=Re[Ct]-Je[Ct];var Yt=ce.touches[0].clientX-At[0],Xt=Yt*Yt,Lr=ce.touches[0].clientY-At[1],ar=Lr*Lr,mn=Xt+ar;Ut=mn>=t.touchTapThreshold2}if(ve&&t.touchData.cxt){ce.preventDefault();var Wr=ce.touches[0].clientX-pe,Br=ce.touches[0].clientY-me,nn=ce.touches[1].clientX-pe,br=ce.touches[1].clientY-me,Tt=St(Wr,Br,nn,br),zr=Tt/se,Qn=150,Ji=Qn*Qn,Ka=1.5,Rs=Ka*Ka;if(zr>=Rs||Tt>=Ji){t.touchData.cxt=!1,t.data.bgActivePosistion=void 0,t.redrawHint("select",!0);var Ln=pt("cxttapend");t.touchData.start?(t.touchData.start.unactivate().emit(Ln),t.touchData.start=null):Te.emit(Ln)}}if(ve&&t.touchData.cxt){var Ln=pt("cxtdrag");t.data.bgActivePosistion=void 0,t.redrawHint("select",!0),t.touchData.start?t.touchData.start.emit(Ln):Te.emit(Ln),t.touchData.start&&(t.touchData.start._private.grabbed=!1),t.touchData.cxtDragged=!0;var un=t.findNearestElement(Re[0],Re[1],!0,!0);(!t.touchData.cxtOver||un!==t.touchData.cxtOver)&&(t.touchData.cxtOver&&t.touchData.cxtOver.emit(pt("cxtdragout")),t.touchData.cxtOver=un,un&&un.emit(pt("cxtdragover")))}else if(ve&&ce.touches[2]&&Te.boxSelectionEnabled())ce.preventDefault(),t.data.bgActivePosistion=void 0,this.lastThreeTouch=+new Date,t.touchData.selecting||Te.emit(pt("boxstart")),t.touchData.selecting=!0,t.touchData.didSelect=!0,ke[4]=1,!ke||ke.length===0||ke[0]===void 0?(ke[0]=(Re[0]+Re[2]+Re[4])/3,ke[1]=(Re[1]+Re[3]+Re[5])/3,ke[2]=(Re[0]+Re[2]+Re[4])/3+1,ke[3]=(Re[1]+Re[3]+Re[5])/3+1):(ke[2]=(Re[0]+Re[2]+Re[4])/3,ke[3]=(Re[1]+Re[3]+Re[5])/3),t.redrawHint("select",!0),t.redraw();else if(ve&&ce.touches[1]&&!t.touchData.didSelect&&Te.zoomingEnabled()&&Te.panningEnabled()&&Te.userZoomingEnabled()&&Te.userPanningEnabled()){ce.preventDefault(),t.data.bgActivePosistion=void 0,t.redrawHint("select",!0);var bn=t.dragData.touchDragEles;if(bn){t.redrawHint("drag",!0);for(var Jn=0;Jn<bn.length;Jn++){var zi=bn[Jn]._private;zi.grabbed=!1,zi.rscratch.inDragLayer=!1}}var vi=t.touchData.start,Wr=ce.touches[0].clientX-pe,Br=ce.touches[0].clientY-me,nn=ce.touches[1].clientX-pe,br=ce.touches[1].clientY-me,Jo=$e(Wr,Br,nn,br),el=Jo/ye;if(Ve){var zl=Wr-te,xo=Br-ae,Xr=nn-de,tl=br-ge,fs=(zl+Xr)/2,Be=(xo+tl)/2,Xe=Te.zoom(),ot=Xe*el,Vt=Te.pan(),ir=le[0]*Xe+Vt.x,tr=le[1]*Xe+Vt.y,gr={x:-ot/Xe*(ir-Vt.x-fs)+ir,y:-ot/Xe*(tr-Vt.y-Be)+tr};if(vi&&vi.active()){var bn=t.dragData.touchDragEles;T(bn),t.redrawHint("drag",!0),t.redrawHint("eles",!0),vi.unactivate().emit(pt("freeon")),bn.emit(pt("free")),t.dragData.didDrag&&(vi.emit(pt("dragfreeon")),bn.emit(pt("dragfree")))}Te.viewport({zoom:ot,pan:gr,cancelOnFailedZoom:!0}),Te.emit(pt("pinchzoom")),ye=Jo,te=Wr,ae=Br,de=nn,ge=br,t.pinching=!0}if(ce.touches[0]){var vt=t.projectIntoViewport(ce.touches[0].clientX,ce.touches[0].clientY);Re[0]=vt[0],Re[1]=vt[1]}if(ce.touches[1]){var vt=t.projectIntoViewport(ce.touches[1].clientX,ce.touches[1].clientY);Re[2]=vt[0],Re[3]=vt[1]}if(ce.touches[2]){var vt=t.projectIntoViewport(ce.touches[2].clientX,ce.touches[2].clientY);Re[4]=vt[0],Re[5]=vt[1]}}else if(ce.touches[0]&&!t.touchData.didSelect){var ct=t.touchData.start,mr=t.touchData.last,un;if(!t.hoverData.draggingEles&&!t.swipePanning&&(un=t.findNearestElement(Re[0],Re[1],!0,!0)),ve&&ct!=null&&ce.preventDefault(),ve&&ct!=null&&t.nodeIsDraggable(ct))if(Ut){var bn=t.dragData.touchDragEles,Qr=!t.dragData.didDrag;Qr&&S(bn,{inDragLayer:!0}),t.dragData.didDrag=!0;var Ur={x:0,y:0};if(bt(Kt[0])&&bt(Kt[1])&&(Ur.x+=Kt[0],Ur.y+=Kt[1],Qr)){t.redrawHint("eles",!0);var Or=t.touchData.dragDelta;Or&&bt(Or[0])&&bt(Or[1])&&(Ur.x+=Or[0],Ur.y+=Or[1])}t.hoverData.draggingEles=!0,bn.silentShift(Ur).emit(pt("position")).emit(pt("drag")),t.redrawHint("drag",!0),t.touchData.startPosition[0]==Je[0]&&t.touchData.startPosition[1]==Je[1]&&t.redrawHint("eles",!0),t.redraw()}else{var Or=t.touchData.dragDelta=t.touchData.dragDelta||[];Or.length===0?(Or.push(Kt[0]),Or.push(Kt[1])):(Or[0]+=Kt[0],Or[1]+=Kt[1])}if(i(ct||un,["touchmove","tapdrag","vmousemove"],ce,{x:Re[0],y:Re[1]}),(!ct||!ct.grabbed())&&un!=mr&&(mr&&mr.emit(pt("tapdragout")),un&&un.emit(pt("tapdragover"))),t.touchData.last=un,ve)for(var Jn=0;Jn<Re.length;Jn++)Re[Jn]&&t.touchData.startPosition[Jn]&&Ut&&(t.touchData.singleTouchMoved=!0);if(ve&&(ct==null||ct.pannable())&&Te.panningEnabled()&&Te.userPanningEnabled()){var ii=s(ct,t.touchData.starts);ii&&(ce.preventDefault(),t.data.bgActivePosistion||(t.data.bgActivePosistion=Rp(t.touchData.startPosition)),t.swipePanning?(Te.panBy({x:Kt[0]*ze,y:Kt[1]*ze}),Te.emit(pt("dragpan"))):Ut&&(t.swipePanning=!0,Te.panBy({x:Yt*ze,y:Lr*ze}),Te.emit(pt("dragpan")),ct&&(ct.unactivate(),t.redrawHint("select",!0),t.touchData.start=null)));var vt=t.projectIntoViewport(ce.touches[0].clientX,ce.touches[0].clientY);Re[0]=vt[0],Re[1]=vt[1]}}for(var Ct=0;Ct<Re.length;Ct++)Je[Ct]=Re[Ct];ve&&ce.touches.length>0&&!t.hoverData.draggingEles&&!t.swipePanning&&t.data.bgActivePosistion!=null&&(t.data.bgActivePosistion=void 0,t.redrawHint("select",!0),t.redraw())}},!1);var De;t.registerBinding(e,"touchcancel",De=function(ce){var ve=t.touchData.start;t.touchData.capture=!1,ve&&ve.unactivate()});var Le,Qe,Ce,Fe;if(t.registerBinding(e,"touchend",Le=function(ce){var ve=t.touchData.start,ke=t.touchData.capture;if(ke)ce.touches.length===0&&(t.touchData.capture=!1),ce.preventDefault();else return;var Te=t.selection;t.swipePanning=!1,t.hoverData.draggingEles=!1;var Re=t.cy,Je=Re.zoom(),ze=t.touchData.now,vt=t.touchData.earlier;if(ce.touches[0]){var pt=t.projectIntoViewport(ce.touches[0].clientX,ce.touches[0].clientY);ze[0]=pt[0],ze[1]=pt[1]}if(ce.touches[1]){var pt=t.projectIntoViewport(ce.touches[1].clientX,ce.touches[1].clientY);ze[2]=pt[0],ze[3]=pt[1]}if(ce.touches[2]){var pt=t.projectIntoViewport(ce.touches[2].clientX,ce.touches[2].clientY);ze[4]=pt[0],ze[5]=pt[1]}var At=function(Ji){return{originalEvent:ce,type:Ji,position:{x:ze[0],y:ze[1]}}};ve&&ve.unactivate();var Ut;if(t.touchData.cxt){if(Ut=At("cxttapend"),ve?ve.emit(Ut):Re.emit(Ut),!t.touchData.cxtDragged){var Kt=At("cxttap");ve?ve.emit(Kt):Re.emit(Kt)}t.touchData.start&&(t.touchData.start._private.grabbed=!1),t.touchData.cxt=!1,t.touchData.start=null,t.redraw();return}if(!ce.touches[2]&&Re.boxSelectionEnabled()&&t.touchData.selecting){t.touchData.selecting=!1;var Ct=Re.collection(t.getAllInBox(Te[0],Te[1],Te[2],Te[3]));Te[0]=void 0,Te[1]=void 0,Te[2]=void 0,Te[3]=void 0,Te[4]=0,t.redrawHint("select",!0),Re.emit(At("boxend"));var Yt=function(Ji){return Ji.selectable()&&!Ji.selected()};Ct.emit(At("box")).stdFilter(Yt).select().emit(At("boxselect")),Ct.nonempty()&&t.redrawHint("eles",!0),t.redraw()}if(ve?.unactivate(),ce.touches[2])t.data.bgActivePosistion=void 0,t.redrawHint("select",!0);else if(!ce.touches[1]){if(!ce.touches[0]){if(!ce.touches[0]){t.data.bgActivePosistion=void 0,t.redrawHint("select",!0);var Xt=t.dragData.touchDragEles;if(ve!=null){var Lr=ve._private.grabbed;T(Xt),t.redrawHint("drag",!0),t.redrawHint("eles",!0),Lr&&(ve.emit(At("freeon")),Xt.emit(At("free")),t.dragData.didDrag&&(ve.emit(At("dragfreeon")),Xt.emit(At("dragfree")))),i(ve,["touchend","tapend","vmouseup","tapdragout"],ce,{x:ze[0],y:ze[1]}),ve.unactivate(),t.touchData.start=null}else{var ar=t.findNearestElement(ze[0],ze[1],!0,!0);i(ar,["touchend","tapend","vmouseup","tapdragout"],ce,{x:ze[0],y:ze[1]})}var mn=t.touchData.startPosition[0]-ze[0],Wr=mn*mn,Br=t.touchData.startPosition[1]-ze[1],nn=Br*Br,br=Wr+nn,Tt=br*Je*Je;t.touchData.singleTouchMoved||(ve||Re.$(":selected").unselect(["tapunselect"]),i(ve,["tap","vclick"],ce,{x:ze[0],y:ze[1]}),Qe=!1,ce.timeStamp-Fe<=Re.multiClickDebounceTime()?(Ce&&clearTimeout(Ce),Qe=!0,Fe=null,i(ve,["dbltap","vdblclick"],ce,{x:ze[0],y:ze[1]})):(Ce=setTimeout(function(){Qe||i(ve,["onetap","voneclick"],ce,{x:ze[0],y:ze[1]})},Re.multiClickDebounceTime()),Fe=ce.timeStamp)),ve!=null&&!t.dragData.didDrag&&ve._private.selectable&&Tt<t.touchTapThreshold2&&!t.pinching&&(Re.selectionType()==="single"?(Re.$(r).unmerge(ve).unselect(["tapunselect"]),ve.select(["tapselect"])):ve.selected()?ve.unselect(["tapunselect"]):ve.select(["tapselect"]),t.redrawHint("eles",!0)),t.touchData.singleTouchMoved=!0}}}for(var zr=0;zr<ze.length;zr++)vt[zr]=ze[zr];t.dragData.didDrag=!1,ce.touches.length===0&&(t.touchData.dragDelta=[],t.touchData.startPosition=[null,null,null,null,null,null],t.touchData.startGPosition=null,t.touchData.didSelect=!1),ce.touches.length<2&&(ce.touches.length===1&&(t.touchData.startGPosition=[ce.touches[0].clientX,ce.touches[0].clientY]),t.pinching=!1,t.redrawHint("eles",!0),t.redraw())},!1),typeof TouchEvent>"u"){var Ke=[],mt=function(ce){return{clientX:ce.clientX,clientY:ce.clientY,force:1,identifier:ce.pointerId,pageX:ce.pageX,pageY:ce.pageY,radiusX:ce.width/2,radiusY:ce.height/2,screenX:ce.screenX,screenY:ce.screenY,target:ce.target}},gt=function(ce){return{event:ce,touch:mt(ce)}},yt=function(ce){Ke.push(gt(ce))},jt=function(ce){for(var ve=0;ve<Ke.length;ve++){var ke=Ke[ve];if(ke.event.pointerId===ce.pointerId){Ke.splice(ve,1);return}}},qt=function(ce){var ve=Ke.filter(function(ke){return ke.event.pointerId===ce.pointerId})[0];ve.event=ce,ve.touch=mt(ce)},wt=function(ce){ce.touches=Ke.map(function(ve){return ve.touch})},ft=function(ce){return ce.pointerType==="mouse"||ce.pointerType===4};t.registerBinding(t.container,"pointerdown",function(qe){ft(qe)||(qe.preventDefault(),yt(qe),wt(qe),rt(qe))}),t.registerBinding(t.container,"pointerup",function(qe){ft(qe)||(jt(qe),wt(qe),Le(qe))}),t.registerBinding(t.container,"pointercancel",function(qe){ft(qe)||(jt(qe),wt(qe),De(qe))}),t.registerBinding(t.container,"pointermove",function(qe){ft(qe)||(qe.preventDefault(),qt(qe),wt(qe),lt(qe))})}};var wc={};wc.generatePolygon=function(t,e){return this.nodeShapes[t]={renderer:this,name:t,points:e,draw:function(n,i,a,s,o,l){this.renderer.nodeShapeImpl("polygon",n,i,a,s,o,this.points)},intersectLine:function(n,i,a,s,o,l,u,c){return Sv(o,l,this.points,n,i,a/2,s/2,u)},checkPoint:function(n,i,a,s,o,l,u,c){return vc(n,i,this.points,l,u,s,o,[0,-1],a)},hasMiterBounds:t!=="rectangle",miterBounds:function(n,i,a,s,o,l){return J9(this.points,n,i,a,s,o)}}};wc.generateEllipse=function(){return this.nodeShapes.ellipse={renderer:this,name:"ellipse",draw:function(e,r,n,i,a,s){this.renderer.nodeShapeImpl(this.name,e,r,n,i,a)},intersectLine:function(e,r,n,i,a,s,o,l){return oF(a,s,e,r,n/2+o,i/2+o)},checkPoint:function(e,r,n,i,a,s,o,l){return ef(e,r,i,a,s,o,n)}}};wc.generateRoundPolygon=function(t,e){return this.nodeShapes[t]={renderer:this,name:t,points:e,getOrCreateCorners:function(n,i,a,s,o,l,u){if(l[u]!==void 0&&l[u+"-cx"]===n&&l[u+"-cy"]===i)return l[u];l[u]=new Array(e.length/2),l[u+"-cx"]=n,l[u+"-cy"]=i;var c=a/2,h=s/2;o=o==="auto"?eA(a,s):o;for(var p=new Array(e.length/2),v=0;v<e.length/2;v++)p[v]={x:n+c*e[v*2],y:i+h*e[v*2+1]};var y,S,w,T,_=p.length;for(S=p[_-1],y=0;y<_;y++)w=p[y%_],T=p[(y+1)%_],l[u][y]=v_(S,w,T,o),S=w,w=T;return l[u]},draw:function(n,i,a,s,o,l,u){this.renderer.nodeShapeImpl("round-polygon",n,i,a,s,o,this.points,this.getOrCreateCorners(i,a,s,o,l,u,"drawCorners"))},intersectLine:function(n,i,a,s,o,l,u,c,h){return uF(o,l,this.points,n,i,a,s,u,this.getOrCreateCorners(n,i,a,s,c,h,"corners"))},checkPoint:function(n,i,a,s,o,l,u,c,h){return sF(n,i,this.points,l,u,s,o,this.getOrCreateCorners(l,u,s,o,c,h,"corners"))}}};wc.generateRoundRectangle=function(){return this.nodeShapes["round-rectangle"]=this.nodeShapes.roundrectangle={renderer:this,name:"round-rectangle",points:Ts(4,0),draw:function(e,r,n,i,a,s){this.renderer.nodeShapeImpl(this.name,e,r,n,i,a,this.points,s)},intersectLine:function(e,r,n,i,a,s,o,l){return QM(a,s,e,r,n,i,o,l)},checkPoint:function(e,r,n,i,a,s,o,l){var u=i/2,c=a/2;l=l==="auto"?Xd(i,a):l,l=Math.min(u,c,l);var h=l*2;return!!(vc(e,r,this.points,s,o,i,a-h,[0,-1],n)||vc(e,r,this.points,s,o,i-h,a,[0,-1],n)||ef(e,r,h,h,s-u+l,o-c+l,n)||ef(e,r,h,h,s+u-l,o-c+l,n)||ef(e,r,h,h,s+u-l,o+c-l,n)||ef(e,r,h,h,s-u+l,o+c-l,n))}}};wc.generateCutRectangle=function(){return this.nodeShapes["cut-rectangle"]=this.nodeShapes.cutrectangle={renderer:this,name:"cut-rectangle",cornerLength:s_(),points:Ts(4,0),draw:function(e,r,n,i,a,s){this.renderer.nodeShapeImpl(this.name,e,r,n,i,a,null,s)},generateCutTrianglePts:function(e,r,n,i,a){var s=a==="auto"?this.cornerLength:a,o=r/2,l=e/2,u=n-l,c=n+l,h=i-o,p=i+o;return{topLeft:[u,h+s,u+s,h,u+s,h+s],topRight:[c-s,h,c,h+s,c-s,h+s],bottomRight:[c,p-s,c-s,p,c-s,p-s],bottomLeft:[u+s,p,u,p-s,u+s,p-s]}},intersectLine:function(e,r,n,i,a,s,o,l){var u=this.generateCutTrianglePts(n+2*o,i+2*o,e,r,l),c=[].concat.apply([],[u.topLeft.splice(0,4),u.topRight.splice(0,4),u.bottomRight.splice(0,4),u.bottomLeft.splice(0,4)]);return Sv(a,s,c,e,r)},checkPoint:function(e,r,n,i,a,s,o,l){var u=l==="auto"?this.cornerLength:l;if(vc(e,r,this.points,s,o,i,a-2*u,[0,-1],n)||vc(e,r,this.points,s,o,i-2*u,a,[0,-1],n))return!0;var c=this.generateCutTrianglePts(i,a,s,o);return Ks(e,r,c.topLeft)||Ks(e,r,c.topRight)||Ks(e,r,c.bottomRight)||Ks(e,r,c.bottomLeft)}}};wc.generateBarrel=function(){return this.nodeShapes.barrel={renderer:this,name:"barrel",points:Ts(4,0),draw:function(e,r,n,i,a,s){this.renderer.nodeShapeImpl(this.name,e,r,n,i,a)},intersectLine:function(e,r,n,i,a,s,o,l){var u=.15,c=.5,h=.85,p=this.generateBarrelBezierPts(n+2*o,i+2*o,e,r),v=function(w){var T=jp({x:w[0],y:w[1]},{x:w[2],y:w[3]},{x:w[4],y:w[5]},u),_=jp({x:w[0],y:w[1]},{x:w[2],y:w[3]},{x:w[4],y:w[5]},c),C=jp({x:w[0],y:w[1]},{x:w[2],y:w[3]},{x:w[4],y:w[5]},h);return[w[0],w[1],T.x,T.y,_.x,_.y,C.x,C.y,w[4],w[5]]},y=[].concat(v(p.topLeft),v(p.topRight),v(p.bottomRight),v(p.bottomLeft));return Sv(a,s,y,e,r)},generateBarrelBezierPts:function(e,r,n,i){var a=r/2,s=e/2,o=n-s,l=n+s,u=i-a,c=i+a,h=DS(e,r),p=h.heightOffset,v=h.widthOffset,y=h.ctrlPtOffsetPct*e,S={topLeft:[o,u+p,o+y,u,o+v,u],topRight:[l-v,u,l-y,u,l,u+p],bottomRight:[l,c-p,l-y,c,l-v,c],bottomLeft:[o+v,c,o+y,c,o,c-p]};return S.topLeft.isTop=!0,S.topRight.isTop=!0,S.bottomLeft.isBottom=!0,S.bottomRight.isBottom=!0,S},checkPoint:function(e,r,n,i,a,s,o,l){var u=DS(i,a),c=u.heightOffset,h=u.widthOffset;if(vc(e,r,this.points,s,o,i,a-2*c,[0,-1],n)||vc(e,r,this.points,s,o,i-2*h,a,[0,-1],n))return!0;for(var p=this.generateBarrelBezierPts(i,a,s,o),v=function(O,F,B){var $=B[4],Z=B[2],D=B[0],H=B[5],U=B[1],W=Math.min($,D),Y=Math.max($,D),Q=Math.min(H,U),ne=Math.max(H,U);if(W<=O&&O<=Y&&Q<=F&&F<=ne){var re=cF($,Z,D),q=rF(re[0],re[1],re[2],O),te=q.filter(function(ae){return 0<=ae&&ae<=1});if(te.length>0)return te[0]}return null},y=Object.keys(p),S=0;S<y.length;S++){var w=y[S],T=p[w],_=v(e,r,T);if(_!=null){var C=T[5],N=T[3],A=T[1],I=pa(C,N,A,_);if(T.isTop&&I<=r||T.isBottom&&r<=I)return!0}}return!1}}};wc.generateBottomRoundrectangle=function(){return this.nodeShapes["bottom-round-rectangle"]=this.nodeShapes.bottomroundrectangle={renderer:this,name:"bottom-round-rectangle",points:Ts(4,0),draw:function(e,r,n,i,a,s){this.renderer.nodeShapeImpl(this.name,e,r,n,i,a,this.points,s)},intersectLine:function(e,r,n,i,a,s,o,l){var u=e-(n/2+o),c=r-(i/2+o),h=c,p=e+(n/2+o),v=Dd(a,s,e,r,u,c,p,h,!1);return v.length>0?v:QM(a,s,e,r,n,i,o,l)},checkPoint:function(e,r,n,i,a,s,o,l){l=l==="auto"?Xd(i,a):l;var u=2*l;if(vc(e,r,this.points,s,o,i,a-u,[0,-1],n)||vc(e,r,this.points,s,o,i-u,a,[0,-1],n))return!0;var c=i/2+2*n,h=a/2+2*n,p=[s-c,o-h,s-c,o,s+c,o,s+c,o-h];return!!(Ks(e,r,p)||ef(e,r,u,u,s+i/2-l,o+a/2-l,n)||ef(e,r,u,u,s-i/2+l,o+a/2-l,n))}}};wc.registerNodeShapes=function(){var t=this.nodeShapes={},e=this;this.generateEllipse(),this.generatePolygon("triangle",Ts(3,0)),this.generateRoundPolygon("round-triangle",Ts(3,0)),this.generatePolygon("rectangle",Ts(4,0)),t.square=t.rectangle,this.generateRoundRectangle(),this.generateCutRectangle(),this.generateBarrel(),this.generateBottomRoundrectangle();{var r=[0,1,1,0,0,-1,-1,0];this.generatePolygon("diamond",r),this.generateRoundPolygon("round-diamond",r)}this.generatePolygon("pentagon",Ts(5,0)),this.generateRoundPolygon("round-pentagon",Ts(5,0)),this.generatePolygon("hexagon",Ts(6,0)),this.generateRoundPolygon("round-hexagon",Ts(6,0)),this.generatePolygon("heptagon",Ts(7,0)),this.generateRoundPolygon("round-heptagon",Ts(7,0)),this.generatePolygon("octagon",Ts(8,0)),this.generateRoundPolygon("round-octagon",Ts(8,0));var n=new Array(20);{var i=OS(5,0),a=OS(5,Math.PI/5),s=.5*(3-Math.sqrt(5));s*=1.57;for(var o=0;o<a.length/2;o++)a[o*2]*=s,a[o*2+1]*=s;for(var o=0;o<20/4;o++)n[o*4]=i[o*2],n[o*4+1]=i[o*2+1],n[o*4+2]=a[o*2],n[o*4+3]=a[o*2+1]}n=JM(n),this.generatePolygon("star",n),this.generatePolygon("vee",[-1,-1,0,-.333,1,-1,0,1]),this.generatePolygon("rhomboid",[-1,-1,.333,-1,1,1,-.333,1]),this.generatePolygon("right-rhomboid",[-.333,-1,1,-1,.333,1,-1,1]),this.nodeShapes.concavehexagon=this.generatePolygon("concave-hexagon",[-1,-.95,-.75,0,-1,.95,1,.95,.75,0,1,-.95]);{var l=[-1,-1,.25,-1,1,0,.25,1,-1,1];this.generatePolygon("tag",l),this.generateRoundPolygon("round-tag",l)}t.makePolygon=function(u){var c=u.join("$"),h="polygon-"+c,p;return(p=this[h])?p:e.generatePolygon(h,u)}};var n0={};n0.timeToRender=function(){return this.redrawTotalTime/this.redrawCount};n0.redraw=function(t){t=t||KM();var e=this;e.averageRedrawTime===void 0&&(e.averageRedrawTime=0),e.lastRedrawTime===void 0&&(e.lastRedrawTime=0),e.lastDrawTime===void 0&&(e.lastDrawTime=0),e.requestedFrame=!0,e.renderOptions=t};n0.beforeRender=function(t,e){if(!this.destroyed){e==null&&Kn("Priority is not optional for beforeRender");var r=this.beforeRenderCallbacks;r.push({fn:t,priority:e}),r.sort(function(n,i){return i.priority-n.priority})}};var UN=function(e,r,n){for(var i=e.beforeRenderCallbacks,a=0;a<i.length;a++)i[a].fn(r,n)};n0.startRenderLoop=function(){var t=this,e=t.cy;if(!t.renderLoopStarted){t.renderLoopStarted=!0;var r=function(i){if(!t.destroyed){if(!e.batching())if(t.requestedFrame&&!t.skipFrame){UN(t,!0,i);var a=gc();t.render(t.renderOptions);var s=t.lastDrawTime=gc();t.averageRedrawTime===void 0&&(t.averageRedrawTime=s-a),t.redrawCount===void 0&&(t.redrawCount=0),t.redrawCount++,t.redrawTotalTime===void 0&&(t.redrawTotalTime=0);var o=s-a;t.redrawTotalTime+=o,t.lastRedrawTime=o,t.averageRedrawTime=t.averageRedrawTime/2+o/2,t.requestedFrame=!1}else UN(t,!1,i);t.skipFrame=!1,ax(r)}};ax(r)}};var Ez=function(e){this.init(e)},eR=Ez,pm=eR.prototype;pm.clientFunctions=["redrawHint","render","renderTo","matchCanvasSize","nodeShapeImpl","arrowShapeImpl"];pm.init=function(t){var e=this;e.options=t,e.cy=t.cy;var r=e.container=t.cy.container(),n=e.cy.window();if(n){var i=n.document,a=i.head,s="__________cytoscape_stylesheet",o="__________cytoscape_container",l=i.getElementById(s)!=null;if(r.className.indexOf(o)<0&&(r.className=(r.className||"")+" "+o),!l){var u=i.createElement("style");u.id=s,u.textContent="."+o+" { position: relative; }",a.insertBefore(u,a.children[0])}var c=n.getComputedStyle(r),h=c.getPropertyValue("position");h==="static"&&rn("A Cytoscape container has style position:static and so can not use UI extensions properly")}e.selection=[void 0,void 0,void 0,void 0,0],e.bezierProjPcts=[.05,.225,.4,.5,.6,.775,.95],e.hoverData={down:null,last:null,downTime:null,triggerMode:null,dragging:!1,initialPan:[null,null],capture:!1},e.dragData={possibleDragElements:[]},e.touchData={start:null,capture:!1,startPosition:[null,null,null,null,null,null],singleTouchStartTime:null,singleTouchMoved:!0,now:[null,null,null,null,null,null],earlier:[null,null,null,null,null,null]},e.redraws=0,e.showFps=t.showFps,e.debug=t.debug,e.webgl=t.webgl,e.hideEdgesOnViewport=t.hideEdgesOnViewport,e.textureOnViewport=t.textureOnViewport,e.wheelSensitivity=t.wheelSensitivity,e.motionBlurEnabled=t.motionBlur,e.forcedPixelRatio=bt(t.pixelRatio)?t.pixelRatio:null,e.motionBlur=t.motionBlur,e.motionBlurOpacity=t.motionBlurOpacity,e.motionBlurTransparency=1-e.motionBlurOpacity,e.motionBlurPxRatio=1,e.mbPxRBlurry=1,e.minMbLowQualFrames=4,e.fullQualityMb=!1,e.clearedForMotionBlur=[],e.desktopTapThreshold=t.desktopTapThreshold,e.desktopTapThreshold2=t.desktopTapThreshold*t.desktopTapThreshold,e.touchTapThreshold=t.touchTapThreshold,e.touchTapThreshold2=t.touchTapThreshold*t.touchTapThreshold,e.tapholdDuration=500,e.bindings=[],e.beforeRenderCallbacks=[],e.beforeRenderPriorities={animations:400,eleCalcs:300,eleTxrDeq:200,lyrTxrDeq:150,lyrTxrSkip:100},e.registerNodeShapes(),e.registerArrowShapes(),e.registerCalculationListeners()};pm.notify=function(t,e){var r=this,n=r.cy;if(!this.destroyed){if(t==="init"){r.load();return}if(t==="destroy"){r.destroy();return}(t==="add"||t==="remove"||t==="move"&&n.hasCompoundNodes()||t==="load"||t==="zorder"||t==="mount")&&r.invalidateCachedZSortedEles(),t==="viewport"&&r.redrawHint("select",!0),t==="gc"&&r.redrawHint("gc",!0),(t==="load"||t==="resize"||t==="mount")&&(r.invalidateContainerClientCoordsCache(),r.matchCanvasSize(r.container)),r.redrawHint("eles",!0),r.redrawHint("drag",!0),this.startRenderLoop(),this.redraw()}};pm.destroy=function(){var t=this;t.destroyed=!0,t.cy.stopAnimationLoop();for(var e=0;e<t.bindings.length;e++){var r=t.bindings[e],n=r,i=n.target;(i.off||i.removeEventListener).apply(i,n.args)}if(t.bindings=[],t.beforeRenderCallbacks=[],t.onUpdateEleCalcsFns=[],t.removeObserver&&t.removeObserver.disconnect(),t.styleObserver&&t.styleObserver.disconnect(),t.resizeObserver&&t.resizeObserver.disconnect(),t.labelCalcDiv)try{document.body.removeChild(t.labelCalcDiv)}catch{}};pm.isHeadless=function(){return!1};[g_,QA,JA,fm,wc,n0].forEach(function(t){er(pm,t)});var d2=1e3/60,tR={setupDequeueing:function(e){return function(){var n=this,i=this.renderer;if(!n.dequeueingSetup){n.dequeueingSetup=!0;var a=Qv(function(){i.redrawHint("eles",!0),i.redrawHint("drag",!0),i.redraw()},e.deqRedrawThreshold),s=function(u,c){var h=gc(),p=i.averageRedrawTime,v=i.lastRedrawTime,y=[],S=i.cy.extent(),w=i.getPixelRatio();for(u||i.flushRenderedStyleQueue();;){var T=gc(),_=T-h,C=T-c;if(v<d2){var N=d2-(u?p:0);if(C>=e.deqFastCost*N)break}else if(u){if(_>=e.deqCost*v||_>=e.deqAvgCost*p)break}else if(C>=e.deqNoDrawCost*d2)break;var A=e.deq(n,w,S);if(A.length>0)for(var I=0;I<A.length;I++)y.push(A[I]);else break}y.length>0&&(e.onDeqd(n,y),!u&&e.shouldRedraw(n,y,w,S)&&a())},o=e.priority||t_;i.beforeRender(s,o(n))}}}},Tz=(function(){function t(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:sx;ah(this,t),this.idsByKey=new cc,this.keyForId=new cc,this.cachesByLvl=new cc,this.lvls=[],this.getKey=e,this.doesEleInvalidateKey=r}return sh(t,[{key:"getIdsFor",value:function(r){r==null&&Kn("Can not get id list for null key");var n=this.idsByKey,i=this.idsByKey.get(r);return i||(i=new um,n.set(r,i)),i}},{key:"addIdForKey",value:function(r,n){r!=null&&this.getIdsFor(r).add(n)}},{key:"deleteIdForKey",value:function(r,n){r!=null&&this.getIdsFor(r).delete(n)}},{key:"getNumberOfIdsForKey",value:function(r){return r==null?0:this.getIdsFor(r).size}},{key:"updateKeyMappingFor",value:function(r){var n=r.id(),i=this.keyForId.get(n),a=this.getKey(r);this.deleteIdForKey(i,n),this.addIdForKey(a,n),this.keyForId.set(n,a)}},{key:"deleteKeyMappingFor",value:function(r){var n=r.id(),i=this.keyForId.get(n);this.deleteIdForKey(i,n),this.keyForId.delete(n)}},{key:"keyHasChangedFor",value:function(r){var n=r.id(),i=this.keyForId.get(n),a=this.getKey(r);return i!==a}},{key:"isInvalid",value:function(r){return this.keyHasChangedFor(r)||this.doesEleInvalidateKey(r)}},{key:"getCachesAt",value:function(r){var n=this.cachesByLvl,i=this.lvls,a=n.get(r);return a||(a=new cc,n.set(r,a),i.push(r)),a}},{key:"getCache",value:function(r,n){return this.getCachesAt(n).get(r)}},{key:"get",value:function(r,n){var i=this.getKey(r),a=this.getCache(i,n);return a!=null&&this.updateKeyMappingFor(r),a}},{key:"getForCachedKey",value:function(r,n){var i=this.keyForId.get(r.id()),a=this.getCache(i,n);return a}},{key:"hasCache",value:function(r,n){return this.getCachesAt(n).has(r)}},{key:"has",value:function(r,n){var i=this.getKey(r);return this.hasCache(i,n)}},{key:"setCache",value:function(r,n,i){i.key=r,this.getCachesAt(n).set(r,i)}},{key:"set",value:function(r,n,i){var a=this.getKey(r);this.setCache(a,n,i),this.updateKeyMappingFor(r)}},{key:"deleteCache",value:function(r,n){this.getCachesAt(n).delete(r)}},{key:"delete",value:function(r,n){var i=this.getKey(r);this.deleteCache(i,n)}},{key:"invalidateKey",value:function(r){var n=this;this.lvls.forEach(function(i){return n.deleteCache(r,i)})}},{key:"invalidate",value:function(r){var n=r.id(),i=this.keyForId.get(n);this.deleteKeyMappingFor(r);var a=this.doesEleInvalidateKey(r);return a&&this.invalidateKey(i),a||this.getNumberOfIdsForKey(i)===0}}])})(),GN=25,sy=50,Vy=-4,KS=3,rR=7.99,Nz=8,Pz=1024,Mz=1024,Az=1024,Rz=.2,Lz=.8,Oz=10,Dz=.15,Iz=.1,jz=.9,Fz=.9,Bz=100,zz=1,Op={dequeue:"dequeue",downscale:"downscale",highQuality:"highQuality"},Uz=qa({getKey:null,doesEleInvalidateKey:sx,drawElement:null,getBoundingBox:null,getRotationPoint:null,getRotationOffset:null,isVisible:WM,allowEdgeTxrCaching:!0,allowParentTxrCaching:!0}),qg=function(e,r){var n=this;n.renderer=e,n.onDequeues=[];var i=Uz(r);er(n,i),n.lookup=new Tz(i.getKey,i.doesEleInvalidateKey),n.setupDequeueing()},Qi=qg.prototype;Qi.reasons=Op;Qi.getTextureQueue=function(t){var e=this;return e.eleImgCaches=e.eleImgCaches||{},e.eleImgCaches[t]=e.eleImgCaches[t]||[]};Qi.getRetiredTextureQueue=function(t){var e=this,r=e.eleImgCaches.retired=e.eleImgCaches.retired||{},n=r[t]=r[t]||[];return n};Qi.getElementQueue=function(){var t=this,e=t.eleCacheQueue=t.eleCacheQueue||new Jv(function(r,n){return n.reqs-r.reqs});return e};Qi.getElementKeyToQueue=function(){var t=this,e=t.eleKeyToCacheQueue=t.eleKeyToCacheQueue||{};return e};Qi.getElement=function(t,e,r,n,i){var a=this,s=this.renderer,o=s.cy.zoom(),l=this.lookup;if(!e||e.w===0||e.h===0||isNaN(e.w)||isNaN(e.h)||!t.visible()||t.removed()||!a.allowEdgeTxrCaching&&t.isEdge()||!a.allowParentTxrCaching&&t.isParent())return null;if(n==null&&(n=Math.ceil(n_(o*r))),n<Vy)n=Vy;else if(o>=rR||n>KS)return null;var u=Math.pow(2,n),c=e.h*u,h=e.w*u,p=s.eleTextBiggerThanMin(t,u);if(!this.isVisible(t,p))return null;var v=l.get(t,n);if(v&&v.invalidated&&(v.invalidated=!1,v.texture.invalidatedWidth-=v.width),v)return v;var y;if(c<=GN?y=GN:c<=sy?y=sy:y=Math.ceil(c/sy)*sy,c>Az||h>Mz)return null;var S=a.getTextureQueue(y),w=S[S.length-2],T=function(){return a.recycleTexture(y,h)||a.addTexture(y,h)};w||(w=S[S.length-1]),w||(w=T()),w.width-w.usedWidth<h&&(w=T());for(var _=function(W){return W&&W.scaledLabelShown===p},C=i&&i===Op.dequeue,N=i&&i===Op.highQuality,A=i&&i===Op.downscale,I,j=n+1;j<=KS;j++){var O=l.get(t,j);if(O){I=O;break}}var F=I&&I.level===n+1?I:null,B=function(){w.context.drawImage(F.texture.canvas,F.x,0,F.width,F.height,w.usedWidth,0,h,c)};if(w.context.setTransform(1,0,0,1,0,0),w.context.clearRect(w.usedWidth,0,h,y),_(F))B();else if(_(I))if(N){for(var $=I.level;$>n;$--)F=a.getElement(t,e,r,$,Op.downscale);B()}else return a.queueElement(t,I.level-1),I;else{var Z;if(!C&&!N&&!A)for(var D=n-1;D>=Vy;D--){var H=l.get(t,D);if(H){Z=H;break}}if(_(Z))return a.queueElement(t,n),Z;w.context.translate(w.usedWidth,0),w.context.scale(u,u),this.drawElement(w.context,t,e,p,!1),w.context.scale(1/u,1/u),w.context.translate(-w.usedWidth,0)}return v={x:w.usedWidth,texture:w,level:n,scale:u,width:h,height:c,scaledLabelShown:p},w.usedWidth+=Math.ceil(h+Nz),w.eleCaches.push(v),l.set(t,n,v),a.checkTextureFullness(w),v};Qi.invalidateElements=function(t){for(var e=0;e<t.length;e++)this.invalidateElement(t[e])};Qi.invalidateElement=function(t){var e=this,r=e.lookup,n=[],i=r.isInvalid(t);if(i){for(var a=Vy;a<=KS;a++){var s=r.getForCachedKey(t,a);s&&n.push(s)}var o=r.invalidate(t);if(o)for(var l=0;l<n.length;l++){var u=n[l],c=u.texture;c.invalidatedWidth+=u.width,u.invalidated=!0,e.checkTextureUtility(c)}e.removeFromQueue(t)}};Qi.checkTextureUtility=function(t){t.invalidatedWidth>=Rz*t.width&&this.retireTexture(t)};Qi.checkTextureFullness=function(t){var e=this,r=e.getTextureQueue(t.height);t.usedWidth/t.width>Lz&&t.fullnessChecks>=Oz?Yd(r,t):t.fullnessChecks++};Qi.retireTexture=function(t){var e=this,r=t.height,n=e.getTextureQueue(r),i=this.lookup;Yd(n,t),t.retired=!0;for(var a=t.eleCaches,s=0;s<a.length;s++){var o=a[s];i.deleteCache(o.key,o.level)}r_(a);var l=e.getRetiredTextureQueue(r);l.push(t)};Qi.addTexture=function(t,e){var r=this,n=r.getTextureQueue(t),i={};return n.push(i),i.eleCaches=[],i.height=t,i.width=Math.max(Pz,e),i.usedWidth=0,i.invalidatedWidth=0,i.fullnessChecks=0,i.canvas=r.renderer.makeOffscreenCanvas(i.width,i.height),i.context=i.canvas.getContext("2d"),i};Qi.recycleTexture=function(t,e){for(var r=this,n=r.getTextureQueue(t),i=r.getRetiredTextureQueue(t),a=0;a<i.length;a++){var s=i[a];if(s.width>=e)return s.retired=!1,s.usedWidth=0,s.invalidatedWidth=0,s.fullnessChecks=0,r_(s.eleCaches),s.context.setTransform(1,0,0,1,0,0),s.context.clearRect(0,0,s.width,s.height),Yd(i,s),n.push(s),s}};Qi.queueElement=function(t,e){var r=this,n=r.getElementQueue(),i=r.getElementKeyToQueue(),a=this.getKey(t),s=i[a];if(s)s.level=Math.max(s.level,e),s.eles.merge(t),s.reqs++,n.updateItem(s);else{var o={eles:t.spawn().merge(t),level:e,reqs:1,key:a};n.push(o),i[a]=o}};Qi.dequeue=function(t){for(var e=this,r=e.getElementQueue(),n=e.getElementKeyToQueue(),i=[],a=e.lookup,s=0;s<zz&&r.size()>0;s++){var o=r.pop(),l=o.key,u=o.eles[0],c=a.hasCache(u,o.level);if(n[l]=null,c)continue;i.push(o);var h=e.getBoundingBox(u);e.getElement(u,h,t,o.level,Op.dequeue)}return i};Qi.removeFromQueue=function(t){var e=this,r=e.getElementQueue(),n=e.getElementKeyToQueue(),i=this.getKey(t),a=n[i];a!=null&&(a.eles.length===1?(a.reqs=e_,r.updateItem(a),r.pop(),n[i]=null):a.eles.unmerge(t))};Qi.onDequeue=function(t){this.onDequeues.push(t)};Qi.offDequeue=function(t){Yd(this.onDequeues,t)};Qi.setupDequeueing=tR.setupDequeueing({deqRedrawThreshold:Bz,deqCost:Dz,deqAvgCost:Iz,deqNoDrawCost:jz,deqFastCost:Fz,deq:function(e,r,n){return e.dequeue(r,n)},onDeqd:function(e,r){for(var n=0;n<e.onDequeues.length;n++){var i=e.onDequeues[n];i(r)}},shouldRedraw:function(e,r,n,i){for(var a=0;a<r.length;a++)for(var s=r[a].eles,o=0;o<s.length;o++){var l=s[o].boundingBox();if(a_(l,i))return!0}return!1},priority:function(e){return e.renderer.beforeRenderPriorities.eleTxrDeq}});var Gz=1,ev=-4,px=2,Vz=3.99,Hz=50,Wz=50,qz=.15,$z=.1,Kz=.9,Zz=.9,Yz=1,VN=250,Xz=4e3*4e3,HN=32767,Qz=!0,nR=function(e){var r=this,n=r.renderer=e,i=n.cy;r.layersByLevel={},r.firstGet=!0,r.lastInvalidationTime=gc()-2*VN,r.skipping=!1,r.eleTxrDeqs=i.collection(),r.scheduleElementRefinement=Qv(function(){r.refineElementTextures(r.eleTxrDeqs),r.eleTxrDeqs.unmerge(r.eleTxrDeqs)},Wz),n.beforeRender(function(s,o){o-r.lastInvalidationTime<=VN?r.skipping=!0:r.skipping=!1},n.beforeRenderPriorities.lyrTxrSkip);var a=function(o,l){return l.reqs-o.reqs};r.layersQueue=new Jv(a),r.setupDequeueing()},$a=nR.prototype,WN=0,Jz=Math.pow(2,53)-1;$a.makeLayer=function(t,e){var r=Math.pow(2,e),n=Math.ceil(t.w*r),i=Math.ceil(t.h*r),a=this.renderer.makeOffscreenCanvas(n,i),s={id:WN=++WN%Jz,bb:t,level:e,width:n,height:i,canvas:a,context:a.getContext("2d"),eles:[],elesQueue:[],reqs:0},o=s.context,l=-s.bb.x1,u=-s.bb.y1;return o.scale(r,r),o.translate(l,u),s};$a.getLayers=function(t,e,r){var n=this,i=n.renderer,a=i.cy,s=a.zoom(),o=n.firstGet;if(n.firstGet=!1,r==null){if(r=Math.ceil(n_(s*e)),r<ev)r=ev;else if(s>=Vz||r>px)return null}n.validateLayersElesOrdering(r,t);var l=n.layersByLevel,u=Math.pow(2,r),c=l[r]=l[r]||[],h,p=n.levelIsComplete(r,t),v,y=function(){var B=function(U){if(n.validateLayersElesOrdering(U,t),n.levelIsComplete(U,t))return v=l[U],!0},$=function(U){if(!v)for(var W=r+U;ev<=W&&W<=px&&!B(W);W+=U);};$(1),$(-1);for(var Z=c.length-1;Z>=0;Z--){var D=c[Z];D.invalid&&Yd(c,D)}};if(!p)y();else return c;var S=function(){if(!h){h=Ns();for(var B=0;B<t.length;B++)Y9(h,t[B].boundingBox())}return h},w=function(B){B=B||{};var $=B.after;S();var Z=Math.ceil(h.w*u),D=Math.ceil(h.h*u);if(Z>HN||D>HN)return null;var H=Z*D;if(H>Xz)return null;var U=n.makeLayer(h,r);if($!=null){var W=c.indexOf($)+1;c.splice(W,0,U)}else(B.insert===void 0||B.insert)&&c.unshift(U);return U};if(n.skipping&&!o)return null;for(var T=null,_=t.length/Gz,C=!o,N=0;N<t.length;N++){var A=t[N],I=A._private.rscratch,j=I.imgLayerCaches=I.imgLayerCaches||{},O=j[r];if(O){T=O;continue}if((!T||T.eles.length>=_||!XM(T.bb,A.boundingBox()))&&(T=w({insert:!0,after:T}),!T))return null;v||C?n.queueLayer(T,A):n.drawEleInLayer(T,A,r,e),T.eles.push(A),j[r]=T}return v||(C?null:c)};$a.getEleLevelForLayerLevel=function(t,e){return t};$a.drawEleInLayer=function(t,e,r,n){var i=this,a=this.renderer,s=t.context,o=e.boundingBox();o.w===0||o.h===0||!e.visible()||(r=i.getEleLevelForLayerLevel(r,n),a.setImgSmoothing(s,!1),a.drawCachedElement(s,e,null,null,r,Qz),a.setImgSmoothing(s,!0))};$a.levelIsComplete=function(t,e){var r=this,n=r.layersByLevel[t];if(!n||n.length===0)return!1;for(var i=0,a=0;a<n.length;a++){var s=n[a];if(s.reqs>0||s.invalid)return!1;i+=s.eles.length}return i===e.length};$a.validateLayersElesOrdering=function(t,e){var r=this.layersByLevel[t];if(r)for(var n=0;n<r.length;n++){for(var i=r[n],a=-1,s=0;s<e.length;s++)if(i.eles[0]===e[s]){a=s;break}if(a<0){this.invalidateLayer(i);continue}for(var o=a,s=0;s<i.eles.length;s++)if(i.eles[s]!==e[o+s]){this.invalidateLayer(i);break}}};$a.updateElementsInLayers=function(t,e){for(var r=this,n=Kv(t[0]),i=0;i<t.length;i++)for(var a=n?null:t[i],s=n?t[i]:t[i].ele,o=s._private.rscratch,l=o.imgLayerCaches=o.imgLayerCaches||{},u=ev;u<=px;u++){var c=l[u];c&&(a&&r.getEleLevelForLayerLevel(c.level)!==a.level||e(c,s,a))}};$a.haveLayers=function(){for(var t=this,e=!1,r=ev;r<=px;r++){var n=t.layersByLevel[r];if(n&&n.length>0){e=!0;break}}return e};$a.invalidateElements=function(t){var e=this;t.length!==0&&(e.lastInvalidationTime=gc(),!(t.length===0||!e.haveLayers())&&e.updateElementsInLayers(t,function(n,i,a){e.invalidateLayer(n)}))};$a.invalidateLayer=function(t){if(this.lastInvalidationTime=gc(),!t.invalid){var e=t.level,r=t.eles,n=this.layersByLevel[e];Yd(n,t),t.elesQueue=[],t.invalid=!0,t.replacement&&(t.replacement.invalid=!0);for(var i=0;i<r.length;i++){var a=r[i]._private.rscratch.imgLayerCaches;a&&(a[e]=null)}}};$a.refineElementTextures=function(t){var e=this;e.updateElementsInLayers(t,function(n,i,a){var s=n.replacement;if(s||(s=n.replacement=e.makeLayer(n.bb,n.level),s.replaces=n,s.eles=n.eles),!s.reqs)for(var o=0;o<s.eles.length;o++)e.queueLayer(s,s.eles[o])})};$a.enqueueElementRefinement=function(t){this.eleTxrDeqs.merge(t),this.scheduleElementRefinement()};$a.queueLayer=function(t,e){var r=this,n=r.layersQueue,i=t.elesQueue,a=i.hasId=i.hasId||{};if(!t.replacement){if(e){if(a[e.id()])return;i.push(e),a[e.id()]=!0}t.reqs?(t.reqs++,n.updateItem(t)):(t.reqs=1,n.push(t))}};$a.dequeue=function(t){for(var e=this,r=e.layersQueue,n=[],i=0;i<Yz&&r.size()!==0;){var a=r.peek();if(a.replacement){r.pop();continue}if(a.replaces&&a!==a.replaces.replacement){r.pop();continue}if(a.invalid){r.pop();continue}var s=a.elesQueue.shift();s&&(e.drawEleInLayer(a,s,a.level,t),i++),n.length===0&&n.push(!0),a.elesQueue.length===0&&(r.pop(),a.reqs=0,a.replaces&&e.applyLayerReplacement(a),e.requestRedraw())}return n};$a.applyLayerReplacement=function(t){var e=this,r=e.layersByLevel[t.level],n=t.replaces,i=r.indexOf(n);if(!(i<0||n.invalid)){r[i]=t;for(var a=0;a<t.eles.length;a++){var s=t.eles[a]._private,o=s.imgLayerCaches=s.imgLayerCaches||{};o&&(o[t.level]=t)}e.requestRedraw()}};$a.requestRedraw=Qv(function(){var t=this.renderer;t.redrawHint("eles",!0),t.redrawHint("drag",!0),t.redraw()},100);$a.setupDequeueing=tR.setupDequeueing({deqRedrawThreshold:Hz,deqCost:qz,deqAvgCost:$z,deqNoDrawCost:Kz,deqFastCost:Zz,deq:function(e,r){return e.dequeue(r)},onDeqd:t_,shouldRedraw:WM,priority:function(e){return e.renderer.beforeRenderPriorities.lyrTxrDeq}});var iR={},qN;function eU(t,e){for(var r=0;r<e.length;r++){var n=e[r];t.lineTo(n.x,n.y)}}function tU(t,e,r){for(var n,i=0;i<e.length;i++){var a=e[i];i===0&&(n=a),t.lineTo(a.x,a.y)}t.quadraticCurveTo(r.x,r.y,n.x,n.y)}function $N(t,e,r){t.beginPath&&t.beginPath();for(var n=e,i=0;i<n.length;i++){var a=n[i];t.lineTo(a.x,a.y)}var s=r,o=r[0];t.moveTo(o.x,o.y);for(var i=1;i<s.length;i++){var a=s[i];t.lineTo(a.x,a.y)}t.closePath&&t.closePath()}function rU(t,e,r,n,i){t.beginPath&&t.beginPath(),t.arc(r,n,i,0,Math.PI*2,!1);var a=e,s=a[0];t.moveTo(s.x,s.y);for(var o=0;o<a.length;o++){var l=a[o];t.lineTo(l.x,l.y)}t.closePath&&t.closePath()}function nU(t,e,r,n){t.arc(e,r,n,0,Math.PI*2,!1)}iR.arrowShapeImpl=function(t){return(qN||(qN={polygon:eU,"triangle-backcurve":tU,"triangle-tee":$N,"circle-triangle":rU,"triangle-cross":$N,circle:nU}))[t]};var Ru={};Ru.drawElement=function(t,e,r,n,i,a){var s=this;e.isNode()?s.drawNode(t,e,r,n,i,a):s.drawEdge(t,e,r,n,i,a)};Ru.drawElementOverlay=function(t,e){var r=this;e.isNode()?r.drawNodeOverlay(t,e):r.drawEdgeOverlay(t,e)};Ru.drawElementUnderlay=function(t,e){var r=this;e.isNode()?r.drawNodeUnderlay(t,e):r.drawEdgeUnderlay(t,e)};Ru.drawCachedElementPortion=function(t,e,r,n,i,a,s,o){var l=this,u=r.getBoundingBox(e);if(!(u.w===0||u.h===0)){var c=r.getElement(e,u,n,i,a);if(c!=null){var h=o(l,e);if(h===0)return;var p=s(l,e),v=u.x1,y=u.y1,S=u.w,w=u.h,T,_,C,N,A;if(p!==0){var I=r.getRotationPoint(e);C=I.x,N=I.y,t.translate(C,N),t.rotate(p),A=l.getImgSmoothing(t),A||l.setImgSmoothing(t,!0);var j=r.getRotationOffset(e);T=j.x,_=j.y}else T=v,_=y;var O;h!==1&&(O=t.globalAlpha,t.globalAlpha=O*h),t.drawImage(c.texture.canvas,c.x,0,c.width,c.height,T,_,S,w),h!==1&&(t.globalAlpha=O),p!==0&&(t.rotate(-p),t.translate(-C,-N),A||l.setImgSmoothing(t,!1))}else r.drawElement(t,e)}};var iU=function(){return 0},aU=function(e,r){return e.getTextAngle(r,null)},sU=function(e,r){return e.getTextAngle(r,"source")},oU=function(e,r){return e.getTextAngle(r,"target")},lU=function(e,r){return r.effectiveOpacity()},h2=function(e,r){return r.pstyle("text-opacity").pfValue*r.effectiveOpacity()};Ru.drawCachedElement=function(t,e,r,n,i,a){var s=this,o=s.data,l=o.eleTxrCache,u=o.lblTxrCache,c=o.slbTxrCache,h=o.tlbTxrCache,p=e.boundingBox(),v=a===!0?l.reasons.highQuality:null;if(!(p.w===0||p.h===0||!e.visible())&&(!n||a_(p,n))){var y=e.isEdge(),S=e.element()._private.rscratch.badLine;s.drawElementUnderlay(t,e),s.drawCachedElementPortion(t,e,l,r,i,v,iU,lU),(!y||!S)&&s.drawCachedElementPortion(t,e,u,r,i,v,aU,h2),y&&!S&&(s.drawCachedElementPortion(t,e,c,r,i,v,sU,h2),s.drawCachedElementPortion(t,e,h,r,i,v,oU,h2)),s.drawElementOverlay(t,e)}};Ru.drawElements=function(t,e){for(var r=this,n=0;n<e.length;n++){var i=e[n];r.drawElement(t,i)}};Ru.drawCachedElements=function(t,e,r,n){for(var i=this,a=0;a<e.length;a++){var s=e[a];i.drawCachedElement(t,s,r,n)}};Ru.drawCachedNodes=function(t,e,r,n){for(var i=this,a=0;a<e.length;a++){var s=e[a];s.isNode()&&i.drawCachedElement(t,s,r,n)}};Ru.drawLayeredElements=function(t,e,r,n){var i=this,a=i.data.lyrTxrCache.getLayers(e,r);if(a)for(var s=0;s<a.length;s++){var o=a[s],l=o.bb;l.w===0||l.h===0||t.drawImage(o.canvas,l.x1,l.y1,l.w,l.h)}else i.drawCachedElements(t,e,r,n)};var Sc={};Sc.drawEdge=function(t,e,r){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!0,s=this,o=e._private.rscratch;if(!(a&&!e.visible())&&!(o.badLine||o.allpts==null||isNaN(o.allpts[0]))){var l;r&&(l=r,t.translate(-l.x1,-l.y1));var u=a?e.pstyle("opacity").value:1,c=a?e.pstyle("line-opacity").value:1,h=e.pstyle("curve-style").value,p=e.pstyle("line-style").value,v=e.pstyle("width").pfValue,y=e.pstyle("line-cap").value,S=e.pstyle("line-outline-width").value,w=e.pstyle("line-outline-color").value,T=u*c,_=u*c,C=function(){var U=arguments.length>0&&arguments[0]!==void 0?arguments[0]:T;h==="straight-triangle"?(s.eleStrokeStyle(t,e,U),s.drawEdgeTrianglePath(e,t,o.allpts)):(t.lineWidth=v,t.lineCap=y,s.eleStrokeStyle(t,e,U),s.drawEdgePath(e,t,o.allpts,p),t.lineCap="butt")},N=function(){var U=arguments.length>0&&arguments[0]!==void 0?arguments[0]:T;if(t.lineWidth=v+S,t.lineCap=y,S>0)s.colorStrokeStyle(t,w[0],w[1],w[2],U);else{t.lineCap="butt";return}h==="straight-triangle"?s.drawEdgeTrianglePath(e,t,o.allpts):(s.drawEdgePath(e,t,o.allpts,p),t.lineCap="butt")},A=function(){i&&s.drawEdgeOverlay(t,e)},I=function(){i&&s.drawEdgeUnderlay(t,e)},j=function(){var U=arguments.length>0&&arguments[0]!==void 0?arguments[0]:_;s.drawArrowheads(t,e,U)},O=function(){s.drawElementText(t,e,null,n)};t.lineJoin="round";var F=e.pstyle("ghost").value==="yes";if(F){var B=e.pstyle("ghost-offset-x").pfValue,$=e.pstyle("ghost-offset-y").pfValue,Z=e.pstyle("ghost-opacity").value,D=T*Z;t.translate(B,$),C(D),j(D),t.translate(-B,-$)}else N();I(),C(),j(),A(),O(),r&&t.translate(l.x1,l.y1)}};var aR=function(e){if(!["overlay","underlay"].includes(e))throw new Error("Invalid state");return function(r,n){if(n.visible()){var i=n.pstyle("".concat(e,"-opacity")).value;if(i!==0){var a=this,s=a.usePaths(),o=n._private.rscratch,l=n.pstyle("".concat(e,"-padding")).pfValue,u=2*l,c=n.pstyle("".concat(e,"-color")).value;r.lineWidth=u,o.edgeType==="self"&&!s?r.lineCap="butt":r.lineCap="round",a.colorStrokeStyle(r,c[0],c[1],c[2],i),a.drawEdgePath(n,r,o.allpts,"solid")}}}};Sc.drawEdgeOverlay=aR("overlay");Sc.drawEdgeUnderlay=aR("underlay");Sc.drawEdgePath=function(t,e,r,n){var i=t._private.rscratch,a=e,s,o=!1,l=this.usePaths(),u=t.pstyle("line-dash-pattern").pfValue,c=t.pstyle("line-dash-offset").pfValue;if(l){var h=r.join("$"),p=i.pathCacheKey&&i.pathCacheKey===h;p?(s=e=i.pathCache,o=!0):(s=e=new Path2D,i.pathCacheKey=h,i.pathCache=s)}if(a.setLineDash)switch(n){case"dotted":a.setLineDash([1,1]);break;case"dashed":a.setLineDash(u),a.lineDashOffset=c;break;case"solid":a.setLineDash([]);break}if(!o&&!i.badLine)switch(e.beginPath&&e.beginPath(),e.moveTo(r[0],r[1]),i.edgeType){case"bezier":case"self":case"compound":case"multibezier":for(var v=2;v+3<r.length;v+=4)e.quadraticCurveTo(r[v],r[v+1],r[v+2],r[v+3]);break;case"straight":case"haystack":for(var y=2;y+1<r.length;y+=2)e.lineTo(r[y],r[y+1]);break;case"segments":if(i.isRound){var S=Ys(i.roundCorners),w;try{for(S.s();!(w=S.n()).done;){var T=w.value;$A(e,T)}}catch(C){S.e(C)}finally{S.f()}e.lineTo(r[r.length-2],r[r.length-1])}else for(var _=2;_+1<r.length;_+=2)e.lineTo(r[_],r[_+1]);break}e=a,l?e.stroke(s):e.stroke(),e.setLineDash&&e.setLineDash([])};Sc.drawEdgeTrianglePath=function(t,e,r){e.fillStyle=e.strokeStyle;for(var n=t.pstyle("width").pfValue,i=0;i+1<r.length;i+=2){var a=[r[i+2]-r[i],r[i+3]-r[i+1]],s=Math.sqrt(a[0]*a[0]+a[1]*a[1]),o=[a[1]/s,-a[0]/s],l=[o[0]*n/2,o[1]*n/2];e.beginPath(),e.moveTo(r[i]-l[0],r[i+1]-l[1]),e.lineTo(r[i]+l[0],r[i+1]+l[1]),e.lineTo(r[i+2],r[i+3]),e.closePath(),e.fill()}};Sc.drawArrowheads=function(t,e,r){var n=e._private.rscratch,i=n.edgeType==="haystack";i||this.drawArrowhead(t,e,"source",n.arrowStartX,n.arrowStartY,n.srcArrowAngle,r),this.drawArrowhead(t,e,"mid-target",n.midX,n.midY,n.midtgtArrowAngle,r),this.drawArrowhead(t,e,"mid-source",n.midX,n.midY,n.midsrcArrowAngle,r),i||this.drawArrowhead(t,e,"target",n.arrowEndX,n.arrowEndY,n.tgtArrowAngle,r)};Sc.drawArrowhead=function(t,e,r,n,i,a,s){if(!(isNaN(n)||n==null||isNaN(i)||i==null||isNaN(a)||a==null)){var o=this,l=e.pstyle(r+"-arrow-shape").value;if(l!=="none"){var u=e.pstyle(r+"-arrow-fill").value==="hollow"?"both":"filled",c=e.pstyle(r+"-arrow-fill").value,h=e.pstyle("width").pfValue,p=e.pstyle(r+"-arrow-width"),v=p.value==="match-line"?h:p.pfValue;p.units==="%"&&(v*=h);var y=e.pstyle("opacity").value;s===void 0&&(s=y);var S=t.globalCompositeOperation;(s!==1||c==="hollow")&&(t.globalCompositeOperation="destination-out",o.colorFillStyle(t,255,255,255,1),o.colorStrokeStyle(t,255,255,255,1),o.drawArrowShape(e,t,u,h,l,v,n,i,a),t.globalCompositeOperation=S);var w=e.pstyle(r+"-arrow-color").value;o.colorFillStyle(t,w[0],w[1],w[2],s),o.colorStrokeStyle(t,w[0],w[1],w[2],s),o.drawArrowShape(e,t,c,h,l,v,n,i,a)}}};Sc.drawArrowShape=function(t,e,r,n,i,a,s,o,l){var u=this,c=this.usePaths()&&i!=="triangle-cross",h=!1,p,v=e,y={x:s,y:o},S=t.pstyle("arrow-scale").value,w=this.getArrowWidth(n,S),T=u.arrowShapes[i];if(c){var _=u.arrowPathCache=u.arrowPathCache||[],C=pf(i),N=_[C];N!=null?(p=e=N,h=!0):(p=e=new Path2D,_[C]=p)}h||(e.beginPath&&e.beginPath(),c?T.draw(e,1,0,{x:0,y:0},1):T.draw(e,w,l,y,n),e.closePath&&e.closePath()),e=v,c&&(e.translate(s,o),e.rotate(l),e.scale(w,w)),(r==="filled"||r==="both")&&(c?e.fill(p):e.fill()),(r==="hollow"||r==="both")&&(e.lineWidth=a/(c?w:1),e.lineJoin="miter",c?e.stroke(p):e.stroke()),c&&(e.scale(1/w,1/w),e.rotate(-l),e.translate(-s,-o))};var x_={};x_.safeDrawImage=function(t,e,r,n,i,a,s,o,l,u){if(!(i<=0||a<=0||l<=0||u<=0))try{t.drawImage(e,r,n,i,a,s,o,l,u)}catch(c){rn(c)}};x_.drawInscribedImage=function(t,e,r,n,i){var a=this,s=r.position(),o=s.x,l=s.y,u=r.cy().style(),c=u.getIndexedStyle.bind(u),h=c(r,"background-fit","value",n),p=c(r,"background-repeat","value",n),v=r.width(),y=r.height(),S=r.padding()*2,w=v+(c(r,"background-width-relative-to","value",n)==="inner"?0:S),T=y+(c(r,"background-height-relative-to","value",n)==="inner"?0:S),_=r._private.rscratch,C=c(r,"background-clip","value",n),N=C==="node",A=c(r,"background-image-opacity","value",n)*i,I=c(r,"background-image-smoothing","value",n),j=r.pstyle("corner-radius").value;j!=="auto"&&(j=r.pstyle("corner-radius").pfValue);var O=e.width||e.cachedW,F=e.height||e.cachedH;(O==null||F==null)&&(document.body.appendChild(e),O=e.cachedW=e.width||e.offsetWidth,F=e.cachedH=e.height||e.offsetHeight,document.body.removeChild(e));var B=O,$=F;if(c(r,"background-width","value",n)!=="auto"&&(c(r,"background-width","units",n)==="%"?B=c(r,"background-width","pfValue",n)*w:B=c(r,"background-width","pfValue",n)),c(r,"background-height","value",n)!=="auto"&&(c(r,"background-height","units",n)==="%"?$=c(r,"background-height","pfValue",n)*T:$=c(r,"background-height","pfValue",n)),!(B===0||$===0)){if(h==="contain"){var Z=Math.min(w/B,T/$);B*=Z,$*=Z}else if(h==="cover"){var Z=Math.max(w/B,T/$);B*=Z,$*=Z}var D=o-w/2,H=c(r,"background-position-x","units",n),U=c(r,"background-position-x","pfValue",n);H==="%"?D+=(w-B)*U:D+=U;var W=c(r,"background-offset-x","units",n),Y=c(r,"background-offset-x","pfValue",n);W==="%"?D+=(w-B)*Y:D+=Y;var Q=l-T/2,ne=c(r,"background-position-y","units",n),re=c(r,"background-position-y","pfValue",n);ne==="%"?Q+=(T-$)*re:Q+=re;var q=c(r,"background-offset-y","units",n),te=c(r,"background-offset-y","pfValue",n);q==="%"?Q+=(T-$)*te:Q+=te,_.pathCache&&(D-=o,Q-=l,o=0,l=0);var ae=t.globalAlpha;t.globalAlpha=A;var de=a.getImgSmoothing(t),ge=!1;if(I==="no"&&de?(a.setImgSmoothing(t,!1),ge=!0):I==="yes"&&!de&&(a.setImgSmoothing(t,!0),ge=!0),p==="no-repeat")N&&(t.save(),_.pathCache?t.clip(_.pathCache):(a.nodeShapes[a.getNodeShape(r)].draw(t,o,l,w,T,j,_),t.clip())),a.safeDrawImage(t,e,0,0,O,F,D,Q,B,$),N&&t.restore();else{var ye=t.createPattern(e,p);t.fillStyle=ye,a.nodeShapes[a.getNodeShape(r)].draw(t,o,l,w,T,j,_),t.translate(D,Q),t.fill(),t.translate(-D,-Q)}t.globalAlpha=ae,ge&&a.setImgSmoothing(t,de)}};var Mf={};Mf.eleTextBiggerThanMin=function(t,e){if(!e){var r=t.cy().zoom(),n=this.getPixelRatio(),i=Math.ceil(n_(r*n));e=Math.pow(2,i)}var a=t.pstyle("font-size").pfValue*e,s=t.pstyle("min-zoomed-font-size").pfValue;return!(a<s)};Mf.drawElementText=function(t,e,r,n,i){var a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!0,s=this;if(n==null){if(a&&!s.eleTextBiggerThanMin(e))return}else if(n===!1)return;if(e.isNode()){var o=e.pstyle("label");if(!o||!o.value)return;var l=s.getLabelJustification(e);t.textAlign=l,t.textBaseline="bottom"}else{var u=e.element()._private.rscratch.badLine,c=e.pstyle("label"),h=e.pstyle("source-label"),p=e.pstyle("target-label");if(u||(!c||!c.value)&&(!h||!h.value)&&(!p||!p.value))return;t.textAlign="center",t.textBaseline="bottom"}var v=!r,y;r&&(y=r,t.translate(-y.x1,-y.y1)),i==null?(s.drawText(t,e,null,v,a),e.isEdge()&&(s.drawText(t,e,"source",v,a),s.drawText(t,e,"target",v,a))):s.drawText(t,e,i,v,a),r&&t.translate(y.x1,y.y1)};Mf.getFontCache=function(t){var e;this.fontCaches=this.fontCaches||[];for(var r=0;r<this.fontCaches.length;r++)if(e=this.fontCaches[r],e.context===t)return e;return e={context:t},this.fontCaches.push(e),e};Mf.setupTextStyle=function(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,n=e.pstyle("font-style").strValue,i=e.pstyle("font-size").pfValue+"px",a=e.pstyle("font-family").strValue,s=e.pstyle("font-weight").strValue,o=r?e.effectiveOpacity()*e.pstyle("text-opacity").value:1,l=e.pstyle("text-outline-opacity").value*o,u=e.pstyle("color").value,c=e.pstyle("text-outline-color").value;t.font=n+" "+s+" "+i+" "+a,t.lineJoin="round",this.colorFillStyle(t,u[0],u[1],u[2],o),this.colorStrokeStyle(t,c[0],c[1],c[2],l)};function uU(t,e,r,n,i){var a=Math.min(n,i),s=a/2,o=e+n/2,l=r+i/2;t.beginPath(),t.arc(o,l,s,0,Math.PI*2),t.closePath()}function KN(t,e,r,n,i){var a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:5,s=Math.min(a,n/2,i/2);t.beginPath(),t.moveTo(e+s,r),t.lineTo(e+n-s,r),t.quadraticCurveTo(e+n,r,e+n,r+s),t.lineTo(e+n,r+i-s),t.quadraticCurveTo(e+n,r+i,e+n-s,r+i),t.lineTo(e+s,r+i),t.quadraticCurveTo(e,r+i,e,r+i-s),t.lineTo(e,r+s),t.quadraticCurveTo(e,r,e+s,r),t.closePath()}Mf.getTextAngle=function(t,e){var r,n=t._private,i=n.rscratch,a=e?e+"-":"",s=t.pstyle(a+"text-rotation");if(s.strValue==="autorotate"){var o=$s(i,"labelAngle",e);r=t.isEdge()?o:0}else s.strValue==="none"?r=0:r=s.pfValue;return r};Mf.drawText=function(t,e,r){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,a=e._private,s=a.rscratch,o=i?e.effectiveOpacity():1;if(!(i&&(o===0||e.pstyle("text-opacity").value===0))){r==="main"&&(r=null);var l=$s(s,"labelX",r),u=$s(s,"labelY",r),c,h,p=this.getLabelText(e,r);if(p!=null&&p!==""&&!isNaN(l)&&!isNaN(u)){this.setupTextStyle(t,e,i);var v=r?r+"-":"",y=$s(s,"labelWidth",r),S=$s(s,"labelHeight",r),w=e.pstyle(v+"text-margin-x").pfValue,T=e.pstyle(v+"text-margin-y").pfValue,_=e.isEdge(),C=e.pstyle("text-halign").value,N=e.pstyle("text-valign").value;_&&(C="center",N="center"),l+=w,u+=T;var A;switch(n?A=this.getTextAngle(e,r):A=0,A!==0&&(c=l,h=u,t.translate(c,h),t.rotate(A),l=0,u=0),N){case"top":break;case"center":u+=S/2;break;case"bottom":u+=S;break}var I=e.pstyle("text-background-opacity").value,j=e.pstyle("text-border-opacity").value,O=e.pstyle("text-border-width").pfValue,F=e.pstyle("text-background-padding").pfValue,B=e.pstyle("text-background-shape").strValue,$=B==="round-rectangle"||B==="roundrectangle",Z=B==="circle",D=2;if(I>0||O>0&&j>0){var H=t.fillStyle,U=t.strokeStyle,W=t.lineWidth,Y=e.pstyle("text-background-color").value,Q=e.pstyle("text-border-color").value,ne=e.pstyle("text-border-style").value,re=I>0,q=O>0&&j>0,te=l-F;switch(C){case"left":te-=y;break;case"center":te-=y/2;break}var ae=u-S-F,de=y+2*F,ge=S+2*F;if(re&&(t.fillStyle="rgba(".concat(Y[0],",").concat(Y[1],",").concat(Y[2],",").concat(I*o,")")),q&&(t.strokeStyle="rgba(".concat(Q[0],",").concat(Q[1],",").concat(Q[2],",").concat(j*o,")"),t.lineWidth=O,t.setLineDash))switch(ne){case"dotted":t.setLineDash([1,1]);break;case"dashed":t.setLineDash([4,2]);break;case"double":t.lineWidth=O/4,t.setLineDash([]);break;default:t.setLineDash([]);break}if($?(t.beginPath(),KN(t,te,ae,de,ge,D)):Z?(t.beginPath(),uU(t,te,ae,de,ge)):(t.beginPath(),t.rect(te,ae,de,ge)),re&&t.fill(),q&&t.stroke(),q&&ne==="double"){var ye=O/2;t.beginPath(),$?KN(t,te+ye,ae+ye,de-2*ye,ge-2*ye,D):t.rect(te+ye,ae+ye,de-2*ye,ge-2*ye),t.stroke()}t.fillStyle=H,t.strokeStyle=U,t.lineWidth=W,t.setLineDash&&t.setLineDash([])}var se=2*e.pstyle("text-outline-width").pfValue;if(se>0&&(t.lineWidth=se),e.pstyle("text-wrap").value==="wrap"){var fe=$s(s,"labelWrapCachedLines",r),le=$s(s,"labelLineHeight",r),pe=y/2,me=this.getLabelJustification(e);switch(me==="auto"||(C==="left"?me==="left"?l+=-y:me==="center"&&(l+=-pe):C==="center"?me==="left"?l+=-pe:me==="right"&&(l+=pe):C==="right"&&(me==="center"?l+=pe:me==="right"&&(l+=y))),N){case"top":u-=(fe.length-1)*le;break;case"center":case"bottom":u-=(fe.length-1)*le;break}for(var xe=0;xe<fe.length;xe++)se>0&&t.strokeText(fe[xe],l,u),t.fillText(fe[xe],l,u),u+=le}else se>0&&t.strokeText(p,l,u),t.fillText(p,l,u);A!==0&&(t.rotate(-A),t.translate(-c,-h))}}};var lh={};lh.drawNode=function(t,e,r){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!0,s=this,o,l,u=e._private,c=u.rscratch,h=e.position();if(!(!bt(h.x)||!bt(h.y))&&!(a&&!e.visible())){var p=a?e.effectiveOpacity():1,v=s.usePaths(),y,S=!1,w=e.padding();o=e.width()+2*w,l=e.height()+2*w;var T;r&&(T=r,t.translate(-T.x1,-T.y1));for(var _=e.pstyle("background-image"),C=_.value,N=new Array(C.length),A=new Array(C.length),I=0,j=0;j<C.length;j++){var O=C[j],F=N[j]=O!=null&&O!=="none";if(F){var B=e.cy().style().getIndexedStyle(e,"background-image-crossorigin","value",j);I++,A[j]=s.getCachedImage(O,B,function(){u.backgroundTimestamp=Date.now(),e.emitAndNotify("background")})}}var $=e.pstyle("background-blacken").value,Z=e.pstyle("border-width").pfValue,D=e.pstyle("background-opacity").value*p,H=e.pstyle("border-color").value,U=e.pstyle("border-style").value,W=e.pstyle("border-join").value,Y=e.pstyle("border-cap").value,Q=e.pstyle("border-position").value,ne=e.pstyle("border-dash-pattern").pfValue,re=e.pstyle("border-dash-offset").pfValue,q=e.pstyle("border-opacity").value*p,te=e.pstyle("outline-width").pfValue,ae=e.pstyle("outline-color").value,de=e.pstyle("outline-style").value,ge=e.pstyle("outline-opacity").value*p,ye=e.pstyle("outline-offset").value,se=e.pstyle("corner-radius").value;se!=="auto"&&(se=e.pstyle("corner-radius").pfValue);var fe=function(){var ft=arguments.length>0&&arguments[0]!==void 0?arguments[0]:D;s.eleFillStyle(t,e,ft)},le=function(){var ft=arguments.length>0&&arguments[0]!==void 0?arguments[0]:q;s.colorStrokeStyle(t,H[0],H[1],H[2],ft)},pe=function(){var ft=arguments.length>0&&arguments[0]!==void 0?arguments[0]:ge;s.colorStrokeStyle(t,ae[0],ae[1],ae[2],ft)},me=function(ft,qe,ce,ve){var ke=s.nodePathCache=s.nodePathCache||[],Te=HM(ce==="polygon"?ce+","+ve.join(","):ce,""+qe,""+ft,""+se),Re=ke[Te],Je,ze=!1;return Re!=null?(Je=Re,ze=!0,c.pathCache=Je):(Je=new Path2D,ke[Te]=c.pathCache=Je),{path:Je,cacheHit:ze}},xe=e.pstyle("shape").strValue,Se=e.pstyle("shape-polygon-points").pfValue;if(v){t.translate(h.x,h.y);var Ve=me(o,l,xe,Se);y=Ve.path,S=Ve.cacheHit}var $e=function(){if(!S){var ft=h;v&&(ft={x:0,y:0}),s.nodeShapes[s.getNodeShape(e)].draw(y||t,ft.x,ft.y,o,l,se,c)}v?t.fill(y):t.fill()},St=function(){for(var ft=arguments.length>0&&arguments[0]!==void 0?arguments[0]:p,qe=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,ce=u.backgrounding,ve=0,ke=0;ke<A.length;ke++){var Te=e.cy().style().getIndexedStyle(e,"background-image-containment","value",ke);if(qe&&Te==="over"||!qe&&Te==="inside"){ve++;continue}N[ke]&&A[ke].complete&&!A[ke].error&&(ve++,s.drawInscribedImage(t,A[ke],e,ke,ft))}u.backgrounding=ve!==I,ce!==u.backgrounding&&e.updateStyle(!1)},rt=function(){var ft=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,qe=arguments.length>1&&arguments[1]!==void 0?arguments[1]:p;s.hasPie(e)&&(s.drawPie(t,e,qe),ft&&(v||s.nodeShapes[s.getNodeShape(e)].draw(t,h.x,h.y,o,l,se,c)))},lt=function(){var ft=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,qe=arguments.length>1&&arguments[1]!==void 0?arguments[1]:p;s.hasStripe(e)&&(t.save(),v?t.clip(c.pathCache):(s.nodeShapes[s.getNodeShape(e)].draw(t,h.x,h.y,o,l,se,c),t.clip()),s.drawStripe(t,e,qe),t.restore(),ft&&(v||s.nodeShapes[s.getNodeShape(e)].draw(t,h.x,h.y,o,l,se,c)))},De=function(){var ft=arguments.length>0&&arguments[0]!==void 0?arguments[0]:p,qe=($>0?$:-$)*ft,ce=$>0?0:255;$!==0&&(s.colorFillStyle(t,ce,ce,ce,qe),v?t.fill(y):t.fill())},Le=function(){if(Z>0){if(t.lineWidth=Z,t.lineCap=Y,t.lineJoin=W,t.setLineDash)switch(U){case"dotted":t.setLineDash([1,1]);break;case"dashed":t.setLineDash(ne),t.lineDashOffset=re;break;case"solid":case"double":t.setLineDash([]);break}if(Q!=="center"){if(t.save(),t.lineWidth*=2,Q==="inside")v?t.clip(y):t.clip();else{var ft=new Path2D;ft.rect(-o/2-Z,-l/2-Z,o+2*Z,l+2*Z),ft.addPath(y),t.clip(ft,"evenodd")}v?t.stroke(y):t.stroke(),t.restore()}else v?t.stroke(y):t.stroke();if(U==="double"){t.lineWidth=Z/3;var qe=t.globalCompositeOperation;t.globalCompositeOperation="destination-out",v?t.stroke(y):t.stroke(),t.globalCompositeOperation=qe}t.setLineDash&&t.setLineDash([])}},Qe=function(){if(te>0){if(t.lineWidth=te,t.lineCap="butt",t.setLineDash)switch(de){case"dotted":t.setLineDash([1,1]);break;case"dashed":t.setLineDash([4,2]);break;case"solid":case"double":t.setLineDash([]);break}var ft=h;v&&(ft={x:0,y:0});var qe=s.getNodeShape(e),ce=Z;Q==="inside"&&(ce=0),Q==="outside"&&(ce*=2);var ve=(o+ce+(te+ye))/o,ke=(l+ce+(te+ye))/l,Te=o*ve,Re=l*ke,Je=s.nodeShapes[qe].points,ze;if(v){var vt=me(Te,Re,qe,Je);ze=vt.path}if(qe==="ellipse")s.drawEllipsePath(ze||t,ft.x,ft.y,Te,Re);else if(["round-diamond","round-heptagon","round-hexagon","round-octagon","round-pentagon","round-polygon","round-triangle","round-tag"].includes(qe)){var pt=0,At=0,Ut=0;qe==="round-diamond"?pt=(ce+ye+te)*1.4:qe==="round-heptagon"?(pt=(ce+ye+te)*1.075,Ut=-(ce/2+ye+te)/35):qe==="round-hexagon"?pt=(ce+ye+te)*1.12:qe==="round-pentagon"?(pt=(ce+ye+te)*1.13,Ut=-(ce/2+ye+te)/15):qe==="round-tag"?(pt=(ce+ye+te)*1.12,At=(ce/2+te+ye)*.07):qe==="round-triangle"&&(pt=(ce+ye+te)*(Math.PI/2),Ut=-(ce+ye/2+te)/Math.PI),pt!==0&&(ve=(o+pt)/o,Te=o*ve,["round-hexagon","round-tag"].includes(qe)||(ke=(l+pt)/l,Re=l*ke)),se=se==="auto"?eA(Te,Re):se;for(var Kt=Te/2,Ct=Re/2,Yt=se+(ce+te+ye)/2,Xt=new Array(Je.length/2),Lr=new Array(Je.length/2),ar=0;ar<Je.length/2;ar++)Xt[ar]={x:ft.x+At+Kt*Je[ar*2],y:ft.y+Ut+Ct*Je[ar*2+1]};var mn,Wr,Br,nn,br=Xt.length;for(Wr=Xt[br-1],mn=0;mn<br;mn++)Br=Xt[mn%br],nn=Xt[(mn+1)%br],Lr[mn]=v_(Wr,Br,nn,Yt),Wr=Br,Br=nn;s.drawRoundPolygonPath(ze||t,ft.x+At,ft.y+Ut,o*ve,l*ke,Je,Lr)}else if(["roundrectangle","round-rectangle"].includes(qe))se=se==="auto"?Xd(Te,Re):se,s.drawRoundRectanglePath(ze||t,ft.x,ft.y,Te,Re,se+(ce+te+ye)/2);else if(["cutrectangle","cut-rectangle"].includes(qe))se=se==="auto"?s_():se,s.drawCutRectanglePath(ze||t,ft.x,ft.y,Te,Re,null,se+(ce+te+ye)/4);else if(["bottomroundrectangle","bottom-round-rectangle"].includes(qe))se=se==="auto"?Xd(Te,Re):se,s.drawBottomRoundRectanglePath(ze||t,ft.x,ft.y,Te,Re,se+(ce+te+ye)/2);else if(qe==="barrel")s.drawBarrelPath(ze||t,ft.x,ft.y,Te,Re);else if(qe.startsWith("polygon")||["rhomboid","right-rhomboid","round-tag","tag","vee"].includes(qe)){var Tt=(ce+te+ye)/o;Je=ox(lx(Je,Tt)),s.drawPolygonPath(ze||t,ft.x,ft.y,o,l,Je)}else{var zr=(ce+te+ye)/o;Je=ox(lx(Je,-zr)),s.drawPolygonPath(ze||t,ft.x,ft.y,o,l,Je)}if(v?t.stroke(ze):t.stroke(),de==="double"){t.lineWidth=ce/3;var Qn=t.globalCompositeOperation;t.globalCompositeOperation="destination-out",v?t.stroke(ze):t.stroke(),t.globalCompositeOperation=Qn}t.setLineDash&&t.setLineDash([])}},Ce=function(){i&&s.drawNodeOverlay(t,e,h,o,l)},Fe=function(){i&&s.drawNodeUnderlay(t,e,h,o,l)},Ke=function(){s.drawElementText(t,e,null,n)},mt=e.pstyle("ghost").value==="yes";if(mt){var gt=e.pstyle("ghost-offset-x").pfValue,yt=e.pstyle("ghost-offset-y").pfValue,jt=e.pstyle("ghost-opacity").value,qt=jt*p;t.translate(gt,yt),pe(),Qe(),fe(jt*D),$e(),St(qt,!0),le(jt*q),Le(),rt($!==0||Z!==0),lt($!==0||Z!==0),St(qt,!1),De(qt),t.translate(-gt,-yt)}v&&t.translate(-h.x,-h.y),Fe(),v&&t.translate(h.x,h.y),pe(),Qe(),fe(),$e(),St(p,!0),le(),Le(),rt($!==0||Z!==0),lt($!==0||Z!==0),St(p,!1),De(),v&&t.translate(-h.x,-h.y),Ke(),Ce(),r&&t.translate(T.x1,T.y1)}};var sR=function(e){if(!["overlay","underlay"].includes(e))throw new Error("Invalid state");return function(r,n,i,a,s){var o=this;if(n.visible()){var l=n.pstyle("".concat(e,"-padding")).pfValue,u=n.pstyle("".concat(e,"-opacity")).value,c=n.pstyle("".concat(e,"-color")).value,h=n.pstyle("".concat(e,"-shape")).value,p=n.pstyle("".concat(e,"-corner-radius")).value;if(u>0){if(i=i||n.position(),a==null||s==null){var v=n.padding();a=n.width()+2*v,s=n.height()+2*v}o.colorFillStyle(r,c[0],c[1],c[2],u),o.nodeShapes[h].draw(r,i.x,i.y,a+l*2,s+l*2,p),r.fill()}}}};lh.drawNodeOverlay=sR("overlay");lh.drawNodeUnderlay=sR("underlay");lh.hasPie=function(t){return t=t[0],t._private.hasPie};lh.hasStripe=function(t){return t=t[0],t._private.hasStripe};lh.drawPie=function(t,e,r,n){e=e[0],n=n||e.position();var i=e.cy().style(),a=e.pstyle("pie-size"),s=e.pstyle("pie-hole"),o=e.pstyle("pie-start-angle").pfValue,l=n.x,u=n.y,c=e.width(),h=e.height(),p=Math.min(c,h)/2,v,y=0,S=this.usePaths();if(S&&(l=0,u=0),a.units==="%"?p=p*a.pfValue:a.pfValue!==void 0&&(p=a.pfValue/2),s.units==="%"?v=p*s.pfValue:s.pfValue!==void 0&&(v=s.pfValue/2),!(v>=p))for(var w=1;w<=i.pieBackgroundN;w++){var T=e.pstyle("pie-"+w+"-background-size").value,_=e.pstyle("pie-"+w+"-background-color").value,C=e.pstyle("pie-"+w+"-background-opacity").value*r,N=T/100;N+y>1&&(N=1-y);var A=1.5*Math.PI+2*Math.PI*y;A+=o;var I=2*Math.PI*N,j=A+I;T===0||y>=1||y+N>1||(v===0?(t.beginPath(),t.moveTo(l,u),t.arc(l,u,p,A,j),t.closePath()):(t.beginPath(),t.arc(l,u,p,A,j),t.arc(l,u,v,j,A,!0),t.closePath()),this.colorFillStyle(t,_[0],_[1],_[2],C),t.fill(),y+=N)}};lh.drawStripe=function(t,e,r,n){e=e[0],n=n||e.position();var i=e.cy().style(),a=n.x,s=n.y,o=e.width(),l=e.height(),u=0,c=this.usePaths();t.save();var h=e.pstyle("stripe-direction").value,p=e.pstyle("stripe-size");switch(h){case"vertical":break;case"righward":t.rotate(-Math.PI/2);break}var v=o,y=l;p.units==="%"?(v=v*p.pfValue,y=y*p.pfValue):p.pfValue!==void 0&&(v=p.pfValue,y=p.pfValue),c&&(a=0,s=0),s-=v/2,a-=y/2;for(var S=1;S<=i.stripeBackgroundN;S++){var w=e.pstyle("stripe-"+S+"-background-size").value,T=e.pstyle("stripe-"+S+"-background-color").value,_=e.pstyle("stripe-"+S+"-background-opacity").value*r,C=w/100;C+u>1&&(C=1-u),!(w===0||u>=1||u+C>1)&&(t.beginPath(),t.rect(a,s+y*u,v,y*C),t.closePath(),this.colorFillStyle(t,T[0],T[1],T[2],_),t.fill(),u+=C)}t.restore()};var As={},cU=100;As.getPixelRatio=function(){var t=this.data.contexts[0];if(this.forcedPixelRatio!=null)return this.forcedPixelRatio;var e=this.cy.window(),r=t.backingStorePixelRatio||t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1;return(e.devicePixelRatio||1)/r};As.paintCache=function(t){for(var e=this.paintCaches=this.paintCaches||[],r=!0,n,i=0;i<e.length;i++)if(n=e[i],n.context===t){r=!1;break}return r&&(n={context:t},e.push(n)),n};As.createGradientStyleFor=function(t,e,r,n,i){var a,s=this.usePaths(),o=r.pstyle(e+"-gradient-stop-colors").value,l=r.pstyle(e+"-gradient-stop-positions").pfValue;if(n==="radial-gradient")if(r.isEdge()){var u=r.sourceEndpoint(),c=r.targetEndpoint(),h=r.midpoint(),p=mf(u,h),v=mf(c,h);a=t.createRadialGradient(h.x,h.y,0,h.x,h.y,Math.max(p,v))}else{var y=s?{x:0,y:0}:r.position(),S=r.paddedWidth(),w=r.paddedHeight();a=t.createRadialGradient(y.x,y.y,0,y.x,y.y,Math.max(S,w))}else if(r.isEdge()){var T=r.sourceEndpoint(),_=r.targetEndpoint();a=t.createLinearGradient(T.x,T.y,_.x,_.y)}else{var C=s?{x:0,y:0}:r.position(),N=r.paddedWidth(),A=r.paddedHeight(),I=N/2,j=A/2,O=r.pstyle("background-gradient-direction").value;switch(O){case"to-bottom":a=t.createLinearGradient(C.x,C.y-j,C.x,C.y+j);break;case"to-top":a=t.createLinearGradient(C.x,C.y+j,C.x,C.y-j);break;case"to-left":a=t.createLinearGradient(C.x+I,C.y,C.x-I,C.y);break;case"to-right":a=t.createLinearGradient(C.x-I,C.y,C.x+I,C.y);break;case"to-bottom-right":case"to-right-bottom":a=t.createLinearGradient(C.x-I,C.y-j,C.x+I,C.y+j);break;case"to-top-right":case"to-right-top":a=t.createLinearGradient(C.x-I,C.y+j,C.x+I,C.y-j);break;case"to-bottom-left":case"to-left-bottom":a=t.createLinearGradient(C.x+I,C.y-j,C.x-I,C.y+j);break;case"to-top-left":case"to-left-top":a=t.createLinearGradient(C.x+I,C.y+j,C.x-I,C.y-j);break}}if(!a)return null;for(var F=l.length===o.length,B=o.length,$=0;$<B;$++)a.addColorStop(F?l[$]:$/(B-1),"rgba("+o[$][0]+","+o[$][1]+","+o[$][2]+","+i+")");return a};As.gradientFillStyle=function(t,e,r,n){var i=this.createGradientStyleFor(t,"background",e,r,n);if(!i)return null;t.fillStyle=i};As.colorFillStyle=function(t,e,r,n,i){t.fillStyle="rgba("+e+","+r+","+n+","+i+")"};As.eleFillStyle=function(t,e,r){var n=e.pstyle("background-fill").value;if(n==="linear-gradient"||n==="radial-gradient")this.gradientFillStyle(t,e,n,r);else{var i=e.pstyle("background-color").value;this.colorFillStyle(t,i[0],i[1],i[2],r)}};As.gradientStrokeStyle=function(t,e,r,n){var i=this.createGradientStyleFor(t,"line",e,r,n);if(!i)return null;t.strokeStyle=i};As.colorStrokeStyle=function(t,e,r,n,i){t.strokeStyle="rgba("+e+","+r+","+n+","+i+")"};As.eleStrokeStyle=function(t,e,r){var n=e.pstyle("line-fill").value;if(n==="linear-gradient"||n==="radial-gradient")this.gradientStrokeStyle(t,e,n,r);else{var i=e.pstyle("line-color").value;this.colorStrokeStyle(t,i[0],i[1],i[2],r)}};As.matchCanvasSize=function(t){var e=this,r=e.data,n=e.findContainerClientCoords(),i=n[2],a=n[3],s=e.getPixelRatio(),o=e.motionBlurPxRatio;(t===e.data.bufferCanvases[e.MOTIONBLUR_BUFFER_NODE]||t===e.data.bufferCanvases[e.MOTIONBLUR_BUFFER_DRAG])&&(s=o);var l=i*s,u=a*s,c;if(!(l===e.canvasWidth&&u===e.canvasHeight)){e.fontCaches=null;var h=r.canvasContainer;h.style.width=i+"px",h.style.height=a+"px";for(var p=0;p<e.CANVAS_LAYERS;p++)c=r.canvases[p],c.width=l,c.height=u,c.style.width=i+"px",c.style.height=a+"px";for(var p=0;p<e.BUFFER_COUNT;p++)c=r.bufferCanvases[p],c.width=l,c.height=u,c.style.width=i+"px",c.style.height=a+"px";e.textureMult=1,s<=1&&(c=r.bufferCanvases[e.TEXTURE_BUFFER],e.textureMult=2,c.width=l*e.textureMult,c.height=u*e.textureMult),e.canvasWidth=l,e.canvasHeight=u,e.pixelRatio=s}};As.renderTo=function(t,e,r,n){this.render({forcedContext:t,forcedZoom:e,forcedPan:r,drawAllLayers:!0,forcedPxRatio:n})};As.clearCanvas=function(){var t=this,e=t.data;function r(n){n.clearRect(0,0,t.canvasWidth,t.canvasHeight)}r(e.contexts[t.NODE]),r(e.contexts[t.DRAG])};As.render=function(t){var e=this;t=t||KM();var r=e.cy,n=t.forcedContext,i=t.drawAllLayers,a=t.drawOnlyNodeLayer,s=t.forcedZoom,o=t.forcedPan,l=t.forcedPxRatio===void 0?this.getPixelRatio():t.forcedPxRatio,u=e.data,c=u.canvasNeedsRedraw,h=e.textureOnViewport&&!n&&(e.pinching||e.hoverData.dragging||e.swipePanning||e.data.wheelZooming),p=t.motionBlur!==void 0?t.motionBlur:e.motionBlur,v=e.motionBlurPxRatio,y=r.hasCompoundNodes(),S=e.hoverData.draggingEles,w=!!(e.hoverData.selecting||e.touchData.selecting);p=p&&!n&&e.motionBlurEnabled&&!w;var T=p;n||(e.prevPxRatio!==l&&(e.invalidateContainerClientCoordsCache(),e.matchCanvasSize(e.container),e.redrawHint("eles",!0),e.redrawHint("drag",!0)),e.prevPxRatio=l),!n&&e.motionBlurTimeout&&clearTimeout(e.motionBlurTimeout),p&&(e.mbFrames==null&&(e.mbFrames=0),e.mbFrames++,e.mbFrames<3&&(T=!1),e.mbFrames>e.minMbLowQualFrames&&(e.motionBlurPxRatio=e.mbPxRBlurry)),e.clearingMotionBlur&&(e.motionBlurPxRatio=1),e.textureDrawLastFrame&&!h&&(c[e.NODE]=!0,c[e.SELECT_BOX]=!0);var _=r.style(),C=r.zoom(),N=s!==void 0?s:C,A=r.pan(),I={x:A.x,y:A.y},j={zoom:C,pan:{x:A.x,y:A.y}},O=e.prevViewport,F=O===void 0||j.zoom!==O.zoom||j.pan.x!==O.pan.x||j.pan.y!==O.pan.y;!F&&!(S&&!y)&&(e.motionBlurPxRatio=1),o&&(I=o),N*=l,I.x*=l,I.y*=l;var B=e.getCachedZSortedEles();function $(le,pe,me,xe,Se){var Ve=le.globalCompositeOperation;le.globalCompositeOperation="destination-out",e.colorFillStyle(le,255,255,255,e.motionBlurTransparency),le.fillRect(pe,me,xe,Se),le.globalCompositeOperation=Ve}function Z(le,pe){var me,xe,Se,Ve;!e.clearingMotionBlur&&(le===u.bufferContexts[e.MOTIONBLUR_BUFFER_NODE]||le===u.bufferContexts[e.MOTIONBLUR_BUFFER_DRAG])?(me={x:A.x*v,y:A.y*v},xe=C*v,Se=e.canvasWidth*v,Ve=e.canvasHeight*v):(me=I,xe=N,Se=e.canvasWidth,Ve=e.canvasHeight),le.setTransform(1,0,0,1,0,0),pe==="motionBlur"?$(le,0,0,Se,Ve):!n&&(pe===void 0||pe)&&le.clearRect(0,0,Se,Ve),i||(le.translate(me.x,me.y),le.scale(xe,xe)),o&&le.translate(o.x,o.y),s&&le.scale(s,s)}if(h||(e.textureDrawLastFrame=!1),h){if(e.textureDrawLastFrame=!0,!e.textureCache){e.textureCache={},e.textureCache.bb=r.mutableElements().boundingBox(),e.textureCache.texture=e.data.bufferCanvases[e.TEXTURE_BUFFER];var D=e.data.bufferContexts[e.TEXTURE_BUFFER];D.setTransform(1,0,0,1,0,0),D.clearRect(0,0,e.canvasWidth*e.textureMult,e.canvasHeight*e.textureMult),e.render({forcedContext:D,drawOnlyNodeLayer:!0,forcedPxRatio:l*e.textureMult});var j=e.textureCache.viewport={zoom:r.zoom(),pan:r.pan(),width:e.canvasWidth,height:e.canvasHeight};j.mpan={x:(0-j.pan.x)/j.zoom,y:(0-j.pan.y)/j.zoom}}c[e.DRAG]=!1,c[e.NODE]=!1;var H=u.contexts[e.NODE],U=e.textureCache.texture,j=e.textureCache.viewport;H.setTransform(1,0,0,1,0,0),p?$(H,0,0,j.width,j.height):H.clearRect(0,0,j.width,j.height);var W=_.core("outside-texture-bg-color").value,Y=_.core("outside-texture-bg-opacity").value;e.colorFillStyle(H,W[0],W[1],W[2],Y),H.fillRect(0,0,j.width,j.height);var C=r.zoom();Z(H,!1),H.clearRect(j.mpan.x,j.mpan.y,j.width/j.zoom/l,j.height/j.zoom/l),H.drawImage(U,j.mpan.x,j.mpan.y,j.width/j.zoom/l,j.height/j.zoom/l)}else e.textureOnViewport&&!n&&(e.textureCache=null);var Q=r.extent(),ne=e.pinching||e.hoverData.dragging||e.swipePanning||e.data.wheelZooming||e.hoverData.draggingEles||e.cy.animated(),re=e.hideEdgesOnViewport&&ne,q=[];if(q[e.NODE]=!c[e.NODE]&&p&&!e.clearedForMotionBlur[e.NODE]||e.clearingMotionBlur,q[e.NODE]&&(e.clearedForMotionBlur[e.NODE]=!0),q[e.DRAG]=!c[e.DRAG]&&p&&!e.clearedForMotionBlur[e.DRAG]||e.clearingMotionBlur,q[e.DRAG]&&(e.clearedForMotionBlur[e.DRAG]=!0),c[e.NODE]||i||a||q[e.NODE]){var te=p&&!q[e.NODE]&&v!==1,H=n||(te?e.data.bufferContexts[e.MOTIONBLUR_BUFFER_NODE]:u.contexts[e.NODE]),ae=p&&!te?"motionBlur":void 0;Z(H,ae),re?e.drawCachedNodes(H,B.nondrag,l,Q):e.drawLayeredElements(H,B.nondrag,l,Q),e.debug&&e.drawDebugPoints(H,B.nondrag),!i&&!p&&(c[e.NODE]=!1)}if(!a&&(c[e.DRAG]||i||q[e.DRAG])){var te=p&&!q[e.DRAG]&&v!==1,H=n||(te?e.data.bufferContexts[e.MOTIONBLUR_BUFFER_DRAG]:u.contexts[e.DRAG]);Z(H,p&&!te?"motionBlur":void 0),re?e.drawCachedNodes(H,B.drag,l,Q):e.drawCachedElements(H,B.drag,l,Q),e.debug&&e.drawDebugPoints(H,B.drag),!i&&!p&&(c[e.DRAG]=!1)}if(this.drawSelectionRectangle(t,Z),p&&v!==1){var de=u.contexts[e.NODE],ge=e.data.bufferCanvases[e.MOTIONBLUR_BUFFER_NODE],ye=u.contexts[e.DRAG],se=e.data.bufferCanvases[e.MOTIONBLUR_BUFFER_DRAG],fe=function(pe,me,xe){pe.setTransform(1,0,0,1,0,0),xe||!T?pe.clearRect(0,0,e.canvasWidth,e.canvasHeight):$(pe,0,0,e.canvasWidth,e.canvasHeight);var Se=v;pe.drawImage(me,0,0,e.canvasWidth*Se,e.canvasHeight*Se,0,0,e.canvasWidth,e.canvasHeight)};(c[e.NODE]||q[e.NODE])&&(fe(de,ge,q[e.NODE]),c[e.NODE]=!1),(c[e.DRAG]||q[e.DRAG])&&(fe(ye,se,q[e.DRAG]),c[e.DRAG]=!1)}e.prevViewport=j,e.clearingMotionBlur&&(e.clearingMotionBlur=!1,e.motionBlurCleared=!0,e.motionBlur=!0),p&&(e.motionBlurTimeout=setTimeout(function(){e.motionBlurTimeout=null,e.clearedForMotionBlur[e.NODE]=!1,e.clearedForMotionBlur[e.DRAG]=!1,e.motionBlur=!1,e.clearingMotionBlur=!h,e.mbFrames=0,c[e.NODE]=!0,c[e.DRAG]=!0,e.redraw()},cU)),n||r.emit("render")};var Wm;As.drawSelectionRectangle=function(t,e){var r=this,n=r.cy,i=r.data,a=n.style(),s=t.drawOnlyNodeLayer,o=t.drawAllLayers,l=i.canvasNeedsRedraw,u=t.forcedContext;if(r.showFps||!s&&l[r.SELECT_BOX]&&!o){var c=u||i.contexts[r.SELECT_BOX];if(e(c),r.selection[4]==1&&(r.hoverData.selecting||r.touchData.selecting)){var h=r.cy.zoom(),p=a.core("selection-box-border-width").value/h;c.lineWidth=p,c.fillStyle="rgba("+a.core("selection-box-color").value[0]+","+a.core("selection-box-color").value[1]+","+a.core("selection-box-color").value[2]+","+a.core("selection-box-opacity").value+")",c.fillRect(r.selection[0],r.selection[1],r.selection[2]-r.selection[0],r.selection[3]-r.selection[1]),p>0&&(c.strokeStyle="rgba("+a.core("selection-box-border-color").value[0]+","+a.core("selection-box-border-color").value[1]+","+a.core("selection-box-border-color").value[2]+","+a.core("selection-box-opacity").value+")",c.strokeRect(r.selection[0],r.selection[1],r.selection[2]-r.selection[0],r.selection[3]-r.selection[1]))}if(i.bgActivePosistion&&!r.hoverData.selecting){var h=r.cy.zoom(),v=i.bgActivePosistion;c.fillStyle="rgba("+a.core("active-bg-color").value[0]+","+a.core("active-bg-color").value[1]+","+a.core("active-bg-color").value[2]+","+a.core("active-bg-opacity").value+")",c.beginPath(),c.arc(v.x,v.y,a.core("active-bg-size").pfValue/h,0,2*Math.PI),c.fill()}var y=r.lastRedrawTime;if(r.showFps&&y){y=Math.round(y);var S=Math.round(1e3/y),w="1 frame = "+y+" ms = "+S+" fps";if(c.setTransform(1,0,0,1,0,0),c.fillStyle="rgba(255, 0, 0, 0.75)",c.strokeStyle="rgba(255, 0, 0, 0.75)",c.font="30px Arial",!Wm){var T=c.measureText(w);Wm=T.actualBoundingBoxAscent}c.fillText(w,0,Wm);var _=60;c.strokeRect(0,Wm+10,250,20),c.fillRect(0,Wm+10,250*Math.min(S/_,1),20)}o||(l[r.SELECT_BOX]=!1)}};function ZN(t,e,r){var n=t.createShader(e);if(t.shaderSource(n,r),t.compileShader(n),!t.getShaderParameter(n,t.COMPILE_STATUS))throw new Error(t.getShaderInfoLog(n));return n}function dU(t,e,r){var n=ZN(t,t.VERTEX_SHADER,e),i=ZN(t,t.FRAGMENT_SHADER,r),a=t.createProgram();if(t.attachShader(a,n),t.attachShader(a,i),t.linkProgram(a),!t.getProgramParameter(a,t.LINK_STATUS))throw new Error("Could not initialize shaders");return a}function hU(t,e,r){r===void 0&&(r=e);var n=t.makeOffscreenCanvas(e,r),i=n.context=n.getContext("2d");return n.clear=function(){return i.clearRect(0,0,n.width,n.height)},n.clear(),n}function b_(t){var e=t.pixelRatio,r=t.cy.zoom(),n=t.cy.pan();return{zoom:r*e,pan:{x:n.x*e,y:n.y*e}}}function fU(t){var e=t.pixelRatio,r=t.cy.zoom();return r*e}function pU(t,e,r,n,i){var a=n*r+e.x,s=i*r+e.y;return s=Math.round(t.canvasHeight-s),[a,s]}function mU(t){return t.pstyle("background-fill").value!=="solid"||t.pstyle("background-image").strValue!=="none"?!1:t.pstyle("border-width").value===0||t.pstyle("border-opacity").value===0?!0:t.pstyle("border-style").value==="solid"}function gU(t,e){if(t.length!==e.length)return!1;for(var r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function Vh(t,e,r){var n=t[0]/255,i=t[1]/255,a=t[2]/255,s=e,o=r||new Array(4);return o[0]=n*s,o[1]=i*s,o[2]=a*s,o[3]=s,o}function vp(t,e){var r=e||new Array(4);return r[0]=(t>>0&255)/255,r[1]=(t>>8&255)/255,r[2]=(t>>16&255)/255,r[3]=(t>>24&255)/255,r}function vU(t){return t[0]+(t[1]<<8)+(t[2]<<16)+(t[3]<<24)}function yU(t,e){var r=t.createTexture();return r.buffer=function(n){t.bindTexture(t.TEXTURE_2D,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR_MIPMAP_NEAREST),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n),t.generateMipmap(t.TEXTURE_2D),t.bindTexture(t.TEXTURE_2D,null)},r.deleteTexture=function(){t.deleteTexture(r)},r}function oR(t,e){switch(e){case"float":return[1,t.FLOAT,4];case"vec2":return[2,t.FLOAT,4];case"vec3":return[3,t.FLOAT,4];case"vec4":return[4,t.FLOAT,4];case"int":return[1,t.INT,4];case"ivec2":return[2,t.INT,4]}}function lR(t,e,r){switch(e){case t.FLOAT:return new Float32Array(r);case t.INT:return new Int32Array(r)}}function xU(t,e,r,n,i,a){switch(e){case t.FLOAT:return new Float32Array(r.buffer,a*n,i);case t.INT:return new Int32Array(r.buffer,a*n,i)}}function bU(t,e,r,n){var i=oR(t,e),a=ji(i,2),s=a[0],o=a[1],l=lR(t,o,n),u=t.createBuffer();return t.bindBuffer(t.ARRAY_BUFFER,u),t.bufferData(t.ARRAY_BUFFER,l,t.STATIC_DRAW),o===t.FLOAT?t.vertexAttribPointer(r,s,o,!1,0,0):o===t.INT&&t.vertexAttribIPointer(r,s,o,0,0),t.enableVertexAttribArray(r),t.bindBuffer(t.ARRAY_BUFFER,null),u}function vu(t,e,r,n){var i=oR(t,r),a=ji(i,3),s=a[0],o=a[1],l=a[2],u=lR(t,o,e*s),c=s*l,h=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,h),t.bufferData(t.ARRAY_BUFFER,e*c,t.DYNAMIC_DRAW),t.enableVertexAttribArray(n),o===t.FLOAT?t.vertexAttribPointer(n,s,o,!1,c,0):o===t.INT&&t.vertexAttribIPointer(n,s,o,c,0),t.vertexAttribDivisor(n,1),t.bindBuffer(t.ARRAY_BUFFER,null);for(var p=new Array(e),v=0;v<e;v++)p[v]=xU(t,o,u,c,s,v);return h.dataArray=u,h.stride=c,h.size=s,h.getView=function(y){return p[y]},h.setPoint=function(y,S,w){var T=p[y];T[0]=S,T[1]=w},h.bufferSubData=function(y){t.bindBuffer(t.ARRAY_BUFFER,h),y?t.bufferSubData(t.ARRAY_BUFFER,0,u,0,y*s):t.bufferSubData(t.ARRAY_BUFFER,0,u)},h}function wU(t,e,r){for(var n=9,i=new Float32Array(e*n),a=new Array(e),s=0;s<e;s++){var o=s*n*4;a[s]=new Float32Array(i.buffer,o,n)}var l=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,l),t.bufferData(t.ARRAY_BUFFER,i.byteLength,t.DYNAMIC_DRAW);for(var u=0;u<3;u++){var c=r+u;t.enableVertexAttribArray(c),t.vertexAttribPointer(c,3,t.FLOAT,!1,36,u*12),t.vertexAttribDivisor(c,1)}return t.bindBuffer(t.ARRAY_BUFFER,null),l.getMatrixView=function(h){return a[h]},l.setData=function(h,p){a[p].set(h,0)},l.bufferSubData=function(){t.bindBuffer(t.ARRAY_BUFFER,l),t.bufferSubData(t.ARRAY_BUFFER,0,i)},l}function SU(t){var e=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,e);var r=t.createTexture();return t.bindTexture(t.TEXTURE_2D,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r,0),t.bindFramebuffer(t.FRAMEBUFFER,null),e.setFramebufferAttachmentSizes=function(n,i){t.bindTexture(t.TEXTURE_2D,r),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,n,i,0,t.RGBA,t.UNSIGNED_BYTE,null)},e}var YN=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});function f2(){var t=new YN(9);return YN!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function XN(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function kU(t,e,r){var n=e[0],i=e[1],a=e[2],s=e[3],o=e[4],l=e[5],u=e[6],c=e[7],h=e[8],p=r[0],v=r[1],y=r[2],S=r[3],w=r[4],T=r[5],_=r[6],C=r[7],N=r[8];return t[0]=p*n+v*s+y*u,t[1]=p*i+v*o+y*c,t[2]=p*a+v*l+y*h,t[3]=S*n+w*s+T*u,t[4]=S*i+w*o+T*c,t[5]=S*a+w*l+T*h,t[6]=_*n+C*s+N*u,t[7]=_*i+C*o+N*c,t[8]=_*a+C*l+N*h,t}function Hy(t,e,r){var n=e[0],i=e[1],a=e[2],s=e[3],o=e[4],l=e[5],u=e[6],c=e[7],h=e[8],p=r[0],v=r[1];return t[0]=n,t[1]=i,t[2]=a,t[3]=s,t[4]=o,t[5]=l,t[6]=p*n+v*s+u,t[7]=p*i+v*o+c,t[8]=p*a+v*l+h,t}function QN(t,e,r){var n=e[0],i=e[1],a=e[2],s=e[3],o=e[4],l=e[5],u=e[6],c=e[7],h=e[8],p=Math.sin(r),v=Math.cos(r);return t[0]=v*n+p*s,t[1]=v*i+p*o,t[2]=v*a+p*l,t[3]=v*s-p*n,t[4]=v*o-p*i,t[5]=v*l-p*a,t[6]=u,t[7]=c,t[8]=h,t}function ZS(t,e,r){var n=r[0],i=r[1];return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=i*e[3],t[4]=i*e[4],t[5]=i*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function _U(t,e,r){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/r,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}var CU=(function(){function t(e,r,n,i){ah(this,t),this.debugID=Math.floor(Math.random()*1e4),this.r=e,this.texSize=r,this.texRows=n,this.texHeight=Math.floor(r/n),this.enableWrapping=!0,this.locked=!1,this.texture=null,this.needsBuffer=!0,this.freePointer={x:0,row:0},this.keyToLocation=new Map,this.canvas=i(e,r,r),this.scratch=i(e,r,this.texHeight,"scratch")}return sh(t,[{key:"lock",value:function(){this.locked=!0}},{key:"getKeys",value:function(){return new Set(this.keyToLocation.keys())}},{key:"getScale",value:function(r){var n=r.w,i=r.h,a=this.texHeight,s=this.texSize,o=a/i,l=n*o,u=i*o;return l>s&&(o=s/n,l=n*o,u=i*o),{scale:o,texW:l,texH:u}}},{key:"draw",value:function(r,n,i){var a=this;if(this.locked)throw new Error("can't draw, atlas is locked");var s=this.texSize,o=this.texRows,l=this.texHeight,u=this.getScale(n),c=u.scale,h=u.texW,p=u.texH,v=function(C,N){if(i&&N){var A=N.context,I=C.x,j=C.row,O=I,F=l*j;A.save(),A.translate(O,F),A.scale(c,c),i(A,n),A.restore()}},y=[null,null],S=function(){v(a.freePointer,a.canvas),y[0]={x:a.freePointer.x,y:a.freePointer.row*l,w:h,h:p},y[1]={x:a.freePointer.x+h,y:a.freePointer.row*l,w:0,h:p},a.freePointer.x+=h,a.freePointer.x==s&&(a.freePointer.x=0,a.freePointer.row++)},w=function(){var C=a.scratch,N=a.canvas;C.clear(),v({x:0,row:0},C);var A=s-a.freePointer.x,I=h-A,j=l;{var O=a.freePointer.x,F=a.freePointer.row*l,B=A;N.context.drawImage(C,0,0,B,j,O,F,B,j),y[0]={x:O,y:F,w:B,h:p}}{var $=A,Z=(a.freePointer.row+1)*l,D=I;N&&N.context.drawImage(C,$,0,D,j,0,Z,D,j),y[1]={x:0,y:Z,w:D,h:p}}a.freePointer.x=I,a.freePointer.row++},T=function(){a.freePointer.x=0,a.freePointer.row++};if(this.freePointer.x+h<=s)S();else{if(this.freePointer.row>=o-1)return!1;this.freePointer.x===s?(T(),S()):this.enableWrapping?w():(T(),S())}return this.keyToLocation.set(r,y),this.needsBuffer=!0,y}},{key:"getOffsets",value:function(r){return this.keyToLocation.get(r)}},{key:"isEmpty",value:function(){return this.freePointer.x===0&&this.freePointer.row===0}},{key:"canFit",value:function(r){if(this.locked)return!1;var n=this.texSize,i=this.texRows,a=this.getScale(r),s=a.texW;return this.freePointer.x+s>n?this.freePointer.row<i-1:!0}},{key:"bufferIfNeeded",value:function(r){this.texture||(this.texture=yU(r,this.debugID)),this.needsBuffer&&(this.texture.buffer(this.canvas),this.needsBuffer=!1,this.locked&&(this.canvas=null,this.scratch=null))}},{key:"dispose",value:function(){this.texture&&(this.texture.deleteTexture(),this.texture=null),this.canvas=null,this.scratch=null,this.locked=!0}}])})(),EU=(function(){function t(e,r,n,i){ah(this,t),this.r=e,this.texSize=r,this.texRows=n,this.createTextureCanvas=i,this.atlases=[],this.styleKeyToAtlas=new Map,this.markedKeys=new Set}return sh(t,[{key:"getKeys",value:function(){return new Set(this.styleKeyToAtlas.keys())}},{key:"_createAtlas",value:function(){var r=this.r,n=this.texSize,i=this.texRows,a=this.createTextureCanvas;return new CU(r,n,i,a)}},{key:"_getScratchCanvas",value:function(){if(!this.scratch){var r=this.r,n=this.texSize,i=this.texRows,a=this.createTextureCanvas,s=Math.floor(n/i);this.scratch=a(r,n,s,"scratch")}return this.scratch}},{key:"draw",value:function(r,n,i){var a=this.styleKeyToAtlas.get(r);return a||(a=this.atlases[this.atlases.length-1],(!a||!a.canFit(n))&&(a&&a.lock(),a=this._createAtlas(),this.atlases.push(a)),a.draw(r,n,i),this.styleKeyToAtlas.set(r,a)),a}},{key:"getAtlas",value:function(r){return this.styleKeyToAtlas.get(r)}},{key:"hasAtlas",value:function(r){return this.styleKeyToAtlas.has(r)}},{key:"markKeyForGC",value:function(r){this.markedKeys.add(r)}},{key:"gc",value:function(){var r=this,n=this.markedKeys;if(n.size===0){console.log("nothing to garbage collect");return}var i=[],a=new Map,s=null,o=Ys(this.atlases),l;try{var u=function(){var h=l.value,p=h.getKeys(),v=TU(n,p);if(v.size===0)return i.push(h),p.forEach(function(A){return a.set(A,h)}),1;s||(s=r._createAtlas(),i.push(s));var y=Ys(p),S;try{for(y.s();!(S=y.n()).done;){var w=S.value;if(!v.has(w)){var T=h.getOffsets(w),_=ji(T,2),C=_[0],N=_[1];s.canFit({w:C.w+N.w,h:C.h})||(s.lock(),s=r._createAtlas(),i.push(s)),h.canvas&&(r._copyTextureToNewAtlas(w,h,s),a.set(w,s))}}}catch(A){y.e(A)}finally{y.f()}h.dispose()};for(o.s();!(l=o.n()).done;)u()}catch(c){o.e(c)}finally{o.f()}this.atlases=i,this.styleKeyToAtlas=a,this.markedKeys=new Set}},{key:"_copyTextureToNewAtlas",value:function(r,n,i){var a=n.getOffsets(r),s=ji(a,2),o=s[0],l=s[1];if(l.w===0)i.draw(r,o,function(p){p.drawImage(n.canvas,o.x,o.y,o.w,o.h,0,0,o.w,o.h)});else{var u=this._getScratchCanvas();u.clear(),u.context.drawImage(n.canvas,o.x,o.y,o.w,o.h,0,0,o.w,o.h),u.context.drawImage(n.canvas,l.x,l.y,l.w,l.h,o.w,0,l.w,l.h);var c=o.w+l.w,h=o.h;i.draw(r,{w:c,h},function(p){p.drawImage(u,0,0,c,h,0,0,c,h)})}}},{key:"getCounts",value:function(){return{keyCount:this.styleKeyToAtlas.size,atlasCount:new Set(this.styleKeyToAtlas.values()).size}}}])})();function TU(t,e){return t.intersection?t.intersection(e):new Set(nx(t).filter(function(r){return e.has(r)}))}var NU=(function(){function t(e,r){ah(this,t),this.r=e,this.globalOptions=r,this.atlasSize=r.webglTexSize,this.maxAtlasesPerBatch=r.webglTexPerBatch,this.renderTypes=new Map,this.collections=new Map,this.typeAndIdToKey=new Map}return sh(t,[{key:"getAtlasSize",value:function(){return this.atlasSize}},{key:"addAtlasCollection",value:function(r,n){var i=this.globalOptions,a=i.webglTexSize,s=i.createTextureCanvas,o=n.texRows,l=this._cacheScratchCanvas(s),u=new EU(this.r,a,o,l);this.collections.set(r,u)}},{key:"addRenderType",value:function(r,n){var i=n.collection;if(!this.collections.has(i))throw new Error("invalid atlas collection name '".concat(i,"'"));var a=this.collections.get(i),s=er({type:r,atlasCollection:a},n);this.renderTypes.set(r,s)}},{key:"getRenderTypeOpts",value:function(r){return this.renderTypes.get(r)}},{key:"getAtlasCollection",value:function(r){return this.collections.get(r)}},{key:"_cacheScratchCanvas",value:function(r){var n=-1,i=-1,a=null;return function(s,o,l,u){return u?((!a||o!=n||l!=i)&&(n=o,i=l,a=r(s,o,l)),a):r(s,o,l)}}},{key:"_key",value:function(r,n){return"".concat(r,"-").concat(n)}},{key:"invalidate",value:function(r){var n=this,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=i.forceRedraw,s=a===void 0?!1:a,o=i.filterEle,l=o===void 0?function(){return!0}:o,u=i.filterType,c=u===void 0?function(){return!0}:u,h=!1,p=!1,v=Ys(r),y;try{for(v.s();!(y=v.n()).done;){var S=y.value;if(l(S)){var w=Ys(this.renderTypes.values()),T;try{var _=function(){var N=T.value,A=N.type;if(c(A)){var I=n.collections.get(N.collection),j=N.getKey(S),O=Array.isArray(j)?j:[j];if(s)O.forEach(function(Z){return I.markKeyForGC(Z)}),p=!0;else{var F=N.getID?N.getID(S):S.id(),B=n._key(A,F),$=n.typeAndIdToKey.get(B);$!==void 0&&!gU(O,$)&&(h=!0,n.typeAndIdToKey.delete(B),$.forEach(function(Z){return I.markKeyForGC(Z)}))}}};for(w.s();!(T=w.n()).done;)_()}catch(C){w.e(C)}finally{w.f()}}}}catch(C){v.e(C)}finally{v.f()}return p&&(this.gc(),h=!1),h}},{key:"gc",value:function(){var r=Ys(this.collections.values()),n;try{for(r.s();!(n=r.n()).done;){var i=n.value;i.gc()}}catch(a){r.e(a)}finally{r.f()}}},{key:"getOrCreateAtlas",value:function(r,n,i,a){var s=this.renderTypes.get(n),o=this.collections.get(s.collection),l=!1,u=o.draw(a,i,function(p){s.drawClipped?(p.save(),p.beginPath(),p.rect(0,0,i.w,i.h),p.clip(),s.drawElement(p,r,i,!0,!0),p.restore()):s.drawElement(p,r,i,!0,!0),l=!0});if(l){var c=s.getID?s.getID(r):r.id(),h=this._key(n,c);this.typeAndIdToKey.has(h)?this.typeAndIdToKey.get(h).push(a):this.typeAndIdToKey.set(h,[a])}return u}},{key:"getAtlasInfo",value:function(r,n){var i=this,a=this.renderTypes.get(n),s=a.getKey(r),o=Array.isArray(s)?s:[s];return o.map(function(l){var u=a.getBoundingBox(r,l),c=i.getOrCreateAtlas(r,n,u,l),h=c.getOffsets(l),p=ji(h,2),v=p[0],y=p[1];return{atlas:c,tex:v,tex1:v,tex2:y,bb:u}})}},{key:"getDebugInfo",value:function(){var r=[],n=Ys(this.collections),i;try{for(n.s();!(i=n.n()).done;){var a=ji(i.value,2),s=a[0],o=a[1],l=o.getCounts(),u=l.keyCount,c=l.atlasCount;r.push({type:s,keyCount:u,atlasCount:c})}}catch(h){n.e(h)}finally{n.f()}return r}}])})(),PU=(function(){function t(e){ah(this,t),this.globalOptions=e,this.atlasSize=e.webglTexSize,this.maxAtlasesPerBatch=e.webglTexPerBatch,this.batchAtlases=[]}return sh(t,[{key:"getMaxAtlasesPerBatch",value:function(){return this.maxAtlasesPerBatch}},{key:"getAtlasSize",value:function(){return this.atlasSize}},{key:"getIndexArray",value:function(){return Array.from({length:this.maxAtlasesPerBatch},function(r,n){return n})}},{key:"startBatch",value:function(){this.batchAtlases=[]}},{key:"getAtlasCount",value:function(){return this.batchAtlases.length}},{key:"getAtlases",value:function(){return this.batchAtlases}},{key:"canAddToCurrentBatch",value:function(r){return this.batchAtlases.length===this.maxAtlasesPerBatch?this.batchAtlases.includes(r):!0}},{key:"getAtlasIndexForBatch",value:function(r){var n=this.batchAtlases.indexOf(r);if(n<0){if(this.batchAtlases.length===this.maxAtlasesPerBatch)throw new Error("cannot add more atlases to batch");this.batchAtlases.push(r),n=this.batchAtlases.length-1}return n}}])})(),MU=`
  float circleSD(vec2 p, float r) {
    return distance(vec2(0), p) - r; // signed distance
  }
`,AU=`
  float rectangleSD(vec2 p, vec2 b) {
    vec2 d = abs(p)-b;
    return distance(vec2(0),max(d,0.0)) + min(max(d.x,d.y),0.0);
  }
`,RU=`
  float roundRectangleSD(vec2 p, vec2 b, vec4 cr) {
    cr.xy = (p.x > 0.0) ? cr.xy : cr.zw;
    cr.x  = (p.y > 0.0) ? cr.x  : cr.y;
    vec2 q = abs(p) - b + cr.x;
    return min(max(q.x, q.y), 0.0) + distance(vec2(0), max(q, 0.0)) - cr.x;
  }
`,LU=`
  float ellipseSD(vec2 p, vec2 ab) {
    p = abs( p ); // symmetry

    // find root with Newton solver
    vec2 q = ab*(p-ab);
    float w = (q.x<q.y)? 1.570796327 : 0.0;
    for( int i=0; i<5; i++ ) {
      vec2 cs = vec2(cos(w),sin(w));
      vec2 u = ab*vec2( cs.x,cs.y);
      vec2 v = ab*vec2(-cs.y,cs.x);
      w = w + dot(p-u,v)/(dot(p-u,u)+dot(v,v));
    }
    
    // compute final point and distance
    float d = length(p-ab*vec2(cos(w),sin(w)));
    
    // return signed distance
    return (dot(p/ab,p/ab)>1.0) ? d : -d;
  }
`,tv={SCREEN:{name:"screen",screen:!0},PICKING:{name:"picking",picking:!0}},mx={IGNORE:1,USE_BB:2},p2=0,JN=1,e5=2,m2=3,yp=4,oy=5,qm=6,$m=7,OU=(function(){function t(e,r,n){ah(this,t),this.r=e,this.gl=r,this.maxInstances=n.webglBatchSize,this.atlasSize=n.webglTexSize,this.bgColor=n.bgColor,this.debug=n.webglDebug,this.batchDebugInfo=[],n.enableWrapping=!0,n.createTextureCanvas=hU,this.atlasManager=new NU(e,n),this.batchManager=new PU(n),this.simpleShapeOptions=new Map,this.program=this._createShaderProgram(tv.SCREEN),this.pickingProgram=this._createShaderProgram(tv.PICKING),this.vao=this._createVAO()}return sh(t,[{key:"addAtlasCollection",value:function(r,n){this.atlasManager.addAtlasCollection(r,n)}},{key:"addTextureAtlasRenderType",value:function(r,n){this.atlasManager.addRenderType(r,n)}},{key:"addSimpleShapeRenderType",value:function(r,n){this.simpleShapeOptions.set(r,n)}},{key:"invalidate",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=n.type,a=this.atlasManager;return i?a.invalidate(r,{filterType:function(o){return o===i},forceRedraw:!0}):a.invalidate(r)}},{key:"gc",value:function(){this.atlasManager.gc()}},{key:"_createShaderProgram",value:function(r){var n=this.gl,i=`#version 300 es
      precision highp float;

      uniform mat3 uPanZoomMatrix;
      uniform int  uAtlasSize;
      
      // instanced
      in vec2 aPosition; // a vertex from the unit square
      
      in mat3 aTransform; // used to transform verticies, eg into a bounding box
      in int aVertType; // the type of thing we are rendering

      // the z-index that is output when using picking mode
      in vec4 aIndex;
      
      // For textures
      in int aAtlasId; // which shader unit/atlas to use
      in vec4 aTex; // x/y/w/h of texture in atlas

      // for edges
      in vec4 aPointAPointB;
      in vec4 aPointCPointD;
      in vec2 aLineWidth; // also used for node border width

      // simple shapes
      in vec4 aCornerRadius; // for round-rectangle [top-right, bottom-right, top-left, bottom-left]
      in vec4 aColor; // also used for edges
      in vec4 aBorderColor; // aLineWidth is used for border width

      // output values passed to the fragment shader
      out vec2 vTexCoord;
      out vec4 vColor;
      out vec2 vPosition;
      // flat values are not interpolated
      flat out int vAtlasId; 
      flat out int vVertType;
      flat out vec2 vTopRight;
      flat out vec2 vBotLeft;
      flat out vec4 vCornerRadius;
      flat out vec4 vBorderColor;
      flat out vec2 vBorderWidth;
      flat out vec4 vIndex;
      
      void main(void) {
        int vid = gl_VertexID;
        vec2 position = aPosition; // TODO make this a vec3, simplifies some code below

        if(aVertType == `.concat(p2,`) {
          float texX = aTex.x; // texture coordinates
          float texY = aTex.y;
          float texW = aTex.z;
          float texH = aTex.w;

          if(vid == 1 || vid == 2 || vid == 4) {
            texX += texW;
          }
          if(vid == 2 || vid == 4 || vid == 5) {
            texY += texH;
          }

          float d = float(uAtlasSize);
          vTexCoord = vec2(texX / d, texY / d); // tex coords must be between 0 and 1

          gl_Position = vec4(uPanZoomMatrix * aTransform * vec3(position, 1.0), 1.0);
        }
        else if(aVertType == `).concat(yp," || aVertType == ").concat($m,` 
             || aVertType == `).concat(oy," || aVertType == ").concat(qm,`) { // simple shapes

          // the bounding box is needed by the fragment shader
          vBotLeft  = (aTransform * vec3(0, 0, 1)).xy; // flat
          vTopRight = (aTransform * vec3(1, 1, 1)).xy; // flat
          vPosition = (aTransform * vec3(position, 1)).xy; // will be interpolated

          // calculations are done in the fragment shader, just pass these along
          vColor = aColor;
          vCornerRadius = aCornerRadius;
          vBorderColor = aBorderColor;
          vBorderWidth = aLineWidth;

          gl_Position = vec4(uPanZoomMatrix * aTransform * vec3(position, 1.0), 1.0);
        }
        else if(aVertType == `).concat(JN,`) {
          vec2 source = aPointAPointB.xy;
          vec2 target = aPointAPointB.zw;

          // adjust the geometry so that the line is centered on the edge
          position.y = position.y - 0.5;

          // stretch the unit square into a long skinny rectangle
          vec2 xBasis = target - source;
          vec2 yBasis = normalize(vec2(-xBasis.y, xBasis.x));
          vec2 point = source + xBasis * position.x + yBasis * aLineWidth[0] * position.y;

          gl_Position = vec4(uPanZoomMatrix * vec3(point, 1.0), 1.0);
          vColor = aColor;
        } 
        else if(aVertType == `).concat(e5,`) {
          vec2 pointA = aPointAPointB.xy;
          vec2 pointB = aPointAPointB.zw;
          vec2 pointC = aPointCPointD.xy;
          vec2 pointD = aPointCPointD.zw;

          // adjust the geometry so that the line is centered on the edge
          position.y = position.y - 0.5;

          vec2 p0, p1, p2, pos;
          if(position.x == 0.0) { // The left side of the unit square
            p0 = pointA;
            p1 = pointB;
            p2 = pointC;
            pos = position;
          } else { // The right side of the unit square, use same approach but flip the geometry upside down
            p0 = pointD;
            p1 = pointC;
            p2 = pointB;
            pos = vec2(0.0, -position.y);
          }

          vec2 p01 = p1 - p0;
          vec2 p12 = p2 - p1;
          vec2 p21 = p1 - p2;

          // Find the normal vector.
          vec2 tangent = normalize(normalize(p12) + normalize(p01));
          vec2 normal = vec2(-tangent.y, tangent.x);

          // Find the vector perpendicular to p0 -> p1.
          vec2 p01Norm = normalize(vec2(-p01.y, p01.x));

          // Determine the bend direction.
          float sigma = sign(dot(p01 + p21, normal));
          float width = aLineWidth[0];

          if(sign(pos.y) == -sigma) {
            // This is an intersecting vertex. Adjust the position so that there's no overlap.
            vec2 point = 0.5 * width * normal * -sigma / dot(normal, p01Norm);
            gl_Position = vec4(uPanZoomMatrix * vec3(p1 + point, 1.0), 1.0);
          } else {
            // This is a non-intersecting vertex. Treat it like a mitre join.
            vec2 point = 0.5 * width * normal * sigma * dot(normal, p01Norm);
            gl_Position = vec4(uPanZoomMatrix * vec3(p1 + point, 1.0), 1.0);
          }

          vColor = aColor;
        } 
        else if(aVertType == `).concat(m2,` && vid < 3) {
          // massage the first triangle into an edge arrow
          if(vid == 0)
            position = vec2(-0.15, -0.3);
          if(vid == 1)
            position = vec2(  0.0,  0.0);
          if(vid == 2)
            position = vec2( 0.15, -0.3);

          gl_Position = vec4(uPanZoomMatrix * aTransform * vec3(position, 1.0), 1.0);
          vColor = aColor;
        }
        else {
          gl_Position = vec4(2.0, 0.0, 0.0, 1.0); // discard vertex by putting it outside webgl clip space
        }

        vAtlasId = aAtlasId;
        vVertType = aVertType;
        vIndex = aIndex;
      }
    `),a=this.batchManager.getIndexArray(),s=`#version 300 es
      precision highp float;

      // declare texture unit for each texture atlas in the batch
      `.concat(a.map(function(u){return"uniform sampler2D uTexture".concat(u,";")}).join(`
	`),`

      uniform vec4 uBGColor;
      uniform float uZoom;

      in vec2 vTexCoord;
      in vec4 vColor;
      in vec2 vPosition; // model coordinates

      flat in int vAtlasId;
      flat in vec4 vIndex;
      flat in int vVertType;
      flat in vec2 vTopRight;
      flat in vec2 vBotLeft;
      flat in vec4 vCornerRadius;
      flat in vec4 vBorderColor;
      flat in vec2 vBorderWidth;

      out vec4 outColor;

      `).concat(MU,`
      `).concat(AU,`
      `).concat(RU,`
      `).concat(LU,`

      vec4 blend(vec4 top, vec4 bot) { // blend colors with premultiplied alpha
        return vec4( 
          top.rgb + (bot.rgb * (1.0 - top.a)),
          top.a   + (bot.a   * (1.0 - top.a)) 
        );
      }

      vec4 distInterp(vec4 cA, vec4 cB, float d) { // interpolate color using Signed Distance
        // scale to the zoom level so that borders don't look blurry when zoomed in
        // note 1.5 is an aribitrary value chosen because it looks good
        return mix(cA, cB, 1.0 - smoothstep(0.0, 1.5 / uZoom, abs(d))); 
      }

      void main(void) {
        if(vVertType == `).concat(p2,`) {
          // look up the texel from the texture unit
          `).concat(a.map(function(u){return"if(vAtlasId == ".concat(u,") outColor = texture(uTexture").concat(u,", vTexCoord);")}).join(`
	else `),`
        } 
        else if(vVertType == `).concat(m2,`) {
          // mimics how canvas renderer uses context.globalCompositeOperation = 'destination-out';
          outColor = blend(vColor, uBGColor);
          outColor.a = 1.0; // make opaque, masks out line under arrow
        }
        else if(vVertType == `).concat(yp,` && vBorderWidth == vec2(0.0)) { // simple rectangle with no border
          outColor = vColor; // unit square is already transformed to the rectangle, nothing else needs to be done
        }
        else if(vVertType == `).concat(yp," || vVertType == ").concat($m,` 
          || vVertType == `).concat(oy," || vVertType == ").concat(qm,`) { // use SDF

          float outerBorder = vBorderWidth[0];
          float innerBorder = vBorderWidth[1];
          float borderPadding = outerBorder * 2.0;
          float w = vTopRight.x - vBotLeft.x - borderPadding;
          float h = vTopRight.y - vBotLeft.y - borderPadding;
          vec2 b = vec2(w/2.0, h/2.0); // half width, half height
          vec2 p = vPosition - vec2(vTopRight.x - b[0] - outerBorder, vTopRight.y - b[1] - outerBorder); // translate to center

          float d; // signed distance
          if(vVertType == `).concat(yp,`) {
            d = rectangleSD(p, b);
          } else if(vVertType == `).concat($m,` && w == h) {
            d = circleSD(p, b.x); // faster than ellipse
          } else if(vVertType == `).concat($m,`) {
            d = ellipseSD(p, b);
          } else {
            d = roundRectangleSD(p, b, vCornerRadius.wzyx);
          }

          // use the distance to interpolate a color to smooth the edges of the shape, doesn't need multisampling
          // we must smooth colors inwards, because we can't change pixels outside the shape's bounding box
          if(d > 0.0) {
            if(d > outerBorder) {
              discard;
            } else {
              outColor = distInterp(vBorderColor, vec4(0), d - outerBorder);
            }
          } else {
            if(d > innerBorder) {
              vec4 outerColor = outerBorder == 0.0 ? vec4(0) : vBorderColor;
              vec4 innerBorderColor = blend(vBorderColor, vColor);
              outColor = distInterp(innerBorderColor, outerColor, d);
            } 
            else {
              vec4 outerColor;
              if(innerBorder == 0.0 && outerBorder == 0.0) {
                outerColor = vec4(0);
              } else if(innerBorder == 0.0) {
                outerColor = vBorderColor;
              } else {
                outerColor = blend(vBorderColor, vColor);
              }
              outColor = distInterp(vColor, outerColor, d - innerBorder);
            }
          }
        }
        else {
          outColor = vColor;
        }

        `).concat(r.picking?`if(outColor.a == 0.0) discard;
             else outColor = vIndex;`:"",`
      }
    `),o=dU(n,i,s);o.aPosition=n.getAttribLocation(o,"aPosition"),o.aIndex=n.getAttribLocation(o,"aIndex"),o.aVertType=n.getAttribLocation(o,"aVertType"),o.aTransform=n.getAttribLocation(o,"aTransform"),o.aAtlasId=n.getAttribLocation(o,"aAtlasId"),o.aTex=n.getAttribLocation(o,"aTex"),o.aPointAPointB=n.getAttribLocation(o,"aPointAPointB"),o.aPointCPointD=n.getAttribLocation(o,"aPointCPointD"),o.aLineWidth=n.getAttribLocation(o,"aLineWidth"),o.aColor=n.getAttribLocation(o,"aColor"),o.aCornerRadius=n.getAttribLocation(o,"aCornerRadius"),o.aBorderColor=n.getAttribLocation(o,"aBorderColor"),o.uPanZoomMatrix=n.getUniformLocation(o,"uPanZoomMatrix"),o.uAtlasSize=n.getUniformLocation(o,"uAtlasSize"),o.uBGColor=n.getUniformLocation(o,"uBGColor"),o.uZoom=n.getUniformLocation(o,"uZoom"),o.uTextures=[];for(var l=0;l<this.batchManager.getMaxAtlasesPerBatch();l++)o.uTextures.push(n.getUniformLocation(o,"uTexture".concat(l)));return o}},{key:"_createVAO",value:function(){var r=[0,0,1,0,1,1,0,0,1,1,0,1];this.vertexCount=r.length/2;var n=this.maxInstances,i=this.gl,a=this.program,s=i.createVertexArray();return i.bindVertexArray(s),bU(i,"vec2",a.aPosition,r),this.transformBuffer=wU(i,n,a.aTransform),this.indexBuffer=vu(i,n,"vec4",a.aIndex),this.vertTypeBuffer=vu(i,n,"int",a.aVertType),this.atlasIdBuffer=vu(i,n,"int",a.aAtlasId),this.texBuffer=vu(i,n,"vec4",a.aTex),this.pointAPointBBuffer=vu(i,n,"vec4",a.aPointAPointB),this.pointCPointDBuffer=vu(i,n,"vec4",a.aPointCPointD),this.lineWidthBuffer=vu(i,n,"vec2",a.aLineWidth),this.colorBuffer=vu(i,n,"vec4",a.aColor),this.cornerRadiusBuffer=vu(i,n,"vec4",a.aCornerRadius),this.borderColorBuffer=vu(i,n,"vec4",a.aBorderColor),i.bindVertexArray(null),s}},{key:"buffers",get:function(){var r=this;return this._buffers||(this._buffers=Object.keys(this).filter(function(n){return Ld(n,"Buffer")}).map(function(n){return r[n]})),this._buffers}},{key:"startFrame",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:tv.SCREEN;this.panZoomMatrix=r,this.renderTarget=n,this.batchDebugInfo=[],this.wrappedCount=0,this.simpleCount=0,this.startBatch()}},{key:"startBatch",value:function(){this.instanceCount=0,this.batchManager.startBatch()}},{key:"endFrame",value:function(){this.endBatch()}},{key:"_isVisible",value:function(r,n){return r.visible()?n&&n.isVisible?n.isVisible(r):!0:!1}},{key:"drawTexture",value:function(r,n,i){var a=this.atlasManager,s=this.batchManager,o=a.getRenderTypeOpts(i);if(this._isVisible(r,o)&&!(r.isEdge()&&!this._isValidEdge(r))){if(this.renderTarget.picking&&o.getTexPickingMode){var l=o.getTexPickingMode(r);if(l===mx.IGNORE)return;if(l==mx.USE_BB){this.drawPickingRectangle(r,n,i);return}}var u=a.getAtlasInfo(r,i),c=Ys(u),h;try{for(c.s();!(h=c.n()).done;){var p=h.value,v=p.atlas,y=p.tex1,S=p.tex2;s.canAddToCurrentBatch(v)||this.endBatch();for(var w=s.getAtlasIndexForBatch(v),T=0,_=[[y,!0],[S,!1]];T<_.length;T++){var C=ji(_[T],2),N=C[0],A=C[1];if(N.w!=0){var I=this.instanceCount;this.vertTypeBuffer.getView(I)[0]=p2;var j=this.indexBuffer.getView(I);vp(n,j);var O=this.atlasIdBuffer.getView(I);O[0]=w;var F=this.texBuffer.getView(I);F[0]=N.x,F[1]=N.y,F[2]=N.w,F[3]=N.h;var B=this.transformBuffer.getMatrixView(I);this.setTransformMatrix(r,B,o,p,A),this.instanceCount++,A||this.wrappedCount++,this.instanceCount>=this.maxInstances&&this.endBatch()}}}}catch($){c.e($)}finally{c.f()}}}},{key:"setTransformMatrix",value:function(r,n,i,a){var s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,o=0;if(i.shapeProps&&i.shapeProps.padding&&(o=r.pstyle(i.shapeProps.padding).pfValue),a){var l=a.bb,u=a.tex1,c=a.tex2,h=u.w/(u.w+c.w);s||(h=1-h);var p=this._getAdjustedBB(l,o,s,h);this._applyTransformMatrix(n,p,i,r)}else{var v=i.getBoundingBox(r),y=this._getAdjustedBB(v,o,!0,1);this._applyTransformMatrix(n,y,i,r)}}},{key:"_applyTransformMatrix",value:function(r,n,i,a){var s,o;XN(r);var l=i.getRotation?i.getRotation(a):0;if(l!==0){var u=i.getRotationPoint(a),c=u.x,h=u.y;Hy(r,r,[c,h]),QN(r,r,l);var p=i.getRotationOffset(a);s=p.x+(n.xOffset||0),o=p.y+(n.yOffset||0)}else s=n.x1,o=n.y1;Hy(r,r,[s,o]),ZS(r,r,[n.w,n.h])}},{key:"_getAdjustedBB",value:function(r,n,i,a){var s=r.x1,o=r.y1,l=r.w,u=r.h,c=r.yOffset;n&&(s-=n,o-=n,l+=2*n,u+=2*n);var h=0,p=l*a;return i&&a<1?l=p:!i&&a<1&&(h=l-p,s+=h,l=p),{x1:s,y1:o,w:l,h:u,xOffset:h,yOffset:c}}},{key:"drawPickingRectangle",value:function(r,n,i){var a=this.atlasManager.getRenderTypeOpts(i),s=this.instanceCount;this.vertTypeBuffer.getView(s)[0]=yp;var o=this.indexBuffer.getView(s);vp(n,o);var l=this.colorBuffer.getView(s);Vh([0,0,0],1,l);var u=this.transformBuffer.getMatrixView(s);this.setTransformMatrix(r,u,a),this.simpleCount++,this.instanceCount++,this.instanceCount>=this.maxInstances&&this.endBatch()}},{key:"drawNode",value:function(r,n,i){var a=this.simpleShapeOptions.get(i);if(this._isVisible(r,a)){var s=a.shapeProps,o=this._getVertTypeForShape(r,s.shape);if(o===void 0||a.isSimple&&!a.isSimple(r)){this.drawTexture(r,n,i);return}var l=this.instanceCount;if(this.vertTypeBuffer.getView(l)[0]=o,o===oy||o===qm){var u=a.getBoundingBox(r),c=this._getCornerRadius(r,s.radius,u),h=this.cornerRadiusBuffer.getView(l);h[0]=c,h[1]=c,h[2]=c,h[3]=c,o===qm&&(h[0]=0,h[2]=0)}var p=this.indexBuffer.getView(l);vp(n,p);var v=r.pstyle(s.color).value,y=r.pstyle(s.opacity).value,S=this.colorBuffer.getView(l);Vh(v,y,S);var w=this.lineWidthBuffer.getView(l);if(w[0]=0,w[1]=0,s.border){var T=r.pstyle("border-width").value;if(T>0){var _=r.pstyle("border-color").value,C=r.pstyle("border-opacity").value,N=this.borderColorBuffer.getView(l);Vh(_,C,N);var A=r.pstyle("border-position").value;if(A==="inside")w[0]=0,w[1]=-T;else if(A==="outside")w[0]=T,w[1]=0;else{var I=T/2;w[0]=I,w[1]=-I}}}var j=this.transformBuffer.getMatrixView(l);this.setTransformMatrix(r,j,a),this.simpleCount++,this.instanceCount++,this.instanceCount>=this.maxInstances&&this.endBatch()}}},{key:"_getVertTypeForShape",value:function(r,n){var i=r.pstyle(n).value;switch(i){case"rectangle":return yp;case"ellipse":return $m;case"roundrectangle":case"round-rectangle":return oy;case"bottom-round-rectangle":return qm;default:return}}},{key:"_getCornerRadius",value:function(r,n,i){var a=i.w,s=i.h;if(r.pstyle(n).value==="auto")return Xd(a,s);var o=r.pstyle(n).pfValue,l=a/2,u=s/2;return Math.min(o,u,l)}},{key:"drawEdgeArrow",value:function(r,n,i){if(r.visible()){var a=r._private.rscratch,s,o,l;if(i==="source"?(s=a.arrowStartX,o=a.arrowStartY,l=a.srcArrowAngle):(s=a.arrowEndX,o=a.arrowEndY,l=a.tgtArrowAngle),!(isNaN(s)||s==null||isNaN(o)||o==null||isNaN(l)||l==null)){var u=r.pstyle(i+"-arrow-shape").value;if(u!=="none"){var c=r.pstyle(i+"-arrow-color").value,h=r.pstyle("opacity").value,p=r.pstyle("line-opacity").value,v=h*p,y=r.pstyle("width").pfValue,S=r.pstyle("arrow-scale").value,w=this.r.getArrowWidth(y,S),T=this.instanceCount,_=this.transformBuffer.getMatrixView(T);XN(_),Hy(_,_,[s,o]),ZS(_,_,[w,w]),QN(_,_,l),this.vertTypeBuffer.getView(T)[0]=m2;var C=this.indexBuffer.getView(T);vp(n,C);var N=this.colorBuffer.getView(T);Vh(c,v,N),this.instanceCount++,this.instanceCount>=this.maxInstances&&this.endBatch()}}}}},{key:"drawEdgeLine",value:function(r,n){if(r.visible()){var i=this._getEdgePoints(r);if(i){var a=r.pstyle("opacity").value,s=r.pstyle("line-opacity").value,o=r.pstyle("width").pfValue,l=r.pstyle("line-color").value,u=a*s;if(i.length/2+this.instanceCount>this.maxInstances&&this.endBatch(),i.length==4){var c=this.instanceCount;this.vertTypeBuffer.getView(c)[0]=JN;var h=this.indexBuffer.getView(c);vp(n,h);var p=this.colorBuffer.getView(c);Vh(l,u,p);var v=this.lineWidthBuffer.getView(c);v[0]=o;var y=this.pointAPointBBuffer.getView(c);y[0]=i[0],y[1]=i[1],y[2]=i[2],y[3]=i[3],this.instanceCount++,this.instanceCount>=this.maxInstances&&this.endBatch()}else for(var S=0;S<i.length-2;S+=2){var w=this.instanceCount;this.vertTypeBuffer.getView(w)[0]=e5;var T=this.indexBuffer.getView(w);vp(n,T);var _=this.colorBuffer.getView(w);Vh(l,u,_);var C=this.lineWidthBuffer.getView(w);C[0]=o;var N=i[S-2],A=i[S-1],I=i[S],j=i[S+1],O=i[S+2],F=i[S+3],B=i[S+4],$=i[S+5];S==0&&(N=2*I-O+.001,A=2*j-F+.001),S==i.length-4&&(B=2*O-I+.001,$=2*F-j+.001);var Z=this.pointAPointBBuffer.getView(w);Z[0]=N,Z[1]=A,Z[2]=I,Z[3]=j;var D=this.pointCPointDBuffer.getView(w);D[0]=O,D[1]=F,D[2]=B,D[3]=$,this.instanceCount++,this.instanceCount>=this.maxInstances&&this.endBatch()}}}}},{key:"_isValidEdge",value:function(r){var n=r._private.rscratch;return!(n.badLine||n.allpts==null||isNaN(n.allpts[0]))}},{key:"_getEdgePoints",value:function(r){var n=r._private.rscratch;if(this._isValidEdge(r)){var i=n.allpts;if(i.length==4)return i;var a=this._getNumSegments(r);return this._getCurveSegmentPoints(i,a)}}},{key:"_getNumSegments",value:function(r){var n=15;return Math.min(Math.max(n,5),this.maxInstances)}},{key:"_getCurveSegmentPoints",value:function(r,n){if(r.length==4)return r;for(var i=Array((n+1)*2),a=0;a<=n;a++)if(a==0)i[0]=r[0],i[1]=r[1];else if(a==n)i[a*2]=r[r.length-2],i[a*2+1]=r[r.length-1];else{var s=a/n;this._setCurvePoint(r,s,i,a*2)}return i}},{key:"_setCurvePoint",value:function(r,n,i,a){if(r.length<=2)i[a]=r[0],i[a+1]=r[1];else{for(var s=Array(r.length-2),o=0;o<s.length;o+=2){var l=(1-n)*r[o]+n*r[o+2],u=(1-n)*r[o+1]+n*r[o+3];s[o]=l,s[o+1]=u}return this._setCurvePoint(s,n,i,a)}}},{key:"endBatch",value:function(){var r=this.gl,n=this.vao,i=this.vertexCount,a=this.instanceCount;if(a!==0){var s=this.renderTarget.picking?this.pickingProgram:this.program;r.useProgram(s),r.bindVertexArray(n);var o=Ys(this.buffers),l;try{for(o.s();!(l=o.n()).done;){var u=l.value;u.bufferSubData(a)}}catch(y){o.e(y)}finally{o.f()}for(var c=this.batchManager.getAtlases(),h=0;h<c.length;h++)c[h].bufferIfNeeded(r);for(var p=0;p<c.length;p++)r.activeTexture(r.TEXTURE0+p),r.bindTexture(r.TEXTURE_2D,c[p].texture),r.uniform1i(s.uTextures[p],p);r.uniform1f(s.uZoom,fU(this.r)),r.uniformMatrix3fv(s.uPanZoomMatrix,!1,this.panZoomMatrix),r.uniform1i(s.uAtlasSize,this.batchManager.getAtlasSize());var v=Vh(this.bgColor,1);r.uniform4fv(s.uBGColor,v),r.drawArraysInstanced(r.TRIANGLES,0,i,a),r.bindVertexArray(null),r.bindTexture(r.TEXTURE_2D,null),this.debug&&this.batchDebugInfo.push({count:a,atlasCount:c.length}),this.startBatch()}}},{key:"getDebugInfo",value:function(){var r=this.atlasManager.getDebugInfo(),n=r.reduce(function(s,o){return s+o.atlasCount},0),i=this.batchDebugInfo,a=i.reduce(function(s,o){return s+o.count},0);return{atlasInfo:r,totalAtlases:n,wrappedCount:this.wrappedCount,simpleCount:this.simpleCount,batchCount:i.length,batchInfo:i,totalInstances:a}}}])})(),uR={};uR.initWebgl=function(t,e){var r=this,n=r.data.contexts[r.WEBGL];t.bgColor=DU(r),t.webglTexSize=Math.min(t.webglTexSize,n.getParameter(n.MAX_TEXTURE_SIZE)),t.webglTexRows=Math.min(t.webglTexRows,54),t.webglTexRowsNodes=Math.min(t.webglTexRowsNodes,54),t.webglBatchSize=Math.min(t.webglBatchSize,16384),t.webglTexPerBatch=Math.min(t.webglTexPerBatch,n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS)),r.webglDebug=t.webglDebug,r.webglDebugShowAtlases=t.webglDebugShowAtlases,r.pickingFrameBuffer=SU(n),r.pickingFrameBuffer.needsDraw=!0,r.drawing=new OU(r,n,t);var i=function(h){return function(p){return r.getTextAngle(p,h)}},a=function(h){return function(p){var v=p.pstyle(h);return v&&v.value}},s=function(h){return function(p){return p.pstyle("".concat(h,"-opacity")).value>0}},o=function(h){var p=h.pstyle("text-events").strValue==="yes";return p?mx.USE_BB:mx.IGNORE},l=function(h){var p=h.position(),v=p.x,y=p.y,S=h.outerWidth(),w=h.outerHeight();return{w:S,h:w,x1:v-S/2,y1:y-w/2}};r.drawing.addAtlasCollection("node",{texRows:t.webglTexRowsNodes}),r.drawing.addAtlasCollection("label",{texRows:t.webglTexRows}),r.drawing.addTextureAtlasRenderType("node-body",{collection:"node",getKey:e.getStyleKey,getBoundingBox:e.getElementBox,drawElement:e.drawElement}),r.drawing.addSimpleShapeRenderType("node-body",{getBoundingBox:l,isSimple:mU,shapeProps:{shape:"shape",color:"background-color",opacity:"background-opacity",radius:"corner-radius",border:!0}}),r.drawing.addSimpleShapeRenderType("node-overlay",{getBoundingBox:l,isVisible:s("overlay"),shapeProps:{shape:"overlay-shape",color:"overlay-color",opacity:"overlay-opacity",padding:"overlay-padding",radius:"overlay-corner-radius"}}),r.drawing.addSimpleShapeRenderType("node-underlay",{getBoundingBox:l,isVisible:s("underlay"),shapeProps:{shape:"underlay-shape",color:"underlay-color",opacity:"underlay-opacity",padding:"underlay-padding",radius:"underlay-corner-radius"}}),r.drawing.addTextureAtlasRenderType("label",{collection:"label",getTexPickingMode:o,getKey:g2(e.getLabelKey,null),getBoundingBox:v2(e.getLabelBox,null),drawClipped:!0,drawElement:e.drawLabel,getRotation:i(null),getRotationPoint:e.getLabelRotationPoint,getRotationOffset:e.getLabelRotationOffset,isVisible:a("label")}),r.drawing.addTextureAtlasRenderType("edge-source-label",{collection:"label",getTexPickingMode:o,getKey:g2(e.getSourceLabelKey,"source"),getBoundingBox:v2(e.getSourceLabelBox,"source"),drawClipped:!0,drawElement:e.drawSourceLabel,getRotation:i("source"),getRotationPoint:e.getSourceLabelRotationPoint,getRotationOffset:e.getSourceLabelRotationOffset,isVisible:a("source-label")}),r.drawing.addTextureAtlasRenderType("edge-target-label",{collection:"label",getTexPickingMode:o,getKey:g2(e.getTargetLabelKey,"target"),getBoundingBox:v2(e.getTargetLabelBox,"target"),drawClipped:!0,drawElement:e.drawTargetLabel,getRotation:i("target"),getRotationPoint:e.getTargetLabelRotationPoint,getRotationOffset:e.getTargetLabelRotationOffset,isVisible:a("target-label")});var u=Qv(function(){console.log("garbage collect flag set"),r.data.gc=!0},1e4);r.onUpdateEleCalcs(function(c,h){var p=!1;h&&h.length>0&&(p|=r.drawing.invalidate(h)),p&&u()}),IU(r)};function DU(t){var e=t.cy.container(),r=e&&e.style&&e.style.backgroundColor||"white";return jM(r)}function cR(t,e){var r=t._private.rscratch;return $s(r,"labelWrapCachedLines",e)||[]}var g2=function(e,r){return function(n){var i=e(n),a=cR(n,r);return a.length>1?a.map(function(s,o){return"".concat(i,"_").concat(o)}):i}},v2=function(e,r){return function(n,i){var a=e(n);if(typeof i=="string"){var s=i.indexOf("_");if(s>0){var o=Number(i.substring(s+1)),l=cR(n,r),u=a.h/l.length,c=u*o,h=a.y1+c;return{x1:a.x1,w:a.w,y1:h,h:u,yOffset:c}}}return a}};function IU(t){{var e=t.render;t.render=function(a){a=a||{};var s=t.cy;t.webgl&&(s.zoom()>rR?(jU(t),e.call(t,a)):(FU(t),hR(t,a,tv.SCREEN)))}}{var r=t.matchCanvasSize;t.matchCanvasSize=function(a){r.call(t,a),t.pickingFrameBuffer.setFramebufferAttachmentSizes(t.canvasWidth,t.canvasHeight),t.pickingFrameBuffer.needsDraw=!0}}t.findNearestElements=function(a,s,o,l){return HU(t,a,s)};{var n=t.invalidateCachedZSortedEles;t.invalidateCachedZSortedEles=function(){n.call(t),t.pickingFrameBuffer.needsDraw=!0}}{var i=t.notify;t.notify=function(a,s){i.call(t,a,s),a==="viewport"||a==="bounds"?t.pickingFrameBuffer.needsDraw=!0:a==="background"&&t.drawing.invalidate(s,{type:"node-body"})}}}function jU(t){var e=t.data.contexts[t.WEBGL];e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT)}function FU(t){var e=function(n){n.save(),n.setTransform(1,0,0,1,0,0),n.clearRect(0,0,t.canvasWidth,t.canvasHeight),n.restore()};e(t.data.contexts[t.NODE]),e(t.data.contexts[t.DRAG])}function BU(t){var e=t.canvasWidth,r=t.canvasHeight,n=b_(t),i=n.pan,a=n.zoom,s=f2();Hy(s,s,[i.x,i.y]),ZS(s,s,[a,a]);var o=f2();_U(o,e,r);var l=f2();return kU(l,o,s),l}function dR(t,e){var r=t.canvasWidth,n=t.canvasHeight,i=b_(t),a=i.pan,s=i.zoom;e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,r,n),e.translate(a.x,a.y),e.scale(s,s)}function zU(t,e){t.drawSelectionRectangle(e,function(r){return dR(t,r)})}function UU(t){var e=t.data.contexts[t.NODE];e.save(),dR(t,e),e.strokeStyle="rgba(0, 0, 0, 0.3)",e.beginPath(),e.moveTo(-1e3,0),e.lineTo(1e3,0),e.stroke(),e.beginPath(),e.moveTo(0,-1e3),e.lineTo(0,1e3),e.stroke(),e.restore()}function GU(t){var e=function(i,a,s){for(var o=i.atlasManager.getAtlasCollection(a),l=t.data.contexts[t.NODE],u=o.atlases,c=0;c<u.length;c++){var h=u[c],p=h.canvas;if(p){var v=p.width,y=p.height,S=v*c,w=p.height*s,T=.4;l.save(),l.scale(T,T),l.drawImage(p,S,w),l.strokeStyle="black",l.rect(S,w,v,y),l.stroke(),l.restore()}}},r=0;e(t.drawing,"node",r++),e(t.drawing,"label",r++)}function VU(t,e,r,n,i){var a,s,o,l,u=b_(t),c=u.pan,h=u.zoom;{var p=pU(t,c,h,e,r),v=ji(p,2),y=v[0],S=v[1],w=6;a=y-w/2,s=S-w/2,o=w,l=w}if(o===0||l===0)return[];var T=t.data.contexts[t.WEBGL];T.bindFramebuffer(T.FRAMEBUFFER,t.pickingFrameBuffer),t.pickingFrameBuffer.needsDraw&&(T.viewport(0,0,T.canvas.width,T.canvas.height),hR(t,null,tv.PICKING),t.pickingFrameBuffer.needsDraw=!1);var _=o*l,C=new Uint8Array(_*4);T.readPixels(a,s,o,l,T.RGBA,T.UNSIGNED_BYTE,C),T.bindFramebuffer(T.FRAMEBUFFER,null);for(var N=new Set,A=0;A<_;A++){var I=C.slice(A*4,A*4+4),j=vU(I)-1;j>=0&&N.add(j)}return N}function HU(t,e,r){var n=VU(t,e,r),i=t.getCachedZSortedEles(),a,s,o=Ys(n),l;try{for(o.s();!(l=o.n()).done;){var u=l.value,c=i[u];if(!a&&c.isNode()&&(a=c),!s&&c.isEdge()&&(s=c),a&&s)break}}catch(h){o.e(h)}finally{o.f()}return[a,s].filter(Boolean)}function y2(t,e,r){var n=t.drawing;e+=1,r.isNode()?(n.drawNode(r,e,"node-underlay"),n.drawNode(r,e,"node-body"),n.drawTexture(r,e,"label"),n.drawNode(r,e,"node-overlay")):(n.drawEdgeLine(r,e),n.drawEdgeArrow(r,e,"source"),n.drawEdgeArrow(r,e,"target"),n.drawTexture(r,e,"label"),n.drawTexture(r,e,"edge-source-label"),n.drawTexture(r,e,"edge-target-label"))}function hR(t,e,r){var n;t.webglDebug&&(n=performance.now());var i=t.drawing,a=0;if(r.screen&&t.data.canvasNeedsRedraw[t.SELECT_BOX]&&zU(t,e),t.data.canvasNeedsRedraw[t.NODE]||r.picking){var s=t.data.contexts[t.WEBGL];r.screen?(s.clearColor(0,0,0,0),s.enable(s.BLEND),s.blendFunc(s.ONE,s.ONE_MINUS_SRC_ALPHA)):s.disable(s.BLEND),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT),s.viewport(0,0,s.canvas.width,s.canvas.height);var o=BU(t),l=t.getCachedZSortedEles();if(a=l.length,i.startFrame(o,r),r.screen){for(var u=0;u<l.nondrag.length;u++)y2(t,u,l.nondrag[u]);for(var c=0;c<l.drag.length;c++)y2(t,c,l.drag[c])}else if(r.picking)for(var h=0;h<l.length;h++)y2(t,h,l[h]);i.endFrame(),r.screen&&t.webglDebugShowAtlases&&(UU(t),GU(t)),t.data.canvasNeedsRedraw[t.NODE]=!1,t.data.canvasNeedsRedraw[t.DRAG]=!1}if(t.webglDebug){var p=performance.now(),v=!1,y=Math.ceil(p-n),S=i.getDebugInfo(),w=["".concat(a," elements"),"".concat(S.totalInstances," instances"),"".concat(S.batchCount," batches"),"".concat(S.totalAtlases," atlases"),"".concat(S.wrappedCount," wrapped textures"),"".concat(S.simpleCount," simple shapes")].join(", ");if(v)console.log("WebGL (".concat(r.name,") - time ").concat(y,"ms, ").concat(w));else{console.log("WebGL (".concat(r.name,") - frame time ").concat(y,"ms")),console.log("Totals:"),console.log("  ".concat(w)),console.log("Texture Atlases Used:");var T=S.atlasInfo,_=Ys(T),C;try{for(_.s();!(C=_.n()).done;){var N=C.value;console.log("  ".concat(N.type,": ").concat(N.keyCount," keys, ").concat(N.atlasCount," atlases"))}}catch(A){_.e(A)}finally{_.f()}console.log("")}}t.data.gc&&(console.log("Garbage Collect!"),t.data.gc=!1,i.gc())}var uh={};uh.drawPolygonPath=function(t,e,r,n,i,a){var s=n/2,o=i/2;t.beginPath&&t.beginPath(),t.moveTo(e+s*a[0],r+o*a[1]);for(var l=1;l<a.length/2;l++)t.lineTo(e+s*a[l*2],r+o*a[l*2+1]);t.closePath()};uh.drawRoundPolygonPath=function(t,e,r,n,i,a,s){s.forEach(function(o){return $A(t,o)}),t.closePath()};uh.drawRoundRectanglePath=function(t,e,r,n,i,a){var s=n/2,o=i/2,l=a==="auto"?Xd(n,i):Math.min(a,o,s);t.beginPath&&t.beginPath(),t.moveTo(e,r-o),t.arcTo(e+s,r-o,e+s,r,l),t.arcTo(e+s,r+o,e,r+o,l),t.arcTo(e-s,r+o,e-s,r,l),t.arcTo(e-s,r-o,e,r-o,l),t.lineTo(e,r-o),t.closePath()};uh.drawBottomRoundRectanglePath=function(t,e,r,n,i,a){var s=n/2,o=i/2,l=a==="auto"?Xd(n,i):a;t.beginPath&&t.beginPath(),t.moveTo(e,r-o),t.lineTo(e+s,r-o),t.lineTo(e+s,r),t.arcTo(e+s,r+o,e,r+o,l),t.arcTo(e-s,r+o,e-s,r,l),t.lineTo(e-s,r-o),t.lineTo(e,r-o),t.closePath()};uh.drawCutRectanglePath=function(t,e,r,n,i,a,s){var o=n/2,l=i/2,u=s==="auto"?s_():s;t.beginPath&&t.beginPath(),t.moveTo(e-o+u,r-l),t.lineTo(e+o-u,r-l),t.lineTo(e+o,r-l+u),t.lineTo(e+o,r+l-u),t.lineTo(e+o-u,r+l),t.lineTo(e-o+u,r+l),t.lineTo(e-o,r+l-u),t.lineTo(e-o,r-l+u),t.closePath()};uh.drawBarrelPath=function(t,e,r,n,i){var a=n/2,s=i/2,o=e-a,l=e+a,u=r-s,c=r+s,h=DS(n,i),p=h.widthOffset,v=h.heightOffset,y=h.ctrlPtOffsetPct*p;t.beginPath&&t.beginPath(),t.moveTo(o,u+v),t.lineTo(o,c-v),t.quadraticCurveTo(o+y,c,o+p,c),t.lineTo(l-p,c),t.quadraticCurveTo(l-y,c,l,c-v),t.lineTo(l,u+v),t.quadraticCurveTo(l-y,u,l-p,u),t.lineTo(o+p,u),t.quadraticCurveTo(o+y,u,o,u+v),t.closePath()};var t5=Math.sin(0),r5=Math.cos(0),YS={},XS={},fR=Math.PI/40;for(var xp=0*Math.PI;xp<2*Math.PI;xp+=fR)YS[xp]=Math.sin(xp),XS[xp]=Math.cos(xp);uh.drawEllipsePath=function(t,e,r,n,i){if(t.beginPath&&t.beginPath(),t.ellipse)t.ellipse(e,r,n/2,i/2,0,0,2*Math.PI);else for(var a,s,o=n/2,l=i/2,u=0*Math.PI;u<2*Math.PI;u+=fR)a=e-o*YS[u]*t5+o*XS[u]*r5,s=r+l*XS[u]*t5+l*YS[u]*r5,u===0?t.moveTo(a,s):t.lineTo(a,s);t.closePath()};var i0={};i0.createBuffer=function(t,e){var r=document.createElement("canvas");return r.width=t,r.height=e,[r,r.getContext("2d")]};i0.bufferCanvasImage=function(t){var e=this.cy,r=e.mutableElements(),n=r.boundingBox(),i=this.findContainerClientCoords(),a=t.full?Math.ceil(n.w):i[2],s=t.full?Math.ceil(n.h):i[3],o=bt(t.maxWidth)||bt(t.maxHeight),l=this.getPixelRatio(),u=1;if(t.scale!==void 0)a*=t.scale,s*=t.scale,u=t.scale;else if(o){var c=1/0,h=1/0;bt(t.maxWidth)&&(c=u*t.maxWidth/a),bt(t.maxHeight)&&(h=u*t.maxHeight/s),u=Math.min(c,h),a*=u,s*=u}o||(a*=l,s*=l,u*=l);var p=document.createElement("canvas");p.width=a,p.height=s,p.style.width=a+"px",p.style.height=s+"px";var v=p.getContext("2d");if(a>0&&s>0){v.clearRect(0,0,a,s),v.globalCompositeOperation="source-over";var y=this.getCachedZSortedEles();if(t.full)v.translate(-n.x1*u,-n.y1*u),v.scale(u,u),this.drawElements(v,y),v.scale(1/u,1/u),v.translate(n.x1*u,n.y1*u);else{var S=e.pan(),w={x:S.x*u,y:S.y*u};u*=e.zoom(),v.translate(w.x,w.y),v.scale(u,u),this.drawElements(v,y),v.scale(1/u,1/u),v.translate(-w.x,-w.y)}t.bg&&(v.globalCompositeOperation="destination-over",v.fillStyle=t.bg,v.rect(0,0,a,s),v.fill())}return p};function WU(t,e){for(var r=atob(t),n=new ArrayBuffer(r.length),i=new Uint8Array(n),a=0;a<r.length;a++)i[a]=r.charCodeAt(a);return new Blob([n],{type:e})}function n5(t){var e=t.indexOf(",");return t.substr(e+1)}function pR(t,e,r){var n=function(){return e.toDataURL(r,t.quality)};switch(t.output){case"blob-promise":return new cm(function(i,a){try{e.toBlob(function(s){s!=null?i(s):a(new Error("`canvas.toBlob()` sent a null value in its callback"))},r,t.quality)}catch(s){a(s)}});case"blob":return WU(n5(n()),r);case"base64":return n5(n());default:return n()}}i0.png=function(t){return pR(t,this.bufferCanvasImage(t),"image/png")};i0.jpg=function(t){return pR(t,this.bufferCanvasImage(t),"image/jpeg")};var mR={};mR.nodeShapeImpl=function(t,e,r,n,i,a,s,o){switch(t){case"ellipse":return this.drawEllipsePath(e,r,n,i,a);case"polygon":return this.drawPolygonPath(e,r,n,i,a,s);case"round-polygon":return this.drawRoundPolygonPath(e,r,n,i,a,s,o);case"roundrectangle":case"round-rectangle":return this.drawRoundRectanglePath(e,r,n,i,a,o);case"cutrectangle":case"cut-rectangle":return this.drawCutRectanglePath(e,r,n,i,a,s,o);case"bottomroundrectangle":case"bottom-round-rectangle":return this.drawBottomRoundRectanglePath(e,r,n,i,a,o);case"barrel":return this.drawBarrelPath(e,r,n,i,a)}};var qU=gR,Er=gR.prototype;Er.CANVAS_LAYERS=3;Er.SELECT_BOX=0;Er.DRAG=1;Er.NODE=2;Er.WEBGL=3;Er.CANVAS_TYPES=["2d","2d","2d","webgl2"];Er.BUFFER_COUNT=3;Er.TEXTURE_BUFFER=0;Er.MOTIONBLUR_BUFFER_NODE=1;Er.MOTIONBLUR_BUFFER_DRAG=2;function gR(t){var e=this,r=e.cy.window(),n=r.document;t.webgl&&(Er.CANVAS_LAYERS=e.CANVAS_LAYERS=4,console.log("webgl rendering enabled")),e.data={canvases:new Array(Er.CANVAS_LAYERS),contexts:new Array(Er.CANVAS_LAYERS),canvasNeedsRedraw:new Array(Er.CANVAS_LAYERS),bufferCanvases:new Array(Er.BUFFER_COUNT),bufferContexts:new Array(Er.CANVAS_LAYERS)};var i="-webkit-tap-highlight-color",a="rgba(0,0,0,0)";e.data.canvasContainer=n.createElement("div");var s=e.data.canvasContainer.style;e.data.canvasContainer.style[i]=a,s.position="relative",s.zIndex="0",s.overflow="hidden";var o=t.cy.container();o.appendChild(e.data.canvasContainer),o.style[i]=a;var l={"-webkit-user-select":"none","-moz-user-select":"-moz-none","user-select":"none","-webkit-tap-highlight-color":"rgba(0,0,0,0)","outline-style":"none"};zj()&&(l["-ms-touch-action"]="none",l["touch-action"]="none");for(var u=0;u<Er.CANVAS_LAYERS;u++){var c=e.data.canvases[u]=n.createElement("canvas"),h=Er.CANVAS_TYPES[u];e.data.contexts[u]=c.getContext(h),e.data.contexts[u]||Kn("Could not create canvas of type "+h),Object.keys(l).forEach(function(le){c.style[le]=l[le]}),c.style.position="absolute",c.setAttribute("data-id","layer"+u),c.style.zIndex=String(Er.CANVAS_LAYERS-u),e.data.canvasContainer.appendChild(c),e.data.canvasNeedsRedraw[u]=!1}e.data.topCanvas=e.data.canvases[0],e.data.canvases[Er.NODE].setAttribute("data-id","layer"+Er.NODE+"-node"),e.data.canvases[Er.SELECT_BOX].setAttribute("data-id","layer"+Er.SELECT_BOX+"-selectbox"),e.data.canvases[Er.DRAG].setAttribute("data-id","layer"+Er.DRAG+"-drag"),e.data.canvases[Er.WEBGL]&&e.data.canvases[Er.WEBGL].setAttribute("data-id","layer"+Er.WEBGL+"-webgl");for(var u=0;u<Er.BUFFER_COUNT;u++)e.data.bufferCanvases[u]=n.createElement("canvas"),e.data.bufferContexts[u]=e.data.bufferCanvases[u].getContext("2d"),e.data.bufferCanvases[u].style.position="absolute",e.data.bufferCanvases[u].setAttribute("data-id","buffer"+u),e.data.bufferCanvases[u].style.zIndex=String(-u-1),e.data.bufferCanvases[u].style.visibility="hidden";e.pathsEnabled=!0;var p=Ns(),v=function(pe){return{x:(pe.x1+pe.x2)/2,y:(pe.y1+pe.y2)/2}},y=function(pe){return{x:-pe.w/2,y:-pe.h/2}},S=function(pe){var me=pe[0]._private,xe=me.oldBackgroundTimestamp===me.backgroundTimestamp;return!xe},w=function(pe){return pe[0]._private.nodeKey},T=function(pe){return pe[0]._private.labelStyleKey},_=function(pe){return pe[0]._private.sourceLabelStyleKey},C=function(pe){return pe[0]._private.targetLabelStyleKey},N=function(pe,me,xe,Se,Ve){return e.drawElement(pe,me,xe,!1,!1,Ve)},A=function(pe,me,xe,Se,Ve){return e.drawElementText(pe,me,xe,Se,"main",Ve)},I=function(pe,me,xe,Se,Ve){return e.drawElementText(pe,me,xe,Se,"source",Ve)},j=function(pe,me,xe,Se,Ve){return e.drawElementText(pe,me,xe,Se,"target",Ve)},O=function(pe){return pe.boundingBox(),pe[0]._private.bodyBounds},F=function(pe){return pe.boundingBox(),pe[0]._private.labelBounds.main||p},B=function(pe){return pe.boundingBox(),pe[0]._private.labelBounds.source||p},$=function(pe){return pe.boundingBox(),pe[0]._private.labelBounds.target||p},Z=function(pe,me){return me},D=function(pe){return v(O(pe))},H=function(pe,me,xe){var Se=pe?pe+"-":"";return{x:me.x+xe.pstyle(Se+"text-margin-x").pfValue,y:me.y+xe.pstyle(Se+"text-margin-y").pfValue}},U=function(pe,me,xe){var Se=pe[0]._private.rscratch;return{x:Se[me],y:Se[xe]}},W=function(pe){return H("",U(pe,"labelX","labelY"),pe)},Y=function(pe){return H("source",U(pe,"sourceLabelX","sourceLabelY"),pe)},Q=function(pe){return H("target",U(pe,"targetLabelX","targetLabelY"),pe)},ne=function(pe){return y(O(pe))},re=function(pe){return y(B(pe))},q=function(pe){return y($(pe))},te=function(pe){var me=F(pe),xe=y(F(pe));if(pe.isNode()){switch(pe.pstyle("text-halign").value){case"left":xe.x=-me.w-(me.leftPad||0);break;case"right":xe.x=-(me.rightPad||0);break}switch(pe.pstyle("text-valign").value){case"top":xe.y=-me.h-(me.topPad||0);break;case"bottom":xe.y=-(me.botPad||0);break}}return xe},ae=e.data.eleTxrCache=new qg(e,{getKey:w,doesEleInvalidateKey:S,drawElement:N,getBoundingBox:O,getRotationPoint:D,getRotationOffset:ne,allowEdgeTxrCaching:!1,allowParentTxrCaching:!1}),de=e.data.lblTxrCache=new qg(e,{getKey:T,drawElement:A,getBoundingBox:F,getRotationPoint:W,getRotationOffset:te,isVisible:Z}),ge=e.data.slbTxrCache=new qg(e,{getKey:_,drawElement:I,getBoundingBox:B,getRotationPoint:Y,getRotationOffset:re,isVisible:Z}),ye=e.data.tlbTxrCache=new qg(e,{getKey:C,drawElement:j,getBoundingBox:$,getRotationPoint:Q,getRotationOffset:q,isVisible:Z}),se=e.data.lyrTxrCache=new nR(e);e.onUpdateEleCalcs(function(pe,me){ae.invalidateElements(me),de.invalidateElements(me),ge.invalidateElements(me),ye.invalidateElements(me),se.invalidateElements(me);for(var xe=0;xe<me.length;xe++){var Se=me[xe]._private;Se.oldBackgroundTimestamp=Se.backgroundTimestamp}});var fe=function(pe){for(var me=0;me<pe.length;me++)se.enqueueElementRefinement(pe[me].ele)};ae.onDequeue(fe),de.onDequeue(fe),ge.onDequeue(fe),ye.onDequeue(fe),t.webgl&&e.initWebgl(t,{getStyleKey:w,getLabelKey:T,getSourceLabelKey:_,getTargetLabelKey:C,drawElement:N,drawLabel:A,drawSourceLabel:I,drawTargetLabel:j,getElementBox:O,getLabelBox:F,getSourceLabelBox:B,getTargetLabelBox:$,getElementRotationPoint:D,getElementRotationOffset:ne,getLabelRotationPoint:W,getSourceLabelRotationPoint:Y,getTargetLabelRotationPoint:Q,getLabelRotationOffset:te,getSourceLabelRotationOffset:re,getTargetLabelRotationOffset:q})}Er.redrawHint=function(t,e){var r=this;switch(t){case"eles":r.data.canvasNeedsRedraw[Er.NODE]=e;break;case"drag":r.data.canvasNeedsRedraw[Er.DRAG]=e;break;case"select":r.data.canvasNeedsRedraw[Er.SELECT_BOX]=e;break;case"gc":r.data.gc=!0;break}};var $U=typeof Path2D<"u";Er.path2dEnabled=function(t){if(t===void 0)return this.pathsEnabled;this.pathsEnabled=!!t};Er.usePaths=function(){return $U&&this.pathsEnabled};Er.setImgSmoothing=function(t,e){t.imageSmoothingEnabled!=null?t.imageSmoothingEnabled=e:(t.webkitImageSmoothingEnabled=e,t.mozImageSmoothingEnabled=e,t.msImageSmoothingEnabled=e)};Er.getImgSmoothing=function(t){return t.imageSmoothingEnabled!=null?t.imageSmoothingEnabled:t.webkitImageSmoothingEnabled||t.mozImageSmoothingEnabled||t.msImageSmoothingEnabled};Er.makeOffscreenCanvas=function(t,e){var r;if((typeof OffscreenCanvas>"u"?"undefined":Yi(OffscreenCanvas))!=="undefined")r=new OffscreenCanvas(t,e);else{var n=this.cy.window(),i=n.document;r=i.createElement("canvas"),r.width=t,r.height=e}return r};[iR,Ru,Sc,x_,Mf,lh,As,uR,uh,i0,mR].forEach(function(t){er(Er,t)});var KU=[{name:"null",impl:HA},{name:"base",impl:eR},{name:"canvas",impl:qU}],ZU=[{type:"layout",extensions:bz},{type:"renderer",extensions:KU}],vR={},yR={};function xR(t,e,r){var n=r,i=function(O){rn("Can not register `"+e+"` for `"+t+"` since `"+O+"` already exists in the prototype and can not be overridden")};if(t==="core"){if(Ev.prototype[e])return i(e);Ev.prototype[e]=r}else if(t==="collection"){if(Va.prototype[e])return i(e);Va.prototype[e]=r}else if(t==="layout"){for(var a=function(O){this.options=O,r.call(this,O),Fr(this._private)||(this._private={}),this._private.cy=O.cy,this._private.listeners=[],this.createEmitter()},s=a.prototype=Object.create(r.prototype),o=[],l=0;l<o.length;l++){var u=o[l];s[u]=s[u]||function(){return this}}s.start&&!s.run?s.run=function(){return this.start(),this}:!s.start&&s.run&&(s.start=function(){return this.run(),this});var c=r.prototype.stop;s.stop=function(){var j=this.options;if(j&&j.animate){var O=this.animations;if(O)for(var F=0;F<O.length;F++)O[F].stop()}return c?c.call(this):this.emit("layoutstop"),this},s.destroy||(s.destroy=function(){return this}),s.cy=function(){return this._private.cy};var h=function(O){return O._private.cy},p={addEventFields:function(O,F){F.layout=O,F.cy=h(O),F.target=O},bubble:function(){return!0},parent:function(O){return h(O)}};er(s,{createEmitter:function(){return this._private.emitter=new M1(p,this),this},emitter:function(){return this._private.emitter},on:function(O,F){return this.emitter().on(O,F),this},one:function(O,F){return this.emitter().one(O,F),this},once:function(O,F){return this.emitter().one(O,F),this},removeListener:function(O,F){return this.emitter().removeListener(O,F),this},removeAllListeners:function(){return this.emitter().removeAllListeners(),this},emit:function(O,F){return this.emitter().emit(O,F),this}}),tn.eventAliasesOn(s),n=a}else if(t==="renderer"&&e!=="null"&&e!=="base"){var v=bR("renderer","base"),y=v.prototype,S=r,w=r.prototype,T=function(){v.apply(this,arguments),S.apply(this,arguments)},_=T.prototype;for(var C in y){var N=y[C],A=w[C]!=null;if(A)return i(C);_[C]=N}for(var I in w)_[I]=w[I];y.clientFunctions.forEach(function(j){_[j]=_[j]||function(){Kn("Renderer does not implement `renderer."+j+"()` on its prototype")}}),n=T}else if(t==="__proto__"||t==="constructor"||t==="prototype")return Kn(t+" is an illegal type to be registered, possibly lead to prototype pollutions");return FM({map:vR,keys:[t,e],value:n})}function bR(t,e){return BM({map:vR,keys:[t,e]})}function YU(t,e,r,n,i){return FM({map:yR,keys:[t,e,r,n],value:i})}function XU(t,e,r,n){return BM({map:yR,keys:[t,e,r,n]})}var QS=function(){if(arguments.length===2)return bR.apply(null,arguments);if(arguments.length===3)return xR.apply(null,arguments);if(arguments.length===4)return XU.apply(null,arguments);if(arguments.length===5)return YU.apply(null,arguments);Kn("Invalid extension access syntax")};Ev.prototype.extension=QS;ZU.forEach(function(t){t.extensions.forEach(function(e){xR(t.type,e.name,e.impl)})});var gx=function(){if(!(this instanceof gx))return new gx;this.length=0},yf=gx.prototype;yf.instanceString=function(){return"stylesheet"};yf.selector=function(t){var e=this.length++;return this[e]={selector:t,properties:[]},this};yf.css=function(t,e){var r=this.length-1;if(Wt(t))this[r].properties.push({name:t,value:e});else if(Fr(t))for(var n=t,i=Object.keys(n),a=0;a<i.length;a++){var s=i[a],o=n[s];if(o!=null){var l=ya.properties[s]||ya.properties[b1(s)];if(l!=null){var u=l.name,c=o;this[r].properties.push({name:u,value:c})}}}return this};yf.style=yf.css;yf.generateStyle=function(t){var e=new ya(t);return this.appendToStyle(e)};yf.appendToStyle=function(t){for(var e=0;e<this.length;e++){var r=this[e],n=r.selector,i=r.properties;t.selector(n);for(var a=0;a<i.length;a++){var s=i[a];t.css(s.name,s.value)}}return t};var QU="3.33.1",xf=function(e){if(e===void 0&&(e={}),Fr(e))return new Ev(e);if(Wt(e))return QS.apply(QS,arguments)};xf.use=function(t){var e=Array.prototype.slice.call(arguments,1);return e.unshift(xf),t.apply(null,e),this};xf.warnings=function(t){return qM(t)};xf.version=QU;xf.stylesheet=xf.Stylesheet=gx;const{string:ly,array:i5,object:uy,number:Km,bool:ho,oneOfType:bp,any:cy,func:Zm}=Sj,JU={id:ly,className:ly,style:bp([ly,uy]),elements:bp([i5,cy]),stylesheet:bp([i5,cy]),layout:bp([uy,cy]),pan:bp([uy,cy]),zoom:Km,panningEnabled:ho,userPanningEnabled:ho,minZoom:Km,maxZoom:Km,zoomingEnabled:ho,userZoomingEnabled:ho,boxSelectionEnabled:ho,autoungrabify:ho,autolock:ho,autounselectify:ho,get:Zm,toJson:Zm,diff:Zm,forEach:Zm,cy:Zm,headless:ho,styleEnabled:ho,hideEdgesOnViewport:ho,textureOnViewport:ho,motionBlur:ho,motionBlurOpacity:Km,wheelSensitivity:Km,pixelRatio:bp([ly,uy])},wR=(t,e)=>{if(((a,s)=>a==null||s==null)(t,e)&&(t!=null||e!=null))return!0;if(t===e)return!1;if(typeof t!="object"||typeof e!="object")return t!==e;const r=Object.keys(t),n=Object.keys(e),i=a=>t[a]!==e[a];return r.length!==n.length||!(!r.some(i)&&!n.some(i))},Tl=(t,e)=>t!=null?t[e]:null,eG={diff:wR,get:Tl,toJson:t=>t,forEach:(t,e)=>t.forEach(e),elements:[{data:{id:"a",label:"Example node A"}},{data:{id:"b",label:"Example node B"}},{data:{id:"e",source:"a",target:"b"}}],stylesheet:[{selector:"node",style:{label:"data(label)"}}],zoom:1,pan:{x:0,y:0}},dy=(t,e,r,n)=>r(Tl(t,n),Tl(e,n)),tG=(t,e,r,n,i,a,s)=>{t.batch(()=>{(n===wR||dy(e,r,n,"elements"))&&aG(t,Tl(e,"elements"),Tl(r,"elements"),i,a,s,n),dy(e,r,n,"stylesheet")&&iG(t,Tl(e,"stylesheet"),Tl(r,"stylesheet"),i),["zoom","minZoom","maxZoom","zoomingEnabled","userZoomingEnabled","pan","panningEnabled","userPanningEnabled","boxSelectionEnabled","autoungrabify","autolock","autounselectify"].forEach(o=>{dy(e,r,n,o)&&rG(t,o,Tl(e,o),Tl(r,o),i)})}),dy(e,r,n,"layout")&&nG(t,Tl(e,"layout"),Tl(r,"layout"),i)},rG=(t,e,r,n,i)=>{t[e](i(n))},nG=(t,e,r,n)=>{const i=n(r);i!=null&&t.layout(i).run()},iG=(t,e,r,n)=>{const i=t.style();i?.fromJson(n(r)).update()},aG=(t,e,r,n,i,a,s)=>{const o=[],l=t.collection(),u=[],c={},h={},p=v=>i(i(v,"data"),"id");a(r,v=>{const y=p(v);h[y]=v}),e!=null&&a(e,v=>{const y=p(v);c[y]=v,(S=>h[S]!=null)(y)||l.merge(t.getElementById(y))}),a(r,v=>{const y=p(v),S=(w=>c[w])(y);(w=>c[w]!=null)(y)?u.push({ele1:S,ele2:v}):o.push(n(v))}),l.length>0&&t.remove(l),o.length>0&&t.add(o),u.forEach(({ele1:v,ele2:y})=>sG(t,v,y,n,i,s))},sG=(t,e,r,n,i,a)=>{const s=i(i(r,"data"),"id"),o=t.getElementById(s),l={};["data","position","selected","selectable","locked","grabbable","classes"].forEach(c=>{const h=i(r,c);a(h,i(e,c))&&(l[c]=n(h))});const u=i(r,"scratch");a(u,i(e,"scratch"))&&o.scratch(n(u)),Object.keys(l).length>0&&o.json(l)};class oG extends nr.Component{static get propTypes(){return JU}static get defaultProps(){return eG}static normalizeElements(e){if(e.length!=null)return e;{let{nodes:r,edges:n}=e;return r==null&&(r=[]),n==null&&(n=[]),r.concat(n)}}constructor(e){super(e),this.displayName="CytoscapeComponent",this.containerRef=nr.createRef()}componentDidMount(){const e=this.containerRef.current,{global:r,headless:n,styleEnabled:i,hideEdgesOnViewport:a,textureOnViewport:s,motionBlur:o,motionBlurOpacity:l,wheelSensitivity:u,pixelRatio:c}=this.props,h=this._cy=new xf({container:e,headless:n,styleEnabled:i,hideEdgesOnViewport:a,textureOnViewport:s,motionBlur:o,motionBlurOpacity:l,wheelSensitivity:u,pixelRatio:c});r&&(window[r]=h),this.updateCytoscape(null,this.props)}updateCytoscape(e,r){const n=this._cy,{diff:i,toJson:a,get:s,forEach:o}=r;tG(n,e,r,i,a,s,o),r.cy!=null&&r.cy(n)}componentDidUpdate(e){this.updateCytoscape(e,this.props)}componentWillUnmount(){this._cy.destroy()}render(){const{id:e,className:r,style:n}=this.props;return nr.createElement("div",{ref:this.containerRef,id:e,className:r,style:n})}}const lG=[{selector:"node",style:{"background-color":"#1f2937",label:"data(label)",color:"#cbd5e1","font-family":"Outfit, sans-serif","font-size":"12px","text-valign":"bottom","text-margin-y":8,width:40,height:40,"border-width":2,"border-color":"#475569","text-outline-width":2,"text-outline-color":"#050508","overlay-padding":6,"z-index":10}},{selector:'node[category="Individual"]',style:{"background-color":"rgba(49, 46, 129, 0.9)","border-color":"#6366f1",shape:"ellipse",width:50,height:50}},{selector:'node[category="Location"]',style:{"background-color":"rgba(6, 78, 59, 0.9)","border-color":"#10b981",shape:"hexagon",width:60,height:60}},{selector:'node[category="Group"]',style:{"background-color":"rgba(88, 28, 135, 0.9)","border-color":"#a855f7",shape:"round-rectangle"}},{selector:"edge",style:{width:2,"line-color":"#334155","target-arrow-color":"#334155","target-arrow-shape":"triangle","curve-style":"bezier"}},{selector:":selected",style:{"border-width":4,"border-color":"#fafafa","line-color":"#fafafa","target-arrow-color":"#fafafa","z-index":999}}],uG=()=>{const{username:t,projectName:e}=Zi(),{setRightPanelMode:r,setRightOpen:n,setRightPanelTitle:i}=jl(),a=Wa(),[s,o]=ie.useState([]),[l,u]=ie.useState(""),[c,h]=ie.useState(!0),[p,v]=ie.useState(null),y=ie.useRef(null),[S,w]=ie.useState(null);ie.useEffect(()=>{r("CUSTOM"),i("Inspector"),T()},[]),ie.useEffect(()=>{const A=setInterval(()=>{const I=document.getElementById("architect-right-panel-portal");I&&(w(I),clearInterval(A))},100);return()=>clearInterval(A)},[]);const T=async()=>{h(!0);try{const A=await et.get("/world-bible/graph");A&&A.nodes&&o([...A.nodes,...A.edges])}catch(A){console.error("Failed to load graph data",A),a("/")}finally{h(!1)}},_=()=>{if(!y.current)return;y.current.layout({name:"cose",animate:!0,padding:50,nodeOverlap:20,componentSpacing:100}).run()};ie.useEffect(()=>{y.current&&(_(),y.current.on("select","node",A=>{const I=A.target;v(I.data()),n(!0)}),y.current.on("unselect","node",()=>{v(null)}))},[s]);const C=()=>{if(!y.current||!l)return;const A=y.current;if(A.elements().removeClass("highlighted faded"),l.length>0){const I=A.nodes().filter(j=>j.data("label").toLowerCase().includes(l.toLowerCase()));I.length>0&&(A.elements().not(I).addClass("faded"),I.addClass("highlighted"),A.animate({fit:{eles:I,padding:50}}))}},N=()=>m.jsxs("div",{className:"p-6 flex flex-col h-full animate-in fade-in slide-in-from-right-4 duration-500 space-y-8",children:[m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsx("div",{className:"size-8 rounded bg-primary flex items-center justify-center",children:m.jsx("span",{className:"material-symbols-outlined text-primary-foreground text-sm",children:"hub"})}),m.jsx("h2",{className:"font-bold text-sm tracking-tight uppercase",children:"Network Controls"})]}),m.jsxs("div",{className:"flex gap-2",children:[m.jsx("input",{className:"bg-white/5 border border-white/10 rounded-xl px-4 py-2 text-xs w-full outline-none focus:ring-1 focus:ring-primary placeholder:text-slate-600 text-slate-200",placeholder:"Find cosmic entity...",value:l,onChange:A=>u(A.target.value),onKeyDown:A=>A.key==="Enter"&&C()}),m.jsx("button",{onClick:C,className:"px-4 bg-primary/20 hover:bg-primary/30 border border-primary/30 rounded-xl text-primary transition-colors",children:m.jsx("span",{className:"material-symbols-outlined text-base",children:"search"})})]}),m.jsxs("div",{className:"flex items-center justify-between pt-2",children:[m.jsxs("div",{className:"flex gap-2",children:[m.jsx("button",{onClick:_,className:"p-2.5 bg-white/5 hover:bg-white/10 rounded-xl text-slate-400 hover:text-white transition-colors border border-white/5",title:"Re-simulate Gravity",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"refresh"})}),m.jsx("button",{onClick:()=>y.current?.fit(),className:"p-2.5 bg-white/5 hover:bg-white/10 rounded-xl text-slate-400 hover:text-white transition-colors border border-white/5",title:"Fit View",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"fit_screen"})})]}),m.jsxs("div",{className:"flex flex-wrap gap-2 text-[8px] uppercase font-black text-slate-500",children:[m.jsxs("div",{className:"flex items-center gap-1",children:[m.jsx("div",{className:"size-1.5 rounded-full bg-indigo-500"})," IND"]}),m.jsxs("div",{className:"flex items-center gap-1",children:[m.jsx("div",{className:"size-1.5 rounded-full bg-emerald-500"})," LOC"]}),m.jsxs("div",{className:"flex items-center gap-1",children:[m.jsx("div",{className:"size-1.5 rounded-full bg-purple-500"})," GRP"]})]})]})]}),m.jsx("div",{className:"h-px bg-white/5"}),p?m.jsxs("div",{className:"space-y-6",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("div",{className:`size-12 rounded-2xl flex items-center justify-center text-white shadow-xl ${p.category==="Individual"?"bg-indigo-600 shadow-indigo-500/20":p.category==="Location"?"bg-emerald-600 shadow-emerald-500/20":"bg-purple-600 shadow-purple-500/20"}`,children:m.jsx("span",{className:"material-symbols-outlined",children:p.category==="Individual"?"person":p.category==="Location"?"location_on":"groups"})}),m.jsxs("div",{children:[m.jsx("h3",{className:"text-xl font-serif font-bold text-white leading-tight",children:p.label}),m.jsx("span",{className:"text-[10px] font-black uppercase tracking-tighter text-slate-500",children:p.category})]})]}),m.jsx("p",{className:"text-sm text-slate-400 font-serif leading-relaxed italic opacity-80",children:p.summary||"No description available for this cosmic entity."}),m.jsxs("div",{className:"pt-6 border-t border-white/5 space-y-3",children:[m.jsxs("button",{onClick:()=>a(`/${t}/${e}/entities/${p.type||"individual"}/${p.id}`),className:"w-full py-3 bg-white/5 hover:bg-white/10 border border-white/10 rounded-xl text-[10px] font-black uppercase tracking-widest text-slate-300 transition-all flex items-center justify-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"open_in_new"}),m.jsx("span",{children:"Open Bible Entry"})]}),m.jsxs("button",{onClick:()=>{if(!y.current)return;const A=y.current.$id(p.id);y.current.animate({center:{eles:A},zoom:2})},className:"w-full py-3 bg-indigo-600/10 hover:bg-indigo-600/20 border border-indigo-500/30 rounded-xl text-[10px] font-black uppercase tracking-widest text-indigo-300 transition-all flex items-center justify-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"center_focus_strong"}),m.jsx("span",{children:"Focus on Graph"})]})]})]}):m.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center text-slate-500 text-center opacity-40 py-12",children:[m.jsx("span",{className:"material-symbols-outlined text-4xl mb-4",children:"touch_app"}),m.jsxs("p",{className:"text-[10px] font-black uppercase tracking-widest leading-loose",children:["Select a node",m.jsx("br",{}),"to reveal its secrets"]})]})]});return m.jsxs("div",{className:"w-full h-full flex bg-background-dark relative overflow-hidden font-display text-foreground",children:[S&&Il.createPortal(N(),S),s.length===0&&!c&&m.jsx("div",{className:"absolute inset-0 flex items-center justify-center z-10 pointer-events-none",children:m.jsx("div",{className:"text-muted text-lg font-serif italic text-slate-600",children:"The void is empty. Document your world in the Bible."})}),m.jsx(oG,{elements:s,stylesheet:lG,style:{width:"100%",height:"100%"},cy:A=>{y.current=A},minZoom:.2,maxZoom:3,wheelSensitivity:.3,className:"bg-background-dark"})]})},cG=({id:t})=>{const{id:e}=Zi(),r=Wa(),[n,i]=ie.useState("overview"),[a,s]=ie.useState(null),[o,l]=ie.useState(!0),[u,c]=ie.useState(!1);ie.useEffect(()=>{h()},[t]);const h=async()=>{l(!0);try{const S=await et.get(`/bd/entidadindividual/${t}`);s(S)}catch(S){console.error("Error loading character:",S)}finally{l(!1)}},p=async()=>{try{await et.patch("/bd/modificar",{...a,tipoEntidad:"entidadindividual"}),c(!1)}catch(S){console.error("Error saving:",S)}},v=async()=>{if(window.confirm("Move this character to the Trash Bin?"))try{await et.delete(`/bd/entidadindividual/${t}`),r(`/project/${e}`)}catch(S){console.error(S)}},y=(S,w)=>{s(T=>({...T,[S]:w}))};return o?m.jsx("div",{className:"p-20 text-center text-slate-500 animate-pulse",children:"Summoning entity..."}):a?m.jsxs("div",{className:"flex h-full",children:[m.jsxs("div",{className:"flex-1 flex flex-col overflow-y-auto custom-scrollbar p-8 gap-6",children:[m.jsxs("div",{className:"flex items-start gap-6",children:[m.jsx("div",{className:"relative",children:m.jsx(rx,{url:a.imagenUrl||"https://images.unsplash.com/photo-1544005313-94ddf0286df2?q=80&w=1976&auto=format&fit=crop",size:"xl",className:"rounded-2xl border-2 border-primary shadow-[0_0_30px_rgba(99,102,242,0.3)]"})}),m.jsxs("div",{className:"flex-1",children:[m.jsxs("div",{className:"flex items-center gap-3 mb-1",children:[m.jsx("span",{className:"text-xs font-bold text-primary bg-primary/10 px-2 py-0.5 rounded border border-primary/20",children:a.estado||"ACTIVE"}),m.jsx("span",{className:"text-xs font-bold text-slate-400 bg-surface-light px-2 py-0.5 rounded border border-white/5",children:a.tipo||"Unknown"})]}),m.jsxs("h1",{className:"text-4xl font-bold text-white mb-2",children:[a.nombre," ",a.apellidos]}),m.jsx("p",{className:"text-lg text-slate-300",children:a.origen||"Traveling the void"})]}),m.jsxs("div",{className:"flex gap-2",children:[!u&&m.jsx(Yn,{className:"border-red-500/30 text-red-400 hover:bg-red-500/10",icon:"delete",onClick:v,children:"Delete"}),m.jsx(Yn,{variant:"secondary",icon:u?"close":"edit",onClick:()=>c(!u),children:u?"Cancel":"Edit Profile"}),u&&m.jsx(Yn,{variant:"primary",icon:"save",onClick:p,children:"Save Changes"})]})]}),m.jsx("div",{className:"border-b border-glass-border flex gap-6",children:["Overview","Biography","Attributes & Stats","Relationships"].map(S=>m.jsx("button",{onClick:()=>i(S.toLowerCase()),className:`pb-4 px-2 text-sm font-bold border-b-2 transition-colors ${n===S.toLowerCase()?"text-primary border-primary":"text-slate-500 border-transparent hover:text-white"}`,children:S},S))}),m.jsxs("div",{className:"grid grid-cols-3 gap-6",children:[m.jsx("div",{className:"col-span-1 space-y-6",children:m.jsxs(An,{className:"p-4",children:[m.jsxs("h3",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider mb-4 flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"fingerprint"})," Identity"]}),m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[m.jsxs("div",{children:[m.jsx("label",{className:"text-xs text-slate-400 block mb-1",children:"Name"}),m.jsx("input",{type:"text",value:a.nombre,onChange:S=>y("nombre",S.target.value),className:"w-full bg-surface-light border border-white/10 rounded px-3 py-2 text-white text-sm",readOnly:!u})]}),m.jsxs("div",{children:[m.jsx("label",{className:"text-xs text-slate-400 block mb-1",children:"Surnames"}),m.jsx("input",{type:"text",value:a.apellidos||"",onChange:S=>y("apellidos",S.target.value),className:"w-full bg-surface-light border border-white/10 rounded px-3 py-2 text-white text-sm",readOnly:!u})]})]}),m.jsxs("div",{children:[m.jsx("label",{className:"text-xs text-slate-400 block mb-1",children:"Type / Species"}),m.jsx("input",{type:"text",value:a.tipo||"",onChange:S=>y("tipo",S.target.value),className:"w-full bg-surface-light border border-white/10 rounded px-3 py-2 text-white text-sm",readOnly:!u})]}),m.jsxs("div",{children:[m.jsx("label",{className:"text-xs text-slate-400 block mb-1",children:"Origin"}),m.jsx("input",{type:"text",value:a.origen||"",onChange:S=>y("origen",S.target.value),className:"w-full bg-surface-light border border-white/10 rounded px-3 py-2 text-white text-sm",readOnly:!u})]})]})]})}),m.jsx("div",{className:"col-span-2 space-y-6",children:m.jsxs(An,{className:"p-6 relative overflow-hidden group",children:[m.jsxs("div",{className:"flex items-center justify-between mb-6",children:[m.jsxs("h3",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"auto_stories"})," Narrative & Connections"]}),!u&&m.jsx("span",{className:"text-[10px] text-slate-600 bg-white/5 px-2 py-1 rounded",children:"Read Only"})]}),m.jsxs("div",{className:"mb-8",children:[m.jsx("h4",{className:"text-[10px] font-black uppercase tracking-widest text-primary mb-3 opacity-80",children:"Biography"}),m.jsx("textarea",{value:a.descripcion||"",onChange:S=>y("descripcion",S.target.value),readOnly:!u,className:`w-full bg-transparent border-none outline-none text-slate-300 text-sm leading-relaxed resize-none custom-scrollbar ${u?"min-h-[150px] placeholder-white/20":"h-auto overflow-hidden"}`,placeholder:"Write the history of this person..."}),m.jsx("h4",{className:"text-[10px] font-black uppercase tracking-widest text-primary mt-6 mb-3 opacity-80",children:"Behavior & Personality"}),m.jsx("textarea",{value:a.comportamiento||"",onChange:S=>y("comportamiento",S.target.value),readOnly:!u,className:`w-full bg-transparent border-none outline-none text-slate-300 text-sm leading-relaxed resize-none custom-scrollbar ${u?"min-h-[100px]":"h-auto overflow-hidden"}`,placeholder:"How does this person act?"})]}),m.jsxs("div",{className:"pt-6 border-t border-white/5",children:[m.jsxs("h4",{className:"text-[10px] font-black uppercase tracking-widest text-primary mb-4 flex items-center gap-2 opacity-80",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"hub"})," Established Connections"]}),a.relaciones&&a.relaciones.length>0?m.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:a.relaciones.map((S,w)=>m.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white/5 rounded-xl border border-white/5 hover:border-primary/30 transition-colors",children:[m.jsx("div",{className:"size-8 rounded-full bg-white/10 flex items-center justify-center text-xs font-bold",children:S.entidadDestino?.nombre?.charAt(0)||"?"}),m.jsxs("div",{className:"flex-1 min-w-0",children:[m.jsx("div",{className:"text-sm font-bold text-white truncate",children:S.entidadDestino?.nombre||"Unknown"}),m.jsx("div",{className:"text-[10px] text-primary truncate",children:S.tipoRelacion||"Connected"})]})]},w))}):m.jsx("div",{className:"p-6 text-center bg-white/5 rounded-xl border border-dashed border-white/10",children:m.jsx("p",{className:"text-xs text-slate-500 italic",children:"No relationships recorded yet."})})]})]})})]})]}),m.jsxs("div",{className:"w-80 border-l border-glass-border bg-surface-dark/50 hidden xl:flex flex-col",children:[m.jsxs("div",{className:"p-4 border-b border-glass-border flex justify-between items-center",children:[m.jsx("span",{className:"text-xs font-bold text-slate-500",children:"QUICK NOTES"}),m.jsx("button",{className:"text-slate-400 hover:text-white",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"open_in_new"})})]}),m.jsx("div",{className:"p-4 flex-1",children:m.jsx("textarea",{className:"w-full h-full bg-transparent border-none outline-none text-sm text-slate-300 placeholder-slate-600 resize-none",placeholder:"Draft a quick scene or jot down notes for Elara here..."})}),m.jsx("div",{className:"p-2 border-t border-glass-border text-right text-[10px] text-slate-600",children:"0 words"})]})]}):m.jsx("div",{className:"p-20 text-center text-red-500",children:"Character not found in the archives."})},a5=({id:t})=>{const[e,r]=ie.useState(null),[n,i]=ie.useState(!0),[a,s]=ie.useState(!1);ie.useEffect(()=>{o()},[t]);const o=async()=>{i(!0);try{const c=await et.get(`/bd/zona/${t}`);r(c)}catch(c){console.error("Error loading location:",c)}finally{i(!1)}},l=async()=>{try{await et.patch("/bd/modificar",{...e,tipoEntidad:"zona"}),s(!1)}catch(c){console.error("Error saving:",c)}},u=(c,h)=>{r(p=>({...p,[c]:h}))};return n?m.jsx("div",{className:"p-20 text-center text-slate-500 animate-pulse",children:"Scanning terrain..."}):e?m.jsxs("div",{className:"flex h-full overflow-y-auto custom-scrollbar p-8 flex-col gap-8",children:[m.jsxs("header",{className:"flex justify-between items-end",children:[m.jsxs("div",{children:[m.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[m.jsx("span",{className:"text-xs font-bold text-emerald-400 bg-emerald-400/10 px-2 py-0.5 rounded border border-emerald-400/20",children:"LOCATION"}),m.jsx("span",{className:"text-xs font-bold text-slate-400 bg-surface-light px-2 py-0.5 rounded border border-white/5",children:e.tipo||"Wilderness"})]}),m.jsx("h1",{className:"text-5xl font-manrope font-black text-white tracking-tight",children:e.nombre}),m.jsx("p",{className:"text-slate-400 mt-2",children:e.apellidos||"Uncharted territory"})]}),m.jsxs("div",{className:"flex gap-2",children:[m.jsx(Yn,{variant:"secondary",icon:a?"close":"edit",onClick:()=>s(!a),children:a?"Cancel":"Edit Location"}),a&&m.jsx(Yn,{variant:"primary",icon:"save",onClick:l,children:"Update Records"})]})]}),m.jsxs("div",{className:"grid grid-cols-3 gap-8",children:[m.jsxs("div",{className:"col-span-1 space-y-6",children:[m.jsxs(An,{className:"p-6",children:[m.jsxs("h3",{className:"text-xs font-bold text-slate-500 uppercase tracking-widest mb-4 flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"straighten"})," Geography & Scale"]}),m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{children:[m.jsx("label",{className:"text-xs text-slate-400 block mb-1",children:"Size / Scale"}),m.jsx("input",{type:"text",value:e.tamanno||"",onChange:c=>u("tamanno",c.target.value),className:"w-full bg-surface-light border border-white/10 rounded px-3 py-2 text-white text-sm",readOnly:!a})]}),m.jsxs("div",{children:[m.jsx("label",{className:"text-xs text-slate-400 block mb-1",children:"Development Level"}),m.jsx("input",{type:"text",value:e.desarrollo||"",onChange:c=>u("desarrollo",c.target.value),className:"w-full bg-surface-light border border-white/10 rounded px-3 py-2 text-white text-sm",readOnly:!a})]})]})]}),m.jsxs(An,{className:"p-6",children:[m.jsx("h3",{className:"text-xs font-bold text-slate-500 uppercase tracking-widest mb-4",children:"Quick Stats"}),m.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[m.jsxs("div",{className:"bg-white/5 p-3 rounded-xl border border-white/5",children:[m.jsx("span",{className:"text-[10px] text-slate-500 block",children:"Density"}),m.jsx("span",{className:"text-white font-bold",children:"Medium"})]}),m.jsxs("div",{className:"bg-white/5 p-3 rounded-xl border border-white/5",children:[m.jsx("span",{className:"text-[10px] text-slate-500 block",children:"Security"}),m.jsx("span",{className:"text-emerald-400 font-bold",children:"Stable"})]})]})]})]}),m.jsx("div",{className:"col-span-2 space-y-6",children:m.jsxs(An,{className:"p-8",children:[m.jsxs("h3",{className:"text-xs font-bold text-slate-500 uppercase tracking-widest mb-4 flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"description"})," Topographic Records & Lore"]}),m.jsx("textarea",{value:e.descripcion||"",onChange:c=>u("descripcion",c.target.value),readOnly:!a,className:"w-full bg-transparent border-none outline-none text-slate-300 text-lg leading-relaxed min-h-[400px] resize-none",placeholder:"Describe the vistas, the smells, and the secrets of this place..."})]})})]})]}):m.jsx("div",{className:"p-20 text-center text-red-500",children:"Location not found in the maps."})},dG=({id:t})=>{const[e,r]=ie.useState(null),[n,i]=ie.useState(!0),[a,s]=ie.useState(!1);ie.useEffect(()=>{o()},[t]);const o=async()=>{i(!0);try{const c=await et.get(`/bd/entidadcolectiva/${t}`);r(c)}catch(c){console.error("Error loading collective:",c)}finally{i(!1)}},l=async()=>{try{await et.patch("/bd/modificar",{...e,tipoEntidad:"entidadcolectiva"}),s(!1)}catch(c){console.error("Error saving:",c)}},u=(c,h)=>{r(p=>({...p,[c]:h}))};return n?m.jsx("div",{className:"p-20 text-center text-slate-500 animate-pulse",children:"Gathering intelligence..."}):e?m.jsxs("div",{className:"flex h-full overflow-y-auto custom-scrollbar p-8 flex-col gap-8",children:[m.jsxs("header",{className:"flex justify-between items-end",children:[m.jsxs("div",{children:[m.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[m.jsx("span",{className:"text-xs font-bold text-indigo-400 bg-indigo-400/10 px-2 py-0.5 rounded border border-indigo-400/20",children:"COLLECTIVE"}),m.jsx("span",{className:"text-xs font-bold text-slate-400 bg-surface-light px-2 py-0.5 rounded border border-white/5",children:e.tipo||"Organization"})]}),m.jsx("h1",{className:"text-5xl font-manrope font-black text-white tracking-tight",children:e.nombre}),m.jsxs("p",{className:"text-slate-400 mt-2",children:[e.cantidadMiembros||"Unknown"," members"]})]}),m.jsxs("div",{className:"flex gap-2",children:[m.jsx(Yn,{variant:"secondary",icon:a?"close":"edit",onClick:()=>s(!a),children:a?"Cancel":"Edit Collective"}),a&&m.jsx(Yn,{variant:"primary",icon:"save",onClick:l,children:"Update Dossier"})]})]}),m.jsxs("div",{className:"grid grid-cols-3 gap-8",children:[m.jsx("div",{className:"col-span-1 space-y-6",children:m.jsxs(An,{className:"p-6",children:[m.jsxs("h3",{className:"text-xs font-bold text-slate-500 uppercase tracking-widest mb-4 flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"group_work"})," Group Dynamics"]}),m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{children:[m.jsx("label",{className:"text-xs text-slate-400 block mb-1",children:"Scale / Members"}),m.jsx("input",{type:"text",value:e.cantidadMiembros||"",onChange:c=>u("cantidadMiembros",c.target.value),className:"w-full bg-surface-light border border-white/10 rounded px-3 py-2 text-white text-sm",readOnly:!a})]}),m.jsxs("div",{children:[m.jsx("label",{className:"text-xs text-slate-400 block mb-1",children:"Behavior / Alignment"}),m.jsx("input",{type:"text",value:e.comportamiento||"",onChange:c=>u("comportamiento",c.target.value),className:"w-full bg-surface-light border border-white/10 rounded px-3 py-2 text-white text-sm",readOnly:!a})]})]})]})}),m.jsx("div",{className:"col-span-2 space-y-6",children:m.jsxs(An,{className:"p-8",children:[m.jsxs("h3",{className:"text-xs font-bold text-slate-500 uppercase tracking-widest mb-4 flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"history_edu"})," Mandate & History"]}),m.jsx("textarea",{value:e.descripcion||"",onChange:c=>u("descripcion",c.target.value),readOnly:!a,className:"w-full bg-transparent border-none outline-none text-slate-300 text-lg leading-relaxed min-h-[400px] resize-none",placeholder:"Detail the motives, the structure, and the legacy of this group..."})]})})]})]}):m.jsx("div",{className:"p-20 text-center text-red-500",children:"Collective not found in the records."})},hG=()=>m.jsx("div",{className:"flex-1 flex overflow-hidden bg-background-dark font-sans text-slate-300",children:m.jsxs("main",{className:"flex-1 flex flex-col p-12 overflow-y-auto custom-scrollbar relative",children:[m.jsxs("header",{className:"mb-12 space-y-4",children:[m.jsxs("div",{className:"flex items-center gap-2 text-slate-500 font-bold text-[10px] tracking-widest uppercase",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"grid_view"}),m.jsx("span",{children:"Universo Alpha"}),m.jsx("span",{className:"material-symbols-outlined text-sm",children:"chevron_right"}),m.jsx("span",{children:"Galaxia Andrmeda"}),m.jsx("span",{className:"material-symbols-outlined text-sm",children:"chevron_right"}),m.jsx("span",{className:"text-white",children:"Sistema Solar"})]}),m.jsxs("div",{className:"flex justify-between items-start",children:[m.jsxs("div",{className:"space-y-4 max-w-3xl",children:[m.jsxs("div",{className:"flex items-center gap-3 px-3 py-1 rounded bg-orange-500/10 text-orange-400 border border-orange-500/20 inline-block",children:[m.jsx("span",{className:"material-symbols-outlined text-[14px]",children:"sunny"}),m.jsx("span",{className:"text-[9px] font-black uppercase tracking-widest",children:"Sistema Planetario"}),m.jsx("span",{className:"text-[9px] font-bold text-slate-600 tracking-widest ml-2",children:"ID: SYS-SOL-001"})]}),m.jsx("h1",{className:"text-6xl font-manrope font-black text-white tracking-tight",children:"Sistema Solar"}),m.jsx("p",{className:"text-slate-400 text-lg leading-relaxed",children:"Sistema planetario principal ubicado en el Brazo de Orin, hogar de la nica vida biolgica compleja confirmada en el sector galctico Alpha-9."})]}),m.jsxs("div",{className:"flex gap-3",children:[m.jsx("button",{className:"p-3 rounded-2xl bg-white/5 hover:bg-red-500/10 text-slate-500 hover:text-red-400 border border-white/5 transition-all outline-none",children:m.jsx("span",{className:"material-symbols-outlined",children:"delete"})}),m.jsx(Yn,{variant:"primary",icon:"save",children:"Guardar"})]})]})]}),m.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-12",children:[m.jsxs("div",{className:"lg:col-span-1 space-y-8",children:[m.jsxs("section",{className:"space-y-4",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-primary text-lg",children:"sell"}),m.jsx("h4",{className:"text-[10px] font-black uppercase tracking-[0.2em] text-slate-500",children:"Etiquetas"}),m.jsx("span",{className:"ml-auto text-[9px] font-bold text-slate-600 px-1.5 py-0.5 rounded bg-white/5",children:"3 ACTIVAS"})]}),m.jsxs("div",{className:"flex flex-wrap gap-2",children:[m.jsx(x2,{label:"Estrella Tipo G",color:"amber",icon:"star"}),m.jsx(x2,{label:"Vida Confirmada",color:"emerald",icon:"tempest"}),m.jsx(x2,{label:"Rico en Agua",color:"cyan",icon:"water_drop"}),m.jsx("button",{className:"size-8 rounded-full border border-dashed border-white/10 flex items-center justify-center text-slate-600 hover:text-white hover:border-white/30 transition-all",children:"+"})]})]}),m.jsxs("section",{className:"space-y-6",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-primary text-lg",children:"analytics"}),m.jsx("h4",{className:"text-[10px] font-black uppercase tracking-[0.2em] text-slate-500",children:"Atributos Principales"}),m.jsx("button",{className:"ml-auto text-slate-600 hover:text-white transition-colors",children:m.jsx("span",{className:"material-symbols-outlined text-lg",children:"settings"})})]}),m.jsxs("div",{className:"space-y-4",children:[m.jsx(hy,{label:"Forma / Estructura",value:"Heliosfrica Estndar",icon:"hive"}),m.jsx(hy,{label:"Composicin",value:"Hidrgeno (74%), Helio (24%)",icon:"experiment"}),m.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[m.jsx(hy,{label:"Edad (Aos)",value:"4.6 MM",unit:"Aos"}),m.jsx(hy,{label:"Ciclo Orbital",value:"230 MM",unit:"Aos"})]})]})]}),m.jsxs("section",{className:"space-y-4",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-primary text-lg",children:"menu_book"}),m.jsx("h4",{className:"text-[10px] font-black uppercase tracking-[0.2em] text-slate-500",children:"Notas de Lore"})]}),m.jsx("textarea",{className:"w-full h-48 bg-white/5 border border-white/5 rounded-[2rem] p-6 text-sm text-slate-400 placeholder:text-slate-700 focus:border-primary/50 outline-none transition-all resize-none leading-relaxed italic shadow-inner",defaultValue:"El sistema contiene un cinturn de asteroides inusualmente denso entre el 4 y 5 planeta. Se teoriza que es el remanente de una colisin planetaria antigua conocida como 'El Gran Impacto' en las escrituras sagradas de los habitantes de Terra."})]})]}),m.jsx("div",{className:"lg:col-span-2",children:m.jsxs(An,{className:"h-full border-white/5 bg-surface-dark/40 overflow-hidden flex flex-col shadow-2xl",children:[m.jsxs("header",{className:"p-8 border-b border-white/5 flex justify-between items-center",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("div",{className:"size-10 rounded-xl bg-primary/20 text-primary flex items-center justify-center",children:m.jsx("span",{className:"material-symbols-outlined",children:"hub"})}),m.jsxs("div",{children:[m.jsx("h3",{className:"font-bold text-white text-lg tracking-tight",children:"Contenido Interno (Planetas)"}),m.jsx("p",{className:"text-[10px] font-medium text-slate-500 mt-0.5",children:"Arrastra para reordenar la jerarqua orbital"})]})]}),m.jsxs("div",{className:"px-3 py-1 rounded-full bg-emerald-500/10 text-emerald-400 border border-emerald-500/20 text-[10px] font-black uppercase tracking-widest flex items-center gap-2",children:[m.jsx("div",{className:"size-1.5 rounded-full bg-emerald-500 animate-pulse"}),"8 Entidades"]})]}),m.jsxs("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-6 space-y-3",children:[m.jsx(Ym,{name:"Mercurio",type:"Rocoso",stats:"430C | 88 Das",icon:"public"}),m.jsx(Ym,{name:"Venus",type:"Atmsfera",stats:"462C | 225 Das",icon:"public"}),m.jsx(Ym,{name:"Tierra",type:"Habitable",stats:"8B Hab | 1 Luna",icon:"public",active:!0}),m.jsx(Ym,{name:"Marte",type:"Desierto",stats:"-60C | 2 Lunas",icon:"public"}),m.jsx(Ym,{name:"Cinturn Asteroides",type:"Anillo",stats:">1M Obj",icon:"grain"})]}),m.jsx("div",{className:"p-8 bg-black/20 border-t border-white/5",children:m.jsxs("button",{className:"w-full py-4 rounded-[1.5rem] border-2 border-dashed border-white/10 text-slate-500 hover:text-white hover:border-primary/50 hover:bg-primary/5 transition-all flex items-center justify-center gap-3 font-black uppercase text-[10px] tracking-[0.2em]",children:[m.jsx("span",{className:"material-symbols-outlined",children:"add"}),"Aadir Nueva Entidad"]})})]})})]})]})}),x2=({label:t,color:e,icon:r})=>m.jsxs("div",{className:`px-4 py-1.5 rounded-xl bg-${e}-500/10 text-${e}-400 border border-${e}-500/20 flex items-center gap-2 text-[10px] font-black uppercase tracking-widest shadow-lg`,children:[m.jsx("span",{className:"material-symbols-outlined text-[14px]",children:r}),t]}),hy=({label:t,value:e,unit:r,icon:n})=>m.jsxs("div",{className:"space-y-2",children:[m.jsx("p",{className:"text-[9px] font-black uppercase tracking-widest text-slate-600 ml-1",children:t}),m.jsxs("div",{className:"w-full bg-white/5 border border-white/5 rounded-2xl px-5 py-3.5 flex items-center justify-between group hover:border-white/10 transition-all",children:[m.jsxs("div",{className:"flex items-center gap-3",children:[n&&m.jsx("span",{className:"material-symbols-outlined text-slate-500 text-lg group-hover:text-primary transition-colors",children:n}),m.jsx("span",{className:"text-sm font-bold text-slate-300",children:e})]}),r&&m.jsx("span",{className:"text-[10px] font-black text-slate-600 uppercase tracking-widest",children:r})]})]}),Ym=({name:t,type:e,stats:r,icon:n,active:i})=>m.jsxs("div",{className:`group flex items-center gap-6 p-4 rounded-2xl transition-all cursor-pointer ${i?"bg-primary/10 border border-primary/20 shadow-xl":"hover:bg-white/5 border border-transparent"}`,children:[m.jsx("span",{className:"material-symbols-outlined text-slate-700 group-hover:text-slate-500",children:"drag_indicator"}),m.jsx("div",{className:`size-12 rounded-xl flex items-center justify-center ${i?"bg-primary text-white shadow-lg shadow-primary/30":"bg-surface-dark border border-white/5 text-slate-500"}`,children:m.jsx("span",{className:"material-symbols-outlined text-3xl",children:n})}),m.jsx("div",{className:"flex-1",children:m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsx("h4",{className:"text-sm font-bold text-white group-hover:text-primary transition-colors",children:t}),m.jsx("span",{className:`text-[8px] font-black px-1.5 py-0.5 rounded uppercase tracking-widest ${i?"bg-emerald-500/20 text-emerald-400 border border-emerald-500/30":"bg-white/5 text-slate-600"}`,children:e})]})}),m.jsx("div",{className:"flex flex-col items-end gap-1",children:m.jsxs("div",{className:"flex items-center gap-1.5 text-slate-500",children:[m.jsx("span",{className:"material-symbols-outlined text-[12px]",children:"analytics"}),m.jsx("span",{className:"text-[10px] font-mono tracking-tight group-hover:text-slate-300",children:r})]})}),m.jsxs("div",{className:"flex gap-2 ml-4",children:[m.jsx("button",{className:"p-2 rounded-lg text-slate-700 hover:text-white hover:bg-white/5 transition-all",children:m.jsx("span",{className:"material-symbols-outlined text-xl",children:"edit_note"})}),i?m.jsx("button",{className:"size-8 rounded-full bg-primary text-white flex items-center justify-center shadow-lg",children:m.jsx("span",{className:"material-symbols-outlined text-lg",children:"arrow_forward"})}):m.jsx("button",{className:"p-2 rounded-lg text-slate-700 hover:text-white hover:bg-white/5 transition-all",children:m.jsx("span",{className:"material-symbols-outlined text-xl",children:"open_in_new"})})]})]}),fG=()=>m.jsx("div",{className:"flex-1 flex overflow-hidden bg-background-dark font-sans text-slate-300",children:m.jsxs("main",{className:"flex-1 flex flex-col p-12 overflow-y-auto custom-scrollbar relative",children:[m.jsxs("header",{className:"mb-12 space-y-4",children:[m.jsxs("div",{className:"flex items-center gap-2 text-slate-500 font-bold text-[10px] tracking-widest uppercase",children:[m.jsx("span",{children:"Sistema Solar"}),m.jsx("span",{className:"material-symbols-outlined text-sm",children:"chevron_right"}),m.jsx("span",{children:"Kepler-186f"}),m.jsx("span",{className:"material-symbols-outlined text-sm",children:"chevron_right"}),m.jsx("span",{className:"text-white",children:"Territorios"})]}),m.jsxs("div",{className:"flex justify-between items-end",children:[m.jsxs("div",{children:[m.jsxs("div",{className:"flex items-center gap-4 mb-2",children:[m.jsx("h1",{className:"text-6xl font-manrope font-black text-white tracking-tight",children:"Kepler-186f"}),m.jsx("span",{className:"material-symbols-outlined text-4xl text-primary",children:"public"})]}),m.jsx("p",{className:"text-slate-400 text-lg max-w-2xl leading-relaxed",children:"Gestin geopoltica y geogrfica de la superficie planetaria. Administra biomas, asentamientos y recursos estratgicos."})]}),m.jsxs("div",{className:"flex gap-3",children:[m.jsx(Yn,{variant:"secondary",icon:"map",children:"Ver Atlas"}),m.jsx(Yn,{variant:"primary",icon:"add",children:"Nuevo Territorio"})]})]})]}),m.jsxs("section",{className:"space-y-8",children:[m.jsxs(An,{className:"p-2 flex items-center justify-between border-white/5",children:[m.jsxs("div",{className:"flex items-center gap-4 flex-1",children:[m.jsxs("div",{className:"relative flex-1 max-w-sm",children:[m.jsx("span",{className:"material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-slate-500 text-sm",children:"search"}),m.jsx("input",{type:"text",placeholder:"Buscar por nombre...",className:"w-full bg-transparent border-none rounded-xl py-2 pl-9 pr-4 text-xs focus:ring-1 focus:ring-primary/30 outline-none transition-all"})]}),m.jsx("div",{className:"w-px h-6 bg-white/5 mx-2"}),m.jsx(b2,{label:"Bioma: Todos"}),m.jsx(b2,{label:"Poblacin"}),m.jsx(b2,{label:"Estado"})]}),m.jsxs("div",{className:"flex items-center gap-1 p-1 bg-white/5 rounded-lg",children:[m.jsx("button",{className:"p-1.5 rounded-md text-slate-500 hover:text-white transition-colors",children:m.jsx("span",{className:"material-symbols-outlined text-lg",children:"format_list_bulleted"})}),m.jsx("button",{className:"p-1.5 rounded-md bg-white/10 text-white shadow-sm",children:m.jsx("span",{className:"material-symbols-outlined text-lg",children:"grid_view"})})]})]}),m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:[m.jsx(w2,{title:"Nueva Neo-Tokyo",desc:"Metrpolis vertical construida sobre las...",image:"https://lh3.googleusercontent.com/aida-public/AB6AXuAYF5Q6W3o1w1f1",badges:["Capital"],stats:["15M","Templado","Costero"],color:"cyan"}),m.jsx(w2,{title:"Mar de Dunas",desc:"Extensin rida rica en especia slica...",image:"https://lh3.googleusercontent.com/aida-public/AB6AXuBYG6R7X4p2x2g2",stats:["Hostil","rido"],color:"amber"}),m.jsx(w2,{title:"Sanctum Bio-Domo",desc:"Instalacin de investigacin...",image:"https://lh3.googleusercontent.com/aida-public/AB6AXuCZ H7S8Y5q3z3h3",badges:["Ciencia"],stats:["5K","Jungla"],color:"purple"}),m.jsxs("div",{className:"group border-2 border-dashed border-white/5 rounded-[2.5rem] flex flex-col items-center justify-center p-12 gap-4 hover:border-primary/30 hover:bg-primary/5 transition-all cursor-pointer",children:[m.jsx("div",{className:"size-16 rounded-3xl bg-white/5 flex items-center justify-center group-hover:scale-110 transition-transform",children:m.jsx("span",{className:"material-symbols-outlined text-3xl text-slate-600 group-hover:text-primary",children:"add_location_alt"})}),m.jsx("p",{className:"text-xs font-black uppercase tracking-widest text-slate-600 group-hover:text-white",children:"Aadir Territorio"})]})]})]})]})}),b2=({label:t})=>m.jsxs("button",{className:"flex items-center gap-2 px-3 py-1.5 rounded-xl hover:bg-white/5 transition-all group",children:[m.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest text-slate-500 group-hover:text-white",children:t}),m.jsx("span",{className:"material-symbols-outlined text-slate-600 text-[14px]",children:"expand_more"})]}),w2=({title:t,desc:e,image:r,badges:n=[],stats:i=[],color:a})=>m.jsxs("div",{className:"group relative rounded-[2.5rem] overflow-hidden border border-white/5 bg-surface-dark/50 hover:border-white/10 transition-all shadow-2xl",children:[m.jsxs("div",{className:"h-48 overflow-hidden relative",children:[m.jsx("img",{src:r,alt:t,className:"w-full h-full object-cover transition-transform duration-700 group-hover:scale-110 opacity-60 group-hover:opacity-100"}),m.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-surface-dark via-transparent to-transparent"}),m.jsx("div",{className:"absolute top-4 right-4 flex gap-2",children:n.map(s=>m.jsxs("span",{className:`px-3 py-1 rounded-full text-[9px] font-black uppercase tracking-widest bg-${a==="cyan"?"primary":a==="amber"?"amber-500":"purple-500"}/20 text-${a==="cyan"?"primary":a==="amber"?"amber-400":"purple-400"} border border-white/10 backdrop-blur-md flex items-center gap-1.5`,children:[m.jsx("span",{className:"material-symbols-outlined text-[12px]",children:s==="Capital"?"star":"science"}),s]},s))})]}),m.jsxs("div",{className:"p-8 space-y-6",children:[m.jsxs("header",{className:"flex justify-between items-start",children:[m.jsxs("div",{children:[m.jsx("h3",{className:"text-2xl font-manrope font-black text-white mb-2 group-hover:text-primary transition-colors",children:t}),m.jsx("p",{className:"text-xs text-slate-500 leading-relaxed line-clamp-2",children:e})]}),m.jsx("button",{className:"p-2 text-slate-700 hover:text-white",children:m.jsx("span",{className:"material-symbols-outlined",children:"more_vert"})})]}),m.jsx("div",{className:"flex flex-wrap gap-2",children:i.map(s=>m.jsxs("div",{className:"flex items-center gap-1.5 px-3 py-1 rounded-full bg-white/5 border border-white/5 text-[9px] font-black text-slate-400 uppercase tracking-widest",children:[m.jsx("div",{className:`size-1.5 rounded-full bg-${a==="cyan"?"primary":a==="amber"?"amber-500":"purple-500"}/50`}),s]},s))}),m.jsxs("div",{className:"flex gap-3 pt-2",children:[m.jsxs("button",{className:"flex-1 py-2.5 rounded-xl bg-white/5 hover:bg-white/10 border border-white/5 text-[10px] font-black uppercase tracking-widest text-slate-300 flex items-center justify-center gap-2 transition-all",children:[m.jsx("span",{className:"material-symbols-outlined text-sm opacity-50",children:"edit"})," Editar"]}),m.jsxs("button",{className:"flex-1 py-2.5 rounded-xl bg-white/5 hover:bg-white/10 border border-white/5 text-[10px] font-black uppercase tracking-widest text-slate-300 flex items-center justify-center gap-2 transition-all",children:[m.jsx("span",{className:"material-symbols-outlined text-sm opacity-50",children:"map"})," Ubicacin"]})]})]})]}),pG=()=>{const{type:t,entityId:e}=Zi(),r=()=>{const n=t?.toLowerCase();switch(n){case"character":case"entidadindividual":return m.jsx(cG,{id:e});case"location":case"zona":return m.jsx(a5,{id:e});case"culture":case"entidadcolectiva":return m.jsx(dG,{id:e});case"universe":case"galaxy":case"system":return m.jsx(hG,{id:e,type:n});case"planet":return m.jsx(fG,{id:e});case"construccion":return m.jsx(a5,{id:e});case"efectos":return m.jsxs("div",{className:"p-8 text-white",children:["Effect/Spell View for ID: ",e]});case"interaccion":return m.jsxs("div",{className:"p-8 text-white",children:["Interaction/Event View for ID: ",e]});case"magic":return m.jsxs("div",{className:"p-8 text-white",children:["Magic System View for ID: ",id]});default:return m.jsxs("div",{className:"p-8 text-white",children:["Unknown Entity Type: ",t]})}};return m.jsx("div",{className:"flex-1 bg-background-dark overflow-hidden",children:r()})},mG=()=>{const{t}=bc(),{setRightPanelMode:e,setRightOpen:r,setRightPanelTitle:n}=jl(),[i,a]=ie.useState([]),[s,o]=ie.useState(null),[l,u]=ie.useState([]),[c,h]=ie.useState(!0),[p,v]=ie.useState(!1),[y,S]=ie.useState(!1),[w,T]=ie.useState({nombre:"",descripcion:"",fechaTexto:"",ordenAbsoluto:0}),[_,C]=ie.useState({nombre:"",descripcion:""}),[N,A]=ie.useState(null),[I,j]=ie.useState(null),[O,F]=ie.useState("eventos"),[B,$]=ie.useState([]),[Z,D]=ie.useState([]),[H,U]=ie.useState(null),W=nr.useRef(!1),Y=async Ce=>{try{return(await et.get("/bd/relacion")).filter(gt=>gt.tipoOrigen==="lineatiempo"&&gt.idOrigen===Ce||gt.tipoDestino==="lineatiempo"&&gt.idDestino===Ce).map(gt=>gt.idOrigen===Ce?gt.idDestino:gt.idOrigen)}catch(Fe){return console.error(Fe),[]}},Q=async(Ce,Fe)=>{const Ke=await Y(Ce),mt=Fe.filter(yt=>Ke.includes(yt.id));$(mt);const gt=Fe.filter(yt=>yt.id!==Ce&&!Ke.includes(yt.id));D(gt)},ne=async Ce=>{if(!(!s||!Ce))try{await et.put("/bd/insertar",{tipoEntidad:"relacion",tipoOrigen:"lineatiempo",idOrigen:s,tipoDestino:"lineatiempo",idDestino:Ce,descripcion:"Anexo de lnea de tiempo"}),Q(s,i)}catch(Fe){console.error(Fe)}},re=async Ce=>{const Ke=(await et.get("/bd/relacion")).find(mt=>mt.tipoOrigen==="lineatiempo"&&mt.idOrigen===s&&mt.idDestino===Ce||mt.tipoDestino==="lineatiempo"&&mt.idDestino===s&&mt.idOrigen===Ce);Ke&&(await et.delete(`/bd/relacion/${Ke.id}`),Q(s,i))};ie.useEffect(()=>{e("CUSTOM"),n(t("timeline.title"));const Ce=setInterval(()=>{const Fe=document.getElementById("architect-right-panel-portal");Fe&&(U(Fe),clearInterval(Ce))},50);return()=>{clearInterval(Ce),e("NOTES"),n("")}},[]);const[q,te]=ie.useState([]),[ae,de]=ie.useState(null);ie.useEffect(()=>{W.current||(W.current=!0,ye())},[]);const ge=Ce=>{n(m.jsxs("div",{className:"flex flex-col",children:[m.jsx("span",{children:t("timeline.title").toUpperCase()}),Ce&&m.jsx("span",{className:"text-[10px] text-slate-400 font-medium normal-case tracking-normal mt-0.5",children:Ce})]}))};ie.useEffect(()=>{if(O==="eventos"||O==="anexos")if(s){const Fe=q.flatMap(Ke=>Ke.lineasTemporales||[]).find(Ke=>Ke.id===s);ge(Fe?.nombre)}else ge(null);else O==="universo"&&n(t("timeline.multiverse"))},[s,O,q]);const ye=async()=>{try{const Ce=await et.get("/multiverso/list");if(te(Ce),!s&&Ce.length>0){const Fe=Ce[0];Fe.lineasTemporales&&Fe.lineasTemporales.length>0&&o(Fe.lineasTemporales[0].id)}}catch(Ce){console.error("Failed to load multiverse",Ce)}},se=async Ce=>{try{const Fe=await et.get(`/timeline/linea/${Ce}/eventos`);Fe.sort((Ke,mt)=>(Ke.ordenAbsoluto||0)-(mt.ordenAbsoluto||0)),u(Fe)}catch(Fe){console.error("Failed to load events",Fe)}},fe=async()=>{if(!s||!w.nombre)return;const Ce={...w,ordenAbsoluto:parseInt(w.ordenAbsoluto)||0};try{N?await et.put(`/timeline/evento/${N.id}`,{...Ce,lineaTiempo:{id:s}}):await et.post("/timeline/evento",{...Ce,lineaTiempo:{id:s}}),T({nombre:"",descripcion:"",fechaTexto:"",ordenAbsoluto:0}),A(null),se(s)}catch(Fe){console.error(Fe)}},le=Ce=>{A(Ce),T({nombre:Ce.nombre,descripcion:Ce.descripcion,fechaTexto:Ce.fechaTexto,ordenAbsoluto:Ce.ordenAbsoluto||0}),F("eventos"),r(!0)},pe=async()=>{if(!(!_.nombre||!_.universoId))try{const Ce=await et.post("/timeline/linea",{..._,esRaiz:!1,universo:{id:_.universoId}});S(!1),C({nombre:"",descripcion:"",universoId:null}),await ye(),o(Ce.id)}catch(Ce){console.error("Error creating timeline:",Ce)}},[me,xe]=ie.useState({nombre:"",descripcion:""}),Se=async()=>{if(me.nombre)try{const Ce=await et.post("/multiverso/crear",me);xe({nombre:"",descripcion:""}),r(!1),await ye()}catch(Ce){console.error("Error creating universe",Ce)}},Ve=async()=>{if(ae)try{await et.put(`/multiverso/${ae}`,{nombre:me.nombre,descripcion:me.descripcion}),r(!1),await ye()}catch(Ce){console.error("Error updating universe",Ce)}},$e=async()=>{if(ae&&window.confirm(t("timeline.delete_universe_confirm")))try{await et.delete(`/multiverso/${ae}`),r(!1),de(null),await ye()}catch(Ce){console.error("Error deleting universe",Ce)}};ie.useEffect(()=>{if(O==="universe-create")xe({nombre:"",descripcion:""});else if(O==="universe-edit"&&ae){const Ce=q.find(Fe=>Fe.id===ae);Ce&&xe({nombre:Ce.nombre,descripcion:Ce.descripcion||""})}},[O,ae,q]);const[St,rt]=ie.useState({open:!1,type:null,id:null,title:"",message:""}),lt=(Ce,Fe)=>{Fe.stopPropagation(),rt({open:!0,type:"TIMELINE",id:Ce,title:t("timeline.delete_line"),message:t("bible.delete_folder_msg")})},De=(Ce,Fe)=>{Fe.stopPropagation(),rt({open:!0,type:"EVENT",id:Ce,title:t("timeline.delete_event"),message:t("common.are_you_sure")})},Le=async()=>{const{type:Ce,id:Fe}=St;if(!(!Ce||!Fe))try{if(Ce==="TIMELINE"){if(await et.delete(`/timeline/linea/${Fe}`),s===Fe){const mt=q.flatMap(gt=>gt.lineasTemporales||[]).filter(gt=>gt.id!==Fe);o(mt.length>0?mt[0].id:null)}await ye()}else Ce==="EVENT"&&(await et.delete(`/timeline/evento/${Fe}`),se(s),N&&N.id===Fe&&A(null))}catch(Ke){console.error(Ke),alert(t("common.error_delete"))}},Qe=m.jsxs(m.Fragment,{children:[m.jsx("div",{className:"p-4 border-b border-white/5",children:m.jsxs("div",{className:"flex bg-black/40 rounded-lg p-1 overflow-x-auto gap-1",children:[m.jsx("button",{onClick:()=>F("eventos"),className:`flex-1 py-2 text-xs font-bold uppercase tracking-wider rounded-md transition-all ${O==="eventos"?"bg-primary text-white shadow-lg":"text-slate-500 hover:text-slate-300"}`,children:t("timeline.events_tab")}),m.jsx("button",{onClick:()=>F("anexos"),className:`flex-1 py-2 text-xs font-bold uppercase tracking-wider rounded-md transition-all ${O==="anexos"?"bg-primary text-white shadow-lg":"text-slate-500 hover:text-slate-300"}`,children:t("timeline.annexes_tab")}),m.jsx("button",{onClick:()=>F("universo"),className:`flex-1 py-2 text-xs font-bold uppercase tracking-wider rounded-md transition-all ${O==="universo"?"bg-amber-600 text-white shadow-lg":"text-slate-500 hover:text-amber-500/80"}`,children:t("timeline.multiverse")})]})}),m.jsxs("div",{className:"flex-1 overflow-y-auto p-4 custom-scrollbar",children:[O==="eventos"&&m.jsx("div",{className:"space-y-6 animate-in fade-in slide-in-from-right-4",children:m.jsxs("div",{className:"bg-black/20 rounded-xl p-4 border border-white/5",children:[m.jsxs("h3",{className:"text-xs font-black uppercase text-primary mb-4 flex items-center justify-between",children:[t(N?"timeline.edit_event":"timeline.add_event"),N&&m.jsx("button",{onClick:()=>{A(null),T({nombre:"",descripcion:"",fechaTexto:"",ordenAbsoluto:l.length+1})},className:"text-[10px] text-slate-500 hover:text-white underline",children:t("common.cancel").toUpperCase()})]}),m.jsxs("div",{className:"space-y-3",children:[m.jsxs("div",{children:[m.jsx("label",{className:"text-[10px] text-slate-500 uppercase font-bold mb-1 block",children:t("timeline.event_name")}),m.jsx("input",{className:"w-full bg-background-dark border border-white/10 rounded-lg p-2 text-sm text-white outline-none focus:border-primary",value:w.nombre,onChange:Ce=>T({...w,nombre:Ce.target.value}),placeholder:t("timeline.event_name")})]}),m.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[m.jsxs("div",{children:[m.jsx("label",{className:"text-[10px] text-slate-500 uppercase font-bold mb-1 block",children:t("timeline.date_label")}),m.jsx("input",{className:"w-full bg-background-dark border border-white/10 rounded-lg p-2 text-sm text-white outline-none focus:border-primary",value:w.fechaTexto,onChange:Ce=>T({...w,fechaTexto:Ce.target.value}),placeholder:"e.g. Year 500"})]}),m.jsxs("div",{children:[m.jsx("label",{className:"text-[10px] text-slate-500 uppercase font-bold mb-1 block",children:t("timeline.order")}),m.jsx("input",{type:"text",className:"w-full bg-background-dark border border-white/10 rounded-lg p-2 text-sm text-white outline-none focus:border-primary",value:w.ordenAbsoluto,onChange:Ce=>{const Fe=Ce.target.value;/^[-+]?\d*$/.test(Fe)&&T({...w,ordenAbsoluto:Fe})},placeholder:"+/- Num"})]})]}),m.jsxs("div",{children:[m.jsx("label",{className:"text-[10px] text-slate-500 uppercase font-bold mb-1 block",children:t("timeline.description")}),m.jsx("textarea",{className:"w-full bg-background-dark border border-white/10 rounded-lg p-2 text-sm text-white outline-none focus:border-primary h-24 resize-none",value:w.descripcion,onChange:Ce=>T({...w,descripcion:Ce.target.value}),placeholder:t("timeline.description")})]}),m.jsx("div",{className:"pt-2",children:m.jsx(Yn,{variant:"primary",onClick:fe,className:"w-full justify-center",children:t(N?"timeline.save_changes":"timeline.create_event")})}),N&&m.jsx("button",{onClick:Ce=>De(N.id,Ce),className:"w-full text-center text-xs text-red-500 hover:text-red-400 py-2 border border-red-500/20 rounded-lg hover:bg-red-500/10 transition-colors",children:t("timeline.delete_event_btn")})]})]})}),O==="anexos"&&m.jsx("div",{className:"space-y-6 animate-in fade-in slide-in-from-right-4",children:m.jsxs("div",{className:"bg-black/20 rounded-xl p-4 border border-white/5",children:[m.jsx("h3",{className:"text-xs font-black uppercase text-primary mb-4",children:t("timeline.linked_timelines")}),m.jsx("p",{className:"text-xs text-slate-500 mb-4",children:t("timeline.annexed_desc")}),m.jsxs("div",{className:"space-y-2 mb-6",children:[B.map(Ce=>m.jsxs("div",{className:"flex items-center justify-between p-2 bg-white/5 rounded-lg border border-white/5",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-xs text-slate-400",children:"timeline"}),m.jsx("span",{className:"text-xs font-bold text-slate-300",children:Ce.nombre})]}),m.jsx("button",{onClick:()=>re(Ce.id),className:"text-slate-500 hover:text-red-500",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"link_off"})})]},Ce.id)),B.length===0&&m.jsx("span",{className:"text-xs text-slate-600 italic",children:t("timeline.no_linked")})]}),m.jsx("h4",{className:"text-[10px] font-bold uppercase text-slate-400 mb-2",children:t("timeline.available_to_link")}),m.jsxs("div",{className:"space-y-1",children:[Z.map(Ce=>m.jsxs("button",{onClick:()=>ne(Ce.id),className:"w-full flex items-center gap-2 p-2 hover:bg-white/5 rounded-lg text-left transition-colors group",children:[m.jsx("span",{className:"material-symbols-outlined text-xs text-green-500/50 group-hover:text-green-500",children:"add_link"}),m.jsx("span",{className:"text-xs text-slate-400 group-hover:text-white",children:Ce.nombre})]},Ce.id)),Z.length===0&&m.jsx("span",{className:"text-xs text-slate-600 italic",children:t("timeline.no_available")})]})]})}),O==="universo"&&m.jsx("div",{className:"space-y-6 animate-in fade-in slide-in-from-right-4",children:m.jsxs("div",{className:"bg-black/20 rounded-xl p-4 border border-white/5",children:[m.jsx("h3",{className:"text-xs font-black uppercase text-amber-500 mb-4",children:t(ae?"timeline.universe_settings":"timeline.new_universe")}),m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{children:[m.jsx("label",{className:"text-[10px] text-slate-500 uppercase font-bold mb-1 block",children:t("timeline.universe_name")}),m.jsx("input",{className:"w-full bg-background-dark border border-white/10 rounded-lg p-2 text-sm text-white outline-none focus:border-primary",value:me.nombre,onChange:Ce=>xe({...me,nombre:Ce.target.value}),placeholder:"e.g. Alternate Reality 1"})]}),m.jsxs("div",{children:[m.jsx("label",{className:"text-[10px] text-slate-500 uppercase font-bold mb-1 block",children:"Description"}),m.jsx("textarea",{className:"w-full bg-background-dark border border-white/10 rounded-lg p-2 text-sm text-white outline-none focus:border-primary h-24 resize-none",value:me.descripcion,onChange:Ce=>xe({...me,descripcion:Ce.target.value}),placeholder:t("timeline.universe_desc")})]}),m.jsx("div",{className:"pt-2",children:m.jsx(Yn,{variant:"primary",onClick:ae?Ve:Se,className:"w-full justify-center",children:t(ae?"common.save":"common.create")})}),ae&&m.jsx("button",{onClick:$e,className:"w-full text-center text-xs text-red-500 hover:text-red-400 py-2 border border-red-500/20 rounded-lg hover:bg-red-500/10 transition-colors",children:t("common.delete")})]})]})})]})]});return m.jsxs("div",{className:"flex h-screen bg-background-dark text-white overflow-hidden",children:[H&&Il.createPortal(Qe,H),m.jsxs("aside",{className:"w-64 bg-surface-dark border-r border-white/5 flex flex-col p-4 z-20 shrink-0",children:[m.jsxs("header",{className:"flex justify-between items-center mb-6",children:[m.jsx("h2",{className:"text-xs font-black uppercase tracking-widest text-primary",children:t("timeline.multiverse")}),m.jsx("button",{onClick:()=>{e("CUSTOM"),F("universo"),de(null),xe({nombre:"",descripcion:""}),r(!0)},className:"text-slate-400 hover:text-white",title:"New Universe",children:m.jsx("span",{className:"material-symbols-outlined",children:"add_circle"})})]}),m.jsx("div",{className:"space-y-6 overflow-y-auto flex-1 custom-scrollbar",children:q.map(Ce=>m.jsxs("div",{className:"space-y-2",children:[m.jsxs("div",{className:"flex items-center justify-between group",children:[m.jsx("h3",{className:`text-[10px] font-bold uppercase pl-2 cursor-pointer ${ae===Ce.id?"text-white":"text-slate-500"}`,onClick:()=>{de(Ce.id),xe({nombre:Ce.nombre,descripcion:Ce.descripcion||""}),F("universo"),e("CUSTOM"),r(!0)},children:Ce.nombre}),m.jsx("div",{className:"flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:m.jsx("button",{onClick:()=>{C({..._,universoId:Ce.id}),S(!0)},className:"text-slate-500 hover:text-primary",title:"Add Timeline here",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"add"})})})]}),y&&_.universoId===Ce.id&&m.jsxs("div",{className:"ml-2 mb-2 p-2 bg-black/20 rounded-lg animate-in fade-in",children:[m.jsx("input",{className:"w-full bg-transparent border-b border-white/20 text-xs p-1 outline-none focus:border-primary mb-1",placeholder:"Timeline Name",value:_.nombre,onChange:Fe=>C({..._,nombre:Fe.target.value}),autoFocus:!0,onKeyDown:Fe=>Fe.key==="Enter"&&pe()}),m.jsxs("div",{className:"flex justify-end gap-1",children:[m.jsx("button",{onClick:()=>S(!1),className:"text-[10px] text-slate-500 hover:text-white",children:t("common.cancel").toUpperCase()}),m.jsx("button",{onClick:pe,className:"text-[10px] font-bold text-primary",children:t("common.create").toUpperCase()})]})]}),m.jsxs("div",{className:"space-y-1 pl-2 border-l border-white/5 ml-1",children:[Ce.lineasTemporales&&Ce.lineasTemporales.map(Fe=>m.jsxs("div",{onClick:()=>{o(Fe.id),F("eventos"),e("CUSTOM"),r(!0)},className:`group flex items-center justify-between p-2 rounded-lg cursor-pointer transition-all ${s===Fe.id?"bg-primary/10 text-white shadow-[0_0_10px_rgba(var(--primary-rgb),0.1)]":"text-slate-400 hover:bg-white/5"}`,children:[m.jsx("span",{className:"text-xs truncate",children:Fe.nombre}),m.jsx("button",{onClick:Ke=>lt(Fe.id,Ke),className:"opacity-0 group-hover:opacity-100 text-slate-500 hover:text-red-500 transition-opacity",children:m.jsx("span",{className:"material-symbols-outlined text-[10px]",children:"delete"})})]},Fe.id)),(!Ce.lineasTemporales||Ce.lineasTemporales.length===0)&&m.jsx("div",{className:"p-2 text-[10px] italic text-slate-600",children:t("timeline.no_timelines")})]})]},Ce.id))})]}),m.jsxs("main",{className:"flex-1 relative flex flex-col h-full overflow-hidden bg-background-dark",children:[m.jsx("div",{className:"h-16 border-b border-white/5 bg-background-dark/80 backdrop-blur flex items-center px-8 z-10 shrink-0",children:m.jsx("div",{children:(()=>{const Fe=q.flatMap(Ke=>Ke.lineasTemporales||[]).find(Ke=>Ke.id===s);return m.jsxs(m.Fragment,{children:[m.jsxs("h1",{className:"text-xl font-bold flex items-center gap-2",children:[Fe?.esRaiz&&m.jsx("span",{className:"text-amber-400 material-symbols-outlined",children:"star"}),Fe?.nombre||t("timeline.select_timeline")]}),m.jsx("p",{className:"text-xs text-slate-500",children:Fe?.descripcion})]})})()})}),m.jsx("div",{className:"flex-1 overflow-y-auto p-8 relative custom-scrollbar z-10",children:m.jsxs("div",{className:"max-w-2xl mx-auto relative pl-8 border-l-2 border-white/10 space-y-8 pb-32",children:[l.length===0&&m.jsx("div",{className:"text-center text-slate-600 italic py-20",children:t("timeline.no_events")}),l.map((Ce,Fe)=>m.jsxs("div",{className:"relative group animate-in fade-in slide-in-from-bottom-4",style:{animationDelay:`${Fe*50}ms`},children:[m.jsx("div",{className:"absolute top-6 -left-[41px] size-4 rounded-full bg-white/20 border-4 border-background-dark group-hover:bg-primary transition-colors cursor-pointer",onClick:()=>le(Ce)}),m.jsxs("div",{className:"ml-4 bg-surface-dark/50 border border-white/5 p-5 rounded-2xl hover:border-primary/30 transition-all hover:bg-surface-dark group-hover:translate-x-1 duration-300 relative group/card",children:[m.jsxs("div",{className:"absolute top-3 right-3 opacity-0 group-hover/card:opacity-100 transition-opacity flex gap-1 bg-black/50 rounded-lg backdrop-blur-sm border border-white/5 p-1",children:[m.jsx("button",{onClick:()=>le(Ce),className:"p-1.5 text-slate-400 hover:text-white hover:bg-white/10 rounded transition-colors",title:"Edit",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"edit"})}),m.jsx("button",{onClick:Ke=>De(Ce.id,Ke),className:"p-1.5 text-slate-400 hover:text-red-500 hover:bg-red-500/10 rounded transition-colors",title:"Delete",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})})]}),m.jsx("div",{className:"flex justify-between items-start",children:m.jsxs("div",{children:[m.jsxs("div",{className:"flex flex-col mb-1",children:[m.jsx("h3",{className:"text-lg font-bold text-white",children:Ce.nombre}),m.jsx("span",{className:"text-xs font-mono font-bold text-primary opacity-80",children:Ce.fechaTexto})]}),m.jsx("p",{className:"text-sm text-slate-400 leading-relaxed",children:Ce.descripcion})]})})]})]},Ce.id))]})})]}),m.jsx(qv,{isOpen:St.open,onClose:()=>rt({...St,open:!1}),onConfirm:Le,title:St.title,message:St.message,confirmText:t("common.delete"),type:"danger"})]})},gG=({onCancel:t,onCreate:e})=>{const[r,n]=ie.useState(1),[i,a]=ie.useState("regional"),[s,o]=ie.useState("upload"),[l,u]=ie.useState(null),[c,h]=ie.useState(""),p=nr.useRef(null),v=w=>{const T=w.target.files?.[0];T&&T.type.startsWith("image/")&&(u(T),o("upload"))},y=()=>{p.current?.click()},S=()=>{e(s,c||"Nuevo Mapa",l)};return m.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-background-dark/80 backdrop-blur-xl animate-in fade-in duration-300",children:m.jsx("div",{className:"w-full max-w-4xl max-h-[90vh] overflow-y-auto no-scrollbar relative animate-in zoom-in-95 duration-500",children:m.jsxs(An,{className:"p-0 border-white/10 shadow-[0_0_100px_rgba(0,0,0,0.5)] overflow-hidden",children:[m.jsxs("header",{className:"p-8 border-b border-white/5 flex justify-between items-center bg-white/[0.02]",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("div",{className:"size-12 rounded-2xl bg-primary/20 text-primary flex items-center justify-center",children:m.jsx("span",{className:"material-symbols-outlined text-2xl",children:"add_location_alt"})}),m.jsxs("div",{children:[m.jsx("h1",{className:"text-2xl font-manrope font-black text-white tracking-tight",children:"Crear Nuevo Mapa / Zona"}),m.jsx("p",{className:"text-xs text-slate-500 font-medium",children:"Configura los detalles para tu nueva entrada cartogrfica."})]})]}),m.jsx("button",{onClick:t,className:"text-slate-500 hover:text-white transition-colors",children:m.jsx("span",{className:"material-symbols-outlined",children:"close"})})]}),m.jsxs("div",{className:"p-12 space-y-12",children:[m.jsxs("section",{className:"space-y-6",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("div",{className:`size-8 rounded-full flex items-center justify-center text-[10px] font-black ${r===1?"bg-primary text-white shadow-lg shadow-primary/30":"bg-white/10 text-slate-500"}`,children:"1"}),m.jsx("h2",{className:"text-sm font-black uppercase tracking-[0.2em] text-white",children:"Identidad y Jerarqua"})]}),m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8 pl-12",children:[m.jsxs("div",{className:"space-y-1.5",children:[m.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-slate-600 ml-1",children:"Nombre del Mapa"}),m.jsx("input",{type:"text",placeholder:"ej. La Costa de Zafiro",value:c,onChange:w=>h(w.target.value),className:"w-full bg-white/5 border border-white/5 rounded-2xl px-4 py-3 text-sm text-white focus:border-primary/50 transition-all outline-none"})]}),m.jsxs("div",{className:"space-y-1.5 row-span-2",children:[m.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-slate-600 ml-1",children:"Descripcin"}),m.jsx("textarea",{placeholder:"Breve descripcin de la geografa, clima o importancia...",className:"w-full h-[120px] bg-white/5 border border-white/5 rounded-2xl p-4 text-sm text-white focus:border-primary/50 outline-none transition-all resize-none"})]}),m.jsxs("div",{className:"space-y-1.5",children:[m.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-slate-600 ml-1",children:"Zona Padre (Opcional)"}),m.jsxs("select",{className:"w-full bg-white/5 border border-white/5 rounded-2xl px-4 py-3 text-sm text-white focus:border-primary/50 outline-none appearance-none",children:[m.jsx("option",{children:"Ninguna (Nivel Superior)"}),m.jsx("option",{children:"Reino de Aethelgard"}),m.jsx("option",{children:"Continente de Aurum"})]}),m.jsx("p",{className:"text-[9px] text-slate-500 italic mt-1 ml-1 text-primary/70",children:"Seleccionar un padre convierte esto en sub-zona."})]})]})]}),m.jsx("div",{className:"h-px w-full bg-white/5"}),m.jsxs("section",{className:"space-y-6",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("div",{className:`size-8 rounded-full flex items-center justify-center text-[10px] font-black ${r===2?"bg-primary text-white shadow-lg shadow-primary/30":"bg-white/10 text-slate-500"}`,children:"2"}),m.jsx("h2",{className:"text-sm font-black uppercase tracking-[0.2em] text-white",children:"Tipo de Mapa"})]}),m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 pl-12",children:[m.jsx(S2,{active:i==="world",onClick:()=>a("world"),icon:"public",label:"Mapa Mundial",desc:"Continentes, ocanos, escala global."}),m.jsx(S2,{active:i==="regional",onClick:()=>a("regional"),icon:"map",label:"Mapa Regional",desc:"Reinos, provincias, biomas."}),m.jsx(S2,{active:i==="local",onClick:()=>a("local"),icon:"location_city",label:"Ciudad / Local",desc:"Ciudades, mazmorras, mapas de batalla."})]})]}),m.jsx("div",{className:"h-px w-full bg-white/5"}),m.jsxs("section",{className:"space-y-6",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("div",{className:`size-8 rounded-full flex items-center justify-center text-[10px] font-black ${r===3?"bg-primary text-white shadow-lg shadow-primary/30":"bg-white/10 text-slate-500"}`,children:"3"}),m.jsx("h2",{className:"text-sm font-black uppercase tracking-[0.2em] text-white",children:"Fuente del Lienzo"})]}),m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 pl-12",children:[m.jsx("input",{ref:p,type:"file",accept:"image/*",onChange:v,className:"hidden"}),m.jsx(s5,{active:s==="upload",onClick:y,icon:"cloud_upload",label:l?l.name:"Cargar Archivo de Imagen",desc:l?"Archivo seleccionado":"Arrastra y suelta o haz clic para buscar",subdesc:"JPG, PNG, WEBP  MAX 25MB"}),m.jsx(s5,{active:s==="blank",onClick:()=>o("blank"),icon:"brush",label:"Lienzo en Blanco",desc:"Crear un nuevo dibujo desde cero",subdesc:"4096 px x 4096 px"})]})]})]}),m.jsxs("footer",{className:"p-8 bg-white/[0.02] border-t border-white/5 flex justify-between items-center",children:[m.jsx("button",{onClick:t,className:"text-sm font-bold text-slate-500 hover:text-white transition-colors",children:"Cancelar"}),m.jsxs("div",{className:"flex items-center gap-6",children:[m.jsx("span",{className:"text-[9px] font-black uppercase tracking-widest text-slate-600",children:"Cambios guardados localmente"}),m.jsx(Yn,{variant:"primary",className:"px-10 py-3 shadow-xl",onClick:S,children:"Crear Mapa"})]})]})]})})})},S2=({active:t,onClick:e,icon:r,label:n,desc:i})=>m.jsxs("div",{onClick:e,className:`p-6 rounded-3xl border transition-all cursor-pointer group ${t?"bg-primary/10 border-primary shadow-lg shadow-primary/10":"bg-white/5 border-white/5 hover:border-white/10"}`,children:[m.jsx("div",{className:`size-10 rounded-xl mb-4 flex items-center justify-center transition-all ${t?"bg-primary text-white":"bg-white/5 text-slate-500 group-hover:text-slate-300"}`,children:m.jsx("span",{className:"material-symbols-outlined",children:r})}),m.jsx("h3",{className:`text-sm font-bold mb-1 transition-colors ${t?"text-white":"text-slate-400 group-hover:text-slate-200"}`,children:n}),m.jsx("p",{className:"text-[10px] text-slate-500 leading-relaxed font-medium",children:i})]}),s5=({active:t,onClick:e,icon:r,label:n,desc:i,subdesc:a})=>m.jsxs("div",{onClick:e,className:`p-10 rounded-[2.5rem] border transition-all cursor-pointer group flex flex-col items-center text-center gap-4 ${t?"bg-primary/5 border-primary shadow-lg":"bg-white/[0.02] border-white/5 hover:border-white/10 hover:bg-white/[0.04]"}`,children:[m.jsx("div",{className:`size-16 rounded-[2rem] flex items-center justify-center transition-all ${t?"bg-primary text-white shadow-xl shadow-primary/20":"bg-white/5 text-slate-600 group-hover:text-slate-400"}`,children:m.jsx("span",{className:"material-symbols-outlined text-3xl",children:r})}),m.jsxs("div",{className:"space-y-1",children:[m.jsx("h3",{className:`font-bold transition-colors ${t?"text-white":"text-slate-400"}`,children:n}),m.jsx("p",{className:"text-xs text-slate-500 font-medium",children:i})]}),m.jsx("div",{className:"flex gap-2 mt-2",children:a.split("").map((s,o)=>m.jsx("span",{className:"px-2 py-1 rounded bg-black/20 text-[8px] font-black text-slate-600 tracking-tighter uppercase whitespace-nowrap",children:s.trim()},o))})]});var Wy={exports:{}},Xm={},k2={},_2={},o5;function Tr(){return o5||(o5=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t._registerNode=t.Konva=t.glob=void 0;const e=Math.PI/180;function r(){return typeof window<"u"&&({}.toString.call(window)==="[object Window]"||{}.toString.call(window)==="[object global]")}t.glob=typeof aE<"u"?aE:typeof window<"u"?window:typeof WorkerGlobalScope<"u"?self:{},t.Konva={_global:t.glob,version:"9.3.16",isBrowser:r(),isUnminified:/param/.test((function(i){}).toString()),dblClickWindow:400,getAngle(i){return t.Konva.angleDeg?i*e:i},enableTrace:!1,pointerEventsEnabled:!0,autoDrawEnabled:!0,hitOnDragEnabled:!1,capturePointerEventsEnabled:!1,_mouseListenClick:!1,_touchListenClick:!1,_pointerListenClick:!1,_mouseInDblClickWindow:!1,_touchInDblClickWindow:!1,_pointerInDblClickWindow:!1,_mouseDblClickPointerId:null,_touchDblClickPointerId:null,_pointerDblClickPointerId:null,_fixTextRendering:!1,pixelRatio:typeof window<"u"&&window.devicePixelRatio||1,dragDistance:3,angleDeg:!0,showWarnings:!0,dragButtons:[0,1],isDragging(){return t.Konva.DD.isDragging},isTransforming(){var i;return(i=t.Konva.Transformer)===null||i===void 0?void 0:i.isTransforming()},isDragReady(){return!!t.Konva.DD.node},releaseCanvasOnDestroy:!0,document:t.glob.document,_injectGlobal(i){t.glob.Konva=i}};const n=i=>{t.Konva[i.prototype.getClassName()]=i};t._registerNode=n,t.Konva._injectGlobal(t.Konva)})(_2)),_2}var C2={},l5;function mi(){return l5||(l5=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Util=t.Transform=void 0;const e=Tr();class r{constructor(N=[1,0,0,1,0,0]){this.dirty=!1,this.m=N&&N.slice()||[1,0,0,1,0,0]}reset(){this.m[0]=1,this.m[1]=0,this.m[2]=0,this.m[3]=1,this.m[4]=0,this.m[5]=0}copy(){return new r(this.m)}copyInto(N){N.m[0]=this.m[0],N.m[1]=this.m[1],N.m[2]=this.m[2],N.m[3]=this.m[3],N.m[4]=this.m[4],N.m[5]=this.m[5]}point(N){const A=this.m;return{x:A[0]*N.x+A[2]*N.y+A[4],y:A[1]*N.x+A[3]*N.y+A[5]}}translate(N,A){return this.m[4]+=this.m[0]*N+this.m[2]*A,this.m[5]+=this.m[1]*N+this.m[3]*A,this}scale(N,A){return this.m[0]*=N,this.m[1]*=N,this.m[2]*=A,this.m[3]*=A,this}rotate(N){const A=Math.cos(N),I=Math.sin(N),j=this.m[0]*A+this.m[2]*I,O=this.m[1]*A+this.m[3]*I,F=this.m[0]*-I+this.m[2]*A,B=this.m[1]*-I+this.m[3]*A;return this.m[0]=j,this.m[1]=O,this.m[2]=F,this.m[3]=B,this}getTranslation(){return{x:this.m[4],y:this.m[5]}}skew(N,A){const I=this.m[0]+this.m[2]*A,j=this.m[1]+this.m[3]*A,O=this.m[2]+this.m[0]*N,F=this.m[3]+this.m[1]*N;return this.m[0]=I,this.m[1]=j,this.m[2]=O,this.m[3]=F,this}multiply(N){const A=this.m[0]*N.m[0]+this.m[2]*N.m[1],I=this.m[1]*N.m[0]+this.m[3]*N.m[1],j=this.m[0]*N.m[2]+this.m[2]*N.m[3],O=this.m[1]*N.m[2]+this.m[3]*N.m[3],F=this.m[0]*N.m[4]+this.m[2]*N.m[5]+this.m[4],B=this.m[1]*N.m[4]+this.m[3]*N.m[5]+this.m[5];return this.m[0]=A,this.m[1]=I,this.m[2]=j,this.m[3]=O,this.m[4]=F,this.m[5]=B,this}invert(){const N=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),A=this.m[3]*N,I=-this.m[1]*N,j=-this.m[2]*N,O=this.m[0]*N,F=N*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),B=N*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);return this.m[0]=A,this.m[1]=I,this.m[2]=j,this.m[3]=O,this.m[4]=F,this.m[5]=B,this}getMatrix(){return this.m}decompose(){const N=this.m[0],A=this.m[1],I=this.m[2],j=this.m[3],O=this.m[4],F=this.m[5],B=N*j-A*I,$={x:O,y:F,rotation:0,scaleX:0,scaleY:0,skewX:0,skewY:0};if(N!=0||A!=0){const Z=Math.sqrt(N*N+A*A);$.rotation=A>0?Math.acos(N/Z):-Math.acos(N/Z),$.scaleX=Z,$.scaleY=B/Z,$.skewX=(N*I+A*j)/B,$.skewY=0}else if(I!=0||j!=0){const Z=Math.sqrt(I*I+j*j);$.rotation=Math.PI/2-(j>0?Math.acos(-I/Z):-Math.acos(I/Z)),$.scaleX=B/Z,$.scaleY=Z,$.skewX=0,$.skewY=(N*I+A*j)/B}return $.rotation=t.Util._getRotation($.rotation),$}}t.Transform=r;let n="[object Array]",i="[object Number]",a="[object String]",s="[object Boolean]",o=Math.PI/180,l=180/Math.PI,u="#",c="",h="0",p="Konva warning: ",v="Konva error: ",y="rgb(",S={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,132,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,255,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,203],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[119,128,144],slategrey:[119,128,144],snow:[255,255,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],transparent:[255,255,255,0],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,5]},w=/rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)/,T=[];const _=typeof requestAnimationFrame<"u"&&requestAnimationFrame||function(C){setTimeout(C,60)};t.Util={_isElement(C){return!!(C&&C.nodeType==1)},_isFunction(C){return!!(C&&C.constructor&&C.call&&C.apply)},_isPlainObject(C){return!!C&&C.constructor===Object},_isArray(C){return Object.prototype.toString.call(C)===n},_isNumber(C){return Object.prototype.toString.call(C)===i&&!isNaN(C)&&isFinite(C)},_isString(C){return Object.prototype.toString.call(C)===a},_isBoolean(C){return Object.prototype.toString.call(C)===s},isObject(C){return C instanceof Object},isValidSelector(C){if(typeof C!="string")return!1;const N=C[0];return N==="#"||N==="."||N===N.toUpperCase()},_sign(C){return C===0||C>0?1:-1},requestAnimFrame(C){T.push(C),T.length===1&&_(function(){const N=T;T=[],N.forEach(function(A){A()})})},createCanvasElement(){const C=document.createElement("canvas");try{C.style=C.style||{}}catch{}return C},createImageElement(){return document.createElement("img")},_isInDocument(C){for(;C=C.parentNode;)if(C==document)return!0;return!1},_urlToImage(C,N){const A=t.Util.createImageElement();A.onload=function(){N(A)},A.src=C},_rgbToHex(C,N,A){return((1<<24)+(C<<16)+(N<<8)+A).toString(16).slice(1)},_hexToRgb(C){C=C.replace(u,c);const N=parseInt(C,16);return{r:N>>16&255,g:N>>8&255,b:N&255}},getRandomColor(){let C=(Math.random()*16777215<<0).toString(16);for(;C.length<6;)C=h+C;return u+C},getRGB(C){let N;return C in S?(N=S[C],{r:N[0],g:N[1],b:N[2]}):C[0]===u?this._hexToRgb(C.substring(1)):C.substr(0,4)===y?(N=w.exec(C.replace(/ /g,"")),{r:parseInt(N[1],10),g:parseInt(N[2],10),b:parseInt(N[3],10)}):{r:0,g:0,b:0}},colorToRGBA(C){return C=C||"black",t.Util._namedColorToRBA(C)||t.Util._hex3ColorToRGBA(C)||t.Util._hex4ColorToRGBA(C)||t.Util._hex6ColorToRGBA(C)||t.Util._hex8ColorToRGBA(C)||t.Util._rgbColorToRGBA(C)||t.Util._rgbaColorToRGBA(C)||t.Util._hslColorToRGBA(C)},_namedColorToRBA(C){const N=S[C.toLowerCase()];return N?{r:N[0],g:N[1],b:N[2],a:1}:null},_rgbColorToRGBA(C){if(C.indexOf("rgb(")===0){C=C.match(/rgb\(([^)]+)\)/)[1];const N=C.split(/ *, */).map(Number);return{r:N[0],g:N[1],b:N[2],a:1}}},_rgbaColorToRGBA(C){if(C.indexOf("rgba(")===0){C=C.match(/rgba\(([^)]+)\)/)[1];const N=C.split(/ *, */).map((A,I)=>A.slice(-1)==="%"?I===3?parseInt(A)/100:parseInt(A)/100*255:Number(A));return{r:N[0],g:N[1],b:N[2],a:N[3]}}},_hex8ColorToRGBA(C){if(C[0]==="#"&&C.length===9)return{r:parseInt(C.slice(1,3),16),g:parseInt(C.slice(3,5),16),b:parseInt(C.slice(5,7),16),a:parseInt(C.slice(7,9),16)/255}},_hex6ColorToRGBA(C){if(C[0]==="#"&&C.length===7)return{r:parseInt(C.slice(1,3),16),g:parseInt(C.slice(3,5),16),b:parseInt(C.slice(5,7),16),a:1}},_hex4ColorToRGBA(C){if(C[0]==="#"&&C.length===5)return{r:parseInt(C[1]+C[1],16),g:parseInt(C[2]+C[2],16),b:parseInt(C[3]+C[3],16),a:parseInt(C[4]+C[4],16)/255}},_hex3ColorToRGBA(C){if(C[0]==="#"&&C.length===4)return{r:parseInt(C[1]+C[1],16),g:parseInt(C[2]+C[2],16),b:parseInt(C[3]+C[3],16),a:1}},_hslColorToRGBA(C){if(/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.test(C)){const[N,...A]=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(C),I=Number(A[0])/360,j=Number(A[1])/100,O=Number(A[2])/100;let F,B,$;if(j===0)return $=O*255,{r:Math.round($),g:Math.round($),b:Math.round($),a:1};O<.5?F=O*(1+j):F=O+j-O*j;const Z=2*O-F,D=[0,0,0];for(let H=0;H<3;H++)B=I+1/3*-(H-1),B<0&&B++,B>1&&B--,6*B<1?$=Z+(F-Z)*6*B:2*B<1?$=F:3*B<2?$=Z+(F-Z)*(2/3-B)*6:$=Z,D[H]=$*255;return{r:Math.round(D[0]),g:Math.round(D[1]),b:Math.round(D[2]),a:1}}},haveIntersection(C,N){return!(N.x>C.x+C.width||N.x+N.width<C.x||N.y>C.y+C.height||N.y+N.height<C.y)},cloneObject(C){const N={};for(const A in C)this._isPlainObject(C[A])?N[A]=this.cloneObject(C[A]):this._isArray(C[A])?N[A]=this.cloneArray(C[A]):N[A]=C[A];return N},cloneArray(C){return C.slice(0)},degToRad(C){return C*o},radToDeg(C){return C*l},_degToRad(C){return t.Util.warn("Util._degToRad is removed. Please use public Util.degToRad instead."),t.Util.degToRad(C)},_radToDeg(C){return t.Util.warn("Util._radToDeg is removed. Please use public Util.radToDeg instead."),t.Util.radToDeg(C)},_getRotation(C){return e.Konva.angleDeg?t.Util.radToDeg(C):C},_capitalize(C){return C.charAt(0).toUpperCase()+C.slice(1)},throw(C){throw new Error(v+C)},error(C){console.error(v+C)},warn(C){e.Konva.showWarnings&&console.warn(p+C)},each(C,N){for(const A in C)N(A,C[A])},_inRange(C,N,A){return N<=C&&C<A},_getProjectionToSegment(C,N,A,I,j,O){let F,B,$;const Z=(C-A)*(C-A)+(N-I)*(N-I);if(Z==0)F=C,B=N,$=(j-A)*(j-A)+(O-I)*(O-I);else{const D=((j-C)*(A-C)+(O-N)*(I-N))/Z;D<0?(F=C,B=N,$=(C-j)*(C-j)+(N-O)*(N-O)):D>1?(F=A,B=I,$=(A-j)*(A-j)+(I-O)*(I-O)):(F=C+D*(A-C),B=N+D*(I-N),$=(F-j)*(F-j)+(B-O)*(B-O))}return[F,B,$]},_getProjectionToLine(C,N,A){const I=t.Util.cloneObject(C);let j=Number.MAX_VALUE;return N.forEach(function(O,F){if(!A&&F===N.length-1)return;const B=N[(F+1)%N.length],$=t.Util._getProjectionToSegment(O.x,O.y,B.x,B.y,C.x,C.y),Z=$[0],D=$[1],H=$[2];H<j&&(I.x=Z,I.y=D,j=H)}),I},_prepareArrayForTween(C,N,A){let I,j=[],O=[];if(C.length>N.length){const B=N;N=C,C=B}for(I=0;I<C.length;I+=2)j.push({x:C[I],y:C[I+1]});for(I=0;I<N.length;I+=2)O.push({x:N[I],y:N[I+1]});const F=[];return O.forEach(function(B){const $=t.Util._getProjectionToLine(B,j,A);F.push($.x),F.push($.y)}),F},_prepareToStringify(C){let N;C.visitedByCircularReferenceRemoval=!0;for(const A in C)if(C.hasOwnProperty(A)&&C[A]&&typeof C[A]=="object"){if(N=Object.getOwnPropertyDescriptor(C,A),C[A].visitedByCircularReferenceRemoval||t.Util._isElement(C[A]))if(N.configurable)delete C[A];else return null;else if(t.Util._prepareToStringify(C[A])===null)if(N.configurable)delete C[A];else return null}return delete C.visitedByCircularReferenceRemoval,C},_assign(C,N){for(const A in N)C[A]=N[A];return C},_getFirstPointerId(C){return C.touches?C.changedTouches[0].identifier:C.pointerId||999},releaseCanvas(...C){e.Konva.releaseCanvasOnDestroy&&C.forEach(N=>{N.width=0,N.height=0})},drawRoundedRectPath(C,N,A,I){let j=0,O=0,F=0,B=0;typeof I=="number"?j=O=F=B=Math.min(I,N/2,A/2):(j=Math.min(I[0]||0,N/2,A/2),O=Math.min(I[1]||0,N/2,A/2),B=Math.min(I[2]||0,N/2,A/2),F=Math.min(I[3]||0,N/2,A/2)),C.moveTo(j,0),C.lineTo(N-O,0),C.arc(N-O,O,O,Math.PI*3/2,0,!1),C.lineTo(N,A-B),C.arc(N-B,A-B,B,0,Math.PI/2,!1),C.lineTo(F,A),C.arc(F,A-F,F,Math.PI/2,Math.PI,!1),C.lineTo(0,j),C.arc(j,j,j,Math.PI,Math.PI*3/2,!1)}}})(C2)),C2}var Qm={},E2={},qs={},u5;function Ar(){if(u5)return qs;u5=1,Object.defineProperty(qs,"__esModule",{value:!0}),qs.RGBComponent=n,qs.alphaComponent=i,qs.getNumberValidator=a,qs.getNumberOrArrayOfNumbersValidator=s,qs.getNumberOrAutoValidator=o,qs.getStringValidator=l,qs.getStringOrGradientValidator=u,qs.getFunctionValidator=c,qs.getNumberArrayValidator=h,qs.getBooleanValidator=p,qs.getComponentValidator=v;const t=Tr(),e=mi();function r(y){return e.Util._isString(y)?'"'+y+'"':Object.prototype.toString.call(y)==="[object Number]"||e.Util._isBoolean(y)?y:Object.prototype.toString.call(y)}function n(y){return y>255?255:y<0?0:Math.round(y)}function i(y){return y>1?1:y<1e-4?1e-4:y}function a(){if(t.Konva.isUnminified)return function(y,S){return e.Util._isNumber(y)||e.Util.warn(r(y)+' is a not valid value for "'+S+'" attribute. The value should be a number.'),y}}function s(y){if(t.Konva.isUnminified)return function(S,w){const T=e.Util._isNumber(S),_=e.Util._isArray(S)&&S.length==y;return!T&&!_&&e.Util.warn(r(S)+' is a not valid value for "'+w+'" attribute. The value should be a number or Array<number>('+y+")"),S}}function o(){if(t.Konva.isUnminified)return function(y,S){return e.Util._isNumber(y)||y==="auto"||e.Util.warn(r(y)+' is a not valid value for "'+S+'" attribute. The value should be a number or "auto".'),y}}function l(){if(t.Konva.isUnminified)return function(y,S){return e.Util._isString(y)||e.Util.warn(r(y)+' is a not valid value for "'+S+'" attribute. The value should be a string.'),y}}function u(){if(t.Konva.isUnminified)return function(y,S){const w=e.Util._isString(y),T=Object.prototype.toString.call(y)==="[object CanvasGradient]"||y&&y.addColorStop;return w||T||e.Util.warn(r(y)+' is a not valid value for "'+S+'" attribute. The value should be a string or a native gradient.'),y}}function c(){if(t.Konva.isUnminified)return function(y,S){return e.Util._isFunction(y)||e.Util.warn(r(y)+' is a not valid value for "'+S+'" attribute. The value should be a function.'),y}}function h(){if(t.Konva.isUnminified)return function(y,S){const w=Int8Array?Object.getPrototypeOf(Int8Array):null;return w&&y instanceof w||(e.Util._isArray(y)?y.forEach(function(T){e.Util._isNumber(T)||e.Util.warn('"'+S+'" attribute has non numeric element '+T+". Make sure that all elements are numbers.")}):e.Util.warn(r(y)+' is a not valid value for "'+S+'" attribute. The value should be a array of numbers.')),y}}function p(){if(t.Konva.isUnminified)return function(y,S){return y===!0||y===!1||e.Util.warn(r(y)+' is a not valid value for "'+S+'" attribute. The value should be a boolean.'),y}}function v(y){if(t.Konva.isUnminified)return function(S,w){return S==null||e.Util.isObject(S)||e.Util.warn(r(S)+' is a not valid value for "'+w+'" attribute. The value should be an object with properties '+y),S}}return qs}var c5;function Pr(){return c5||(c5=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Factory=void 0;const e=mi(),r=Ar(),n="get",i="set";t.Factory={addGetterSetter(a,s,o,l,u){t.Factory.addGetter(a,s,o),t.Factory.addSetter(a,s,l,u),t.Factory.addOverloadedGetterSetter(a,s)},addGetter(a,s,o){const l=n+e.Util._capitalize(s);a.prototype[l]=a.prototype[l]||function(){const u=this.attrs[s];return u===void 0?o:u}},addSetter(a,s,o,l){const u=i+e.Util._capitalize(s);a.prototype[u]||t.Factory.overWriteSetter(a,s,o,l)},overWriteSetter(a,s,o,l){const u=i+e.Util._capitalize(s);a.prototype[u]=function(c){return o&&c!==void 0&&c!==null&&(c=o.call(this,c,s)),this._setAttr(s,c),l&&l.call(this),this}},addComponentsGetterSetter(a,s,o,l,u){let c=o.length,h=e.Util._capitalize,p=n+h(s),v=i+h(s),y,S;a.prototype[p]=function(){const T={};for(y=0;y<c;y++)S=o[y],T[S]=this.getAttr(s+h(S));return T};const w=(0,r.getComponentValidator)(o);a.prototype[v]=function(T){let _=this.attrs[s],C;l&&(T=l.call(this,T)),w&&w.call(this,T,s);for(C in T)T.hasOwnProperty(C)&&this._setAttr(s+h(C),T[C]);return T||o.forEach(N=>{this._setAttr(s+h(N),void 0)}),this._fireChangeEvent(s,_,T),u&&u.call(this),this},t.Factory.addOverloadedGetterSetter(a,s)},addOverloadedGetterSetter(a,s){const o=e.Util._capitalize(s),l=i+o,u=n+o;a.prototype[s]=function(){return arguments.length?(this[l](arguments[0]),this):this[u]()}},addDeprecatedGetterSetter(a,s,o,l){e.Util.error("Adding deprecated "+s);const u=n+e.Util._capitalize(s),c=s+" property is deprecated and will be removed soon. Look at Konva change log for more information.";a.prototype[u]=function(){e.Util.error(c);const h=this.attrs[s];return h===void 0?o:h},t.Factory.addSetter(a,s,l,function(){e.Util.error(c)}),t.Factory.addOverloadedGetterSetter(a,s)},backCompat(a,s){e.Util.each(s,function(o,l){const u=a.prototype[l],c=n+e.Util._capitalize(o),h=i+e.Util._capitalize(o);function p(){u.apply(this,arguments),e.Util.error('"'+o+'" method is deprecated and will be removed soon. Use ""'+l+'" instead.')}a.prototype[o]=p,a.prototype[c]=p,a.prototype[h]=p})},afterSetFilter(){this._filterUpToDate=!1}}})(E2)),E2}var rc={},nc={},d5;function SR(){if(d5)return nc;d5=1,Object.defineProperty(nc,"__esModule",{value:!0}),nc.HitContext=nc.SceneContext=nc.Context=void 0;const t=mi(),e=Tr();function r(T){let _=[],C=T.length,N=t.Util,A,I;for(A=0;A<C;A++)I=T[A],N._isNumber(I)?I=Math.round(I*1e3)/1e3:N._isString(I)||(I=I+""),_.push(I);return _}const n=",",i="(",a=")",s="([",o="])",l=";",u="()",c="=",h=["arc","arcTo","beginPath","bezierCurveTo","clearRect","clip","closePath","createLinearGradient","createPattern","createRadialGradient","drawImage","ellipse","fill","fillText","getImageData","createImageData","lineTo","moveTo","putImageData","quadraticCurveTo","rect","roundRect","restore","rotate","save","scale","setLineDash","setTransform","stroke","strokeText","transform","translate"],p=["fillStyle","strokeStyle","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","letterSpacing","lineCap","lineDashOffset","lineJoin","lineWidth","miterLimit","direction","font","textAlign","textBaseline","globalAlpha","globalCompositeOperation","imageSmoothingEnabled"],v=100;let y=class{constructor(_){this.canvas=_,e.Konva.enableTrace&&(this.traceArr=[],this._enableTrace())}fillShape(_){_.fillEnabled()&&this._fill(_)}_fill(_){}strokeShape(_){_.hasStroke()&&this._stroke(_)}_stroke(_){}fillStrokeShape(_){_.attrs.fillAfterStrokeEnabled?(this.strokeShape(_),this.fillShape(_)):(this.fillShape(_),this.strokeShape(_))}getTrace(_,C){let N=this.traceArr,A=N.length,I="",j,O,F,B;for(j=0;j<A;j++)O=N[j],F=O.method,F?(B=O.args,I+=F,_?I+=u:t.Util._isArray(B[0])?I+=s+B.join(n)+o:(C&&(B=B.map($=>typeof $=="number"?Math.floor($):$)),I+=i+B.join(n)+a)):(I+=O.property,_||(I+=c+O.val)),I+=l;return I}clearTrace(){this.traceArr=[]}_trace(_){let C=this.traceArr,N;C.push(_),N=C.length,N>=v&&C.shift()}reset(){const _=this.getCanvas().getPixelRatio();this.setTransform(1*_,0,0,1*_,0,0)}getCanvas(){return this.canvas}clear(_){const C=this.getCanvas();_?this.clearRect(_.x||0,_.y||0,_.width||0,_.height||0):this.clearRect(0,0,C.getWidth()/C.pixelRatio,C.getHeight()/C.pixelRatio)}_applyLineCap(_){const C=_.attrs.lineCap;C&&this.setAttr("lineCap",C)}_applyOpacity(_){const C=_.getAbsoluteOpacity();C!==1&&this.setAttr("globalAlpha",C)}_applyLineJoin(_){const C=_.attrs.lineJoin;C&&this.setAttr("lineJoin",C)}setAttr(_,C){this._context[_]=C}arc(_,C,N,A,I,j){this._context.arc(_,C,N,A,I,j)}arcTo(_,C,N,A,I){this._context.arcTo(_,C,N,A,I)}beginPath(){this._context.beginPath()}bezierCurveTo(_,C,N,A,I,j){this._context.bezierCurveTo(_,C,N,A,I,j)}clearRect(_,C,N,A){this._context.clearRect(_,C,N,A)}clip(..._){this._context.clip.apply(this._context,_)}closePath(){this._context.closePath()}createImageData(_,C){const N=arguments;if(N.length===2)return this._context.createImageData(_,C);if(N.length===1)return this._context.createImageData(_)}createLinearGradient(_,C,N,A){return this._context.createLinearGradient(_,C,N,A)}createPattern(_,C){return this._context.createPattern(_,C)}createRadialGradient(_,C,N,A,I,j){return this._context.createRadialGradient(_,C,N,A,I,j)}drawImage(_,C,N,A,I,j,O,F,B){const $=arguments,Z=this._context;$.length===3?Z.drawImage(_,C,N):$.length===5?Z.drawImage(_,C,N,A,I):$.length===9&&Z.drawImage(_,C,N,A,I,j,O,F,B)}ellipse(_,C,N,A,I,j,O,F){this._context.ellipse(_,C,N,A,I,j,O,F)}isPointInPath(_,C,N,A){return N?this._context.isPointInPath(N,_,C,A):this._context.isPointInPath(_,C,A)}fill(..._){this._context.fill.apply(this._context,_)}fillRect(_,C,N,A){this._context.fillRect(_,C,N,A)}strokeRect(_,C,N,A){this._context.strokeRect(_,C,N,A)}fillText(_,C,N,A){A?this._context.fillText(_,C,N,A):this._context.fillText(_,C,N)}measureText(_){return this._context.measureText(_)}getImageData(_,C,N,A){return this._context.getImageData(_,C,N,A)}lineTo(_,C){this._context.lineTo(_,C)}moveTo(_,C){this._context.moveTo(_,C)}rect(_,C,N,A){this._context.rect(_,C,N,A)}roundRect(_,C,N,A,I){this._context.roundRect(_,C,N,A,I)}putImageData(_,C,N){this._context.putImageData(_,C,N)}quadraticCurveTo(_,C,N,A){this._context.quadraticCurveTo(_,C,N,A)}restore(){this._context.restore()}rotate(_){this._context.rotate(_)}save(){this._context.save()}scale(_,C){this._context.scale(_,C)}setLineDash(_){this._context.setLineDash?this._context.setLineDash(_):"mozDash"in this._context?this._context.mozDash=_:"webkitLineDash"in this._context&&(this._context.webkitLineDash=_)}getLineDash(){return this._context.getLineDash()}setTransform(_,C,N,A,I,j){this._context.setTransform(_,C,N,A,I,j)}stroke(_){_?this._context.stroke(_):this._context.stroke()}strokeText(_,C,N,A){this._context.strokeText(_,C,N,A)}transform(_,C,N,A,I,j){this._context.transform(_,C,N,A,I,j)}translate(_,C){this._context.translate(_,C)}_enableTrace(){let _=this,C=h.length,N=this.setAttr,A,I;const j=function(O){let F=_[O],B;_[O]=function(){return I=r(Array.prototype.slice.call(arguments,0)),B=F.apply(_,arguments),_._trace({method:O,args:I}),B}};for(A=0;A<C;A++)j(h[A]);_.setAttr=function(){N.apply(_,arguments);const O=arguments[0];let F=arguments[1];(O==="shadowOffsetX"||O==="shadowOffsetY"||O==="shadowBlur")&&(F=F/this.canvas.getPixelRatio()),_._trace({property:O,val:F})}}_applyGlobalCompositeOperation(_){const C=_.attrs.globalCompositeOperation;!C||C==="source-over"||this.setAttr("globalCompositeOperation",C)}};nc.Context=y,p.forEach(function(T){Object.defineProperty(y.prototype,T,{get(){return this._context[T]},set(_){this._context[T]=_}})});class S extends y{constructor(_,{willReadFrequently:C=!1}={}){super(_),this._context=_._canvas.getContext("2d",{willReadFrequently:C})}_fillColor(_){const C=_.fill();this.setAttr("fillStyle",C),_._fillFunc(this)}_fillPattern(_){this.setAttr("fillStyle",_._getFillPattern()),_._fillFunc(this)}_fillLinearGradient(_){const C=_._getLinearGradient();C&&(this.setAttr("fillStyle",C),_._fillFunc(this))}_fillRadialGradient(_){const C=_._getRadialGradient();C&&(this.setAttr("fillStyle",C),_._fillFunc(this))}_fill(_){const C=_.fill(),N=_.getFillPriority();if(C&&N==="color"){this._fillColor(_);return}const A=_.getFillPatternImage();if(A&&N==="pattern"){this._fillPattern(_);return}const I=_.getFillLinearGradientColorStops();if(I&&N==="linear-gradient"){this._fillLinearGradient(_);return}const j=_.getFillRadialGradientColorStops();if(j&&N==="radial-gradient"){this._fillRadialGradient(_);return}C?this._fillColor(_):A?this._fillPattern(_):I?this._fillLinearGradient(_):j&&this._fillRadialGradient(_)}_strokeLinearGradient(_){const C=_.getStrokeLinearGradientStartPoint(),N=_.getStrokeLinearGradientEndPoint(),A=_.getStrokeLinearGradientColorStops(),I=this.createLinearGradient(C.x,C.y,N.x,N.y);if(A){for(let j=0;j<A.length;j+=2)I.addColorStop(A[j],A[j+1]);this.setAttr("strokeStyle",I)}}_stroke(_){const C=_.dash(),N=_.getStrokeScaleEnabled();if(_.hasStroke()){if(!N){this.save();const I=this.getCanvas().getPixelRatio();this.setTransform(I,0,0,I,0,0)}this._applyLineCap(_),C&&_.dashEnabled()&&(this.setLineDash(C),this.setAttr("lineDashOffset",_.dashOffset())),this.setAttr("lineWidth",_.strokeWidth()),_.getShadowForStrokeEnabled()||this.setAttr("shadowColor","rgba(0,0,0,0)"),_.getStrokeLinearGradientColorStops()?this._strokeLinearGradient(_):this.setAttr("strokeStyle",_.stroke()),_._strokeFunc(this),N||this.restore()}}_applyShadow(_){var C,N,A;const I=(C=_.getShadowRGBA())!==null&&C!==void 0?C:"black",j=(N=_.getShadowBlur())!==null&&N!==void 0?N:5,O=(A=_.getShadowOffset())!==null&&A!==void 0?A:{x:0,y:0},F=_.getAbsoluteScale(),B=this.canvas.getPixelRatio(),$=F.x*B,Z=F.y*B;this.setAttr("shadowColor",I),this.setAttr("shadowBlur",j*Math.min(Math.abs($),Math.abs(Z))),this.setAttr("shadowOffsetX",O.x*$),this.setAttr("shadowOffsetY",O.y*Z)}}nc.SceneContext=S;class w extends y{constructor(_){super(_),this._context=_._canvas.getContext("2d",{willReadFrequently:!0})}_fill(_){this.save(),this.setAttr("fillStyle",_.colorKey),_._fillFuncHit(this),this.restore()}strokeShape(_){_.hasHitStroke()&&this._stroke(_)}_stroke(_){if(_.hasHitStroke()){const C=_.getStrokeScaleEnabled();if(!C){this.save();const I=this.getCanvas().getPixelRatio();this.setTransform(I,0,0,I,0,0)}this._applyLineCap(_);const N=_.hitStrokeWidth(),A=N==="auto"?_.strokeWidth():N;this.setAttr("lineWidth",A),this.setAttr("strokeStyle",_.colorKey),_._strokeFuncHit(this),C||this.restore()}}}return nc.HitContext=w,nc}var h5;function F1(){if(h5)return rc;h5=1,Object.defineProperty(rc,"__esModule",{value:!0}),rc.HitCanvas=rc.SceneCanvas=rc.Canvas=void 0;const t=mi(),e=SR(),r=Tr(),n=Pr(),i=Ar();let a;function s(){if(a)return a;const c=t.Util.createCanvasElement(),h=c.getContext("2d");return a=(function(){const p=r.Konva._global.devicePixelRatio||1,v=h.webkitBackingStorePixelRatio||h.mozBackingStorePixelRatio||h.msBackingStorePixelRatio||h.oBackingStorePixelRatio||h.backingStorePixelRatio||1;return p/v})(),t.Util.releaseCanvas(c),a}let o=class{constructor(h){this.pixelRatio=1,this.width=0,this.height=0,this.isCache=!1;const v=(h||{}).pixelRatio||r.Konva.pixelRatio||s();this.pixelRatio=v,this._canvas=t.Util.createCanvasElement(),this._canvas.style.padding="0",this._canvas.style.margin="0",this._canvas.style.border="0",this._canvas.style.background="transparent",this._canvas.style.position="absolute",this._canvas.style.top="0",this._canvas.style.left="0"}getContext(){return this.context}getPixelRatio(){return this.pixelRatio}setPixelRatio(h){const p=this.pixelRatio;this.pixelRatio=h,this.setSize(this.getWidth()/p,this.getHeight()/p)}setWidth(h){this.width=this._canvas.width=h*this.pixelRatio,this._canvas.style.width=h+"px";const p=this.pixelRatio;this.getContext()._context.scale(p,p)}setHeight(h){this.height=this._canvas.height=h*this.pixelRatio,this._canvas.style.height=h+"px";const p=this.pixelRatio;this.getContext()._context.scale(p,p)}getWidth(){return this.width}getHeight(){return this.height}setSize(h,p){this.setWidth(h||0),this.setHeight(p||0)}toDataURL(h,p){try{return this._canvas.toDataURL(h,p)}catch{try{return this._canvas.toDataURL()}catch(y){return t.Util.error("Unable to get data URL. "+y.message+" For more info read https://konvajs.org/docs/posts/Tainted_Canvas.html."),""}}}};rc.Canvas=o,n.Factory.addGetterSetter(o,"pixelRatio",void 0,(0,i.getNumberValidator)());class l extends o{constructor(h={width:0,height:0,willReadFrequently:!1}){super(h),this.context=new e.SceneContext(this,{willReadFrequently:h.willReadFrequently}),this.setSize(h.width,h.height)}}rc.SceneCanvas=l;class u extends o{constructor(h={width:0,height:0}){super(h),this.hitCanvas=!0,this.context=new e.HitContext(this),this.setSize(h.width,h.height)}}return rc.HitCanvas=u,rc}var T2={},f5;function w_(){return f5||(f5=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.DD=void 0;const e=Tr(),r=mi();t.DD={get isDragging(){let n=!1;return t.DD._dragElements.forEach(i=>{i.dragStatus==="dragging"&&(n=!0)}),n},justDragged:!1,get node(){let n;return t.DD._dragElements.forEach(i=>{n=i.node}),n},_dragElements:new Map,_drag(n){const i=[];t.DD._dragElements.forEach((a,s)=>{const{node:o}=a,l=o.getStage();l.setPointersPositions(n),a.pointerId===void 0&&(a.pointerId=r.Util._getFirstPointerId(n));const u=l._changedPointerPositions.find(c=>c.id===a.pointerId);if(u){if(a.dragStatus!=="dragging"){const c=o.dragDistance();if(Math.max(Math.abs(u.x-a.startPointerPos.x),Math.abs(u.y-a.startPointerPos.y))<c||(o.startDrag({evt:n}),!o.isDragging()))return}o._setDragPosition(n,a),i.push(o)}}),i.forEach(a=>{a.fire("dragmove",{type:"dragmove",target:a,evt:n},!0)})},_endDragBefore(n){const i=[];t.DD._dragElements.forEach(a=>{const{node:s}=a,o=s.getStage();if(n&&o.setPointersPositions(n),!o._changedPointerPositions.find(c=>c.id===a.pointerId))return;(a.dragStatus==="dragging"||a.dragStatus==="stopped")&&(t.DD.justDragged=!0,e.Konva._mouseListenClick=!1,e.Konva._touchListenClick=!1,e.Konva._pointerListenClick=!1,a.dragStatus="stopped");const u=a.node.getLayer()||a.node instanceof e.Konva.Stage&&a.node;u&&i.indexOf(u)===-1&&i.push(u)}),i.forEach(a=>{a.draw()})},_endDragAfter(n){t.DD._dragElements.forEach((i,a)=>{i.dragStatus==="stopped"&&i.node.fire("dragend",{type:"dragend",target:i.node,evt:n},!0),i.dragStatus!=="dragging"&&t.DD._dragElements.delete(a)})}},e.Konva.isBrowser&&(window.addEventListener("mouseup",t.DD._endDragBefore,!0),window.addEventListener("touchend",t.DD._endDragBefore,!0),window.addEventListener("touchcancel",t.DD._endDragBefore,!0),window.addEventListener("mousemove",t.DD._drag),window.addEventListener("touchmove",t.DD._drag),window.addEventListener("mouseup",t.DD._endDragAfter,!1),window.addEventListener("touchend",t.DD._endDragAfter,!1),window.addEventListener("touchcancel",t.DD._endDragAfter,!1))})(T2)),T2}var p5;function Ti(){if(p5)return Qm;p5=1,Object.defineProperty(Qm,"__esModule",{value:!0}),Qm.Node=void 0;const t=mi(),e=Pr(),r=F1(),n=Tr(),i=w_(),a=Ar(),s="absoluteOpacity",o="allEventListeners",l="absoluteTransform",u="absoluteScale",c="canvas",h="Change",p="children",v="konva",y="listening",S="mouseenter",w="mouseleave",T="set",_="Shape",C=" ",N="stage",A="transform",I="Stage",j="visible",O=["xChange.konva","yChange.konva","scaleXChange.konva","scaleYChange.konva","skewXChange.konva","skewYChange.konva","rotationChange.konva","offsetXChange.konva","offsetYChange.konva","transformsEnabledChange.konva"].join(C);let F=1;class B{constructor(D){this._id=F++,this.eventListeners={},this.attrs={},this.index=0,this._allEventListeners=null,this.parent=null,this._cache=new Map,this._attachedDepsListeners=new Map,this._lastPos=null,this._batchingTransformChange=!1,this._needClearTransformCache=!1,this._filterUpToDate=!1,this._isUnderCache=!1,this._dragEventId=null,this._shouldFireChangeEvents=!1,this.setAttrs(D),this._shouldFireChangeEvents=!0}hasChildren(){return!1}_clearCache(D){(D===A||D===l)&&this._cache.get(D)?this._cache.get(D).dirty=!0:D?this._cache.delete(D):this._cache.clear()}_getCache(D,H){let U=this._cache.get(D);return(U===void 0||(D===A||D===l)&&U.dirty===!0)&&(U=H.call(this),this._cache.set(D,U)),U}_calculate(D,H,U){if(!this._attachedDepsListeners.get(D)){const W=H.map(Y=>Y+"Change.konva").join(C);this.on(W,()=>{this._clearCache(D)}),this._attachedDepsListeners.set(D,!0)}return this._getCache(D,U)}_getCanvasCache(){return this._cache.get(c)}_clearSelfAndDescendantCache(D){this._clearCache(D),D===l&&this.fire("absoluteTransformChange")}clearCache(){if(this._cache.has(c)){const{scene:D,filter:H,hit:U}=this._cache.get(c);t.Util.releaseCanvas(D,H,U),this._cache.delete(c)}return this._clearSelfAndDescendantCache(),this._requestDraw(),this}cache(D){const H=D||{};let U={};(H.x===void 0||H.y===void 0||H.width===void 0||H.height===void 0)&&(U=this.getClientRect({skipTransform:!0,relativeTo:this.getParent()||void 0}));let W=Math.ceil(H.width||U.width),Y=Math.ceil(H.height||U.height),Q=H.pixelRatio,ne=H.x===void 0?Math.floor(U.x):H.x,re=H.y===void 0?Math.floor(U.y):H.y,q=H.offset||0,te=H.drawBorder||!1,ae=H.hitCanvasPixelRatio||1;if(!W||!Y){t.Util.error("Can not cache the node. Width or height of the node equals 0. Caching is skipped.");return}const de=Math.abs(Math.round(U.x)-ne)>.5?1:0,ge=Math.abs(Math.round(U.y)-re)>.5?1:0;W+=q*2+de,Y+=q*2+ge,ne-=q,re-=q;const ye=new r.SceneCanvas({pixelRatio:Q,width:W,height:Y}),se=new r.SceneCanvas({pixelRatio:Q,width:0,height:0,willReadFrequently:!0}),fe=new r.HitCanvas({pixelRatio:ae,width:W,height:Y}),le=ye.getContext(),pe=fe.getContext();return fe.isCache=!0,ye.isCache=!0,this._cache.delete(c),this._filterUpToDate=!1,H.imageSmoothingEnabled===!1&&(ye.getContext()._context.imageSmoothingEnabled=!1,se.getContext()._context.imageSmoothingEnabled=!1),le.save(),pe.save(),le.translate(-ne,-re),pe.translate(-ne,-re),this._isUnderCache=!0,this._clearSelfAndDescendantCache(s),this._clearSelfAndDescendantCache(u),this.drawScene(ye,this),this.drawHit(fe,this),this._isUnderCache=!1,le.restore(),pe.restore(),te&&(le.save(),le.beginPath(),le.rect(0,0,W,Y),le.closePath(),le.setAttr("strokeStyle","red"),le.setAttr("lineWidth",5),le.stroke(),le.restore()),this._cache.set(c,{scene:ye,filter:se,hit:fe,x:ne,y:re}),this._requestDraw(),this}isCached(){return this._cache.has(c)}getClientRect(D){throw new Error('abstract "getClientRect" method call')}_transformedRect(D,H){const U=[{x:D.x,y:D.y},{x:D.x+D.width,y:D.y},{x:D.x+D.width,y:D.y+D.height},{x:D.x,y:D.y+D.height}];let W=1/0,Y=1/0,Q=-1/0,ne=-1/0;const re=this.getAbsoluteTransform(H);return U.forEach(function(q){const te=re.point(q);W===void 0&&(W=Q=te.x,Y=ne=te.y),W=Math.min(W,te.x),Y=Math.min(Y,te.y),Q=Math.max(Q,te.x),ne=Math.max(ne,te.y)}),{x:W,y:Y,width:Q-W,height:ne-Y}}_drawCachedSceneCanvas(D){D.save(),D._applyOpacity(this),D._applyGlobalCompositeOperation(this);const H=this._getCanvasCache();D.translate(H.x,H.y);const U=this._getCachedSceneCanvas(),W=U.pixelRatio;D.drawImage(U._canvas,0,0,U.width/W,U.height/W),D.restore()}_drawCachedHitCanvas(D){const H=this._getCanvasCache(),U=H.hit;D.save(),D.translate(H.x,H.y),D.drawImage(U._canvas,0,0,U.width/U.pixelRatio,U.height/U.pixelRatio),D.restore()}_getCachedSceneCanvas(){let D=this.filters(),H=this._getCanvasCache(),U=H.scene,W=H.filter,Y=W.getContext(),Q,ne,re,q;if(D){if(!this._filterUpToDate){const te=U.pixelRatio;W.setSize(U.width/U.pixelRatio,U.height/U.pixelRatio);try{for(Q=D.length,Y.clear(),Y.drawImage(U._canvas,0,0,U.getWidth()/te,U.getHeight()/te),ne=Y.getImageData(0,0,W.getWidth(),W.getHeight()),re=0;re<Q;re++){if(q=D[re],typeof q!="function"){t.Util.error("Filter should be type of function, but got "+typeof q+" instead. Please check correct filters");continue}q.call(this,ne),Y.putImageData(ne,0,0)}}catch(ae){t.Util.error("Unable to apply filter. "+ae.message+" This post my help you https://konvajs.org/docs/posts/Tainted_Canvas.html.")}this._filterUpToDate=!0}return W}return U}on(D,H){if(this._cache&&this._cache.delete(o),arguments.length===3)return this._delegate.apply(this,arguments);let U=D.split(C),W=U.length,Y,Q,ne,re,q;for(Y=0;Y<W;Y++)Q=U[Y],ne=Q.split("."),re=ne[0],q=ne[1]||"",this.eventListeners[re]||(this.eventListeners[re]=[]),this.eventListeners[re].push({name:q,handler:H});return this}off(D,H){let U=(D||"").split(C),W=U.length,Y,Q,ne,re,q,te;if(this._cache&&this._cache.delete(o),!D)for(Q in this.eventListeners)this._off(Q);for(Y=0;Y<W;Y++)if(ne=U[Y],re=ne.split("."),q=re[0],te=re[1],q)this.eventListeners[q]&&this._off(q,te,H);else for(Q in this.eventListeners)this._off(Q,te,H);return this}dispatchEvent(D){const H={target:this,type:D.type,evt:D};return this.fire(D.type,H),this}addEventListener(D,H){return this.on(D,function(U){H.call(this,U.evt)}),this}removeEventListener(D){return this.off(D),this}_delegate(D,H,U){const W=this;this.on(D,function(Y){const Q=Y.target.findAncestors(H,!0,W);for(let ne=0;ne<Q.length;ne++)Y=t.Util.cloneObject(Y),Y.currentTarget=Q[ne],U.call(Q[ne],Y)})}remove(){return this.isDragging()&&this.stopDrag(),i.DD._dragElements.delete(this._id),this._remove(),this}_clearCaches(){this._clearSelfAndDescendantCache(l),this._clearSelfAndDescendantCache(s),this._clearSelfAndDescendantCache(u),this._clearSelfAndDescendantCache(N),this._clearSelfAndDescendantCache(j),this._clearSelfAndDescendantCache(y)}_remove(){this._clearCaches();const D=this.getParent();D&&D.children&&(D.children.splice(this.index,1),D._setChildrenIndices(),this.parent=null)}destroy(){return this.remove(),this.clearCache(),this}getAttr(D){const H="get"+t.Util._capitalize(D);return t.Util._isFunction(this[H])?this[H]():this.attrs[D]}getAncestors(){let D=this.getParent(),H=[];for(;D;)H.push(D),D=D.getParent();return H}getAttrs(){return this.attrs||{}}setAttrs(D){return this._batchTransformChanges(()=>{let H,U;if(!D)return this;for(H in D)H!==p&&(U=T+t.Util._capitalize(H),t.Util._isFunction(this[U])?this[U](D[H]):this._setAttr(H,D[H]))}),this}isListening(){return this._getCache(y,this._isListening)}_isListening(D){if(!this.listening())return!1;const U=this.getParent();return U&&U!==D&&this!==D?U._isListening(D):!0}isVisible(){return this._getCache(j,this._isVisible)}_isVisible(D){if(!this.visible())return!1;const U=this.getParent();return U&&U!==D&&this!==D?U._isVisible(D):!0}shouldDrawHit(D,H=!1){if(D)return this._isVisible(D)&&this._isListening(D);const U=this.getLayer();let W=!1;i.DD._dragElements.forEach(Q=>{Q.dragStatus==="dragging"&&(Q.node.nodeType==="Stage"||Q.node.getLayer()===U)&&(W=!0)});const Y=!H&&!n.Konva.hitOnDragEnabled&&(W||n.Konva.isTransforming());return this.isListening()&&this.isVisible()&&!Y}show(){return this.visible(!0),this}hide(){return this.visible(!1),this}getZIndex(){return this.index||0}getAbsoluteZIndex(){let D=this.getDepth(),H=this,U=0,W,Y,Q,ne;function re(te){for(W=[],Y=te.length,Q=0;Q<Y;Q++)ne=te[Q],U++,ne.nodeType!==_&&(W=W.concat(ne.getChildren().slice())),ne._id===H._id&&(Q=Y);W.length>0&&W[0].getDepth()<=D&&re(W)}const q=this.getStage();return H.nodeType!==I&&q&&re(q.getChildren()),U}getDepth(){let D=0,H=this.parent;for(;H;)D++,H=H.parent;return D}_batchTransformChanges(D){this._batchingTransformChange=!0,D(),this._batchingTransformChange=!1,this._needClearTransformCache&&(this._clearCache(A),this._clearSelfAndDescendantCache(l)),this._needClearTransformCache=!1}setPosition(D){return this._batchTransformChanges(()=>{this.x(D.x),this.y(D.y)}),this}getPosition(){return{x:this.x(),y:this.y()}}getRelativePointerPosition(){const D=this.getStage();if(!D)return null;const H=D.getPointerPosition();if(!H)return null;const U=this.getAbsoluteTransform().copy();return U.invert(),U.point(H)}getAbsolutePosition(D){let H=!1,U=this.parent;for(;U;){if(U.isCached()){H=!0;break}U=U.parent}H&&!D&&(D=!0);const W=this.getAbsoluteTransform(D).getMatrix(),Y=new t.Transform,Q=this.offset();return Y.m=W.slice(),Y.translate(Q.x,Q.y),Y.getTranslation()}setAbsolutePosition(D){const{x:H,y:U,...W}=this._clearTransform();this.attrs.x=H,this.attrs.y=U,this._clearCache(A);const Y=this._getAbsoluteTransform().copy();return Y.invert(),Y.translate(D.x,D.y),D={x:this.attrs.x+Y.getTranslation().x,y:this.attrs.y+Y.getTranslation().y},this._setTransform(W),this.setPosition({x:D.x,y:D.y}),this._clearCache(A),this._clearSelfAndDescendantCache(l),this}_setTransform(D){let H;for(H in D)this.attrs[H]=D[H]}_clearTransform(){const D={x:this.x(),y:this.y(),rotation:this.rotation(),scaleX:this.scaleX(),scaleY:this.scaleY(),offsetX:this.offsetX(),offsetY:this.offsetY(),skewX:this.skewX(),skewY:this.skewY()};return this.attrs.x=0,this.attrs.y=0,this.attrs.rotation=0,this.attrs.scaleX=1,this.attrs.scaleY=1,this.attrs.offsetX=0,this.attrs.offsetY=0,this.attrs.skewX=0,this.attrs.skewY=0,D}move(D){let H=D.x,U=D.y,W=this.x(),Y=this.y();return H!==void 0&&(W+=H),U!==void 0&&(Y+=U),this.setPosition({x:W,y:Y}),this}_eachAncestorReverse(D,H){let U=[],W=this.getParent(),Y,Q;if(!(H&&H._id===this._id)){for(U.unshift(this);W&&(!H||W._id!==H._id);)U.unshift(W),W=W.parent;for(Y=U.length,Q=0;Q<Y;Q++)D(U[Q])}}rotate(D){return this.rotation(this.rotation()+D),this}moveToTop(){if(!this.parent)return t.Util.warn("Node has no parent. moveToTop function is ignored."),!1;const D=this.index,H=this.parent.getChildren().length;return D<H-1?(this.parent.children.splice(D,1),this.parent.children.push(this),this.parent._setChildrenIndices(),!0):!1}moveUp(){if(!this.parent)return t.Util.warn("Node has no parent. moveUp function is ignored."),!1;const D=this.index,H=this.parent.getChildren().length;return D<H-1?(this.parent.children.splice(D,1),this.parent.children.splice(D+1,0,this),this.parent._setChildrenIndices(),!0):!1}moveDown(){if(!this.parent)return t.Util.warn("Node has no parent. moveDown function is ignored."),!1;const D=this.index;return D>0?(this.parent.children.splice(D,1),this.parent.children.splice(D-1,0,this),this.parent._setChildrenIndices(),!0):!1}moveToBottom(){if(!this.parent)return t.Util.warn("Node has no parent. moveToBottom function is ignored."),!1;const D=this.index;return D>0?(this.parent.children.splice(D,1),this.parent.children.unshift(this),this.parent._setChildrenIndices(),!0):!1}setZIndex(D){if(!this.parent)return t.Util.warn("Node has no parent. zIndex parameter is ignored."),this;(D<0||D>=this.parent.children.length)&&t.Util.warn("Unexpected value "+D+" for zIndex property. zIndex is just index of a node in children of its parent. Expected value is from 0 to "+(this.parent.children.length-1)+".");const H=this.index;return this.parent.children.splice(H,1),this.parent.children.splice(D,0,this),this.parent._setChildrenIndices(),this}getAbsoluteOpacity(){return this._getCache(s,this._getAbsoluteOpacity)}_getAbsoluteOpacity(){let D=this.opacity();const H=this.getParent();return H&&!H._isUnderCache&&(D*=H.getAbsoluteOpacity()),D}moveTo(D){return this.getParent()!==D&&(this._remove(),D.add(this)),this}toObject(){let D=this.getAttrs(),H,U,W,Y,Q;const ne={attrs:{},className:this.getClassName()};for(H in D)U=D[H],Q=t.Util.isObject(U)&&!t.Util._isPlainObject(U)&&!t.Util._isArray(U),!Q&&(W=typeof this[H]=="function"&&this[H],delete D[H],Y=W?W.call(this):null,D[H]=U,Y!==U&&(ne.attrs[H]=U));return t.Util._prepareToStringify(ne)}toJSON(){return JSON.stringify(this.toObject())}getParent(){return this.parent}findAncestors(D,H,U){const W=[];H&&this._isMatch(D)&&W.push(this);let Y=this.parent;for(;Y;){if(Y===U)return W;Y._isMatch(D)&&W.push(Y),Y=Y.parent}return W}isAncestorOf(D){return!1}findAncestor(D,H,U){return this.findAncestors(D,H,U)[0]}_isMatch(D){if(!D)return!1;if(typeof D=="function")return D(this);let H=D.replace(/ /g,"").split(","),U=H.length,W,Y;for(W=0;W<U;W++)if(Y=H[W],t.Util.isValidSelector(Y)||(t.Util.warn('Selector "'+Y+'" is invalid. Allowed selectors examples are "#foo", ".bar" or "Group".'),t.Util.warn('If you have a custom shape with such className, please change it to start with upper letter like "Triangle".'),t.Util.warn("Konva is awesome, right?")),Y.charAt(0)==="#"){if(this.id()===Y.slice(1))return!0}else if(Y.charAt(0)==="."){if(this.hasName(Y.slice(1)))return!0}else if(this.className===Y||this.nodeType===Y)return!0;return!1}getLayer(){const D=this.getParent();return D?D.getLayer():null}getStage(){return this._getCache(N,this._getStage)}_getStage(){const D=this.getParent();return D?D.getStage():null}fire(D,H={},U){return H.target=H.target||this,U?this._fireAndBubble(D,H):this._fire(D,H),this}getAbsoluteTransform(D){return D?this._getAbsoluteTransform(D):this._getCache(l,this._getAbsoluteTransform)}_getAbsoluteTransform(D){let H;if(D)return H=new t.Transform,this._eachAncestorReverse(function(U){const W=U.transformsEnabled();W==="all"?H.multiply(U.getTransform()):W==="position"&&H.translate(U.x()-U.offsetX(),U.y()-U.offsetY())},D),H;{H=this._cache.get(l)||new t.Transform,this.parent?this.parent.getAbsoluteTransform().copyInto(H):H.reset();const U=this.transformsEnabled();if(U==="all")H.multiply(this.getTransform());else if(U==="position"){const W=this.attrs.x||0,Y=this.attrs.y||0,Q=this.attrs.offsetX||0,ne=this.attrs.offsetY||0;H.translate(W-Q,Y-ne)}return H.dirty=!1,H}}getAbsoluteScale(D){let H=this;for(;H;)H._isUnderCache&&(D=H),H=H.getParent();const W=this.getAbsoluteTransform(D).decompose();return{x:W.scaleX,y:W.scaleY}}getAbsoluteRotation(){return this.getAbsoluteTransform().decompose().rotation}getTransform(){return this._getCache(A,this._getTransform)}_getTransform(){var D,H;const U=this._cache.get(A)||new t.Transform;U.reset();const W=this.x(),Y=this.y(),Q=n.Konva.getAngle(this.rotation()),ne=(D=this.attrs.scaleX)!==null&&D!==void 0?D:1,re=(H=this.attrs.scaleY)!==null&&H!==void 0?H:1,q=this.attrs.skewX||0,te=this.attrs.skewY||0,ae=this.attrs.offsetX||0,de=this.attrs.offsetY||0;return(W!==0||Y!==0)&&U.translate(W,Y),Q!==0&&U.rotate(Q),(q!==0||te!==0)&&U.skew(q,te),(ne!==1||re!==1)&&U.scale(ne,re),(ae!==0||de!==0)&&U.translate(-1*ae,-1*de),U.dirty=!1,U}clone(D){let H=t.Util.cloneObject(this.attrs),U,W,Y,Q,ne;for(U in D)H[U]=D[U];const re=new this.constructor(H);for(U in this.eventListeners)for(W=this.eventListeners[U],Y=W.length,Q=0;Q<Y;Q++)ne=W[Q],ne.name.indexOf(v)<0&&(re.eventListeners[U]||(re.eventListeners[U]=[]),re.eventListeners[U].push(ne));return re}_toKonvaCanvas(D){D=D||{};const H=this.getClientRect(),U=this.getStage(),W=D.x!==void 0?D.x:Math.floor(H.x),Y=D.y!==void 0?D.y:Math.floor(H.y),Q=D.pixelRatio||1,ne=new r.SceneCanvas({width:D.width||Math.ceil(H.width)||(U?U.width():0),height:D.height||Math.ceil(H.height)||(U?U.height():0),pixelRatio:Q}),re=ne.getContext(),q=new r.SceneCanvas({width:ne.width/ne.pixelRatio+Math.abs(W),height:ne.height/ne.pixelRatio+Math.abs(Y),pixelRatio:ne.pixelRatio});return D.imageSmoothingEnabled===!1&&(re._context.imageSmoothingEnabled=!1),re.save(),(W||Y)&&re.translate(-1*W,-1*Y),this.drawScene(ne,void 0,q),re.restore(),ne}toCanvas(D){return this._toKonvaCanvas(D)._canvas}toDataURL(D){D=D||{};const H=D.mimeType||null,U=D.quality||null,W=this._toKonvaCanvas(D).toDataURL(H,U);return D.callback&&D.callback(W),W}toImage(D){return new Promise((H,U)=>{try{const W=D?.callback;W&&delete D.callback,t.Util._urlToImage(this.toDataURL(D),function(Y){H(Y),W?.(Y)})}catch(W){U(W)}})}toBlob(D){return new Promise((H,U)=>{try{const W=D?.callback;W&&delete D.callback,this.toCanvas(D).toBlob(Y=>{H(Y),W?.(Y)},D?.mimeType,D?.quality)}catch(W){U(W)}})}setSize(D){return this.width(D.width),this.height(D.height),this}getSize(){return{width:this.width(),height:this.height()}}getClassName(){return this.className||this.nodeType}getType(){return this.nodeType}getDragDistance(){return this.attrs.dragDistance!==void 0?this.attrs.dragDistance:this.parent?this.parent.getDragDistance():n.Konva.dragDistance}_off(D,H,U){let W=this.eventListeners[D],Y,Q,ne;for(Y=0;Y<W.length;Y++)if(Q=W[Y].name,ne=W[Y].handler,(Q!=="konva"||H==="konva")&&(!H||Q===H)&&(!U||U===ne)){if(W.splice(Y,1),W.length===0){delete this.eventListeners[D];break}Y--}}_fireChangeEvent(D,H,U){this._fire(D+h,{oldVal:H,newVal:U})}addName(D){if(!this.hasName(D)){const H=this.name(),U=H?H+" "+D:D;this.name(U)}return this}hasName(D){if(!D)return!1;const H=this.name();return H?(H||"").split(/\s/g).indexOf(D)!==-1:!1}removeName(D){const H=(this.name()||"").split(/\s/g),U=H.indexOf(D);return U!==-1&&(H.splice(U,1),this.name(H.join(" "))),this}setAttr(D,H){const U=this[T+t.Util._capitalize(D)];return t.Util._isFunction(U)?U.call(this,H):this._setAttr(D,H),this}_requestDraw(){if(n.Konva.autoDrawEnabled){const D=this.getLayer()||this.getStage();D?.batchDraw()}}_setAttr(D,H){const U=this.attrs[D];U===H&&!t.Util.isObject(H)||(H==null?delete this.attrs[D]:this.attrs[D]=H,this._shouldFireChangeEvents&&this._fireChangeEvent(D,U,H),this._requestDraw())}_setComponentAttr(D,H,U){let W;U!==void 0&&(W=this.attrs[D],W||(this.attrs[D]=this.getAttr(D)),this.attrs[D][H]=U,this._fireChangeEvent(D,W,U))}_fireAndBubble(D,H,U){if(H&&this.nodeType===_&&(H.target=this),!((D===S||D===w)&&(U&&(this===U||this.isAncestorOf&&this.isAncestorOf(U))||this.nodeType==="Stage"&&!U))){this._fire(D,H);const Y=(D===S||D===w)&&U&&U.isAncestorOf&&U.isAncestorOf(this)&&!U.isAncestorOf(this.parent);(H&&!H.cancelBubble||!H)&&this.parent&&this.parent.isListening()&&!Y&&(U&&U.parent?this._fireAndBubble.call(this.parent,D,H,U):this._fireAndBubble.call(this.parent,D,H))}}_getProtoListeners(D){var H,U,W;const Y=(H=this._cache.get(o))!==null&&H!==void 0?H:{};let Q=Y?.[D];if(Q===void 0){Q=[];let ne=Object.getPrototypeOf(this);for(;ne;){const re=(W=(U=ne.eventListeners)===null||U===void 0?void 0:U[D])!==null&&W!==void 0?W:[];Q.push(...re),ne=Object.getPrototypeOf(ne)}Y[D]=Q,this._cache.set(o,Y)}return Q}_fire(D,H){H=H||{},H.currentTarget=this,H.type=D;const U=this._getProtoListeners(D);if(U)for(var W=0;W<U.length;W++)U[W].handler.call(this,H);const Y=this.eventListeners[D];if(Y)for(var W=0;W<Y.length;W++)Y[W].handler.call(this,H)}draw(){return this.drawScene(),this.drawHit(),this}_createDragElement(D){const H=D?D.pointerId:void 0,U=this.getStage(),W=this.getAbsolutePosition();if(!U)return;const Y=U._getPointerById(H)||U._changedPointerPositions[0]||W;i.DD._dragElements.set(this._id,{node:this,startPointerPos:Y,offset:{x:Y.x-W.x,y:Y.y-W.y},dragStatus:"ready",pointerId:H})}startDrag(D,H=!0){i.DD._dragElements.has(this._id)||this._createDragElement(D);const U=i.DD._dragElements.get(this._id);U.dragStatus="dragging",this.fire("dragstart",{type:"dragstart",target:this,evt:D&&D.evt},H)}_setDragPosition(D,H){const U=this.getStage()._getPointerById(H.pointerId);if(!U)return;let W={x:U.x-H.offset.x,y:U.y-H.offset.y};const Y=this.dragBoundFunc();if(Y!==void 0){const Q=Y.call(this,W,D);Q?W=Q:t.Util.warn("dragBoundFunc did not return any value. That is unexpected behavior. You must return new absolute position from dragBoundFunc.")}(!this._lastPos||this._lastPos.x!==W.x||this._lastPos.y!==W.y)&&(this.setAbsolutePosition(W),this._requestDraw()),this._lastPos=W}stopDrag(D){const H=i.DD._dragElements.get(this._id);H&&(H.dragStatus="stopped"),i.DD._endDragBefore(D),i.DD._endDragAfter(D)}setDraggable(D){this._setAttr("draggable",D),this._dragChange()}isDragging(){const D=i.DD._dragElements.get(this._id);return D?D.dragStatus==="dragging":!1}_listenDrag(){this._dragCleanup(),this.on("mousedown.konva touchstart.konva",function(D){if(!(!(D.evt.button!==void 0)||n.Konva.dragButtons.indexOf(D.evt.button)>=0)||this.isDragging())return;let W=!1;i.DD._dragElements.forEach(Y=>{this.isAncestorOf(Y.node)&&(W=!0)}),W||this._createDragElement(D)})}_dragChange(){if(this.attrs.draggable)this._listenDrag();else{if(this._dragCleanup(),!this.getStage())return;const H=i.DD._dragElements.get(this._id),U=H&&H.dragStatus==="dragging",W=H&&H.dragStatus==="ready";U?this.stopDrag():W&&i.DD._dragElements.delete(this._id)}}_dragCleanup(){this.off("mousedown.konva"),this.off("touchstart.konva")}isClientRectOnScreen(D={x:0,y:0}){const H=this.getStage();if(!H)return!1;const U={x:-D.x,y:-D.y,width:H.width()+2*D.x,height:H.height()+2*D.y};return t.Util.haveIntersection(U,this.getClientRect())}static create(D,H){return t.Util._isString(D)&&(D=JSON.parse(D)),this._createNode(D,H)}static _createNode(D,H){let U=B.prototype.getClassName.call(D),W=D.children,Y,Q,ne;H&&(D.attrs.container=H),n.Konva[U]||(t.Util.warn('Can not find a node with class name "'+U+'". Fallback to "Shape".'),U="Shape");const re=n.Konva[U];if(Y=new re(D.attrs),W)for(Q=W.length,ne=0;ne<Q;ne++)Y.add(B._createNode(W[ne]));return Y}}Qm.Node=B,B.prototype.nodeType="Node",B.prototype._attrsAffectingSize=[],B.prototype.eventListeners={},B.prototype.on.call(B.prototype,O,function(){if(this._batchingTransformChange){this._needClearTransformCache=!0;return}this._clearCache(A),this._clearSelfAndDescendantCache(l)}),B.prototype.on.call(B.prototype,"visibleChange.konva",function(){this._clearSelfAndDescendantCache(j)}),B.prototype.on.call(B.prototype,"listeningChange.konva",function(){this._clearSelfAndDescendantCache(y)}),B.prototype.on.call(B.prototype,"opacityChange.konva",function(){this._clearSelfAndDescendantCache(s)});const $=e.Factory.addGetterSetter;return $(B,"zIndex"),$(B,"absolutePosition"),$(B,"position"),$(B,"x",0,(0,a.getNumberValidator)()),$(B,"y",0,(0,a.getNumberValidator)()),$(B,"globalCompositeOperation","source-over",(0,a.getStringValidator)()),$(B,"opacity",1,(0,a.getNumberValidator)()),$(B,"name","",(0,a.getStringValidator)()),$(B,"id","",(0,a.getStringValidator)()),$(B,"rotation",0,(0,a.getNumberValidator)()),e.Factory.addComponentsGetterSetter(B,"scale",["x","y"]),$(B,"scaleX",1,(0,a.getNumberValidator)()),$(B,"scaleY",1,(0,a.getNumberValidator)()),e.Factory.addComponentsGetterSetter(B,"skew",["x","y"]),$(B,"skewX",0,(0,a.getNumberValidator)()),$(B,"skewY",0,(0,a.getNumberValidator)()),e.Factory.addComponentsGetterSetter(B,"offset",["x","y"]),$(B,"offsetX",0,(0,a.getNumberValidator)()),$(B,"offsetY",0,(0,a.getNumberValidator)()),$(B,"dragDistance",null,(0,a.getNumberValidator)()),$(B,"width",0,(0,a.getNumberValidator)()),$(B,"height",0,(0,a.getNumberValidator)()),$(B,"listening",!0,(0,a.getBooleanValidator)()),$(B,"preventDefault",!0,(0,a.getBooleanValidator)()),$(B,"filters",null,function(Z){return this._filterUpToDate=!1,Z}),$(B,"visible",!0,(0,a.getBooleanValidator)()),$(B,"transformsEnabled","all",(0,a.getStringValidator)()),$(B,"size"),$(B,"dragBoundFunc"),$(B,"draggable",!1,(0,a.getBooleanValidator)()),e.Factory.backCompat(B,{rotateDeg:"rotate",setRotationDeg:"setRotation",getRotationDeg:"getRotation"}),Qm}var Jm={},m5;function B1(){if(m5)return Jm;m5=1,Object.defineProperty(Jm,"__esModule",{value:!0}),Jm.Container=void 0;const t=Pr(),e=Ti(),r=Ar();let n=class extends e.Node{constructor(){super(...arguments),this.children=[]}getChildren(a){if(!a)return this.children||[];const s=this.children||[],o=[];return s.forEach(function(l){a(l)&&o.push(l)}),o}hasChildren(){return this.getChildren().length>0}removeChildren(){return this.getChildren().forEach(a=>{a.parent=null,a.index=0,a.remove()}),this.children=[],this._requestDraw(),this}destroyChildren(){return this.getChildren().forEach(a=>{a.parent=null,a.index=0,a.destroy()}),this.children=[],this._requestDraw(),this}add(...a){if(a.length===0)return this;if(a.length>1){for(let o=0;o<a.length;o++)this.add(a[o]);return this}const s=a[0];return s.getParent()?(s.moveTo(this),this):(this._validateAdd(s),s.index=this.getChildren().length,s.parent=this,s._clearCaches(),this.getChildren().push(s),this._fire("add",{child:s}),this._requestDraw(),this)}destroy(){return this.hasChildren()&&this.destroyChildren(),super.destroy(),this}find(a){return this._generalFind(a,!1)}findOne(a){const s=this._generalFind(a,!0);return s.length>0?s[0]:void 0}_generalFind(a,s){const o=[];return this._descendants(l=>{const u=l._isMatch(a);return u&&o.push(l),!!(u&&s)}),o}_descendants(a){let s=!1;const o=this.getChildren();for(const l of o){if(s=a(l),s)return!0;if(l.hasChildren()&&(s=l._descendants(a),s))return!0}return!1}toObject(){const a=e.Node.prototype.toObject.call(this);return a.children=[],this.getChildren().forEach(s=>{a.children.push(s.toObject())}),a}isAncestorOf(a){let s=a.getParent();for(;s;){if(s._id===this._id)return!0;s=s.getParent()}return!1}clone(a){const s=e.Node.prototype.clone.call(this,a);return this.getChildren().forEach(function(o){s.add(o.clone())}),s}getAllIntersections(a){const s=[];return this.find("Shape").forEach(o=>{o.isVisible()&&o.intersects(a)&&s.push(o)}),s}_clearSelfAndDescendantCache(a){var s;super._clearSelfAndDescendantCache(a),!this.isCached()&&((s=this.children)===null||s===void 0||s.forEach(function(o){o._clearSelfAndDescendantCache(a)}))}_setChildrenIndices(){var a;(a=this.children)===null||a===void 0||a.forEach(function(s,o){s.index=o}),this._requestDraw()}drawScene(a,s,o){const l=this.getLayer(),u=a||l&&l.getCanvas(),c=u&&u.getContext(),h=this._getCanvasCache(),p=h&&h.scene,v=u&&u.isCache;if(!this.isVisible()&&!v)return this;if(p){c.save();const y=this.getAbsoluteTransform(s).getMatrix();c.transform(y[0],y[1],y[2],y[3],y[4],y[5]),this._drawCachedSceneCanvas(c),c.restore()}else this._drawChildren("drawScene",u,s,o);return this}drawHit(a,s){if(!this.shouldDrawHit(s))return this;const o=this.getLayer(),l=a||o&&o.hitCanvas,u=l&&l.getContext(),c=this._getCanvasCache();if(c&&c.hit){u.save();const p=this.getAbsoluteTransform(s).getMatrix();u.transform(p[0],p[1],p[2],p[3],p[4],p[5]),this._drawCachedHitCanvas(u),u.restore()}else this._drawChildren("drawHit",l,s);return this}_drawChildren(a,s,o,l){var u;const c=s&&s.getContext(),h=this.clipWidth(),p=this.clipHeight(),v=this.clipFunc(),y=typeof h=="number"&&typeof p=="number"||v,S=o===this;if(y){c.save();const T=this.getAbsoluteTransform(o);let _=T.getMatrix();c.transform(_[0],_[1],_[2],_[3],_[4],_[5]),c.beginPath();let C;if(v)C=v.call(this,c,this);else{const N=this.clipX(),A=this.clipY();c.rect(N||0,A||0,h,p)}c.clip.apply(c,C),_=T.copy().invert().getMatrix(),c.transform(_[0],_[1],_[2],_[3],_[4],_[5])}const w=!S&&this.globalCompositeOperation()!=="source-over"&&a==="drawScene";w&&(c.save(),c._applyGlobalCompositeOperation(this)),(u=this.children)===null||u===void 0||u.forEach(function(T){T[a](s,o,l)}),w&&c.restore(),y&&c.restore()}getClientRect(a={}){var s;const o=a.skipTransform,l=a.relativeTo;let u,c,h,p,v={x:1/0,y:1/0,width:0,height:0};const y=this;(s=this.children)===null||s===void 0||s.forEach(function(T){if(!T.visible())return;const _=T.getClientRect({relativeTo:y,skipShadow:a.skipShadow,skipStroke:a.skipStroke});_.width===0&&_.height===0||(u===void 0?(u=_.x,c=_.y,h=_.x+_.width,p=_.y+_.height):(u=Math.min(u,_.x),c=Math.min(c,_.y),h=Math.max(h,_.x+_.width),p=Math.max(p,_.y+_.height)))});const S=this.find("Shape");let w=!1;for(let T=0;T<S.length;T++)if(S[T]._isVisible(this)){w=!0;break}return w&&u!==void 0?v={x:u,y:c,width:h-u,height:p-c}:v={x:0,y:0,width:0,height:0},o?v:this._transformedRect(v,l)}};return Jm.Container=n,t.Factory.addComponentsGetterSetter(n,"clip",["x","y","width","height"]),t.Factory.addGetterSetter(n,"clipX",void 0,(0,r.getNumberValidator)()),t.Factory.addGetterSetter(n,"clipY",void 0,(0,r.getNumberValidator)()),t.Factory.addGetterSetter(n,"clipWidth",void 0,(0,r.getNumberValidator)()),t.Factory.addGetterSetter(n,"clipHeight",void 0,(0,r.getNumberValidator)()),t.Factory.addGetterSetter(n,"clipFunc"),Jm}var N2={},xd={},g5;function kR(){if(g5)return xd;g5=1,Object.defineProperty(xd,"__esModule",{value:!0}),xd.getCapturedShape=n,xd.createEvent=i,xd.hasPointerCapture=a,xd.setPointerCapture=s,xd.releaseCapture=o;const t=Tr(),e=new Map,r=t.Konva._global.PointerEvent!==void 0;function n(l){return e.get(l)}function i(l){return{evt:l,pointerId:l.pointerId}}function a(l,u){return e.get(l)===u}function s(l,u){o(l),u.getStage()&&(e.set(l,u),r&&u._fire("gotpointercapture",i(new PointerEvent("gotpointercapture"))))}function o(l,u){const c=e.get(l);if(!c)return;const h=c.getStage();h&&h.content,e.delete(l),r&&c._fire("lostpointercapture",i(new PointerEvent("lostpointercapture")))}return xd}var v5;function vG(){return v5||(v5=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Stage=t.stages=void 0;const e=mi(),r=Pr(),n=B1(),i=Tr(),a=F1(),s=w_(),o=Tr(),l=kR(),u="Stage",c="string",h="px",p="mouseout",v="mouseleave",y="mouseover",S="mouseenter",w="mousemove",T="mousedown",_="mouseup",C="pointermove",N="pointerdown",A="pointerup",I="pointercancel",j="lostpointercapture",O="pointerout",F="pointerleave",B="pointerover",$="pointerenter",Z="contextmenu",D="touchstart",H="touchend",U="touchmove",W="touchcancel",Y="wheel",Q=5,ne=[[S,"_pointerenter"],[T,"_pointerdown"],[w,"_pointermove"],[_,"_pointerup"],[v,"_pointerleave"],[D,"_pointerdown"],[U,"_pointermove"],[H,"_pointerup"],[W,"_pointercancel"],[y,"_pointerover"],[Y,"_wheel"],[Z,"_contextmenu"],[N,"_pointerdown"],[C,"_pointermove"],[A,"_pointerup"],[I,"_pointercancel"],[j,"_lostpointercapture"]],re={mouse:{[O]:p,[F]:v,[B]:y,[$]:S,[C]:w,[N]:T,[A]:_,[I]:"mousecancel",pointerclick:"click",pointerdblclick:"dblclick"},touch:{[O]:"touchout",[F]:"touchleave",[B]:"touchover",[$]:"touchenter",[C]:U,[N]:D,[A]:H,[I]:W,pointerclick:"tap",pointerdblclick:"dbltap"},pointer:{[O]:O,[F]:F,[B]:B,[$]:$,[C]:C,[N]:N,[A]:A,[I]:I,pointerclick:"pointerclick",pointerdblclick:"pointerdblclick"}},q=ye=>ye.indexOf("pointer")>=0?"pointer":ye.indexOf("touch")>=0?"touch":"mouse",te=ye=>{const se=q(ye);if(se==="pointer")return i.Konva.pointerEventsEnabled&&re.pointer;if(se==="touch")return re.touch;if(se==="mouse")return re.mouse};function ae(ye={}){return(ye.clipFunc||ye.clipWidth||ye.clipHeight)&&e.Util.warn("Stage does not support clipping. Please use clip for Layers or Groups."),ye}const de="Pointer position is missing and not registered by the stage. Looks like it is outside of the stage container. You can set it manually from event: stage.setPointersPositions(event);";t.stages=[];class ge extends n.Container{constructor(se){super(ae(se)),this._pointerPositions=[],this._changedPointerPositions=[],this._buildDOM(),this._bindContentEvents(),t.stages.push(this),this.on("widthChange.konva heightChange.konva",this._resizeDOM),this.on("visibleChange.konva",this._checkVisibility),this.on("clipWidthChange.konva clipHeightChange.konva clipFuncChange.konva",()=>{ae(this.attrs)}),this._checkVisibility()}_validateAdd(se){const fe=se.getType()==="Layer",le=se.getType()==="FastLayer";fe||le||e.Util.throw("You may only add layers to the stage.")}_checkVisibility(){if(!this.content)return;const se=this.visible()?"":"none";this.content.style.display=se}setContainer(se){if(typeof se===c){if(se.charAt(0)==="."){const le=se.slice(1);se=document.getElementsByClassName(le)[0]}else{var fe;se.charAt(0)!=="#"?fe=se:fe=se.slice(1),se=document.getElementById(fe)}if(!se)throw"Can not find container in document with id "+fe}return this._setAttr("container",se),this.content&&(this.content.parentElement&&this.content.parentElement.removeChild(this.content),se.appendChild(this.content)),this}shouldDrawHit(){return!0}clear(){let se=this.children,fe=se.length,le;for(le=0;le<fe;le++)se[le].clear();return this}clone(se){return se||(se={}),se.container=typeof document<"u"&&document.createElement("div"),n.Container.prototype.clone.call(this,se)}destroy(){super.destroy();const se=this.content;se&&e.Util._isInDocument(se)&&this.container().removeChild(se);const fe=t.stages.indexOf(this);return fe>-1&&t.stages.splice(fe,1),e.Util.releaseCanvas(this.bufferCanvas._canvas,this.bufferHitCanvas._canvas),this}getPointerPosition(){const se=this._pointerPositions[0]||this._changedPointerPositions[0];return se?{x:se.x,y:se.y}:(e.Util.warn(de),null)}_getPointerById(se){return this._pointerPositions.find(fe=>fe.id===se)}getPointersPositions(){return this._pointerPositions}getStage(){return this}getContent(){return this.content}_toKonvaCanvas(se){se=se||{},se.x=se.x||0,se.y=se.y||0,se.width=se.width||this.width(),se.height=se.height||this.height();const fe=new a.SceneCanvas({width:se.width,height:se.height,pixelRatio:se.pixelRatio||1}),le=fe.getContext()._context,pe=this.children;return(se.x||se.y)&&le.translate(-1*se.x,-1*se.y),pe.forEach(function(me){if(!me.isVisible())return;const xe=me._toKonvaCanvas(se);le.drawImage(xe._canvas,se.x,se.y,xe.getWidth()/xe.getPixelRatio(),xe.getHeight()/xe.getPixelRatio())}),fe}getIntersection(se){if(!se)return null;let fe=this.children,le=fe.length,pe=le-1,me;for(me=pe;me>=0;me--){const xe=fe[me].getIntersection(se);if(xe)return xe}return null}_resizeDOM(){const se=this.width(),fe=this.height();this.content&&(this.content.style.width=se+h,this.content.style.height=fe+h),this.bufferCanvas.setSize(se,fe),this.bufferHitCanvas.setSize(se,fe),this.children.forEach(le=>{le.setSize({width:se,height:fe}),le.draw()})}add(se,...fe){if(arguments.length>1){for(let pe=0;pe<arguments.length;pe++)this.add(arguments[pe]);return this}super.add(se);const le=this.children.length;return le>Q&&e.Util.warn("The stage has "+le+" layers. Recommended maximum number of layers is 3-5. Adding more layers into the stage may drop the performance. Rethink your tree structure, you can use Konva.Group."),se.setSize({width:this.width(),height:this.height()}),se.draw(),i.Konva.isBrowser&&this.content.appendChild(se.canvas._canvas),this}getParent(){return null}getLayer(){return null}hasPointerCapture(se){return l.hasPointerCapture(se,this)}setPointerCapture(se){l.setPointerCapture(se,this)}releaseCapture(se){l.releaseCapture(se,this)}getLayers(){return this.children}_bindContentEvents(){i.Konva.isBrowser&&ne.forEach(([se,fe])=>{this.content.addEventListener(se,le=>{this[fe](le)},{passive:!1})})}_pointerenter(se){this.setPointersPositions(se);const fe=te(se.type);fe&&this._fire(fe.pointerenter,{evt:se,target:this,currentTarget:this})}_pointerover(se){this.setPointersPositions(se);const fe=te(se.type);fe&&this._fire(fe.pointerover,{evt:se,target:this,currentTarget:this})}_getTargetShape(se){let fe=this[se+"targetShape"];return fe&&!fe.getStage()&&(fe=null),fe}_pointerleave(se){const fe=te(se.type),le=q(se.type);if(!fe)return;this.setPointersPositions(se);const pe=this._getTargetShape(le),me=!(i.Konva.isDragging()||i.Konva.isTransforming())||i.Konva.hitOnDragEnabled;pe&&me?(pe._fireAndBubble(fe.pointerout,{evt:se}),pe._fireAndBubble(fe.pointerleave,{evt:se}),this._fire(fe.pointerleave,{evt:se,target:this,currentTarget:this}),this[le+"targetShape"]=null):me&&(this._fire(fe.pointerleave,{evt:se,target:this,currentTarget:this}),this._fire(fe.pointerout,{evt:se,target:this,currentTarget:this})),this.pointerPos=null,this._pointerPositions=[]}_pointerdown(se){const fe=te(se.type),le=q(se.type);if(!fe)return;this.setPointersPositions(se);let pe=!1;this._changedPointerPositions.forEach(me=>{const xe=this.getIntersection(me);if(s.DD.justDragged=!1,i.Konva["_"+le+"ListenClick"]=!0,!xe||!xe.isListening()){this[le+"ClickStartShape"]=void 0;return}i.Konva.capturePointerEventsEnabled&&xe.setPointerCapture(me.id),this[le+"ClickStartShape"]=xe,xe._fireAndBubble(fe.pointerdown,{evt:se,pointerId:me.id}),pe=!0;const Se=se.type.indexOf("touch")>=0;xe.preventDefault()&&se.cancelable&&Se&&se.preventDefault()}),pe||this._fire(fe.pointerdown,{evt:se,target:this,currentTarget:this,pointerId:this._pointerPositions[0].id})}_pointermove(se){const fe=te(se.type),le=q(se.type);if(!fe||(i.Konva.isDragging()&&s.DD.node.preventDefault()&&se.cancelable&&se.preventDefault(),this.setPointersPositions(se),!(!(i.Konva.isDragging()||i.Konva.isTransforming())||i.Konva.hitOnDragEnabled)))return;const me={};let xe=!1;const Se=this._getTargetShape(le);this._changedPointerPositions.forEach(Ve=>{const $e=l.getCapturedShape(Ve.id)||this.getIntersection(Ve),St=Ve.id,rt={evt:se,pointerId:St},lt=Se!==$e;if(lt&&Se&&(Se._fireAndBubble(fe.pointerout,{...rt},$e),Se._fireAndBubble(fe.pointerleave,{...rt},$e)),$e){if(me[$e._id])return;me[$e._id]=!0}$e&&$e.isListening()?(xe=!0,lt&&($e._fireAndBubble(fe.pointerover,{...rt},Se),$e._fireAndBubble(fe.pointerenter,{...rt},Se),this[le+"targetShape"]=$e),$e._fireAndBubble(fe.pointermove,{...rt})):Se&&(this._fire(fe.pointerover,{evt:se,target:this,currentTarget:this,pointerId:St}),this[le+"targetShape"]=null)}),xe||this._fire(fe.pointermove,{evt:se,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id})}_pointerup(se){const fe=te(se.type),le=q(se.type);if(!fe)return;this.setPointersPositions(se);const pe=this[le+"ClickStartShape"],me=this[le+"ClickEndShape"],xe={};let Se=!1;this._changedPointerPositions.forEach(Ve=>{const $e=l.getCapturedShape(Ve.id)||this.getIntersection(Ve);if($e){if($e.releaseCapture(Ve.id),xe[$e._id])return;xe[$e._id]=!0}const St=Ve.id,rt={evt:se,pointerId:St};let lt=!1;i.Konva["_"+le+"InDblClickWindow"]?(lt=!0,clearTimeout(this[le+"DblTimeout"])):s.DD.justDragged||(i.Konva["_"+le+"InDblClickWindow"]=!0,clearTimeout(this[le+"DblTimeout"])),this[le+"DblTimeout"]=setTimeout(function(){i.Konva["_"+le+"InDblClickWindow"]=!1},i.Konva.dblClickWindow),$e&&$e.isListening()?(Se=!0,this[le+"ClickEndShape"]=$e,$e._fireAndBubble(fe.pointerup,{...rt}),i.Konva["_"+le+"ListenClick"]&&pe&&pe===$e&&($e._fireAndBubble(fe.pointerclick,{...rt}),lt&&me&&me===$e&&$e._fireAndBubble(fe.pointerdblclick,{...rt}))):(this[le+"ClickEndShape"]=null,i.Konva["_"+le+"ListenClick"]&&this._fire(fe.pointerclick,{evt:se,target:this,currentTarget:this,pointerId:St}),lt&&this._fire(fe.pointerdblclick,{evt:se,target:this,currentTarget:this,pointerId:St}))}),Se||this._fire(fe.pointerup,{evt:se,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id}),i.Konva["_"+le+"ListenClick"]=!1,se.cancelable&&le!=="touch"&&se.preventDefault()}_contextmenu(se){this.setPointersPositions(se);const fe=this.getIntersection(this.getPointerPosition());fe&&fe.isListening()?fe._fireAndBubble(Z,{evt:se}):this._fire(Z,{evt:se,target:this,currentTarget:this})}_wheel(se){this.setPointersPositions(se);const fe=this.getIntersection(this.getPointerPosition());fe&&fe.isListening()?fe._fireAndBubble(Y,{evt:se}):this._fire(Y,{evt:se,target:this,currentTarget:this})}_pointercancel(se){this.setPointersPositions(se);const fe=l.getCapturedShape(se.pointerId)||this.getIntersection(this.getPointerPosition());fe&&fe._fireAndBubble(A,l.createEvent(se)),l.releaseCapture(se.pointerId)}_lostpointercapture(se){l.releaseCapture(se.pointerId)}setPointersPositions(se){let fe=this._getContentPosition(),le=null,pe=null;se=se||window.event,se.touches!==void 0?(this._pointerPositions=[],this._changedPointerPositions=[],Array.prototype.forEach.call(se.touches,me=>{this._pointerPositions.push({id:me.identifier,x:(me.clientX-fe.left)/fe.scaleX,y:(me.clientY-fe.top)/fe.scaleY})}),Array.prototype.forEach.call(se.changedTouches||se.touches,me=>{this._changedPointerPositions.push({id:me.identifier,x:(me.clientX-fe.left)/fe.scaleX,y:(me.clientY-fe.top)/fe.scaleY})})):(le=(se.clientX-fe.left)/fe.scaleX,pe=(se.clientY-fe.top)/fe.scaleY,this.pointerPos={x:le,y:pe},this._pointerPositions=[{x:le,y:pe,id:e.Util._getFirstPointerId(se)}],this._changedPointerPositions=[{x:le,y:pe,id:e.Util._getFirstPointerId(se)}])}_setPointerPosition(se){e.Util.warn('Method _setPointerPosition is deprecated. Use "stage.setPointersPositions(event)" instead.'),this.setPointersPositions(se)}_getContentPosition(){if(!this.content||!this.content.getBoundingClientRect)return{top:0,left:0,scaleX:1,scaleY:1};const se=this.content.getBoundingClientRect();return{top:se.top,left:se.left,scaleX:se.width/this.content.clientWidth||1,scaleY:se.height/this.content.clientHeight||1}}_buildDOM(){if(this.bufferCanvas=new a.SceneCanvas({width:this.width(),height:this.height()}),this.bufferHitCanvas=new a.HitCanvas({pixelRatio:1,width:this.width(),height:this.height()}),!i.Konva.isBrowser)return;const se=this.container();if(!se)throw"Stage has no container. A container is required.";se.innerHTML="",this.content=document.createElement("div"),this.content.style.position="relative",this.content.style.userSelect="none",this.content.className="konvajs-content",this.content.setAttribute("role","presentation"),se.appendChild(this.content),this._resizeDOM()}cache(){return e.Util.warn("Cache function is not allowed for stage. You may use cache only for layers, groups and shapes."),this}clearCache(){return this}batchDraw(){return this.getChildren().forEach(function(se){se.batchDraw()}),this}}t.Stage=ge,ge.prototype.nodeType=u,(0,o._registerNode)(ge),r.Factory.addGetterSetter(ge,"container"),i.Konva.isBrowser&&document.addEventListener("visibilitychange",()=>{t.stages.forEach(ye=>{ye.batchDraw()})})})(N2)),N2}var eg={},P2={},y5;function Sa(){return y5||(y5=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Shape=t.shapes=void 0;const e=Tr(),r=mi(),n=Pr(),i=Ti(),a=Ar(),s=Tr(),o=kR(),l="hasShadow",u="shadowRGBA",c="patternImage",h="linearGradient",p="radialGradient";let v;function y(){return v||(v=r.Util.createCanvasElement().getContext("2d"),v)}t.shapes={};function S(F){const B=this.attrs.fillRule;B?F.fill(B):F.fill()}function w(F){F.stroke()}function T(F){const B=this.attrs.fillRule;B?F.fill(B):F.fill()}function _(F){F.stroke()}function C(){this._clearCache(l)}function N(){this._clearCache(u)}function A(){this._clearCache(c)}function I(){this._clearCache(h)}function j(){this._clearCache(p)}class O extends i.Node{constructor(B){super(B);let $;for(;$=r.Util.getRandomColor(),!($&&!($ in t.shapes)););this.colorKey=$,t.shapes[$]=this}getContext(){return r.Util.warn("shape.getContext() method is deprecated. Please do not use it."),this.getLayer().getContext()}getCanvas(){return r.Util.warn("shape.getCanvas() method is deprecated. Please do not use it."),this.getLayer().getCanvas()}getSceneFunc(){return this.attrs.sceneFunc||this._sceneFunc}getHitFunc(){return this.attrs.hitFunc||this._hitFunc}hasShadow(){return this._getCache(l,this._hasShadow)}_hasShadow(){return this.shadowEnabled()&&this.shadowOpacity()!==0&&!!(this.shadowColor()||this.shadowBlur()||this.shadowOffsetX()||this.shadowOffsetY())}_getFillPattern(){return this._getCache(c,this.__getFillPattern)}__getFillPattern(){if(this.fillPatternImage()){const $=y().createPattern(this.fillPatternImage(),this.fillPatternRepeat()||"repeat");if($&&$.setTransform){const Z=new r.Transform;Z.translate(this.fillPatternX(),this.fillPatternY()),Z.rotate(e.Konva.getAngle(this.fillPatternRotation())),Z.scale(this.fillPatternScaleX(),this.fillPatternScaleY()),Z.translate(-1*this.fillPatternOffsetX(),-1*this.fillPatternOffsetY());const D=Z.getMatrix(),H=typeof DOMMatrix>"u"?{a:D[0],b:D[1],c:D[2],d:D[3],e:D[4],f:D[5]}:new DOMMatrix(D);$.setTransform(H)}return $}}_getLinearGradient(){return this._getCache(h,this.__getLinearGradient)}__getLinearGradient(){const B=this.fillLinearGradientColorStops();if(B){const $=y(),Z=this.fillLinearGradientStartPoint(),D=this.fillLinearGradientEndPoint(),H=$.createLinearGradient(Z.x,Z.y,D.x,D.y);for(let U=0;U<B.length;U+=2)H.addColorStop(B[U],B[U+1]);return H}}_getRadialGradient(){return this._getCache(p,this.__getRadialGradient)}__getRadialGradient(){const B=this.fillRadialGradientColorStops();if(B){const $=y(),Z=this.fillRadialGradientStartPoint(),D=this.fillRadialGradientEndPoint(),H=$.createRadialGradient(Z.x,Z.y,this.fillRadialGradientStartRadius(),D.x,D.y,this.fillRadialGradientEndRadius());for(let U=0;U<B.length;U+=2)H.addColorStop(B[U],B[U+1]);return H}}getShadowRGBA(){return this._getCache(u,this._getShadowRGBA)}_getShadowRGBA(){if(!this.hasShadow())return;const B=r.Util.colorToRGBA(this.shadowColor());if(B)return"rgba("+B.r+","+B.g+","+B.b+","+B.a*(this.shadowOpacity()||1)+")"}hasFill(){return this._calculate("hasFill",["fillEnabled","fill","fillPatternImage","fillLinearGradientColorStops","fillRadialGradientColorStops"],()=>this.fillEnabled()&&!!(this.fill()||this.fillPatternImage()||this.fillLinearGradientColorStops()||this.fillRadialGradientColorStops()))}hasStroke(){return this._calculate("hasStroke",["strokeEnabled","strokeWidth","stroke","strokeLinearGradientColorStops"],()=>this.strokeEnabled()&&this.strokeWidth()&&!!(this.stroke()||this.strokeLinearGradientColorStops()))}hasHitStroke(){const B=this.hitStrokeWidth();return B==="auto"?this.hasStroke():this.strokeEnabled()&&!!B}intersects(B){const $=this.getStage();if(!$)return!1;const Z=$.bufferHitCanvas;return Z.getContext().clear(),this.drawHit(Z,void 0,!0),Z.context.getImageData(Math.round(B.x),Math.round(B.y),1,1).data[3]>0}destroy(){return i.Node.prototype.destroy.call(this),delete t.shapes[this.colorKey],delete this.colorKey,this}_useBufferCanvas(B){var $;if(!(($=this.attrs.perfectDrawEnabled)!==null&&$!==void 0?$:!0))return!1;const D=B||this.hasFill(),H=this.hasStroke(),U=this.getAbsoluteOpacity()!==1;if(D&&H&&U)return!0;const W=this.hasShadow(),Y=this.shadowForStrokeEnabled();return!!(D&&H&&W&&Y)}setStrokeHitEnabled(B){r.Util.warn("strokeHitEnabled property is deprecated. Please use hitStrokeWidth instead."),B?this.hitStrokeWidth("auto"):this.hitStrokeWidth(0)}getStrokeHitEnabled(){return this.hitStrokeWidth()!==0}getSelfRect(){const B=this.size();return{x:this._centroid?-B.width/2:0,y:this._centroid?-B.height/2:0,width:B.width,height:B.height}}getClientRect(B={}){let $=!1,Z=this.getParent();for(;Z;){if(Z.isCached()){$=!0;break}Z=Z.getParent()}const D=B.skipTransform,H=B.relativeTo||$&&this.getStage()||void 0,U=this.getSelfRect(),Y=!B.skipStroke&&this.hasStroke()&&this.strokeWidth()||0,Q=U.width+Y,ne=U.height+Y,re=!B.skipShadow&&this.hasShadow(),q=re?this.shadowOffsetX():0,te=re?this.shadowOffsetY():0,ae=Q+Math.abs(q),de=ne+Math.abs(te),ge=re&&this.shadowBlur()||0,ye=ae+ge*2,se=de+ge*2,fe={width:ye,height:se,x:-(Y/2+ge)+Math.min(q,0)+U.x,y:-(Y/2+ge)+Math.min(te,0)+U.y};return D?fe:this._transformedRect(fe,H)}drawScene(B,$,Z){const D=this.getLayer();let H=B||D.getCanvas(),U=H.getContext(),W=this._getCanvasCache(),Y=this.getSceneFunc(),Q=this.hasShadow(),ne,re;const q=H.isCache,te=$===this;if(!this.isVisible()&&!te)return this;if(W){U.save();const de=this.getAbsoluteTransform($).getMatrix();return U.transform(de[0],de[1],de[2],de[3],de[4],de[5]),this._drawCachedSceneCanvas(U),U.restore(),this}if(!Y)return this;if(U.save(),this._useBufferCanvas()&&!q){ne=this.getStage();const de=Z||ne.bufferCanvas;re=de.getContext(),re.clear(),re.save(),re._applyLineJoin(this);var ae=this.getAbsoluteTransform($).getMatrix();re.transform(ae[0],ae[1],ae[2],ae[3],ae[4],ae[5]),Y.call(this,re,this),re.restore();const ge=de.pixelRatio;Q&&U._applyShadow(this),U._applyOpacity(this),U._applyGlobalCompositeOperation(this),U.drawImage(de._canvas,0,0,de.width/ge,de.height/ge)}else{if(U._applyLineJoin(this),!te){var ae=this.getAbsoluteTransform($).getMatrix();U.transform(ae[0],ae[1],ae[2],ae[3],ae[4],ae[5]),U._applyOpacity(this),U._applyGlobalCompositeOperation(this)}Q&&U._applyShadow(this),Y.call(this,U,this)}return U.restore(),this}drawHit(B,$,Z=!1){if(!this.shouldDrawHit($,Z))return this;const D=this.getLayer(),H=B||D.hitCanvas,U=H&&H.getContext(),W=this.hitFunc()||this.sceneFunc(),Y=this._getCanvasCache(),Q=Y&&Y.hit;if(this.colorKey||r.Util.warn("Looks like your canvas has a destroyed shape in it. Do not reuse shape after you destroyed it. If you want to reuse shape you should call remove() instead of destroy()"),Q){U.save();const re=this.getAbsoluteTransform($).getMatrix();return U.transform(re[0],re[1],re[2],re[3],re[4],re[5]),this._drawCachedHitCanvas(U),U.restore(),this}if(!W)return this;if(U.save(),U._applyLineJoin(this),!(this===$)){const re=this.getAbsoluteTransform($).getMatrix();U.transform(re[0],re[1],re[2],re[3],re[4],re[5])}return W.call(this,U,this),U.restore(),this}drawHitFromCache(B=0){let $=this._getCanvasCache(),Z=this._getCachedSceneCanvas(),D=$.hit,H=D.getContext(),U=D.getWidth(),W=D.getHeight(),Y,Q,ne,re,q,te;H.clear(),H.drawImage(Z._canvas,0,0,U,W);try{for(Y=H.getImageData(0,0,U,W),Q=Y.data,ne=Q.length,re=r.Util._hexToRgb(this.colorKey),q=0;q<ne;q+=4)te=Q[q+3],te>B?(Q[q]=re.r,Q[q+1]=re.g,Q[q+2]=re.b,Q[q+3]=255):Q[q+3]=0;H.putImageData(Y,0,0)}catch(ae){r.Util.error("Unable to draw hit graph from cached scene canvas. "+ae.message)}return this}hasPointerCapture(B){return o.hasPointerCapture(B,this)}setPointerCapture(B){o.setPointerCapture(B,this)}releaseCapture(B){o.releaseCapture(B,this)}}t.Shape=O,O.prototype._fillFunc=S,O.prototype._strokeFunc=w,O.prototype._fillFuncHit=T,O.prototype._strokeFuncHit=_,O.prototype._centroid=!1,O.prototype.nodeType="Shape",(0,s._registerNode)(O),O.prototype.eventListeners={},O.prototype.on.call(O.prototype,"shadowColorChange.konva shadowBlurChange.konva shadowOffsetChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",C),O.prototype.on.call(O.prototype,"shadowColorChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",N),O.prototype.on.call(O.prototype,"fillPriorityChange.konva fillPatternImageChange.konva fillPatternRepeatChange.konva fillPatternScaleXChange.konva fillPatternScaleYChange.konva fillPatternOffsetXChange.konva fillPatternOffsetYChange.konva fillPatternXChange.konva fillPatternYChange.konva fillPatternRotationChange.konva",A),O.prototype.on.call(O.prototype,"fillPriorityChange.konva fillLinearGradientColorStopsChange.konva fillLinearGradientStartPointXChange.konva fillLinearGradientStartPointYChange.konva fillLinearGradientEndPointXChange.konva fillLinearGradientEndPointYChange.konva",I),O.prototype.on.call(O.prototype,"fillPriorityChange.konva fillRadialGradientColorStopsChange.konva fillRadialGradientStartPointXChange.konva fillRadialGradientStartPointYChange.konva fillRadialGradientEndPointXChange.konva fillRadialGradientEndPointYChange.konva fillRadialGradientStartRadiusChange.konva fillRadialGradientEndRadiusChange.konva",j),n.Factory.addGetterSetter(O,"stroke",void 0,(0,a.getStringOrGradientValidator)()),n.Factory.addGetterSetter(O,"strokeWidth",2,(0,a.getNumberValidator)()),n.Factory.addGetterSetter(O,"fillAfterStrokeEnabled",!1),n.Factory.addGetterSetter(O,"hitStrokeWidth","auto",(0,a.getNumberOrAutoValidator)()),n.Factory.addGetterSetter(O,"strokeHitEnabled",!0,(0,a.getBooleanValidator)()),n.Factory.addGetterSetter(O,"perfectDrawEnabled",!0,(0,a.getBooleanValidator)()),n.Factory.addGetterSetter(O,"shadowForStrokeEnabled",!0,(0,a.getBooleanValidator)()),n.Factory.addGetterSetter(O,"lineJoin"),n.Factory.addGetterSetter(O,"lineCap"),n.Factory.addGetterSetter(O,"sceneFunc"),n.Factory.addGetterSetter(O,"hitFunc"),n.Factory.addGetterSetter(O,"dash"),n.Factory.addGetterSetter(O,"dashOffset",0,(0,a.getNumberValidator)()),n.Factory.addGetterSetter(O,"shadowColor",void 0,(0,a.getStringValidator)()),n.Factory.addGetterSetter(O,"shadowBlur",0,(0,a.getNumberValidator)()),n.Factory.addGetterSetter(O,"shadowOpacity",1,(0,a.getNumberValidator)()),n.Factory.addComponentsGetterSetter(O,"shadowOffset",["x","y"]),n.Factory.addGetterSetter(O,"shadowOffsetX",0,(0,a.getNumberValidator)()),n.Factory.addGetterSetter(O,"shadowOffsetY",0,(0,a.getNumberValidator)()),n.Factory.addGetterSetter(O,"fillPatternImage"),n.Factory.addGetterSetter(O,"fill",void 0,(0,a.getStringOrGradientValidator)()),n.Factory.addGetterSetter(O,"fillPatternX",0,(0,a.getNumberValidator)()),n.Factory.addGetterSetter(O,"fillPatternY",0,(0,a.getNumberValidator)()),n.Factory.addGetterSetter(O,"fillLinearGradientColorStops"),n.Factory.addGetterSetter(O,"strokeLinearGradientColorStops"),n.Factory.addGetterSetter(O,"fillRadialGradientStartRadius",0),n.Factory.addGetterSetter(O,"fillRadialGradientEndRadius",0),n.Factory.addGetterSetter(O,"fillRadialGradientColorStops"),n.Factory.addGetterSetter(O,"fillPatternRepeat","repeat"),n.Factory.addGetterSetter(O,"fillEnabled",!0),n.Factory.addGetterSetter(O,"strokeEnabled",!0),n.Factory.addGetterSetter(O,"shadowEnabled",!0),n.Factory.addGetterSetter(O,"dashEnabled",!0),n.Factory.addGetterSetter(O,"strokeScaleEnabled",!0),n.Factory.addGetterSetter(O,"fillPriority","color"),n.Factory.addComponentsGetterSetter(O,"fillPatternOffset",["x","y"]),n.Factory.addGetterSetter(O,"fillPatternOffsetX",0,(0,a.getNumberValidator)()),n.Factory.addGetterSetter(O,"fillPatternOffsetY",0,(0,a.getNumberValidator)()),n.Factory.addComponentsGetterSetter(O,"fillPatternScale",["x","y"]),n.Factory.addGetterSetter(O,"fillPatternScaleX",1,(0,a.getNumberValidator)()),n.Factory.addGetterSetter(O,"fillPatternScaleY",1,(0,a.getNumberValidator)()),n.Factory.addComponentsGetterSetter(O,"fillLinearGradientStartPoint",["x","y"]),n.Factory.addComponentsGetterSetter(O,"strokeLinearGradientStartPoint",["x","y"]),n.Factory.addGetterSetter(O,"fillLinearGradientStartPointX",0),n.Factory.addGetterSetter(O,"strokeLinearGradientStartPointX",0),n.Factory.addGetterSetter(O,"fillLinearGradientStartPointY",0),n.Factory.addGetterSetter(O,"strokeLinearGradientStartPointY",0),n.Factory.addComponentsGetterSetter(O,"fillLinearGradientEndPoint",["x","y"]),n.Factory.addComponentsGetterSetter(O,"strokeLinearGradientEndPoint",["x","y"]),n.Factory.addGetterSetter(O,"fillLinearGradientEndPointX",0),n.Factory.addGetterSetter(O,"strokeLinearGradientEndPointX",0),n.Factory.addGetterSetter(O,"fillLinearGradientEndPointY",0),n.Factory.addGetterSetter(O,"strokeLinearGradientEndPointY",0),n.Factory.addComponentsGetterSetter(O,"fillRadialGradientStartPoint",["x","y"]),n.Factory.addGetterSetter(O,"fillRadialGradientStartPointX",0),n.Factory.addGetterSetter(O,"fillRadialGradientStartPointY",0),n.Factory.addComponentsGetterSetter(O,"fillRadialGradientEndPoint",["x","y"]),n.Factory.addGetterSetter(O,"fillRadialGradientEndPointX",0),n.Factory.addGetterSetter(O,"fillRadialGradientEndPointY",0),n.Factory.addGetterSetter(O,"fillPatternRotation",0),n.Factory.addGetterSetter(O,"fillRule",void 0,(0,a.getStringValidator)()),n.Factory.backCompat(O,{dashArray:"dash",getDashArray:"getDash",setDashArray:"getDash",drawFunc:"sceneFunc",getDrawFunc:"getSceneFunc",setDrawFunc:"setSceneFunc",drawHitFunc:"hitFunc",getDrawHitFunc:"getHitFunc",setDrawHitFunc:"setHitFunc"})})(P2)),P2}var x5;function _R(){if(x5)return eg;x5=1,Object.defineProperty(eg,"__esModule",{value:!0}),eg.Layer=void 0;const t=mi(),e=B1(),r=Ti(),n=Pr(),i=F1(),a=Ar(),s=Sa(),o=Tr(),l="#",u="beforeDraw",c="draw",h=[{x:0,y:0},{x:-1,y:-1},{x:1,y:-1},{x:1,y:1},{x:-1,y:1}],p=h.length;class v extends e.Container{constructor(S){super(S),this.canvas=new i.SceneCanvas,this.hitCanvas=new i.HitCanvas({pixelRatio:1}),this._waitingForDraw=!1,this.on("visibleChange.konva",this._checkVisibility),this._checkVisibility(),this.on("imageSmoothingEnabledChange.konva",this._setSmoothEnabled),this._setSmoothEnabled()}createPNGStream(){return this.canvas._canvas.createPNGStream()}getCanvas(){return this.canvas}getNativeCanvasElement(){return this.canvas._canvas}getHitCanvas(){return this.hitCanvas}getContext(){return this.getCanvas().getContext()}clear(S){return this.getContext().clear(S),this.getHitCanvas().getContext().clear(S),this}setZIndex(S){super.setZIndex(S);const w=this.getStage();return w&&w.content&&(w.content.removeChild(this.getNativeCanvasElement()),S<w.children.length-1?w.content.insertBefore(this.getNativeCanvasElement(),w.children[S+1].getCanvas()._canvas):w.content.appendChild(this.getNativeCanvasElement())),this}moveToTop(){r.Node.prototype.moveToTop.call(this);const S=this.getStage();return S&&S.content&&(S.content.removeChild(this.getNativeCanvasElement()),S.content.appendChild(this.getNativeCanvasElement())),!0}moveUp(){if(!r.Node.prototype.moveUp.call(this))return!1;const w=this.getStage();return!w||!w.content?!1:(w.content.removeChild(this.getNativeCanvasElement()),this.index<w.children.length-1?w.content.insertBefore(this.getNativeCanvasElement(),w.children[this.index+1].getCanvas()._canvas):w.content.appendChild(this.getNativeCanvasElement()),!0)}moveDown(){if(r.Node.prototype.moveDown.call(this)){const S=this.getStage();if(S){const w=S.children;S.content&&(S.content.removeChild(this.getNativeCanvasElement()),S.content.insertBefore(this.getNativeCanvasElement(),w[this.index+1].getCanvas()._canvas))}return!0}return!1}moveToBottom(){if(r.Node.prototype.moveToBottom.call(this)){const S=this.getStage();if(S){const w=S.children;S.content&&(S.content.removeChild(this.getNativeCanvasElement()),S.content.insertBefore(this.getNativeCanvasElement(),w[1].getCanvas()._canvas))}return!0}return!1}getLayer(){return this}remove(){const S=this.getNativeCanvasElement();return r.Node.prototype.remove.call(this),S&&S.parentNode&&t.Util._isInDocument(S)&&S.parentNode.removeChild(S),this}getStage(){return this.parent}setSize({width:S,height:w}){return this.canvas.setSize(S,w),this.hitCanvas.setSize(S,w),this._setSmoothEnabled(),this}_validateAdd(S){const w=S.getType();w!=="Group"&&w!=="Shape"&&t.Util.throw("You may only add groups and shapes to a layer.")}_toKonvaCanvas(S){return S=S||{},S.width=S.width||this.getWidth(),S.height=S.height||this.getHeight(),S.x=S.x!==void 0?S.x:this.x(),S.y=S.y!==void 0?S.y:this.y(),r.Node.prototype._toKonvaCanvas.call(this,S)}_checkVisibility(){this.visible()?this.canvas._canvas.style.display="block":this.canvas._canvas.style.display="none"}_setSmoothEnabled(){this.getContext()._context.imageSmoothingEnabled=this.imageSmoothingEnabled()}getWidth(){if(this.parent)return this.parent.width()}setWidth(){t.Util.warn('Can not change width of layer. Use "stage.width(value)" function instead.')}getHeight(){if(this.parent)return this.parent.height()}setHeight(){t.Util.warn('Can not change height of layer. Use "stage.height(value)" function instead.')}batchDraw(){return this._waitingForDraw||(this._waitingForDraw=!0,t.Util.requestAnimFrame(()=>{this.draw(),this._waitingForDraw=!1})),this}getIntersection(S){if(!this.isListening()||!this.isVisible())return null;let w=1,T=!1;for(;;){for(let _=0;_<p;_++){const C=h[_],N=this._getIntersection({x:S.x+C.x*w,y:S.y+C.y*w}),A=N.shape;if(A)return A;if(T=!!N.antialiased,!N.antialiased)break}if(T)w+=1;else return null}}_getIntersection(S){const w=this.hitCanvas.pixelRatio,T=this.hitCanvas.context.getImageData(Math.round(S.x*w),Math.round(S.y*w),1,1).data,_=T[3];if(_===255){const C=t.Util._rgbToHex(T[0],T[1],T[2]),N=s.shapes[l+C];return N?{shape:N}:{antialiased:!0}}else if(_>0)return{antialiased:!0};return{}}drawScene(S,w){const T=this.getLayer(),_=S||T&&T.getCanvas();return this._fire(u,{node:this}),this.clearBeforeDraw()&&_.getContext().clear(),e.Container.prototype.drawScene.call(this,_,w),this._fire(c,{node:this}),this}drawHit(S,w){const T=this.getLayer(),_=S||T&&T.hitCanvas;return T&&T.clearBeforeDraw()&&T.getHitCanvas().getContext().clear(),e.Container.prototype.drawHit.call(this,_,w),this}enableHitGraph(){return this.hitGraphEnabled(!0),this}disableHitGraph(){return this.hitGraphEnabled(!1),this}setHitGraphEnabled(S){t.Util.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening(S)}getHitGraphEnabled(S){return t.Util.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening()}toggleHitCanvas(){if(!this.parent||!this.parent.content)return;const S=this.parent;!!this.hitCanvas._canvas.parentNode?S.content.removeChild(this.hitCanvas._canvas):S.content.appendChild(this.hitCanvas._canvas)}destroy(){return t.Util.releaseCanvas(this.getNativeCanvasElement(),this.getHitCanvas()._canvas),super.destroy()}}return eg.Layer=v,v.prototype.nodeType="Layer",(0,o._registerNode)(v),n.Factory.addGetterSetter(v,"imageSmoothingEnabled",!0),n.Factory.addGetterSetter(v,"clearBeforeDraw",!0),n.Factory.addGetterSetter(v,"hitGraphEnabled",!0,(0,a.getBooleanValidator)()),eg}var tg={},b5;function yG(){if(b5)return tg;b5=1,Object.defineProperty(tg,"__esModule",{value:!0}),tg.FastLayer=void 0;const t=mi(),e=_R(),r=Tr();let n=class extends e.Layer{constructor(a){super(a),this.listening(!1),t.Util.warn('Konva.Fast layer is deprecated. Please use "new Konva.Layer({ listening: false })" instead.')}};return tg.FastLayer=n,n.prototype.nodeType="FastLayer",(0,r._registerNode)(n),tg}var rg={},w5;function S_(){if(w5)return rg;w5=1,Object.defineProperty(rg,"__esModule",{value:!0}),rg.Group=void 0;const t=mi(),e=B1(),r=Tr();let n=class extends e.Container{_validateAdd(a){const s=a.getType();s!=="Group"&&s!=="Shape"&&t.Util.throw("You may only add groups and shapes to groups.")}};return rg.Group=n,n.prototype.nodeType="Group",(0,r._registerNode)(n),rg}var ng={},S5;function k_(){if(S5)return ng;S5=1,Object.defineProperty(ng,"__esModule",{value:!0}),ng.Animation=void 0;const t=Tr(),e=mi(),r=(function(){return t.glob.performance&&t.glob.performance.now?function(){return t.glob.performance.now()}:function(){return new Date().getTime()}})();let n=class Ep{constructor(a,s){this.id=Ep.animIdCounter++,this.frame={time:0,timeDiff:0,lastTime:r(),frameRate:0},this.func=a,this.setLayers(s)}setLayers(a){let s=[];return a&&(s=Array.isArray(a)?a:[a]),this.layers=s,this}getLayers(){return this.layers}addLayer(a){const s=this.layers,o=s.length;for(let l=0;l<o;l++)if(s[l]._id===a._id)return!1;return this.layers.push(a),!0}isRunning(){const s=Ep.animations,o=s.length;for(let l=0;l<o;l++)if(s[l].id===this.id)return!0;return!1}start(){return this.stop(),this.frame.timeDiff=0,this.frame.lastTime=r(),Ep._addAnimation(this),this}stop(){return Ep._removeAnimation(this),this}_updateFrameObject(a){this.frame.timeDiff=a-this.frame.lastTime,this.frame.lastTime=a,this.frame.time+=this.frame.timeDiff,this.frame.frameRate=1e3/this.frame.timeDiff}static _addAnimation(a){this.animations.push(a),this._handleAnimation()}static _removeAnimation(a){const s=a.id,o=this.animations,l=o.length;for(let u=0;u<l;u++)if(o[u].id===s){this.animations.splice(u,1);break}}static _runFrames(){const a={},s=this.animations;for(let o=0;o<s.length;o++){const l=s[o],u=l.layers,c=l.func;l._updateFrameObject(r());const h=u.length;let p;if(c?p=c.call(l,l.frame)!==!1:p=!0,!!p)for(let v=0;v<h;v++){const y=u[v];y._id!==void 0&&(a[y._id]=y)}}for(const o in a)a.hasOwnProperty(o)&&a[o].batchDraw()}static _animationLoop(){const a=Ep;a.animations.length?(a._runFrames(),e.Util.requestAnimFrame(a._animationLoop)):a.animRunning=!1}static _handleAnimation(){this.animRunning||(this.animRunning=!0,e.Util.requestAnimFrame(this._animationLoop))}};return ng.Animation=n,n.animations=[],n.animIdCounter=0,n.animRunning=!1,ng}var M2={},k5;function xG(){return k5||(k5=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Easings=t.Tween=void 0;const e=mi(),r=k_(),n=Ti(),i=Tr();let a={node:1,duration:1,easing:1,onFinish:1,yoyo:1},s=1,o=2,l=3,u=0,c=["fill","stroke","shadowColor"];class h{constructor(y,S,w,T,_,C,N){this.prop=y,this.propFunc=S,this.begin=T,this._pos=T,this.duration=C,this._change=0,this.prevPos=0,this.yoyo=N,this._time=0,this._position=0,this._startTime=0,this._finish=0,this.func=w,this._change=_-this.begin,this.pause()}fire(y){const S=this[y];S&&S()}setTime(y){y>this.duration?this.yoyo?(this._time=this.duration,this.reverse()):this.finish():y<0?this.yoyo?(this._time=0,this.play()):this.reset():(this._time=y,this.update())}getTime(){return this._time}setPosition(y){this.prevPos=this._pos,this.propFunc(y),this._pos=y}getPosition(y){return y===void 0&&(y=this._time),this.func(y,this.begin,this._change,this.duration)}play(){this.state=o,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onPlay")}reverse(){this.state=l,this._time=this.duration-this._time,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onReverse")}seek(y){this.pause(),this._time=y,this.update(),this.fire("onSeek")}reset(){this.pause(),this._time=0,this.update(),this.fire("onReset")}finish(){this.pause(),this._time=this.duration,this.update(),this.fire("onFinish")}update(){this.setPosition(this.getPosition(this._time)),this.fire("onUpdate")}onEnterFrame(){const y=this.getTimer()-this._startTime;this.state===o?this.setTime(y):this.state===l&&this.setTime(this.duration-y)}pause(){this.state=s,this.fire("onPause")}getTimer(){return new Date().getTime()}}class p{constructor(y){let S=this,w=y.node,T=w._id,_,C=y.easing||t.Easings.Linear,N=!!y.yoyo,A;typeof y.duration>"u"?_=.3:y.duration===0?_=.001:_=y.duration,this.node=w,this._id=u++;const I=w.getLayer()||(w instanceof i.Konva.Stage?w.getLayers():null);I||e.Util.error("Tween constructor have `node` that is not in a layer. Please add node into layer first."),this.anim=new r.Animation(function(){S.tween.onEnterFrame()},I),this.tween=new h(A,function(j){S._tweenFunc(j)},C,0,1,_*1e3,N),this._addListeners(),p.attrs[T]||(p.attrs[T]={}),p.attrs[T][this._id]||(p.attrs[T][this._id]={}),p.tweens[T]||(p.tweens[T]={});for(A in y)a[A]===void 0&&this._addAttr(A,y[A]);this.reset(),this.onFinish=y.onFinish,this.onReset=y.onReset,this.onUpdate=y.onUpdate}_addAttr(y,S){let w=this.node,T=w._id,_,C,N,A,I,j,O,F;if(N=p.tweens[T][y],N&&delete p.attrs[T][N][y],_=w.getAttr(y),e.Util._isArray(S))if(C=[],I=Math.max(S.length,_.length),y==="points"&&S.length!==_.length&&(S.length>_.length?(O=_,_=e.Util._prepareArrayForTween(_,S,w.closed())):(j=S,S=e.Util._prepareArrayForTween(S,_,w.closed()))),y.indexOf("fill")===0)for(A=0;A<I;A++)if(A%2===0)C.push(S[A]-_[A]);else{const B=e.Util.colorToRGBA(_[A]);F=e.Util.colorToRGBA(S[A]),_[A]=B,C.push({r:F.r-B.r,g:F.g-B.g,b:F.b-B.b,a:F.a-B.a})}else for(A=0;A<I;A++)C.push(S[A]-_[A]);else c.indexOf(y)!==-1?(_=e.Util.colorToRGBA(_),F=e.Util.colorToRGBA(S),C={r:F.r-_.r,g:F.g-_.g,b:F.b-_.b,a:F.a-_.a}):C=S-_;p.attrs[T][this._id][y]={start:_,diff:C,end:S,trueEnd:j,trueStart:O},p.tweens[T][y]=this._id}_tweenFunc(y){let S=this.node,w=p.attrs[S._id][this._id],T,_,C,N,A,I,j,O;for(T in w){if(_=w[T],C=_.start,N=_.diff,O=_.end,e.Util._isArray(C))if(A=[],j=Math.max(C.length,O.length),T.indexOf("fill")===0)for(I=0;I<j;I++)I%2===0?A.push((C[I]||0)+N[I]*y):A.push("rgba("+Math.round(C[I].r+N[I].r*y)+","+Math.round(C[I].g+N[I].g*y)+","+Math.round(C[I].b+N[I].b*y)+","+(C[I].a+N[I].a*y)+")");else for(I=0;I<j;I++)A.push((C[I]||0)+N[I]*y);else c.indexOf(T)!==-1?A="rgba("+Math.round(C.r+N.r*y)+","+Math.round(C.g+N.g*y)+","+Math.round(C.b+N.b*y)+","+(C.a+N.a*y)+")":A=C+N*y;S.setAttr(T,A)}}_addListeners(){this.tween.onPlay=()=>{this.anim.start()},this.tween.onReverse=()=>{this.anim.start()},this.tween.onPause=()=>{this.anim.stop()},this.tween.onFinish=()=>{const y=this.node,S=p.attrs[y._id][this._id];S.points&&S.points.trueEnd&&y.setAttr("points",S.points.trueEnd),this.onFinish&&this.onFinish.call(this)},this.tween.onReset=()=>{const y=this.node,S=p.attrs[y._id][this._id];S.points&&S.points.trueStart&&y.points(S.points.trueStart),this.onReset&&this.onReset()},this.tween.onUpdate=()=>{this.onUpdate&&this.onUpdate.call(this)}}play(){return this.tween.play(),this}reverse(){return this.tween.reverse(),this}reset(){return this.tween.reset(),this}seek(y){return this.tween.seek(y*1e3),this}pause(){return this.tween.pause(),this}finish(){return this.tween.finish(),this}destroy(){let y=this.node._id,S=this._id,w=p.tweens[y],T;this.pause();for(T in w)delete p.tweens[y][T];delete p.attrs[y][S]}}t.Tween=p,p.attrs={},p.tweens={},n.Node.prototype.to=function(v){const y=v.onFinish;v.node=this,v.onFinish=function(){this.destroy(),y&&y()},new p(v).play()},t.Easings={BackEaseIn(v,y,S,w){return S*(v/=w)*v*((1.70158+1)*v-1.70158)+y},BackEaseOut(v,y,S,w){return S*((v=v/w-1)*v*((1.70158+1)*v+1.70158)+1)+y},BackEaseInOut(v,y,S,w){let T=1.70158;return(v/=w/2)<1?S/2*(v*v*(((T*=1.525)+1)*v-T))+y:S/2*((v-=2)*v*(((T*=1.525)+1)*v+T)+2)+y},ElasticEaseIn(v,y,S,w,T,_){let C=0;return v===0?y:(v/=w)===1?y+S:(_||(_=w*.3),!T||T<Math.abs(S)?(T=S,C=_/4):C=_/(2*Math.PI)*Math.asin(S/T),-(T*Math.pow(2,10*(v-=1))*Math.sin((v*w-C)*(2*Math.PI)/_))+y)},ElasticEaseOut(v,y,S,w,T,_){let C=0;return v===0?y:(v/=w)===1?y+S:(_||(_=w*.3),!T||T<Math.abs(S)?(T=S,C=_/4):C=_/(2*Math.PI)*Math.asin(S/T),T*Math.pow(2,-10*v)*Math.sin((v*w-C)*(2*Math.PI)/_)+S+y)},ElasticEaseInOut(v,y,S,w,T,_){let C=0;return v===0?y:(v/=w/2)===2?y+S:(_||(_=w*(.3*1.5)),!T||T<Math.abs(S)?(T=S,C=_/4):C=_/(2*Math.PI)*Math.asin(S/T),v<1?-.5*(T*Math.pow(2,10*(v-=1))*Math.sin((v*w-C)*(2*Math.PI)/_))+y:T*Math.pow(2,-10*(v-=1))*Math.sin((v*w-C)*(2*Math.PI)/_)*.5+S+y)},BounceEaseOut(v,y,S,w){return(v/=w)<1/2.75?S*(7.5625*v*v)+y:v<2/2.75?S*(7.5625*(v-=1.5/2.75)*v+.75)+y:v<2.5/2.75?S*(7.5625*(v-=2.25/2.75)*v+.9375)+y:S*(7.5625*(v-=2.625/2.75)*v+.984375)+y},BounceEaseIn(v,y,S,w){return S-t.Easings.BounceEaseOut(w-v,0,S,w)+y},BounceEaseInOut(v,y,S,w){return v<w/2?t.Easings.BounceEaseIn(v*2,0,S,w)*.5+y:t.Easings.BounceEaseOut(v*2-w,0,S,w)*.5+S*.5+y},EaseIn(v,y,S,w){return S*(v/=w)*v+y},EaseOut(v,y,S,w){return-S*(v/=w)*(v-2)+y},EaseInOut(v,y,S,w){return(v/=w/2)<1?S/2*v*v+y:-S/2*(--v*(v-2)-1)+y},StrongEaseIn(v,y,S,w){return S*(v/=w)*v*v*v*v+y},StrongEaseOut(v,y,S,w){return S*((v=v/w-1)*v*v*v*v+1)+y},StrongEaseInOut(v,y,S,w){return(v/=w/2)<1?S/2*v*v*v*v*v+y:S/2*((v-=2)*v*v*v*v+2)+y},Linear(v,y,S,w){return S*v/w+y}}})(M2)),M2}var _5;function JS(){return _5||(_5=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Konva=void 0;const e=Tr(),r=mi(),n=Ti(),i=B1(),a=vG(),s=_R(),o=yG(),l=S_(),u=w_(),c=Sa(),h=k_(),p=xG(),v=SR(),y=F1();t.Konva=r.Util._assign(e.Konva,{Util:r.Util,Transform:r.Transform,Node:n.Node,Container:i.Container,Stage:a.Stage,stages:a.stages,Layer:s.Layer,FastLayer:o.FastLayer,Group:l.Group,DD:u.DD,Shape:c.Shape,shapes:c.shapes,Animation:h.Animation,Tween:p.Tween,Easings:p.Easings,Context:v.Context,Canvas:y.Canvas}),t.default=t.Konva})(k2)),k2}var ig={},C5;function bG(){if(C5)return ig;C5=1,Object.defineProperty(ig,"__esModule",{value:!0}),ig.Arc=void 0;const t=Pr(),e=Sa(),r=Tr(),n=Ar(),i=Tr();let a=class extends e.Shape{_sceneFunc(o){const l=r.Konva.getAngle(this.angle()),u=this.clockwise();o.beginPath(),o.arc(0,0,this.outerRadius(),0,l,u),o.arc(0,0,this.innerRadius(),l,0,!u),o.closePath(),o.fillStrokeShape(this)}getWidth(){return this.outerRadius()*2}getHeight(){return this.outerRadius()*2}setWidth(o){this.outerRadius(o/2)}setHeight(o){this.outerRadius(o/2)}getSelfRect(){const o=this.innerRadius(),l=this.outerRadius(),u=this.clockwise(),c=r.Konva.getAngle(u?360-this.angle():this.angle()),h=Math.cos(Math.min(c,Math.PI)),p=1,v=Math.sin(Math.min(Math.max(Math.PI,c),3*Math.PI/2)),y=Math.sin(Math.min(c,Math.PI/2)),S=h*(h>0?o:l),w=p*l,T=v*(v>0?o:l),_=y*(y>0?l:o);return{x:S,y:u?-1*_:T,width:w-S,height:_-T}}};return ig.Arc=a,a.prototype._centroid=!0,a.prototype.className="Arc",a.prototype._attrsAffectingSize=["innerRadius","outerRadius"],(0,i._registerNode)(a),t.Factory.addGetterSetter(a,"innerRadius",0,(0,n.getNumberValidator)()),t.Factory.addGetterSetter(a,"outerRadius",0,(0,n.getNumberValidator)()),t.Factory.addGetterSetter(a,"angle",0,(0,n.getNumberValidator)()),t.Factory.addGetterSetter(a,"clockwise",!1,(0,n.getBooleanValidator)()),ig}var ag={},sg={},E5;function CR(){if(E5)return sg;E5=1,Object.defineProperty(sg,"__esModule",{value:!0}),sg.Line=void 0;const t=Pr(),e=Tr(),r=Sa(),n=Ar();function i(o,l,u,c,h,p,v){const y=Math.sqrt(Math.pow(u-o,2)+Math.pow(c-l,2)),S=Math.sqrt(Math.pow(h-u,2)+Math.pow(p-c,2)),w=v*y/(y+S),T=v*S/(y+S),_=u-w*(h-o),C=c-w*(p-l),N=u+T*(h-o),A=c+T*(p-l);return[_,C,N,A]}function a(o,l){const u=o.length,c=[];for(let h=2;h<u-2;h+=2){const p=i(o[h-2],o[h-1],o[h],o[h+1],o[h+2],o[h+3],l);isNaN(p[0])||(c.push(p[0]),c.push(p[1]),c.push(o[h]),c.push(o[h+1]),c.push(p[2]),c.push(p[3]))}return c}class s extends r.Shape{constructor(l){super(l),this.on("pointsChange.konva tensionChange.konva closedChange.konva bezierChange.konva",function(){this._clearCache("tensionPoints")})}_sceneFunc(l){let u=this.points(),c=u.length,h=this.tension(),p=this.closed(),v=this.bezier(),y,S,w;if(c){if(l.beginPath(),l.moveTo(u[0],u[1]),h!==0&&c>4){for(y=this.getTensionPoints(),S=y.length,w=p?0:4,p||l.quadraticCurveTo(y[0],y[1],y[2],y[3]);w<S-2;)l.bezierCurveTo(y[w++],y[w++],y[w++],y[w++],y[w++],y[w++]);p||l.quadraticCurveTo(y[S-2],y[S-1],u[c-2],u[c-1])}else if(v)for(w=2;w<c;)l.bezierCurveTo(u[w++],u[w++],u[w++],u[w++],u[w++],u[w++]);else for(w=2;w<c;w+=2)l.lineTo(u[w],u[w+1]);p?(l.closePath(),l.fillStrokeShape(this)):l.strokeShape(this)}}getTensionPoints(){return this._getCache("tensionPoints",this._getTensionPoints)}_getTensionPoints(){return this.closed()?this._getTensionPointsClosed():a(this.points(),this.tension())}_getTensionPointsClosed(){const l=this.points(),u=l.length,c=this.tension(),h=i(l[u-2],l[u-1],l[0],l[1],l[2],l[3],c),p=i(l[u-4],l[u-3],l[u-2],l[u-1],l[0],l[1],c),v=a(l,c);return[h[2],h[3]].concat(v).concat([p[0],p[1],l[u-2],l[u-1],p[2],p[3],h[0],h[1],l[0],l[1]])}getWidth(){return this.getSelfRect().width}getHeight(){return this.getSelfRect().height}getSelfRect(){let l=this.points();if(l.length<4)return{x:l[0]||0,y:l[1]||0,width:0,height:0};this.tension()!==0?l=[l[0],l[1],...this._getTensionPoints(),l[l.length-2],l[l.length-1]]:l=this.points();let u=l[0],c=l[0],h=l[1],p=l[1],v,y;for(let S=0;S<l.length/2;S++)v=l[S*2],y=l[S*2+1],u=Math.min(u,v),c=Math.max(c,v),h=Math.min(h,y),p=Math.max(p,y);return{x:u,y:h,width:c-u,height:p-h}}}return sg.Line=s,s.prototype.className="Line",s.prototype._attrsAffectingSize=["points","bezier","tension"],(0,e._registerNode)(s),t.Factory.addGetterSetter(s,"closed",!1),t.Factory.addGetterSetter(s,"bezier",!1),t.Factory.addGetterSetter(s,"tension",0,(0,n.getNumberValidator)()),t.Factory.addGetterSetter(s,"points",[],(0,n.getNumberArrayValidator)()),sg}var og={},A2={},T5;function wG(){return T5||(T5=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.t2length=t.getQuadraticArcLength=t.getCubicArcLength=t.binomialCoefficients=t.cValues=t.tValues=void 0,t.tValues=[[],[],[-.5773502691896257,.5773502691896257],[0,-.7745966692414834,.7745966692414834],[-.33998104358485626,.33998104358485626,-.8611363115940526,.8611363115940526],[0,-.5384693101056831,.5384693101056831,-.906179845938664,.906179845938664],[.6612093864662645,-.6612093864662645,-.2386191860831969,.2386191860831969,-.932469514203152,.932469514203152],[0,.4058451513773972,-.4058451513773972,-.7415311855993945,.7415311855993945,-.9491079123427585,.9491079123427585],[-.1834346424956498,.1834346424956498,-.525532409916329,.525532409916329,-.7966664774136267,.7966664774136267,-.9602898564975363,.9602898564975363],[0,-.8360311073266358,.8360311073266358,-.9681602395076261,.9681602395076261,-.3242534234038089,.3242534234038089,-.6133714327005904,.6133714327005904],[-.14887433898163122,.14887433898163122,-.4333953941292472,.4333953941292472,-.6794095682990244,.6794095682990244,-.8650633666889845,.8650633666889845,-.9739065285171717,.9739065285171717],[0,-.26954315595234496,.26954315595234496,-.5190961292068118,.5190961292068118,-.7301520055740494,.7301520055740494,-.8870625997680953,.8870625997680953,-.978228658146057,.978228658146057],[-.1252334085114689,.1252334085114689,-.3678314989981802,.3678314989981802,-.5873179542866175,.5873179542866175,-.7699026741943047,.7699026741943047,-.9041172563704749,.9041172563704749,-.9815606342467192,.9815606342467192],[0,-.2304583159551348,.2304583159551348,-.44849275103644687,.44849275103644687,-.6423493394403402,.6423493394403402,-.8015780907333099,.8015780907333099,-.9175983992229779,.9175983992229779,-.9841830547185881,.9841830547185881],[-.10805494870734367,.10805494870734367,-.31911236892788974,.31911236892788974,-.5152486363581541,.5152486363581541,-.6872929048116855,.6872929048116855,-.827201315069765,.827201315069765,-.9284348836635735,.9284348836635735,-.9862838086968123,.9862838086968123],[0,-.20119409399743451,.20119409399743451,-.3941513470775634,.3941513470775634,-.5709721726085388,.5709721726085388,-.7244177313601701,.7244177313601701,-.8482065834104272,.8482065834104272,-.937273392400706,.937273392400706,-.9879925180204854,.9879925180204854],[-.09501250983763744,.09501250983763744,-.2816035507792589,.2816035507792589,-.45801677765722737,.45801677765722737,-.6178762444026438,.6178762444026438,-.755404408355003,.755404408355003,-.8656312023878318,.8656312023878318,-.9445750230732326,.9445750230732326,-.9894009349916499,.9894009349916499],[0,-.17848418149584785,.17848418149584785,-.3512317634538763,.3512317634538763,-.5126905370864769,.5126905370864769,-.6576711592166907,.6576711592166907,-.7815140038968014,.7815140038968014,-.8802391537269859,.8802391537269859,-.9506755217687678,.9506755217687678,-.9905754753144174,.9905754753144174],[-.0847750130417353,.0847750130417353,-.2518862256915055,.2518862256915055,-.41175116146284263,.41175116146284263,-.5597708310739475,.5597708310739475,-.6916870430603532,.6916870430603532,-.8037049589725231,.8037049589725231,-.8926024664975557,.8926024664975557,-.9558239495713977,.9558239495713977,-.9915651684209309,.9915651684209309],[0,-.16035864564022537,.16035864564022537,-.31656409996362983,.31656409996362983,-.46457074137596094,.46457074137596094,-.600545304661681,.600545304661681,-.7209661773352294,.7209661773352294,-.8227146565371428,.8227146565371428,-.9031559036148179,.9031559036148179,-.96020815213483,.96020815213483,-.9924068438435844,.9924068438435844],[-.07652652113349734,.07652652113349734,-.22778585114164507,.22778585114164507,-.37370608871541955,.37370608871541955,-.5108670019508271,.5108670019508271,-.636053680726515,.636053680726515,-.7463319064601508,.7463319064601508,-.8391169718222188,.8391169718222188,-.912234428251326,.912234428251326,-.9639719272779138,.9639719272779138,-.9931285991850949,.9931285991850949],[0,-.1455618541608951,.1455618541608951,-.2880213168024011,.2880213168024011,-.4243421202074388,.4243421202074388,-.5516188358872198,.5516188358872198,-.6671388041974123,.6671388041974123,-.7684399634756779,.7684399634756779,-.8533633645833173,.8533633645833173,-.9200993341504008,.9200993341504008,-.9672268385663063,.9672268385663063,-.9937521706203895,.9937521706203895],[-.06973927331972223,.06973927331972223,-.20786042668822127,.20786042668822127,-.34193582089208424,.34193582089208424,-.469355837986757,.469355837986757,-.5876404035069116,.5876404035069116,-.6944872631866827,.6944872631866827,-.7878168059792081,.7878168059792081,-.8658125777203002,.8658125777203002,-.926956772187174,.926956772187174,-.9700604978354287,.9700604978354287,-.9942945854823992,.9942945854823992],[0,-.1332568242984661,.1332568242984661,-.26413568097034495,.26413568097034495,-.3903010380302908,.3903010380302908,-.5095014778460075,.5095014778460075,-.6196098757636461,.6196098757636461,-.7186613631319502,.7186613631319502,-.8048884016188399,.8048884016188399,-.8767523582704416,.8767523582704416,-.9329710868260161,.9329710868260161,-.9725424712181152,.9725424712181152,-.9947693349975522,.9947693349975522],[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213]],t.cValues=[[],[],[1,1],[.8888888888888888,.5555555555555556,.5555555555555556],[.6521451548625461,.6521451548625461,.34785484513745385,.34785484513745385],[.5688888888888889,.47862867049936647,.47862867049936647,.23692688505618908,.23692688505618908],[.3607615730481386,.3607615730481386,.46791393457269104,.46791393457269104,.17132449237917036,.17132449237917036],[.4179591836734694,.3818300505051189,.3818300505051189,.27970539148927664,.27970539148927664,.1294849661688697,.1294849661688697],[.362683783378362,.362683783378362,.31370664587788727,.31370664587788727,.22238103445337448,.22238103445337448,.10122853629037626,.10122853629037626],[.3302393550012598,.1806481606948574,.1806481606948574,.08127438836157441,.08127438836157441,.31234707704000286,.31234707704000286,.26061069640293544,.26061069640293544],[.29552422471475287,.29552422471475287,.26926671930999635,.26926671930999635,.21908636251598204,.21908636251598204,.1494513491505806,.1494513491505806,.06667134430868814,.06667134430868814],[.2729250867779006,.26280454451024665,.26280454451024665,.23319376459199048,.23319376459199048,.18629021092773426,.18629021092773426,.1255803694649046,.1255803694649046,.05566856711617366,.05566856711617366],[.24914704581340277,.24914704581340277,.2334925365383548,.2334925365383548,.20316742672306592,.20316742672306592,.16007832854334622,.16007832854334622,.10693932599531843,.10693932599531843,.04717533638651183,.04717533638651183],[.2325515532308739,.22628318026289723,.22628318026289723,.2078160475368885,.2078160475368885,.17814598076194574,.17814598076194574,.13887351021978725,.13887351021978725,.09212149983772845,.09212149983772845,.04048400476531588,.04048400476531588],[.2152638534631578,.2152638534631578,.2051984637212956,.2051984637212956,.18553839747793782,.18553839747793782,.15720316715819355,.15720316715819355,.12151857068790319,.12151857068790319,.08015808715976021,.08015808715976021,.03511946033175186,.03511946033175186],[.2025782419255613,.19843148532711158,.19843148532711158,.1861610000155622,.1861610000155622,.16626920581699392,.16626920581699392,.13957067792615432,.13957067792615432,.10715922046717194,.10715922046717194,.07036604748810812,.07036604748810812,.03075324199611727,.03075324199611727],[.1894506104550685,.1894506104550685,.18260341504492358,.18260341504492358,.16915651939500254,.16915651939500254,.14959598881657674,.14959598881657674,.12462897125553388,.12462897125553388,.09515851168249279,.09515851168249279,.062253523938647894,.062253523938647894,.027152459411754096,.027152459411754096],[.17944647035620653,.17656270536699264,.17656270536699264,.16800410215645004,.16800410215645004,.15404576107681028,.15404576107681028,.13513636846852548,.13513636846852548,.11188384719340397,.11188384719340397,.08503614831717918,.08503614831717918,.0554595293739872,.0554595293739872,.02414830286854793,.02414830286854793],[.1691423829631436,.1691423829631436,.16427648374583273,.16427648374583273,.15468467512626524,.15468467512626524,.14064291467065065,.14064291467065065,.12255520671147846,.12255520671147846,.10094204410628717,.10094204410628717,.07642573025488905,.07642573025488905,.0497145488949698,.0497145488949698,.02161601352648331,.02161601352648331],[.1610544498487837,.15896884339395434,.15896884339395434,.15276604206585967,.15276604206585967,.1426067021736066,.1426067021736066,.12875396253933621,.12875396253933621,.11156664554733399,.11156664554733399,.09149002162245,.09149002162245,.06904454273764123,.06904454273764123,.0448142267656996,.0448142267656996,.019461788229726478,.019461788229726478],[.15275338713072584,.15275338713072584,.14917298647260374,.14917298647260374,.14209610931838204,.14209610931838204,.13168863844917664,.13168863844917664,.11819453196151841,.11819453196151841,.10193011981724044,.10193011981724044,.08327674157670475,.08327674157670475,.06267204833410907,.06267204833410907,.04060142980038694,.04060142980038694,.017614007139152118,.017614007139152118],[.14608113364969041,.14452440398997005,.14452440398997005,.13988739479107315,.13988739479107315,.13226893863333747,.13226893863333747,.12183141605372853,.12183141605372853,.10879729916714838,.10879729916714838,.09344442345603386,.09344442345603386,.0761001136283793,.0761001136283793,.057134425426857205,.057134425426857205,.036953789770852494,.036953789770852494,.016017228257774335,.016017228257774335],[.13925187285563198,.13925187285563198,.13654149834601517,.13654149834601517,.13117350478706238,.13117350478706238,.12325237681051242,.12325237681051242,.11293229608053922,.11293229608053922,.10041414444288096,.10041414444288096,.08594160621706773,.08594160621706773,.06979646842452049,.06979646842452049,.052293335152683286,.052293335152683286,.03377490158481415,.03377490158481415,.0146279952982722,.0146279952982722],[.13365457218610619,.1324620394046966,.1324620394046966,.12890572218808216,.12890572218808216,.12304908430672953,.12304908430672953,.11499664022241136,.11499664022241136,.10489209146454141,.10489209146454141,.09291576606003515,.09291576606003515,.07928141177671895,.07928141177671895,.06423242140852585,.06423242140852585,.04803767173108467,.04803767173108467,.030988005856979445,.030988005856979445,.013411859487141771,.013411859487141771],[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872]],t.binomialCoefficients=[[1],[1,1],[1,2,1],[1,3,3,1]];const e=(s,o,l)=>{let u,c;const p=l/2;u=0;for(let v=0;v<20;v++)c=p*t.tValues[20][v]+p,u+=t.cValues[20][v]*n(s,o,c);return p*u};t.getCubicArcLength=e;const r=(s,o,l)=>{l===void 0&&(l=1);const u=s[0]-2*s[1]+s[2],c=o[0]-2*o[1]+o[2],h=2*s[1]-2*s[0],p=2*o[1]-2*o[0],v=4*(u*u+c*c),y=4*(u*h+c*p),S=h*h+p*p;if(v===0)return l*Math.sqrt(Math.pow(s[2]-s[0],2)+Math.pow(o[2]-o[0],2));const w=y/(2*v),T=S/v,_=l+w,C=T-w*w,N=_*_+C>0?Math.sqrt(_*_+C):0,A=w*w+C>0?Math.sqrt(w*w+C):0,I=w+Math.sqrt(w*w+C)!==0?C*Math.log(Math.abs((_+N)/(w+A))):0;return Math.sqrt(v)/2*(_*N-w*A+I)};t.getQuadraticArcLength=r;function n(s,o,l){const u=i(1,l,s),c=i(1,l,o),h=u*u+c*c;return Math.sqrt(h)}const i=(s,o,l)=>{const u=l.length-1;let c,h;if(u===0)return 0;if(s===0){h=0;for(let p=0;p<=u;p++)h+=t.binomialCoefficients[u][p]*Math.pow(1-o,u-p)*Math.pow(o,p)*l[p];return h}else{c=new Array(u);for(let p=0;p<u;p++)c[p]=u*(l[p+1]-l[p]);return i(s-1,o,c)}},a=(s,o,l)=>{let u=1,c=s/o,h=(s-l(c))/o,p=0;for(;u>.001;){const v=l(c+h),y=Math.abs(s-v)/o;if(y<u)u=y,c+=h;else{const S=l(c-h),w=Math.abs(s-S)/o;w<u?(u=w,c-=h):h/=2}if(p++,p>500)break}return c};t.t2length=a})(A2)),A2}var N5;function __(){if(N5)return og;N5=1,Object.defineProperty(og,"__esModule",{value:!0}),og.Path=void 0;const t=Pr(),e=Sa(),r=Tr(),n=wG();class i extends e.Shape{constructor(s){super(s),this.dataArray=[],this.pathLength=0,this._readDataAttribute(),this.on("dataChange.konva",function(){this._readDataAttribute()})}_readDataAttribute(){this.dataArray=i.parsePathData(this.data()),this.pathLength=i.getPathLength(this.dataArray)}_sceneFunc(s){const o=this.dataArray;s.beginPath();let l=!1;for(let N=0;N<o.length;N++){const A=o[N].command,I=o[N].points;switch(A){case"L":s.lineTo(I[0],I[1]);break;case"M":s.moveTo(I[0],I[1]);break;case"C":s.bezierCurveTo(I[0],I[1],I[2],I[3],I[4],I[5]);break;case"Q":s.quadraticCurveTo(I[0],I[1],I[2],I[3]);break;case"A":var u=I[0],c=I[1],h=I[2],p=I[3],v=I[4],y=I[5],S=I[6],w=I[7],T=h>p?h:p,_=h>p?1:h/p,C=h>p?p/h:1;s.translate(u,c),s.rotate(S),s.scale(_,C),s.arc(0,0,T,v,v+y,1-w),s.scale(1/_,1/C),s.rotate(-S),s.translate(-u,-c);break;case"z":l=!0,s.closePath();break}}!l&&!this.hasFill()?s.strokeShape(this):s.fillStrokeShape(this)}getSelfRect(){let s=[];this.dataArray.forEach(function(v){if(v.command==="A"){const y=v.points[4],S=v.points[5],w=v.points[4]+S;let T=Math.PI/180;if(Math.abs(y-w)<T&&(T=Math.abs(y-w)),S<0)for(let _=y-T;_>w;_-=T){const C=i.getPointOnEllipticalArc(v.points[0],v.points[1],v.points[2],v.points[3],_,0);s.push(C.x,C.y)}else for(let _=y+T;_<w;_+=T){const C=i.getPointOnEllipticalArc(v.points[0],v.points[1],v.points[2],v.points[3],_,0);s.push(C.x,C.y)}}else if(v.command==="C")for(let y=0;y<=1;y+=.01){const S=i.getPointOnCubicBezier(y,v.start.x,v.start.y,v.points[0],v.points[1],v.points[2],v.points[3],v.points[4],v.points[5]);s.push(S.x,S.y)}else s=s.concat(v.points)});let o=s[0],l=s[0],u=s[1],c=s[1],h,p;for(let v=0;v<s.length/2;v++)h=s[v*2],p=s[v*2+1],isNaN(h)||(o=Math.min(o,h),l=Math.max(l,h)),isNaN(p)||(u=Math.min(u,p),c=Math.max(c,p));return{x:o,y:u,width:l-o,height:c-u}}getLength(){return this.pathLength}getPointAtLength(s){return i.getPointAtLengthOfDataArray(s,this.dataArray)}static getLineLength(s,o,l,u){return Math.sqrt((l-s)*(l-s)+(u-o)*(u-o))}static getPathLength(s){let o=0;for(let l=0;l<s.length;++l)o+=s[l].pathLength;return o}static getPointAtLengthOfDataArray(s,o){let l,u=0,c=o.length;if(!c)return null;for(;u<c&&s>o[u].pathLength;)s-=o[u].pathLength,++u;if(u===c)return l=o[u-1].points.slice(-2),{x:l[0],y:l[1]};if(s<.01)return l=o[u].points.slice(0,2),{x:l[0],y:l[1]};const h=o[u],p=h.points;switch(h.command){case"L":return i.getPointOnLine(s,h.start.x,h.start.y,p[0],p[1]);case"C":return i.getPointOnCubicBezier((0,n.t2length)(s,i.getPathLength(o),N=>(0,n.getCubicArcLength)([h.start.x,p[0],p[2],p[4]],[h.start.y,p[1],p[3],p[5]],N)),h.start.x,h.start.y,p[0],p[1],p[2],p[3],p[4],p[5]);case"Q":return i.getPointOnQuadraticBezier((0,n.t2length)(s,i.getPathLength(o),N=>(0,n.getQuadraticArcLength)([h.start.x,p[0],p[2]],[h.start.y,p[1],p[3]],N)),h.start.x,h.start.y,p[0],p[1],p[2],p[3]);case"A":var v=p[0],y=p[1],S=p[2],w=p[3],T=p[4],_=p[5],C=p[6];return T+=_*s/h.pathLength,i.getPointOnEllipticalArc(v,y,S,w,T,C)}return null}static getPointOnLine(s,o,l,u,c,h,p){h=h??o,p=p??l;const v=this.getLineLength(o,l,u,c);if(v<1e-10)return{x:o,y:l};if(u===o)return{x:h,y:p+(c>l?s:-s)};const y=(c-l)/(u-o),S=Math.sqrt(s*s/(1+y*y))*(u<o?-1:1),w=y*S;if(Math.abs(p-l-y*(h-o))<1e-10)return{x:h+S,y:p+w};const T=((h-o)*(u-o)+(p-l)*(c-l))/(v*v),_=o+T*(u-o),C=l+T*(c-l),N=this.getLineLength(h,p,_,C),A=Math.sqrt(s*s-N*N),I=Math.sqrt(A*A/(1+y*y))*(u<o?-1:1),j=y*I;return{x:_+I,y:C+j}}static getPointOnCubicBezier(s,o,l,u,c,h,p,v,y){function S(A){return A*A*A}function w(A){return 3*A*A*(1-A)}function T(A){return 3*A*(1-A)*(1-A)}function _(A){return(1-A)*(1-A)*(1-A)}const C=v*S(s)+h*w(s)+u*T(s)+o*_(s),N=y*S(s)+p*w(s)+c*T(s)+l*_(s);return{x:C,y:N}}static getPointOnQuadraticBezier(s,o,l,u,c,h,p){function v(_){return _*_}function y(_){return 2*_*(1-_)}function S(_){return(1-_)*(1-_)}const w=h*v(s)+u*y(s)+o*S(s),T=p*v(s)+c*y(s)+l*S(s);return{x:w,y:T}}static getPointOnEllipticalArc(s,o,l,u,c,h){const p=Math.cos(h),v=Math.sin(h),y={x:l*Math.cos(c),y:u*Math.sin(c)};return{x:s+(y.x*p-y.y*v),y:o+(y.x*v+y.y*p)}}static parsePathData(s){if(!s)return[];let o=s;const l=["m","M","l","L","v","V","h","H","z","Z","c","C","q","Q","t","T","s","S","a","A"];o=o.replace(new RegExp(" ","g"),",");for(var u=0;u<l.length;u++)o=o.replace(new RegExp(l[u],"g"),"|"+l[u]);const c=o.split("|"),h=[],p=[];let v=0,y=0;const S=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/gi;let w;for(u=1;u<c.length;u++){let D=c[u],H=D.charAt(0);for(D=D.slice(1),p.length=0;w=S.exec(D);)p.push(w[0]);const U=[];for(let W=0,Y=p.length;W<Y;W++){if(p[W]==="00"){U.push(0,0);continue}const Q=parseFloat(p[W]);isNaN(Q)?U.push(0):U.push(Q)}for(;U.length>0&&!isNaN(U[0]);){let W="",Y=[];const Q=v,ne=y;var T,_,C,N,A,I,j,O,F,B;switch(H){case"l":v+=U.shift(),y+=U.shift(),W="L",Y.push(v,y);break;case"L":v=U.shift(),y=U.shift(),Y.push(v,y);break;case"m":var $=U.shift(),Z=U.shift();if(v+=$,y+=Z,W="M",h.length>2&&h[h.length-1].command==="z"){for(let re=h.length-2;re>=0;re--)if(h[re].command==="M"){v=h[re].points[0]+$,y=h[re].points[1]+Z;break}}Y.push(v,y),H="l";break;case"M":v=U.shift(),y=U.shift(),W="M",Y.push(v,y),H="L";break;case"h":v+=U.shift(),W="L",Y.push(v,y);break;case"H":v=U.shift(),W="L",Y.push(v,y);break;case"v":y+=U.shift(),W="L",Y.push(v,y);break;case"V":y=U.shift(),W="L",Y.push(v,y);break;case"C":Y.push(U.shift(),U.shift(),U.shift(),U.shift()),v=U.shift(),y=U.shift(),Y.push(v,y);break;case"c":Y.push(v+U.shift(),y+U.shift(),v+U.shift(),y+U.shift()),v+=U.shift(),y+=U.shift(),W="C",Y.push(v,y);break;case"S":_=v,C=y,T=h[h.length-1],T.command==="C"&&(_=v+(v-T.points[2]),C=y+(y-T.points[3])),Y.push(_,C,U.shift(),U.shift()),v=U.shift(),y=U.shift(),W="C",Y.push(v,y);break;case"s":_=v,C=y,T=h[h.length-1],T.command==="C"&&(_=v+(v-T.points[2]),C=y+(y-T.points[3])),Y.push(_,C,v+U.shift(),y+U.shift()),v+=U.shift(),y+=U.shift(),W="C",Y.push(v,y);break;case"Q":Y.push(U.shift(),U.shift()),v=U.shift(),y=U.shift(),Y.push(v,y);break;case"q":Y.push(v+U.shift(),y+U.shift()),v+=U.shift(),y+=U.shift(),W="Q",Y.push(v,y);break;case"T":_=v,C=y,T=h[h.length-1],T.command==="Q"&&(_=v+(v-T.points[0]),C=y+(y-T.points[1])),v=U.shift(),y=U.shift(),W="Q",Y.push(_,C,v,y);break;case"t":_=v,C=y,T=h[h.length-1],T.command==="Q"&&(_=v+(v-T.points[0]),C=y+(y-T.points[1])),v+=U.shift(),y+=U.shift(),W="Q",Y.push(_,C,v,y);break;case"A":N=U.shift(),A=U.shift(),I=U.shift(),j=U.shift(),O=U.shift(),F=v,B=y,v=U.shift(),y=U.shift(),W="A",Y=this.convertEndpointToCenterParameterization(F,B,v,y,j,O,N,A,I);break;case"a":N=U.shift(),A=U.shift(),I=U.shift(),j=U.shift(),O=U.shift(),F=v,B=y,v+=U.shift(),y+=U.shift(),W="A",Y=this.convertEndpointToCenterParameterization(F,B,v,y,j,O,N,A,I);break}h.push({command:W||H,points:Y,start:{x:Q,y:ne},pathLength:this.calcLength(Q,ne,W||H,Y)})}(H==="z"||H==="Z")&&h.push({command:"z",points:[],start:void 0,pathLength:0})}return h}static calcLength(s,o,l,u){let c,h,p,v;const y=i;switch(l){case"L":return y.getLineLength(s,o,u[0],u[1]);case"C":return(0,n.getCubicArcLength)([s,u[0],u[2],u[4]],[o,u[1],u[3],u[5]],1);case"Q":return(0,n.getQuadraticArcLength)([s,u[0],u[2]],[o,u[1],u[3]],1);case"A":c=0;var S=u[4],w=u[5],T=u[4]+w,_=Math.PI/180;if(Math.abs(S-T)<_&&(_=Math.abs(S-T)),h=y.getPointOnEllipticalArc(u[0],u[1],u[2],u[3],S,0),w<0)for(v=S-_;v>T;v-=_)p=y.getPointOnEllipticalArc(u[0],u[1],u[2],u[3],v,0),c+=y.getLineLength(h.x,h.y,p.x,p.y),h=p;else for(v=S+_;v<T;v+=_)p=y.getPointOnEllipticalArc(u[0],u[1],u[2],u[3],v,0),c+=y.getLineLength(h.x,h.y,p.x,p.y),h=p;return p=y.getPointOnEllipticalArc(u[0],u[1],u[2],u[3],T,0),c+=y.getLineLength(h.x,h.y,p.x,p.y),c}return 0}static convertEndpointToCenterParameterization(s,o,l,u,c,h,p,v,y){const S=y*(Math.PI/180),w=Math.cos(S)*(s-l)/2+Math.sin(S)*(o-u)/2,T=-1*Math.sin(S)*(s-l)/2+Math.cos(S)*(o-u)/2,_=w*w/(p*p)+T*T/(v*v);_>1&&(p*=Math.sqrt(_),v*=Math.sqrt(_));let C=Math.sqrt((p*p*(v*v)-p*p*(T*T)-v*v*(w*w))/(p*p*(T*T)+v*v*(w*w)));c===h&&(C*=-1),isNaN(C)&&(C=0);const N=C*p*T/v,A=C*-v*w/p,I=(s+l)/2+Math.cos(S)*N-Math.sin(S)*A,j=(o+u)/2+Math.sin(S)*N+Math.cos(S)*A,O=function(U){return Math.sqrt(U[0]*U[0]+U[1]*U[1])},F=function(U,W){return(U[0]*W[0]+U[1]*W[1])/(O(U)*O(W))},B=function(U,W){return(U[0]*W[1]<U[1]*W[0]?-1:1)*Math.acos(F(U,W))},$=B([1,0],[(w-N)/p,(T-A)/v]),Z=[(w-N)/p,(T-A)/v],D=[(-1*w-N)/p,(-1*T-A)/v];let H=B(Z,D);return F(Z,D)<=-1&&(H=Math.PI),F(Z,D)>=1&&(H=0),h===0&&H>0&&(H=H-2*Math.PI),h===1&&H<0&&(H=H+2*Math.PI),[I,j,p,v,$,H,S,h]}}return og.Path=i,i.prototype.className="Path",i.prototype._attrsAffectingSize=["data"],(0,r._registerNode)(i),t.Factory.addGetterSetter(i,"data"),og}var P5;function SG(){if(P5)return ag;P5=1,Object.defineProperty(ag,"__esModule",{value:!0}),ag.Arrow=void 0;const t=Pr(),e=CR(),r=Ar(),n=Tr(),i=__();let a=class extends e.Line{_sceneFunc(o){super._sceneFunc(o);const l=Math.PI*2,u=this.points();let c=u;const h=this.tension()!==0&&u.length>4;h&&(c=this.getTensionPoints());const p=this.pointerLength(),v=u.length;let y,S;if(h){const _=[c[c.length-4],c[c.length-3],c[c.length-2],c[c.length-1],u[v-2],u[v-1]],C=i.Path.calcLength(c[c.length-4],c[c.length-3],"C",_),N=i.Path.getPointOnQuadraticBezier(Math.min(1,1-p/C),_[0],_[1],_[2],_[3],_[4],_[5]);y=u[v-2]-N.x,S=u[v-1]-N.y}else y=u[v-2]-u[v-4],S=u[v-1]-u[v-3];const w=(Math.atan2(S,y)+l)%l,T=this.pointerWidth();this.pointerAtEnding()&&(o.save(),o.beginPath(),o.translate(u[v-2],u[v-1]),o.rotate(w),o.moveTo(0,0),o.lineTo(-p,T/2),o.lineTo(-p,-T/2),o.closePath(),o.restore(),this.__fillStroke(o)),this.pointerAtBeginning()&&(o.save(),o.beginPath(),o.translate(u[0],u[1]),h?(y=(c[0]+c[2])/2-u[0],S=(c[1]+c[3])/2-u[1]):(y=u[2]-u[0],S=u[3]-u[1]),o.rotate((Math.atan2(-S,-y)+l)%l),o.moveTo(0,0),o.lineTo(-p,T/2),o.lineTo(-p,-T/2),o.closePath(),o.restore(),this.__fillStroke(o))}__fillStroke(o){const l=this.dashEnabled();l&&(this.attrs.dashEnabled=!1,o.setLineDash([])),o.fillStrokeShape(this),l&&(this.attrs.dashEnabled=!0)}getSelfRect(){const o=super.getSelfRect(),l=this.pointerWidth()/2;return{x:o.x-l,y:o.y-l,width:o.width+l*2,height:o.height+l*2}}};return ag.Arrow=a,a.prototype.className="Arrow",(0,n._registerNode)(a),t.Factory.addGetterSetter(a,"pointerLength",10,(0,r.getNumberValidator)()),t.Factory.addGetterSetter(a,"pointerWidth",10,(0,r.getNumberValidator)()),t.Factory.addGetterSetter(a,"pointerAtBeginning",!1),t.Factory.addGetterSetter(a,"pointerAtEnding",!0),ag}var lg={},M5;function kG(){if(M5)return lg;M5=1,Object.defineProperty(lg,"__esModule",{value:!0}),lg.Circle=void 0;const t=Pr(),e=Sa(),r=Ar(),n=Tr();class i extends e.Shape{_sceneFunc(s){s.beginPath(),s.arc(0,0,this.attrs.radius||0,0,Math.PI*2,!1),s.closePath(),s.fillStrokeShape(this)}getWidth(){return this.radius()*2}getHeight(){return this.radius()*2}setWidth(s){this.radius()!==s/2&&this.radius(s/2)}setHeight(s){this.radius()!==s/2&&this.radius(s/2)}}return lg.Circle=i,i.prototype._centroid=!0,i.prototype.className="Circle",i.prototype._attrsAffectingSize=["radius"],(0,n._registerNode)(i),t.Factory.addGetterSetter(i,"radius",0,(0,r.getNumberValidator)()),lg}var ug={},A5;function _G(){if(A5)return ug;A5=1,Object.defineProperty(ug,"__esModule",{value:!0}),ug.Ellipse=void 0;const t=Pr(),e=Sa(),r=Ar(),n=Tr();let i=class extends e.Shape{_sceneFunc(s){const o=this.radiusX(),l=this.radiusY();s.beginPath(),s.save(),o!==l&&s.scale(1,l/o),s.arc(0,0,o,0,Math.PI*2,!1),s.restore(),s.closePath(),s.fillStrokeShape(this)}getWidth(){return this.radiusX()*2}getHeight(){return this.radiusY()*2}setWidth(s){this.radiusX(s/2)}setHeight(s){this.radiusY(s/2)}};return ug.Ellipse=i,i.prototype.className="Ellipse",i.prototype._centroid=!0,i.prototype._attrsAffectingSize=["radiusX","radiusY"],(0,n._registerNode)(i),t.Factory.addComponentsGetterSetter(i,"radius",["x","y"]),t.Factory.addGetterSetter(i,"radiusX",0,(0,r.getNumberValidator)()),t.Factory.addGetterSetter(i,"radiusY",0,(0,r.getNumberValidator)()),ug}var cg={},R5;function CG(){if(R5)return cg;R5=1,Object.defineProperty(cg,"__esModule",{value:!0}),cg.Image=void 0;const t=mi(),e=Pr(),r=Sa(),n=Tr(),i=Ar();class a extends r.Shape{constructor(o){super(o),this.on("imageChange.konva",()=>{this._setImageLoad()}),this._setImageLoad()}_setImageLoad(){const o=this.image();o&&o.complete||o&&o.readyState===4||o&&o.addEventListener&&o.addEventListener("load",()=>{this._requestDraw()})}_useBufferCanvas(){const o=!!this.cornerRadius(),l=this.hasShadow();return o&&l?!0:super._useBufferCanvas(!0)}_sceneFunc(o){const l=this.getWidth(),u=this.getHeight(),c=this.cornerRadius(),h=this.attrs.image;let p;if(h){const v=this.attrs.cropWidth,y=this.attrs.cropHeight;v&&y?p=[h,this.cropX(),this.cropY(),v,y,0,0,l,u]:p=[h,0,0,l,u]}(this.hasFill()||this.hasStroke()||c)&&(o.beginPath(),c?t.Util.drawRoundedRectPath(o,l,u,c):o.rect(0,0,l,u),o.closePath(),o.fillStrokeShape(this)),h&&(c&&o.clip(),o.drawImage.apply(o,p))}_hitFunc(o){const l=this.width(),u=this.height(),c=this.cornerRadius();o.beginPath(),c?t.Util.drawRoundedRectPath(o,l,u,c):o.rect(0,0,l,u),o.closePath(),o.fillStrokeShape(this)}getWidth(){var o,l;return(o=this.attrs.width)!==null&&o!==void 0?o:(l=this.image())===null||l===void 0?void 0:l.width}getHeight(){var o,l;return(o=this.attrs.height)!==null&&o!==void 0?o:(l=this.image())===null||l===void 0?void 0:l.height}static fromURL(o,l,u=null){const c=t.Util.createImageElement();c.onload=function(){const h=new a({image:c});l(h)},c.onerror=u,c.crossOrigin="Anonymous",c.src=o}}return cg.Image=a,a.prototype.className="Image",(0,n._registerNode)(a),e.Factory.addGetterSetter(a,"cornerRadius",0,(0,i.getNumberOrArrayOfNumbersValidator)(4)),e.Factory.addGetterSetter(a,"image"),e.Factory.addComponentsGetterSetter(a,"crop",["x","y","width","height"]),e.Factory.addGetterSetter(a,"cropX",0,(0,i.getNumberValidator)()),e.Factory.addGetterSetter(a,"cropY",0,(0,i.getNumberValidator)()),e.Factory.addGetterSetter(a,"cropWidth",0,(0,i.getNumberValidator)()),e.Factory.addGetterSetter(a,"cropHeight",0,(0,i.getNumberValidator)()),cg}var Hh={},L5;function EG(){if(L5)return Hh;L5=1,Object.defineProperty(Hh,"__esModule",{value:!0}),Hh.Tag=Hh.Label=void 0;const t=Pr(),e=Sa(),r=S_(),n=Ar(),i=Tr(),a=["fontFamily","fontSize","fontStyle","padding","lineHeight","text","width","height","pointerDirection","pointerWidth","pointerHeight"],s="Change.konva",o="none",l="up",u="right",c="down",h="left",p=a.length;let v=class extends r.Group{constructor(w){super(w),this.on("add.konva",function(T){this._addListeners(T.child),this._sync()})}getText(){return this.find("Text")[0]}getTag(){return this.find("Tag")[0]}_addListeners(w){let T=this,_;const C=function(){T._sync()};for(_=0;_<p;_++)w.on(a[_]+s,C)}getWidth(){return this.getText().width()}getHeight(){return this.getText().height()}_sync(){let w=this.getText(),T=this.getTag(),_,C,N,A,I,j,O;if(w&&T){switch(_=w.width(),C=w.height(),N=T.pointerDirection(),A=T.pointerWidth(),O=T.pointerHeight(),I=0,j=0,N){case l:I=_/2,j=-1*O;break;case u:I=_+A,j=C/2;break;case c:I=_/2,j=C+O;break;case h:I=-1*A,j=C/2;break}T.setAttrs({x:-1*I,y:-1*j,width:_,height:C}),w.setAttrs({x:-1*I,y:-1*j})}}};Hh.Label=v,v.prototype.className="Label",(0,i._registerNode)(v);class y extends e.Shape{_sceneFunc(w){const T=this.width(),_=this.height(),C=this.pointerDirection(),N=this.pointerWidth(),A=this.pointerHeight(),I=this.cornerRadius();let j=0,O=0,F=0,B=0;typeof I=="number"?j=O=F=B=Math.min(I,T/2,_/2):(j=Math.min(I[0]||0,T/2,_/2),O=Math.min(I[1]||0,T/2,_/2),B=Math.min(I[2]||0,T/2,_/2),F=Math.min(I[3]||0,T/2,_/2)),w.beginPath(),w.moveTo(j,0),C===l&&(w.lineTo((T-N)/2,0),w.lineTo(T/2,-1*A),w.lineTo((T+N)/2,0)),w.lineTo(T-O,0),w.arc(T-O,O,O,Math.PI*3/2,0,!1),C===u&&(w.lineTo(T,(_-A)/2),w.lineTo(T+N,_/2),w.lineTo(T,(_+A)/2)),w.lineTo(T,_-B),w.arc(T-B,_-B,B,0,Math.PI/2,!1),C===c&&(w.lineTo((T+N)/2,_),w.lineTo(T/2,_+A),w.lineTo((T-N)/2,_)),w.lineTo(F,_),w.arc(F,_-F,F,Math.PI/2,Math.PI,!1),C===h&&(w.lineTo(0,(_+A)/2),w.lineTo(-1*N,_/2),w.lineTo(0,(_-A)/2)),w.lineTo(0,j),w.arc(j,j,j,Math.PI,Math.PI*3/2,!1),w.closePath(),w.fillStrokeShape(this)}getSelfRect(){let w=0,T=0,_=this.pointerWidth(),C=this.pointerHeight(),N=this.pointerDirection(),A=this.width(),I=this.height();return N===l?(T-=C,I+=C):N===c?I+=C:N===h?(w-=_*1.5,A+=_):N===u&&(A+=_*1.5),{x:w,y:T,width:A,height:I}}}return Hh.Tag=y,y.prototype.className="Tag",(0,i._registerNode)(y),t.Factory.addGetterSetter(y,"pointerDirection",o),t.Factory.addGetterSetter(y,"pointerWidth",0,(0,n.getNumberValidator)()),t.Factory.addGetterSetter(y,"pointerHeight",0,(0,n.getNumberValidator)()),t.Factory.addGetterSetter(y,"cornerRadius",0,(0,n.getNumberOrArrayOfNumbersValidator)(4)),Hh}var dg={},O5;function ER(){if(O5)return dg;O5=1,Object.defineProperty(dg,"__esModule",{value:!0}),dg.Rect=void 0;const t=Pr(),e=Sa(),r=Tr(),n=mi(),i=Ar();class a extends e.Shape{_sceneFunc(o){const l=this.cornerRadius(),u=this.width(),c=this.height();o.beginPath(),l?n.Util.drawRoundedRectPath(o,u,c,l):o.rect(0,0,u,c),o.closePath(),o.fillStrokeShape(this)}}return dg.Rect=a,a.prototype.className="Rect",(0,r._registerNode)(a),t.Factory.addGetterSetter(a,"cornerRadius",0,(0,i.getNumberOrArrayOfNumbersValidator)(4)),dg}var hg={},D5;function TG(){if(D5)return hg;D5=1,Object.defineProperty(hg,"__esModule",{value:!0}),hg.RegularPolygon=void 0;const t=Pr(),e=Sa(),r=Ar(),n=Tr();let i=class extends e.Shape{_sceneFunc(s){const o=this._getPoints();s.beginPath(),s.moveTo(o[0].x,o[0].y);for(let l=1;l<o.length;l++)s.lineTo(o[l].x,o[l].y);s.closePath(),s.fillStrokeShape(this)}_getPoints(){const s=this.attrs.sides,o=this.attrs.radius||0,l=[];for(let u=0;u<s;u++)l.push({x:o*Math.sin(u*2*Math.PI/s),y:-1*o*Math.cos(u*2*Math.PI/s)});return l}getSelfRect(){const s=this._getPoints();let o=s[0].x,l=s[0].y,u=s[0].x,c=s[0].y;return s.forEach(h=>{o=Math.min(o,h.x),l=Math.max(l,h.x),u=Math.min(u,h.y),c=Math.max(c,h.y)}),{x:o,y:u,width:l-o,height:c-u}}getWidth(){return this.radius()*2}getHeight(){return this.radius()*2}setWidth(s){this.radius(s/2)}setHeight(s){this.radius(s/2)}};return hg.RegularPolygon=i,i.prototype.className="RegularPolygon",i.prototype._centroid=!0,i.prototype._attrsAffectingSize=["radius"],(0,n._registerNode)(i),t.Factory.addGetterSetter(i,"radius",0,(0,r.getNumberValidator)()),t.Factory.addGetterSetter(i,"sides",0,(0,r.getNumberValidator)()),hg}var fg={},I5;function NG(){if(I5)return fg;I5=1,Object.defineProperty(fg,"__esModule",{value:!0}),fg.Ring=void 0;const t=Pr(),e=Sa(),r=Ar(),n=Tr(),i=Math.PI*2;let a=class extends e.Shape{_sceneFunc(o){o.beginPath(),o.arc(0,0,this.innerRadius(),0,i,!1),o.moveTo(this.outerRadius(),0),o.arc(0,0,this.outerRadius(),i,0,!0),o.closePath(),o.fillStrokeShape(this)}getWidth(){return this.outerRadius()*2}getHeight(){return this.outerRadius()*2}setWidth(o){this.outerRadius(o/2)}setHeight(o){this.outerRadius(o/2)}};return fg.Ring=a,a.prototype.className="Ring",a.prototype._centroid=!0,a.prototype._attrsAffectingSize=["innerRadius","outerRadius"],(0,n._registerNode)(a),t.Factory.addGetterSetter(a,"innerRadius",0,(0,r.getNumberValidator)()),t.Factory.addGetterSetter(a,"outerRadius",0,(0,r.getNumberValidator)()),fg}var pg={},j5;function PG(){if(j5)return pg;j5=1,Object.defineProperty(pg,"__esModule",{value:!0}),pg.Sprite=void 0;const t=Pr(),e=Sa(),r=k_(),n=Ar(),i=Tr();let a=class extends e.Shape{constructor(o){super(o),this._updated=!0,this.anim=new r.Animation(()=>{const l=this._updated;return this._updated=!1,l}),this.on("animationChange.konva",function(){this.frameIndex(0)}),this.on("frameIndexChange.konva",function(){this._updated=!0}),this.on("frameRateChange.konva",function(){this.anim.isRunning()&&(clearInterval(this.interval),this._setInterval())})}_sceneFunc(o){const l=this.animation(),u=this.frameIndex(),c=u*4,h=this.animations()[l],p=this.frameOffsets(),v=h[c+0],y=h[c+1],S=h[c+2],w=h[c+3],T=this.image();if((this.hasFill()||this.hasStroke())&&(o.beginPath(),o.rect(0,0,S,w),o.closePath(),o.fillStrokeShape(this)),T)if(p){const _=p[l],C=u*2;o.drawImage(T,v,y,S,w,_[C+0],_[C+1],S,w)}else o.drawImage(T,v,y,S,w,0,0,S,w)}_hitFunc(o){const l=this.animation(),u=this.frameIndex(),c=u*4,h=this.animations()[l],p=this.frameOffsets(),v=h[c+2],y=h[c+3];if(o.beginPath(),p){const S=p[l],w=u*2;o.rect(S[w+0],S[w+1],v,y)}else o.rect(0,0,v,y);o.closePath(),o.fillShape(this)}_useBufferCanvas(){return super._useBufferCanvas(!0)}_setInterval(){const o=this;this.interval=setInterval(function(){o._updateIndex()},1e3/this.frameRate())}start(){if(this.isRunning())return;const o=this.getLayer();this.anim.setLayers(o),this._setInterval(),this.anim.start()}stop(){this.anim.stop(),clearInterval(this.interval)}isRunning(){return this.anim.isRunning()}_updateIndex(){const o=this.frameIndex(),l=this.animation(),u=this.animations(),c=u[l],h=c.length/4;o<h-1?this.frameIndex(o+1):this.frameIndex(0)}};return pg.Sprite=a,a.prototype.className="Sprite",(0,i._registerNode)(a),t.Factory.addGetterSetter(a,"animation"),t.Factory.addGetterSetter(a,"animations"),t.Factory.addGetterSetter(a,"frameOffsets"),t.Factory.addGetterSetter(a,"image"),t.Factory.addGetterSetter(a,"frameIndex",0,(0,n.getNumberValidator)()),t.Factory.addGetterSetter(a,"frameRate",17,(0,n.getNumberValidator)()),t.Factory.backCompat(a,{index:"frameIndex",getIndex:"getFrameIndex",setIndex:"setFrameIndex"}),pg}var mg={},F5;function MG(){if(F5)return mg;F5=1,Object.defineProperty(mg,"__esModule",{value:!0}),mg.Star=void 0;const t=Pr(),e=Sa(),r=Ar(),n=Tr();let i=class extends e.Shape{_sceneFunc(s){const o=this.innerRadius(),l=this.outerRadius(),u=this.numPoints();s.beginPath(),s.moveTo(0,0-l);for(let c=1;c<u*2;c++){const h=c%2===0?l:o,p=h*Math.sin(c*Math.PI/u),v=-1*h*Math.cos(c*Math.PI/u);s.lineTo(p,v)}s.closePath(),s.fillStrokeShape(this)}getWidth(){return this.outerRadius()*2}getHeight(){return this.outerRadius()*2}setWidth(s){this.outerRadius(s/2)}setHeight(s){this.outerRadius(s/2)}};return mg.Star=i,i.prototype.className="Star",i.prototype._centroid=!0,i.prototype._attrsAffectingSize=["innerRadius","outerRadius"],(0,n._registerNode)(i),t.Factory.addGetterSetter(i,"numPoints",5,(0,r.getNumberValidator)()),t.Factory.addGetterSetter(i,"innerRadius",0,(0,r.getNumberValidator)()),t.Factory.addGetterSetter(i,"outerRadius",0,(0,r.getNumberValidator)()),mg}var wp={},B5;function TR(){if(B5)return wp;B5=1,Object.defineProperty(wp,"__esModule",{value:!0}),wp.Text=void 0,wp.stringToArray=s;const t=mi(),e=Pr(),r=Sa(),n=Tr(),i=Ar(),a=Tr();function s(te){return[...te].reduce((ae,de,ge,ye)=>(new RegExp("\\p{Emoji_Modifier_Base}\\p{Emoji_Modifier}?(?:\\u200D\\p{Emoji_Presentation})+","u").test(de)?ae.push(de):new RegExp("\\p{Regional_Indicator}{2}","u").test(de+(ye[ge+1]||""))?ae.push(de+ye[ge+1]):ge>0&&new RegExp("\\p{Mn}|\\p{Me}|\\p{Mc}","u").test(de)?ae[ae.length-1]+=de:ae.push(de),ae),[])}const o="auto",l="center",u="inherit",c="justify",h="Change.konva",p="2d",v="-",y="left",S="text",w="Text",T="top",_="bottom",C="middle",N="normal",A="px ",I=" ",j="right",O="rtl",F="word",B="char",$="none",Z="",D=["direction","fontFamily","fontSize","fontStyle","fontVariant","padding","align","verticalAlign","lineHeight","text","width","height","wrap","ellipsis","letterSpacing"],H=D.length;function U(te){return te.split(",").map(ae=>{ae=ae.trim();const de=ae.indexOf(" ")>=0,ge=ae.indexOf('"')>=0||ae.indexOf("'")>=0;return de&&!ge&&(ae=`"${ae}"`),ae}).join(", ")}let W;function Y(){return W||(W=t.Util.createCanvasElement().getContext(p),W)}function Q(te){te.fillText(this._partialText,this._partialTextX,this._partialTextY)}function ne(te){te.setAttr("miterLimit",2),te.strokeText(this._partialText,this._partialTextX,this._partialTextY)}function re(te){return te=te||{},!te.fillLinearGradientColorStops&&!te.fillRadialGradientColorStops&&!te.fillPatternImage&&(te.fill=te.fill||"black"),te}class q extends r.Shape{constructor(ae){super(re(ae)),this._partialTextX=0,this._partialTextY=0;for(let de=0;de<H;de++)this.on(D[de]+h,this._setTextData);this._setTextData()}_sceneFunc(ae){const de=this.textArr,ge=de.length;if(!this.text())return;let ye=this.padding(),se=this.fontSize(),fe=this.lineHeight()*se,le=this.verticalAlign(),pe=this.direction(),me=0,xe=this.align(),Se=this.getWidth(),Ve=this.letterSpacing(),$e=this.fill(),St=this.textDecoration(),rt=St.indexOf("underline")!==-1,lt=St.indexOf("line-through")!==-1,De;pe=pe===u?ae.direction:pe;let Le=fe/2,Qe=C;if(n.Konva._fixTextRendering){const ft=this.measureSize("M");Qe="alphabetic",Le=(ft.fontBoundingBoxAscent-ft.fontBoundingBoxDescent)/2+fe/2}var Ce=0,Fe=0;for(pe===O&&ae.setAttr("direction",pe),ae.setAttr("font",this._getContextFont()),ae.setAttr("textBaseline",Qe),ae.setAttr("textAlign",y),le===C?me=(this.getHeight()-ge*fe-ye*2)/2:le===_&&(me=this.getHeight()-ge*fe-ye*2),ae.translate(ye,me+ye),De=0;De<ge;De++){var Ce=0,Fe=0,Ke=de[De],mt=Ke.text,gt=Ke.width,yt=Ke.lastInParagraph,jt,qt,wt;if(ae.save(),xe===j?Ce+=Se-gt-ye*2:xe===l&&(Ce+=(Se-gt-ye*2)/2),rt){ae.save(),ae.beginPath();const ce=n.Konva._fixTextRendering?Math.round(se/4):Math.round(se/2),ve=Ce,ke=Le+Fe+ce;ae.moveTo(ve,ke),jt=mt.split(" ").length-1,qt=jt===0,wt=xe===c&&!yt?Se-ye*2:gt,ae.lineTo(ve+Math.round(wt),ke),ae.lineWidth=se/15;const Te=this._getLinearGradient();ae.strokeStyle=Te||$e,ae.stroke(),ae.restore()}if(lt){ae.save(),ae.beginPath();const ce=n.Konva._fixTextRendering?-Math.round(se/4):0;ae.moveTo(Ce,Le+Fe+ce),jt=mt.split(" ").length-1,qt=jt===0,wt=xe===c&&yt&&!qt?Se-ye*2:gt,ae.lineTo(Ce+Math.round(wt),Le+Fe+ce),ae.lineWidth=se/15;const ve=this._getLinearGradient();ae.strokeStyle=ve||$e,ae.stroke(),ae.restore()}if(pe!==O&&(Ve!==0||xe===c)){jt=mt.split(" ").length-1;const ce=s(mt);for(let ve=0;ve<ce.length;ve++){const ke=ce[ve];ke===" "&&!yt&&xe===c&&(Ce+=(Se-ye*2-gt)/jt),this._partialTextX=Ce,this._partialTextY=Le+Fe,this._partialText=ke,ae.fillStrokeShape(this),Ce+=this.measureSize(ke).width+Ve}}else Ve!==0&&ae.setAttr("letterSpacing",`${Ve}px`),this._partialTextX=Ce,this._partialTextY=Le+Fe,this._partialText=mt,ae.fillStrokeShape(this);ae.restore(),ge>1&&(Le+=fe)}}_hitFunc(ae){const de=this.getWidth(),ge=this.getHeight();ae.beginPath(),ae.rect(0,0,de,ge),ae.closePath(),ae.fillStrokeShape(this)}setText(ae){const de=t.Util._isString(ae)?ae:ae==null?"":ae+"";return this._setAttr(S,de),this}getWidth(){return this.attrs.width===o||this.attrs.width===void 0?this.getTextWidth()+this.padding()*2:this.attrs.width}getHeight(){return this.attrs.height===o||this.attrs.height===void 0?this.fontSize()*this.textArr.length*this.lineHeight()+this.padding()*2:this.attrs.height}getTextWidth(){return this.textWidth}getTextHeight(){return t.Util.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height."),this.textHeight}measureSize(ae){var de,ge,ye,se,fe,le,pe,me,xe,Se,Ve;let $e=Y(),St=this.fontSize(),rt;$e.save(),$e.font=this._getContextFont(),rt=$e.measureText(ae),$e.restore();const lt=St/100;return{actualBoundingBoxAscent:(de=rt.actualBoundingBoxAscent)!==null&&de!==void 0?de:71.58203125*lt,actualBoundingBoxDescent:(ge=rt.actualBoundingBoxDescent)!==null&&ge!==void 0?ge:0,actualBoundingBoxLeft:(ye=rt.actualBoundingBoxLeft)!==null&&ye!==void 0?ye:-7.421875*lt,actualBoundingBoxRight:(se=rt.actualBoundingBoxRight)!==null&&se!==void 0?se:75.732421875*lt,alphabeticBaseline:(fe=rt.alphabeticBaseline)!==null&&fe!==void 0?fe:0,emHeightAscent:(le=rt.emHeightAscent)!==null&&le!==void 0?le:100*lt,emHeightDescent:(pe=rt.emHeightDescent)!==null&&pe!==void 0?pe:-20*lt,fontBoundingBoxAscent:(me=rt.fontBoundingBoxAscent)!==null&&me!==void 0?me:91*lt,fontBoundingBoxDescent:(xe=rt.fontBoundingBoxDescent)!==null&&xe!==void 0?xe:21*lt,hangingBaseline:(Se=rt.hangingBaseline)!==null&&Se!==void 0?Se:72.80000305175781*lt,ideographicBaseline:(Ve=rt.ideographicBaseline)!==null&&Ve!==void 0?Ve:-21*lt,width:rt.width,height:St}}_getContextFont(){return this.fontStyle()+I+this.fontVariant()+I+(this.fontSize()+A)+U(this.fontFamily())}_addTextLine(ae){this.align()===c&&(ae=ae.trim());const ge=this._getTextWidth(ae);return this.textArr.push({text:ae,width:ge,lastInParagraph:!1})}_getTextWidth(ae){const de=this.letterSpacing(),ge=ae.length;return Y().measureText(ae).width+(ge?de*(ge-1):0)}_setTextData(){let ae=this.text().split(`
`),de=+this.fontSize(),ge=0,ye=this.lineHeight()*de,se=this.attrs.width,fe=this.attrs.height,le=se!==o&&se!==void 0,pe=fe!==o&&fe!==void 0,me=this.padding(),xe=se-me*2,Se=fe-me*2,Ve=0,$e=this.wrap(),St=$e!==$,rt=$e!==B&&St,lt=this.ellipsis();this.textArr=[],Y().font=this._getContextFont();const De=lt?this._getTextWidth(Z):0;for(let Qe=0,Ce=ae.length;Qe<Ce;++Qe){let Fe=ae[Qe],Ke=this._getTextWidth(Fe);if(le&&Ke>xe)for(;Fe.length>0;){let mt=0,gt=Fe.length,yt="",jt=0;for(;mt<gt;){const qt=mt+gt>>>1,wt=Fe.slice(0,qt+1),ft=this._getTextWidth(wt)+De;ft<=xe?(mt=qt+1,yt=wt,jt=ft):gt=qt}if(yt){if(rt){var Le;const wt=Fe[yt.length];(wt===I||wt===v)&&jt<=xe?Le=yt.length:Le=Math.max(yt.lastIndexOf(I),yt.lastIndexOf(v))+1,Le>0&&(mt=Le,yt=yt.slice(0,mt),jt=this._getTextWidth(yt))}if(yt=yt.trimRight(),this._addTextLine(yt),ge=Math.max(ge,jt),Ve+=ye,this._shouldHandleEllipsis(Ve)){this._tryToAddEllipsisToLastLine();break}if(Fe=Fe.slice(mt),Fe=Fe.trimLeft(),Fe.length>0&&(Ke=this._getTextWidth(Fe),Ke<=xe)){this._addTextLine(Fe),Ve+=ye,ge=Math.max(ge,Ke);break}}else break}else this._addTextLine(Fe),Ve+=ye,ge=Math.max(ge,Ke),this._shouldHandleEllipsis(Ve)&&Qe<Ce-1&&this._tryToAddEllipsisToLastLine();if(this.textArr[this.textArr.length-1]&&(this.textArr[this.textArr.length-1].lastInParagraph=!0),pe&&Ve+ye>Se)break}this.textHeight=de,this.textWidth=ge}_shouldHandleEllipsis(ae){const de=+this.fontSize(),ge=this.lineHeight()*de,ye=this.attrs.height,se=ye!==o&&ye!==void 0,fe=this.padding(),le=ye-fe*2;return!(this.wrap()!==$)||se&&ae+ge>le}_tryToAddEllipsisToLastLine(){const ae=this.attrs.width,de=ae!==o&&ae!==void 0,ge=this.padding(),ye=ae-ge*2,se=this.ellipsis(),fe=this.textArr[this.textArr.length-1];!fe||!se||(de&&(this._getTextWidth(fe.text+Z)<ye||(fe.text=fe.text.slice(0,fe.text.length-3))),this.textArr.splice(this.textArr.length-1,1),this._addTextLine(fe.text+Z))}getStrokeScaleEnabled(){return!0}_useBufferCanvas(){const ae=this.textDecoration().indexOf("underline")!==-1||this.textDecoration().indexOf("line-through")!==-1,de=this.hasShadow();return ae&&de?!0:super._useBufferCanvas()}}return wp.Text=q,q.prototype._fillFunc=Q,q.prototype._strokeFunc=ne,q.prototype.className=w,q.prototype._attrsAffectingSize=["text","fontSize","padding","wrap","lineHeight","letterSpacing"],(0,a._registerNode)(q),e.Factory.overWriteSetter(q,"width",(0,i.getNumberOrAutoValidator)()),e.Factory.overWriteSetter(q,"height",(0,i.getNumberOrAutoValidator)()),e.Factory.addGetterSetter(q,"direction",u),e.Factory.addGetterSetter(q,"fontFamily","Arial"),e.Factory.addGetterSetter(q,"fontSize",12,(0,i.getNumberValidator)()),e.Factory.addGetterSetter(q,"fontStyle",N),e.Factory.addGetterSetter(q,"fontVariant",N),e.Factory.addGetterSetter(q,"padding",0,(0,i.getNumberValidator)()),e.Factory.addGetterSetter(q,"align",y),e.Factory.addGetterSetter(q,"verticalAlign",T),e.Factory.addGetterSetter(q,"lineHeight",1,(0,i.getNumberValidator)()),e.Factory.addGetterSetter(q,"wrap",F),e.Factory.addGetterSetter(q,"ellipsis",!1,(0,i.getBooleanValidator)()),e.Factory.addGetterSetter(q,"letterSpacing",0,(0,i.getNumberValidator)()),e.Factory.addGetterSetter(q,"text","",(0,i.getStringValidator)()),e.Factory.addGetterSetter(q,"textDecoration",""),wp}var gg={},z5;function AG(){if(z5)return gg;z5=1,Object.defineProperty(gg,"__esModule",{value:!0}),gg.TextPath=void 0;const t=mi(),e=Pr(),r=Sa(),n=__(),i=TR(),a=Ar(),s=Tr(),o="",l="normal";function u(p){p.fillText(this.partialText,0,0)}function c(p){p.strokeText(this.partialText,0,0)}let h=class extends r.Shape{constructor(v){super(v),this.dummyCanvas=t.Util.createCanvasElement(),this.dataArray=[],this._readDataAttribute(),this.on("dataChange.konva",function(){this._readDataAttribute(),this._setTextData()}),this.on("textChange.konva alignChange.konva letterSpacingChange.konva kerningFuncChange.konva fontSizeChange.konva fontFamilyChange.konva",this._setTextData),this._setTextData()}_getTextPathLength(){return n.Path.getPathLength(this.dataArray)}_getPointAtLength(v){if(!this.attrs.data)return null;const y=this.pathLength;return v-1>y?null:n.Path.getPointAtLengthOfDataArray(v,this.dataArray)}_readDataAttribute(){this.dataArray=n.Path.parsePathData(this.attrs.data),this.pathLength=this._getTextPathLength()}_sceneFunc(v){v.setAttr("font",this._getContextFont()),v.setAttr("textBaseline",this.textBaseline()),v.setAttr("textAlign","left"),v.save();const y=this.textDecoration(),S=this.fill(),w=this.fontSize(),T=this.glyphInfo;y==="underline"&&v.beginPath();for(let _=0;_<T.length;_++){v.save();const C=T[_].p0;v.translate(C.x,C.y),v.rotate(T[_].rotation),this.partialText=T[_].text,v.fillStrokeShape(this),y==="underline"&&(_===0&&v.moveTo(0,w/2+1),v.lineTo(w,w/2+1)),v.restore()}y==="underline"&&(v.strokeStyle=S,v.lineWidth=w/20,v.stroke()),v.restore()}_hitFunc(v){v.beginPath();const y=this.glyphInfo;if(y.length>=1){const S=y[0].p0;v.moveTo(S.x,S.y)}for(let S=0;S<y.length;S++){const w=y[S].p1;v.lineTo(w.x,w.y)}v.setAttr("lineWidth",this.fontSize()),v.setAttr("strokeStyle",this.colorKey),v.stroke()}getTextWidth(){return this.textWidth}getTextHeight(){return t.Util.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height."),this.textHeight}setText(v){return i.Text.prototype.setText.call(this,v)}_getContextFont(){return i.Text.prototype._getContextFont.call(this)}_getTextSize(v){const S=this.dummyCanvas.getContext("2d");S.save(),S.font=this._getContextFont();const w=S.measureText(v);return S.restore(),{width:w.width,height:parseInt(`${this.fontSize()}`,10)}}_setTextData(){const{width:v,height:y}=this._getTextSize(this.attrs.text);if(this.textWidth=v,this.textHeight=y,this.glyphInfo=[],!this.attrs.data)return null;const S=this.letterSpacing(),w=this.align(),T=this.kerningFunc(),_=Math.max(this.textWidth+((this.attrs.text||"").length-1)*S,0);let C=0;w==="center"&&(C=Math.max(0,this.pathLength/2-_/2)),w==="right"&&(C=Math.max(0,this.pathLength-_));const N=(0,i.stringToArray)(this.text());let A=C;for(let I=0;I<N.length;I++){const j=this._getPointAtLength(A);if(!j)return;let O=this._getTextSize(N[I]).width+S;if(N[I]===" "&&w==="justify"){const H=this.text().split(" ").length-1;O+=(this.pathLength-_)/H}const F=this._getPointAtLength(A+O);if(!F)return;const B=n.Path.getLineLength(j.x,j.y,F.x,F.y);let $=0;if(T)try{$=T(N[I-1],N[I])*this.fontSize()}catch{$=0}j.x+=$,F.x+=$,this.textWidth+=$;const Z=n.Path.getPointOnLine($+B/2,j.x,j.y,F.x,F.y),D=Math.atan2(F.y-j.y,F.x-j.x);this.glyphInfo.push({transposeX:Z.x,transposeY:Z.y,text:N[I],rotation:D,p0:j,p1:F}),A+=O}}getSelfRect(){if(!this.glyphInfo.length)return{x:0,y:0,width:0,height:0};const v=[];this.glyphInfo.forEach(function(A){v.push(A.p0.x),v.push(A.p0.y),v.push(A.p1.x),v.push(A.p1.y)});let y=v[0]||0,S=v[0]||0,w=v[1]||0,T=v[1]||0,_,C;for(let A=0;A<v.length/2;A++)_=v[A*2],C=v[A*2+1],y=Math.min(y,_),S=Math.max(S,_),w=Math.min(w,C),T=Math.max(T,C);const N=this.fontSize();return{x:y-N/2,y:w-N/2,width:S-y+N,height:T-w+N}}destroy(){return t.Util.releaseCanvas(this.dummyCanvas),super.destroy()}};return gg.TextPath=h,h.prototype._fillFunc=u,h.prototype._strokeFunc=c,h.prototype._fillFuncHit=u,h.prototype._strokeFuncHit=c,h.prototype.className="TextPath",h.prototype._attrsAffectingSize=["text","fontSize","data"],(0,s._registerNode)(h),e.Factory.addGetterSetter(h,"data"),e.Factory.addGetterSetter(h,"fontFamily","Arial"),e.Factory.addGetterSetter(h,"fontSize",12,(0,a.getNumberValidator)()),e.Factory.addGetterSetter(h,"fontStyle",l),e.Factory.addGetterSetter(h,"align","left"),e.Factory.addGetterSetter(h,"letterSpacing",0,(0,a.getNumberValidator)()),e.Factory.addGetterSetter(h,"textBaseline","middle"),e.Factory.addGetterSetter(h,"fontVariant",l),e.Factory.addGetterSetter(h,"text",o),e.Factory.addGetterSetter(h,"textDecoration",null),e.Factory.addGetterSetter(h,"kerningFunc",null),gg}var vg={},U5;function RG(){if(U5)return vg;U5=1,Object.defineProperty(vg,"__esModule",{value:!0}),vg.Transformer=void 0;const t=mi(),e=Pr(),r=Ti(),n=Sa(),i=ER(),a=S_(),s=Tr(),o=Ar(),l=Tr(),u="tr-konva",c=["resizeEnabledChange","rotateAnchorOffsetChange","rotateEnabledChange","enabledAnchorsChange","anchorSizeChange","borderEnabledChange","borderStrokeChange","borderStrokeWidthChange","borderDashChange","anchorStrokeChange","anchorStrokeWidthChange","anchorFillChange","anchorCornerRadiusChange","ignoreStrokeChange","anchorStyleFuncChange"].map(O=>O+`.${u}`).join(" "),h="nodesRect",p=["widthChange","heightChange","scaleXChange","scaleYChange","skewXChange","skewYChange","rotationChange","offsetXChange","offsetYChange","transformsEnabledChange","strokeWidthChange"],v={"top-left":-45,"top-center":0,"top-right":45,"middle-right":-90,"middle-left":90,"bottom-left":-135,"bottom-center":180,"bottom-right":135},y="ontouchstart"in s.Konva._global;function S(O,F,B){if(O==="rotater")return B;F+=t.Util.degToRad(v[O]||0);const $=(t.Util.radToDeg(F)%360+360)%360;return t.Util._inRange($,315+22.5,360)||t.Util._inRange($,0,22.5)?"ns-resize":t.Util._inRange($,45-22.5,45+22.5)?"nesw-resize":t.Util._inRange($,90-22.5,90+22.5)?"ew-resize":t.Util._inRange($,135-22.5,135+22.5)?"nwse-resize":t.Util._inRange($,180-22.5,180+22.5)?"ns-resize":t.Util._inRange($,225-22.5,225+22.5)?"nesw-resize":t.Util._inRange($,270-22.5,270+22.5)?"ew-resize":t.Util._inRange($,315-22.5,315+22.5)?"nwse-resize":(t.Util.error("Transformer has unknown angle for cursor detection: "+$),"pointer")}const w=["top-left","top-center","top-right","middle-right","middle-left","bottom-left","bottom-center","bottom-right"];function T(O){return{x:O.x+O.width/2*Math.cos(O.rotation)+O.height/2*Math.sin(-O.rotation),y:O.y+O.height/2*Math.cos(O.rotation)+O.width/2*Math.sin(O.rotation)}}function _(O,F,B){const $=B.x+(O.x-B.x)*Math.cos(F)-(O.y-B.y)*Math.sin(F),Z=B.y+(O.x-B.x)*Math.sin(F)+(O.y-B.y)*Math.cos(F);return{...O,rotation:O.rotation+F,x:$,y:Z}}function C(O,F){const B=T(O);return _(O,F,B)}function N(O,F,B){let $=F;for(let Z=0;Z<O.length;Z++){const D=s.Konva.getAngle(O[Z]),H=Math.abs(D-F)%(Math.PI*2);Math.min(H,Math.PI*2-H)<B&&($=D)}return $}let A=0;class I extends a.Group{constructor(F){super(F),this._movingAnchorName=null,this._transforming=!1,this._createElements(),this._handleMouseMove=this._handleMouseMove.bind(this),this._handleMouseUp=this._handleMouseUp.bind(this),this.update=this.update.bind(this),this.on(c,this.update),this.getNode()&&this.update()}attachTo(F){return this.setNode(F),this}setNode(F){return t.Util.warn("tr.setNode(shape), tr.node(shape) and tr.attachTo(shape) methods are deprecated. Please use tr.nodes(nodesArray) instead."),this.setNodes([F])}getNode(){return this._nodes&&this._nodes[0]}_getEventNamespace(){return u+this._id}setNodes(F=[]){this._nodes&&this._nodes.length&&this.detach();const B=F.filter(Z=>Z.isAncestorOf(this)?(t.Util.error("Konva.Transformer cannot be an a child of the node you are trying to attach"),!1):!0);return this._nodes=F=B,F.length===1&&this.useSingleNodeRotation()?this.rotation(F[0].getAbsoluteRotation()):this.rotation(0),this._nodes.forEach(Z=>{const D=()=>{this.nodes().length===1&&this.useSingleNodeRotation()&&this.rotation(this.nodes()[0].getAbsoluteRotation()),this._resetTransformCache(),!this._transforming&&!this.isDragging()&&this.update()},H=Z._attrsAffectingSize.map(U=>U+"Change."+this._getEventNamespace()).join(" ");Z.on(H,D),Z.on(p.map(U=>U+`.${this._getEventNamespace()}`).join(" "),D),Z.on(`absoluteTransformChange.${this._getEventNamespace()}`,D),this._proxyDrag(Z)}),this._resetTransformCache(),this.findOne(".top-left")&&this.update(),this}_proxyDrag(F){let B;F.on(`dragstart.${this._getEventNamespace()}`,$=>{B=F.getAbsolutePosition(),!this.isDragging()&&F!==this.findOne(".back")&&this.startDrag($,!1)}),F.on(`dragmove.${this._getEventNamespace()}`,$=>{if(!B)return;const Z=F.getAbsolutePosition(),D=Z.x-B.x,H=Z.y-B.y;this.nodes().forEach(U=>{if(U===F||U.isDragging())return;const W=U.getAbsolutePosition();U.setAbsolutePosition({x:W.x+D,y:W.y+H}),U.startDrag($)}),B=null})}getNodes(){return this._nodes||[]}getActiveAnchor(){return this._movingAnchorName}detach(){this._nodes&&this._nodes.forEach(F=>{F.off("."+this._getEventNamespace())}),this._nodes=[],this._resetTransformCache()}_resetTransformCache(){this._clearCache(h),this._clearCache("transform"),this._clearSelfAndDescendantCache("absoluteTransform")}_getNodeRect(){return this._getCache(h,this.__getNodeRect)}__getNodeShape(F,B=this.rotation(),$){const Z=F.getClientRect({skipTransform:!0,skipShadow:!0,skipStroke:this.ignoreStroke()}),D=F.getAbsoluteScale($),H=F.getAbsolutePosition($),U=Z.x*D.x-F.offsetX()*D.x,W=Z.y*D.y-F.offsetY()*D.y,Y=(s.Konva.getAngle(F.getAbsoluteRotation())+Math.PI*2)%(Math.PI*2),Q={x:H.x+U*Math.cos(Y)+W*Math.sin(-Y),y:H.y+W*Math.cos(Y)+U*Math.sin(Y),width:Z.width*D.x,height:Z.height*D.y,rotation:Y};return _(Q,-s.Konva.getAngle(B),{x:0,y:0})}__getNodeRect(){if(!this.getNode())return{x:-1e8,y:-1e8,width:0,height:0,rotation:0};const B=[];this.nodes().map(Y=>{const Q=Y.getClientRect({skipTransform:!0,skipShadow:!0,skipStroke:this.ignoreStroke()}),ne=[{x:Q.x,y:Q.y},{x:Q.x+Q.width,y:Q.y},{x:Q.x+Q.width,y:Q.y+Q.height},{x:Q.x,y:Q.y+Q.height}],re=Y.getAbsoluteTransform();ne.forEach(function(q){const te=re.point(q);B.push(te)})});const $=new t.Transform;$.rotate(-s.Konva.getAngle(this.rotation()));let Z=1/0,D=1/0,H=-1/0,U=-1/0;B.forEach(function(Y){const Q=$.point(Y);Z===void 0&&(Z=H=Q.x,D=U=Q.y),Z=Math.min(Z,Q.x),D=Math.min(D,Q.y),H=Math.max(H,Q.x),U=Math.max(U,Q.y)}),$.invert();const W=$.point({x:Z,y:D});return{x:W.x,y:W.y,width:H-Z,height:U-D,rotation:s.Konva.getAngle(this.rotation())}}getX(){return this._getNodeRect().x}getY(){return this._getNodeRect().y}getWidth(){return this._getNodeRect().width}getHeight(){return this._getNodeRect().height}_createElements(){this._createBack(),w.forEach(F=>{this._createAnchor(F)}),this._createAnchor("rotater")}_createAnchor(F){const B=new i.Rect({stroke:"rgb(0, 161, 255)",fill:"white",strokeWidth:1,name:F+" _anchor",dragDistance:0,draggable:!0,hitStrokeWidth:y?10:"auto"}),$=this;B.on("mousedown touchstart",function(Z){$._handleMouseDown(Z)}),B.on("dragstart",Z=>{B.stopDrag(),Z.cancelBubble=!0}),B.on("dragend",Z=>{Z.cancelBubble=!0}),B.on("mouseenter",()=>{const Z=s.Konva.getAngle(this.rotation()),D=this.rotateAnchorCursor(),H=S(F,Z,D);B.getStage().content&&(B.getStage().content.style.cursor=H),this._cursorChange=!0}),B.on("mouseout",()=>{B.getStage().content&&(B.getStage().content.style.cursor=""),this._cursorChange=!1}),this.add(B)}_createBack(){const F=new n.Shape({name:"back",width:0,height:0,draggable:!0,sceneFunc(B,$){const Z=$.getParent(),D=Z.padding();B.beginPath(),B.rect(-D,-D,$.width()+D*2,$.height()+D*2),B.moveTo($.width()/2,-D),Z.rotateEnabled()&&Z.rotateLineVisible()&&B.lineTo($.width()/2,-Z.rotateAnchorOffset()*t.Util._sign($.height())-D),B.fillStrokeShape($)},hitFunc:(B,$)=>{if(!this.shouldOverdrawWholeArea())return;const Z=this.padding();B.beginPath(),B.rect(-Z,-Z,$.width()+Z*2,$.height()+Z*2),B.fillStrokeShape($)}});this.add(F),this._proxyDrag(F),F.on("dragstart",B=>{B.cancelBubble=!0}),F.on("dragmove",B=>{B.cancelBubble=!0}),F.on("dragend",B=>{B.cancelBubble=!0}),this.on("dragmove",B=>{this.update()})}_handleMouseDown(F){if(this._transforming)return;this._movingAnchorName=F.target.name().split(" ")[0];const B=this._getNodeRect(),$=B.width,Z=B.height,D=Math.sqrt(Math.pow($,2)+Math.pow(Z,2));this.sin=Math.abs(Z/D),this.cos=Math.abs($/D),typeof window<"u"&&(window.addEventListener("mousemove",this._handleMouseMove),window.addEventListener("touchmove",this._handleMouseMove),window.addEventListener("mouseup",this._handleMouseUp,!0),window.addEventListener("touchend",this._handleMouseUp,!0)),this._transforming=!0;const H=F.target.getAbsolutePosition(),U=F.target.getStage().getPointerPosition();this._anchorDragOffset={x:U.x-H.x,y:U.y-H.y},A++,this._fire("transformstart",{evt:F.evt,target:this.getNode()}),this._nodes.forEach(W=>{W._fire("transformstart",{evt:F.evt,target:W})})}_handleMouseMove(F){let B,$,Z;const D=this.findOne("."+this._movingAnchorName),H=D.getStage();H.setPointersPositions(F);const U=H.getPointerPosition();let W={x:U.x-this._anchorDragOffset.x,y:U.y-this._anchorDragOffset.y};const Y=D.getAbsolutePosition();this.anchorDragBoundFunc()&&(W=this.anchorDragBoundFunc()(Y,W,F)),D.setAbsolutePosition(W);const Q=D.getAbsolutePosition();if(Y.x===Q.x&&Y.y===Q.y)return;if(this._movingAnchorName==="rotater"){const le=this._getNodeRect();B=D.x()-le.width/2,$=-D.y()+le.height/2;let pe=Math.atan2(-$,B)+Math.PI/2;le.height<0&&(pe-=Math.PI);const xe=s.Konva.getAngle(this.rotation())+pe,Se=s.Konva.getAngle(this.rotationSnapTolerance()),$e=N(this.rotationSnaps(),xe,Se)-le.rotation,St=C(le,$e);this._fitNodesInto(St,F);return}const ne=this.shiftBehavior();let re;ne==="inverted"?re=this.keepRatio()&&!F.shiftKey:ne==="none"?re=this.keepRatio():re=this.keepRatio()||F.shiftKey;var ge=this.centeredScaling()||F.altKey;if(this._movingAnchorName==="top-left"){if(re){var q=ge?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".bottom-right").x(),y:this.findOne(".bottom-right").y()};Z=Math.sqrt(Math.pow(q.x-D.x(),2)+Math.pow(q.y-D.y(),2));var te=this.findOne(".top-left").x()>q.x?-1:1,ae=this.findOne(".top-left").y()>q.y?-1:1;B=Z*this.cos*te,$=Z*this.sin*ae,this.findOne(".top-left").x(q.x-B),this.findOne(".top-left").y(q.y-$)}}else if(this._movingAnchorName==="top-center")this.findOne(".top-left").y(D.y());else if(this._movingAnchorName==="top-right"){if(re){var q=ge?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".bottom-left").x(),y:this.findOne(".bottom-left").y()};Z=Math.sqrt(Math.pow(D.x()-q.x,2)+Math.pow(q.y-D.y(),2));var te=this.findOne(".top-right").x()<q.x?-1:1,ae=this.findOne(".top-right").y()>q.y?-1:1;B=Z*this.cos*te,$=Z*this.sin*ae,this.findOne(".top-right").x(q.x+B),this.findOne(".top-right").y(q.y-$)}var de=D.position();this.findOne(".top-left").y(de.y),this.findOne(".bottom-right").x(de.x)}else if(this._movingAnchorName==="middle-left")this.findOne(".top-left").x(D.x());else if(this._movingAnchorName==="middle-right")this.findOne(".bottom-right").x(D.x());else if(this._movingAnchorName==="bottom-left"){if(re){var q=ge?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".top-right").x(),y:this.findOne(".top-right").y()};Z=Math.sqrt(Math.pow(q.x-D.x(),2)+Math.pow(D.y()-q.y,2));var te=q.x<D.x()?-1:1,ae=D.y()<q.y?-1:1;B=Z*this.cos*te,$=Z*this.sin*ae,D.x(q.x-B),D.y(q.y+$)}de=D.position(),this.findOne(".top-left").x(de.x),this.findOne(".bottom-right").y(de.y)}else if(this._movingAnchorName==="bottom-center")this.findOne(".bottom-right").y(D.y());else if(this._movingAnchorName==="bottom-right"){if(re){var q=ge?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".top-left").x(),y:this.findOne(".top-left").y()};Z=Math.sqrt(Math.pow(D.x()-q.x,2)+Math.pow(D.y()-q.y,2));var te=this.findOne(".bottom-right").x()<q.x?-1:1,ae=this.findOne(".bottom-right").y()<q.y?-1:1;B=Z*this.cos*te,$=Z*this.sin*ae,this.findOne(".bottom-right").x(q.x+B),this.findOne(".bottom-right").y(q.y+$)}}else console.error(new Error("Wrong position argument of selection resizer: "+this._movingAnchorName));var ge=this.centeredScaling()||F.altKey;if(ge){const le=this.findOne(".top-left"),pe=this.findOne(".bottom-right"),me=le.x(),xe=le.y(),Se=this.getWidth()-pe.x(),Ve=this.getHeight()-pe.y();pe.move({x:-me,y:-xe}),le.move({x:Se,y:Ve})}const ye=this.findOne(".top-left").getAbsolutePosition();B=ye.x,$=ye.y;const se=this.findOne(".bottom-right").x()-this.findOne(".top-left").x(),fe=this.findOne(".bottom-right").y()-this.findOne(".top-left").y();this._fitNodesInto({x:B,y:$,width:se,height:fe,rotation:s.Konva.getAngle(this.rotation())},F)}_handleMouseUp(F){this._removeEvents(F)}getAbsoluteTransform(){return this.getTransform()}_removeEvents(F){var B;if(this._transforming){this._transforming=!1,typeof window<"u"&&(window.removeEventListener("mousemove",this._handleMouseMove),window.removeEventListener("touchmove",this._handleMouseMove),window.removeEventListener("mouseup",this._handleMouseUp,!0),window.removeEventListener("touchend",this._handleMouseUp,!0));const $=this.getNode();A--,this._fire("transformend",{evt:F,target:$}),(B=this.getLayer())===null||B===void 0||B.batchDraw(),$&&this._nodes.forEach(Z=>{var D;Z._fire("transformend",{evt:F,target:Z}),(D=Z.getLayer())===null||D===void 0||D.batchDraw()}),this._movingAnchorName=null}}_fitNodesInto(F,B){const $=this._getNodeRect(),Z=1;if(t.Util._inRange(F.width,-this.padding()*2-Z,Z)){this.update();return}if(t.Util._inRange(F.height,-this.padding()*2-Z,Z)){this.update();return}const D=new t.Transform;if(D.rotate(s.Konva.getAngle(this.rotation())),this._movingAnchorName&&F.width<0&&this._movingAnchorName.indexOf("left")>=0){const re=D.point({x:-this.padding()*2,y:0});F.x+=re.x,F.y+=re.y,F.width+=this.padding()*2,this._movingAnchorName=this._movingAnchorName.replace("left","right"),this._anchorDragOffset.x-=re.x,this._anchorDragOffset.y-=re.y}else if(this._movingAnchorName&&F.width<0&&this._movingAnchorName.indexOf("right")>=0){const re=D.point({x:this.padding()*2,y:0});this._movingAnchorName=this._movingAnchorName.replace("right","left"),this._anchorDragOffset.x-=re.x,this._anchorDragOffset.y-=re.y,F.width+=this.padding()*2}if(this._movingAnchorName&&F.height<0&&this._movingAnchorName.indexOf("top")>=0){const re=D.point({x:0,y:-this.padding()*2});F.x+=re.x,F.y+=re.y,this._movingAnchorName=this._movingAnchorName.replace("top","bottom"),this._anchorDragOffset.x-=re.x,this._anchorDragOffset.y-=re.y,F.height+=this.padding()*2}else if(this._movingAnchorName&&F.height<0&&this._movingAnchorName.indexOf("bottom")>=0){const re=D.point({x:0,y:this.padding()*2});this._movingAnchorName=this._movingAnchorName.replace("bottom","top"),this._anchorDragOffset.x-=re.x,this._anchorDragOffset.y-=re.y,F.height+=this.padding()*2}if(this.boundBoxFunc()){const re=this.boundBoxFunc()($,F);re?F=re:t.Util.warn("boundBoxFunc returned falsy. You should return new bound rect from it!")}const H=1e7,U=new t.Transform;U.translate($.x,$.y),U.rotate($.rotation),U.scale($.width/H,$.height/H);const W=new t.Transform,Y=F.width/H,Q=F.height/H;this.flipEnabled()===!1?(W.translate(F.x,F.y),W.rotate(F.rotation),W.translate(F.width<0?F.width:0,F.height<0?F.height:0),W.scale(Math.abs(Y),Math.abs(Q))):(W.translate(F.x,F.y),W.rotate(F.rotation),W.scale(Y,Q));const ne=W.multiply(U.invert());this._nodes.forEach(re=>{var q;const te=re.getParent().getAbsoluteTransform(),ae=re.getTransform().copy();ae.translate(re.offsetX(),re.offsetY());const de=new t.Transform;de.multiply(te.copy().invert()).multiply(ne).multiply(te).multiply(ae);const ge=de.decompose();re.setAttrs(ge),(q=re.getLayer())===null||q===void 0||q.batchDraw()}),this.rotation(t.Util._getRotation(F.rotation)),this._nodes.forEach(re=>{this._fire("transform",{evt:B,target:re}),re._fire("transform",{evt:B,target:re})}),this._resetTransformCache(),this.update(),this.getLayer().batchDraw()}forceUpdate(){this._resetTransformCache(),this.update()}_batchChangeChild(F,B){this.findOne(F).setAttrs(B)}update(){var F;const B=this._getNodeRect();this.rotation(t.Util._getRotation(B.rotation));const $=B.width,Z=B.height,D=this.enabledAnchors(),H=this.resizeEnabled(),U=this.padding(),W=this.anchorSize(),Y=this.find("._anchor");Y.forEach(ne=>{ne.setAttrs({width:W,height:W,offsetX:W/2,offsetY:W/2,stroke:this.anchorStroke(),strokeWidth:this.anchorStrokeWidth(),fill:this.anchorFill(),cornerRadius:this.anchorCornerRadius()})}),this._batchChangeChild(".top-left",{x:0,y:0,offsetX:W/2+U,offsetY:W/2+U,visible:H&&D.indexOf("top-left")>=0}),this._batchChangeChild(".top-center",{x:$/2,y:0,offsetY:W/2+U,visible:H&&D.indexOf("top-center")>=0}),this._batchChangeChild(".top-right",{x:$,y:0,offsetX:W/2-U,offsetY:W/2+U,visible:H&&D.indexOf("top-right")>=0}),this._batchChangeChild(".middle-left",{x:0,y:Z/2,offsetX:W/2+U,visible:H&&D.indexOf("middle-left")>=0}),this._batchChangeChild(".middle-right",{x:$,y:Z/2,offsetX:W/2-U,visible:H&&D.indexOf("middle-right")>=0}),this._batchChangeChild(".bottom-left",{x:0,y:Z,offsetX:W/2+U,offsetY:W/2-U,visible:H&&D.indexOf("bottom-left")>=0}),this._batchChangeChild(".bottom-center",{x:$/2,y:Z,offsetY:W/2-U,visible:H&&D.indexOf("bottom-center")>=0}),this._batchChangeChild(".bottom-right",{x:$,y:Z,offsetX:W/2-U,offsetY:W/2-U,visible:H&&D.indexOf("bottom-right")>=0}),this._batchChangeChild(".rotater",{x:$/2,y:-this.rotateAnchorOffset()*t.Util._sign(Z)-U,visible:this.rotateEnabled()}),this._batchChangeChild(".back",{width:$,height:Z,visible:this.borderEnabled(),stroke:this.borderStroke(),strokeWidth:this.borderStrokeWidth(),dash:this.borderDash(),x:0,y:0});const Q=this.anchorStyleFunc();Q&&Y.forEach(ne=>{Q(ne)}),(F=this.getLayer())===null||F===void 0||F.batchDraw()}isTransforming(){return this._transforming}stopTransform(){if(this._transforming){this._removeEvents();const F=this.findOne("."+this._movingAnchorName);F&&F.stopDrag()}}destroy(){return this.getStage()&&this._cursorChange&&this.getStage().content&&(this.getStage().content.style.cursor=""),a.Group.prototype.destroy.call(this),this.detach(),this._removeEvents(),this}toObject(){return r.Node.prototype.toObject.call(this)}clone(F){return r.Node.prototype.clone.call(this,F)}getClientRect(){return this.nodes().length>0?super.getClientRect():{x:0,y:0,width:0,height:0}}}vg.Transformer=I,I.isTransforming=()=>A>0;function j(O){return O instanceof Array||t.Util.warn("enabledAnchors value should be an array"),O instanceof Array&&O.forEach(function(F){w.indexOf(F)===-1&&t.Util.warn("Unknown anchor name: "+F+". Available names are: "+w.join(", "))}),O||[]}return I.prototype.className="Transformer",(0,l._registerNode)(I),e.Factory.addGetterSetter(I,"enabledAnchors",w,j),e.Factory.addGetterSetter(I,"flipEnabled",!0,(0,o.getBooleanValidator)()),e.Factory.addGetterSetter(I,"resizeEnabled",!0),e.Factory.addGetterSetter(I,"anchorSize",10,(0,o.getNumberValidator)()),e.Factory.addGetterSetter(I,"rotateEnabled",!0),e.Factory.addGetterSetter(I,"rotateLineVisible",!0),e.Factory.addGetterSetter(I,"rotationSnaps",[]),e.Factory.addGetterSetter(I,"rotateAnchorOffset",50,(0,o.getNumberValidator)()),e.Factory.addGetterSetter(I,"rotateAnchorCursor","crosshair"),e.Factory.addGetterSetter(I,"rotationSnapTolerance",5,(0,o.getNumberValidator)()),e.Factory.addGetterSetter(I,"borderEnabled",!0),e.Factory.addGetterSetter(I,"anchorStroke","rgb(0, 161, 255)"),e.Factory.addGetterSetter(I,"anchorStrokeWidth",1,(0,o.getNumberValidator)()),e.Factory.addGetterSetter(I,"anchorFill","white"),e.Factory.addGetterSetter(I,"anchorCornerRadius",0,(0,o.getNumberValidator)()),e.Factory.addGetterSetter(I,"borderStroke","rgb(0, 161, 255)"),e.Factory.addGetterSetter(I,"borderStrokeWidth",1,(0,o.getNumberValidator)()),e.Factory.addGetterSetter(I,"borderDash"),e.Factory.addGetterSetter(I,"keepRatio",!0),e.Factory.addGetterSetter(I,"shiftBehavior","default"),e.Factory.addGetterSetter(I,"centeredScaling",!1),e.Factory.addGetterSetter(I,"ignoreStroke",!1),e.Factory.addGetterSetter(I,"padding",0,(0,o.getNumberValidator)()),e.Factory.addGetterSetter(I,"node"),e.Factory.addGetterSetter(I,"nodes"),e.Factory.addGetterSetter(I,"boundBoxFunc"),e.Factory.addGetterSetter(I,"anchorDragBoundFunc"),e.Factory.addGetterSetter(I,"anchorStyleFunc"),e.Factory.addGetterSetter(I,"shouldOverdrawWholeArea",!1),e.Factory.addGetterSetter(I,"useSingleNodeRotation",!0),e.Factory.backCompat(I,{lineEnabled:"borderEnabled",rotateHandlerOffset:"rotateAnchorOffset",enabledHandlers:"enabledAnchors"}),vg}var yg={},G5;function LG(){if(G5)return yg;G5=1,Object.defineProperty(yg,"__esModule",{value:!0}),yg.Wedge=void 0;const t=Pr(),e=Sa(),r=Tr(),n=Ar(),i=Tr();let a=class extends e.Shape{_sceneFunc(o){o.beginPath(),o.arc(0,0,this.radius(),0,r.Konva.getAngle(this.angle()),this.clockwise()),o.lineTo(0,0),o.closePath(),o.fillStrokeShape(this)}getWidth(){return this.radius()*2}getHeight(){return this.radius()*2}setWidth(o){this.radius(o/2)}setHeight(o){this.radius(o/2)}};return yg.Wedge=a,a.prototype.className="Wedge",a.prototype._centroid=!0,a.prototype._attrsAffectingSize=["radius"],(0,i._registerNode)(a),t.Factory.addGetterSetter(a,"radius",0,(0,n.getNumberValidator)()),t.Factory.addGetterSetter(a,"angle",0,(0,n.getNumberValidator)()),t.Factory.addGetterSetter(a,"clockwise",!1),t.Factory.backCompat(a,{angleDeg:"angle",getAngleDeg:"getAngle",setAngleDeg:"setAngle"}),yg}var xg={},V5;function OG(){if(V5)return xg;V5=1,Object.defineProperty(xg,"__esModule",{value:!0}),xg.Blur=void 0;const t=Pr(),e=Ti(),r=Ar();function n(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}const i=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],a=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function s(l,u){const c=l.data,h=l.width,p=l.height;let v,y,S,w,T,_,C,N,A,I,j,O,F,B,$,Z,D,H,U,W,Y,Q,ne,re,q=u+u+1,te=h-1,ae=p-1,de=u+1,ge=de*(de+1)/2,ye=new n,se=null,fe=ye,le=null,pe=null,me=i[u],xe=a[u];for(S=1;S<q;S++)fe=fe.next=new n,S===de&&(se=fe);for(fe.next=ye,C=_=0,y=0;y<p;y++){for(Z=D=H=U=N=A=I=j=0,O=de*(W=c[_]),F=de*(Y=c[_+1]),B=de*(Q=c[_+2]),$=de*(ne=c[_+3]),N+=ge*W,A+=ge*Y,I+=ge*Q,j+=ge*ne,fe=ye,S=0;S<de;S++)fe.r=W,fe.g=Y,fe.b=Q,fe.a=ne,fe=fe.next;for(S=1;S<de;S++)w=_+((te<S?te:S)<<2),N+=(fe.r=W=c[w])*(re=de-S),A+=(fe.g=Y=c[w+1])*re,I+=(fe.b=Q=c[w+2])*re,j+=(fe.a=ne=c[w+3])*re,Z+=W,D+=Y,H+=Q,U+=ne,fe=fe.next;for(le=ye,pe=se,v=0;v<h;v++)c[_+3]=ne=j*me>>xe,ne!==0?(ne=255/ne,c[_]=(N*me>>xe)*ne,c[_+1]=(A*me>>xe)*ne,c[_+2]=(I*me>>xe)*ne):c[_]=c[_+1]=c[_+2]=0,N-=O,A-=F,I-=B,j-=$,O-=le.r,F-=le.g,B-=le.b,$-=le.a,w=C+((w=v+u+1)<te?w:te)<<2,Z+=le.r=c[w],D+=le.g=c[w+1],H+=le.b=c[w+2],U+=le.a=c[w+3],N+=Z,A+=D,I+=H,j+=U,le=le.next,O+=W=pe.r,F+=Y=pe.g,B+=Q=pe.b,$+=ne=pe.a,Z-=W,D-=Y,H-=Q,U-=ne,pe=pe.next,_+=4;C+=h}for(v=0;v<h;v++){for(D=H=U=Z=A=I=j=N=0,_=v<<2,O=de*(W=c[_]),F=de*(Y=c[_+1]),B=de*(Q=c[_+2]),$=de*(ne=c[_+3]),N+=ge*W,A+=ge*Y,I+=ge*Q,j+=ge*ne,fe=ye,S=0;S<de;S++)fe.r=W,fe.g=Y,fe.b=Q,fe.a=ne,fe=fe.next;for(T=h,S=1;S<=u;S++)_=T+v<<2,N+=(fe.r=W=c[_])*(re=de-S),A+=(fe.g=Y=c[_+1])*re,I+=(fe.b=Q=c[_+2])*re,j+=(fe.a=ne=c[_+3])*re,Z+=W,D+=Y,H+=Q,U+=ne,fe=fe.next,S<ae&&(T+=h);for(_=v,le=ye,pe=se,y=0;y<p;y++)w=_<<2,c[w+3]=ne=j*me>>xe,ne>0?(ne=255/ne,c[w]=(N*me>>xe)*ne,c[w+1]=(A*me>>xe)*ne,c[w+2]=(I*me>>xe)*ne):c[w]=c[w+1]=c[w+2]=0,N-=O,A-=F,I-=B,j-=$,O-=le.r,F-=le.g,B-=le.b,$-=le.a,w=v+((w=y+de)<ae?w:ae)*h<<2,N+=Z+=le.r=c[w],A+=D+=le.g=c[w+1],I+=H+=le.b=c[w+2],j+=U+=le.a=c[w+3],le=le.next,O+=W=pe.r,F+=Y=pe.g,B+=Q=pe.b,$+=ne=pe.a,Z-=W,D-=Y,H-=Q,U-=ne,pe=pe.next,_+=h}}const o=function(u){const c=Math.round(this.blurRadius());c>0&&s(u,c)};return xg.Blur=o,t.Factory.addGetterSetter(e.Node,"blurRadius",0,(0,r.getNumberValidator)(),t.Factory.afterSetFilter),xg}var bg={},H5;function DG(){if(H5)return bg;H5=1,Object.defineProperty(bg,"__esModule",{value:!0}),bg.Brighten=void 0;const t=Pr(),e=Ti(),r=Ar(),n=function(i){let a=this.brightness()*255,s=i.data,o=s.length,l;for(l=0;l<o;l+=4)s[l]+=a,s[l+1]+=a,s[l+2]+=a};return bg.Brighten=n,t.Factory.addGetterSetter(e.Node,"brightness",0,(0,r.getNumberValidator)(),t.Factory.afterSetFilter),bg}var wg={},W5;function IG(){if(W5)return wg;W5=1,Object.defineProperty(wg,"__esModule",{value:!0}),wg.Contrast=void 0;const t=Pr(),e=Ti(),r=Ar(),n=function(i){const a=Math.pow((this.contrast()+100)/100,2);let s=i.data,o=s.length,l=150,u=150,c=150,h;for(h=0;h<o;h+=4)l=s[h],u=s[h+1],c=s[h+2],l/=255,l-=.5,l*=a,l+=.5,l*=255,u/=255,u-=.5,u*=a,u+=.5,u*=255,c/=255,c-=.5,c*=a,c+=.5,c*=255,l=l<0?0:l>255?255:l,u=u<0?0:u>255?255:u,c=c<0?0:c>255?255:c,s[h]=l,s[h+1]=u,s[h+2]=c};return wg.Contrast=n,t.Factory.addGetterSetter(e.Node,"contrast",0,(0,r.getNumberValidator)(),t.Factory.afterSetFilter),wg}var Sg={},q5;function jG(){if(q5)return Sg;q5=1,Object.defineProperty(Sg,"__esModule",{value:!0}),Sg.Emboss=void 0;const t=Pr(),e=Ti(),r=mi(),n=Ar(),i=function(a){let s=this.embossStrength()*10,o=this.embossWhiteLevel()*255,l=this.embossDirection(),u=this.embossBlend(),c=0,h=0,p=a.data,v=a.width,y=a.height,S=v*4,w=y;switch(l){case"top-left":c=-1,h=-1;break;case"top":c=-1,h=0;break;case"top-right":c=-1,h=1;break;case"right":c=0,h=1;break;case"bottom-right":c=1,h=1;break;case"bottom":c=1,h=0;break;case"bottom-left":c=1,h=-1;break;case"left":c=0,h=-1;break;default:r.Util.error("Unknown emboss direction: "+l)}do{const T=(w-1)*S;let _=c;w+_<1&&(_=0),w+_>y&&(_=0);const C=(w-1+_)*v*4;let N=v;do{const A=T+(N-1)*4;let I=h;N+I<1&&(I=0),N+I>v&&(I=0);const j=C+(N-1+I)*4,O=p[A]-p[j],F=p[A+1]-p[j+1],B=p[A+2]-p[j+2];let $=O;const Z=$>0?$:-$,D=F>0?F:-F,H=B>0?B:-B;if(D>Z&&($=F),H>Z&&($=B),$*=s,u){const U=p[A]+$,W=p[A+1]+$,Y=p[A+2]+$;p[A]=U>255?255:U<0?0:U,p[A+1]=W>255?255:W<0?0:W,p[A+2]=Y>255?255:Y<0?0:Y}else{let U=o-$;U<0?U=0:U>255&&(U=255),p[A]=p[A+1]=p[A+2]=U}}while(--N)}while(--w)};return Sg.Emboss=i,t.Factory.addGetterSetter(e.Node,"embossStrength",.5,(0,n.getNumberValidator)(),t.Factory.afterSetFilter),t.Factory.addGetterSetter(e.Node,"embossWhiteLevel",.5,(0,n.getNumberValidator)(),t.Factory.afterSetFilter),t.Factory.addGetterSetter(e.Node,"embossDirection","top-left",null,t.Factory.afterSetFilter),t.Factory.addGetterSetter(e.Node,"embossBlend",!1,null,t.Factory.afterSetFilter),Sg}var kg={},$5;function FG(){if($5)return kg;$5=1,Object.defineProperty(kg,"__esModule",{value:!0}),kg.Enhance=void 0;const t=Pr(),e=Ti(),r=Ar();function n(a,s,o,l,u){let c=o-s,h=u-l,p;return c===0?l+h/2:h===0?l:(p=(a-s)/c,p=h*p+l,p)}const i=function(a){let s=a.data,o=s.length,l=s[0],u=l,c,h=s[1],p=h,v,y=s[2],S=y,w,T;const _=this.enhance();if(_===0)return;for(T=0;T<o;T+=4)c=s[T+0],c<l?l=c:c>u&&(u=c),v=s[T+1],v<h?h=v:v>p&&(p=v),w=s[T+2],w<y?y=w:w>S&&(S=w);u===l&&(u=255,l=0),p===h&&(p=255,h=0),S===y&&(S=255,y=0);let C,N,A,I,j,O,F,B,$;for(_>0?(N=u+_*(255-u),A=l-_*(l-0),j=p+_*(255-p),O=h-_*(h-0),B=S+_*(255-S),$=y-_*(y-0)):(C=(u+l)*.5,N=u+_*(u-C),A=l+_*(l-C),I=(p+h)*.5,j=p+_*(p-I),O=h+_*(h-I),F=(S+y)*.5,B=S+_*(S-F),$=y+_*(y-F)),T=0;T<o;T+=4)s[T+0]=n(s[T+0],l,u,A,N),s[T+1]=n(s[T+1],h,p,O,j),s[T+2]=n(s[T+2],y,S,$,B)};return kg.Enhance=i,t.Factory.addGetterSetter(e.Node,"enhance",0,(0,r.getNumberValidator)(),t.Factory.afterSetFilter),kg}var _g={},K5;function BG(){if(K5)return _g;K5=1,Object.defineProperty(_g,"__esModule",{value:!0}),_g.Grayscale=void 0;const t=function(e){let r=e.data,n=r.length,i,a;for(i=0;i<n;i+=4)a=.34*r[i]+.5*r[i+1]+.16*r[i+2],r[i]=a,r[i+1]=a,r[i+2]=a};return _g.Grayscale=t,_g}var Cg={},Z5;function zG(){if(Z5)return Cg;Z5=1,Object.defineProperty(Cg,"__esModule",{value:!0}),Cg.HSL=void 0;const t=Pr(),e=Ti(),r=Ar();t.Factory.addGetterSetter(e.Node,"hue",0,(0,r.getNumberValidator)(),t.Factory.afterSetFilter),t.Factory.addGetterSetter(e.Node,"saturation",0,(0,r.getNumberValidator)(),t.Factory.afterSetFilter),t.Factory.addGetterSetter(e.Node,"luminance",0,(0,r.getNumberValidator)(),t.Factory.afterSetFilter);const n=function(i){let a=i.data,s=a.length,o=1,l=Math.pow(2,this.saturation()),u=Math.abs(this.hue()+360)%360,c=this.luminance()*127,h;const p=o*l*Math.cos(u*Math.PI/180),v=o*l*Math.sin(u*Math.PI/180),y=.299*o+.701*p+.167*v,S=.587*o-.587*p+.33*v,w=.114*o-.114*p-.497*v,T=.299*o-.299*p-.328*v,_=.587*o+.413*p+.035*v,C=.114*o-.114*p+.293*v,N=.299*o-.3*p+1.25*v,A=.587*o-.586*p-1.05*v,I=.114*o+.886*p-.2*v;let j,O,F,B;for(h=0;h<s;h+=4)j=a[h+0],O=a[h+1],F=a[h+2],B=a[h+3],a[h+0]=y*j+S*O+w*F+c,a[h+1]=T*j+_*O+C*F+c,a[h+2]=N*j+A*O+I*F+c,a[h+3]=B};return Cg.HSL=n,Cg}var Eg={},Y5;function UG(){if(Y5)return Eg;Y5=1,Object.defineProperty(Eg,"__esModule",{value:!0}),Eg.HSV=void 0;const t=Pr(),e=Ti(),r=Ar(),n=function(i){const a=i.data,s=a.length,o=Math.pow(2,this.value()),l=Math.pow(2,this.saturation()),u=Math.abs(this.hue()+360)%360,c=o*l*Math.cos(u*Math.PI/180),h=o*l*Math.sin(u*Math.PI/180),p=.299*o+.701*c+.167*h,v=.587*o-.587*c+.33*h,y=.114*o-.114*c-.497*h,S=.299*o-.299*c-.328*h,w=.587*o+.413*c+.035*h,T=.114*o-.114*c+.293*h,_=.299*o-.3*c+1.25*h,C=.587*o-.586*c-1.05*h,N=.114*o+.886*c-.2*h;let A,I,j,O;for(let F=0;F<s;F+=4)A=a[F+0],I=a[F+1],j=a[F+2],O=a[F+3],a[F+0]=p*A+v*I+y*j,a[F+1]=S*A+w*I+T*j,a[F+2]=_*A+C*I+N*j,a[F+3]=O};return Eg.HSV=n,t.Factory.addGetterSetter(e.Node,"hue",0,(0,r.getNumberValidator)(),t.Factory.afterSetFilter),t.Factory.addGetterSetter(e.Node,"saturation",0,(0,r.getNumberValidator)(),t.Factory.afterSetFilter),t.Factory.addGetterSetter(e.Node,"value",0,(0,r.getNumberValidator)(),t.Factory.afterSetFilter),Eg}var Tg={},X5;function GG(){if(X5)return Tg;X5=1,Object.defineProperty(Tg,"__esModule",{value:!0}),Tg.Invert=void 0;const t=function(e){let r=e.data,n=r.length,i;for(i=0;i<n;i+=4)r[i]=255-r[i],r[i+1]=255-r[i+1],r[i+2]=255-r[i+2]};return Tg.Invert=t,Tg}var Ng={},Q5;function VG(){if(Q5)return Ng;Q5=1,Object.defineProperty(Ng,"__esModule",{value:!0}),Ng.Kaleidoscope=void 0;const t=Pr(),e=Ti(),r=mi(),n=Ar(),i=function(o,l,u){let c=o.data,h=l.data,p=o.width,v=o.height,y=u.polarCenterX||p/2,S=u.polarCenterY||v/2,w,T,_,C=0,N=0,A=0,I=0,j,O=Math.sqrt(y*y+S*S);T=p-y,_=v-S,j=Math.sqrt(T*T+_*_),O=j>O?j:O;let F=v,B=p,$,Z,D=360/B*Math.PI/180,H,U;for(Z=0;Z<B;Z+=1)for(H=Math.sin(Z*D),U=Math.cos(Z*D),$=0;$<F;$+=1)T=Math.floor(y+O*$/F*U),_=Math.floor(S+O*$/F*H),w=(_*p+T)*4,C=c[w+0],N=c[w+1],A=c[w+2],I=c[w+3],w=(Z+$*p)*4,h[w+0]=C,h[w+1]=N,h[w+2]=A,h[w+3]=I},a=function(o,l,u){let c=o.data,h=l.data,p=o.width,v=o.height,y=u.polarCenterX||p/2,S=u.polarCenterY||v/2,w,T,_,C,N,A=0,I=0,j=0,O=0,F,B=Math.sqrt(y*y+S*S);T=p-y,_=v-S,F=Math.sqrt(T*T+_*_),B=F>B?F:B;let $=v,Z=p,D,H,U=0,W,Y;for(T=0;T<p;T+=1)for(_=0;_<v;_+=1)C=T-y,N=_-S,D=Math.sqrt(C*C+N*N)*$/B,H=(Math.atan2(N,C)*180/Math.PI+360+U)%360,H=H*Z/360,W=Math.floor(H),Y=Math.floor(D),w=(Y*p+W)*4,A=c[w+0],I=c[w+1],j=c[w+2],O=c[w+3],w=(_*p+T)*4,h[w+0]=A,h[w+1]=I,h[w+2]=j,h[w+3]=O},s=function(o){const l=o.width,u=o.height;let c,h,p,v,y,S,w,T,_,C,N=Math.round(this.kaleidoscopePower());const A=Math.round(this.kaleidoscopeAngle()),I=Math.floor(l*(A%360)/360);if(N<1)return;const j=r.Util.createCanvasElement();j.width=l,j.height=u;const O=j.getContext("2d").getImageData(0,0,l,u);r.Util.releaseCanvas(j),i(o,O,{polarCenterX:l/2,polarCenterY:u/2});let F=l/Math.pow(2,N);for(;F<=8;)F=F*2,N-=1;F=Math.ceil(F);let B=F,$=0,Z=B,D=1;for(I+F>l&&($=B,Z=0,D=-1),h=0;h<u;h+=1)for(c=$;c!==Z;c+=D)p=Math.round(c+I)%l,_=(l*h+p)*4,y=O.data[_+0],S=O.data[_+1],w=O.data[_+2],T=O.data[_+3],C=(l*h+c)*4,O.data[C+0]=y,O.data[C+1]=S,O.data[C+2]=w,O.data[C+3]=T;for(h=0;h<u;h+=1)for(B=Math.floor(F),v=0;v<N;v+=1){for(c=0;c<B+1;c+=1)_=(l*h+c)*4,y=O.data[_+0],S=O.data[_+1],w=O.data[_+2],T=O.data[_+3],C=(l*h+B*2-c-1)*4,O.data[C+0]=y,O.data[C+1]=S,O.data[C+2]=w,O.data[C+3]=T;B*=2}a(O,o,{})};return Ng.Kaleidoscope=s,t.Factory.addGetterSetter(e.Node,"kaleidoscopePower",2,(0,n.getNumberValidator)(),t.Factory.afterSetFilter),t.Factory.addGetterSetter(e.Node,"kaleidoscopeAngle",0,(0,n.getNumberValidator)(),t.Factory.afterSetFilter),Ng}var Pg={},J5;function HG(){if(J5)return Pg;J5=1,Object.defineProperty(Pg,"__esModule",{value:!0}),Pg.Mask=void 0;const t=Pr(),e=Ti(),r=Ar();function n(p,v,y){let S=(y*p.width+v)*4;const w=[];return w.push(p.data[S++],p.data[S++],p.data[S++],p.data[S++]),w}function i(p,v){return Math.sqrt(Math.pow(p[0]-v[0],2)+Math.pow(p[1]-v[1],2)+Math.pow(p[2]-v[2],2))}function a(p){const v=[0,0,0];for(let y=0;y<p.length;y++)v[0]+=p[y][0],v[1]+=p[y][1],v[2]+=p[y][2];return v[0]/=p.length,v[1]/=p.length,v[2]/=p.length,v}function s(p,v){const y=n(p,0,0),S=n(p,p.width-1,0),w=n(p,0,p.height-1),T=n(p,p.width-1,p.height-1),_=v||10;if(i(y,S)<_&&i(S,T)<_&&i(T,w)<_&&i(w,y)<_){const C=a([S,y,T,w]),N=[];for(let A=0;A<p.width*p.height;A++){const I=i(C,[p.data[A*4],p.data[A*4+1],p.data[A*4+2]]);N[A]=I<_?0:255}return N}}function o(p,v){for(let y=0;y<p.width*p.height;y++)p.data[4*y+3]=v[y]}function l(p,v,y){const S=[1,1,1,1,0,1,1,1,1],w=Math.round(Math.sqrt(S.length)),T=Math.floor(w/2),_=[];for(let C=0;C<y;C++)for(let N=0;N<v;N++){const A=C*v+N;let I=0;for(let j=0;j<w;j++)for(let O=0;O<w;O++){const F=C+j-T,B=N+O-T;if(F>=0&&F<y&&B>=0&&B<v){const $=F*v+B,Z=S[j*w+O];I+=p[$]*Z}}_[A]=I===2040?255:0}return _}function u(p,v,y){const S=[1,1,1,1,1,1,1,1,1],w=Math.round(Math.sqrt(S.length)),T=Math.floor(w/2),_=[];for(let C=0;C<y;C++)for(let N=0;N<v;N++){const A=C*v+N;let I=0;for(let j=0;j<w;j++)for(let O=0;O<w;O++){const F=C+j-T,B=N+O-T;if(F>=0&&F<y&&B>=0&&B<v){const $=F*v+B,Z=S[j*w+O];I+=p[$]*Z}}_[A]=I>=1020?255:0}return _}function c(p,v,y){const S=[.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111],w=Math.round(Math.sqrt(S.length)),T=Math.floor(w/2),_=[];for(let C=0;C<y;C++)for(let N=0;N<v;N++){const A=C*v+N;let I=0;for(let j=0;j<w;j++)for(let O=0;O<w;O++){const F=C+j-T,B=N+O-T;if(F>=0&&F<y&&B>=0&&B<v){const $=F*v+B,Z=S[j*w+O];I+=p[$]*Z}}_[A]=I}return _}const h=function(p){let v=this.threshold(),y=s(p,v);return y&&(y=l(y,p.width,p.height),y=u(y,p.width,p.height),y=c(y,p.width,p.height),o(p,y)),p};return Pg.Mask=h,t.Factory.addGetterSetter(e.Node,"threshold",0,(0,r.getNumberValidator)(),t.Factory.afterSetFilter),Pg}var Mg={},e4;function WG(){if(e4)return Mg;e4=1,Object.defineProperty(Mg,"__esModule",{value:!0}),Mg.Noise=void 0;const t=Pr(),e=Ti(),r=Ar(),n=function(i){const a=this.noise()*255,s=i.data,o=s.length,l=a/2;for(let u=0;u<o;u+=4)s[u+0]+=l-2*l*Math.random(),s[u+1]+=l-2*l*Math.random(),s[u+2]+=l-2*l*Math.random()};return Mg.Noise=n,t.Factory.addGetterSetter(e.Node,"noise",.2,(0,r.getNumberValidator)(),t.Factory.afterSetFilter),Mg}var Ag={},t4;function qG(){if(t4)return Ag;t4=1,Object.defineProperty(Ag,"__esModule",{value:!0}),Ag.Pixelate=void 0;const t=Pr(),e=mi(),r=Ti(),n=Ar(),i=function(a){let s=Math.ceil(this.pixelSize()),o=a.width,l=a.height,u,c,h,p,v,y,S,w=Math.ceil(o/s),T=Math.ceil(l/s),_,C,N,A,I,j,O,F=a.data;if(s<=0){e.Util.error("pixelSize value can not be <= 0");return}for(I=0;I<w;I+=1)for(j=0;j<T;j+=1){for(p=0,v=0,y=0,S=0,_=I*s,C=_+s,N=j*s,A=N+s,O=0,u=_;u<C;u+=1)if(!(u>=o))for(c=N;c<A;c+=1)c>=l||(h=(o*c+u)*4,p+=F[h+0],v+=F[h+1],y+=F[h+2],S+=F[h+3],O+=1);for(p=p/O,v=v/O,y=y/O,S=S/O,u=_;u<C;u+=1)if(!(u>=o))for(c=N;c<A;c+=1)c>=l||(h=(o*c+u)*4,F[h+0]=p,F[h+1]=v,F[h+2]=y,F[h+3]=S)}};return Ag.Pixelate=i,t.Factory.addGetterSetter(r.Node,"pixelSize",8,(0,n.getNumberValidator)(),t.Factory.afterSetFilter),Ag}var Rg={},r4;function $G(){if(r4)return Rg;r4=1,Object.defineProperty(Rg,"__esModule",{value:!0}),Rg.Posterize=void 0;const t=Pr(),e=Ti(),r=Ar(),n=function(i){let a=Math.round(this.levels()*254)+1,s=i.data,o=s.length,l=255/a,u;for(u=0;u<o;u+=1)s[u]=Math.floor(s[u]/l)*l};return Rg.Posterize=n,t.Factory.addGetterSetter(e.Node,"levels",.5,(0,r.getNumberValidator)(),t.Factory.afterSetFilter),Rg}var Lg={},n4;function KG(){if(n4)return Lg;n4=1,Object.defineProperty(Lg,"__esModule",{value:!0}),Lg.RGB=void 0;const t=Pr(),e=Ti(),r=Ar(),n=function(i){let a=i.data,s=a.length,o=this.red(),l=this.green(),u=this.blue(),c,h;for(c=0;c<s;c+=4)h=(.34*a[c]+.5*a[c+1]+.16*a[c+2])/255,a[c]=h*o,a[c+1]=h*l,a[c+2]=h*u,a[c+3]=a[c+3]};return Lg.RGB=n,t.Factory.addGetterSetter(e.Node,"red",0,function(i){return this._filterUpToDate=!1,i>255?255:i<0?0:Math.round(i)}),t.Factory.addGetterSetter(e.Node,"green",0,function(i){return this._filterUpToDate=!1,i>255?255:i<0?0:Math.round(i)}),t.Factory.addGetterSetter(e.Node,"blue",0,r.RGBComponent,t.Factory.afterSetFilter),Lg}var Og={},i4;function ZG(){if(i4)return Og;i4=1,Object.defineProperty(Og,"__esModule",{value:!0}),Og.RGBA=void 0;const t=Pr(),e=Ti(),r=Ar(),n=function(i){const a=i.data,s=a.length,o=this.red(),l=this.green(),u=this.blue(),c=this.alpha();for(let h=0;h<s;h+=4){const p=1-c;a[h]=o*c+a[h]*p,a[h+1]=l*c+a[h+1]*p,a[h+2]=u*c+a[h+2]*p}};return Og.RGBA=n,t.Factory.addGetterSetter(e.Node,"red",0,function(i){return this._filterUpToDate=!1,i>255?255:i<0?0:Math.round(i)}),t.Factory.addGetterSetter(e.Node,"green",0,function(i){return this._filterUpToDate=!1,i>255?255:i<0?0:Math.round(i)}),t.Factory.addGetterSetter(e.Node,"blue",0,r.RGBComponent,t.Factory.afterSetFilter),t.Factory.addGetterSetter(e.Node,"alpha",1,function(i){return this._filterUpToDate=!1,i>1?1:i<0?0:i}),Og}var Dg={},a4;function YG(){if(a4)return Dg;a4=1,Object.defineProperty(Dg,"__esModule",{value:!0}),Dg.Sepia=void 0;const t=function(e){let r=e.data,n=r.length,i,a,s,o;for(i=0;i<n;i+=4)a=r[i+0],s=r[i+1],o=r[i+2],r[i+0]=Math.min(255,a*.393+s*.769+o*.189),r[i+1]=Math.min(255,a*.349+s*.686+o*.168),r[i+2]=Math.min(255,a*.272+s*.534+o*.131)};return Dg.Sepia=t,Dg}var Ig={},s4;function XG(){if(s4)return Ig;s4=1,Object.defineProperty(Ig,"__esModule",{value:!0}),Ig.Solarize=void 0;const t=function(e){const r=e.data,n=e.width,i=e.height,a=n*4;let s=i;do{const o=(s-1)*a;let l=n;do{const u=o+(l-1)*4;let c=r[u],h=r[u+1],p=r[u+2];c>127&&(c=255-c),h>127&&(h=255-h),p>127&&(p=255-p),r[u]=c,r[u+1]=h,r[u+2]=p}while(--l)}while(--s)};return Ig.Solarize=t,Ig}var jg={},o4;function QG(){if(o4)return jg;o4=1,Object.defineProperty(jg,"__esModule",{value:!0}),jg.Threshold=void 0;const t=Pr(),e=Ti(),r=Ar(),n=function(i){const a=this.threshold()*255,s=i.data,o=s.length;for(let l=0;l<o;l+=1)s[l]=s[l]<a?0:255};return jg.Threshold=n,t.Factory.addGetterSetter(e.Node,"threshold",.5,(0,r.getNumberValidator)(),t.Factory.afterSetFilter),jg}var l4;function JG(){if(l4)return Xm;l4=1,Object.defineProperty(Xm,"__esModule",{value:!0}),Xm.Konva=void 0;const t=JS(),e=bG(),r=SG(),n=kG(),i=_G(),a=CG(),s=EG(),o=CR(),l=__(),u=ER(),c=TG(),h=NG(),p=PG(),v=MG(),y=TR(),S=AG(),w=RG(),T=LG(),_=OG(),C=DG(),N=IG(),A=jG(),I=FG(),j=BG(),O=zG(),F=UG(),B=GG(),$=VG(),Z=HG(),D=WG(),H=qG(),U=$G(),W=KG(),Y=ZG(),Q=YG(),ne=XG(),re=QG();return Xm.Konva=t.Konva.Util._assign(t.Konva,{Arc:e.Arc,Arrow:r.Arrow,Circle:n.Circle,Ellipse:i.Ellipse,Image:a.Image,Label:s.Label,Tag:s.Tag,Line:o.Line,Path:l.Path,Rect:u.Rect,RegularPolygon:c.RegularPolygon,Ring:h.Ring,Sprite:p.Sprite,Star:v.Star,Text:y.Text,TextPath:S.TextPath,Transformer:w.Transformer,Wedge:T.Wedge,Filters:{Blur:_.Blur,Brighten:C.Brighten,Contrast:N.Contrast,Emboss:A.Emboss,Enhance:I.Enhance,Grayscale:j.Grayscale,HSL:O.HSL,HSV:F.HSV,Invert:B.Invert,Kaleidoscope:$.Kaleidoscope,Mask:Z.Mask,Noise:D.Noise,Pixelate:H.Pixelate,Posterize:U.Posterize,RGB:W.RGB,RGBA:Y.RGBA,Sepia:Q.Sepia,Solarize:ne.Solarize,Threshold:re.Threshold}}),Xm}var eV=Wy.exports,u4;function tV(){if(u4)return Wy.exports;u4=1,Object.defineProperty(eV,"__esModule",{value:!0});const t=JG();return Wy.exports=t.Konva,Wy.exports}tV();var fy={exports:{}},c4;function rV(){return c4||(c4=1,(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.Konva=void 0;var r=JS();Object.defineProperty(e,"Konva",{enumerable:!0,get:function(){return r.Konva}});const n=JS();t.exports=n.Konva})(fy,fy.exports)),fy.exports}var nV=rV();const Nv=Tf(nV);var R2={exports:{}};var L2,d4;function iV(){return d4||(d4=1,L2=function(e){var r={},n=sm(),i=Wk(),a=Object.assign;function s(x){for(var b="https://reactjs.org/docs/error-decoder.html?invariant="+x,M=1;M<arguments.length;M++)b+="&args[]="+encodeURIComponent(arguments[M]);return"Minified React error #"+x+"; visit "+b+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,l=Symbol.for("react.element"),u=Symbol.for("react.portal"),c=Symbol.for("react.fragment"),h=Symbol.for("react.strict_mode"),p=Symbol.for("react.profiler"),v=Symbol.for("react.provider"),y=Symbol.for("react.context"),S=Symbol.for("react.forward_ref"),w=Symbol.for("react.suspense"),T=Symbol.for("react.suspense_list"),_=Symbol.for("react.memo"),C=Symbol.for("react.lazy"),N=Symbol.for("react.offscreen"),A=Symbol.iterator;function I(x){return x===null||typeof x!="object"?null:(x=A&&x[A]||x["@@iterator"],typeof x=="function"?x:null)}function j(x){if(x==null)return null;if(typeof x=="function")return x.displayName||x.name||null;if(typeof x=="string")return x;switch(x){case c:return"Fragment";case u:return"Portal";case p:return"Profiler";case h:return"StrictMode";case w:return"Suspense";case T:return"SuspenseList"}if(typeof x=="object")switch(x.$$typeof){case y:return(x.displayName||"Context")+".Consumer";case v:return(x._context.displayName||"Context")+".Provider";case S:var b=x.render;return x=x.displayName,x||(x=b.displayName||b.name||"",x=x!==""?"ForwardRef("+x+")":"ForwardRef"),x;case _:return b=x.displayName||null,b!==null?b:j(x.type)||"Memo";case C:b=x._payload,x=x._init;try{return j(x(b))}catch{}}return null}function O(x){var b=x.type;switch(x.tag){case 24:return"Cache";case 9:return(b.displayName||"Context")+".Consumer";case 10:return(b._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return x=b.render,x=x.displayName||x.name||"",b.displayName||(x!==""?"ForwardRef("+x+")":"ForwardRef");case 7:return"Fragment";case 5:return b;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return j(b);case 8:return b===h?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof b=="function")return b.displayName||b.name||null;if(typeof b=="string")return b}return null}function F(x){var b=x,M=x;if(x.alternate)for(;b.return;)b=b.return;else{x=b;do b=x,(b.flags&4098)!==0&&(M=b.return),x=b.return;while(x)}return b.tag===3?M:null}function B(x){if(F(x)!==x)throw Error(s(188))}function $(x){var b=x.alternate;if(!b){if(b=F(x),b===null)throw Error(s(188));return b!==x?null:x}for(var M=x,z=b;;){var K=M.return;if(K===null)break;var ee=K.alternate;if(ee===null){if(z=K.return,z!==null){M=z;continue}break}if(K.child===ee.child){for(ee=K.child;ee;){if(ee===M)return B(K),x;if(ee===z)return B(K),b;ee=ee.sibling}throw Error(s(188))}if(M.return!==z.return)M=K,z=ee;else{for(var he=!1,Ne=K.child;Ne;){if(Ne===M){he=!0,M=K,z=ee;break}if(Ne===z){he=!0,z=K,M=ee;break}Ne=Ne.sibling}if(!he){for(Ne=ee.child;Ne;){if(Ne===M){he=!0,M=ee,z=K;break}if(Ne===z){he=!0,z=ee,M=K;break}Ne=Ne.sibling}if(!he)throw Error(s(189))}}if(M.alternate!==z)throw Error(s(190))}if(M.tag!==3)throw Error(s(188));return M.stateNode.current===M?x:b}function Z(x){return x=$(x),x!==null?D(x):null}function D(x){if(x.tag===5||x.tag===6)return x;for(x=x.child;x!==null;){var b=D(x);if(b!==null)return b;x=x.sibling}return null}function H(x){if(x.tag===5||x.tag===6)return x;for(x=x.child;x!==null;){if(x.tag!==4){var b=H(x);if(b!==null)return b}x=x.sibling}return null}var U=Array.isArray,W=e.getPublicInstance,Y=e.getRootHostContext,Q=e.getChildHostContext,ne=e.prepareForCommit,re=e.resetAfterCommit,q=e.createInstance,te=e.appendInitialChild,ae=e.finalizeInitialChildren,de=e.prepareUpdate,ge=e.shouldSetTextContent,ye=e.createTextInstance,se=e.scheduleTimeout,fe=e.cancelTimeout,le=e.noTimeout,pe=e.isPrimaryRenderer,me=e.supportsMutation,xe=e.supportsPersistence,Se=e.supportsHydration,Ve=e.getInstanceFromNode,$e=e.preparePortalMount,St=e.getCurrentEventPriority,rt=e.detachDeletedInstance,lt=e.supportsMicrotasks,De=e.scheduleMicrotask,Le=e.supportsTestSelectors,Qe=e.findFiberRoot,Ce=e.getBoundingRect,Fe=e.getTextContent,Ke=e.isHiddenSubtree,mt=e.matchAccessibilityRole,gt=e.setFocusIfFocusable,yt=e.setupIntersectionObserver,jt=e.appendChild,qt=e.appendChildToContainer,wt=e.commitTextUpdate,ft=e.commitMount,qe=e.commitUpdate,ce=e.insertBefore,ve=e.insertInContainerBefore,ke=e.removeChild,Te=e.removeChildFromContainer,Re=e.resetTextContent,Je=e.hideInstance,ze=e.hideTextInstance,vt=e.unhideInstance,pt=e.unhideTextInstance,At=e.clearContainer,Ut=e.cloneInstance,Kt=e.createContainerChildSet,Ct=e.appendChildToContainerChildSet,Yt=e.finalizeContainerChildren,Xt=e.replaceContainerChildren,Lr=e.cloneHiddenInstance,ar=e.cloneHiddenTextInstance,mn=e.canHydrateInstance,Wr=e.canHydrateTextInstance,Br=e.canHydrateSuspenseInstance,nn=e.isSuspenseInstancePending,br=e.isSuspenseInstanceFallback,Tt=e.getSuspenseInstanceFallbackErrorDetails,zr=e.registerSuspenseInstanceRetry,Qn=e.getNextHydratableSibling,Ji=e.getFirstHydratableChild,Ka=e.getFirstHydratableChildWithinContainer,Rs=e.getFirstHydratableChildWithinSuspenseInstance,Ln=e.hydrateInstance,un=e.hydrateTextInstance,bn=e.hydrateSuspenseInstance,Jn=e.getNextHydratableInstanceAfterSuspenseInstance,zi=e.commitHydratedContainer,vi=e.commitHydratedSuspenseInstance,Jo=e.clearSuspenseBoundary,el=e.clearSuspenseBoundaryFromContainer,zl=e.shouldDeleteUnhydratedTailInstances,xo=e.didNotMatchHydratedContainerTextInstance,Xr=e.didNotMatchHydratedTextInstance,tl;function fs(x){if(tl===void 0)try{throw Error()}catch(M){var b=M.stack.trim().match(/\n( *(at )?)/);tl=b&&b[1]||""}return`
`+tl+x}var Be=!1;function Xe(x,b){if(!x||Be)return"";Be=!0;var M=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(b)if(b=function(){throw Error()},Object.defineProperty(b.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(b,[])}catch(dt){var z=dt}Reflect.construct(x,[],b)}else{try{b.call()}catch(dt){z=dt}x.call(b.prototype)}else{try{throw Error()}catch(dt){z=dt}x()}}catch(dt){if(dt&&z&&typeof dt.stack=="string"){for(var K=dt.stack.split(`
`),ee=z.stack.split(`
`),he=K.length-1,Ne=ee.length-1;1<=he&&0<=Ne&&K[he]!==ee[Ne];)Ne--;for(;1<=he&&0<=Ne;he--,Ne--)if(K[he]!==ee[Ne]){if(he!==1||Ne!==1)do if(he--,Ne--,0>Ne||K[he]!==ee[Ne]){var Ge=`
`+K[he].replace(" at new "," at ");return x.displayName&&Ge.includes("<anonymous>")&&(Ge=Ge.replace("<anonymous>",x.displayName)),Ge}while(1<=he&&0<=Ne);break}}}finally{Be=!1,Error.prepareStackTrace=M}return(x=x?x.displayName||x.name:"")?fs(x):""}var ot=Object.prototype.hasOwnProperty,Vt=[],ir=-1;function tr(x){return{current:x}}function gr(x){0>ir||(x.current=Vt[ir],Vt[ir]=null,ir--)}function ct(x,b){ir++,Vt[ir]=x.current,x.current=b}var mr={},Qr=tr(mr),Ur=tr(!1),Or=mr;function ii(x,b){var M=x.type.contextTypes;if(!M)return mr;var z=x.stateNode;if(z&&z.__reactInternalMemoizedUnmaskedChildContext===b)return z.__reactInternalMemoizedMaskedChildContext;var K={},ee;for(ee in M)K[ee]=b[ee];return z&&(x=x.stateNode,x.__reactInternalMemoizedUnmaskedChildContext=b,x.__reactInternalMemoizedMaskedChildContext=K),K}function it(x){return x=x.childContextTypes,x!=null}function sr(){gr(Ur),gr(Qr)}function yi(x,b,M){if(Qr.current!==mr)throw Error(s(168));ct(Qr,b),ct(Ur,M)}function On(x,b,M){var z=x.stateNode;if(b=b.childContextTypes,typeof z.getChildContext!="function")return M;z=z.getChildContext();for(var K in z)if(!(K in b))throw Error(s(108,O(x)||"Unknown",K));return a({},M,z)}function Dn(x){return x=(x=x.stateNode)&&x.__reactInternalMemoizedMergedChildContext||mr,Or=Qr.current,ct(Qr,x),ct(Ur,Ur.current),!0}function Ul(x,b,M){var z=x.stateNode;if(!z)throw Error(s(169));M?(x=On(x,b,Or),z.__reactInternalMemoizedMergedChildContext=x,gr(Ur),gr(Qr),ct(Qr,x)):gr(Ur),ct(Ur,M)}var Mi=Math.clz32?Math.clz32:to,ps=Math.log,In=Math.LN2;function to(x){return x>>>=0,x===0?32:31-(ps(x)/In|0)|0}var wr=64,ro=4194304;function bo(x){switch(x&-x){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return x&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return x&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return x}}function Ls(x,b){var M=x.pendingLanes;if(M===0)return 0;var z=0,K=x.suspendedLanes,ee=x.pingedLanes,he=M&268435455;if(he!==0){var Ne=he&~K;Ne!==0?z=bo(Ne):(ee&=he,ee!==0&&(z=bo(ee)))}else he=M&~K,he!==0?z=bo(he):ee!==0&&(z=bo(ee));if(z===0)return 0;if(b!==0&&b!==z&&(b&K)===0&&(K=z&-z,ee=b&-b,K>=ee||K===16&&(ee&4194240)!==0))return b;if((z&4)!==0&&(z|=M&16),b=x.entangledLanes,b!==0)for(x=x.entanglements,b&=z;0<b;)M=31-Mi(b),K=1<<M,z|=x[M],b&=~K;return z}function Cc(x,b){switch(x){case 1:case 2:case 4:return b+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return b+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Ec(x,b){for(var M=x.suspendedLanes,z=x.pingedLanes,K=x.expirationTimes,ee=x.pendingLanes;0<ee;){var he=31-Mi(ee),Ne=1<<he,Ge=K[he];Ge===-1?((Ne&M)===0||(Ne&z)!==0)&&(K[he]=Cc(Ne,b)):Ge<=b&&(x.expiredLanes|=Ne),ee&=~Ne}}function rl(x){return x=x.pendingLanes&-1073741825,x!==0?x:x&1073741824?1073741824:0}function Gl(){var x=wr;return wr<<=1,(wr&4194240)===0&&(wr=64),x}function wo(x){for(var b=[],M=0;31>M;M++)b.push(x);return b}function Ui(x,b,M){x.pendingLanes|=b,b!==536870912&&(x.suspendedLanes=0,x.pingedLanes=0),x=x.eventTimes,b=31-Mi(b),x[b]=M}function no(x,b){var M=x.pendingLanes&~b;x.pendingLanes=b,x.suspendedLanes=0,x.pingedLanes=0,x.expiredLanes&=b,x.mutableReadLanes&=b,x.entangledLanes&=b,b=x.entanglements;var z=x.eventTimes;for(x=x.expirationTimes;0<M;){var K=31-Mi(M),ee=1<<K;b[K]=0,z[K]=-1,x[K]=-1,M&=~ee}}function Za(x,b){var M=x.entangledLanes|=b;for(x=x.entanglements;M;){var z=31-Mi(M),K=1<<z;K&b|x[z]&b&&(x[z]|=b),M&=~K}}var Sr=0;function rr(x){return x&=-x,1<x?4<x?(x&268435455)!==0?16:536870912:4:1}var ei=i.unstable_scheduleCallback,qr=i.unstable_cancelCallback,gh=i.unstable_shouldYield,nl=i.unstable_requestPaint,jn=i.unstable_now,Vl=i.unstable_ImmediatePriority,Os=i.unstable_UserBlockingPriority,Hl=i.unstable_NormalPriority,Lu=i.unstable_IdlePriority,cn=null,Fn=null;function il(x){if(Fn&&typeof Fn.onCommitFiberRoot=="function")try{Fn.onCommitFiberRoot(cn,x,void 0,(x.current.flags&128)===128)}catch{}}function Ou(x,b){return x===b&&(x!==0||1/x===1/b)||x!==x&&b!==b}var ms=typeof Object.is=="function"?Object.is:Ou,Ds=null,So=!1,Wl=!1;function Du(x){Ds===null?Ds=[x]:Ds.push(x)}function Cr(x){So=!0,Du(x)}function xi(){if(!Wl&&Ds!==null){Wl=!0;var x=0,b=Sr;try{var M=Ds;for(Sr=1;x<M.length;x++){var z=M[x];do z=z(!0);while(z!==null)}Ds=null,So=!1}catch(K){throw Ds!==null&&(Ds=Ds.slice(x+1)),ei(Vl,xi),K}finally{Sr=b,Wl=!1}}return null}var ai=[],ka=0,ql=null,al=0,bi=[],_a=0,Bn=null,ea=1,gs="";function Ca(x,b){ai[ka++]=al,ai[ka++]=ql,ql=x,al=b}function Of(x,b,M){bi[_a++]=ea,bi[_a++]=gs,bi[_a++]=Bn,Bn=x;var z=ea;x=gs;var K=32-Mi(z)-1;z&=~(1<<K),M+=1;var ee=32-Mi(b)+K;if(30<ee){var he=K-K%5;ee=(z&(1<<he)-1).toString(32),z>>=he,K-=he,ea=1<<32-Mi(b)+K|M<<K|z,gs=ee+x}else ea=1<<ee|M<<K|z,gs=x}function ta(x){x.return!==null&&(Ca(x,1),Of(x,1,0))}function Iu(x){for(;x===ql;)ql=ai[--ka],ai[ka]=null,al=ai[--ka],ai[ka]=null;for(;x===Bn;)Bn=bi[--_a],bi[_a]=null,gs=bi[--_a],bi[_a]=null,ea=bi[--_a],bi[_a]=null}var si=null,wn=null,Jr=!1,$l=!1,Ea=null;function Df(x,b){var M=Cs(5,null,null,0);M.elementType="DELETED",M.stateNode=b,M.return=x,b=x.deletions,b===null?(x.deletions=[M],x.flags|=16):b.push(M)}function ju(x,b){switch(x.tag){case 5:return b=mn(b,x.type,x.pendingProps),b!==null?(x.stateNode=b,si=x,wn=Ji(b),!0):!1;case 6:return b=Wr(b,x.pendingProps),b!==null?(x.stateNode=b,si=x,wn=null,!0):!1;case 13:if(b=Br(b),b!==null){var M=Bn!==null?{id:ea,overflow:gs}:null;return x.memoizedState={dehydrated:b,treeContext:M,retryLane:1073741824},M=Cs(18,null,null,0),M.stateNode=b,M.return=x,x.child=M,si=x,wn=null,!0}return!1;default:return!1}}function Tc(x){return(x.mode&1)!==0&&(x.flags&128)===0}function vh(x){if(Jr){var b=wn;if(b){var M=b;if(!ju(x,b)){if(Tc(x))throw Error(s(418));b=Qn(M);var z=si;b&&ju(x,b)?Df(z,M):(x.flags=x.flags&-4097|2,Jr=!1,si=x)}}else{if(Tc(x))throw Error(s(418));x.flags=x.flags&-4097|2,Jr=!1,si=x}}}function If(x){for(x=x.return;x!==null&&x.tag!==5&&x.tag!==3&&x.tag!==13;)x=x.return;si=x}function Kl(x){if(!Se||x!==si)return!1;if(!Jr)return If(x),Jr=!0,!1;if(x.tag!==3&&(x.tag!==5||zl(x.type)&&!ge(x.type,x.memoizedProps))){var b=wn;if(b){if(Tc(x))throw jf(),Error(s(418));for(;b;)Df(x,b),b=Qn(b)}}if(If(x),x.tag===13){if(!Se)throw Error(s(316));if(x=x.memoizedState,x=x!==null?x.dehydrated:null,!x)throw Error(s(317));wn=Jn(x)}else wn=si?Qn(x.stateNode):null;return!0}function jf(){for(var x=wn;x;)x=Qn(x)}function ko(){Se&&(wn=si=null,$l=Jr=!1)}function Nc(x){Ea===null?Ea=[x]:Ea.push(x)}var Pc=o.ReactCurrentBatchConfig;function Is(x,b){if(ms(x,b))return!0;if(typeof x!="object"||x===null||typeof b!="object"||b===null)return!1;var M=Object.keys(x),z=Object.keys(b);if(M.length!==z.length)return!1;for(z=0;z<M.length;z++){var K=M[z];if(!ot.call(b,K)||!ms(x[K],b[K]))return!1}return!0}function ym(x){switch(x.tag){case 5:return fs(x.type);case 16:return fs("Lazy");case 13:return fs("Suspense");case 19:return fs("SuspenseList");case 0:case 2:case 15:return x=Xe(x.type,!1),x;case 11:return x=Xe(x.type.render,!1),x;case 1:return x=Xe(x.type,!0),x;default:return""}}function vs(x,b,M){if(x=M.ref,x!==null&&typeof x!="function"&&typeof x!="object"){if(M._owner){if(M=M._owner,M){if(M.tag!==1)throw Error(s(309));var z=M.stateNode}if(!z)throw Error(s(147,x));var K=z,ee=""+x;return b!==null&&b.ref!==null&&typeof b.ref=="function"&&b.ref._stringRef===ee?b.ref:(b=function(he){var Ne=K.refs;he===null?delete Ne[ee]:Ne[ee]=he},b._stringRef=ee,b)}if(typeof x!="string")throw Error(s(284));if(!M._owner)throw Error(s(290,x))}return x}function Gi(x,b){throw x=Object.prototype.toString.call(b),Error(s(31,x==="[object Object]"?"object with keys {"+Object.keys(b).join(", ")+"}":x))}function yh(x){var b=x._init;return b(x._payload)}function xh(x){function b(je,Pe){if(x){var He=je.deletions;He===null?(je.deletions=[Pe],je.flags|=16):He.push(Pe)}}function M(je,Pe){if(!x)return null;for(;Pe!==null;)b(je,Pe),Pe=Pe.sibling;return null}function z(je,Pe){for(je=new Map;Pe!==null;)Pe.key!==null?je.set(Pe.key,Pe):je.set(Pe.index,Pe),Pe=Pe.sibling;return je}function K(je,Pe){return je=pu(je,Pe),je.index=0,je.sibling=null,je}function ee(je,Pe,He){return je.index=He,x?(He=je.alternate,He!==null?(He=He.index,He<Pe?(je.flags|=2,Pe):He):(je.flags|=2,Pe)):(je.flags|=1048576,Pe)}function he(je){return x&&je.alternate===null&&(je.flags|=2),je}function Ne(je,Pe,He,Nt){return Pe===null||Pe.tag!==6?(Pe=ad(He,je.mode,Nt),Pe.return=je,Pe):(Pe=K(Pe,He),Pe.return=je,Pe)}function Ge(je,Pe,He,Nt){var Gt=He.type;return Gt===c?Rt(je,Pe,He.props.children,Nt,He.key):Pe!==null&&(Pe.elementType===Gt||typeof Gt=="object"&&Gt!==null&&Gt.$$typeof===C&&yh(Gt)===Pe.type)?(Nt=K(Pe,He.props),Nt.ref=vs(je,Pe,He),Nt.return=je,Nt):(Nt=np(He.type,He.key,He.props,null,je.mode,Nt),Nt.ref=vs(je,Pe,He),Nt.return=je,Nt)}function dt(je,Pe,He,Nt){return Pe===null||Pe.tag!==4||Pe.stateNode.containerInfo!==He.containerInfo||Pe.stateNode.implementation!==He.implementation?(Pe=ip(He,je.mode,Nt),Pe.return=je,Pe):(Pe=K(Pe,He.children||[]),Pe.return=je,Pe)}function Rt(je,Pe,He,Nt,Gt){return Pe===null||Pe.tag!==7?(Pe=Wi(He,je.mode,Nt,Gt),Pe.return=je,Pe):(Pe=K(Pe,He),Pe.return=je,Pe)}function ur(je,Pe,He){if(typeof Pe=="string"&&Pe!==""||typeof Pe=="number")return Pe=ad(""+Pe,je.mode,He),Pe.return=je,Pe;if(typeof Pe=="object"&&Pe!==null){switch(Pe.$$typeof){case l:return He=np(Pe.type,Pe.key,Pe.props,null,je.mode,He),He.ref=vs(je,null,Pe),He.return=je,He;case u:return Pe=ip(Pe,je.mode,He),Pe.return=je,Pe;case C:var Nt=Pe._init;return ur(je,Nt(Pe._payload),He)}if(U(Pe)||I(Pe))return Pe=Wi(Pe,je.mode,He,null),Pe.return=je,Pe;Gi(je,Pe)}return null}function Et(je,Pe,He,Nt){var Gt=Pe!==null?Pe.key:null;if(typeof He=="string"&&He!==""||typeof He=="number")return Gt!==null?null:Ne(je,Pe,""+He,Nt);if(typeof He=="object"&&He!==null){switch(He.$$typeof){case l:return He.key===Gt?Ge(je,Pe,He,Nt):null;case u:return He.key===Gt?dt(je,Pe,He,Nt):null;case C:return Gt=He._init,Et(je,Pe,Gt(He._payload),Nt)}if(U(He)||I(He))return Gt!==null?null:Rt(je,Pe,He,Nt,null);Gi(je,He)}return null}function fn(je,Pe,He,Nt,Gt){if(typeof Nt=="string"&&Nt!==""||typeof Nt=="number")return je=je.get(He)||null,Ne(Pe,je,""+Nt,Gt);if(typeof Nt=="object"&&Nt!==null){switch(Nt.$$typeof){case l:return je=je.get(Nt.key===null?He:Nt.key)||null,Ge(Pe,je,Nt,Gt);case u:return je=je.get(Nt.key===null?He:Nt.key)||null,dt(Pe,je,Nt,Gt);case C:var vr=Nt._init;return fn(je,Pe,He,vr(Nt._payload),Gt)}if(U(Nt)||I(Nt))return je=je.get(He)||null,Rt(Pe,je,Nt,Gt,null);Gi(Pe,Nt)}return null}function Yr(je,Pe,He,Nt){for(var Gt=null,vr=null,cr=Pe,Rr=Pe=0,Ci=null;cr!==null&&Rr<He.length;Rr++){cr.index>Rr?(Ci=cr,cr=null):Ci=cr.sibling;var Mr=Et(je,cr,He[Rr],Nt);if(Mr===null){cr===null&&(cr=Ci);break}x&&cr&&Mr.alternate===null&&b(je,cr),Pe=ee(Mr,Pe,Rr),vr===null?Gt=Mr:vr.sibling=Mr,vr=Mr,cr=Ci}if(Rr===He.length)return M(je,cr),Jr&&Ca(je,Rr),Gt;if(cr===null){for(;Rr<He.length;Rr++)cr=ur(je,He[Rr],Nt),cr!==null&&(Pe=ee(cr,Pe,Rr),vr===null?Gt=cr:vr.sibling=cr,vr=cr);return Jr&&Ca(je,Rr),Gt}for(cr=z(je,cr);Rr<He.length;Rr++)Ci=fn(cr,je,Rr,He[Rr],Nt),Ci!==null&&(x&&Ci.alternate!==null&&cr.delete(Ci.key===null?Rr:Ci.key),Pe=ee(Ci,Pe,Rr),vr===null?Gt=Ci:vr.sibling=Ci,vr=Ci);return x&&cr.forEach(function(da){return b(je,da)}),Jr&&Ca(je,Rr),Gt}function Ia(je,Pe,He,Nt){var Gt=I(He);if(typeof Gt!="function")throw Error(s(150));if(He=Gt.call(He),He==null)throw Error(s(151));for(var vr=Gt=null,cr=Pe,Rr=Pe=0,Ci=null,Mr=He.next();cr!==null&&!Mr.done;Rr++,Mr=He.next()){cr.index>Rr?(Ci=cr,cr=null):Ci=cr.sibling;var da=Et(je,cr,Mr.value,Nt);if(da===null){cr===null&&(cr=Ci);break}x&&cr&&da.alternate===null&&b(je,cr),Pe=ee(da,Pe,Rr),vr===null?Gt=da:vr.sibling=da,vr=da,cr=Ci}if(Mr.done)return M(je,cr),Jr&&Ca(je,Rr),Gt;if(cr===null){for(;!Mr.done;Rr++,Mr=He.next())Mr=ur(je,Mr.value,Nt),Mr!==null&&(Pe=ee(Mr,Pe,Rr),vr===null?Gt=Mr:vr.sibling=Mr,vr=Mr);return Jr&&Ca(je,Rr),Gt}for(cr=z(je,cr);!Mr.done;Rr++,Mr=He.next())Mr=fn(cr,je,Rr,Mr.value,Nt),Mr!==null&&(x&&Mr.alternate!==null&&cr.delete(Mr.key===null?Rr:Mr.key),Pe=ee(Mr,Pe,Rr),vr===null?Gt=Mr:vr.sibling=Mr,vr=Mr);return x&&cr.forEach(function(cb){return b(je,cb)}),Jr&&Ca(je,Rr),Gt}function Io(je,Pe,He,Nt){if(typeof He=="object"&&He!==null&&He.type===c&&He.key===null&&(He=He.props.children),typeof He=="object"&&He!==null){switch(He.$$typeof){case l:e:{for(var Gt=He.key,vr=Pe;vr!==null;){if(vr.key===Gt){if(Gt=He.type,Gt===c){if(vr.tag===7){M(je,vr.sibling),Pe=K(vr,He.props.children),Pe.return=je,je=Pe;break e}}else if(vr.elementType===Gt||typeof Gt=="object"&&Gt!==null&&Gt.$$typeof===C&&yh(Gt)===vr.type){M(je,vr.sibling),Pe=K(vr,He.props),Pe.ref=vs(je,vr,He),Pe.return=je,je=Pe;break e}M(je,vr);break}else b(je,vr);vr=vr.sibling}He.type===c?(Pe=Wi(He.props.children,je.mode,Nt,He.key),Pe.return=je,je=Pe):(Nt=np(He.type,He.key,He.props,null,je.mode,Nt),Nt.ref=vs(je,Pe,He),Nt.return=je,je=Nt)}return he(je);case u:e:{for(vr=He.key;Pe!==null;){if(Pe.key===vr)if(Pe.tag===4&&Pe.stateNode.containerInfo===He.containerInfo&&Pe.stateNode.implementation===He.implementation){M(je,Pe.sibling),Pe=K(Pe,He.children||[]),Pe.return=je,je=Pe;break e}else{M(je,Pe);break}else b(je,Pe);Pe=Pe.sibling}Pe=ip(He,je.mode,Nt),Pe.return=je,je=Pe}return he(je);case C:return vr=He._init,Io(je,Pe,vr(He._payload),Nt)}if(U(He))return Yr(je,Pe,He,Nt);if(I(He))return Ia(je,Pe,He,Nt);Gi(je,He)}return typeof He=="string"&&He!==""||typeof He=="number"?(He=""+He,Pe!==null&&Pe.tag===6?(M(je,Pe.sibling),Pe=K(Pe,He),Pe.return=je,je=Pe):(M(je,Pe),Pe=ad(He,je.mode,Nt),Pe.return=je,je=Pe),he(je)):M(je,Pe)}return Io}var sl=xh(!0),Mc=xh(!1),Zl=tr(null),Ac=null,Yl=null,Rc=null;function bh(){Rc=Yl=Ac=null}function Ya(x,b,M){pe?(ct(Zl,b._currentValue),b._currentValue=M):(ct(Zl,b._currentValue2),b._currentValue2=M)}function js(x){var b=Zl.current;gr(Zl),pe?x._currentValue=b:x._currentValue2=b}function ol(x,b,M){for(;x!==null;){var z=x.alternate;if((x.childLanes&b)!==b?(x.childLanes|=b,z!==null&&(z.childLanes|=b)):z!==null&&(z.childLanes&b)!==b&&(z.childLanes|=b),x===M)break;x=x.return}}function ra(x,b){Ac=x,Rc=Yl=null,x=x.dependencies,x!==null&&x.firstContext!==null&&((x.lanes&b)!==0&&(Vn=!0),x.firstContext=null)}function Ta(x){var b=pe?x._currentValue:x._currentValue2;if(Rc!==x)if(x={context:x,memoizedValue:b,next:null},Yl===null){if(Ac===null)throw Error(s(308));Yl=x,Ac.dependencies={lanes:0,firstContext:x}}else Yl=Yl.next=x;return b}var Na=null;function Lc(x){Na===null?Na=[x]:Na.push(x)}function ll(x,b,M,z){var K=b.interleaved;return K===null?(M.next=M,Lc(b)):(M.next=K.next,K.next=M),b.interleaved=M,Xa(x,z)}function Xa(x,b){x.lanes|=b;var M=x.alternate;for(M!==null&&(M.lanes|=b),M=x,x=x.return;x!==null;)x.childLanes|=b,M=x.alternate,M!==null&&(M.childLanes|=b),M=x,x=x.return;return M.tag===3?M.stateNode:null}var Ai=!1;function wh(x){x.updateQueue={baseState:x.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function io(x,b){x=x.updateQueue,b.updateQueue===x&&(b.updateQueue={baseState:x.baseState,firstBaseUpdate:x.firstBaseUpdate,lastBaseUpdate:x.lastBaseUpdate,shared:x.shared,effects:x.effects})}function Qa(x,b){return{eventTime:x,lane:b,tag:0,payload:null,callback:null,next:null}}function ao(x,b,M){var z=x.updateQueue;if(z===null)return null;if(z=z.shared,(fr&2)!==0){var K=z.pending;return K===null?b.next=b:(b.next=K.next,K.next=b),z.pending=b,Xa(x,M)}return K=z.interleaved,K===null?(b.next=b,Lc(z)):(b.next=K.next,K.next=b),z.interleaved=b,Xa(x,M)}function ul(x,b,M){if(b=b.updateQueue,b!==null&&(b=b.shared,(M&4194240)!==0)){var z=b.lanes;z&=x.pendingLanes,M|=z,b.lanes=M,Za(x,M)}}function Xl(x,b){var M=x.updateQueue,z=x.alternate;if(z!==null&&(z=z.updateQueue,M===z)){var K=null,ee=null;if(M=M.firstBaseUpdate,M!==null){do{var he={eventTime:M.eventTime,lane:M.lane,tag:M.tag,payload:M.payload,callback:M.callback,next:null};ee===null?K=ee=he:ee=ee.next=he,M=M.next}while(M!==null);ee===null?K=ee=b:ee=ee.next=b}else K=ee=b;M={baseState:z.baseState,firstBaseUpdate:K,lastBaseUpdate:ee,shared:z.shared,effects:z.effects},x.updateQueue=M;return}x=M.lastBaseUpdate,x===null?M.firstBaseUpdate=b:x.next=b,M.lastBaseUpdate=b}function Ri(x,b,M,z){var K=x.updateQueue;Ai=!1;var ee=K.firstBaseUpdate,he=K.lastBaseUpdate,Ne=K.shared.pending;if(Ne!==null){K.shared.pending=null;var Ge=Ne,dt=Ge.next;Ge.next=null,he===null?ee=dt:he.next=dt,he=Ge;var Rt=x.alternate;Rt!==null&&(Rt=Rt.updateQueue,Ne=Rt.lastBaseUpdate,Ne!==he&&(Ne===null?Rt.firstBaseUpdate=dt:Ne.next=dt,Rt.lastBaseUpdate=Ge))}if(ee!==null){var ur=K.baseState;he=0,Rt=dt=Ge=null,Ne=ee;do{var Et=Ne.lane,fn=Ne.eventTime;if((z&Et)===Et){Rt!==null&&(Rt=Rt.next={eventTime:fn,lane:0,tag:Ne.tag,payload:Ne.payload,callback:Ne.callback,next:null});e:{var Yr=x,Ia=Ne;switch(Et=b,fn=M,Ia.tag){case 1:if(Yr=Ia.payload,typeof Yr=="function"){ur=Yr.call(fn,ur,Et);break e}ur=Yr;break e;case 3:Yr.flags=Yr.flags&-65537|128;case 0:if(Yr=Ia.payload,Et=typeof Yr=="function"?Yr.call(fn,ur,Et):Yr,Et==null)break e;ur=a({},ur,Et);break e;case 2:Ai=!0}}Ne.callback!==null&&Ne.lane!==0&&(x.flags|=64,Et=K.effects,Et===null?K.effects=[Ne]:Et.push(Ne))}else fn={eventTime:fn,lane:Et,tag:Ne.tag,payload:Ne.payload,callback:Ne.callback,next:null},Rt===null?(dt=Rt=fn,Ge=ur):Rt=Rt.next=fn,he|=Et;if(Ne=Ne.next,Ne===null){if(Ne=K.shared.pending,Ne===null)break;Et=Ne,Ne=Et.next,Et.next=null,K.lastBaseUpdate=Et,K.shared.pending=null}}while(!0);if(Rt===null&&(Ge=ur),K.baseState=Ge,K.firstBaseUpdate=dt,K.lastBaseUpdate=Rt,b=K.shared.interleaved,b!==null){K=b;do he|=K.lane,K=K.next;while(K!==b)}else ee===null&&(K.shared.lanes=0);wl|=he,x.lanes=he,x.memoizedState=ur}}function Ff(x,b,M){if(x=b.effects,b.effects=null,x!==null)for(b=0;b<x.length;b++){var z=x[b],K=z.callback;if(K!==null){if(z.callback=null,z=M,typeof K!="function")throw Error(s(191,K));K.call(z)}}}var Pa={},Ja=tr(Pa),na=tr(Pa),ys=tr(Pa);function Ma(x){if(x===Pa)throw Error(s(174));return x}function Ql(x,b){ct(ys,b),ct(na,x),ct(Ja,Pa),x=Y(b),gr(Ja),ct(Ja,x)}function Fs(){gr(Ja),gr(na),gr(ys)}function Fu(x){var b=Ma(ys.current),M=Ma(Ja.current);b=Q(M,x.type,b),M!==b&&(ct(na,x),ct(Ja,b))}function Jl(x){na.current===x&&(gr(Ja),gr(na))}var Gr=tr(0);function cl(x){for(var b=x;b!==null;){if(b.tag===13){var M=b.memoizedState;if(M!==null&&(M=M.dehydrated,M===null||nn(M)||br(M)))return b}else if(b.tag===19&&b.memoizedProps.revealOrder!==void 0){if((b.flags&128)!==0)return b}else if(b.child!==null){b.child.return=b,b=b.child;continue}if(b===x)break;for(;b.sibling===null;){if(b.return===null||b.return===x)return null;b=b.return}b.sibling.return=b.return,b=b.sibling}return null}var Bu=[];function Oc(){for(var x=0;x<Bu.length;x++){var b=Bu[x];pe?b._workInProgressVersionPrimary=null:b._workInProgressVersionSecondary=null}Bu.length=0}var ia=o.ReactCurrentDispatcher,Bs=o.ReactCurrentBatchConfig,_o=0,an=null,zn=null,Un=null,eu=!1,aa=!1,Co=0,tu=0;function Nn(){throw Error(s(321))}function dl(x,b){if(b===null)return!1;for(var M=0;M<b.length&&M<x.length;M++)if(!ms(x[M],b[M]))return!1;return!0}function ru(x,b,M,z,K,ee){if(_o=ee,an=b,b.memoizedState=null,b.updateQueue=null,b.lanes=0,ia.current=x===null||x.memoizedState===null?kt:$t,x=M(z,K),aa){ee=0;do{if(aa=!1,Co=0,25<=ee)throw Error(s(301));ee+=1,Un=zn=null,b.updateQueue=null,ia.current=hr,x=M(z,K)}while(aa)}if(ia.current=Ze,b=zn!==null&&zn.next!==null,_o=0,Un=zn=an=null,eu=!1,b)throw Error(s(300));return x}function Dc(){var x=Co!==0;return Co=0,x}function wi(){var x={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Un===null?an.memoizedState=Un=x:Un=Un.next=x,Un}function Si(){if(zn===null){var x=an.alternate;x=x!==null?x.memoizedState:null}else x=zn.next;var b=Un===null?an.memoizedState:Un.next;if(b!==null)Un=b,zn=x;else{if(x===null)throw Error(s(310));zn=x,x={memoizedState:zn.memoizedState,baseState:zn.baseState,baseQueue:zn.baseQueue,queue:zn.queue,next:null},Un===null?an.memoizedState=Un=x:Un=Un.next=x}return Un}function es(x,b){return typeof b=="function"?b(x):b}function zu(x){var b=Si(),M=b.queue;if(M===null)throw Error(s(311));M.lastRenderedReducer=x;var z=zn,K=z.baseQueue,ee=M.pending;if(ee!==null){if(K!==null){var he=K.next;K.next=ee.next,ee.next=he}z.baseQueue=K=ee,M.pending=null}if(K!==null){ee=K.next,z=z.baseState;var Ne=he=null,Ge=null,dt=ee;do{var Rt=dt.lane;if((_o&Rt)===Rt)Ge!==null&&(Ge=Ge.next={lane:0,action:dt.action,hasEagerState:dt.hasEagerState,eagerState:dt.eagerState,next:null}),z=dt.hasEagerState?dt.eagerState:x(z,dt.action);else{var ur={lane:Rt,action:dt.action,hasEagerState:dt.hasEagerState,eagerState:dt.eagerState,next:null};Ge===null?(Ne=Ge=ur,he=z):Ge=Ge.next=ur,an.lanes|=Rt,wl|=Rt}dt=dt.next}while(dt!==null&&dt!==ee);Ge===null?he=z:Ge.next=Ne,ms(z,b.memoizedState)||(Vn=!0),b.memoizedState=z,b.baseState=he,b.baseQueue=Ge,M.lastRenderedState=z}if(x=M.interleaved,x!==null){K=x;do ee=K.lane,an.lanes|=ee,wl|=ee,K=K.next;while(K!==x)}else K===null&&(M.lanes=0);return[b.memoizedState,M.dispatch]}function hl(x){var b=Si(),M=b.queue;if(M===null)throw Error(s(311));M.lastRenderedReducer=x;var z=M.dispatch,K=M.pending,ee=b.memoizedState;if(K!==null){M.pending=null;var he=K=K.next;do ee=x(ee,he.action),he=he.next;while(he!==K);ms(ee,b.memoizedState)||(Vn=!0),b.memoizedState=ee,b.baseQueue===null&&(b.baseState=ee),M.lastRenderedState=ee}return[ee,z]}function Sh(){}function xs(x,b){var M=an,z=Si(),K=b(),ee=!ms(z.memoizedState,K);if(ee&&(z.memoizedState=K,Vn=!0),z=z.queue,Uu(fl.bind(null,M,z,x),[x]),z.getSnapshot!==b||ee||Un!==null&&Un.memoizedState.tag&1){if(M.flags|=2048,To(9,jc.bind(null,M,z,K,b),void 0,null),on===null)throw Error(s(349));(_o&30)!==0||Ic(M,b,K)}return K}function Ic(x,b,M){x.flags|=16384,x={getSnapshot:b,value:M},b=an.updateQueue,b===null?(b={lastEffect:null,stores:null},an.updateQueue=b,b.stores=[x]):(M=b.stores,M===null?b.stores=[x]:M.push(x))}function jc(x,b,M,z){b.value=M,b.getSnapshot=z,kh(b)&&ts(x)}function fl(x,b,M){return M(function(){kh(b)&&ts(x)})}function kh(x){var b=x.getSnapshot;x=x.value;try{var M=b();return!ms(x,M)}catch{return!0}}function ts(x){var b=Xa(x,1);b!==null&&ua(b,x,1,-1)}function Eo(x){var b=wi();return typeof x=="function"&&(x=x()),b.memoizedState=b.baseState=x,x={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:es,lastRenderedState:x},b.queue=x,x=x.dispatch=ue.bind(null,an,x),[b.memoizedState,x]}function To(x,b,M,z){return x={tag:x,create:b,destroy:M,deps:z,next:null},b=an.updateQueue,b===null?(b={lastEffect:null,stores:null},an.updateQueue=b,b.lastEffect=x.next=x):(M=b.lastEffect,M===null?b.lastEffect=x.next=x:(z=M.next,M.next=x,x.next=z,b.lastEffect=x)),x}function _h(){return Si().memoizedState}function Fc(x,b,M,z){var K=wi();an.flags|=x,K.memoizedState=To(1|b,M,void 0,z===void 0?null:z)}function so(x,b,M,z){var K=Si();z=z===void 0?null:z;var ee=void 0;if(zn!==null){var he=zn.memoizedState;if(ee=he.destroy,z!==null&&dl(z,he.deps)){K.memoizedState=To(b,M,ee,z);return}}an.flags|=x,K.memoizedState=To(1|b,M,ee,z)}function Ch(x,b){return Fc(8390656,8,x,b)}function Uu(x,b){return so(2048,8,x,b)}function Bc(x,b){return so(4,2,x,b)}function $r(x,b){return so(4,4,x,b)}function zc(x,b){if(typeof b=="function")return x=x(),b(x),function(){b(null)};if(b!=null)return x=x(),b.current=x,function(){b.current=null}}function nu(x,b,M){return M=M!=null?M.concat([x]):null,so(4,4,zc.bind(null,b,x),M)}function No(){}function Eh(x,b){var M=Si();b=b===void 0?null:b;var z=M.memoizedState;return z!==null&&b!==null&&dl(b,z[1])?z[0]:(M.memoizedState=[x,b],x)}function f(x,b){var M=Si();b=b===void 0?null:b;var z=M.memoizedState;return z!==null&&b!==null&&dl(b,z[1])?z[0]:(x=x(),M.memoizedState=[x,b],x)}function k(x,b,M){return(_o&21)===0?(x.baseState&&(x.baseState=!1,Vn=!0),x.memoizedState=M):(ms(M,b)||(M=Gl(),an.lanes|=M,wl|=M,x.baseState=!0),b)}function P(x,b){var M=Sr;Sr=M!==0&&4>M?M:4,x(!0);var z=Bs.transition;Bs.transition={};try{x(!1),b()}finally{Sr=M,Bs.transition=z}}function G(){return Si().memoizedState}function J(x,b,M){var z=_i(x);if(M={lane:z,action:M,hasEagerState:!1,eagerState:null,next:null},we(x))Me(b,M);else if(M=ll(x,b,M,z),M!==null){var K=gn();ua(M,x,z,K),Ie(M,b,z)}}function ue(x,b,M){var z=_i(x),K={lane:z,action:M,hasEagerState:!1,eagerState:null,next:null};if(we(x))Me(b,K);else{var ee=x.alternate;if(x.lanes===0&&(ee===null||ee.lanes===0)&&(ee=b.lastRenderedReducer,ee!==null))try{var he=b.lastRenderedState,Ne=ee(he,M);if(K.hasEagerState=!0,K.eagerState=Ne,ms(Ne,he)){var Ge=b.interleaved;Ge===null?(K.next=K,Lc(b)):(K.next=Ge.next,Ge.next=K),b.interleaved=K;return}}catch{}M=ll(x,b,K,z),M!==null&&(K=gn(),ua(M,x,z,K),Ie(M,b,z))}}function we(x){var b=x.alternate;return x===an||b!==null&&b===an}function Me(x,b){aa=eu=!0;var M=x.pending;M===null?b.next=b:(b.next=M.next,M.next=b),x.pending=b}function Ie(x,b,M){if((M&4194240)!==0){var z=b.lanes;z&=x.pendingLanes,M|=z,b.lanes=M,Za(x,M)}}var Ze={readContext:Ta,useCallback:Nn,useContext:Nn,useEffect:Nn,useImperativeHandle:Nn,useInsertionEffect:Nn,useLayoutEffect:Nn,useMemo:Nn,useReducer:Nn,useRef:Nn,useState:Nn,useDebugValue:Nn,useDeferredValue:Nn,useTransition:Nn,useMutableSource:Nn,useSyncExternalStore:Nn,useId:Nn,unstable_isNewReconciler:!1},kt={readContext:Ta,useCallback:function(x,b){return wi().memoizedState=[x,b===void 0?null:b],x},useContext:Ta,useEffect:Ch,useImperativeHandle:function(x,b,M){return M=M!=null?M.concat([x]):null,Fc(4194308,4,zc.bind(null,b,x),M)},useLayoutEffect:function(x,b){return Fc(4194308,4,x,b)},useInsertionEffect:function(x,b){return Fc(4,2,x,b)},useMemo:function(x,b){var M=wi();return b=b===void 0?null:b,x=x(),M.memoizedState=[x,b],x},useReducer:function(x,b,M){var z=wi();return b=M!==void 0?M(b):b,z.memoizedState=z.baseState=b,x={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:x,lastRenderedState:b},z.queue=x,x=x.dispatch=J.bind(null,an,x),[z.memoizedState,x]},useRef:function(x){var b=wi();return x={current:x},b.memoizedState=x},useState:Eo,useDebugValue:No,useDeferredValue:function(x){return wi().memoizedState=x},useTransition:function(){var x=Eo(!1),b=x[0];return x=P.bind(null,x[1]),wi().memoizedState=x,[b,x]},useMutableSource:function(){},useSyncExternalStore:function(x,b,M){var z=an,K=wi();if(Jr){if(M===void 0)throw Error(s(407));M=M()}else{if(M=b(),on===null)throw Error(s(349));(_o&30)!==0||Ic(z,b,M)}K.memoizedState=M;var ee={value:M,getSnapshot:b};return K.queue=ee,Ch(fl.bind(null,z,ee,x),[x]),z.flags|=2048,To(9,jc.bind(null,z,ee,M,b),void 0,null),M},useId:function(){var x=wi(),b=on.identifierPrefix;if(Jr){var M=gs,z=ea;M=(z&~(1<<32-Mi(z)-1)).toString(32)+M,b=":"+b+"R"+M,M=Co++,0<M&&(b+="H"+M.toString(32)),b+=":"}else M=tu++,b=":"+b+"r"+M.toString(32)+":";return x.memoizedState=b},unstable_isNewReconciler:!1},$t={readContext:Ta,useCallback:Eh,useContext:Ta,useEffect:Uu,useImperativeHandle:nu,useInsertionEffect:Bc,useLayoutEffect:$r,useMemo:f,useReducer:zu,useRef:_h,useState:function(){return zu(es)},useDebugValue:No,useDeferredValue:function(x){var b=Si();return k(b,zn.memoizedState,x)},useTransition:function(){var x=zu(es)[0],b=Si().memoizedState;return[x,b]},useMutableSource:Sh,useSyncExternalStore:xs,useId:G,unstable_isNewReconciler:!1},hr={readContext:Ta,useCallback:Eh,useContext:Ta,useEffect:Uu,useImperativeHandle:nu,useInsertionEffect:Bc,useLayoutEffect:$r,useMemo:f,useReducer:hl,useRef:_h,useState:function(){return hl(es)},useDebugValue:No,useDeferredValue:function(x){var b=Si();return zn===null?b.memoizedState=x:k(b,zn.memoizedState,x)},useTransition:function(){var x=hl(es)[0],b=Si().memoizedState;return[x,b]},useMutableSource:Sh,useSyncExternalStore:xs,useId:G,unstable_isNewReconciler:!1};function Kr(x,b){if(x&&x.defaultProps){b=a({},b),x=x.defaultProps;for(var M in x)b[M]===void 0&&(b[M]=x[M]);return b}return b}function Gn(x,b,M,z){b=x.memoizedState,M=M(z,b),M=M==null?b:a({},b,M),x.memoizedState=M,x.lanes===0&&(x.updateQueue.baseState=M)}var Li={isMounted:function(x){return(x=x._reactInternals)?F(x)===x:!1},enqueueSetState:function(x,b,M){x=x._reactInternals;var z=gn(),K=_i(x),ee=Qa(z,K);ee.payload=b,M!=null&&(ee.callback=M),b=ao(x,ee,K),b!==null&&(ua(b,x,K,z),ul(b,x,K))},enqueueReplaceState:function(x,b,M){x=x._reactInternals;var z=gn(),K=_i(x),ee=Qa(z,K);ee.tag=1,ee.payload=b,M!=null&&(ee.callback=M),b=ao(x,ee,K),b!==null&&(ua(b,x,K,z),ul(b,x,K))},enqueueForceUpdate:function(x,b){x=x._reactInternals;var M=gn(),z=_i(x),K=Qa(M,z);K.tag=2,b!=null&&(K.callback=b),b=ao(x,K,z),b!==null&&(ua(b,x,z,M),ul(b,x,z))}};function Vi(x,b,M,z,K,ee,he){return x=x.stateNode,typeof x.shouldComponentUpdate=="function"?x.shouldComponentUpdate(z,ee,he):b.prototype&&b.prototype.isPureReactComponent?!Is(M,z)||!Is(K,ee):!0}function pl(x,b,M){var z=!1,K=mr,ee=b.contextType;return typeof ee=="object"&&ee!==null?ee=Ta(ee):(K=it(b)?Or:Qr.current,z=b.contextTypes,ee=(z=z!=null)?ii(x,K):mr),b=new b(M,ee),x.memoizedState=b.state!==null&&b.state!==void 0?b.state:null,b.updater=Li,x.stateNode=b,b._reactInternals=x,z&&(x=x.stateNode,x.__reactInternalMemoizedUnmaskedChildContext=K,x.__reactInternalMemoizedMaskedChildContext=ee),b}function Uc(x,b,M,z){x=b.state,typeof b.componentWillReceiveProps=="function"&&b.componentWillReceiveProps(M,z),typeof b.UNSAFE_componentWillReceiveProps=="function"&&b.UNSAFE_componentWillReceiveProps(M,z),b.state!==x&&Li.enqueueReplaceState(b,b.state,null)}function zs(x,b,M,z){var K=x.stateNode;K.props=M,K.state=x.memoizedState,K.refs={},wh(x);var ee=b.contextType;typeof ee=="object"&&ee!==null?K.context=Ta(ee):(ee=it(b)?Or:Qr.current,K.context=ii(x,ee)),K.state=x.memoizedState,ee=b.getDerivedStateFromProps,typeof ee=="function"&&(Gn(x,b,ee,M),K.state=x.memoizedState),typeof b.getDerivedStateFromProps=="function"||typeof K.getSnapshotBeforeUpdate=="function"||typeof K.UNSAFE_componentWillMount!="function"&&typeof K.componentWillMount!="function"||(b=K.state,typeof K.componentWillMount=="function"&&K.componentWillMount(),typeof K.UNSAFE_componentWillMount=="function"&&K.UNSAFE_componentWillMount(),b!==K.state&&Li.enqueueReplaceState(K,K.state,null),Ri(x,M,K,z),K.state=x.memoizedState),typeof K.componentDidMount=="function"&&(x.flags|=4194308)}function ml(x,b){try{var M="",z=b;do M+=ym(z),z=z.return;while(z);var K=M}catch(ee){K=`
Error generating stack: `+ee.message+`
`+ee.stack}return{value:x,source:b,stack:K,digest:null}}function oo(x,b,M){return{value:x,source:null,stack:M??null,digest:b??null}}function rs(x,b){try{console.error(b.value)}catch(M){setTimeout(function(){throw M})}}var iu=typeof WeakMap=="function"?WeakMap:Map;function Dr(x,b,M){M=Qa(-1,M),M.tag=3,M.payload={element:null};var z=b.value;return M.callback=function(){Wn||(Wn=!0,li=z),rs(x,b)},M}function gl(x,b,M){M=Qa(-1,M),M.tag=3;var z=x.type.getDerivedStateFromError;if(typeof z=="function"){var K=b.value;M.payload=function(){return z(K)},M.callback=function(){rs(x,b)}}var ee=x.stateNode;return ee!==null&&typeof ee.componentDidCatch=="function"&&(M.callback=function(){rs(x,b),typeof z!="function"&&(uo===null?uo=new Set([this]):uo.add(this));var he=b.stack;this.componentDidCatch(b.value,{componentStack:he!==null?he:""})}),M}function Bf(x,b,M){var z=x.pingCache;if(z===null){z=x.pingCache=new iu;var K=new Set;z.set(b,K)}else K=z.get(b),K===void 0&&(K=new Set,z.set(b,K));K.has(M)||(K.add(M),x=k0.bind(null,x,b,M),b.then(x,x))}function zf(x){do{var b;if((b=x.tag===13)&&(b=x.memoizedState,b=b!==null?b.dehydrated!==null:!0),b)return x;x=x.return}while(x!==null);return null}function Po(x,b,M,z,K){return(x.mode&1)===0?(x===b?x.flags|=65536:(x.flags|=128,M.flags|=131072,M.flags&=-52805,M.tag===1&&(M.alternate===null?M.tag=17:(b=Qa(-1,1),b.tag=2,ao(M,b,1))),M.lanes|=1),x):(x.flags|=65536,x.lanes=K,x)}var vl=o.ReactCurrentOwner,Vn=!1;function oi(x,b,M,z){b.child=x===null?Mc(b,null,M,z):sl(b,x.child,M,z)}function Uf(x,b,M,z,K){M=M.render;var ee=b.ref;return ra(b,K),z=ru(x,b,M,z,ee,K),M=Dc(),x!==null&&!Vn?(b.updateQueue=x.updateQueue,b.flags&=-2053,x.lanes&=~K,xl(x,b,K)):(Jr&&M&&ta(b),b.flags|=1,oi(x,b,z,K),b.child)}function Gu(x,b,M,z,K){if(x===null){var ee=M.type;return typeof ee=="function"&&!rd(ee)&&ee.defaultProps===void 0&&M.compare===null&&M.defaultProps===void 0?(b.tag=15,b.type=ee,yl(x,b,ee,z,K)):(x=np(M.type,null,z,b,b.mode,K),x.ref=b.ref,x.return=b,b.child=x)}if(ee=x.child,(x.lanes&K)===0){var he=ee.memoizedProps;if(M=M.compare,M=M!==null?M:Is,M(he,z)&&x.ref===b.ref)return xl(x,b,K)}return b.flags|=1,x=pu(ee,z),x.ref=b.ref,x.return=b,b.child=x}function yl(x,b,M,z,K){if(x!==null){var ee=x.memoizedProps;if(Is(ee,z)&&x.ref===b.ref)if(Vn=!1,b.pendingProps=z=ee,(x.lanes&K)!==0)(x.flags&131072)!==0&&(Vn=!0);else return b.lanes=x.lanes,xl(x,b,K)}return Mo(x,b,M,z,K)}function dn(x,b,M){var z=b.pendingProps,K=z.children,ee=x!==null?x.memoizedState:null;if(z.mode==="hidden")if((b.mode&1)===0)b.memoizedState={baseLanes:0,cachePool:null,transitions:null},ct(cu,ki),ki|=M;else{if((M&1073741824)===0)return x=ee!==null?ee.baseLanes|M:M,b.lanes=b.childLanes=1073741824,b.memoizedState={baseLanes:x,cachePool:null,transitions:null},b.updateQueue=null,ct(cu,ki),ki|=x,null;b.memoizedState={baseLanes:0,cachePool:null,transitions:null},z=ee!==null?ee.baseLanes:M,ct(cu,ki),ki|=z}else ee!==null?(z=ee.baseLanes|M,b.memoizedState=null):z=M,ct(cu,ki),ki|=z;return oi(x,b,K,M),b.child}function sn(x,b){var M=b.ref;(x===null&&M!==null||x!==null&&x.ref!==M)&&(b.flags|=512,b.flags|=2097152)}function Mo(x,b,M,z,K){var ee=it(M)?Or:Qr.current;return ee=ii(b,ee),ra(b,K),M=ru(x,b,M,z,ee,K),z=Dc(),x!==null&&!Vn?(b.updateQueue=x.updateQueue,b.flags&=-2053,x.lanes&=~K,xl(x,b,K)):(Jr&&z&&ta(b),b.flags|=1,oi(x,b,M,K),b.child)}function Hi(x,b,M,z,K){if(it(M)){var ee=!0;Dn(b)}else ee=!1;if(ra(b,K),b.stateNode===null)Th(x,b),pl(b,M,z),zs(b,M,z,K),z=!0;else if(x===null){var he=b.stateNode,Ne=b.memoizedProps;he.props=Ne;var Ge=he.context,dt=M.contextType;typeof dt=="object"&&dt!==null?dt=Ta(dt):(dt=it(M)?Or:Qr.current,dt=ii(b,dt));var Rt=M.getDerivedStateFromProps,ur=typeof Rt=="function"||typeof he.getSnapshotBeforeUpdate=="function";ur||typeof he.UNSAFE_componentWillReceiveProps!="function"&&typeof he.componentWillReceiveProps!="function"||(Ne!==z||Ge!==dt)&&Uc(b,he,z,dt),Ai=!1;var Et=b.memoizedState;he.state=Et,Ri(b,z,he,K),Ge=b.memoizedState,Ne!==z||Et!==Ge||Ur.current||Ai?(typeof Rt=="function"&&(Gn(b,M,Rt,z),Ge=b.memoizedState),(Ne=Ai||Vi(b,M,Ne,z,Et,Ge,dt))?(ur||typeof he.UNSAFE_componentWillMount!="function"&&typeof he.componentWillMount!="function"||(typeof he.componentWillMount=="function"&&he.componentWillMount(),typeof he.UNSAFE_componentWillMount=="function"&&he.UNSAFE_componentWillMount()),typeof he.componentDidMount=="function"&&(b.flags|=4194308)):(typeof he.componentDidMount=="function"&&(b.flags|=4194308),b.memoizedProps=z,b.memoizedState=Ge),he.props=z,he.state=Ge,he.context=dt,z=Ne):(typeof he.componentDidMount=="function"&&(b.flags|=4194308),z=!1)}else{he=b.stateNode,io(x,b),Ne=b.memoizedProps,dt=b.type===b.elementType?Ne:Kr(b.type,Ne),he.props=dt,ur=b.pendingProps,Et=he.context,Ge=M.contextType,typeof Ge=="object"&&Ge!==null?Ge=Ta(Ge):(Ge=it(M)?Or:Qr.current,Ge=ii(b,Ge));var fn=M.getDerivedStateFromProps;(Rt=typeof fn=="function"||typeof he.getSnapshotBeforeUpdate=="function")||typeof he.UNSAFE_componentWillReceiveProps!="function"&&typeof he.componentWillReceiveProps!="function"||(Ne!==ur||Et!==Ge)&&Uc(b,he,z,Ge),Ai=!1,Et=b.memoizedState,he.state=Et,Ri(b,z,he,K);var Yr=b.memoizedState;Ne!==ur||Et!==Yr||Ur.current||Ai?(typeof fn=="function"&&(Gn(b,M,fn,z),Yr=b.memoizedState),(dt=Ai||Vi(b,M,dt,z,Et,Yr,Ge)||!1)?(Rt||typeof he.UNSAFE_componentWillUpdate!="function"&&typeof he.componentWillUpdate!="function"||(typeof he.componentWillUpdate=="function"&&he.componentWillUpdate(z,Yr,Ge),typeof he.UNSAFE_componentWillUpdate=="function"&&he.UNSAFE_componentWillUpdate(z,Yr,Ge)),typeof he.componentDidUpdate=="function"&&(b.flags|=4),typeof he.getSnapshotBeforeUpdate=="function"&&(b.flags|=1024)):(typeof he.componentDidUpdate!="function"||Ne===x.memoizedProps&&Et===x.memoizedState||(b.flags|=4),typeof he.getSnapshotBeforeUpdate!="function"||Ne===x.memoizedProps&&Et===x.memoizedState||(b.flags|=1024),b.memoizedProps=z,b.memoizedState=Yr),he.props=z,he.state=Yr,he.context=Ge,z=dt):(typeof he.componentDidUpdate!="function"||Ne===x.memoizedProps&&Et===x.memoizedState||(b.flags|=4),typeof he.getSnapshotBeforeUpdate!="function"||Ne===x.memoizedProps&&Et===x.memoizedState||(b.flags|=1024),z=!1)}return sa(x,b,M,z,ee,K)}function sa(x,b,M,z,K,ee){sn(x,b);var he=(b.flags&128)!==0;if(!z&&!he)return K&&Ul(b,M,!1),xl(x,b,ee);z=b.stateNode,vl.current=b;var Ne=he&&typeof M.getDerivedStateFromError!="function"?null:z.render();return b.flags|=1,x!==null&&he?(b.child=sl(b,x.child,null,ee),b.child=sl(b,null,Ne,ee)):oi(x,b,Ne,ee),b.memoizedState=z.state,K&&Ul(b,M,!0),b.child}function au(x){var b=x.stateNode;b.pendingContext?yi(x,b.pendingContext,b.pendingContext!==b.context):b.context&&yi(x,b.context,!1),Ql(x,b.containerInfo)}function Vu(x,b,M,z,K){return ko(),Nc(K),b.flags|=256,oi(x,b,M,z),b.child}var oa={dehydrated:null,treeContext:null,retryLane:0};function Gc(x){return{baseLanes:x,cachePool:null,transitions:null}}function xm(x,b,M){var z=b.pendingProps,K=Gr.current,ee=!1,he=(b.flags&128)!==0,Ne;if((Ne=he)||(Ne=x!==null&&x.memoizedState===null?!1:(K&2)!==0),Ne?(ee=!0,b.flags&=-129):(x===null||x.memoizedState!==null)&&(K|=1),ct(Gr,K&1),x===null)return vh(b),x=b.memoizedState,x!==null&&(x=x.dehydrated,x!==null)?((b.mode&1)===0?b.lanes=1:br(x)?b.lanes=8:b.lanes=1073741824,null):(he=z.children,x=z.fallback,ee?(z=b.mode,ee=b.child,he={mode:"hidden",children:he},(z&1)===0&&ee!==null?(ee.childLanes=0,ee.pendingProps=he):ee=nd(he,z,0,null),x=Wi(x,z,M,null),ee.return=b,x.return=b,ee.sibling=x,b.child=ee,b.child.memoizedState=Gc(M),b.memoizedState=oa,x):Gf(b,he));if(K=x.memoizedState,K!==null&&(Ne=K.dehydrated,Ne!==null))return v0(x,b,he,z,Ne,K,M);if(ee){ee=z.fallback,he=b.mode,K=x.child,Ne=K.sibling;var Ge={mode:"hidden",children:z.children};return(he&1)===0&&b.child!==K?(z=b.child,z.childLanes=0,z.pendingProps=Ge,b.deletions=null):(z=pu(K,Ge),z.subtreeFlags=K.subtreeFlags&14680064),Ne!==null?ee=pu(Ne,ee):(ee=Wi(ee,he,M,null),ee.flags|=2),ee.return=b,z.return=b,z.sibling=ee,b.child=z,z=ee,ee=b.child,he=x.child.memoizedState,he=he===null?Gc(M):{baseLanes:he.baseLanes|M,cachePool:null,transitions:he.transitions},ee.memoizedState=he,ee.childLanes=x.childLanes&~M,b.memoizedState=oa,z}return ee=x.child,x=ee.sibling,z=pu(ee,{mode:"visible",children:z.children}),(b.mode&1)===0&&(z.lanes=M),z.return=b,z.sibling=null,x!==null&&(M=b.deletions,M===null?(b.deletions=[x],b.flags|=16):M.push(x)),b.child=z,b.memoizedState=null,z}function Gf(x,b){return b=nd({mode:"visible",children:b},x.mode,0,null),b.return=x,x.child=b}function Hu(x,b,M,z){return z!==null&&Nc(z),sl(b,x.child,null,M),x=Gf(b,b.pendingProps.children),x.flags|=2,b.memoizedState=null,x}function v0(x,b,M,z,K,ee,he){if(M)return b.flags&256?(b.flags&=-257,z=oo(Error(s(422))),Hu(x,b,he,z)):b.memoizedState!==null?(b.child=x.child,b.flags|=128,null):(ee=z.fallback,K=b.mode,z=nd({mode:"visible",children:z.children},K,0,null),ee=Wi(ee,K,he,null),ee.flags|=2,z.return=b,ee.return=b,z.sibling=ee,b.child=z,(b.mode&1)!==0&&sl(b,x.child,null,he),b.child.memoizedState=Gc(he),b.memoizedState=oa,ee);if((b.mode&1)===0)return Hu(x,b,he,null);if(br(K))return z=Tt(K).digest,ee=Error(s(419)),z=oo(ee,z,void 0),Hu(x,b,he,z);if(M=(he&x.childLanes)!==0,Vn||M){if(z=on,z!==null){switch(he&-he){case 4:K=2;break;case 16:K=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:K=32;break;case 536870912:K=268435456;break;default:K=0}K=(K&(z.suspendedLanes|he))!==0?0:K,K!==0&&K!==ee.retryLane&&(ee.retryLane=K,Xa(x,K),ua(z,x,K,-1))}return td(),z=oo(Error(s(421))),Hu(x,b,he,z)}return nn(K)?(b.flags|=128,b.child=x.child,b=C0.bind(null,x),zr(K,b),null):(x=ee.treeContext,Se&&(wn=Rs(K),si=b,Jr=!0,Ea=null,$l=!1,x!==null&&(bi[_a++]=ea,bi[_a++]=gs,bi[_a++]=Bn,ea=x.id,gs=x.overflow,Bn=b)),b=Gf(b,z.children),b.flags|=4096,b)}function Ao(x,b,M){x.lanes|=b;var z=x.alternate;z!==null&&(z.lanes|=b),ol(x.return,b,M)}function Vc(x,b,M,z,K){var ee=x.memoizedState;ee===null?x.memoizedState={isBackwards:b,rendering:null,renderingStartTime:0,last:z,tail:M,tailMode:K}:(ee.isBackwards=b,ee.rendering=null,ee.renderingStartTime=0,ee.last=z,ee.tail=M,ee.tailMode=K)}function Vf(x,b,M){var z=b.pendingProps,K=z.revealOrder,ee=z.tail;if(oi(x,b,z.children,M),z=Gr.current,(z&2)!==0)z=z&1|2,b.flags|=128;else{if(x!==null&&(x.flags&128)!==0)e:for(x=b.child;x!==null;){if(x.tag===13)x.memoizedState!==null&&Ao(x,M,b);else if(x.tag===19)Ao(x,M,b);else if(x.child!==null){x.child.return=x,x=x.child;continue}if(x===b)break e;for(;x.sibling===null;){if(x.return===null||x.return===b)break e;x=x.return}x.sibling.return=x.return,x=x.sibling}z&=1}if(ct(Gr,z),(b.mode&1)===0)b.memoizedState=null;else switch(K){case"forwards":for(M=b.child,K=null;M!==null;)x=M.alternate,x!==null&&cl(x)===null&&(K=M),M=M.sibling;M=K,M===null?(K=b.child,b.child=null):(K=M.sibling,M.sibling=null),Vc(b,!1,K,M,ee);break;case"backwards":for(M=null,K=b.child,b.child=null;K!==null;){if(x=K.alternate,x!==null&&cl(x)===null){b.child=K;break}x=K.sibling,K.sibling=M,M=K,K=x}Vc(b,!0,M,null,ee);break;case"together":Vc(b,!1,null,null,void 0);break;default:b.memoizedState=null}return b.child}function Th(x,b){(b.mode&1)===0&&x!==null&&(x.alternate=null,b.alternate=null,b.flags|=2)}function xl(x,b,M){if(x!==null&&(b.dependencies=x.dependencies),wl|=b.lanes,(M&b.childLanes)===0)return null;if(x!==null&&b.child!==x.child)throw Error(s(153));if(b.child!==null){for(x=b.child,M=pu(x,x.pendingProps),b.child=M,M.return=b;x.sibling!==null;)x=x.sibling,M=M.sibling=pu(x,x.pendingProps),M.return=b;M.sibling=null}return b.child}function su(x,b,M){switch(b.tag){case 3:au(b),ko();break;case 5:Fu(b);break;case 1:it(b.type)&&Dn(b);break;case 4:Ql(b,b.stateNode.containerInfo);break;case 10:Ya(b,b.type._context,b.memoizedProps.value);break;case 13:var z=b.memoizedState;if(z!==null)return z.dehydrated!==null?(ct(Gr,Gr.current&1),b.flags|=128,null):(M&b.child.childLanes)!==0?xm(x,b,M):(ct(Gr,Gr.current&1),x=xl(x,b,M),x!==null?x.sibling:null);ct(Gr,Gr.current&1);break;case 19:if(z=(M&b.childLanes)!==0,(x.flags&128)!==0){if(z)return Vf(x,b,M);b.flags|=128}var K=b.memoizedState;if(K!==null&&(K.rendering=null,K.tail=null,K.lastEffect=null),ct(Gr,Gr.current),z)break;return null;case 22:case 23:return b.lanes=0,dn(x,b,M)}return xl(x,b,M)}function Aa(x){x.flags|=4}function Wu(x,b){if(x!==null&&x.child===b.child)return!0;if((b.flags&16)!==0)return!1;for(x=b.child;x!==null;){if((x.flags&12854)!==0||(x.subtreeFlags&12854)!==0)return!1;x=x.sibling}return!0}var ou,lu,Ra,La;if(me)ou=function(x,b){for(var M=b.child;M!==null;){if(M.tag===5||M.tag===6)te(x,M.stateNode);else if(M.tag!==4&&M.child!==null){M.child.return=M,M=M.child;continue}if(M===b)break;for(;M.sibling===null;){if(M.return===null||M.return===b)return;M=M.return}M.sibling.return=M.return,M=M.sibling}},lu=function(){},Ra=function(x,b,M,z,K){if(x=x.memoizedProps,x!==z){var ee=b.stateNode,he=Ma(Ja.current);M=de(ee,M,x,z,K,he),(b.updateQueue=M)&&Aa(b)}},La=function(x,b,M,z){M!==z&&Aa(b)};else if(xe){ou=function(x,b,M,z){for(var K=b.child;K!==null;){if(K.tag===5){var ee=K.stateNode;M&&z&&(ee=Lr(ee,K.type,K.memoizedProps,K)),te(x,ee)}else if(K.tag===6)ee=K.stateNode,M&&z&&(ee=ar(ee,K.memoizedProps,K)),te(x,ee);else if(K.tag!==4){if(K.tag===22&&K.memoizedState!==null)ee=K.child,ee!==null&&(ee.return=K),ou(x,K,!0,!0);else if(K.child!==null){K.child.return=K,K=K.child;continue}}if(K===b)break;for(;K.sibling===null;){if(K.return===null||K.return===b)return;K=K.return}K.sibling.return=K.return,K=K.sibling}};var uu=function(x,b,M,z){for(var K=b.child;K!==null;){if(K.tag===5){var ee=K.stateNode;M&&z&&(ee=Lr(ee,K.type,K.memoizedProps,K)),Ct(x,ee)}else if(K.tag===6)ee=K.stateNode,M&&z&&(ee=ar(ee,K.memoizedProps,K)),Ct(x,ee);else if(K.tag!==4){if(K.tag===22&&K.memoizedState!==null)ee=K.child,ee!==null&&(ee.return=K),uu(x,K,!0,!0);else if(K.child!==null){K.child.return=K,K=K.child;continue}}if(K===b)break;for(;K.sibling===null;){if(K.return===null||K.return===b)return;K=K.return}K.sibling.return=K.return,K=K.sibling}};lu=function(x,b){var M=b.stateNode;if(!Wu(x,b)){x=M.containerInfo;var z=Kt(x);uu(z,b,!1,!1),M.pendingChildren=z,Aa(b),Yt(x,z)}},Ra=function(x,b,M,z,K){var ee=x.stateNode,he=x.memoizedProps;if((x=Wu(x,b))&&he===z)b.stateNode=ee;else{var Ne=b.stateNode,Ge=Ma(Ja.current),dt=null;he!==z&&(dt=de(Ne,M,he,z,K,Ge)),x&&dt===null?b.stateNode=ee:(ee=Ut(ee,dt,M,he,z,b,x,Ne),ae(ee,M,z,K,Ge)&&Aa(b),b.stateNode=ee,x?Aa(b):ou(ee,b,!1,!1))}},La=function(x,b,M,z){M!==z?(x=Ma(ys.current),M=Ma(Ja.current),b.stateNode=ye(z,x,M,b),Aa(b)):b.stateNode=x.stateNode}}else lu=function(){},Ra=function(){},La=function(){};function bs(x,b){if(!Jr)switch(x.tailMode){case"hidden":b=x.tail;for(var M=null;b!==null;)b.alternate!==null&&(M=b),b=b.sibling;M===null?x.tail=null:M.sibling=null;break;case"collapsed":M=x.tail;for(var z=null;M!==null;)M.alternate!==null&&(z=M),M=M.sibling;z===null?b||x.tail===null?x.tail=null:x.tail.sibling=null:z.sibling=null}}function Sn(x){var b=x.alternate!==null&&x.alternate.child===x.child,M=0,z=0;if(b)for(var K=x.child;K!==null;)M|=K.lanes|K.childLanes,z|=K.subtreeFlags&14680064,z|=K.flags&14680064,K.return=x,K=K.sibling;else for(K=x.child;K!==null;)M|=K.lanes|K.childLanes,z|=K.subtreeFlags,z|=K.flags,K.return=x,K=K.sibling;return x.subtreeFlags|=z,x.childLanes=M,b}function qu(x,b,M){var z=b.pendingProps;switch(Iu(b),b.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Sn(b),null;case 1:return it(b.type)&&sr(),Sn(b),null;case 3:return M=b.stateNode,Fs(),gr(Ur),gr(Qr),Oc(),M.pendingContext&&(M.context=M.pendingContext,M.pendingContext=null),(x===null||x.child===null)&&(Kl(b)?Aa(b):x===null||x.memoizedState.isDehydrated&&(b.flags&256)===0||(b.flags|=1024,Ea!==null&&(tp(Ea),Ea=null))),lu(x,b),Sn(b),null;case 5:Jl(b),M=Ma(ys.current);var K=b.type;if(x!==null&&b.stateNode!=null)Ra(x,b,K,z,M),x.ref!==b.ref&&(b.flags|=512,b.flags|=2097152);else{if(!z){if(b.stateNode===null)throw Error(s(166));return Sn(b),null}if(x=Ma(Ja.current),Kl(b)){if(!Se)throw Error(s(175));x=Ln(b.stateNode,b.type,b.memoizedProps,M,x,b,!$l),b.updateQueue=x,x!==null&&Aa(b)}else{var ee=q(K,z,M,x,b);ou(ee,b,!1,!1),b.stateNode=ee,ae(ee,K,z,M,x)&&Aa(b)}b.ref!==null&&(b.flags|=512,b.flags|=2097152)}return Sn(b),null;case 6:if(x&&b.stateNode!=null)La(x,b,x.memoizedProps,z);else{if(typeof z!="string"&&b.stateNode===null)throw Error(s(166));if(x=Ma(ys.current),M=Ma(Ja.current),Kl(b)){if(!Se)throw Error(s(176));if(x=b.stateNode,M=b.memoizedProps,(z=un(x,M,b,!$l))&&(K=si,K!==null))switch(K.tag){case 3:xo(K.stateNode.containerInfo,x,M,(K.mode&1)!==0);break;case 5:Xr(K.type,K.memoizedProps,K.stateNode,x,M,(K.mode&1)!==0)}z&&Aa(b)}else b.stateNode=ye(z,x,M,b)}return Sn(b),null;case 13:if(gr(Gr),z=b.memoizedState,x===null||x.memoizedState!==null&&x.memoizedState.dehydrated!==null){if(Jr&&wn!==null&&(b.mode&1)!==0&&(b.flags&128)===0)jf(),ko(),b.flags|=98560,K=!1;else if(K=Kl(b),z!==null&&z.dehydrated!==null){if(x===null){if(!K)throw Error(s(318));if(!Se)throw Error(s(344));if(K=b.memoizedState,K=K!==null?K.dehydrated:null,!K)throw Error(s(317));bn(K,b)}else ko(),(b.flags&128)===0&&(b.memoizedState=null),b.flags|=4;Sn(b),K=!1}else Ea!==null&&(tp(Ea),Ea=null),K=!0;if(!K)return b.flags&65536?b:null}return(b.flags&128)!==0?(b.lanes=M,b):(M=z!==null,M!==(x!==null&&x.memoizedState!==null)&&M&&(b.child.flags|=8192,(b.mode&1)!==0&&(x===null||(Gr.current&1)!==0?_n===0&&(_n=3):td())),b.updateQueue!==null&&(b.flags|=4),Sn(b),null);case 4:return Fs(),lu(x,b),x===null&&$e(b.stateNode.containerInfo),Sn(b),null;case 10:return js(b.type._context),Sn(b),null;case 17:return it(b.type)&&sr(),Sn(b),null;case 19:if(gr(Gr),K=b.memoizedState,K===null)return Sn(b),null;if(z=(b.flags&128)!==0,ee=K.rendering,ee===null)if(z)bs(K,!1);else{if(_n!==0||x!==null&&(x.flags&128)!==0)for(x=b.child;x!==null;){if(ee=cl(x),ee!==null){for(b.flags|=128,bs(K,!1),x=ee.updateQueue,x!==null&&(b.updateQueue=x,b.flags|=4),b.subtreeFlags=0,x=M,M=b.child;M!==null;)z=M,K=x,z.flags&=14680066,ee=z.alternate,ee===null?(z.childLanes=0,z.lanes=K,z.child=null,z.subtreeFlags=0,z.memoizedProps=null,z.memoizedState=null,z.updateQueue=null,z.dependencies=null,z.stateNode=null):(z.childLanes=ee.childLanes,z.lanes=ee.lanes,z.child=ee.child,z.subtreeFlags=0,z.deletions=null,z.memoizedProps=ee.memoizedProps,z.memoizedState=ee.memoizedState,z.updateQueue=ee.updateQueue,z.type=ee.type,K=ee.dependencies,z.dependencies=K===null?null:{lanes:K.lanes,firstContext:K.firstContext}),M=M.sibling;return ct(Gr,Gr.current&1|2),b.child}x=x.sibling}K.tail!==null&&jn()>Oh&&(b.flags|=128,z=!0,bs(K,!1),b.lanes=4194304)}else{if(!z)if(x=cl(ee),x!==null){if(b.flags|=128,z=!0,x=x.updateQueue,x!==null&&(b.updateQueue=x,b.flags|=4),bs(K,!0),K.tail===null&&K.tailMode==="hidden"&&!ee.alternate&&!Jr)return Sn(b),null}else 2*jn()-K.renderingStartTime>Oh&&M!==1073741824&&(b.flags|=128,z=!0,bs(K,!1),b.lanes=4194304);K.isBackwards?(ee.sibling=b.child,b.child=ee):(x=K.last,x!==null?x.sibling=ee:b.child=ee,K.last=ee)}return K.tail!==null?(b=K.tail,K.rendering=b,K.tail=b.sibling,K.renderingStartTime=jn(),b.sibling=null,x=Gr.current,ct(Gr,z?x&1|2:x&1),b):(Sn(b),null);case 22:case 23:return rp(),M=b.memoizedState!==null,x!==null&&x.memoizedState!==null!==M&&(b.flags|=8192),M&&(b.mode&1)!==0?(ki&1073741824)!==0&&(Sn(b),me&&b.subtreeFlags&6&&(b.flags|=8192)):Sn(b),null;case 24:return null;case 25:return null}throw Error(s(156,b.tag))}function y0(x,b){switch(Iu(b),b.tag){case 1:return it(b.type)&&sr(),x=b.flags,x&65536?(b.flags=x&-65537|128,b):null;case 3:return Fs(),gr(Ur),gr(Qr),Oc(),x=b.flags,(x&65536)!==0&&(x&128)===0?(b.flags=x&-65537|128,b):null;case 5:return Jl(b),null;case 13:if(gr(Gr),x=b.memoizedState,x!==null&&x.dehydrated!==null){if(b.alternate===null)throw Error(s(340));ko()}return x=b.flags,x&65536?(b.flags=x&-65537|128,b):null;case 19:return gr(Gr),null;case 4:return Fs(),null;case 10:return js(b.type._context),null;case 22:case 23:return rp(),null;case 24:return null;default:return null}}var Hc=!1,Oi=!1,ws=typeof WeakSet=="function"?WeakSet:Set,xt=null;function Zr(x,b){var M=x.ref;if(M!==null)if(typeof M=="function")try{M(null)}catch(z){vn(x,b,z)}else M.current=null}function Ss(x,b,M){try{M()}catch(z){vn(x,b,z)}}var bm=!1;function x0(x,b){for(ne(x.containerInfo),xt=b;xt!==null;)if(x=xt,b=x.child,(x.subtreeFlags&1028)!==0&&b!==null)b.return=x,xt=b;else for(;xt!==null;){x=xt;try{var M=x.alternate;if((x.flags&1024)!==0)switch(x.tag){case 0:case 11:case 15:break;case 1:if(M!==null){var z=M.memoizedProps,K=M.memoizedState,ee=x.stateNode,he=ee.getSnapshotBeforeUpdate(x.elementType===x.type?z:Kr(x.type,z),K);ee.__reactInternalSnapshotBeforeUpdate=he}break;case 3:me&&At(x.stateNode.containerInfo);break;case 5:case 6:case 4:case 17:break;default:throw Error(s(163))}}catch(Ne){vn(x,x.return,Ne)}if(b=x.sibling,b!==null){b.return=x.return,xt=b;break}xt=x.return}return M=bm,bm=!1,M}function $u(x,b,M){var z=b.updateQueue;if(z=z!==null?z.lastEffect:null,z!==null){var K=z=z.next;do{if((K.tag&x)===x){var ee=K.destroy;K.destroy=void 0,ee!==void 0&&Ss(b,M,ee)}K=K.next}while(K!==z)}}function Wc(x,b){if(b=b.updateQueue,b=b!==null?b.lastEffect:null,b!==null){var M=b=b.next;do{if((M.tag&x)===x){var z=M.create;M.destroy=z()}M=M.next}while(M!==b)}}function Hf(x){var b=x.ref;if(b!==null){var M=x.stateNode;x.tag===5?x=W(M):x=M,typeof b=="function"?b(x):b.current=x}}function Nh(x){var b=x.alternate;b!==null&&(x.alternate=null,Nh(b)),x.child=null,x.deletions=null,x.sibling=null,x.tag===5&&(b=x.stateNode,b!==null&&rt(b)),x.stateNode=null,x.return=null,x.dependencies=null,x.memoizedProps=null,x.memoizedState=null,x.pendingProps=null,x.stateNode=null,x.updateQueue=null}function wm(x){return x.tag===5||x.tag===3||x.tag===4}function Ku(x){e:for(;;){for(;x.sibling===null;){if(x.return===null||wm(x.return))return null;x=x.return}for(x.sibling.return=x.return,x=x.sibling;x.tag!==5&&x.tag!==6&&x.tag!==18;){if(x.flags&2||x.child===null||x.tag===4)continue e;x.child.return=x,x=x.child}if(!(x.flags&2))return x.stateNode}}function Ph(x,b,M){var z=x.tag;if(z===5||z===6)x=x.stateNode,b?ve(M,x,b):qt(M,x);else if(z!==4&&(x=x.child,x!==null))for(Ph(x,b,M),x=x.sibling;x!==null;)Ph(x,b,M),x=x.sibling}function Sm(x,b,M){var z=x.tag;if(z===5||z===6)x=x.stateNode,b?ce(M,x,b):jt(M,x);else if(z!==4&&(x=x.child,x!==null))for(Sm(x,b,M),x=x.sibling;x!==null;)Sm(x,b,M),x=x.sibling}var ti=null,ns=!1;function lo(x,b,M){for(M=M.child;M!==null;)Wf(x,b,M),M=M.sibling}function Wf(x,b,M){if(Fn&&typeof Fn.onCommitFiberUnmount=="function")try{Fn.onCommitFiberUnmount(cn,M)}catch{}switch(M.tag){case 5:Oi||Zr(M,b);case 6:if(me){var z=ti,K=ns;ti=null,lo(x,b,M),ti=z,ns=K,ti!==null&&(ns?Te(ti,M.stateNode):ke(ti,M.stateNode))}else lo(x,b,M);break;case 18:me&&ti!==null&&(ns?el(ti,M.stateNode):Jo(ti,M.stateNode));break;case 4:me?(z=ti,K=ns,ti=M.stateNode.containerInfo,ns=!0,lo(x,b,M),ti=z,ns=K):(xe&&(z=M.stateNode.containerInfo,K=Kt(z),Xt(z,K)),lo(x,b,M));break;case 0:case 11:case 14:case 15:if(!Oi&&(z=M.updateQueue,z!==null&&(z=z.lastEffect,z!==null))){K=z=z.next;do{var ee=K,he=ee.destroy;ee=ee.tag,he!==void 0&&((ee&2)!==0||(ee&4)!==0)&&Ss(M,b,he),K=K.next}while(K!==z)}lo(x,b,M);break;case 1:if(!Oi&&(Zr(M,b),z=M.stateNode,typeof z.componentWillUnmount=="function"))try{z.props=M.memoizedProps,z.state=M.memoizedState,z.componentWillUnmount()}catch(Ne){vn(M,b,Ne)}lo(x,b,M);break;case 21:lo(x,b,M);break;case 22:M.mode&1?(Oi=(z=Oi)||M.memoizedState!==null,lo(x,b,M),Oi=z):lo(x,b,M);break;default:lo(x,b,M)}}function Zu(x){var b=x.updateQueue;if(b!==null){x.updateQueue=null;var M=x.stateNode;M===null&&(M=x.stateNode=new ws),b.forEach(function(z){var K=ob.bind(null,x,z);M.has(z)||(M.add(z),z.then(K,K))})}}function Us(x,b){var M=b.deletions;if(M!==null)for(var z=0;z<M.length;z++){var K=M[z];try{var ee=x,he=b;if(me){var Ne=he;e:for(;Ne!==null;){switch(Ne.tag){case 5:ti=Ne.stateNode,ns=!1;break e;case 3:ti=Ne.stateNode.containerInfo,ns=!0;break e;case 4:ti=Ne.stateNode.containerInfo,ns=!0;break e}Ne=Ne.return}if(ti===null)throw Error(s(160));Wf(ee,he,K),ti=null,ns=!1}else Wf(ee,he,K);var Ge=K.alternate;Ge!==null&&(Ge.return=null),K.return=null}catch(dt){vn(K,b,dt)}}if(b.subtreeFlags&12854)for(b=b.child;b!==null;)Mh(b,x),b=b.sibling}function Mh(x,b){var M=x.alternate,z=x.flags;switch(x.tag){case 0:case 11:case 14:case 15:if(Us(b,x),ks(x),z&4){try{$u(3,x,x.return),Wc(3,x)}catch(Et){vn(x,x.return,Et)}try{$u(5,x,x.return)}catch(Et){vn(x,x.return,Et)}}break;case 1:Us(b,x),ks(x),z&512&&M!==null&&Zr(M,M.return);break;case 5:if(Us(b,x),ks(x),z&512&&M!==null&&Zr(M,M.return),me){if(x.flags&32){var K=x.stateNode;try{Re(K)}catch(Et){vn(x,x.return,Et)}}if(z&4&&(K=x.stateNode,K!=null)){var ee=x.memoizedProps;if(M=M!==null?M.memoizedProps:ee,z=x.type,b=x.updateQueue,x.updateQueue=null,b!==null)try{qe(K,b,z,M,ee,x)}catch(Et){vn(x,x.return,Et)}}}break;case 6:if(Us(b,x),ks(x),z&4&&me){if(x.stateNode===null)throw Error(s(162));K=x.stateNode,ee=x.memoizedProps,M=M!==null?M.memoizedProps:ee;try{wt(K,M,ee)}catch(Et){vn(x,x.return,Et)}}break;case 3:if(Us(b,x),ks(x),z&4){if(me&&Se&&M!==null&&M.memoizedState.isDehydrated)try{zi(b.containerInfo)}catch(Et){vn(x,x.return,Et)}if(xe){K=b.containerInfo,ee=b.pendingChildren;try{Xt(K,ee)}catch(Et){vn(x,x.return,Et)}}}break;case 4:if(Us(b,x),ks(x),z&4&&xe){ee=x.stateNode,K=ee.containerInfo,ee=ee.pendingChildren;try{Xt(K,ee)}catch(Et){vn(x,x.return,Et)}}break;case 13:Us(b,x),ks(x),K=x.child,K.flags&8192&&(ee=K.memoizedState!==null,K.stateNode.isHidden=ee,!ee||K.alternate!==null&&K.alternate.memoizedState!==null||(Xc=jn())),z&4&&Zu(x);break;case 22:var he=M!==null&&M.memoizedState!==null;if(x.mode&1?(Oi=(M=Oi)||he,Us(b,x),Oi=M):Us(b,x),ks(x),z&8192){if(M=x.memoizedState!==null,(x.stateNode.isHidden=M)&&!he&&(x.mode&1)!==0)for(xt=x,z=x.child;z!==null;){for(b=xt=z;xt!==null;){he=xt;var Ne=he.child;switch(he.tag){case 0:case 11:case 14:case 15:$u(4,he,he.return);break;case 1:Zr(he,he.return);var Ge=he.stateNode;if(typeof Ge.componentWillUnmount=="function"){var dt=he,Rt=he.return;try{var ur=dt;Ge.props=ur.memoizedProps,Ge.state=ur.memoizedState,Ge.componentWillUnmount()}catch(Et){vn(dt,Rt,Et)}}break;case 5:Zr(he,he.return);break;case 22:if(he.memoizedState!==null){Kf(b);continue}}Ne!==null?(Ne.return=he,xt=Ne):Kf(b)}z=z.sibling}if(me){e:if(z=null,me)for(b=x;;){if(b.tag===5){if(z===null){z=b;try{K=b.stateNode,M?Je(K):vt(b.stateNode,b.memoizedProps)}catch(Et){vn(x,x.return,Et)}}}else if(b.tag===6){if(z===null)try{ee=b.stateNode,M?ze(ee):pt(ee,b.memoizedProps)}catch(Et){vn(x,x.return,Et)}}else if((b.tag!==22&&b.tag!==23||b.memoizedState===null||b===x)&&b.child!==null){b.child.return=b,b=b.child;continue}if(b===x)break e;for(;b.sibling===null;){if(b.return===null||b.return===x)break e;z===b&&(z=null),b=b.return}z===b&&(z=null),b.sibling.return=b.return,b=b.sibling}}}break;case 19:Us(b,x),ks(x),z&4&&Zu(x);break;case 21:break;default:Us(b,x),ks(x)}}function ks(x){var b=x.flags;if(b&2){try{if(me){e:{for(var M=x.return;M!==null;){if(wm(M)){var z=M;break e}M=M.return}throw Error(s(160))}switch(z.tag){case 5:var K=z.stateNode;z.flags&32&&(Re(K),z.flags&=-33);var ee=Ku(x);Sm(x,ee,K);break;case 3:case 4:var he=z.stateNode.containerInfo,Ne=Ku(x);Ph(x,Ne,he);break;default:throw Error(s(161))}}}catch(Ge){vn(x,x.return,Ge)}x.flags&=-3}b&4096&&(x.flags&=-4097)}function qc(x,b,M){xt=x,qf(x)}function qf(x,b,M){for(var z=(x.mode&1)!==0;xt!==null;){var K=xt,ee=K.child;if(K.tag===22&&z){var he=K.memoizedState!==null||Hc;if(!he){var Ne=K.alternate,Ge=Ne!==null&&Ne.memoizedState!==null||Oi;Ne=Hc;var dt=Oi;if(Hc=he,(Oi=Ge)&&!dt)for(xt=K;xt!==null;)he=xt,Ge=he.child,he.tag===22&&he.memoizedState!==null?Zf(K):Ge!==null?(Ge.return=he,xt=Ge):Zf(K);for(;ee!==null;)xt=ee,qf(ee),ee=ee.sibling;xt=K,Hc=Ne,Oi=dt}$f(x)}else(K.subtreeFlags&8772)!==0&&ee!==null?(ee.return=K,xt=ee):$f(x)}}function $f(x){for(;xt!==null;){var b=xt;if((b.flags&8772)!==0){var M=b.alternate;try{if((b.flags&8772)!==0)switch(b.tag){case 0:case 11:case 15:Oi||Wc(5,b);break;case 1:var z=b.stateNode;if(b.flags&4&&!Oi)if(M===null)z.componentDidMount();else{var K=b.elementType===b.type?M.memoizedProps:Kr(b.type,M.memoizedProps);z.componentDidUpdate(K,M.memoizedState,z.__reactInternalSnapshotBeforeUpdate)}var ee=b.updateQueue;ee!==null&&Ff(b,ee,z);break;case 3:var he=b.updateQueue;if(he!==null){if(M=null,b.child!==null)switch(b.child.tag){case 5:M=W(b.child.stateNode);break;case 1:M=b.child.stateNode}Ff(b,he,M)}break;case 5:var Ne=b.stateNode;M===null&&b.flags&4&&ft(Ne,b.type,b.memoizedProps,b);break;case 6:break;case 4:break;case 12:break;case 13:if(Se&&b.memoizedState===null){var Ge=b.alternate;if(Ge!==null){var dt=Ge.memoizedState;if(dt!==null){var Rt=dt.dehydrated;Rt!==null&&vi(Rt)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(s(163))}Oi||b.flags&512&&Hf(b)}catch(ur){vn(b,b.return,ur)}}if(b===x){xt=null;break}if(M=b.sibling,M!==null){M.return=b.return,xt=M;break}xt=b.return}}function Kf(x){for(;xt!==null;){var b=xt;if(b===x){xt=null;break}var M=b.sibling;if(M!==null){M.return=b.return,xt=M;break}xt=b.return}}function Zf(x){for(;xt!==null;){var b=xt;try{switch(b.tag){case 0:case 11:case 15:var M=b.return;try{Wc(4,b)}catch(Ge){vn(b,M,Ge)}break;case 1:var z=b.stateNode;if(typeof z.componentDidMount=="function"){var K=b.return;try{z.componentDidMount()}catch(Ge){vn(b,K,Ge)}}var ee=b.return;try{Hf(b)}catch(Ge){vn(b,ee,Ge)}break;case 5:var he=b.return;try{Hf(b)}catch(Ge){vn(b,he,Ge)}}}catch(Ge){vn(b,b.return,Ge)}if(b===x){xt=null;break}var Ne=b.sibling;if(Ne!==null){Ne.return=b.return,xt=Ne;break}xt=b.return}}var bl=0,Oa=1,Ro=2,$c=3,Ah=4;if(typeof Symbol=="function"&&Symbol.for){var _s=Symbol.for;bl=_s("selector.component"),Oa=_s("selector.has_pseudo_class"),Ro=_s("selector.role"),$c=_s("selector.test_id"),Ah=_s("selector.text")}function Lo(x){var b=Ve(x);if(b!=null){if(typeof b.memoizedProps["data-testname"]!="string")throw Error(s(364));return b}if(x=Qe(x),x===null)throw Error(s(362));return x.stateNode.current}function Rh(x,b){switch(b.$$typeof){case bl:if(x.type===b.value)return!0;break;case Oa:e:{b=b.value,x=[x,0];for(var M=0;M<x.length;){var z=x[M++],K=x[M++],ee=b[K];if(z.tag!==5||!Ke(z)){for(;ee!=null&&Rh(z,ee);)K++,ee=b[K];if(K===b.length){b=!0;break e}else for(z=z.child;z!==null;)x.push(z,K),z=z.sibling}}b=!1}return b;case Ro:if(x.tag===5&&mt(x.stateNode,b.value))return!0;break;case Ah:if((x.tag===5||x.tag===6)&&(x=Fe(x),x!==null&&0<=x.indexOf(b.value)))return!0;break;case $c:if(x.tag===5&&(x=x.memoizedProps["data-testname"],typeof x=="string"&&x.toLowerCase()===b.value.toLowerCase()))return!0;break;default:throw Error(s(365))}return!1}function Yf(x){switch(x.$$typeof){case bl:return"<"+(j(x.value)||"Unknown")+">";case Oa:return":has("+(Yf(x)||"")+")";case Ro:return'[role="'+x.value+'"]';case Ah:return'"'+x.value+'"';case $c:return'[data-testname="'+x.value+'"]';default:throw Error(s(365))}}function Oo(x,b){var M=[];x=[x,0];for(var z=0;z<x.length;){var K=x[z++],ee=x[z++],he=b[ee];if(K.tag!==5||!Ke(K)){for(;he!=null&&Rh(K,he);)ee++,he=b[ee];if(ee===b.length)M.push(K);else for(K=K.child;K!==null;)x.push(K,ee),K=K.sibling}}return M}function Do(x,b){if(!Le)throw Error(s(363));x=Lo(x),x=Oo(x,b),b=[],x=Array.from(x);for(var M=0;M<x.length;){var z=x[M++];if(z.tag===5)Ke(z)||b.push(z.stateNode);else for(z=z.child;z!==null;)x.push(z),z=z.sibling}return b}var Xf=Math.ceil,Lh=o.ReactCurrentDispatcher,Kc=o.ReactCurrentOwner,Hn=o.ReactCurrentBatchConfig,fr=0,on=null,kn=null,ri=0,ki=0,cu=tr(0),_n=0,Zc=null,wl=0,hn=0,Yc=0,Yu=null,la=null,Xc=0,Oh=1/0,Da=null;function en(){Oh=jn()+500}var Wn=!1,li=null,uo=null,du=!1,Gs=null,Qf=0,ui=0,Dh=null,Qc=-1,Jc=0;function gn(){return(fr&6)!==0?jn():Qc!==-1?Qc:Qc=jn()}function _i(x){return(x.mode&1)===0?1:(fr&2)!==0&&ri!==0?ri&-ri:Pc.transition!==null?(Jc===0&&(Jc=Gl()),Jc):(x=Sr,x!==0?x:St())}function ua(x,b,M,z){if(50<ui)throw ui=0,Dh=null,Error(s(185));Ui(x,M,z),((fr&2)===0||x!==on)&&(x===on&&((fr&2)===0&&(hn|=M),_n===4&&Sl(x,ri)),ca(x,z),M===1&&fr===0&&(b.mode&1)===0&&(en(),So&&xi()))}function ca(x,b){var M=x.callbackNode;Ec(x,b);var z=Ls(x,x===on?ri:0);if(z===0)M!==null&&qr(M),x.callbackNode=null,x.callbackPriority=0;else if(b=z&-z,x.callbackPriority!==b){if(M!=null&&qr(M),b===1)x.tag===0?Cr(km.bind(null,x)):Du(km.bind(null,x)),lt?De(function(){(fr&6)===0&&xi()}):ei(Vl,xi),M=null;else{switch(rr(z)){case 1:M=Vl;break;case 4:M=Os;break;case 16:M=Hl;break;case 536870912:M=Lu;break;default:M=Hl}M=Mm(M,Jf.bind(null,x))}x.callbackPriority=b,x.callbackNode=M}}function Jf(x,b){if(Qc=-1,Jc=0,(fr&6)!==0)throw Error(s(327));var M=x.callbackNode;if(kl()&&x.callbackNode!==M)return null;var z=Ls(x,x===on?ri:0);if(z===0)return null;if((z&30)!==0||(z&x.expiredLanes)!==0||b)b=Xu(x,z);else{b=z;var K=fr;fr|=2;var ee=Cm();(on!==x||ri!==b)&&(Da=null,en(),hu(x,b));do try{Em();break}catch(Ne){ed(x,Ne)}while(!0);bh(),Lh.current=ee,fr=K,kn!==null?b=0:(on=null,ri=0,b=_n)}if(b!==0){if(b===2&&(K=rl(x),K!==0&&(z=K,b=ep(x,K))),b===1)throw M=Zc,hu(x,0),Sl(x,z),ca(x,jn()),M;if(b===6)Sl(x,z);else{if(K=x.current.alternate,(z&30)===0&&!b0(K)&&(b=Xu(x,z),b===2&&(ee=rl(x),ee!==0&&(z=ee,b=ep(x,ee))),b===1))throw M=Zc,hu(x,0),Sl(x,z),ca(x,jn()),M;switch(x.finishedWork=K,x.finishedLanes=z,b){case 0:case 1:throw Error(s(345));case 2:fu(x,la,Da);break;case 3:if(Sl(x,z),(z&130023424)===z&&(b=Xc+500-jn(),10<b)){if(Ls(x,0)!==0)break;if(K=x.suspendedLanes,(K&z)!==z){gn(),x.pingedLanes|=x.suspendedLanes&K;break}x.timeoutHandle=se(fu.bind(null,x,la,Da),b);break}fu(x,la,Da);break;case 4:if(Sl(x,z),(z&4194240)===z)break;for(b=x.eventTimes,K=-1;0<z;){var he=31-Mi(z);ee=1<<he,he=b[he],he>K&&(K=he),z&=~ee}if(z=K,z=jn()-z,z=(120>z?120:480>z?480:1080>z?1080:1920>z?1920:3e3>z?3e3:4320>z?4320:1960*Xf(z/1960))-z,10<z){x.timeoutHandle=se(fu.bind(null,x,la,Da),z);break}fu(x,la,Da);break;case 5:fu(x,la,Da);break;default:throw Error(s(329))}}}return ca(x,jn()),x.callbackNode===M?Jf.bind(null,x):null}function ep(x,b){var M=Yu;return x.current.memoizedState.isDehydrated&&(hu(x,b).flags|=256),x=Xu(x,b),x!==2&&(b=la,la=M,b!==null&&tp(b)),x}function tp(x){la===null?la=x:la.push.apply(la,x)}function b0(x){for(var b=x;;){if(b.flags&16384){var M=b.updateQueue;if(M!==null&&(M=M.stores,M!==null))for(var z=0;z<M.length;z++){var K=M[z],ee=K.getSnapshot;K=K.value;try{if(!ms(ee(),K))return!1}catch{return!1}}}if(M=b.child,b.subtreeFlags&16384&&M!==null)M.return=b,b=M;else{if(b===x)break;for(;b.sibling===null;){if(b.return===null||b.return===x)return!0;b=b.return}b.sibling.return=b.return,b=b.sibling}}return!0}function Sl(x,b){for(b&=~Yc,b&=~hn,x.suspendedLanes|=b,x.pingedLanes&=~b,x=x.expirationTimes;0<b;){var M=31-Mi(b),z=1<<M;x[M]=-1,b&=~z}}function km(x){if((fr&6)!==0)throw Error(s(327));kl();var b=Ls(x,0);if((b&1)===0)return ca(x,jn()),null;var M=Xu(x,b);if(x.tag!==0&&M===2){var z=rl(x);z!==0&&(b=z,M=ep(x,z))}if(M===1)throw M=Zc,hu(x,0),Sl(x,b),ca(x,jn()),M;if(M===6)throw Error(s(345));return x.finishedWork=x.current.alternate,x.finishedLanes=b,fu(x,la,Da),ca(x,jn()),null}function _m(x){Gs!==null&&Gs.tag===0&&(fr&6)===0&&kl();var b=fr;fr|=1;var M=Hn.transition,z=Sr;try{if(Hn.transition=null,Sr=1,x)return x()}finally{Sr=z,Hn.transition=M,fr=b,(fr&6)===0&&xi()}}function rp(){ki=cu.current,gr(cu)}function hu(x,b){x.finishedWork=null,x.finishedLanes=0;var M=x.timeoutHandle;if(M!==le&&(x.timeoutHandle=le,fe(M)),kn!==null)for(M=kn.return;M!==null;){var z=M;switch(Iu(z),z.tag){case 1:z=z.type.childContextTypes,z!=null&&sr();break;case 3:Fs(),gr(Ur),gr(Qr),Oc();break;case 5:Jl(z);break;case 4:Fs();break;case 13:gr(Gr);break;case 19:gr(Gr);break;case 10:js(z.type._context);break;case 22:case 23:rp()}M=M.return}if(on=x,kn=x=pu(x.current,null),ri=ki=b,_n=0,Zc=null,Yc=hn=wl=0,la=Yu=null,Na!==null){for(b=0;b<Na.length;b++)if(M=Na[b],z=M.interleaved,z!==null){M.interleaved=null;var K=z.next,ee=M.pending;if(ee!==null){var he=ee.next;ee.next=K,z.next=he}M.pending=z}Na=null}return x}function ed(x,b){do{var M=kn;try{if(bh(),ia.current=Ze,eu){for(var z=an.memoizedState;z!==null;){var K=z.queue;K!==null&&(K.pending=null),z=z.next}eu=!1}if(_o=0,Un=zn=an=null,aa=!1,Co=0,Kc.current=null,M===null||M.return===null){_n=1,Zc=b,kn=null;break}e:{var ee=x,he=M.return,Ne=M,Ge=b;if(b=ri,Ne.flags|=32768,Ge!==null&&typeof Ge=="object"&&typeof Ge.then=="function"){var dt=Ge,Rt=Ne,ur=Rt.tag;if((Rt.mode&1)===0&&(ur===0||ur===11||ur===15)){var Et=Rt.alternate;Et?(Rt.updateQueue=Et.updateQueue,Rt.memoizedState=Et.memoizedState,Rt.lanes=Et.lanes):(Rt.updateQueue=null,Rt.memoizedState=null)}var fn=zf(he);if(fn!==null){fn.flags&=-257,Po(fn,he,Ne,ee,b),fn.mode&1&&Bf(ee,dt,b),b=fn,Ge=dt;var Yr=b.updateQueue;if(Yr===null){var Ia=new Set;Ia.add(Ge),b.updateQueue=Ia}else Yr.add(Ge);break e}else{if((b&1)===0){Bf(ee,dt,b),td();break e}Ge=Error(s(426))}}else if(Jr&&Ne.mode&1){var Io=zf(he);if(Io!==null){(Io.flags&65536)===0&&(Io.flags|=256),Po(Io,he,Ne,ee,b),Nc(ml(Ge,Ne));break e}}ee=Ge=ml(Ge,Ne),_n!==4&&(_n=2),Yu===null?Yu=[ee]:Yu.push(ee),ee=he;do{switch(ee.tag){case 3:ee.flags|=65536,b&=-b,ee.lanes|=b;var je=Dr(ee,Ge,b);Xl(ee,je);break e;case 1:Ne=Ge;var Pe=ee.type,He=ee.stateNode;if((ee.flags&128)===0&&(typeof Pe.getDerivedStateFromError=="function"||He!==null&&typeof He.componentDidCatch=="function"&&(uo===null||!uo.has(He)))){ee.flags|=65536,b&=-b,ee.lanes|=b;var Nt=gl(ee,Ne,b);Xl(ee,Nt);break e}}ee=ee.return}while(ee!==null)}Nm(M)}catch(Gt){b=Gt,kn===M&&M!==null&&(kn=M=M.return);continue}break}while(!0)}function Cm(){var x=Lh.current;return Lh.current=Ze,x===null?Ze:x}function td(){(_n===0||_n===3||_n===2)&&(_n=4),on===null||(wl&268435455)===0&&(hn&268435455)===0||Sl(on,ri)}function Xu(x,b){var M=fr;fr|=2;var z=Cm();(on!==x||ri!==b)&&(Da=null,hu(x,b));do try{w0();break}catch(K){ed(x,K)}while(!0);if(bh(),fr=M,Lh.current=z,kn!==null)throw Error(s(261));return on=null,ri=0,_n}function w0(){for(;kn!==null;)Tm(kn)}function Em(){for(;kn!==null&&!gh();)Tm(kn)}function Tm(x){var b=E0(x.alternate,x,ki);x.memoizedProps=x.pendingProps,b===null?Nm(x):kn=b,Kc.current=null}function Nm(x){var b=x;do{var M=b.alternate;if(x=b.return,(b.flags&32768)===0){if(M=qu(M,b,ki),M!==null){kn=M;return}}else{if(M=y0(M,b),M!==null){M.flags&=32767,kn=M;return}if(x!==null)x.flags|=32768,x.subtreeFlags=0,x.deletions=null;else{_n=6,kn=null;return}}if(b=b.sibling,b!==null){kn=b;return}kn=b=x}while(b!==null);_n===0&&(_n=5)}function fu(x,b,M){var z=Sr,K=Hn.transition;try{Hn.transition=null,Sr=1,S0(x,b,M,z)}finally{Hn.transition=K,Sr=z}return null}function S0(x,b,M,z){do kl();while(Gs!==null);if((fr&6)!==0)throw Error(s(327));M=x.finishedWork;var K=x.finishedLanes;if(M===null)return null;if(x.finishedWork=null,x.finishedLanes=0,M===x.current)throw Error(s(177));x.callbackNode=null,x.callbackPriority=0;var ee=M.lanes|M.childLanes;if(no(x,ee),x===on&&(kn=on=null,ri=0),(M.subtreeFlags&2064)===0&&(M.flags&2064)===0||du||(du=!0,Mm(Hl,function(){return kl(),null})),ee=(M.flags&15990)!==0,(M.subtreeFlags&15990)!==0||ee){ee=Hn.transition,Hn.transition=null;var he=Sr;Sr=1;var Ne=fr;fr|=4,Kc.current=null,x0(x,M),Mh(M,x),re(x.containerInfo),x.current=M,qc(M),nl(),fr=Ne,Sr=he,Hn.transition=ee}else x.current=M;if(du&&(du=!1,Gs=x,Qf=K),ee=x.pendingLanes,ee===0&&(uo=null),il(M.stateNode),ca(x,jn()),b!==null)for(z=x.onRecoverableError,M=0;M<b.length;M++)K=b[M],z(K.value,{componentStack:K.stack,digest:K.digest});if(Wn)throw Wn=!1,x=li,li=null,x;return(Qf&1)!==0&&x.tag!==0&&kl(),ee=x.pendingLanes,(ee&1)!==0?x===Dh?ui++:(ui=0,Dh=x):ui=0,xi(),null}function kl(){if(Gs!==null){var x=rr(Qf),b=Hn.transition,M=Sr;try{if(Hn.transition=null,Sr=16>x?16:x,Gs===null)var z=!1;else{if(x=Gs,Gs=null,Qf=0,(fr&6)!==0)throw Error(s(331));var K=fr;for(fr|=4,xt=x.current;xt!==null;){var ee=xt,he=ee.child;if((xt.flags&16)!==0){var Ne=ee.deletions;if(Ne!==null){for(var Ge=0;Ge<Ne.length;Ge++){var dt=Ne[Ge];for(xt=dt;xt!==null;){var Rt=xt;switch(Rt.tag){case 0:case 11:case 15:$u(8,Rt,ee)}var ur=Rt.child;if(ur!==null)ur.return=Rt,xt=ur;else for(;xt!==null;){Rt=xt;var Et=Rt.sibling,fn=Rt.return;if(Nh(Rt),Rt===dt){xt=null;break}if(Et!==null){Et.return=fn,xt=Et;break}xt=fn}}}var Yr=ee.alternate;if(Yr!==null){var Ia=Yr.child;if(Ia!==null){Yr.child=null;do{var Io=Ia.sibling;Ia.sibling=null,Ia=Io}while(Ia!==null)}}xt=ee}}if((ee.subtreeFlags&2064)!==0&&he!==null)he.return=ee,xt=he;else e:for(;xt!==null;){if(ee=xt,(ee.flags&2048)!==0)switch(ee.tag){case 0:case 11:case 15:$u(9,ee,ee.return)}var je=ee.sibling;if(je!==null){je.return=ee.return,xt=je;break e}xt=ee.return}}var Pe=x.current;for(xt=Pe;xt!==null;){he=xt;var He=he.child;if((he.subtreeFlags&2064)!==0&&He!==null)He.return=he,xt=He;else e:for(he=Pe;xt!==null;){if(Ne=xt,(Ne.flags&2048)!==0)try{switch(Ne.tag){case 0:case 11:case 15:Wc(9,Ne)}}catch(Gt){vn(Ne,Ne.return,Gt)}if(Ne===he){xt=null;break e}var Nt=Ne.sibling;if(Nt!==null){Nt.return=Ne.return,xt=Nt;break e}xt=Ne.return}}if(fr=K,xi(),Fn&&typeof Fn.onPostCommitFiberRoot=="function")try{Fn.onPostCommitFiberRoot(cn,x)}catch{}z=!0}return z}finally{Sr=M,Hn.transition=b}}return!1}function Pm(x,b,M){b=ml(M,b),b=Dr(x,b,1),x=ao(x,b,1),b=gn(),x!==null&&(Ui(x,1,b),ca(x,b))}function vn(x,b,M){if(x.tag===3)Pm(x,x,M);else for(;b!==null;){if(b.tag===3){Pm(b,x,M);break}else if(b.tag===1){var z=b.stateNode;if(typeof b.type.getDerivedStateFromError=="function"||typeof z.componentDidCatch=="function"&&(uo===null||!uo.has(z))){x=ml(M,x),x=gl(b,x,1),b=ao(b,x,1),x=gn(),b!==null&&(Ui(b,1,x),ca(b,x));break}}b=b.return}}function k0(x,b,M){var z=x.pingCache;z!==null&&z.delete(b),b=gn(),x.pingedLanes|=x.suspendedLanes&M,on===x&&(ri&M)===M&&(_n===4||_n===3&&(ri&130023424)===ri&&500>jn()-Xc?hu(x,0):Yc|=M),ca(x,b)}function _0(x,b){b===0&&((x.mode&1)===0?b=1:(b=ro,ro<<=1,(ro&130023424)===0&&(ro=4194304)));var M=gn();x=Xa(x,b),x!==null&&(Ui(x,b,M),ca(x,M))}function C0(x){var b=x.memoizedState,M=0;b!==null&&(M=b.retryLane),_0(x,M)}function ob(x,b){var M=0;switch(x.tag){case 13:var z=x.stateNode,K=x.memoizedState;K!==null&&(M=K.retryLane);break;case 19:z=x.stateNode;break;default:throw Error(s(314))}z!==null&&z.delete(b),_0(x,M)}var E0;E0=function(x,b,M){if(x!==null)if(x.memoizedProps!==b.pendingProps||Ur.current)Vn=!0;else{if((x.lanes&M)===0&&(b.flags&128)===0)return Vn=!1,su(x,b,M);Vn=(x.flags&131072)!==0}else Vn=!1,Jr&&(b.flags&1048576)!==0&&Of(b,al,b.index);switch(b.lanes=0,b.tag){case 2:var z=b.type;Th(x,b),x=b.pendingProps;var K=ii(b,Qr.current);ra(b,M),K=ru(null,b,z,x,K,M);var ee=Dc();return b.flags|=1,typeof K=="object"&&K!==null&&typeof K.render=="function"&&K.$$typeof===void 0?(b.tag=1,b.memoizedState=null,b.updateQueue=null,it(z)?(ee=!0,Dn(b)):ee=!1,b.memoizedState=K.state!==null&&K.state!==void 0?K.state:null,wh(b),K.updater=Li,b.stateNode=K,K._reactInternals=b,zs(b,z,x,M),b=sa(null,b,z,!0,ee,M)):(b.tag=0,Jr&&ee&&ta(b),oi(null,b,K,M),b=b.child),b;case 16:z=b.elementType;e:{switch(Th(x,b),x=b.pendingProps,K=z._init,z=K(z._payload),b.type=z,K=b.tag=lb(z),x=Kr(z,x),K){case 0:b=Mo(null,b,z,x,M);break e;case 1:b=Hi(null,b,z,x,M);break e;case 11:b=Uf(null,b,z,x,M);break e;case 14:b=Gu(null,b,z,Kr(z.type,x),M);break e}throw Error(s(306,z,""))}return b;case 0:return z=b.type,K=b.pendingProps,K=b.elementType===z?K:Kr(z,K),Mo(x,b,z,K,M);case 1:return z=b.type,K=b.pendingProps,K=b.elementType===z?K:Kr(z,K),Hi(x,b,z,K,M);case 3:e:{if(au(b),x===null)throw Error(s(387));z=b.pendingProps,ee=b.memoizedState,K=ee.element,io(x,b),Ri(b,z,null,M);var he=b.memoizedState;if(z=he.element,Se&&ee.isDehydrated)if(ee={element:z,isDehydrated:!1,cache:he.cache,pendingSuspenseBoundaries:he.pendingSuspenseBoundaries,transitions:he.transitions},b.updateQueue.baseState=ee,b.memoizedState=ee,b.flags&256){K=ml(Error(s(423)),b),b=Vu(x,b,z,M,K);break e}else if(z!==K){K=ml(Error(s(424)),b),b=Vu(x,b,z,M,K);break e}else for(Se&&(wn=Ka(b.stateNode.containerInfo),si=b,Jr=!0,Ea=null,$l=!1),M=Mc(b,null,z,M),b.child=M;M;)M.flags=M.flags&-3|4096,M=M.sibling;else{if(ko(),z===K){b=xl(x,b,M);break e}oi(x,b,z,M)}b=b.child}return b;case 5:return Fu(b),x===null&&vh(b),z=b.type,K=b.pendingProps,ee=x!==null?x.memoizedProps:null,he=K.children,ge(z,K)?he=null:ee!==null&&ge(z,ee)&&(b.flags|=32),sn(x,b),oi(x,b,he,M),b.child;case 6:return x===null&&vh(b),null;case 13:return xm(x,b,M);case 4:return Ql(b,b.stateNode.containerInfo),z=b.pendingProps,x===null?b.child=sl(b,null,z,M):oi(x,b,z,M),b.child;case 11:return z=b.type,K=b.pendingProps,K=b.elementType===z?K:Kr(z,K),Uf(x,b,z,K,M);case 7:return oi(x,b,b.pendingProps,M),b.child;case 8:return oi(x,b,b.pendingProps.children,M),b.child;case 12:return oi(x,b,b.pendingProps.children,M),b.child;case 10:e:{if(z=b.type._context,K=b.pendingProps,ee=b.memoizedProps,he=K.value,Ya(b,z,he),ee!==null)if(ms(ee.value,he)){if(ee.children===K.children&&!Ur.current){b=xl(x,b,M);break e}}else for(ee=b.child,ee!==null&&(ee.return=b);ee!==null;){var Ne=ee.dependencies;if(Ne!==null){he=ee.child;for(var Ge=Ne.firstContext;Ge!==null;){if(Ge.context===z){if(ee.tag===1){Ge=Qa(-1,M&-M),Ge.tag=2;var dt=ee.updateQueue;if(dt!==null){dt=dt.shared;var Rt=dt.pending;Rt===null?Ge.next=Ge:(Ge.next=Rt.next,Rt.next=Ge),dt.pending=Ge}}ee.lanes|=M,Ge=ee.alternate,Ge!==null&&(Ge.lanes|=M),ol(ee.return,M,b),Ne.lanes|=M;break}Ge=Ge.next}}else if(ee.tag===10)he=ee.type===b.type?null:ee.child;else if(ee.tag===18){if(he=ee.return,he===null)throw Error(s(341));he.lanes|=M,Ne=he.alternate,Ne!==null&&(Ne.lanes|=M),ol(he,M,b),he=ee.sibling}else he=ee.child;if(he!==null)he.return=ee;else for(he=ee;he!==null;){if(he===b){he=null;break}if(ee=he.sibling,ee!==null){ee.return=he.return,he=ee;break}he=he.return}ee=he}oi(x,b,K.children,M),b=b.child}return b;case 9:return K=b.type,z=b.pendingProps.children,ra(b,M),K=Ta(K),z=z(K),b.flags|=1,oi(x,b,z,M),b.child;case 14:return z=b.type,K=Kr(z,b.pendingProps),K=Kr(z.type,K),Gu(x,b,z,K,M);case 15:return yl(x,b,b.type,b.pendingProps,M);case 17:return z=b.type,K=b.pendingProps,K=b.elementType===z?K:Kr(z,K),Th(x,b),b.tag=1,it(z)?(x=!0,Dn(b)):x=!1,ra(b,M),pl(b,z,K),zs(b,z,K,M),sa(null,b,z,!0,x,M);case 19:return Vf(x,b,M);case 22:return dn(x,b,M)}throw Error(s(156,b.tag))};function Mm(x,b){return ei(x,b)}function T0(x,b,M,z){this.tag=x,this.key=M,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=b,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=z,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Cs(x,b,M,z){return new T0(x,b,M,z)}function rd(x){return x=x.prototype,!(!x||!x.isReactComponent)}function lb(x){if(typeof x=="function")return rd(x)?1:0;if(x!=null){if(x=x.$$typeof,x===S)return 11;if(x===_)return 14}return 2}function pu(x,b){var M=x.alternate;return M===null?(M=Cs(x.tag,b,x.key,x.mode),M.elementType=x.elementType,M.type=x.type,M.stateNode=x.stateNode,M.alternate=x,x.alternate=M):(M.pendingProps=b,M.type=x.type,M.flags=0,M.subtreeFlags=0,M.deletions=null),M.flags=x.flags&14680064,M.childLanes=x.childLanes,M.lanes=x.lanes,M.child=x.child,M.memoizedProps=x.memoizedProps,M.memoizedState=x.memoizedState,M.updateQueue=x.updateQueue,b=x.dependencies,M.dependencies=b===null?null:{lanes:b.lanes,firstContext:b.firstContext},M.sibling=x.sibling,M.index=x.index,M.ref=x.ref,M}function np(x,b,M,z,K,ee){var he=2;if(z=x,typeof x=="function")rd(x)&&(he=1);else if(typeof x=="string")he=5;else e:switch(x){case c:return Wi(M.children,K,ee,b);case h:he=8,K|=8;break;case p:return x=Cs(12,M,b,K|2),x.elementType=p,x.lanes=ee,x;case w:return x=Cs(13,M,b,K),x.elementType=w,x.lanes=ee,x;case T:return x=Cs(19,M,b,K),x.elementType=T,x.lanes=ee,x;case N:return nd(M,K,ee,b);default:if(typeof x=="object"&&x!==null)switch(x.$$typeof){case v:he=10;break e;case y:he=9;break e;case S:he=11;break e;case _:he=14;break e;case C:he=16,z=null;break e}throw Error(s(130,x==null?x:typeof x,""))}return b=Cs(he,M,b,K),b.elementType=x,b.type=z,b.lanes=ee,b}function Wi(x,b,M,z){return x=Cs(7,x,z,b),x.lanes=M,x}function nd(x,b,M,z){return x=Cs(22,x,z,b),x.elementType=N,x.lanes=M,x.stateNode={isHidden:!1},x}function ad(x,b,M){return x=Cs(6,x,null,b),x.lanes=M,x}function ip(x,b,M){return b=Cs(4,x.children!==null?x.children:[],x.key,b),b.lanes=M,b.stateNode={containerInfo:x.containerInfo,pendingChildren:null,implementation:x.implementation},b}function N0(x,b,M,z,K){this.tag=b,this.containerInfo=x,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=le,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=wo(0),this.expirationTimes=wo(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=wo(0),this.identifierPrefix=z,this.onRecoverableError=K,Se&&(this.mutableSourceEagerHydrationData=null)}function Am(x,b,M,z,K,ee,he,Ne,Ge){return x=new N0(x,b,M,Ne,Ge),b===1?(b=1,ee===!0&&(b|=8)):b=0,ee=Cs(3,null,null,b),x.current=ee,ee.stateNode=x,ee.memoizedState={element:z,isDehydrated:M,cache:null,transitions:null,pendingSuspenseBoundaries:null},wh(ee),x}function ap(x){if(!x)return mr;x=x._reactInternals;e:{if(F(x)!==x||x.tag!==1)throw Error(s(170));var b=x;do{switch(b.tag){case 3:b=b.stateNode.context;break e;case 1:if(it(b.type)){b=b.stateNode.__reactInternalMemoizedMergedChildContext;break e}}b=b.return}while(b!==null);throw Error(s(171))}if(x.tag===1){var M=x.type;if(it(M))return On(x,M,b)}return b}function Qu(x){var b=x._reactInternals;if(b===void 0)throw typeof x.render=="function"?Error(s(188)):(x=Object.keys(x).join(","),Error(s(268,x)));return x=Z(b),x===null?null:x.stateNode}function sp(x,b){if(x=x.memoizedState,x!==null&&x.dehydrated!==null){var M=x.retryLane;x.retryLane=M!==0&&M<b?M:b}}function sd(x,b){sp(x,b),(x=x.alternate)&&sp(x,b)}function ub(x){return x=Z(x),x===null?null:x.stateNode}function P0(){return null}return r.attemptContinuousHydration=function(x){if(x.tag===13){var b=Xa(x,134217728);if(b!==null){var M=gn();ua(b,x,134217728,M)}sd(x,134217728)}},r.attemptDiscreteHydration=function(x){if(x.tag===13){var b=Xa(x,1);if(b!==null){var M=gn();ua(b,x,1,M)}sd(x,1)}},r.attemptHydrationAtCurrentPriority=function(x){if(x.tag===13){var b=_i(x),M=Xa(x,b);if(M!==null){var z=gn();ua(M,x,b,z)}sd(x,b)}},r.attemptSynchronousHydration=function(x){switch(x.tag){case 3:var b=x.stateNode;if(b.current.memoizedState.isDehydrated){var M=bo(b.pendingLanes);M!==0&&(Za(b,M|1),ca(b,jn()),(fr&6)===0&&(en(),xi()))}break;case 13:_m(function(){var z=Xa(x,1);if(z!==null){var K=gn();ua(z,x,1,K)}}),sd(x,1)}},r.batchedUpdates=function(x,b){var M=fr;fr|=1;try{return x(b)}finally{fr=M,fr===0&&(en(),So&&xi())}},r.createComponentSelector=function(x){return{$$typeof:bl,value:x}},r.createContainer=function(x,b,M,z,K,ee,he){return Am(x,b,!1,null,M,z,K,ee,he)},r.createHasPseudoClassSelector=function(x){return{$$typeof:Oa,value:x}},r.createHydrationContainer=function(x,b,M,z,K,ee,he,Ne,Ge){return x=Am(M,z,!0,x,K,ee,he,Ne,Ge),x.context=ap(null),M=x.current,z=gn(),K=_i(M),ee=Qa(z,K),ee.callback=b??null,ao(M,ee,K),x.current.lanes=K,Ui(x,K,z),ca(x,z),x},r.createPortal=function(x,b,M){var z=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:u,key:z==null?null:""+z,children:x,containerInfo:b,implementation:M}},r.createRoleSelector=function(x){return{$$typeof:Ro,value:x}},r.createTestNameSelector=function(x){return{$$typeof:$c,value:x}},r.createTextSelector=function(x){return{$$typeof:Ah,value:x}},r.deferredUpdates=function(x){var b=Sr,M=Hn.transition;try{return Hn.transition=null,Sr=16,x()}finally{Sr=b,Hn.transition=M}},r.discreteUpdates=function(x,b,M,z,K){var ee=Sr,he=Hn.transition;try{return Hn.transition=null,Sr=1,x(b,M,z,K)}finally{Sr=ee,Hn.transition=he,fr===0&&en()}},r.findAllNodes=Do,r.findBoundingRects=function(x,b){if(!Le)throw Error(s(363));b=Do(x,b),x=[];for(var M=0;M<b.length;M++)x.push(Ce(b[M]));for(b=x.length-1;0<b;b--){M=x[b];for(var z=M.x,K=z+M.width,ee=M.y,he=ee+M.height,Ne=b-1;0<=Ne;Ne--)if(b!==Ne){var Ge=x[Ne],dt=Ge.x,Rt=dt+Ge.width,ur=Ge.y,Et=ur+Ge.height;if(z>=dt&&ee>=ur&&K<=Rt&&he<=Et){x.splice(b,1);break}else if(z!==dt||M.width!==Ge.width||Et<ee||ur>he){if(!(ee!==ur||M.height!==Ge.height||Rt<z||dt>K)){dt>z&&(Ge.width+=dt-z,Ge.x=z),Rt<K&&(Ge.width=K-dt),x.splice(b,1);break}}else{ur>ee&&(Ge.height+=ur-ee,Ge.y=ee),Et<he&&(Ge.height=he-ur),x.splice(b,1);break}}}return x},r.findHostInstance=Qu,r.findHostInstanceWithNoPortals=function(x){return x=$(x),x=x!==null?H(x):null,x===null?null:x.stateNode},r.findHostInstanceWithWarning=function(x){return Qu(x)},r.flushControlled=function(x){var b=fr;fr|=1;var M=Hn.transition,z=Sr;try{Hn.transition=null,Sr=1,x()}finally{Sr=z,Hn.transition=M,fr=b,fr===0&&(en(),xi())}},r.flushPassiveEffects=kl,r.flushSync=_m,r.focusWithin=function(x,b){if(!Le)throw Error(s(363));for(x=Lo(x),b=Oo(x,b),b=Array.from(b),x=0;x<b.length;){var M=b[x++];if(!Ke(M)){if(M.tag===5&&gt(M.stateNode))return!0;for(M=M.child;M!==null;)b.push(M),M=M.sibling}}return!1},r.getCurrentUpdatePriority=function(){return Sr},r.getFindAllNodesFailureDescription=function(x,b){if(!Le)throw Error(s(363));var M=0,z=[];x=[Lo(x),0];for(var K=0;K<x.length;){var ee=x[K++],he=x[K++],Ne=b[he];if((ee.tag!==5||!Ke(ee))&&(Rh(ee,Ne)&&(z.push(Yf(Ne)),he++,he>M&&(M=he)),he<b.length))for(ee=ee.child;ee!==null;)x.push(ee,he),ee=ee.sibling}if(M<b.length){for(x=[];M<b.length;M++)x.push(Yf(b[M]));return`findAllNodes was able to match part of the selector:
  `+(z.join(" > ")+`

No matching component was found for:
  `)+x.join(" > ")}return null},r.getPublicRootInstance=function(x){return x=x.current,x.child?x.child.tag===5?W(x.child.stateNode):x.child.stateNode:null},r.injectIntoDevTools=function(x){if(x={bundleType:x.bundleType,version:x.version,rendererPackageName:x.rendererPackageName,rendererConfig:x.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:o.ReactCurrentDispatcher,findHostInstanceByFiber:ub,findFiberByHostInstance:x.findFiberByHostInstance||P0,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1"},typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u")x=!1;else{var b=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(b.isDisabled||!b.supportsFiber)x=!0;else{try{cn=b.inject(x),Fn=b}catch{}x=!!b.checkDCE}}return x},r.isAlreadyRendering=function(){return!1},r.observeVisibleRects=function(x,b,M,z){if(!Le)throw Error(s(363));x=Do(x,b);var K=yt(x,M,z).disconnect;return{disconnect:function(){K()}}},r.registerMutableSourceForHydration=function(x,b){var M=b._getVersion;M=M(b._source),x.mutableSourceEagerHydrationData==null?x.mutableSourceEagerHydrationData=[b,M]:x.mutableSourceEagerHydrationData.push(b,M)},r.runWithPriority=function(x,b){var M=Sr;try{return Sr=x,b()}finally{Sr=M}},r.shouldError=function(){return null},r.shouldSuspend=function(){return!1},r.updateContainer=function(x,b,M,z){var K=b.current,ee=gn(),he=_i(K);return M=ap(M),b.context===null?b.context=M:b.pendingContext=M,b=Qa(ee,he),b.payload={element:x},z=z===void 0?null:z,z!==null&&(b.callback=z),x=ao(K,b,he),x!==null&&(ua(x,K,he,ee),ul(x,K,he)),he},r}),L2}var h4;function aV(){return h4||(h4=1,R2.exports=iV()),R2.exports}var sV=aV();const oV=Tf(sV);var O2={exports:{}},bd={};var f4;function lV(){return f4||(f4=1,bd.ConcurrentRoot=1,bd.ContinuousEventPriority=4,bd.DefaultEventPriority=16,bd.DiscreteEventPriority=1,bd.IdleEventPriority=536870912,bd.LegacyRoot=0),bd}var p4;function uV(){return p4||(p4=1,O2.exports=lV()),O2.exports}var NR=uV(),cV=Tr();const m4={children:!0,ref:!0,key:!0,style:!0,forwardedRef:!0,unstable_applyCache:!0,unstable_applyDrawHitFromCache:!0};let g4=!1,v4=!1;const C_=".react-konva-event",dV=`ReactKonva: You have a Konva node with draggable = true and position defined but no onDragMove or onDragEnd events are handled.
Position of a node will be changed during drag&drop, so you should update state of the react app as well.
Consider to add onDragMove or onDragEnd events.
For more info see: https://github.com/konvajs/react-konva/issues/256
`,hV=`ReactKonva: You are using "zIndex" attribute for a Konva node.
react-konva may get confused with ordering. Just define correct order of elements in your render function of a component.
For more info see: https://github.com/konvajs/react-konva/issues/194
`,fV={};function z1(t,e,r=fV){if(!g4&&"zIndex"in e&&(console.warn(hV),g4=!0),!v4&&e.draggable){var n=e.x!==void 0||e.y!==void 0,i=e.onDragEnd||e.onDragMove;n&&!i&&(console.warn(dV),v4=!0)}for(var a in r)if(!m4[a]){var s=a.slice(0,2)==="on",o=r[a]!==e[a];if(s&&o){var l=a.substr(2).toLowerCase();l.substr(0,7)==="content"&&(l="content"+l.substr(7,1).toUpperCase()+l.substr(8)),t.off(l,r[a])}var u=!e.hasOwnProperty(a);u&&t.setAttr(a,void 0)}var c=e._useStrictMode,h={},p=!1;const v={};for(var a in e)if(!m4[a]){var s=a.slice(0,2)==="on",y=r[a]!==e[a];if(s&&y){var l=a.substr(2).toLowerCase();l.substr(0,7)==="content"&&(l="content"+l.substr(7,1).toUpperCase()+l.substr(8)),e[a]&&(v[l]=e[a])}!s&&(e[a]!==r[a]||c&&e[a]!==t.getAttr(a))&&(p=!0,h[a]=e[a])}p&&(t.setAttrs(h),ch(t));for(var l in v)t.on(l+C_,v[l])}function ch(t){if(!cV.Konva.autoDrawEnabled){var e=t.getLayer()||t.getStage();e&&e.batchDraw()}}var D2=Wk();const PR={},pV={};Nv.Node.prototype._applyProps=z1;function mV(t,e){if(typeof e=="string"){console.error(`Do not use plain text as child of Konva.Node. You are using text: ${e}`);return}t.add(e),ch(t)}function gV(t,e,r){let n=Nv[t];n||(console.error(`Konva has no node with the type ${t}. Group will be used instead. If you use minimal version of react-konva, just import required nodes into Konva: "import "konva/lib/shapes/${t}"  If you want to render DOM elements as part of canvas tree take a look into this demo: https://konvajs.github.io/docs/react/DOM_Portal.html`),n=Nv.Group);const i={},a={};for(var s in e){var o=s.slice(0,2)==="on";o?a[s]=e[s]:i[s]=e[s]}const l=new n(i);return z1(l,a),l}function vV(t,e,r){console.error(`Text components are not supported for now in ReactKonva. Your text is: "${t}"`)}function yV(t,e,r){return!1}function xV(t){return t}function bV(){return null}function wV(){return null}function SV(t,e,r,n){return pV}function kV(){}function _V(t){}function CV(t,e){return!1}function EV(){return PR}function TV(){return PR}const NV=setTimeout,PV=clearTimeout,MV=-1;function AV(t,e){return!1}const RV=!1,LV=!0,OV=!0;function DV(t,e){e.parent===t?e.moveToTop():t.add(e),ch(t)}function IV(t,e){e.parent===t?e.moveToTop():t.add(e),ch(t)}function MR(t,e,r){e._remove(),t.add(e),e.setZIndex(r.getZIndex()),ch(t)}function jV(t,e,r){MR(t,e,r)}function FV(t,e){e.destroy(),e.off(C_),ch(t)}function BV(t,e){e.destroy(),e.off(C_),ch(t)}function zV(t,e,r){console.error(`Text components are not yet supported in ReactKonva. You text is: "${r}"`)}function UV(t,e,r){}function GV(t,e,r,n,i){z1(t,i,n)}function VV(t){t.hide(),ch(t)}function HV(t){}function WV(t,e){(e.visible==null||e.visible)&&t.show()}function qV(t,e){}function $V(t){}function KV(){}const ZV=()=>NR.DefaultEventPriority,YV=Object.freeze(Object.defineProperty({__proto__:null,appendChild:DV,appendChildToContainer:IV,appendInitialChild:mV,cancelTimeout:PV,clearContainer:$V,commitMount:UV,commitTextUpdate:zV,commitUpdate:GV,createInstance:gV,createTextInstance:vV,detachDeletedInstance:KV,finalizeInitialChildren:yV,getChildHostContext:TV,getCurrentEventPriority:ZV,getPublicInstance:xV,getRootHostContext:EV,hideInstance:VV,hideTextInstance:HV,idlePriority:D2.unstable_IdlePriority,insertBefore:MR,insertInContainerBefore:jV,isPrimaryRenderer:RV,noTimeout:MV,now:D2.unstable_now,prepareForCommit:bV,preparePortalMount:wV,prepareUpdate:SV,removeChild:FV,removeChildFromContainer:BV,resetAfterCommit:kV,resetTextContent:_V,run:D2.unstable_runWithPriority,scheduleTimeout:NV,shouldDeprioritizeSubtree:CV,shouldSetTextContent:AV,supportsMutation:OV,unhideInstance:WV,unhideTextInstance:qV,warnsIfNotActing:LV},Symbol.toStringTag,{value:"Module"}));var XV=Object.defineProperty,QV=Object.defineProperties,JV=Object.getOwnPropertyDescriptors,y4=Object.getOwnPropertySymbols,eH=Object.prototype.hasOwnProperty,tH=Object.prototype.propertyIsEnumerable,x4=(t,e,r)=>e in t?XV(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,b4=(t,e)=>{for(var r in e||(e={}))eH.call(e,r)&&x4(t,r,e[r]);if(y4)for(var r of y4(e))tH.call(e,r)&&x4(t,r,e[r]);return t},rH=(t,e)=>QV(t,JV(e)),w4,S4;typeof window<"u"&&((w4=window.document)!=null&&w4.createElement||((S4=window.navigator)==null?void 0:S4.product)==="ReactNative")?ie.useLayoutEffect:ie.useEffect;function AR(t,e,r){if(!t)return;if(r(t)===!0)return t;let n=t.child;for(;n;){const i=AR(n,e,r);if(i)return i;n=n.sibling}}function RR(t){try{return Object.defineProperties(t,{_currentRenderer:{get(){return null},set(){}},_currentRenderer2:{get(){return null},set(){}}})}catch{return t}}const k4=console.error;console.error=function(){const t=[...arguments].join("");if(t?.startsWith("Warning:")&&t.includes("useContext")){console.error=k4;return}return k4.apply(this,arguments)};const E_=RR(ie.createContext(null));class LR extends ie.Component{render(){return ie.createElement(E_.Provider,{value:this._reactInternals},this.props.children)}}function nH(){const t=ie.useContext(E_);if(t===null)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const e=ie.useId();return ie.useMemo(()=>{for(const n of[t,t?.alternate]){if(!n)continue;const i=AR(n,!1,a=>{let s=a.memoizedState;for(;s;){if(s.memoizedState===e)return!0;s=s.next}});if(i)return i}},[t,e])}function iH(){const t=nH(),[e]=ie.useState(()=>new Map);e.clear();let r=t;for(;r;){if(r.type&&typeof r.type=="object"){const i=r.type._context===void 0&&r.type.Provider===r.type?r.type:r.type._context;i&&i!==E_&&!e.has(i)&&e.set(i,ie.useContext(RR(i)))}r=r.return}return e}function aH(){const t=iH();return ie.useMemo(()=>Array.from(t.keys()).reduce((e,r)=>n=>ie.createElement(e,null,ie.createElement(r.Provider,rH(b4({},n),{value:t.get(r)}))),e=>ie.createElement(LR,b4({},e))),[t])}function sH(t){const e=nr.useRef({});return nr.useLayoutEffect(()=>{e.current=t}),nr.useLayoutEffect(()=>()=>{e.current={}},[]),e.current}const oH=t=>{const e=nr.useRef(),r=nr.useRef(),n=nr.useRef(),i=sH(t),a=aH(),s=o=>{const{forwardedRef:l}=t;l&&(typeof l=="function"?l(o):l.current=o)};return nr.useLayoutEffect(()=>(r.current=new Nv.Stage({width:t.width,height:t.height,container:e.current}),s(r.current),n.current=$g.createContainer(r.current,NR.LegacyRoot,!1,null),$g.updateContainer(nr.createElement(a,{},t.children),n.current),()=>{Nv.isBrowser&&(s(null),$g.updateContainer(null,n.current,null),r.current.destroy())}),[]),nr.useLayoutEffect(()=>{s(r.current),z1(r.current,t,i),$g.updateContainer(nr.createElement(a,{},t.children),n.current,null)}),nr.createElement("div",{ref:e,id:t.id,accessKey:t.accessKey,className:t.className,role:t.role,style:t.style,tabIndex:t.tabIndex,title:t.title})},vx="Layer",yx="Rect",lH="Circle",OR="Line",uH="Image",cH="Text",dH="Path",DR="Transformer",$g=oV(YV);$g.injectIntoDevTools({findHostInstanceByFiber:()=>null,bundleType:0,version:nr.version,rendererPackageName:"react-konva"});const IR=nr.forwardRef((t,e)=>nr.createElement(LR,{},nr.createElement(oH,{...t,forwardedRef:e}))),hH=({isOpen:t,onClose:e,onConfirm:r,title:n,message:i,initialValue:a="",placeholder:s="",confirmText:o="Confirmar",cancelText:l="Cancelar"})=>{const[u,c]=ie.useState(a),h=ie.useRef(null);if(ie.useEffect(()=>{c(a)},[a,t]),ie.useEffect(()=>{t&&h.current&&setTimeout(()=>h.current.focus(),50)},[t]),!t)return null;const p=v=>{v.preventDefault(),r(u),e()};return Il.createPortal(m.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/80 backdrop-blur-md animate-in fade-in duration-300",children:m.jsxs("div",{className:"bg-[#0f0f13] border border-white/10 rounded-2xl p-6 shadow-2xl shadow-black/50 w-full max-w-md space-y-5 animate-in zoom-in-95 slide-in-from-bottom-2 duration-300 relative overflow-hidden ring-1 ring-white/5",onClick:v=>v.stopPropagation(),children:[m.jsx("div",{className:"absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-primary to-transparent opacity-70"}),m.jsx("div",{className:"absolute -top-10 -right-10 size-40 bg-primary/5 rounded-full blur-3xl pointer-events-none"}),m.jsxs("div",{children:[m.jsx("h3",{className:"text-xl font-bold text-white tracking-tight",children:n}),i&&m.jsx("p",{className:"text-sm text-slate-400 leading-relaxed mt-2",children:i})]}),m.jsxs("form",{onSubmit:p,className:"space-y-6",children:[m.jsx("input",{ref:h,type:"text",value:u,onChange:v=>c(v.target.value),placeholder:s,className:"w-full bg-black/30 border border-white/10 rounded-xl px-4 py-3.5 text-white placeholder-slate-600 focus:border-primary/50 focus:ring-1 focus:ring-primary/50 outline-none transition-all font-sans text-sm shadow-inner"}),m.jsxs("div",{className:"flex justify-end gap-3 pt-2",children:[m.jsx("button",{type:"button",onClick:e,className:"px-4 py-2 text-sm text-slate-400 hover:text-white transition-colors",children:l}),m.jsx(Yn,{type:"submit",variant:"primary",disabled:!u.trim(),children:o})]})]})]})}),document.body)},I2=({stepNumber:t,title:e,isOpen:r,onClick:n,children:i})=>m.jsxs("div",{className:`border border-white/10 rounded-2xl bg-[#13141f] overflow-hidden transition-all duration-300 ${r?"ring-1 ring-primary/50":"opacity-80"}`,children:[m.jsxs("button",{onClick:n,className:"w-full flex items-center justify-between p-6 hover:bg-white/5 transition-colors",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("div",{className:`size-8 rounded-full flex items-center justify-center font-black text-sm ${r?"bg-primary text-white":"bg-white/10 text-slate-400"}`,children:t}),m.jsx("h3",{className:`text-lg font-bold ${r?"text-white":"text-slate-400"}`,children:e})]}),m.jsx("span",{className:`material-symbols-outlined transition-transform duration-300 ${r?"rotate-180 text-primary":"text-slate-500"}`,children:"expand_more"})]}),r&&m.jsx("div",{className:"p-6 pt-0 border-t border-white/5 animate-in fade-in slide-in-from-top-2",children:i})]}),j2=({icon:t,title:e,desc:r,selected:n,onClick:i})=>m.jsxs("div",{onClick:i,className:`p-6 rounded-xl border cursor-pointer transition-all relative group h-full flex flex-col justify-between ${n?"bg-primary/20 border-primary shadow-[0_0_30px_rgba(var(--color-primary),0.3)]":"bg-[#0a0a0c] border-white/10 hover:border-white/30"}`,children:[m.jsxs("div",{className:"mb-4",children:[m.jsx("div",{className:`size-12 rounded-lg flex items-center justify-center mb-4 ${n?"bg-primary text-white":"bg-white/10 text-slate-400 group-hover:text-white group-hover:bg-white/20"}`,children:m.jsx("span",{className:"material-symbols-outlined text-2xl",children:t})}),m.jsx("h4",{className:"font-bold text-white mb-1",children:e}),m.jsx("p",{className:"text-xs text-slate-500 leading-relaxed",children:r})]}),n&&m.jsx("div",{className:"absolute top-4 right-4 size-3 bg-primary rounded-full shadow-glow"})]}),fH=({src:t,x:e,y:r,width:n,height:i,...a})=>{const[s,o]=ie.useState(null);return ie.useEffect(()=>{if(!t)return;const l=new window.Image;l.src=t,l.crossOrigin="Anonymous",l.onload=()=>{o(l)}},[t]),m.jsx(uH,{image:s,x:e,y:r,width:n,height:i,...a})},pH=({selectedId:t})=>{const e=nr.useRef();return nr.useEffect(()=>{if(t){const r=e.current.getStage().findOne("#"+t);r&&(e.current.nodes([r]),e.current.getLayer().batchDraw())}else e.current.nodes([])},[t]),m.jsx(DR,{ref:e})},ek=({mode:t})=>{const{username:e,projectName:r,folderId:n,entityId:i}=Zi(),a=Wa(),s=Nf(),{setRightOpen:o,setRightPanelMode:l,setAvailableTemplates:u,mapSettings:c,setMapSettings:h,setOnMapSettingsChange:p}=jl(),[v,y]=ie.useState(t==="create"?"setup":"editor");ie.useEffect(()=>{y(t==="create"?"setup":"editor")},[t]);const[S,w]=ie.useState(s.state?.folderId||null),[T,_]=ie.useState(1),[C,N]=ie.useState({name:"New Map",description:"",parentZone:null,type:"regional",sourceType:"blank",dims:{width:800,height:600},bgImage:null}),[A,I]=ie.useState(!1),[j,O]=ie.useState("brush"),[F,B]=ie.useState([]),[$,Z]=ie.useState([]),[D,H]=ie.useState([]),[U,W]=ie.useState(null),Y=nr.useRef(!1),[Q,ne]=ie.useState({isOpen:!1,id:null,text:""}),re=le=>{(le.target===le.target.getStage()||le.target.name()==="bg-image")&&W(null)},q=le=>{re(le);const me=le.target.getStage().getPointerPosition();j!=="select"&&(Y.current=!0,j==="brush"||j==="eraser"?B([...F,{id:`line-${Date.now()}`,tool:j,points:[me.x,me.y],color:j==="eraser"?"#ffffff":"#df4b26",size:j==="eraser"?20:5}]):j==="rect"?Z([...$,{id:`rect-${Date.now()}`,x:me.x,y:me.y,width:0,height:0,color:"#df4b26"}]):j==="text"&&(H([...D,{id:`text-${Date.now()}`,x:me.x,y:me.y,text:"Double click to edit",fontSize:20,color:"#ffffff"}]),Y.current=!1))},te=le=>{if(!Y.current)return;const me=le.target.getStage().getPointerPosition();j==="brush"||j==="eraser"?B(xe=>{const Se=[...xe],Ve={...Se[Se.length-1]};return Ve.points=Ve.points.concat([me.x,me.y]),Se[Se.length-1]=Ve,Se}):j==="rect"&&Z(xe=>{const Se=[...xe],Ve={...Se[Se.length-1]};return Ve.width=me.x-Ve.x,Ve.height=me.y-Ve.y,Se[Se.length-1]=Ve,Se})},ae=()=>{Y.current=!1};ie.useEffect(()=>{if(o(v==="editor"),v==="editor"){l("MAP");const le={showGrid:!0,gridSize:50,width:C.dims.width,height:C.dims.height};h(le),p(pe=>{pe&&N(me=>({...me,dims:{width:pe.width,height:pe.height},bgImage:pe.bgImage||me.bgImage}))})}},[v]),ie.useEffect(()=>{t==="create"&&!S&&n&&(console.log("Resolving folder ID for slug:",n),et.get(`/world-bible/folders/${n}`).then(le=>w(le.id)).catch(le=>console.error("Could not resolve folder ID",le)))},[t,n,S]);const de=le=>{const pe=le.target.files[0];if(pe){const me=new FileReader;me.onload=xe=>{const Se=new Image;Se.onload=()=>{N(Ve=>({...Ve,bgImage:xe.target.result,dims:{width:Se.width,height:Se.height},sourceType:"upload"}))},Se.src=xe.target.result},me.readAsDataURL(pe)}},ge=nr.useRef(null),ye=async()=>{if(!S){alert("Folder context missing. Please start from the folder view again.");return}I(!0);try{let le=C.bgImage;if(ge.current){const xe=ge.current.findOne("Transformer");if(xe&&xe.nodes([]),le=ge.current.toDataURL({pixelRatio:.5}),xe&&U){const Se=ge.current.findOne("#"+U);Se&&xe.nodes([Se])}}const pe={nombre:C.name,tipoEspecial:"map",carpetaId:S,descripcion:C.description,attributes:{type:C.type,width:C.dims.width,height:C.dims.height,bgImage:C.bgImage,layers:{lines:F,rectangles:$,texts:D},snapshotUrl:le},iconUrl:le},me=await et.post("/world-bible/entities",pe);window.dispatchEvent(new CustomEvent("folder-update",{detail:{folderId:S}})),a(`/${e}/${r}/map-editor/edit/${me.id}`,{replace:!0})}catch(le){console.error(le),alert("Error creating map. Check console.")}finally{I(!1)}},se=nr.useRef(null);ie.useEffect(()=>{(!t||t==="edit")&&i&&et.get(`/world-bible/entities/${i}`).then(le=>{w(le.carpetaId),se.current=le.iconUrl,y("editor");let pe=le.attributes||{},me={};const xe=pe.layers||pe.bgImage;if(!xe&&le.descripcion&&le.descripcion.trim().startsWith("{"))try{me=JSON.parse(le.descripcion)}catch($e){console.error("Error parsing legacy map data",$e)}const Se=xe?pe:me;let Ve=le.descripcion;le.descripcion&&le.descripcion.trim().startsWith("{")&&(Ve=me.description||""),N({name:le.nombre,description:Ve||"",parentZone:null,type:Se.type||"regional",sourceType:Se.bgImage?"upload":"blank",dims:{width:Se.width||800,height:Se.height||600},bgImage:Se.bgImage}),Se.layers&&(B(Se.layers.lines||[]),Z(Se.layers.rectangles||[]),H(Se.layers.texts||[])),h({name:le.nombre,description:Ve||"",type:Se.type||"regional",showGrid:!0,gridSize:50,width:Se.width||800,height:Se.height||600,bgImage:Se.bgImage})}).catch(le=>console.error("Error loading entity",le))},[t,i]);const fe=async()=>{I(!0);try{let le=C.bgImage;if(ge.current){W(null);const me=ge.current.findOne("Transformer");me&&me.nodes([]),le=ge.current.toDataURL({pixelRatio:.5})}const pe={id:i,nombre:C.name,tipoEspecial:"map",carpetaId:S,descripcion:C.description,attributes:{type:C.type,width:C.dims.width,height:C.dims.height,bgImage:C.bgImage,layers:{lines:F,rectangles:$,texts:D},snapshotUrl:le},iconUrl:se.current};await et.put(`/world-bible/entities/${i}`,pe),a(S?`/${e}/${r}/bible/folder/${S}`:`/${e}/${r}/bible`)}catch(le){console.error("Save failed",le),alert("Error saving map")}finally{I(!1)}};return v==="setup"?m.jsxs("div",{className:"flex-1 flex flex-col h-screen bg-[#060608] text-white",children:[m.jsxs("div",{className:"h-16 border-b border-white/5 flex items-center justify-between px-8 bg-[#0a0a0c]",children:[m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsx("div",{className:"p-2 bg-primary/20 rounded-lg text-primary",children:m.jsx("span",{className:"material-symbols-outlined",children:"add_circle"})}),m.jsxs("div",{children:[m.jsx("h1",{className:"text-lg font-bold leading-tight",children:"Create New Map / Zone"}),m.jsx("p",{className:"text-[10px] text-slate-500 uppercase font-bold tracking-wider",children:"Configure details for your new cartography entry"})]})]}),m.jsx("button",{onClick:()=>a(-1),className:"p-2 hover:bg-white/5 rounded-full text-slate-500 hover:text-white transition-colors",children:m.jsx("span",{className:"material-symbols-outlined",children:"close"})})]}),m.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-8",children:m.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[m.jsx(I2,{stepNumber:"1",title:"Identity & Hierarchy",isOpen:T===1,onClick:()=>_(1),children:m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{children:[m.jsx("label",{className:"text-[10px] uppercase font-bold text-slate-500 mb-2 block",children:"Map Name"}),m.jsx("input",{autoFocus:!0,value:C.name,onChange:le=>N({...C,name:le.target.value}),className:"w-full bg-[#0a0a0c] border border-white/10 rounded-xl p-4 text-white focus:border-primary outline-none transition-colors",placeholder:"e.g. The Sapphire Coast"})]}),m.jsxs("div",{children:[m.jsx("label",{className:"text-[10px] uppercase font-bold text-slate-500 mb-2 block",children:"Parent Zone (Optional)"}),m.jsxs("div",{className:"w-full bg-[#0a0a0c] border border-white/10 rounded-xl p-4 text-slate-400 flex items-center justify-between cursor-pointer hover:border-white/20",children:[m.jsx("span",{children:"Current Folder (Default)"}),m.jsx("span",{className:"material-symbols-outlined text-sm",children:"expand_more"})]}),m.jsx("p",{className:"text-[10px] text-slate-600 mt-2",children:"Selecting a parent makes this a sub-zone."})]})]}),m.jsxs("div",{children:[m.jsx("label",{className:"text-[10px] uppercase font-bold text-slate-500 mb-2 block",children:"Description"}),m.jsx("textarea",{value:C.description,onChange:le=>N({...C,description:le.target.value}),className:"w-full h-40 bg-[#0a0a0c] border border-white/10 rounded-xl p-4 text-white resize-none focus:border-primary outline-none transition-colors leading-relaxed",placeholder:"Brief description of geography, climate, or importance..."})]})]})}),m.jsx(I2,{stepNumber:"2",title:"Map Type",isOpen:T===2,onClick:()=>_(2),children:m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[m.jsx(j2,{icon:"public",title:"World Map",desc:"Continents, oceans, global scale.",selected:C.type==="world",onClick:()=>N({...C,type:"world"})}),m.jsx(j2,{icon:"map",title:"Regional Map",desc:"Kingdoms, provinces, biomes.",selected:C.type==="regional",onClick:()=>N({...C,type:"regional"})}),m.jsx(j2,{icon:"location_city",title:"City / Local",desc:"Cities, dungeons, battlemaps.",selected:C.type==="local",onClick:()=>N({...C,type:"local"})})]})}),m.jsx(I2,{stepNumber:"3",title:"Canvas Source",isOpen:T===3,onClick:()=>_(3),children:m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[m.jsxs("div",{onClick:()=>document.getElementById("map-upload-input").click(),className:`relative p-8 rounded-xl border-2 border-dashed flex flex-col items-center justify-center text-center cursor-pointer transition-all group min-h-[200px] ${C.sourceType==="upload"?"border-primary bg-primary/5":"border-white/10 hover:border-white/30 bg-[#0a0a0c]"}`,children:[m.jsx("input",{id:"map-upload-input",type:"file",accept:"image/*",className:"hidden",onChange:de}),C.bgImage?m.jsx("img",{src:C.bgImage,alt:"Preview",className:"absolute inset-0 w-full h-full object-cover rounded-xl opacity-50 group-hover:opacity-70"}):m.jsxs(m.Fragment,{children:[m.jsx("div",{className:"size-16 bg-white/5 rounded-full flex items-center justify-center mb-4 group-hover:scale-110 transition-transform",children:m.jsx("span",{className:"material-symbols-outlined text-3xl text-slate-400",children:"cloud_upload"})}),m.jsx("h4",{className:"font-bold text-white",children:"Upload Image File"}),m.jsx("p",{className:"text-xs text-slate-500 mt-2",children:"Drag & drop or click to browse"}),m.jsx("p",{className:"text-[10px] text-slate-600 mt-1 uppercase font-bold",children:"JPG, PNG, WEBP  Max 20MB"})]}),C.sourceType==="upload"&&m.jsx("div",{className:"absolute top-4 right-4 size-3 bg-primary rounded-full shadow-glow z-10"})]}),m.jsxs("div",{onClick:()=>N({...C,sourceType:"blank",bgImage:null}),className:`p-8 rounded-xl border flex flex-col items-center justify-center text-center cursor-pointer transition-all min-h-[200px] ${C.sourceType==="blank"?"border-primary bg-primary/5":"border-white/10 hover:border-white/30 bg-[#0a0a0c]"}`,children:[m.jsx("div",{className:"size-16 bg-white/5 rounded-full flex items-center justify-center mb-4",children:m.jsx("span",{className:"material-symbols-outlined text-3xl text-slate-400",children:"check_box_outline_blank"})}),m.jsx("h4",{className:"font-bold text-white",children:"Blank Canvas"}),m.jsx("p",{className:"text-xs text-slate-500 mt-2",children:"Start a new drawing from scratch"}),C.sourceType==="blank"&&m.jsxs("div",{className:"mt-6 flex items-center gap-2 bg-black/50 p-1 rounded-lg border border-white/10",children:[m.jsx("span",{className:"text-[10px] uppercase font-bold text-slate-500 px-2",children:"Size"}),m.jsx("span",{className:"text-xs font-mono text-white",children:"4096 px"}),m.jsx("span",{className:"text-xs text-slate-500",children:"x"}),m.jsx("span",{className:"text-xs font-mono text-white",children:"4096 px"})]})]})]})})]})}),m.jsxs("div",{className:"h-20 border-t border-white/5 bg-[#0a0a0c] flex items-center justify-between px-8 z-20",children:[m.jsx("button",{onClick:()=>a(-1),className:"text-sm font-bold text-slate-500 hover:text-white transition-colors",children:"Cancel"}),m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("span",{className:"text-xs text-slate-600 italic",children:"Changes saved locally"}),m.jsx(Yn,{variant:"primary",size:"lg",icon:"check",onClick:ye,disabled:!C.name||A,className:"bg-primary hover:bg-primary-light text-white shadow-lg shadow-primary/25 px-8",children:A?"Creating...":"Create Map"})]})]})]}):m.jsxs("div",{className:"flex flex-col h-screen w-full bg-[#0f0f13] text-white overflow-hidden",children:[m.jsxs("header",{className:"h-14 border-b border-white/5 flex items-center justify-between px-4 bg-[#1a1a20] shrink-0",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("button",{onClick:()=>a(-1),className:"p-2 hover:bg-white/5 rounded-full",title:"Back to Collection",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"arrow_back"})}),m.jsxs("div",{className:"flex flex-col",children:[m.jsx("input",{value:C.name,onChange:le=>N({...C,name:le.target.value}),className:"bg-transparent font-bold text-sm outline-none focus:bg-white/5 rounded px-2 -ml-2"}),m.jsxs("span",{className:"text-[10px] text-text-muted px-2",children:[C.dims.width," x ",C.dims.height,"  ",c?.gridSize||50,"px Grid"]})]})]}),m.jsx("div",{className:"flex items-center gap-2",children:m.jsx(Yn,{variant:"primary",size:"sm",icon:"save",onClick:fe,disabled:A,children:A?"Saving...":"Save Changes"})})]}),m.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[m.jsx("div",{className:"w-14 bg-[#1a1a20] border-r border-white/5 flex flex-col items-center py-4 gap-4 z-10",children:[{id:"select",icon:"near_me"},{id:"brush",icon:"brush"},{id:"eraser",icon:"ink_eraser"},{id:"rect",icon:"check_box_outline_blank"},{id:"text",icon:"title"}].map(le=>m.jsx("button",{onClick:()=>O(le.id),className:`p-2 rounded-lg transition-colors ${j===le.id?"bg-primary text-white shadow-lg shadow-primary/30":"hover:bg-white/5 text-slate-400 hover:text-white"}`,children:m.jsx("span",{className:"material-symbols-outlined",children:le.icon})},le.id))}),m.jsx("div",{className:"flex-1 overflow-auto bg-[#0f0f13] relative flex items-center justify-center p-8 custom-scrollbar",children:m.jsx("div",{className:"bg-[#1a1a20] shadow-[0_0_50px_rgba(0,0,0,0.5)] flex-none",children:m.jsxs(IR,{ref:ge,width:C.dims.width,height:C.dims.height,onMouseDown:q,onMouseMove:te,onMouseUp:ae,className:"bg-white",children:[m.jsxs(vx,{children:[C.bgImage&&m.jsx(fH,{name:"bg-image",src:C.bgImage,x:0,y:0,width:C.dims.width,height:C.dims.height,onMouseDown:q,onTouchStart:q}),c?.showGrid&&m.jsx(yx,{width:C.dims.width,height:C.dims.height,fillPatternImage:(()=>{const le=document.createElement("canvas");le.width=c.gridSize||50,le.height=c.gridSize||50;const pe=le.getContext("2d");return pe.strokeStyle="rgba(0,0,0,0.2)",pe.lineWidth=1,pe.strokeRect(0,0,le.width,le.height),le})(),listening:!1})]}),m.jsxs(vx,{children:[F.map((le,pe)=>m.jsx(OR,{points:le.points,stroke:le.color,strokeWidth:le.size,tension:.5,lineCap:"round",lineJoin:"round",globalCompositeOperation:le.tool==="eraser"?"destination-out":"source-over"},pe)),$.map((le,pe)=>m.jsx(yx,{id:le.id,x:le.x,y:le.y,width:le.width,height:le.height,stroke:le.color,strokeWidth:2,draggable:j==="select",onClick:()=>j==="select"&&W(le.id),onTap:()=>j==="select"&&W(le.id)},le.id)),D.map((le,pe)=>m.jsx(cH,{id:le.id,x:le.x,y:le.y,text:le.text,fontSize:le.fontSize,fill:le.color,draggable:j==="select",onClick:()=>j==="select"&&W(le.id),onTap:()=>j==="select"&&W(le.id),onDblClick:me=>{ne({isOpen:!0,id:le.id,text:le.text})}},le.id)),m.jsx(pH,{selectedId:U})]})]})})})]}),m.jsx(hH,{isOpen:Q.isOpen,onClose:()=>ne(le=>({...le,isOpen:!1})),title:"Edit Map Text",initialValue:Q.text,onConfirm:le=>{H(pe=>pe.map(me=>me.id===Q.id?{...me,text:le}:me))},confirmText:"Save Text"})]})};function jR(t,e){const r=ie.useRef(e);ie.useEffect(function(){e!==r.current&&t.attributionControl!=null&&(r.current!=null&&t.attributionControl.removeAttribution(r.current),e!=null&&t.attributionControl.addAttribution(e)),r.current=e},[t,e])}const mH=1;function gH(t){return Object.freeze({__version:mH,map:t})}function FR(t,e){return Object.freeze({...t,...e})}const BR=ie.createContext(null),zR=BR.Provider;function T_(){const t=ie.useContext(BR);if(t==null)throw new Error("No context provided: useLeafletContext() can only be used in a descendant of <MapContainer>");return t}function vH(t){function e(r,n){const{instance:i,context:a}=t(r).current;return ie.useImperativeHandle(n,()=>i),r.children==null?null:nr.createElement(zR,{value:a},r.children)}return ie.forwardRef(e)}function yH(t){function e(r,n){const[i,a]=ie.useState(!1),{instance:s}=t(r,a).current;ie.useImperativeHandle(n,()=>s),ie.useEffect(function(){i&&s.update()},[s,i,r.children]);const o=s._contentNode;return o?Il.createPortal(r.children,o):null}return ie.forwardRef(e)}function UR(t,e){const r=ie.useRef();ie.useEffect(function(){return e!=null&&t.instance.on(e),r.current=e,function(){r.current!=null&&t.instance.off(r.current),r.current=null}},[t,e])}function GR(t,e){const r=t.pane??e.pane;return r?{...t,pane:r}:t}function xH(t,e){return function(n,i){const a=T_(),s=t(GR(n,a),a);return jR(a.map,n.attribution),UR(s.current,n.eventHandlers),e(s.current,a,n,i),s}}var Kg={exports:{}};var bH=Kg.exports,_4;function wH(){return _4||(_4=1,(function(t,e){(function(r,n){n(e)})(bH,(function(r){var n="1.9.4";function i(f){var k,P,G,J;for(P=1,G=arguments.length;P<G;P++){J=arguments[P];for(k in J)f[k]=J[k]}return f}var a=Object.create||(function(){function f(){}return function(k){return f.prototype=k,new f}})();function s(f,k){var P=Array.prototype.slice;if(f.bind)return f.bind.apply(f,P.call(arguments,1));var G=P.call(arguments,2);return function(){return f.apply(k,G.length?G.concat(P.call(arguments)):arguments)}}var o=0;function l(f){return"_leaflet_id"in f||(f._leaflet_id=++o),f._leaflet_id}function u(f,k,P){var G,J,ue,we;return we=function(){G=!1,J&&(ue.apply(P,J),J=!1)},ue=function(){G?J=arguments:(f.apply(P,arguments),setTimeout(we,k),G=!0)},ue}function c(f,k,P){var G=k[1],J=k[0],ue=G-J;return f===G&&P?f:((f-J)%ue+ue)%ue+J}function h(){return!1}function p(f,k){if(k===!1)return f;var P=Math.pow(10,k===void 0?6:k);return Math.round(f*P)/P}function v(f){return f.trim?f.trim():f.replace(/^\s+|\s+$/g,"")}function y(f){return v(f).split(/\s+/)}function S(f,k){Object.prototype.hasOwnProperty.call(f,"options")||(f.options=f.options?a(f.options):{});for(var P in k)f.options[P]=k[P];return f.options}function w(f,k,P){var G=[];for(var J in f)G.push(encodeURIComponent(P?J.toUpperCase():J)+"="+encodeURIComponent(f[J]));return(!k||k.indexOf("?")===-1?"?":"&")+G.join("&")}var T=/\{ *([\w_ -]+) *\}/g;function _(f,k){return f.replace(T,function(P,G){var J=k[G];if(J===void 0)throw new Error("No value provided for variable "+P);return typeof J=="function"&&(J=J(k)),J})}var C=Array.isArray||function(f){return Object.prototype.toString.call(f)==="[object Array]"};function N(f,k){for(var P=0;P<f.length;P++)if(f[P]===k)return P;return-1}var A="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function I(f){return window["webkit"+f]||window["moz"+f]||window["ms"+f]}var j=0;function O(f){var k=+new Date,P=Math.max(0,16-(k-j));return j=k+P,window.setTimeout(f,P)}var F=window.requestAnimationFrame||I("RequestAnimationFrame")||O,B=window.cancelAnimationFrame||I("CancelAnimationFrame")||I("CancelRequestAnimationFrame")||function(f){window.clearTimeout(f)};function $(f,k,P){if(P&&F===O)f.call(k);else return F.call(window,s(f,k))}function Z(f){f&&B.call(window,f)}var D={__proto__:null,extend:i,create:a,bind:s,get lastId(){return o},stamp:l,throttle:u,wrapNum:c,falseFn:h,formatNum:p,trim:v,splitWords:y,setOptions:S,getParamString:w,template:_,isArray:C,indexOf:N,emptyImageUrl:A,requestFn:F,cancelFn:B,requestAnimFrame:$,cancelAnimFrame:Z};function H(){}H.extend=function(f){var k=function(){S(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},P=k.__super__=this.prototype,G=a(P);G.constructor=k,k.prototype=G;for(var J in this)Object.prototype.hasOwnProperty.call(this,J)&&J!=="prototype"&&J!=="__super__"&&(k[J]=this[J]);return f.statics&&i(k,f.statics),f.includes&&(U(f.includes),i.apply(null,[G].concat(f.includes))),i(G,f),delete G.statics,delete G.includes,G.options&&(G.options=P.options?a(P.options):{},i(G.options,f.options)),G._initHooks=[],G.callInitHooks=function(){if(!this._initHooksCalled){P.callInitHooks&&P.callInitHooks.call(this),this._initHooksCalled=!0;for(var ue=0,we=G._initHooks.length;ue<we;ue++)G._initHooks[ue].call(this)}},k},H.include=function(f){var k=this.prototype.options;return i(this.prototype,f),f.options&&(this.prototype.options=k,this.mergeOptions(f.options)),this},H.mergeOptions=function(f){return i(this.prototype.options,f),this},H.addInitHook=function(f){var k=Array.prototype.slice.call(arguments,1),P=typeof f=="function"?f:function(){this[f].apply(this,k)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(P),this};function U(f){if(!(typeof L>"u"||!L||!L.Mixin)){f=C(f)?f:[f];for(var k=0;k<f.length;k++)f[k]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",new Error().stack)}}var W={on:function(f,k,P){if(typeof f=="object")for(var G in f)this._on(G,f[G],k);else{f=y(f);for(var J=0,ue=f.length;J<ue;J++)this._on(f[J],k,P)}return this},off:function(f,k,P){if(!arguments.length)delete this._events;else if(typeof f=="object")for(var G in f)this._off(G,f[G],k);else{f=y(f);for(var J=arguments.length===1,ue=0,we=f.length;ue<we;ue++)J?this._off(f[ue]):this._off(f[ue],k,P)}return this},_on:function(f,k,P,G){if(typeof k!="function"){console.warn("wrong listener type: "+typeof k);return}if(this._listens(f,k,P)===!1){P===this&&(P=void 0);var J={fn:k,ctx:P};G&&(J.once=!0),this._events=this._events||{},this._events[f]=this._events[f]||[],this._events[f].push(J)}},_off:function(f,k,P){var G,J,ue;if(this._events&&(G=this._events[f],!!G)){if(arguments.length===1){if(this._firingCount)for(J=0,ue=G.length;J<ue;J++)G[J].fn=h;delete this._events[f];return}if(typeof k!="function"){console.warn("wrong listener type: "+typeof k);return}var we=this._listens(f,k,P);if(we!==!1){var Me=G[we];this._firingCount&&(Me.fn=h,this._events[f]=G=G.slice()),G.splice(we,1)}}},fire:function(f,k,P){if(!this.listens(f,P))return this;var G=i({},k,{type:f,target:this,sourceTarget:k&&k.sourceTarget||this});if(this._events){var J=this._events[f];if(J){this._firingCount=this._firingCount+1||1;for(var ue=0,we=J.length;ue<we;ue++){var Me=J[ue],Ie=Me.fn;Me.once&&this.off(f,Ie,Me.ctx),Ie.call(Me.ctx||this,G)}this._firingCount--}}return P&&this._propagateEvent(G),this},listens:function(f,k,P,G){typeof f!="string"&&console.warn('"string" type argument expected');var J=k;typeof k!="function"&&(G=!!k,J=void 0,P=void 0);var ue=this._events&&this._events[f];if(ue&&ue.length&&this._listens(f,J,P)!==!1)return!0;if(G){for(var we in this._eventParents)if(this._eventParents[we].listens(f,k,P,G))return!0}return!1},_listens:function(f,k,P){if(!this._events)return!1;var G=this._events[f]||[];if(!k)return!!G.length;P===this&&(P=void 0);for(var J=0,ue=G.length;J<ue;J++)if(G[J].fn===k&&G[J].ctx===P)return J;return!1},once:function(f,k,P){if(typeof f=="object")for(var G in f)this._on(G,f[G],k,!0);else{f=y(f);for(var J=0,ue=f.length;J<ue;J++)this._on(f[J],k,P,!0)}return this},addEventParent:function(f){return this._eventParents=this._eventParents||{},this._eventParents[l(f)]=f,this},removeEventParent:function(f){return this._eventParents&&delete this._eventParents[l(f)],this},_propagateEvent:function(f){for(var k in this._eventParents)this._eventParents[k].fire(f.type,i({layer:f.target,propagatedFrom:f.target},f),!0)}};W.addEventListener=W.on,W.removeEventListener=W.clearAllEventListeners=W.off,W.addOneTimeEventListener=W.once,W.fireEvent=W.fire,W.hasEventListeners=W.listens;var Y=H.extend(W);function Q(f,k,P){this.x=P?Math.round(f):f,this.y=P?Math.round(k):k}var ne=Math.trunc||function(f){return f>0?Math.floor(f):Math.ceil(f)};Q.prototype={clone:function(){return new Q(this.x,this.y)},add:function(f){return this.clone()._add(re(f))},_add:function(f){return this.x+=f.x,this.y+=f.y,this},subtract:function(f){return this.clone()._subtract(re(f))},_subtract:function(f){return this.x-=f.x,this.y-=f.y,this},divideBy:function(f){return this.clone()._divideBy(f)},_divideBy:function(f){return this.x/=f,this.y/=f,this},multiplyBy:function(f){return this.clone()._multiplyBy(f)},_multiplyBy:function(f){return this.x*=f,this.y*=f,this},scaleBy:function(f){return new Q(this.x*f.x,this.y*f.y)},unscaleBy:function(f){return new Q(this.x/f.x,this.y/f.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=ne(this.x),this.y=ne(this.y),this},distanceTo:function(f){f=re(f);var k=f.x-this.x,P=f.y-this.y;return Math.sqrt(k*k+P*P)},equals:function(f){return f=re(f),f.x===this.x&&f.y===this.y},contains:function(f){return f=re(f),Math.abs(f.x)<=Math.abs(this.x)&&Math.abs(f.y)<=Math.abs(this.y)},toString:function(){return"Point("+p(this.x)+", "+p(this.y)+")"}};function re(f,k,P){return f instanceof Q?f:C(f)?new Q(f[0],f[1]):f==null?f:typeof f=="object"&&"x"in f&&"y"in f?new Q(f.x,f.y):new Q(f,k,P)}function q(f,k){if(f)for(var P=k?[f,k]:f,G=0,J=P.length;G<J;G++)this.extend(P[G])}q.prototype={extend:function(f){var k,P;if(!f)return this;if(f instanceof Q||typeof f[0]=="number"||"x"in f)k=P=re(f);else if(f=te(f),k=f.min,P=f.max,!k||!P)return this;return!this.min&&!this.max?(this.min=k.clone(),this.max=P.clone()):(this.min.x=Math.min(k.x,this.min.x),this.max.x=Math.max(P.x,this.max.x),this.min.y=Math.min(k.y,this.min.y),this.max.y=Math.max(P.y,this.max.y)),this},getCenter:function(f){return re((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,f)},getBottomLeft:function(){return re(this.min.x,this.max.y)},getTopRight:function(){return re(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(f){var k,P;return typeof f[0]=="number"||f instanceof Q?f=re(f):f=te(f),f instanceof q?(k=f.min,P=f.max):k=P=f,k.x>=this.min.x&&P.x<=this.max.x&&k.y>=this.min.y&&P.y<=this.max.y},intersects:function(f){f=te(f);var k=this.min,P=this.max,G=f.min,J=f.max,ue=J.x>=k.x&&G.x<=P.x,we=J.y>=k.y&&G.y<=P.y;return ue&&we},overlaps:function(f){f=te(f);var k=this.min,P=this.max,G=f.min,J=f.max,ue=J.x>k.x&&G.x<P.x,we=J.y>k.y&&G.y<P.y;return ue&&we},isValid:function(){return!!(this.min&&this.max)},pad:function(f){var k=this.min,P=this.max,G=Math.abs(k.x-P.x)*f,J=Math.abs(k.y-P.y)*f;return te(re(k.x-G,k.y-J),re(P.x+G,P.y+J))},equals:function(f){return f?(f=te(f),this.min.equals(f.getTopLeft())&&this.max.equals(f.getBottomRight())):!1}};function te(f,k){return!f||f instanceof q?f:new q(f,k)}function ae(f,k){if(f)for(var P=k?[f,k]:f,G=0,J=P.length;G<J;G++)this.extend(P[G])}ae.prototype={extend:function(f){var k=this._southWest,P=this._northEast,G,J;if(f instanceof ge)G=f,J=f;else if(f instanceof ae){if(G=f._southWest,J=f._northEast,!G||!J)return this}else return f?this.extend(ye(f)||de(f)):this;return!k&&!P?(this._southWest=new ge(G.lat,G.lng),this._northEast=new ge(J.lat,J.lng)):(k.lat=Math.min(G.lat,k.lat),k.lng=Math.min(G.lng,k.lng),P.lat=Math.max(J.lat,P.lat),P.lng=Math.max(J.lng,P.lng)),this},pad:function(f){var k=this._southWest,P=this._northEast,G=Math.abs(k.lat-P.lat)*f,J=Math.abs(k.lng-P.lng)*f;return new ae(new ge(k.lat-G,k.lng-J),new ge(P.lat+G,P.lng+J))},getCenter:function(){return new ge((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new ge(this.getNorth(),this.getWest())},getSouthEast:function(){return new ge(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(f){typeof f[0]=="number"||f instanceof ge||"lat"in f?f=ye(f):f=de(f);var k=this._southWest,P=this._northEast,G,J;return f instanceof ae?(G=f.getSouthWest(),J=f.getNorthEast()):G=J=f,G.lat>=k.lat&&J.lat<=P.lat&&G.lng>=k.lng&&J.lng<=P.lng},intersects:function(f){f=de(f);var k=this._southWest,P=this._northEast,G=f.getSouthWest(),J=f.getNorthEast(),ue=J.lat>=k.lat&&G.lat<=P.lat,we=J.lng>=k.lng&&G.lng<=P.lng;return ue&&we},overlaps:function(f){f=de(f);var k=this._southWest,P=this._northEast,G=f.getSouthWest(),J=f.getNorthEast(),ue=J.lat>k.lat&&G.lat<P.lat,we=J.lng>k.lng&&G.lng<P.lng;return ue&&we},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(f,k){return f?(f=de(f),this._southWest.equals(f.getSouthWest(),k)&&this._northEast.equals(f.getNorthEast(),k)):!1},isValid:function(){return!!(this._southWest&&this._northEast)}};function de(f,k){return f instanceof ae?f:new ae(f,k)}function ge(f,k,P){if(isNaN(f)||isNaN(k))throw new Error("Invalid LatLng object: ("+f+", "+k+")");this.lat=+f,this.lng=+k,P!==void 0&&(this.alt=+P)}ge.prototype={equals:function(f,k){if(!f)return!1;f=ye(f);var P=Math.max(Math.abs(this.lat-f.lat),Math.abs(this.lng-f.lng));return P<=(k===void 0?1e-9:k)},toString:function(f){return"LatLng("+p(this.lat,f)+", "+p(this.lng,f)+")"},distanceTo:function(f){return fe.distance(this,ye(f))},wrap:function(){return fe.wrapLatLng(this)},toBounds:function(f){var k=180*f/40075017,P=k/Math.cos(Math.PI/180*this.lat);return de([this.lat-k,this.lng-P],[this.lat+k,this.lng+P])},clone:function(){return new ge(this.lat,this.lng,this.alt)}};function ye(f,k,P){return f instanceof ge?f:C(f)&&typeof f[0]!="object"?f.length===3?new ge(f[0],f[1],f[2]):f.length===2?new ge(f[0],f[1]):null:f==null?f:typeof f=="object"&&"lat"in f?new ge(f.lat,"lng"in f?f.lng:f.lon,f.alt):k===void 0?null:new ge(f,k,P)}var se={latLngToPoint:function(f,k){var P=this.projection.project(f),G=this.scale(k);return this.transformation._transform(P,G)},pointToLatLng:function(f,k){var P=this.scale(k),G=this.transformation.untransform(f,P);return this.projection.unproject(G)},project:function(f){return this.projection.project(f)},unproject:function(f){return this.projection.unproject(f)},scale:function(f){return 256*Math.pow(2,f)},zoom:function(f){return Math.log(f/256)/Math.LN2},getProjectedBounds:function(f){if(this.infinite)return null;var k=this.projection.bounds,P=this.scale(f),G=this.transformation.transform(k.min,P),J=this.transformation.transform(k.max,P);return new q(G,J)},infinite:!1,wrapLatLng:function(f){var k=this.wrapLng?c(f.lng,this.wrapLng,!0):f.lng,P=this.wrapLat?c(f.lat,this.wrapLat,!0):f.lat,G=f.alt;return new ge(P,k,G)},wrapLatLngBounds:function(f){var k=f.getCenter(),P=this.wrapLatLng(k),G=k.lat-P.lat,J=k.lng-P.lng;if(G===0&&J===0)return f;var ue=f.getSouthWest(),we=f.getNorthEast(),Me=new ge(ue.lat-G,ue.lng-J),Ie=new ge(we.lat-G,we.lng-J);return new ae(Me,Ie)}},fe=i({},se,{wrapLng:[-180,180],R:6371e3,distance:function(f,k){var P=Math.PI/180,G=f.lat*P,J=k.lat*P,ue=Math.sin((k.lat-f.lat)*P/2),we=Math.sin((k.lng-f.lng)*P/2),Me=ue*ue+Math.cos(G)*Math.cos(J)*we*we,Ie=2*Math.atan2(Math.sqrt(Me),Math.sqrt(1-Me));return this.R*Ie}}),le=6378137,pe={R:le,MAX_LATITUDE:85.0511287798,project:function(f){var k=Math.PI/180,P=this.MAX_LATITUDE,G=Math.max(Math.min(P,f.lat),-P),J=Math.sin(G*k);return new Q(this.R*f.lng*k,this.R*Math.log((1+J)/(1-J))/2)},unproject:function(f){var k=180/Math.PI;return new ge((2*Math.atan(Math.exp(f.y/this.R))-Math.PI/2)*k,f.x*k/this.R)},bounds:(function(){var f=le*Math.PI;return new q([-f,-f],[f,f])})()};function me(f,k,P,G){if(C(f)){this._a=f[0],this._b=f[1],this._c=f[2],this._d=f[3];return}this._a=f,this._b=k,this._c=P,this._d=G}me.prototype={transform:function(f,k){return this._transform(f.clone(),k)},_transform:function(f,k){return k=k||1,f.x=k*(this._a*f.x+this._b),f.y=k*(this._c*f.y+this._d),f},untransform:function(f,k){return k=k||1,new Q((f.x/k-this._b)/this._a,(f.y/k-this._d)/this._c)}};function xe(f,k,P,G){return new me(f,k,P,G)}var Se=i({},fe,{code:"EPSG:3857",projection:pe,transformation:(function(){var f=.5/(Math.PI*pe.R);return xe(f,.5,-f,.5)})()}),Ve=i({},Se,{code:"EPSG:900913"});function $e(f){return document.createElementNS("http://www.w3.org/2000/svg",f)}function St(f,k){var P="",G,J,ue,we,Me,Ie;for(G=0,ue=f.length;G<ue;G++){for(Me=f[G],J=0,we=Me.length;J<we;J++)Ie=Me[J],P+=(J?"L":"M")+Ie.x+" "+Ie.y;P+=k?Tt.svg?"z":"x":""}return P||"M0 0"}var rt=document.documentElement.style,lt="ActiveXObject"in window,De=lt&&!document.addEventListener,Le="msLaunchUri"in navigator&&!("documentMode"in document),Qe=br("webkit"),Ce=br("android"),Fe=br("android 2")||br("android 3"),Ke=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),mt=Ce&&br("Google")&&Ke<537&&!("AudioNode"in window),gt=!!window.opera,yt=!Le&&br("chrome"),jt=br("gecko")&&!Qe&&!gt&&!lt,qt=!yt&&br("safari"),wt=br("phantom"),ft="OTransition"in rt,qe=navigator.platform.indexOf("Win")===0,ce=lt&&"transition"in rt,ve="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!Fe,ke="MozPerspective"in rt,Te=!window.L_DISABLE_3D&&(ce||ve||ke)&&!ft&&!wt,Re=typeof orientation<"u"||br("mobile"),Je=Re&&Qe,ze=Re&&ve,vt=!window.PointerEvent&&window.MSPointerEvent,pt=!!(window.PointerEvent||vt),At="ontouchstart"in window||!!window.TouchEvent,Ut=!window.L_NO_TOUCH&&(At||pt),Kt=Re&&gt,Ct=Re&&jt,Yt=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,Xt=(function(){var f=!1;try{var k=Object.defineProperty({},"passive",{get:function(){f=!0}});window.addEventListener("testPassiveEventSupport",h,k),window.removeEventListener("testPassiveEventSupport",h,k)}catch{}return f})(),Lr=(function(){return!!document.createElement("canvas").getContext})(),ar=!!(document.createElementNS&&$e("svg").createSVGRect),mn=!!ar&&(function(){var f=document.createElement("div");return f.innerHTML="<svg/>",(f.firstChild&&f.firstChild.namespaceURI)==="http://www.w3.org/2000/svg"})(),Wr=!ar&&(function(){try{var f=document.createElement("div");f.innerHTML='<v:shape adj="1"/>';var k=f.firstChild;return k.style.behavior="url(#default#VML)",k&&typeof k.adj=="object"}catch{return!1}})(),Br=navigator.platform.indexOf("Mac")===0,nn=navigator.platform.indexOf("Linux")===0;function br(f){return navigator.userAgent.toLowerCase().indexOf(f)>=0}var Tt={ie:lt,ielt9:De,edge:Le,webkit:Qe,android:Ce,android23:Fe,androidStock:mt,opera:gt,chrome:yt,gecko:jt,safari:qt,phantom:wt,opera12:ft,win:qe,ie3d:ce,webkit3d:ve,gecko3d:ke,any3d:Te,mobile:Re,mobileWebkit:Je,mobileWebkit3d:ze,msPointer:vt,pointer:pt,touch:Ut,touchNative:At,mobileOpera:Kt,mobileGecko:Ct,retina:Yt,passiveEvents:Xt,canvas:Lr,svg:ar,vml:Wr,inlineSvg:mn,mac:Br,linux:nn},zr=Tt.msPointer?"MSPointerDown":"pointerdown",Qn=Tt.msPointer?"MSPointerMove":"pointermove",Ji=Tt.msPointer?"MSPointerUp":"pointerup",Ka=Tt.msPointer?"MSPointerCancel":"pointercancel",Rs={touchstart:zr,touchmove:Qn,touchend:Ji,touchcancel:Ka},Ln={touchstart:Xr,touchmove:xo,touchend:xo,touchcancel:xo},un={},bn=!1;function Jn(f,k,P){return k==="touchstart"&&zl(),Ln[k]?(P=Ln[k].bind(this,P),f.addEventListener(Rs[k],P,!1),P):(console.warn("wrong event specified:",k),h)}function zi(f,k,P){if(!Rs[k]){console.warn("wrong event specified:",k);return}f.removeEventListener(Rs[k],P,!1)}function vi(f){un[f.pointerId]=f}function Jo(f){un[f.pointerId]&&(un[f.pointerId]=f)}function el(f){delete un[f.pointerId]}function zl(){bn||(document.addEventListener(zr,vi,!0),document.addEventListener(Qn,Jo,!0),document.addEventListener(Ji,el,!0),document.addEventListener(Ka,el,!0),bn=!0)}function xo(f,k){if(k.pointerType!==(k.MSPOINTER_TYPE_MOUSE||"mouse")){k.touches=[];for(var P in un)k.touches.push(un[P]);k.changedTouches=[k],f(k)}}function Xr(f,k){k.MSPOINTER_TYPE_TOUCH&&k.pointerType===k.MSPOINTER_TYPE_TOUCH&&cn(k),xo(f,k)}function tl(f){var k={},P,G;for(G in f)P=f[G],k[G]=P&&P.bind?P.bind(f):P;return f=k,k.type="dblclick",k.detail=2,k.isTrusted=!1,k._simulated=!0,k}var fs=200;function Be(f,k){f.addEventListener("dblclick",k);var P=0,G;function J(ue){if(ue.detail!==1){G=ue.detail;return}if(!(ue.pointerType==="mouse"||ue.sourceCapabilities&&!ue.sourceCapabilities.firesTouchEvents)){var we=il(ue);if(!(we.some(function(Ie){return Ie instanceof HTMLLabelElement&&Ie.attributes.for})&&!we.some(function(Ie){return Ie instanceof HTMLInputElement||Ie instanceof HTMLSelectElement}))){var Me=Date.now();Me-P<=fs?(G++,G===2&&k(tl(ue))):G=1,P=Me}}}return f.addEventListener("click",J),{dblclick:k,simDblclick:J}}function Xe(f,k){f.removeEventListener("dblclick",k.dblclick),f.removeEventListener("click",k.simDblclick)}var ot=Mi(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),Vt=Mi(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),ir=Vt==="webkitTransition"||Vt==="OTransition"?Vt+"End":"transitionend";function tr(f){return typeof f=="string"?document.getElementById(f):f}function gr(f,k){var P=f.style[k]||f.currentStyle&&f.currentStyle[k];if((!P||P==="auto")&&document.defaultView){var G=document.defaultView.getComputedStyle(f,null);P=G?G[k]:null}return P==="auto"?null:P}function ct(f,k,P){var G=document.createElement(f);return G.className=k||"",P&&P.appendChild(G),G}function mr(f){var k=f.parentNode;k&&k.removeChild(f)}function Qr(f){for(;f.firstChild;)f.removeChild(f.firstChild)}function Ur(f){var k=f.parentNode;k&&k.lastChild!==f&&k.appendChild(f)}function Or(f){var k=f.parentNode;k&&k.firstChild!==f&&k.insertBefore(f,k.firstChild)}function ii(f,k){if(f.classList!==void 0)return f.classList.contains(k);var P=On(f);return P.length>0&&new RegExp("(^|\\s)"+k+"(\\s|$)").test(P)}function it(f,k){if(f.classList!==void 0)for(var P=y(k),G=0,J=P.length;G<J;G++)f.classList.add(P[G]);else if(!ii(f,k)){var ue=On(f);yi(f,(ue?ue+" ":"")+k)}}function sr(f,k){f.classList!==void 0?f.classList.remove(k):yi(f,v((" "+On(f)+" ").replace(" "+k+" "," ")))}function yi(f,k){f.className.baseVal===void 0?f.className=k:f.className.baseVal=k}function On(f){return f.correspondingElement&&(f=f.correspondingElement),f.className.baseVal===void 0?f.className:f.className.baseVal}function Dn(f,k){"opacity"in f.style?f.style.opacity=k:"filter"in f.style&&Ul(f,k)}function Ul(f,k){var P=!1,G="DXImageTransform.Microsoft.Alpha";try{P=f.filters.item(G)}catch{if(k===1)return}k=Math.round(k*100),P?(P.Enabled=k!==100,P.Opacity=k):f.style.filter+=" progid:"+G+"(opacity="+k+")"}function Mi(f){for(var k=document.documentElement.style,P=0;P<f.length;P++)if(f[P]in k)return f[P];return!1}function ps(f,k,P){var G=k||new Q(0,0);f.style[ot]=(Tt.ie3d?"translate("+G.x+"px,"+G.y+"px)":"translate3d("+G.x+"px,"+G.y+"px,0)")+(P?" scale("+P+")":"")}function In(f,k){f._leaflet_pos=k,Tt.any3d?ps(f,k):(f.style.left=k.x+"px",f.style.top=k.y+"px")}function to(f){return f._leaflet_pos||new Q(0,0)}var wr,ro,bo;if("onselectstart"in document)wr=function(){rr(window,"selectstart",cn)},ro=function(){qr(window,"selectstart",cn)};else{var Ls=Mi(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);wr=function(){if(Ls){var f=document.documentElement.style;bo=f[Ls],f[Ls]="none"}},ro=function(){Ls&&(document.documentElement.style[Ls]=bo,bo=void 0)}}function Cc(){rr(window,"dragstart",cn)}function Ec(){qr(window,"dragstart",cn)}var rl,Gl;function wo(f){for(;f.tabIndex===-1;)f=f.parentNode;f.style&&(Ui(),rl=f,Gl=f.style.outlineStyle,f.style.outlineStyle="none",rr(window,"keydown",Ui))}function Ui(){rl&&(rl.style.outlineStyle=Gl,rl=void 0,Gl=void 0,qr(window,"keydown",Ui))}function no(f){do f=f.parentNode;while((!f.offsetWidth||!f.offsetHeight)&&f!==document.body);return f}function Za(f){var k=f.getBoundingClientRect();return{x:k.width/f.offsetWidth||1,y:k.height/f.offsetHeight||1,boundingClientRect:k}}var Sr={__proto__:null,TRANSFORM:ot,TRANSITION:Vt,TRANSITION_END:ir,get:tr,getStyle:gr,create:ct,remove:mr,empty:Qr,toFront:Ur,toBack:Or,hasClass:ii,addClass:it,removeClass:sr,setClass:yi,getClass:On,setOpacity:Dn,testProp:Mi,setTransform:ps,setPosition:In,getPosition:to,get disableTextSelection(){return wr},get enableTextSelection(){return ro},disableImageDrag:Cc,enableImageDrag:Ec,preventOutline:wo,restoreOutline:Ui,getSizedParentNode:no,getScale:Za};function rr(f,k,P,G){if(k&&typeof k=="object")for(var J in k)jn(f,J,k[J],P);else{k=y(k);for(var ue=0,we=k.length;ue<we;ue++)jn(f,k[ue],P,G)}return this}var ei="_leaflet_events";function qr(f,k,P,G){if(arguments.length===1)gh(f),delete f[ei];else if(k&&typeof k=="object")for(var J in k)Vl(f,J,k[J],P);else if(k=y(k),arguments.length===2)gh(f,function(Me){return N(k,Me)!==-1});else for(var ue=0,we=k.length;ue<we;ue++)Vl(f,k[ue],P,G);return this}function gh(f,k){for(var P in f[ei]){var G=P.split(/\d/)[0];(!k||k(G))&&Vl(f,G,null,null,P)}}var nl={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function jn(f,k,P,G){var J=k+l(P)+(G?"_"+l(G):"");if(f[ei]&&f[ei][J])return this;var ue=function(Me){return P.call(G||f,Me||window.event)},we=ue;!Tt.touchNative&&Tt.pointer&&k.indexOf("touch")===0?ue=Jn(f,k,ue):Tt.touch&&k==="dblclick"?ue=Be(f,ue):"addEventListener"in f?k==="touchstart"||k==="touchmove"||k==="wheel"||k==="mousewheel"?f.addEventListener(nl[k]||k,ue,Tt.passiveEvents?{passive:!1}:!1):k==="mouseenter"||k==="mouseleave"?(ue=function(Me){Me=Me||window.event,So(f,Me)&&we(Me)},f.addEventListener(nl[k],ue,!1)):f.addEventListener(k,we,!1):f.attachEvent("on"+k,ue),f[ei]=f[ei]||{},f[ei][J]=ue}function Vl(f,k,P,G,J){J=J||k+l(P)+(G?"_"+l(G):"");var ue=f[ei]&&f[ei][J];if(!ue)return this;!Tt.touchNative&&Tt.pointer&&k.indexOf("touch")===0?zi(f,k,ue):Tt.touch&&k==="dblclick"?Xe(f,ue):"removeEventListener"in f?f.removeEventListener(nl[k]||k,ue,!1):f.detachEvent("on"+k,ue),f[ei][J]=null}function Os(f){return f.stopPropagation?f.stopPropagation():f.originalEvent?f.originalEvent._stopped=!0:f.cancelBubble=!0,this}function Hl(f){return jn(f,"wheel",Os),this}function Lu(f){return rr(f,"mousedown touchstart dblclick contextmenu",Os),f._leaflet_disable_click=!0,this}function cn(f){return f.preventDefault?f.preventDefault():f.returnValue=!1,this}function Fn(f){return cn(f),Os(f),this}function il(f){if(f.composedPath)return f.composedPath();for(var k=[],P=f.target;P;)k.push(P),P=P.parentNode;return k}function Ou(f,k){if(!k)return new Q(f.clientX,f.clientY);var P=Za(k),G=P.boundingClientRect;return new Q((f.clientX-G.left)/P.x-k.clientLeft,(f.clientY-G.top)/P.y-k.clientTop)}var ms=Tt.linux&&Tt.chrome?window.devicePixelRatio:Tt.mac?window.devicePixelRatio*3:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function Ds(f){return Tt.edge?f.wheelDeltaY/2:f.deltaY&&f.deltaMode===0?-f.deltaY/ms:f.deltaY&&f.deltaMode===1?-f.deltaY*20:f.deltaY&&f.deltaMode===2?-f.deltaY*60:f.deltaX||f.deltaZ?0:f.wheelDelta?(f.wheelDeltaY||f.wheelDelta)/2:f.detail&&Math.abs(f.detail)<32765?-f.detail*20:f.detail?f.detail/-32765*60:0}function So(f,k){var P=k.relatedTarget;if(!P)return!0;try{for(;P&&P!==f;)P=P.parentNode}catch{return!1}return P!==f}var Wl={__proto__:null,on:rr,off:qr,stopPropagation:Os,disableScrollPropagation:Hl,disableClickPropagation:Lu,preventDefault:cn,stop:Fn,getPropagationPath:il,getMousePosition:Ou,getWheelDelta:Ds,isExternalTarget:So,addListener:rr,removeListener:qr},Du=Y.extend({run:function(f,k,P,G){this.stop(),this._el=f,this._inProgress=!0,this._duration=P||.25,this._easeOutPower=1/Math.max(G||.5,.2),this._startPos=to(f),this._offset=k.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=$(this._animate,this),this._step()},_step:function(f){var k=+new Date-this._startTime,P=this._duration*1e3;k<P?this._runFrame(this._easeOut(k/P),f):(this._runFrame(1),this._complete())},_runFrame:function(f,k){var P=this._startPos.add(this._offset.multiplyBy(f));k&&P._round(),In(this._el,P),this.fire("step")},_complete:function(){Z(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(f){return 1-Math.pow(1-f,this._easeOutPower)}}),Cr=Y.extend({options:{crs:Se,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(f,k){k=S(this,k),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(f),this._initLayout(),this._onResize=s(this._onResize,this),this._initEvents(),k.maxBounds&&this.setMaxBounds(k.maxBounds),k.zoom!==void 0&&(this._zoom=this._limitZoom(k.zoom)),k.center&&k.zoom!==void 0&&this.setView(ye(k.center),k.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=Vt&&Tt.any3d&&!Tt.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),rr(this._proxy,ir,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(f,k,P){if(k=k===void 0?this._zoom:this._limitZoom(k),f=this._limitCenter(ye(f),k,this.options.maxBounds),P=P||{},this._stop(),this._loaded&&!P.reset&&P!==!0){P.animate!==void 0&&(P.zoom=i({animate:P.animate},P.zoom),P.pan=i({animate:P.animate,duration:P.duration},P.pan));var G=this._zoom!==k?this._tryAnimatedZoom&&this._tryAnimatedZoom(f,k,P.zoom):this._tryAnimatedPan(f,P.pan);if(G)return clearTimeout(this._sizeTimer),this}return this._resetView(f,k,P.pan&&P.pan.noMoveStart),this},setZoom:function(f,k){return this._loaded?this.setView(this.getCenter(),f,{zoom:k}):(this._zoom=f,this)},zoomIn:function(f,k){return f=f||(Tt.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+f,k)},zoomOut:function(f,k){return f=f||(Tt.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-f,k)},setZoomAround:function(f,k,P){var G=this.getZoomScale(k),J=this.getSize().divideBy(2),ue=f instanceof Q?f:this.latLngToContainerPoint(f),we=ue.subtract(J).multiplyBy(1-1/G),Me=this.containerPointToLatLng(J.add(we));return this.setView(Me,k,{zoom:P})},_getBoundsCenterZoom:function(f,k){k=k||{},f=f.getBounds?f.getBounds():de(f);var P=re(k.paddingTopLeft||k.padding||[0,0]),G=re(k.paddingBottomRight||k.padding||[0,0]),J=this.getBoundsZoom(f,!1,P.add(G));if(J=typeof k.maxZoom=="number"?Math.min(k.maxZoom,J):J,J===1/0)return{center:f.getCenter(),zoom:J};var ue=G.subtract(P).divideBy(2),we=this.project(f.getSouthWest(),J),Me=this.project(f.getNorthEast(),J),Ie=this.unproject(we.add(Me).divideBy(2).add(ue),J);return{center:Ie,zoom:J}},fitBounds:function(f,k){if(f=de(f),!f.isValid())throw new Error("Bounds are not valid.");var P=this._getBoundsCenterZoom(f,k);return this.setView(P.center,P.zoom,k)},fitWorld:function(f){return this.fitBounds([[-90,-180],[90,180]],f)},panTo:function(f,k){return this.setView(f,this._zoom,{pan:k})},panBy:function(f,k){if(f=re(f).round(),k=k||{},!f.x&&!f.y)return this.fire("moveend");if(k.animate!==!0&&!this.getSize().contains(f))return this._resetView(this.unproject(this.project(this.getCenter()).add(f)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new Du,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),k.noMoveStart||this.fire("movestart"),k.animate!==!1){it(this._mapPane,"leaflet-pan-anim");var P=this._getMapPanePos().subtract(f).round();this._panAnim.run(this._mapPane,P,k.duration||.25,k.easeLinearity)}else this._rawPanBy(f),this.fire("move").fire("moveend");return this},flyTo:function(f,k,P){if(P=P||{},P.animate===!1||!Tt.any3d)return this.setView(f,k,P);this._stop();var G=this.project(this.getCenter()),J=this.project(f),ue=this.getSize(),we=this._zoom;f=ye(f),k=k===void 0?we:k;var Me=Math.max(ue.x,ue.y),Ie=Me*this.getZoomScale(we,k),Ze=J.distanceTo(G)||1,kt=1.42,$t=kt*kt;function hr(Dr){var gl=Dr?-1:1,Bf=Dr?Ie:Me,zf=Ie*Ie-Me*Me+gl*$t*$t*Ze*Ze,Po=2*Bf*$t*Ze,vl=zf/Po,Vn=Math.sqrt(vl*vl+1)-vl,oi=Vn<1e-9?-18:Math.log(Vn);return oi}function Kr(Dr){return(Math.exp(Dr)-Math.exp(-Dr))/2}function Gn(Dr){return(Math.exp(Dr)+Math.exp(-Dr))/2}function Li(Dr){return Kr(Dr)/Gn(Dr)}var Vi=hr(0);function pl(Dr){return Me*(Gn(Vi)/Gn(Vi+kt*Dr))}function Uc(Dr){return Me*(Gn(Vi)*Li(Vi+kt*Dr)-Kr(Vi))/$t}function zs(Dr){return 1-Math.pow(1-Dr,1.5)}var ml=Date.now(),oo=(hr(1)-Vi)/kt,rs=P.duration?1e3*P.duration:1e3*oo*.8;function iu(){var Dr=(Date.now()-ml)/rs,gl=zs(Dr)*oo;Dr<=1?(this._flyToFrame=$(iu,this),this._move(this.unproject(G.add(J.subtract(G).multiplyBy(Uc(gl)/Ze)),we),this.getScaleZoom(Me/pl(gl),we),{flyTo:!0})):this._move(f,k)._moveEnd(!0)}return this._moveStart(!0,P.noMoveStart),iu.call(this),this},flyToBounds:function(f,k){var P=this._getBoundsCenterZoom(f,k);return this.flyTo(P.center,P.zoom,k)},setMaxBounds:function(f){return f=de(f),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),f.isValid()?(this.options.maxBounds=f,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(f){var k=this.options.minZoom;return this.options.minZoom=f,this._loaded&&k!==f&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(f):this},setMaxZoom:function(f){var k=this.options.maxZoom;return this.options.maxZoom=f,this._loaded&&k!==f&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(f):this},panInsideBounds:function(f,k){this._enforcingBounds=!0;var P=this.getCenter(),G=this._limitCenter(P,this._zoom,de(f));return P.equals(G)||this.panTo(G,k),this._enforcingBounds=!1,this},panInside:function(f,k){k=k||{};var P=re(k.paddingTopLeft||k.padding||[0,0]),G=re(k.paddingBottomRight||k.padding||[0,0]),J=this.project(this.getCenter()),ue=this.project(f),we=this.getPixelBounds(),Me=te([we.min.add(P),we.max.subtract(G)]),Ie=Me.getSize();if(!Me.contains(ue)){this._enforcingBounds=!0;var Ze=ue.subtract(Me.getCenter()),kt=Me.extend(ue).getSize().subtract(Ie);J.x+=Ze.x<0?-kt.x:kt.x,J.y+=Ze.y<0?-kt.y:kt.y,this.panTo(this.unproject(J),k),this._enforcingBounds=!1}return this},invalidateSize:function(f){if(!this._loaded)return this;f=i({animate:!1,pan:!0},f===!0?{animate:!0}:f);var k=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var P=this.getSize(),G=k.divideBy(2).round(),J=P.divideBy(2).round(),ue=G.subtract(J);return!ue.x&&!ue.y?this:(f.animate&&f.pan?this.panBy(ue):(f.pan&&this._rawPanBy(ue),this.fire("move"),f.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(s(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:k,newSize:P}))},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(f){if(f=this._locateOptions=i({timeout:1e4,watch:!1},f),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var k=s(this._handleGeolocationResponse,this),P=s(this._handleGeolocationError,this);return f.watch?this._locationWatchId=navigator.geolocation.watchPosition(k,P,f):navigator.geolocation.getCurrentPosition(k,P,f),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(f){if(this._container._leaflet_id){var k=f.code,P=f.message||(k===1?"permission denied":k===2?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:k,message:"Geolocation error: "+P+"."})}},_handleGeolocationResponse:function(f){if(this._container._leaflet_id){var k=f.coords.latitude,P=f.coords.longitude,G=new ge(k,P),J=G.toBounds(f.coords.accuracy*2),ue=this._locateOptions;if(ue.setView){var we=this.getBoundsZoom(J);this.setView(G,ue.maxZoom?Math.min(we,ue.maxZoom):we)}var Me={latlng:G,bounds:J,timestamp:f.timestamp};for(var Ie in f.coords)typeof f.coords[Ie]=="number"&&(Me[Ie]=f.coords[Ie]);this.fire("locationfound",Me)}},addHandler:function(f,k){if(!k)return this;var P=this[f]=new k(this);return this._handlers.push(P),this.options[f]&&P.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch{this._container._leaflet_id=void 0,this._containerId=void 0}this._locationWatchId!==void 0&&this.stopLocate(),this._stop(),mr(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(Z(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload");var f;for(f in this._layers)this._layers[f].remove();for(f in this._panes)mr(this._panes[f]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(f,k){var P="leaflet-pane"+(f?" leaflet-"+f.replace("Pane","")+"-pane":""),G=ct("div",P,k||this._mapPane);return f&&(this._panes[f]=G),G},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var f=this.getPixelBounds(),k=this.unproject(f.getBottomLeft()),P=this.unproject(f.getTopRight());return new ae(k,P)},getMinZoom:function(){return this.options.minZoom===void 0?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===void 0?this._layersMaxZoom===void 0?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(f,k,P){f=de(f),P=re(P||[0,0]);var G=this.getZoom()||0,J=this.getMinZoom(),ue=this.getMaxZoom(),we=f.getNorthWest(),Me=f.getSouthEast(),Ie=this.getSize().subtract(P),Ze=te(this.project(Me,G),this.project(we,G)).getSize(),kt=Tt.any3d?this.options.zoomSnap:1,$t=Ie.x/Ze.x,hr=Ie.y/Ze.y,Kr=k?Math.max($t,hr):Math.min($t,hr);return G=this.getScaleZoom(Kr,G),kt&&(G=Math.round(G/(kt/100))*(kt/100),G=k?Math.ceil(G/kt)*kt:Math.floor(G/kt)*kt),Math.max(J,Math.min(ue,G))},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new Q(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(f,k){var P=this._getTopLeftPoint(f,k);return new q(P,P.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(f){return this.options.crs.getProjectedBounds(f===void 0?this.getZoom():f)},getPane:function(f){return typeof f=="string"?this._panes[f]:f},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(f,k){var P=this.options.crs;return k=k===void 0?this._zoom:k,P.scale(f)/P.scale(k)},getScaleZoom:function(f,k){var P=this.options.crs;k=k===void 0?this._zoom:k;var G=P.zoom(f*P.scale(k));return isNaN(G)?1/0:G},project:function(f,k){return k=k===void 0?this._zoom:k,this.options.crs.latLngToPoint(ye(f),k)},unproject:function(f,k){return k=k===void 0?this._zoom:k,this.options.crs.pointToLatLng(re(f),k)},layerPointToLatLng:function(f){var k=re(f).add(this.getPixelOrigin());return this.unproject(k)},latLngToLayerPoint:function(f){var k=this.project(ye(f))._round();return k._subtract(this.getPixelOrigin())},wrapLatLng:function(f){return this.options.crs.wrapLatLng(ye(f))},wrapLatLngBounds:function(f){return this.options.crs.wrapLatLngBounds(de(f))},distance:function(f,k){return this.options.crs.distance(ye(f),ye(k))},containerPointToLayerPoint:function(f){return re(f).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(f){return re(f).add(this._getMapPanePos())},containerPointToLatLng:function(f){var k=this.containerPointToLayerPoint(re(f));return this.layerPointToLatLng(k)},latLngToContainerPoint:function(f){return this.layerPointToContainerPoint(this.latLngToLayerPoint(ye(f)))},mouseEventToContainerPoint:function(f){return Ou(f,this._container)},mouseEventToLayerPoint:function(f){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(f))},mouseEventToLatLng:function(f){return this.layerPointToLatLng(this.mouseEventToLayerPoint(f))},_initContainer:function(f){var k=this._container=tr(f);if(k){if(k._leaflet_id)throw new Error("Map container is already initialized.")}else throw new Error("Map container not found.");rr(k,"scroll",this._onScroll,this),this._containerId=l(k)},_initLayout:function(){var f=this._container;this._fadeAnimated=this.options.fadeAnimation&&Tt.any3d,it(f,"leaflet-container"+(Tt.touch?" leaflet-touch":"")+(Tt.retina?" leaflet-retina":"")+(Tt.ielt9?" leaflet-oldie":"")+(Tt.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var k=gr(f,"position");k!=="absolute"&&k!=="relative"&&k!=="fixed"&&k!=="sticky"&&(f.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var f=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),In(this._mapPane,new Q(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(it(f.markerPane,"leaflet-zoom-hide"),it(f.shadowPane,"leaflet-zoom-hide"))},_resetView:function(f,k,P){In(this._mapPane,new Q(0,0));var G=!this._loaded;this._loaded=!0,k=this._limitZoom(k),this.fire("viewprereset");var J=this._zoom!==k;this._moveStart(J,P)._move(f,k)._moveEnd(J),this.fire("viewreset"),G&&this.fire("load")},_moveStart:function(f,k){return f&&this.fire("zoomstart"),k||this.fire("movestart"),this},_move:function(f,k,P,G){k===void 0&&(k=this._zoom);var J=this._zoom!==k;return this._zoom=k,this._lastCenter=f,this._pixelOrigin=this._getNewPixelOrigin(f),G?P&&P.pinch&&this.fire("zoom",P):((J||P&&P.pinch)&&this.fire("zoom",P),this.fire("move",P)),this},_moveEnd:function(f){return f&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return Z(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(f){In(this._mapPane,this._getMapPanePos().subtract(f))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(f){this._targets={},this._targets[l(this._container)]=this;var k=f?qr:rr;k(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&k(window,"resize",this._onResize,this),Tt.any3d&&this.options.transform3DLimit&&(f?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){Z(this._resizeRequest),this._resizeRequest=$(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var f=this._getMapPanePos();Math.max(Math.abs(f.x),Math.abs(f.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(f,k){for(var P=[],G,J=k==="mouseout"||k==="mouseover",ue=f.target||f.srcElement,we=!1;ue;){if(G=this._targets[l(ue)],G&&(k==="click"||k==="preclick")&&this._draggableMoved(G)){we=!0;break}if(G&&G.listens(k,!0)&&(J&&!So(ue,f)||(P.push(G),J))||ue===this._container)break;ue=ue.parentNode}return!P.length&&!we&&!J&&this.listens(k,!0)&&(P=[this]),P},_isClickDisabled:function(f){for(;f&&f!==this._container;){if(f._leaflet_disable_click)return!0;f=f.parentNode}},_handleDOMEvent:function(f){var k=f.target||f.srcElement;if(!(!this._loaded||k._leaflet_disable_events||f.type==="click"&&this._isClickDisabled(k))){var P=f.type;P==="mousedown"&&wo(k),this._fireDOMEvent(f,P)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(f,k,P){if(f.type==="click"){var G=i({},f);G.type="preclick",this._fireDOMEvent(G,G.type,P)}var J=this._findEventTargets(f,k);if(P){for(var ue=[],we=0;we<P.length;we++)P[we].listens(k,!0)&&ue.push(P[we]);J=ue.concat(J)}if(J.length){k==="contextmenu"&&cn(f);var Me=J[0],Ie={originalEvent:f};if(f.type!=="keypress"&&f.type!=="keydown"&&f.type!=="keyup"){var Ze=Me.getLatLng&&(!Me._radius||Me._radius<=10);Ie.containerPoint=Ze?this.latLngToContainerPoint(Me.getLatLng()):this.mouseEventToContainerPoint(f),Ie.layerPoint=this.containerPointToLayerPoint(Ie.containerPoint),Ie.latlng=Ze?Me.getLatLng():this.layerPointToLatLng(Ie.layerPoint)}for(we=0;we<J.length;we++)if(J[we].fire(k,Ie,!0),Ie.originalEvent._stopped||J[we].options.bubblingMouseEvents===!1&&N(this._mouseEvents,k)!==-1)return}},_draggableMoved:function(f){return f=f.dragging&&f.dragging.enabled()?f:this,f.dragging&&f.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var f=0,k=this._handlers.length;f<k;f++)this._handlers[f].disable()},whenReady:function(f,k){return this._loaded?f.call(k||this,{target:this}):this.on("load",f,k),this},_getMapPanePos:function(){return to(this._mapPane)||new Q(0,0)},_moved:function(){var f=this._getMapPanePos();return f&&!f.equals([0,0])},_getTopLeftPoint:function(f,k){var P=f&&k!==void 0?this._getNewPixelOrigin(f,k):this.getPixelOrigin();return P.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(f,k){var P=this.getSize()._divideBy(2);return this.project(f,k)._subtract(P)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(f,k,P){var G=this._getNewPixelOrigin(P,k);return this.project(f,k)._subtract(G)},_latLngBoundsToNewLayerBounds:function(f,k,P){var G=this._getNewPixelOrigin(P,k);return te([this.project(f.getSouthWest(),k)._subtract(G),this.project(f.getNorthWest(),k)._subtract(G),this.project(f.getSouthEast(),k)._subtract(G),this.project(f.getNorthEast(),k)._subtract(G)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(f){return this.latLngToLayerPoint(f).subtract(this._getCenterLayerPoint())},_limitCenter:function(f,k,P){if(!P)return f;var G=this.project(f,k),J=this.getSize().divideBy(2),ue=new q(G.subtract(J),G.add(J)),we=this._getBoundsOffset(ue,P,k);return Math.abs(we.x)<=1&&Math.abs(we.y)<=1?f:this.unproject(G.add(we),k)},_limitOffset:function(f,k){if(!k)return f;var P=this.getPixelBounds(),G=new q(P.min.add(f),P.max.add(f));return f.add(this._getBoundsOffset(G,k))},_getBoundsOffset:function(f,k,P){var G=te(this.project(k.getNorthEast(),P),this.project(k.getSouthWest(),P)),J=G.min.subtract(f.min),ue=G.max.subtract(f.max),we=this._rebound(J.x,-ue.x),Me=this._rebound(J.y,-ue.y);return new Q(we,Me)},_rebound:function(f,k){return f+k>0?Math.round(f-k)/2:Math.max(0,Math.ceil(f))-Math.max(0,Math.floor(k))},_limitZoom:function(f){var k=this.getMinZoom(),P=this.getMaxZoom(),G=Tt.any3d?this.options.zoomSnap:1;return G&&(f=Math.round(f/G)*G),Math.max(k,Math.min(P,f))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){sr(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(f,k){var P=this._getCenterOffset(f)._trunc();return(k&&k.animate)!==!0&&!this.getSize().contains(P)?!1:(this.panBy(P,k),!0)},_createAnimProxy:function(){var f=this._proxy=ct("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(f),this.on("zoomanim",function(k){var P=ot,G=this._proxy.style[P];ps(this._proxy,this.project(k.center,k.zoom),this.getZoomScale(k.zoom,1)),G===this._proxy.style[P]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){mr(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var f=this.getCenter(),k=this.getZoom();ps(this._proxy,this.project(f,k),this.getZoomScale(k,1))},_catchTransitionEnd:function(f){this._animatingZoom&&f.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(f,k,P){if(this._animatingZoom)return!0;if(P=P||{},!this._zoomAnimated||P.animate===!1||this._nothingToAnimate()||Math.abs(k-this._zoom)>this.options.zoomAnimationThreshold)return!1;var G=this.getZoomScale(k),J=this._getCenterOffset(f)._divideBy(1-1/G);return P.animate!==!0&&!this.getSize().contains(J)?!1:($(function(){this._moveStart(!0,P.noMoveStart||!1)._animateZoom(f,k,!0)},this),!0)},_animateZoom:function(f,k,P,G){this._mapPane&&(P&&(this._animatingZoom=!0,this._animateToCenter=f,this._animateToZoom=k,it(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:f,zoom:k,noUpdate:G}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(s(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&sr(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function xi(f,k){return new Cr(f,k)}var ai=H.extend({options:{position:"topright"},initialize:function(f){S(this,f)},getPosition:function(){return this.options.position},setPosition:function(f){var k=this._map;return k&&k.removeControl(this),this.options.position=f,k&&k.addControl(this),this},getContainer:function(){return this._container},addTo:function(f){this.remove(),this._map=f;var k=this._container=this.onAdd(f),P=this.getPosition(),G=f._controlCorners[P];return it(k,"leaflet-control"),P.indexOf("bottom")!==-1?G.insertBefore(k,G.firstChild):G.appendChild(k),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(mr(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(f){this._map&&f&&f.screenX>0&&f.screenY>0&&this._map.getContainer().focus()}}),ka=function(f){return new ai(f)};Cr.include({addControl:function(f){return f.addTo(this),this},removeControl:function(f){return f.remove(),this},_initControlPos:function(){var f=this._controlCorners={},k="leaflet-",P=this._controlContainer=ct("div",k+"control-container",this._container);function G(J,ue){var we=k+J+" "+k+ue;f[J+ue]=ct("div",we,P)}G("top","left"),G("top","right"),G("bottom","left"),G("bottom","right")},_clearControlPos:function(){for(var f in this._controlCorners)mr(this._controlCorners[f]);mr(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var ql=ai.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(f,k,P,G){return P<G?-1:G<P?1:0}},initialize:function(f,k,P){S(this,P),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1;for(var G in f)this._addLayer(f[G],G);for(G in k)this._addLayer(k[G],G,!0)},onAdd:function(f){this._initLayout(),this._update(),this._map=f,f.on("zoomend",this._checkDisabledLayers,this);for(var k=0;k<this._layers.length;k++)this._layers[k].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(f){return ai.prototype.addTo.call(this,f),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var f=0;f<this._layers.length;f++)this._layers[f].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(f,k){return this._addLayer(f,k),this._map?this._update():this},addOverlay:function(f,k){return this._addLayer(f,k,!0),this._map?this._update():this},removeLayer:function(f){f.off("add remove",this._onLayerChange,this);var k=this._getLayer(l(f));return k&&this._layers.splice(this._layers.indexOf(k),1),this._map?this._update():this},expand:function(){it(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var f=this._map.getSize().y-(this._container.offsetTop+50);return f<this._section.clientHeight?(it(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=f+"px"):sr(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return sr(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var f="leaflet-control-layers",k=this._container=ct("div",f),P=this.options.collapsed;k.setAttribute("aria-haspopup",!0),Lu(k),Hl(k);var G=this._section=ct("section",f+"-list");P&&(this._map.on("click",this.collapse,this),rr(k,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var J=this._layersLink=ct("a",f+"-toggle",k);J.href="#",J.title="Layers",J.setAttribute("role","button"),rr(J,{keydown:function(ue){ue.keyCode===13&&this._expandSafely()},click:function(ue){cn(ue),this._expandSafely()}},this),P||this.expand(),this._baseLayersList=ct("div",f+"-base",G),this._separator=ct("div",f+"-separator",G),this._overlaysList=ct("div",f+"-overlays",G),k.appendChild(G)},_getLayer:function(f){for(var k=0;k<this._layers.length;k++)if(this._layers[k]&&l(this._layers[k].layer)===f)return this._layers[k]},_addLayer:function(f,k,P){this._map&&f.on("add remove",this._onLayerChange,this),this._layers.push({layer:f,name:k,overlay:P}),this.options.sortLayers&&this._layers.sort(s(function(G,J){return this.options.sortFunction(G.layer,J.layer,G.name,J.name)},this)),this.options.autoZIndex&&f.setZIndex&&(this._lastZIndex++,f.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;Qr(this._baseLayersList),Qr(this._overlaysList),this._layerControlInputs=[];var f,k,P,G,J=0;for(P=0;P<this._layers.length;P++)G=this._layers[P],this._addItem(G),k=k||G.overlay,f=f||!G.overlay,J+=G.overlay?0:1;return this.options.hideSingleBase&&(f=f&&J>1,this._baseLayersList.style.display=f?"":"none"),this._separator.style.display=k&&f?"":"none",this},_onLayerChange:function(f){this._handlingClick||this._update();var k=this._getLayer(l(f.target)),P=k.overlay?f.type==="add"?"overlayadd":"overlayremove":f.type==="add"?"baselayerchange":null;P&&this._map.fire(P,k)},_createRadioElement:function(f,k){var P='<input type="radio" class="leaflet-control-layers-selector" name="'+f+'"'+(k?' checked="checked"':"")+"/>",G=document.createElement("div");return G.innerHTML=P,G.firstChild},_addItem:function(f){var k=document.createElement("label"),P=this._map.hasLayer(f.layer),G;f.overlay?(G=document.createElement("input"),G.type="checkbox",G.className="leaflet-control-layers-selector",G.defaultChecked=P):G=this._createRadioElement("leaflet-base-layers_"+l(this),P),this._layerControlInputs.push(G),G.layerId=l(f.layer),rr(G,"click",this._onInputClick,this);var J=document.createElement("span");J.innerHTML=" "+f.name;var ue=document.createElement("span");k.appendChild(ue),ue.appendChild(G),ue.appendChild(J);var we=f.overlay?this._overlaysList:this._baseLayersList;return we.appendChild(k),this._checkDisabledLayers(),k},_onInputClick:function(){if(!this._preventClick){var f=this._layerControlInputs,k,P,G=[],J=[];this._handlingClick=!0;for(var ue=f.length-1;ue>=0;ue--)k=f[ue],P=this._getLayer(k.layerId).layer,k.checked?G.push(P):k.checked||J.push(P);for(ue=0;ue<J.length;ue++)this._map.hasLayer(J[ue])&&this._map.removeLayer(J[ue]);for(ue=0;ue<G.length;ue++)this._map.hasLayer(G[ue])||this._map.addLayer(G[ue]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var f=this._layerControlInputs,k,P,G=this._map.getZoom(),J=f.length-1;J>=0;J--)k=f[J],P=this._getLayer(k.layerId).layer,k.disabled=P.options.minZoom!==void 0&&G<P.options.minZoom||P.options.maxZoom!==void 0&&G>P.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var f=this._section;this._preventClick=!0,rr(f,"click",cn),this.expand();var k=this;setTimeout(function(){qr(f,"click",cn),k._preventClick=!1})}}),al=function(f,k,P){return new ql(f,k,P)},bi=ai.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(f){var k="leaflet-control-zoom",P=ct("div",k+" leaflet-bar"),G=this.options;return this._zoomInButton=this._createButton(G.zoomInText,G.zoomInTitle,k+"-in",P,this._zoomIn),this._zoomOutButton=this._createButton(G.zoomOutText,G.zoomOutTitle,k+"-out",P,this._zoomOut),this._updateDisabled(),f.on("zoomend zoomlevelschange",this._updateDisabled,this),P},onRemove:function(f){f.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(f){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(f.shiftKey?3:1))},_zoomOut:function(f){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(f.shiftKey?3:1))},_createButton:function(f,k,P,G,J){var ue=ct("a",P,G);return ue.innerHTML=f,ue.href="#",ue.title=k,ue.setAttribute("role","button"),ue.setAttribute("aria-label",k),Lu(ue),rr(ue,"click",Fn),rr(ue,"click",J,this),rr(ue,"click",this._refocusOnMap,this),ue},_updateDisabled:function(){var f=this._map,k="leaflet-disabled";sr(this._zoomInButton,k),sr(this._zoomOutButton,k),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||f._zoom===f.getMinZoom())&&(it(this._zoomOutButton,k),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||f._zoom===f.getMaxZoom())&&(it(this._zoomInButton,k),this._zoomInButton.setAttribute("aria-disabled","true"))}});Cr.mergeOptions({zoomControl:!0}),Cr.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new bi,this.addControl(this.zoomControl))});var _a=function(f){return new bi(f)},Bn=ai.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(f){var k="leaflet-control-scale",P=ct("div",k),G=this.options;return this._addScales(G,k+"-line",P),f.on(G.updateWhenIdle?"moveend":"move",this._update,this),f.whenReady(this._update,this),P},onRemove:function(f){f.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(f,k,P){f.metric&&(this._mScale=ct("div",k,P)),f.imperial&&(this._iScale=ct("div",k,P))},_update:function(){var f=this._map,k=f.getSize().y/2,P=f.distance(f.containerPointToLatLng([0,k]),f.containerPointToLatLng([this.options.maxWidth,k]));this._updateScales(P)},_updateScales:function(f){this.options.metric&&f&&this._updateMetric(f),this.options.imperial&&f&&this._updateImperial(f)},_updateMetric:function(f){var k=this._getRoundNum(f),P=k<1e3?k+" m":k/1e3+" km";this._updateScale(this._mScale,P,k/f)},_updateImperial:function(f){var k=f*3.2808399,P,G,J;k>5280?(P=k/5280,G=this._getRoundNum(P),this._updateScale(this._iScale,G+" mi",G/P)):(J=this._getRoundNum(k),this._updateScale(this._iScale,J+" ft",J/k))},_updateScale:function(f,k,P){f.style.width=Math.round(this.options.maxWidth*P)+"px",f.innerHTML=k},_getRoundNum:function(f){var k=Math.pow(10,(Math.floor(f)+"").length-1),P=f/k;return P=P>=10?10:P>=5?5:P>=3?3:P>=2?2:1,k*P}}),ea=function(f){return new Bn(f)},gs='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',Ca=ai.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(Tt.inlineSvg?gs+" ":"")+"Leaflet</a>"},initialize:function(f){S(this,f),this._attributions={}},onAdd:function(f){f.attributionControl=this,this._container=ct("div","leaflet-control-attribution"),Lu(this._container);for(var k in f._layers)f._layers[k].getAttribution&&this.addAttribution(f._layers[k].getAttribution());return this._update(),f.on("layeradd",this._addAttribution,this),this._container},onRemove:function(f){f.off("layeradd",this._addAttribution,this)},_addAttribution:function(f){f.layer.getAttribution&&(this.addAttribution(f.layer.getAttribution()),f.layer.once("remove",function(){this.removeAttribution(f.layer.getAttribution())},this))},setPrefix:function(f){return this.options.prefix=f,this._update(),this},addAttribution:function(f){return f?(this._attributions[f]||(this._attributions[f]=0),this._attributions[f]++,this._update(),this):this},removeAttribution:function(f){return f?(this._attributions[f]&&(this._attributions[f]--,this._update()),this):this},_update:function(){if(this._map){var f=[];for(var k in this._attributions)this._attributions[k]&&f.push(k);var P=[];this.options.prefix&&P.push(this.options.prefix),f.length&&P.push(f.join(", ")),this._container.innerHTML=P.join(' <span aria-hidden="true">|</span> ')}}});Cr.mergeOptions({attributionControl:!0}),Cr.addInitHook(function(){this.options.attributionControl&&new Ca().addTo(this)});var Of=function(f){return new Ca(f)};ai.Layers=ql,ai.Zoom=bi,ai.Scale=Bn,ai.Attribution=Ca,ka.layers=al,ka.zoom=_a,ka.scale=ea,ka.attribution=Of;var ta=H.extend({initialize:function(f){this._map=f},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});ta.addTo=function(f,k){return f.addHandler(k,this),this};var Iu={Events:W},si=Tt.touch?"touchstart mousedown":"mousedown",wn=Y.extend({options:{clickTolerance:3},initialize:function(f,k,P,G){S(this,G),this._element=f,this._dragStartTarget=k||f,this._preventOutline=P},enable:function(){this._enabled||(rr(this._dragStartTarget,si,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(wn._dragging===this&&this.finishDrag(!0),qr(this._dragStartTarget,si,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(f){if(this._enabled&&(this._moved=!1,!ii(this._element,"leaflet-zoom-anim"))){if(f.touches&&f.touches.length!==1){wn._dragging===this&&this.finishDrag();return}if(!(wn._dragging||f.shiftKey||f.which!==1&&f.button!==1&&!f.touches)&&(wn._dragging=this,this._preventOutline&&wo(this._element),Cc(),wr(),!this._moving)){this.fire("down");var k=f.touches?f.touches[0]:f,P=no(this._element);this._startPoint=new Q(k.clientX,k.clientY),this._startPos=to(this._element),this._parentScale=Za(P);var G=f.type==="mousedown";rr(document,G?"mousemove":"touchmove",this._onMove,this),rr(document,G?"mouseup":"touchend touchcancel",this._onUp,this)}}},_onMove:function(f){if(this._enabled){if(f.touches&&f.touches.length>1){this._moved=!0;return}var k=f.touches&&f.touches.length===1?f.touches[0]:f,P=new Q(k.clientX,k.clientY)._subtract(this._startPoint);!P.x&&!P.y||Math.abs(P.x)+Math.abs(P.y)<this.options.clickTolerance||(P.x/=this._parentScale.x,P.y/=this._parentScale.y,cn(f),this._moved||(this.fire("dragstart"),this._moved=!0,it(document.body,"leaflet-dragging"),this._lastTarget=f.target||f.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),it(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(P),this._moving=!0,this._lastEvent=f,this._updatePosition())}},_updatePosition:function(){var f={originalEvent:this._lastEvent};this.fire("predrag",f),In(this._element,this._newPos),this.fire("drag",f)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(f){sr(document.body,"leaflet-dragging"),this._lastTarget&&(sr(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),qr(document,"mousemove touchmove",this._onMove,this),qr(document,"mouseup touchend touchcancel",this._onUp,this),Ec(),ro();var k=this._moved&&this._moving;this._moving=!1,wn._dragging=!1,k&&this.fire("dragend",{noInertia:f,distance:this._newPos.distanceTo(this._startPos)})}});function Jr(f,k,P){var G,J=[1,4,2,8],ue,we,Me,Ie,Ze,kt,$t,hr;for(ue=0,kt=f.length;ue<kt;ue++)f[ue]._code=Is(f[ue],k);for(Me=0;Me<4;Me++){for($t=J[Me],G=[],ue=0,kt=f.length,we=kt-1;ue<kt;we=ue++)Ie=f[ue],Ze=f[we],Ie._code&$t?Ze._code&$t||(hr=Pc(Ze,Ie,$t,k,P),hr._code=Is(hr,k),G.push(hr)):(Ze._code&$t&&(hr=Pc(Ze,Ie,$t,k,P),hr._code=Is(hr,k),G.push(hr)),G.push(Ie));f=G}return f}function $l(f,k){var P,G,J,ue,we,Me,Ie,Ze,kt;if(!f||f.length===0)throw new Error("latlngs not passed");Gi(f)||(console.warn("latlngs are not flat! Only the first ring will be used"),f=f[0]);var $t=ye([0,0]),hr=de(f),Kr=hr.getNorthWest().distanceTo(hr.getSouthWest())*hr.getNorthEast().distanceTo(hr.getNorthWest());Kr<1700&&($t=Ea(f));var Gn=f.length,Li=[];for(P=0;P<Gn;P++){var Vi=ye(f[P]);Li.push(k.project(ye([Vi.lat-$t.lat,Vi.lng-$t.lng])))}for(Me=Ie=Ze=0,P=0,G=Gn-1;P<Gn;G=P++)J=Li[P],ue=Li[G],we=J.y*ue.x-ue.y*J.x,Ie+=(J.x+ue.x)*we,Ze+=(J.y+ue.y)*we,Me+=we*3;Me===0?kt=Li[0]:kt=[Ie/Me,Ze/Me];var pl=k.unproject(re(kt));return ye([pl.lat+$t.lat,pl.lng+$t.lng])}function Ea(f){for(var k=0,P=0,G=0,J=0;J<f.length;J++){var ue=ye(f[J]);k+=ue.lat,P+=ue.lng,G++}return ye([k/G,P/G])}var Df={__proto__:null,clipPolygon:Jr,polygonCenter:$l,centroid:Ea};function ju(f,k){if(!k||!f.length)return f.slice();var P=k*k;return f=jf(f,P),f=If(f,P),f}function Tc(f,k,P){return Math.sqrt(vs(f,k,P,!0))}function vh(f,k,P){return vs(f,k,P)}function If(f,k){var P=f.length,G=typeof Uint8Array<"u"?Uint8Array:Array,J=new G(P);J[0]=J[P-1]=1,Kl(f,J,k,0,P-1);var ue,we=[];for(ue=0;ue<P;ue++)J[ue]&&we.push(f[ue]);return we}function Kl(f,k,P,G,J){var ue=0,we,Me,Ie;for(Me=G+1;Me<=J-1;Me++)Ie=vs(f[Me],f[G],f[J],!0),Ie>ue&&(we=Me,ue=Ie);ue>P&&(k[we]=1,Kl(f,k,P,G,we),Kl(f,k,P,we,J))}function jf(f,k){for(var P=[f[0]],G=1,J=0,ue=f.length;G<ue;G++)ym(f[G],f[J])>k&&(P.push(f[G]),J=G);return J<ue-1&&P.push(f[ue-1]),P}var ko;function Nc(f,k,P,G,J){var ue=G?ko:Is(f,P),we=Is(k,P),Me,Ie,Ze;for(ko=we;;){if(!(ue|we))return[f,k];if(ue&we)return!1;Me=ue||we,Ie=Pc(f,k,Me,P,J),Ze=Is(Ie,P),Me===ue?(f=Ie,ue=Ze):(k=Ie,we=Ze)}}function Pc(f,k,P,G,J){var ue=k.x-f.x,we=k.y-f.y,Me=G.min,Ie=G.max,Ze,kt;return P&8?(Ze=f.x+ue*(Ie.y-f.y)/we,kt=Ie.y):P&4?(Ze=f.x+ue*(Me.y-f.y)/we,kt=Me.y):P&2?(Ze=Ie.x,kt=f.y+we*(Ie.x-f.x)/ue):P&1&&(Ze=Me.x,kt=f.y+we*(Me.x-f.x)/ue),new Q(Ze,kt,J)}function Is(f,k){var P=0;return f.x<k.min.x?P|=1:f.x>k.max.x&&(P|=2),f.y<k.min.y?P|=4:f.y>k.max.y&&(P|=8),P}function ym(f,k){var P=k.x-f.x,G=k.y-f.y;return P*P+G*G}function vs(f,k,P,G){var J=k.x,ue=k.y,we=P.x-J,Me=P.y-ue,Ie=we*we+Me*Me,Ze;return Ie>0&&(Ze=((f.x-J)*we+(f.y-ue)*Me)/Ie,Ze>1?(J=P.x,ue=P.y):Ze>0&&(J+=we*Ze,ue+=Me*Ze)),we=f.x-J,Me=f.y-ue,G?we*we+Me*Me:new Q(J,ue)}function Gi(f){return!C(f[0])||typeof f[0][0]!="object"&&typeof f[0][0]<"u"}function yh(f){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),Gi(f)}function xh(f,k){var P,G,J,ue,we,Me,Ie,Ze;if(!f||f.length===0)throw new Error("latlngs not passed");Gi(f)||(console.warn("latlngs are not flat! Only the first ring will be used"),f=f[0]);var kt=ye([0,0]),$t=de(f),hr=$t.getNorthWest().distanceTo($t.getSouthWest())*$t.getNorthEast().distanceTo($t.getNorthWest());hr<1700&&(kt=Ea(f));var Kr=f.length,Gn=[];for(P=0;P<Kr;P++){var Li=ye(f[P]);Gn.push(k.project(ye([Li.lat-kt.lat,Li.lng-kt.lng])))}for(P=0,G=0;P<Kr-1;P++)G+=Gn[P].distanceTo(Gn[P+1])/2;if(G===0)Ze=Gn[0];else for(P=0,ue=0;P<Kr-1;P++)if(we=Gn[P],Me=Gn[P+1],J=we.distanceTo(Me),ue+=J,ue>G){Ie=(ue-G)/J,Ze=[Me.x-Ie*(Me.x-we.x),Me.y-Ie*(Me.y-we.y)];break}var Vi=k.unproject(re(Ze));return ye([Vi.lat+kt.lat,Vi.lng+kt.lng])}var sl={__proto__:null,simplify:ju,pointToSegmentDistance:Tc,closestPointOnSegment:vh,clipSegment:Nc,_getEdgeIntersection:Pc,_getBitCode:Is,_sqClosestPointOnSegment:vs,isFlat:Gi,_flat:yh,polylineCenter:xh},Mc={project:function(f){return new Q(f.lng,f.lat)},unproject:function(f){return new ge(f.y,f.x)},bounds:new q([-180,-90],[180,90])},Zl={R:6378137,R_MINOR:6356752314245179e-9,bounds:new q([-2003750834279e-5,-1549657073972e-5],[2003750834279e-5,1876465623138e-5]),project:function(f){var k=Math.PI/180,P=this.R,G=f.lat*k,J=this.R_MINOR/P,ue=Math.sqrt(1-J*J),we=ue*Math.sin(G),Me=Math.tan(Math.PI/4-G/2)/Math.pow((1-we)/(1+we),ue/2);return G=-P*Math.log(Math.max(Me,1e-10)),new Q(f.lng*k*P,G)},unproject:function(f){for(var k=180/Math.PI,P=this.R,G=this.R_MINOR/P,J=Math.sqrt(1-G*G),ue=Math.exp(-f.y/P),we=Math.PI/2-2*Math.atan(ue),Me=0,Ie=.1,Ze;Me<15&&Math.abs(Ie)>1e-7;Me++)Ze=J*Math.sin(we),Ze=Math.pow((1-Ze)/(1+Ze),J/2),Ie=Math.PI/2-2*Math.atan(ue*Ze)-we,we+=Ie;return new ge(we*k,f.x*k/P)}},Ac={__proto__:null,LonLat:Mc,Mercator:Zl,SphericalMercator:pe},Yl=i({},fe,{code:"EPSG:3395",projection:Zl,transformation:(function(){var f=.5/(Math.PI*Zl.R);return xe(f,.5,-f,.5)})()}),Rc=i({},fe,{code:"EPSG:4326",projection:Mc,transformation:xe(1/180,1,-1/180,.5)}),bh=i({},se,{projection:Mc,transformation:xe(1,0,-1,0),scale:function(f){return Math.pow(2,f)},zoom:function(f){return Math.log(f)/Math.LN2},distance:function(f,k){var P=k.lng-f.lng,G=k.lat-f.lat;return Math.sqrt(P*P+G*G)},infinite:!0});se.Earth=fe,se.EPSG3395=Yl,se.EPSG3857=Se,se.EPSG900913=Ve,se.EPSG4326=Rc,se.Simple=bh;var Ya=Y.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(f){return f.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(f){return f&&f.removeLayer(this),this},getPane:function(f){return this._map.getPane(f?this.options[f]||f:this.options.pane)},addInteractiveTarget:function(f){return this._map._targets[l(f)]=this,this},removeInteractiveTarget:function(f){return delete this._map._targets[l(f)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(f){var k=f.target;if(k.hasLayer(this)){if(this._map=k,this._zoomAnimated=k._zoomAnimated,this.getEvents){var P=this.getEvents();k.on(P,this),this.once("remove",function(){k.off(P,this)},this)}this.onAdd(k),this.fire("add"),k.fire("layeradd",{layer:this})}}});Cr.include({addLayer:function(f){if(!f._layerAdd)throw new Error("The provided object is not a Layer.");var k=l(f);return this._layers[k]?this:(this._layers[k]=f,f._mapToAdd=this,f.beforeAdd&&f.beforeAdd(this),this.whenReady(f._layerAdd,f),this)},removeLayer:function(f){var k=l(f);return this._layers[k]?(this._loaded&&f.onRemove(this),delete this._layers[k],this._loaded&&(this.fire("layerremove",{layer:f}),f.fire("remove")),f._map=f._mapToAdd=null,this):this},hasLayer:function(f){return l(f)in this._layers},eachLayer:function(f,k){for(var P in this._layers)f.call(k,this._layers[P]);return this},_addLayers:function(f){f=f?C(f)?f:[f]:[];for(var k=0,P=f.length;k<P;k++)this.addLayer(f[k])},_addZoomLimit:function(f){(!isNaN(f.options.maxZoom)||!isNaN(f.options.minZoom))&&(this._zoomBoundLayers[l(f)]=f,this._updateZoomLevels())},_removeZoomLimit:function(f){var k=l(f);this._zoomBoundLayers[k]&&(delete this._zoomBoundLayers[k],this._updateZoomLevels())},_updateZoomLevels:function(){var f=1/0,k=-1/0,P=this._getZoomSpan();for(var G in this._zoomBoundLayers){var J=this._zoomBoundLayers[G].options;f=J.minZoom===void 0?f:Math.min(f,J.minZoom),k=J.maxZoom===void 0?k:Math.max(k,J.maxZoom)}this._layersMaxZoom=k===-1/0?void 0:k,this._layersMinZoom=f===1/0?void 0:f,P!==this._getZoomSpan()&&this.fire("zoomlevelschange"),this.options.maxZoom===void 0&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),this.options.minZoom===void 0&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var js=Ya.extend({initialize:function(f,k){S(this,k),this._layers={};var P,G;if(f)for(P=0,G=f.length;P<G;P++)this.addLayer(f[P])},addLayer:function(f){var k=this.getLayerId(f);return this._layers[k]=f,this._map&&this._map.addLayer(f),this},removeLayer:function(f){var k=f in this._layers?f:this.getLayerId(f);return this._map&&this._layers[k]&&this._map.removeLayer(this._layers[k]),delete this._layers[k],this},hasLayer:function(f){var k=typeof f=="number"?f:this.getLayerId(f);return k in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(f){var k=Array.prototype.slice.call(arguments,1),P,G;for(P in this._layers)G=this._layers[P],G[f]&&G[f].apply(G,k);return this},onAdd:function(f){this.eachLayer(f.addLayer,f)},onRemove:function(f){this.eachLayer(f.removeLayer,f)},eachLayer:function(f,k){for(var P in this._layers)f.call(k,this._layers[P]);return this},getLayer:function(f){return this._layers[f]},getLayers:function(){var f=[];return this.eachLayer(f.push,f),f},setZIndex:function(f){return this.invoke("setZIndex",f)},getLayerId:function(f){return l(f)}}),ol=function(f,k){return new js(f,k)},ra=js.extend({addLayer:function(f){return this.hasLayer(f)?this:(f.addEventParent(this),js.prototype.addLayer.call(this,f),this.fire("layeradd",{layer:f}))},removeLayer:function(f){return this.hasLayer(f)?(f in this._layers&&(f=this._layers[f]),f.removeEventParent(this),js.prototype.removeLayer.call(this,f),this.fire("layerremove",{layer:f})):this},setStyle:function(f){return this.invoke("setStyle",f)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var f=new ae;for(var k in this._layers){var P=this._layers[k];f.extend(P.getBounds?P.getBounds():P.getLatLng())}return f}}),Ta=function(f,k){return new ra(f,k)},Na=H.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(f){S(this,f)},createIcon:function(f){return this._createIcon("icon",f)},createShadow:function(f){return this._createIcon("shadow",f)},_createIcon:function(f,k){var P=this._getIconUrl(f);if(!P){if(f==="icon")throw new Error("iconUrl not set in Icon options (see the docs).");return null}var G=this._createImg(P,k&&k.tagName==="IMG"?k:null);return this._setIconStyles(G,f),(this.options.crossOrigin||this.options.crossOrigin==="")&&(G.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),G},_setIconStyles:function(f,k){var P=this.options,G=P[k+"Size"];typeof G=="number"&&(G=[G,G]);var J=re(G),ue=re(k==="shadow"&&P.shadowAnchor||P.iconAnchor||J&&J.divideBy(2,!0));f.className="leaflet-marker-"+k+" "+(P.className||""),ue&&(f.style.marginLeft=-ue.x+"px",f.style.marginTop=-ue.y+"px"),J&&(f.style.width=J.x+"px",f.style.height=J.y+"px")},_createImg:function(f,k){return k=k||document.createElement("img"),k.src=f,k},_getIconUrl:function(f){return Tt.retina&&this.options[f+"RetinaUrl"]||this.options[f+"Url"]}});function Lc(f){return new Na(f)}var ll=Na.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(f){return typeof ll.imagePath!="string"&&(ll.imagePath=this._detectIconPath()),(this.options.imagePath||ll.imagePath)+Na.prototype._getIconUrl.call(this,f)},_stripUrl:function(f){var k=function(P,G,J){var ue=G.exec(P);return ue&&ue[J]};return f=k(f,/^url\((['"])?(.+)\1\)$/,2),f&&k(f,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var f=ct("div","leaflet-default-icon-path",document.body),k=gr(f,"background-image")||gr(f,"backgroundImage");if(document.body.removeChild(f),k=this._stripUrl(k),k)return k;var P=document.querySelector('link[href$="leaflet.css"]');return P?P.href.substring(0,P.href.length-11-1):""}}),Xa=ta.extend({initialize:function(f){this._marker=f},addHooks:function(){var f=this._marker._icon;this._draggable||(this._draggable=new wn(f,f,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),it(f,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&sr(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(f){var k=this._marker,P=k._map,G=this._marker.options.autoPanSpeed,J=this._marker.options.autoPanPadding,ue=to(k._icon),we=P.getPixelBounds(),Me=P.getPixelOrigin(),Ie=te(we.min._subtract(Me).add(J),we.max._subtract(Me).subtract(J));if(!Ie.contains(ue)){var Ze=re((Math.max(Ie.max.x,ue.x)-Ie.max.x)/(we.max.x-Ie.max.x)-(Math.min(Ie.min.x,ue.x)-Ie.min.x)/(we.min.x-Ie.min.x),(Math.max(Ie.max.y,ue.y)-Ie.max.y)/(we.max.y-Ie.max.y)-(Math.min(Ie.min.y,ue.y)-Ie.min.y)/(we.min.y-Ie.min.y)).multiplyBy(G);P.panBy(Ze,{animate:!1}),this._draggable._newPos._add(Ze),this._draggable._startPos._add(Ze),In(k._icon,this._draggable._newPos),this._onDrag(f),this._panRequest=$(this._adjustPan.bind(this,f))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(f){this._marker.options.autoPan&&(Z(this._panRequest),this._panRequest=$(this._adjustPan.bind(this,f)))},_onDrag:function(f){var k=this._marker,P=k._shadow,G=to(k._icon),J=k._map.layerPointToLatLng(G);P&&In(P,G),k._latlng=J,f.latlng=J,f.oldLatLng=this._oldLatLng,k.fire("move",f).fire("drag",f)},_onDragEnd:function(f){Z(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",f)}}),Ai=Ya.extend({options:{icon:new ll,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(f,k){S(this,k),this._latlng=ye(f)},onAdd:function(f){this._zoomAnimated=this._zoomAnimated&&f.options.markerZoomAnimation,this._zoomAnimated&&f.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(f){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&f.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(f){var k=this._latlng;return this._latlng=ye(f),this.update(),this.fire("move",{oldLatLng:k,latlng:this._latlng})},setZIndexOffset:function(f){return this.options.zIndexOffset=f,this.update()},getIcon:function(){return this.options.icon},setIcon:function(f){return this.options.icon=f,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var f=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(f)}return this},_initIcon:function(){var f=this.options,k="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),P=f.icon.createIcon(this._icon),G=!1;P!==this._icon&&(this._icon&&this._removeIcon(),G=!0,f.title&&(P.title=f.title),P.tagName==="IMG"&&(P.alt=f.alt||"")),it(P,k),f.keyboard&&(P.tabIndex="0",P.setAttribute("role","button")),this._icon=P,f.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&rr(P,"focus",this._panOnFocus,this);var J=f.icon.createShadow(this._shadow),ue=!1;J!==this._shadow&&(this._removeShadow(),ue=!0),J&&(it(J,k),J.alt=""),this._shadow=J,f.opacity<1&&this._updateOpacity(),G&&this.getPane().appendChild(this._icon),this._initInteraction(),J&&ue&&this.getPane(f.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&qr(this._icon,"focus",this._panOnFocus,this),mr(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&mr(this._shadow),this._shadow=null},_setPos:function(f){this._icon&&In(this._icon,f),this._shadow&&In(this._shadow,f),this._zIndex=f.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(f){this._icon&&(this._icon.style.zIndex=this._zIndex+f)},_animateZoom:function(f){var k=this._map._latLngToNewLayerPoint(this._latlng,f.zoom,f.center).round();this._setPos(k)},_initInteraction:function(){if(this.options.interactive&&(it(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),Xa)){var f=this.options.draggable;this.dragging&&(f=this.dragging.enabled(),this.dragging.disable()),this.dragging=new Xa(this),f&&this.dragging.enable()}},setOpacity:function(f){return this.options.opacity=f,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var f=this.options.opacity;this._icon&&Dn(this._icon,f),this._shadow&&Dn(this._shadow,f)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var f=this._map;if(f){var k=this.options.icon.options,P=k.iconSize?re(k.iconSize):re(0,0),G=k.iconAnchor?re(k.iconAnchor):re(0,0);f.panInside(this._latlng,{paddingTopLeft:G,paddingBottomRight:P.subtract(G)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function wh(f,k){return new Ai(f,k)}var io=Ya.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(f){this._renderer=f.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(f){return S(this,f),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&f&&Object.prototype.hasOwnProperty.call(f,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),Qa=io.extend({options:{fill:!0,radius:10},initialize:function(f,k){S(this,k),this._latlng=ye(f),this._radius=this.options.radius},setLatLng:function(f){var k=this._latlng;return this._latlng=ye(f),this.redraw(),this.fire("move",{oldLatLng:k,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(f){return this.options.radius=this._radius=f,this.redraw()},getRadius:function(){return this._radius},setStyle:function(f){var k=f&&f.radius||this._radius;return io.prototype.setStyle.call(this,f),this.setRadius(k),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var f=this._radius,k=this._radiusY||f,P=this._clickTolerance(),G=[f+P,k+P];this._pxBounds=new q(this._point.subtract(G),this._point.add(G))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(f){return f.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function ao(f,k){return new Qa(f,k)}var ul=Qa.extend({initialize:function(f,k,P){if(typeof k=="number"&&(k=i({},P,{radius:k})),S(this,k),this._latlng=ye(f),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(f){return this._mRadius=f,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var f=[this._radius,this._radiusY||this._radius];return new ae(this._map.layerPointToLatLng(this._point.subtract(f)),this._map.layerPointToLatLng(this._point.add(f)))},setStyle:io.prototype.setStyle,_project:function(){var f=this._latlng.lng,k=this._latlng.lat,P=this._map,G=P.options.crs;if(G.distance===fe.distance){var J=Math.PI/180,ue=this._mRadius/fe.R/J,we=P.project([k+ue,f]),Me=P.project([k-ue,f]),Ie=we.add(Me).divideBy(2),Ze=P.unproject(Ie).lat,kt=Math.acos((Math.cos(ue*J)-Math.sin(k*J)*Math.sin(Ze*J))/(Math.cos(k*J)*Math.cos(Ze*J)))/J;(isNaN(kt)||kt===0)&&(kt=ue/Math.cos(Math.PI/180*k)),this._point=Ie.subtract(P.getPixelOrigin()),this._radius=isNaN(kt)?0:Ie.x-P.project([Ze,f-kt]).x,this._radiusY=Ie.y-we.y}else{var $t=G.unproject(G.project(this._latlng).subtract([this._mRadius,0]));this._point=P.latLngToLayerPoint(this._latlng),this._radius=this._point.x-P.latLngToLayerPoint($t).x}this._updateBounds()}});function Xl(f,k,P){return new ul(f,k,P)}var Ri=io.extend({options:{smoothFactor:1,noClip:!1},initialize:function(f,k){S(this,k),this._setLatLngs(f)},getLatLngs:function(){return this._latlngs},setLatLngs:function(f){return this._setLatLngs(f),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(f){for(var k=1/0,P=null,G=vs,J,ue,we=0,Me=this._parts.length;we<Me;we++)for(var Ie=this._parts[we],Ze=1,kt=Ie.length;Ze<kt;Ze++){J=Ie[Ze-1],ue=Ie[Ze];var $t=G(f,J,ue,!0);$t<k&&(k=$t,P=G(f,J,ue))}return P&&(P.distance=Math.sqrt(k)),P},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return xh(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(f,k){return k=k||this._defaultShape(),f=ye(f),k.push(f),this._bounds.extend(f),this.redraw()},_setLatLngs:function(f){this._bounds=new ae,this._latlngs=this._convertLatLngs(f)},_defaultShape:function(){return Gi(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(f){for(var k=[],P=Gi(f),G=0,J=f.length;G<J;G++)P?(k[G]=ye(f[G]),this._bounds.extend(k[G])):k[G]=this._convertLatLngs(f[G]);return k},_project:function(){var f=new q;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,f),this._bounds.isValid()&&f.isValid()&&(this._rawPxBounds=f,this._updateBounds())},_updateBounds:function(){var f=this._clickTolerance(),k=new Q(f,f);this._rawPxBounds&&(this._pxBounds=new q([this._rawPxBounds.min.subtract(k),this._rawPxBounds.max.add(k)]))},_projectLatlngs:function(f,k,P){var G=f[0]instanceof ge,J=f.length,ue,we;if(G){for(we=[],ue=0;ue<J;ue++)we[ue]=this._map.latLngToLayerPoint(f[ue]),P.extend(we[ue]);k.push(we)}else for(ue=0;ue<J;ue++)this._projectLatlngs(f[ue],k,P)},_clipPoints:function(){var f=this._renderer._bounds;if(this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(f))){if(this.options.noClip){this._parts=this._rings;return}var k=this._parts,P,G,J,ue,we,Me,Ie;for(P=0,J=0,ue=this._rings.length;P<ue;P++)for(Ie=this._rings[P],G=0,we=Ie.length;G<we-1;G++)Me=Nc(Ie[G],Ie[G+1],f,G,!0),Me&&(k[J]=k[J]||[],k[J].push(Me[0]),(Me[1]!==Ie[G+1]||G===we-2)&&(k[J].push(Me[1]),J++))}},_simplifyPoints:function(){for(var f=this._parts,k=this.options.smoothFactor,P=0,G=f.length;P<G;P++)f[P]=ju(f[P],k)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(f,k){var P,G,J,ue,we,Me,Ie=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(f))return!1;for(P=0,ue=this._parts.length;P<ue;P++)for(Me=this._parts[P],G=0,we=Me.length,J=we-1;G<we;J=G++)if(!(!k&&G===0)&&Tc(f,Me[J],Me[G])<=Ie)return!0;return!1}});function Ff(f,k){return new Ri(f,k)}Ri._flat=yh;var Pa=Ri.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return $l(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(f){var k=Ri.prototype._convertLatLngs.call(this,f),P=k.length;return P>=2&&k[0]instanceof ge&&k[0].equals(k[P-1])&&k.pop(),k},_setLatLngs:function(f){Ri.prototype._setLatLngs.call(this,f),Gi(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return Gi(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var f=this._renderer._bounds,k=this.options.weight,P=new Q(k,k);if(f=new q(f.min.subtract(P),f.max.add(P)),this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(f))){if(this.options.noClip){this._parts=this._rings;return}for(var G=0,J=this._rings.length,ue;G<J;G++)ue=Jr(this._rings[G],f,!0),ue.length&&this._parts.push(ue)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(f){var k=!1,P,G,J,ue,we,Me,Ie,Ze;if(!this._pxBounds||!this._pxBounds.contains(f))return!1;for(ue=0,Ie=this._parts.length;ue<Ie;ue++)for(P=this._parts[ue],we=0,Ze=P.length,Me=Ze-1;we<Ze;Me=we++)G=P[we],J=P[Me],G.y>f.y!=J.y>f.y&&f.x<(J.x-G.x)*(f.y-G.y)/(J.y-G.y)+G.x&&(k=!k);return k||Ri.prototype._containsPoint.call(this,f,!0)}});function Ja(f,k){return new Pa(f,k)}var na=ra.extend({initialize:function(f,k){S(this,k),this._layers={},f&&this.addData(f)},addData:function(f){var k=C(f)?f:f.features,P,G,J;if(k){for(P=0,G=k.length;P<G;P++)J=k[P],(J.geometries||J.geometry||J.features||J.coordinates)&&this.addData(J);return this}var ue=this.options;if(ue.filter&&!ue.filter(f))return this;var we=ys(f,ue);return we?(we.feature=cl(f),we.defaultOptions=we.options,this.resetStyle(we),ue.onEachFeature&&ue.onEachFeature(f,we),this.addLayer(we)):this},resetStyle:function(f){return f===void 0?this.eachLayer(this.resetStyle,this):(f.options=i({},f.defaultOptions),this._setLayerStyle(f,this.options.style),this)},setStyle:function(f){return this.eachLayer(function(k){this._setLayerStyle(k,f)},this)},_setLayerStyle:function(f,k){f.setStyle&&(typeof k=="function"&&(k=k(f.feature)),f.setStyle(k))}});function ys(f,k){var P=f.type==="Feature"?f.geometry:f,G=P?P.coordinates:null,J=[],ue=k&&k.pointToLayer,we=k&&k.coordsToLatLng||Ql,Me,Ie,Ze,kt;if(!G&&!P)return null;switch(P.type){case"Point":return Me=we(G),Ma(ue,f,Me,k);case"MultiPoint":for(Ze=0,kt=G.length;Ze<kt;Ze++)Me=we(G[Ze]),J.push(Ma(ue,f,Me,k));return new ra(J);case"LineString":case"MultiLineString":return Ie=Fs(G,P.type==="LineString"?0:1,we),new Ri(Ie,k);case"Polygon":case"MultiPolygon":return Ie=Fs(G,P.type==="Polygon"?1:2,we),new Pa(Ie,k);case"GeometryCollection":for(Ze=0,kt=P.geometries.length;Ze<kt;Ze++){var $t=ys({geometry:P.geometries[Ze],type:"Feature",properties:f.properties},k);$t&&J.push($t)}return new ra(J);case"FeatureCollection":for(Ze=0,kt=P.features.length;Ze<kt;Ze++){var hr=ys(P.features[Ze],k);hr&&J.push(hr)}return new ra(J);default:throw new Error("Invalid GeoJSON object.")}}function Ma(f,k,P,G){return f?f(k,P):new Ai(P,G&&G.markersInheritOptions&&G)}function Ql(f){return new ge(f[1],f[0],f[2])}function Fs(f,k,P){for(var G=[],J=0,ue=f.length,we;J<ue;J++)we=k?Fs(f[J],k-1,P):(P||Ql)(f[J]),G.push(we);return G}function Fu(f,k){return f=ye(f),f.alt!==void 0?[p(f.lng,k),p(f.lat,k),p(f.alt,k)]:[p(f.lng,k),p(f.lat,k)]}function Jl(f,k,P,G){for(var J=[],ue=0,we=f.length;ue<we;ue++)J.push(k?Jl(f[ue],Gi(f[ue])?0:k-1,P,G):Fu(f[ue],G));return!k&&P&&J.length>0&&J.push(J[0].slice()),J}function Gr(f,k){return f.feature?i({},f.feature,{geometry:k}):cl(k)}function cl(f){return f.type==="Feature"||f.type==="FeatureCollection"?f:{type:"Feature",properties:{},geometry:f}}var Bu={toGeoJSON:function(f){return Gr(this,{type:"Point",coordinates:Fu(this.getLatLng(),f)})}};Ai.include(Bu),ul.include(Bu),Qa.include(Bu),Ri.include({toGeoJSON:function(f){var k=!Gi(this._latlngs),P=Jl(this._latlngs,k?1:0,!1,f);return Gr(this,{type:(k?"Multi":"")+"LineString",coordinates:P})}}),Pa.include({toGeoJSON:function(f){var k=!Gi(this._latlngs),P=k&&!Gi(this._latlngs[0]),G=Jl(this._latlngs,P?2:k?1:0,!0,f);return k||(G=[G]),Gr(this,{type:(P?"Multi":"")+"Polygon",coordinates:G})}}),js.include({toMultiPoint:function(f){var k=[];return this.eachLayer(function(P){k.push(P.toGeoJSON(f).geometry.coordinates)}),Gr(this,{type:"MultiPoint",coordinates:k})},toGeoJSON:function(f){var k=this.feature&&this.feature.geometry&&this.feature.geometry.type;if(k==="MultiPoint")return this.toMultiPoint(f);var P=k==="GeometryCollection",G=[];return this.eachLayer(function(J){if(J.toGeoJSON){var ue=J.toGeoJSON(f);if(P)G.push(ue.geometry);else{var we=cl(ue);we.type==="FeatureCollection"?G.push.apply(G,we.features):G.push(we)}}}),P?Gr(this,{geometries:G,type:"GeometryCollection"}):{type:"FeatureCollection",features:G}}});function Oc(f,k){return new na(f,k)}var ia=Oc,Bs=Ya.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(f,k,P){this._url=f,this._bounds=de(k),S(this,P)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(it(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){mr(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(f){return this.options.opacity=f,this._image&&this._updateOpacity(),this},setStyle:function(f){return f.opacity&&this.setOpacity(f.opacity),this},bringToFront:function(){return this._map&&Ur(this._image),this},bringToBack:function(){return this._map&&Or(this._image),this},setUrl:function(f){return this._url=f,this._image&&(this._image.src=f),this},setBounds:function(f){return this._bounds=de(f),this._map&&this._reset(),this},getEvents:function(){var f={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(f.zoomanim=this._animateZoom),f},setZIndex:function(f){return this.options.zIndex=f,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var f=this._url.tagName==="IMG",k=this._image=f?this._url:ct("img");if(it(k,"leaflet-image-layer"),this._zoomAnimated&&it(k,"leaflet-zoom-animated"),this.options.className&&it(k,this.options.className),k.onselectstart=h,k.onmousemove=h,k.onload=s(this.fire,this,"load"),k.onerror=s(this._overlayOnError,this,"error"),(this.options.crossOrigin||this.options.crossOrigin==="")&&(k.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),f){this._url=k.src;return}k.src=this._url,k.alt=this.options.alt},_animateZoom:function(f){var k=this._map.getZoomScale(f.zoom),P=this._map._latLngBoundsToNewLayerBounds(this._bounds,f.zoom,f.center).min;ps(this._image,P,k)},_reset:function(){var f=this._image,k=new q(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),P=k.getSize();In(f,k.min),f.style.width=P.x+"px",f.style.height=P.y+"px"},_updateOpacity:function(){Dn(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var f=this.options.errorOverlayUrl;f&&this._url!==f&&(this._url=f,this._image.src=f)},getCenter:function(){return this._bounds.getCenter()}}),_o=function(f,k,P){return new Bs(f,k,P)},an=Bs.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var f=this._url.tagName==="VIDEO",k=this._image=f?this._url:ct("video");if(it(k,"leaflet-image-layer"),this._zoomAnimated&&it(k,"leaflet-zoom-animated"),this.options.className&&it(k,this.options.className),k.onselectstart=h,k.onmousemove=h,k.onloadeddata=s(this.fire,this,"load"),f){for(var P=k.getElementsByTagName("source"),G=[],J=0;J<P.length;J++)G.push(P[J].src);this._url=P.length>0?G:[k.src];return}C(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(k.style,"objectFit")&&(k.style.objectFit="fill"),k.autoplay=!!this.options.autoplay,k.loop=!!this.options.loop,k.muted=!!this.options.muted,k.playsInline=!!this.options.playsInline;for(var ue=0;ue<this._url.length;ue++){var we=ct("source");we.src=this._url[ue],k.appendChild(we)}}});function zn(f,k,P){return new an(f,k,P)}var Un=Bs.extend({_initImage:function(){var f=this._image=this._url;it(f,"leaflet-image-layer"),this._zoomAnimated&&it(f,"leaflet-zoom-animated"),this.options.className&&it(f,this.options.className),f.onselectstart=h,f.onmousemove=h}});function eu(f,k,P){return new Un(f,k,P)}var aa=Ya.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(f,k){f&&(f instanceof ge||C(f))?(this._latlng=ye(f),S(this,k)):(S(this,f),this._source=k),this.options.content&&(this._content=this.options.content)},openOn:function(f){return f=arguments.length?f:this._source._map,f.hasLayer(this)||f.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(f){return this._map?this.close():(arguments.length?this._source=f:f=this._source,this._prepareOpen(),this.openOn(f._map)),this},onAdd:function(f){this._zoomAnimated=f._zoomAnimated,this._container||this._initLayout(),f._fadeAnimated&&Dn(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),f._fadeAnimated&&Dn(this._container,1),this.bringToFront(),this.options.interactive&&(it(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(f){f._fadeAnimated?(Dn(this._container,0),this._removeTimeout=setTimeout(s(mr,void 0,this._container),200)):mr(this._container),this.options.interactive&&(sr(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(f){return this._latlng=ye(f),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(f){return this._content=f,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var f={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(f.zoomanim=this._animateZoom),f},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&Ur(this._container),this},bringToBack:function(){return this._map&&Or(this._container),this},_prepareOpen:function(f){var k=this._source;if(!k._map)return!1;if(k instanceof ra){k=null;var P=this._source._layers;for(var G in P)if(P[G]._map){k=P[G];break}if(!k)return!1;this._source=k}if(!f)if(k.getCenter)f=k.getCenter();else if(k.getLatLng)f=k.getLatLng();else if(k.getBounds)f=k.getBounds().getCenter();else throw new Error("Unable to get source layer LatLng.");return this.setLatLng(f),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var f=this._contentNode,k=typeof this._content=="function"?this._content(this._source||this):this._content;if(typeof k=="string")f.innerHTML=k;else{for(;f.hasChildNodes();)f.removeChild(f.firstChild);f.appendChild(k)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var f=this._map.latLngToLayerPoint(this._latlng),k=re(this.options.offset),P=this._getAnchor();this._zoomAnimated?In(this._container,f.add(P)):k=k.add(f).add(P);var G=this._containerBottom=-k.y,J=this._containerLeft=-Math.round(this._containerWidth/2)+k.x;this._container.style.bottom=G+"px",this._container.style.left=J+"px"}},_getAnchor:function(){return[0,0]}});Cr.include({_initOverlay:function(f,k,P,G){var J=k;return J instanceof f||(J=new f(G).setContent(k)),P&&J.setLatLng(P),J}}),Ya.include({_initOverlay:function(f,k,P,G){var J=P;return J instanceof f?(S(J,G),J._source=this):(J=k&&!G?k:new f(G,this),J.setContent(P)),J}});var Co=aa.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(f){return f=arguments.length?f:this._source._map,!f.hasLayer(this)&&f._popup&&f._popup.options.autoClose&&f.removeLayer(f._popup),f._popup=this,aa.prototype.openOn.call(this,f)},onAdd:function(f){aa.prototype.onAdd.call(this,f),f.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof io||this._source.on("preclick",Os))},onRemove:function(f){aa.prototype.onRemove.call(this,f),f.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof io||this._source.off("preclick",Os))},getEvents:function(){var f=aa.prototype.getEvents.call(this);return(this.options.closeOnClick!==void 0?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(f.preclick=this.close),this.options.keepInView&&(f.moveend=this._adjustPan),f},_initLayout:function(){var f="leaflet-popup",k=this._container=ct("div",f+" "+(this.options.className||"")+" leaflet-zoom-animated"),P=this._wrapper=ct("div",f+"-content-wrapper",k);if(this._contentNode=ct("div",f+"-content",P),Lu(k),Hl(this._contentNode),rr(k,"contextmenu",Os),this._tipContainer=ct("div",f+"-tip-container",k),this._tip=ct("div",f+"-tip",this._tipContainer),this.options.closeButton){var G=this._closeButton=ct("a",f+"-close-button",k);G.setAttribute("role","button"),G.setAttribute("aria-label","Close popup"),G.href="#close",G.innerHTML='<span aria-hidden="true">&#215;</span>',rr(G,"click",function(J){cn(J),this.close()},this)}},_updateLayout:function(){var f=this._contentNode,k=f.style;k.width="",k.whiteSpace="nowrap";var P=f.offsetWidth;P=Math.min(P,this.options.maxWidth),P=Math.max(P,this.options.minWidth),k.width=P+1+"px",k.whiteSpace="",k.height="";var G=f.offsetHeight,J=this.options.maxHeight,ue="leaflet-popup-scrolled";J&&G>J?(k.height=J+"px",it(f,ue)):sr(f,ue),this._containerWidth=this._container.offsetWidth},_animateZoom:function(f){var k=this._map._latLngToNewLayerPoint(this._latlng,f.zoom,f.center),P=this._getAnchor();In(this._container,k.add(P))},_adjustPan:function(){if(this.options.autoPan){if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning){this._autopanning=!1;return}var f=this._map,k=parseInt(gr(this._container,"marginBottom"),10)||0,P=this._container.offsetHeight+k,G=this._containerWidth,J=new Q(this._containerLeft,-P-this._containerBottom);J._add(to(this._container));var ue=f.layerPointToContainerPoint(J),we=re(this.options.autoPanPadding),Me=re(this.options.autoPanPaddingTopLeft||we),Ie=re(this.options.autoPanPaddingBottomRight||we),Ze=f.getSize(),kt=0,$t=0;ue.x+G+Ie.x>Ze.x&&(kt=ue.x+G-Ze.x+Ie.x),ue.x-kt-Me.x<0&&(kt=ue.x-Me.x),ue.y+P+Ie.y>Ze.y&&($t=ue.y+P-Ze.y+Ie.y),ue.y-$t-Me.y<0&&($t=ue.y-Me.y),(kt||$t)&&(this.options.keepInView&&(this._autopanning=!0),f.fire("autopanstart").panBy([kt,$t]))}},_getAnchor:function(){return re(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),tu=function(f,k){return new Co(f,k)};Cr.mergeOptions({closePopupOnClick:!0}),Cr.include({openPopup:function(f,k,P){return this._initOverlay(Co,f,k,P).openOn(this),this},closePopup:function(f){return f=arguments.length?f:this._popup,f&&f.close(),this}}),Ya.include({bindPopup:function(f,k){return this._popup=this._initOverlay(Co,this._popup,f,k),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(f){return this._popup&&(this instanceof ra||(this._popup._source=this),this._popup._prepareOpen(f||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return this._popup?this._popup.isOpen():!1},setPopupContent:function(f){return this._popup&&this._popup.setContent(f),this},getPopup:function(){return this._popup},_openPopup:function(f){if(!(!this._popup||!this._map)){Fn(f);var k=f.layer||f.target;if(this._popup._source===k&&!(k instanceof io)){this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(f.latlng);return}this._popup._source=k,this.openPopup(f.latlng)}},_movePopup:function(f){this._popup.setLatLng(f.latlng)},_onKeyPress:function(f){f.originalEvent.keyCode===13&&this._openPopup(f)}});var Nn=aa.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(f){aa.prototype.onAdd.call(this,f),this.setOpacity(this.options.opacity),f.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(f){aa.prototype.onRemove.call(this,f),f.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var f=aa.prototype.getEvents.call(this);return this.options.permanent||(f.preclick=this.close),f},_initLayout:function(){var f="leaflet-tooltip",k=f+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=ct("div",k),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+l(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(f){var k,P,G=this._map,J=this._container,ue=G.latLngToContainerPoint(G.getCenter()),we=G.layerPointToContainerPoint(f),Me=this.options.direction,Ie=J.offsetWidth,Ze=J.offsetHeight,kt=re(this.options.offset),$t=this._getAnchor();Me==="top"?(k=Ie/2,P=Ze):Me==="bottom"?(k=Ie/2,P=0):Me==="center"?(k=Ie/2,P=Ze/2):Me==="right"?(k=0,P=Ze/2):Me==="left"?(k=Ie,P=Ze/2):we.x<ue.x?(Me="right",k=0,P=Ze/2):(Me="left",k=Ie+(kt.x+$t.x)*2,P=Ze/2),f=f.subtract(re(k,P,!0)).add(kt).add($t),sr(J,"leaflet-tooltip-right"),sr(J,"leaflet-tooltip-left"),sr(J,"leaflet-tooltip-top"),sr(J,"leaflet-tooltip-bottom"),it(J,"leaflet-tooltip-"+Me),In(J,f)},_updatePosition:function(){var f=this._map.latLngToLayerPoint(this._latlng);this._setPosition(f)},setOpacity:function(f){this.options.opacity=f,this._container&&Dn(this._container,f)},_animateZoom:function(f){var k=this._map._latLngToNewLayerPoint(this._latlng,f.zoom,f.center);this._setPosition(k)},_getAnchor:function(){return re(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),dl=function(f,k){return new Nn(f,k)};Cr.include({openTooltip:function(f,k,P){return this._initOverlay(Nn,f,k,P).openOn(this),this},closeTooltip:function(f){return f.close(),this}}),Ya.include({bindTooltip:function(f,k){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(Nn,this._tooltip,f,k),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(f){if(!(!f&&this._tooltipHandlersAdded)){var k=f?"off":"on",P={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?P.add=this._openTooltip:(P.mouseover=this._openTooltip,P.mouseout=this.closeTooltip,P.click=this._openTooltip,this._map?this._addFocusListeners():P.add=this._addFocusListeners),this._tooltip.options.sticky&&(P.mousemove=this._moveTooltip),this[k](P),this._tooltipHandlersAdded=!f}},openTooltip:function(f){return this._tooltip&&(this instanceof ra||(this._tooltip._source=this),this._tooltip._prepareOpen(f)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(f){return this._tooltip&&this._tooltip.setContent(f),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(f){var k=typeof f.getElement=="function"&&f.getElement();k&&(rr(k,"focus",function(){this._tooltip._source=f,this.openTooltip()},this),rr(k,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(f){var k=typeof f.getElement=="function"&&f.getElement();k&&k.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(f){if(!(!this._tooltip||!this._map)){if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var k=this;this._map.once("moveend",function(){k._openOnceFlag=!1,k._openTooltip(f)});return}this._tooltip._source=f.layer||f.target,this.openTooltip(this._tooltip.options.sticky?f.latlng:void 0)}},_moveTooltip:function(f){var k=f.latlng,P,G;this._tooltip.options.sticky&&f.originalEvent&&(P=this._map.mouseEventToContainerPoint(f.originalEvent),G=this._map.containerPointToLayerPoint(P),k=this._map.layerPointToLatLng(G)),this._tooltip.setLatLng(k)}});var ru=Na.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(f){var k=f&&f.tagName==="DIV"?f:document.createElement("div"),P=this.options;if(P.html instanceof Element?(Qr(k),k.appendChild(P.html)):k.innerHTML=P.html!==!1?P.html:"",P.bgPos){var G=re(P.bgPos);k.style.backgroundPosition=-G.x+"px "+-G.y+"px"}return this._setIconStyles(k,"icon"),k},createShadow:function(){return null}});function Dc(f){return new ru(f)}Na.Default=ll;var wi=Ya.extend({options:{tileSize:256,opacity:1,updateWhenIdle:Tt.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(f){S(this,f)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(f){f._addZoomLimit(this)},onRemove:function(f){this._removeAllTiles(),mr(this._container),f._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(Ur(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(Or(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(f){return this.options.opacity=f,this._updateOpacity(),this},setZIndex:function(f){return this.options.zIndex=f,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var f=this._clampZoom(this._map.getZoom());f!==this._tileZoom&&(this._tileZoom=f,this._updateLevels()),this._update()}return this},getEvents:function(){var f={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=u(this._onMoveEnd,this.options.updateInterval,this)),f.move=this._onMove),this._zoomAnimated&&(f.zoomanim=this._animateZoom),f},createTile:function(){return document.createElement("div")},getTileSize:function(){var f=this.options.tileSize;return f instanceof Q?f:new Q(f,f)},_updateZIndex:function(){this._container&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(f){for(var k=this.getPane().children,P=-f(-1/0,1/0),G=0,J=k.length,ue;G<J;G++)ue=k[G].style.zIndex,k[G]!==this._container&&ue&&(P=f(P,+ue));isFinite(P)&&(this.options.zIndex=P+f(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!Tt.ielt9){Dn(this._container,this.options.opacity);var f=+new Date,k=!1,P=!1;for(var G in this._tiles){var J=this._tiles[G];if(!(!J.current||!J.loaded)){var ue=Math.min(1,(f-J.loaded)/200);Dn(J.el,ue),ue<1?k=!0:(J.active?P=!0:this._onOpaqueTile(J),J.active=!0)}}P&&!this._noPrune&&this._pruneTiles(),k&&(Z(this._fadeFrame),this._fadeFrame=$(this._updateOpacity,this))}},_onOpaqueTile:h,_initContainer:function(){this._container||(this._container=ct("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var f=this._tileZoom,k=this.options.maxZoom;if(f!==void 0){for(var P in this._levels)P=Number(P),this._levels[P].el.children.length||P===f?(this._levels[P].el.style.zIndex=k-Math.abs(f-P),this._onUpdateLevel(P)):(mr(this._levels[P].el),this._removeTilesAtZoom(P),this._onRemoveLevel(P),delete this._levels[P]);var G=this._levels[f],J=this._map;return G||(G=this._levels[f]={},G.el=ct("div","leaflet-tile-container leaflet-zoom-animated",this._container),G.el.style.zIndex=k,G.origin=J.project(J.unproject(J.getPixelOrigin()),f).round(),G.zoom=f,this._setZoomTransform(G,J.getCenter(),J.getZoom()),h(G.el.offsetWidth),this._onCreateLevel(G)),this._level=G,G}},_onUpdateLevel:h,_onRemoveLevel:h,_onCreateLevel:h,_pruneTiles:function(){if(this._map){var f,k,P=this._map.getZoom();if(P>this.options.maxZoom||P<this.options.minZoom){this._removeAllTiles();return}for(f in this._tiles)k=this._tiles[f],k.retain=k.current;for(f in this._tiles)if(k=this._tiles[f],k.current&&!k.active){var G=k.coords;this._retainParent(G.x,G.y,G.z,G.z-5)||this._retainChildren(G.x,G.y,G.z,G.z+2)}for(f in this._tiles)this._tiles[f].retain||this._removeTile(f)}},_removeTilesAtZoom:function(f){for(var k in this._tiles)this._tiles[k].coords.z===f&&this._removeTile(k)},_removeAllTiles:function(){for(var f in this._tiles)this._removeTile(f)},_invalidateAll:function(){for(var f in this._levels)mr(this._levels[f].el),this._onRemoveLevel(Number(f)),delete this._levels[f];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(f,k,P,G){var J=Math.floor(f/2),ue=Math.floor(k/2),we=P-1,Me=new Q(+J,+ue);Me.z=+we;var Ie=this._tileCoordsToKey(Me),Ze=this._tiles[Ie];return Ze&&Ze.active?(Ze.retain=!0,!0):(Ze&&Ze.loaded&&(Ze.retain=!0),we>G?this._retainParent(J,ue,we,G):!1)},_retainChildren:function(f,k,P,G){for(var J=2*f;J<2*f+2;J++)for(var ue=2*k;ue<2*k+2;ue++){var we=new Q(J,ue);we.z=P+1;var Me=this._tileCoordsToKey(we),Ie=this._tiles[Me];if(Ie&&Ie.active){Ie.retain=!0;continue}else Ie&&Ie.loaded&&(Ie.retain=!0);P+1<G&&this._retainChildren(J,ue,P+1,G)}},_resetView:function(f){var k=f&&(f.pinch||f.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),k,k)},_animateZoom:function(f){this._setView(f.center,f.zoom,!0,f.noUpdate)},_clampZoom:function(f){var k=this.options;return k.minNativeZoom!==void 0&&f<k.minNativeZoom?k.minNativeZoom:k.maxNativeZoom!==void 0&&k.maxNativeZoom<f?k.maxNativeZoom:f},_setView:function(f,k,P,G){var J=Math.round(k);this.options.maxZoom!==void 0&&J>this.options.maxZoom||this.options.minZoom!==void 0&&J<this.options.minZoom?J=void 0:J=this._clampZoom(J);var ue=this.options.updateWhenZooming&&J!==this._tileZoom;(!G||ue)&&(this._tileZoom=J,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),J!==void 0&&this._update(f),P||this._pruneTiles(),this._noPrune=!!P),this._setZoomTransforms(f,k)},_setZoomTransforms:function(f,k){for(var P in this._levels)this._setZoomTransform(this._levels[P],f,k)},_setZoomTransform:function(f,k,P){var G=this._map.getZoomScale(P,f.zoom),J=f.origin.multiplyBy(G).subtract(this._map._getNewPixelOrigin(k,P)).round();Tt.any3d?ps(f.el,J,G):In(f.el,J)},_resetGrid:function(){var f=this._map,k=f.options.crs,P=this._tileSize=this.getTileSize(),G=this._tileZoom,J=this._map.getPixelWorldBounds(this._tileZoom);J&&(this._globalTileRange=this._pxBoundsToTileRange(J)),this._wrapX=k.wrapLng&&!this.options.noWrap&&[Math.floor(f.project([0,k.wrapLng[0]],G).x/P.x),Math.ceil(f.project([0,k.wrapLng[1]],G).x/P.y)],this._wrapY=k.wrapLat&&!this.options.noWrap&&[Math.floor(f.project([k.wrapLat[0],0],G).y/P.x),Math.ceil(f.project([k.wrapLat[1],0],G).y/P.y)]},_onMoveEnd:function(){!this._map||this._map._animatingZoom||this._update()},_getTiledPixelBounds:function(f){var k=this._map,P=k._animatingZoom?Math.max(k._animateToZoom,k.getZoom()):k.getZoom(),G=k.getZoomScale(P,this._tileZoom),J=k.project(f,this._tileZoom).floor(),ue=k.getSize().divideBy(G*2);return new q(J.subtract(ue),J.add(ue))},_update:function(f){var k=this._map;if(k){var P=this._clampZoom(k.getZoom());if(f===void 0&&(f=k.getCenter()),this._tileZoom!==void 0){var G=this._getTiledPixelBounds(f),J=this._pxBoundsToTileRange(G),ue=J.getCenter(),we=[],Me=this.options.keepBuffer,Ie=new q(J.getBottomLeft().subtract([Me,-Me]),J.getTopRight().add([Me,-Me]));if(!(isFinite(J.min.x)&&isFinite(J.min.y)&&isFinite(J.max.x)&&isFinite(J.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var Ze in this._tiles){var kt=this._tiles[Ze].coords;(kt.z!==this._tileZoom||!Ie.contains(new Q(kt.x,kt.y)))&&(this._tiles[Ze].current=!1)}if(Math.abs(P-this._tileZoom)>1){this._setView(f,P);return}for(var $t=J.min.y;$t<=J.max.y;$t++)for(var hr=J.min.x;hr<=J.max.x;hr++){var Kr=new Q(hr,$t);if(Kr.z=this._tileZoom,!!this._isValidTile(Kr)){var Gn=this._tiles[this._tileCoordsToKey(Kr)];Gn?Gn.current=!0:we.push(Kr)}}if(we.sort(function(Vi,pl){return Vi.distanceTo(ue)-pl.distanceTo(ue)}),we.length!==0){this._loading||(this._loading=!0,this.fire("loading"));var Li=document.createDocumentFragment();for(hr=0;hr<we.length;hr++)this._addTile(we[hr],Li);this._level.el.appendChild(Li)}}}},_isValidTile:function(f){var k=this._map.options.crs;if(!k.infinite){var P=this._globalTileRange;if(!k.wrapLng&&(f.x<P.min.x||f.x>P.max.x)||!k.wrapLat&&(f.y<P.min.y||f.y>P.max.y))return!1}if(!this.options.bounds)return!0;var G=this._tileCoordsToBounds(f);return de(this.options.bounds).overlaps(G)},_keyToBounds:function(f){return this._tileCoordsToBounds(this._keyToTileCoords(f))},_tileCoordsToNwSe:function(f){var k=this._map,P=this.getTileSize(),G=f.scaleBy(P),J=G.add(P),ue=k.unproject(G,f.z),we=k.unproject(J,f.z);return[ue,we]},_tileCoordsToBounds:function(f){var k=this._tileCoordsToNwSe(f),P=new ae(k[0],k[1]);return this.options.noWrap||(P=this._map.wrapLatLngBounds(P)),P},_tileCoordsToKey:function(f){return f.x+":"+f.y+":"+f.z},_keyToTileCoords:function(f){var k=f.split(":"),P=new Q(+k[0],+k[1]);return P.z=+k[2],P},_removeTile:function(f){var k=this._tiles[f];k&&(mr(k.el),delete this._tiles[f],this.fire("tileunload",{tile:k.el,coords:this._keyToTileCoords(f)}))},_initTile:function(f){it(f,"leaflet-tile");var k=this.getTileSize();f.style.width=k.x+"px",f.style.height=k.y+"px",f.onselectstart=h,f.onmousemove=h,Tt.ielt9&&this.options.opacity<1&&Dn(f,this.options.opacity)},_addTile:function(f,k){var P=this._getTilePos(f),G=this._tileCoordsToKey(f),J=this.createTile(this._wrapCoords(f),s(this._tileReady,this,f));this._initTile(J),this.createTile.length<2&&$(s(this._tileReady,this,f,null,J)),In(J,P),this._tiles[G]={el:J,coords:f,current:!0},k.appendChild(J),this.fire("tileloadstart",{tile:J,coords:f})},_tileReady:function(f,k,P){k&&this.fire("tileerror",{error:k,tile:P,coords:f});var G=this._tileCoordsToKey(f);P=this._tiles[G],P&&(P.loaded=+new Date,this._map._fadeAnimated?(Dn(P.el,0),Z(this._fadeFrame),this._fadeFrame=$(this._updateOpacity,this)):(P.active=!0,this._pruneTiles()),k||(it(P.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:P.el,coords:f})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),Tt.ielt9||!this._map._fadeAnimated?$(this._pruneTiles,this):setTimeout(s(this._pruneTiles,this),250)))},_getTilePos:function(f){return f.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(f){var k=new Q(this._wrapX?c(f.x,this._wrapX):f.x,this._wrapY?c(f.y,this._wrapY):f.y);return k.z=f.z,k},_pxBoundsToTileRange:function(f){var k=this.getTileSize();return new q(f.min.unscaleBy(k).floor(),f.max.unscaleBy(k).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var f in this._tiles)if(!this._tiles[f].loaded)return!1;return!0}});function Si(f){return new wi(f)}var es=wi.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(f,k){this._url=f,k=S(this,k),k.detectRetina&&Tt.retina&&k.maxZoom>0?(k.tileSize=Math.floor(k.tileSize/2),k.zoomReverse?(k.zoomOffset--,k.minZoom=Math.min(k.maxZoom,k.minZoom+1)):(k.zoomOffset++,k.maxZoom=Math.max(k.minZoom,k.maxZoom-1)),k.minZoom=Math.max(0,k.minZoom)):k.zoomReverse?k.minZoom=Math.min(k.maxZoom,k.minZoom):k.maxZoom=Math.max(k.minZoom,k.maxZoom),typeof k.subdomains=="string"&&(k.subdomains=k.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(f,k){return this._url===f&&k===void 0&&(k=!0),this._url=f,k||this.redraw(),this},createTile:function(f,k){var P=document.createElement("img");return rr(P,"load",s(this._tileOnLoad,this,k,P)),rr(P,"error",s(this._tileOnError,this,k,P)),(this.options.crossOrigin||this.options.crossOrigin==="")&&(P.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),typeof this.options.referrerPolicy=="string"&&(P.referrerPolicy=this.options.referrerPolicy),P.alt="",P.src=this.getTileUrl(f),P},getTileUrl:function(f){var k={r:Tt.retina?"@2x":"",s:this._getSubdomain(f),x:f.x,y:f.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var P=this._globalTileRange.max.y-f.y;this.options.tms&&(k.y=P),k["-y"]=P}return _(this._url,i(k,this.options))},_tileOnLoad:function(f,k){Tt.ielt9?setTimeout(s(f,this,null,k),0):f(null,k)},_tileOnError:function(f,k,P){var G=this.options.errorTileUrl;G&&k.getAttribute("src")!==G&&(k.src=G),f(P,k)},_onTileRemove:function(f){f.tile.onload=null},_getZoomForUrl:function(){var f=this._tileZoom,k=this.options.maxZoom,P=this.options.zoomReverse,G=this.options.zoomOffset;return P&&(f=k-f),f+G},_getSubdomain:function(f){var k=Math.abs(f.x+f.y)%this.options.subdomains.length;return this.options.subdomains[k]},_abortLoading:function(){var f,k;for(f in this._tiles)if(this._tiles[f].coords.z!==this._tileZoom&&(k=this._tiles[f].el,k.onload=h,k.onerror=h,!k.complete)){k.src=A;var P=this._tiles[f].coords;mr(k),delete this._tiles[f],this.fire("tileabort",{tile:k,coords:P})}},_removeTile:function(f){var k=this._tiles[f];if(k)return k.el.setAttribute("src",A),wi.prototype._removeTile.call(this,f)},_tileReady:function(f,k,P){if(!(!this._map||P&&P.getAttribute("src")===A))return wi.prototype._tileReady.call(this,f,k,P)}});function zu(f,k){return new es(f,k)}var hl=es.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(f,k){this._url=f;var P=i({},this.defaultWmsParams);for(var G in k)G in this.options||(P[G]=k[G]);k=S(this,k);var J=k.detectRetina&&Tt.retina?2:1,ue=this.getTileSize();P.width=ue.x*J,P.height=ue.y*J,this.wmsParams=P},onAdd:function(f){this._crs=this.options.crs||f.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var k=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[k]=this._crs.code,es.prototype.onAdd.call(this,f)},getTileUrl:function(f){var k=this._tileCoordsToNwSe(f),P=this._crs,G=te(P.project(k[0]),P.project(k[1])),J=G.min,ue=G.max,we=(this._wmsVersion>=1.3&&this._crs===Rc?[J.y,J.x,ue.y,ue.x]:[J.x,J.y,ue.x,ue.y]).join(","),Me=es.prototype.getTileUrl.call(this,f);return Me+w(this.wmsParams,Me,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+we},setParams:function(f,k){return i(this.wmsParams,f),k||this.redraw(),this}});function Sh(f,k){return new hl(f,k)}es.WMS=hl,zu.wms=Sh;var xs=Ya.extend({options:{padding:.1},initialize:function(f){S(this,f),l(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),it(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var f={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(f.zoomanim=this._onAnimZoom),f},_onAnimZoom:function(f){this._updateTransform(f.center,f.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(f,k){var P=this._map.getZoomScale(k,this._zoom),G=this._map.getSize().multiplyBy(.5+this.options.padding),J=this._map.project(this._center,k),ue=G.multiplyBy(-P).add(J).subtract(this._map._getNewPixelOrigin(f,k));Tt.any3d?ps(this._container,ue,P):In(this._container,ue)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var f in this._layers)this._layers[f]._reset()},_onZoomEnd:function(){for(var f in this._layers)this._layers[f]._project()},_updatePaths:function(){for(var f in this._layers)this._layers[f]._update()},_update:function(){var f=this.options.padding,k=this._map.getSize(),P=this._map.containerPointToLayerPoint(k.multiplyBy(-f)).round();this._bounds=new q(P,P.add(k.multiplyBy(1+f*2)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),Ic=xs.extend({options:{tolerance:0},getEvents:function(){var f=xs.prototype.getEvents.call(this);return f.viewprereset=this._onViewPreReset,f},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){xs.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var f=this._container=document.createElement("canvas");rr(f,"mousemove",this._onMouseMove,this),rr(f,"click dblclick mousedown mouseup contextmenu",this._onClick,this),rr(f,"mouseout",this._handleMouseOut,this),f._leaflet_disable_events=!0,this._ctx=f.getContext("2d")},_destroyContainer:function(){Z(this._redrawRequest),delete this._ctx,mr(this._container),qr(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){var f;this._redrawBounds=null;for(var k in this._layers)f=this._layers[k],f._update();this._redraw()}},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){xs.prototype._update.call(this);var f=this._bounds,k=this._container,P=f.getSize(),G=Tt.retina?2:1;In(k,f.min),k.width=G*P.x,k.height=G*P.y,k.style.width=P.x+"px",k.style.height=P.y+"px",Tt.retina&&this._ctx.scale(2,2),this._ctx.translate(-f.min.x,-f.min.y),this.fire("update")}},_reset:function(){xs.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(f){this._updateDashArray(f),this._layers[l(f)]=f;var k=f._order={layer:f,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=k),this._drawLast=k,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(f){this._requestRedraw(f)},_removePath:function(f){var k=f._order,P=k.next,G=k.prev;P?P.prev=G:this._drawLast=G,G?G.next=P:this._drawFirst=P,delete f._order,delete this._layers[l(f)],this._requestRedraw(f)},_updatePath:function(f){this._extendRedrawBounds(f),f._project(),f._update(),this._requestRedraw(f)},_updateStyle:function(f){this._updateDashArray(f),this._requestRedraw(f)},_updateDashArray:function(f){if(typeof f.options.dashArray=="string"){var k=f.options.dashArray.split(/[, ]+/),P=[],G,J;for(J=0;J<k.length;J++){if(G=Number(k[J]),isNaN(G))return;P.push(G)}f.options._dashArray=P}else f.options._dashArray=f.options.dashArray},_requestRedraw:function(f){this._map&&(this._extendRedrawBounds(f),this._redrawRequest=this._redrawRequest||$(this._redraw,this))},_extendRedrawBounds:function(f){if(f._pxBounds){var k=(f.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new q,this._redrawBounds.extend(f._pxBounds.min.subtract([k,k])),this._redrawBounds.extend(f._pxBounds.max.add([k,k]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var f=this._redrawBounds;if(f){var k=f.getSize();this._ctx.clearRect(f.min.x,f.min.y,k.x,k.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var f,k=this._redrawBounds;if(this._ctx.save(),k){var P=k.getSize();this._ctx.beginPath(),this._ctx.rect(k.min.x,k.min.y,P.x,P.y),this._ctx.clip()}this._drawing=!0;for(var G=this._drawFirst;G;G=G.next)f=G.layer,(!k||f._pxBounds&&f._pxBounds.intersects(k))&&f._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(f,k){if(this._drawing){var P,G,J,ue,we=f._parts,Me=we.length,Ie=this._ctx;if(Me){for(Ie.beginPath(),P=0;P<Me;P++){for(G=0,J=we[P].length;G<J;G++)ue=we[P][G],Ie[G?"lineTo":"moveTo"](ue.x,ue.y);k&&Ie.closePath()}this._fillStroke(Ie,f)}}},_updateCircle:function(f){if(!(!this._drawing||f._empty())){var k=f._point,P=this._ctx,G=Math.max(Math.round(f._radius),1),J=(Math.max(Math.round(f._radiusY),1)||G)/G;J!==1&&(P.save(),P.scale(1,J)),P.beginPath(),P.arc(k.x,k.y/J,G,0,Math.PI*2,!1),J!==1&&P.restore(),this._fillStroke(P,f)}},_fillStroke:function(f,k){var P=k.options;P.fill&&(f.globalAlpha=P.fillOpacity,f.fillStyle=P.fillColor||P.color,f.fill(P.fillRule||"evenodd")),P.stroke&&P.weight!==0&&(f.setLineDash&&f.setLineDash(k.options&&k.options._dashArray||[]),f.globalAlpha=P.opacity,f.lineWidth=P.weight,f.strokeStyle=P.color,f.lineCap=P.lineCap,f.lineJoin=P.lineJoin,f.stroke())},_onClick:function(f){for(var k=this._map.mouseEventToLayerPoint(f),P,G,J=this._drawFirst;J;J=J.next)P=J.layer,P.options.interactive&&P._containsPoint(k)&&(!(f.type==="click"||f.type==="preclick")||!this._map._draggableMoved(P))&&(G=P);this._fireEvent(G?[G]:!1,f)},_onMouseMove:function(f){if(!(!this._map||this._map.dragging.moving()||this._map._animatingZoom)){var k=this._map.mouseEventToLayerPoint(f);this._handleMouseHover(f,k)}},_handleMouseOut:function(f){var k=this._hoveredLayer;k&&(sr(this._container,"leaflet-interactive"),this._fireEvent([k],f,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(f,k){if(!this._mouseHoverThrottled){for(var P,G,J=this._drawFirst;J;J=J.next)P=J.layer,P.options.interactive&&P._containsPoint(k)&&(G=P);G!==this._hoveredLayer&&(this._handleMouseOut(f),G&&(it(this._container,"leaflet-interactive"),this._fireEvent([G],f,"mouseover"),this._hoveredLayer=G)),this._fireEvent(this._hoveredLayer?[this._hoveredLayer]:!1,f),this._mouseHoverThrottled=!0,setTimeout(s(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(f,k,P){this._map._fireDOMEvent(k,P||k.type,f)},_bringToFront:function(f){var k=f._order;if(k){var P=k.next,G=k.prev;if(P)P.prev=G;else return;G?G.next=P:P&&(this._drawFirst=P),k.prev=this._drawLast,this._drawLast.next=k,k.next=null,this._drawLast=k,this._requestRedraw(f)}},_bringToBack:function(f){var k=f._order;if(k){var P=k.next,G=k.prev;if(G)G.next=P;else return;P?P.prev=G:G&&(this._drawLast=G),k.prev=null,k.next=this._drawFirst,this._drawFirst.prev=k,this._drawFirst=k,this._requestRedraw(f)}}});function jc(f){return Tt.canvas?new Ic(f):null}var fl=(function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(f){return document.createElement("<lvml:"+f+' class="lvml">')}}catch{}return function(f){return document.createElement("<"+f+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}})(),kh={_initContainer:function(){this._container=ct("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(xs.prototype._update.call(this),this.fire("update"))},_initPath:function(f){var k=f._container=fl("shape");it(k,"leaflet-vml-shape "+(this.options.className||"")),k.coordsize="1 1",f._path=fl("path"),k.appendChild(f._path),this._updateStyle(f),this._layers[l(f)]=f},_addPath:function(f){var k=f._container;this._container.appendChild(k),f.options.interactive&&f.addInteractiveTarget(k)},_removePath:function(f){var k=f._container;mr(k),f.removeInteractiveTarget(k),delete this._layers[l(f)]},_updateStyle:function(f){var k=f._stroke,P=f._fill,G=f.options,J=f._container;J.stroked=!!G.stroke,J.filled=!!G.fill,G.stroke?(k||(k=f._stroke=fl("stroke")),J.appendChild(k),k.weight=G.weight+"px",k.color=G.color,k.opacity=G.opacity,G.dashArray?k.dashStyle=C(G.dashArray)?G.dashArray.join(" "):G.dashArray.replace(/( *, *)/g," "):k.dashStyle="",k.endcap=G.lineCap.replace("butt","flat"),k.joinstyle=G.lineJoin):k&&(J.removeChild(k),f._stroke=null),G.fill?(P||(P=f._fill=fl("fill")),J.appendChild(P),P.color=G.fillColor||G.color,P.opacity=G.fillOpacity):P&&(J.removeChild(P),f._fill=null)},_updateCircle:function(f){var k=f._point.round(),P=Math.round(f._radius),G=Math.round(f._radiusY||P);this._setPath(f,f._empty()?"M0 0":"AL "+k.x+","+k.y+" "+P+","+G+" 0,"+65535*360)},_setPath:function(f,k){f._path.v=k},_bringToFront:function(f){Ur(f._container)},_bringToBack:function(f){Or(f._container)}},ts=Tt.vml?fl:$e,Eo=xs.extend({_initContainer:function(){this._container=ts("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=ts("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){mr(this._container),qr(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){xs.prototype._update.call(this);var f=this._bounds,k=f.getSize(),P=this._container;(!this._svgSize||!this._svgSize.equals(k))&&(this._svgSize=k,P.setAttribute("width",k.x),P.setAttribute("height",k.y)),In(P,f.min),P.setAttribute("viewBox",[f.min.x,f.min.y,k.x,k.y].join(" ")),this.fire("update")}},_initPath:function(f){var k=f._path=ts("path");f.options.className&&it(k,f.options.className),f.options.interactive&&it(k,"leaflet-interactive"),this._updateStyle(f),this._layers[l(f)]=f},_addPath:function(f){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(f._path),f.addInteractiveTarget(f._path)},_removePath:function(f){mr(f._path),f.removeInteractiveTarget(f._path),delete this._layers[l(f)]},_updatePath:function(f){f._project(),f._update()},_updateStyle:function(f){var k=f._path,P=f.options;k&&(P.stroke?(k.setAttribute("stroke",P.color),k.setAttribute("stroke-opacity",P.opacity),k.setAttribute("stroke-width",P.weight),k.setAttribute("stroke-linecap",P.lineCap),k.setAttribute("stroke-linejoin",P.lineJoin),P.dashArray?k.setAttribute("stroke-dasharray",P.dashArray):k.removeAttribute("stroke-dasharray"),P.dashOffset?k.setAttribute("stroke-dashoffset",P.dashOffset):k.removeAttribute("stroke-dashoffset")):k.setAttribute("stroke","none"),P.fill?(k.setAttribute("fill",P.fillColor||P.color),k.setAttribute("fill-opacity",P.fillOpacity),k.setAttribute("fill-rule",P.fillRule||"evenodd")):k.setAttribute("fill","none"))},_updatePoly:function(f,k){this._setPath(f,St(f._parts,k))},_updateCircle:function(f){var k=f._point,P=Math.max(Math.round(f._radius),1),G=Math.max(Math.round(f._radiusY),1)||P,J="a"+P+","+G+" 0 1,0 ",ue=f._empty()?"M0 0":"M"+(k.x-P)+","+k.y+J+P*2+",0 "+J+-P*2+",0 ";this._setPath(f,ue)},_setPath:function(f,k){f._path.setAttribute("d",k)},_bringToFront:function(f){Ur(f._path)},_bringToBack:function(f){Or(f._path)}});Tt.vml&&Eo.include(kh);function To(f){return Tt.svg||Tt.vml?new Eo(f):null}Cr.include({getRenderer:function(f){var k=f.options.renderer||this._getPaneRenderer(f.options.pane)||this.options.renderer||this._renderer;return k||(k=this._renderer=this._createRenderer()),this.hasLayer(k)||this.addLayer(k),k},_getPaneRenderer:function(f){if(f==="overlayPane"||f===void 0)return!1;var k=this._paneRenderers[f];return k===void 0&&(k=this._createRenderer({pane:f}),this._paneRenderers[f]=k),k},_createRenderer:function(f){return this.options.preferCanvas&&jc(f)||To(f)}});var _h=Pa.extend({initialize:function(f,k){Pa.prototype.initialize.call(this,this._boundsToLatLngs(f),k)},setBounds:function(f){return this.setLatLngs(this._boundsToLatLngs(f))},_boundsToLatLngs:function(f){return f=de(f),[f.getSouthWest(),f.getNorthWest(),f.getNorthEast(),f.getSouthEast()]}});function Fc(f,k){return new _h(f,k)}Eo.create=ts,Eo.pointsToPath=St,na.geometryToLayer=ys,na.coordsToLatLng=Ql,na.coordsToLatLngs=Fs,na.latLngToCoords=Fu,na.latLngsToCoords=Jl,na.getFeature=Gr,na.asFeature=cl,Cr.mergeOptions({boxZoom:!0});var so=ta.extend({initialize:function(f){this._map=f,this._container=f._container,this._pane=f._panes.overlayPane,this._resetStateTimeout=0,f.on("unload",this._destroy,this)},addHooks:function(){rr(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){qr(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){mr(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){this._resetStateTimeout!==0&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(f){if(!f.shiftKey||f.which!==1&&f.button!==1)return!1;this._clearDeferredResetState(),this._resetState(),wr(),Cc(),this._startPoint=this._map.mouseEventToContainerPoint(f),rr(document,{contextmenu:Fn,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(f){this._moved||(this._moved=!0,this._box=ct("div","leaflet-zoom-box",this._container),it(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(f);var k=new q(this._point,this._startPoint),P=k.getSize();In(this._box,k.min),this._box.style.width=P.x+"px",this._box.style.height=P.y+"px"},_finish:function(){this._moved&&(mr(this._box),sr(this._container,"leaflet-crosshair")),ro(),Ec(),qr(document,{contextmenu:Fn,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(f){if(!(f.which!==1&&f.button!==1)&&(this._finish(),!!this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(s(this._resetState,this),0);var k=new ae(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(k).fire("boxzoomend",{boxZoomBounds:k})}},_onKeyDown:function(f){f.keyCode===27&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});Cr.addInitHook("addHandler","boxZoom",so),Cr.mergeOptions({doubleClickZoom:!0});var Ch=ta.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(f){var k=this._map,P=k.getZoom(),G=k.options.zoomDelta,J=f.originalEvent.shiftKey?P-G:P+G;k.options.doubleClickZoom==="center"?k.setZoom(J):k.setZoomAround(f.containerPoint,J)}});Cr.addInitHook("addHandler","doubleClickZoom",Ch),Cr.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var Uu=ta.extend({addHooks:function(){if(!this._draggable){var f=this._map;this._draggable=new wn(f._mapPane,f._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),f.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),f.on("zoomend",this._onZoomEnd,this),f.whenReady(this._onZoomEnd,this))}it(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){sr(this._map._container,"leaflet-grab"),sr(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var f=this._map;if(f._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var k=de(this._map.options.maxBounds);this._offsetLimit=te(this._map.latLngToContainerPoint(k.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(k.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;f.fire("movestart").fire("dragstart"),f.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(f){if(this._map.options.inertia){var k=this._lastTime=+new Date,P=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(P),this._times.push(k),this._prunePositions(k)}this._map.fire("move",f).fire("drag",f)},_prunePositions:function(f){for(;this._positions.length>1&&f-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var f=this._map.getSize().divideBy(2),k=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=k.subtract(f).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(f,k){return f-(f-k)*this._viscosity},_onPreDragLimit:function(){if(!(!this._viscosity||!this._offsetLimit)){var f=this._draggable._newPos.subtract(this._draggable._startPos),k=this._offsetLimit;f.x<k.min.x&&(f.x=this._viscousLimit(f.x,k.min.x)),f.y<k.min.y&&(f.y=this._viscousLimit(f.y,k.min.y)),f.x>k.max.x&&(f.x=this._viscousLimit(f.x,k.max.x)),f.y>k.max.y&&(f.y=this._viscousLimit(f.y,k.max.y)),this._draggable._newPos=this._draggable._startPos.add(f)}},_onPreDragWrap:function(){var f=this._worldWidth,k=Math.round(f/2),P=this._initialWorldOffset,G=this._draggable._newPos.x,J=(G-k+P)%f+k-P,ue=(G+k+P)%f-k-P,we=Math.abs(J+P)<Math.abs(ue+P)?J:ue;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=we},_onDragEnd:function(f){var k=this._map,P=k.options,G=!P.inertia||f.noInertia||this._times.length<2;if(k.fire("dragend",f),G)k.fire("moveend");else{this._prunePositions(+new Date);var J=this._lastPos.subtract(this._positions[0]),ue=(this._lastTime-this._times[0])/1e3,we=P.easeLinearity,Me=J.multiplyBy(we/ue),Ie=Me.distanceTo([0,0]),Ze=Math.min(P.inertiaMaxSpeed,Ie),kt=Me.multiplyBy(Ze/Ie),$t=Ze/(P.inertiaDeceleration*we),hr=kt.multiplyBy(-$t/2).round();!hr.x&&!hr.y?k.fire("moveend"):(hr=k._limitOffset(hr,k.options.maxBounds),$(function(){k.panBy(hr,{duration:$t,easeLinearity:we,noMoveStart:!0,animate:!0})}))}}});Cr.addInitHook("addHandler","dragging",Uu),Cr.mergeOptions({keyboard:!0,keyboardPanDelta:80});var Bc=ta.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(f){this._map=f,this._setPanDelta(f.options.keyboardPanDelta),this._setZoomDelta(f.options.zoomDelta)},addHooks:function(){var f=this._map._container;f.tabIndex<=0&&(f.tabIndex="0"),rr(f,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),qr(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var f=document.body,k=document.documentElement,P=f.scrollTop||k.scrollTop,G=f.scrollLeft||k.scrollLeft;this._map._container.focus(),window.scrollTo(G,P)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(f){var k=this._panKeys={},P=this.keyCodes,G,J;for(G=0,J=P.left.length;G<J;G++)k[P.left[G]]=[-1*f,0];for(G=0,J=P.right.length;G<J;G++)k[P.right[G]]=[f,0];for(G=0,J=P.down.length;G<J;G++)k[P.down[G]]=[0,f];for(G=0,J=P.up.length;G<J;G++)k[P.up[G]]=[0,-1*f]},_setZoomDelta:function(f){var k=this._zoomKeys={},P=this.keyCodes,G,J;for(G=0,J=P.zoomIn.length;G<J;G++)k[P.zoomIn[G]]=f;for(G=0,J=P.zoomOut.length;G<J;G++)k[P.zoomOut[G]]=-f},_addHooks:function(){rr(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){qr(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(f){if(!(f.altKey||f.ctrlKey||f.metaKey)){var k=f.keyCode,P=this._map,G;if(k in this._panKeys){if(!P._panAnim||!P._panAnim._inProgress)if(G=this._panKeys[k],f.shiftKey&&(G=re(G).multiplyBy(3)),P.options.maxBounds&&(G=P._limitOffset(re(G),P.options.maxBounds)),P.options.worldCopyJump){var J=P.wrapLatLng(P.unproject(P.project(P.getCenter()).add(G)));P.panTo(J)}else P.panBy(G)}else if(k in this._zoomKeys)P.setZoom(P.getZoom()+(f.shiftKey?3:1)*this._zoomKeys[k]);else if(k===27&&P._popup&&P._popup.options.closeOnEscapeKey)P.closePopup();else return;Fn(f)}}});Cr.addInitHook("addHandler","keyboard",Bc),Cr.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var $r=ta.extend({addHooks:function(){rr(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){qr(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(f){var k=Ds(f),P=this._map.options.wheelDebounceTime;this._delta+=k,this._lastMousePos=this._map.mouseEventToContainerPoint(f),this._startTime||(this._startTime=+new Date);var G=Math.max(P-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(s(this._performZoom,this),G),Fn(f)},_performZoom:function(){var f=this._map,k=f.getZoom(),P=this._map.options.zoomSnap||0;f._stop();var G=this._delta/(this._map.options.wheelPxPerZoomLevel*4),J=4*Math.log(2/(1+Math.exp(-Math.abs(G))))/Math.LN2,ue=P?Math.ceil(J/P)*P:J,we=f._limitZoom(k+(this._delta>0?ue:-ue))-k;this._delta=0,this._startTime=null,we&&(f.options.scrollWheelZoom==="center"?f.setZoom(k+we):f.setZoomAround(this._lastMousePos,k+we))}});Cr.addInitHook("addHandler","scrollWheelZoom",$r);var zc=600;Cr.mergeOptions({tapHold:Tt.touchNative&&Tt.safari&&Tt.mobile,tapTolerance:15});var nu=ta.extend({addHooks:function(){rr(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){qr(this._map._container,"touchstart",this._onDown,this)},_onDown:function(f){if(clearTimeout(this._holdTimeout),f.touches.length===1){var k=f.touches[0];this._startPos=this._newPos=new Q(k.clientX,k.clientY),this._holdTimeout=setTimeout(s(function(){this._cancel(),this._isTapValid()&&(rr(document,"touchend",cn),rr(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",k))},this),zc),rr(document,"touchend touchcancel contextmenu",this._cancel,this),rr(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function f(){qr(document,"touchend",cn),qr(document,"touchend touchcancel",f)},_cancel:function(){clearTimeout(this._holdTimeout),qr(document,"touchend touchcancel contextmenu",this._cancel,this),qr(document,"touchmove",this._onMove,this)},_onMove:function(f){var k=f.touches[0];this._newPos=new Q(k.clientX,k.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(f,k){var P=new MouseEvent(f,{bubbles:!0,cancelable:!0,view:window,screenX:k.screenX,screenY:k.screenY,clientX:k.clientX,clientY:k.clientY});P._simulated=!0,k.target.dispatchEvent(P)}});Cr.addInitHook("addHandler","tapHold",nu),Cr.mergeOptions({touchZoom:Tt.touch,bounceAtZoomLimits:!0});var No=ta.extend({addHooks:function(){it(this._map._container,"leaflet-touch-zoom"),rr(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){sr(this._map._container,"leaflet-touch-zoom"),qr(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(f){var k=this._map;if(!(!f.touches||f.touches.length!==2||k._animatingZoom||this._zooming)){var P=k.mouseEventToContainerPoint(f.touches[0]),G=k.mouseEventToContainerPoint(f.touches[1]);this._centerPoint=k.getSize()._divideBy(2),this._startLatLng=k.containerPointToLatLng(this._centerPoint),k.options.touchZoom!=="center"&&(this._pinchStartLatLng=k.containerPointToLatLng(P.add(G)._divideBy(2))),this._startDist=P.distanceTo(G),this._startZoom=k.getZoom(),this._moved=!1,this._zooming=!0,k._stop(),rr(document,"touchmove",this._onTouchMove,this),rr(document,"touchend touchcancel",this._onTouchEnd,this),cn(f)}},_onTouchMove:function(f){if(!(!f.touches||f.touches.length!==2||!this._zooming)){var k=this._map,P=k.mouseEventToContainerPoint(f.touches[0]),G=k.mouseEventToContainerPoint(f.touches[1]),J=P.distanceTo(G)/this._startDist;if(this._zoom=k.getScaleZoom(J,this._startZoom),!k.options.bounceAtZoomLimits&&(this._zoom<k.getMinZoom()&&J<1||this._zoom>k.getMaxZoom()&&J>1)&&(this._zoom=k._limitZoom(this._zoom)),k.options.touchZoom==="center"){if(this._center=this._startLatLng,J===1)return}else{var ue=P._add(G)._divideBy(2)._subtract(this._centerPoint);if(J===1&&ue.x===0&&ue.y===0)return;this._center=k.unproject(k.project(this._pinchStartLatLng,this._zoom).subtract(ue),this._zoom)}this._moved||(k._moveStart(!0,!1),this._moved=!0),Z(this._animRequest);var we=s(k._move,k,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=$(we,this,!0),cn(f)}},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=!1;return}this._zooming=!1,Z(this._animRequest),qr(document,"touchmove",this._onTouchMove,this),qr(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))}});Cr.addInitHook("addHandler","touchZoom",No),Cr.BoxZoom=so,Cr.DoubleClickZoom=Ch,Cr.Drag=Uu,Cr.Keyboard=Bc,Cr.ScrollWheelZoom=$r,Cr.TapHold=nu,Cr.TouchZoom=No,r.Bounds=q,r.Browser=Tt,r.CRS=se,r.Canvas=Ic,r.Circle=ul,r.CircleMarker=Qa,r.Class=H,r.Control=ai,r.DivIcon=ru,r.DivOverlay=aa,r.DomEvent=Wl,r.DomUtil=Sr,r.Draggable=wn,r.Evented=Y,r.FeatureGroup=ra,r.GeoJSON=na,r.GridLayer=wi,r.Handler=ta,r.Icon=Na,r.ImageOverlay=Bs,r.LatLng=ge,r.LatLngBounds=ae,r.Layer=Ya,r.LayerGroup=js,r.LineUtil=sl,r.Map=Cr,r.Marker=Ai,r.Mixin=Iu,r.Path=io,r.Point=Q,r.PolyUtil=Df,r.Polygon=Pa,r.Polyline=Ri,r.Popup=Co,r.PosAnimation=Du,r.Projection=Ac,r.Rectangle=_h,r.Renderer=xs,r.SVG=Eo,r.SVGOverlay=Un,r.TileLayer=es,r.Tooltip=Nn,r.Transformation=me,r.Util=D,r.VideoOverlay=an,r.bind=s,r.bounds=te,r.canvas=jc,r.circle=Xl,r.circleMarker=ao,r.control=ka,r.divIcon=Dc,r.extend=i,r.featureGroup=Ta,r.geoJSON=Oc,r.geoJson=ia,r.gridLayer=Si,r.icon=Lc,r.imageOverlay=_o,r.latLng=ye,r.latLngBounds=de,r.layerGroup=ol,r.map=xi,r.marker=wh,r.point=re,r.polygon=Ja,r.polyline=Ff,r.popup=tu,r.rectangle=Fc,r.setOptions=S,r.stamp=l,r.svg=To,r.svgOverlay=eu,r.tileLayer=zu,r.tooltip=dl,r.transformation=xe,r.version=n,r.videoOverlay=zn;var Eh=window.L;r.noConflict=function(){return window.L=Eh,this},window.L=r}))})(Kg,Kg.exports)),Kg.exports}var Vd=wH();const U1=Tf(Vd);function N_(t,e,r){return Object.freeze({instance:t,context:e,container:r})}function VR(t,e){return e==null?function(n,i){const a=ie.useRef();return a.current||(a.current=t(n,i)),a}:function(n,i){const a=ie.useRef();a.current||(a.current=t(n,i));const s=ie.useRef(n),{instance:o}=a.current;return ie.useEffect(function(){s.current!==n&&(e(o,n,s.current),s.current=n)},[o,n,i]),a}}function SH(t,e){ie.useEffect(function(){return(e.layerContainer??e.map).addLayer(t.instance),function(){e.layerContainer?.removeLayer(t.instance),e.map.removeLayer(t.instance)}},[e,t])}function kH(t){return function(r){const n=T_(),i=t(GR(r,n),n);return jR(n.map,r.attribution),UR(i.current,r.eventHandlers),SH(i.current,n),i}}function HR(t,e){const r=VR(t,e),n=kH(r);return vH(n)}function _H(t,e){const r=VR(t),n=xH(r,e);return yH(n)}function CH(t,e,r){e.bounds instanceof Vd.LatLngBounds&&e.bounds!==r.bounds&&t.setBounds(e.bounds),e.opacity!=null&&e.opacity!==r.opacity&&t.setOpacity(e.opacity),e.zIndex!=null&&e.zIndex!==r.zIndex&&t.setZIndex(e.zIndex)}function EH(){return T_().map}const TH=HR(function({bounds:e,url:r,...n},i){const a=new Vd.ImageOverlay(r,e,n);return N_(a,FR(i,{overlayContainer:a}))},function(e,r,n){if(CH(e,r,n),r.bounds!==n.bounds){const i=r.bounds instanceof Vd.LatLngBounds?r.bounds:new Vd.LatLngBounds(r.bounds);e.setBounds(i)}r.url!==n.url&&e.setUrl(r.url)});function tk(){return tk=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},tk.apply(this,arguments)}function NH({bounds:t,boundsOptions:e,center:r,children:n,className:i,id:a,placeholder:s,style:o,whenReady:l,zoom:u,...c},h){const[p]=ie.useState({className:i,id:a,style:o}),[v,y]=ie.useState(null);ie.useImperativeHandle(h,()=>v?.map??null,[v]);const S=ie.useCallback(T=>{if(T!==null&&v===null){const _=new Vd.Map(T,c);r!=null&&u!=null?_.setView(r,u):t!=null&&_.fitBounds(t,e),l!=null&&_.whenReady(l),y(gH(_))}},[]);ie.useEffect(()=>()=>{v?.map.remove()},[v]);const w=v?nr.createElement(zR,{value:v},n):s??null;return nr.createElement("div",tk({},p,{ref:S}),w)}const PH=ie.forwardRef(NH),MH=HR(function({position:e,...r},n){const i=new Vd.Marker(e,r);return N_(i,FR(n,{overlayContainer:i}))},function(e,r,n){r.position!==n.position&&e.setLatLng(r.position),r.icon!=null&&r.icon!==n.icon&&e.setIcon(r.icon),r.zIndexOffset!=null&&r.zIndexOffset!==n.zIndexOffset&&e.setZIndexOffset(r.zIndexOffset),r.opacity!=null&&r.opacity!==n.opacity&&e.setOpacity(r.opacity),e.dragging!=null&&r.draggable!==n.draggable&&(r.draggable===!0?e.dragging.enable():e.dragging.disable())}),AH=_H(function(e,r){const n=new Vd.Popup(e,r.overlayContainer);return N_(n,r)},function(e,r,{position:n},i){ie.useEffect(function(){const{instance:s}=e;function o(u){u.popup===s&&(s.update(),i(!0))}function l(u){u.popup===s&&i(!1)}return r.map.on({popupopen:o,popupclose:l}),r.overlayContainer==null?(n!=null&&s.setLatLng(n),s.openOn(r.map)):r.overlayContainer.bindPopup(s),function(){r.map.off({popupopen:o,popupclose:l}),r.overlayContainer?.unbindPopup(),r.map.removeLayer(s)}},[e,r,i,n])});delete U1.Icon.Default.prototype._getIconUrl;U1.Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png"});const RH=(t="default")=>{const e=`
        <div class="custom-marker-icon marker-${t}">
            <span class="material-symbols-outlined" style="font-size: 18px; color: white;">
                ${LH(t)}
            </span>
        </div>
    `;return U1.divIcon({html:e,className:"custom-leaflet-marker",iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-32]})},LH=t=>{const e={city:"location_city",dungeon:"castle",landmark:"place",battle:"swords",default:"location_on"};return e[t]||e.default},OH=({bounds:t})=>{const e=EH();return nr.useEffect(()=>{t&&e.fitBounds(t)},[e,t]),null},DH=({mapImage:t,markers:e=[],onMarkerClick:r,imageWidth:n=1920,imageHeight:i=1080})=>{const a=ie.useMemo(()=>[[0,0],[i,n]],[n,i]),s=ie.useMemo(()=>[i/2,n/2],[n,i]),o=e.length>0?e:[];return m.jsxs("div",{className:"w-full h-full relative",children:[m.jsxs(PH,{center:s,zoom:0,minZoom:-2,maxZoom:3,crs:U1.CRS.Simple,style:{height:"100%",width:"100%",background:"#0a0a0c"},zoomControl:!0,attributionControl:!1,children:[t&&m.jsx(TH,{url:t,bounds:a,opacity:1}),m.jsx(OH,{bounds:a}),o.map((l,u)=>{const c=l.position||[i/2,n/2];return m.jsx(MH,{position:c,icon:RH(l.type),eventHandlers:{click:()=>{r&&r(l)}},children:m.jsx(AH,{children:m.jsxs("div",{className:"space-y-2",children:[m.jsx("h3",{className:"text-white font-bold",children:l.label||"Unnamed Location"}),l.description&&m.jsx("p",{className:"text-slate-400 text-sm",children:l.description}),l.entityId&&m.jsxs("a",{href:`#/entity/${l.entityId}`,className:"text-primary hover:underline text-sm inline-flex items-center gap-1",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"open_in_new"}),"View Details"]})]})})},l.id||u)})]}),o.length>0&&m.jsxs("div",{className:"absolute bottom-4 left-4 bg-surface-dark/90 backdrop-blur-xl border border-white/10 rounded-2xl p-4 max-w-xs z-[1000]",children:[m.jsxs("h4",{className:"text-white font-bold text-sm mb-2 flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-primary",children:"map"}),"Locations (",o.length,")"]}),m.jsxs("div",{className:"space-y-1 max-h-40 overflow-y-auto no-scrollbar",children:[o.slice(0,10).map((l,u)=>m.jsxs("div",{className:"text-xs text-slate-400 flex items-center gap-2 hover:text-white cursor-pointer transition-colors",onClick:()=>r&&r(l),children:[m.jsx("span",{className:"w-2 h-2 rounded-full bg-primary"}),l.label||`Location ${u+1}`]},l.id||u)),o.length>10&&m.jsxs("p",{className:"text-xs text-slate-500 italic",children:["+",o.length-10," more..."]})]})]})]})},IH=({map:t})=>{const{t:e}=bc(),[r,n]=ie.useState(null),i=t?.nombre||e("maps.explorer"),a=t?.attributes||{};let s={};if(!a.bgImage&&t?.descripcion&&t?.descripcion.startsWith("{"))try{s=JSON.parse(t.descripcion)}catch{}const o=a.bgImage||s.bgImage||t?.iconUrl||null,l=a.markers||[],u=a.imageWidth||1920,c=a.imageHeight||1080,h=p=>{n(p),console.log("Marker clicked:",p)};return m.jsxs("div",{className:"flex-1 flex overflow-hidden bg-background-dark font-sans text-slate-300 relative",children:[m.jsxs("main",{className:"flex-1 overflow-hidden relative group",children:[m.jsx("div",{className:"absolute inset-4 rounded-[2.5rem] overflow-hidden border border-white/5 shadow-2xl bg-surface-dark",children:o?m.jsx(DH,{mapImage:o,markers:l,onMarkerClick:h,imageWidth:u,imageHeight:c}):m.jsx("div",{className:"w-full h-full flex items-center justify-center text-slate-500",children:m.jsxs("div",{className:"text-center space-y-4",children:[m.jsx("span",{className:"material-symbols-outlined text-6xl opacity-20",children:"map"}),m.jsx("p",{children:e("maps.not_found")}),m.jsx("p",{className:"text-xs text-slate-600",children:e("maps.upload_desc")})]})})}),m.jsx("div",{className:"absolute top-8 left-8 z-[1000]",children:m.jsx(An,{className:"px-6 py-3 border-white/10",children:m.jsxs("h1",{className:"text-2xl font-black text-white tracking-tight flex items-center gap-3",children:[m.jsx("span",{className:"material-symbols-outlined text-primary",children:"public"}),i]})})}),m.jsxs("div",{className:"absolute top-8 right-8 z-[1000] flex gap-3",children:[m.jsx("button",{className:"size-12 rounded-xl bg-surface-dark/90 backdrop-blur-xl border border-white/10 flex items-center justify-center text-slate-400 hover:text-white hover:border-primary/50 transition-all shadow-lg",title:e("maps.fullscreen"),children:m.jsx("span",{className:"material-symbols-outlined",children:"fullscreen"})}),m.jsx("button",{className:"size-12 rounded-xl bg-surface-dark/90 backdrop-blur-xl border border-white/10 flex items-center justify-center text-slate-400 hover:text-white hover:border-primary/50 transition-all shadow-lg",title:e("maps.share"),children:m.jsx("span",{className:"material-symbols-outlined",children:"share"})})]})]}),m.jsx("aside",{className:`flex-none bg-surface-dark border-l border-white/5 transition-all duration-700 relative z-30 ${r?"w-96 p-8 opacity-100":"w-0 p-0 opacity-0 overflow-hidden"}`,children:r&&m.jsxs("div",{className:"flex flex-col h-full gap-8 animate-in slide-in-from-right-8 duration-500",children:[m.jsxs("header",{className:"space-y-6",children:[m.jsxs("div",{className:"relative aspect-[4/3] rounded-3xl overflow-hidden border border-white/10 shadow-xl group",children:[m.jsx("img",{src:"https://images.unsplash.com/photo-1533154683836-84ea7a0bc310?auto=format&fit=crop&w=500&q=80",alt:"Detail",className:"w-full h-full object-cover grayscale-[0.4] group-hover:grayscale-0 transition-all duration-700"}),m.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-background-dark via-transparent to-transparent"}),m.jsx("div",{className:"absolute top-4 right-4 flex gap-2",children:m.jsx("button",{onClick:()=>n(null),className:"size-8 rounded-lg bg-black/40 border border-white/10 backdrop-blur-md text-white flex items-center justify-center hover:bg-black/60 transition-colors",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"close"})})}),m.jsxs("div",{className:"absolute bottom-4 left-4 flex gap-2",children:[m.jsx("span",{className:"px-3 py-1 rounded bg-primary/20 text-primary border border-primary/20 text-[8px] font-black uppercase tracking-widest backdrop-blur-md",children:e("maps.place")}),m.jsx("span",{className:"px-3 py-1 rounded bg-emerald-500/20 text-emerald-400 border border-emerald-500/20 text-[8px] font-black uppercase tracking-widest backdrop-blur-md",children:e("maps.capital")})]})]}),m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{className:"flex justify-between items-start",children:[m.jsx("h2",{className:"text-3xl font-manrope font-black text-white tracking-tight leading-none",children:r.label||r.name}),m.jsx("button",{className:"text-slate-500 hover:text-white transition-colors p-2 rounded-xl hover:bg-white/5",children:m.jsx("span",{className:"material-symbols-outlined",children:"edit"})})]}),m.jsx("p",{className:"text-sm text-slate-400 leading-relaxed font-manrope",children:r.description||"No description available"})]})]}),m.jsxs("div",{className:"space-y-8 flex-1 overflow-y-auto no-scrollbar",children:[m.jsxs("section",{className:"space-y-4",children:[m.jsxs("div",{className:"flex justify-between items-center px-1",children:[m.jsx("h3",{className:"text-[10px] font-black uppercase tracking-[0.2em] text-slate-500",children:e("maps.inhabitants")}),m.jsx("button",{className:"text-[10px] font-bold text-primary hover:underline transition-all",children:e("maps.view_all")})]}),m.jsxs("div",{className:"space-y-3",children:[m.jsx(C4,{name:"Lyra Ignis",role:"Gran Maga"}),m.jsx(C4,{name:"Kaelen",role:"Capitn de la Guardia"})]})]}),m.jsxs("section",{className:"space-y-4",children:[m.jsx("h3",{className:"text-[10px] font-black uppercase tracking-[0.2em] text-slate-500 px-1",children:e("maps.related_events")}),m.jsx(An,{className:"p-4 border-white/5 hover:border-white/10 transition-all cursor-pointer group",children:m.jsxs("div",{className:"flex gap-4 items-center",children:[m.jsx("div",{className:"size-10 rounded-xl bg-amber-500/10 text-amber-500 border border-amber-500/20 flex items-center justify-center",children:m.jsx("span",{className:"material-symbols-outlined text-xl",children:"history_edu"})}),m.jsxs("div",{children:[m.jsx("h4",{className:"text-xs font-bold text-white group-hover:text-primary transition-colors",children:"El Asedio de Ceniza"}),m.jsx("p",{className:"text-[10px] text-slate-500 font-medium",children:"Hace 300 aos"})]})]})})]})]}),m.jsx("footer",{className:"pt-6 border-t border-white/5",children:m.jsx(Yn,{variant:"primary",icon:"auto_stories",className:"w-full py-4 rounded-2xl shadow-xl shadow-primary/20",children:e("maps.open_bible")})})]})})]})},C4=({name:t,role:e})=>m.jsxs("div",{className:"flex items-center gap-4 p-3 rounded-2xl bg-white/[0.02] border border-white/5 hover:border-white/10 transition-all cursor-pointer group",children:[m.jsx(rx,{name:t,size:"sm",className:"border-white/10 group-hover:border-primary/50 transition-all"}),m.jsxs("div",{className:"flex-1 min-w-0",children:[m.jsx("h4",{className:"text-xs font-bold text-white truncate",children:t}),m.jsx("p",{className:"text-[10px] text-slate-500 font-medium truncate",children:e})]}),m.jsx("span",{className:"material-symbols-outlined text-slate-700 text-sm group-hover:text-white transition-colors",children:"chevron_right"})]}),jH=({maps:t,onSelect:e,onCreateNew:r,onClose:n})=>m.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-background-dark/80 backdrop-blur-xl animate-in fade-in duration-300",children:m.jsx("div",{className:"w-full max-w-3xl animate-in zoom-in-95 duration-500",children:m.jsxs(An,{className:"overflow-hidden border-white/10 shadow-2xl",children:[m.jsxs("header",{className:"p-6 border-b border-white/5 flex justify-between items-center bg-white/[0.02]",children:[m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsx("span",{className:"material-symbols-outlined text-primary",children:"map"}),m.jsx("h2",{className:"text-xl font-manrope font-black text-white",children:"Cartografa del Proyecto"})]}),m.jsx("button",{onClick:n,className:"text-slate-500 hover:text-white transition-colors",children:m.jsx("span",{className:"material-symbols-outlined",children:"close"})})]}),m.jsxs("div",{className:"p-8 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 max-h-[60vh] overflow-y-auto custom-scrollbar",children:[m.jsxs("div",{onClick:r,className:"group p-6 rounded-2xl border-2 border-dashed border-white/5 hover:border-primary/50 hover:bg-primary/5 transition-all cursor-pointer flex flex-col items-center justify-center text-center gap-3",children:[m.jsx("div",{className:"size-12 rounded-full bg-primary/10 text-primary flex items-center justify-center group-hover:scale-110 transition-transform",children:m.jsx("span",{className:"material-symbols-outlined",children:"add"})}),m.jsxs("div",{children:[m.jsx("h3",{className:"text-sm font-bold text-white",children:"Nuevo Mapa"}),m.jsx("p",{className:"text-[10px] text-slate-500 uppercase font-black tracking-tighter",children:"Crear desde cero"})]})]}),t.map(i=>{const a=i.attributes?.snapshotUrl||i.attributes?.bgImage||i.iconUrl;return m.jsxs("div",{onClick:()=>e(i),className:"group p-4 rounded-2xl bg-white/5 border border-white/5 hover:border-primary/50 hover:bg-white/10 transition-all cursor-pointer space-y-3",children:[m.jsx("div",{className:"aspect-video rounded-xl bg-surface-light border border-white/5 flex items-center justify-center overflow-hidden",children:a?m.jsx("img",{src:a,alt:i.nombre,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"}):m.jsx("span",{className:"material-symbols-outlined text-4xl opacity-20 group-hover:opacity-40 transition-opacity",children:"image"})}),m.jsxs("div",{children:[m.jsx("h3",{className:"text-sm font-bold text-white truncate",children:i.nombre}),m.jsxs("p",{className:"text-[10px] text-slate-500 uppercase font-black tracking-tighter",children:[i.attributes?.layers?.length||0," capas"]})]})]},i.id)})]}),m.jsx("footer",{className:"p-6 bg-white/[0.02] border-t border-white/5 flex justify-end",children:m.jsx("p",{className:"text-[10px] text-slate-600 font-bold uppercase tracking-widest",children:"Selecciona un mapa para cargar el visor"})})]})})}),FH=()=>{const{username:t,projectName:e}=Zi(),r=Wa(),[n,i]=ie.useState("viewer"),[a,s]=ie.useState([]),[o,l]=ie.useState(null),[u,c]=ie.useState(!1),[h,p]=ie.useState(null);nr.useEffect(()=>{v()},[]);const v=async()=>{try{const w=(await et.get("/world-bible/entities")).filter(T=>T.tipoEspecial==="map");s(w),w.length>0&&!o&&l(w[0])}catch(S){console.error("Error loading maps",S)}},y=async(S,w,T)=>{try{const _=await et.get("/world-bible/folders"),C=_.find(A=>A.nombre.toLowerCase().includes("map"))||_[0];if(!C){console.error("No folders available to create map");return}const N=await et.post("/world-bible/entities",{nombre:w,carpetaId:C.id,tipoEspecial:"map",categoria:"Location",descripcion:"",iconUrl:"",attributes:{mapType:"regional",layers:[]}});p(N.id),i("wizard"),c(!1),await v(),setTimeout(()=>{i("editor")},100)}catch(_){console.error("Error creating map:",_)}};return m.jsxs("div",{className:"flex-1 flex flex-col h-full bg-background-dark overflow-hidden",children:[n==="viewer"&&m.jsxs("div",{className:"flex-1 flex flex-col h-full relative",children:[m.jsx("button",{onClick:()=>c(!0),className:"absolute right-12 bottom-12 z-50 size-16 rounded-3xl bg-primary text-white flex items-center justify-center shadow-2xl shadow-primary/40 hover:scale-110 active:scale-95 transition-all group",children:m.jsx("span",{className:"material-symbols-outlined text-3xl group-hover:rotate-90 transition-transform duration-300",children:"add"})}),m.jsx(IH,{map:o}),u&&m.jsx(jH,{maps:a,onSelect:S=>{l(S),c(!1)},onCreateNew:()=>{c(!1),i("wizard")},onClose:()=>c(!1)})]}),n==="wizard"&&m.jsx(gG,{onCancel:()=>i("viewer"),onCreate:y}),n==="editor"&&m.jsx(ek,{mode:h?"create":"edit",entityId:h,onBack:()=>{i("viewer"),p(null)},onSave:async()=>{await v(),h?r(`/local/${e}/entity/${h}`):i("viewer"),p(null)}})]})};String.prototype.codePointAt||(function(){var t=(function(){try{var r={},n=Object.defineProperty,i=n(r,r,r)&&n}catch{}return i})(),e=function(r){if(this==null)throw TypeError();var n=String(this),i=n.length,a=r?Number(r):0;if(a!=a&&(a=0),!(a<0||a>=i)){var s=n.charCodeAt(a),o;return s>=55296&&s<=56319&&i>a+1&&(o=n.charCodeAt(a+1),o>=56320&&o<=57343)?(s-55296)*1024+o-56320+65536:s}};t?t(String.prototype,"codePointAt",{value:e,configurable:!0,writable:!0}):String.prototype.codePointAt=e})();function WR(){this.table=new Uint16Array(16),this.trans=new Uint16Array(288)}var BH=new WR,zH=new WR,qR=new Uint8Array(30),$R=new Uint16Array(30),UH=new Uint8Array(30),GH=new Uint16Array(30);function KR(t,e,r,n){var i,a;for(i=0;i<r;++i)t[i]=0;for(i=0;i<30-r;++i)t[i+r]=i/r|0;for(a=n,i=0;i<30;++i)e[i]=a,a+=1<<t[i]}function VH(t,e){var r;for(r=0;r<7;++r)t.table[r]=0;for(t.table[7]=24,t.table[8]=152,t.table[9]=112,r=0;r<24;++r)t.trans[r]=256+r;for(r=0;r<144;++r)t.trans[24+r]=r;for(r=0;r<8;++r)t.trans[168+r]=280+r;for(r=0;r<112;++r)t.trans[176+r]=144+r;for(r=0;r<5;++r)e.table[r]=0;for(e.table[5]=32,r=0;r<32;++r)e.trans[r]=r}VH(BH,zH);KR(qR,$R,4,3);KR(UH,GH,2,1);qR[28]=0;$R[28]=258;function Sp(t,e,r,n,i){return Math.pow(1-i,3)*t+3*Math.pow(1-i,2)*i*e+3*(1-i)*Math.pow(i,2)*r+Math.pow(i,3)*n}function dh(){this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN}dh.prototype.isEmpty=function(){return isNaN(this.x1)||isNaN(this.y1)||isNaN(this.x2)||isNaN(this.y2)};dh.prototype.addPoint=function(t,e){typeof t=="number"&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=t,this.x2=t),t<this.x1&&(this.x1=t),t>this.x2&&(this.x2=t)),typeof e=="number"&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=e,this.y2=e),e<this.y1&&(this.y1=e),e>this.y2&&(this.y2=e))};dh.prototype.addX=function(t){this.addPoint(t,null)};dh.prototype.addY=function(t){this.addPoint(null,t)};dh.prototype.addBezier=function(t,e,r,n,i,a,s,o){var l=[t,e],u=[r,n],c=[i,a],h=[s,o];this.addPoint(t,e),this.addPoint(s,o);for(var p=0;p<=1;p++){var v=6*l[p]-12*u[p]+6*c[p],y=-3*l[p]+9*u[p]-9*c[p]+3*h[p],S=3*u[p]-3*l[p];if(y===0){if(v===0)continue;var w=-S/v;0<w&&w<1&&(p===0&&this.addX(Sp(l[p],u[p],c[p],h[p],w)),p===1&&this.addY(Sp(l[p],u[p],c[p],h[p],w)));continue}var T=Math.pow(v,2)-4*S*y;if(!(T<0)){var _=(-v+Math.sqrt(T))/(2*y);0<_&&_<1&&(p===0&&this.addX(Sp(l[p],u[p],c[p],h[p],_)),p===1&&this.addY(Sp(l[p],u[p],c[p],h[p],_)));var C=(-v-Math.sqrt(T))/(2*y);0<C&&C<1&&(p===0&&this.addX(Sp(l[p],u[p],c[p],h[p],C)),p===1&&this.addY(Sp(l[p],u[p],c[p],h[p],C)))}}};dh.prototype.addQuad=function(t,e,r,n,i,a){var s=t+.6666666666666666*(r-t),o=e+2/3*(n-e),l=s+1/3*(i-t),u=o+1/3*(a-e);this.addBezier(t,e,s,o,l,u,i,a)};function Xi(){this.commands=[],this.fill="black",this.stroke=null,this.strokeWidth=1}Xi.prototype.moveTo=function(t,e){this.commands.push({type:"M",x:t,y:e})};Xi.prototype.lineTo=function(t,e){this.commands.push({type:"L",x:t,y:e})};Xi.prototype.curveTo=Xi.prototype.bezierCurveTo=function(t,e,r,n,i,a){this.commands.push({type:"C",x1:t,y1:e,x2:r,y2:n,x:i,y:a})};Xi.prototype.quadTo=Xi.prototype.quadraticCurveTo=function(t,e,r,n){this.commands.push({type:"Q",x1:t,y1:e,x:r,y:n})};Xi.prototype.close=Xi.prototype.closePath=function(){this.commands.push({type:"Z"})};Xi.prototype.extend=function(t){if(t.commands)t=t.commands;else if(t instanceof dh){var e=t;this.moveTo(e.x1,e.y1),this.lineTo(e.x2,e.y1),this.lineTo(e.x2,e.y2),this.lineTo(e.x1,e.y2),this.close();return}Array.prototype.push.apply(this.commands,t)};Xi.prototype.getBoundingBox=function(){for(var t=new dh,e=0,r=0,n=0,i=0,a=0;a<this.commands.length;a++){var s=this.commands[a];switch(s.type){case"M":t.addPoint(s.x,s.y),e=n=s.x,r=i=s.y;break;case"L":t.addPoint(s.x,s.y),n=s.x,i=s.y;break;case"Q":t.addQuad(n,i,s.x1,s.y1,s.x,s.y),n=s.x,i=s.y;break;case"C":t.addBezier(n,i,s.x1,s.y1,s.x2,s.y2,s.x,s.y),n=s.x,i=s.y;break;case"Z":n=e,i=r;break;default:throw new Error("Unexpected path command "+s.type)}}return t.isEmpty()&&t.addPoint(0,0),t};Xi.prototype.draw=function(t){t.beginPath();for(var e=0;e<this.commands.length;e+=1){var r=this.commands[e];r.type==="M"?t.moveTo(r.x,r.y):r.type==="L"?t.lineTo(r.x,r.y):r.type==="C"?t.bezierCurveTo(r.x1,r.y1,r.x2,r.y2,r.x,r.y):r.type==="Q"?t.quadraticCurveTo(r.x1,r.y1,r.x,r.y):r.type==="Z"&&t.closePath()}this.fill&&(t.fillStyle=this.fill,t.fill()),this.stroke&&(t.strokeStyle=this.stroke,t.lineWidth=this.strokeWidth,t.stroke())};Xi.prototype.toPathData=function(t){t=t!==void 0?t:2;function e(s){return Math.round(s)===s?""+Math.round(s):s.toFixed(t)}function r(){for(var s=arguments,o="",l=0;l<arguments.length;l+=1){var u=s[l];u>=0&&l>0&&(o+=" "),o+=e(u)}return o}for(var n="",i=0;i<this.commands.length;i+=1){var a=this.commands[i];a.type==="M"?n+="M"+r(a.x,a.y):a.type==="L"?n+="L"+r(a.x,a.y):a.type==="C"?n+="C"+r(a.x1,a.y1,a.x2,a.y2,a.x,a.y):a.type==="Q"?n+="Q"+r(a.x1,a.y1,a.x,a.y):a.type==="Z"&&(n+="Z")}return n};Xi.prototype.toSVG=function(t){var e='<path d="';return e+=this.toPathData(t),e+='"',this.fill&&this.fill!=="black"&&(this.fill===null?e+=' fill="none"':e+=' fill="'+this.fill+'"'),this.stroke&&(e+=' stroke="'+this.stroke+'" stroke-width="'+this.strokeWidth+'"'),e+="/>",e};Xi.prototype.toDOMElement=function(t){var e=this.toPathData(t),r=document.createElementNS("http://www.w3.org/2000/svg","path");return r.setAttribute("d",e),r};function ZR(t){throw new Error(t)}function E4(t,e){t||ZR(e)}var pr={fail:ZR,argument:E4,assert:E4},T4=32768,N4=2147483648,Kp={},_t={},lr={};function Fl(t){return function(){return t}}_t.BYTE=function(t){return pr.argument(t>=0&&t<=255,"Byte value should be between 0 and 255."),[t]};lr.BYTE=Fl(1);_t.CHAR=function(t){return[t.charCodeAt(0)]};lr.CHAR=Fl(1);_t.CHARARRAY=function(t){typeof t>"u"&&(t="",console.warn("Undefined CHARARRAY encountered and treated as an empty string. This is probably caused by a missing glyph name."));for(var e=[],r=0;r<t.length;r+=1)e[r]=t.charCodeAt(r);return e};lr.CHARARRAY=function(t){return typeof t>"u"?0:t.length};_t.USHORT=function(t){return[t>>8&255,t&255]};lr.USHORT=Fl(2);_t.SHORT=function(t){return t>=T4&&(t=-(2*T4-t)),[t>>8&255,t&255]};lr.SHORT=Fl(2);_t.UINT24=function(t){return[t>>16&255,t>>8&255,t&255]};lr.UINT24=Fl(3);_t.ULONG=function(t){return[t>>24&255,t>>16&255,t>>8&255,t&255]};lr.ULONG=Fl(4);_t.LONG=function(t){return t>=N4&&(t=-(2*N4-t)),[t>>24&255,t>>16&255,t>>8&255,t&255]};lr.LONG=Fl(4);_t.FIXED=_t.ULONG;lr.FIXED=lr.ULONG;_t.FWORD=_t.SHORT;lr.FWORD=lr.SHORT;_t.UFWORD=_t.USHORT;lr.UFWORD=lr.USHORT;_t.LONGDATETIME=function(t){return[0,0,0,0,t>>24&255,t>>16&255,t>>8&255,t&255]};lr.LONGDATETIME=Fl(8);_t.TAG=function(t){return pr.argument(t.length===4,"Tag should be exactly 4 ASCII characters."),[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]};lr.TAG=Fl(4);_t.Card8=_t.BYTE;lr.Card8=lr.BYTE;_t.Card16=_t.USHORT;lr.Card16=lr.USHORT;_t.OffSize=_t.BYTE;lr.OffSize=lr.BYTE;_t.SID=_t.USHORT;lr.SID=lr.USHORT;_t.NUMBER=function(t){return t>=-107&&t<=107?[t+139]:t>=108&&t<=1131?(t=t-108,[(t>>8)+247,t&255]):t>=-1131&&t<=-108?(t=-t-108,[(t>>8)+251,t&255]):t>=-32768&&t<=32767?_t.NUMBER16(t):_t.NUMBER32(t)};lr.NUMBER=function(t){return _t.NUMBER(t).length};_t.NUMBER16=function(t){return[28,t>>8&255,t&255]};lr.NUMBER16=Fl(3);_t.NUMBER32=function(t){return[29,t>>24&255,t>>16&255,t>>8&255,t&255]};lr.NUMBER32=Fl(5);_t.REAL=function(t){var e=t.toString(),r=/\.(\d*?)(?:9{5,20}|0{5,20})\d{0,2}(?:e(.+)|$)/.exec(e);if(r){var n=parseFloat("1e"+((r[2]?+r[2]:0)+r[1].length));e=(Math.round(t*n)/n).toString()}for(var i="",a=0,s=e.length;a<s;a+=1){var o=e[a];o==="e"?i+=e[++a]==="-"?"c":"b":o==="."?i+="a":o==="-"?i+="e":i+=o}i+=i.length&1?"f":"ff";for(var l=[30],u=0,c=i.length;u<c;u+=2)l.push(parseInt(i.substr(u,2),16));return l};lr.REAL=function(t){return _t.REAL(t).length};_t.NAME=_t.CHARARRAY;lr.NAME=lr.CHARARRAY;_t.STRING=_t.CHARARRAY;lr.STRING=lr.CHARARRAY;Kp.UTF8=function(t,e,r){for(var n=[],i=r,a=0;a<i;a++,e+=1)n[a]=t.getUint8(e);return String.fromCharCode.apply(null,n)};Kp.UTF16=function(t,e,r){for(var n=[],i=r/2,a=0;a<i;a++,e+=2)n[a]=t.getUint16(e);return String.fromCharCode.apply(null,n)};_t.UTF16=function(t){for(var e=[],r=0;r<t.length;r+=1){var n=t.charCodeAt(r);e[e.length]=n>>8&255,e[e.length]=n&255}return e};lr.UTF16=function(t){return t.length*2};var rk={"x-mac-croatian":"","x-mac-cyrillic":"","x-mac-gaelic":"","x-mac-greek":"","x-mac-icelandic":"","x-mac-inuit":"","x-mac-ce":"",macintosh:"","x-mac-romanian":"","x-mac-turkish":""};Kp.MACSTRING=function(t,e,r,n){var i=rk[n];if(i!==void 0){for(var a="",s=0;s<r;s++){var o=t.getUint8(e+s);o<=127?a+=String.fromCharCode(o):a+=i[o&127]}return a}};var py=typeof WeakMap=="function"&&new WeakMap,my,HH=function(t){if(!my){my={};for(var e in rk)my[e]=new String(e)}var r=my[t];if(r!==void 0){if(py){var n=py.get(r);if(n!==void 0)return n}var i=rk[t];if(i!==void 0){for(var a={},s=0;s<i.length;s++)a[i.charCodeAt(s)]=s+128;return py&&py.set(r,a),a}}};_t.MACSTRING=function(t,e){var r=HH(e);if(r!==void 0){for(var n=[],i=0;i<t.length;i++){var a=t.charCodeAt(i);if(a>=128&&(a=r[a],a===void 0))return;n[i]=a}return n}};lr.MACSTRING=function(t,e){var r=_t.MACSTRING(t,e);return r!==void 0?r.length:0};function nk(t){return t>=-128&&t<=127}function WH(t,e,r){for(var n=0,i=t.length;e<i&&n<64&&t[e]===0;)++e,++n;return r.push(128|n-1),e}function qH(t,e,r){for(var n=0,i=t.length,a=e;a<i&&n<64;){var s=t[a];if(!nk(s)||s===0&&a+1<i&&t[a+1]===0)break;++a,++n}r.push(n-1);for(var o=e;o<a;++o)r.push(t[o]+256&255);return a}function $H(t,e,r){for(var n=0,i=t.length,a=e;a<i&&n<64;){var s=t[a];if(s===0||nk(s)&&a+1<i&&nk(t[a+1]))break;++a,++n}r.push(64|n-1);for(var o=e;o<a;++o){var l=t[o];r.push(l+65536>>8&255,l+256&255)}return a}_t.VARDELTAS=function(t){for(var e=0,r=[];e<t.length;){var n=t[e];n===0?e=WH(t,e,r):n>=-128&&n<=127?e=qH(t,e,r):e=$H(t,e,r)}return r};_t.INDEX=function(t){for(var e=1,r=[e],n=[],i=0;i<t.length;i+=1){var a=_t.OBJECT(t[i]);Array.prototype.push.apply(n,a),e+=a.length,r.push(e)}if(n.length===0)return[0,0];for(var s=[],o=1+Math.floor(Math.log(e)/Math.log(2))/8|0,l=[void 0,_t.BYTE,_t.USHORT,_t.UINT24,_t.ULONG][o],u=0;u<r.length;u+=1){var c=l(r[u]);Array.prototype.push.apply(s,c)}return Array.prototype.concat(_t.Card16(t.length),_t.OffSize(o),s,n)};lr.INDEX=function(t){return _t.INDEX(t).length};_t.DICT=function(t){for(var e=[],r=Object.keys(t),n=r.length,i=0;i<n;i+=1){var a=parseInt(r[i],0),s=t[a];e=e.concat(_t.OPERAND(s.value,s.type)),e=e.concat(_t.OPERATOR(a))}return e};lr.DICT=function(t){return _t.DICT(t).length};_t.OPERATOR=function(t){return t<1200?[t]:[12,t-1200]};_t.OPERAND=function(t,e){var r=[];if(Array.isArray(e))for(var n=0;n<e.length;n+=1)pr.argument(t.length===e.length,"Not enough arguments given for type"+e),r=r.concat(_t.OPERAND(t[n],e[n]));else if(e==="SID")r=r.concat(_t.NUMBER(t));else if(e==="offset")r=r.concat(_t.NUMBER32(t));else if(e==="number")r=r.concat(_t.NUMBER(t));else if(e==="real")r=r.concat(_t.REAL(t));else throw new Error("Unknown operand type "+e);return r};_t.OP=_t.BYTE;lr.OP=lr.BYTE;var gy=typeof WeakMap=="function"&&new WeakMap;_t.CHARSTRING=function(t){if(gy){var e=gy.get(t);if(e!==void 0)return e}for(var r=[],n=t.length,i=0;i<n;i+=1){var a=t[i];r=r.concat(_t[a.type](a.value))}return gy&&gy.set(t,r),r};lr.CHARSTRING=function(t){return _t.CHARSTRING(t).length};_t.OBJECT=function(t){var e=_t[t.type];return pr.argument(e!==void 0,"No encoding function for type "+t.type),e(t.value)};lr.OBJECT=function(t){var e=lr[t.type];return pr.argument(e!==void 0,"No sizeOf function for type "+t.type),e(t.value)};_t.TABLE=function(t){for(var e=[],r=t.fields.length,n=[],i=[],a=0;a<r;a+=1){var s=t.fields[a],o=_t[s.type];pr.argument(o!==void 0,"No encoding function for field type "+s.type+" ("+s.name+")");var l=t[s.name];l===void 0&&(l=s.value);var u=o(l);s.type==="TABLE"?(i.push(e.length),e=e.concat([0,0]),n.push(u)):e=e.concat(u)}for(var c=0;c<n.length;c+=1){var h=i[c],p=e.length;pr.argument(p<65536,"Table "+t.tableName+" too big."),e[h]=p>>8,e[h+1]=p&255,e=e.concat(n[c])}return e};lr.TABLE=function(t){for(var e=0,r=t.fields.length,n=0;n<r;n+=1){var i=t.fields[n],a=lr[i.type];pr.argument(a!==void 0,"No sizeOf function for field type "+i.type+" ("+i.name+")");var s=t[i.name];s===void 0&&(s=i.value),e+=a(s),i.type==="TABLE"&&(e+=2)}return e};_t.RECORD=_t.TABLE;lr.RECORD=lr.TABLE;_t.LITERAL=function(t){return t};lr.LITERAL=function(t){return t.length};function ga(t,e,r){if(e.length&&(e[0].name!=="coverageFormat"||e[0].value===1))for(var n=0;n<e.length;n+=1){var i=e[n];this[i.name]=i.value}if(this.tableName=t,this.fields=e,r)for(var a=Object.keys(r),s=0;s<a.length;s+=1){var o=a[s],l=r[o];this[o]!==void 0&&(this[o]=l)}}ga.prototype.encode=function(){return _t.TABLE(this)};ga.prototype.sizeOf=function(){return lr.TABLE(this)};function Pv(t,e,r){r===void 0&&(r=e.length);var n=new Array(e.length+1);n[0]={name:t+"Count",type:"USHORT",value:r};for(var i=0;i<e.length;i++)n[i+1]={name:t+i,type:"USHORT",value:e[i]};return n}function ik(t,e,r){var n=e.length,i=new Array(n+1);i[0]={name:t+"Count",type:"USHORT",value:n};for(var a=0;a<n;a++)i[a+1]={name:t+a,type:"TABLE",value:r(e[a],a)};return i}function Mv(t,e,r){var n=e.length,i=[];i[0]={name:t+"Count",type:"USHORT",value:n};for(var a=0;a<n;a++)i=i.concat(r(e[a],a));return i}function xx(t){t.format===1?ga.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:1}].concat(Pv("glyph",t.glyphs))):t.format===2?ga.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:2}].concat(Mv("rangeRecord",t.ranges,function(e){return[{name:"startGlyphID",type:"USHORT",value:e.start},{name:"endGlyphID",type:"USHORT",value:e.end},{name:"startCoverageIndex",type:"USHORT",value:e.index}]}))):pr.assert(!1,"Coverage format must be 1 or 2.")}xx.prototype=Object.create(ga.prototype);xx.prototype.constructor=xx;function bx(t){ga.call(this,"scriptListTable",Mv("scriptRecord",t,function(e,r){var n=e.script,i=n.defaultLangSys;return pr.assert(!!i,"Unable to write GSUB: script "+e.tag+" has no default language system."),[{name:"scriptTag"+r,type:"TAG",value:e.tag},{name:"script"+r,type:"TABLE",value:new ga("scriptTable",[{name:"defaultLangSys",type:"TABLE",value:new ga("defaultLangSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:i.reqFeatureIndex}].concat(Pv("featureIndex",i.featureIndexes)))}].concat(Mv("langSys",n.langSysRecords,function(a,s){var o=a.langSys;return[{name:"langSysTag"+s,type:"TAG",value:a.tag},{name:"langSys"+s,type:"TABLE",value:new ga("langSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:o.reqFeatureIndex}].concat(Pv("featureIndex",o.featureIndexes)))}]})))}]}))}bx.prototype=Object.create(ga.prototype);bx.prototype.constructor=bx;function wx(t){ga.call(this,"featureListTable",Mv("featureRecord",t,function(e,r){var n=e.feature;return[{name:"featureTag"+r,type:"TAG",value:e.tag},{name:"feature"+r,type:"TABLE",value:new ga("featureTable",[{name:"featureParams",type:"USHORT",value:n.featureParams}].concat(Pv("lookupListIndex",n.lookupListIndexes)))}]}))}wx.prototype=Object.create(ga.prototype);wx.prototype.constructor=wx;function Sx(t,e){ga.call(this,"lookupListTable",ik("lookup",t,function(r){var n=e[r.lookupType];return pr.assert(!!n,"Unable to write GSUB lookup type "+r.lookupType+" tables."),new ga("lookupTable",[{name:"lookupType",type:"USHORT",value:r.lookupType},{name:"lookupFlag",type:"USHORT",value:r.lookupFlag}].concat(ik("subtable",r.subtables,n)))}))}Sx.prototype=Object.create(ga.prototype);Sx.prototype.constructor=Sx;var Ft={Table:ga,Record:ga,Coverage:xx,ScriptList:bx,FeatureList:wx,LookupList:Sx,ushortList:Pv,tableList:ik,recordList:Mv};function P4(t,e){return t.getUint8(e)}function kx(t,e){return t.getUint16(e,!1)}function KH(t,e){return t.getInt16(e,!1)}function P_(t,e){return t.getUint32(e,!1)}function YR(t,e){var r=t.getInt16(e,!1),n=t.getUint16(e+2,!1);return r+n/65535}function ZH(t,e){for(var r="",n=e;n<e+4;n+=1)r+=String.fromCharCode(t.getInt8(n));return r}function YH(t,e,r){for(var n=0,i=0;i<r;i+=1)n<<=8,n+=t.getUint8(e+i);return n}function XH(t,e,r){for(var n=[],i=e;i<r;i+=1)n.push(t.getUint8(i));return n}function QH(t){for(var e="",r=0;r<t.length;r+=1)e+=String.fromCharCode(t[r]);return e}var JH={byte:1,uShort:2,short:2,uLong:4,fixed:4,longDateTime:8,tag:4};function We(t,e){this.data=t,this.offset=e,this.relativeOffset=0}We.prototype.parseByte=function(){var t=this.data.getUint8(this.offset+this.relativeOffset);return this.relativeOffset+=1,t};We.prototype.parseChar=function(){var t=this.data.getInt8(this.offset+this.relativeOffset);return this.relativeOffset+=1,t};We.prototype.parseCard8=We.prototype.parseByte;We.prototype.parseUShort=function(){var t=this.data.getUint16(this.offset+this.relativeOffset);return this.relativeOffset+=2,t};We.prototype.parseCard16=We.prototype.parseUShort;We.prototype.parseSID=We.prototype.parseUShort;We.prototype.parseOffset16=We.prototype.parseUShort;We.prototype.parseShort=function(){var t=this.data.getInt16(this.offset+this.relativeOffset);return this.relativeOffset+=2,t};We.prototype.parseF2Dot14=function(){var t=this.data.getInt16(this.offset+this.relativeOffset)/16384;return this.relativeOffset+=2,t};We.prototype.parseULong=function(){var t=P_(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,t};We.prototype.parseOffset32=We.prototype.parseULong;We.prototype.parseFixed=function(){var t=YR(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,t};We.prototype.parseString=function(t){var e=this.data,r=this.offset+this.relativeOffset,n="";this.relativeOffset+=t;for(var i=0;i<t;i++)n+=String.fromCharCode(e.getUint8(r+i));return n};We.prototype.parseTag=function(){return this.parseString(4)};We.prototype.parseLongDateTime=function(){var t=P_(this.data,this.offset+this.relativeOffset+4);return t-=2082844800,this.relativeOffset+=8,t};We.prototype.parseVersion=function(t){var e=kx(this.data,this.offset+this.relativeOffset),r=kx(this.data,this.offset+this.relativeOffset+2);return this.relativeOffset+=4,t===void 0&&(t=4096),e+r/t/10};We.prototype.skip=function(t,e){e===void 0&&(e=1),this.relativeOffset+=JH[t]*e};We.prototype.parseULongList=function(t){t===void 0&&(t=this.parseULong());for(var e=new Array(t),r=this.data,n=this.offset+this.relativeOffset,i=0;i<t;i++)e[i]=r.getUint32(n),n+=4;return this.relativeOffset+=t*4,e};We.prototype.parseOffset16List=We.prototype.parseUShortList=function(t){t===void 0&&(t=this.parseUShort());for(var e=new Array(t),r=this.data,n=this.offset+this.relativeOffset,i=0;i<t;i++)e[i]=r.getUint16(n),n+=2;return this.relativeOffset+=t*2,e};We.prototype.parseShortList=function(t){for(var e=new Array(t),r=this.data,n=this.offset+this.relativeOffset,i=0;i<t;i++)e[i]=r.getInt16(n),n+=2;return this.relativeOffset+=t*2,e};We.prototype.parseByteList=function(t){for(var e=new Array(t),r=this.data,n=this.offset+this.relativeOffset,i=0;i<t;i++)e[i]=r.getUint8(n++);return this.relativeOffset+=t,e};We.prototype.parseList=function(t,e){e||(e=t,t=this.parseUShort());for(var r=new Array(t),n=0;n<t;n++)r[n]=e.call(this);return r};We.prototype.parseList32=function(t,e){e||(e=t,t=this.parseULong());for(var r=new Array(t),n=0;n<t;n++)r[n]=e.call(this);return r};We.prototype.parseRecordList=function(t,e){e||(e=t,t=this.parseUShort());for(var r=new Array(t),n=Object.keys(e),i=0;i<t;i++){for(var a={},s=0;s<n.length;s++){var o=n[s],l=e[o];a[o]=l.call(this)}r[i]=a}return r};We.prototype.parseRecordList32=function(t,e){e||(e=t,t=this.parseULong());for(var r=new Array(t),n=Object.keys(e),i=0;i<t;i++){for(var a={},s=0;s<n.length;s++){var o=n[s],l=e[o];a[o]=l.call(this)}r[i]=a}return r};We.prototype.parseStruct=function(t){if(typeof t=="function")return t.call(this);for(var e=Object.keys(t),r={},n=0;n<e.length;n++){var i=e[n],a=t[i];r[i]=a.call(this)}return r};We.prototype.parseValueRecord=function(t){if(t===void 0&&(t=this.parseUShort()),t!==0){var e={};return t&1&&(e.xPlacement=this.parseShort()),t&2&&(e.yPlacement=this.parseShort()),t&4&&(e.xAdvance=this.parseShort()),t&8&&(e.yAdvance=this.parseShort()),t&16&&(e.xPlaDevice=void 0,this.parseShort()),t&32&&(e.yPlaDevice=void 0,this.parseShort()),t&64&&(e.xAdvDevice=void 0,this.parseShort()),t&128&&(e.yAdvDevice=void 0,this.parseShort()),e}};We.prototype.parseValueRecordList=function(){for(var t=this.parseUShort(),e=this.parseUShort(),r=new Array(e),n=0;n<e;n++)r[n]=this.parseValueRecord(t);return r};We.prototype.parsePointer=function(t){var e=this.parseOffset16();if(e>0)return new We(this.data,this.offset+e).parseStruct(t)};We.prototype.parsePointer32=function(t){var e=this.parseOffset32();if(e>0)return new We(this.data,this.offset+e).parseStruct(t)};We.prototype.parseListOfLists=function(t){for(var e=this.parseOffset16List(),r=e.length,n=this.relativeOffset,i=new Array(r),a=0;a<r;a++){var s=e[a];if(s===0){i[a]=void 0;continue}if(this.relativeOffset=s,t){for(var o=this.parseOffset16List(),l=new Array(o.length),u=0;u<o.length;u++)this.relativeOffset=s+o[u],l[u]=t.call(this);i[a]=l}else i[a]=this.parseUShortList()}return this.relativeOffset=n,i};We.prototype.parseCoverage=function(){var t=this.offset+this.relativeOffset,e=this.parseUShort(),r=this.parseUShort();if(e===1)return{format:1,glyphs:this.parseUShortList(r)};if(e===2){for(var n=new Array(r),i=0;i<r;i++)n[i]={start:this.parseUShort(),end:this.parseUShort(),index:this.parseUShort()};return{format:2,ranges:n}}throw new Error("0x"+t.toString(16)+": Coverage format must be 1 or 2.")};We.prototype.parseClassDef=function(){var t=this.offset+this.relativeOffset,e=this.parseUShort();if(e===1)return{format:1,startGlyph:this.parseUShort(),classes:this.parseUShortList()};if(e===2)return{format:2,ranges:this.parseRecordList({start:We.uShort,end:We.uShort,classId:We.uShort})};throw new Error("0x"+t.toString(16)+": ClassDef format must be 1 or 2.")};We.list=function(t,e){return function(){return this.parseList(t,e)}};We.list32=function(t,e){return function(){return this.parseList32(t,e)}};We.recordList=function(t,e){return function(){return this.parseRecordList(t,e)}};We.recordList32=function(t,e){return function(){return this.parseRecordList32(t,e)}};We.pointer=function(t){return function(){return this.parsePointer(t)}};We.pointer32=function(t){return function(){return this.parsePointer32(t)}};We.tag=We.prototype.parseTag;We.byte=We.prototype.parseByte;We.uShort=We.offset16=We.prototype.parseUShort;We.uShortList=We.prototype.parseUShortList;We.uLong=We.offset32=We.prototype.parseULong;We.uLongList=We.prototype.parseULongList;We.struct=We.prototype.parseStruct;We.coverage=We.prototype.parseCoverage;We.classDef=We.prototype.parseClassDef;var M4={reserved:We.uShort,reqFeatureIndex:We.uShort,featureIndexes:We.uShortList};We.prototype.parseScriptList=function(){return this.parsePointer(We.recordList({tag:We.tag,script:We.pointer({defaultLangSys:We.pointer(M4),langSysRecords:We.recordList({tag:We.tag,langSys:We.pointer(M4)})})}))||[]};We.prototype.parseFeatureList=function(){return this.parsePointer(We.recordList({tag:We.tag,feature:We.pointer({featureParams:We.offset16,lookupListIndexes:We.uShortList})}))||[]};We.prototype.parseLookupList=function(t){return this.parsePointer(We.list(We.pointer(function(){var e=this.parseUShort();pr.argument(1<=e&&e<=9,"GPOS/GSUB lookup type "+e+" unknown.");var r=this.parseUShort(),n=r&16;return{lookupType:e,lookupFlag:r,subtables:this.parseList(We.pointer(t[e])),markFilteringSet:n?this.parseUShort():void 0}})))||[]};We.prototype.parseFeatureVariationsList=function(){return this.parsePointer32(function(){var t=this.parseUShort(),e=this.parseUShort();pr.argument(t===1&&e<1,"GPOS/GSUB feature variations table unknown.");var r=this.parseRecordList32({conditionSetOffset:We.offset32,featureTableSubstitutionOffset:We.offset32});return r})||[]};var yr={getByte:P4,getCard8:P4,getUShort:kx,getCard16:kx,getShort:KH,getULong:P_,getFixed:YR,getTag:ZH,getOffset:YH,getBytes:XH,bytesToString:QH,Parser:We};function eW(t,e){e.parseUShort(),t.length=e.parseULong(),t.language=e.parseULong();var r;t.groupCount=r=e.parseULong(),t.glyphIndexMap={};for(var n=0;n<r;n+=1)for(var i=e.parseULong(),a=e.parseULong(),s=e.parseULong(),o=i;o<=a;o+=1)t.glyphIndexMap[o]=s,s++}function tW(t,e,r,n,i){t.length=e.parseUShort(),t.language=e.parseUShort();var a;t.segCount=a=e.parseUShort()>>1,e.skip("uShort",3),t.glyphIndexMap={};for(var s=new yr.Parser(r,n+i+14),o=new yr.Parser(r,n+i+16+a*2),l=new yr.Parser(r,n+i+16+a*4),u=new yr.Parser(r,n+i+16+a*6),c=n+i+16+a*8,h=0;h<a-1;h+=1)for(var p=void 0,v=s.parseUShort(),y=o.parseUShort(),S=l.parseShort(),w=u.parseUShort(),T=y;T<=v;T+=1)w!==0?(c=u.offset+u.relativeOffset-2,c+=w,c+=(T-y)*2,p=yr.getUShort(r,c),p!==0&&(p=p+S&65535)):p=T+S&65535,t.glyphIndexMap[T]=p}function rW(t,e){var r={};r.version=yr.getUShort(t,e),pr.argument(r.version===0,"cmap table version should be 0."),r.numTables=yr.getUShort(t,e+2);for(var n=-1,i=r.numTables-1;i>=0;i-=1){var a=yr.getUShort(t,e+4+i*8),s=yr.getUShort(t,e+4+i*8+2);if(a===3&&(s===0||s===1||s===10)||a===0&&(s===0||s===1||s===2||s===3||s===4)){n=yr.getULong(t,e+4+i*8+4);break}}if(n===-1)throw new Error("No valid cmap sub-tables found.");var o=new yr.Parser(t,e+n);if(r.format=o.parseUShort(),r.format===12)eW(r,o);else if(r.format===4)tW(r,o,t,e,n);else throw new Error("Only format 4 and 12 cmap tables are supported (found format "+r.format+").");return r}function nW(t,e,r){t.segments.push({end:e,start:e,delta:-(e-r),offset:0,glyphIndex:r})}function iW(t){t.segments.push({end:65535,start:65535,delta:1,offset:0})}function aW(t){var e=!0,r;for(r=t.length-1;r>0;r-=1){var n=t.get(r);if(n.unicode>65535){console.log("Adding CMAP format 12 (needed!)"),e=!1;break}}var i=[{name:"version",type:"USHORT",value:0},{name:"numTables",type:"USHORT",value:e?1:2},{name:"platformID",type:"USHORT",value:3},{name:"encodingID",type:"USHORT",value:1},{name:"offset",type:"ULONG",value:e?12:20}];e||(i=i.concat([{name:"cmap12PlatformID",type:"USHORT",value:3},{name:"cmap12EncodingID",type:"USHORT",value:10},{name:"cmap12Offset",type:"ULONG",value:0}])),i=i.concat([{name:"format",type:"USHORT",value:4},{name:"cmap4Length",type:"USHORT",value:0},{name:"language",type:"USHORT",value:0},{name:"segCountX2",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);var a=new Ft.Table("cmap",i);for(a.segments=[],r=0;r<t.length;r+=1){for(var s=t.get(r),o=0;o<s.unicodes.length;o+=1)nW(a,s.unicodes[o],r);a.segments=a.segments.sort(function(_,C){return _.start-C.start})}iW(a);var l=a.segments.length,u=0,c=[],h=[],p=[],v=[],y=[],S=[];for(r=0;r<l;r+=1){var w=a.segments[r];w.end<=65535&&w.start<=65535?(c=c.concat({name:"end_"+r,type:"USHORT",value:w.end}),h=h.concat({name:"start_"+r,type:"USHORT",value:w.start}),p=p.concat({name:"idDelta_"+r,type:"SHORT",value:w.delta}),v=v.concat({name:"idRangeOffset_"+r,type:"USHORT",value:w.offset}),w.glyphId!==void 0&&(y=y.concat({name:"glyph_"+r,type:"USHORT",value:w.glyphId}))):u+=1,!e&&w.glyphIndex!==void 0&&(S=S.concat({name:"cmap12Start_"+r,type:"ULONG",value:w.start}),S=S.concat({name:"cmap12End_"+r,type:"ULONG",value:w.end}),S=S.concat({name:"cmap12Glyph_"+r,type:"ULONG",value:w.glyphIndex}))}if(a.segCountX2=(l-u)*2,a.searchRange=Math.pow(2,Math.floor(Math.log(l-u)/Math.log(2)))*2,a.entrySelector=Math.log(a.searchRange/2)/Math.log(2),a.rangeShift=a.segCountX2-a.searchRange,a.fields=a.fields.concat(c),a.fields.push({name:"reservedPad",type:"USHORT",value:0}),a.fields=a.fields.concat(h),a.fields=a.fields.concat(p),a.fields=a.fields.concat(v),a.fields=a.fields.concat(y),a.cmap4Length=14+c.length*2+2+h.length*2+p.length*2+v.length*2+y.length*2,!e){var T=16+S.length*4;a.cmap12Offset=20+a.cmap4Length,a.fields=a.fields.concat([{name:"cmap12Format",type:"USHORT",value:12},{name:"cmap12Reserved",type:"USHORT",value:0},{name:"cmap12Length",type:"ULONG",value:T},{name:"cmap12Language",type:"ULONG",value:0},{name:"cmap12nGroups",type:"ULONG",value:S.length/3}]),a.fields=a.fields.concat(S)}return a}var sW={parse:rW,make:aW},qy=[".notdef","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","endash","dagger","daggerdbl","periodcentered","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","questiondown","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","ring","cedilla","hungarumlaut","ogonek","caron","emdash","AE","ordfeminine","Lslash","Oslash","OE","ordmasculine","ae","dotlessi","lslash","oslash","oe","germandbls","onesuperior","logicalnot","mu","trademark","Eth","onehalf","plusminus","Thorn","onequarter","divide","brokenbar","degree","thorn","threequarters","twosuperior","registered","minus","eth","multiply","threesuperior","copyright","Aacute","Acircumflex","Adieresis","Agrave","Aring","Atilde","Ccedilla","Eacute","Ecircumflex","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Ntilde","Oacute","Ocircumflex","Odieresis","Ograve","Otilde","Scaron","Uacute","Ucircumflex","Udieresis","Ugrave","Yacute","Ydieresis","Zcaron","aacute","acircumflex","adieresis","agrave","aring","atilde","ccedilla","eacute","ecircumflex","edieresis","egrave","iacute","icircumflex","idieresis","igrave","ntilde","oacute","ocircumflex","odieresis","ograve","otilde","scaron","uacute","ucircumflex","udieresis","ugrave","yacute","ydieresis","zcaron","exclamsmall","Hungarumlautsmall","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","266 ff","onedotenleader","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","commasuperior","threequartersemdash","periodsuperior","questionsmall","asuperior","bsuperior","centsuperior","dsuperior","esuperior","isuperior","lsuperior","msuperior","nsuperior","osuperior","rsuperior","ssuperior","tsuperior","ff","ffi","ffl","parenleftinferior","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","exclamdownsmall","centoldstyle","Lslashsmall","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","Dotaccentsmall","Macronsmall","figuredash","hypheninferior","Ogoneksmall","Ringsmall","Cedillasmall","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","zerosuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall","001.000","001.001","001.002","001.003","Black","Bold","Book","Light","Medium","Regular","Roman","Semibold"],oW=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","","endash","dagger","daggerdbl","periodcentered","","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","","questiondown","","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","","ring","cedilla","","hungarumlaut","ogonek","caron","emdash","","","","","","","","","","","","","","","","","AE","","ordfeminine","","","","","Lslash","Oslash","OE","ordmasculine","","","","","","ae","","","","dotlessi","","","lslash","oslash","oe","germandbls"],lW=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclamsmall","Hungarumlautsmall","","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","twodotenleader","onedotenleader","comma","hyphen","period","fraction","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","colon","semicolon","commasuperior","threequartersemdash","periodsuperior","questionsmall","","asuperior","bsuperior","centsuperior","dsuperior","esuperior","","","isuperior","","","lsuperior","msuperior","nsuperior","osuperior","","","rsuperior","ssuperior","tsuperior","","ff","fi","fl","ffi","ffl","parenleftinferior","","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdownsmall","centoldstyle","Lslashsmall","","","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","","Dotaccentsmall","","","Macronsmall","","","figuredash","hypheninferior","","","Ogoneksmall","Ringsmall","Cedillasmall","","","","onequarter","onehalf","threequarters","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","","","zerosuperior","onesuperior","twosuperior","threesuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall"],A4=[".notdef",".null","nonmarkingreturn","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quotesingle","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","grave","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","Adieresis","Aring","Ccedilla","Eacute","Ntilde","Odieresis","Udieresis","aacute","agrave","acircumflex","adieresis","atilde","aring","ccedilla","eacute","egrave","ecircumflex","edieresis","iacute","igrave","icircumflex","idieresis","ntilde","oacute","ograve","ocircumflex","odieresis","otilde","uacute","ugrave","ucircumflex","udieresis","dagger","degree","cent","sterling","section","bullet","paragraph","germandbls","registered","copyright","trademark","acute","dieresis","notequal","AE","Oslash","infinity","plusminus","lessequal","greaterequal","yen","mu","partialdiff","summation","product","pi","integral","ordfeminine","ordmasculine","Omega","ae","oslash","questiondown","exclamdown","logicalnot","radical","florin","approxequal","Delta","guillemotleft","guillemotright","ellipsis","nonbreakingspace","Agrave","Atilde","Otilde","OE","oe","endash","emdash","quotedblleft","quotedblright","quoteleft","quoteright","divide","lozenge","ydieresis","Ydieresis","fraction","currency","guilsinglleft","guilsinglright","fi","fl","daggerdbl","periodcentered","quotesinglbase","quotedblbase","perthousand","Acircumflex","Ecircumflex","Aacute","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Oacute","Ocircumflex","apple","Ograve","Uacute","Ucircumflex","Ugrave","dotlessi","circumflex","tilde","macron","breve","dotaccent","ring","cedilla","hungarumlaut","ogonek","caron","Lslash","lslash","Scaron","scaron","Zcaron","zcaron","brokenbar","Eth","eth","Yacute","yacute","Thorn","thorn","minus","multiply","onesuperior","twosuperior","threesuperior","onehalf","onequarter","threequarters","franc","Gbreve","gbreve","Idotaccent","Scedilla","scedilla","Cacute","cacute","Ccaron","ccaron","dcroat"];function XR(t){this.font=t}XR.prototype.charToGlyphIndex=function(t){var e=t.codePointAt(0),r=this.font.glyphs;if(r){for(var n=0;n<r.length;n+=1)for(var i=r.get(n),a=0;a<i.unicodes.length;a+=1)if(i.unicodes[a]===e)return n}return null};function _x(t,e){this.encoding=t,this.charset=e}_x.prototype.charToGlyphIndex=function(t){var e=t.codePointAt(0),r=this.encoding[e];return this.charset.indexOf(r)};function uW(t,e,r,n,i){t.beginPath(),t.moveTo(e,r),t.lineTo(n,i),t.stroke()}var Wh={line:uW};function cW(t,e){var r=e||new Xi;return{configurable:!0,get:function(){return typeof r=="function"&&(r=r()),r},set:function(n){r=n}}}function Qo(t){this.bindConstructorValues(t)}Qo.prototype.bindConstructorValues=function(t){this.index=t.index||0,this.name=t.name||null,this.unicode=t.unicode||void 0,this.unicodes=t.unicodes||t.unicode!==void 0?[t.unicode]:[],"xMin"in t&&(this.xMin=t.xMin),"yMin"in t&&(this.yMin=t.yMin),"xMax"in t&&(this.xMax=t.xMax),"yMax"in t&&(this.yMax=t.yMax),"advanceWidth"in t&&(this.advanceWidth=t.advanceWidth),Object.defineProperty(this,"path",cW(this,t.path))};Qo.prototype.addUnicode=function(t){this.unicodes.length===0&&(this.unicode=t),this.unicodes.push(t)};Qo.prototype.getBoundingBox=function(){return this.path.getBoundingBox()};Qo.prototype.getPath=function(t,e,r,n,i){t=t!==void 0?t:0,e=e!==void 0?e:0,r=r!==void 0?r:72;var a,s;n||(n={});var o=n.xScale,l=n.yScale;if(n.hinting&&i&&i.hinting&&(s=this.path&&i.hinting.exec(this,r)),s)a=i.hinting.getCommands(s),t=Math.round(t),e=Math.round(e),o=l=1;else{a=this.path.commands;var u=1/(this.path.unitsPerEm||1e3)*r;o===void 0&&(o=u),l===void 0&&(l=u)}for(var c=new Xi,h=0;h<a.length;h+=1){var p=a[h];p.type==="M"?c.moveTo(t+p.x*o,e+-p.y*l):p.type==="L"?c.lineTo(t+p.x*o,e+-p.y*l):p.type==="Q"?c.quadraticCurveTo(t+p.x1*o,e+-p.y1*l,t+p.x*o,e+-p.y*l):p.type==="C"?c.curveTo(t+p.x1*o,e+-p.y1*l,t+p.x2*o,e+-p.y2*l,t+p.x*o,e+-p.y*l):p.type==="Z"&&c.closePath()}return c};Qo.prototype.getContours=function(){if(this.points===void 0)return[];for(var t=[],e=[],r=0;r<this.points.length;r+=1){var n=this.points[r];e.push(n),n.lastPointOfContour&&(t.push(e),e=[])}return pr.argument(e.length===0,"There are still points left in the current contour."),t};Qo.prototype.getMetrics=function(){for(var t=this.path.commands,e=[],r=[],n=0;n<t.length;n+=1){var i=t[n];i.type!=="Z"&&(e.push(i.x),r.push(i.y)),(i.type==="Q"||i.type==="C")&&(e.push(i.x1),r.push(i.y1)),i.type==="C"&&(e.push(i.x2),r.push(i.y2))}var a={xMin:Math.min.apply(null,e),yMin:Math.min.apply(null,r),xMax:Math.max.apply(null,e),yMax:Math.max.apply(null,r),leftSideBearing:this.leftSideBearing};return isFinite(a.xMin)||(a.xMin=0),isFinite(a.xMax)||(a.xMax=this.advanceWidth),isFinite(a.yMin)||(a.yMin=0),isFinite(a.yMax)||(a.yMax=0),a.rightSideBearing=this.advanceWidth-a.leftSideBearing-(a.xMax-a.xMin),a};Qo.prototype.draw=function(t,e,r,n,i){this.getPath(e,r,n,i).draw(t)};Qo.prototype.drawPoints=function(t,e,r,n){function i(h,p,v,y){t.beginPath();for(var S=0;S<h.length;S+=1)t.moveTo(p+h[S].x*y,v+h[S].y*y),t.arc(p+h[S].x*y,v+h[S].y*y,2,0,Math.PI*2,!1);t.closePath(),t.fill()}e=e!==void 0?e:0,r=r!==void 0?r:0,n=n!==void 0?n:24;for(var a=1/this.path.unitsPerEm*n,s=[],o=[],l=this.path,u=0;u<l.commands.length;u+=1){var c=l.commands[u];c.x!==void 0&&s.push({x:c.x,y:-c.y}),c.x1!==void 0&&o.push({x:c.x1,y:-c.y1}),c.x2!==void 0&&o.push({x:c.x2,y:-c.y2})}t.fillStyle="blue",i(s,e,r,a),t.fillStyle="red",i(o,e,r,a)};Qo.prototype.drawMetrics=function(t,e,r,n){var i;e=e!==void 0?e:0,r=r!==void 0?r:0,n=n!==void 0?n:24,i=1/this.path.unitsPerEm*n,t.lineWidth=1,t.strokeStyle="black",Wh.line(t,e,-1e4,e,1e4),Wh.line(t,-1e4,r,1e4,r);var a=this.xMin||0,s=this.yMin||0,o=this.xMax||0,l=this.yMax||0,u=this.advanceWidth||0;t.strokeStyle="blue",Wh.line(t,e+a*i,-1e4,e+a*i,1e4),Wh.line(t,e+o*i,-1e4,e+o*i,1e4),Wh.line(t,-1e4,r+-s*i,1e4,r+-s*i),Wh.line(t,-1e4,r+-l*i,1e4,r+-l*i),t.strokeStyle="green",Wh.line(t,e+u*i,-1e4,e+u*i,1e4)};function vy(t,e,r){Object.defineProperty(t,e,{get:function(){return t.path,t[r]},set:function(n){t[r]=n},enumerable:!0,configurable:!0})}function M_(t,e){if(this.font=t,this.glyphs={},Array.isArray(e))for(var r=0;r<e.length;r++){var n=e[r];n.path.unitsPerEm=t.unitsPerEm,this.glyphs[r]=n}this.length=e&&e.length||0}M_.prototype.get=function(t){if(this.glyphs[t]===void 0){this.font._push(t),typeof this.glyphs[t]=="function"&&(this.glyphs[t]=this.glyphs[t]());var e=this.glyphs[t],r=this.font._IndexToUnicodeMap[t];if(r)for(var n=0;n<r.unicodes.length;n++)e.addUnicode(r.unicodes[n]);this.font.cffEncoding?this.font.isCIDFont?e.name="gid"+t:e.name=this.font.cffEncoding.charset[t]:this.font.glyphNames.names&&(e.name=this.font.glyphNames.glyphIndexToName(t)),this.glyphs[t].advanceWidth=this.font._hmtxTableData[t].advanceWidth,this.glyphs[t].leftSideBearing=this.font._hmtxTableData[t].leftSideBearing}else typeof this.glyphs[t]=="function"&&(this.glyphs[t]=this.glyphs[t]());return this.glyphs[t]};M_.prototype.push=function(t,e){this.glyphs[t]=e,this.length++};function dW(t,e){return new Qo({index:e,font:t})}function hW(t,e,r,n,i,a){return function(){var s=new Qo({index:e,font:t});return s.path=function(){r(s,n,i);var o=a(t.glyphs,s);return o.unitsPerEm=t.unitsPerEm,o},vy(s,"xMin","_xMin"),vy(s,"xMax","_xMax"),vy(s,"yMin","_yMin"),vy(s,"yMax","_yMax"),s}}function fW(t,e,r,n){return function(){var i=new Qo({index:e,font:t});return i.path=function(){var a=r(t,i,n);return a.unitsPerEm=t.unitsPerEm,a},i}}var Cu={GlyphSet:M_,glyphLoader:dW,ttfGlyphLoader:hW,cffGlyphLoader:fW};function QR(t,e){if(t===e)return!0;if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return!1;for(var r=0;r<t.length;r+=1)if(!QR(t[r],e[r]))return!1;return!0}else return!1}function ak(t){var e;return t.length<1240?e=107:t.length<33900?e=1131:e=32768,e}function _d(t,e,r){var n=[],i=[],a=yr.getCard16(t,e),s,o;if(a!==0){var l=yr.getByte(t,e+2);s=e+(a+1)*l+2;for(var u=e+3,c=0;c<a+1;c+=1)n.push(yr.getOffset(t,u,l)),u+=l;o=s+n[a]}else o=e+2;for(var h=0;h<n.length-1;h+=1){var p=yr.getBytes(t,s+n[h],s+n[h+1]);r&&(p=r(p)),i.push(p)}return{objects:i,startOffset:e,endOffset:o}}function pW(t,e){var r=[],n=yr.getCard16(t,e),i,a;if(n!==0){var s=yr.getByte(t,e+2);i=e+(n+1)*s+2;for(var o=e+3,l=0;l<n+1;l+=1)r.push(yr.getOffset(t,o,s)),o+=s;a=i+r[n]}else a=e+2;return{offsets:r,startOffset:e,endOffset:a}}function mW(t,e,r,n,i){var a=yr.getCard16(r,n),s=0;if(a!==0){var o=yr.getByte(r,n+2);s=n+(a+1)*o+2}var l=yr.getBytes(r,s+e[t],s+e[t+1]);return l}function gW(t){for(var e="",r=15,n=["0","1","2","3","4","5","6","7","8","9",".","E","E-",null,"-"];;){var i=t.parseByte(),a=i>>4,s=i&15;if(a===r||(e+=n[a],s===r))break;e+=n[s]}return parseFloat(e)}function vW(t,e){var r,n,i,a;if(e===28)return r=t.parseByte(),n=t.parseByte(),r<<8|n;if(e===29)return r=t.parseByte(),n=t.parseByte(),i=t.parseByte(),a=t.parseByte(),r<<24|n<<16|i<<8|a;if(e===30)return gW(t);if(e>=32&&e<=246)return e-139;if(e>=247&&e<=250)return r=t.parseByte(),(e-247)*256+r+108;if(e>=251&&e<=254)return r=t.parseByte(),-(e-251)*256-r-108;throw new Error("Invalid b0 "+e)}function yW(t){for(var e={},r=0;r<t.length;r+=1){var n=t[r][0],i=t[r][1],a=void 0;if(i.length===1?a=i[0]:a=i,e.hasOwnProperty(n)&&!isNaN(e[n]))throw new Error("Object "+e+" already has key "+n);e[n]=a}return e}function JR(t,e,r){e=e!==void 0?e:0;var n=new yr.Parser(t,e),i=[],a=[];for(r=r!==void 0?r:t.length;n.relativeOffset<r;){var s=n.parseByte();s<=21?(s===12&&(s=1200+n.parseByte()),i.push([s,a]),a=[]):a.push(vW(n,s))}return yW(i)}function rv(t,e){return e<=390?e=qy[e]:e=t[e-391],e}function eL(t,e,r){for(var n={},i,a=0;a<e.length;a+=1){var s=e[a];if(Array.isArray(s.type)){var o=[];o.length=s.type.length;for(var l=0;l<s.type.length;l++)i=t[s.op]!==void 0?t[s.op][l]:void 0,i===void 0&&(i=s.value!==void 0&&s.value[l]!==void 0?s.value[l]:null),s.type[l]==="SID"&&(i=rv(r,i)),o[l]=i;n[s.name]=o}else i=t[s.op],i===void 0&&(i=s.value!==void 0?s.value:null),s.type==="SID"&&(i=rv(r,i)),n[s.name]=i}return n}function xW(t,e){var r={};return r.formatMajor=yr.getCard8(t,e),r.formatMinor=yr.getCard8(t,e+1),r.size=yr.getCard8(t,e+2),r.offsetSize=yr.getCard8(t,e+3),r.startOffset=e,r.endOffset=e+4,r}var tL=[{name:"version",op:0,type:"SID"},{name:"notice",op:1,type:"SID"},{name:"copyright",op:1200,type:"SID"},{name:"fullName",op:2,type:"SID"},{name:"familyName",op:3,type:"SID"},{name:"weight",op:4,type:"SID"},{name:"isFixedPitch",op:1201,type:"number",value:0},{name:"italicAngle",op:1202,type:"number",value:0},{name:"underlinePosition",op:1203,type:"number",value:-100},{name:"underlineThickness",op:1204,type:"number",value:50},{name:"paintType",op:1205,type:"number",value:0},{name:"charstringType",op:1206,type:"number",value:2},{name:"fontMatrix",op:1207,type:["real","real","real","real","real","real"],value:[.001,0,0,.001,0,0]},{name:"uniqueId",op:13,type:"number"},{name:"fontBBox",op:5,type:["number","number","number","number"],value:[0,0,0,0]},{name:"strokeWidth",op:1208,type:"number",value:0},{name:"xuid",op:14,type:[],value:null},{name:"charset",op:15,type:"offset",value:0},{name:"encoding",op:16,type:"offset",value:0},{name:"charStrings",op:17,type:"offset",value:0},{name:"private",op:18,type:["number","offset"],value:[0,0]},{name:"ros",op:1230,type:["SID","SID","number"]},{name:"cidFontVersion",op:1231,type:"number",value:0},{name:"cidFontRevision",op:1232,type:"number",value:0},{name:"cidFontType",op:1233,type:"number",value:0},{name:"cidCount",op:1234,type:"number",value:8720},{name:"uidBase",op:1235,type:"number"},{name:"fdArray",op:1236,type:"offset"},{name:"fdSelect",op:1237,type:"offset"},{name:"fontName",op:1238,type:"SID"}],rL=[{name:"subrs",op:19,type:"offset",value:0},{name:"defaultWidthX",op:20,type:"number",value:0},{name:"nominalWidthX",op:21,type:"number",value:0}];function bW(t,e){var r=JR(t,0,t.byteLength);return eL(r,tL,e)}function nL(t,e,r,n){var i=JR(t,e,r);return eL(i,rL,n)}function R4(t,e,r,n){for(var i=[],a=0;a<r.length;a+=1){var s=new DataView(new Uint8Array(r[a]).buffer),o=bW(s,n);o._subrs=[],o._subrsBias=0,o._defaultWidthX=0,o._nominalWidthX=0;var l=o.private[0],u=o.private[1];if(l!==0&&u!==0){var c=nL(t,u+e,l,n);if(o._defaultWidthX=c.defaultWidthX,o._nominalWidthX=c.nominalWidthX,c.subrs!==0){var h=u+c.subrs,p=_d(t,h+e);o._subrs=p.objects,o._subrsBias=ak(o._subrs)}o._privateDict=c}i.push(o)}return i}function wW(t,e,r,n){var i,a,s=new yr.Parser(t,e);r-=1;var o=[".notdef"],l=s.parseCard8();if(l===0)for(var u=0;u<r;u+=1)i=s.parseSID(),o.push(rv(n,i));else if(l===1)for(;o.length<=r;){i=s.parseSID(),a=s.parseCard8();for(var c=0;c<=a;c+=1)o.push(rv(n,i)),i+=1}else if(l===2)for(;o.length<=r;){i=s.parseSID(),a=s.parseCard16();for(var h=0;h<=a;h+=1)o.push(rv(n,i)),i+=1}else throw new Error("Unknown charset format "+l);return o}function SW(t,e,r){var n,i={},a=new yr.Parser(t,e),s=a.parseCard8();if(s===0)for(var o=a.parseCard8(),l=0;l<o;l+=1)n=a.parseCard8(),i[n]=l;else if(s===1){var u=a.parseCard8();n=1;for(var c=0;c<u;c+=1)for(var h=a.parseCard8(),p=a.parseCard8(),v=h;v<=h+p;v+=1)i[v]=n,n+=1}else throw new Error("Unknown encoding format "+s);return new _x(i,r)}function L4(t,e,r){var n,i,a,s,o=new Xi,l=[],u=0,c=!1,h=!1,p=0,v=0,y,S,w,T;if(t.isCIDFont){var _=t.tables.cff.topDict._fdSelect[e.index],C=t.tables.cff.topDict._fdArray[_];y=C._subrs,S=C._subrsBias,w=C._defaultWidthX,T=C._nominalWidthX}else y=t.tables.cff.topDict._subrs,S=t.tables.cff.topDict._subrsBias,w=t.tables.cff.topDict._defaultWidthX,T=t.tables.cff.topDict._nominalWidthX;var N=w;function A(O,F){h&&o.closePath(),o.moveTo(O,F),h=!0}function I(){var O;O=l.length%2!==0,O&&!c&&(N=l.shift()+T),u+=l.length>>1,l.length=0,c=!0}function j(O){for(var F,B,$,Z,D,H,U,W,Y,Q,ne,re,q=0;q<O.length;){var te=O[q];switch(q+=1,te){case 1:I();break;case 3:I();break;case 4:l.length>1&&!c&&(N=l.shift()+T,c=!0),v+=l.pop(),A(p,v);break;case 5:for(;l.length>0;)p+=l.shift(),v+=l.shift(),o.lineTo(p,v);break;case 6:for(;l.length>0&&(p+=l.shift(),o.lineTo(p,v),l.length!==0);)v+=l.shift(),o.lineTo(p,v);break;case 7:for(;l.length>0&&(v+=l.shift(),o.lineTo(p,v),l.length!==0);)p+=l.shift(),o.lineTo(p,v);break;case 8:for(;l.length>0;)n=p+l.shift(),i=v+l.shift(),a=n+l.shift(),s=i+l.shift(),p=a+l.shift(),v=s+l.shift(),o.curveTo(n,i,a,s,p,v);break;case 10:D=l.pop()+S,H=y[D],H&&j(H);break;case 11:return;case 12:switch(te=O[q],q+=1,te){case 35:n=p+l.shift(),i=v+l.shift(),a=n+l.shift(),s=i+l.shift(),U=a+l.shift(),W=s+l.shift(),Y=U+l.shift(),Q=W+l.shift(),ne=Y+l.shift(),re=Q+l.shift(),p=ne+l.shift(),v=re+l.shift(),l.shift(),o.curveTo(n,i,a,s,U,W),o.curveTo(Y,Q,ne,re,p,v);break;case 34:n=p+l.shift(),i=v,a=n+l.shift(),s=i+l.shift(),U=a+l.shift(),W=s,Y=U+l.shift(),Q=s,ne=Y+l.shift(),re=v,p=ne+l.shift(),o.curveTo(n,i,a,s,U,W),o.curveTo(Y,Q,ne,re,p,v);break;case 36:n=p+l.shift(),i=v+l.shift(),a=n+l.shift(),s=i+l.shift(),U=a+l.shift(),W=s,Y=U+l.shift(),Q=s,ne=Y+l.shift(),re=Q+l.shift(),p=ne+l.shift(),o.curveTo(n,i,a,s,U,W),o.curveTo(Y,Q,ne,re,p,v);break;case 37:n=p+l.shift(),i=v+l.shift(),a=n+l.shift(),s=i+l.shift(),U=a+l.shift(),W=s+l.shift(),Y=U+l.shift(),Q=W+l.shift(),ne=Y+l.shift(),re=Q+l.shift(),Math.abs(ne-p)>Math.abs(re-v)?p=ne+l.shift():v=re+l.shift(),o.curveTo(n,i,a,s,U,W),o.curveTo(Y,Q,ne,re,p,v);break;default:console.log("Glyph "+e.index+": unknown operator 1200"+te),l.length=0}break;case 14:l.length>0&&!c&&(N=l.shift()+T,c=!0),h&&(o.closePath(),h=!1);break;case 18:I();break;case 19:case 20:I(),q+=u+7>>3;break;case 21:l.length>2&&!c&&(N=l.shift()+T,c=!0),v+=l.pop(),p+=l.pop(),A(p,v);break;case 22:l.length>1&&!c&&(N=l.shift()+T,c=!0),p+=l.pop(),A(p,v);break;case 23:I();break;case 24:for(;l.length>2;)n=p+l.shift(),i=v+l.shift(),a=n+l.shift(),s=i+l.shift(),p=a+l.shift(),v=s+l.shift(),o.curveTo(n,i,a,s,p,v);p+=l.shift(),v+=l.shift(),o.lineTo(p,v);break;case 25:for(;l.length>6;)p+=l.shift(),v+=l.shift(),o.lineTo(p,v);n=p+l.shift(),i=v+l.shift(),a=n+l.shift(),s=i+l.shift(),p=a+l.shift(),v=s+l.shift(),o.curveTo(n,i,a,s,p,v);break;case 26:for(l.length%2&&(p+=l.shift());l.length>0;)n=p,i=v+l.shift(),a=n+l.shift(),s=i+l.shift(),p=a,v=s+l.shift(),o.curveTo(n,i,a,s,p,v);break;case 27:for(l.length%2&&(v+=l.shift());l.length>0;)n=p+l.shift(),i=v,a=n+l.shift(),s=i+l.shift(),p=a+l.shift(),v=s,o.curveTo(n,i,a,s,p,v);break;case 28:F=O[q],B=O[q+1],l.push((F<<24|B<<16)>>16),q+=2;break;case 29:D=l.pop()+t.gsubrsBias,H=t.gsubrs[D],H&&j(H);break;case 30:for(;l.length>0&&(n=p,i=v+l.shift(),a=n+l.shift(),s=i+l.shift(),p=a+l.shift(),v=s+(l.length===1?l.shift():0),o.curveTo(n,i,a,s,p,v),l.length!==0);)n=p+l.shift(),i=v,a=n+l.shift(),s=i+l.shift(),v=s+l.shift(),p=a+(l.length===1?l.shift():0),o.curveTo(n,i,a,s,p,v);break;case 31:for(;l.length>0&&(n=p+l.shift(),i=v,a=n+l.shift(),s=i+l.shift(),v=s+l.shift(),p=a+(l.length===1?l.shift():0),o.curveTo(n,i,a,s,p,v),l.length!==0);)n=p,i=v+l.shift(),a=n+l.shift(),s=i+l.shift(),p=a+l.shift(),v=s+(l.length===1?l.shift():0),o.curveTo(n,i,a,s,p,v);break;default:te<32?console.log("Glyph "+e.index+": unknown operator "+te):te<247?l.push(te-139):te<251?(F=O[q],q+=1,l.push((te-247)*256+F+108)):te<255?(F=O[q],q+=1,l.push(-(te-251)*256-F-108)):(F=O[q],B=O[q+1],$=O[q+2],Z=O[q+3],q+=4,l.push((F<<24|B<<16|$<<8|Z)/65536))}}}return j(r),e.advanceWidth=N,o}function kW(t,e,r,n){var i=[],a,s=new yr.Parser(t,e),o=s.parseCard8();if(o===0)for(var l=0;l<r;l++){if(a=s.parseCard8(),a>=n)throw new Error("CFF table CID Font FDSelect has bad FD index value "+a+" (FD count "+n+")");i.push(a)}else if(o===3){var u=s.parseCard16(),c=s.parseCard16();if(c!==0)throw new Error("CFF Table CID Font FDSelect format 3 range has bad initial GID "+c);for(var h,p=0;p<u;p++){if(a=s.parseCard8(),h=s.parseCard16(),a>=n)throw new Error("CFF table CID Font FDSelect has bad FD index value "+a+" (FD count "+n+")");if(h>r)throw new Error("CFF Table CID Font FDSelect format 3 range has bad GID "+h);for(;c<h;c++)i.push(a);c=h}if(h!==r)throw new Error("CFF Table CID Font FDSelect format 3 range has bad final GID "+h)}else throw new Error("CFF Table CID Font FDSelect table has unsupported format "+o);return i}function _W(t,e,r,n){r.tables.cff={};var i=xW(t,e),a=_d(t,i.endOffset,yr.bytesToString),s=_d(t,a.endOffset),o=_d(t,s.endOffset,yr.bytesToString),l=_d(t,o.endOffset);r.gsubrs=l.objects,r.gsubrsBias=ak(r.gsubrs);var u=R4(t,e,s.objects,o.objects);if(u.length!==1)throw new Error("CFF table has too many fonts in 'FontSet' - count of fonts NameIndex.length = "+u.length);var c=u[0];if(r.tables.cff.topDict=c,c._privateDict&&(r.defaultWidthX=c._privateDict.defaultWidthX,r.nominalWidthX=c._privateDict.nominalWidthX),c.ros[0]!==void 0&&c.ros[1]!==void 0&&(r.isCIDFont=!0),r.isCIDFont){var h=c.fdArray,p=c.fdSelect;if(h===0||p===0)throw new Error("Font is marked as a CID font, but FDArray and/or FDSelect information is missing");h+=e;var v=_d(t,h),y=R4(t,e,v.objects,o.objects);c._fdArray=y,p+=e,c._fdSelect=kW(t,p,r.numGlyphs,y.length)}var S=e+c.private[1],w=nL(t,S,c.private[0],o.objects);if(r.defaultWidthX=w.defaultWidthX,r.nominalWidthX=w.nominalWidthX,w.subrs!==0){var T=S+w.subrs,_=_d(t,T);r.subrs=_.objects,r.subrsBias=ak(r.subrs)}else r.subrs=[],r.subrsBias=0;var C;n.lowMemory?(C=pW(t,e+c.charStrings),r.nGlyphs=C.offsets.length):(C=_d(t,e+c.charStrings),r.nGlyphs=C.objects.length);var N=wW(t,e+c.charset,r.nGlyphs,o.objects);if(c.encoding===0?r.cffEncoding=new _x(oW,N):c.encoding===1?r.cffEncoding=new _x(lW,N):r.cffEncoding=SW(t,e+c.encoding,N),r.encoding=r.encoding||r.cffEncoding,r.glyphs=new Cu.GlyphSet(r),n.lowMemory)r._push=function(j){var O=mW(j,C.offsets,t,e+c.charStrings);r.glyphs.push(j,Cu.cffGlyphLoader(r,j,L4,O))};else for(var A=0;A<r.nGlyphs;A+=1){var I=C.objects[A];r.glyphs.push(A,Cu.cffGlyphLoader(r,A,L4,I))}}function iL(t,e){var r,n=qy.indexOf(t);return n>=0&&(r=n),n=e.indexOf(t),n>=0?r=n+qy.length:(r=qy.length+e.length,e.push(t)),r}function CW(){return new Ft.Record("Header",[{name:"major",type:"Card8",value:1},{name:"minor",type:"Card8",value:0},{name:"hdrSize",type:"Card8",value:4},{name:"major",type:"Card8",value:1}])}function EW(t){var e=new Ft.Record("Name INDEX",[{name:"names",type:"INDEX",value:[]}]);e.names=[];for(var r=0;r<t.length;r+=1)e.names.push({name:"name_"+r,type:"NAME",value:t[r]});return e}function aL(t,e,r){for(var n={},i=0;i<t.length;i+=1){var a=t[i],s=e[a.name];s!==void 0&&!QR(s,a.value)&&(a.type==="SID"&&(s=iL(s,r)),n[a.op]={name:a.name,type:a.type,value:s})}return n}function O4(t,e){var r=new Ft.Record("Top DICT",[{name:"dict",type:"DICT",value:{}}]);return r.dict=aL(tL,t,e),r}function D4(t){var e=new Ft.Record("Top DICT INDEX",[{name:"topDicts",type:"INDEX",value:[]}]);return e.topDicts=[{name:"topDict_0",type:"TABLE",value:t}],e}function TW(t){var e=new Ft.Record("String INDEX",[{name:"strings",type:"INDEX",value:[]}]);e.strings=[];for(var r=0;r<t.length;r+=1)e.strings.push({name:"string_"+r,type:"STRING",value:t[r]});return e}function NW(){return new Ft.Record("Global Subr INDEX",[{name:"subrs",type:"INDEX",value:[]}])}function PW(t,e){for(var r=new Ft.Record("Charsets",[{name:"format",type:"Card8",value:0}]),n=0;n<t.length;n+=1){var i=t[n],a=iL(i,e);r.fields.push({name:"glyph_"+n,type:"SID",value:a})}return r}function MW(t){var e=[],r=t.path;e.push({name:"width",type:"NUMBER",value:t.advanceWidth});for(var n=0,i=0,a=0;a<r.commands.length;a+=1){var s=void 0,o=void 0,l=r.commands[a];if(l.type==="Q"){var u=.3333333333333333,c=2/3;l={type:"C",x:l.x,y:l.y,x1:Math.round(u*n+c*l.x1),y1:Math.round(u*i+c*l.y1),x2:Math.round(u*l.x+c*l.x1),y2:Math.round(u*l.y+c*l.y1)}}if(l.type==="M")s=Math.round(l.x-n),o=Math.round(l.y-i),e.push({name:"dx",type:"NUMBER",value:s}),e.push({name:"dy",type:"NUMBER",value:o}),e.push({name:"rmoveto",type:"OP",value:21}),n=Math.round(l.x),i=Math.round(l.y);else if(l.type==="L")s=Math.round(l.x-n),o=Math.round(l.y-i),e.push({name:"dx",type:"NUMBER",value:s}),e.push({name:"dy",type:"NUMBER",value:o}),e.push({name:"rlineto",type:"OP",value:5}),n=Math.round(l.x),i=Math.round(l.y);else if(l.type==="C"){var h=Math.round(l.x1-n),p=Math.round(l.y1-i),v=Math.round(l.x2-l.x1),y=Math.round(l.y2-l.y1);s=Math.round(l.x-l.x2),o=Math.round(l.y-l.y2),e.push({name:"dx1",type:"NUMBER",value:h}),e.push({name:"dy1",type:"NUMBER",value:p}),e.push({name:"dx2",type:"NUMBER",value:v}),e.push({name:"dy2",type:"NUMBER",value:y}),e.push({name:"dx",type:"NUMBER",value:s}),e.push({name:"dy",type:"NUMBER",value:o}),e.push({name:"rrcurveto",type:"OP",value:8}),n=Math.round(l.x),i=Math.round(l.y)}}return e.push({name:"endchar",type:"OP",value:14}),e}function AW(t){for(var e=new Ft.Record("CharStrings INDEX",[{name:"charStrings",type:"INDEX",value:[]}]),r=0;r<t.length;r+=1){var n=t.get(r),i=MW(n);e.charStrings.push({name:n.name,type:"CHARSTRING",value:i})}return e}function RW(t,e){var r=new Ft.Record("Private DICT",[{name:"dict",type:"DICT",value:{}}]);return r.dict=aL(rL,t,e),r}function LW(t,e){for(var r=new Ft.Table("CFF ",[{name:"header",type:"RECORD"},{name:"nameIndex",type:"RECORD"},{name:"topDictIndex",type:"RECORD"},{name:"stringIndex",type:"RECORD"},{name:"globalSubrIndex",type:"RECORD"},{name:"charsets",type:"RECORD"},{name:"charStringsIndex",type:"RECORD"},{name:"privateDict",type:"RECORD"}]),n=1/e.unitsPerEm,i={version:e.version,fullName:e.fullName,familyName:e.familyName,weight:e.weightName,fontBBox:e.fontBBox||[0,0,0,0],fontMatrix:[n,0,0,n,0,0],charset:999,encoding:0,charStrings:999,private:[0,999]},a={},s=[],o,l=1;l<t.length;l+=1)o=t.get(l),s.push(o.name);var u=[];r.header=CW(),r.nameIndex=EW([e.postScriptName]);var c=O4(i,u);r.topDictIndex=D4(c),r.globalSubrIndex=NW(),r.charsets=PW(s,u),r.charStringsIndex=AW(t),r.privateDict=RW(a,u),r.stringIndex=TW(u);var h=r.header.sizeOf()+r.nameIndex.sizeOf()+r.topDictIndex.sizeOf()+r.stringIndex.sizeOf()+r.globalSubrIndex.sizeOf();return i.charset=h,i.encoding=0,i.charStrings=i.charset+r.charsets.sizeOf(),i.private[1]=i.charStrings+r.charStringsIndex.sizeOf(),c=O4(i,u),r.topDictIndex=D4(c),r}var OW={parse:_W,make:LW};function DW(t,e){var r={},n=new yr.Parser(t,e);return r.version=n.parseVersion(),r.fontRevision=Math.round(n.parseFixed()*1e3)/1e3,r.checkSumAdjustment=n.parseULong(),r.magicNumber=n.parseULong(),pr.argument(r.magicNumber===1594834165,"Font header has wrong magic number."),r.flags=n.parseUShort(),r.unitsPerEm=n.parseUShort(),r.created=n.parseLongDateTime(),r.modified=n.parseLongDateTime(),r.xMin=n.parseShort(),r.yMin=n.parseShort(),r.xMax=n.parseShort(),r.yMax=n.parseShort(),r.macStyle=n.parseUShort(),r.lowestRecPPEM=n.parseUShort(),r.fontDirectionHint=n.parseShort(),r.indexToLocFormat=n.parseShort(),r.glyphDataFormat=n.parseShort(),r}function IW(t){var e=Math.round(new Date().getTime()/1e3)+2082844800,r=e;return t.createdTimestamp&&(r=t.createdTimestamp+2082844800),new Ft.Table("head",[{name:"version",type:"FIXED",value:65536},{name:"fontRevision",type:"FIXED",value:65536},{name:"checkSumAdjustment",type:"ULONG",value:0},{name:"magicNumber",type:"ULONG",value:1594834165},{name:"flags",type:"USHORT",value:0},{name:"unitsPerEm",type:"USHORT",value:1e3},{name:"created",type:"LONGDATETIME",value:r},{name:"modified",type:"LONGDATETIME",value:e},{name:"xMin",type:"SHORT",value:0},{name:"yMin",type:"SHORT",value:0},{name:"xMax",type:"SHORT",value:0},{name:"yMax",type:"SHORT",value:0},{name:"macStyle",type:"USHORT",value:0},{name:"lowestRecPPEM",type:"USHORT",value:0},{name:"fontDirectionHint",type:"SHORT",value:2},{name:"indexToLocFormat",type:"SHORT",value:0},{name:"glyphDataFormat",type:"SHORT",value:0}],t)}var jW={parse:DW,make:IW};function FW(t,e){var r={},n=new yr.Parser(t,e);return r.version=n.parseVersion(),r.ascender=n.parseShort(),r.descender=n.parseShort(),r.lineGap=n.parseShort(),r.advanceWidthMax=n.parseUShort(),r.minLeftSideBearing=n.parseShort(),r.minRightSideBearing=n.parseShort(),r.xMaxExtent=n.parseShort(),r.caretSlopeRise=n.parseShort(),r.caretSlopeRun=n.parseShort(),r.caretOffset=n.parseShort(),n.relativeOffset+=8,r.metricDataFormat=n.parseShort(),r.numberOfHMetrics=n.parseUShort(),r}function BW(t){return new Ft.Table("hhea",[{name:"version",type:"FIXED",value:65536},{name:"ascender",type:"FWORD",value:0},{name:"descender",type:"FWORD",value:0},{name:"lineGap",type:"FWORD",value:0},{name:"advanceWidthMax",type:"UFWORD",value:0},{name:"minLeftSideBearing",type:"FWORD",value:0},{name:"minRightSideBearing",type:"FWORD",value:0},{name:"xMaxExtent",type:"FWORD",value:0},{name:"caretSlopeRise",type:"SHORT",value:1},{name:"caretSlopeRun",type:"SHORT",value:0},{name:"caretOffset",type:"SHORT",value:0},{name:"reserved1",type:"SHORT",value:0},{name:"reserved2",type:"SHORT",value:0},{name:"reserved3",type:"SHORT",value:0},{name:"reserved4",type:"SHORT",value:0},{name:"metricDataFormat",type:"SHORT",value:0},{name:"numberOfHMetrics",type:"USHORT",value:0}],t)}var zW={parse:FW,make:BW};function UW(t,e,r,n,i){for(var a,s,o=new yr.Parser(t,e),l=0;l<n;l+=1){l<r&&(a=o.parseUShort(),s=o.parseShort());var u=i.get(l);u.advanceWidth=a,u.leftSideBearing=s}}function GW(t,e,r,n,i){t._hmtxTableData={};for(var a,s,o=new yr.Parser(e,r),l=0;l<i;l+=1)l<n&&(a=o.parseUShort(),s=o.parseShort()),t._hmtxTableData[l]={advanceWidth:a,leftSideBearing:s}}function VW(t,e,r,n,i,a,s){s.lowMemory?GW(t,e,r,n,i):UW(e,r,n,i,a)}function HW(t){for(var e=new Ft.Table("hmtx",[]),r=0;r<t.length;r+=1){var n=t.get(r),i=n.advanceWidth||0,a=n.leftSideBearing||0;e.fields.push({name:"advanceWidth_"+r,type:"USHORT",value:i}),e.fields.push({name:"leftSideBearing_"+r,type:"SHORT",value:a})}return e}var WW={parse:VW,make:HW};function qW(t){for(var e=new Ft.Table("ltag",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"numTags",type:"ULONG",value:t.length}]),r="",n=12+t.length*4,i=0;i<t.length;++i){var a=r.indexOf(t[i]);a<0&&(a=r.length,r+=t[i]),e.fields.push({name:"offset "+i,type:"USHORT",value:n+a}),e.fields.push({name:"length "+i,type:"USHORT",value:t[i].length})}return e.fields.push({name:"stringPool",type:"CHARARRAY",value:r}),e}function $W(t,e){var r=new yr.Parser(t,e),n=r.parseULong();pr.argument(n===1,"Unsupported ltag table version."),r.skip("uLong",1);for(var i=r.parseULong(),a=[],s=0;s<i;s++){for(var o="",l=e+r.parseUShort(),u=r.parseUShort(),c=l;c<l+u;++c)o+=String.fromCharCode(t.getInt8(c));a.push(o)}return a}var KW={make:qW,parse:$W};function ZW(t,e){var r={},n=new yr.Parser(t,e);return r.version=n.parseVersion(),r.numGlyphs=n.parseUShort(),r.version===1&&(r.maxPoints=n.parseUShort(),r.maxContours=n.parseUShort(),r.maxCompositePoints=n.parseUShort(),r.maxCompositeContours=n.parseUShort(),r.maxZones=n.parseUShort(),r.maxTwilightPoints=n.parseUShort(),r.maxStorage=n.parseUShort(),r.maxFunctionDefs=n.parseUShort(),r.maxInstructionDefs=n.parseUShort(),r.maxStackElements=n.parseUShort(),r.maxSizeOfInstructions=n.parseUShort(),r.maxComponentElements=n.parseUShort(),r.maxComponentDepth=n.parseUShort()),r}function YW(t){return new Ft.Table("maxp",[{name:"version",type:"FIXED",value:20480},{name:"numGlyphs",type:"USHORT",value:t}])}var XW={parse:ZW,make:YW},sL=["copyright","fontFamily","fontSubfamily","uniqueID","fullName","version","postScriptName","trademark","manufacturer","designer","description","manufacturerURL","designerURL","license","licenseURL","reserved","preferredFamily","preferredSubfamily","compatibleFullName","sampleText","postScriptFindFontName","wwsFamily","wwsSubfamily"],oL={0:"en",1:"fr",2:"de",3:"it",4:"nl",5:"sv",6:"es",7:"da",8:"pt",9:"no",10:"he",11:"ja",12:"ar",13:"fi",14:"el",15:"is",16:"mt",17:"tr",18:"hr",19:"zh-Hant",20:"ur",21:"hi",22:"th",23:"ko",24:"lt",25:"pl",26:"hu",27:"es",28:"lv",29:"se",30:"fo",31:"fa",32:"ru",33:"zh",34:"nl-BE",35:"ga",36:"sq",37:"ro",38:"cz",39:"sk",40:"si",41:"yi",42:"sr",43:"mk",44:"bg",45:"uk",46:"be",47:"uz",48:"kk",49:"az-Cyrl",50:"az-Arab",51:"hy",52:"ka",53:"mo",54:"ky",55:"tg",56:"tk",57:"mn-CN",58:"mn",59:"ps",60:"ks",61:"ku",62:"sd",63:"bo",64:"ne",65:"sa",66:"mr",67:"bn",68:"as",69:"gu",70:"pa",71:"or",72:"ml",73:"kn",74:"ta",75:"te",76:"si",77:"my",78:"km",79:"lo",80:"vi",81:"id",82:"tl",83:"ms",84:"ms-Arab",85:"am",86:"ti",87:"om",88:"so",89:"sw",90:"rw",91:"rn",92:"ny",93:"mg",94:"eo",128:"cy",129:"eu",130:"ca",131:"la",132:"qu",133:"gn",134:"ay",135:"tt",136:"ug",137:"dz",138:"jv",139:"su",140:"gl",141:"af",142:"br",143:"iu",144:"gd",145:"gv",146:"ga",147:"to",148:"el-polyton",149:"kl",150:"az",151:"nn"},QW={0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:5,11:1,12:4,13:0,14:6,15:0,16:0,17:0,18:0,19:2,20:4,21:9,22:21,23:3,24:29,25:29,26:29,27:29,28:29,29:0,30:0,31:4,32:7,33:25,34:0,35:0,36:0,37:0,38:29,39:29,40:0,41:5,42:7,43:7,44:7,45:7,46:7,47:7,48:7,49:7,50:4,51:24,52:23,53:7,54:7,55:7,56:7,57:27,58:7,59:4,60:4,61:4,62:4,63:26,64:9,65:9,66:9,67:13,68:13,69:11,70:10,71:12,72:17,73:16,74:14,75:15,76:18,77:19,78:20,79:22,80:30,81:0,82:0,83:0,84:4,85:28,86:28,87:28,88:0,89:0,90:0,91:0,92:0,93:0,94:0,128:0,129:0,130:0,131:0,132:0,133:0,134:0,135:7,136:4,137:26,138:0,139:0,140:0,141:0,142:0,143:28,144:0,145:0,146:0,147:0,148:6,149:0,150:0,151:0},lL={1078:"af",1052:"sq",1156:"gsw",1118:"am",5121:"ar-DZ",15361:"ar-BH",3073:"ar",2049:"ar-IQ",11265:"ar-JO",13313:"ar-KW",12289:"ar-LB",4097:"ar-LY",6145:"ary",8193:"ar-OM",16385:"ar-QA",1025:"ar-SA",10241:"ar-SY",7169:"aeb",14337:"ar-AE",9217:"ar-YE",1067:"hy",1101:"as",2092:"az-Cyrl",1068:"az",1133:"ba",1069:"eu",1059:"be",2117:"bn",1093:"bn-IN",8218:"bs-Cyrl",5146:"bs",1150:"br",1026:"bg",1027:"ca",3076:"zh-HK",5124:"zh-MO",2052:"zh",4100:"zh-SG",1028:"zh-TW",1155:"co",1050:"hr",4122:"hr-BA",1029:"cs",1030:"da",1164:"prs",1125:"dv",2067:"nl-BE",1043:"nl",3081:"en-AU",10249:"en-BZ",4105:"en-CA",9225:"en-029",16393:"en-IN",6153:"en-IE",8201:"en-JM",17417:"en-MY",5129:"en-NZ",13321:"en-PH",18441:"en-SG",7177:"en-ZA",11273:"en-TT",2057:"en-GB",1033:"en",12297:"en-ZW",1061:"et",1080:"fo",1124:"fil",1035:"fi",2060:"fr-BE",3084:"fr-CA",1036:"fr",5132:"fr-LU",6156:"fr-MC",4108:"fr-CH",1122:"fy",1110:"gl",1079:"ka",3079:"de-AT",1031:"de",5127:"de-LI",4103:"de-LU",2055:"de-CH",1032:"el",1135:"kl",1095:"gu",1128:"ha",1037:"he",1081:"hi",1038:"hu",1039:"is",1136:"ig",1057:"id",1117:"iu",2141:"iu-Latn",2108:"ga",1076:"xh",1077:"zu",1040:"it",2064:"it-CH",1041:"ja",1099:"kn",1087:"kk",1107:"km",1158:"quc",1159:"rw",1089:"sw",1111:"kok",1042:"ko",1088:"ky",1108:"lo",1062:"lv",1063:"lt",2094:"dsb",1134:"lb",1071:"mk",2110:"ms-BN",1086:"ms",1100:"ml",1082:"mt",1153:"mi",1146:"arn",1102:"mr",1148:"moh",1104:"mn",2128:"mn-CN",1121:"ne",1044:"nb",2068:"nn",1154:"oc",1096:"or",1123:"ps",1045:"pl",1046:"pt",2070:"pt-PT",1094:"pa",1131:"qu-BO",2155:"qu-EC",3179:"qu",1048:"ro",1047:"rm",1049:"ru",9275:"smn",4155:"smj-NO",5179:"smj",3131:"se-FI",1083:"se",2107:"se-SE",8251:"sms",6203:"sma-NO",7227:"sms",1103:"sa",7194:"sr-Cyrl-BA",3098:"sr",6170:"sr-Latn-BA",2074:"sr-Latn",1132:"nso",1074:"tn",1115:"si",1051:"sk",1060:"sl",11274:"es-AR",16394:"es-BO",13322:"es-CL",9226:"es-CO",5130:"es-CR",7178:"es-DO",12298:"es-EC",17418:"es-SV",4106:"es-GT",18442:"es-HN",2058:"es-MX",19466:"es-NI",6154:"es-PA",15370:"es-PY",10250:"es-PE",20490:"es-PR",3082:"es",1034:"es",21514:"es-US",14346:"es-UY",8202:"es-VE",2077:"sv-FI",1053:"sv",1114:"syr",1064:"tg",2143:"tzm",1097:"ta",1092:"tt",1098:"te",1054:"th",1105:"bo",1055:"tr",1090:"tk",1152:"ug",1058:"uk",1070:"hsb",1056:"ur",2115:"uz-Cyrl",1091:"uz",1066:"vi",1106:"cy",1160:"wo",1157:"sah",1144:"ii",1130:"yo"};function JW(t,e,r){switch(t){case 0:if(e===65535)return"und";if(r)return r[e];break;case 1:return oL[e];case 3:return lL[e]}}var sk="utf-16",eq={0:"macintosh",1:"x-mac-japanese",2:"x-mac-chinesetrad",3:"x-mac-korean",6:"x-mac-greek",7:"x-mac-cyrillic",9:"x-mac-devanagai",10:"x-mac-gurmukhi",11:"x-mac-gujarati",12:"x-mac-oriya",13:"x-mac-bengali",14:"x-mac-tamil",15:"x-mac-telugu",16:"x-mac-kannada",17:"x-mac-malayalam",18:"x-mac-sinhalese",19:"x-mac-burmese",20:"x-mac-khmer",21:"x-mac-thai",22:"x-mac-lao",23:"x-mac-georgian",24:"x-mac-armenian",25:"x-mac-chinesesimp",26:"x-mac-tibetan",27:"x-mac-mongolian",28:"x-mac-ethiopic",29:"x-mac-ce",30:"x-mac-vietnamese",31:"x-mac-extarabic"},tq={15:"x-mac-icelandic",17:"x-mac-turkish",18:"x-mac-croatian",24:"x-mac-ce",25:"x-mac-ce",26:"x-mac-ce",27:"x-mac-ce",28:"x-mac-ce",30:"x-mac-icelandic",37:"x-mac-romanian",38:"x-mac-ce",39:"x-mac-ce",40:"x-mac-ce",143:"x-mac-inuit",146:"x-mac-gaelic"};function uL(t,e,r){switch(t){case 0:return sk;case 1:return tq[r]||eq[e];case 3:if(e===1||e===10)return sk;break}}function rq(t,e,r){for(var n={},i=new yr.Parser(t,e),a=i.parseUShort(),s=i.parseUShort(),o=i.offset+i.parseUShort(),l=0;l<s;l++){var u=i.parseUShort(),c=i.parseUShort(),h=i.parseUShort(),p=i.parseUShort(),v=sL[p]||p,y=i.parseUShort(),S=i.parseUShort(),w=JW(u,h,r),T=uL(u,c,h);if(T!==void 0&&w!==void 0){var _=void 0;if(T===sk?_=Kp.UTF16(t,o+S,y):_=Kp.MACSTRING(t,o+S,y,T),_){var C=n[v];C===void 0&&(C=n[v]={}),C[w]=_}}}return a===1&&i.parseUShort(),n}function F2(t){var e={};for(var r in t)e[t[r]]=parseInt(r);return e}function I4(t,e,r,n,i,a){return new Ft.Record("NameRecord",[{name:"platformID",type:"USHORT",value:t},{name:"encodingID",type:"USHORT",value:e},{name:"languageID",type:"USHORT",value:r},{name:"nameID",type:"USHORT",value:n},{name:"length",type:"USHORT",value:i},{name:"offset",type:"USHORT",value:a}])}function nq(t,e){var r=t.length,n=e.length-r+1;e:for(var i=0;i<n;i++)for(;i<n;i++){for(var a=0;a<r;a++)if(e[i+a]!==t[a])continue e;return i}return-1}function j4(t,e){var r=nq(t,e);if(r<0){r=e.length;for(var n=0,i=t.length;n<i;++n)e.push(t[n])}return r}function iq(t,e){var r,n=[],i={},a=F2(sL);for(var s in t){var o=a[s];if(o===void 0&&(o=s),r=parseInt(o),isNaN(r))throw new Error('Name table entry "'+s+'" does not exist, see nameTableNames for complete list.');i[r]=t[s],n.push(r)}for(var l=F2(oL),u=F2(lL),c=[],h=[],p=0;p<n.length;p++){r=n[p];var v=i[r];for(var y in v){var S=v[y],w=1,T=l[y],_=QW[T],C=uL(w,_,T),N=_t.MACSTRING(S,C);N===void 0&&(w=0,T=e.indexOf(y),T<0&&(T=e.length,e.push(y)),_=4,N=_t.UTF16(S));var A=j4(N,h);c.push(I4(w,_,T,r,N.length,A));var I=u[y];if(I!==void 0){var j=_t.UTF16(S),O=j4(j,h);c.push(I4(3,1,I,r,j.length,O))}}}c.sort(function($,Z){return $.platformID-Z.platformID||$.encodingID-Z.encodingID||$.languageID-Z.languageID||$.nameID-Z.nameID});for(var F=new Ft.Table("name",[{name:"format",type:"USHORT",value:0},{name:"count",type:"USHORT",value:c.length},{name:"stringOffset",type:"USHORT",value:6+c.length*12}]),B=0;B<c.length;B++)F.fields.push({name:"record_"+B,type:"RECORD",value:c[B]});return F.fields.push({name:"strings",type:"LITERAL",value:h}),F}var aq={parse:rq,make:iq},ok=[{begin:0,end:127},{begin:128,end:255},{begin:256,end:383},{begin:384,end:591},{begin:592,end:687},{begin:688,end:767},{begin:768,end:879},{begin:880,end:1023},{begin:11392,end:11519},{begin:1024,end:1279},{begin:1328,end:1423},{begin:1424,end:1535},{begin:42240,end:42559},{begin:1536,end:1791},{begin:1984,end:2047},{begin:2304,end:2431},{begin:2432,end:2559},{begin:2560,end:2687},{begin:2688,end:2815},{begin:2816,end:2943},{begin:2944,end:3071},{begin:3072,end:3199},{begin:3200,end:3327},{begin:3328,end:3455},{begin:3584,end:3711},{begin:3712,end:3839},{begin:4256,end:4351},{begin:6912,end:7039},{begin:4352,end:4607},{begin:7680,end:7935},{begin:7936,end:8191},{begin:8192,end:8303},{begin:8304,end:8351},{begin:8352,end:8399},{begin:8400,end:8447},{begin:8448,end:8527},{begin:8528,end:8591},{begin:8592,end:8703},{begin:8704,end:8959},{begin:8960,end:9215},{begin:9216,end:9279},{begin:9280,end:9311},{begin:9312,end:9471},{begin:9472,end:9599},{begin:9600,end:9631},{begin:9632,end:9727},{begin:9728,end:9983},{begin:9984,end:10175},{begin:12288,end:12351},{begin:12352,end:12447},{begin:12448,end:12543},{begin:12544,end:12591},{begin:12592,end:12687},{begin:43072,end:43135},{begin:12800,end:13055},{begin:13056,end:13311},{begin:44032,end:55215},{begin:55296,end:57343},{begin:67840,end:67871},{begin:19968,end:40959},{begin:57344,end:63743},{begin:12736,end:12783},{begin:64256,end:64335},{begin:64336,end:65023},{begin:65056,end:65071},{begin:65040,end:65055},{begin:65104,end:65135},{begin:65136,end:65279},{begin:65280,end:65519},{begin:65520,end:65535},{begin:3840,end:4095},{begin:1792,end:1871},{begin:1920,end:1983},{begin:3456,end:3583},{begin:4096,end:4255},{begin:4608,end:4991},{begin:5024,end:5119},{begin:5120,end:5759},{begin:5760,end:5791},{begin:5792,end:5887},{begin:6016,end:6143},{begin:6144,end:6319},{begin:10240,end:10495},{begin:40960,end:42127},{begin:5888,end:5919},{begin:66304,end:66351},{begin:66352,end:66383},{begin:66560,end:66639},{begin:118784,end:119039},{begin:119808,end:120831},{begin:1044480,end:1048573},{begin:65024,end:65039},{begin:917504,end:917631},{begin:6400,end:6479},{begin:6480,end:6527},{begin:6528,end:6623},{begin:6656,end:6687},{begin:11264,end:11359},{begin:11568,end:11647},{begin:19904,end:19967},{begin:43008,end:43055},{begin:65536,end:65663},{begin:65856,end:65935},{begin:66432,end:66463},{begin:66464,end:66527},{begin:66640,end:66687},{begin:66688,end:66735},{begin:67584,end:67647},{begin:68096,end:68191},{begin:119552,end:119647},{begin:73728,end:74751},{begin:119648,end:119679},{begin:7040,end:7103},{begin:7168,end:7247},{begin:7248,end:7295},{begin:43136,end:43231},{begin:43264,end:43311},{begin:43312,end:43359},{begin:43520,end:43615},{begin:65936,end:65999},{begin:66e3,end:66047},{begin:66208,end:66271},{begin:127024,end:127135}];function sq(t){for(var e=0;e<ok.length;e+=1){var r=ok[e];if(t>=r.begin&&t<r.end)return e}return-1}function oq(t,e){var r={},n=new yr.Parser(t,e);r.version=n.parseUShort(),r.xAvgCharWidth=n.parseShort(),r.usWeightClass=n.parseUShort(),r.usWidthClass=n.parseUShort(),r.fsType=n.parseUShort(),r.ySubscriptXSize=n.parseShort(),r.ySubscriptYSize=n.parseShort(),r.ySubscriptXOffset=n.parseShort(),r.ySubscriptYOffset=n.parseShort(),r.ySuperscriptXSize=n.parseShort(),r.ySuperscriptYSize=n.parseShort(),r.ySuperscriptXOffset=n.parseShort(),r.ySuperscriptYOffset=n.parseShort(),r.yStrikeoutSize=n.parseShort(),r.yStrikeoutPosition=n.parseShort(),r.sFamilyClass=n.parseShort(),r.panose=[];for(var i=0;i<10;i++)r.panose[i]=n.parseByte();return r.ulUnicodeRange1=n.parseULong(),r.ulUnicodeRange2=n.parseULong(),r.ulUnicodeRange3=n.parseULong(),r.ulUnicodeRange4=n.parseULong(),r.achVendID=String.fromCharCode(n.parseByte(),n.parseByte(),n.parseByte(),n.parseByte()),r.fsSelection=n.parseUShort(),r.usFirstCharIndex=n.parseUShort(),r.usLastCharIndex=n.parseUShort(),r.sTypoAscender=n.parseShort(),r.sTypoDescender=n.parseShort(),r.sTypoLineGap=n.parseShort(),r.usWinAscent=n.parseUShort(),r.usWinDescent=n.parseUShort(),r.version>=1&&(r.ulCodePageRange1=n.parseULong(),r.ulCodePageRange2=n.parseULong()),r.version>=2&&(r.sxHeight=n.parseShort(),r.sCapHeight=n.parseShort(),r.usDefaultChar=n.parseUShort(),r.usBreakChar=n.parseUShort(),r.usMaxContent=n.parseUShort()),r}function lq(t){return new Ft.Table("OS/2",[{name:"version",type:"USHORT",value:3},{name:"xAvgCharWidth",type:"SHORT",value:0},{name:"usWeightClass",type:"USHORT",value:0},{name:"usWidthClass",type:"USHORT",value:0},{name:"fsType",type:"USHORT",value:0},{name:"ySubscriptXSize",type:"SHORT",value:650},{name:"ySubscriptYSize",type:"SHORT",value:699},{name:"ySubscriptXOffset",type:"SHORT",value:0},{name:"ySubscriptYOffset",type:"SHORT",value:140},{name:"ySuperscriptXSize",type:"SHORT",value:650},{name:"ySuperscriptYSize",type:"SHORT",value:699},{name:"ySuperscriptXOffset",type:"SHORT",value:0},{name:"ySuperscriptYOffset",type:"SHORT",value:479},{name:"yStrikeoutSize",type:"SHORT",value:49},{name:"yStrikeoutPosition",type:"SHORT",value:258},{name:"sFamilyClass",type:"SHORT",value:0},{name:"bFamilyType",type:"BYTE",value:0},{name:"bSerifStyle",type:"BYTE",value:0},{name:"bWeight",type:"BYTE",value:0},{name:"bProportion",type:"BYTE",value:0},{name:"bContrast",type:"BYTE",value:0},{name:"bStrokeVariation",type:"BYTE",value:0},{name:"bArmStyle",type:"BYTE",value:0},{name:"bLetterform",type:"BYTE",value:0},{name:"bMidline",type:"BYTE",value:0},{name:"bXHeight",type:"BYTE",value:0},{name:"ulUnicodeRange1",type:"ULONG",value:0},{name:"ulUnicodeRange2",type:"ULONG",value:0},{name:"ulUnicodeRange3",type:"ULONG",value:0},{name:"ulUnicodeRange4",type:"ULONG",value:0},{name:"achVendID",type:"CHARARRAY",value:"XXXX"},{name:"fsSelection",type:"USHORT",value:0},{name:"usFirstCharIndex",type:"USHORT",value:0},{name:"usLastCharIndex",type:"USHORT",value:0},{name:"sTypoAscender",type:"SHORT",value:0},{name:"sTypoDescender",type:"SHORT",value:0},{name:"sTypoLineGap",type:"SHORT",value:0},{name:"usWinAscent",type:"USHORT",value:0},{name:"usWinDescent",type:"USHORT",value:0},{name:"ulCodePageRange1",type:"ULONG",value:0},{name:"ulCodePageRange2",type:"ULONG",value:0},{name:"sxHeight",type:"SHORT",value:0},{name:"sCapHeight",type:"SHORT",value:0},{name:"usDefaultChar",type:"USHORT",value:0},{name:"usBreakChar",type:"USHORT",value:0},{name:"usMaxContext",type:"USHORT",value:0}],t)}var F4={parse:oq,make:lq,unicodeRanges:ok,getUnicodeRange:sq};function uq(t,e){var r={},n=new yr.Parser(t,e);switch(r.version=n.parseVersion(),r.italicAngle=n.parseFixed(),r.underlinePosition=n.parseShort(),r.underlineThickness=n.parseShort(),r.isFixedPitch=n.parseULong(),r.minMemType42=n.parseULong(),r.maxMemType42=n.parseULong(),r.minMemType1=n.parseULong(),r.maxMemType1=n.parseULong(),r.version){case 1:r.names=A4.slice();break;case 2:r.numberOfGlyphs=n.parseUShort(),r.glyphNameIndex=new Array(r.numberOfGlyphs);for(var i=0;i<r.numberOfGlyphs;i++)r.glyphNameIndex[i]=n.parseUShort();r.names=[];for(var a=0;a<r.numberOfGlyphs;a++)if(r.glyphNameIndex[a]>=A4.length){var s=n.parseChar();r.names.push(n.parseString(s))}break;case 2.5:r.numberOfGlyphs=n.parseUShort(),r.offset=new Array(r.numberOfGlyphs);for(var o=0;o<r.numberOfGlyphs;o++)r.offset[o]=n.parseChar();break}return r}function cq(){return new Ft.Table("post",[{name:"version",type:"FIXED",value:196608},{name:"italicAngle",type:"FIXED",value:0},{name:"underlinePosition",type:"FWORD",value:0},{name:"underlineThickness",type:"FWORD",value:0},{name:"isFixedPitch",type:"ULONG",value:0},{name:"minMemType42",type:"ULONG",value:0},{name:"maxMemType42",type:"ULONG",value:0},{name:"minMemType1",type:"ULONG",value:0},{name:"maxMemType1",type:"ULONG",value:0}])}var dq={parse:uq,make:cq},Ol=new Array(9);Ol[1]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{substFormat:1,coverage:this.parsePointer(We.coverage),deltaGlyphId:this.parseUShort()};if(r===2)return{substFormat:2,coverage:this.parsePointer(We.coverage),substitute:this.parseOffset16List()};pr.assert(!1,"0x"+e.toString(16)+": lookup type 1 format must be 1 or 2.")};Ol[2]=function(){var e=this.parseUShort();return pr.argument(e===1,"GSUB Multiple Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(We.coverage),sequences:this.parseListOfLists()}};Ol[3]=function(){var e=this.parseUShort();return pr.argument(e===1,"GSUB Alternate Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(We.coverage),alternateSets:this.parseListOfLists()}};Ol[4]=function(){var e=this.parseUShort();return pr.argument(e===1,"GSUB ligature table identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(We.coverage),ligatureSets:this.parseListOfLists(function(){return{ligGlyph:this.parseUShort(),components:this.parseUShortList(this.parseUShort()-1)}})}};var Up={sequenceIndex:We.uShort,lookupListIndex:We.uShort};Ol[5]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{substFormat:r,coverage:this.parsePointer(We.coverage),ruleSets:this.parseListOfLists(function(){var a=this.parseUShort(),s=this.parseUShort();return{input:this.parseUShortList(a-1),lookupRecords:this.parseRecordList(s,Up)}})};if(r===2)return{substFormat:r,coverage:this.parsePointer(We.coverage),classDef:this.parsePointer(We.classDef),classSets:this.parseListOfLists(function(){var a=this.parseUShort(),s=this.parseUShort();return{classes:this.parseUShortList(a-1),lookupRecords:this.parseRecordList(s,Up)}})};if(r===3){var n=this.parseUShort(),i=this.parseUShort();return{substFormat:r,coverages:this.parseList(n,We.pointer(We.coverage)),lookupRecords:this.parseRecordList(i,Up)}}pr.assert(!1,"0x"+e.toString(16)+": lookup type 5 format must be 1, 2 or 3.")};Ol[6]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{substFormat:1,coverage:this.parsePointer(We.coverage),chainRuleSets:this.parseListOfLists(function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(Up)}})};if(r===2)return{substFormat:2,coverage:this.parsePointer(We.coverage),backtrackClassDef:this.parsePointer(We.classDef),inputClassDef:this.parsePointer(We.classDef),lookaheadClassDef:this.parsePointer(We.classDef),chainClassSet:this.parseListOfLists(function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(Up)}})};if(r===3)return{substFormat:3,backtrackCoverage:this.parseList(We.pointer(We.coverage)),inputCoverage:this.parseList(We.pointer(We.coverage)),lookaheadCoverage:this.parseList(We.pointer(We.coverage)),lookupRecords:this.parseRecordList(Up)};pr.assert(!1,"0x"+e.toString(16)+": lookup type 6 format must be 1, 2 or 3.")};Ol[7]=function(){var e=this.parseUShort();pr.argument(e===1,"GSUB Extension Substitution subtable identifier-format must be 1");var r=this.parseUShort(),n=new We(this.data,this.offset+this.parseULong());return{substFormat:1,lookupType:r,extension:Ol[r].call(n)}};Ol[8]=function(){var e=this.parseUShort();return pr.argument(e===1,"GSUB Reverse Chaining Contextual Single Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(We.coverage),backtrackCoverage:this.parseList(We.pointer(We.coverage)),lookaheadCoverage:this.parseList(We.pointer(We.coverage)),substitutes:this.parseUShortList()}};function hq(t,e){e=e||0;var r=new We(t,e),n=r.parseVersion(1);return pr.argument(n===1||n===1.1,"Unsupported GSUB table version."),n===1?{version:n,scripts:r.parseScriptList(),features:r.parseFeatureList(),lookups:r.parseLookupList(Ol)}:{version:n,scripts:r.parseScriptList(),features:r.parseFeatureList(),lookups:r.parseLookupList(Ol),variations:r.parseFeatureVariationsList()}}var mm=new Array(9);mm[1]=function(e){return e.substFormat===1?new Ft.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new Ft.Coverage(e.coverage)},{name:"deltaGlyphID",type:"USHORT",value:e.deltaGlyphId}]):new Ft.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:2},{name:"coverage",type:"TABLE",value:new Ft.Coverage(e.coverage)}].concat(Ft.ushortList("substitute",e.substitute)))};mm[2]=function(e){return pr.assert(e.substFormat===1,"Lookup type 2 substFormat must be 1."),new Ft.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new Ft.Coverage(e.coverage)}].concat(Ft.tableList("seqSet",e.sequences,function(r){return new Ft.Table("sequenceSetTable",Ft.ushortList("sequence",r))})))};mm[3]=function(e){return pr.assert(e.substFormat===1,"Lookup type 3 substFormat must be 1."),new Ft.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new Ft.Coverage(e.coverage)}].concat(Ft.tableList("altSet",e.alternateSets,function(r){return new Ft.Table("alternateSetTable",Ft.ushortList("alternate",r))})))};mm[4]=function(e){return pr.assert(e.substFormat===1,"Lookup type 4 substFormat must be 1."),new Ft.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new Ft.Coverage(e.coverage)}].concat(Ft.tableList("ligSet",e.ligatureSets,function(r){return new Ft.Table("ligatureSetTable",Ft.tableList("ligature",r,function(n){return new Ft.Table("ligatureTable",[{name:"ligGlyph",type:"USHORT",value:n.ligGlyph}].concat(Ft.ushortList("component",n.components,n.components.length+1)))}))})))};mm[6]=function(e){if(e.substFormat===1){var r=new Ft.Table("chainContextTable",[{name:"substFormat",type:"USHORT",value:e.substFormat},{name:"coverage",type:"TABLE",value:new Ft.Coverage(e.coverage)}].concat(Ft.tableList("chainRuleSet",e.chainRuleSets,function(a){return new Ft.Table("chainRuleSetTable",Ft.tableList("chainRule",a,function(s){var o=Ft.ushortList("backtrackGlyph",s.backtrack,s.backtrack.length).concat(Ft.ushortList("inputGlyph",s.input,s.input.length+1)).concat(Ft.ushortList("lookaheadGlyph",s.lookahead,s.lookahead.length)).concat(Ft.ushortList("substitution",[],s.lookupRecords.length));return s.lookupRecords.forEach(function(l,u){o=o.concat({name:"sequenceIndex"+u,type:"USHORT",value:l.sequenceIndex}).concat({name:"lookupListIndex"+u,type:"USHORT",value:l.lookupListIndex})}),new Ft.Table("chainRuleTable",o)}))})));return r}else if(e.substFormat===2)pr.assert(!1,"lookup type 6 format 2 is not yet supported.");else if(e.substFormat===3){var n=[{name:"substFormat",type:"USHORT",value:e.substFormat}];n.push({name:"backtrackGlyphCount",type:"USHORT",value:e.backtrackCoverage.length}),e.backtrackCoverage.forEach(function(a,s){n.push({name:"backtrackCoverage"+s,type:"TABLE",value:new Ft.Coverage(a)})}),n.push({name:"inputGlyphCount",type:"USHORT",value:e.inputCoverage.length}),e.inputCoverage.forEach(function(a,s){n.push({name:"inputCoverage"+s,type:"TABLE",value:new Ft.Coverage(a)})}),n.push({name:"lookaheadGlyphCount",type:"USHORT",value:e.lookaheadCoverage.length}),e.lookaheadCoverage.forEach(function(a,s){n.push({name:"lookaheadCoverage"+s,type:"TABLE",value:new Ft.Coverage(a)})}),n.push({name:"substitutionCount",type:"USHORT",value:e.lookupRecords.length}),e.lookupRecords.forEach(function(a,s){n=n.concat({name:"sequenceIndex"+s,type:"USHORT",value:a.sequenceIndex}).concat({name:"lookupListIndex"+s,type:"USHORT",value:a.lookupListIndex})});var i=new Ft.Table("chainContextTable",n);return i}pr.assert(!1,"lookup type 6 format must be 1, 2 or 3.")};function fq(t){return new Ft.Table("GSUB",[{name:"version",type:"ULONG",value:65536},{name:"scripts",type:"TABLE",value:new Ft.ScriptList(t.scripts)},{name:"features",type:"TABLE",value:new Ft.FeatureList(t.features)},{name:"lookups",type:"TABLE",value:new Ft.LookupList(t.lookups,mm)}])}var pq={parse:hq,make:fq};function mq(t,e){var r=new yr.Parser(t,e),n=r.parseULong();pr.argument(n===1,"Unsupported META table version."),r.parseULong(),r.parseULong();for(var i=r.parseULong(),a={},s=0;s<i;s++){var o=r.parseTag(),l=r.parseULong(),u=r.parseULong(),c=Kp.UTF8(t,e+l,u);a[o]=c}return a}function gq(t){var e=Object.keys(t).length,r="",n=16+e*12,i=new Ft.Table("meta",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"offset",type:"ULONG",value:n},{name:"numTags",type:"ULONG",value:e}]);for(var a in t){var s=r.length;r+=t[a],i.fields.push({name:"tag "+a,type:"TAG",value:a}),i.fields.push({name:"offset "+a,type:"ULONG",value:n+s}),i.fields.push({name:"length "+a,type:"ULONG",value:t[a].length})}return i.fields.push({name:"stringPool",type:"CHARARRAY",value:r}),i}var vq={parse:mq,make:gq};function B4(t){return Math.log(t)/Math.log(2)|0}function A_(t){for(;t.length%4!==0;)t.push(0);for(var e=0,r=0;r<t.length;r+=4)e+=(t[r]<<24)+(t[r+1]<<16)+(t[r+2]<<8)+t[r+3];return e%=Math.pow(2,32),e}function z4(t,e,r,n){return new Ft.Record("Table Record",[{name:"tag",type:"TAG",value:t!==void 0?t:""},{name:"checkSum",type:"ULONG",value:e!==void 0?e:0},{name:"offset",type:"ULONG",value:r!==void 0?r:0},{name:"length",type:"ULONG",value:n!==void 0?n:0}])}function cL(t){var e=new Ft.Table("sfnt",[{name:"version",type:"TAG",value:"OTTO"},{name:"numTables",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);e.tables=t,e.numTables=t.length;var r=Math.pow(2,B4(e.numTables));e.searchRange=16*r,e.entrySelector=B4(r),e.rangeShift=e.numTables*16-e.searchRange;for(var n=[],i=[],a=e.sizeOf()+z4().sizeOf()*e.numTables;a%4!==0;)a+=1,i.push({name:"padding",type:"BYTE",value:0});for(var s=0;s<t.length;s+=1){var o=t[s];pr.argument(o.tableName.length===4,"Table name"+o.tableName+" is invalid.");var l=o.sizeOf(),u=z4(o.tableName,A_(o.encode()),a,l);for(n.push({name:u.tag+" Table Record",type:"RECORD",value:u}),i.push({name:o.tableName+" table",type:"RECORD",value:o}),a+=l,pr.argument(!isNaN(a),"Something went wrong calculating the offset.");a%4!==0;)a+=1,i.push({name:"padding",type:"BYTE",value:0})}return n.sort(function(c,h){return c.value.tag>h.value.tag?1:-1}),e.fields=e.fields.concat(n),e.fields=e.fields.concat(i),e}function U4(t,e,r){for(var n=0;n<e.length;n+=1){var i=t.charToGlyphIndex(e[n]);if(i>0){var a=t.glyphs.get(i);return a.getMetrics()}}return r}function yq(t){for(var e=0,r=0;r<t.length;r+=1)e+=t[r];return e/t.length}function xq(t){for(var e=[],r=[],n=[],i=[],a=[],s=[],o=[],l,u=0,c=0,h=0,p=0,v=0,y=0;y<t.glyphs.length;y+=1){var S=t.glyphs.get(y),w=S.unicode|0;if(isNaN(S.advanceWidth))throw new Error("Glyph "+S.name+" ("+y+"): advanceWidth is not a number.");(l>w||l===void 0)&&w>0&&(l=w),u<w&&(u=w);var T=F4.getUnicodeRange(w);if(T<32)c|=1<<T;else if(T<64)h|=1<<T-32;else if(T<96)p|=1<<T-64;else if(T<123)v|=1<<T-96;else throw new Error("Unicode ranges bits > 123 are reserved for internal usage");if(S.name!==".notdef"){var _=S.getMetrics();e.push(_.xMin),r.push(_.yMin),n.push(_.xMax),i.push(_.yMax),s.push(_.leftSideBearing),o.push(_.rightSideBearing),a.push(S.advanceWidth)}}var C={xMin:Math.min.apply(null,e),yMin:Math.min.apply(null,r),xMax:Math.max.apply(null,n),yMax:Math.max.apply(null,i),advanceWidthMax:Math.max.apply(null,a),advanceWidthAvg:yq(a),minLeftSideBearing:Math.min.apply(null,s),maxLeftSideBearing:Math.max.apply(null,s),minRightSideBearing:Math.min.apply(null,o)};C.ascender=t.ascender,C.descender=t.descender;var N=jW.make({flags:3,unitsPerEm:t.unitsPerEm,xMin:C.xMin,yMin:C.yMin,xMax:C.xMax,yMax:C.yMax,lowestRecPPEM:3,createdTimestamp:t.createdTimestamp}),A=zW.make({ascender:C.ascender,descender:C.descender,advanceWidthMax:C.advanceWidthMax,minLeftSideBearing:C.minLeftSideBearing,minRightSideBearing:C.minRightSideBearing,xMaxExtent:C.maxLeftSideBearing+(C.xMax-C.xMin),numberOfHMetrics:t.glyphs.length}),I=XW.make(t.glyphs.length),j=F4.make(Object.assign({xAvgCharWidth:Math.round(C.advanceWidthAvg),usFirstCharIndex:l,usLastCharIndex:u,ulUnicodeRange1:c,ulUnicodeRange2:h,ulUnicodeRange3:p,ulUnicodeRange4:v,sTypoAscender:C.ascender,sTypoDescender:C.descender,sTypoLineGap:0,usWinAscent:C.yMax,usWinDescent:Math.abs(C.yMin),ulCodePageRange1:1,sxHeight:U4(t,"xyvw",{yMax:Math.round(C.ascender/2)}).yMax,sCapHeight:U4(t,"HIKLEFJMNTZBDPRAGOQSUVWXY",C).yMax,usDefaultChar:t.hasChar(" ")?32:0,usBreakChar:t.hasChar(" ")?32:0},t.tables.os2)),O=WW.make(t.glyphs),F=sW.make(t.glyphs),B=t.getEnglishName("fontFamily"),$=t.getEnglishName("fontSubfamily"),Z=B+" "+$,D=t.getEnglishName("postScriptName");D||(D=B.replace(/\s/g,"")+"-"+$);var H={};for(var U in t.names)H[U]=t.names[U];H.uniqueID||(H.uniqueID={en:t.getEnglishName("manufacturer")+":"+Z}),H.postScriptName||(H.postScriptName={en:D}),H.preferredFamily||(H.preferredFamily=t.names.fontFamily),H.preferredSubfamily||(H.preferredSubfamily=t.names.fontSubfamily);var W=[],Y=aq.make(H,W),Q=W.length>0?KW.make(W):void 0,ne=dq.make(),re=OW.make(t.glyphs,{version:t.getEnglishName("version"),fullName:Z,familyName:B,weightName:$,postScriptName:D,unitsPerEm:t.unitsPerEm,fontBBox:[0,C.yMin,C.ascender,C.advanceWidthMax]}),q=t.metas&&Object.keys(t.metas).length>0?vq.make(t.metas):void 0,te=[N,A,I,j,Y,F,ne,re,O];Q&&te.push(Q),t.tables.gsub&&te.push(pq.make(t.tables.gsub)),q&&te.push(q);for(var ae=cL(te),de=ae.encode(),ge=A_(de),ye=ae.fields,se=!1,fe=0;fe<ye.length;fe+=1)if(ye[fe].name==="head table"){ye[fe].value.checkSumAdjustment=2981146554-ge,se=!0;break}if(!se)throw new Error("Could not find head table with checkSum to adjust.");return ae}var bq={make:cL,fontToTable:xq,computeCheckSum:A_};function B2(t,e){for(var r=0,n=t.length-1;r<=n;){var i=r+n>>>1,a=t[i].tag;if(a===e)return i;a<e?r=i+1:n=i-1}return-r-1}function G4(t,e){for(var r=0,n=t.length-1;r<=n;){var i=r+n>>>1,a=t[i];if(a===e)return i;a<e?r=i+1:n=i-1}return-r-1}function V4(t,e){for(var r,n=0,i=t.length-1;n<=i;){var a=n+i>>>1;r=t[a];var s=r.start;if(s===e)return r;s<e?n=a+1:i=a-1}if(n>0)return r=t[n-1],e>r.end?0:r}function a0(t,e){this.font=t,this.tableName=e}a0.prototype={searchTag:B2,binSearch:G4,getTable:function(t){var e=this.font.tables[this.tableName];return!e&&t&&(e=this.font.tables[this.tableName]=this.createDefaultTable()),e},getScriptNames:function(){var t=this.getTable();return t?t.scripts.map(function(e){return e.tag}):[]},getDefaultScriptName:function(){var t=this.getTable();if(t){for(var e=!1,r=0;r<t.scripts.length;r++){var n=t.scripts[r].tag;if(n==="DFLT")return n;n==="latn"&&(e=!0)}if(e)return"latn"}},getScriptTable:function(t,e){var r=this.getTable(e);if(r){t=t||"DFLT";var n=r.scripts,i=B2(r.scripts,t);if(i>=0)return n[i].script;if(e){var a={tag:t,script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}};return n.splice(-1-i,0,a),a.script}}},getLangSysTable:function(t,e,r){var n=this.getScriptTable(t,r);if(n){if(!e||e==="dflt"||e==="DFLT")return n.defaultLangSys;var i=B2(n.langSysRecords,e);if(i>=0)return n.langSysRecords[i].langSys;if(r){var a={tag:e,langSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]}};return n.langSysRecords.splice(-1-i,0,a),a.langSys}}},getFeatureTable:function(t,e,r,n){var i=this.getLangSysTable(t,e,n);if(i){for(var a,s=i.featureIndexes,o=this.font.tables[this.tableName].features,l=0;l<s.length;l++)if(a=o[s[l]],a.tag===r)return a.feature;if(n){var u=o.length;return pr.assert(u===0||r>=o[u-1].tag,"Features must be added in alphabetical order."),a={tag:r,feature:{params:0,lookupListIndexes:[]}},o.push(a),s.push(u),a.feature}}},getLookupTables:function(t,e,r,n,i){var a=this.getFeatureTable(t,e,r,i),s=[];if(a){for(var o,l=a.lookupListIndexes,u=this.font.tables[this.tableName].lookups,c=0;c<l.length;c++)o=u[l[c]],o.lookupType===n&&s.push(o);if(s.length===0&&i){o={lookupType:n,lookupFlag:0,subtables:[],markFilteringSet:void 0};var h=u.length;return u.push(o),l.push(h),[o]}}return s},getGlyphClass:function(t,e){switch(t.format){case 1:return t.startGlyph<=e&&e<t.startGlyph+t.classes.length?t.classes[e-t.startGlyph]:0;case 2:var r=V4(t.ranges,e);return r?r.classId:0}},getCoverageIndex:function(t,e){switch(t.format){case 1:var r=G4(t.glyphs,e);return r>=0?r:-1;case 2:var n=V4(t.ranges,e);return n?n.index+e-n.start:-1}},expandCoverage:function(t){if(t.format===1)return t.glyphs;for(var e=[],r=t.ranges,n=0;n<r.length;n++)for(var i=r[n],a=i.start,s=i.end,o=a;o<=s;o++)e.push(o);return e}};function s0(t){a0.call(this,t,"gpos")}s0.prototype=a0.prototype;s0.prototype.init=function(){var t=this.getDefaultScriptName();this.defaultKerningTables=this.getKerningTables(t)};s0.prototype.getKerningValue=function(t,e,r){for(var n=0;n<t.length;n++)for(var i=t[n].subtables,a=0;a<i.length;a++){var s=i[a],o=this.getCoverageIndex(s.coverage,e);if(!(o<0))switch(s.posFormat){case 1:for(var l=s.pairSets[o],u=0;u<l.length;u++){var c=l[u];if(c.secondGlyph===r)return c.value1&&c.value1.xAdvance||0}break;case 2:var h=this.getGlyphClass(s.classDef1,e),p=this.getGlyphClass(s.classDef2,r),v=s.classRecords[h][p];return v.value1&&v.value1.xAdvance||0}}return 0};s0.prototype.getKerningTables=function(t,e){if(this.font.tables.gpos)return this.getLookupTables(t,e,"kern",2)};function vo(t){a0.call(this,t,"gsub")}function wq(t,e){var r=t.length;if(r!==e.length)return!1;for(var n=0;n<r;n++)if(t[n]!==e[n])return!1;return!0}function R_(t,e,r){for(var n=t.subtables,i=0;i<n.length;i++){var a=n[i];if(a.substFormat===e)return a}if(r)return n.push(r),r}vo.prototype=a0.prototype;vo.prototype.createDefaultTable=function(){return{version:1,scripts:[{tag:"DFLT",script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}}],features:[],lookups:[]}};vo.prototype.getSingle=function(t,e,r){for(var n=[],i=this.getLookupTables(e,r,t,1),a=0;a<i.length;a++)for(var s=i[a].subtables,o=0;o<s.length;o++){var l=s[o],u=this.expandCoverage(l.coverage),c=void 0;if(l.substFormat===1){var h=l.deltaGlyphId;for(c=0;c<u.length;c++){var p=u[c];n.push({sub:p,by:p+h})}}else{var v=l.substitute;for(c=0;c<u.length;c++)n.push({sub:u[c],by:v[c]})}}return n};vo.prototype.getMultiple=function(t,e,r){for(var n=[],i=this.getLookupTables(e,r,t,2),a=0;a<i.length;a++)for(var s=i[a].subtables,o=0;o<s.length;o++){var l=s[o],u=this.expandCoverage(l.coverage),c=void 0;for(c=0;c<u.length;c++){var h=u[c],p=l.sequences[c];n.push({sub:h,by:p})}}return n};vo.prototype.getAlternates=function(t,e,r){for(var n=[],i=this.getLookupTables(e,r,t,3),a=0;a<i.length;a++)for(var s=i[a].subtables,o=0;o<s.length;o++)for(var l=s[o],u=this.expandCoverage(l.coverage),c=l.alternateSets,h=0;h<u.length;h++)n.push({sub:u[h],by:c[h]});return n};vo.prototype.getLigatures=function(t,e,r){for(var n=[],i=this.getLookupTables(e,r,t,4),a=0;a<i.length;a++)for(var s=i[a].subtables,o=0;o<s.length;o++)for(var l=s[o],u=this.expandCoverage(l.coverage),c=l.ligatureSets,h=0;h<u.length;h++)for(var p=u[h],v=c[h],y=0;y<v.length;y++){var S=v[y];n.push({sub:[p].concat(S.components),by:S.ligGlyph})}return n};vo.prototype.addSingle=function(t,e,r,n){var i=this.getLookupTables(r,n,t,1,!0)[0],a=R_(i,2,{substFormat:2,coverage:{format:1,glyphs:[]},substitute:[]});pr.assert(a.coverage.format===1,"Single: unable to modify coverage table format "+a.coverage.format);var s=e.sub,o=this.binSearch(a.coverage.glyphs,s);o<0&&(o=-1-o,a.coverage.glyphs.splice(o,0,s),a.substitute.splice(o,0,0)),a.substitute[o]=e.by};vo.prototype.addMultiple=function(t,e,r,n){pr.assert(e.by instanceof Array&&e.by.length>1,'Multiple: "by" must be an array of two or more ids');var i=this.getLookupTables(r,n,t,2,!0)[0],a=R_(i,1,{substFormat:1,coverage:{format:1,glyphs:[]},sequences:[]});pr.assert(a.coverage.format===1,"Multiple: unable to modify coverage table format "+a.coverage.format);var s=e.sub,o=this.binSearch(a.coverage.glyphs,s);o<0&&(o=-1-o,a.coverage.glyphs.splice(o,0,s),a.sequences.splice(o,0,0)),a.sequences[o]=e.by};vo.prototype.addAlternate=function(t,e,r,n){var i=this.getLookupTables(r,n,t,3,!0)[0],a=R_(i,1,{substFormat:1,coverage:{format:1,glyphs:[]},alternateSets:[]});pr.assert(a.coverage.format===1,"Alternate: unable to modify coverage table format "+a.coverage.format);var s=e.sub,o=this.binSearch(a.coverage.glyphs,s);o<0&&(o=-1-o,a.coverage.glyphs.splice(o,0,s),a.alternateSets.splice(o,0,0)),a.alternateSets[o]=e.by};vo.prototype.addLigature=function(t,e,r,n){var i=this.getLookupTables(r,n,t,4,!0)[0],a=i.subtables[0];a||(a={substFormat:1,coverage:{format:1,glyphs:[]},ligatureSets:[]},i.subtables[0]=a),pr.assert(a.coverage.format===1,"Ligature: unable to modify coverage table format "+a.coverage.format);var s=e.sub[0],o=e.sub.slice(1),l={ligGlyph:e.by,components:o},u=this.binSearch(a.coverage.glyphs,s);if(u>=0){for(var c=a.ligatureSets[u],h=0;h<c.length;h++)if(wq(c[h].components,o))return;c.push(l)}else u=-1-u,a.coverage.glyphs.splice(u,0,s),a.ligatureSets.splice(u,0,[l])};vo.prototype.getFeature=function(t,e,r){if(/ss\d\d/.test(t))return this.getSingle(t,e,r);switch(t){case"aalt":case"salt":return this.getSingle(t,e,r).concat(this.getAlternates(t,e,r));case"dlig":case"liga":case"rlig":return this.getLigatures(t,e,r);case"ccmp":return this.getMultiple(t,e,r).concat(this.getLigatures(t,e,r));case"stch":return this.getMultiple(t,e,r)}};vo.prototype.add=function(t,e,r,n){if(/ss\d\d/.test(t))return this.addSingle(t,e,r,n);switch(t){case"aalt":case"salt":return typeof e.by=="number"?this.addSingle(t,e,r,n):this.addAlternate(t,e,r,n);case"dlig":case"liga":case"rlig":return this.addLigature(t,e,r,n);case"ccmp":return e.by instanceof Array?this.addMultiple(t,e,r,n):this.addLigature(t,e,r,n)}};function Sq(){return typeof window<"u"}function kq(t){for(var e=new Buffer(t.byteLength),r=new Uint8Array(t),n=0;n<e.length;++n)e[n]=r[n];return e}function Fg(t,e){if(!t)throw e}function H4(t,e,r,n,i){var a;return(e&n)>0?(a=t.parseByte(),(e&i)===0&&(a=-a),a=r+a):(e&i)>0?a=r:a=r+t.parseShort(),a}function dL(t,e,r){var n=new yr.Parser(e,r);t.numberOfContours=n.parseShort(),t._xMin=n.parseShort(),t._yMin=n.parseShort(),t._xMax=n.parseShort(),t._yMax=n.parseShort();var i,a;if(t.numberOfContours>0){for(var s=t.endPointIndices=[],o=0;o<t.numberOfContours;o+=1)s.push(n.parseUShort());t.instructionLength=n.parseUShort(),t.instructions=[];for(var l=0;l<t.instructionLength;l+=1)t.instructions.push(n.parseByte());var u=s[s.length-1]+1;i=[];for(var c=0;c<u;c+=1)if(a=n.parseByte(),i.push(a),(a&8)>0)for(var h=n.parseByte(),p=0;p<h;p+=1)i.push(a),c+=1;if(pr.argument(i.length===u,"Bad flags."),s.length>0){var v=[],y;if(u>0){for(var S=0;S<u;S+=1)a=i[S],y={},y.onCurve=!!(a&1),y.lastPointOfContour=s.indexOf(S)>=0,v.push(y);for(var w=0,T=0;T<u;T+=1)a=i[T],y=v[T],y.x=H4(n,a,w,2,16),w=y.x;for(var _=0,C=0;C<u;C+=1)a=i[C],y=v[C],y.y=H4(n,a,_,4,32),_=y.y}t.points=v}else t.points=[]}else if(t.numberOfContours===0)t.points=[];else{t.isComposite=!0,t.points=[],t.components=[];for(var N=!0;N;){i=n.parseUShort();var A={glyphIndex:n.parseUShort(),xScale:1,scale01:0,scale10:0,yScale:1,dx:0,dy:0};(i&1)>0?(i&2)>0?(A.dx=n.parseShort(),A.dy=n.parseShort()):A.matchedPoints=[n.parseUShort(),n.parseUShort()]:(i&2)>0?(A.dx=n.parseChar(),A.dy=n.parseChar()):A.matchedPoints=[n.parseByte(),n.parseByte()],(i&8)>0?A.xScale=A.yScale=n.parseF2Dot14():(i&64)>0?(A.xScale=n.parseF2Dot14(),A.yScale=n.parseF2Dot14()):(i&128)>0&&(A.xScale=n.parseF2Dot14(),A.scale01=n.parseF2Dot14(),A.scale10=n.parseF2Dot14(),A.yScale=n.parseF2Dot14()),t.components.push(A),N=!!(i&32)}if(i&256){t.instructionLength=n.parseUShort(),t.instructions=[];for(var I=0;I<t.instructionLength;I+=1)t.instructions.push(n.parseByte())}}}function z2(t,e){for(var r=[],n=0;n<t.length;n+=1){var i=t[n],a={x:e.xScale*i.x+e.scale01*i.y+e.dx,y:e.scale10*i.x+e.yScale*i.y+e.dy,onCurve:i.onCurve,lastPointOfContour:i.lastPointOfContour};r.push(a)}return r}function _q(t){for(var e=[],r=[],n=0;n<t.length;n+=1){var i=t[n];r.push(i),i.lastPointOfContour&&(e.push(r),r=[])}return pr.argument(r.length===0,"There are still points left in the current contour."),e}function hL(t){var e=new Xi;if(!t)return e;for(var r=_q(t),n=0;n<r.length;++n){var i=r[n],a=null,s=i[i.length-1],o=i[0];if(s.onCurve)e.moveTo(s.x,s.y);else if(o.onCurve)e.moveTo(o.x,o.y);else{var l={x:(s.x+o.x)*.5,y:(s.y+o.y)*.5};e.moveTo(l.x,l.y)}for(var u=0;u<i.length;++u)if(a=s,s=o,o=i[(u+1)%i.length],s.onCurve)e.lineTo(s.x,s.y);else{var c=o;a.onCurve||((s.x+a.x)*.5,(s.y+a.y)*.5),o.onCurve||(c={x:(s.x+o.x)*.5,y:(s.y+o.y)*.5}),e.quadraticCurveTo(s.x,s.y,c.x,c.y)}e.closePath()}return e}function fL(t,e){if(e.isComposite)for(var r=0;r<e.components.length;r+=1){var n=e.components[r],i=t.get(n.glyphIndex);if(i.getPath(),i.points){var a=void 0;if(n.matchedPoints===void 0)a=z2(i.points,n);else{if(n.matchedPoints[0]>e.points.length-1||n.matchedPoints[1]>i.points.length-1)throw Error("Matched points out of range in "+e.name);var s=e.points[n.matchedPoints[0]],o=i.points[n.matchedPoints[1]],l={xScale:n.xScale,scale01:n.scale01,scale10:n.scale10,yScale:n.yScale,dx:0,dy:0};o=z2([o],l)[0],l.dx=s.x-o.x,l.dy=s.y-o.y,a=z2(i.points,l)}e.points=e.points.concat(a)}}return hL(e.points)}function Cq(t,e,r,n){for(var i=new Cu.GlyphSet(n),a=0;a<r.length-1;a+=1){var s=r[a],o=r[a+1];s!==o?i.push(a,Cu.ttfGlyphLoader(n,a,dL,t,e+s,fL)):i.push(a,Cu.glyphLoader(n,a))}return i}function Eq(t,e,r,n){var i=new Cu.GlyphSet(n);return n._push=function(a){var s=r[a],o=r[a+1];s!==o?i.push(a,Cu.ttfGlyphLoader(n,a,dL,t,e+s,fL)):i.push(a,Cu.glyphLoader(n,a))},i}function Tq(t,e,r,n,i){return i.lowMemory?Eq(t,e,r,n):Cq(t,e,r,n)}var Nq={getPath:hL,parse:Tq},pL,bf,mL,lk;function gL(t){this.font=t,this.getCommands=function(e){return Nq.getPath(e).commands},this._fpgmState=this._prepState=void 0,this._errorState=0}function Pq(t){return t}function vL(t){return Math.sign(t)*Math.round(Math.abs(t))}function Mq(t){return Math.sign(t)*Math.round(Math.abs(t*2))/2}function Aq(t){return Math.sign(t)*(Math.round(Math.abs(t)+.5)-.5)}function Rq(t){return Math.sign(t)*Math.ceil(Math.abs(t))}function Lq(t){return Math.sign(t)*Math.floor(Math.abs(t))}var yL=function(t){var e=this.srPeriod,r=this.srPhase,n=this.srThreshold,i=1;return t<0&&(t=-t,i=-1),t+=n-r,t=Math.trunc(t/e)*e,t+=r,t<0?r*i:t*i},_u={x:1,y:0,axis:"x",distance:function(t,e,r,n){return(r?t.xo:t.x)-(n?e.xo:e.x)},interpolate:function(t,e,r,n){var i,a,s,o,l,u,c;if(!n||n===this){if(i=t.xo-e.xo,a=t.xo-r.xo,l=e.x-e.xo,u=r.x-r.xo,s=Math.abs(i),o=Math.abs(a),c=s+o,c===0){t.x=t.xo+(l+u)/2;return}t.x=t.xo+(l*o+u*s)/c;return}if(i=n.distance(t,e,!0,!0),a=n.distance(t,r,!0,!0),l=n.distance(e,e,!1,!0),u=n.distance(r,r,!1,!0),s=Math.abs(i),o=Math.abs(a),c=s+o,c===0){_u.setRelative(t,t,(l+u)/2,n,!0);return}_u.setRelative(t,t,(l*o+u*s)/c,n,!0)},normalSlope:Number.NEGATIVE_INFINITY,setRelative:function(t,e,r,n,i){if(!n||n===this){t.x=(i?e.xo:e.x)+r;return}var a=i?e.xo:e.x,s=i?e.yo:e.y,o=a+r*n.x,l=s+r*n.y;t.x=o+(t.y-l)/n.normalSlope},slope:0,touch:function(t){t.xTouched=!0},touched:function(t){return t.xTouched},untouch:function(t){t.xTouched=!1}},dc={x:0,y:1,axis:"y",distance:function(t,e,r,n){return(r?t.yo:t.y)-(n?e.yo:e.y)},interpolate:function(t,e,r,n){var i,a,s,o,l,u,c;if(!n||n===this){if(i=t.yo-e.yo,a=t.yo-r.yo,l=e.y-e.yo,u=r.y-r.yo,s=Math.abs(i),o=Math.abs(a),c=s+o,c===0){t.y=t.yo+(l+u)/2;return}t.y=t.yo+(l*o+u*s)/c;return}if(i=n.distance(t,e,!0,!0),a=n.distance(t,r,!0,!0),l=n.distance(e,e,!1,!0),u=n.distance(r,r,!1,!0),s=Math.abs(i),o=Math.abs(a),c=s+o,c===0){dc.setRelative(t,t,(l+u)/2,n,!0);return}dc.setRelative(t,t,(l*o+u*s)/c,n,!0)},normalSlope:0,setRelative:function(t,e,r,n,i){if(!n||n===this){t.y=(i?e.yo:e.y)+r;return}var a=i?e.xo:e.x,s=i?e.yo:e.y,o=a+r*n.x,l=s+r*n.y;t.y=l+n.normalSlope*(t.x-o)},slope:Number.POSITIVE_INFINITY,touch:function(t){t.yTouched=!0},touched:function(t){return t.yTouched},untouch:function(t){t.yTouched=!1}};Object.freeze(_u);Object.freeze(dc);function o0(t,e){this.x=t,this.y=e,this.axis=void 0,this.slope=e/t,this.normalSlope=-t/e,Object.freeze(this)}o0.prototype.distance=function(t,e,r,n){return this.x*_u.distance(t,e,r,n)+this.y*dc.distance(t,e,r,n)};o0.prototype.interpolate=function(t,e,r,n){var i,a,s,o,l,u,c;if(s=n.distance(t,e,!0,!0),o=n.distance(t,r,!0,!0),i=n.distance(e,e,!1,!0),a=n.distance(r,r,!1,!0),l=Math.abs(s),u=Math.abs(o),c=l+u,c===0){this.setRelative(t,t,(i+a)/2,n,!0);return}this.setRelative(t,t,(i*u+a*l)/c,n,!0)};o0.prototype.setRelative=function(t,e,r,n,i){n=n||this;var a=i?e.xo:e.x,s=i?e.yo:e.y,o=a+r*n.x,l=s+r*n.y,u=n.normalSlope,c=this.slope,h=t.x,p=t.y;t.x=(c*h-u*o+l-p)/(c-u),t.y=c*(t.x-h)+p};o0.prototype.touch=function(t){t.xTouched=!0,t.yTouched=!0};function l0(t,e){var r=Math.sqrt(t*t+e*e);return t/=r,e/=r,t===1&&e===0?_u:t===0&&e===1?dc:new o0(t,e)}function fc(t,e,r,n){this.x=this.xo=Math.round(t*64)/64,this.y=this.yo=Math.round(e*64)/64,this.lastPointOfContour=r,this.onCurve=n,this.prevPointOnContour=void 0,this.nextPointOnContour=void 0,this.xTouched=!1,this.yTouched=!1,Object.preventExtensions(this)}fc.prototype.nextTouched=function(t){for(var e=this.nextPointOnContour;!t.touched(e)&&e!==this;)e=e.nextPointOnContour;return e};fc.prototype.prevTouched=function(t){for(var e=this.prevPointOnContour;!t.touched(e)&&e!==this;)e=e.prevPointOnContour;return e};var Av=Object.freeze(new fc(0,0)),Oq={cvCutIn:17/16,deltaBase:9,deltaShift:.125,loop:1,minDis:1,autoFlip:!0};function Id(t,e){switch(this.env=t,this.stack=[],this.prog=e,t){case"glyf":this.zp0=this.zp1=this.zp2=1,this.rp0=this.rp1=this.rp2=0;case"prep":this.fv=this.pv=this.dpv=_u,this.round=vL}}gL.prototype.exec=function(t,e){if(typeof e!="number")throw new Error("Point size is not a number!");if(!(this._errorState>2)){var r=this.font,n=this._prepState;if(!n||n.ppem!==e){var i=this._fpgmState;if(!i){Id.prototype=Oq,i=this._fpgmState=new Id("fpgm",r.tables.fpgm),i.funcs=[],i.font=r,Ye.DEBUG&&(console.log("---EXEC FPGM---"),i.step=-1);try{bf(i)}catch(u){console.log("Hinting error in FPGM:"+u),this._errorState=3;return}}Id.prototype=i,n=this._prepState=new Id("prep",r.tables.prep),n.ppem=e;var a=r.tables.cvt;if(a)for(var s=n.cvt=new Array(a.length),o=e/r.unitsPerEm,l=0;l<a.length;l++)s[l]=a[l]*o;else n.cvt=[];Ye.DEBUG&&(console.log("---EXEC PREP---"),n.step=-1);try{bf(n)}catch(u){this._errorState<2&&console.log("Hinting error in PREP:"+u),this._errorState=2}}if(!(this._errorState>1))try{return mL(t,n)}catch(u){this._errorState<1&&(console.log("Hinting error:"+u),console.log("Note: further hinting errors are silenced")),this._errorState=1;return}}};mL=function(t,e){var r=e.ppem/e.font.unitsPerEm,n=r,i=t.components,a,s,o;if(Id.prototype=e,!i)o=new Id("glyf",t.instructions),Ye.DEBUG&&(console.log("---EXEC GLYPH---"),o.step=-1),lk(t,o,r,n),s=o.gZone;else{var l=e.font;s=[],a=[];for(var u=0;u<i.length;u++){var c=i[u],h=l.glyphs.get(c.glyphIndex);o=new Id("glyf",h.instructions),Ye.DEBUG&&(console.log("---EXEC COMP "+u+"---"),o.step=-1),lk(h,o,r,n);for(var p=Math.round(c.dx*r),v=Math.round(c.dy*n),y=o.gZone,S=o.contours,w=0;w<y.length;w++){var T=y[w];T.xTouched=T.yTouched=!1,T.xo=T.x=T.x+p,T.yo=T.y=T.y+v}var _=s.length;s.push.apply(s,y);for(var C=0;C<S.length;C++)a.push(S[C]+_)}t.instructions&&!o.inhibitGridFit&&(o=new Id("glyf",t.instructions),o.gZone=o.z0=o.z1=o.z2=s,o.contours=a,s.push(new fc(0,0),new fc(Math.round(t.advanceWidth*r),0)),Ye.DEBUG&&(console.log("---EXEC COMPOSITE---"),o.step=-1),bf(o),s.length-=2)}return s};lk=function(t,e,r,n){for(var i=t.points||[],a=i.length,s=e.gZone=e.z0=e.z1=e.z2=[],o=e.contours=[],l,u=0;u<a;u++)l=i[u],s[u]=new fc(l.x*r,l.y*n,l.lastPointOfContour,l.onCurve);for(var c,h,p=0;p<a;p++)l=s[p],c||(c=l,o.push(p)),l.lastPointOfContour?(l.nextPointOnContour=c,c.prevPointOnContour=l,c=void 0):(h=s[p+1],l.nextPointOnContour=h,h.prevPointOnContour=l);if(!e.inhibitGridFit){if(Ye.DEBUG){console.log("PROCESSING GLYPH",e.stack);for(var v=0;v<a;v++)console.log(v,s[v].x,s[v].y)}if(s.push(new fc(0,0),new fc(Math.round(t.advanceWidth*r),0)),bf(e),s.length-=2,Ye.DEBUG){console.log("FINISHED GLYPH",e.stack);for(var y=0;y<a;y++)console.log(y,s[y].x,s[y].y)}}};bf=function(t){var e=t.prog;if(e){var r=e.length,n;for(t.ip=0;t.ip<r;t.ip++){if(Ye.DEBUG&&t.step++,n=pL[e[t.ip]],!n)throw new Error("unknown instruction: 0x"+Number(e[t.ip]).toString(16));n(t)}}};function G1(t){for(var e=t.tZone=new Array(t.gZone.length),r=0;r<e.length;r++)e[r]=new fc(0,0)}function xL(t,e){var r=t.prog,n=t.ip,i=1,a;do if(a=r[++n],a===88)i++;else if(a===89)i--;else if(a===64)n+=r[n+1]+1;else if(a===65)n+=2*r[n+1]+1;else if(a>=176&&a<=183)n+=a-176+1;else if(a>=184&&a<=191)n+=(a-184+1)*2;else if(e&&i===1&&a===27)break;while(i>0);t.ip=n}function W4(t,e){Ye.DEBUG&&console.log(e.step,"SVTCA["+t.axis+"]"),e.fv=e.pv=e.dpv=t}function q4(t,e){Ye.DEBUG&&console.log(e.step,"SPVTCA["+t.axis+"]"),e.pv=e.dpv=t}function $4(t,e){Ye.DEBUG&&console.log(e.step,"SFVTCA["+t.axis+"]"),e.fv=t}function K4(t,e){var r=e.stack,n=r.pop(),i=r.pop(),a=e.z2[n],s=e.z1[i];Ye.DEBUG&&console.log("SPVTL["+t+"]",n,i);var o,l;t?(o=a.y-s.y,l=s.x-a.x):(o=s.x-a.x,l=s.y-a.y),e.pv=e.dpv=l0(o,l)}function Z4(t,e){var r=e.stack,n=r.pop(),i=r.pop(),a=e.z2[n],s=e.z1[i];Ye.DEBUG&&console.log("SFVTL["+t+"]",n,i);var o,l;t?(o=a.y-s.y,l=s.x-a.x):(o=s.x-a.x,l=s.y-a.y),e.fv=l0(o,l)}function Dq(t){var e=t.stack,r=e.pop(),n=e.pop();Ye.DEBUG&&console.log(t.step,"SPVFS[]",r,n),t.pv=t.dpv=l0(n,r)}function Iq(t){var e=t.stack,r=e.pop(),n=e.pop();Ye.DEBUG&&console.log(t.step,"SPVFS[]",r,n),t.fv=l0(n,r)}function jq(t){var e=t.stack,r=t.pv;Ye.DEBUG&&console.log(t.step,"GPV[]"),e.push(r.x*16384),e.push(r.y*16384)}function Fq(t){var e=t.stack,r=t.fv;Ye.DEBUG&&console.log(t.step,"GFV[]"),e.push(r.x*16384),e.push(r.y*16384)}function Bq(t){t.fv=t.pv,Ye.DEBUG&&console.log(t.step,"SFVTPV[]")}function zq(t){var e=t.stack,r=e.pop(),n=e.pop(),i=e.pop(),a=e.pop(),s=e.pop(),o=t.z0,l=t.z1,u=o[r],c=o[n],h=l[i],p=l[a],v=t.z2[s];Ye.DEBUG&&console.log("ISECT[], ",r,n,i,a,s);var y=u.x,S=u.y,w=c.x,T=c.y,_=h.x,C=h.y,N=p.x,A=p.y,I=(y-w)*(C-A)-(S-T)*(_-N),j=y*T-S*w,O=_*A-C*N;v.x=(j*(_-N)-O*(y-w))/I,v.y=(j*(C-A)-O*(S-T))/I}function Uq(t){t.rp0=t.stack.pop(),Ye.DEBUG&&console.log(t.step,"SRP0[]",t.rp0)}function Gq(t){t.rp1=t.stack.pop(),Ye.DEBUG&&console.log(t.step,"SRP1[]",t.rp1)}function Vq(t){t.rp2=t.stack.pop(),Ye.DEBUG&&console.log(t.step,"SRP2[]",t.rp2)}function Hq(t){var e=t.stack.pop();switch(Ye.DEBUG&&console.log(t.step,"SZP0[]",e),t.zp0=e,e){case 0:t.tZone||G1(t),t.z0=t.tZone;break;case 1:t.z0=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function Wq(t){var e=t.stack.pop();switch(Ye.DEBUG&&console.log(t.step,"SZP1[]",e),t.zp1=e,e){case 0:t.tZone||G1(t),t.z1=t.tZone;break;case 1:t.z1=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function qq(t){var e=t.stack.pop();switch(Ye.DEBUG&&console.log(t.step,"SZP2[]",e),t.zp2=e,e){case 0:t.tZone||G1(t),t.z2=t.tZone;break;case 1:t.z2=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function $q(t){var e=t.stack.pop();switch(Ye.DEBUG&&console.log(t.step,"SZPS[]",e),t.zp0=t.zp1=t.zp2=e,e){case 0:t.tZone||G1(t),t.z0=t.z1=t.z2=t.tZone;break;case 1:t.z0=t.z1=t.z2=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function Kq(t){t.loop=t.stack.pop(),Ye.DEBUG&&console.log(t.step,"SLOOP[]",t.loop)}function Zq(t){Ye.DEBUG&&console.log(t.step,"RTG[]"),t.round=vL}function Yq(t){Ye.DEBUG&&console.log(t.step,"RTHG[]"),t.round=Aq}function Xq(t){var e=t.stack.pop();Ye.DEBUG&&console.log(t.step,"SMD[]",e),t.minDis=e/64}function Qq(t){Ye.DEBUG&&console.log(t.step,"ELSE[]"),xL(t,!1)}function Jq(t){var e=t.stack.pop();Ye.DEBUG&&console.log(t.step,"JMPR[]",e),t.ip+=e-1}function e$(t){var e=t.stack.pop();Ye.DEBUG&&console.log(t.step,"SCVTCI[]",e),t.cvCutIn=e/64}function t$(t){var e=t.stack;Ye.DEBUG&&console.log(t.step,"DUP[]"),e.push(e[e.length-1])}function U2(t){Ye.DEBUG&&console.log(t.step,"POP[]"),t.stack.pop()}function r$(t){Ye.DEBUG&&console.log(t.step,"CLEAR[]"),t.stack.length=0}function n$(t){var e=t.stack,r=e.pop(),n=e.pop();Ye.DEBUG&&console.log(t.step,"SWAP[]"),e.push(r),e.push(n)}function i$(t){var e=t.stack;Ye.DEBUG&&console.log(t.step,"DEPTH[]"),e.push(e.length)}function a$(t){var e=t.stack,r=e.pop(),n=e.pop();Ye.DEBUG&&console.log(t.step,"LOOPCALL[]",r,n);var i=t.ip,a=t.prog;t.prog=t.funcs[r];for(var s=0;s<n;s++)bf(t),Ye.DEBUG&&console.log(++t.step,s+1<n?"next loopcall":"done loopcall",s);t.ip=i,t.prog=a}function s$(t){var e=t.stack.pop();Ye.DEBUG&&console.log(t.step,"CALL[]",e);var r=t.ip,n=t.prog;t.prog=t.funcs[e],bf(t),t.ip=r,t.prog=n,Ye.DEBUG&&console.log(++t.step,"returning from",e)}function o$(t){var e=t.stack,r=e.pop();Ye.DEBUG&&console.log(t.step,"CINDEX[]",r),e.push(e[e.length-r])}function l$(t){var e=t.stack,r=e.pop();Ye.DEBUG&&console.log(t.step,"MINDEX[]",r),e.push(e.splice(e.length-r,1)[0])}function u$(t){if(t.env!=="fpgm")throw new Error("FDEF not allowed here");var e=t.stack,r=t.prog,n=t.ip,i=e.pop(),a=n;for(Ye.DEBUG&&console.log(t.step,"FDEF[]",i);r[++n]!==45;);t.ip=n,t.funcs[i]=r.slice(a+1,n)}function Y4(t,e){var r=e.stack.pop(),n=e.z0[r],i=e.fv,a=e.pv;Ye.DEBUG&&console.log(e.step,"MDAP["+t+"]",r);var s=a.distance(n,Av);t&&(s=e.round(s)),i.setRelative(n,Av,s,a),i.touch(n),e.rp0=e.rp1=r}function X4(t,e){var r=e.z2,n=r.length-2,i,a,s;Ye.DEBUG&&console.log(e.step,"IUP["+t.axis+"]");for(var o=0;o<n;o++)i=r[o],!t.touched(i)&&(a=i.prevTouched(t),a!==i&&(s=i.nextTouched(t),a===s&&t.setRelative(i,i,t.distance(a,a,!1,!0),t,!0),t.interpolate(i,a,s,t)))}function Q4(t,e){for(var r=e.stack,n=t?e.rp1:e.rp2,i=(t?e.z0:e.z1)[n],a=e.fv,s=e.pv,o=e.loop,l=e.z2;o--;){var u=r.pop(),c=l[u],h=s.distance(i,i,!1,!0);a.setRelative(c,c,h,s),a.touch(c),Ye.DEBUG&&console.log(e.step,(e.loop>1?"loop "+(e.loop-o)+": ":"")+"SHP["+(t?"rp1":"rp2")+"]",u)}e.loop=1}function J4(t,e){var r=e.stack,n=t?e.rp1:e.rp2,i=(t?e.z0:e.z1)[n],a=e.fv,s=e.pv,o=r.pop(),l=e.z2[e.contours[o]],u=l;Ye.DEBUG&&console.log(e.step,"SHC["+t+"]",o);var c=s.distance(i,i,!1,!0);do u!==i&&a.setRelative(u,u,c,s),u=u.nextPointOnContour;while(u!==l)}function e3(t,e){var r=e.stack,n=t?e.rp1:e.rp2,i=(t?e.z0:e.z1)[n],a=e.fv,s=e.pv,o=r.pop();Ye.DEBUG&&console.log(e.step,"SHZ["+t+"]",o);var l;switch(o){case 0:l=e.tZone;break;case 1:l=e.gZone;break;default:throw new Error("Invalid zone")}for(var u,c=s.distance(i,i,!1,!0),h=l.length-2,p=0;p<h;p++)u=l[p],a.setRelative(u,u,c,s)}function c$(t){for(var e=t.stack,r=t.loop,n=t.fv,i=e.pop()/64,a=t.z2;r--;){var s=e.pop(),o=a[s];Ye.DEBUG&&console.log(t.step,(t.loop>1?"loop "+(t.loop-r)+": ":"")+"SHPIX[]",s,i),n.setRelative(o,o,i),n.touch(o)}t.loop=1}function d$(t){for(var e=t.stack,r=t.rp1,n=t.rp2,i=t.loop,a=t.z0[r],s=t.z1[n],o=t.fv,l=t.dpv,u=t.z2;i--;){var c=e.pop(),h=u[c];Ye.DEBUG&&console.log(t.step,(t.loop>1?"loop "+(t.loop-i)+": ":"")+"IP[]",c,r,"<->",n),o.interpolate(h,a,s,l),o.touch(h)}t.loop=1}function t3(t,e){var r=e.stack,n=r.pop()/64,i=r.pop(),a=e.z1[i],s=e.z0[e.rp0],o=e.fv,l=e.pv;o.setRelative(a,s,n,l),o.touch(a),Ye.DEBUG&&console.log(e.step,"MSIRP["+t+"]",n,i),e.rp1=e.rp0,e.rp2=i,t&&(e.rp0=i)}function h$(t){for(var e=t.stack,r=t.rp0,n=t.z0[r],i=t.loop,a=t.fv,s=t.pv,o=t.z1;i--;){var l=e.pop(),u=o[l];Ye.DEBUG&&console.log(t.step,(t.loop>1?"loop "+(t.loop-i)+": ":"")+"ALIGNRP[]",l),a.setRelative(u,n,0,s),a.touch(u)}t.loop=1}function f$(t){Ye.DEBUG&&console.log(t.step,"RTDG[]"),t.round=Mq}function r3(t,e){var r=e.stack,n=r.pop(),i=r.pop(),a=e.z0[i],s=e.fv,o=e.pv,l=e.cvt[n];Ye.DEBUG&&console.log(e.step,"MIAP["+t+"]",n,"(",l,")",i);var u=o.distance(a,Av);t&&(Math.abs(u-l)<e.cvCutIn&&(u=l),u=e.round(u)),s.setRelative(a,Av,u,o),e.zp0===0&&(a.xo=a.x,a.yo=a.y),s.touch(a),e.rp0=e.rp1=i}function p$(t){var e=t.prog,r=t.ip,n=t.stack,i=e[++r];Ye.DEBUG&&console.log(t.step,"NPUSHB[]",i);for(var a=0;a<i;a++)n.push(e[++r]);t.ip=r}function m$(t){var e=t.ip,r=t.prog,n=t.stack,i=r[++e];Ye.DEBUG&&console.log(t.step,"NPUSHW[]",i);for(var a=0;a<i;a++){var s=r[++e]<<8|r[++e];s&32768&&(s=-((s^65535)+1)),n.push(s)}t.ip=e}function g$(t){var e=t.stack,r=t.store;r||(r=t.store=[]);var n=e.pop(),i=e.pop();Ye.DEBUG&&console.log(t.step,"WS",n,i),r[i]=n}function v$(t){var e=t.stack,r=t.store,n=e.pop();Ye.DEBUG&&console.log(t.step,"RS",n);var i=r&&r[n]||0;e.push(i)}function y$(t){var e=t.stack,r=e.pop(),n=e.pop();Ye.DEBUG&&console.log(t.step,"WCVTP",r,n),t.cvt[n]=r/64}function x$(t){var e=t.stack,r=e.pop();Ye.DEBUG&&console.log(t.step,"RCVT",r),e.push(t.cvt[r]*64)}function n3(t,e){var r=e.stack,n=r.pop(),i=e.z2[n];Ye.DEBUG&&console.log(e.step,"GC["+t+"]",n),r.push(e.dpv.distance(i,Av,t,!1)*64)}function i3(t,e){var r=e.stack,n=r.pop(),i=r.pop(),a=e.z1[n],s=e.z0[i],o=e.dpv.distance(s,a,t,t);Ye.DEBUG&&console.log(e.step,"MD["+t+"]",n,i,"->",o),e.stack.push(Math.round(o*64))}function b$(t){Ye.DEBUG&&console.log(t.step,"MPPEM[]"),t.stack.push(t.ppem)}function w$(t){Ye.DEBUG&&console.log(t.step,"FLIPON[]"),t.autoFlip=!0}function S$(t){var e=t.stack,r=e.pop(),n=e.pop();Ye.DEBUG&&console.log(t.step,"LT[]",r,n),e.push(n<r?1:0)}function k$(t){var e=t.stack,r=e.pop(),n=e.pop();Ye.DEBUG&&console.log(t.step,"LTEQ[]",r,n),e.push(n<=r?1:0)}function _$(t){var e=t.stack,r=e.pop(),n=e.pop();Ye.DEBUG&&console.log(t.step,"GT[]",r,n),e.push(n>r?1:0)}function C$(t){var e=t.stack,r=e.pop(),n=e.pop();Ye.DEBUG&&console.log(t.step,"GTEQ[]",r,n),e.push(n>=r?1:0)}function E$(t){var e=t.stack,r=e.pop(),n=e.pop();Ye.DEBUG&&console.log(t.step,"EQ[]",r,n),e.push(r===n?1:0)}function T$(t){var e=t.stack,r=e.pop(),n=e.pop();Ye.DEBUG&&console.log(t.step,"NEQ[]",r,n),e.push(r!==n?1:0)}function N$(t){var e=t.stack,r=e.pop();Ye.DEBUG&&console.log(t.step,"ODD[]",r),e.push(Math.trunc(r)%2?1:0)}function P$(t){var e=t.stack,r=e.pop();Ye.DEBUG&&console.log(t.step,"EVEN[]",r),e.push(Math.trunc(r)%2?0:1)}function M$(t){var e=t.stack.pop();Ye.DEBUG&&console.log(t.step,"IF[]",e),e||(xL(t,!0),Ye.DEBUG&&console.log(t.step,"EIF[]"))}function A$(t){Ye.DEBUG&&console.log(t.step,"EIF[]")}function R$(t){var e=t.stack,r=e.pop(),n=e.pop();Ye.DEBUG&&console.log(t.step,"AND[]",r,n),e.push(r&&n?1:0)}function L$(t){var e=t.stack,r=e.pop(),n=e.pop();Ye.DEBUG&&console.log(t.step,"OR[]",r,n),e.push(r||n?1:0)}function O$(t){var e=t.stack,r=e.pop();Ye.DEBUG&&console.log(t.step,"NOT[]",r),e.push(r?0:1)}function G2(t,e){var r=e.stack,n=r.pop(),i=e.fv,a=e.pv,s=e.ppem,o=e.deltaBase+(t-1)*16,l=e.deltaShift,u=e.z0;Ye.DEBUG&&console.log(e.step,"DELTAP["+t+"]",n,r);for(var c=0;c<n;c++){var h=r.pop(),p=r.pop(),v=o+((p&240)>>4);if(v===s){var y=(p&15)-8;y>=0&&y++,Ye.DEBUG&&console.log(e.step,"DELTAPFIX",h,"by",y*l);var S=u[h];i.setRelative(S,S,y*l,a)}}}function D$(t){var e=t.stack,r=e.pop();Ye.DEBUG&&console.log(t.step,"SDB[]",r),t.deltaBase=r}function I$(t){var e=t.stack,r=e.pop();Ye.DEBUG&&console.log(t.step,"SDS[]",r),t.deltaShift=Math.pow(.5,r)}function j$(t){var e=t.stack,r=e.pop(),n=e.pop();Ye.DEBUG&&console.log(t.step,"ADD[]",r,n),e.push(n+r)}function F$(t){var e=t.stack,r=e.pop(),n=e.pop();Ye.DEBUG&&console.log(t.step,"SUB[]",r,n),e.push(n-r)}function B$(t){var e=t.stack,r=e.pop(),n=e.pop();Ye.DEBUG&&console.log(t.step,"DIV[]",r,n),e.push(n*64/r)}function z$(t){var e=t.stack,r=e.pop(),n=e.pop();Ye.DEBUG&&console.log(t.step,"MUL[]",r,n),e.push(n*r/64)}function U$(t){var e=t.stack,r=e.pop();Ye.DEBUG&&console.log(t.step,"ABS[]",r),e.push(Math.abs(r))}function G$(t){var e=t.stack,r=e.pop();Ye.DEBUG&&console.log(t.step,"NEG[]",r),e.push(-r)}function V$(t){var e=t.stack,r=e.pop();Ye.DEBUG&&console.log(t.step,"FLOOR[]",r),e.push(Math.floor(r/64)*64)}function H$(t){var e=t.stack,r=e.pop();Ye.DEBUG&&console.log(t.step,"CEILING[]",r),e.push(Math.ceil(r/64)*64)}function yy(t,e){var r=e.stack,n=r.pop();Ye.DEBUG&&console.log(e.step,"ROUND[]"),r.push(e.round(n/64)*64)}function W$(t){var e=t.stack,r=e.pop(),n=e.pop();Ye.DEBUG&&console.log(t.step,"WCVTF[]",r,n),t.cvt[n]=r*t.ppem/t.font.unitsPerEm}function V2(t,e){var r=e.stack,n=r.pop(),i=e.ppem,a=e.deltaBase+(t-1)*16,s=e.deltaShift;Ye.DEBUG&&console.log(e.step,"DELTAC["+t+"]",n,r);for(var o=0;o<n;o++){var l=r.pop(),u=r.pop(),c=a+((u&240)>>4);if(c===i){var h=(u&15)-8;h>=0&&h++;var p=h*s;Ye.DEBUG&&console.log(e.step,"DELTACFIX",l,"by",p),e.cvt[l]+=p}}}function q$(t){var e=t.stack.pop();Ye.DEBUG&&console.log(t.step,"SROUND[]",e),t.round=yL;var r;switch(e&192){case 0:r=.5;break;case 64:r=1;break;case 128:r=2;break;default:throw new Error("invalid SROUND value")}switch(t.srPeriod=r,e&48){case 0:t.srPhase=0;break;case 16:t.srPhase=.25*r;break;case 32:t.srPhase=.5*r;break;case 48:t.srPhase=.75*r;break;default:throw new Error("invalid SROUND value")}e&=15,e===0?t.srThreshold=0:t.srThreshold=(e/8-.5)*r}function $$(t){var e=t.stack.pop();Ye.DEBUG&&console.log(t.step,"S45ROUND[]",e),t.round=yL;var r;switch(e&192){case 0:r=Math.sqrt(2)/2;break;case 64:r=Math.sqrt(2);break;case 128:r=2*Math.sqrt(2);break;default:throw new Error("invalid S45ROUND value")}switch(t.srPeriod=r,e&48){case 0:t.srPhase=0;break;case 16:t.srPhase=.25*r;break;case 32:t.srPhase=.5*r;break;case 48:t.srPhase=.75*r;break;default:throw new Error("invalid S45ROUND value")}e&=15,e===0?t.srThreshold=0:t.srThreshold=(e/8-.5)*r}function K$(t){Ye.DEBUG&&console.log(t.step,"ROFF[]"),t.round=Pq}function Z$(t){Ye.DEBUG&&console.log(t.step,"RUTG[]"),t.round=Rq}function Y$(t){Ye.DEBUG&&console.log(t.step,"RDTG[]"),t.round=Lq}function X$(t){var e=t.stack.pop();Ye.DEBUG&&console.log(t.step,"SCANCTRL[]",e)}function a3(t,e){var r=e.stack,n=r.pop(),i=r.pop(),a=e.z2[n],s=e.z1[i];Ye.DEBUG&&console.log(e.step,"SDPVTL["+t+"]",n,i);var o,l;t?(o=a.y-s.y,l=s.x-a.x):(o=s.x-a.x,l=s.y-a.y),e.dpv=l0(o,l)}function Q$(t){var e=t.stack,r=e.pop(),n=0;Ye.DEBUG&&console.log(t.step,"GETINFO[]",r),r&1&&(n=35),r&32&&(n|=4096),e.push(n)}function J$(t){var e=t.stack,r=e.pop(),n=e.pop(),i=e.pop();Ye.DEBUG&&console.log(t.step,"ROLL[]"),e.push(n),e.push(r),e.push(i)}function eK(t){var e=t.stack,r=e.pop(),n=e.pop();Ye.DEBUG&&console.log(t.step,"MAX[]",r,n),e.push(Math.max(n,r))}function tK(t){var e=t.stack,r=e.pop(),n=e.pop();Ye.DEBUG&&console.log(t.step,"MIN[]",r,n),e.push(Math.min(n,r))}function rK(t){var e=t.stack.pop();Ye.DEBUG&&console.log(t.step,"SCANTYPE[]",e)}function nK(t){var e=t.stack.pop(),r=t.stack.pop();switch(Ye.DEBUG&&console.log(t.step,"INSTCTRL[]",e,r),e){case 1:t.inhibitGridFit=!!r;return;case 2:t.ignoreCvt=!!r;return;default:throw new Error("invalid INSTCTRL[] selector")}}function wd(t,e){var r=e.stack,n=e.prog,i=e.ip;Ye.DEBUG&&console.log(e.step,"PUSHB["+t+"]");for(var a=0;a<t;a++)r.push(n[++i]);e.ip=i}function Sd(t,e){var r=e.ip,n=e.prog,i=e.stack;Ye.DEBUG&&console.log(e.ip,"PUSHW["+t+"]");for(var a=0;a<t;a++){var s=n[++r]<<8|n[++r];s&32768&&(s=-((s^65535)+1)),i.push(s)}e.ip=r}function It(t,e,r,n,i,a){var s=a.stack,o=t&&s.pop(),l=s.pop(),u=a.rp0,c=a.z0[u],h=a.z1[l],p=a.minDis,v=a.fv,y=a.dpv,S,w,T,_;w=S=y.distance(h,c,!0,!0),T=w>=0?1:-1,w=Math.abs(w),t&&(_=a.cvt[o],n&&Math.abs(w-_)<a.cvCutIn&&(w=_)),r&&w<p&&(w=p),n&&(w=a.round(w)),v.setRelative(h,c,T*w,y),v.touch(h),Ye.DEBUG&&console.log(a.step,(t?"MIRP[":"MDRP[")+(e?"M":"m")+(r?">":"_")+(n?"R":"_")+(i===0?"Gr":i===1?"Bl":i===2?"Wh":"")+"]",t?o+"("+a.cvt[o]+","+_+")":"",l,"(d =",S,"->",T*w,")"),a.rp1=a.rp0,a.rp2=l,e&&(a.rp0=l)}pL=[W4.bind(void 0,dc),W4.bind(void 0,_u),q4.bind(void 0,dc),q4.bind(void 0,_u),$4.bind(void 0,dc),$4.bind(void 0,_u),K4.bind(void 0,0),K4.bind(void 0,1),Z4.bind(void 0,0),Z4.bind(void 0,1),Dq,Iq,jq,Fq,Bq,zq,Uq,Gq,Vq,Hq,Wq,qq,$q,Kq,Zq,Yq,Xq,Qq,Jq,e$,void 0,void 0,t$,U2,r$,n$,i$,o$,l$,void 0,void 0,void 0,a$,s$,u$,void 0,Y4.bind(void 0,0),Y4.bind(void 0,1),X4.bind(void 0,dc),X4.bind(void 0,_u),Q4.bind(void 0,0),Q4.bind(void 0,1),J4.bind(void 0,0),J4.bind(void 0,1),e3.bind(void 0,0),e3.bind(void 0,1),c$,d$,t3.bind(void 0,0),t3.bind(void 0,1),h$,f$,r3.bind(void 0,0),r3.bind(void 0,1),p$,m$,g$,v$,y$,x$,n3.bind(void 0,0),n3.bind(void 0,1),void 0,i3.bind(void 0,0),i3.bind(void 0,1),b$,void 0,w$,void 0,void 0,S$,k$,_$,C$,E$,T$,N$,P$,M$,A$,R$,L$,O$,G2.bind(void 0,1),D$,I$,j$,F$,B$,z$,U$,G$,V$,H$,yy.bind(void 0,0),yy.bind(void 0,1),yy.bind(void 0,2),yy.bind(void 0,3),void 0,void 0,void 0,void 0,W$,G2.bind(void 0,2),G2.bind(void 0,3),V2.bind(void 0,1),V2.bind(void 0,2),V2.bind(void 0,3),q$,$$,void 0,void 0,K$,void 0,Z$,Y$,U2,U2,void 0,void 0,void 0,void 0,void 0,X$,a3.bind(void 0,0),a3.bind(void 0,1),Q$,void 0,J$,eK,tK,rK,nK,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,wd.bind(void 0,1),wd.bind(void 0,2),wd.bind(void 0,3),wd.bind(void 0,4),wd.bind(void 0,5),wd.bind(void 0,6),wd.bind(void 0,7),wd.bind(void 0,8),Sd.bind(void 0,1),Sd.bind(void 0,2),Sd.bind(void 0,3),Sd.bind(void 0,4),Sd.bind(void 0,5),Sd.bind(void 0,6),Sd.bind(void 0,7),Sd.bind(void 0,8),It.bind(void 0,0,0,0,0,0),It.bind(void 0,0,0,0,0,1),It.bind(void 0,0,0,0,0,2),It.bind(void 0,0,0,0,0,3),It.bind(void 0,0,0,0,1,0),It.bind(void 0,0,0,0,1,1),It.bind(void 0,0,0,0,1,2),It.bind(void 0,0,0,0,1,3),It.bind(void 0,0,0,1,0,0),It.bind(void 0,0,0,1,0,1),It.bind(void 0,0,0,1,0,2),It.bind(void 0,0,0,1,0,3),It.bind(void 0,0,0,1,1,0),It.bind(void 0,0,0,1,1,1),It.bind(void 0,0,0,1,1,2),It.bind(void 0,0,0,1,1,3),It.bind(void 0,0,1,0,0,0),It.bind(void 0,0,1,0,0,1),It.bind(void 0,0,1,0,0,2),It.bind(void 0,0,1,0,0,3),It.bind(void 0,0,1,0,1,0),It.bind(void 0,0,1,0,1,1),It.bind(void 0,0,1,0,1,2),It.bind(void 0,0,1,0,1,3),It.bind(void 0,0,1,1,0,0),It.bind(void 0,0,1,1,0,1),It.bind(void 0,0,1,1,0,2),It.bind(void 0,0,1,1,0,3),It.bind(void 0,0,1,1,1,0),It.bind(void 0,0,1,1,1,1),It.bind(void 0,0,1,1,1,2),It.bind(void 0,0,1,1,1,3),It.bind(void 0,1,0,0,0,0),It.bind(void 0,1,0,0,0,1),It.bind(void 0,1,0,0,0,2),It.bind(void 0,1,0,0,0,3),It.bind(void 0,1,0,0,1,0),It.bind(void 0,1,0,0,1,1),It.bind(void 0,1,0,0,1,2),It.bind(void 0,1,0,0,1,3),It.bind(void 0,1,0,1,0,0),It.bind(void 0,1,0,1,0,1),It.bind(void 0,1,0,1,0,2),It.bind(void 0,1,0,1,0,3),It.bind(void 0,1,0,1,1,0),It.bind(void 0,1,0,1,1,1),It.bind(void 0,1,0,1,1,2),It.bind(void 0,1,0,1,1,3),It.bind(void 0,1,1,0,0,0),It.bind(void 0,1,1,0,0,1),It.bind(void 0,1,1,0,0,2),It.bind(void 0,1,1,0,0,3),It.bind(void 0,1,1,0,1,0),It.bind(void 0,1,1,0,1,1),It.bind(void 0,1,1,0,1,2),It.bind(void 0,1,1,0,1,3),It.bind(void 0,1,1,1,0,0),It.bind(void 0,1,1,1,0,1),It.bind(void 0,1,1,1,0,2),It.bind(void 0,1,1,1,0,3),It.bind(void 0,1,1,1,1,0),It.bind(void 0,1,1,1,1,1),It.bind(void 0,1,1,1,1,2),It.bind(void 0,1,1,1,1,3)];function gm(t){this.char=t,this.state={},this.activeState=null}function L_(t,e,r){this.contextName=r,this.startIndex=t,this.endOffset=e}function iK(t,e,r){this.contextName=t,this.openRange=null,this.ranges=[],this.checkStart=e,this.checkEnd=r}function Dl(t,e){this.context=t,this.index=e,this.length=t.length,this.current=t[e],this.backtrack=t.slice(0,e),this.lookahead=t.slice(e+1)}function V1(t){this.eventId=t,this.subscribers=[]}function aK(t){var e=this,r=["start","end","next","newToken","contextStart","contextEnd","insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD","updateContextsRanges"];r.forEach(function(i){Object.defineProperty(e.events,i,{value:new V1(i)})}),t&&r.forEach(function(i){var a=t[i];typeof a=="function"&&e.events[i].subscribe(a)});var n=["insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD"];n.forEach(function(i){e.events[i].subscribe(e.updateContextsRanges)})}function gi(t){this.tokens=[],this.registeredContexts={},this.contextCheckers=[],this.events={},this.registeredModifiers=[],aK.call(this,t)}gm.prototype.setState=function(t,e){return this.state[t]=e,this.activeState={key:t,value:this.state[t]},this.activeState};gm.prototype.getState=function(t){return this.state[t]||null};gi.prototype.inboundIndex=function(t){return t>=0&&t<this.tokens.length};gi.prototype.composeRUD=function(t){var e=this,r=!0,n=t.map(function(a){return e[a[0]].apply(e,a.slice(1).concat(r))}),i=function(a){return typeof a=="object"&&a.hasOwnProperty("FAIL")};if(n.every(i))return{FAIL:"composeRUD: one or more operations hasn't completed successfully",report:n.filter(i)};this.dispatch("composeRUD",[n.filter(function(a){return!i(a)})])};gi.prototype.replaceRange=function(t,e,r,n){e=e!==null?e:this.tokens.length;var i=r.every(function(s){return s instanceof gm});if(!isNaN(t)&&this.inboundIndex(t)&&i){var a=this.tokens.splice.apply(this.tokens,[t,e].concat(r));return n||this.dispatch("replaceToken",[t,e,r]),[a,r]}else return{FAIL:"replaceRange: invalid tokens or startIndex."}};gi.prototype.replaceToken=function(t,e,r){if(!isNaN(t)&&this.inboundIndex(t)&&e instanceof gm){var n=this.tokens.splice(t,1,e);return r||this.dispatch("replaceToken",[t,e]),[n[0],e]}else return{FAIL:"replaceToken: invalid token or index."}};gi.prototype.removeRange=function(t,e,r){e=isNaN(e)?this.tokens.length:e;var n=this.tokens.splice(t,e);return r||this.dispatch("removeRange",[n,t,e]),n};gi.prototype.removeToken=function(t,e){if(!isNaN(t)&&this.inboundIndex(t)){var r=this.tokens.splice(t,1);return e||this.dispatch("removeToken",[r,t]),r}else return{FAIL:"removeToken: invalid token index."}};gi.prototype.insertToken=function(t,e,r){var n=t.every(function(i){return i instanceof gm});return n?(this.tokens.splice.apply(this.tokens,[e,0].concat(t)),r||this.dispatch("insertToken",[t,e]),t):{FAIL:"insertToken: invalid token(s)."}};gi.prototype.registerModifier=function(t,e,r){this.events.newToken.subscribe(function(n,i){var a=[n,i],s=e===null||e.apply(this,a)===!0,o=[n,i];if(s){var l=r.apply(this,o);n.setState(t,l)}}),this.registeredModifiers.push(t)};V1.prototype.subscribe=function(t){return typeof t=="function"?this.subscribers.push(t)-1:{FAIL:"invalid '"+this.eventId+"' event handler"}};V1.prototype.unsubscribe=function(t){this.subscribers.splice(t,1)};Dl.prototype.setCurrentIndex=function(t){this.index=t,this.current=this.context[t],this.backtrack=this.context.slice(0,t),this.lookahead=this.context.slice(t+1)};Dl.prototype.get=function(t){switch(!0){case t===0:return this.current;case(t<0&&Math.abs(t)<=this.backtrack.length):return this.backtrack.slice(t)[0];case(t>0&&t<=this.lookahead.length):return this.lookahead[t-1];default:return null}};gi.prototype.rangeToText=function(t){if(t instanceof L_)return this.getRangeTokens(t).map(function(e){return e.char}).join("")};gi.prototype.getText=function(){return this.tokens.map(function(t){return t.char}).join("")};gi.prototype.getContext=function(t){var e=this.registeredContexts[t];return e||null};gi.prototype.on=function(t,e){var r=this.events[t];return r?r.subscribe(e):null};gi.prototype.dispatch=function(t,e){var r=this,n=this.events[t];n instanceof V1&&n.subscribers.forEach(function(i){i.apply(r,e||[])})};gi.prototype.registerContextChecker=function(t,e,r){if(this.getContext(t))return{FAIL:"context name '"+t+"' is already registered."};if(typeof e!="function")return{FAIL:"missing context start check."};if(typeof r!="function")return{FAIL:"missing context end check."};var n=new iK(t,e,r);return this.registeredContexts[t]=n,this.contextCheckers.push(n),n};gi.prototype.getRangeTokens=function(t){var e=t.startIndex+t.endOffset;return[].concat(this.tokens.slice(t.startIndex,e))};gi.prototype.getContextRanges=function(t){var e=this.getContext(t);return e?e.ranges:{FAIL:"context checker '"+t+"' is not registered."}};gi.prototype.resetContextsRanges=function(){var t=this.registeredContexts;for(var e in t)if(t.hasOwnProperty(e)){var r=t[e];r.ranges=[]}};gi.prototype.updateContextsRanges=function(){this.resetContextsRanges();for(var t=this.tokens.map(function(n){return n.char}),e=0;e<t.length;e++){var r=new Dl(t,e);this.runContextCheck(r)}this.dispatch("updateContextsRanges",[this.registeredContexts])};gi.prototype.setEndOffset=function(t,e){var r=this.getContext(e).openRange.startIndex,n=new L_(r,t,e),i=this.getContext(e).ranges;return n.rangeId=e+"."+i.length,i.push(n),this.getContext(e).openRange=null,n};gi.prototype.runContextCheck=function(t){var e=this,r=t.index;this.contextCheckers.forEach(function(n){var i=n.contextName,a=e.getContext(i).openRange;if(!a&&n.checkStart(t)&&(a=new L_(r,null,i),e.getContext(i).openRange=a,e.dispatch("contextStart",[i,r])),a&&n.checkEnd(t)){var s=r-a.startIndex+1,o=e.setEndOffset(s,i);e.dispatch("contextEnd",[i,o])}})};gi.prototype.tokenize=function(t){this.tokens=[],this.resetContextsRanges();var e=Array.from(t);this.dispatch("start");for(var r=0;r<e.length;r++){var n=e[r],i=new Dl(e,r);this.dispatch("next",[i]),this.runContextCheck(i);var a=new gm(n);this.tokens.push(a),this.dispatch("newToken",[a,i])}return this.dispatch("end",[this.tokens]),this.tokens};function Hd(t){return/[\u0600-\u065F\u066A-\u06D2\u06FA-\u06FF]/.test(t)}function bL(t){return/[\u0630\u0690\u0621\u0631\u0661\u0671\u0622\u0632\u0672\u0692\u06C2\u0623\u0673\u0693\u06C3\u0624\u0694\u06C4\u0625\u0675\u0695\u06C5\u06E5\u0676\u0696\u06C6\u0627\u0677\u0697\u06C7\u0648\u0688\u0698\u06C8\u0689\u0699\u06C9\u068A\u06CA\u066B\u068B\u06CB\u068C\u068D\u06CD\u06FD\u068E\u06EE\u06FE\u062F\u068F\u06CF\u06EF]/.test(t)}function th(t){return/[\u0600-\u0605\u060C-\u060E\u0610-\u061B\u061E\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED]/.test(t)}function $y(t){return/[A-z]/.test(t)}function sK(t){return/\s/.test(t)}function yo(t){this.font=t,this.features={}}function Qh(t){this.id=t.id,this.tag=t.tag,this.substitution=t.substitution}function u0(t,e){if(!t)return-1;switch(e.format){case 1:return e.glyphs.indexOf(t);case 2:for(var r=e.ranges,n=0;n<r.length;n++){var i=r[n];if(t>=i.start&&t<=i.end){var a=t-i.start;return i.index+a}}break;default:return-1}return-1}function oK(t,e){var r=u0(t,e.coverage);return r===-1?null:t+e.deltaGlyphId}function lK(t,e){var r=u0(t,e.coverage);return r===-1?null:e.substitute[r]}function H2(t,e){for(var r=[],n=0;n<t.length;n++){var i=t[n],a=e.current;a=Array.isArray(a)?a[0]:a;var s=u0(a,i);s!==-1&&r.push(s)}return r.length!==t.length?-1:r}function uK(t,e){var r=e.inputCoverage.length+e.lookaheadCoverage.length+e.backtrackCoverage.length;if(t.context.length<r)return[];var n=H2(e.inputCoverage,t);if(n===-1)return[];var i=e.inputCoverage.length-1;if(t.lookahead.length<e.lookaheadCoverage.length)return[];for(var a=t.lookahead.slice(i);a.length&&th(a[0].char);)a.shift();var s=new Dl(a,0),o=H2(e.lookaheadCoverage,s),l=[].concat(t.backtrack);for(l.reverse();l.length&&th(l[0].char);)l.shift();if(l.length<e.backtrackCoverage.length)return[];var u=new Dl(l,0),c=H2(e.backtrackCoverage,u),h=n.length===e.inputCoverage.length&&o.length===e.lookaheadCoverage.length&&c.length===e.backtrackCoverage.length,p=[];if(h)for(var v=0;v<e.lookupRecords.length;v++)for(var y=e.lookupRecords[v],S=y.lookupListIndex,w=this.getLookupByIndex(S),T=0;T<w.subtables.length;T++){var _=w.subtables[T],C=this.getLookupMethod(w,_),N=this.getSubstitutionType(w,_);if(N==="12")for(var A=0;A<n.length;A++){var I=t.get(A),j=C(I);j&&p.push(j)}}return p}function cK(t,e){var r=t.current,n=u0(r,e.coverage);if(n===-1)return null;for(var i,a=e.ligatureSets[n],s=0;s<a.length;s++){i=a[s];for(var o=0;o<i.components.length;o++){var l=t.lookahead[o],u=i.components[o];if(l!==u)break;if(o===i.components.length-1)return i}}return null}function dK(t,e){var r=u0(t,e.coverage);return r===-1?null:e.sequences[r]}yo.prototype.getDefaultScriptFeaturesIndexes=function(){for(var t=this.font.tables.gsub.scripts,e=0;e<t.length;e++){var r=t[e];if(r.tag==="DFLT")return r.script.defaultLangSys.featureIndexes}return[]};yo.prototype.getScriptFeaturesIndexes=function(t){var e=this.font.tables;if(!e.gsub)return[];if(!t)return this.getDefaultScriptFeaturesIndexes();for(var r=this.font.tables.gsub.scripts,n=0;n<r.length;n++){var i=r[n];if(i.tag===t&&i.script.defaultLangSys)return i.script.defaultLangSys.featureIndexes;var a=i.langSysRecords;if(a)for(var s=0;s<a.length;s++){var o=a[s];if(o.tag===t){var l=o.langSys;return l.featureIndexes}}}return this.getDefaultScriptFeaturesIndexes()};yo.prototype.mapTagsToFeatures=function(t,e){for(var r={},n=0;n<t.length;n++){var i=t[n].tag,a=t[n].feature;r[i]=a}this.features[e].tags=r};yo.prototype.getScriptFeatures=function(t){var e=this.features[t];if(this.features.hasOwnProperty(t))return e;var r=this.getScriptFeaturesIndexes(t);if(!r)return null;var n=this.font.tables.gsub;return e=r.map(function(i){return n.features[i]}),this.features[t]=e,this.mapTagsToFeatures(e,t),e};yo.prototype.getSubstitutionType=function(t,e){var r=t.lookupType.toString(),n=e.substFormat.toString();return r+n};yo.prototype.getLookupMethod=function(t,e){var r=this,n=this.getSubstitutionType(t,e);switch(n){case"11":return function(i){return oK.apply(r,[i,e])};case"12":return function(i){return lK.apply(r,[i,e])};case"63":return function(i){return uK.apply(r,[i,e])};case"41":return function(i){return cK.apply(r,[i,e])};case"21":return function(i){return dK.apply(r,[i,e])};default:throw new Error("lookupType: "+t.lookupType+" - substFormat: "+e.substFormat+" is not yet supported")}};yo.prototype.lookupFeature=function(t){var e=t.contextParams,r=e.index,n=this.getFeature({tag:t.tag,script:t.script});if(!n)return new Error("font '"+this.font.names.fullName.en+"' doesn't support feature '"+t.tag+"' for script '"+t.script+"'.");for(var i=this.getFeatureLookups(n),a=[].concat(e.context),s=0;s<i.length;s++)for(var o=i[s],l=this.getLookupSubtables(o),u=0;u<l.length;u++){var c=l[u],h=this.getSubstitutionType(o,c),p=this.getLookupMethod(o,c),v=void 0;switch(h){case"11":v=p(e.current),v&&a.splice(r,1,new Qh({id:11,tag:t.tag,substitution:v}));break;case"12":v=p(e.current),v&&a.splice(r,1,new Qh({id:12,tag:t.tag,substitution:v}));break;case"63":v=p(e),Array.isArray(v)&&v.length&&a.splice(r,1,new Qh({id:63,tag:t.tag,substitution:v}));break;case"41":v=p(e),v&&a.splice(r,1,new Qh({id:41,tag:t.tag,substitution:v}));break;case"21":v=p(e.current),v&&a.splice(r,1,new Qh({id:21,tag:t.tag,substitution:v}));break}e=new Dl(a,r),!(Array.isArray(v)&&!v.length)&&(v=null)}return a.length?a:null};yo.prototype.supports=function(t){if(!t.script)return!1;this.getScriptFeatures(t.script);var e=this.features.hasOwnProperty(t.script);if(!t.tag)return e;var r=this.features[t.script].some(function(n){return n.tag===t.tag});return e&&r};yo.prototype.getLookupSubtables=function(t){return t.subtables||null};yo.prototype.getLookupByIndex=function(t){var e=this.font.tables.gsub.lookups;return e[t]||null};yo.prototype.getFeatureLookups=function(t){return t.lookupListIndexes.map(this.getLookupByIndex.bind(this))};yo.prototype.getFeature=function(e){if(!this.font)return{FAIL:"No font was found"};this.features.hasOwnProperty(e.script)||this.getScriptFeatures(e.script);var r=this.features[e.script];return r?r.tags[e.tag]?this.features[e.script].tags[e.tag]:null:{FAIL:"No feature for script "+e.script}};function hK(t){var e=t.current,r=t.get(-1);return r===null&&Hd(e)||!Hd(r)&&Hd(e)}function fK(t){var e=t.get(1);return e===null||!Hd(e)}var pK={startCheck:hK,endCheck:fK};function mK(t){var e=t.current,r=t.get(-1);return(Hd(e)||th(e))&&!Hd(r)}function gK(t){var e=t.get(1);switch(!0){case e===null:return!0;case(!Hd(e)&&!th(e)):var r=sK(e);if(!r)return!0;if(r){var n=!1;if(n=t.lookahead.some(function(i){return Hd(i)||th(i)}),!n)return!0}break;default:return!1}}var vK={startCheck:mK,endCheck:gK};function yK(t,e,r){e[r].setState(t.tag,t.substitution)}function xK(t,e,r){e[r].setState(t.tag,t.substitution)}function bK(t,e,r){t.substitution.forEach(function(n,i){var a=e[r+i];a.setState(t.tag,n)})}function wK(t,e,r){var n=e[r];n.setState(t.tag,t.substitution.ligGlyph);for(var i=t.substitution.components.length,a=0;a<i;a++)n=e[r+a+1],n.setState("deleted",!0)}var s3={11:yK,12:xK,63:bK,41:wK};function O_(t,e,r){t instanceof Qh&&s3[t.id]&&s3[t.id](t,e,r)}function SK(t){for(var e=[].concat(t.backtrack),r=e.length-1;r>=0;r--){var n=e[r],i=bL(n),a=th(n);if(!i&&!a)return!0;if(i)return!1}return!1}function kK(t){if(bL(t.current))return!1;for(var e=0;e<t.lookahead.length;e++){var r=t.lookahead[e],n=th(r);if(!n)return!0}return!1}function _K(t){var e=this,r="arab",n=this.featuresTags[r],i=this.tokenizer.getRangeTokens(t);if(i.length!==1){var a=new Dl(i.map(function(o){return o.getState("glyphIndex")}),0),s=new Dl(i.map(function(o){return o.char}),0);i.forEach(function(o,l){if(!th(o.char)){a.setCurrentIndex(l),s.setCurrentIndex(l);var u=0;SK(s)&&(u|=1),kK(s)&&(u|=2);var c;switch(u){case 1:c="fina";break;case 2:c="init";break;case 3:c="medi";break}if(n.indexOf(c)!==-1){var h=e.query.lookupFeature({tag:c,script:r,contextParams:a});if(h instanceof Error)return console.info(h.message);h.forEach(function(p,v){p instanceof Qh&&(O_(p,i,v),a.context[v]=p.substitution)})}}})}}function o3(t,e){var r=t.map(function(n){return n.activeState.value});return new Dl(r,0)}function CK(t){var e=this,r="arab",n=this.tokenizer.getRangeTokens(t),i=o3(n);i.context.forEach(function(a,s){i.setCurrentIndex(s);var o=e.query.lookupFeature({tag:"rlig",script:r,contextParams:i});o.length&&(o.forEach(function(l){return O_(l,n,s)}),i=o3(n))})}function EK(t){var e=t.current,r=t.get(-1);return r===null&&$y(e)||!$y(r)&&$y(e)}function TK(t){var e=t.get(1);return e===null||!$y(e)}var NK={startCheck:EK,endCheck:TK};function l3(t,e){var r=t.map(function(n){return n.activeState.value});return new Dl(r,0)}function PK(t){var e=this,r="latn",n=this.tokenizer.getRangeTokens(t),i=l3(n);i.context.forEach(function(a,s){i.setCurrentIndex(s);var o=e.query.lookupFeature({tag:"liga",script:r,contextParams:i});o.length&&(o.forEach(function(l){return O_(l,n,s)}),i=l3(n))})}function Bl(t){this.baseDir=t||"ltr",this.tokenizer=new gi,this.featuresTags={}}Bl.prototype.setText=function(t){this.text=t};Bl.prototype.contextChecks={latinWordCheck:NK,arabicWordCheck:pK,arabicSentenceCheck:vK};function W2(t){var e=this.contextChecks[t+"Check"];return this.tokenizer.registerContextChecker(t,e.startCheck,e.endCheck)}function MK(){return W2.call(this,"latinWord"),W2.call(this,"arabicWord"),W2.call(this,"arabicSentence"),this.tokenizer.tokenize(this.text)}function AK(){var t=this,e=this.tokenizer.getContextRanges("arabicSentence");e.forEach(function(r){var n=t.tokenizer.getRangeTokens(r);t.tokenizer.replaceRange(r.startIndex,r.endOffset,n.reverse())})}Bl.prototype.registerFeatures=function(t,e){var r=this,n=e.filter(function(i){return r.query.supports({script:t,tag:i})});this.featuresTags.hasOwnProperty(t)?this.featuresTags[t]=this.featuresTags[t].concat(n):this.featuresTags[t]=n};Bl.prototype.applyFeatures=function(t,e){if(!t)throw new Error("No valid font was provided to apply features");this.query||(this.query=new yo(t));for(var r=0;r<e.length;r++){var n=e[r];this.query.supports({script:n.script})&&this.registerFeatures(n.script,n.tags)}};Bl.prototype.registerModifier=function(t,e,r){this.tokenizer.registerModifier(t,e,r)};function D_(){if(this.tokenizer.registeredModifiers.indexOf("glyphIndex")===-1)throw new Error("glyphIndex modifier is required to apply arabic presentation features.")}function RK(){var t=this,e="arab";if(this.featuresTags.hasOwnProperty(e)){D_.call(this);var r=this.tokenizer.getContextRanges("arabicWord");r.forEach(function(n){_K.call(t,n)})}}function LK(){var t=this,e="arab";if(this.featuresTags.hasOwnProperty(e)){var r=this.featuresTags[e];if(r.indexOf("rlig")!==-1){D_.call(this);var n=this.tokenizer.getContextRanges("arabicWord");n.forEach(function(i){CK.call(t,i)})}}}function OK(){var t=this,e="latn";if(this.featuresTags.hasOwnProperty(e)){var r=this.featuresTags[e];if(r.indexOf("liga")!==-1){D_.call(this);var n=this.tokenizer.getContextRanges("latinWord");n.forEach(function(i){PK.call(t,i)})}}}Bl.prototype.checkContextReady=function(t){return!!this.tokenizer.getContext(t)};Bl.prototype.applyFeaturesToContexts=function(){this.checkContextReady("arabicWord")&&(RK.call(this),LK.call(this)),this.checkContextReady("latinWord")&&OK.call(this),this.checkContextReady("arabicSentence")&&AK.call(this)};Bl.prototype.processText=function(t){(!this.text||this.text!==t)&&(this.setText(t),MK.call(this),this.applyFeaturesToContexts())};Bl.prototype.getBidiText=function(t){return this.processText(t),this.tokenizer.getText()};Bl.prototype.getTextGlyphs=function(t){this.processText(t);for(var e=[],r=0;r<this.tokenizer.tokens.length;r++){var n=this.tokenizer.tokens[r];if(!n.state.deleted){var i=n.activeState.value;e.push(Array.isArray(i)?i[0]:i)}}return e};function Tn(t){t=t||{},t.tables=t.tables||{},t.empty||(Fg(t.familyName,"When creating a new Font object, familyName is required."),Fg(t.styleName,"When creating a new Font object, styleName is required."),Fg(t.unitsPerEm,"When creating a new Font object, unitsPerEm is required."),Fg(t.ascender,"When creating a new Font object, ascender is required."),Fg(t.descender<=0,"When creating a new Font object, negative descender value is required."),this.names={fontFamily:{en:t.familyName||" "},fontSubfamily:{en:t.styleName||" "},fullName:{en:t.fullName||t.familyName+" "+t.styleName},postScriptName:{en:t.postScriptName||(t.familyName+t.styleName).replace(/\s/g,"")},designer:{en:t.designer||" "},designerURL:{en:t.designerURL||" "},manufacturer:{en:t.manufacturer||" "},manufacturerURL:{en:t.manufacturerURL||" "},license:{en:t.license||" "},licenseURL:{en:t.licenseURL||" "},version:{en:t.version||"Version 0.1"},description:{en:t.description||" "},copyright:{en:t.copyright||" "},trademark:{en:t.trademark||" "}},this.unitsPerEm=t.unitsPerEm||1e3,this.ascender=t.ascender,this.descender=t.descender,this.createdTimestamp=t.createdTimestamp,this.tables=Object.assign(t.tables,{os2:Object.assign({usWeightClass:t.weightClass||this.usWeightClasses.MEDIUM,usWidthClass:t.widthClass||this.usWidthClasses.MEDIUM,fsSelection:t.fsSelection||this.fsSelectionValues.REGULAR},t.tables.os2)})),this.supported=!0,this.glyphs=new Cu.GlyphSet(this,t.glyphs||[]),this.encoding=new XR(this),this.position=new s0(this),this.substitution=new vo(this),this.tables=this.tables||{},this._push=null,this._hmtxTableData={},Object.defineProperty(this,"hinting",{get:function(){if(this._hinting)return this._hinting;if(this.outlinesFormat==="truetype")return this._hinting=new gL(this)}})}Tn.prototype.hasChar=function(t){return this.encoding.charToGlyphIndex(t)!==null};Tn.prototype.charToGlyphIndex=function(t){return this.encoding.charToGlyphIndex(t)};Tn.prototype.charToGlyph=function(t){var e=this.charToGlyphIndex(t),r=this.glyphs.get(e);return r||(r=this.glyphs.get(0)),r};Tn.prototype.updateFeatures=function(t){return this.defaultRenderOptions.features.map(function(e){return e.script==="latn"?{script:"latn",tags:e.tags.filter(function(r){return t[r]})}:e})};Tn.prototype.stringToGlyphs=function(t,e){var r=this,n=new Bl,i=function(h){return r.charToGlyphIndex(h.char)};n.registerModifier("glyphIndex",null,i);var a=e?this.updateFeatures(e.features):this.defaultRenderOptions.features;n.applyFeatures(this,a);for(var s=n.getTextGlyphs(t),o=s.length,l=new Array(o),u=this.glyphs.get(0),c=0;c<o;c+=1)l[c]=this.glyphs.get(s[c])||u;return l};Tn.prototype.nameToGlyphIndex=function(t){return this.glyphNames.nameToGlyphIndex(t)};Tn.prototype.nameToGlyph=function(t){var e=this.nameToGlyphIndex(t),r=this.glyphs.get(e);return r||(r=this.glyphs.get(0)),r};Tn.prototype.glyphIndexToName=function(t){return this.glyphNames.glyphIndexToName?this.glyphNames.glyphIndexToName(t):""};Tn.prototype.getKerningValue=function(t,e){t=t.index||t,e=e.index||e;var r=this.position.defaultKerningTables;return r?this.position.getKerningValue(r,t,e):this.kerningPairs[t+","+e]||0};Tn.prototype.defaultRenderOptions={kerning:!0,features:[{script:"arab",tags:["init","medi","fina","rlig"]},{script:"latn",tags:["liga","rlig"]}]};Tn.prototype.forEachGlyph=function(t,e,r,n,i,a){e=e!==void 0?e:0,r=r!==void 0?r:0,n=n!==void 0?n:72,i=Object.assign({},this.defaultRenderOptions,i);var s=1/this.unitsPerEm*n,o=this.stringToGlyphs(t,i),l;if(i.kerning){var u=i.script||this.position.getDefaultScriptName();l=this.position.getKerningTables(u,i.language)}for(var c=0;c<o.length;c+=1){var h=o[c];if(a.call(this,h,e,r,n,i),h.advanceWidth&&(e+=h.advanceWidth*s),i.kerning&&c<o.length-1){var p=l?this.position.getKerningValue(l,h.index,o[c+1].index):this.getKerningValue(h,o[c+1]);e+=p*s}i.letterSpacing?e+=i.letterSpacing*n:i.tracking&&(e+=i.tracking/1e3*n)}return e};Tn.prototype.getPath=function(t,e,r,n,i){var a=new Xi;return this.forEachGlyph(t,e,r,n,i,function(s,o,l,u){var c=s.getPath(o,l,u,i,this);a.extend(c)}),a};Tn.prototype.getPaths=function(t,e,r,n,i){var a=[];return this.forEachGlyph(t,e,r,n,i,function(s,o,l,u){var c=s.getPath(o,l,u,i,this);a.push(c)}),a};Tn.prototype.getAdvanceWidth=function(t,e,r){return this.forEachGlyph(t,0,0,e,r,function(){})};Tn.prototype.draw=function(t,e,r,n,i,a){this.getPath(e,r,n,i,a).draw(t)};Tn.prototype.drawPoints=function(t,e,r,n,i,a){this.forEachGlyph(e,r,n,i,a,function(s,o,l,u){s.drawPoints(t,o,l,u)})};Tn.prototype.drawMetrics=function(t,e,r,n,i,a){this.forEachGlyph(e,r,n,i,a,function(s,o,l,u){s.drawMetrics(t,o,l,u)})};Tn.prototype.getEnglishName=function(t){var e=this.names[t];if(e)return e.en};Tn.prototype.validate=function(){var t=this;function e(n,i){}function r(n){var i=t.getEnglishName(n);i&&i.trim().length>0}r("fontFamily"),r("weightName"),r("manufacturer"),r("copyright"),r("version"),this.unitsPerEm>0};Tn.prototype.toTables=function(){return bq.fontToTable(this)};Tn.prototype.toBuffer=function(){return console.warn("Font.toBuffer is deprecated. Use Font.toArrayBuffer instead."),this.toArrayBuffer()};Tn.prototype.toArrayBuffer=function(){for(var t=this.toTables(),e=t.encode(),r=new ArrayBuffer(e.length),n=new Uint8Array(r),i=0;i<e.length;i++)n[i]=e[i];return r};Tn.prototype.download=function(t){var e=this.getEnglishName("fontFamily"),r=this.getEnglishName("fontSubfamily");t=t||e.replace(/\s/g,"")+"-"+r+".otf";var n=this.toArrayBuffer();if(Sq())if(window.URL=window.URL||window.webkitURL,window.URL){var i=new DataView(n),a=new Blob([i],{type:"font/opentype"}),s=document.createElement("a");s.href=window.URL.createObjectURL(a),s.download=t;var o=document.createEvent("MouseEvents");o.initEvent("click",!0,!1),s.dispatchEvent(o)}else console.warn("Font file could not be downloaded. Try using a different browser.");else{var l=require("fs"),u=kq(n);l.writeFileSync(t,u)}};Tn.prototype.fsSelectionValues={ITALIC:1,UNDERSCORE:2,NEGATIVE:4,OUTLINED:8,STRIKEOUT:16,BOLD:32,REGULAR:64,USER_TYPO_METRICS:128,WWS:256,OBLIQUE:512};Tn.prototype.usWidthClasses={ULTRA_CONDENSED:1,EXTRA_CONDENSED:2,CONDENSED:3,SEMI_CONDENSED:4,MEDIUM:5,SEMI_EXPANDED:6,EXPANDED:7,EXTRA_EXPANDED:8,ULTRA_EXPANDED:9};Tn.prototype.usWeightClasses={THIN:100,EXTRA_LIGHT:200,LIGHT:300,NORMAL:400,MEDIUM:500,SEMI_BOLD:600,BOLD:700,EXTRA_BOLD:800,BLACK:900};var kc=new Array(10);kc[1]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{posFormat:1,coverage:this.parsePointer(We.coverage),value:this.parseValueRecord()};if(r===2)return{posFormat:2,coverage:this.parsePointer(We.coverage),values:this.parseValueRecordList()};pr.assert(!1,"0x"+e.toString(16)+": GPOS lookup type 1 format must be 1 or 2.")};kc[2]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();pr.assert(r===1||r===2,"0x"+e.toString(16)+": GPOS lookup type 2 format must be 1 or 2.");var n=this.parsePointer(We.coverage),i=this.parseUShort(),a=this.parseUShort();if(r===1)return{posFormat:r,coverage:n,valueFormat1:i,valueFormat2:a,pairSets:this.parseList(We.pointer(We.list(function(){return{secondGlyph:this.parseUShort(),value1:this.parseValueRecord(i),value2:this.parseValueRecord(a)}})))};if(r===2){var s=this.parsePointer(We.classDef),o=this.parsePointer(We.classDef),l=this.parseUShort(),u=this.parseUShort();return{posFormat:r,coverage:n,valueFormat1:i,valueFormat2:a,classDef1:s,classDef2:o,class1Count:l,class2Count:u,classRecords:this.parseList(l,We.list(u,function(){return{value1:this.parseValueRecord(i),value2:this.parseValueRecord(a)}}))}}};kc[3]=function(){return{error:"GPOS Lookup 3 not supported"}};kc[4]=function(){return{error:"GPOS Lookup 4 not supported"}};kc[5]=function(){return{error:"GPOS Lookup 5 not supported"}};kc[6]=function(){return{error:"GPOS Lookup 6 not supported"}};kc[7]=function(){return{error:"GPOS Lookup 7 not supported"}};kc[8]=function(){return{error:"GPOS Lookup 8 not supported"}};kc[9]=function(){return{error:"GPOS Lookup 9 not supported"}};new Array(10);const DK=({stageRef:t,layers:e,selectedShapeId:r,onSelectShape:n,onChangeShape:i,tool:a,color:s,strokeWidth:o,lineCap:l,onDrawEnd:u})=>{const c=ie.useRef(!1),[h,p]=nr.useState(null),v=N=>{const A=N.target.getStage(),I=A.getRelativePointerPosition();if(a==="select"){N.target===A&&(n(null),p({x1:I.x,y1:I.y,x2:I.x,y2:I.y}));return}c.current=!0,u("START",{tool:a,pos:I,stroke:s,strokeWidth:o,lineCap:l})},y=N=>{const I=N.target.getStage().getRelativePointerPosition();if(a==="select"&&h){p(j=>({...j,x2:I.x,y2:I.y}));return}c.current&&u("MOVE",{pos:I})},S=N=>{if(a==="select"&&h){const A=Math.min(h.x1,h.x2),I=Math.min(h.y1,h.y2),j=Math.abs(h.x1-h.x2),O=Math.abs(h.y1-h.y2);if(j>5&&O>5){const $=N.target.getStage().find(".shape").filter(Z=>{const D=Z.getClientRect();return D.x>=A&&D.y>=I&&D.x+D.width<=A+j&&D.y+D.height<=I+O});n($.map(Z=>Z.id()))}p(null)}c.current=!1,u("END")},w=ie.useRef(null),[T,_]=nr.useState({width:0,height:0});nr.useLayoutEffect(()=>{const N=()=>{w.current&&_({width:w.current.offsetWidth,height:w.current.offsetHeight})};return window.addEventListener("resize",N),N(),()=>window.removeEventListener("resize",N)},[]);const C=Array.isArray(r);return m.jsxs("div",{ref:w,className:"w-full h-full bg-[#050B0D] relative overflow-hidden flex items-center justify-center",children:[m.jsx("div",{className:"absolute inset-0 opacity-10",style:{backgroundImage:"radial-gradient(#00E5FF 1px, transparent 1px)",backgroundSize:"20px 20px"}}),m.jsxs(IR,{width:T.width,height:T.height,ref:t,onMouseDown:v,onMouseMove:y,onMouseUp:S,className:"bg-black/20 shadow-2xl border border-white/5",children:[e.slice().reverse().map(N=>N.visible&&m.jsx(vx,{children:N.shapes.map(A=>{C?r.includes(A.id):A.id;const I={...A,name:"shape",id:A.id,onClick:()=>a==="select"&&!N.locked&&n(A.id),onTap:()=>a==="select"&&!N.locked&&n(A.id),draggable:a==="select"&&!N.locked,onDragEnd:j=>{i(A.id,{x:j.target.x(),y:j.target.y()})},onTransformEnd:j=>{const O=j.target,F={x:O.x(),y:O.y(),scaleX:O.scaleX(),scaleY:O.scaleY(),rotation:O.rotation()};A.type==="rect"&&(F.width=O.width()*O.scaleX(),F.height=O.height()*O.scaleY(),F.scaleX=1,F.scaleY=1),i(A.id,F)}};return m.jsxs(nr.Fragment,{children:[A.type==="line"&&m.jsx(OR,{...I,lineCap:A.lineCap||"round",lineJoin:A.lineJoin||"round"}),A.type==="path"&&m.jsx(dH,{...I,data:A.data,fill:A.fill||"#00E5FF",stroke:A.stroke||"#00E5FF"}),A.type==="rect"&&m.jsx(yx,{...I}),A.type==="circle"&&m.jsx(lH,{...I})]},A.id)})},N.id)),m.jsxs(vx,{children:[h&&m.jsx(yx,{x:Math.min(h.x1,h.x2),y:Math.min(h.y1,h.y2),width:Math.abs(h.x1-h.x2),height:Math.abs(h.y1-h.y2),fill:"rgba(0, 229, 255, 0.1)",stroke:"#00E5FF",strokeWidth:1,dash:[5,5]}),a==="select"&&r&&m.jsx(IK,{selectedShapeIds:C?r:[r]})]})]})]})},IK=({selectedShapeIds:t})=>{const e=ie.useRef();return ie.useEffect(()=>{if(e.current){const r=e.current.getStage(),n=t.map(i=>r.findOne("#"+i)).filter(Boolean);e.current.nodes(n),e.current.getLayer().batchDraw()}},[t]),m.jsx(DR,{ref:e,boundBoxFunc:(r,n)=>n.width<5||n.height<5?r:n,borderStroke:"#00E5FF",anchorStroke:"#00E5FF",anchorFill:"#050B0D",anchorSize:8})},jK=({tool:t,setTool:e,strokeWidth:r,setStrokeWidth:n,color:i,setColor:a,opacity:s,setOpacity:o,lineCap:l,setLineCap:u,strokeStyle:c,setStrokeStyle:h,layers:p,activeLayerId:v,setActiveLayerId:y,onToggleLayerVisibility:S,onToggleLayerLock:w,onAddLayer:T,onDeleteLayer:_,activeShape:C,onSetProperty:N,onUndo:A,onRedo:I,onClear:j})=>m.jsxs("div",{className:"flex flex-col h-full gap-8 p-6 text-slate-300",children:[m.jsxs("section",{className:"bg-white/5 rounded-2xl p-4 grid grid-cols-4 gap-2",children:[[{id:"select",icon:"near_me",label:"Select"},{id:"brush",icon:"gesture",label:"Brush"},{id:"line",icon:"horizontal_rule",label:"Line"},{id:"rect",icon:"rectangle",label:"Box"},{id:"circle",icon:"circle",label:"Circle"},{id:"eraser",icon:"ink_eraser",label:"Erase"}].map(O=>m.jsx("button",{onClick:()=>e(O.id),className:`aspect-square rounded-xl flex flex-col items-center justify-center gap-1 transition-all ${t===O.id?"bg-primary text-white shadow-[0_0_15px_rgba(0,229,255,0.4)]":"text-slate-400 hover:text-white hover:bg-white/10"}`,title:O.label,children:m.jsx("span",{className:"material-symbols-outlined text-xl",children:O.icon})},O.id)),m.jsx("button",{onClick:A,className:"aspect-square rounded-xl flex items-center justify-center text-slate-500 hover:text-white hover:bg-white/10",title:"Undo",children:m.jsx("span",{className:"material-symbols-outlined text-xl",children:"undo"})}),m.jsx("button",{onClick:I,className:"aspect-square rounded-xl flex items-center justify-center text-slate-500 hover:text-white hover:bg-white/10",title:"Redo",children:m.jsx("span",{className:"material-symbols-outlined text-xl",children:"redo"})}),m.jsx("button",{onClick:j,className:"aspect-square rounded-xl flex items-center justify-center text-slate-500 hover:text-red-400 hover:bg-red-400/10",title:"Clear Canvas",children:m.jsx("span",{className:"material-symbols-outlined text-xl",children:"delete_sweep"})})]}),m.jsxs("section",{className:"space-y-6",children:[m.jsx("h3",{className:"text-xs font-black uppercase tracking-[0.2em] text-primary/60 border-b border-white/5 pb-2",children:"Propiedades"}),m.jsxs("div",{className:"space-y-3",children:[m.jsxs("div",{className:"flex justify-between text-[10px] uppercase font-bold text-slate-500",children:[m.jsx("span",{children:"Grosor de Trazo"}),m.jsxs("span",{children:[r,"px"]})]}),m.jsx("input",{type:"range",min:"1",max:"50",value:r,onChange:O=>n(parseInt(O.target.value)),className:"w-full accent-primary h-1 bg-white/10 rounded-full appearance-none cursor-pointer"})]}),m.jsxs("div",{className:"space-y-3",children:[m.jsxs("div",{className:"flex justify-between text-[10px] uppercase font-bold text-slate-500",children:[m.jsx("span",{children:"Opacidad"}),m.jsxs("span",{children:[Math.round(s*100),"%"]})]}),m.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:s,onChange:O=>o(parseFloat(O.target.value)),className:"w-full accent-primary h-1 bg-white/10 rounded-full appearance-none cursor-pointer"})]}),m.jsxs("div",{className:"space-y-3",children:[m.jsx("span",{className:"text-[10px] uppercase font-bold text-slate-500",children:"Color / Relleno"}),m.jsxs("div",{className:"flex items-center gap-3 p-2 bg-white/5 rounded-lg border border-white/5",children:[m.jsx("input",{type:"color",value:i,onChange:O=>a(O.target.value),className:"size-8 rounded cursor-pointer bg-transparent border-none"}),m.jsx("span",{className:"text-xs font-mono text-primary",children:i})]})]}),m.jsxs("div",{className:"space-y-3",children:[m.jsx("span",{className:"text-[10px] uppercase font-bold text-slate-500",children:"Terminacin (Cap)"}),m.jsx("div",{className:"flex bg-white/5 rounded-lg p-1",children:["butt","round","square"].map(O=>m.jsx("button",{onClick:()=>u(O),className:`flex-1 py-1 rounded text-[10px] uppercase transition-all ${l===O?"bg-primary text-white shadow-lg font-black":"hover:text-white text-slate-500"}`,children:O==="round"?"":O==="square"?"":"|"},O))})]}),m.jsxs("div",{className:"space-y-3",children:[m.jsx("span",{className:"text-[10px] uppercase font-bold text-slate-500",children:"Estilo de Trazo"}),m.jsx("div",{className:"flex bg-white/5 rounded-lg p-1",children:[{id:"linear",label:"Lnea",icon:"segment"},{id:"points",label:"Puntos",icon:"more_horiz"},{id:"quadratic",label:"Curva",icon:"conversion_path"}].map(O=>m.jsx("button",{onClick:()=>h(O.id),className:`flex-1 py-1.5 rounded flex items-center justify-center gap-2 text-[9px] uppercase transition-all ${c===O.id?"bg-primary text-white shadow-lg font-black":"hover:text-white text-slate-500"}`,title:O.label,children:m.jsx("span",{className:"material-symbols-outlined text-xs",children:O.icon})},O.id))})]})]}),m.jsxs("section",{className:"flex-1 flex flex-col min-h-0 space-y-4",children:[m.jsxs("div",{className:"flex items-center justify-between border-b border-white/5 pb-2",children:[m.jsx("h3",{className:"text-xs font-black uppercase tracking-[0.2em] text-primary/60",children:"Capas"}),m.jsx("button",{onClick:T,className:"size-6 flex items-center justify-center rounded bg-white/5 hover:bg-primary hover:text-white transition-colors",title:"Nueva Capa",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"add"})})]}),m.jsx("div",{className:"flex-1 overflow-y-auto space-y-2 pr-2 custom-scrollbar",children:p.slice().reverse().map(O=>m.jsxs("div",{onClick:()=>y(O.id),className:`group flex items-center gap-3 p-3 rounded-lg border transition-all cursor-pointer ${v===O.id?"bg-primary/10 border-primary/50":"bg-white/5 border-transparent hover:border-white/10"}`,children:[m.jsx("button",{onClick:F=>{F.stopPropagation(),S(O.id)},className:`text-slate-500 hover:text-white ${!O.visible&&"opacity-30"}`,children:m.jsx("span",{className:"material-symbols-outlined text-base",children:O.visible?"visibility":"visibility_off"})}),m.jsxs("div",{className:"flex-1 flex flex-col",children:[m.jsx("span",{className:`text-xs font-bold leading-none ${v===O.id?"text-white":"text-slate-400"}`,children:O.name}),m.jsxs("span",{className:"text-[9px] font-black uppercase text-slate-600 mt-1",children:[O.shapes.length," Objetos"]})]}),m.jsxs("div",{className:"flex items-center gap-1",children:[m.jsx("button",{onClick:F=>{F.stopPropagation(),w(O.id)},className:`text-slate-500 hover:text-white p-1 rounded hover:bg-white/5 ${O.locked?"text-red-400 opacity-100":"opacity-0 group-hover:opacity-100"}`,children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:O.locked?"lock":"lock_open"})}),m.jsx("button",{onClick:F=>{F.stopPropagation(),_(O.id)},className:"p-1 text-slate-500 hover:text-red-400 opacity-0 group-hover:opacity-100 rounded hover:bg-white/5",title:"Eliminar Capa",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})})]})]},O.id))})]})]}),FK=({onOpenEditor:t})=>{const{t:e}=bc(),{projectName:r}=Zi(),{setRightPanelMode:n,setRightOpen:i,setRightPanelTitle:a}=jl(),[s,o]=ie.useState("..."),[l,u]=ie.useState({words:0,rules:0,glyphs:0}),[c,h]=ie.useState("..."),[p,v]=ie.useState([]),[y,S]=ie.useState([]),[w,T]=ie.useState(null),[_,C]=ie.useState(""),[N,A]=ie.useState(""),[I,j]=ie.useState("lexicon"),[O,F]=ie.useState(""),[B,$]=ie.useState("MANAGEMENT"),[Z,D]=ie.useState(!1),[H,U]=ie.useState(null),[W,Y]=ie.useState(!1),[Q,ne]=ie.useState(null),[re,q]=ie.useState("CHRONOS_ATLAS_V1"),[te,ae]=ie.useState("ARCHITECT_ID"),[de,ge]=ie.useState("TTF"),[ye,se]=ie.useState(!0),[fe,le]=ie.useState(!0),[pe,me]=ie.useState([{msg:"Inicializando Bfer de Glifos...",type:"info"},{msg:"Sincronizacin de Biblia Activa",type:"success"}]),xe={ALPHABET:{id:"ALPHABET",name:"Alfabeto",desc:"Un smbolo por fonema (consonantes y vocales coordinadas)."},ABJAD:{id:"ABJAD",name:"Abjad",desc:"Consonantes marcadas; las vocales son diacrticos o se infieren (ej: rabe, Hebreo)."},SYLLABARY:{id:"SYLLABARY",name:"Silabario",desc:"Cada smbolo representa una slaba completa (Consonante + Vocal)."},ABUGIDA:{id:"ABUGIDA",name:"Abugida",desc:"Smbolos base para consonantes; las vocales modifican al smbolo base."}},[Se,Ve]=ie.useState(xe.ALPHABET.id),[$e,St]=ie.useState(""),[rt,lt]=ie.useState([]),[De,Le]=ie.useState([]),Qe=(Be,Xe="info")=>{me(ot=>[...ot.slice(-4),{msg:Be,type:Xe}])},[Ce,Fe]=ie.useState(!1),[Ke,mt]=ie.useState(null),[gt,yt]=ie.useState([{id:"layer1",name:"Trazo Principal",visible:!0,locked:!1,shapes:[]},{id:"layer2",name:"Guas",visible:!0,locked:!1,shapes:[]}]),[jt,qt]=ie.useState("layer1"),[wt,ft]=ie.useState(null),[qe,ce]=ie.useState([]),[ve,ke]=ie.useState([]),Te=Be=>{ce(Xe=>[...Xe.slice(-19),gt]),ke([])},Re=()=>{if(qe.length===0)return;const Be=qe[qe.length-1];ce(Xe=>Xe.slice(0,-1)),ke(Xe=>[gt,...Xe]),yt(Be)},Je=()=>{if(ve.length===0)return;const Be=ve[0];ke(Xe=>Xe.slice(1)),ce(Xe=>[...Xe,gt]),yt(Be)},[ze,vt]=ie.useState("brush"),[pt,At]=ie.useState(4),[Ut,Kt]=ie.useState("#00E5FF"),[Ct,Yt]=ie.useState(1),[Xt,Lr]=ie.useState("round"),[ar,mn]=ie.useState("linear"),Wr=nr.useRef(null);ie.useEffect(()=>(bn(),n("LINGUISTICS"),a("Lingstica"),i(!0),()=>{n("NOTES"),a("")}),[]),ie.useEffect(()=>{!wt||Array.isArray(wt)||yt(Be=>{const Xe=Be.map(ot=>({...ot,shapes:ot.shapes.map(Vt=>{if(Vt.id===wt&&(Vt.type==="line"||Vt.type==="brush")){const ir={...Vt};return ar==="points"?(ir.dash=[2,10],delete ir.tension):ar==="quadratic"?(ir.tension=.8,delete ir.dash):(delete ir.dash,delete ir.tension),ir}return Vt})}));return Te(),Xe})},[ar]);const Br=Be=>{if(mt(Be.id),Fe(!0),n("LINGUISTICS"),Be.rawEditorData)try{const ot=JSON.parse(Be.rawEditorData);if(Array.isArray(ot)&&ot.length>0){yt(ot),qt(ot[0].id);return}}catch(ot){console.error("Error parsing rawEditorData:",ot)}const Xe=[];Be.svgPathData&&Xe.push({id:crypto.randomUUID(),type:"path",data:Be.svgPathData,x:0,y:0,stroke:"#00E5FF",strokeWidth:2,fill:null,scaleX:1,scaleY:1}),yt([{id:"layer1",name:"Trazo Principal",visible:!0,locked:!1,shapes:Xe},{id:"layer2",name:"Guas",visible:!0,locked:!1,shapes:[]}]),qt("layer1")},nn=()=>{Fe(!1),mt(null),ft(null)},br=async()=>{if(!Ke||!w)return;const Be=gt.filter(it=>it.visible&&!it.name.toLowerCase().includes("gua")).flatMap(it=>it.shapes);if(Be.length===0){Qe("No hay trazos para guardar","warning");return}let Xe=1/0,ot=1/0,Vt=-1/0,ir=-1/0;const tr=it=>{const sr=it.x||0,yi=it.y||0;if(it.type==="line"&&it.points)for(let On=0;On<it.points.length;On+=2){const Dn=it.points[On]+sr,Ul=it.points[On+1]+yi;Xe=Math.min(Xe,Dn),ot=Math.min(ot,Ul),ir=Math.max(ir,Dn),Vt=Math.max(Vt,Ul)}else if(it.type==="rect")Xe=Math.min(Xe,sr),ot=Math.min(ot,yi),ir=Math.max(ir,sr+(it.width||0)),Vt=Math.max(Vt,yi+(it.height||0));else if(it.type==="circle"){const On=it.radius||0;Xe=Math.min(Xe,sr-On),ot=Math.min(ot,yi-On),ir=Math.max(ir,sr+On),Vt=Math.max(Vt,yi+On)}};if(Be.forEach(tr),Xe===1/0)return;const gr=(Xe+ir)/2,ct=(ot+Vt)/2,mr=Wr.current,Qr=mr.width()/2-gr,Ur=mr.height()/2-ct,Or=gt.map(it=>({...it,shapes:it.shapes.map(sr=>({...sr,x:(sr.x||0)+Qr,y:(sr.y||0)+Ur}))}));let ii="";Be.forEach(it=>{if(it.type==="line"&&it.points&&it.points.length>=4){const sr=(it.x||0)+Qr,yi=(it.y||0)+Ur;ii+=`M ${it.points[0]+sr} ${it.points[1]+yi} `;for(let On=2;On<it.points.length;On+=2)ii+=`L ${it.points[On]+sr} ${it.points[On+1]+yi} `}});try{const it=p.find(yi=>yi.id===Ke)||{lema:"Nuevo Glifo",categoriaGramatical:"GLYPH",definicion:"Glifo dibujado manualmente"};p.some(yi=>yi.id===Ke)?await et.put(`/conlang/${w}/palabra/${Ke}`,{...it,svgPathData:ii,rawEditorData:JSON.stringify(Or)}):await et.post(`/conlang/${w}/palabra`,{...it,id:Ke,svgPathData:ii,rawEditorData:JSON.stringify(Or)}),zi(w),Qe("Glifo guardado y centrado con xito","success")}catch(it){throw console.error("Error saving glyph:",it),Qe("Error al guardar glifo","error"),it}},Tt=Be=>{ne(Be),Y(!0)},zr=async()=>{if(!(!Q||!w))try{await et.delete(`/conlang/${w}/palabra/${Q}`),zi(w),Qe("Palabra eliminada","success"),ne(null),Y(!1)}catch(Be){console.error("Error deleting word:",Be),Qe("Error al eliminar palabra","error")}},Qn=Be=>{U(Be),D(!0)},Ji=async Be=>{if(w)try{Be.isNew?await et.post(`/conlang/${w}/palabra`,Be):await et.put(`/conlang/${w}/palabra/${H.id}`,Be),zi(w),Qe("Cambios sincronizados","success"),D(!1),U(null)}catch(Xe){console.error("Error saving meaning:",Xe),Qe("Error al sincronizar cambios","error")}},Ka=p.filter(Be=>{const Xe=O.toLowerCase(),ot=(Be.lema||"").toLowerCase(),Vt=(Be.traduccionEspanol||Be.definicion||"").toLowerCase();return ot.includes(Xe)||Vt.includes(Xe)}),Rs=(Be,Xe)=>{if(Be==="START"){const ot={id:crypto.randomUUID(),type:ze,stroke:Ut,strokeWidth:pt,opacity:Ct,lineCap:Xt,lineJoin:"round",x:ze==="brush"||ze==="line"?0:Xe.pos.x,y:ze==="brush"||ze==="line"?0:Xe.pos.y};ze==="brush"?(ot.type="line",ot.points=[Xe.pos.x,Xe.pos.y,Xe.pos.x,Xe.pos.y],ar==="points"&&(ot.dash=[2,10]),ar==="quadratic"&&(ot.tension=.8)):ze==="line"?(ot.type="line",ot.points=[Xe.pos.x,Xe.pos.y,Xe.pos.x,Xe.pos.y],ar==="points"&&(ot.dash=[2,10]),ar==="quadratic"&&(ot.tension=.8)):ze==="rect"?(ot.width=0,ot.height=0,ar==="points"&&(ot.dash=[5,5])):ze==="circle"&&(ot.radius=0,ar==="points"&&(ot.dash=[5,5])),yt(Vt=>{const ir=Vt.map(tr=>tr.id===jt?{...tr,shapes:[...tr.shapes,ot]}:tr);return Te(),ir}),ft(ot.id)}else Be==="MOVE"?yt(ot=>ot.map(Vt=>{if(Vt.id===jt){const ir=[...Vt.shapes],tr={...ir[ir.length-1]};if(!tr)return Vt;if(ze==="brush")tr.points=[...tr.points,Xe.pos.x,Xe.pos.y];else if(ze==="line")tr.points=[tr.points[0],tr.points[1],Xe.pos.x,Xe.pos.y];else if(ze==="rect")tr.width=Xe.pos.x-tr.x,tr.height=Xe.pos.y-tr.y;else if(ze==="circle"){const gr=Xe.pos.x-tr.x,ct=Xe.pos.y-tr.y;tr.radius=Math.sqrt(gr*gr+ct*ct)}return ir[ir.length-1]=tr,{...Vt,shapes:ir}}return Vt})):Be==="END"&&Te()},Ln=()=>{const Be={id:crypto.randomUUID()};mt(Be.id);const Xe=crypto.randomUUID();yt([{id:Xe,name:"Capa 1",visible:!0,locked:!1,shapes:[]}]),qt(Xe),Fe(!0),n("LINGUISTICS")},un=(Be,Xe)=>{yt(ot=>ot.map(Vt=>({...Vt,shapes:Vt.shapes.map(ir=>ir.id===Be?{...ir,...Xe}:ir)})))},bn=async()=>{try{const Be=await et.get("/bd/proyecto-activo");o(Be.nombreProyecto);const Xe=await et.get("/conlang/stats");u(Xe);const ot=await et.get("/conlang/lenguas");ot&&ot.length>0&&(h(ot[0].nombre),T(ot[0].id),Jn(ot[0].id),zi(ot[0].id))}catch(Be){console.error("Error loading conlang data:",Be),o("Default Project")}},Jn=async Be=>{try{const Xe=await et.get(`/conlang/${Be}/rules`);S(Xe)}catch(Xe){console.error("Error loading rules:",Xe)}},zi=async Be=>{try{const Xe=await et.get(`/conlang/${Be}/diccionario`);v(Xe),Le(Xe.filter(ot=>["GLYPH","GLYFO","GLIFO"].includes(ot.categoriaGramatical)||ot.svgPathData&&ot.lema.length===1))}catch(Xe){console.error("Error loading lexicon:",Xe)}},vi=async()=>{if(!w)return;const Be=prompt("Enter rule title:");if(!Be)return;const Xe=prompt("Enter rule description:"),ot=prompt("Enter category (Grammar, Syntax, etc.):");try{await et.post(`/conlang/${w}/rules`,{titulo:Be,descripcion:Xe,categoria:ot,status:"IN_PROGRESS"}),Jn(w);const Vt=await et.get("/conlang/stats");u(Vt)}catch(Vt){console.error("Error adding rule:",Vt)}},Jo=Be=>{C(Be);const Xe=Be.split("").map(ot=>{const Vt=De.find(ir=>ir.lema.toLowerCase()===ot.toLowerCase());return Vt?Vt.lema:ot}).join(" ");A(Xe)},el=Be=>{St(Be);const Xe=Be.split("").map(ot=>De.find(ir=>ir.lema.toLowerCase()===ot.toLowerCase())||{lema:ot,placeholder:!0});lt(Xe)},zl=async()=>{if(!(!w||!$e))try{await et.post(`/conlang/${w}/palabra`,{lema:$e,definicion:`Entrada automtica (${new Date().toLocaleDateString()})`,categoriaGramatical:"COMPUESTA"}),zi(w),Qe(`Palabra "${$e}" sincronizada automticamente`,"success")}catch(Be){console.error("Error al guardar automticamente:",Be)}},xo=()=>{const Be=De.map(ot=>ot.unicodeCode).filter(ot=>ot&&ot.startsWith("U+")).map(ot=>parseInt(ot.replace("U+",""),16));return`U+${(Be.length>0?Math.max(...Be)+1:57344).toString(16).toUpperCase()}`},Xr=ie.useRef(null),tl=()=>{Xr.current.click()},fs=async Be=>{const Xe=Be.target.files[0];if(!Xe)return;const ot=new FileReader;ot.onload=async Vt=>{const tr=Vt.target.result.match(/d="([^"]+)"/);if(tr&&tr[1]){const gr=tr[1],ct=xo(),mr=String.fromCharCode(parseInt(ct.replace("U+",""),16));try{await et.post(`/conlang/${w}/palabra`,{lema:mr,categoriaGramatical:"GLYFO",definicion:`Glifo importado (${Xe.name})`,svgPathData:gr,unicodeCode:ct}),zi(w),Qe(`Glifo ${ct} importado con xito`,"success")}catch{Qe("Error al importar glifo","error")}}else alert("SVG invlido para renderizado de glifos.")},ot.readAsText(Xe),Be.target.value=null};return m.jsxs("div",{className:"flex-1 flex flex-col h-full bg-[#050508] text-slate-300 font-sans overflow-hidden",children:[m.jsx("input",{type:"file",ref:Xr,onChange:fs,accept:".svg",className:"hidden"}),m.jsxs("div",{className:"h-16 border-b border-white/5 flex items-center justify-between px-8 bg-black/40",children:[m.jsx("div",{className:"flex items-center gap-4"}),!Ce&&m.jsx("div",{className:"flex bg-white/5 p-1 rounded-xl border border-white/5 backdrop-blur-md",children:[{id:"lexicon",label:e("linguistics.lexicon")},{id:"translator",label:e("linguistics.translator")},{id:"biblia",label:"BIBLIA"}].map(Be=>m.jsx("button",{onClick:()=>j(Be.id),className:`px-6 py-1.5 rounded-lg text-[10px] font-black uppercase tracking-widest transition-all ${I===Be.id?"bg-primary text-white shadow-lg":"text-slate-500 hover:text-slate-300"}`,children:Be.label},Be.id))}),Ce&&m.jsxs("div",{className:"flex items-center gap-3 bg-white/5 p-1 rounded-xl border border-white/5",children:[m.jsxs("button",{onClick:nn,className:"flex items-center gap-2 px-4 py-1.5 rounded-lg text-[10px] font-black uppercase tracking-widest text-red-400 hover:bg-red-400/10 transition-all border border-transparent hover:border-red-400/20",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"close"}),"Descartar"]}),m.jsx("div",{className:"w-px h-4 bg-white/10 mx-1"}),m.jsxs("button",{onClick:async()=>{await br(),nn()},className:"flex items-center gap-2 px-4 py-1.5 rounded-lg text-[10px] font-black uppercase tracking-widest bg-primary text-white shadow-lg hover:shadow-primary/20 transition-all",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"check"}),"Aplicar y Guardar"]})]})]}),m.jsx("main",{className:"flex-1 overflow-y-auto no-scrollbar p-8 lg:p-12 relative flex flex-col",children:Ce?m.jsx("div",{className:"flex-1 flex flex-col h-full relative",children:m.jsx(DK,{stageRef:Wr,layers:gt,selectedShapeId:wt,onSelectShape:ft,onChangeShape:un,tool:ze,color:Ut,strokeWidth:pt,onDrawEnd:Rs})}):I==="lexicon"?m.jsx("div",{className:"max-w-6xl mx-auto w-full animate-in fade-in slide-in-from-bottom-4 duration-700",children:m.jsxs("section",{className:"space-y-8",children:[m.jsxs("div",{className:"flex justify-between items-center px-4",children:[m.jsxs("div",{className:"flex flex-col",children:[m.jsx("h3",{className:"text-3xl font-black text-white tracking-tight italic",children:e("linguistics.lexicon")}),m.jsxs("p",{className:"text-[10px] text-slate-500 font-bold uppercase tracking-widest",children:[l.words," Palabras Mapeadas"]})]}),m.jsx(Yn,{variant:"primary",size:"md",onClick:Ln,icon:"draw",children:"Nuevo Glifo"})]}),m.jsxs(An,{className:"p-0 border-white/5 bg-surface-dark/40 overflow-hidden shadow-2xl rounded-[2.5rem]",children:[m.jsxs("div",{className:"p-6 border-b border-white/5 flex items-center gap-4 bg-black/20",children:[m.jsxs("div",{className:"flex-1 relative",children:[m.jsx("span",{className:"material-symbols-outlined absolute left-4 top-1/2 -translate-y-1/2 text-primary/60 text-lg",children:"search"}),m.jsx("input",{type:"text",placeholder:e("linguistics.search_lexicon"),value:O,onChange:Be=>F(Be.target.value),className:"w-full bg-white/5 border border-white/10 rounded-2xl py-4 pl-12 pr-4 text-xs font-bold text-white focus:ring-1 focus:ring-primary/30 outline-none transition-all placeholder-slate-600"})]}),m.jsx("button",{className:"size-12 rounded-2xl bg-white/5 border border-white/10 flex items-center justify-center text-slate-500 hover:text-white transition-all hover:bg-white/10",children:m.jsx("span",{className:"material-symbols-outlined text-xl",children:"tune"})})]}),m.jsxs("div",{className:"p-8 space-y-2 max-h-[70vh] overflow-y-auto no-scrollbar custom-scrollbar",children:[Ka.map(Be=>m.jsx(BK,{word:Be.lema||Be.palabraOriginal,type:Be.categoriaGramatical,gender:Be.genero,def:Be.definicion||Be.traduccionEspanol,onEdit:()=>Qn(Be),onDelete:()=>Tt(Be.id)},Be.id)),Ka.length===0&&m.jsxs("div",{className:"py-20 flex flex-col items-center justify-center text-slate-600 opacity-20",children:[m.jsx("span",{className:"material-symbols-outlined text-8xl mb-4",children:"menu_book"}),m.jsx("p",{className:"text-[10px] uppercase tracking-[0.5em] font-black",children:O?"No se encontraron resultados":"Flujo de Datos Vaco"})]})]})]})]})}):I==="translator"?m.jsx("div",{className:"max-w-6xl mx-auto w-full animate-in fade-in slide-in-from-bottom-4 duration-700",children:m.jsxs("section",{className:"space-y-8",children:[m.jsxs("div",{className:"flex items-center gap-4 px-4",children:[m.jsx("span",{className:"material-symbols-outlined text-primary text-4xl",children:"sync_alt"}),m.jsx("h3",{className:"text-3xl font-black text-white tracking-tight italic",children:e("linguistics.translator")})]}),m.jsx(An,{className:"p-12 border-primary/20 bg-primary/5 rounded-[3rem] shadow-2xl shadow-primary/5",children:m.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-12 items-center",children:[m.jsxs("div",{className:"space-y-6",children:[m.jsx("label",{className:"text-[10px] font-black uppercase tracking-[0.4em] text-primary opacity-60",children:"Entrada de Origen"}),m.jsx("textarea",{value:_,onChange:Be=>Jo(Be.target.value),placeholder:e("linguistics.source_text"),className:"w-full h-48 bg-black/40 border border-white/10 rounded-[2.5rem] p-8 text-lg font-bold text-white focus:border-primary/50 outline-none transition-all placeholder-slate-800 resize-none"})]}),m.jsxs("div",{className:"space-y-6",children:[m.jsx("label",{className:"text-[10px] font-black uppercase tracking-[0.4em] text-primary opacity-60",children:"Salida Visual"}),m.jsx("div",{className:"h-48 rounded-[2.5rem] bg-black/60 border border-white/5 flex items-center justify-center relative overflow-hidden group shadow-inner",children:m.jsx("span",{className:"text-7xl font-serif text-white opacity-40 group-hover:opacity-100 transition-all duration-1000 whitespace-pre drop-shadow-[0_0_20px_rgba(255,255,255,0.4)]",children:N||"   "})})]})]})})]})}):m.jsxs("section",{className:"max-w-7xl mx-auto w-full animate-in fade-in slide-in-from-bottom-8 duration-1000 flex flex-col gap-12",children:[m.jsxs("div",{className:"flex justify-between items-center px-4",children:[m.jsx("div",{className:"flex flex-col"}),m.jsx("div",{className:"px-6 py-2 rounded bg-[#00E5FF]/10 border border-[#00E5FF]/20 text-[10px] font-black text-[#00E5FF] uppercase tracking-[0.3em] animate-pulse",children:"Bfer de Sincronizacin Listo"})]}),m.jsxs("div",{className:"space-y-12",children:[m.jsxs("section",{className:"space-y-6",children:[m.jsxs("div",{className:"flex items-center justify-between px-2",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("div",{className:"size-2 bg-[#00E5FF] rounded-full shadow-[0_0_10px_#00E5FF]"}),m.jsx("h3",{className:"text-xs font-black uppercase tracking-[0.5em] text-[#00E5FF]/60",children:"Glifos Mapeados"})]}),m.jsxs("div",{className:"flex flex-col gap-3 items-end",children:[m.jsxs("span",{className:"text-[10px] font-bold text-[#00E5FF]/40",children:[De.length," Smbolos Indexados"]}),m.jsxs("div",{className:"flex items-center gap-4 px-6 py-2.5 rounded-2xl bg-black/40 border border-[#00E5FF]/10 backdrop-blur-md",children:[m.jsx("span",{className:"text-[9px] font-black uppercase tracking-[0.2em] text-[#00E5FF]/60 font-mono",children:"Estado del Bfer"}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("span",{className:"text-[10px] font-bold text-white tracking-widest",children:"SINCRONIZADO"}),m.jsx("div",{className:"size-1.5 bg-[#00E5FF] rounded-full shadow-[0_0_10px_#00E5FF] animate-pulse"})]})]})]})]}),m.jsxs("div",{className:"p-10 rounded-[2.5rem] border border-[#00E5FF]/10 bg-[#00E5FF]/[0.02] grid grid-cols-4 md:grid-cols-6 lg:grid-cols-8 gap-6",children:[De.map((Be,Xe)=>m.jsx(zK,{symbol:Be.lema,keyLabel:Be.lema.toUpperCase(),active:!1,onClick:()=>Br(Be)},Be.id||Xe)),m.jsxs("button",{onClick:Ln,className:"aspect-square rounded-2xl border-2 border-dashed border-[#00E5FF]/10 flex flex-col items-center justify-center text-[#00E5FF]/20 hover:text-[#00E5FF] hover:border-[#00E5FF]/40 transition-all cursor-pointer group gap-2",title:"Dibujar Nuevo Glifo",children:[m.jsx("span",{className:"material-symbols-outlined text-3xl group-hover:scale-110 transition-transform",children:"draw"}),m.jsx("span",{className:"text-[8px] font-black uppercase tracking-widest opacity-0 group-hover:opacity-100 transition-opacity",children:"Dibujar"})]}),m.jsxs("button",{onClick:tl,className:"aspect-square rounded-2xl border-2 border-dashed border-[#00E5FF]/10 flex flex-col items-center justify-center text-[#00E5FF]/20 hover:text-[#00E5FF] hover:border-[#00E5FF]/40 transition-all cursor-pointer group gap-2",title:"Importar desde SVG",children:[m.jsx("span",{className:"material-symbols-outlined text-3xl group-hover:scale-110 transition-transform",children:"upload_file"}),m.jsx("span",{className:"text-[8px] font-black uppercase tracking-widest opacity-0 group-hover:opacity-100 transition-opacity",children:"Importar"})]})]})]}),m.jsx("div",{className:"px-10",children:m.jsx("div",{className:"w-full h-[2px] bg-white/5 overflow-hidden rounded-full",children:m.jsx("div",{className:"h-full bg-[#00E5FF] shadow-[0_0_10px_#00E5FF] transition-all duration-1000",style:{width:`${Math.min(100,De.length/26*100)}%`}})})}),m.jsxs("section",{className:"space-y-6",children:[m.jsxs("div",{className:"flex items-center gap-4 px-2",children:[m.jsx("div",{className:"size-2 bg-primary rounded-full shadow-[0_0_10px_#7c3aed] opacity-60"}),m.jsx("h3",{className:"text-xs font-black uppercase tracking-[0.5em] text-primary/60",children:"Compositor de Palabras"})]}),m.jsxs(An,{className:"p-10 border-white/5 bg-black/40 rounded-[2.5rem] space-y-8",children:[m.jsxs("div",{className:"flex gap-8 items-start",children:[m.jsxs("div",{className:"flex-1 space-y-4",children:[m.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-slate-500",children:"Escritura Fontica"}),m.jsx("input",{type:"text",value:$e,onChange:Be=>el(Be.target.value),onBlur:()=>{$e&&zl()},onKeyDown:Be=>{Be.key==="Enter"&&zl()},placeholder:"Escribe para componer...",className:"w-full bg-white/5 border border-white/10 rounded-2xl py-6 px-8 text-2xl font-bold text-white outline-none focus:border-primary/40 transition-all placeholder:text-slate-800"})]}),m.jsxs("div",{className:"mt-10 px-6 py-4 rounded-xl bg-white/5 border border-white/10 flex items-center gap-3",children:[m.jsx("div",{className:"size-2 bg-emerald-500 rounded-full animate-pulse shadow-[0_0_10px_#10b981]"}),m.jsx("span",{className:"text-[9px] font-black uppercase tracking-widest text-slate-400",children:"Auto-Sincronizacin"})]})]}),m.jsxs("div",{className:"space-y-4",children:[m.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-slate-500",children:"Flujo de Renderizado Visual"}),m.jsx("div",{className:"min-h-32 p-8 rounded-2xl bg-black/60 border border-white/5 flex flex-wrap gap-4 items-center justify-center relative group",children:rt.length>0?rt.map((Be,Xe)=>m.jsxs("div",{className:"flex flex-col items-center gap-1",children:[m.jsx("span",{className:`text-5xl font-serif ${Be.placeholder?"text-slate-800 animate-pulse":"text-[#00E5FF] drop-shadow-[0_0_10px_rgba(0,229,255,0.4)]"}`,children:Be.lema}),m.jsx("span",{className:"text-[8px] font-black text-slate-600 uppercase tracking-widest",children:Be.lema})]},Xe)):m.jsx("span",{className:"text-slate-800 font-black uppercase tracking-[0.5em] text-[10px]",children:"Sin glifos detectados"})})]})]})]}),m.jsxs("section",{className:"space-y-6",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("div",{className:"size-2 bg-[#00E5FF] rounded-full shadow-[0_0_10px_#00E5FF] opacity-40"}),m.jsx("h3",{className:"text-xs font-black uppercase tracking-[0.5em] text-[#00E5FF]/60",children:"Previsualizacin de Transmisin"})]}),m.jsxs("div",{className:"h-64 rounded-[2.5rem] border border-[#00E5FF]/10 bg-black/40 flex flex-col p-12 items-center justify-center relative group shadow-inner",children:[m.jsx("div",{className:"absolute top-6 left-8 text-[8px] opacity-20 uppercase tracking-[0.3em] font-black",children:"Estado del Bfer: Activo"}),m.jsx("textarea",{className:"w-full bg-transparent border-none outline-none text-center text-7xl font-bold tracking-widest text-[#00E5FF]/10 group-hover:text-[#00E5FF]/40 transition-all placeholder:text-[#00E5FF]/5 resize-none italic font-serif",placeholder:"..."}),m.jsxs("div",{className:"absolute bottom-6 right-8 flex gap-6 text-[8px] font-black uppercase tracking-widest text-[#00E5FF]/20",children:[m.jsx("span",{children:"Motor_V4"}),m.jsx("span",{children:"ASCII/UTF-8"})]})]})]})]})]})}),Il.createPortal(m.jsx("div",{className:"h-full flex flex-col bg-background relative overflow-hidden",children:Ce?m.jsx(jK,{tool:ze,setTool:vt,strokeWidth:pt,setStrokeWidth:At,color:Ut,setColor:Kt,opacity:Ct,setOpacity:Yt,lineCap:Xt,setLineCap:Lr,strokeStyle:ar,setStrokeStyle:mn,layers:gt,activeLayerId:jt,setActiveLayerId:qt,onToggleLayerVisibility:Be=>yt(Xe=>Xe.map(ot=>ot.id===Be?{...ot,visible:!ot.visible}:ot)),onToggleLayerLock:Be=>yt(Xe=>Xe.map(ot=>ot.id===Be?{...ot,locked:!ot.locked}:ot)),onAddLayer:()=>{const Be=crypto.randomUUID();yt(Xe=>[{id:Be,name:`Capa ${Xe.length+1}`,visible:!0,locked:!1,shapes:[]},...Xe]),qt(Be)},onDeleteLayer:Be=>{gt.length!==1&&yt(Xe=>{const ot=Xe.filter(Vt=>Vt.id!==Be);return jt===Be&&qt(ot[0].id),ot})},activeShape:wt&&!Array.isArray(wt)?gt.flatMap(Be=>Be.shapes).find(Be=>Be.id===wt):null,onUndo:Re,onRedo:Je,onClear:()=>{yt(Be=>Be.map(Xe=>Xe.id===jt?{...Xe,shapes:[]}:Xe)),Qe("Capa limpiada","info")}}):m.jsxs(m.Fragment,{children:[m.jsx("div",{className:"flex border-b border-white/5 bg-surface-dark/50 p-2 gap-1",children:["NOTES","MANAGEMENT"].map(Be=>m.jsx("button",{onClick:()=>$(Be),className:`flex-1 py-2 text-[9px] font-black uppercase tracking-widest transition-all rounded-lg ${B===Be?"bg-primary text-white shadow-lg":"text-text-muted hover:text-white hover:bg-white/5"}`,children:Be==="NOTES"?"NOTAS":"HERRAMIENTAS"},Be))}),m.jsxs("div",{className:"flex-1 overflow-y-auto no-scrollbar custom-scrollbar p-0",children:[B==="NOTES"&&m.jsx("div",{className:"h-full",children:m.jsx(RS,{projectName:r})}),B==="MANAGEMENT"&&m.jsxs("div",{className:"p-4 space-y-8 pb-24 animate-in fade-in slide-in-from-right-4 duration-500",children:[m.jsxs("section",{className:"space-y-4",children:[m.jsxs("div",{className:"flex justify-between items-center px-1",children:[m.jsx("h4",{className:"text-[10px] font-black uppercase tracking-widest text-text-muted",children:"Sistemas de Escritura"}),m.jsx("span",{className:"material-symbols-outlined text-text-muted text-sm",children:"history_edu"})]}),m.jsx("div",{className:"space-y-2",children:Object.values(xe).map(Be=>m.jsxs("button",{onClick:()=>Ve(Be.id),className:`w-full p-3 rounded-xl border text-left transition-all group ${Se===Be.id?"bg-primary/10 border-primary/40":"bg-surface-dark border-white/5 hover:border-white/10"}`,children:[m.jsxs("div",{className:"flex justify-between items-center mb-1",children:[m.jsx("span",{className:`text-[10px] font-black uppercase tracking-widest group-hover:text-primary transition-colors ${Se===Be.id?"text-primary":"text-text-muted"}`,children:Be.name}),Se===Be.id&&m.jsx("div",{className:"size-1.5 rounded-full bg-primary animate-pulse"})]}),m.jsx("p",{className:"text-[9px] text-slate-500 leading-tight",children:Be.desc})]},Be.id))})]}),m.jsxs("section",{className:"space-y-4",children:[m.jsxs("div",{className:"flex justify-between items-center",children:[m.jsx("h4",{className:"text-[10px] font-black uppercase tracking-widest text-text-muted",children:e("linguistics.writing_system")}),m.jsx("button",{onClick:Ln,className:"text-primary hover:text-white transition-colors",title:"Crear Nuevo Glifo",children:m.jsx("span",{className:"material-symbols-outlined text-lg",children:"add_circle"})})]}),m.jsxs("div",{className:"p-4 bg-surface-dark border border-white/5 rounded-2xl",children:[m.jsxs("div",{className:"grid grid-cols-4 gap-2",children:[De.slice(0,12).map(Be=>m.jsx("div",{onClick:()=>Br(Be),className:"aspect-square rounded-lg bg-black/40 border border-white/5 flex items-center justify-center text-xl font-serif text-primary hover:border-primary/40 hover:bg-primary/5 transition-all cursor-pointer",title:Be.lema,children:m.jsx("span",{children:Be.lema})},Be.id)),De.length===0&&m.jsx("div",{className:"col-span-4 py-8 flex items-center justify-center opacity-20",children:m.jsx("span",{className:"text-[8px] font-black uppercase font-mono",children:"Sin Glifos"})})]}),m.jsx("div",{className:"mt-3 text-center",children:m.jsxs("button",{onClick:()=>j("lexicon"),className:"text-[9px] font-bold text-primary hover:underline uppercase tracking-wide",children:["Ver todos (",De.length,")"]})})]})]}),m.jsxs("section",{className:"space-y-4",children:[m.jsxs("div",{className:"flex justify-between items-center",children:[m.jsx("h4",{className:"text-[10px] font-black uppercase tracking-widest text-text-muted",children:e("linguistics.grammar")}),m.jsx("button",{onClick:vi,className:"text-primary hover:text-white transition-colors",children:m.jsx("span",{className:"material-symbols-outlined text-lg",children:"add_circle"})})]}),m.jsxs("div",{className:"space-y-2",children:[y.map(Be=>m.jsxs("div",{className:"p-3 bg-surface-dark border border-white/5 rounded-xl hover:border-primary/30 transition-all cursor-pointer group",children:[m.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[m.jsx("div",{className:`size-1.5 rounded-full ${Be.status==="complete"?"bg-emerald-500":"bg-amber-500"}`}),m.jsx("span",{className:"text-[10px] font-bold text-white group-hover:text-primary transition-colors",children:Be.titulo})]}),m.jsx("p",{className:"text-[9px] text-slate-500 leading-tight line-clamp-2",children:Be.descripcion})]},Be.id)),y.length===0&&m.jsx("p",{className:"text-[9px] text-slate-600 italic px-2",children:"No hay reglas definidas."})]})]})]})]})]})}),document.getElementById("architect-right-panel-portal")),m.jsx(NM,{isOpen:W,onClose:()=>Y(!1),onConfirm:zr,title:"Eliminar Palabra",message:"Ests seguro de que quieres eliminar esta palabra? Esta accin no se puede deshacer.",confirmText:"Eliminar",cancelText:"Cancelar"}),Z&&m.jsx(UK,{word:H,onClose:()=>D(!1),onSave:Ji,onEditSymbol:Be=>{D(!1),Br(Be)}})]})},BK=({word:t,type:e,gender:r,def:n,onEdit:i,onDelete:a})=>m.jsxs("div",{className:"p-4 rounded-2xl border border-transparent hover:bg-white/5 hover:border-white/5 transition-all group cursor-pointer relative",children:[m.jsxs("div",{className:"flex items-center gap-3 mb-1",children:[m.jsx("h4",{className:"text-xl font-manrope font-black text-white group-hover:text-primary transition-colors",children:t}),m.jsxs("div",{className:"flex gap-2",children:[m.jsx("span",{className:"text-[9px] font-bold text-slate-600 italic",children:e}),r&&m.jsxs("span",{className:"text-[9px] font-bold text-slate-700 uppercase",children:["(",r,")"]})]})]}),m.jsx("p",{className:"text-sm text-slate-400 leading-relaxed font-manrope line-clamp-2 pr-16",children:n}),m.jsxs("div",{className:"absolute right-4 top-1/2 -translate-y-1/2 flex gap-1",children:[m.jsx("button",{onClick:s=>{s.stopPropagation(),i?.()},className:"opacity-0 group-hover:opacity-100 transition-opacity p-2 bg-white/5 hover:bg-white/10 rounded-xl text-primary hover:text-white",title:"Editar Significado",children:m.jsx("span",{className:"material-symbols-outlined text-lg",children:"edit"})}),m.jsx("button",{onClick:s=>{s.stopPropagation(),a?.()},className:"opacity-0 group-hover:opacity-100 transition-opacity p-2 bg-white/5 hover:bg-red-400/20 rounded-xl text-slate-600 hover:text-red-400",title:"Eliminar Palabra",children:m.jsx("span",{className:"material-symbols-outlined text-lg",children:"delete"})})]})]}),zK=({symbol:t,keyLabel:e,active:r,onClick:n})=>m.jsxs("div",{onClick:n,className:`aspect-square rounded-2xl border transition-all cursor-pointer flex items-center justify-center relative group ${r?"bg-[#00E5FF]/20 border-[#00E5FF] shadow-[0_0_20px_rgba(0,229,255,0.3)]":"bg-black/40 border-[#00E5FF]/10 hover:border-[#00E5FF]/40"}`,children:[m.jsx("span",{className:`text-4xl font-serif ${r||t?"text-[#00E5FF]":"opacity-20 group-hover:opacity-60 text-white"}`,children:t||"?"}),e&&m.jsx("span",{className:`absolute top-2 right-3 text-[8px] font-black uppercase ${r?"text-[#00E5FF]/80":"opacity-20"}`,children:e})]}),UK=({word:t,onClose:e,onSave:r,onEditSymbol:n})=>{const[i,a]=ie.useState({lema:t?.lema||"",definicion:t?.definicion||t?.traduccionEspanol||"",categoriaGramatical:t?.categoriaGramatical||"Noun",notas:t?.notas||"",isNew:t?.isNew});return m.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-6 bg-black/60 backdrop-blur-sm animate-in fade-in duration-300",children:m.jsxs("div",{className:"w-full max-w-lg bg-[#0A0A0F] border border-white/10 rounded-[2.5rem] overflow-hidden shadow-2xl animate-in zoom-in-95 duration-500",children:[m.jsxs("div",{className:"p-8 border-b border-white/5 bg-white/[0.02] flex justify-between items-center",children:[m.jsxs("div",{className:"flex flex-col",children:[m.jsx("h2",{className:"text-xl font-black text-white italic tracking-tight",children:"Editar Significado"}),m.jsx("p",{className:"text-[10px] text-slate-500 font-bold uppercase tracking-widest",children:"Atributos del Lema"})]}),m.jsx("button",{onClick:e,className:"size-10 rounded-xl bg-white/5 flex items-center justify-center text-slate-500 hover:text-white transition-all",children:m.jsx("span",{className:"material-symbols-outlined",children:"close"})})]}),m.jsxs("div",{className:"p-8 space-y-6",children:[m.jsxs("div",{className:"space-y-2",children:[m.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-slate-600 ml-4",children:"Palabra / Lema"}),m.jsx("input",{type:"text",value:i.lema,onChange:s=>a(o=>({...o,lema:s.target.value})),className:"w-full bg-white/5 border border-white/10 rounded-2xl py-4 px-6 text-white text-sm font-bold focus:border-primary/40 outline-none transition-all"})]}),m.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[m.jsxs("div",{className:"space-y-2",children:[m.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-slate-600 ml-4",children:"Categora"}),m.jsxs("select",{value:i.categoriaGramatical,onChange:s=>a(o=>({...o,categoriaGramatical:s.target.value})),className:"w-full bg-white/5 border border-white/10 rounded-2xl py-4 px-6 text-white text-xs font-bold focus:border-primary/40 outline-none transition-all appearance-none",children:[m.jsx("option",{value:"Noun",children:"Sustantivo"}),m.jsx("option",{value:"Verb",children:"Verbo"}),m.jsx("option",{value:"Adj",children:"Adjetivo"}),m.jsx("option",{value:"Adv",children:"Adverbio"}),m.jsx("option",{value:"Conj",children:"Conjuncin"}),m.jsx("option",{value:"GLYPH",children:"Glifo / Smbolo"}),m.jsx("option",{value:"GLYFO",children:"Glifo / Smbolo (Alt)"}),m.jsx("option",{value:"GLIFO",children:"Glifo / Smbolo (ES)"})]})]}),m.jsx("div",{className:"flex items-end pb-1",children:m.jsxs("button",{onClick:()=>n(t),className:"w-full h-[52px] rounded-2xl border border-primary/20 bg-primary/5 hover:bg-primary/20 text-primary text-[10px] font-black uppercase tracking-widest transition-all flex items-center justify-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"draw"}),"Editar Smbolo"]})})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-slate-600 ml-4",children:"Definicin / Significado"}),m.jsx("textarea",{value:i.definicion,onChange:s=>a(o=>({...o,definicion:s.target.value})),className:"w-full bg-white/5 border border-white/10 rounded-2xl py-4 px-6 text-white text-sm font-bold focus:border-primary/40 outline-none transition-all h-24 resize-none"})]})]}),m.jsxs("div",{className:"p-8 bg-white/[0.02] border-t border-white/5 flex gap-4",children:[m.jsx("button",{onClick:e,className:"flex-1 py-4 rounded-2xl text-[10px] font-black uppercase tracking-widest text-slate-500 hover:text-white transition-all",children:"Cancelar"}),m.jsx("button",{onClick:()=>r(i),className:"flex-1 py-4 rounded-2xl bg-primary text-white text-[10px] font-black uppercase tracking-widest shadow-lg shadow-primary/20 transition-all hover:scale-105",children:"Guardar Cambios"})]})]})})},GK=()=>{const[t,e]=ie.useState("hub"),[r,n]=ie.useState(null),i=a=>{n(a),console.log("Opening editor for",a)};return m.jsx("div",{className:"flex-1 flex flex-col h-full bg-[#050508] overflow-hidden",children:t==="hub"&&m.jsx(FK,{onOpenEditor:i})})};var q2={exports:{}},$2={};var u3;function VK(){if(u3)return $2;u3=1;var t=sm();function e(h,p){return h===p&&(h!==0||1/h===1/p)||h!==h&&p!==p}var r=typeof Object.is=="function"?Object.is:e,n=t.useState,i=t.useEffect,a=t.useLayoutEffect,s=t.useDebugValue;function o(h,p){var v=p(),y=n({inst:{value:v,getSnapshot:p}}),S=y[0].inst,w=y[1];return a(function(){S.value=v,S.getSnapshot=p,l(S)&&w({inst:S})},[h,v,p]),i(function(){return l(S)&&w({inst:S}),h(function(){l(S)&&w({inst:S})})},[h]),s(v),v}function l(h){var p=h.getSnapshot;h=h.value;try{var v=p();return!r(h,v)}catch{return!0}}function u(h,p){return p()}var c=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?u:o;return $2.useSyncExternalStore=t.useSyncExternalStore!==void 0?t.useSyncExternalStore:c,$2}var c3;function wL(){return c3||(c3=1,q2.exports=VK()),q2.exports}var SL=wL();function Ba(t){this.content=t}Ba.prototype={constructor:Ba,find:function(t){for(var e=0;e<this.content.length;e+=2)if(this.content[e]===t)return e;return-1},get:function(t){var e=this.find(t);return e==-1?void 0:this.content[e+1]},update:function(t,e,r){var n=r&&r!=t?this.remove(r):this,i=n.find(t),a=n.content.slice();return i==-1?a.push(r||t,e):(a[i+1]=e,r&&(a[i]=r)),new Ba(a)},remove:function(t){var e=this.find(t);if(e==-1)return this;var r=this.content.slice();return r.splice(e,2),new Ba(r)},addToStart:function(t,e){return new Ba([t,e].concat(this.remove(t).content))},addToEnd:function(t,e){var r=this.remove(t).content.slice();return r.push(t,e),new Ba(r)},addBefore:function(t,e,r){var n=this.remove(e),i=n.content.slice(),a=n.find(t);return i.splice(a==-1?i.length:a,0,e,r),new Ba(i)},forEach:function(t){for(var e=0;e<this.content.length;e+=2)t(this.content[e],this.content[e+1])},prepend:function(t){return t=Ba.from(t),t.size?new Ba(t.content.concat(this.subtract(t).content)):this},append:function(t){return t=Ba.from(t),t.size?new Ba(this.subtract(t).content.concat(t.content)):this},subtract:function(t){var e=this;t=Ba.from(t);for(var r=0;r<t.content.length;r+=2)e=e.remove(t.content[r]);return e},toObject:function(){var t={};return this.forEach(function(e,r){t[e]=r}),t},get size(){return this.content.length>>1}};Ba.from=function(t){if(t instanceof Ba)return t;var e=[];if(t)for(var r in t)e.push(r,t[r]);return new Ba(e)};function kL(t,e,r){for(let n=0;;n++){if(n==t.childCount||n==e.childCount)return t.childCount==e.childCount?null:r;let i=t.child(n),a=e.child(n);if(i==a){r+=i.nodeSize;continue}if(!i.sameMarkup(a))return r;if(i.isText&&i.text!=a.text){for(let s=0;i.text[s]==a.text[s];s++)r++;return r}if(i.content.size||a.content.size){let s=kL(i.content,a.content,r+1);if(s!=null)return s}r+=i.nodeSize}}function _L(t,e,r,n){for(let i=t.childCount,a=e.childCount;;){if(i==0||a==0)return i==a?null:{a:r,b:n};let s=t.child(--i),o=e.child(--a),l=s.nodeSize;if(s==o){r-=l,n-=l;continue}if(!s.sameMarkup(o))return{a:r,b:n};if(s.isText&&s.text!=o.text){let u=0,c=Math.min(s.text.length,o.text.length);for(;u<c&&s.text[s.text.length-u-1]==o.text[o.text.length-u-1];)u++,r--,n--;return{a:r,b:n}}if(s.content.size||o.content.size){let u=_L(s.content,o.content,r-1,n-1);if(u)return u}r-=l,n-=l}}class at{constructor(e,r){if(this.content=e,this.size=r||0,r==null)for(let n=0;n<e.length;n++)this.size+=e[n].nodeSize}nodesBetween(e,r,n,i=0,a){for(let s=0,o=0;o<r;s++){let l=this.content[s],u=o+l.nodeSize;if(u>e&&n(l,i+o,a||null,s)!==!1&&l.content.size){let c=o+1;l.nodesBetween(Math.max(0,e-c),Math.min(l.content.size,r-c),n,i+c)}o=u}}descendants(e){this.nodesBetween(0,this.size,e)}textBetween(e,r,n,i){let a="",s=!0;return this.nodesBetween(e,r,(o,l)=>{let u=o.isText?o.text.slice(Math.max(e,l)-l,r-l):o.isLeaf?i?typeof i=="function"?i(o):i:o.type.spec.leafText?o.type.spec.leafText(o):"":"";o.isBlock&&(o.isLeaf&&u||o.isTextblock)&&n&&(s?s=!1:a+=n),a+=u},0),a}append(e){if(!e.size)return this;if(!this.size)return e;let r=this.lastChild,n=e.firstChild,i=this.content.slice(),a=0;for(r.isText&&r.sameMarkup(n)&&(i[i.length-1]=r.withText(r.text+n.text),a=1);a<e.content.length;a++)i.push(e.content[a]);return new at(i,this.size+e.size)}cut(e,r=this.size){if(e==0&&r==this.size)return this;let n=[],i=0;if(r>e)for(let a=0,s=0;s<r;a++){let o=this.content[a],l=s+o.nodeSize;l>e&&((s<e||l>r)&&(o.isText?o=o.cut(Math.max(0,e-s),Math.min(o.text.length,r-s)):o=o.cut(Math.max(0,e-s-1),Math.min(o.content.size,r-s-1))),n.push(o),i+=o.nodeSize),s=l}return new at(n,i)}cutByIndex(e,r){return e==r?at.empty:e==0&&r==this.content.length?this:new at(this.content.slice(e,r))}replaceChild(e,r){let n=this.content[e];if(n==r)return this;let i=this.content.slice(),a=this.size+r.nodeSize-n.nodeSize;return i[e]=r,new at(i,a)}addToStart(e){return new at([e].concat(this.content),this.size+e.nodeSize)}addToEnd(e){return new at(this.content.concat(e),this.size+e.nodeSize)}eq(e){if(this.content.length!=e.content.length)return!1;for(let r=0;r<this.content.length;r++)if(!this.content[r].eq(e.content[r]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(e){let r=this.content[e];if(!r)throw new RangeError("Index "+e+" out of range for "+this);return r}maybeChild(e){return this.content[e]||null}forEach(e){for(let r=0,n=0;r<this.content.length;r++){let i=this.content[r];e(i,n,r),n+=i.nodeSize}}findDiffStart(e,r=0){return kL(this,e,r)}findDiffEnd(e,r=this.size,n=e.size){return _L(this,e,r,n)}findIndex(e){if(e==0)return xy(0,e);if(e==this.size)return xy(this.content.length,e);if(e>this.size||e<0)throw new RangeError(`Position ${e} outside of fragment (${this})`);for(let r=0,n=0;;r++){let i=this.child(r),a=n+i.nodeSize;if(a>=e)return a==e?xy(r+1,a):xy(r,n);n=a}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(e=>e.toJSON()):null}static fromJSON(e,r){if(!r)return at.empty;if(!Array.isArray(r))throw new RangeError("Invalid input for Fragment.fromJSON");return new at(r.map(e.nodeFromJSON))}static fromArray(e){if(!e.length)return at.empty;let r,n=0;for(let i=0;i<e.length;i++){let a=e[i];n+=a.nodeSize,i&&a.isText&&e[i-1].sameMarkup(a)?(r||(r=e.slice(0,i)),r[r.length-1]=a.withText(r[r.length-1].text+a.text)):r&&r.push(a)}return new at(r||e,n)}static from(e){if(!e)return at.empty;if(e instanceof at)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new at([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}at.empty=new at([],0);const K2={index:0,offset:0};function xy(t,e){return K2.index=t,K2.offset=e,K2}function Cx(t,e){if(t===e)return!0;if(!(t&&typeof t=="object")||!(e&&typeof e=="object"))return!1;let r=Array.isArray(t);if(Array.isArray(e)!=r)return!1;if(r){if(t.length!=e.length)return!1;for(let n=0;n<t.length;n++)if(!Cx(t[n],e[n]))return!1}else{for(let n in t)if(!(n in e)||!Cx(t[n],e[n]))return!1;for(let n in e)if(!(n in t))return!1}return!0}let yn=class uk{constructor(e,r){this.type=e,this.attrs=r}addToSet(e){let r,n=!1;for(let i=0;i<e.length;i++){let a=e[i];if(this.eq(a))return e;if(this.type.excludes(a.type))r||(r=e.slice(0,i));else{if(a.type.excludes(this.type))return e;!n&&a.type.rank>this.type.rank&&(r||(r=e.slice(0,i)),r.push(this),n=!0),r&&r.push(a)}}return r||(r=e.slice()),n||r.push(this),r}removeFromSet(e){for(let r=0;r<e.length;r++)if(this.eq(e[r]))return e.slice(0,r).concat(e.slice(r+1));return e}isInSet(e){for(let r=0;r<e.length;r++)if(this.eq(e[r]))return!0;return!1}eq(e){return this==e||this.type==e.type&&Cx(this.attrs,e.attrs)}toJSON(){let e={type:this.type.name};for(let r in this.attrs){e.attrs=this.attrs;break}return e}static fromJSON(e,r){if(!r)throw new RangeError("Invalid input for Mark.fromJSON");let n=e.marks[r.type];if(!n)throw new RangeError(`There is no mark type ${r.type} in this schema`);let i=n.create(r.attrs);return n.checkAttrs(i.attrs),i}static sameSet(e,r){if(e==r)return!0;if(e.length!=r.length)return!1;for(let n=0;n<e.length;n++)if(!e[n].eq(r[n]))return!1;return!0}static setFrom(e){if(!e||Array.isArray(e)&&e.length==0)return uk.none;if(e instanceof uk)return[e];let r=e.slice();return r.sort((n,i)=>n.type.rank-i.type.rank),r}};yn.none=[];class Ex extends Error{}class Mt{constructor(e,r,n){this.content=e,this.openStart=r,this.openEnd=n}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(e,r){let n=EL(this.content,e+this.openStart,r);return n&&new Mt(n,this.openStart,this.openEnd)}removeBetween(e,r){return new Mt(CL(this.content,e+this.openStart,r+this.openStart),this.openStart,this.openEnd)}eq(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e}static fromJSON(e,r){if(!r)return Mt.empty;let n=r.openStart||0,i=r.openEnd||0;if(typeof n!="number"||typeof i!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new Mt(at.fromJSON(e,r.content),n,i)}static maxOpen(e,r=!0){let n=0,i=0;for(let a=e.firstChild;a&&!a.isLeaf&&(r||!a.type.spec.isolating);a=a.firstChild)n++;for(let a=e.lastChild;a&&!a.isLeaf&&(r||!a.type.spec.isolating);a=a.lastChild)i++;return new Mt(e,n,i)}}Mt.empty=new Mt(at.empty,0,0);function CL(t,e,r){let{index:n,offset:i}=t.findIndex(e),a=t.maybeChild(n),{index:s,offset:o}=t.findIndex(r);if(i==e||a.isText){if(o!=r&&!t.child(s).isText)throw new RangeError("Removing non-flat range");return t.cut(0,e).append(t.cut(r))}if(n!=s)throw new RangeError("Removing non-flat range");return t.replaceChild(n,a.copy(CL(a.content,e-i-1,r-i-1)))}function EL(t,e,r,n){let{index:i,offset:a}=t.findIndex(e),s=t.maybeChild(i);if(a==e||s.isText)return n&&!n.canReplace(i,i,r)?null:t.cut(0,e).append(r).append(t.cut(e));let o=EL(s.content,e-a-1,r,s);return o&&t.replaceChild(i,s.copy(o))}function HK(t,e,r){if(r.openStart>t.depth)throw new Ex("Inserted content deeper than insertion position");if(t.depth-r.openStart!=e.depth-r.openEnd)throw new Ex("Inconsistent open depths");return TL(t,e,r,0)}function TL(t,e,r,n){let i=t.index(n),a=t.node(n);if(i==e.index(n)&&n<t.depth-r.openStart){let s=TL(t,e,r,n+1);return a.copy(a.content.replaceChild(i,s))}else if(r.content.size)if(!r.openStart&&!r.openEnd&&t.depth==n&&e.depth==n){let s=t.parent,o=s.content;return lf(s,o.cut(0,t.parentOffset).append(r.content).append(o.cut(e.parentOffset)))}else{let{start:s,end:o}=WK(r,t);return lf(a,PL(t,s,o,e,n))}else return lf(a,Tx(t,e,n))}function NL(t,e){if(!e.type.compatibleContent(t.type))throw new Ex("Cannot join "+e.type.name+" onto "+t.type.name)}function ck(t,e,r){let n=t.node(r);return NL(n,e.node(r)),n}function of(t,e){let r=e.length-1;r>=0&&t.isText&&t.sameMarkup(e[r])?e[r]=t.withText(e[r].text+t.text):e.push(t)}function nv(t,e,r,n){let i=(e||t).node(r),a=0,s=e?e.index(r):i.childCount;t&&(a=t.index(r),t.depth>r?a++:t.textOffset&&(of(t.nodeAfter,n),a++));for(let o=a;o<s;o++)of(i.child(o),n);e&&e.depth==r&&e.textOffset&&of(e.nodeBefore,n)}function lf(t,e){return t.type.checkContent(e),t.copy(e)}function PL(t,e,r,n,i){let a=t.depth>i&&ck(t,e,i+1),s=n.depth>i&&ck(r,n,i+1),o=[];return nv(null,t,i,o),a&&s&&e.index(i)==r.index(i)?(NL(a,s),of(lf(a,PL(t,e,r,n,i+1)),o)):(a&&of(lf(a,Tx(t,e,i+1)),o),nv(e,r,i,o),s&&of(lf(s,Tx(r,n,i+1)),o)),nv(n,null,i,o),new at(o)}function Tx(t,e,r){let n=[];if(nv(null,t,r,n),t.depth>r){let i=ck(t,e,r+1);of(lf(i,Tx(t,e,r+1)),n)}return nv(e,null,r,n),new at(n)}function WK(t,e){let r=e.depth-t.openStart,i=e.node(r).copy(t.content);for(let a=r-1;a>=0;a--)i=e.node(a).copy(at.from(i));return{start:i.resolveNoCache(t.openStart+r),end:i.resolveNoCache(i.content.size-t.openEnd-r)}}class Rv{constructor(e,r,n){this.pos=e,this.path=r,this.parentOffset=n,this.depth=r.length/3-1}resolveDepth(e){return e==null?this.depth:e<0?this.depth+e:e}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(e){return this.path[this.resolveDepth(e)*3]}index(e){return this.path[this.resolveDepth(e)*3+1]}indexAfter(e){return e=this.resolveDepth(e),this.index(e)+(e==this.depth&&!this.textOffset?0:1)}start(e){return e=this.resolveDepth(e),e==0?0:this.path[e*3-1]+1}end(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size}before(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]}after(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]+this.path[e*3].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let e=this.parent,r=this.index(this.depth);if(r==e.childCount)return null;let n=this.pos-this.path[this.path.length-1],i=e.child(r);return n?e.child(r).cut(n):i}get nodeBefore(){let e=this.index(this.depth),r=this.pos-this.path[this.path.length-1];return r?this.parent.child(e).cut(0,r):e==0?null:this.parent.child(e-1)}posAtIndex(e,r){r=this.resolveDepth(r);let n=this.path[r*3],i=r==0?0:this.path[r*3-1]+1;for(let a=0;a<e;a++)i+=n.child(a).nodeSize;return i}marks(){let e=this.parent,r=this.index();if(e.content.size==0)return yn.none;if(this.textOffset)return e.child(r).marks;let n=e.maybeChild(r-1),i=e.maybeChild(r);if(!n){let o=n;n=i,i=o}let a=n.marks;for(var s=0;s<a.length;s++)a[s].type.spec.inclusive===!1&&(!i||!a[s].isInSet(i.marks))&&(a=a[s--].removeFromSet(a));return a}marksAcross(e){let r=this.parent.maybeChild(this.index());if(!r||!r.isInline)return null;let n=r.marks,i=e.parent.maybeChild(e.index());for(var a=0;a<n.length;a++)n[a].type.spec.inclusive===!1&&(!i||!n[a].isInSet(i.marks))&&(n=n[a--].removeFromSet(n));return n}sharedDepth(e){for(let r=this.depth;r>0;r--)if(this.start(r)<=e&&this.end(r)>=e)return r;return 0}blockRange(e=this,r){if(e.pos<this.pos)return e.blockRange(this);for(let n=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);n>=0;n--)if(e.pos<=this.end(n)&&(!r||r(this.node(n))))return new Nx(this,e,n);return null}sameParent(e){return this.pos-this.parentOffset==e.pos-e.parentOffset}max(e){return e.pos>this.pos?e:this}min(e){return e.pos<this.pos?e:this}toString(){let e="";for(let r=1;r<=this.depth;r++)e+=(e?"/":"")+this.node(r).type.name+"_"+this.index(r-1);return e+":"+this.parentOffset}static resolve(e,r){if(!(r>=0&&r<=e.content.size))throw new RangeError("Position "+r+" out of range");let n=[],i=0,a=r;for(let s=e;;){let{index:o,offset:l}=s.content.findIndex(a),u=a-l;if(n.push(s,o,i+l),!u||(s=s.child(o),s.isText))break;a=u-1,i+=l+1}return new Rv(r,n,a)}static resolveCached(e,r){let n=d3.get(e);if(n)for(let a=0;a<n.elts.length;a++){let s=n.elts[a];if(s.pos==r)return s}else d3.set(e,n=new qK);let i=n.elts[n.i]=Rv.resolve(e,r);return n.i=(n.i+1)%$K,i}}class qK{constructor(){this.elts=[],this.i=0}}const $K=12,d3=new WeakMap;class Nx{constructor(e,r,n){this.$from=e,this.$to=r,this.depth=n}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}const KK=Object.create(null);class qo{constructor(e,r,n,i=yn.none){this.type=e,this.attrs=r,this.marks=i,this.content=n||at.empty}get children(){return this.content.content}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(e){return this.content.child(e)}maybeChild(e){return this.content.maybeChild(e)}forEach(e){this.content.forEach(e)}nodesBetween(e,r,n,i=0){this.content.nodesBetween(e,r,n,i,this)}descendants(e){this.nodesBetween(0,this.content.size,e)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(e,r,n,i){return this.content.textBetween(e,r,n,i)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)}sameMarkup(e){return this.hasMarkup(e.type,e.attrs,e.marks)}hasMarkup(e,r,n){return this.type==e&&Cx(this.attrs,r||e.defaultAttrs||KK)&&yn.sameSet(this.marks,n||yn.none)}copy(e=null){return e==this.content?this:new qo(this.type,this.attrs,e,this.marks)}mark(e){return e==this.marks?this:new qo(this.type,this.attrs,this.content,e)}cut(e,r=this.content.size){return e==0&&r==this.content.size?this:this.copy(this.content.cut(e,r))}slice(e,r=this.content.size,n=!1){if(e==r)return Mt.empty;let i=this.resolve(e),a=this.resolve(r),s=n?0:i.sharedDepth(r),o=i.start(s),u=i.node(s).content.cut(i.pos-o,a.pos-o);return new Mt(u,i.depth-s,a.depth-s)}replace(e,r,n){return HK(this.resolve(e),this.resolve(r),n)}nodeAt(e){for(let r=this;;){let{index:n,offset:i}=r.content.findIndex(e);if(r=r.maybeChild(n),!r)return null;if(i==e||r.isText)return r;e-=i+1}}childAfter(e){let{index:r,offset:n}=this.content.findIndex(e);return{node:this.content.maybeChild(r),index:r,offset:n}}childBefore(e){if(e==0)return{node:null,index:0,offset:0};let{index:r,offset:n}=this.content.findIndex(e);if(n<e)return{node:this.content.child(r),index:r,offset:n};let i=this.content.child(r-1);return{node:i,index:r-1,offset:n-i.nodeSize}}resolve(e){return Rv.resolveCached(this,e)}resolveNoCache(e){return Rv.resolve(this,e)}rangeHasMark(e,r,n){let i=!1;return r>e&&this.nodesBetween(e,r,a=>(n.isInSet(a.marks)&&(i=!0),!i)),i}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),ML(this.marks,e)}contentMatchAt(e){let r=this.type.contentMatch.matchFragment(this.content,0,e);if(!r)throw new Error("Called contentMatchAt on a node with invalid content");return r}canReplace(e,r,n=at.empty,i=0,a=n.childCount){let s=this.contentMatchAt(e).matchFragment(n,i,a),o=s&&s.matchFragment(this.content,r);if(!o||!o.validEnd)return!1;for(let l=i;l<a;l++)if(!this.type.allowsMarks(n.child(l).marks))return!1;return!0}canReplaceWith(e,r,n,i){if(i&&!this.type.allowsMarks(i))return!1;let a=this.contentMatchAt(e).matchType(n),s=a&&a.matchFragment(this.content,r);return s?s.validEnd:!1}canAppend(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let e=yn.none;for(let r=0;r<this.marks.length;r++){let n=this.marks[r];n.type.checkAttrs(n.attrs),e=n.addToSet(e)}if(!yn.sameSet(e,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(r=>r.type.name)}`);this.content.forEach(r=>r.check())}toJSON(){let e={type:this.type.name};for(let r in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map(r=>r.toJSON())),e}static fromJSON(e,r){if(!r)throw new RangeError("Invalid input for Node.fromJSON");let n;if(r.marks){if(!Array.isArray(r.marks))throw new RangeError("Invalid mark data for Node.fromJSON");n=r.marks.map(e.markFromJSON)}if(r.type=="text"){if(typeof r.text!="string")throw new RangeError("Invalid text node in JSON");return e.text(r.text,n)}let i=at.fromJSON(e,r.content),a=e.nodeType(r.type).create(r.attrs,i,n);return a.type.checkAttrs(a.attrs),a}}qo.prototype.text=void 0;class Px extends qo{constructor(e,r,n,i){if(super(e,r,null,i),!n)throw new RangeError("Empty text nodes are not allowed");this.text=n}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):ML(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(e,r){return this.text.slice(e,r)}get nodeSize(){return this.text.length}mark(e){return e==this.marks?this:new Px(this.type,this.attrs,this.text,e)}withText(e){return e==this.text?this:new Px(this.type,this.attrs,e,this.marks)}cut(e=0,r=this.text.length){return e==0&&r==this.text.length?this:this.withText(this.text.slice(e,r))}eq(e){return this.sameMarkup(e)&&this.text==e.text}toJSON(){let e=super.toJSON();return e.text=this.text,e}}function ML(t,e){for(let r=t.length-1;r>=0;r--)e=t[r].type.name+"("+e+")";return e}class wf{constructor(e){this.validEnd=e,this.next=[],this.wrapCache=[]}static parse(e,r){let n=new ZK(e,r);if(n.next==null)return wf.empty;let i=AL(n);n.next&&n.err("Unexpected trailing text");let a=rZ(tZ(i));return nZ(a,n),a}matchType(e){for(let r=0;r<this.next.length;r++)if(this.next[r].type==e)return this.next[r].next;return null}matchFragment(e,r=0,n=e.childCount){let i=this;for(let a=r;i&&a<n;a++)i=i.matchType(e.child(a).type);return i}get inlineContent(){return this.next.length!=0&&this.next[0].type.isInline}get defaultType(){for(let e=0;e<this.next.length;e++){let{type:r}=this.next[e];if(!(r.isText||r.hasRequiredAttrs()))return r}return null}compatible(e){for(let r=0;r<this.next.length;r++)for(let n=0;n<e.next.length;n++)if(this.next[r].type==e.next[n].type)return!0;return!1}fillBefore(e,r=!1,n=0){let i=[this];function a(s,o){let l=s.matchFragment(e,n);if(l&&(!r||l.validEnd))return at.from(o.map(u=>u.createAndFill()));for(let u=0;u<s.next.length;u++){let{type:c,next:h}=s.next[u];if(!(c.isText||c.hasRequiredAttrs())&&i.indexOf(h)==-1){i.push(h);let p=a(h,o.concat(c));if(p)return p}}return null}return a(this,[])}findWrapping(e){for(let n=0;n<this.wrapCache.length;n+=2)if(this.wrapCache[n]==e)return this.wrapCache[n+1];let r=this.computeWrapping(e);return this.wrapCache.push(e,r),r}computeWrapping(e){let r=Object.create(null),n=[{match:this,type:null,via:null}];for(;n.length;){let i=n.shift(),a=i.match;if(a.matchType(e)){let s=[];for(let o=i;o.type;o=o.via)s.push(o.type);return s.reverse()}for(let s=0;s<a.next.length;s++){let{type:o,next:l}=a.next[s];!o.isLeaf&&!o.hasRequiredAttrs()&&!(o.name in r)&&(!i.type||l.validEnd)&&(n.push({match:o.contentMatch,type:o,via:i}),r[o.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(e){if(e>=this.next.length)throw new RangeError(`There's no ${e}th edge in this content match`);return this.next[e]}toString(){let e=[];function r(n){e.push(n);for(let i=0;i<n.next.length;i++)e.indexOf(n.next[i].next)==-1&&r(n.next[i].next)}return r(this),e.map((n,i)=>{let a=i+(n.validEnd?"*":" ")+" ";for(let s=0;s<n.next.length;s++)a+=(s?", ":"")+n.next[s].type.name+"->"+e.indexOf(n.next[s].next);return a}).join(`
`)}}wf.empty=new wf(!0);class ZK{constructor(e,r){this.string=e,this.nodeTypes=r,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(e){return this.next==e&&(this.pos++||!0)}err(e){throw new SyntaxError(e+" (in content expression '"+this.string+"')")}}function AL(t){let e=[];do e.push(YK(t));while(t.eat("|"));return e.length==1?e[0]:{type:"choice",exprs:e}}function YK(t){let e=[];do e.push(XK(t));while(t.next&&t.next!=")"&&t.next!="|");return e.length==1?e[0]:{type:"seq",exprs:e}}function XK(t){let e=eZ(t);for(;;)if(t.eat("+"))e={type:"plus",expr:e};else if(t.eat("*"))e={type:"star",expr:e};else if(t.eat("?"))e={type:"opt",expr:e};else if(t.eat("{"))e=QK(t,e);else break;return e}function h3(t){/\D/.test(t.next)&&t.err("Expected number, got '"+t.next+"'");let e=Number(t.next);return t.pos++,e}function QK(t,e){let r=h3(t),n=r;return t.eat(",")&&(t.next!="}"?n=h3(t):n=-1),t.eat("}")||t.err("Unclosed braced range"),{type:"range",min:r,max:n,expr:e}}function JK(t,e){let r=t.nodeTypes,n=r[e];if(n)return[n];let i=[];for(let a in r){let s=r[a];s.isInGroup(e)&&i.push(s)}return i.length==0&&t.err("No node type or group '"+e+"' found"),i}function eZ(t){if(t.eat("(")){let e=AL(t);return t.eat(")")||t.err("Missing closing paren"),e}else if(/\W/.test(t.next))t.err("Unexpected token '"+t.next+"'");else{let e=JK(t,t.next).map(r=>(t.inline==null?t.inline=r.isInline:t.inline!=r.isInline&&t.err("Mixing inline and block content"),{type:"name",value:r}));return t.pos++,e.length==1?e[0]:{type:"choice",exprs:e}}}function tZ(t){let e=[[]];return i(a(t,0),r()),e;function r(){return e.push([])-1}function n(s,o,l){let u={term:l,to:o};return e[s].push(u),u}function i(s,o){s.forEach(l=>l.to=o)}function a(s,o){if(s.type=="choice")return s.exprs.reduce((l,u)=>l.concat(a(u,o)),[]);if(s.type=="seq")for(let l=0;;l++){let u=a(s.exprs[l],o);if(l==s.exprs.length-1)return u;i(u,o=r())}else if(s.type=="star"){let l=r();return n(o,l),i(a(s.expr,l),l),[n(l)]}else if(s.type=="plus"){let l=r();return i(a(s.expr,o),l),i(a(s.expr,l),l),[n(l)]}else{if(s.type=="opt")return[n(o)].concat(a(s.expr,o));if(s.type=="range"){let l=o;for(let u=0;u<s.min;u++){let c=r();i(a(s.expr,l),c),l=c}if(s.max==-1)i(a(s.expr,l),l);else for(let u=s.min;u<s.max;u++){let c=r();n(l,c),i(a(s.expr,l),c),l=c}return[n(l)]}else{if(s.type=="name")return[n(o,void 0,s.value)];throw new Error("Unknown expr type")}}}}function RL(t,e){return e-t}function f3(t,e){let r=[];return n(e),r.sort(RL);function n(i){let a=t[i];if(a.length==1&&!a[0].term)return n(a[0].to);r.push(i);for(let s=0;s<a.length;s++){let{term:o,to:l}=a[s];!o&&r.indexOf(l)==-1&&n(l)}}}function rZ(t){let e=Object.create(null);return r(f3(t,0));function r(n){let i=[];n.forEach(s=>{t[s].forEach(({term:o,to:l})=>{if(!o)return;let u;for(let c=0;c<i.length;c++)i[c][0]==o&&(u=i[c][1]);f3(t,l).forEach(c=>{u||i.push([o,u=[]]),u.indexOf(c)==-1&&u.push(c)})})});let a=e[n.join(",")]=new wf(n.indexOf(t.length-1)>-1);for(let s=0;s<i.length;s++){let o=i[s][1].sort(RL);a.next.push({type:i[s][0],next:e[o.join(",")]||r(o)})}return a}}function nZ(t,e){for(let r=0,n=[t];r<n.length;r++){let i=n[r],a=!i.validEnd,s=[];for(let o=0;o<i.next.length;o++){let{type:l,next:u}=i.next[o];s.push(l.name),a&&!(l.isText||l.hasRequiredAttrs())&&(a=!1),n.indexOf(u)==-1&&n.push(u)}a&&e.err("Only non-generatable nodes ("+s.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function LL(t){let e=Object.create(null);for(let r in t){let n=t[r];if(!n.hasDefault)return null;e[r]=n.default}return e}function OL(t,e){let r=Object.create(null);for(let n in t){let i=e&&e[n];if(i===void 0){let a=t[n];if(a.hasDefault)i=a.default;else throw new RangeError("No value supplied for attribute "+n)}r[n]=i}return r}function DL(t,e,r,n){for(let i in e)if(!(i in t))throw new RangeError(`Unsupported attribute ${i} for ${r} of type ${i}`);for(let i in t){let a=t[i];a.validate&&a.validate(e[i])}}function IL(t,e){let r=Object.create(null);if(e)for(let n in e)r[n]=new aZ(t,n,e[n]);return r}let p3=class jL{constructor(e,r,n){this.name=e,this.schema=r,this.spec=n,this.markSet=null,this.groups=n.group?n.group.split(" "):[],this.attrs=IL(e,n.attrs),this.defaultAttrs=LL(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(n.inline||e=="text"),this.isText=e=="text"}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==wf.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}isInGroup(e){return this.groups.indexOf(e)>-1}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1}compatibleContent(e){return this==e||this.contentMatch.compatible(e.contentMatch)}computeAttrs(e){return!e&&this.defaultAttrs?this.defaultAttrs:OL(this.attrs,e)}create(e=null,r,n){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new qo(this,this.computeAttrs(e),at.from(r),yn.setFrom(n))}createChecked(e=null,r,n){return r=at.from(r),this.checkContent(r),new qo(this,this.computeAttrs(e),r,yn.setFrom(n))}createAndFill(e=null,r,n){if(e=this.computeAttrs(e),r=at.from(r),r.size){let s=this.contentMatch.fillBefore(r);if(!s)return null;r=s.append(r)}let i=this.contentMatch.matchFragment(r),a=i&&i.fillBefore(at.empty,!0);return a?new qo(this,e,r.append(a),yn.setFrom(n)):null}validContent(e){let r=this.contentMatch.matchFragment(e);if(!r||!r.validEnd)return!1;for(let n=0;n<e.childCount;n++)if(!this.allowsMarks(e.child(n).marks))return!1;return!0}checkContent(e){if(!this.validContent(e))throw new RangeError(`Invalid content for node ${this.name}: ${e.toString().slice(0,50)}`)}checkAttrs(e){DL(this.attrs,e,"node",this.name)}allowsMarkType(e){return this.markSet==null||this.markSet.indexOf(e)>-1}allowsMarks(e){if(this.markSet==null)return!0;for(let r=0;r<e.length;r++)if(!this.allowsMarkType(e[r].type))return!1;return!0}allowedMarks(e){if(this.markSet==null)return e;let r;for(let n=0;n<e.length;n++)this.allowsMarkType(e[n].type)?r&&r.push(e[n]):r||(r=e.slice(0,n));return r?r.length?r:yn.none:e}static compile(e,r){let n=Object.create(null);e.forEach((a,s)=>n[a]=new jL(a,r,s));let i=r.spec.topNode||"doc";if(!n[i])throw new RangeError("Schema is missing its top node type ('"+i+"')");if(!n.text)throw new RangeError("Every schema needs a 'text' type");for(let a in n.text.attrs)throw new RangeError("The text node type should not have attributes");return n}};function iZ(t,e,r){let n=r.split("|");return i=>{let a=i===null?"null":typeof i;if(n.indexOf(a)<0)throw new RangeError(`Expected value of type ${n} for attribute ${e} on type ${t}, got ${a}`)}}class aZ{constructor(e,r,n){this.hasDefault=Object.prototype.hasOwnProperty.call(n,"default"),this.default=n.default,this.validate=typeof n.validate=="string"?iZ(e,r,n.validate):n.validate}get isRequired(){return!this.hasDefault}}class H1{constructor(e,r,n,i){this.name=e,this.rank=r,this.schema=n,this.spec=i,this.attrs=IL(e,i.attrs),this.excluded=null;let a=LL(this.attrs);this.instance=a?new yn(this,a):null}create(e=null){return!e&&this.instance?this.instance:new yn(this,OL(this.attrs,e))}static compile(e,r){let n=Object.create(null),i=0;return e.forEach((a,s)=>n[a]=new H1(a,i++,r,s)),n}removeFromSet(e){for(var r=0;r<e.length;r++)e[r].type==this&&(e=e.slice(0,r).concat(e.slice(r+1)),r--);return e}isInSet(e){for(let r=0;r<e.length;r++)if(e[r].type==this)return e[r]}checkAttrs(e){DL(this.attrs,e,"mark",this.name)}excludes(e){return this.excluded.indexOf(e)>-1}}class FL{constructor(e){this.linebreakReplacement=null,this.cached=Object.create(null);let r=this.spec={};for(let i in e)r[i]=e[i];r.nodes=Ba.from(e.nodes),r.marks=Ba.from(e.marks||{}),this.nodes=p3.compile(this.spec.nodes,this),this.marks=H1.compile(this.spec.marks,this);let n=Object.create(null);for(let i in this.nodes){if(i in this.marks)throw new RangeError(i+" can not be both a node and a mark");let a=this.nodes[i],s=a.spec.content||"",o=a.spec.marks;if(a.contentMatch=n[s]||(n[s]=wf.parse(s,this.nodes)),a.inlineContent=a.contentMatch.inlineContent,a.spec.linebreakReplacement){if(this.linebreakReplacement)throw new RangeError("Multiple linebreak nodes defined");if(!a.isInline||!a.isLeaf)throw new RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=a}a.markSet=o=="_"?null:o?m3(this,o.split(" ")):o==""||!a.inlineContent?[]:null}for(let i in this.marks){let a=this.marks[i],s=a.spec.excludes;a.excluded=s==null?[a]:s==""?[]:m3(this,s.split(" "))}this.nodeFromJSON=i=>qo.fromJSON(this,i),this.markFromJSON=i=>yn.fromJSON(this,i),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(e,r=null,n,i){if(typeof e=="string")e=this.nodeType(e);else if(e instanceof p3){if(e.schema!=this)throw new RangeError("Node type from different schema used ("+e.name+")")}else throw new RangeError("Invalid node type: "+e);return e.createChecked(r,n,i)}text(e,r){let n=this.nodes.text;return new Px(n,n.defaultAttrs,e,yn.setFrom(r))}mark(e,r){return typeof e=="string"&&(e=this.marks[e]),e.create(r)}nodeType(e){let r=this.nodes[e];if(!r)throw new RangeError("Unknown node type: "+e);return r}}function m3(t,e){let r=[];for(let n=0;n<e.length;n++){let i=e[n],a=t.marks[i],s=a;if(a)r.push(a);else for(let o in t.marks){let l=t.marks[o];(i=="_"||l.spec.group&&l.spec.group.split(" ").indexOf(i)>-1)&&r.push(s=l)}if(!s)throw new SyntaxError("Unknown mark type: '"+e[n]+"'")}return r}function sZ(t){return t.tag!=null}function oZ(t){return t.style!=null}class Wd{constructor(e,r){this.schema=e,this.rules=r,this.tags=[],this.styles=[];let n=this.matchedStyles=[];r.forEach(i=>{if(sZ(i))this.tags.push(i);else if(oZ(i)){let a=/[^=]*/.exec(i.style)[0];n.indexOf(a)<0&&n.push(a),this.styles.push(i)}}),this.normalizeLists=!this.tags.some(i=>{if(!/^(ul|ol)\b/.test(i.tag)||!i.node)return!1;let a=e.nodes[i.node];return a.contentMatch.matchType(a)})}parse(e,r={}){let n=new v3(this,r,!1);return n.addAll(e,yn.none,r.from,r.to),n.finish()}parseSlice(e,r={}){let n=new v3(this,r,!0);return n.addAll(e,yn.none,r.from,r.to),Mt.maxOpen(n.finish())}matchTag(e,r,n){for(let i=n?this.tags.indexOf(n)+1:0;i<this.tags.length;i++){let a=this.tags[i];if(cZ(e,a.tag)&&(a.namespace===void 0||e.namespaceURI==a.namespace)&&(!a.context||r.matchesContext(a.context))){if(a.getAttrs){let s=a.getAttrs(e);if(s===!1)continue;a.attrs=s||void 0}return a}}}matchStyle(e,r,n,i){for(let a=i?this.styles.indexOf(i)+1:0;a<this.styles.length;a++){let s=this.styles[a],o=s.style;if(!(o.indexOf(e)!=0||s.context&&!n.matchesContext(s.context)||o.length>e.length&&(o.charCodeAt(e.length)!=61||o.slice(e.length+1)!=r))){if(s.getAttrs){let l=s.getAttrs(r);if(l===!1)continue;s.attrs=l||void 0}return s}}}static schemaRules(e){let r=[];function n(i){let a=i.priority==null?50:i.priority,s=0;for(;s<r.length;s++){let o=r[s];if((o.priority==null?50:o.priority)<a)break}r.splice(s,0,i)}for(let i in e.marks){let a=e.marks[i].spec.parseDOM;a&&a.forEach(s=>{n(s=y3(s)),s.mark||s.ignore||s.clearMark||(s.mark=i)})}for(let i in e.nodes){let a=e.nodes[i].spec.parseDOM;a&&a.forEach(s=>{n(s=y3(s)),s.node||s.ignore||s.mark||(s.node=i)})}return r}static fromSchema(e){return e.cached.domParser||(e.cached.domParser=new Wd(e,Wd.schemaRules(e)))}}const BL={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},lZ={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},zL={ol:!0,ul:!0},Lv=1,dk=2,iv=4;function g3(t,e,r){return e!=null?(e?Lv:0)|(e==="full"?dk:0):t&&t.whitespace=="pre"?Lv|dk:r&~iv}class by{constructor(e,r,n,i,a,s){this.type=e,this.attrs=r,this.marks=n,this.solid=i,this.options=s,this.content=[],this.activeMarks=yn.none,this.match=a||(s&iv?null:e.contentMatch)}findWrapping(e){if(!this.match){if(!this.type)return[];let r=this.type.contentMatch.fillBefore(at.from(e));if(r)this.match=this.type.contentMatch.matchFragment(r);else{let n=this.type.contentMatch,i;return(i=n.findWrapping(e.type))?(this.match=n,i):null}}return this.match.findWrapping(e.type)}finish(e){if(!(this.options&Lv)){let n=this.content[this.content.length-1],i;if(n&&n.isText&&(i=/[ \t\r\n\u000c]+$/.exec(n.text))){let a=n;n.text.length==i[0].length?this.content.pop():this.content[this.content.length-1]=a.withText(a.text.slice(0,a.text.length-i[0].length))}}let r=at.from(this.content);return!e&&this.match&&(r=r.append(this.match.fillBefore(at.empty,!0))),this.type?this.type.create(this.attrs,r,this.marks):r}inlineContext(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!BL.hasOwnProperty(e.parentNode.nodeName.toLowerCase())}}class v3{constructor(e,r,n){this.parser=e,this.options=r,this.isOpen=n,this.open=0,this.localPreserveWS=!1;let i=r.topNode,a,s=g3(null,r.preserveWhitespace,0)|(n?iv:0);i?a=new by(i.type,i.attrs,yn.none,!0,r.topMatch||i.type.contentMatch,s):n?a=new by(null,null,yn.none,!0,null,s):a=new by(e.schema.topNodeType,null,yn.none,!0,null,s),this.nodes=[a],this.find=r.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(e,r){e.nodeType==3?this.addTextNode(e,r):e.nodeType==1&&this.addElement(e,r)}addTextNode(e,r){let n=e.nodeValue,i=this.top,a=i.options&dk?"full":this.localPreserveWS||(i.options&Lv)>0,{schema:s}=this.parser;if(a==="full"||i.inlineContext(e)||/[^ \t\r\n\u000c]/.test(n)){if(a)if(a==="full")n=n.replace(/\r\n?/g,`
`);else if(s.linebreakReplacement&&/[\r\n]/.test(n)&&this.top.findWrapping(s.linebreakReplacement.create())){let o=n.split(/\r?\n|\r/);for(let l=0;l<o.length;l++)l&&this.insertNode(s.linebreakReplacement.create(),r,!0),o[l]&&this.insertNode(s.text(o[l]),r,!/\S/.test(o[l]));n=""}else n=n.replace(/\r?\n|\r/g," ");else if(n=n.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(n)&&this.open==this.nodes.length-1){let o=i.content[i.content.length-1],l=e.previousSibling;(!o||l&&l.nodeName=="BR"||o.isText&&/[ \t\r\n\u000c]$/.test(o.text))&&(n=n.slice(1))}n&&this.insertNode(s.text(n),r,!/\S/.test(n)),this.findInText(e)}else this.findInside(e)}addElement(e,r,n){let i=this.localPreserveWS,a=this.top;(e.tagName=="PRE"||/pre/.test(e.style&&e.style.whiteSpace))&&(this.localPreserveWS=!0);let s=e.nodeName.toLowerCase(),o;zL.hasOwnProperty(s)&&this.parser.normalizeLists&&uZ(e);let l=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(o=this.parser.matchTag(e,this,n));e:if(l?l.ignore:lZ.hasOwnProperty(s))this.findInside(e),this.ignoreFallback(e,r);else if(!l||l.skip||l.closeParent){l&&l.closeParent?this.open=Math.max(0,this.open-1):l&&l.skip.nodeType&&(e=l.skip);let u,c=this.needsBlock;if(BL.hasOwnProperty(s))a.content.length&&a.content[0].isInline&&this.open&&(this.open--,a=this.top),u=!0,a.type||(this.needsBlock=!0);else if(!e.firstChild){this.leafFallback(e,r);break e}let h=l&&l.skip?r:this.readStyles(e,r);h&&this.addAll(e,h),u&&this.sync(a),this.needsBlock=c}else{let u=this.readStyles(e,r);u&&this.addElementByRule(e,l,u,l.consuming===!1?o:void 0)}this.localPreserveWS=i}leafFallback(e,r){e.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode(`
`),r)}ignoreFallback(e,r){e.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"),r,!0)}readStyles(e,r){let n=e.style;if(n&&n.length)for(let i=0;i<this.parser.matchedStyles.length;i++){let a=this.parser.matchedStyles[i],s=n.getPropertyValue(a);if(s)for(let o=void 0;;){let l=this.parser.matchStyle(a,s,this,o);if(!l)break;if(l.ignore)return null;if(l.clearMark?r=r.filter(u=>!l.clearMark(u)):r=r.concat(this.parser.schema.marks[l.mark].create(l.attrs)),l.consuming===!1)o=l;else break}}return r}addElementByRule(e,r,n,i){let a,s;if(r.node)if(s=this.parser.schema.nodes[r.node],s.isLeaf)this.insertNode(s.create(r.attrs),n,e.nodeName=="BR")||this.leafFallback(e,n);else{let l=this.enter(s,r.attrs||null,n,r.preserveWhitespace);l&&(a=!0,n=l)}else{let l=this.parser.schema.marks[r.mark];n=n.concat(l.create(r.attrs))}let o=this.top;if(s&&s.isLeaf)this.findInside(e);else if(i)this.addElement(e,n,i);else if(r.getContent)this.findInside(e),r.getContent(e,this.parser.schema).forEach(l=>this.insertNode(l,n,!1));else{let l=e;typeof r.contentElement=="string"?l=e.querySelector(r.contentElement):typeof r.contentElement=="function"?l=r.contentElement(e):r.contentElement&&(l=r.contentElement),this.findAround(e,l,!0),this.addAll(l,n),this.findAround(e,l,!1)}a&&this.sync(o)&&this.open--}addAll(e,r,n,i){let a=n||0;for(let s=n?e.childNodes[n]:e.firstChild,o=i==null?null:e.childNodes[i];s!=o;s=s.nextSibling,++a)this.findAtPoint(e,a),this.addDOM(s,r);this.findAtPoint(e,a)}findPlace(e,r,n){let i,a;for(let s=this.open,o=0;s>=0;s--){let l=this.nodes[s],u=l.findWrapping(e);if(u&&(!i||i.length>u.length+o)&&(i=u,a=l,!u.length))break;if(l.solid){if(n)break;o+=2}}if(!i)return null;this.sync(a);for(let s=0;s<i.length;s++)r=this.enterInner(i[s],null,r,!1);return r}insertNode(e,r,n){if(e.isInline&&this.needsBlock&&!this.top.type){let a=this.textblockFromContext();a&&(r=this.enterInner(a,null,r))}let i=this.findPlace(e,r,n);if(i){this.closeExtra();let a=this.top;a.match&&(a.match=a.match.matchType(e.type));let s=yn.none;for(let o of i.concat(e.marks))(a.type?a.type.allowsMarkType(o.type):x3(o.type,e.type))&&(s=o.addToSet(s));return a.content.push(e.mark(s)),!0}return!1}enter(e,r,n,i){let a=this.findPlace(e.create(r),n,!1);return a&&(a=this.enterInner(e,r,n,!0,i)),a}enterInner(e,r,n,i=!1,a){this.closeExtra();let s=this.top;s.match=s.match&&s.match.matchType(e);let o=g3(e,a,s.options);s.options&iv&&s.content.length==0&&(o|=iv);let l=yn.none;return n=n.filter(u=>(s.type?s.type.allowsMarkType(u.type):x3(u.type,e))?(l=u.addToSet(l),!1):!0),this.nodes.push(new by(e,r,l,i,null,o)),this.open++,n}closeExtra(e=!1){let r=this.nodes.length-1;if(r>this.open){for(;r>this.open;r--)this.nodes[r-1].content.push(this.nodes[r].finish(e));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(!!(this.isOpen||this.options.topOpen))}sync(e){for(let r=this.open;r>=0;r--){if(this.nodes[r]==e)return this.open=r,!0;this.localPreserveWS&&(this.nodes[r].options|=Lv)}return!1}get currentPos(){this.closeExtra();let e=0;for(let r=this.open;r>=0;r--){let n=this.nodes[r].content;for(let i=n.length-1;i>=0;i--)e+=n[i].nodeSize;r&&e++}return e}findAtPoint(e,r){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].node==e&&this.find[n].offset==r&&(this.find[n].pos=this.currentPos)}findInside(e){if(this.find)for(let r=0;r<this.find.length;r++)this.find[r].pos==null&&e.nodeType==1&&e.contains(this.find[r].node)&&(this.find[r].pos=this.currentPos)}findAround(e,r,n){if(e!=r&&this.find)for(let i=0;i<this.find.length;i++)this.find[i].pos==null&&e.nodeType==1&&e.contains(this.find[i].node)&&r.compareDocumentPosition(this.find[i].node)&(n?2:4)&&(this.find[i].pos=this.currentPos)}findInText(e){if(this.find)for(let r=0;r<this.find.length;r++)this.find[r].node==e&&(this.find[r].pos=this.currentPos-(e.nodeValue.length-this.find[r].offset))}matchesContext(e){if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);let r=e.split("/"),n=this.options.context,i=!this.isOpen&&(!n||n.parent.type==this.nodes[0].type),a=-(n?n.depth+1:0)+(i?0:1),s=(o,l)=>{for(;o>=0;o--){let u=r[o];if(u==""){if(o==r.length-1||o==0)continue;for(;l>=a;l--)if(s(o-1,l))return!0;return!1}else{let c=l>0||l==0&&i?this.nodes[l].type:n&&l>=a?n.node(l-a).type:null;if(!c||c.name!=u&&!c.isInGroup(u))return!1;l--}}return!0};return s(r.length-1,this.open)}textblockFromContext(){let e=this.options.context;if(e)for(let r=e.depth;r>=0;r--){let n=e.node(r).contentMatchAt(e.indexAfter(r)).defaultType;if(n&&n.isTextblock&&n.defaultAttrs)return n}for(let r in this.parser.schema.nodes){let n=this.parser.schema.nodes[r];if(n.isTextblock&&n.defaultAttrs)return n}}}function uZ(t){for(let e=t.firstChild,r=null;e;e=e.nextSibling){let n=e.nodeType==1?e.nodeName.toLowerCase():null;n&&zL.hasOwnProperty(n)&&r?(r.appendChild(e),e=r):n=="li"?r=e:n&&(r=null)}}function cZ(t,e){return(t.matches||t.msMatchesSelector||t.webkitMatchesSelector||t.mozMatchesSelector).call(t,e)}function y3(t){let e={};for(let r in t)e[r]=t[r];return e}function x3(t,e){let r=e.schema.nodes;for(let n in r){let i=r[n];if(!i.allowsMarkType(t))continue;let a=[],s=o=>{a.push(o);for(let l=0;l<o.edgeCount;l++){let{type:u,next:c}=o.edge(l);if(u==e||a.indexOf(c)<0&&s(c))return!0}};if(s(i.contentMatch))return!0}}class Af{constructor(e,r){this.nodes=e,this.marks=r}serializeFragment(e,r={},n){n||(n=Z2(r).createDocumentFragment());let i=n,a=[];return e.forEach(s=>{if(a.length||s.marks.length){let o=0,l=0;for(;o<a.length&&l<s.marks.length;){let u=s.marks[l];if(!this.marks[u.type.name]){l++;continue}if(!u.eq(a[o][0])||u.type.spec.spanning===!1)break;o++,l++}for(;o<a.length;)i=a.pop()[1];for(;l<s.marks.length;){let u=s.marks[l++],c=this.serializeMark(u,s.isInline,r);c&&(a.push([u,i]),i.appendChild(c.dom),i=c.contentDOM||c.dom)}}i.appendChild(this.serializeNodeInner(s,r))}),n}serializeNodeInner(e,r){let{dom:n,contentDOM:i}=Ky(Z2(r),this.nodes[e.type.name](e),null,e.attrs);if(i){if(e.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(e.content,r,i)}return n}serializeNode(e,r={}){let n=this.serializeNodeInner(e,r);for(let i=e.marks.length-1;i>=0;i--){let a=this.serializeMark(e.marks[i],e.isInline,r);a&&((a.contentDOM||a.dom).appendChild(n),n=a.dom)}return n}serializeMark(e,r,n={}){let i=this.marks[e.type.name];return i&&Ky(Z2(n),i(e,r),null,e.attrs)}static renderSpec(e,r,n=null,i){return Ky(e,r,n,i)}static fromSchema(e){return e.cached.domSerializer||(e.cached.domSerializer=new Af(this.nodesFromSchema(e),this.marksFromSchema(e)))}static nodesFromSchema(e){let r=b3(e.nodes);return r.text||(r.text=n=>n.text),r}static marksFromSchema(e){return b3(e.marks)}}function b3(t){let e={};for(let r in t){let n=t[r].spec.toDOM;n&&(e[r]=n)}return e}function Z2(t){return t.document||window.document}const w3=new WeakMap;function dZ(t){let e=w3.get(t);return e===void 0&&w3.set(t,e=hZ(t)),e}function hZ(t){let e=null;function r(n){if(n&&typeof n=="object")if(Array.isArray(n))if(typeof n[0]=="string")e||(e=[]),e.push(n);else for(let i=0;i<n.length;i++)r(n[i]);else for(let i in n)r(n[i])}return r(t),e}function Ky(t,e,r,n){if(typeof e=="string")return{dom:t.createTextNode(e)};if(e.nodeType!=null)return{dom:e};if(e.dom&&e.dom.nodeType!=null)return e;let i=e[0],a;if(typeof i!="string")throw new RangeError("Invalid array passed to renderSpec");if(n&&(a=dZ(n))&&a.indexOf(e)>-1)throw new RangeError("Using an array from an attribute object as a DOM spec. This may be an attempted cross site scripting attack.");let s=i.indexOf(" ");s>0&&(r=i.slice(0,s),i=i.slice(s+1));let o,l=r?t.createElementNS(r,i):t.createElement(i),u=e[1],c=1;if(u&&typeof u=="object"&&u.nodeType==null&&!Array.isArray(u)){c=2;for(let h in u)if(u[h]!=null){let p=h.indexOf(" ");p>0?l.setAttributeNS(h.slice(0,p),h.slice(p+1),u[h]):h=="style"&&l.style?l.style.cssText=u[h]:l.setAttribute(h,u[h])}}for(let h=c;h<e.length;h++){let p=e[h];if(p===0){if(h<e.length-1||h>c)throw new RangeError("Content hole must be the only child of its parent node");return{dom:l,contentDOM:l}}else{let{dom:v,contentDOM:y}=Ky(t,p,r,n);if(l.appendChild(v),y){if(o)throw new RangeError("Multiple content holes");o=y}}}return{dom:l,contentDOM:o}}const UL=65535,GL=Math.pow(2,16);function fZ(t,e){return t+e*GL}function S3(t){return t&UL}function pZ(t){return(t-(t&UL))/GL}const VL=1,HL=2,Zy=4,WL=8;class hk{constructor(e,r,n){this.pos=e,this.delInfo=r,this.recover=n}get deleted(){return(this.delInfo&WL)>0}get deletedBefore(){return(this.delInfo&(VL|Zy))>0}get deletedAfter(){return(this.delInfo&(HL|Zy))>0}get deletedAcross(){return(this.delInfo&Zy)>0}}class fo{constructor(e,r=!1){if(this.ranges=e,this.inverted=r,!e.length&&fo.empty)return fo.empty}recover(e){let r=0,n=S3(e);if(!this.inverted)for(let i=0;i<n;i++)r+=this.ranges[i*3+2]-this.ranges[i*3+1];return this.ranges[n*3]+r+pZ(e)}mapResult(e,r=1){return this._map(e,r,!1)}map(e,r=1){return this._map(e,r,!0)}_map(e,r,n){let i=0,a=this.inverted?2:1,s=this.inverted?1:2;for(let o=0;o<this.ranges.length;o+=3){let l=this.ranges[o]-(this.inverted?i:0);if(l>e)break;let u=this.ranges[o+a],c=this.ranges[o+s],h=l+u;if(e<=h){let p=u?e==l?-1:e==h?1:r:r,v=l+i+(p<0?0:c);if(n)return v;let y=e==(r<0?l:h)?null:fZ(o/3,e-l),S=e==l?HL:e==h?VL:Zy;return(r<0?e!=l:e!=h)&&(S|=WL),new hk(v,S,y)}i+=c-u}return n?e+i:new hk(e+i,0,null)}touches(e,r){let n=0,i=S3(r),a=this.inverted?2:1,s=this.inverted?1:2;for(let o=0;o<this.ranges.length;o+=3){let l=this.ranges[o]-(this.inverted?n:0);if(l>e)break;let u=this.ranges[o+a],c=l+u;if(e<=c&&o==i*3)return!0;n+=this.ranges[o+s]-u}return!1}forEach(e){let r=this.inverted?2:1,n=this.inverted?1:2;for(let i=0,a=0;i<this.ranges.length;i+=3){let s=this.ranges[i],o=s-(this.inverted?a:0),l=s+(this.inverted?0:a),u=this.ranges[i+r],c=this.ranges[i+n];e(o,o+u,l,l+c),a+=c-u}}invert(){return new fo(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(e){return e==0?fo.empty:new fo(e<0?[0,-e,0]:[0,0,e])}}fo.empty=new fo([]);class Ov{constructor(e,r,n=0,i=e?e.length:0){this.mirror=r,this.from=n,this.to=i,this._maps=e||[],this.ownData=!(e||r)}get maps(){return this._maps}slice(e=0,r=this.maps.length){return new Ov(this._maps,this.mirror,e,r)}appendMap(e,r){this.ownData||(this._maps=this._maps.slice(),this.mirror=this.mirror&&this.mirror.slice(),this.ownData=!0),this.to=this._maps.push(e),r!=null&&this.setMirror(this._maps.length-1,r)}appendMapping(e){for(let r=0,n=this._maps.length;r<e._maps.length;r++){let i=e.getMirror(r);this.appendMap(e._maps[r],i!=null&&i<r?n+i:void 0)}}getMirror(e){if(this.mirror){for(let r=0;r<this.mirror.length;r++)if(this.mirror[r]==e)return this.mirror[r+(r%2?-1:1)]}}setMirror(e,r){this.mirror||(this.mirror=[]),this.mirror.push(e,r)}appendMappingInverted(e){for(let r=e.maps.length-1,n=this._maps.length+e._maps.length;r>=0;r--){let i=e.getMirror(r);this.appendMap(e._maps[r].invert(),i!=null&&i>r?n-i-1:void 0)}}invert(){let e=new Ov;return e.appendMappingInverted(this),e}map(e,r=1){if(this.mirror)return this._map(e,r,!0);for(let n=this.from;n<this.to;n++)e=this._maps[n].map(e,r);return e}mapResult(e,r=1){return this._map(e,r,!1)}_map(e,r,n){let i=0;for(let a=this.from;a<this.to;a++){let s=this._maps[a],o=s.mapResult(e,r);if(o.recover!=null){let l=this.getMirror(a);if(l!=null&&l>a&&l<this.to){a=l,e=this._maps[l].recover(o.recover);continue}}i|=o.delInfo,e=o.pos}return n?e:new hk(e,i,null)}}const Y2=Object.create(null);class hs{getMap(){return fo.empty}merge(e){return null}static fromJSON(e,r){if(!r||!r.stepType)throw new RangeError("Invalid input for Step.fromJSON");let n=Y2[r.stepType];if(!n)throw new RangeError(`No step type ${r.stepType} defined`);return n.fromJSON(e,r)}static jsonID(e,r){if(e in Y2)throw new RangeError("Duplicate use of step JSON ID "+e);return Y2[e]=r,r.prototype.jsonID=e,r}}class Fi{constructor(e,r){this.doc=e,this.failed=r}static ok(e){return new Fi(e,null)}static fail(e){return new Fi(null,e)}static fromReplace(e,r,n,i){try{return Fi.ok(e.replace(r,n,i))}catch(a){if(a instanceof Ex)return Fi.fail(a.message);throw a}}}function I_(t,e,r){let n=[];for(let i=0;i<t.childCount;i++){let a=t.child(i);a.content.size&&(a=a.copy(I_(a.content,e,a))),a.isInline&&(a=e(a,r,i)),n.push(a)}return at.fromArray(n)}class jd extends hs{constructor(e,r,n){super(),this.from=e,this.to=r,this.mark=n}apply(e){let r=e.slice(this.from,this.to),n=e.resolve(this.from),i=n.node(n.sharedDepth(this.to)),a=new Mt(I_(r.content,(s,o)=>!s.isAtom||!o.type.allowsMarkType(this.mark.type)?s:s.mark(this.mark.addToSet(s.marks)),i),r.openStart,r.openEnd);return Fi.fromReplace(e,this.from,this.to,a)}invert(){return new Ml(this.from,this.to,this.mark)}map(e){let r=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return r.deleted&&n.deleted||r.pos>=n.pos?null:new jd(r.pos,n.pos,this.mark)}merge(e){return e instanceof jd&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new jd(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,r){if(typeof r.from!="number"||typeof r.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new jd(r.from,r.to,e.markFromJSON(r.mark))}}hs.jsonID("addMark",jd);class Ml extends hs{constructor(e,r,n){super(),this.from=e,this.to=r,this.mark=n}apply(e){let r=e.slice(this.from,this.to),n=new Mt(I_(r.content,i=>i.mark(this.mark.removeFromSet(i.marks)),e),r.openStart,r.openEnd);return Fi.fromReplace(e,this.from,this.to,n)}invert(){return new jd(this.from,this.to,this.mark)}map(e){let r=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return r.deleted&&n.deleted||r.pos>=n.pos?null:new Ml(r.pos,n.pos,this.mark)}merge(e){return e instanceof Ml&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new Ml(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,r){if(typeof r.from!="number"||typeof r.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new Ml(r.from,r.to,e.markFromJSON(r.mark))}}hs.jsonID("removeMark",Ml);class Fd extends hs{constructor(e,r){super(),this.pos=e,this.mark=r}apply(e){let r=e.nodeAt(this.pos);if(!r)return Fi.fail("No node at mark step's position");let n=r.type.create(r.attrs,null,this.mark.addToSet(r.marks));return Fi.fromReplace(e,this.pos,this.pos+1,new Mt(at.from(n),0,r.isLeaf?0:1))}invert(e){let r=e.nodeAt(this.pos);if(r){let n=this.mark.addToSet(r.marks);if(n.length==r.marks.length){for(let i=0;i<r.marks.length;i++)if(!r.marks[i].isInSet(n))return new Fd(this.pos,r.marks[i]);return new Fd(this.pos,this.mark)}}return new Sf(this.pos,this.mark)}map(e){let r=e.mapResult(this.pos,1);return r.deletedAfter?null:new Fd(r.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,r){if(typeof r.pos!="number")throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new Fd(r.pos,e.markFromJSON(r.mark))}}hs.jsonID("addNodeMark",Fd);class Sf extends hs{constructor(e,r){super(),this.pos=e,this.mark=r}apply(e){let r=e.nodeAt(this.pos);if(!r)return Fi.fail("No node at mark step's position");let n=r.type.create(r.attrs,null,this.mark.removeFromSet(r.marks));return Fi.fromReplace(e,this.pos,this.pos+1,new Mt(at.from(n),0,r.isLeaf?0:1))}invert(e){let r=e.nodeAt(this.pos);return!r||!this.mark.isInSet(r.marks)?this:new Fd(this.pos,this.mark)}map(e){let r=e.mapResult(this.pos,1);return r.deletedAfter?null:new Sf(r.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,r){if(typeof r.pos!="number")throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new Sf(r.pos,e.markFromJSON(r.mark))}}hs.jsonID("removeNodeMark",Sf);class ma extends hs{constructor(e,r,n,i=!1){super(),this.from=e,this.to=r,this.slice=n,this.structure=i}apply(e){return this.structure&&fk(e,this.from,this.to)?Fi.fail("Structure replace would overwrite content"):Fi.fromReplace(e,this.from,this.to,this.slice)}getMap(){return new fo([this.from,this.to-this.from,this.slice.size])}invert(e){return new ma(this.from,this.from+this.slice.size,e.slice(this.from,this.to))}map(e){let r=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return r.deletedAcross&&n.deletedAcross?null:new ma(r.pos,Math.max(r.pos,n.pos),this.slice,this.structure)}merge(e){if(!(e instanceof ma)||e.structure||this.structure)return null;if(this.from+this.slice.size==e.from&&!this.slice.openEnd&&!e.slice.openStart){let r=this.slice.size+e.slice.size==0?Mt.empty:new Mt(this.slice.content.append(e.slice.content),this.slice.openStart,e.slice.openEnd);return new ma(this.from,this.to+(e.to-e.from),r,this.structure)}else if(e.to==this.from&&!this.slice.openStart&&!e.slice.openEnd){let r=this.slice.size+e.slice.size==0?Mt.empty:new Mt(e.slice.content.append(this.slice.content),e.slice.openStart,this.slice.openEnd);return new ma(e.from,this.to,r,this.structure)}else return null}toJSON(){let e={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,r){if(typeof r.from!="number"||typeof r.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new ma(r.from,r.to,Mt.fromJSON(e,r.slice),!!r.structure)}}hs.jsonID("replace",ma);class xa extends hs{constructor(e,r,n,i,a,s,o=!1){super(),this.from=e,this.to=r,this.gapFrom=n,this.gapTo=i,this.slice=a,this.insert=s,this.structure=o}apply(e){if(this.structure&&(fk(e,this.from,this.gapFrom)||fk(e,this.gapTo,this.to)))return Fi.fail("Structure gap-replace would overwrite content");let r=e.slice(this.gapFrom,this.gapTo);if(r.openStart||r.openEnd)return Fi.fail("Gap is not a flat range");let n=this.slice.insertAt(this.insert,r.content);return n?Fi.fromReplace(e,this.from,this.to,n):Fi.fail("Content does not fit in gap")}getMap(){return new fo([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(e){let r=this.gapTo-this.gapFrom;return new xa(this.from,this.from+this.slice.size+r,this.from+this.insert,this.from+this.insert+r,e.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(e){let r=e.mapResult(this.from,1),n=e.mapResult(this.to,-1),i=this.from==this.gapFrom?r.pos:e.map(this.gapFrom,-1),a=this.to==this.gapTo?n.pos:e.map(this.gapTo,1);return r.deletedAcross&&n.deletedAcross||i<r.pos||a>n.pos?null:new xa(r.pos,n.pos,i,a,this.slice,this.insert,this.structure)}toJSON(){let e={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,r){if(typeof r.from!="number"||typeof r.to!="number"||typeof r.gapFrom!="number"||typeof r.gapTo!="number"||typeof r.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new xa(r.from,r.to,r.gapFrom,r.gapTo,Mt.fromJSON(e,r.slice),r.insert,!!r.structure)}}hs.jsonID("replaceAround",xa);function fk(t,e,r){let n=t.resolve(e),i=r-e,a=n.depth;for(;i>0&&a>0&&n.indexAfter(a)==n.node(a).childCount;)a--,i--;if(i>0){let s=n.node(a).maybeChild(n.indexAfter(a));for(;i>0;){if(!s||s.isLeaf)return!0;s=s.firstChild,i--}}return!1}function mZ(t,e,r,n){let i=[],a=[],s,o;t.doc.nodesBetween(e,r,(l,u,c)=>{if(!l.isInline)return;let h=l.marks;if(!n.isInSet(h)&&c.type.allowsMarkType(n.type)){let p=Math.max(u,e),v=Math.min(u+l.nodeSize,r),y=n.addToSet(h);for(let S=0;S<h.length;S++)h[S].isInSet(y)||(s&&s.to==p&&s.mark.eq(h[S])?s.to=v:i.push(s=new Ml(p,v,h[S])));o&&o.to==p?o.to=v:a.push(o=new jd(p,v,n))}}),i.forEach(l=>t.step(l)),a.forEach(l=>t.step(l))}function gZ(t,e,r,n){let i=[],a=0;t.doc.nodesBetween(e,r,(s,o)=>{if(!s.isInline)return;a++;let l=null;if(n instanceof H1){let u=s.marks,c;for(;c=n.isInSet(u);)(l||(l=[])).push(c),u=c.removeFromSet(u)}else n?n.isInSet(s.marks)&&(l=[n]):l=s.marks;if(l&&l.length){let u=Math.min(o+s.nodeSize,r);for(let c=0;c<l.length;c++){let h=l[c],p;for(let v=0;v<i.length;v++){let y=i[v];y.step==a-1&&h.eq(i[v].style)&&(p=y)}p?(p.to=u,p.step=a):i.push({style:h,from:Math.max(o,e),to:u,step:a})}}}),i.forEach(s=>t.step(new Ml(s.from,s.to,s.style)))}function j_(t,e,r,n=r.contentMatch,i=!0){let a=t.doc.nodeAt(e),s=[],o=e+1;for(let l=0;l<a.childCount;l++){let u=a.child(l),c=o+u.nodeSize,h=n.matchType(u.type);if(!h)s.push(new ma(o,c,Mt.empty));else{n=h;for(let p=0;p<u.marks.length;p++)r.allowsMarkType(u.marks[p].type)||t.step(new Ml(o,c,u.marks[p]));if(i&&u.isText&&r.whitespace!="pre"){let p,v=/\r?\n|\r/g,y;for(;p=v.exec(u.text);)y||(y=new Mt(at.from(r.schema.text(" ",r.allowedMarks(u.marks))),0,0)),s.push(new ma(o+p.index,o+p.index+p[0].length,y))}}o=c}if(!n.validEnd){let l=n.fillBefore(at.empty,!0);t.replace(o,o,new Mt(l,0,0))}for(let l=s.length-1;l>=0;l--)t.step(s[l])}function vZ(t,e,r){return(e==0||t.canReplace(e,t.childCount))&&(r==t.childCount||t.canReplace(0,r))}function vm(t){let r=t.parent.content.cutByIndex(t.startIndex,t.endIndex);for(let n=t.depth,i=0,a=0;;--n){let s=t.$from.node(n),o=t.$from.index(n)+i,l=t.$to.indexAfter(n)-a;if(n<t.depth&&s.canReplace(o,l,r))return n;if(n==0||s.type.spec.isolating||!vZ(s,o,l))break;o&&(i=1),l<s.childCount&&(a=1)}return null}function yZ(t,e,r){let{$from:n,$to:i,depth:a}=e,s=n.before(a+1),o=i.after(a+1),l=s,u=o,c=at.empty,h=0;for(let y=a,S=!1;y>r;y--)S||n.index(y)>0?(S=!0,c=at.from(n.node(y).copy(c)),h++):l--;let p=at.empty,v=0;for(let y=a,S=!1;y>r;y--)S||i.after(y+1)<i.end(y)?(S=!0,p=at.from(i.node(y).copy(p)),v++):u++;t.step(new xa(l,u,s,o,new Mt(c.append(p),h,v),c.size-h,!0))}function F_(t,e,r=null,n=t){let i=xZ(t,e),a=i&&bZ(n,e);return a?i.map(k3).concat({type:e,attrs:r}).concat(a.map(k3)):null}function k3(t){return{type:t,attrs:null}}function xZ(t,e){let{parent:r,startIndex:n,endIndex:i}=t,a=r.contentMatchAt(n).findWrapping(e);if(!a)return null;let s=a.length?a[0]:e;return r.canReplaceWith(n,i,s)?a:null}function bZ(t,e){let{parent:r,startIndex:n,endIndex:i}=t,a=r.child(n),s=e.contentMatch.findWrapping(a.type);if(!s)return null;let l=(s.length?s[s.length-1]:e).contentMatch;for(let u=n;l&&u<i;u++)l=l.matchType(r.child(u).type);return!l||!l.validEnd?null:s}function wZ(t,e,r){let n=at.empty;for(let s=r.length-1;s>=0;s--){if(n.size){let o=r[s].type.contentMatch.matchFragment(n);if(!o||!o.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}n=at.from(r[s].type.create(r[s].attrs,n))}let i=e.start,a=e.end;t.step(new xa(i,a,i,a,new Mt(n,0,0),r.length,!0))}function SZ(t,e,r,n,i){if(!n.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let a=t.steps.length;t.doc.nodesBetween(e,r,(s,o)=>{let l=typeof i=="function"?i(s):i;if(s.isTextblock&&!s.hasMarkup(n,l)&&kZ(t.doc,t.mapping.slice(a).map(o),n)){let u=null;if(n.schema.linebreakReplacement){let v=n.whitespace=="pre",y=!!n.contentMatch.matchType(n.schema.linebreakReplacement);v&&!y?u=!1:!v&&y&&(u=!0)}u===!1&&$L(t,s,o,a),j_(t,t.mapping.slice(a).map(o,1),n,void 0,u===null);let c=t.mapping.slice(a),h=c.map(o,1),p=c.map(o+s.nodeSize,1);return t.step(new xa(h,p,h+1,p-1,new Mt(at.from(n.create(l,null,s.marks)),0,0),1,!0)),u===!0&&qL(t,s,o,a),!1}})}function qL(t,e,r,n){e.forEach((i,a)=>{if(i.isText){let s,o=/\r?\n|\r/g;for(;s=o.exec(i.text);){let l=t.mapping.slice(n).map(r+1+a+s.index);t.replaceWith(l,l+1,e.type.schema.linebreakReplacement.create())}}})}function $L(t,e,r,n){e.forEach((i,a)=>{if(i.type==i.type.schema.linebreakReplacement){let s=t.mapping.slice(n).map(r+1+a);t.replaceWith(s,s+1,e.type.schema.text(`
`))}})}function kZ(t,e,r){let n=t.resolve(e),i=n.index();return n.parent.canReplaceWith(i,i+1,r)}function _Z(t,e,r,n,i){let a=t.doc.nodeAt(e);if(!a)throw new RangeError("No node at given position");r||(r=a.type);let s=r.create(n,null,i||a.marks);if(a.isLeaf)return t.replaceWith(e,e+a.nodeSize,s);if(!r.validContent(a.content))throw new RangeError("Invalid content for node type "+r.name);t.step(new xa(e,e+a.nodeSize,e+1,e+a.nodeSize-1,new Mt(at.from(s),0,0),1,!0))}function pc(t,e,r=1,n){let i=t.resolve(e),a=i.depth-r,s=n&&n[n.length-1]||i.parent;if(a<0||i.parent.type.spec.isolating||!i.parent.canReplace(i.index(),i.parent.childCount)||!s.type.validContent(i.parent.content.cutByIndex(i.index(),i.parent.childCount)))return!1;for(let u=i.depth-1,c=r-2;u>a;u--,c--){let h=i.node(u),p=i.index(u);if(h.type.spec.isolating)return!1;let v=h.content.cutByIndex(p,h.childCount),y=n&&n[c+1];y&&(v=v.replaceChild(0,y.type.create(y.attrs)));let S=n&&n[c]||h;if(!h.canReplace(p+1,h.childCount)||!S.type.validContent(v))return!1}let o=i.indexAfter(a),l=n&&n[0];return i.node(a).canReplaceWith(o,o,l?l.type:i.node(a+1).type)}function CZ(t,e,r=1,n){let i=t.doc.resolve(e),a=at.empty,s=at.empty;for(let o=i.depth,l=i.depth-r,u=r-1;o>l;o--,u--){a=at.from(i.node(o).copy(a));let c=n&&n[u];s=at.from(c?c.type.create(c.attrs,s):i.node(o).copy(s))}t.step(new ma(e,e,new Mt(a.append(s),r,r),!0))}function hh(t,e){let r=t.resolve(e),n=r.index();return KL(r.nodeBefore,r.nodeAfter)&&r.parent.canReplace(n,n+1)}function EZ(t,e){e.content.size||t.type.compatibleContent(e.type);let r=t.contentMatchAt(t.childCount),{linebreakReplacement:n}=t.type.schema;for(let i=0;i<e.childCount;i++){let a=e.child(i),s=a.type==n?t.type.schema.nodes.text:a.type;if(r=r.matchType(s),!r||!t.type.allowsMarks(a.marks))return!1}return r.validEnd}function KL(t,e){return!!(t&&e&&!t.isLeaf&&EZ(t,e))}function W1(t,e,r=-1){let n=t.resolve(e);for(let i=n.depth;;i--){let a,s,o=n.index(i);if(i==n.depth?(a=n.nodeBefore,s=n.nodeAfter):r>0?(a=n.node(i+1),o++,s=n.node(i).maybeChild(o)):(a=n.node(i).maybeChild(o-1),s=n.node(i+1)),a&&!a.isTextblock&&KL(a,s)&&n.node(i).canReplace(o,o+1))return e;if(i==0)break;e=r<0?n.before(i):n.after(i)}}function TZ(t,e,r){let n=null,{linebreakReplacement:i}=t.doc.type.schema,a=t.doc.resolve(e-r),s=a.node().type;if(i&&s.inlineContent){let c=s.whitespace=="pre",h=!!s.contentMatch.matchType(i);c&&!h?n=!1:!c&&h&&(n=!0)}let o=t.steps.length;if(n===!1){let c=t.doc.resolve(e+r);$L(t,c.node(),c.before(),o)}s.inlineContent&&j_(t,e+r-1,s,a.node().contentMatchAt(a.index()),n==null);let l=t.mapping.slice(o),u=l.map(e-r);if(t.step(new ma(u,l.map(e+r,-1),Mt.empty,!0)),n===!0){let c=t.doc.resolve(u);qL(t,c.node(),c.before(),t.steps.length)}return t}function NZ(t,e,r){let n=t.resolve(e);if(n.parent.canReplaceWith(n.index(),n.index(),r))return e;if(n.parentOffset==0)for(let i=n.depth-1;i>=0;i--){let a=n.index(i);if(n.node(i).canReplaceWith(a,a,r))return n.before(i+1);if(a>0)return null}if(n.parentOffset==n.parent.content.size)for(let i=n.depth-1;i>=0;i--){let a=n.indexAfter(i);if(n.node(i).canReplaceWith(a,a,r))return n.after(i+1);if(a<n.node(i).childCount)return null}return null}function ZL(t,e,r){let n=t.resolve(e);if(!r.content.size)return e;let i=r.content;for(let a=0;a<r.openStart;a++)i=i.firstChild.content;for(let a=1;a<=(r.openStart==0&&r.size?2:1);a++)for(let s=n.depth;s>=0;s--){let o=s==n.depth?0:n.pos<=(n.start(s+1)+n.end(s+1))/2?-1:1,l=n.index(s)+(o>0?1:0),u=n.node(s),c=!1;if(a==1)c=u.canReplace(l,l,i);else{let h=u.contentMatchAt(l).findWrapping(i.firstChild.type);c=h&&u.canReplaceWith(l,l,h[0])}if(c)return o==0?n.pos:o<0?n.before(s+1):n.after(s+1)}return null}function q1(t,e,r=e,n=Mt.empty){if(e==r&&!n.size)return null;let i=t.resolve(e),a=t.resolve(r);return YL(i,a,n)?new ma(e,r,n):new PZ(i,a,n).fit()}function YL(t,e,r){return!r.openStart&&!r.openEnd&&t.start()==e.start()&&t.parent.canReplace(t.index(),e.index(),r.content)}class PZ{constructor(e,r,n){this.$from=e,this.$to=r,this.unplaced=n,this.frontier=[],this.placed=at.empty;for(let i=0;i<=e.depth;i++){let a=e.node(i);this.frontier.push({type:a.type,match:a.contentMatchAt(e.indexAfter(i))})}for(let i=e.depth;i>0;i--)this.placed=at.from(e.node(i).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let u=this.findFittable();u?this.placeNodes(u):this.openMore()||this.dropNode()}let e=this.mustMoveInline(),r=this.placed.size-this.depth-this.$from.depth,n=this.$from,i=this.close(e<0?this.$to:n.doc.resolve(e));if(!i)return null;let a=this.placed,s=n.depth,o=i.depth;for(;s&&o&&a.childCount==1;)a=a.firstChild.content,s--,o--;let l=new Mt(a,s,o);return e>-1?new xa(n.pos,e,this.$to.pos,this.$to.end(),l,r):l.size||n.pos!=this.$to.pos?new ma(n.pos,i.pos,l):null}findFittable(){let e=this.unplaced.openStart;for(let r=this.unplaced.content,n=0,i=this.unplaced.openEnd;n<e;n++){let a=r.firstChild;if(r.childCount>1&&(i=0),a.type.spec.isolating&&i<=n){e=n;break}r=a.content}for(let r=1;r<=2;r++)for(let n=r==1?e:this.unplaced.openStart;n>=0;n--){let i,a=null;n?(a=X2(this.unplaced.content,n-1).firstChild,i=a.content):i=this.unplaced.content;let s=i.firstChild;for(let o=this.depth;o>=0;o--){let{type:l,match:u}=this.frontier[o],c,h=null;if(r==1&&(s?u.matchType(s.type)||(h=u.fillBefore(at.from(s),!1)):a&&l.compatibleContent(a.type)))return{sliceDepth:n,frontierDepth:o,parent:a,inject:h};if(r==2&&s&&(c=u.findWrapping(s.type)))return{sliceDepth:n,frontierDepth:o,parent:a,wrap:c};if(a&&u.matchType(a.type))break}}}openMore(){let{content:e,openStart:r,openEnd:n}=this.unplaced,i=X2(e,r);return!i.childCount||i.firstChild.isLeaf?!1:(this.unplaced=new Mt(e,r+1,Math.max(n,i.size+r>=e.size-n?r+1:0)),!0)}dropNode(){let{content:e,openStart:r,openEnd:n}=this.unplaced,i=X2(e,r);if(i.childCount<=1&&r>0){let a=e.size-r<=r+i.size;this.unplaced=new Mt(Zg(e,r-1,1),r-1,a?r-1:n)}else this.unplaced=new Mt(Zg(e,r,1),r,n)}placeNodes({sliceDepth:e,frontierDepth:r,parent:n,inject:i,wrap:a}){for(;this.depth>r;)this.closeFrontierNode();if(a)for(let S=0;S<a.length;S++)this.openFrontierNode(a[S]);let s=this.unplaced,o=n?n.content:s.content,l=s.openStart-e,u=0,c=[],{match:h,type:p}=this.frontier[r];if(i){for(let S=0;S<i.childCount;S++)c.push(i.child(S));h=h.matchFragment(i)}let v=o.size+e-(s.content.size-s.openEnd);for(;u<o.childCount;){let S=o.child(u),w=h.matchType(S.type);if(!w)break;u++,(u>1||l==0||S.content.size)&&(h=w,c.push(XL(S.mark(p.allowedMarks(S.marks)),u==1?l:0,u==o.childCount?v:-1)))}let y=u==o.childCount;y||(v=-1),this.placed=Yg(this.placed,r,at.from(c)),this.frontier[r].match=h,y&&v<0&&n&&n.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let S=0,w=o;S<v;S++){let T=w.lastChild;this.frontier.push({type:T.type,match:T.contentMatchAt(T.childCount)}),w=T.content}this.unplaced=y?e==0?Mt.empty:new Mt(Zg(s.content,e-1,1),e-1,v<0?s.openEnd:e-1):new Mt(Zg(s.content,e,u),s.openStart,s.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let e=this.frontier[this.depth],r;if(!e.type.isTextblock||!Q2(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(r=this.findCloseLevel(this.$to))&&r.depth==this.depth)return-1;let{depth:n}=this.$to,i=this.$to.after(n);for(;n>1&&i==this.$to.end(--n);)++i;return i}findCloseLevel(e){e:for(let r=Math.min(this.depth,e.depth);r>=0;r--){let{match:n,type:i}=this.frontier[r],a=r<e.depth&&e.end(r+1)==e.pos+(e.depth-(r+1)),s=Q2(e,r,i,n,a);if(s){for(let o=r-1;o>=0;o--){let{match:l,type:u}=this.frontier[o],c=Q2(e,o,u,l,!0);if(!c||c.childCount)continue e}return{depth:r,fit:s,move:a?e.doc.resolve(e.after(r+1)):e}}}}close(e){let r=this.findCloseLevel(e);if(!r)return null;for(;this.depth>r.depth;)this.closeFrontierNode();r.fit.childCount&&(this.placed=Yg(this.placed,r.depth,r.fit)),e=r.move;for(let n=r.depth+1;n<=e.depth;n++){let i=e.node(n),a=i.type.contentMatch.fillBefore(i.content,!0,e.index(n));this.openFrontierNode(i.type,i.attrs,a)}return e}openFrontierNode(e,r=null,n){let i=this.frontier[this.depth];i.match=i.match.matchType(e),this.placed=Yg(this.placed,this.depth,at.from(e.create(r,n))),this.frontier.push({type:e,match:e.contentMatch})}closeFrontierNode(){let r=this.frontier.pop().match.fillBefore(at.empty,!0);r.childCount&&(this.placed=Yg(this.placed,this.frontier.length,r))}}function Zg(t,e,r){return e==0?t.cutByIndex(r,t.childCount):t.replaceChild(0,t.firstChild.copy(Zg(t.firstChild.content,e-1,r)))}function Yg(t,e,r){return e==0?t.append(r):t.replaceChild(t.childCount-1,t.lastChild.copy(Yg(t.lastChild.content,e-1,r)))}function X2(t,e){for(let r=0;r<e;r++)t=t.firstChild.content;return t}function XL(t,e,r){if(e<=0)return t;let n=t.content;return e>1&&(n=n.replaceChild(0,XL(n.firstChild,e-1,n.childCount==1?r-1:0))),e>0&&(n=t.type.contentMatch.fillBefore(n).append(n),r<=0&&(n=n.append(t.type.contentMatch.matchFragment(n).fillBefore(at.empty,!0)))),t.copy(n)}function Q2(t,e,r,n,i){let a=t.node(e),s=i?t.indexAfter(e):t.index(e);if(s==a.childCount&&!r.compatibleContent(a.type))return null;let o=n.fillBefore(a.content,!0,s);return o&&!MZ(r,a.content,s)?o:null}function MZ(t,e,r){for(let n=r;n<e.childCount;n++)if(!t.allowsMarks(e.child(n).marks))return!0;return!1}function AZ(t){return t.spec.defining||t.spec.definingForContent}function RZ(t,e,r,n){if(!n.size)return t.deleteRange(e,r);let i=t.doc.resolve(e),a=t.doc.resolve(r);if(YL(i,a,n))return t.step(new ma(e,r,n));let s=JL(i,a);s[s.length-1]==0&&s.pop();let o=-(i.depth+1);s.unshift(o);for(let p=i.depth,v=i.pos-1;p>0;p--,v--){let y=i.node(p).type.spec;if(y.defining||y.definingAsContext||y.isolating)break;s.indexOf(p)>-1?o=p:i.before(p)==v&&s.splice(1,0,-p)}let l=s.indexOf(o),u=[],c=n.openStart;for(let p=n.content,v=0;;v++){let y=p.firstChild;if(u.push(y),v==n.openStart)break;p=y.content}for(let p=c-1;p>=0;p--){let v=u[p],y=AZ(v.type);if(y&&!v.sameMarkup(i.node(Math.abs(o)-1)))c=p;else if(y||!v.type.isTextblock)break}for(let p=n.openStart;p>=0;p--){let v=(p+c+1)%(n.openStart+1),y=u[v];if(y)for(let S=0;S<s.length;S++){let w=s[(S+l)%s.length],T=!0;w<0&&(T=!1,w=-w);let _=i.node(w-1),C=i.index(w-1);if(_.canReplaceWith(C,C,y.type,y.marks))return t.replace(i.before(w),T?a.after(w):r,new Mt(QL(n.content,0,n.openStart,v),v,n.openEnd))}}let h=t.steps.length;for(let p=s.length-1;p>=0&&(t.replace(e,r,n),!(t.steps.length>h));p--){let v=s[p];v<0||(e=i.before(v),r=a.after(v))}}function QL(t,e,r,n,i){if(e<r){let a=t.firstChild;t=t.replaceChild(0,a.copy(QL(a.content,e+1,r,n,a)))}if(e>n){let a=i.contentMatchAt(0),s=a.fillBefore(t).append(t);t=s.append(a.matchFragment(s).fillBefore(at.empty,!0))}return t}function LZ(t,e,r,n){if(!n.isInline&&e==r&&t.doc.resolve(e).parent.content.size){let i=NZ(t.doc,e,n.type);i!=null&&(e=r=i)}t.replaceRange(e,r,new Mt(at.from(n),0,0))}function OZ(t,e,r){let n=t.doc.resolve(e),i=t.doc.resolve(r),a=JL(n,i);for(let s=0;s<a.length;s++){let o=a[s],l=s==a.length-1;if(l&&o==0||n.node(o).type.contentMatch.validEnd)return t.delete(n.start(o),i.end(o));if(o>0&&(l||n.node(o-1).canReplace(n.index(o-1),i.indexAfter(o-1))))return t.delete(n.before(o),i.after(o))}for(let s=1;s<=n.depth&&s<=i.depth;s++)if(e-n.start(s)==n.depth-s&&r>n.end(s)&&i.end(s)-r!=i.depth-s&&n.start(s-1)==i.start(s-1)&&n.node(s-1).canReplace(n.index(s-1),i.index(s-1)))return t.delete(n.before(s),r);t.delete(e,r)}function JL(t,e){let r=[],n=Math.min(t.depth,e.depth);for(let i=n;i>=0;i--){let a=t.start(i);if(a<t.pos-(t.depth-i)||e.end(i)>e.pos+(e.depth-i)||t.node(i).type.spec.isolating||e.node(i).type.spec.isolating)break;(a==e.start(i)||i==t.depth&&i==e.depth&&t.parent.inlineContent&&e.parent.inlineContent&&i&&e.start(i-1)==a-1)&&r.push(i)}return r}class Gp extends hs{constructor(e,r,n){super(),this.pos=e,this.attr=r,this.value=n}apply(e){let r=e.nodeAt(this.pos);if(!r)return Fi.fail("No node at attribute step's position");let n=Object.create(null);for(let a in r.attrs)n[a]=r.attrs[a];n[this.attr]=this.value;let i=r.type.create(n,null,r.marks);return Fi.fromReplace(e,this.pos,this.pos+1,new Mt(at.from(i),0,r.isLeaf?0:1))}getMap(){return fo.empty}invert(e){return new Gp(this.pos,this.attr,e.nodeAt(this.pos).attrs[this.attr])}map(e){let r=e.mapResult(this.pos,1);return r.deletedAfter?null:new Gp(r.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(e,r){if(typeof r.pos!="number"||typeof r.attr!="string")throw new RangeError("Invalid input for AttrStep.fromJSON");return new Gp(r.pos,r.attr,r.value)}}hs.jsonID("attr",Gp);class Dv extends hs{constructor(e,r){super(),this.attr=e,this.value=r}apply(e){let r=Object.create(null);for(let i in e.attrs)r[i]=e.attrs[i];r[this.attr]=this.value;let n=e.type.create(r,e.content,e.marks);return Fi.ok(n)}getMap(){return fo.empty}invert(e){return new Dv(this.attr,e.attrs[this.attr])}map(e){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(e,r){if(typeof r.attr!="string")throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new Dv(r.attr,r.value)}}hs.jsonID("docAttr",Dv);let Zp=class extends Error{};Zp=function t(e){let r=Error.call(this,e);return r.__proto__=t.prototype,r};Zp.prototype=Object.create(Error.prototype);Zp.prototype.constructor=Zp;Zp.prototype.name="TransformError";class eO{constructor(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new Ov}get before(){return this.docs.length?this.docs[0]:this.doc}step(e){let r=this.maybeStep(e);if(r.failed)throw new Zp(r.failed);return this}maybeStep(e){let r=e.apply(this.doc);return r.failed||this.addStep(e,r.doc),r}get docChanged(){return this.steps.length>0}changedRange(){let e=1e9,r=-1e9;for(let n=0;n<this.mapping.maps.length;n++){let i=this.mapping.maps[n];n&&(e=i.map(e,1),r=i.map(r,-1)),i.forEach((a,s,o,l)=>{e=Math.min(e,o),r=Math.max(r,l)})}return e==1e9?null:{from:e,to:r}}addStep(e,r){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=r}replace(e,r=e,n=Mt.empty){let i=q1(this.doc,e,r,n);return i&&this.step(i),this}replaceWith(e,r,n){return this.replace(e,r,new Mt(at.from(n),0,0))}delete(e,r){return this.replace(e,r,Mt.empty)}insert(e,r){return this.replaceWith(e,e,r)}replaceRange(e,r,n){return RZ(this,e,r,n),this}replaceRangeWith(e,r,n){return LZ(this,e,r,n),this}deleteRange(e,r){return OZ(this,e,r),this}lift(e,r){return yZ(this,e,r),this}join(e,r=1){return TZ(this,e,r),this}wrap(e,r){return wZ(this,e,r),this}setBlockType(e,r=e,n,i=null){return SZ(this,e,r,n,i),this}setNodeMarkup(e,r,n=null,i){return _Z(this,e,r,n,i),this}setNodeAttribute(e,r,n){return this.step(new Gp(e,r,n)),this}setDocAttribute(e,r){return this.step(new Dv(e,r)),this}addNodeMark(e,r){return this.step(new Fd(e,r)),this}removeNodeMark(e,r){let n=this.doc.nodeAt(e);if(!n)throw new RangeError("No node at position "+e);if(r instanceof yn)r.isInSet(n.marks)&&this.step(new Sf(e,r));else{let i=n.marks,a,s=[];for(;a=r.isInSet(i);)s.push(new Sf(e,a)),i=a.removeFromSet(i);for(let o=s.length-1;o>=0;o--)this.step(s[o])}return this}split(e,r=1,n){return CZ(this,e,r,n),this}addMark(e,r,n){return mZ(this,e,r,n),this}removeMark(e,r,n){return gZ(this,e,r,n),this}clearIncompatible(e,r,n){return j_(this,e,r,n),this}}const J2=Object.create(null);class _r{constructor(e,r,n){this.$anchor=e,this.$head=r,this.ranges=n||[new DZ(e.min(r),e.max(r))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let r=0;r<e.length;r++)if(e[r].$from.pos!=e[r].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,r=Mt.empty){let n=r.content.lastChild,i=null;for(let o=0;o<r.openEnd;o++)i=n,n=n.lastChild;let a=e.steps.length,s=this.ranges;for(let o=0;o<s.length;o++){let{$from:l,$to:u}=s[o],c=e.mapping.slice(a);e.replaceRange(c.map(l.pos),c.map(u.pos),o?Mt.empty:r),o==0&&E3(e,a,(n?n.isInline:i&&i.isTextblock)?-1:1)}}replaceWith(e,r){let n=e.steps.length,i=this.ranges;for(let a=0;a<i.length;a++){let{$from:s,$to:o}=i[a],l=e.mapping.slice(n),u=l.map(s.pos),c=l.map(o.pos);a?e.deleteRange(u,c):(e.replaceRangeWith(u,c,r),E3(e,n,r.isInline?-1:1))}}static findFrom(e,r,n=!1){let i=e.parent.inlineContent?new dr(e):Tp(e.node(0),e.parent,e.pos,e.index(),r,n);if(i)return i;for(let a=e.depth-1;a>=0;a--){let s=r<0?Tp(e.node(0),e.node(a),e.before(a+1),e.index(a),r,n):Tp(e.node(0),e.node(a),e.after(a+1),e.index(a)+1,r,n);if(s)return s}return null}static near(e,r=1){return this.findFrom(e,r)||this.findFrom(e,-r)||new mo(e.node(0))}static atStart(e){return Tp(e,e,0,0,1)||new mo(e)}static atEnd(e){return Tp(e,e,e.content.size,e.childCount,-1)||new mo(e)}static fromJSON(e,r){if(!r||!r.type)throw new RangeError("Invalid input for Selection.fromJSON");let n=J2[r.type];if(!n)throw new RangeError(`No selection type ${r.type} defined`);return n.fromJSON(e,r)}static jsonID(e,r){if(e in J2)throw new RangeError("Duplicate use of selection JSON ID "+e);return J2[e]=r,r.prototype.jsonID=e,r}getBookmark(){return dr.between(this.$anchor,this.$head).getBookmark()}}_r.prototype.visible=!0;class DZ{constructor(e,r){this.$from=e,this.$to=r}}let _3=!1;function C3(t){!_3&&!t.parent.inlineContent&&(_3=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+t.parent.type.name+")"))}class dr extends _r{constructor(e,r=e){C3(e),C3(r),super(e,r)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(e,r){let n=e.resolve(r.map(this.head));if(!n.parent.inlineContent)return _r.near(n);let i=e.resolve(r.map(this.anchor));return new dr(i.parent.inlineContent?i:n,n)}replace(e,r=Mt.empty){if(super.replace(e,r),r==Mt.empty){let n=this.$from.marksAcross(this.$to);n&&e.ensureMarks(n)}}eq(e){return e instanceof dr&&e.anchor==this.anchor&&e.head==this.head}getBookmark(){return new $1(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(e,r){if(typeof r.anchor!="number"||typeof r.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new dr(e.resolve(r.anchor),e.resolve(r.head))}static create(e,r,n=r){let i=e.resolve(r);return new this(i,n==r?i:e.resolve(n))}static between(e,r,n){let i=e.pos-r.pos;if((!n||i)&&(n=i>=0?1:-1),!r.parent.inlineContent){let a=_r.findFrom(r,n,!0)||_r.findFrom(r,-n,!0);if(a)r=a.$head;else return _r.near(r,n)}return e.parent.inlineContent||(i==0?e=r:(e=(_r.findFrom(e,-n,!0)||_r.findFrom(e,n,!0)).$anchor,e.pos<r.pos!=i<0&&(e=r))),new dr(e,r)}}_r.jsonID("text",dr);class $1{constructor(e,r){this.anchor=e,this.head=r}map(e){return new $1(e.map(this.anchor),e.map(this.head))}resolve(e){return dr.between(e.resolve(this.anchor),e.resolve(this.head))}}class Zt extends _r{constructor(e){let r=e.nodeAfter,n=e.node(0).resolve(e.pos+r.nodeSize);super(e,n),this.node=r}map(e,r){let{deleted:n,pos:i}=r.mapResult(this.anchor),a=e.resolve(i);return n?_r.near(a):new Zt(a)}content(){return new Mt(at.from(this.node),0,0)}eq(e){return e instanceof Zt&&e.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new B_(this.anchor)}static fromJSON(e,r){if(typeof r.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new Zt(e.resolve(r.anchor))}static create(e,r){return new Zt(e.resolve(r))}static isSelectable(e){return!e.isText&&e.type.spec.selectable!==!1}}Zt.prototype.visible=!1;_r.jsonID("node",Zt);class B_{constructor(e){this.anchor=e}map(e){let{deleted:r,pos:n}=e.mapResult(this.anchor);return r?new $1(n,n):new B_(n)}resolve(e){let r=e.resolve(this.anchor),n=r.nodeAfter;return n&&Zt.isSelectable(n)?new Zt(r):_r.near(r)}}class mo extends _r{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,r=Mt.empty){if(r==Mt.empty){e.delete(0,e.doc.content.size);let n=_r.atStart(e.doc);n.eq(e.selection)||e.setSelection(n)}else super.replace(e,r)}toJSON(){return{type:"all"}}static fromJSON(e){return new mo(e)}map(e){return new mo(e)}eq(e){return e instanceof mo}getBookmark(){return IZ}}_r.jsonID("all",mo);const IZ={map(){return this},resolve(t){return new mo(t)}};function Tp(t,e,r,n,i,a=!1){if(e.inlineContent)return dr.create(t,r);for(let s=n-(i>0?0:1);i>0?s<e.childCount:s>=0;s+=i){let o=e.child(s);if(o.isAtom){if(!a&&Zt.isSelectable(o))return Zt.create(t,r-(i<0?o.nodeSize:0))}else{let l=Tp(t,o,r+i,i<0?o.childCount:0,i,a);if(l)return l}r+=o.nodeSize*i}return null}function E3(t,e,r){let n=t.steps.length-1;if(n<e)return;let i=t.steps[n];if(!(i instanceof ma||i instanceof xa))return;let a=t.mapping.maps[n],s;a.forEach((o,l,u,c)=>{s==null&&(s=c)}),t.setSelection(_r.near(t.doc.resolve(s),r))}const T3=1,wy=2,N3=4;class jZ extends eO{constructor(e){super(e.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=e.selection,this.storedMarks=e.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(e){if(e.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=e,this.curSelectionFor=this.steps.length,this.updated=(this.updated|T3)&~wy,this.storedMarks=null,this}get selectionSet(){return(this.updated&T3)>0}setStoredMarks(e){return this.storedMarks=e,this.updated|=wy,this}ensureMarks(e){return yn.sameSet(this.storedMarks||this.selection.$from.marks(),e)||this.setStoredMarks(e),this}addStoredMark(e){return this.ensureMarks(e.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(e){return this.ensureMarks(e.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(this.updated&wy)>0}addStep(e,r){super.addStep(e,r),this.updated=this.updated&~wy,this.storedMarks=null}setTime(e){return this.time=e,this}replaceSelection(e){return this.selection.replace(this,e),this}replaceSelectionWith(e,r=!0){let n=this.selection;return r&&(e=e.mark(this.storedMarks||(n.empty?n.$from.marks():n.$from.marksAcross(n.$to)||yn.none))),n.replaceWith(this,e),this}deleteSelection(){return this.selection.replace(this),this}insertText(e,r,n){let i=this.doc.type.schema;if(r==null)return e?this.replaceSelectionWith(i.text(e),!0):this.deleteSelection();{if(n==null&&(n=r),!e)return this.deleteRange(r,n);let a=this.storedMarks;if(!a){let s=this.doc.resolve(r);a=n==r?s.marks():s.marksAcross(this.doc.resolve(n))}return this.replaceRangeWith(r,n,i.text(e,a)),!this.selection.empty&&this.selection.to==r+e.length&&this.setSelection(_r.near(this.selection.$to)),this}}setMeta(e,r){return this.meta[typeof e=="string"?e:e.key]=r,this}getMeta(e){return this.meta[typeof e=="string"?e:e.key]}get isGeneric(){for(let e in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=N3,this}get scrolledIntoView(){return(this.updated&N3)>0}}function P3(t,e){return!e||!t?t:t.bind(e)}class Xg{constructor(e,r,n){this.name=e,this.init=P3(r.init,n),this.apply=P3(r.apply,n)}}const FZ=[new Xg("doc",{init(t){return t.doc||t.schema.topNodeType.createAndFill()},apply(t){return t.doc}}),new Xg("selection",{init(t,e){return t.selection||_r.atStart(e.doc)},apply(t){return t.selection}}),new Xg("storedMarks",{init(t){return t.storedMarks||null},apply(t,e,r,n){return n.selection.$cursor?t.storedMarks:null}}),new Xg("scrollToSelection",{init(){return 0},apply(t,e){return t.scrolledIntoView?e+1:e}})];class eS{constructor(e,r){this.schema=e,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=FZ.slice(),r&&r.forEach(n=>{if(this.pluginsByKey[n.key])throw new RangeError("Adding different instances of a keyed plugin ("+n.key+")");this.plugins.push(n),this.pluginsByKey[n.key]=n,n.spec.state&&this.fields.push(new Xg(n.key,n.spec.state,n))})}}class Dp{constructor(e){this.config=e}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(e){return this.applyTransaction(e).state}filterTransaction(e,r=-1){for(let n=0;n<this.config.plugins.length;n++)if(n!=r){let i=this.config.plugins[n];if(i.spec.filterTransaction&&!i.spec.filterTransaction.call(i,e,this))return!1}return!0}applyTransaction(e){if(!this.filterTransaction(e))return{state:this,transactions:[]};let r=[e],n=this.applyInner(e),i=null;for(;;){let a=!1;for(let s=0;s<this.config.plugins.length;s++){let o=this.config.plugins[s];if(o.spec.appendTransaction){let l=i?i[s].n:0,u=i?i[s].state:this,c=l<r.length&&o.spec.appendTransaction.call(o,l?r.slice(l):r,u,n);if(c&&n.filterTransaction(c,s)){if(c.setMeta("appendedTransaction",e),!i){i=[];for(let h=0;h<this.config.plugins.length;h++)i.push(h<s?{state:n,n:r.length}:{state:this,n:0})}r.push(c),n=n.applyInner(c),a=!0}i&&(i[s]={state:n,n:r.length})}}if(!a)return{state:n,transactions:r}}}applyInner(e){if(!e.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");let r=new Dp(this.config),n=this.config.fields;for(let i=0;i<n.length;i++){let a=n[i];r[a.name]=a.apply(e,this[a.name],this,r)}return r}get tr(){return new jZ(this)}static create(e){let r=new eS(e.doc?e.doc.type.schema:e.schema,e.plugins),n=new Dp(r);for(let i=0;i<r.fields.length;i++)n[r.fields[i].name]=r.fields[i].init(e,n);return n}reconfigure(e){let r=new eS(this.schema,e.plugins),n=r.fields,i=new Dp(r);for(let a=0;a<n.length;a++){let s=n[a].name;i[s]=this.hasOwnProperty(s)?this[s]:n[a].init(e,i)}return i}toJSON(e){let r={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(r.storedMarks=this.storedMarks.map(n=>n.toJSON())),e&&typeof e=="object")for(let n in e){if(n=="doc"||n=="selection")throw new RangeError("The JSON fields `doc` and `selection` are reserved");let i=e[n],a=i.spec.state;a&&a.toJSON&&(r[n]=a.toJSON.call(i,this[i.key]))}return r}static fromJSON(e,r,n){if(!r)throw new RangeError("Invalid input for EditorState.fromJSON");if(!e.schema)throw new RangeError("Required config field 'schema' missing");let i=new eS(e.schema,e.plugins),a=new Dp(i);return i.fields.forEach(s=>{if(s.name=="doc")a.doc=qo.fromJSON(e.schema,r.doc);else if(s.name=="selection")a.selection=_r.fromJSON(a.doc,r.selection);else if(s.name=="storedMarks")r.storedMarks&&(a.storedMarks=r.storedMarks.map(e.schema.markFromJSON));else{if(n)for(let o in n){let l=n[o],u=l.spec.state;if(l.key==s.name&&u&&u.fromJSON&&Object.prototype.hasOwnProperty.call(r,o)){a[s.name]=u.fromJSON.call(l,e,r[o],a);return}}a[s.name]=s.init(e,a)}}),a}}function tO(t,e,r){for(let n in t){let i=t[n];i instanceof Function?i=i.bind(e):n=="handleDOMEvents"&&(i=tO(i,e,{})),r[n]=i}return r}class Xn{constructor(e){this.spec=e,this.props={},e.props&&tO(e.props,this,this.props),this.key=e.key?e.key.key:rO("plugin")}getState(e){return e[this.key]}}const tS=Object.create(null);function rO(t){return t in tS?t+"$"+ ++tS[t]:(tS[t]=0,t+"$")}class Ni{constructor(e="key"){this.key=rO(e)}get(e){return e.config.pluginsByKey[this.key]}getState(e){return e[this.key]}}const z_=(t,e)=>t.selection.empty?!1:(e&&e(t.tr.deleteSelection().scrollIntoView()),!0);function nO(t,e){let{$cursor:r}=t.selection;return!r||(e?!e.endOfTextblock("backward",t):r.parentOffset>0)?null:r}const iO=(t,e,r)=>{let n=nO(t,r);if(!n)return!1;let i=U_(n);if(!i){let s=n.blockRange(),o=s&&vm(s);return o==null?!1:(e&&e(t.tr.lift(s,o).scrollIntoView()),!0)}let a=i.nodeBefore;if(fO(t,i,e,-1))return!0;if(n.parent.content.size==0&&(Yp(a,"end")||Zt.isSelectable(a)))for(let s=n.depth;;s--){let o=q1(t.doc,n.before(s),n.after(s),Mt.empty);if(o&&o.slice.size<o.to-o.from){if(e){let l=t.tr.step(o);l.setSelection(Yp(a,"end")?_r.findFrom(l.doc.resolve(l.mapping.map(i.pos,-1)),-1):Zt.create(l.doc,i.pos-a.nodeSize)),e(l.scrollIntoView())}return!0}if(s==1||n.node(s-1).childCount>1)break}return a.isAtom&&i.depth==n.depth-1?(e&&e(t.tr.delete(i.pos-a.nodeSize,i.pos).scrollIntoView()),!0):!1},BZ=(t,e,r)=>{let n=nO(t,r);if(!n)return!1;let i=U_(n);return i?aO(t,i,e):!1},zZ=(t,e,r)=>{let n=oO(t,r);if(!n)return!1;let i=G_(n);return i?aO(t,i,e):!1};function aO(t,e,r){let n=e.nodeBefore,i=n,a=e.pos-1;for(;!i.isTextblock;a--){if(i.type.spec.isolating)return!1;let c=i.lastChild;if(!c)return!1;i=c}let s=e.nodeAfter,o=s,l=e.pos+1;for(;!o.isTextblock;l++){if(o.type.spec.isolating)return!1;let c=o.firstChild;if(!c)return!1;o=c}let u=q1(t.doc,a,l,Mt.empty);if(!u||u.from!=a||u instanceof ma&&u.slice.size>=l-a)return!1;if(r){let c=t.tr.step(u);c.setSelection(dr.create(c.doc,a)),r(c.scrollIntoView())}return!0}function Yp(t,e,r=!1){for(let n=t;n;n=e=="start"?n.firstChild:n.lastChild){if(n.isTextblock)return!0;if(r&&n.childCount!=1)return!1}return!1}const sO=(t,e,r)=>{let{$head:n,empty:i}=t.selection,a=n;if(!i)return!1;if(n.parent.isTextblock){if(r?!r.endOfTextblock("backward",t):n.parentOffset>0)return!1;a=U_(n)}let s=a&&a.nodeBefore;return!s||!Zt.isSelectable(s)?!1:(e&&e(t.tr.setSelection(Zt.create(t.doc,a.pos-s.nodeSize)).scrollIntoView()),!0)};function U_(t){if(!t.parent.type.spec.isolating)for(let e=t.depth-1;e>=0;e--){if(t.index(e)>0)return t.doc.resolve(t.before(e+1));if(t.node(e).type.spec.isolating)break}return null}function oO(t,e){let{$cursor:r}=t.selection;return!r||(e?!e.endOfTextblock("forward",t):r.parentOffset<r.parent.content.size)?null:r}const lO=(t,e,r)=>{let n=oO(t,r);if(!n)return!1;let i=G_(n);if(!i)return!1;let a=i.nodeAfter;if(fO(t,i,e,1))return!0;if(n.parent.content.size==0&&(Yp(a,"start")||Zt.isSelectable(a))){let s=q1(t.doc,n.before(),n.after(),Mt.empty);if(s&&s.slice.size<s.to-s.from){if(e){let o=t.tr.step(s);o.setSelection(Yp(a,"start")?_r.findFrom(o.doc.resolve(o.mapping.map(i.pos)),1):Zt.create(o.doc,o.mapping.map(i.pos))),e(o.scrollIntoView())}return!0}}return a.isAtom&&i.depth==n.depth-1?(e&&e(t.tr.delete(i.pos,i.pos+a.nodeSize).scrollIntoView()),!0):!1},uO=(t,e,r)=>{let{$head:n,empty:i}=t.selection,a=n;if(!i)return!1;if(n.parent.isTextblock){if(r?!r.endOfTextblock("forward",t):n.parentOffset<n.parent.content.size)return!1;a=G_(n)}let s=a&&a.nodeAfter;return!s||!Zt.isSelectable(s)?!1:(e&&e(t.tr.setSelection(Zt.create(t.doc,a.pos)).scrollIntoView()),!0)};function G_(t){if(!t.parent.type.spec.isolating)for(let e=t.depth-1;e>=0;e--){let r=t.node(e);if(t.index(e)+1<r.childCount)return t.doc.resolve(t.after(e+1));if(r.type.spec.isolating)break}return null}const UZ=(t,e)=>{let r=t.selection,n=r instanceof Zt,i;if(n){if(r.node.isTextblock||!hh(t.doc,r.from))return!1;i=r.from}else if(i=W1(t.doc,r.from,-1),i==null)return!1;if(e){let a=t.tr.join(i);n&&a.setSelection(Zt.create(a.doc,i-t.doc.resolve(i).nodeBefore.nodeSize)),e(a.scrollIntoView())}return!0},GZ=(t,e)=>{let r=t.selection,n;if(r instanceof Zt){if(r.node.isTextblock||!hh(t.doc,r.to))return!1;n=r.to}else if(n=W1(t.doc,r.to,1),n==null)return!1;return e&&e(t.tr.join(n).scrollIntoView()),!0},VZ=(t,e)=>{let{$from:r,$to:n}=t.selection,i=r.blockRange(n),a=i&&vm(i);return a==null?!1:(e&&e(t.tr.lift(i,a).scrollIntoView()),!0)},cO=(t,e)=>{let{$head:r,$anchor:n}=t.selection;return!r.parent.type.spec.code||!r.sameParent(n)?!1:(e&&e(t.tr.insertText(`
`).scrollIntoView()),!0)};function V_(t){for(let e=0;e<t.edgeCount;e++){let{type:r}=t.edge(e);if(r.isTextblock&&!r.hasRequiredAttrs())return r}return null}const HZ=(t,e)=>{let{$head:r,$anchor:n}=t.selection;if(!r.parent.type.spec.code||!r.sameParent(n))return!1;let i=r.node(-1),a=r.indexAfter(-1),s=V_(i.contentMatchAt(a));if(!s||!i.canReplaceWith(a,a,s))return!1;if(e){let o=r.after(),l=t.tr.replaceWith(o,o,s.createAndFill());l.setSelection(_r.near(l.doc.resolve(o),1)),e(l.scrollIntoView())}return!0},dO=(t,e)=>{let r=t.selection,{$from:n,$to:i}=r;if(r instanceof mo||n.parent.inlineContent||i.parent.inlineContent)return!1;let a=V_(i.parent.contentMatchAt(i.indexAfter()));if(!a||!a.isTextblock)return!1;if(e){let s=(!n.parentOffset&&i.index()<i.parent.childCount?n:i).pos,o=t.tr.insert(s,a.createAndFill());o.setSelection(dr.create(o.doc,s+1)),e(o.scrollIntoView())}return!0},hO=(t,e)=>{let{$cursor:r}=t.selection;if(!r||r.parent.content.size)return!1;if(r.depth>1&&r.after()!=r.end(-1)){let a=r.before();if(pc(t.doc,a))return e&&e(t.tr.split(a).scrollIntoView()),!0}let n=r.blockRange(),i=n&&vm(n);return i==null?!1:(e&&e(t.tr.lift(n,i).scrollIntoView()),!0)};function WZ(t){return(e,r)=>{let{$from:n,$to:i}=e.selection;if(e.selection instanceof Zt&&e.selection.node.isBlock)return!n.parentOffset||!pc(e.doc,n.pos)?!1:(r&&r(e.tr.split(n.pos).scrollIntoView()),!0);if(!n.depth)return!1;let a=[],s,o,l=!1,u=!1;for(let v=n.depth;;v--)if(n.node(v).isBlock){l=n.end(v)==n.pos+(n.depth-v),u=n.start(v)==n.pos-(n.depth-v),o=V_(n.node(v-1).contentMatchAt(n.indexAfter(v-1))),a.unshift(l&&o?{type:o}:null),s=v;break}else{if(v==1)return!1;a.unshift(null)}let c=e.tr;(e.selection instanceof dr||e.selection instanceof mo)&&c.deleteSelection();let h=c.mapping.map(n.pos),p=pc(c.doc,h,a.length,a);if(p||(a[0]=o?{type:o}:null,p=pc(c.doc,h,a.length,a)),!p)return!1;if(c.split(h,a.length,a),!l&&u&&n.node(s).type!=o){let v=c.mapping.map(n.before(s)),y=c.doc.resolve(v);o&&n.node(s-1).canReplaceWith(y.index(),y.index()+1,o)&&c.setNodeMarkup(c.mapping.map(n.before(s)),o)}return r&&r(c.scrollIntoView()),!0}}const qZ=WZ(),$Z=(t,e)=>{let{$from:r,to:n}=t.selection,i,a=r.sharedDepth(n);return a==0?!1:(i=r.before(a),e&&e(t.tr.setSelection(Zt.create(t.doc,i))),!0)};function KZ(t,e,r){let n=e.nodeBefore,i=e.nodeAfter,a=e.index();return!n||!i||!n.type.compatibleContent(i.type)?!1:!n.content.size&&e.parent.canReplace(a-1,a)?(r&&r(t.tr.delete(e.pos-n.nodeSize,e.pos).scrollIntoView()),!0):!e.parent.canReplace(a,a+1)||!(i.isTextblock||hh(t.doc,e.pos))?!1:(r&&r(t.tr.join(e.pos).scrollIntoView()),!0)}function fO(t,e,r,n){let i=e.nodeBefore,a=e.nodeAfter,s,o,l=i.type.spec.isolating||a.type.spec.isolating;if(!l&&KZ(t,e,r))return!0;let u=!l&&e.parent.canReplace(e.index(),e.index()+1);if(u&&(s=(o=i.contentMatchAt(i.childCount)).findWrapping(a.type))&&o.matchType(s[0]||a.type).validEnd){if(r){let v=e.pos+a.nodeSize,y=at.empty;for(let T=s.length-1;T>=0;T--)y=at.from(s[T].create(null,y));y=at.from(i.copy(y));let S=t.tr.step(new xa(e.pos-1,v,e.pos,v,new Mt(y,1,0),s.length,!0)),w=S.doc.resolve(v+2*s.length);w.nodeAfter&&w.nodeAfter.type==i.type&&hh(S.doc,w.pos)&&S.join(w.pos),r(S.scrollIntoView())}return!0}let c=a.type.spec.isolating||n>0&&l?null:_r.findFrom(e,1),h=c&&c.$from.blockRange(c.$to),p=h&&vm(h);if(p!=null&&p>=e.depth)return r&&r(t.tr.lift(h,p).scrollIntoView()),!0;if(u&&Yp(a,"start",!0)&&Yp(i,"end")){let v=i,y=[];for(;y.push(v),!v.isTextblock;)v=v.lastChild;let S=a,w=1;for(;!S.isTextblock;S=S.firstChild)w++;if(v.canReplace(v.childCount,v.childCount,S.content)){if(r){let T=at.empty;for(let C=y.length-1;C>=0;C--)T=at.from(y[C].copy(T));let _=t.tr.step(new xa(e.pos-y.length,e.pos+a.nodeSize,e.pos+w,e.pos+a.nodeSize-w,new Mt(T,y.length,0),0,!0));r(_.scrollIntoView())}return!0}}return!1}function pO(t){return function(e,r){let n=e.selection,i=t<0?n.$from:n.$to,a=i.depth;for(;i.node(a).isInline;){if(!a)return!1;a--}return i.node(a).isTextblock?(r&&r(e.tr.setSelection(dr.create(e.doc,t<0?i.start(a):i.end(a)))),!0):!1}}const ZZ=pO(-1),YZ=pO(1);function XZ(t,e=null){return function(r,n){let{$from:i,$to:a}=r.selection,s=i.blockRange(a),o=s&&F_(s,t,e);return o?(n&&n(r.tr.wrap(s,o).scrollIntoView()),!0):!1}}function M3(t,e=null){return function(r,n){let i=!1;for(let a=0;a<r.selection.ranges.length&&!i;a++){let{$from:{pos:s},$to:{pos:o}}=r.selection.ranges[a];r.doc.nodesBetween(s,o,(l,u)=>{if(i)return!1;if(!(!l.isTextblock||l.hasMarkup(t,e)))if(l.type==t)i=!0;else{let c=r.doc.resolve(u),h=c.index();i=c.parent.canReplaceWith(h,h+1,t)}})}if(!i)return!1;if(n){let a=r.tr;for(let s=0;s<r.selection.ranges.length;s++){let{$from:{pos:o},$to:{pos:l}}=r.selection.ranges[s];a.setBlockType(o,l,t,e)}n(a.scrollIntoView())}return!0}}function H_(...t){return function(e,r,n){for(let i=0;i<t.length;i++)if(t[i](e,r,n))return!0;return!1}}H_(z_,iO,sO);H_(z_,lO,uO);H_(cO,dO,hO,qZ);typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):typeof os<"u"&&os.platform&&os.platform()=="darwin";function QZ(t,e=null){return function(r,n){let{$from:i,$to:a}=r.selection,s=i.blockRange(a);if(!s)return!1;let o=n?r.tr:null;return JZ(o,s,t,e)?(n&&n(o.scrollIntoView()),!0):!1}}function JZ(t,e,r,n=null){let i=!1,a=e,s=e.$from.doc;if(e.depth>=2&&e.$from.node(e.depth-1).type.compatibleContent(r)&&e.startIndex==0){if(e.$from.index(e.depth-1)==0)return!1;let l=s.resolve(e.start-2);a=new Nx(l,l,e.depth),e.endIndex<e.parent.childCount&&(e=new Nx(e.$from,s.resolve(e.$to.end(e.depth)),e.depth)),i=!0}let o=F_(a,r,n,e);return o?(t&&eY(t,e,o,i,r),!0):!1}function eY(t,e,r,n,i){let a=at.empty;for(let c=r.length-1;c>=0;c--)a=at.from(r[c].type.create(r[c].attrs,a));t.step(new xa(e.start-(n?2:0),e.end,e.start,e.end,new Mt(a,0,0),r.length,!0));let s=0;for(let c=0;c<r.length;c++)r[c].type==i&&(s=c+1);let o=r.length-s,l=e.start+r.length-(n?2:0),u=e.parent;for(let c=e.startIndex,h=e.endIndex,p=!0;c<h;c++,p=!1)!p&&pc(t.doc,l,o)&&(t.split(l,o),l+=2*o),l+=u.child(c).nodeSize;return t}function tY(t){return function(e,r){let{$from:n,$to:i}=e.selection,a=n.blockRange(i,s=>s.childCount>0&&s.firstChild.type==t);return a?r?n.node(a.depth-1).type==t?rY(e,r,t,a):nY(e,r,a):!0:!1}}function rY(t,e,r,n){let i=t.tr,a=n.end,s=n.$to.end(n.depth);a<s&&(i.step(new xa(a-1,s,a,s,new Mt(at.from(r.create(null,n.parent.copy())),1,0),1,!0)),n=new Nx(i.doc.resolve(n.$from.pos),i.doc.resolve(s),n.depth));const o=vm(n);if(o==null)return!1;i.lift(n,o);let l=i.doc.resolve(i.mapping.map(a,-1)-1);return hh(i.doc,l.pos)&&l.nodeBefore.type==l.nodeAfter.type&&i.join(l.pos),e(i.scrollIntoView()),!0}function nY(t,e,r){let n=t.tr,i=r.parent;for(let v=r.end,y=r.endIndex-1,S=r.startIndex;y>S;y--)v-=i.child(y).nodeSize,n.delete(v-1,v+1);let a=n.doc.resolve(r.start),s=a.nodeAfter;if(n.mapping.map(r.end)!=r.start+a.nodeAfter.nodeSize)return!1;let o=r.startIndex==0,l=r.endIndex==i.childCount,u=a.node(-1),c=a.index(-1);if(!u.canReplace(c+(o?0:1),c+1,s.content.append(l?at.empty:at.from(i))))return!1;let h=a.pos,p=h+s.nodeSize;return n.step(new xa(h-(o?1:0),p+(l?1:0),h+1,p-1,new Mt((o?at.empty:at.from(i.copy(at.empty))).append(l?at.empty:at.from(i.copy(at.empty))),o?0:1,l?0:1),o?0:1)),e(n.scrollIntoView()),!0}function iY(t){return function(e,r){let{$from:n,$to:i}=e.selection,a=n.blockRange(i,u=>u.childCount>0&&u.firstChild.type==t);if(!a)return!1;let s=a.startIndex;if(s==0)return!1;let o=a.parent,l=o.child(s-1);if(l.type!=t)return!1;if(r){let u=l.lastChild&&l.lastChild.type==o.type,c=at.from(u?t.create():null),h=new Mt(at.from(t.create(null,at.from(o.type.create(null,c)))),u?3:1,0),p=a.start,v=a.end;r(e.tr.step(new xa(p-(u?3:1),v,p,v,h,1,!0)).scrollIntoView())}return!0}}const za=function(t){for(var e=0;;e++)if(t=t.previousSibling,!t)return e},Xp=function(t){let e=t.assignedSlot||t.parentNode;return e&&e.nodeType==11?e.host:e};let pk=null;const lc=function(t,e,r){let n=pk||(pk=document.createRange());return n.setEnd(t,r??t.nodeValue.length),n.setStart(t,e||0),n},aY=function(){pk=null},kf=function(t,e,r,n){return r&&(A3(t,e,r,n,-1)||A3(t,e,r,n,1))},sY=/^(img|br|input|textarea|hr)$/i;function A3(t,e,r,n,i){for(var a;;){if(t==r&&e==n)return!0;if(e==(i<0?0:Ho(t))){let s=t.parentNode;if(!s||s.nodeType!=1||c0(t)||sY.test(t.nodeName)||t.contentEditable=="false")return!1;e=za(t)+(i<0?0:1),t=s}else if(t.nodeType==1){let s=t.childNodes[e+(i<0?-1:0)];if(s.nodeType==1&&s.contentEditable=="false")if(!((a=s.pmViewDesc)===null||a===void 0)&&a.ignoreForSelection)e+=i;else return!1;else t=s,e=i<0?Ho(t):0}else return!1}}function Ho(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}function oY(t,e){for(;;){if(t.nodeType==3&&e)return t;if(t.nodeType==1&&e>0){if(t.contentEditable=="false")return null;t=t.childNodes[e-1],e=Ho(t)}else if(t.parentNode&&!c0(t))e=za(t),t=t.parentNode;else return null}}function lY(t,e){for(;;){if(t.nodeType==3&&e<t.nodeValue.length)return t;if(t.nodeType==1&&e<t.childNodes.length){if(t.contentEditable=="false")return null;t=t.childNodes[e],e=0}else if(t.parentNode&&!c0(t))e=za(t)+1,t=t.parentNode;else return null}}function uY(t,e,r){for(let n=e==0,i=e==Ho(t);n||i;){if(t==r)return!0;let a=za(t);if(t=t.parentNode,!t)return!1;n=n&&a==0,i=i&&a==Ho(t)}}function c0(t){let e;for(let r=t;r&&!(e=r.pmViewDesc);r=r.parentNode);return e&&e.node&&e.node.isBlock&&(e.dom==t||e.contentDOM==t)}const K1=function(t){return t.focusNode&&kf(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset)};function Jh(t,e){let r=document.createEvent("Event");return r.initEvent("keydown",!0,!0),r.keyCode=t,r.key=r.code=e,r}function cY(t){let e=t.activeElement;for(;e&&e.shadowRoot;)e=e.shadowRoot.activeElement;return e}function dY(t,e,r){if(t.caretPositionFromPoint)try{let n=t.caretPositionFromPoint(e,r);if(n)return{node:n.offsetNode,offset:Math.min(Ho(n.offsetNode),n.offset)}}catch{}if(t.caretRangeFromPoint){let n=t.caretRangeFromPoint(e,r);if(n)return{node:n.startContainer,offset:Math.min(Ho(n.startContainer),n.startOffset)}}}const Nu=typeof navigator<"u"?navigator:null,R3=typeof document<"u"?document:null,fh=Nu&&Nu.userAgent||"",mk=/Edge\/(\d+)/.exec(fh),mO=/MSIE \d/.exec(fh),gk=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(fh),Xs=!!(mO||gk||mk),qd=mO?document.documentMode:gk?+gk[1]:mk?+mk[1]:0,$o=!Xs&&/gecko\/(\d+)/i.test(fh);$o&&+(/Firefox\/(\d+)/.exec(fh)||[0,0])[1];const vk=!Xs&&/Chrome\/(\d+)/.exec(fh),va=!!vk,gO=vk?+vk[1]:0,Ha=!Xs&&!!Nu&&/Apple Computer/.test(Nu.vendor),Qp=Ha&&(/Mobile\/\w+/.test(fh)||!!Nu&&Nu.maxTouchPoints>2),Go=Qp||(Nu?/Mac/.test(Nu.platform):!1),vO=Nu?/Win/.test(Nu.platform):!1,hc=/Android \d/.test(fh),d0=!!R3&&"webkitFontSmoothing"in R3.documentElement.style,hY=d0?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function fY(t){let e=t.defaultView&&t.defaultView.visualViewport;return e?{left:0,right:e.width,top:0,bottom:e.height}:{left:0,right:t.documentElement.clientWidth,top:0,bottom:t.documentElement.clientHeight}}function ic(t,e){return typeof t=="number"?t:t[e]}function pY(t){let e=t.getBoundingClientRect(),r=e.width/t.offsetWidth||1,n=e.height/t.offsetHeight||1;return{left:e.left,right:e.left+t.clientWidth*r,top:e.top,bottom:e.top+t.clientHeight*n}}function L3(t,e,r){let n=t.someProp("scrollThreshold")||0,i=t.someProp("scrollMargin")||5,a=t.dom.ownerDocument;for(let s=r||t.dom;s;){if(s.nodeType!=1){s=Xp(s);continue}let o=s,l=o==a.body,u=l?fY(a):pY(o),c=0,h=0;if(e.top<u.top+ic(n,"top")?h=-(u.top-e.top+ic(i,"top")):e.bottom>u.bottom-ic(n,"bottom")&&(h=e.bottom-e.top>u.bottom-u.top?e.top+ic(i,"top")-u.top:e.bottom-u.bottom+ic(i,"bottom")),e.left<u.left+ic(n,"left")?c=-(u.left-e.left+ic(i,"left")):e.right>u.right-ic(n,"right")&&(c=e.right-u.right+ic(i,"right")),c||h)if(l)a.defaultView.scrollBy(c,h);else{let v=o.scrollLeft,y=o.scrollTop;h&&(o.scrollTop+=h),c&&(o.scrollLeft+=c);let S=o.scrollLeft-v,w=o.scrollTop-y;e={left:e.left-S,top:e.top-w,right:e.right-S,bottom:e.bottom-w}}let p=l?"fixed":getComputedStyle(s).position;if(/^(fixed|sticky)$/.test(p))break;s=p=="absolute"?s.offsetParent:Xp(s)}}function mY(t){let e=t.dom.getBoundingClientRect(),r=Math.max(0,e.top),n,i;for(let a=(e.left+e.right)/2,s=r+1;s<Math.min(innerHeight,e.bottom);s+=5){let o=t.root.elementFromPoint(a,s);if(!o||o==t.dom||!t.dom.contains(o))continue;let l=o.getBoundingClientRect();if(l.top>=r-20){n=o,i=l.top;break}}return{refDOM:n,refTop:i,stack:yO(t.dom)}}function yO(t){let e=[],r=t.ownerDocument;for(let n=t;n&&(e.push({dom:n,top:n.scrollTop,left:n.scrollLeft}),t!=r);n=Xp(n));return e}function gY({refDOM:t,refTop:e,stack:r}){let n=t?t.getBoundingClientRect().top:0;xO(r,n==0?0:n-e)}function xO(t,e){for(let r=0;r<t.length;r++){let{dom:n,top:i,left:a}=t[r];n.scrollTop!=i+e&&(n.scrollTop=i+e),n.scrollLeft!=a&&(n.scrollLeft=a)}}let kp=null;function vY(t){if(t.setActive)return t.setActive();if(kp)return t.focus(kp);let e=yO(t);t.focus(kp==null?{get preventScroll(){return kp={preventScroll:!0},!0}}:void 0),kp||(kp=!1,xO(e,0))}function bO(t,e){let r,n=2e8,i,a=0,s=e.top,o=e.top,l,u;for(let c=t.firstChild,h=0;c;c=c.nextSibling,h++){let p;if(c.nodeType==1)p=c.getClientRects();else if(c.nodeType==3)p=lc(c).getClientRects();else continue;for(let v=0;v<p.length;v++){let y=p[v];if(y.top<=s&&y.bottom>=o){s=Math.max(y.bottom,s),o=Math.min(y.top,o);let S=y.left>e.left?y.left-e.left:y.right<e.left?e.left-y.right:0;if(S<n){r=c,n=S,i=S&&r.nodeType==3?{left:y.right<e.left?y.right:y.left,top:e.top}:e,c.nodeType==1&&S&&(a=h+(e.left>=(y.left+y.right)/2?1:0));continue}}else y.top>e.top&&!l&&y.left<=e.left&&y.right>=e.left&&(l=c,u={left:Math.max(y.left,Math.min(y.right,e.left)),top:y.top});!r&&(e.left>=y.right&&e.top>=y.top||e.left>=y.left&&e.top>=y.bottom)&&(a=h+1)}}return!r&&l&&(r=l,i=u,n=0),r&&r.nodeType==3?yY(r,i):!r||n&&r.nodeType==1?{node:t,offset:a}:bO(r,i)}function yY(t,e){let r=t.nodeValue.length,n=document.createRange(),i;for(let a=0;a<r;a++){n.setEnd(t,a+1),n.setStart(t,a);let s=Cd(n,1);if(s.top!=s.bottom&&W_(e,s)){i={node:t,offset:a+(e.left>=(s.left+s.right)/2?1:0)};break}}return n.detach(),i||{node:t,offset:0}}function W_(t,e){return t.left>=e.left-1&&t.left<=e.right+1&&t.top>=e.top-1&&t.top<=e.bottom+1}function xY(t,e){let r=t.parentNode;return r&&/^li$/i.test(r.nodeName)&&e.left<t.getBoundingClientRect().left?r:t}function bY(t,e,r){let{node:n,offset:i}=bO(e,r),a=-1;if(n.nodeType==1&&!n.firstChild){let s=n.getBoundingClientRect();a=s.left!=s.right&&r.left>(s.left+s.right)/2?1:-1}return t.docView.posFromDOM(n,i,a)}function wY(t,e,r,n){let i=-1;for(let a=e,s=!1;a!=t.dom;){let o=t.docView.nearestDesc(a,!0),l;if(!o)return null;if(o.dom.nodeType==1&&(o.node.isBlock&&o.parent||!o.contentDOM)&&((l=o.dom.getBoundingClientRect()).width||l.height)&&(o.node.isBlock&&o.parent&&!/^T(R|BODY|HEAD|FOOT)$/.test(o.dom.nodeName)&&(!s&&l.left>n.left||l.top>n.top?i=o.posBefore:(!s&&l.right<n.left||l.bottom<n.top)&&(i=o.posAfter),s=!0),!o.contentDOM&&i<0&&!o.node.isText))return(o.node.isBlock?n.top<(l.top+l.bottom)/2:n.left<(l.left+l.right)/2)?o.posBefore:o.posAfter;a=o.dom.parentNode}return i>-1?i:t.docView.posFromDOM(e,r,-1)}function wO(t,e,r){let n=t.childNodes.length;if(n&&r.top<r.bottom)for(let i=Math.max(0,Math.min(n-1,Math.floor(n*(e.top-r.top)/(r.bottom-r.top))-2)),a=i;;){let s=t.childNodes[a];if(s.nodeType==1){let o=s.getClientRects();for(let l=0;l<o.length;l++){let u=o[l];if(W_(e,u))return wO(s,e,u)}}if((a=(a+1)%n)==i)break}return t}function SY(t,e){let r=t.dom.ownerDocument,n,i=0,a=dY(r,e.left,e.top);a&&({node:n,offset:i}=a);let s=(t.root.elementFromPoint?t.root:r).elementFromPoint(e.left,e.top),o;if(!s||!t.dom.contains(s.nodeType!=1?s.parentNode:s)){let u=t.dom.getBoundingClientRect();if(!W_(e,u)||(s=wO(t.dom,e,u),!s))return null}if(Ha)for(let u=s;n&&u;u=Xp(u))u.draggable&&(n=void 0);if(s=xY(s,e),n){if($o&&n.nodeType==1&&(i=Math.min(i,n.childNodes.length),i<n.childNodes.length)){let c=n.childNodes[i],h;c.nodeName=="IMG"&&(h=c.getBoundingClientRect()).right<=e.left&&h.bottom>e.top&&i++}let u;d0&&i&&n.nodeType==1&&(u=n.childNodes[i-1]).nodeType==1&&u.contentEditable=="false"&&u.getBoundingClientRect().top>=e.top&&i--,n==t.dom&&i==n.childNodes.length-1&&n.lastChild.nodeType==1&&e.top>n.lastChild.getBoundingClientRect().bottom?o=t.state.doc.content.size:(i==0||n.nodeType!=1||n.childNodes[i-1].nodeName!="BR")&&(o=wY(t,n,i,e))}o==null&&(o=bY(t,s,e));let l=t.docView.nearestDesc(s,!0);return{pos:o,inside:l?l.posAtStart-l.border:-1}}function O3(t){return t.top<t.bottom||t.left<t.right}function Cd(t,e){let r=t.getClientRects();if(r.length){let n=r[e<0?0:r.length-1];if(O3(n))return n}return Array.prototype.find.call(r,O3)||t.getBoundingClientRect()}const kY=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function SO(t,e,r){let{node:n,offset:i,atom:a}=t.docView.domFromPos(e,r<0?-1:1),s=d0||$o;if(n.nodeType==3)if(s&&(kY.test(n.nodeValue)||(r<0?!i:i==n.nodeValue.length))){let l=Cd(lc(n,i,i),r);if($o&&i&&/\s/.test(n.nodeValue[i-1])&&i<n.nodeValue.length){let u=Cd(lc(n,i-1,i-1),-1);if(u.top==l.top){let c=Cd(lc(n,i,i+1),-1);if(c.top!=l.top)return Bg(c,c.left<u.left)}}return l}else{let l=i,u=i,c=r<0?1:-1;return r<0&&!i?(u++,c=-1):r>=0&&i==n.nodeValue.length?(l--,c=1):r<0?l--:u++,Bg(Cd(lc(n,l,u),c),c<0)}if(!t.state.doc.resolve(e-(a||0)).parent.inlineContent){if(a==null&&i&&(r<0||i==Ho(n))){let l=n.childNodes[i-1];if(l.nodeType==1)return rS(l.getBoundingClientRect(),!1)}if(a==null&&i<Ho(n)){let l=n.childNodes[i];if(l.nodeType==1)return rS(l.getBoundingClientRect(),!0)}return rS(n.getBoundingClientRect(),r>=0)}if(a==null&&i&&(r<0||i==Ho(n))){let l=n.childNodes[i-1],u=l.nodeType==3?lc(l,Ho(l)-(s?0:1)):l.nodeType==1&&(l.nodeName!="BR"||!l.nextSibling)?l:null;if(u)return Bg(Cd(u,1),!1)}if(a==null&&i<Ho(n)){let l=n.childNodes[i];for(;l.pmViewDesc&&l.pmViewDesc.ignoreForCoords;)l=l.nextSibling;let u=l?l.nodeType==3?lc(l,0,s?0:1):l.nodeType==1?l:null:null;if(u)return Bg(Cd(u,-1),!0)}return Bg(Cd(n.nodeType==3?lc(n):n,-r),r>=0)}function Bg(t,e){if(t.width==0)return t;let r=e?t.left:t.right;return{top:t.top,bottom:t.bottom,left:r,right:r}}function rS(t,e){if(t.height==0)return t;let r=e?t.top:t.bottom;return{top:r,bottom:r,left:t.left,right:t.right}}function kO(t,e,r){let n=t.state,i=t.root.activeElement;n!=e&&t.updateState(e),i!=t.dom&&t.focus();try{return r()}finally{n!=e&&t.updateState(n),i!=t.dom&&i&&i.focus()}}function _Y(t,e,r){let n=e.selection,i=r=="up"?n.$from:n.$to;return kO(t,e,()=>{let{node:a}=t.docView.domFromPos(i.pos,r=="up"?-1:1);for(;;){let o=t.docView.nearestDesc(a,!0);if(!o)break;if(o.node.isBlock){a=o.contentDOM||o.dom;break}a=o.dom.parentNode}let s=SO(t,i.pos,1);for(let o=a.firstChild;o;o=o.nextSibling){let l;if(o.nodeType==1)l=o.getClientRects();else if(o.nodeType==3)l=lc(o,0,o.nodeValue.length).getClientRects();else continue;for(let u=0;u<l.length;u++){let c=l[u];if(c.bottom>c.top+1&&(r=="up"?s.top-c.top>(c.bottom-s.top)*2:c.bottom-s.bottom>(s.bottom-c.top)*2))return!1}}return!0})}const CY=/[\u0590-\u08ac]/;function EY(t,e,r){let{$head:n}=e.selection;if(!n.parent.isTextblock)return!1;let i=n.parentOffset,a=!i,s=i==n.parent.content.size,o=t.domSelection();return o?!CY.test(n.parent.textContent)||!o.modify?r=="left"||r=="backward"?a:s:kO(t,e,()=>{let{focusNode:l,focusOffset:u,anchorNode:c,anchorOffset:h}=t.domSelectionRange(),p=o.caretBidiLevel;o.modify("move",r,"character");let v=n.depth?t.docView.domAfterPos(n.before()):t.dom,{focusNode:y,focusOffset:S}=t.domSelectionRange(),w=y&&!v.contains(y.nodeType==1?y:y.parentNode)||l==y&&u==S;try{o.collapse(c,h),l&&(l!=c||u!=h)&&o.extend&&o.extend(l,u)}catch{}return p!=null&&(o.caretBidiLevel=p),w}):n.pos==n.start()||n.pos==n.end()}let D3=null,I3=null,j3=!1;function TY(t,e,r){return D3==e&&I3==r?j3:(D3=e,I3=r,j3=r=="up"||r=="down"?_Y(t,e,r):EY(t,e,r))}const Ko=0,F3=1,tf=2,Pu=3;class h0{constructor(e,r,n,i){this.parent=e,this.children=r,this.dom=n,this.contentDOM=i,this.dirty=Ko,n.pmViewDesc=this}matchesWidget(e){return!1}matchesMark(e){return!1}matchesNode(e,r,n){return!1}matchesHack(e){return!1}parseRule(){return null}stopEvent(e){return!1}get size(){let e=0;for(let r=0;r<this.children.length;r++)e+=this.children[r].size;return e}get border(){return 0}destroy(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(let e=0;e<this.children.length;e++)this.children[e].destroy()}posBeforeChild(e){for(let r=0,n=this.posAtStart;;r++){let i=this.children[r];if(i==e)return n;n+=i.size}}get posBefore(){return this.parent.posBeforeChild(this)}get posAtStart(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}get posAfter(){return this.posBefore+this.size}get posAtEnd(){return this.posAtStart+this.size-2*this.border}localPosFromDOM(e,r,n){if(this.contentDOM&&this.contentDOM.contains(e.nodeType==1?e:e.parentNode))if(n<0){let a,s;if(e==this.contentDOM)a=e.childNodes[r-1];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;a=e.previousSibling}for(;a&&!((s=a.pmViewDesc)&&s.parent==this);)a=a.previousSibling;return a?this.posBeforeChild(s)+s.size:this.posAtStart}else{let a,s;if(e==this.contentDOM)a=e.childNodes[r];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;a=e.nextSibling}for(;a&&!((s=a.pmViewDesc)&&s.parent==this);)a=a.nextSibling;return a?this.posBeforeChild(s):this.posAtEnd}let i;if(e==this.dom&&this.contentDOM)i=r>za(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))i=e.compareDocumentPosition(this.contentDOM)&2;else if(this.dom.firstChild){if(r==0)for(let a=e;;a=a.parentNode){if(a==this.dom){i=!1;break}if(a.previousSibling)break}if(i==null&&r==e.childNodes.length)for(let a=e;;a=a.parentNode){if(a==this.dom){i=!0;break}if(a.nextSibling)break}}return i??n>0?this.posAtEnd:this.posAtStart}nearestDesc(e,r=!1){for(let n=!0,i=e;i;i=i.parentNode){let a=this.getDesc(i),s;if(a&&(!r||a.node))if(n&&(s=a.nodeDOM)&&!(s.nodeType==1?s.contains(e.nodeType==1?e:e.parentNode):s==e))n=!1;else return a}}getDesc(e){let r=e.pmViewDesc;for(let n=r;n;n=n.parent)if(n==this)return r}posFromDOM(e,r,n){for(let i=e;i;i=i.parentNode){let a=this.getDesc(i);if(a)return a.localPosFromDOM(e,r,n)}return-1}descAt(e){for(let r=0,n=0;r<this.children.length;r++){let i=this.children[r],a=n+i.size;if(n==e&&a!=n){for(;!i.border&&i.children.length;)for(let s=0;s<i.children.length;s++){let o=i.children[s];if(o.size){i=o;break}}return i}if(e<a)return i.descAt(e-n-i.border);n=a}}domFromPos(e,r){if(!this.contentDOM)return{node:this.dom,offset:0,atom:e+1};let n=0,i=0;for(let a=0;n<this.children.length;n++){let s=this.children[n],o=a+s.size;if(o>e||s instanceof CO){i=e-a;break}a=o}if(i)return this.children[n].domFromPos(i-this.children[n].border,r);for(let a;n&&!(a=this.children[n-1]).size&&a instanceof _O&&a.side>=0;n--);if(r<=0){let a,s=!0;for(;a=n?this.children[n-1]:null,!(!a||a.dom.parentNode==this.contentDOM);n--,s=!1);return a&&r&&s&&!a.border&&!a.domAtom?a.domFromPos(a.size,r):{node:this.contentDOM,offset:a?za(a.dom)+1:0}}else{let a,s=!0;for(;a=n<this.children.length?this.children[n]:null,!(!a||a.dom.parentNode==this.contentDOM);n++,s=!1);return a&&s&&!a.border&&!a.domAtom?a.domFromPos(0,r):{node:this.contentDOM,offset:a?za(a.dom):this.contentDOM.childNodes.length}}}parseRange(e,r,n=0){if(this.children.length==0)return{node:this.contentDOM,from:e,to:r,fromOffset:0,toOffset:this.contentDOM.childNodes.length};let i=-1,a=-1;for(let s=n,o=0;;o++){let l=this.children[o],u=s+l.size;if(i==-1&&e<=u){let c=s+l.border;if(e>=c&&r<=u-l.border&&l.node&&l.contentDOM&&this.contentDOM.contains(l.contentDOM))return l.parseRange(e,r,c);e=s;for(let h=o;h>0;h--){let p=this.children[h-1];if(p.size&&p.dom.parentNode==this.contentDOM&&!p.emptyChildAt(1)){i=za(p.dom)+1;break}e-=p.size}i==-1&&(i=0)}if(i>-1&&(u>r||o==this.children.length-1)){r=u;for(let c=o+1;c<this.children.length;c++){let h=this.children[c];if(h.size&&h.dom.parentNode==this.contentDOM&&!h.emptyChildAt(-1)){a=za(h.dom);break}r+=h.size}a==-1&&(a=this.contentDOM.childNodes.length);break}s=u}return{node:this.contentDOM,from:e,to:r,fromOffset:i,toOffset:a}}emptyChildAt(e){if(this.border||!this.contentDOM||!this.children.length)return!1;let r=this.children[e<0?0:this.children.length-1];return r.size==0||r.emptyChildAt(e)}domAfterPos(e){let{node:r,offset:n}=this.domFromPos(e,0);if(r.nodeType!=1||n==r.childNodes.length)throw new RangeError("No node after pos "+e);return r.childNodes[n]}setSelection(e,r,n,i=!1){let a=Math.min(e,r),s=Math.max(e,r);for(let v=0,y=0;v<this.children.length;v++){let S=this.children[v],w=y+S.size;if(a>y&&s<w)return S.setSelection(e-y-S.border,r-y-S.border,n,i);y=w}let o=this.domFromPos(e,e?-1:1),l=r==e?o:this.domFromPos(r,r?-1:1),u=n.root.getSelection(),c=n.domSelectionRange(),h=!1;if(($o||Ha)&&e==r){let{node:v,offset:y}=o;if(v.nodeType==3){if(h=!!(y&&v.nodeValue[y-1]==`
`),h&&y==v.nodeValue.length)for(let S=v,w;S;S=S.parentNode){if(w=S.nextSibling){w.nodeName=="BR"&&(o=l={node:w.parentNode,offset:za(w)+1});break}let T=S.pmViewDesc;if(T&&T.node&&T.node.isBlock)break}}else{let S=v.childNodes[y-1];h=S&&(S.nodeName=="BR"||S.contentEditable=="false")}}if($o&&c.focusNode&&c.focusNode!=l.node&&c.focusNode.nodeType==1){let v=c.focusNode.childNodes[c.focusOffset];v&&v.contentEditable=="false"&&(i=!0)}if(!(i||h&&Ha)&&kf(o.node,o.offset,c.anchorNode,c.anchorOffset)&&kf(l.node,l.offset,c.focusNode,c.focusOffset))return;let p=!1;if((u.extend||e==r)&&!(h&&$o)){u.collapse(o.node,o.offset);try{e!=r&&u.extend(l.node,l.offset),p=!0}catch{}}if(!p){if(e>r){let y=o;o=l,l=y}let v=document.createRange();v.setEnd(l.node,l.offset),v.setStart(o.node,o.offset),u.removeAllRanges(),u.addRange(v)}}ignoreMutation(e){return!this.contentDOM&&e.type!="selection"}get contentLost(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}markDirty(e,r){for(let n=0,i=0;i<this.children.length;i++){let a=this.children[i],s=n+a.size;if(n==s?e<=s&&r>=n:e<s&&r>n){let o=n+a.border,l=s-a.border;if(e>=o&&r<=l){this.dirty=e==n||r==s?tf:F3,e==o&&r==l&&(a.contentLost||a.dom.parentNode!=this.contentDOM)?a.dirty=Pu:a.markDirty(e-o,r-o);return}else a.dirty=a.dom==a.contentDOM&&a.dom.parentNode==this.contentDOM&&!a.children.length?tf:Pu}n=s}this.dirty=tf}markParentsDirty(){let e=1;for(let r=this.parent;r;r=r.parent,e++){let n=e==1?tf:F3;r.dirty<n&&(r.dirty=n)}}get domAtom(){return!1}get ignoreForCoords(){return!1}get ignoreForSelection(){return!1}isText(e){return!1}}class _O extends h0{constructor(e,r,n,i){let a,s=r.type.toDOM;if(typeof s=="function"&&(s=s(n,()=>{if(!a)return i;if(a.parent)return a.parent.posBeforeChild(a)})),!r.type.spec.raw){if(s.nodeType!=1){let o=document.createElement("span");o.appendChild(s),s=o}s.contentEditable="false",s.classList.add("ProseMirror-widget")}super(e,[],s,null),this.widget=r,this.widget=r,a=this}matchesWidget(e){return this.dirty==Ko&&e.type.eq(this.widget.type)}parseRule(){return{ignore:!0}}stopEvent(e){let r=this.widget.spec.stopEvent;return r?r(e):!1}ignoreMutation(e){return e.type!="selection"||this.widget.spec.ignoreSelection}destroy(){this.widget.type.destroy(this.dom),super.destroy()}get domAtom(){return!0}get ignoreForSelection(){return!!this.widget.type.spec.relaxedSide}get side(){return this.widget.type.side}}class NY extends h0{constructor(e,r,n,i){super(e,[],r,null),this.textDOM=n,this.text=i}get size(){return this.text.length}localPosFromDOM(e,r){return e!=this.textDOM?this.posAtStart+(r?this.size:0):this.posAtStart+r}domFromPos(e){return{node:this.textDOM,offset:e}}ignoreMutation(e){return e.type==="characterData"&&e.target.nodeValue==e.oldValue}}class _f extends h0{constructor(e,r,n,i,a){super(e,[],n,i),this.mark=r,this.spec=a}static create(e,r,n,i){let a=i.nodeViews[r.type.name],s=a&&a(r,i,n);return(!s||!s.dom)&&(s=Af.renderSpec(document,r.type.spec.toDOM(r,n),null,r.attrs)),new _f(e,r,s.dom,s.contentDOM||s.dom,s)}parseRule(){return this.dirty&Pu||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}}matchesMark(e){return this.dirty!=Pu&&this.mark.eq(e)}markDirty(e,r){if(super.markDirty(e,r),this.dirty!=Ko){let n=this.parent;for(;!n.node;)n=n.parent;n.dirty<this.dirty&&(n.dirty=this.dirty),this.dirty=Ko}}slice(e,r,n){let i=_f.create(this.parent,this.mark,!0,n),a=this.children,s=this.size;r<s&&(a=xk(a,r,s,n)),e>0&&(a=xk(a,0,e,n));for(let o=0;o<a.length;o++)a[o].parent=i;return i.children=a,i}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}}class $d extends h0{constructor(e,r,n,i,a,s,o,l,u){super(e,[],a,s),this.node=r,this.outerDeco=n,this.innerDeco=i,this.nodeDOM=o}static create(e,r,n,i,a,s){let o=a.nodeViews[r.type.name],l,u=o&&o(r,a,()=>{if(!l)return s;if(l.parent)return l.parent.posBeforeChild(l)},n,i),c=u&&u.dom,h=u&&u.contentDOM;if(r.isText){if(!c)c=document.createTextNode(r.text);else if(c.nodeType!=3)throw new RangeError("Text must be rendered as a DOM text node")}else c||({dom:c,contentDOM:h}=Af.renderSpec(document,r.type.spec.toDOM(r),null,r.attrs));!h&&!r.isText&&c.nodeName!="BR"&&(c.hasAttribute("contenteditable")||(c.contentEditable="false"),r.type.spec.draggable&&(c.draggable=!0));let p=c;return c=NO(c,n,r),u?l=new PY(e,r,n,i,c,h||null,p,u,a,s+1):r.isText?new Z1(e,r,n,i,c,p,a):new $d(e,r,n,i,c,h||null,p,a,s+1)}parseRule(){if(this.node.type.spec.reparseInView)return null;let e={node:this.node.type.name,attrs:this.node.attrs};if(this.node.type.whitespace=="pre"&&(e.preserveWhitespace="full"),!this.contentDOM)e.getContent=()=>this.node.content;else if(!this.contentLost)e.contentElement=this.contentDOM;else{for(let r=this.children.length-1;r>=0;r--){let n=this.children[r];if(this.dom.contains(n.dom.parentNode)){e.contentElement=n.dom.parentNode;break}}e.contentElement||(e.getContent=()=>at.empty)}return e}matchesNode(e,r,n){return this.dirty==Ko&&e.eq(this.node)&&Mx(r,this.outerDeco)&&n.eq(this.innerDeco)}get size(){return this.node.nodeSize}get border(){return this.node.isLeaf?0:1}updateChildren(e,r){let n=this.node.inlineContent,i=r,a=e.composing?this.localCompositionInfo(e,r):null,s=a&&a.pos>-1?a:null,o=a&&a.pos<0,l=new AY(this,s&&s.node,e);OY(this.node,this.innerDeco,(u,c,h)=>{u.spec.marks?l.syncToMarks(u.spec.marks,n,e,c):u.type.side>=0&&!h&&l.syncToMarks(c==this.node.childCount?yn.none:this.node.child(c).marks,n,e,c),l.placeWidget(u,e,i)},(u,c,h,p)=>{l.syncToMarks(u.marks,n,e,p);let v;l.findNodeMatch(u,c,h,p)||o&&e.state.selection.from>i&&e.state.selection.to<i+u.nodeSize&&(v=l.findIndexWithChild(a.node))>-1&&l.updateNodeAt(u,c,h,v,e)||l.updateNextNode(u,c,h,e,p,i)||l.addNode(u,c,h,e,i),i+=u.nodeSize}),l.syncToMarks([],n,e,0),this.node.isTextblock&&l.addTextblockHacks(),l.destroyRest(),(l.changed||this.dirty==tf)&&(s&&this.protectLocalComposition(e,s),EO(this.contentDOM,this.children,e),Qp&&DY(this.dom))}localCompositionInfo(e,r){let{from:n,to:i}=e.state.selection;if(!(e.state.selection instanceof dr)||n<r||i>r+this.node.content.size)return null;let a=e.input.compositionNode;if(!a||!this.dom.contains(a.parentNode))return null;if(this.node.inlineContent){let s=a.nodeValue,o=IY(this.node.content,s,n-r,i-r);return o<0?null:{node:a,pos:o,text:s}}else return{node:a,pos:-1,text:""}}protectLocalComposition(e,{node:r,pos:n,text:i}){if(this.getDesc(r))return;let a=r;for(;a.parentNode!=this.contentDOM;a=a.parentNode){for(;a.previousSibling;)a.parentNode.removeChild(a.previousSibling);for(;a.nextSibling;)a.parentNode.removeChild(a.nextSibling);a.pmViewDesc&&(a.pmViewDesc=void 0)}let s=new NY(this,a,r,i);e.input.compositionNodes.push(s),this.children=xk(this.children,n,n+i.length,e,s)}update(e,r,n,i){return this.dirty==Pu||!e.sameMarkup(this.node)?!1:(this.updateInner(e,r,n,i),!0)}updateInner(e,r,n,i){this.updateOuterDeco(r),this.node=e,this.innerDeco=n,this.contentDOM&&this.updateChildren(i,this.posAtStart),this.dirty=Ko}updateOuterDeco(e){if(Mx(e,this.outerDeco))return;let r=this.nodeDOM.nodeType!=1,n=this.dom;this.dom=TO(this.dom,this.nodeDOM,yk(this.outerDeco,this.node,r),yk(e,this.node,r)),this.dom!=n&&(n.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=e}selectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.add("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&(this.nodeDOM.draggable=!0))}deselectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.remove("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&this.nodeDOM.removeAttribute("draggable"))}get domAtom(){return this.node.isAtom}}function B3(t,e,r,n,i){NO(n,e,t);let a=new $d(void 0,t,e,r,n,n,n,i,0);return a.contentDOM&&a.updateChildren(i,0),a}class Z1 extends $d{constructor(e,r,n,i,a,s,o){super(e,r,n,i,a,null,s,o,0)}parseRule(){let e=this.nodeDOM.parentNode;for(;e&&e!=this.dom&&!e.pmIsDeco;)e=e.parentNode;return{skip:e||!0}}update(e,r,n,i){return this.dirty==Pu||this.dirty!=Ko&&!this.inParent()||!e.sameMarkup(this.node)?!1:(this.updateOuterDeco(r),(this.dirty!=Ko||e.text!=this.node.text)&&e.text!=this.nodeDOM.nodeValue&&(this.nodeDOM.nodeValue=e.text,i.trackWrites==this.nodeDOM&&(i.trackWrites=null)),this.node=e,this.dirty=Ko,!0)}inParent(){let e=this.parent.contentDOM;for(let r=this.nodeDOM;r;r=r.parentNode)if(r==e)return!0;return!1}domFromPos(e){return{node:this.nodeDOM,offset:e}}localPosFromDOM(e,r,n){return e==this.nodeDOM?this.posAtStart+Math.min(r,this.node.text.length):super.localPosFromDOM(e,r,n)}ignoreMutation(e){return e.type!="characterData"&&e.type!="selection"}slice(e,r,n){let i=this.node.cut(e,r),a=document.createTextNode(i.text);return new Z1(this.parent,i,this.outerDeco,this.innerDeco,a,a,n)}markDirty(e,r){super.markDirty(e,r),this.dom!=this.nodeDOM&&(e==0||r==this.nodeDOM.nodeValue.length)&&(this.dirty=Pu)}get domAtom(){return!1}isText(e){return this.node.text==e}}class CO extends h0{parseRule(){return{ignore:!0}}matchesHack(e){return this.dirty==Ko&&this.dom.nodeName==e}get domAtom(){return!0}get ignoreForCoords(){return this.dom.nodeName=="IMG"}}class PY extends $d{constructor(e,r,n,i,a,s,o,l,u,c){super(e,r,n,i,a,s,o,u,c),this.spec=l}update(e,r,n,i){if(this.dirty==Pu)return!1;if(this.spec.update&&(this.node.type==e.type||this.spec.multiType)){let a=this.spec.update(e,r,n);return a&&this.updateInner(e,r,n,i),a}else return!this.contentDOM&&!e.isLeaf?!1:super.update(e,r,n,i)}selectNode(){this.spec.selectNode?this.spec.selectNode():super.selectNode()}deselectNode(){this.spec.deselectNode?this.spec.deselectNode():super.deselectNode()}setSelection(e,r,n,i){this.spec.setSelection?this.spec.setSelection(e,r,n.root):super.setSelection(e,r,n,i)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}stopEvent(e){return this.spec.stopEvent?this.spec.stopEvent(e):!1}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}}function EO(t,e,r){let n=t.firstChild,i=!1;for(let a=0;a<e.length;a++){let s=e[a],o=s.dom;if(o.parentNode==t){for(;o!=n;)n=z3(n),i=!0;n=n.nextSibling}else i=!0,t.insertBefore(o,n);if(s instanceof _f){let l=n?n.previousSibling:t.lastChild;EO(s.contentDOM,s.children,r),n=l?l.nextSibling:t.firstChild}}for(;n;)n=z3(n),i=!0;i&&r.trackWrites==t&&(r.trackWrites=null)}const av=function(t){t&&(this.nodeName=t)};av.prototype=Object.create(null);const rf=[new av];function yk(t,e,r){if(t.length==0)return rf;let n=r?rf[0]:new av,i=[n];for(let a=0;a<t.length;a++){let s=t[a].type.attrs;if(s){s.nodeName&&i.push(n=new av(s.nodeName));for(let o in s){let l=s[o];l!=null&&(r&&i.length==1&&i.push(n=new av(e.isInline?"span":"div")),o=="class"?n.class=(n.class?n.class+" ":"")+l:o=="style"?n.style=(n.style?n.style+";":"")+l:o!="nodeName"&&(n[o]=l))}}}return i}function TO(t,e,r,n){if(r==rf&&n==rf)return e;let i=e;for(let a=0;a<n.length;a++){let s=n[a],o=r[a];if(a){let l;o&&o.nodeName==s.nodeName&&i!=t&&(l=i.parentNode)&&l.nodeName.toLowerCase()==s.nodeName||(l=document.createElement(s.nodeName),l.pmIsDeco=!0,l.appendChild(i),o=rf[0]),i=l}MY(i,o||rf[0],s)}return i}function MY(t,e,r){for(let n in e)n!="class"&&n!="style"&&n!="nodeName"&&!(n in r)&&t.removeAttribute(n);for(let n in r)n!="class"&&n!="style"&&n!="nodeName"&&r[n]!=e[n]&&t.setAttribute(n,r[n]);if(e.class!=r.class){let n=e.class?e.class.split(" ").filter(Boolean):[],i=r.class?r.class.split(" ").filter(Boolean):[];for(let a=0;a<n.length;a++)i.indexOf(n[a])==-1&&t.classList.remove(n[a]);for(let a=0;a<i.length;a++)n.indexOf(i[a])==-1&&t.classList.add(i[a]);t.classList.length==0&&t.removeAttribute("class")}if(e.style!=r.style){if(e.style){let n=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g,i;for(;i=n.exec(e.style);)t.style.removeProperty(i[1])}r.style&&(t.style.cssText+=r.style)}}function NO(t,e,r){return TO(t,t,rf,yk(e,r,t.nodeType!=1))}function Mx(t,e){if(t.length!=e.length)return!1;for(let r=0;r<t.length;r++)if(!t[r].type.eq(e[r].type))return!1;return!0}function z3(t){let e=t.nextSibling;return t.parentNode.removeChild(t),e}class AY{constructor(e,r,n){this.lock=r,this.view=n,this.index=0,this.stack=[],this.changed=!1,this.top=e,this.preMatch=RY(e.node.content,e)}destroyBetween(e,r){if(e!=r){for(let n=e;n<r;n++)this.top.children[n].destroy();this.top.children.splice(e,r-e),this.changed=!0}}destroyRest(){this.destroyBetween(this.index,this.top.children.length)}syncToMarks(e,r,n,i){let a=0,s=this.stack.length>>1,o=Math.min(s,e.length);for(;a<o&&(a==s-1?this.top:this.stack[a+1<<1]).matchesMark(e[a])&&e[a].type.spec.spanning!==!1;)a++;for(;a<s;)this.destroyRest(),this.top.dirty=Ko,this.index=this.stack.pop(),this.top=this.stack.pop(),s--;for(;s<e.length;){this.stack.push(this.top,this.index+1);let l=-1,u=this.top.children.length;i<this.preMatch.index&&(u=Math.min(this.index+3,u));for(let c=this.index;c<u;c++){let h=this.top.children[c];if(h.matchesMark(e[s])&&!this.isLocked(h.dom)){l=c;break}}if(l>-1)l>this.index&&(this.changed=!0,this.destroyBetween(this.index,l)),this.top=this.top.children[this.index];else{let c=_f.create(this.top,e[s],r,n);this.top.children.splice(this.index,0,c),this.top=c,this.changed=!0}this.index=0,s++}}findNodeMatch(e,r,n,i){let a=-1,s;if(i>=this.preMatch.index&&(s=this.preMatch.matches[i-this.preMatch.index]).parent==this.top&&s.matchesNode(e,r,n))a=this.top.children.indexOf(s,this.index);else for(let o=this.index,l=Math.min(this.top.children.length,o+5);o<l;o++){let u=this.top.children[o];if(u.matchesNode(e,r,n)&&!this.preMatch.matched.has(u)){a=o;break}}return a<0?!1:(this.destroyBetween(this.index,a),this.index++,!0)}updateNodeAt(e,r,n,i,a){let s=this.top.children[i];return s.dirty==Pu&&s.dom==s.contentDOM&&(s.dirty=tf),s.update(e,r,n,a)?(this.destroyBetween(this.index,i),this.index++,!0):!1}findIndexWithChild(e){for(;;){let r=e.parentNode;if(!r)return-1;if(r==this.top.contentDOM){let n=e.pmViewDesc;if(n){for(let i=this.index;i<this.top.children.length;i++)if(this.top.children[i]==n)return i}return-1}e=r}}updateNextNode(e,r,n,i,a,s){for(let o=this.index;o<this.top.children.length;o++){let l=this.top.children[o];if(l instanceof $d){let u=this.preMatch.matched.get(l);if(u!=null&&u!=a)return!1;let c=l.dom,h,p=this.isLocked(c)&&!(e.isText&&l.node&&l.node.isText&&l.nodeDOM.nodeValue==e.text&&l.dirty!=Pu&&Mx(r,l.outerDeco));if(!p&&l.update(e,r,n,i))return this.destroyBetween(this.index,o),l.dom!=c&&(this.changed=!0),this.index++,!0;if(!p&&(h=this.recreateWrapper(l,e,r,n,i,s)))return this.destroyBetween(this.index,o),this.top.children[this.index]=h,h.contentDOM&&(h.dirty=tf,h.updateChildren(i,s+1),h.dirty=Ko),this.changed=!0,this.index++,!0;break}}return!1}recreateWrapper(e,r,n,i,a,s){if(e.dirty||r.isAtom||!e.children.length||!e.node.content.eq(r.content)||!Mx(n,e.outerDeco)||!i.eq(e.innerDeco))return null;let o=$d.create(this.top,r,n,i,a,s);if(o.contentDOM){o.children=e.children,e.children=[];for(let l of o.children)l.parent=o}return e.destroy(),o}addNode(e,r,n,i,a){let s=$d.create(this.top,e,r,n,i,a);s.contentDOM&&s.updateChildren(i,a+1),this.top.children.splice(this.index++,0,s),this.changed=!0}placeWidget(e,r,n){let i=this.index<this.top.children.length?this.top.children[this.index]:null;if(i&&i.matchesWidget(e)&&(e==i.widget||!i.widget.type.toDOM.parentNode))this.index++;else{let a=new _O(this.top,e,r,n);this.top.children.splice(this.index++,0,a),this.changed=!0}}addTextblockHacks(){let e=this.top.children[this.index-1],r=this.top;for(;e instanceof _f;)r=e,e=r.children[r.children.length-1];(!e||!(e instanceof Z1)||/\n$/.test(e.node.text)||this.view.requiresGeckoHackNode&&/\s$/.test(e.node.text))&&((Ha||va)&&e&&e.dom.contentEditable=="false"&&this.addHackNode("IMG",r),this.addHackNode("BR",this.top))}addHackNode(e,r){if(r==this.top&&this.index<r.children.length&&r.children[this.index].matchesHack(e))this.index++;else{let n=document.createElement(e);e=="IMG"&&(n.className="ProseMirror-separator",n.alt=""),e=="BR"&&(n.className="ProseMirror-trailingBreak");let i=new CO(this.top,[],n,null);r!=this.top?r.children.push(i):r.children.splice(this.index++,0,i),this.changed=!0}}isLocked(e){return this.lock&&(e==this.lock||e.nodeType==1&&e.contains(this.lock.parentNode))}}function RY(t,e){let r=e,n=r.children.length,i=t.childCount,a=new Map,s=[];e:for(;i>0;){let o;for(;;)if(n){let u=r.children[n-1];if(u instanceof _f)r=u,n=u.children.length;else{o=u,n--;break}}else{if(r==e)break e;n=r.parent.children.indexOf(r),r=r.parent}let l=o.node;if(l){if(l!=t.child(i-1))break;--i,a.set(o,i),s.push(o)}}return{index:i,matched:a,matches:s.reverse()}}function LY(t,e){return t.type.side-e.type.side}function OY(t,e,r,n){let i=e.locals(t),a=0;if(i.length==0){for(let u=0;u<t.childCount;u++){let c=t.child(u);n(c,i,e.forChild(a,c),u),a+=c.nodeSize}return}let s=0,o=[],l=null;for(let u=0;;){let c,h;for(;s<i.length&&i[s].to==a;){let w=i[s++];w.widget&&(c?(h||(h=[c])).push(w):c=w)}if(c)if(h){h.sort(LY);for(let w=0;w<h.length;w++)r(h[w],u,!!l)}else r(c,u,!!l);let p,v;if(l)v=-1,p=l,l=null;else if(u<t.childCount)v=u,p=t.child(u++);else break;for(let w=0;w<o.length;w++)o[w].to<=a&&o.splice(w--,1);for(;s<i.length&&i[s].from<=a&&i[s].to>a;)o.push(i[s++]);let y=a+p.nodeSize;if(p.isText){let w=y;s<i.length&&i[s].from<w&&(w=i[s].from);for(let T=0;T<o.length;T++)o[T].to<w&&(w=o[T].to);w<y&&(l=p.cut(w-a),p=p.cut(0,w-a),y=w,v=-1)}else for(;s<i.length&&i[s].to<y;)s++;let S=p.isInline&&!p.isLeaf?o.filter(w=>!w.inline):o.slice();n(p,S,e.forChild(a,p),v),a=y}}function DY(t){if(t.nodeName=="UL"||t.nodeName=="OL"){let e=t.style.cssText;t.style.cssText=e+"; list-style: square !important",window.getComputedStyle(t).listStyle,t.style.cssText=e}}function IY(t,e,r,n){for(let i=0,a=0;i<t.childCount&&a<=n;){let s=t.child(i++),o=a;if(a+=s.nodeSize,!s.isText)continue;let l=s.text;for(;i<t.childCount;){let u=t.child(i++);if(a+=u.nodeSize,!u.isText)break;l+=u.text}if(a>=r){if(a>=n&&l.slice(n-e.length-o,n-o)==e)return n-e.length;let u=o<n?l.lastIndexOf(e,n-o-1):-1;if(u>=0&&u+e.length+o>=r)return o+u;if(r==n&&l.length>=n+e.length-o&&l.slice(n-o,n-o+e.length)==e)return n}}return-1}function xk(t,e,r,n,i){let a=[];for(let s=0,o=0;s<t.length;s++){let l=t[s],u=o,c=o+=l.size;u>=r||c<=e?a.push(l):(u<e&&a.push(l.slice(0,e-u,n)),i&&(a.push(i),i=void 0),c>r&&a.push(l.slice(r-u,l.size,n)))}return a}function q_(t,e=null){let r=t.domSelectionRange(),n=t.state.doc;if(!r.focusNode)return null;let i=t.docView.nearestDesc(r.focusNode),a=i&&i.size==0,s=t.docView.posFromDOM(r.focusNode,r.focusOffset,1);if(s<0)return null;let o=n.resolve(s),l,u;if(K1(r)){for(l=s;i&&!i.node;)i=i.parent;let h=i.node;if(i&&h.isAtom&&Zt.isSelectable(h)&&i.parent&&!(h.isInline&&uY(r.focusNode,r.focusOffset,i.dom))){let p=i.posBefore;u=new Zt(s==p?o:n.resolve(p))}}else{if(r instanceof t.dom.ownerDocument.defaultView.Selection&&r.rangeCount>1){let h=s,p=s;for(let v=0;v<r.rangeCount;v++){let y=r.getRangeAt(v);h=Math.min(h,t.docView.posFromDOM(y.startContainer,y.startOffset,1)),p=Math.max(p,t.docView.posFromDOM(y.endContainer,y.endOffset,-1))}if(h<0)return null;[l,s]=p==t.state.selection.anchor?[p,h]:[h,p],o=n.resolve(s)}else l=t.docView.posFromDOM(r.anchorNode,r.anchorOffset,1);if(l<0)return null}let c=n.resolve(l);if(!u){let h=e=="pointer"||t.state.selection.head<o.pos&&!a?1:-1;u=$_(t,c,o,h)}return u}function PO(t){return t.editable?t.hasFocus():AO(t)&&document.activeElement&&document.activeElement.contains(t.dom)}function mc(t,e=!1){let r=t.state.selection;if(MO(t,r),!!PO(t)){if(!e&&t.input.mouseDown&&t.input.mouseDown.allowDefault&&va){let n=t.domSelectionRange(),i=t.domObserver.currentSelection;if(n.anchorNode&&i.anchorNode&&kf(n.anchorNode,n.anchorOffset,i.anchorNode,i.anchorOffset)){t.input.mouseDown.delayedSelectionSync=!0,t.domObserver.setCurSelection();return}}if(t.domObserver.disconnectSelection(),t.cursorWrapper)FY(t);else{let{anchor:n,head:i}=r,a,s;U3&&!(r instanceof dr)&&(r.$from.parent.inlineContent||(a=G3(t,r.from)),!r.empty&&!r.$from.parent.inlineContent&&(s=G3(t,r.to))),t.docView.setSelection(n,i,t,e),U3&&(a&&V3(a),s&&V3(s)),r.visible?t.dom.classList.remove("ProseMirror-hideselection"):(t.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&jY(t))}t.domObserver.setCurSelection(),t.domObserver.connectSelection()}}const U3=Ha||va&&gO<63;function G3(t,e){let{node:r,offset:n}=t.docView.domFromPos(e,0),i=n<r.childNodes.length?r.childNodes[n]:null,a=n?r.childNodes[n-1]:null;if(Ha&&i&&i.contentEditable=="false")return nS(i);if((!i||i.contentEditable=="false")&&(!a||a.contentEditable=="false")){if(i)return nS(i);if(a)return nS(a)}}function nS(t){return t.contentEditable="true",Ha&&t.draggable&&(t.draggable=!1,t.wasDraggable=!0),t}function V3(t){t.contentEditable="false",t.wasDraggable&&(t.draggable=!0,t.wasDraggable=null)}function jY(t){let e=t.dom.ownerDocument;e.removeEventListener("selectionchange",t.input.hideSelectionGuard);let r=t.domSelectionRange(),n=r.anchorNode,i=r.anchorOffset;e.addEventListener("selectionchange",t.input.hideSelectionGuard=()=>{(r.anchorNode!=n||r.anchorOffset!=i)&&(e.removeEventListener("selectionchange",t.input.hideSelectionGuard),setTimeout(()=>{(!PO(t)||t.state.selection.visible)&&t.dom.classList.remove("ProseMirror-hideselection")},20))})}function FY(t){let e=t.domSelection();if(!e)return;let r=t.cursorWrapper.dom,n=r.nodeName=="IMG";n?e.collapse(r.parentNode,za(r)+1):e.collapse(r,0),!n&&!t.state.selection.visible&&Xs&&qd<=11&&(r.disabled=!0,r.disabled=!1)}function MO(t,e){if(e instanceof Zt){let r=t.docView.descAt(e.from);r!=t.lastSelectedViewDesc&&(H3(t),r&&r.selectNode(),t.lastSelectedViewDesc=r)}else H3(t)}function H3(t){t.lastSelectedViewDesc&&(t.lastSelectedViewDesc.parent&&t.lastSelectedViewDesc.deselectNode(),t.lastSelectedViewDesc=void 0)}function $_(t,e,r,n){return t.someProp("createSelectionBetween",i=>i(t,e,r))||dr.between(e,r,n)}function W3(t){return t.editable&&!t.hasFocus()?!1:AO(t)}function AO(t){let e=t.domSelectionRange();if(!e.anchorNode)return!1;try{return t.dom.contains(e.anchorNode.nodeType==3?e.anchorNode.parentNode:e.anchorNode)&&(t.editable||t.dom.contains(e.focusNode.nodeType==3?e.focusNode.parentNode:e.focusNode))}catch{return!1}}function BY(t){let e=t.docView.domFromPos(t.state.selection.anchor,0),r=t.domSelectionRange();return kf(e.node,e.offset,r.anchorNode,r.anchorOffset)}function bk(t,e){let{$anchor:r,$head:n}=t.selection,i=e>0?r.max(n):r.min(n),a=i.parent.inlineContent?i.depth?t.doc.resolve(e>0?i.after():i.before()):null:i;return a&&_r.findFrom(a,e)}function Td(t,e){return t.dispatch(t.state.tr.setSelection(e).scrollIntoView()),!0}function q3(t,e,r){let n=t.state.selection;if(n instanceof dr)if(r.indexOf("s")>-1){let{$head:i}=n,a=i.textOffset?null:e<0?i.nodeBefore:i.nodeAfter;if(!a||a.isText||!a.isLeaf)return!1;let s=t.state.doc.resolve(i.pos+a.nodeSize*(e<0?-1:1));return Td(t,new dr(n.$anchor,s))}else if(n.empty){if(t.endOfTextblock(e>0?"forward":"backward")){let i=bk(t.state,e);return i&&i instanceof Zt?Td(t,i):!1}else if(!(Go&&r.indexOf("m")>-1)){let i=n.$head,a=i.textOffset?null:e<0?i.nodeBefore:i.nodeAfter,s;if(!a||a.isText)return!1;let o=e<0?i.pos-a.nodeSize:i.pos;return a.isAtom||(s=t.docView.descAt(o))&&!s.contentDOM?Zt.isSelectable(a)?Td(t,new Zt(e<0?t.state.doc.resolve(i.pos-a.nodeSize):i)):d0?Td(t,new dr(t.state.doc.resolve(e<0?o:o+a.nodeSize))):!1:!1}}else return!1;else{if(n instanceof Zt&&n.node.isInline)return Td(t,new dr(e>0?n.$to:n.$from));{let i=bk(t.state,e);return i?Td(t,i):!1}}}function Ax(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}function sv(t,e){let r=t.pmViewDesc;return r&&r.size==0&&(e<0||t.nextSibling||t.nodeName!="BR")}function _p(t,e){return e<0?zY(t):UY(t)}function zY(t){let e=t.domSelectionRange(),r=e.focusNode,n=e.focusOffset;if(!r)return;let i,a,s=!1;for($o&&r.nodeType==1&&n<Ax(r)&&sv(r.childNodes[n],-1)&&(s=!0);;)if(n>0){if(r.nodeType!=1)break;{let o=r.childNodes[n-1];if(sv(o,-1))i=r,a=--n;else if(o.nodeType==3)r=o,n=r.nodeValue.length;else break}}else{if(RO(r))break;{let o=r.previousSibling;for(;o&&sv(o,-1);)i=r.parentNode,a=za(o),o=o.previousSibling;if(o)r=o,n=Ax(r);else{if(r=r.parentNode,r==t.dom)break;n=0}}}s?wk(t,r,n):i&&wk(t,i,a)}function UY(t){let e=t.domSelectionRange(),r=e.focusNode,n=e.focusOffset;if(!r)return;let i=Ax(r),a,s;for(;;)if(n<i){if(r.nodeType!=1)break;let o=r.childNodes[n];if(sv(o,1))a=r,s=++n;else break}else{if(RO(r))break;{let o=r.nextSibling;for(;o&&sv(o,1);)a=o.parentNode,s=za(o)+1,o=o.nextSibling;if(o)r=o,n=0,i=Ax(r);else{if(r=r.parentNode,r==t.dom)break;n=i=0}}}a&&wk(t,a,s)}function RO(t){let e=t.pmViewDesc;return e&&e.node&&e.node.isBlock}function GY(t,e){for(;t&&e==t.childNodes.length&&!c0(t);)e=za(t)+1,t=t.parentNode;for(;t&&e<t.childNodes.length;){let r=t.childNodes[e];if(r.nodeType==3)return r;if(r.nodeType==1&&r.contentEditable=="false")break;t=r,e=0}}function VY(t,e){for(;t&&!e&&!c0(t);)e=za(t),t=t.parentNode;for(;t&&e;){let r=t.childNodes[e-1];if(r.nodeType==3)return r;if(r.nodeType==1&&r.contentEditable=="false")break;t=r,e=t.childNodes.length}}function wk(t,e,r){if(e.nodeType!=3){let a,s;(s=GY(e,r))?(e=s,r=0):(a=VY(e,r))&&(e=a,r=a.nodeValue.length)}let n=t.domSelection();if(!n)return;if(K1(n)){let a=document.createRange();a.setEnd(e,r),a.setStart(e,r),n.removeAllRanges(),n.addRange(a)}else n.extend&&n.extend(e,r);t.domObserver.setCurSelection();let{state:i}=t;setTimeout(()=>{t.state==i&&mc(t)},50)}function $3(t,e){let r=t.state.doc.resolve(e);if(!(va||vO)&&r.parent.inlineContent){let i=t.coordsAtPos(e);if(e>r.start()){let a=t.coordsAtPos(e-1),s=(a.top+a.bottom)/2;if(s>i.top&&s<i.bottom&&Math.abs(a.left-i.left)>1)return a.left<i.left?"ltr":"rtl"}if(e<r.end()){let a=t.coordsAtPos(e+1),s=(a.top+a.bottom)/2;if(s>i.top&&s<i.bottom&&Math.abs(a.left-i.left)>1)return a.left>i.left?"ltr":"rtl"}}return getComputedStyle(t.dom).direction=="rtl"?"rtl":"ltr"}function K3(t,e,r){let n=t.state.selection;if(n instanceof dr&&!n.empty||r.indexOf("s")>-1||Go&&r.indexOf("m")>-1)return!1;let{$from:i,$to:a}=n;if(!i.parent.inlineContent||t.endOfTextblock(e<0?"up":"down")){let s=bk(t.state,e);if(s&&s instanceof Zt)return Td(t,s)}if(!i.parent.inlineContent){let s=e<0?i:a,o=n instanceof mo?_r.near(s,e):_r.findFrom(s,e);return o?Td(t,o):!1}return!1}function Z3(t,e){if(!(t.state.selection instanceof dr))return!0;let{$head:r,$anchor:n,empty:i}=t.state.selection;if(!r.sameParent(n))return!0;if(!i)return!1;if(t.endOfTextblock(e>0?"forward":"backward"))return!0;let a=!r.textOffset&&(e<0?r.nodeBefore:r.nodeAfter);if(a&&!a.isText){let s=t.state.tr;return e<0?s.delete(r.pos-a.nodeSize,r.pos):s.delete(r.pos,r.pos+a.nodeSize),t.dispatch(s),!0}return!1}function Y3(t,e,r){t.domObserver.stop(),e.contentEditable=r,t.domObserver.start()}function HY(t){if(!Ha||t.state.selection.$head.parentOffset>0)return!1;let{focusNode:e,focusOffset:r}=t.domSelectionRange();if(e&&e.nodeType==1&&r==0&&e.firstChild&&e.firstChild.contentEditable=="false"){let n=e.firstChild;Y3(t,n,"true"),setTimeout(()=>Y3(t,n,"false"),20)}return!1}function WY(t){let e="";return t.ctrlKey&&(e+="c"),t.metaKey&&(e+="m"),t.altKey&&(e+="a"),t.shiftKey&&(e+="s"),e}function qY(t,e){let r=e.keyCode,n=WY(e);if(r==8||Go&&r==72&&n=="c")return Z3(t,-1)||_p(t,-1);if(r==46&&!e.shiftKey||Go&&r==68&&n=="c")return Z3(t,1)||_p(t,1);if(r==13||r==27)return!0;if(r==37||Go&&r==66&&n=="c"){let i=r==37?$3(t,t.state.selection.from)=="ltr"?-1:1:-1;return q3(t,i,n)||_p(t,i)}else if(r==39||Go&&r==70&&n=="c"){let i=r==39?$3(t,t.state.selection.from)=="ltr"?1:-1:1;return q3(t,i,n)||_p(t,i)}else{if(r==38||Go&&r==80&&n=="c")return K3(t,-1,n)||_p(t,-1);if(r==40||Go&&r==78&&n=="c")return HY(t)||K3(t,1,n)||_p(t,1);if(n==(Go?"m":"c")&&(r==66||r==73||r==89||r==90))return!0}return!1}function K_(t,e){t.someProp("transformCopied",v=>{e=v(e,t)});let r=[],{content:n,openStart:i,openEnd:a}=e;for(;i>1&&a>1&&n.childCount==1&&n.firstChild.childCount==1;){i--,a--;let v=n.firstChild;r.push(v.type.name,v.attrs!=v.type.defaultAttrs?v.attrs:null),n=v.content}let s=t.someProp("clipboardSerializer")||Af.fromSchema(t.state.schema),o=FO(),l=o.createElement("div");l.appendChild(s.serializeFragment(n,{document:o}));let u=l.firstChild,c,h=0;for(;u&&u.nodeType==1&&(c=jO[u.nodeName.toLowerCase()]);){for(let v=c.length-1;v>=0;v--){let y=o.createElement(c[v]);for(;l.firstChild;)y.appendChild(l.firstChild);l.appendChild(y),h++}u=l.firstChild}u&&u.nodeType==1&&u.setAttribute("data-pm-slice",`${i} ${a}${h?` -${h}`:""} ${JSON.stringify(r)}`);let p=t.someProp("clipboardTextSerializer",v=>v(e,t))||e.content.textBetween(0,e.content.size,`

`);return{dom:l,text:p,slice:e}}function LO(t,e,r,n,i){let a=i.parent.type.spec.code,s,o;if(!r&&!e)return null;let l=!!e&&(n||a||!r);if(l){if(t.someProp("transformPastedText",p=>{e=p(e,a||n,t)}),a)return o=new Mt(at.from(t.state.schema.text(e.replace(/\r\n?/g,`
`))),0,0),t.someProp("transformPasted",p=>{o=p(o,t,!0)}),o;let h=t.someProp("clipboardTextParser",p=>p(e,i,n,t));if(h)o=h;else{let p=i.marks(),{schema:v}=t.state,y=Af.fromSchema(v);s=document.createElement("div"),e.split(/(?:\r\n?|\n)+/).forEach(S=>{let w=s.appendChild(document.createElement("p"));S&&w.appendChild(y.serializeNode(v.text(S,p)))})}}else t.someProp("transformPastedHTML",h=>{r=h(r,t)}),s=YY(r),d0&&XY(s);let u=s&&s.querySelector("[data-pm-slice]"),c=u&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(u.getAttribute("data-pm-slice")||"");if(c&&c[3])for(let h=+c[3];h>0;h--){let p=s.firstChild;for(;p&&p.nodeType!=1;)p=p.nextSibling;if(!p)break;s=p}if(o||(o=(t.someProp("clipboardParser")||t.someProp("domParser")||Wd.fromSchema(t.state.schema)).parseSlice(s,{preserveWhitespace:!!(l||c),context:i,ruleFromNode(p){return p.nodeName=="BR"&&!p.nextSibling&&p.parentNode&&!$Y.test(p.parentNode.nodeName)?{ignore:!0}:null}})),c)o=QY(X3(o,+c[1],+c[2]),c[4]);else if(o=Mt.maxOpen(KY(o.content,i),!0),o.openStart||o.openEnd){let h=0,p=0;for(let v=o.content.firstChild;h<o.openStart&&!v.type.spec.isolating;h++,v=v.firstChild);for(let v=o.content.lastChild;p<o.openEnd&&!v.type.spec.isolating;p++,v=v.lastChild);o=X3(o,h,p)}return t.someProp("transformPasted",h=>{o=h(o,t,l)}),o}const $Y=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function KY(t,e){if(t.childCount<2)return t;for(let r=e.depth;r>=0;r--){let i=e.node(r).contentMatchAt(e.index(r)),a,s=[];if(t.forEach(o=>{if(!s)return;let l=i.findWrapping(o.type),u;if(!l)return s=null;if(u=s.length&&a.length&&DO(l,a,o,s[s.length-1],0))s[s.length-1]=u;else{s.length&&(s[s.length-1]=IO(s[s.length-1],a.length));let c=OO(o,l);s.push(c),i=i.matchType(c.type),a=l}}),s)return at.from(s)}return t}function OO(t,e,r=0){for(let n=e.length-1;n>=r;n--)t=e[n].create(null,at.from(t));return t}function DO(t,e,r,n,i){if(i<t.length&&i<e.length&&t[i]==e[i]){let a=DO(t,e,r,n.lastChild,i+1);if(a)return n.copy(n.content.replaceChild(n.childCount-1,a));if(n.contentMatchAt(n.childCount).matchType(i==t.length-1?r.type:t[i+1]))return n.copy(n.content.append(at.from(OO(r,t,i+1))))}}function IO(t,e){if(e==0)return t;let r=t.content.replaceChild(t.childCount-1,IO(t.lastChild,e-1)),n=t.contentMatchAt(t.childCount).fillBefore(at.empty,!0);return t.copy(r.append(n))}function Sk(t,e,r,n,i,a){let s=e<0?t.firstChild:t.lastChild,o=s.content;return t.childCount>1&&(a=0),i<n-1&&(o=Sk(o,e,r,n,i+1,a)),i>=r&&(o=e<0?s.contentMatchAt(0).fillBefore(o,a<=i).append(o):o.append(s.contentMatchAt(s.childCount).fillBefore(at.empty,!0))),t.replaceChild(e<0?0:t.childCount-1,s.copy(o))}function X3(t,e,r){return e<t.openStart&&(t=new Mt(Sk(t.content,-1,e,t.openStart,0,t.openEnd),e,t.openEnd)),r<t.openEnd&&(t=new Mt(Sk(t.content,1,r,t.openEnd,0,0),t.openStart,r)),t}const jO={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};let Q3=null;function FO(){return Q3||(Q3=document.implementation.createHTMLDocument("title"))}let iS=null;function ZY(t){let e=window.trustedTypes;return e?(iS||(iS=e.defaultPolicy||e.createPolicy("ProseMirrorClipboard",{createHTML:r=>r})),iS.createHTML(t)):t}function YY(t){let e=/^(\s*<meta [^>]*>)*/.exec(t);e&&(t=t.slice(e[0].length));let r=FO().createElement("div"),n=/<([a-z][^>\s]+)/i.exec(t),i;if((i=n&&jO[n[1].toLowerCase()])&&(t=i.map(a=>"<"+a+">").join("")+t+i.map(a=>"</"+a+">").reverse().join("")),r.innerHTML=ZY(t),i)for(let a=0;a<i.length;a++)r=r.querySelector(i[a])||r;return r}function XY(t){let e=t.querySelectorAll(va?"span:not([class]):not([style])":"span.Apple-converted-space");for(let r=0;r<e.length;r++){let n=e[r];n.childNodes.length==1&&n.textContent==""&&n.parentNode&&n.parentNode.replaceChild(t.ownerDocument.createTextNode(" "),n)}}function QY(t,e){if(!t.size)return t;let r=t.content.firstChild.type.schema,n;try{n=JSON.parse(e)}catch{return t}let{content:i,openStart:a,openEnd:s}=t;for(let o=n.length-2;o>=0;o-=2){let l=r.nodes[n[o]];if(!l||l.hasRequiredAttrs())break;i=at.from(l.create(n[o+1],i)),a++,s++}return new Mt(i,a,s)}const Ps={},Ms={},JY={touchstart:!0,touchmove:!0};class eX{constructor(){this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:"",button:0},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastFocus=0,this.lastTouch=0,this.lastChromeDelete=0,this.composing=!1,this.compositionNode=null,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.compositionID=1,this.badSafariComposition=!1,this.compositionPendingChanges=0,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null}}function tX(t){for(let e in Ps){let r=Ps[e];t.dom.addEventListener(e,t.input.eventHandlers[e]=n=>{nX(t,n)&&!Z_(t,n)&&(t.editable||!(n.type in Ms))&&r(t,n)},JY[e]?{passive:!0}:void 0)}Ha&&t.dom.addEventListener("input",()=>null),kk(t)}function Bd(t,e){t.input.lastSelectionOrigin=e,t.input.lastSelectionTime=Date.now()}function rX(t){t.domObserver.stop();for(let e in t.input.eventHandlers)t.dom.removeEventListener(e,t.input.eventHandlers[e]);clearTimeout(t.input.composingTimeout),clearTimeout(t.input.lastIOSEnterFallbackTimeout)}function kk(t){t.someProp("handleDOMEvents",e=>{for(let r in e)t.input.eventHandlers[r]||t.dom.addEventListener(r,t.input.eventHandlers[r]=n=>Z_(t,n))})}function Z_(t,e){return t.someProp("handleDOMEvents",r=>{let n=r[e.type];return n?n(t,e)||e.defaultPrevented:!1})}function nX(t,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let r=e.target;r!=t.dom;r=r.parentNode)if(!r||r.nodeType==11||r.pmViewDesc&&r.pmViewDesc.stopEvent(e))return!1;return!0}function iX(t,e){!Z_(t,e)&&Ps[e.type]&&(t.editable||!(e.type in Ms))&&Ps[e.type](t,e)}Ms.keydown=(t,e)=>{let r=e;if(t.input.shiftKey=r.keyCode==16||r.shiftKey,!zO(t,r)&&(t.input.lastKeyCode=r.keyCode,t.input.lastKeyCodeTime=Date.now(),!(hc&&va&&r.keyCode==13)))if(r.keyCode!=229&&t.domObserver.forceFlush(),Qp&&r.keyCode==13&&!r.ctrlKey&&!r.altKey&&!r.metaKey){let n=Date.now();t.input.lastIOSEnter=n,t.input.lastIOSEnterFallbackTimeout=setTimeout(()=>{t.input.lastIOSEnter==n&&(t.someProp("handleKeyDown",i=>i(t,Jh(13,"Enter"))),t.input.lastIOSEnter=0)},200)}else t.someProp("handleKeyDown",n=>n(t,r))||qY(t,r)?r.preventDefault():Bd(t,"key")};Ms.keyup=(t,e)=>{e.keyCode==16&&(t.input.shiftKey=!1)};Ms.keypress=(t,e)=>{let r=e;if(zO(t,r)||!r.charCode||r.ctrlKey&&!r.altKey||Go&&r.metaKey)return;if(t.someProp("handleKeyPress",i=>i(t,r))){r.preventDefault();return}let n=t.state.selection;if(!(n instanceof dr)||!n.$from.sameParent(n.$to)){let i=String.fromCharCode(r.charCode),a=()=>t.state.tr.insertText(i).scrollIntoView();!/[\r\n]/.test(i)&&!t.someProp("handleTextInput",s=>s(t,n.$from.pos,n.$to.pos,i,a))&&t.dispatch(a()),r.preventDefault()}};function Y1(t){return{left:t.clientX,top:t.clientY}}function aX(t,e){let r=e.x-t.clientX,n=e.y-t.clientY;return r*r+n*n<100}function Y_(t,e,r,n,i){if(n==-1)return!1;let a=t.state.doc.resolve(n);for(let s=a.depth+1;s>0;s--)if(t.someProp(e,o=>s>a.depth?o(t,r,a.nodeAfter,a.before(s),i,!0):o(t,r,a.node(s),a.before(s),i,!1)))return!0;return!1}function Vp(t,e,r){if(t.focused||t.focus(),t.state.selection.eq(e))return;let n=t.state.tr.setSelection(e);n.setMeta("pointer",!0),t.dispatch(n)}function sX(t,e){if(e==-1)return!1;let r=t.state.doc.resolve(e),n=r.nodeAfter;return n&&n.isAtom&&Zt.isSelectable(n)?(Vp(t,new Zt(r)),!0):!1}function oX(t,e){if(e==-1)return!1;let r=t.state.selection,n,i;r instanceof Zt&&(n=r.node);let a=t.state.doc.resolve(e);for(let s=a.depth+1;s>0;s--){let o=s>a.depth?a.nodeAfter:a.node(s);if(Zt.isSelectable(o)){n&&r.$from.depth>0&&s>=r.$from.depth&&a.before(r.$from.depth+1)==r.$from.pos?i=a.before(r.$from.depth):i=a.before(s);break}}return i!=null?(Vp(t,Zt.create(t.state.doc,i)),!0):!1}function lX(t,e,r,n,i){return Y_(t,"handleClickOn",e,r,n)||t.someProp("handleClick",a=>a(t,e,n))||(i?oX(t,r):sX(t,r))}function uX(t,e,r,n){return Y_(t,"handleDoubleClickOn",e,r,n)||t.someProp("handleDoubleClick",i=>i(t,e,n))}function cX(t,e,r,n){return Y_(t,"handleTripleClickOn",e,r,n)||t.someProp("handleTripleClick",i=>i(t,e,n))||dX(t,r,n)}function dX(t,e,r){if(r.button!=0)return!1;let n=t.state.doc;if(e==-1)return n.inlineContent?(Vp(t,dr.create(n,0,n.content.size)),!0):!1;let i=n.resolve(e);for(let a=i.depth+1;a>0;a--){let s=a>i.depth?i.nodeAfter:i.node(a),o=i.before(a);if(s.inlineContent)Vp(t,dr.create(n,o+1,o+1+s.content.size));else if(Zt.isSelectable(s))Vp(t,Zt.create(n,o));else continue;return!0}}function X_(t){return Rx(t)}const BO=Go?"metaKey":"ctrlKey";Ps.mousedown=(t,e)=>{let r=e;t.input.shiftKey=r.shiftKey;let n=X_(t),i=Date.now(),a="singleClick";i-t.input.lastClick.time<500&&aX(r,t.input.lastClick)&&!r[BO]&&t.input.lastClick.button==r.button&&(t.input.lastClick.type=="singleClick"?a="doubleClick":t.input.lastClick.type=="doubleClick"&&(a="tripleClick")),t.input.lastClick={time:i,x:r.clientX,y:r.clientY,type:a,button:r.button};let s=t.posAtCoords(Y1(r));s&&(a=="singleClick"?(t.input.mouseDown&&t.input.mouseDown.done(),t.input.mouseDown=new hX(t,s,r,!!n)):(a=="doubleClick"?uX:cX)(t,s.pos,s.inside,r)?r.preventDefault():Bd(t,"pointer"))};class hX{constructor(e,r,n,i){this.view=e,this.pos=r,this.event=n,this.flushed=i,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=e.state.doc,this.selectNode=!!n[BO],this.allowDefault=n.shiftKey;let a,s;if(r.inside>-1)a=e.state.doc.nodeAt(r.inside),s=r.inside;else{let c=e.state.doc.resolve(r.pos);a=c.parent,s=c.depth?c.before():0}const o=i?null:n.target,l=o?e.docView.nearestDesc(o,!0):null;this.target=l&&l.nodeDOM.nodeType==1?l.nodeDOM:null;let{selection:u}=e.state;(n.button==0&&a.type.spec.draggable&&a.type.spec.selectable!==!1||u instanceof Zt&&u.from<=s&&u.to>s)&&(this.mightDrag={node:a,pos:s,addAttr:!!(this.target&&!this.target.draggable),setUneditable:!!(this.target&&$o&&!this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),e.root.addEventListener("mouseup",this.up=this.up.bind(this)),e.root.addEventListener("mousemove",this.move=this.move.bind(this)),Bd(e,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(()=>mc(this.view)),this.view.input.mouseDown=null}up(e){if(this.done(),!this.view.dom.contains(e.target))return;let r=this.pos;this.view.state.doc!=this.startDoc&&(r=this.view.posAtCoords(Y1(e))),this.updateAllowDefault(e),this.allowDefault||!r?Bd(this.view,"pointer"):lX(this.view,r.pos,r.inside,e,this.selectNode)?e.preventDefault():e.button==0&&(this.flushed||Ha&&this.mightDrag&&!this.mightDrag.node.isAtom||va&&!this.view.state.selection.visible&&Math.min(Math.abs(r.pos-this.view.state.selection.from),Math.abs(r.pos-this.view.state.selection.to))<=2)?(Vp(this.view,_r.near(this.view.state.doc.resolve(r.pos))),e.preventDefault()):Bd(this.view,"pointer")}move(e){this.updateAllowDefault(e),Bd(this.view,"pointer"),e.buttons==0&&this.done()}updateAllowDefault(e){!this.allowDefault&&(Math.abs(this.event.x-e.clientX)>4||Math.abs(this.event.y-e.clientY)>4)&&(this.allowDefault=!0)}}Ps.touchstart=t=>{t.input.lastTouch=Date.now(),X_(t),Bd(t,"pointer")};Ps.touchmove=t=>{t.input.lastTouch=Date.now(),Bd(t,"pointer")};Ps.contextmenu=t=>X_(t);function zO(t,e){return t.composing?!0:Ha&&Math.abs(e.timeStamp-t.input.compositionEndedAt)<500?(t.input.compositionEndedAt=-2e8,!0):!1}const fX=hc?5e3:-1;Ms.compositionstart=Ms.compositionupdate=t=>{if(!t.composing){t.domObserver.flush();let{state:e}=t,r=e.selection.$to;if(e.selection instanceof dr&&(e.storedMarks||!r.textOffset&&r.parentOffset&&r.nodeBefore.marks.some(n=>n.type.spec.inclusive===!1)||va&&vO&&pX(t)))t.markCursor=t.state.storedMarks||r.marks(),Rx(t,!0),t.markCursor=null;else if(Rx(t,!e.selection.empty),$o&&e.selection.empty&&r.parentOffset&&!r.textOffset&&r.nodeBefore.marks.length){let n=t.domSelectionRange();for(let i=n.focusNode,a=n.focusOffset;i&&i.nodeType==1&&a!=0;){let s=a<0?i.lastChild:i.childNodes[a-1];if(!s)break;if(s.nodeType==3){let o=t.domSelection();o&&o.collapse(s,s.nodeValue.length);break}else i=s,a=-1}}t.input.composing=!0}UO(t,fX)};function pX(t){let{focusNode:e,focusOffset:r}=t.domSelectionRange();if(!e||e.nodeType!=1||r>=e.childNodes.length)return!1;let n=e.childNodes[r];return n.nodeType==1&&n.contentEditable=="false"}Ms.compositionend=(t,e)=>{t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=e.timeStamp,t.input.compositionPendingChanges=t.domObserver.pendingRecords().length?t.input.compositionID:0,t.input.compositionNode=null,t.input.badSafariComposition?t.domObserver.forceFlush():t.input.compositionPendingChanges&&Promise.resolve().then(()=>t.domObserver.flush()),t.input.compositionID++,UO(t,20))};function UO(t,e){clearTimeout(t.input.composingTimeout),e>-1&&(t.input.composingTimeout=setTimeout(()=>Rx(t),e))}function GO(t){for(t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=gX());t.input.compositionNodes.length>0;)t.input.compositionNodes.pop().markParentsDirty()}function mX(t){let e=t.domSelectionRange();if(!e.focusNode)return null;let r=oY(e.focusNode,e.focusOffset),n=lY(e.focusNode,e.focusOffset);if(r&&n&&r!=n){let i=n.pmViewDesc,a=t.domObserver.lastChangedTextNode;if(r==a||n==a)return a;if(!i||!i.isText(n.nodeValue))return n;if(t.input.compositionNode==n){let s=r.pmViewDesc;if(!(!s||!s.isText(r.nodeValue)))return n}}return r||n}function gX(){let t=document.createEvent("Event");return t.initEvent("event",!0,!0),t.timeStamp}function Rx(t,e=!1){if(!(hc&&t.domObserver.flushingSoon>=0)){if(t.domObserver.forceFlush(),GO(t),e||t.docView&&t.docView.dirty){let r=q_(t),n=t.state.selection;return r&&!r.eq(n)?t.dispatch(t.state.tr.setSelection(r)):(t.markCursor||e)&&!n.$from.node(n.$from.sharedDepth(n.to)).inlineContent?t.dispatch(t.state.tr.deleteSelection()):t.updateState(t.state),!0}return!1}}function vX(t,e){if(!t.dom.parentNode)return;let r=t.dom.parentNode.appendChild(document.createElement("div"));r.appendChild(e),r.style.cssText="position: fixed; left: -10000px; top: 10px";let n=getSelection(),i=document.createRange();i.selectNodeContents(e),t.dom.blur(),n.removeAllRanges(),n.addRange(i),setTimeout(()=>{r.parentNode&&r.parentNode.removeChild(r),t.focus()},50)}const Iv=Xs&&qd<15||Qp&&hY<604;Ps.copy=Ms.cut=(t,e)=>{let r=e,n=t.state.selection,i=r.type=="cut";if(n.empty)return;let a=Iv?null:r.clipboardData,s=n.content(),{dom:o,text:l}=K_(t,s);a?(r.preventDefault(),a.clearData(),a.setData("text/html",o.innerHTML),a.setData("text/plain",l)):vX(t,o),i&&t.dispatch(t.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))};function yX(t){return t.openStart==0&&t.openEnd==0&&t.content.childCount==1?t.content.firstChild:null}function xX(t,e){if(!t.dom.parentNode)return;let r=t.input.shiftKey||t.state.selection.$from.parent.type.spec.code,n=t.dom.parentNode.appendChild(document.createElement(r?"textarea":"div"));r||(n.contentEditable="true"),n.style.cssText="position: fixed; left: -10000px; top: 10px",n.focus();let i=t.input.shiftKey&&t.input.lastKeyCode!=45;setTimeout(()=>{t.focus(),n.parentNode&&n.parentNode.removeChild(n),r?jv(t,n.value,null,i,e):jv(t,n.textContent,n.innerHTML,i,e)},50)}function jv(t,e,r,n,i){let a=LO(t,e,r,n,t.state.selection.$from);if(t.someProp("handlePaste",l=>l(t,i,a||Mt.empty)))return!0;if(!a)return!1;let s=yX(a),o=s?t.state.tr.replaceSelectionWith(s,n):t.state.tr.replaceSelection(a);return t.dispatch(o.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}function VO(t){let e=t.getData("text/plain")||t.getData("Text");if(e)return e;let r=t.getData("text/uri-list");return r?r.replace(/\r?\n/g," "):""}Ms.paste=(t,e)=>{let r=e;if(t.composing&&!hc)return;let n=Iv?null:r.clipboardData,i=t.input.shiftKey&&t.input.lastKeyCode!=45;n&&jv(t,VO(n),n.getData("text/html"),i,r)?r.preventDefault():xX(t,r)};class HO{constructor(e,r,n){this.slice=e,this.move=r,this.node=n}}const bX=Go?"altKey":"ctrlKey";function WO(t,e){let r=t.someProp("dragCopies",n=>!n(e));return r??!e[bX]}Ps.dragstart=(t,e)=>{let r=e,n=t.input.mouseDown;if(n&&n.done(),!r.dataTransfer)return;let i=t.state.selection,a=i.empty?null:t.posAtCoords(Y1(r)),s;if(!(a&&a.pos>=i.from&&a.pos<=(i instanceof Zt?i.to-1:i.to))){if(n&&n.mightDrag)s=Zt.create(t.state.doc,n.mightDrag.pos);else if(r.target&&r.target.nodeType==1){let h=t.docView.nearestDesc(r.target,!0);h&&h.node.type.spec.draggable&&h!=t.docView&&(s=Zt.create(t.state.doc,h.posBefore))}}let o=(s||t.state.selection).content(),{dom:l,text:u,slice:c}=K_(t,o);(!r.dataTransfer.files.length||!va||gO>120)&&r.dataTransfer.clearData(),r.dataTransfer.setData(Iv?"Text":"text/html",l.innerHTML),r.dataTransfer.effectAllowed="copyMove",Iv||r.dataTransfer.setData("text/plain",u),t.dragging=new HO(c,WO(t,r),s)};Ps.dragend=t=>{let e=t.dragging;window.setTimeout(()=>{t.dragging==e&&(t.dragging=null)},50)};Ms.dragover=Ms.dragenter=(t,e)=>e.preventDefault();Ms.drop=(t,e)=>{try{wX(t,e,t.dragging)}finally{t.dragging=null}};function wX(t,e,r){if(!e.dataTransfer)return;let n=t.posAtCoords(Y1(e));if(!n)return;let i=t.state.doc.resolve(n.pos),a=r&&r.slice;a?t.someProp("transformPasted",v=>{a=v(a,t,!1)}):a=LO(t,VO(e.dataTransfer),Iv?null:e.dataTransfer.getData("text/html"),!1,i);let s=!!(r&&WO(t,e));if(t.someProp("handleDrop",v=>v(t,e,a||Mt.empty,s))){e.preventDefault();return}if(!a)return;e.preventDefault();let o=a?ZL(t.state.doc,i.pos,a):i.pos;o==null&&(o=i.pos);let l=t.state.tr;if(s){let{node:v}=r;v?v.replace(l):l.deleteSelection()}let u=l.mapping.map(o),c=a.openStart==0&&a.openEnd==0&&a.content.childCount==1,h=l.doc;if(c?l.replaceRangeWith(u,u,a.content.firstChild):l.replaceRange(u,u,a),l.doc.eq(h))return;let p=l.doc.resolve(u);if(c&&Zt.isSelectable(a.content.firstChild)&&p.nodeAfter&&p.nodeAfter.sameMarkup(a.content.firstChild))l.setSelection(new Zt(p));else{let v=l.mapping.map(o);l.mapping.maps[l.mapping.maps.length-1].forEach((y,S,w,T)=>v=T),l.setSelection($_(t,p,l.doc.resolve(v)))}t.focus(),t.dispatch(l.setMeta("uiEvent","drop"))}Ps.focus=t=>{t.input.lastFocus=Date.now(),t.focused||(t.domObserver.stop(),t.dom.classList.add("ProseMirror-focused"),t.domObserver.start(),t.focused=!0,setTimeout(()=>{t.docView&&t.hasFocus()&&!t.domObserver.currentSelection.eq(t.domSelectionRange())&&mc(t)},20))};Ps.blur=(t,e)=>{let r=e;t.focused&&(t.domObserver.stop(),t.dom.classList.remove("ProseMirror-focused"),t.domObserver.start(),r.relatedTarget&&t.dom.contains(r.relatedTarget)&&t.domObserver.currentSelection.clear(),t.focused=!1)};Ps.beforeinput=(t,e)=>{if(va&&hc&&e.inputType=="deleteContentBackward"){t.domObserver.flushSoon();let{domChangeCount:n}=t.input;setTimeout(()=>{if(t.input.domChangeCount!=n||(t.dom.blur(),t.focus(),t.someProp("handleKeyDown",a=>a(t,Jh(8,"Backspace")))))return;let{$cursor:i}=t.state.selection;i&&i.pos>0&&t.dispatch(t.state.tr.delete(i.pos-1,i.pos).scrollIntoView())},50)}};for(let t in Ms)Ps[t]=Ms[t];function Fv(t,e){if(t==e)return!0;for(let r in t)if(t[r]!==e[r])return!1;for(let r in e)if(!(r in t))return!1;return!0}class Lx{constructor(e,r){this.toDOM=e,this.spec=r||uf,this.side=this.spec.side||0}map(e,r,n,i){let{pos:a,deleted:s}=e.mapResult(r.from+i,this.side<0?-1:1);return s?null:new ls(a-n,a-n,this)}valid(){return!0}eq(e){return this==e||e instanceof Lx&&(this.spec.key&&this.spec.key==e.spec.key||this.toDOM==e.toDOM&&Fv(this.spec,e.spec))}destroy(e){this.spec.destroy&&this.spec.destroy(e)}}class Kd{constructor(e,r){this.attrs=e,this.spec=r||uf}map(e,r,n,i){let a=e.map(r.from+i,this.spec.inclusiveStart?-1:1)-n,s=e.map(r.to+i,this.spec.inclusiveEnd?1:-1)-n;return a>=s?null:new ls(a,s,this)}valid(e,r){return r.from<r.to}eq(e){return this==e||e instanceof Kd&&Fv(this.attrs,e.attrs)&&Fv(this.spec,e.spec)}static is(e){return e.type instanceof Kd}destroy(){}}class Q_{constructor(e,r){this.attrs=e,this.spec=r||uf}map(e,r,n,i){let a=e.mapResult(r.from+i,1);if(a.deleted)return null;let s=e.mapResult(r.to+i,-1);return s.deleted||s.pos<=a.pos?null:new ls(a.pos-n,s.pos-n,this)}valid(e,r){let{index:n,offset:i}=e.content.findIndex(r.from),a;return i==r.from&&!(a=e.child(n)).isText&&i+a.nodeSize==r.to}eq(e){return this==e||e instanceof Q_&&Fv(this.attrs,e.attrs)&&Fv(this.spec,e.spec)}destroy(){}}class ls{constructor(e,r,n){this.from=e,this.to=r,this.type=n}copy(e,r){return new ls(e,r,this.type)}eq(e,r=0){return this.type.eq(e.type)&&this.from+r==e.from&&this.to+r==e.to}map(e,r,n){return this.type.map(e,this,r,n)}static widget(e,r,n){return new ls(e,e,new Lx(r,n))}static inline(e,r,n,i){return new ls(e,r,new Kd(n,i))}static node(e,r,n,i){return new ls(e,r,new Q_(n,i))}get spec(){return this.type.spec}get inline(){return this.type instanceof Kd}get widget(){return this.type instanceof Lx}}const Np=[],uf={};class $n{constructor(e,r){this.local=e.length?e:Np,this.children=r.length?r:Np}static create(e,r){return r.length?Ox(r,e,0,uf):ss}find(e,r,n){let i=[];return this.findInner(e??0,r??1e9,i,0,n),i}findInner(e,r,n,i,a){for(let s=0;s<this.local.length;s++){let o=this.local[s];o.from<=r&&o.to>=e&&(!a||a(o.spec))&&n.push(o.copy(o.from+i,o.to+i))}for(let s=0;s<this.children.length;s+=3)if(this.children[s]<r&&this.children[s+1]>e){let o=this.children[s]+1;this.children[s+2].findInner(e-o,r-o,n,i+o,a)}}map(e,r,n){return this==ss||e.maps.length==0?this:this.mapInner(e,r,0,0,n||uf)}mapInner(e,r,n,i,a){let s;for(let o=0;o<this.local.length;o++){let l=this.local[o].map(e,n,i);l&&l.type.valid(r,l)?(s||(s=[])).push(l):a.onRemove&&a.onRemove(this.local[o].spec)}return this.children.length?SX(this.children,s||[],e,r,n,i,a):s?new $n(s.sort(cf),Np):ss}add(e,r){return r.length?this==ss?$n.create(e,r):this.addInner(e,r,0):this}addInner(e,r,n){let i,a=0;e.forEach((o,l)=>{let u=l+n,c;if(c=$O(r,o,u)){for(i||(i=this.children.slice());a<i.length&&i[a]<l;)a+=3;i[a]==l?i[a+2]=i[a+2].addInner(o,c,u+1):i.splice(a,0,l,l+o.nodeSize,Ox(c,o,u+1,uf)),a+=3}});let s=qO(a?KO(r):r,-n);for(let o=0;o<s.length;o++)s[o].type.valid(e,s[o])||s.splice(o--,1);return new $n(s.length?this.local.concat(s).sort(cf):this.local,i||this.children)}remove(e){return e.length==0||this==ss?this:this.removeInner(e,0)}removeInner(e,r){let n=this.children,i=this.local;for(let a=0;a<n.length;a+=3){let s,o=n[a]+r,l=n[a+1]+r;for(let c=0,h;c<e.length;c++)(h=e[c])&&h.from>o&&h.to<l&&(e[c]=null,(s||(s=[])).push(h));if(!s)continue;n==this.children&&(n=this.children.slice());let u=n[a+2].removeInner(s,o+1);u!=ss?n[a+2]=u:(n.splice(a,3),a-=3)}if(i.length){for(let a=0,s;a<e.length;a++)if(s=e[a])for(let o=0;o<i.length;o++)i[o].eq(s,r)&&(i==this.local&&(i=this.local.slice()),i.splice(o--,1))}return n==this.children&&i==this.local?this:i.length||n.length?new $n(i,n):ss}forChild(e,r){if(this==ss)return this;if(r.isLeaf)return $n.empty;let n,i;for(let o=0;o<this.children.length;o+=3)if(this.children[o]>=e){this.children[o]==e&&(n=this.children[o+2]);break}let a=e+1,s=a+r.content.size;for(let o=0;o<this.local.length;o++){let l=this.local[o];if(l.from<s&&l.to>a&&l.type instanceof Kd){let u=Math.max(a,l.from)-a,c=Math.min(s,l.to)-a;u<c&&(i||(i=[])).push(l.copy(u,c))}}if(i){let o=new $n(i.sort(cf),Np);return n?new Md([o,n]):o}return n||ss}eq(e){if(this==e)return!0;if(!(e instanceof $n)||this.local.length!=e.local.length||this.children.length!=e.children.length)return!1;for(let r=0;r<this.local.length;r++)if(!this.local[r].eq(e.local[r]))return!1;for(let r=0;r<this.children.length;r+=3)if(this.children[r]!=e.children[r]||this.children[r+1]!=e.children[r+1]||!this.children[r+2].eq(e.children[r+2]))return!1;return!0}locals(e){return J_(this.localsInner(e))}localsInner(e){if(this==ss)return Np;if(e.inlineContent||!this.local.some(Kd.is))return this.local;let r=[];for(let n=0;n<this.local.length;n++)this.local[n].type instanceof Kd||r.push(this.local[n]);return r}forEachSet(e){e(this)}}$n.empty=new $n([],[]);$n.removeOverlap=J_;const ss=$n.empty;class Md{constructor(e){this.members=e}map(e,r){const n=this.members.map(i=>i.map(e,r,uf));return Md.from(n)}forChild(e,r){if(r.isLeaf)return $n.empty;let n=[];for(let i=0;i<this.members.length;i++){let a=this.members[i].forChild(e,r);a!=ss&&(a instanceof Md?n=n.concat(a.members):n.push(a))}return Md.from(n)}eq(e){if(!(e instanceof Md)||e.members.length!=this.members.length)return!1;for(let r=0;r<this.members.length;r++)if(!this.members[r].eq(e.members[r]))return!1;return!0}locals(e){let r,n=!0;for(let i=0;i<this.members.length;i++){let a=this.members[i].localsInner(e);if(a.length)if(!r)r=a;else{n&&(r=r.slice(),n=!1);for(let s=0;s<a.length;s++)r.push(a[s])}}return r?J_(n?r:r.sort(cf)):Np}static from(e){switch(e.length){case 0:return ss;case 1:return e[0];default:return new Md(e.every(r=>r instanceof $n)?e:e.reduce((r,n)=>r.concat(n instanceof $n?n:n.members),[]))}}forEachSet(e){for(let r=0;r<this.members.length;r++)this.members[r].forEachSet(e)}}function SX(t,e,r,n,i,a,s){let o=t.slice();for(let u=0,c=a;u<r.maps.length;u++){let h=0;r.maps[u].forEach((p,v,y,S)=>{let w=S-y-(v-p);for(let T=0;T<o.length;T+=3){let _=o[T+1];if(_<0||p>_+c-h)continue;let C=o[T]+c-h;v>=C?o[T+1]=p<=C?-2:-1:p>=c&&w&&(o[T]+=w,o[T+1]+=w)}h+=w}),c=r.maps[u].map(c,-1)}let l=!1;for(let u=0;u<o.length;u+=3)if(o[u+1]<0){if(o[u+1]==-2){l=!0,o[u+1]=-1;continue}let c=r.map(t[u]+a),h=c-i;if(h<0||h>=n.content.size){l=!0;continue}let p=r.map(t[u+1]+a,-1),v=p-i,{index:y,offset:S}=n.content.findIndex(h),w=n.maybeChild(y);if(w&&S==h&&S+w.nodeSize==v){let T=o[u+2].mapInner(r,w,c+1,t[u]+a+1,s);T!=ss?(o[u]=h,o[u+1]=v,o[u+2]=T):(o[u+1]=-2,l=!0)}else l=!0}if(l){let u=kX(o,t,e,r,i,a,s),c=Ox(u,n,0,s);e=c.local;for(let h=0;h<o.length;h+=3)o[h+1]<0&&(o.splice(h,3),h-=3);for(let h=0,p=0;h<c.children.length;h+=3){let v=c.children[h];for(;p<o.length&&o[p]<v;)p+=3;o.splice(p,0,c.children[h],c.children[h+1],c.children[h+2])}}return new $n(e.sort(cf),o)}function qO(t,e){if(!e||!t.length)return t;let r=[];for(let n=0;n<t.length;n++){let i=t[n];r.push(new ls(i.from+e,i.to+e,i.type))}return r}function kX(t,e,r,n,i,a,s){function o(l,u){for(let c=0;c<l.local.length;c++){let h=l.local[c].map(n,i,u);h?r.push(h):s.onRemove&&s.onRemove(l.local[c].spec)}for(let c=0;c<l.children.length;c+=3)o(l.children[c+2],l.children[c]+u+1)}for(let l=0;l<t.length;l+=3)t[l+1]==-1&&o(t[l+2],e[l]+a+1);return r}function $O(t,e,r){if(e.isLeaf)return null;let n=r+e.nodeSize,i=null;for(let a=0,s;a<t.length;a++)(s=t[a])&&s.from>r&&s.to<n&&((i||(i=[])).push(s),t[a]=null);return i}function KO(t){let e=[];for(let r=0;r<t.length;r++)t[r]!=null&&e.push(t[r]);return e}function Ox(t,e,r,n){let i=[],a=!1;e.forEach((o,l)=>{let u=$O(t,o,l+r);if(u){a=!0;let c=Ox(u,o,r+l+1,n);c!=ss&&i.push(l,l+o.nodeSize,c)}});let s=qO(a?KO(t):t,-r).sort(cf);for(let o=0;o<s.length;o++)s[o].type.valid(e,s[o])||(n.onRemove&&n.onRemove(s[o].spec),s.splice(o--,1));return s.length||i.length?new $n(s,i):ss}function cf(t,e){return t.from-e.from||t.to-e.to}function J_(t){let e=t;for(let r=0;r<e.length-1;r++){let n=e[r];if(n.from!=n.to)for(let i=r+1;i<e.length;i++){let a=e[i];if(a.from==n.from){a.to!=n.to&&(e==t&&(e=t.slice()),e[i]=a.copy(a.from,n.to),J3(e,i+1,a.copy(n.to,a.to)));continue}else{a.from<n.to&&(e==t&&(e=t.slice()),e[r]=n.copy(n.from,a.from),J3(e,i,n.copy(a.from,n.to)));break}}}return e}function J3(t,e,r){for(;e<t.length&&cf(r,t[e])>0;)e++;t.splice(e,0,r)}function aS(t){let e=[];return t.someProp("decorations",r=>{let n=r(t.state);n&&n!=ss&&e.push(n)}),t.cursorWrapper&&e.push($n.create(t.state.doc,[t.cursorWrapper.deco])),Md.from(e)}const _X={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},CX=Xs&&qd<=11;class EX{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}set(e){this.anchorNode=e.anchorNode,this.anchorOffset=e.anchorOffset,this.focusNode=e.focusNode,this.focusOffset=e.focusOffset}clear(){this.anchorNode=this.focusNode=null}eq(e){return e.anchorNode==this.anchorNode&&e.anchorOffset==this.anchorOffset&&e.focusNode==this.focusNode&&e.focusOffset==this.focusOffset}}class TX{constructor(e,r){this.view=e,this.handleDOMChange=r,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new EX,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.lastChangedTextNode=null,this.observer=window.MutationObserver&&new window.MutationObserver(n=>{for(let i=0;i<n.length;i++)this.queue.push(n[i]);Xs&&qd<=11&&n.some(i=>i.type=="childList"&&i.removedNodes.length||i.type=="characterData"&&i.oldValue.length>i.target.nodeValue.length)?this.flushSoon():Ha&&e.composing&&n.some(i=>i.type=="childList"&&i.target.nodeName=="TR")?(e.input.badSafariComposition=!0,this.flushSoon()):this.flush()}),CX&&(this.onCharData=n=>{this.queue.push({target:n.target,type:"characterData",oldValue:n.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}flushSoon(){this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(()=>{this.flushingSoon=-1,this.flush()},20))}forceFlush(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}start(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,_X)),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()}stop(){if(this.observer){let e=this.observer.takeRecords();if(e.length){for(let r=0;r<e.length;r++)this.queue.push(e[r]);window.setTimeout(()=>this.flush(),20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()}connectSelection(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}disconnectSelection(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)}suppressSelectionUpdates(){this.suppressingSelectionUpdates=!0,setTimeout(()=>this.suppressingSelectionUpdates=!1,50)}onSelectionChange(){if(W3(this.view)){if(this.suppressingSelectionUpdates)return mc(this.view);if(Xs&&qd<=11&&!this.view.state.selection.empty){let e=this.view.domSelectionRange();if(e.focusNode&&kf(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset))return this.flushSoon()}this.flush()}}setCurSelection(){this.currentSelection.set(this.view.domSelectionRange())}ignoreSelectionChange(e){if(!e.focusNode)return!0;let r=new Set,n;for(let a=e.focusNode;a;a=Xp(a))r.add(a);for(let a=e.anchorNode;a;a=Xp(a))if(r.has(a)){n=a;break}let i=n&&this.view.docView.nearestDesc(n);if(i&&i.ignoreMutation({type:"selection",target:n.nodeType==3?n.parentNode:n}))return this.setCurSelection(),!0}pendingRecords(){if(this.observer)for(let e of this.observer.takeRecords())this.queue.push(e);return this.queue}flush(){let{view:e}=this;if(!e.docView||this.flushingSoon>-1)return;let r=this.pendingRecords();r.length&&(this.queue=[]);let n=e.domSelectionRange(),i=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(n)&&W3(e)&&!this.ignoreSelectionChange(n),a=-1,s=-1,o=!1,l=[];if(e.editable)for(let c=0;c<r.length;c++){let h=this.registerMutation(r[c],l);h&&(a=a<0?h.from:Math.min(h.from,a),s=s<0?h.to:Math.max(h.to,s),h.typeOver&&(o=!0))}if($o&&l.length){let c=l.filter(h=>h.nodeName=="BR");if(c.length==2){let[h,p]=c;h.parentNode&&h.parentNode.parentNode==p.parentNode?p.remove():h.remove()}else{let{focusNode:h}=this.currentSelection;for(let p of c){let v=p.parentNode;v&&v.nodeName=="LI"&&(!h||MX(e,h)!=v)&&p.remove()}}}else if((va||Ha)&&l.some(c=>c.nodeName=="BR")&&(e.input.lastKeyCode==8||e.input.lastKeyCode==46)){for(let c of l)if(c.nodeName=="BR"&&c.parentNode){let h=c.nextSibling;h&&h.nodeType==1&&h.contentEditable=="false"&&c.parentNode.removeChild(c)}}let u=null;a<0&&i&&e.input.lastFocus>Date.now()-200&&Math.max(e.input.lastTouch,e.input.lastClick.time)<Date.now()-300&&K1(n)&&(u=q_(e))&&u.eq(_r.near(e.state.doc.resolve(0),1))?(e.input.lastFocus=0,mc(e),this.currentSelection.set(n),e.scrollToSelection()):(a>-1||i)&&(a>-1&&(e.docView.markDirty(a,s),NX(e)),e.input.badSafariComposition&&(e.input.badSafariComposition=!1,AX(e,l)),this.handleDOMChange(a,s,o,l),e.docView&&e.docView.dirty?e.updateState(e.state):this.currentSelection.eq(n)||mc(e),this.currentSelection.set(n))}registerMutation(e,r){if(r.indexOf(e.target)>-1)return null;let n=this.view.docView.nearestDesc(e.target);if(e.type=="attributes"&&(n==this.view.docView||e.attributeName=="contenteditable"||e.attributeName=="style"&&!e.oldValue&&!e.target.getAttribute("style"))||!n||n.ignoreMutation(e))return null;if(e.type=="childList"){for(let c=0;c<e.addedNodes.length;c++){let h=e.addedNodes[c];r.push(h),h.nodeType==3&&(this.lastChangedTextNode=h)}if(n.contentDOM&&n.contentDOM!=n.dom&&!n.contentDOM.contains(e.target))return{from:n.posBefore,to:n.posAfter};let i=e.previousSibling,a=e.nextSibling;if(Xs&&qd<=11&&e.addedNodes.length)for(let c=0;c<e.addedNodes.length;c++){let{previousSibling:h,nextSibling:p}=e.addedNodes[c];(!h||Array.prototype.indexOf.call(e.addedNodes,h)<0)&&(i=h),(!p||Array.prototype.indexOf.call(e.addedNodes,p)<0)&&(a=p)}let s=i&&i.parentNode==e.target?za(i)+1:0,o=n.localPosFromDOM(e.target,s,-1),l=a&&a.parentNode==e.target?za(a):e.target.childNodes.length,u=n.localPosFromDOM(e.target,l,1);return{from:o,to:u}}else return e.type=="attributes"?{from:n.posAtStart-n.border,to:n.posAtEnd+n.border}:(this.lastChangedTextNode=e.target,{from:n.posAtStart,to:n.posAtEnd,typeOver:e.target.nodeValue==e.oldValue})}}let eP=new WeakMap,tP=!1;function NX(t){if(!eP.has(t)&&(eP.set(t,null),["normal","nowrap","pre-line"].indexOf(getComputedStyle(t.dom).whiteSpace)!==-1)){if(t.requiresGeckoHackNode=$o,tP)return;console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."),tP=!0}}function rP(t,e){let r=e.startContainer,n=e.startOffset,i=e.endContainer,a=e.endOffset,s=t.domAtPos(t.state.selection.anchor);return kf(s.node,s.offset,i,a)&&([r,n,i,a]=[i,a,r,n]),{anchorNode:r,anchorOffset:n,focusNode:i,focusOffset:a}}function PX(t,e){if(e.getComposedRanges){let i=e.getComposedRanges(t.root)[0];if(i)return rP(t,i)}let r;function n(i){i.preventDefault(),i.stopImmediatePropagation(),r=i.getTargetRanges()[0]}return t.dom.addEventListener("beforeinput",n,!0),document.execCommand("indent"),t.dom.removeEventListener("beforeinput",n,!0),r?rP(t,r):null}function MX(t,e){for(let r=e.parentNode;r&&r!=t.dom;r=r.parentNode){let n=t.docView.nearestDesc(r,!0);if(n&&n.node.isBlock)return r}return null}function AX(t,e){var r;let{focusNode:n,focusOffset:i}=t.domSelectionRange();for(let a of e)if(((r=a.parentNode)===null||r===void 0?void 0:r.nodeName)=="TR"){let s=a.nextSibling;for(;s&&s.nodeName!="TD"&&s.nodeName!="TH";)s=s.nextSibling;if(s){let o=s;for(;;){let l=o.firstChild;if(!l||l.nodeType!=1||l.contentEditable=="false"||/^(BR|IMG)$/.test(l.nodeName))break;o=l}o.insertBefore(a,o.firstChild),n==a&&t.domSelection().collapse(a,i)}else a.parentNode.removeChild(a)}}function RX(t,e,r){let{node:n,fromOffset:i,toOffset:a,from:s,to:o}=t.docView.parseRange(e,r),l=t.domSelectionRange(),u,c=l.anchorNode;if(c&&t.dom.contains(c.nodeType==1?c:c.parentNode)&&(u=[{node:c,offset:l.anchorOffset}],K1(l)||u.push({node:l.focusNode,offset:l.focusOffset})),va&&t.input.lastKeyCode===8)for(let w=a;w>i;w--){let T=n.childNodes[w-1],_=T.pmViewDesc;if(T.nodeName=="BR"&&!_){a=w;break}if(!_||_.size)break}let h=t.state.doc,p=t.someProp("domParser")||Wd.fromSchema(t.state.schema),v=h.resolve(s),y=null,S=p.parse(n,{topNode:v.parent,topMatch:v.parent.contentMatchAt(v.index()),topOpen:!0,from:i,to:a,preserveWhitespace:v.parent.type.whitespace=="pre"?"full":!0,findPositions:u,ruleFromNode:LX,context:v});if(u&&u[0].pos!=null){let w=u[0].pos,T=u[1]&&u[1].pos;T==null&&(T=w),y={anchor:w+s,head:T+s}}return{doc:S,sel:y,from:s,to:o}}function LX(t){let e=t.pmViewDesc;if(e)return e.parseRule();if(t.nodeName=="BR"&&t.parentNode){if(Ha&&/^(ul|ol)$/i.test(t.parentNode.nodeName)){let r=document.createElement("div");return r.appendChild(document.createElement("li")),{skip:r}}else if(t.parentNode.lastChild==t||Ha&&/^(tr|table)$/i.test(t.parentNode.nodeName))return{ignore:!0}}else if(t.nodeName=="IMG"&&t.getAttribute("mark-placeholder"))return{ignore:!0};return null}const OX=/^(a|abbr|acronym|b|bd[io]|big|br|button|cite|code|data(list)?|del|dfn|em|i|img|ins|kbd|label|map|mark|meter|output|q|ruby|s|samp|small|span|strong|su[bp]|time|u|tt|var)$/i;function DX(t,e,r,n,i){let a=t.input.compositionPendingChanges||(t.composing?t.input.compositionID:0);if(t.input.compositionPendingChanges=0,e<0){let j=t.input.lastSelectionTime>Date.now()-50?t.input.lastSelectionOrigin:null,O=q_(t,j);if(O&&!t.state.selection.eq(O)){if(va&&hc&&t.input.lastKeyCode===13&&Date.now()-100<t.input.lastKeyCodeTime&&t.someProp("handleKeyDown",B=>B(t,Jh(13,"Enter"))))return;let F=t.state.tr.setSelection(O);j=="pointer"?F.setMeta("pointer",!0):j=="key"&&F.scrollIntoView(),a&&F.setMeta("composition",a),t.dispatch(F)}return}let s=t.state.doc.resolve(e),o=s.sharedDepth(r);e=s.before(o+1),r=t.state.doc.resolve(r).after(o+1);let l=t.state.selection,u=RX(t,e,r),c=t.state.doc,h=c.slice(u.from,u.to),p,v;t.input.lastKeyCode===8&&Date.now()-100<t.input.lastKeyCodeTime?(p=t.state.selection.to,v="end"):(p=t.state.selection.from,v="start"),t.input.lastKeyCode=null;let y=FX(h.content,u.doc.content,u.from,p,v);if(y&&t.input.domChangeCount++,(Qp&&t.input.lastIOSEnter>Date.now()-225||hc)&&i.some(j=>j.nodeType==1&&!OX.test(j.nodeName))&&(!y||y.endA>=y.endB)&&t.someProp("handleKeyDown",j=>j(t,Jh(13,"Enter")))){t.input.lastIOSEnter=0;return}if(!y)if(n&&l instanceof dr&&!l.empty&&l.$head.sameParent(l.$anchor)&&!t.composing&&!(u.sel&&u.sel.anchor!=u.sel.head))y={start:l.from,endA:l.to,endB:l.to};else{if(u.sel){let j=nP(t,t.state.doc,u.sel);if(j&&!j.eq(t.state.selection)){let O=t.state.tr.setSelection(j);a&&O.setMeta("composition",a),t.dispatch(O)}}return}t.state.selection.from<t.state.selection.to&&y.start==y.endB&&t.state.selection instanceof dr&&(y.start>t.state.selection.from&&y.start<=t.state.selection.from+2&&t.state.selection.from>=u.from?y.start=t.state.selection.from:y.endA<t.state.selection.to&&y.endA>=t.state.selection.to-2&&t.state.selection.to<=u.to&&(y.endB+=t.state.selection.to-y.endA,y.endA=t.state.selection.to)),Xs&&qd<=11&&y.endB==y.start+1&&y.endA==y.start&&y.start>u.from&&u.doc.textBetween(y.start-u.from-1,y.start-u.from+1)==" "&&(y.start--,y.endA--,y.endB--);let S=u.doc.resolveNoCache(y.start-u.from),w=u.doc.resolveNoCache(y.endB-u.from),T=c.resolve(y.start),_=S.sameParent(w)&&S.parent.inlineContent&&T.end()>=y.endA;if((Qp&&t.input.lastIOSEnter>Date.now()-225&&(!_||i.some(j=>j.nodeName=="DIV"||j.nodeName=="P"))||!_&&S.pos<u.doc.content.size&&(!S.sameParent(w)||!S.parent.inlineContent)&&S.pos<w.pos&&!/\S/.test(u.doc.textBetween(S.pos,w.pos,"","")))&&t.someProp("handleKeyDown",j=>j(t,Jh(13,"Enter")))){t.input.lastIOSEnter=0;return}if(t.state.selection.anchor>y.start&&jX(c,y.start,y.endA,S,w)&&t.someProp("handleKeyDown",j=>j(t,Jh(8,"Backspace")))){hc&&va&&t.domObserver.suppressSelectionUpdates();return}va&&y.endB==y.start&&(t.input.lastChromeDelete=Date.now()),hc&&!_&&S.start()!=w.start()&&w.parentOffset==0&&S.depth==w.depth&&u.sel&&u.sel.anchor==u.sel.head&&u.sel.head==y.endA&&(y.endB-=2,w=u.doc.resolveNoCache(y.endB-u.from),setTimeout(()=>{t.someProp("handleKeyDown",function(j){return j(t,Jh(13,"Enter"))})},20));let C=y.start,N=y.endA,A=j=>{let O=j||t.state.tr.replace(C,N,u.doc.slice(y.start-u.from,y.endB-u.from));if(u.sel){let F=nP(t,O.doc,u.sel);F&&!(va&&t.composing&&F.empty&&(y.start!=y.endB||t.input.lastChromeDelete<Date.now()-100)&&(F.head==C||F.head==O.mapping.map(N)-1)||Xs&&F.empty&&F.head==C)&&O.setSelection(F)}return a&&O.setMeta("composition",a),O.scrollIntoView()},I;if(_)if(S.pos==w.pos){Xs&&qd<=11&&S.parentOffset==0&&(t.domObserver.suppressSelectionUpdates(),setTimeout(()=>mc(t),20));let j=A(t.state.tr.delete(C,N)),O=c.resolve(y.start).marksAcross(c.resolve(y.endA));O&&j.ensureMarks(O),t.dispatch(j)}else if(y.endA==y.endB&&(I=IX(S.parent.content.cut(S.parentOffset,w.parentOffset),T.parent.content.cut(T.parentOffset,y.endA-T.start())))){let j=A(t.state.tr);I.type=="add"?j.addMark(C,N,I.mark):j.removeMark(C,N,I.mark),t.dispatch(j)}else if(S.parent.child(S.index()).isText&&S.index()==w.index()-(w.textOffset?0:1)){let j=S.parent.textBetween(S.parentOffset,w.parentOffset),O=()=>A(t.state.tr.insertText(j,C,N));t.someProp("handleTextInput",F=>F(t,C,N,j,O))||t.dispatch(O())}else t.dispatch(A());else t.dispatch(A())}function nP(t,e,r){return Math.max(r.anchor,r.head)>e.content.size?null:$_(t,e.resolve(r.anchor),e.resolve(r.head))}function IX(t,e){let r=t.firstChild.marks,n=e.firstChild.marks,i=r,a=n,s,o,l;for(let c=0;c<n.length;c++)i=n[c].removeFromSet(i);for(let c=0;c<r.length;c++)a=r[c].removeFromSet(a);if(i.length==1&&a.length==0)o=i[0],s="add",l=c=>c.mark(o.addToSet(c.marks));else if(i.length==0&&a.length==1)o=a[0],s="remove",l=c=>c.mark(o.removeFromSet(c.marks));else return null;let u=[];for(let c=0;c<e.childCount;c++)u.push(l(e.child(c)));if(at.from(u).eq(t))return{mark:o,type:s}}function jX(t,e,r,n,i){if(r-e<=i.pos-n.pos||sS(n,!0,!1)<i.pos)return!1;let a=t.resolve(e);if(!n.parent.isTextblock){let o=a.nodeAfter;return o!=null&&r==e+o.nodeSize}if(a.parentOffset<a.parent.content.size||!a.parent.isTextblock)return!1;let s=t.resolve(sS(a,!0,!0));return!s.parent.isTextblock||s.pos>r||sS(s,!0,!1)<r?!1:n.parent.content.cut(n.parentOffset).eq(s.parent.content)}function sS(t,e,r){let n=t.depth,i=e?t.end():t.pos;for(;n>0&&(e||t.indexAfter(n)==t.node(n).childCount);)n--,i++,e=!1;if(r){let a=t.node(n).maybeChild(t.indexAfter(n));for(;a&&!a.isLeaf;)a=a.firstChild,i++}return i}function FX(t,e,r,n,i){let a=t.findDiffStart(e,r);if(a==null)return null;let{a:s,b:o}=t.findDiffEnd(e,r+t.size,r+e.size);if(i=="end"){let l=Math.max(0,a-Math.min(s,o));n-=s+l-a}if(s<a&&t.size<e.size){let l=n<=a&&n>=s?a-n:0;a-=l,a&&a<e.size&&iP(e.textBetween(a-1,a+1))&&(a+=l?1:-1),o=a+(o-s),s=a}else if(o<a){let l=n<=a&&n>=o?a-n:0;a-=l,a&&a<t.size&&iP(t.textBetween(a-1,a+1))&&(a+=l?1:-1),s=a+(s-o),o=a}return{start:a,endA:s,endB:o}}function iP(t){if(t.length!=2)return!1;let e=t.charCodeAt(0),r=t.charCodeAt(1);return e>=56320&&e<=57343&&r>=55296&&r<=56319}class ZO{constructor(e,r){this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new eX,this.prevDirectPlugins=[],this.pluginViews=[],this.requiresGeckoHackNode=!1,this.dragging=null,this._props=r,this.state=r.state,this.directPlugins=r.plugins||[],this.directPlugins.forEach(uP),this.dispatch=this.dispatch.bind(this),this.dom=e&&e.mount||document.createElement("div"),e&&(e.appendChild?e.appendChild(this.dom):typeof e=="function"?e(this.dom):e.mount&&(this.mounted=!0)),this.editable=oP(this),sP(this),this.nodeViews=lP(this),this.docView=B3(this.state.doc,aP(this),aS(this),this.dom,this),this.domObserver=new TX(this,(n,i,a,s)=>DX(this,n,i,a,s)),this.domObserver.start(),tX(this),this.updatePluginViews()}get composing(){return this.input.composing}get props(){if(this._props.state!=this.state){let e=this._props;this._props={};for(let r in e)this._props[r]=e[r];this._props.state=this.state}return this._props}update(e){e.handleDOMEvents!=this._props.handleDOMEvents&&kk(this);let r=this._props;this._props=e,e.plugins&&(e.plugins.forEach(uP),this.directPlugins=e.plugins),this.updateStateInner(e.state,r)}setProps(e){let r={};for(let n in this._props)r[n]=this._props[n];r.state=this.state;for(let n in e)r[n]=e[n];this.update(r)}updateState(e){this.updateStateInner(e,this._props)}updateStateInner(e,r){var n;let i=this.state,a=!1,s=!1;e.storedMarks&&this.composing&&(GO(this),s=!0),this.state=e;let o=i.plugins!=e.plugins||this._props.plugins!=r.plugins;if(o||this._props.plugins!=r.plugins||this._props.nodeViews!=r.nodeViews){let v=lP(this);zX(v,this.nodeViews)&&(this.nodeViews=v,a=!0)}(o||r.handleDOMEvents!=this._props.handleDOMEvents)&&kk(this),this.editable=oP(this),sP(this);let l=aS(this),u=aP(this),c=i.plugins!=e.plugins&&!i.doc.eq(e.doc)?"reset":e.scrollToSelection>i.scrollToSelection?"to selection":"preserve",h=a||!this.docView.matchesNode(e.doc,u,l);(h||!e.selection.eq(i.selection))&&(s=!0);let p=c=="preserve"&&s&&this.dom.style.overflowAnchor==null&&mY(this);if(s){this.domObserver.stop();let v=h&&(Xs||va)&&!this.composing&&!i.selection.empty&&!e.selection.empty&&BX(i.selection,e.selection);if(h){let y=va?this.trackWrites=this.domSelectionRange().focusNode:null;this.composing&&(this.input.compositionNode=mX(this)),(a||!this.docView.update(e.doc,u,l,this))&&(this.docView.updateOuterDeco(u),this.docView.destroy(),this.docView=B3(e.doc,u,l,this.dom,this)),y&&(!this.trackWrites||!this.dom.contains(this.trackWrites))&&(v=!0)}v||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelectionRange())&&BY(this))?mc(this,v):(MO(this,e.selection),this.domObserver.setCurSelection()),this.domObserver.start()}this.updatePluginViews(i),!((n=this.dragging)===null||n===void 0)&&n.node&&!i.doc.eq(e.doc)&&this.updateDraggedNode(this.dragging,i),c=="reset"?this.dom.scrollTop=0:c=="to selection"?this.scrollToSelection():p&&gY(p)}scrollToSelection(){let e=this.domSelectionRange().focusNode;if(!(!e||!this.dom.contains(e.nodeType==1?e:e.parentNode))){if(!this.someProp("handleScrollToSelection",r=>r(this)))if(this.state.selection instanceof Zt){let r=this.docView.domAfterPos(this.state.selection.from);r.nodeType==1&&L3(this,r.getBoundingClientRect(),e)}else L3(this,this.coordsAtPos(this.state.selection.head,1),e)}}destroyPluginViews(){let e;for(;e=this.pluginViews.pop();)e.destroy&&e.destroy()}updatePluginViews(e){if(!e||e.plugins!=this.state.plugins||this.directPlugins!=this.prevDirectPlugins){this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(let r=0;r<this.directPlugins.length;r++){let n=this.directPlugins[r];n.spec.view&&this.pluginViews.push(n.spec.view(this))}for(let r=0;r<this.state.plugins.length;r++){let n=this.state.plugins[r];n.spec.view&&this.pluginViews.push(n.spec.view(this))}}else for(let r=0;r<this.pluginViews.length;r++){let n=this.pluginViews[r];n.update&&n.update(this,e)}}updateDraggedNode(e,r){let n=e.node,i=-1;if(this.state.doc.nodeAt(n.from)==n.node)i=n.from;else{let a=n.from+(this.state.doc.content.size-r.doc.content.size);(a>0&&this.state.doc.nodeAt(a))==n.node&&(i=a)}this.dragging=new HO(e.slice,e.move,i<0?void 0:Zt.create(this.state.doc,i))}someProp(e,r){let n=this._props&&this._props[e],i;if(n!=null&&(i=r?r(n):n))return i;for(let s=0;s<this.directPlugins.length;s++){let o=this.directPlugins[s].props[e];if(o!=null&&(i=r?r(o):o))return i}let a=this.state.plugins;if(a)for(let s=0;s<a.length;s++){let o=a[s].props[e];if(o!=null&&(i=r?r(o):o))return i}}hasFocus(){if(Xs){let e=this.root.activeElement;if(e==this.dom)return!0;if(!e||!this.dom.contains(e))return!1;for(;e&&this.dom!=e&&this.dom.contains(e);){if(e.contentEditable=="false")return!1;e=e.parentElement}return!0}return this.root.activeElement==this.dom}focus(){this.domObserver.stop(),this.editable&&vY(this.dom),mc(this),this.domObserver.start()}get root(){let e=this._root;if(e==null){for(let r=this.dom.parentNode;r;r=r.parentNode)if(r.nodeType==9||r.nodeType==11&&r.host)return r.getSelection||(Object.getPrototypeOf(r).getSelection=()=>r.ownerDocument.getSelection()),this._root=r}return e||document}updateRoot(){this._root=null}posAtCoords(e){return SY(this,e)}coordsAtPos(e,r=1){return SO(this,e,r)}domAtPos(e,r=0){return this.docView.domFromPos(e,r)}nodeDOM(e){let r=this.docView.descAt(e);return r?r.nodeDOM:null}posAtDOM(e,r,n=-1){let i=this.docView.posFromDOM(e,r,n);if(i==null)throw new RangeError("DOM position not inside the editor");return i}endOfTextblock(e,r){return TY(this,r||this.state,e)}pasteHTML(e,r){return jv(this,"",e,!1,r||new ClipboardEvent("paste"))}pasteText(e,r){return jv(this,e,null,!0,r||new ClipboardEvent("paste"))}serializeForClipboard(e){return K_(this,e)}destroy(){this.docView&&(rX(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],aS(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null,aY())}get isDestroyed(){return this.docView==null}dispatchEvent(e){return iX(this,e)}domSelectionRange(){let e=this.domSelection();return e?Ha&&this.root.nodeType===11&&cY(this.dom.ownerDocument)==this.dom&&PX(this,e)||e:{focusNode:null,focusOffset:0,anchorNode:null,anchorOffset:0}}domSelection(){return this.root.getSelection()}}ZO.prototype.dispatch=function(t){let e=this._props.dispatchTransaction;e?e.call(this,t):this.updateState(this.state.apply(t))};function aP(t){let e=Object.create(null);return e.class="ProseMirror",e.contenteditable=String(t.editable),t.someProp("attributes",r=>{if(typeof r=="function"&&(r=r(t.state)),r)for(let n in r)n=="class"?e.class+=" "+r[n]:n=="style"?e.style=(e.style?e.style+";":"")+r[n]:!e[n]&&n!="contenteditable"&&n!="nodeName"&&(e[n]=String(r[n]))}),e.translate||(e.translate="no"),[ls.node(0,t.state.doc.content.size,e)]}function sP(t){if(t.markCursor){let e=document.createElement("img");e.className="ProseMirror-separator",e.setAttribute("mark-placeholder","true"),e.setAttribute("alt",""),t.cursorWrapper={dom:e,deco:ls.widget(t.state.selection.from,e,{raw:!0,marks:t.markCursor})}}else t.cursorWrapper=null}function oP(t){return!t.someProp("editable",e=>e(t.state)===!1)}function BX(t,e){let r=Math.min(t.$anchor.sharedDepth(t.head),e.$anchor.sharedDepth(e.head));return t.$anchor.start(r)!=e.$anchor.start(r)}function lP(t){let e=Object.create(null);function r(n){for(let i in n)Object.prototype.hasOwnProperty.call(e,i)||(e[i]=n[i])}return t.someProp("nodeViews",r),t.someProp("markViews",r),e}function zX(t,e){let r=0,n=0;for(let i in t){if(t[i]!=e[i])return!0;r++}for(let i in e)n++;return r!=n}function uP(t){if(t.spec.state||t.spec.filterTransaction||t.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}var rh={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},Dx={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},UX=typeof navigator<"u"&&/Mac/.test(navigator.platform),GX=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);for(var Ua=0;Ua<10;Ua++)rh[48+Ua]=rh[96+Ua]=String(Ua);for(var Ua=1;Ua<=24;Ua++)rh[Ua+111]="F"+Ua;for(var Ua=65;Ua<=90;Ua++)rh[Ua]=String.fromCharCode(Ua+32),Dx[Ua]=String.fromCharCode(Ua);for(var oS in rh)Dx.hasOwnProperty(oS)||(Dx[oS]=rh[oS]);function VX(t){var e=UX&&t.metaKey&&t.shiftKey&&!t.ctrlKey&&!t.altKey||GX&&t.shiftKey&&t.key&&t.key.length==1||t.key=="Unidentified",r=!e&&t.key||(t.shiftKey?Dx:rh)[t.keyCode]||t.key||"Unidentified";return r=="Esc"&&(r="Escape"),r=="Del"&&(r="Delete"),r=="Left"&&(r="ArrowLeft"),r=="Up"&&(r="ArrowUp"),r=="Right"&&(r="ArrowRight"),r=="Down"&&(r="ArrowDown"),r}const HX=typeof navigator<"u"&&/Mac|iP(hone|[oa]d)/.test(navigator.platform),WX=typeof navigator<"u"&&/Win/.test(navigator.platform);function qX(t){let e=t.split(/-(?!$)/),r=e[e.length-1];r=="Space"&&(r=" ");let n,i,a,s;for(let o=0;o<e.length-1;o++){let l=e[o];if(/^(cmd|meta|m)$/i.test(l))s=!0;else if(/^a(lt)?$/i.test(l))n=!0;else if(/^(c|ctrl|control)$/i.test(l))i=!0;else if(/^s(hift)?$/i.test(l))a=!0;else if(/^mod$/i.test(l))HX?s=!0:i=!0;else throw new Error("Unrecognized modifier name: "+l)}return n&&(r="Alt-"+r),i&&(r="Ctrl-"+r),s&&(r="Meta-"+r),a&&(r="Shift-"+r),r}function $X(t){let e=Object.create(null);for(let r in t)e[qX(r)]=t[r];return e}function lS(t,e,r=!0){return e.altKey&&(t="Alt-"+t),e.ctrlKey&&(t="Ctrl-"+t),e.metaKey&&(t="Meta-"+t),r&&e.shiftKey&&(t="Shift-"+t),t}function KX(t){return new Xn({props:{handleKeyDown:YO(t)}})}function YO(t){let e=$X(t);return function(r,n){let i=VX(n),a,s=e[lS(i,n)];if(s&&s(r.state,r.dispatch,r))return!0;if(i.length==1&&i!=" "){if(n.shiftKey){let o=e[lS(i,n,!1)];if(o&&o(r.state,r.dispatch,r))return!0}if((n.altKey||n.metaKey||n.ctrlKey)&&!(WX&&n.ctrlKey&&n.altKey)&&(a=rh[n.keyCode])&&a!=i){let o=e[lS(a,n)];if(o&&o(r.state,r.dispatch,r))return!0}}return!1}}var ZX=Object.defineProperty,eC=(t,e)=>{for(var r in e)ZX(t,r,{get:e[r],enumerable:!0})};function X1(t){const{state:e,transaction:r}=t;let{selection:n}=r,{doc:i}=r,{storedMarks:a}=r;return{...e,apply:e.apply.bind(e),applyTransaction:e.applyTransaction.bind(e),plugins:e.plugins,schema:e.schema,reconfigure:e.reconfigure.bind(e),toJSON:e.toJSON.bind(e),get storedMarks(){return a},get selection(){return n},get doc(){return i},get tr(){return n=r.selection,i=r.doc,a=r.storedMarks,r}}}var Q1=class{constructor(t){this.editor=t.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=t.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:t,editor:e,state:r}=this,{view:n}=e,{tr:i}=r,a=this.buildProps(i);return Object.fromEntries(Object.entries(t).map(([s,o])=>[s,(...u)=>{const c=o(...u)(a);return!i.getMeta("preventDispatch")&&!this.hasCustomState&&n.dispatch(i),c}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(t,e=!0){const{rawCommands:r,editor:n,state:i}=this,{view:a}=n,s=[],o=!!t,l=t||i.tr,u=()=>(!o&&e&&!l.getMeta("preventDispatch")&&!this.hasCustomState&&a.dispatch(l),s.every(h=>h===!0)),c={...Object.fromEntries(Object.entries(r).map(([h,p])=>[h,(...y)=>{const S=this.buildProps(l,e),w=p(...y)(S);return s.push(w),c}])),run:u};return c}createCan(t){const{rawCommands:e,state:r}=this,n=!1,i=t||r.tr,a=this.buildProps(i,n);return{...Object.fromEntries(Object.entries(e).map(([o,l])=>[o,(...u)=>l(...u)({...a,dispatch:void 0})])),chain:()=>this.createChain(i,n)}}buildProps(t,e=!0){const{rawCommands:r,editor:n,state:i}=this,{view:a}=n,s={tr:t,editor:n,view:a,state:X1({state:i,transaction:t}),dispatch:e?()=>{}:void 0,chain:()=>this.createChain(t,e),can:()=>this.createCan(t),get commands(){return Object.fromEntries(Object.entries(r).map(([o,l])=>[o,(...u)=>l(...u)(s)]))}};return s}},XO={};eC(XO,{blur:()=>YX,clearContent:()=>XX,clearNodes:()=>QX,command:()=>JX,createParagraphNear:()=>eQ,cut:()=>tQ,deleteCurrentNode:()=>rQ,deleteNode:()=>nQ,deleteRange:()=>iQ,deleteSelection:()=>aQ,enter:()=>sQ,exitCode:()=>oQ,extendMarkRange:()=>lQ,first:()=>uQ,focus:()=>dQ,forEach:()=>hQ,insertContent:()=>fQ,insertContentAt:()=>gQ,joinBackward:()=>xQ,joinDown:()=>yQ,joinForward:()=>bQ,joinItemBackward:()=>wQ,joinItemForward:()=>SQ,joinTextblockBackward:()=>kQ,joinTextblockForward:()=>_Q,joinUp:()=>vQ,keyboardShortcut:()=>EQ,lift:()=>TQ,liftEmptyBlock:()=>NQ,liftListItem:()=>PQ,newlineInCode:()=>MQ,resetAttributes:()=>AQ,scrollIntoView:()=>RQ,selectAll:()=>LQ,selectNodeBackward:()=>OQ,selectNodeForward:()=>DQ,selectParentNode:()=>IQ,selectTextblockEnd:()=>jQ,selectTextblockStart:()=>FQ,setContent:()=>BQ,setMark:()=>aJ,setMeta:()=>sJ,setNode:()=>oJ,setNodeSelection:()=>lJ,setTextDirection:()=>uJ,setTextSelection:()=>cJ,sinkListItem:()=>dJ,splitBlock:()=>hJ,splitListItem:()=>fJ,toggleList:()=>pJ,toggleMark:()=>mJ,toggleNode:()=>gJ,toggleWrap:()=>vJ,undoInputRule:()=>yJ,unsetAllMarks:()=>xJ,unsetMark:()=>bJ,unsetTextDirection:()=>wJ,updateAttributes:()=>SJ,wrapIn:()=>kJ,wrapInList:()=>_J});var YX=()=>({editor:t,view:e})=>(requestAnimationFrame(()=>{var r;t.isDestroyed||(e.dom.blur(),(r=window?.getSelection())==null||r.removeAllRanges())}),!0),XX=(t=!0)=>({commands:e})=>e.setContent("",{emitUpdate:t}),QX=()=>({state:t,tr:e,dispatch:r})=>{const{selection:n}=e,{ranges:i}=n;return r&&i.forEach(({$from:a,$to:s})=>{t.doc.nodesBetween(a.pos,s.pos,(o,l)=>{if(o.type.isText)return;const{doc:u,mapping:c}=e,h=u.resolve(c.map(l)),p=u.resolve(c.map(l+o.nodeSize)),v=h.blockRange(p);if(!v)return;const y=vm(v);if(o.type.isTextblock){const{defaultType:S}=h.parent.contentMatchAt(h.index());e.setNodeMarkup(v.start,S)}(y||y===0)&&e.lift(v,y)})}),!0},JX=t=>e=>t(e),eQ=()=>({state:t,dispatch:e})=>dO(t,e),tQ=(t,e)=>({editor:r,tr:n})=>{const{state:i}=r,a=i.doc.slice(t.from,t.to);n.deleteRange(t.from,t.to);const s=n.mapping.map(e);return n.insert(s,a.content),n.setSelection(new dr(n.doc.resolve(Math.max(s-1,0)))),!0},rQ=()=>({tr:t,dispatch:e})=>{const{selection:r}=t,n=r.$anchor.node();if(n.content.size>0)return!1;const i=t.selection.$anchor;for(let a=i.depth;a>0;a-=1)if(i.node(a).type===n.type){if(e){const o=i.before(a),l=i.after(a);t.delete(o,l).scrollIntoView()}return!0}return!1};function Bi(t,e){if(typeof t=="string"){if(!e.nodes[t])throw Error(`There is no node type named '${t}'. Maybe you forgot to add the extension?`);return e.nodes[t]}return t}var nQ=t=>({tr:e,state:r,dispatch:n})=>{const i=Bi(t,r.schema),a=e.selection.$anchor;for(let s=a.depth;s>0;s-=1)if(a.node(s).type===i){if(n){const l=a.before(s),u=a.after(s);e.delete(l,u).scrollIntoView()}return!0}return!1},iQ=t=>({tr:e,dispatch:r})=>{const{from:n,to:i}=t;return r&&e.delete(n,i),!0},aQ=()=>({state:t,dispatch:e})=>z_(t,e),sQ=()=>({commands:t})=>t.keyboardShortcut("Enter"),oQ=()=>({state:t,dispatch:e})=>HZ(t,e);function tC(t){return Object.prototype.toString.call(t)==="[object RegExp]"}function Ix(t,e,r={strict:!0}){const n=Object.keys(e);return n.length?n.every(i=>r.strict?e[i]===t[i]:tC(e[i])?e[i].test(t[i]):e[i]===t[i]):!0}function QO(t,e,r={}){return t.find(n=>n.type===e&&Ix(Object.fromEntries(Object.keys(r).map(i=>[i,n.attrs[i]])),r))}function cP(t,e,r={}){return!!QO(t,e,r)}function rC(t,e,r){var n;if(!t||!e)return;let i=t.parent.childAfter(t.parentOffset);if((!i.node||!i.node.marks.some(c=>c.type===e))&&(i=t.parent.childBefore(t.parentOffset)),!i.node||!i.node.marks.some(c=>c.type===e)||(r=r||((n=i.node.marks[0])==null?void 0:n.attrs),!QO([...i.node.marks],e,r)))return;let s=i.index,o=t.start()+i.offset,l=s+1,u=o+i.node.nodeSize;for(;s>0&&cP([...t.parent.child(s-1).marks],e,r);)s-=1,o-=t.parent.child(s).nodeSize;for(;l<t.parent.childCount&&cP([...t.parent.child(l).marks],e,r);)u+=t.parent.child(l).nodeSize,l+=1;return{from:o,to:u}}function _c(t,e){if(typeof t=="string"){if(!e.marks[t])throw Error(`There is no mark type named '${t}'. Maybe you forgot to add the extension?`);return e.marks[t]}return t}var lQ=(t,e={})=>({tr:r,state:n,dispatch:i})=>{const a=_c(t,n.schema),{doc:s,selection:o}=r,{$from:l,from:u,to:c}=o;if(i){const h=rC(l,a,e);if(h&&h.from<=u&&h.to>=c){const p=dr.create(s,h.from,h.to);r.setSelection(p)}}return!0},uQ=t=>e=>{const r=typeof t=="function"?t(e):t;for(let n=0;n<r.length;n+=1)if(r[n](e))return!0;return!1};function JO(t){return t instanceof dr}function nf(t=0,e=0,r=0){return Math.min(Math.max(t,e),r)}function e6(t,e=null){if(!e)return null;const r=_r.atStart(t),n=_r.atEnd(t);if(e==="start"||e===!0)return r;if(e==="end")return n;const i=r.from,a=n.to;return e==="all"?dr.create(t,nf(0,i,a),nf(t.content.size,i,a)):dr.create(t,nf(e,i,a),nf(e,i,a))}function dP(){return navigator.platform==="Android"||/android/i.test(navigator.userAgent)}function jx(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}function cQ(){return typeof navigator<"u"?/^((?!chrome|android).)*safari/i.test(navigator.userAgent):!1}var dQ=(t=null,e={})=>({editor:r,view:n,tr:i,dispatch:a})=>{e={scrollIntoView:!0,...e};const s=()=>{(jx()||dP())&&n.dom.focus(),cQ()&&!jx()&&!dP()&&n.dom.focus({preventScroll:!0}),requestAnimationFrame(()=>{r.isDestroyed||(n.focus(),e?.scrollIntoView&&r.commands.scrollIntoView())})};if(n.hasFocus()&&t===null||t===!1)return!0;if(a&&t===null&&!JO(r.state.selection))return s(),!0;const o=e6(i.doc,t)||r.state.selection,l=r.state.selection.eq(o);return a&&(l||i.setSelection(o),l&&i.storedMarks&&i.setStoredMarks(i.storedMarks),s()),!0},hQ=(t,e)=>r=>t.every((n,i)=>e(n,{...r,index:i})),fQ=(t,e)=>({tr:r,commands:n})=>n.insertContentAt({from:r.selection.from,to:r.selection.to},t,e),t6=t=>{const e=t.childNodes;for(let r=e.length-1;r>=0;r-=1){const n=e[r];n.nodeType===3&&n.nodeValue&&/^(\n\s\s|\n)$/.test(n.nodeValue)?t.removeChild(n):n.nodeType===1&&t6(n)}return t};function Sy(t){if(typeof window>"u")throw new Error("[tiptap error]: there is no window object available, so this function cannot be used");const e=`<body>${t}</body>`,r=new window.DOMParser().parseFromString(e,"text/html").body;return t6(r)}function Bv(t,e,r){if(t instanceof qo||t instanceof at)return t;r={slice:!0,parseOptions:{},...r};const n=typeof t=="object"&&t!==null,i=typeof t=="string";if(n)try{if(Array.isArray(t)&&t.length>0)return at.fromArray(t.map(o=>e.nodeFromJSON(o)));const s=e.nodeFromJSON(t);return r.errorOnInvalidContent&&s.check(),s}catch(a){if(r.errorOnInvalidContent)throw new Error("[tiptap error]: Invalid JSON content",{cause:a});return console.warn("[tiptap warn]: Invalid content.","Passed value:",t,"Error:",a),Bv("",e,r)}if(i){if(r.errorOnInvalidContent){let s=!1,o="";const l=new FL({topNode:e.spec.topNode,marks:e.spec.marks,nodes:e.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:u=>(s=!0,o=typeof u=="string"?u:u.outerHTML,null)}]}})});if(r.slice?Wd.fromSchema(l).parseSlice(Sy(t),r.parseOptions):Wd.fromSchema(l).parse(Sy(t),r.parseOptions),r.errorOnInvalidContent&&s)throw new Error("[tiptap error]: Invalid HTML content",{cause:new Error(`Invalid element found: ${o}`)})}const a=Wd.fromSchema(e);return r.slice?a.parseSlice(Sy(t),r.parseOptions).content:a.parse(Sy(t),r.parseOptions)}return Bv("",e,r)}function pQ(t,e,r){const n=t.steps.length-1;if(n<e)return;const i=t.steps[n];if(!(i instanceof ma||i instanceof xa))return;const a=t.mapping.maps[n];let s=0;a.forEach((o,l,u,c)=>{s===0&&(s=c)}),t.setSelection(_r.near(t.doc.resolve(s),r))}var mQ=t=>!("type"in t),gQ=(t,e,r)=>({tr:n,dispatch:i,editor:a})=>{var s;if(i){r={parseOptions:a.options.parseOptions,updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...r};let o;const l=w=>{a.emit("contentError",{editor:a,error:w,disableCollaboration:()=>{"collaboration"in a.storage&&typeof a.storage.collaboration=="object"&&a.storage.collaboration&&(a.storage.collaboration.isDisabled=!0)}})},u={preserveWhitespace:"full",...r.parseOptions};if(!r.errorOnInvalidContent&&!a.options.enableContentCheck&&a.options.emitContentError)try{Bv(e,a.schema,{parseOptions:u,errorOnInvalidContent:!0})}catch(w){l(w)}try{o=Bv(e,a.schema,{parseOptions:u,errorOnInvalidContent:(s=r.errorOnInvalidContent)!=null?s:a.options.enableContentCheck})}catch(w){return l(w),!1}let{from:c,to:h}=typeof t=="number"?{from:t,to:t}:{from:t.from,to:t.to},p=!0,v=!0;if((mQ(o)?o:[o]).forEach(w=>{w.check(),p=p?w.isText&&w.marks.length===0:!1,v=v?w.isBlock:!1}),c===h&&v){const{parent:w}=n.doc.resolve(c);w.isTextblock&&!w.type.spec.code&&!w.childCount&&(c-=1,h+=1)}let S;if(p){if(Array.isArray(e))S=e.map(w=>w.text||"").join("");else if(e instanceof at){let w="";e.forEach(T=>{T.text&&(w+=T.text)}),S=w}else typeof e=="object"&&e&&e.text?S=e.text:S=e;n.insertText(S,c,h)}else{S=o;const w=n.doc.resolve(c),T=w.node(),_=w.parentOffset===0,C=T.isText||T.isTextblock,N=T.content.size>0;_&&C&&N&&(c=Math.max(0,c-1)),n.replaceWith(c,h,S)}r.updateSelection&&pQ(n,n.steps.length-1,-1),r.applyInputRules&&n.setMeta("applyInputRules",{from:c,text:S}),r.applyPasteRules&&n.setMeta("applyPasteRules",{from:c,text:S})}return!0},vQ=()=>({state:t,dispatch:e})=>UZ(t,e),yQ=()=>({state:t,dispatch:e})=>GZ(t,e),xQ=()=>({state:t,dispatch:e})=>iO(t,e),bQ=()=>({state:t,dispatch:e})=>lO(t,e),wQ=()=>({state:t,dispatch:e,tr:r})=>{try{const n=W1(t.doc,t.selection.$from.pos,-1);return n==null?!1:(r.join(n,2),e&&e(r),!0)}catch{return!1}},SQ=()=>({state:t,dispatch:e,tr:r})=>{try{const n=W1(t.doc,t.selection.$from.pos,1);return n==null?!1:(r.join(n,2),e&&e(r),!0)}catch{return!1}},kQ=()=>({state:t,dispatch:e})=>BZ(t,e),_Q=()=>({state:t,dispatch:e})=>zZ(t,e);function r6(){return typeof navigator<"u"?/Mac/.test(navigator.platform):!1}function CQ(t){const e=t.split(/-(?!$)/);let r=e[e.length-1];r==="Space"&&(r=" ");let n,i,a,s;for(let o=0;o<e.length-1;o+=1){const l=e[o];if(/^(cmd|meta|m)$/i.test(l))s=!0;else if(/^a(lt)?$/i.test(l))n=!0;else if(/^(c|ctrl|control)$/i.test(l))i=!0;else if(/^s(hift)?$/i.test(l))a=!0;else if(/^mod$/i.test(l))jx()||r6()?s=!0:i=!0;else throw new Error(`Unrecognized modifier name: ${l}`)}return n&&(r=`Alt-${r}`),i&&(r=`Ctrl-${r}`),s&&(r=`Meta-${r}`),a&&(r=`Shift-${r}`),r}var EQ=t=>({editor:e,view:r,tr:n,dispatch:i})=>{const a=CQ(t).split(/-(?!$)/),s=a.find(u=>!["Alt","Ctrl","Meta","Shift"].includes(u)),o=new KeyboardEvent("keydown",{key:s==="Space"?" ":s,altKey:a.includes("Alt"),ctrlKey:a.includes("Ctrl"),metaKey:a.includes("Meta"),shiftKey:a.includes("Shift"),bubbles:!0,cancelable:!0}),l=e.captureTransaction(()=>{r.someProp("handleKeyDown",u=>u(r,o))});return l?.steps.forEach(u=>{const c=u.map(n.mapping);c&&i&&n.maybeStep(c)}),!0};function nh(t,e,r={}){const{from:n,to:i,empty:a}=t.selection,s=e?Bi(e,t.schema):null,o=[];t.doc.nodesBetween(n,i,(h,p)=>{if(h.isText)return;const v=Math.max(n,p),y=Math.min(i,p+h.nodeSize);o.push({node:h,from:v,to:y})});const l=i-n,u=o.filter(h=>s?s.name===h.node.type.name:!0).filter(h=>Ix(h.node.attrs,r,{strict:!1}));return a?!!u.length:u.reduce((h,p)=>h+p.to-p.from,0)>=l}var TQ=(t,e={})=>({state:r,dispatch:n})=>{const i=Bi(t,r.schema);return nh(r,i,e)?VZ(r,n):!1},NQ=()=>({state:t,dispatch:e})=>hO(t,e),PQ=t=>({state:e,dispatch:r})=>{const n=Bi(t,e.schema);return tY(n)(e,r)},MQ=()=>({state:t,dispatch:e})=>cO(t,e);function J1(t,e){return e.nodes[t]?"node":e.marks[t]?"mark":null}function hP(t,e){const r=typeof e=="string"?[e]:e;return Object.keys(t).reduce((n,i)=>(r.includes(i)||(n[i]=t[i]),n),{})}var AQ=(t,e)=>({tr:r,state:n,dispatch:i})=>{let a=null,s=null;const o=J1(typeof t=="string"?t:t.name,n.schema);if(!o)return!1;o==="node"&&(a=Bi(t,n.schema)),o==="mark"&&(s=_c(t,n.schema));let l=!1;return r.selection.ranges.forEach(u=>{n.doc.nodesBetween(u.$from.pos,u.$to.pos,(c,h)=>{a&&a===c.type&&(l=!0,i&&r.setNodeMarkup(h,void 0,hP(c.attrs,e))),s&&c.marks.length&&c.marks.forEach(p=>{s===p.type&&(l=!0,i&&r.addMark(h,h+c.nodeSize,s.create(hP(p.attrs,e))))})})}),l},RQ=()=>({tr:t,dispatch:e})=>(e&&t.scrollIntoView(),!0),LQ=()=>({tr:t,dispatch:e})=>{if(e){const r=new mo(t.doc);t.setSelection(r)}return!0},OQ=()=>({state:t,dispatch:e})=>sO(t,e),DQ=()=>({state:t,dispatch:e})=>uO(t,e),IQ=()=>({state:t,dispatch:e})=>$Z(t,e),jQ=()=>({state:t,dispatch:e})=>YZ(t,e),FQ=()=>({state:t,dispatch:e})=>ZZ(t,e);function _k(t,e,r={},n={}){return Bv(t,e,{slice:!1,parseOptions:r,errorOnInvalidContent:n.errorOnInvalidContent})}var BQ=(t,{errorOnInvalidContent:e,emitUpdate:r=!0,parseOptions:n={}}={})=>({editor:i,tr:a,dispatch:s,commands:o})=>{const{doc:l}=a;if(n.preserveWhitespace!=="full"){const u=_k(t,i.schema,n,{errorOnInvalidContent:e??i.options.enableContentCheck});return s&&a.replaceWith(0,l.content.size,u).setMeta("preventUpdate",!r),!0}return s&&a.setMeta("preventUpdate",!r),o.insertContentAt({from:0,to:l.content.size},t,{parseOptions:n,errorOnInvalidContent:e??i.options.enableContentCheck})};function n6(t,e){const r=_c(e,t.schema),{from:n,to:i,empty:a}=t.selection,s=[];a?(t.storedMarks&&s.push(...t.storedMarks),s.push(...t.selection.$head.marks())):t.doc.nodesBetween(n,i,l=>{s.push(...l.marks)});const o=s.find(l=>l.type.name===r.name);return o?{...o.attrs}:{}}function i6(t,e){const r=new eO(t);return e.forEach(n=>{n.steps.forEach(i=>{r.step(i)})}),r}function zQ(t){for(let e=0;e<t.edgeCount;e+=1){const{type:r}=t.edge(e);if(r.isTextblock&&!r.hasRequiredAttrs())return r}return null}function UQ(t,e,r){const n=[];return t.nodesBetween(e.from,e.to,(i,a)=>{r(i)&&n.push({node:i,pos:a})}),n}function GQ(t,e){for(let r=t.depth;r>0;r-=1){const n=t.node(r);if(e(n))return{pos:r>0?t.before(r):0,start:t.start(r),depth:r,node:n}}}function eb(t){return e=>GQ(e.$from,t)}function Ht(t,e,r){return t.config[e]===void 0&&t.parent?Ht(t.parent,e,r):typeof t.config[e]=="function"?t.config[e].bind({...r,parent:t.parent?Ht(t.parent,e,r):null}):t.config[e]}function nC(t){return t.map(e=>{const r={name:e.name,options:e.options,storage:e.storage},n=Ht(e,"addExtensions",r);return n?[e,...nC(n())]:e}).flat(10)}function iC(t,e){const r=Af.fromSchema(e).serializeFragment(t),i=document.implementation.createHTMLDocument().createElement("div");return i.appendChild(r),i.innerHTML}function a6(t){return typeof t=="function"}function ln(t,e=void 0,...r){return a6(t)?e?t.bind(e)(...r):t(...r):t}function VQ(t={}){return Object.keys(t).length===0&&t.constructor===Object}function Jp(t){const e=t.filter(i=>i.type==="extension"),r=t.filter(i=>i.type==="node"),n=t.filter(i=>i.type==="mark");return{baseExtensions:e,nodeExtensions:r,markExtensions:n}}function s6(t){const e=[],{nodeExtensions:r,markExtensions:n}=Jp(t),i=[...r,...n],a={default:null,validate:void 0,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0,isRequired:!1};return t.forEach(s=>{const o={name:s.name,options:s.options,storage:s.storage,extensions:i},l=Ht(s,"addGlobalAttributes",o);if(!l)return;l().forEach(c=>{c.types.forEach(h=>{Object.entries(c.attributes).forEach(([p,v])=>{e.push({type:h,name:p,attribute:{...a,...v}})})})})}),i.forEach(s=>{const o={name:s.name,options:s.options,storage:s.storage},l=Ht(s,"addAttributes",o);if(!l)return;const u=l();Object.entries(u).forEach(([c,h])=>{const p={...a,...h};typeof p?.default=="function"&&(p.default=p.default()),p?.isRequired&&p?.default===void 0&&delete p.default,e.push({type:s.name,name:c,attribute:p})})}),e}function Zn(...t){return t.filter(e=>!!e).reduce((e,r)=>{const n={...e};return Object.entries(r).forEach(([i,a])=>{if(!n[i]){n[i]=a;return}if(i==="class"){const o=a?String(a).split(" "):[],l=n[i]?n[i].split(" "):[],u=o.filter(c=>!l.includes(c));n[i]=[...l,...u].join(" ")}else if(i==="style"){const o=a?a.split(";").map(c=>c.trim()).filter(Boolean):[],l=n[i]?n[i].split(";").map(c=>c.trim()).filter(Boolean):[],u=new Map;l.forEach(c=>{const[h,p]=c.split(":").map(v=>v.trim());u.set(h,p)}),o.forEach(c=>{const[h,p]=c.split(":").map(v=>v.trim());u.set(h,p)}),n[i]=Array.from(u.entries()).map(([c,h])=>`${c}: ${h}`).join("; ")}else n[i]=a}),n},{})}function zv(t,e){return e.filter(r=>r.type===t.type.name).filter(r=>r.attribute.rendered).map(r=>r.attribute.renderHTML?r.attribute.renderHTML(t.attrs)||{}:{[r.name]:t.attrs[r.name]}).reduce((r,n)=>Zn(r,n),{})}function HQ(t){return typeof t!="string"?t:t.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(t):t==="true"?!0:t==="false"?!1:t}function fP(t,e){return"style"in t?t:{...t,getAttrs:r=>{const n=t.getAttrs?t.getAttrs(r):t.attrs;if(n===!1)return!1;const i=e.reduce((a,s)=>{const o=s.attribute.parseHTML?s.attribute.parseHTML(r):HQ(r.getAttribute(s.name));return o==null?a:{...a,[s.name]:o}},{});return{...n,...i}}}}function pP(t){return Object.fromEntries(Object.entries(t).filter(([e,r])=>e==="attrs"&&VQ(r)?!1:r!=null))}function mP(t){var e,r;const n={};return!((e=t?.attribute)!=null&&e.isRequired)&&"default"in(t?.attribute||{})&&(n.default=t.attribute.default),((r=t?.attribute)==null?void 0:r.validate)!==void 0&&(n.validate=t.attribute.validate),[t.name,n]}function WQ(t,e){var r;const n=s6(t),{nodeExtensions:i,markExtensions:a}=Jp(t),s=(r=i.find(u=>Ht(u,"topNode")))==null?void 0:r.name,o=Object.fromEntries(i.map(u=>{const c=n.filter(T=>T.type===u.name),h={name:u.name,options:u.options,storage:u.storage,editor:e},p=t.reduce((T,_)=>{const C=Ht(_,"extendNodeSchema",h);return{...T,...C?C(u):{}}},{}),v=pP({...p,content:ln(Ht(u,"content",h)),marks:ln(Ht(u,"marks",h)),group:ln(Ht(u,"group",h)),inline:ln(Ht(u,"inline",h)),atom:ln(Ht(u,"atom",h)),selectable:ln(Ht(u,"selectable",h)),draggable:ln(Ht(u,"draggable",h)),code:ln(Ht(u,"code",h)),whitespace:ln(Ht(u,"whitespace",h)),linebreakReplacement:ln(Ht(u,"linebreakReplacement",h)),defining:ln(Ht(u,"defining",h)),isolating:ln(Ht(u,"isolating",h)),attrs:Object.fromEntries(c.map(mP))}),y=ln(Ht(u,"parseHTML",h));y&&(v.parseDOM=y.map(T=>fP(T,c)));const S=Ht(u,"renderHTML",h);S&&(v.toDOM=T=>S({node:T,HTMLAttributes:zv(T,c)}));const w=Ht(u,"renderText",h);return w&&(v.toText=w),[u.name,v]})),l=Object.fromEntries(a.map(u=>{const c=n.filter(w=>w.type===u.name),h={name:u.name,options:u.options,storage:u.storage,editor:e},p=t.reduce((w,T)=>{const _=Ht(T,"extendMarkSchema",h);return{...w,..._?_(u):{}}},{}),v=pP({...p,inclusive:ln(Ht(u,"inclusive",h)),excludes:ln(Ht(u,"excludes",h)),group:ln(Ht(u,"group",h)),spanning:ln(Ht(u,"spanning",h)),code:ln(Ht(u,"code",h)),attrs:Object.fromEntries(c.map(mP))}),y=ln(Ht(u,"parseHTML",h));y&&(v.parseDOM=y.map(w=>fP(w,c)));const S=Ht(u,"renderHTML",h);return S&&(v.toDOM=w=>S({mark:w,HTMLAttributes:zv(w,c)})),[u.name,v]}));return new FL({topNode:s,nodes:o,marks:l})}function qQ(t){const e=t.filter((r,n)=>t.indexOf(r)!==n);return Array.from(new Set(e))}function Fx(t){return t.sort((r,n)=>{const i=Ht(r,"priority")||100,a=Ht(n,"priority")||100;return i>a?-1:i<a?1:0})}function o6(t){const e=Fx(nC(t)),r=qQ(e.map(n=>n.name));return r.length&&console.warn(`[tiptap warn]: Duplicate extension names found: [${r.map(n=>`'${n}'`).join(", ")}]. This can lead to issues.`),e}function l6(t,e,r){const{from:n,to:i}=e,{blockSeparator:a=`

`,textSerializers:s={}}=r||{};let o="";return t.nodesBetween(n,i,(l,u,c,h)=>{var p;l.isBlock&&u>n&&(o+=a);const v=s?.[l.type.name];if(v)return c&&(o+=v({node:l,pos:u,parent:c,index:h,range:e})),!1;l.isText&&(o+=(p=l?.text)==null?void 0:p.slice(Math.max(n,u)-u,i-u))}),o}function $Q(t,e){const r={from:0,to:t.content.size};return l6(t,r,e)}function u6(t){return Object.fromEntries(Object.entries(t.nodes).filter(([,e])=>e.spec.toText).map(([e,r])=>[e,r.spec.toText]))}function KQ(t,e){const r=Bi(e,t.schema),{from:n,to:i}=t.selection,a=[];t.doc.nodesBetween(n,i,o=>{a.push(o)});const s=a.reverse().find(o=>o.type.name===r.name);return s?{...s.attrs}:{}}function c6(t,e){const r=J1(typeof e=="string"?e:e.name,t.schema);return r==="node"?KQ(t,e):r==="mark"?n6(t,e):{}}function ZQ(t,e=JSON.stringify){const r={};return t.filter(n=>{const i=e(n);return Object.prototype.hasOwnProperty.call(r,i)?!1:r[i]=!0})}function YQ(t){const e=ZQ(t);return e.length===1?e:e.filter((r,n)=>!e.filter((a,s)=>s!==n).some(a=>r.oldRange.from>=a.oldRange.from&&r.oldRange.to<=a.oldRange.to&&r.newRange.from>=a.newRange.from&&r.newRange.to<=a.newRange.to))}function d6(t){const{mapping:e,steps:r}=t,n=[];return e.maps.forEach((i,a)=>{const s=[];if(i.ranges.length)i.forEach((o,l)=>{s.push({from:o,to:l})});else{const{from:o,to:l}=r[a];if(o===void 0||l===void 0)return;s.push({from:o,to:l})}s.forEach(({from:o,to:l})=>{const u=e.slice(a).map(o,-1),c=e.slice(a).map(l),h=e.invert().map(u,-1),p=e.invert().map(c);n.push({oldRange:{from:h,to:p},newRange:{from:u,to:c}})})}),YQ(n)}function aC(t,e,r){const n=[];return t===e?r.resolve(t).marks().forEach(i=>{const a=r.resolve(t),s=rC(a,i.type);s&&n.push({mark:i,...s})}):r.nodesBetween(t,e,(i,a)=>{!i||i?.nodeSize===void 0||n.push(...i.marks.map(s=>({from:a,to:a+i.nodeSize,mark:s})))}),n}var XQ=(t,e,r,n=20)=>{const i=t.doc.resolve(r);let a=n,s=null;for(;a>0&&s===null;){const o=i.node(a);o?.type.name===e?s=o:a-=1}return[s,a]};function ky(t,e){return e.nodes[t]||e.marks[t]||null}function Yy(t,e,r){return Object.fromEntries(Object.entries(r).filter(([n])=>{const i=t.find(a=>a.type===e&&a.name===n);return i?i.attribute.keepOnSplit:!1}))}var QQ=(t,e=500)=>{let r="";const n=t.parentOffset;return t.parent.nodesBetween(Math.max(0,n-e),n,(i,a,s,o)=>{var l,u;const c=((u=(l=i.type.spec).toText)==null?void 0:u.call(l,{node:i,pos:a,parent:s,index:o}))||i.textContent||"%leaf%";r+=i.isAtom&&!i.isText?c:c.slice(0,Math.max(0,n-a))}),r};function Ck(t,e,r={}){const{empty:n,ranges:i}=t.selection,a=e?_c(e,t.schema):null;if(n)return!!(t.storedMarks||t.selection.$from.marks()).filter(h=>a?a.name===h.type.name:!0).find(h=>Ix(h.attrs,r,{strict:!1}));let s=0;const o=[];if(i.forEach(({$from:h,$to:p})=>{const v=h.pos,y=p.pos;t.doc.nodesBetween(v,y,(S,w)=>{if(!S.isText&&!S.marks.length)return;const T=Math.max(v,w),_=Math.min(y,w+S.nodeSize),C=_-T;s+=C,o.push(...S.marks.map(N=>({mark:N,from:T,to:_})))})}),s===0)return!1;const l=o.filter(h=>a?a.name===h.mark.type.name:!0).filter(h=>Ix(h.mark.attrs,r,{strict:!1})).reduce((h,p)=>h+p.to-p.from,0),u=o.filter(h=>a?h.mark.type!==a&&h.mark.type.excludes(a):!0).reduce((h,p)=>h+p.to-p.from,0);return(l>0?l+u:l)>=s}function JQ(t,e,r={}){if(!e)return nh(t,null,r)||Ck(t,null,r);const n=J1(e,t.schema);return n==="node"?nh(t,e,r):n==="mark"?Ck(t,e,r):!1}var eJ=(t,e)=>{const{$from:r,$to:n,$anchor:i}=t.selection;if(e){const a=eb(o=>o.type.name===e)(t.selection);if(!a)return!1;const s=t.doc.resolve(a.pos+1);return i.pos+1===s.end()}return!(n.parentOffset<n.parent.nodeSize-2||r.pos!==n.pos)},tJ=t=>{const{$from:e,$to:r}=t.selection;return!(e.parentOffset>0||e.pos!==r.pos)};function gP(t,e){return Array.isArray(e)?e.some(r=>(typeof r=="string"?r:r.name)===t.name):e}function vP(t,e){const{nodeExtensions:r}=Jp(e),n=r.find(s=>s.name===t);if(!n)return!1;const i={name:n.name,options:n.options,storage:n.storage},a=ln(Ht(n,"group",i));return typeof a!="string"?!1:a.split(" ").includes("list")}function tb(t,{checkChildren:e=!0,ignoreWhitespace:r=!1}={}){var n;if(r){if(t.type.name==="hardBreak")return!0;if(t.isText)return/^\s*$/m.test((n=t.text)!=null?n:"")}if(t.isText)return!t.text;if(t.isAtom||t.isLeaf)return!1;if(t.content.childCount===0)return!0;if(e){let i=!0;return t.content.forEach(a=>{i!==!1&&(tb(a,{ignoreWhitespace:r,checkChildren:e})||(i=!1))}),i}return!1}function h6(t){return t instanceof Zt}var f6=class p6{constructor(e){this.position=e}static fromJSON(e){return new p6(e.position)}toJSON(){return{position:this.position}}};function rJ(t,e){const r=e.mapping.mapResult(t.position);return{position:new f6(r.pos),mapResult:r}}function nJ(t){return new f6(t)}function iJ(t,e,r){var n;const{selection:i}=e;let a=null;if(JO(i)&&(a=i.$cursor),a){const o=(n=t.storedMarks)!=null?n:a.marks();return a.parent.type.allowsMarkType(r)&&(!!r.isInSet(o)||!o.some(u=>u.type.excludes(r)))}const{ranges:s}=i;return s.some(({$from:o,$to:l})=>{let u=o.depth===0?t.doc.inlineContent&&t.doc.type.allowsMarkType(r):!1;return t.doc.nodesBetween(o.pos,l.pos,(c,h,p)=>{if(u)return!1;if(c.isInline){const v=!p||p.type.allowsMarkType(r),y=!!r.isInSet(c.marks)||!c.marks.some(S=>S.type.excludes(r));u=v&&y}return!u}),u})}var aJ=(t,e={})=>({tr:r,state:n,dispatch:i})=>{const{selection:a}=r,{empty:s,ranges:o}=a,l=_c(t,n.schema);if(i)if(s){const u=n6(n,l);r.addStoredMark(l.create({...u,...e}))}else o.forEach(u=>{const c=u.$from.pos,h=u.$to.pos;n.doc.nodesBetween(c,h,(p,v)=>{const y=Math.max(v,c),S=Math.min(v+p.nodeSize,h);p.marks.find(T=>T.type===l)?p.marks.forEach(T=>{l===T.type&&r.addMark(y,S,l.create({...T.attrs,...e}))}):r.addMark(y,S,l.create(e))})});return iJ(n,r,l)},sJ=(t,e)=>({tr:r})=>(r.setMeta(t,e),!0),oJ=(t,e={})=>({state:r,dispatch:n,chain:i})=>{const a=Bi(t,r.schema);let s;return r.selection.$anchor.sameParent(r.selection.$head)&&(s=r.selection.$anchor.parent.attrs),a.isTextblock?i().command(({commands:o})=>M3(a,{...s,...e})(r)?!0:o.clearNodes()).command(({state:o})=>M3(a,{...s,...e})(o,n)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},lJ=t=>({tr:e,dispatch:r})=>{if(r){const{doc:n}=e,i=nf(t,0,n.content.size),a=Zt.create(n,i);e.setSelection(a)}return!0},uJ=(t,e)=>({tr:r,state:n,dispatch:i})=>{const{selection:a}=n;let s,o;return typeof e=="number"?(s=e,o=e):e&&"from"in e&&"to"in e?(s=e.from,o=e.to):(s=a.from,o=a.to),i&&r.doc.nodesBetween(s,o,(l,u)=>{l.isText||r.setNodeMarkup(u,void 0,{...l.attrs,dir:t})}),!0},cJ=t=>({tr:e,dispatch:r})=>{if(r){const{doc:n}=e,{from:i,to:a}=typeof t=="number"?{from:t,to:t}:t,s=dr.atStart(n).from,o=dr.atEnd(n).to,l=nf(i,s,o),u=nf(a,s,o),c=dr.create(n,l,u);e.setSelection(c)}return!0},dJ=t=>({state:e,dispatch:r})=>{const n=Bi(t,e.schema);return iY(n)(e,r)};function yP(t,e){const r=t.storedMarks||t.selection.$to.parentOffset&&t.selection.$from.marks();if(r){const n=r.filter(i=>e?.includes(i.type.name));t.tr.ensureMarks(n)}}var hJ=({keepMarks:t=!0}={})=>({tr:e,state:r,dispatch:n,editor:i})=>{const{selection:a,doc:s}=e,{$from:o,$to:l}=a,u=i.extensionManager.attributes,c=Yy(u,o.node().type.name,o.node().attrs);if(a instanceof Zt&&a.node.isBlock)return!o.parentOffset||!pc(s,o.pos)?!1:(n&&(t&&yP(r,i.extensionManager.splittableMarks),e.split(o.pos).scrollIntoView()),!0);if(!o.parent.isBlock)return!1;const h=l.parentOffset===l.parent.content.size,p=o.depth===0?void 0:zQ(o.node(-1).contentMatchAt(o.indexAfter(-1)));let v=h&&p?[{type:p,attrs:c}]:void 0,y=pc(e.doc,e.mapping.map(o.pos),1,v);if(!v&&!y&&pc(e.doc,e.mapping.map(o.pos),1,p?[{type:p}]:void 0)&&(y=!0,v=p?[{type:p,attrs:c}]:void 0),n){if(y&&(a instanceof dr&&e.deleteSelection(),e.split(e.mapping.map(o.pos),1,v),p&&!h&&!o.parentOffset&&o.parent.type!==p)){const S=e.mapping.map(o.before()),w=e.doc.resolve(S);o.node(-1).canReplaceWith(w.index(),w.index()+1,p)&&e.setNodeMarkup(e.mapping.map(o.before()),p)}t&&yP(r,i.extensionManager.splittableMarks),e.scrollIntoView()}return y},fJ=(t,e={})=>({tr:r,state:n,dispatch:i,editor:a})=>{var s;const o=Bi(t,n.schema),{$from:l,$to:u}=n.selection,c=n.selection.node;if(c&&c.isBlock||l.depth<2||!l.sameParent(u))return!1;const h=l.node(-1);if(h.type!==o)return!1;const p=a.extensionManager.attributes;if(l.parent.content.size===0&&l.node(-1).childCount===l.indexAfter(-1)){if(l.depth===2||l.node(-3).type!==o||l.index(-2)!==l.node(-2).childCount-1)return!1;if(i){let T=at.empty;const _=l.index(-1)?1:l.index(-2)?2:3;for(let O=l.depth-_;O>=l.depth-3;O-=1)T=at.from(l.node(O).copy(T));const C=l.indexAfter(-1)<l.node(-2).childCount?1:l.indexAfter(-2)<l.node(-3).childCount?2:3,N={...Yy(p,l.node().type.name,l.node().attrs),...e},A=((s=o.contentMatch.defaultType)==null?void 0:s.createAndFill(N))||void 0;T=T.append(at.from(o.createAndFill(null,A)||void 0));const I=l.before(l.depth-(_-1));r.replace(I,l.after(-C),new Mt(T,4-_,0));let j=-1;r.doc.nodesBetween(I,r.doc.content.size,(O,F)=>{if(j>-1)return!1;O.isTextblock&&O.content.size===0&&(j=F+1)}),j>-1&&r.setSelection(dr.near(r.doc.resolve(j))),r.scrollIntoView()}return!0}const v=u.pos===l.end()?h.contentMatchAt(0).defaultType:null,y={...Yy(p,h.type.name,h.attrs),...e},S={...Yy(p,l.node().type.name,l.node().attrs),...e};r.delete(l.pos,u.pos);const w=v?[{type:o,attrs:y},{type:v,attrs:S}]:[{type:o,attrs:y}];if(!pc(r.doc,l.pos,2))return!1;if(i){const{selection:T,storedMarks:_}=n,{splittableMarks:C}=a.extensionManager,N=_||T.$to.parentOffset&&T.$from.marks();if(r.split(l.pos,2,w).scrollIntoView(),!N||!i)return!0;const A=N.filter(I=>C.includes(I.type.name));r.ensureMarks(A)}return!0},uS=(t,e)=>{const r=eb(s=>s.type===e)(t.selection);if(!r)return!0;const n=t.doc.resolve(Math.max(0,r.pos-1)).before(r.depth);if(n===void 0)return!0;const i=t.doc.nodeAt(n);return r.node.type===i?.type&&hh(t.doc,r.pos)&&t.join(r.pos),!0},cS=(t,e)=>{const r=eb(s=>s.type===e)(t.selection);if(!r)return!0;const n=t.doc.resolve(r.start).after(r.depth);if(n===void 0)return!0;const i=t.doc.nodeAt(n);return r.node.type===i?.type&&hh(t.doc,n)&&t.join(n),!0},pJ=(t,e,r,n={})=>({editor:i,tr:a,state:s,dispatch:o,chain:l,commands:u,can:c})=>{const{extensions:h,splittableMarks:p}=i.extensionManager,v=Bi(t,s.schema),y=Bi(e,s.schema),{selection:S,storedMarks:w}=s,{$from:T,$to:_}=S,C=T.blockRange(_),N=w||S.$to.parentOffset&&S.$from.marks();if(!C)return!1;const A=eb(I=>vP(I.type.name,h))(S);if(C.depth>=1&&A&&C.depth-A.depth<=1){if(A.node.type===v)return u.liftListItem(y);if(vP(A.node.type.name,h)&&v.validContent(A.node.content)&&o)return l().command(()=>(a.setNodeMarkup(A.pos,v),!0)).command(()=>uS(a,v)).command(()=>cS(a,v)).run()}return!r||!N||!o?l().command(()=>c().wrapInList(v,n)?!0:u.clearNodes()).wrapInList(v,n).command(()=>uS(a,v)).command(()=>cS(a,v)).run():l().command(()=>{const I=c().wrapInList(v,n),j=N.filter(O=>p.includes(O.type.name));return a.ensureMarks(j),I?!0:u.clearNodes()}).wrapInList(v,n).command(()=>uS(a,v)).command(()=>cS(a,v)).run()},mJ=(t,e={},r={})=>({state:n,commands:i})=>{const{extendEmptyMarkRange:a=!1}=r,s=_c(t,n.schema);return Ck(n,s,e)?i.unsetMark(s,{extendEmptyMarkRange:a}):i.setMark(s,e)},gJ=(t,e,r={})=>({state:n,commands:i})=>{const a=Bi(t,n.schema),s=Bi(e,n.schema),o=nh(n,a,r);let l;return n.selection.$anchor.sameParent(n.selection.$head)&&(l=n.selection.$anchor.parent.attrs),o?i.setNode(s,l):i.setNode(a,{...l,...r})},vJ=(t,e={})=>({state:r,commands:n})=>{const i=Bi(t,r.schema);return nh(r,i,e)?n.lift(i):n.wrapIn(i,e)},yJ=()=>({state:t,dispatch:e})=>{const r=t.plugins;for(let n=0;n<r.length;n+=1){const i=r[n];let a;if(i.spec.isInputRules&&(a=i.getState(t))){if(e){const s=t.tr,o=a.transform;for(let l=o.steps.length-1;l>=0;l-=1)s.step(o.steps[l].invert(o.docs[l]));if(a.text){const l=s.doc.resolve(a.from).marks();s.replaceWith(a.from,a.to,t.schema.text(a.text,l))}else s.delete(a.from,a.to)}return!0}}return!1},xJ=()=>({tr:t,dispatch:e})=>{const{selection:r}=t,{empty:n,ranges:i}=r;return n||e&&i.forEach(a=>{t.removeMark(a.$from.pos,a.$to.pos)}),!0},bJ=(t,e={})=>({tr:r,state:n,dispatch:i})=>{var a;const{extendEmptyMarkRange:s=!1}=e,{selection:o}=r,l=_c(t,n.schema),{$from:u,empty:c,ranges:h}=o;if(!i)return!0;if(c&&s){let{from:p,to:v}=o;const y=(a=u.marks().find(w=>w.type===l))==null?void 0:a.attrs,S=rC(u,l,y);S&&(p=S.from,v=S.to),r.removeMark(p,v,l)}else h.forEach(p=>{r.removeMark(p.$from.pos,p.$to.pos,l)});return r.removeStoredMark(l),!0},wJ=t=>({tr:e,state:r,dispatch:n})=>{const{selection:i}=r;let a,s;return typeof t=="number"?(a=t,s=t):t&&"from"in t&&"to"in t?(a=t.from,s=t.to):(a=i.from,s=i.to),n&&e.doc.nodesBetween(a,s,(o,l)=>{if(o.isText)return;const u={...o.attrs};delete u.dir,e.setNodeMarkup(l,void 0,u)}),!0},SJ=(t,e={})=>({tr:r,state:n,dispatch:i})=>{let a=null,s=null;const o=J1(typeof t=="string"?t:t.name,n.schema);if(!o)return!1;o==="node"&&(a=Bi(t,n.schema)),o==="mark"&&(s=_c(t,n.schema));let l=!1;return r.selection.ranges.forEach(u=>{const c=u.$from.pos,h=u.$to.pos;let p,v,y,S;r.selection.empty?n.doc.nodesBetween(c,h,(w,T)=>{a&&a===w.type&&(l=!0,y=Math.max(T,c),S=Math.min(T+w.nodeSize,h),p=T,v=w)}):n.doc.nodesBetween(c,h,(w,T)=>{T<c&&a&&a===w.type&&(l=!0,y=Math.max(T,c),S=Math.min(T+w.nodeSize,h),p=T,v=w),T>=c&&T<=h&&(a&&a===w.type&&(l=!0,i&&r.setNodeMarkup(T,void 0,{...w.attrs,...e})),s&&w.marks.length&&w.marks.forEach(_=>{if(s===_.type&&(l=!0,i)){const C=Math.max(T,c),N=Math.min(T+w.nodeSize,h);r.addMark(C,N,s.create({..._.attrs,...e}))}}))}),v&&(p!==void 0&&i&&r.setNodeMarkup(p,void 0,{...v.attrs,...e}),s&&v.marks.length&&v.marks.forEach(w=>{s===w.type&&i&&r.addMark(y,S,s.create({...w.attrs,...e}))}))}),l},kJ=(t,e={})=>({state:r,dispatch:n})=>{const i=Bi(t,r.schema);return XZ(i,e)(r,n)},_J=(t,e={})=>({state:r,dispatch:n})=>{const i=Bi(t,r.schema);return QZ(i,e)(r,n)},CJ=class{constructor(){this.callbacks={}}on(t,e){return this.callbacks[t]||(this.callbacks[t]=[]),this.callbacks[t].push(e),this}emit(t,...e){const r=this.callbacks[t];return r&&r.forEach(n=>n.apply(this,e)),this}off(t,e){const r=this.callbacks[t];return r&&(e?this.callbacks[t]=r.filter(n=>n!==e):delete this.callbacks[t]),this}once(t,e){const r=(...n)=>{this.off(t,r),e.apply(this,n)};return this.on(t,r)}removeAllListeners(){this.callbacks={}}},rb=class{constructor(t){var e;this.find=t.find,this.handler=t.handler,this.undoable=(e=t.undoable)!=null?e:!0}},EJ=(t,e)=>{if(tC(e))return e.exec(t);const r=e(t);if(!r)return null;const n=[r.text];return n.index=r.index,n.input=t,n.data=r.data,r.replaceWith&&(r.text.includes(r.replaceWith)||console.warn('[tiptap warn]: "inputRuleMatch.replaceWith" must be part of "inputRuleMatch.text".'),n.push(r.replaceWith)),n};function _y(t){var e;const{editor:r,from:n,to:i,text:a,rules:s,plugin:o}=t,{view:l}=r;if(l.composing)return!1;const u=l.state.doc.resolve(n);if(u.parent.type.spec.code||(e=u.nodeBefore||u.nodeAfter)!=null&&e.marks.find(p=>p.type.spec.code))return!1;let c=!1;const h=QQ(u)+a;return s.forEach(p=>{if(c)return;const v=EJ(h,p.find);if(!v)return;const y=l.state.tr,S=X1({state:l.state,transaction:y}),w={from:n-(v[0].length-a.length),to:i},{commands:T,chain:_,can:C}=new Q1({editor:r,state:S});p.handler({state:S,range:w,match:v,commands:T,chain:_,can:C})===null||!y.steps.length||(p.undoable&&y.setMeta(o,{transform:y,from:n,to:i,text:a}),l.dispatch(y),c=!0)}),c}function TJ(t){const{editor:e,rules:r}=t,n=new Xn({state:{init(){return null},apply(i,a,s){const o=i.getMeta(n);if(o)return o;const l=i.getMeta("applyInputRules");return l&&setTimeout(()=>{let{text:c}=l;typeof c=="string"?c=c:c=iC(at.from(c),s.schema);const{from:h}=l,p=h+c.length;_y({editor:e,from:h,to:p,text:c,rules:r,plugin:n})}),i.selectionSet||i.docChanged?null:a}},props:{handleTextInput(i,a,s,o){return _y({editor:e,from:a,to:s,text:o,rules:r,plugin:n})},handleDOMEvents:{compositionend:i=>(setTimeout(()=>{const{$cursor:a}=i.state.selection;a&&_y({editor:e,from:a.pos,to:a.pos,text:"",rules:r,plugin:n})}),!1)},handleKeyDown(i,a){if(a.key!=="Enter")return!1;const{$cursor:s}=i.state.selection;return s?_y({editor:e,from:s.pos,to:s.pos,text:`
`,rules:r,plugin:n}):!1}},isInputRules:!0});return n}function NJ(t){return Object.prototype.toString.call(t).slice(8,-1)}function Cy(t){return NJ(t)!=="Object"?!1:t.constructor===Object&&Object.getPrototypeOf(t)===Object.prototype}function m6(t,e){const r={...t};return Cy(t)&&Cy(e)&&Object.keys(e).forEach(n=>{Cy(e[n])&&Cy(t[n])?r[n]=m6(t[n],e[n]):r[n]=e[n]}),r}var sC=class{constructor(t={}){this.type="extendable",this.parent=null,this.child=null,this.name="",this.config={name:this.name},this.config={...this.config,...t},this.name=this.config.name}get options(){return{...ln(Ht(this,"addOptions",{name:this.name}))||{}}}get storage(){return{...ln(Ht(this,"addStorage",{name:this.name,options:this.options}))||{}}}configure(t={}){const e=this.extend({...this.config,addOptions:()=>m6(this.options,t)});return e.name=this.name,e.parent=this.parent,e}extend(t={}){const e=new this.constructor({...this.config,...t});return e.parent=this,this.child=e,e.name="name"in t?t.name:e.parent.name,e}},Rf=class g6 extends sC{constructor(){super(...arguments),this.type="mark"}static create(e={}){const r=typeof e=="function"?e():e;return new g6(r)}static handleExit({editor:e,mark:r}){const{tr:n}=e.state,i=e.state.selection.$from;if(i.pos===i.end()){const s=i.marks();if(!!!s.find(u=>u?.type.name===r.name))return!1;const l=s.find(u=>u?.type.name===r.name);return l&&n.removeStoredMark(l),n.insertText(" ",i.pos),e.view.dispatch(n),!0}return!1}configure(e){return super.configure(e)}extend(e){const r=typeof e=="function"?e():e;return super.extend(r)}};function PJ(t){return typeof t=="number"}var MJ=class{constructor(t){this.find=t.find,this.handler=t.handler}},AJ=(t,e,r)=>{if(tC(e))return[...t.matchAll(e)];const n=e(t,r);return n?n.map(i=>{const a=[i.text];return a.index=i.index,a.input=t,a.data=i.data,i.replaceWith&&(i.text.includes(i.replaceWith)||console.warn('[tiptap warn]: "pasteRuleMatch.replaceWith" must be part of "pasteRuleMatch.text".'),a.push(i.replaceWith)),a}):[]};function RJ(t){const{editor:e,state:r,from:n,to:i,rule:a,pasteEvent:s,dropEvent:o}=t,{commands:l,chain:u,can:c}=new Q1({editor:e,state:r}),h=[];return r.doc.nodesBetween(n,i,(v,y)=>{var S,w,T,_,C;if((w=(S=v.type)==null?void 0:S.spec)!=null&&w.code||!(v.isText||v.isTextblock||v.isInline))return;const N=(C=(_=(T=v.content)==null?void 0:T.size)!=null?_:v.nodeSize)!=null?C:0,A=Math.max(n,y),I=Math.min(i,y+N);if(A>=I)return;const j=v.isText?v.text||"":v.textBetween(A-y,I-y,void 0,"");AJ(j,a.find,s).forEach(F=>{if(F.index===void 0)return;const B=A+F.index+1,$=B+F[0].length,Z={from:r.tr.mapping.map(B),to:r.tr.mapping.map($)},D=a.handler({state:r,range:Z,match:F,commands:l,chain:u,can:c,pasteEvent:s,dropEvent:o});h.push(D)})}),h.every(v=>v!==null)}var Ey=null,LJ=t=>{var e;const r=new ClipboardEvent("paste",{clipboardData:new DataTransfer});return(e=r.clipboardData)==null||e.setData("text/html",t),r};function OJ(t){const{editor:e,rules:r}=t;let n=null,i=!1,a=!1,s=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,o;try{o=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{o=null}const l=({state:c,from:h,to:p,rule:v,pasteEvt:y})=>{const S=c.tr,w=X1({state:c,transaction:S});if(!(!RJ({editor:e,state:w,from:Math.max(h-1,0),to:p.b-1,rule:v,pasteEvent:y,dropEvent:o})||!S.steps.length)){try{o=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{o=null}return s=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,S}};return r.map(c=>new Xn({view(h){const p=y=>{var S;n=(S=h.dom.parentElement)!=null&&S.contains(y.target)?h.dom.parentElement:null,n&&(Ey=e)},v=()=>{Ey&&(Ey=null)};return window.addEventListener("dragstart",p),window.addEventListener("dragend",v),{destroy(){window.removeEventListener("dragstart",p),window.removeEventListener("dragend",v)}}},props:{handleDOMEvents:{drop:(h,p)=>{if(a=n===h.dom.parentElement,o=p,!a){const v=Ey;v?.isEditable&&setTimeout(()=>{const y=v.state.selection;y&&v.commands.deleteRange({from:y.from,to:y.to})},10)}return!1},paste:(h,p)=>{var v;const y=(v=p.clipboardData)==null?void 0:v.getData("text/html");return s=p,i=!!y?.includes("data-pm-slice"),!1}}},appendTransaction:(h,p,v)=>{const y=h[0],S=y.getMeta("uiEvent")==="paste"&&!i,w=y.getMeta("uiEvent")==="drop"&&!a,T=y.getMeta("applyPasteRules"),_=!!T;if(!S&&!w&&!_)return;if(_){let{text:A}=T;typeof A=="string"?A=A:A=iC(at.from(A),v.schema);const{from:I}=T,j=I+A.length,O=LJ(A);return l({rule:c,state:v,from:I,to:{b:j},pasteEvt:O})}const C=p.doc.content.findDiffStart(v.doc.content),N=p.doc.content.findDiffEnd(v.doc.content);if(!(!PJ(C)||!N||C===N.b))return l({rule:c,state:v,from:C,to:N,pasteEvt:s})}}))}var nb=class{constructor(t,e){this.splittableMarks=[],this.editor=e,this.baseExtensions=t,this.extensions=o6(t),this.schema=WQ(this.extensions,e),this.setupExtensions()}get commands(){return this.extensions.reduce((t,e)=>{const r={name:e.name,options:e.options,storage:this.editor.extensionStorage[e.name],editor:this.editor,type:ky(e.name,this.schema)},n=Ht(e,"addCommands",r);return n?{...t,...n()}:t},{})}get plugins(){const{editor:t}=this;return Fx([...this.extensions].reverse()).flatMap(n=>{const i={name:n.name,options:n.options,storage:this.editor.extensionStorage[n.name],editor:t,type:ky(n.name,this.schema)},a=[],s=Ht(n,"addKeyboardShortcuts",i);let o={};if(n.type==="mark"&&Ht(n,"exitable",i)&&(o.ArrowRight=()=>Rf.handleExit({editor:t,mark:n})),s){const p=Object.fromEntries(Object.entries(s()).map(([v,y])=>[v,()=>y({editor:t})]));o={...o,...p}}const l=KX(o);a.push(l);const u=Ht(n,"addInputRules",i);if(gP(n,t.options.enableInputRules)&&u){const p=u();if(p&&p.length){const v=TJ({editor:t,rules:p}),y=Array.isArray(v)?v:[v];a.push(...y)}}const c=Ht(n,"addPasteRules",i);if(gP(n,t.options.enablePasteRules)&&c){const p=c();if(p&&p.length){const v=OJ({editor:t,rules:p});a.push(...v)}}const h=Ht(n,"addProseMirrorPlugins",i);if(h){const p=h();a.push(...p)}return a})}get attributes(){return s6(this.extensions)}get nodeViews(){const{editor:t}=this,{nodeExtensions:e}=Jp(this.extensions);return Object.fromEntries(e.filter(r=>!!Ht(r,"addNodeView")).map(r=>{const n=this.attributes.filter(l=>l.type===r.name),i={name:r.name,options:r.options,storage:this.editor.extensionStorage[r.name],editor:t,type:Bi(r.name,this.schema)},a=Ht(r,"addNodeView",i);if(!a)return[];const s=a();if(!s)return[];const o=(l,u,c,h,p)=>{const v=zv(l,n);return s({node:l,view:u,getPos:c,decorations:h,innerDecorations:p,editor:t,extension:r,HTMLAttributes:v})};return[r.name,o]}))}dispatchTransaction(t){const{editor:e}=this;return Fx([...this.extensions].reverse()).reduceRight((n,i)=>{const a={name:i.name,options:i.options,storage:this.editor.extensionStorage[i.name],editor:e,type:ky(i.name,this.schema)},s=Ht(i,"dispatchTransaction",a);return s?o=>{s.call(a,{transaction:o,next:n})}:n},t)}get markViews(){const{editor:t}=this,{markExtensions:e}=Jp(this.extensions);return Object.fromEntries(e.filter(r=>!!Ht(r,"addMarkView")).map(r=>{const n=this.attributes.filter(o=>o.type===r.name),i={name:r.name,options:r.options,storage:this.editor.extensionStorage[r.name],editor:t,type:_c(r.name,this.schema)},a=Ht(r,"addMarkView",i);if(!a)return[];const s=(o,l,u)=>{const c=zv(o,n);return a()({mark:o,view:l,inline:u,editor:t,extension:r,HTMLAttributes:c,updateAttributes:h=>{KJ(o,t,h)}})};return[r.name,s]}))}setupExtensions(){const t=this.extensions;this.editor.extensionStorage=Object.fromEntries(t.map(e=>[e.name,e.storage])),t.forEach(e=>{var r;const n={name:e.name,options:e.options,storage:this.editor.extensionStorage[e.name],editor:this.editor,type:ky(e.name,this.schema)};e.type==="mark"&&((r=ln(Ht(e,"keepOnSplit",n)))==null||r)&&this.splittableMarks.push(e.name);const i=Ht(e,"onBeforeCreate",n),a=Ht(e,"onCreate",n),s=Ht(e,"onUpdate",n),o=Ht(e,"onSelectionUpdate",n),l=Ht(e,"onTransaction",n),u=Ht(e,"onFocus",n),c=Ht(e,"onBlur",n),h=Ht(e,"onDestroy",n);i&&this.editor.on("beforeCreate",i),a&&this.editor.on("create",a),s&&this.editor.on("update",s),o&&this.editor.on("selectionUpdate",o),l&&this.editor.on("transaction",l),u&&this.editor.on("focus",u),c&&this.editor.on("blur",c),h&&this.editor.on("destroy",h)})}};nb.resolve=o6;nb.sort=Fx;nb.flatten=nC;var DJ={};eC(DJ,{ClipboardTextSerializer:()=>y6,Commands:()=>x6,Delete:()=>b6,Drop:()=>w6,Editable:()=>S6,FocusEvents:()=>_6,Keymap:()=>C6,Paste:()=>E6,Tabindex:()=>T6,TextDirection:()=>N6,focusEventsPluginKey:()=>k6});var Pi=class v6 extends sC{constructor(){super(...arguments),this.type="extension"}static create(e={}){const r=typeof e=="function"?e():e;return new v6(r)}configure(e){return super.configure(e)}extend(e){const r=typeof e=="function"?e():e;return super.extend(r)}},y6=Pi.create({name:"clipboardTextSerializer",addOptions(){return{blockSeparator:void 0}},addProseMirrorPlugins(){return[new Xn({key:new Ni("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:t}=this,{state:e,schema:r}=t,{doc:n,selection:i}=e,{ranges:a}=i,s=Math.min(...a.map(c=>c.$from.pos)),o=Math.max(...a.map(c=>c.$to.pos)),l=u6(r);return l6(n,{from:s,to:o},{...this.options.blockSeparator!==void 0?{blockSeparator:this.options.blockSeparator}:{},textSerializers:l})}}})]}}),x6=Pi.create({name:"commands",addCommands(){return{...XO}}}),b6=Pi.create({name:"delete",onUpdate({transaction:t,appendedTransactions:e}){var r,n,i;const a=()=>{var s,o,l,u;if((u=(l=(o=(s=this.editor.options.coreExtensionOptions)==null?void 0:s.delete)==null?void 0:o.filterTransaction)==null?void 0:l.call(o,t))!=null?u:t.getMeta("y-sync$"))return;const c=i6(t.before,[t,...e]);d6(c).forEach(v=>{c.mapping.mapResult(v.oldRange.from).deletedAfter&&c.mapping.mapResult(v.oldRange.to).deletedBefore&&c.before.nodesBetween(v.oldRange.from,v.oldRange.to,(y,S)=>{const w=S+y.nodeSize-2,T=v.oldRange.from<=S&&w<=v.oldRange.to;this.editor.emit("delete",{type:"node",node:y,from:S,to:w,newFrom:c.mapping.map(S),newTo:c.mapping.map(w),deletedRange:v.oldRange,newRange:v.newRange,partial:!T,editor:this.editor,transaction:t,combinedTransform:c})})});const p=c.mapping;c.steps.forEach((v,y)=>{var S,w;if(v instanceof Ml){const T=p.slice(y).map(v.from,-1),_=p.slice(y).map(v.to),C=p.invert().map(T,-1),N=p.invert().map(_),A=(S=c.doc.nodeAt(T-1))==null?void 0:S.marks.some(j=>j.eq(v.mark)),I=(w=c.doc.nodeAt(_))==null?void 0:w.marks.some(j=>j.eq(v.mark));this.editor.emit("delete",{type:"mark",mark:v.mark,from:v.from,to:v.to,deletedRange:{from:C,to:N},newRange:{from:T,to:_},partial:!!(I||A),editor:this.editor,transaction:t,combinedTransform:c})}})};(i=(n=(r=this.editor.options.coreExtensionOptions)==null?void 0:r.delete)==null?void 0:n.async)==null||i?setTimeout(a,0):a()}}),w6=Pi.create({name:"drop",addProseMirrorPlugins(){return[new Xn({key:new Ni("tiptapDrop"),props:{handleDrop:(t,e,r,n)=>{this.editor.emit("drop",{editor:this.editor,event:e,slice:r,moved:n})}}})]}}),S6=Pi.create({name:"editable",addProseMirrorPlugins(){return[new Xn({key:new Ni("editable"),props:{editable:()=>this.editor.options.editable}})]}}),k6=new Ni("focusEvents"),_6=Pi.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:t}=this;return[new Xn({key:k6,props:{handleDOMEvents:{focus:(e,r)=>{t.isFocused=!0;const n=t.state.tr.setMeta("focus",{event:r}).setMeta("addToHistory",!1);return e.dispatch(n),!1},blur:(e,r)=>{t.isFocused=!1;const n=t.state.tr.setMeta("blur",{event:r}).setMeta("addToHistory",!1);return e.dispatch(n),!1}}}})]}}),C6=Pi.create({name:"keymap",addKeyboardShortcuts(){const t=()=>this.editor.commands.first(({commands:s})=>[()=>s.undoInputRule(),()=>s.command(({tr:o})=>{const{selection:l,doc:u}=o,{empty:c,$anchor:h}=l,{pos:p,parent:v}=h,y=h.parent.isTextblock&&p>0?o.doc.resolve(p-1):h,S=y.parent.type.spec.isolating,w=h.pos-h.parentOffset,T=S&&y.parent.childCount===1?w===h.pos:_r.atStart(u).from===p;return!c||!v.type.isTextblock||v.textContent.length||!T||T&&h.parent.type.name==="paragraph"?!1:s.clearNodes()}),()=>s.deleteSelection(),()=>s.joinBackward(),()=>s.selectNodeBackward()]),e=()=>this.editor.commands.first(({commands:s})=>[()=>s.deleteSelection(),()=>s.deleteCurrentNode(),()=>s.joinForward(),()=>s.selectNodeForward()]),n={Enter:()=>this.editor.commands.first(({commands:s})=>[()=>s.newlineInCode(),()=>s.createParagraphNear(),()=>s.liftEmptyBlock(),()=>s.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:t,"Mod-Backspace":t,"Shift-Backspace":t,Delete:e,"Mod-Delete":e,"Mod-a":()=>this.editor.commands.selectAll()},i={...n},a={...n,"Ctrl-h":t,"Alt-Backspace":t,"Ctrl-d":e,"Ctrl-Alt-Backspace":e,"Alt-Delete":e,"Alt-d":e,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return jx()||r6()?a:i},addProseMirrorPlugins(){return[new Xn({key:new Ni("clearDocument"),appendTransaction:(t,e,r)=>{if(t.some(S=>S.getMeta("composition")))return;const n=t.some(S=>S.docChanged)&&!e.doc.eq(r.doc),i=t.some(S=>S.getMeta("preventClearDocument"));if(!n||i)return;const{empty:a,from:s,to:o}=e.selection,l=_r.atStart(e.doc).from,u=_r.atEnd(e.doc).to;if(a||!(s===l&&o===u)||!tb(r.doc))return;const p=r.tr,v=X1({state:r,transaction:p}),{commands:y}=new Q1({editor:this.editor,state:v});if(y.clearNodes(),!!p.steps.length)return p}})]}}),E6=Pi.create({name:"paste",addProseMirrorPlugins(){return[new Xn({key:new Ni("tiptapPaste"),props:{handlePaste:(t,e,r)=>{this.editor.emit("paste",{editor:this.editor,event:e,slice:r})}}})]}}),T6=Pi.create({name:"tabindex",addProseMirrorPlugins(){return[new Xn({key:new Ni("tabindex"),props:{attributes:()=>this.editor.isEditable?{tabindex:"0"}:{}}})]}}),N6=Pi.create({name:"textDirection",addOptions(){return{direction:void 0}},addGlobalAttributes(){if(!this.options.direction)return[];const{nodeExtensions:t}=Jp(this.extensions);return[{types:t.filter(e=>e.name!=="text").map(e=>e.name),attributes:{dir:{default:this.options.direction,parseHTML:e=>{const r=e.getAttribute("dir");return r&&(r==="ltr"||r==="rtl"||r==="auto")?r:this.options.direction},renderHTML:e=>e.dir?{dir:e.dir}:{}}}}]},addProseMirrorPlugins(){return[new Xn({key:new Ni("textDirection"),props:{attributes:()=>{const t=this.options.direction;return t?{dir:t}:{}}}})]}}),IJ=class Pp{constructor(e,r,n=!1,i=null){this.currentNode=null,this.actualDepth=null,this.isBlock=n,this.resolvedPos=e,this.editor=r,this.currentNode=i}get name(){return this.node.type.name}get node(){return this.currentNode||this.resolvedPos.node()}get element(){return this.editor.view.domAtPos(this.pos).node}get depth(){var e;return(e=this.actualDepth)!=null?e:this.resolvedPos.depth}get pos(){return this.resolvedPos.pos}get content(){return this.node.content}set content(e){let r=this.from,n=this.to;if(this.isBlock){if(this.content.size===0){console.error(`You cant set content on a block node. Tried to set content on ${this.name} at ${this.pos}`);return}r=this.from+1,n=this.to-1}this.editor.commands.insertContentAt({from:r,to:n},e)}get attributes(){return this.node.attrs}get textContent(){return this.node.textContent}get size(){return this.node.nodeSize}get from(){return this.isBlock?this.pos:this.resolvedPos.start(this.resolvedPos.depth)}get range(){return{from:this.from,to:this.to}}get to(){return this.isBlock?this.pos+this.size:this.resolvedPos.end(this.resolvedPos.depth)+(this.node.isText?0:1)}get parent(){if(this.depth===0)return null;const e=this.resolvedPos.start(this.resolvedPos.depth-1),r=this.resolvedPos.doc.resolve(e);return new Pp(r,this.editor)}get before(){let e=this.resolvedPos.doc.resolve(this.from-(this.isBlock?1:2));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.from-3)),new Pp(e,this.editor)}get after(){let e=this.resolvedPos.doc.resolve(this.to+(this.isBlock?2:1));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.to+3)),new Pp(e,this.editor)}get children(){const e=[];return this.node.content.forEach((r,n)=>{const i=r.isBlock&&!r.isTextblock,a=r.isAtom&&!r.isText,s=this.pos+n+(a?0:1);if(s<0||s>this.resolvedPos.doc.nodeSize-2)return;const o=this.resolvedPos.doc.resolve(s);if(!i&&o.depth<=this.depth)return;const l=new Pp(o,this.editor,i,i?r:null);i&&(l.actualDepth=this.depth+1),e.push(new Pp(o,this.editor,i,i?r:null))}),e}get firstChild(){return this.children[0]||null}get lastChild(){const e=this.children;return e[e.length-1]||null}closest(e,r={}){let n=null,i=this.parent;for(;i&&!n;){if(i.node.type.name===e)if(Object.keys(r).length>0){const a=i.node.attrs,s=Object.keys(r);for(let o=0;o<s.length;o+=1){const l=s[o];if(a[l]!==r[l])break}}else n=i;i=i.parent}return n}querySelector(e,r={}){return this.querySelectorAll(e,r,!0)[0]||null}querySelectorAll(e,r={},n=!1){let i=[];if(!this.children||this.children.length===0)return i;const a=Object.keys(r);return this.children.forEach(s=>{n&&i.length>0||(s.node.type.name===e&&a.every(l=>r[l]===s.node.attrs[l])&&i.push(s),!(n&&i.length>0)&&(i=i.concat(s.querySelectorAll(e,r,n))))}),i}setAttribute(e){const{tr:r}=this.editor.state;r.setNodeMarkup(this.from,void 0,{...this.node.attrs,...e}),this.editor.view.dispatch(r)}},jJ=`.ProseMirror {
  position: relative;
}

.ProseMirror {
  word-wrap: break-word;
  white-space: pre-wrap;
  white-space: break-spaces;
  -webkit-font-variant-ligatures: none;
  font-variant-ligatures: none;
  font-feature-settings: "liga" 0; /* the above doesn't seem to work in Edge */
}

.ProseMirror [contenteditable="false"] {
  white-space: normal;
}

.ProseMirror [contenteditable="false"] [contenteditable="true"] {
  white-space: pre-wrap;
}

.ProseMirror pre {
  white-space: pre-wrap;
}

img.ProseMirror-separator {
  display: inline !important;
  border: none !important;
  margin: 0 !important;
  width: 0 !important;
  height: 0 !important;
}

.ProseMirror-gapcursor {
  display: none;
  pointer-events: none;
  position: absolute;
  margin: 0;
}

.ProseMirror-gapcursor:after {
  content: "";
  display: block;
  position: absolute;
  top: -2px;
  width: 20px;
  border-top: 1px solid black;
  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;
}

@keyframes ProseMirror-cursor-blink {
  to {
    visibility: hidden;
  }
}

.ProseMirror-hideselection *::selection {
  background: transparent;
}

.ProseMirror-hideselection *::-moz-selection {
  background: transparent;
}

.ProseMirror-hideselection * {
  caret-color: transparent;
}

.ProseMirror-focused .ProseMirror-gapcursor {
  display: block;
}`;function FJ(t,e,r){const n=document.querySelector("style[data-tiptap-style]");if(n!==null)return n;const i=document.createElement("style");return e&&i.setAttribute("nonce",e),i.setAttribute("data-tiptap-style",""),i.innerHTML=t,document.getElementsByTagName("head")[0].appendChild(i),i}var BJ=class extends CJ{constructor(t={}){super(),this.css=null,this.className="tiptap",this.editorView=null,this.isFocused=!1,this.isInitialized=!1,this.extensionStorage={},this.instanceId=Math.random().toString(36).slice(2,9),this.options={element:typeof document<"u"?document.createElement("div"):null,content:"",injectCSS:!0,injectNonce:void 0,extensions:[],autofocus:!1,editable:!0,textDirection:void 0,editorProps:{},parseOptions:{},coreExtensionOptions:{},enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!0,enableContentCheck:!1,emitContentError:!1,onBeforeCreate:()=>null,onCreate:()=>null,onMount:()=>null,onUnmount:()=>null,onUpdate:()=>null,onSelectionUpdate:()=>null,onTransaction:()=>null,onFocus:()=>null,onBlur:()=>null,onDestroy:()=>null,onContentError:({error:n})=>{throw n},onPaste:()=>null,onDrop:()=>null,onDelete:()=>null,enableExtensionDispatchTransaction:!0},this.isCapturingTransaction=!1,this.capturedTransaction=null,this.utils={getUpdatedPosition:rJ,createMappablePosition:nJ},this.setOptions(t),this.createExtensionManager(),this.createCommandManager(),this.createSchema(),this.on("beforeCreate",this.options.onBeforeCreate),this.emit("beforeCreate",{editor:this}),this.on("mount",this.options.onMount),this.on("unmount",this.options.onUnmount),this.on("contentError",this.options.onContentError),this.on("create",this.options.onCreate),this.on("update",this.options.onUpdate),this.on("selectionUpdate",this.options.onSelectionUpdate),this.on("transaction",this.options.onTransaction),this.on("focus",this.options.onFocus),this.on("blur",this.options.onBlur),this.on("destroy",this.options.onDestroy),this.on("drop",({event:n,slice:i,moved:a})=>this.options.onDrop(n,i,a)),this.on("paste",({event:n,slice:i})=>this.options.onPaste(n,i)),this.on("delete",this.options.onDelete);const e=this.createDoc(),r=e6(e,this.options.autofocus);this.editorState=Dp.create({doc:e,schema:this.schema,selection:r||void 0}),this.options.element&&this.mount(this.options.element)}mount(t){if(typeof document>"u")throw new Error("[tiptap error]: The editor cannot be mounted because there is no 'document' defined in this environment.");this.createView(t),this.emit("mount",{editor:this}),this.css&&!document.head.contains(this.css)&&document.head.appendChild(this.css),window.setTimeout(()=>{this.isDestroyed||(this.options.autofocus!==!1&&this.options.autofocus!==null&&this.commands.focus(this.options.autofocus),this.emit("create",{editor:this}),this.isInitialized=!0)},0)}unmount(){if(this.editorView){const t=this.editorView.dom;t?.editor&&delete t.editor,this.editorView.destroy()}if(this.editorView=null,this.isInitialized=!1,this.css&&!document.querySelectorAll(`.${this.className}`).length)try{typeof this.css.remove=="function"?this.css.remove():this.css.parentNode&&this.css.parentNode.removeChild(this.css)}catch(t){console.warn("Failed to remove CSS element:",t)}this.css=null,this.emit("unmount",{editor:this})}get storage(){return this.extensionStorage}get commands(){return this.commandManager.commands}chain(){return this.commandManager.chain()}can(){return this.commandManager.can()}injectCSS(){this.options.injectCSS&&typeof document<"u"&&(this.css=FJ(jJ,this.options.injectNonce))}setOptions(t={}){this.options={...this.options,...t},!(!this.editorView||!this.state||this.isDestroyed)&&(this.options.editorProps&&this.view.setProps(this.options.editorProps),this.view.updateState(this.state))}setEditable(t,e=!0){this.setOptions({editable:t}),e&&this.emit("update",{editor:this,transaction:this.state.tr,appendedTransactions:[]})}get isEditable(){return this.options.editable&&this.view&&this.view.editable}get view(){return this.editorView?this.editorView:new Proxy({state:this.editorState,updateState:t=>{this.editorState=t},dispatch:t=>{this.dispatchTransaction(t)},composing:!1,dragging:null,editable:!0,isDestroyed:!1},{get:(t,e)=>{if(this.editorView)return this.editorView[e];if(e==="state")return this.editorState;if(e in t)return Reflect.get(t,e);throw new Error(`[tiptap error]: The editor view is not available. Cannot access view['${e}']. The editor may not be mounted yet.`)}})}get state(){return this.editorView&&(this.editorState=this.view.state),this.editorState}registerPlugin(t,e){const r=a6(e)?e(t,[...this.state.plugins]):[...this.state.plugins,t],n=this.state.reconfigure({plugins:r});return this.view.updateState(n),n}unregisterPlugin(t){if(this.isDestroyed)return;const e=this.state.plugins;let r=e;if([].concat(t).forEach(i=>{const a=typeof i=="string"?`${i}$`:i.key;r=r.filter(s=>!s.key.startsWith(a))}),e.length===r.length)return;const n=this.state.reconfigure({plugins:r});return this.view.updateState(n),n}createExtensionManager(){var t,e;const n=[...this.options.enableCoreExtensions?[S6,y6.configure({blockSeparator:(e=(t=this.options.coreExtensionOptions)==null?void 0:t.clipboardTextSerializer)==null?void 0:e.blockSeparator}),x6,_6,C6,T6,w6,E6,b6,N6.configure({direction:this.options.textDirection})].filter(i=>typeof this.options.enableCoreExtensions=="object"?this.options.enableCoreExtensions[i.name]!==!1:!0):[],...this.options.extensions].filter(i=>["extension","node","mark"].includes(i?.type));this.extensionManager=new nb(n,this)}createCommandManager(){this.commandManager=new Q1({editor:this})}createSchema(){this.schema=this.extensionManager.schema}createDoc(){let t;try{t=_k(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:this.options.enableContentCheck})}catch(e){if(!(e instanceof Error)||!["[tiptap error]: Invalid JSON content","[tiptap error]: Invalid HTML content"].includes(e.message))throw e;this.emit("contentError",{editor:this,error:e,disableCollaboration:()=>{"collaboration"in this.storage&&typeof this.storage.collaboration=="object"&&this.storage.collaboration&&(this.storage.collaboration.isDisabled=!0),this.options.extensions=this.options.extensions.filter(r=>r.name!=="collaboration"),this.createExtensionManager()}}),t=_k(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:!1})}return t}createView(t){const{editorProps:e,enableExtensionDispatchTransaction:r}=this.options,n=e.dispatchTransaction||this.dispatchTransaction.bind(this),i=r?this.extensionManager.dispatchTransaction(n):n;this.editorView=new ZO(t,{...e,attributes:{role:"textbox",...e?.attributes},dispatchTransaction:i,state:this.editorState,markViews:this.extensionManager.markViews,nodeViews:this.extensionManager.nodeViews});const a=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(a),this.prependClass(),this.injectCSS();const s=this.view.dom;s.editor=this}createNodeViews(){this.view.isDestroyed||this.view.setProps({markViews:this.extensionManager.markViews,nodeViews:this.extensionManager.nodeViews})}prependClass(){this.view.dom.className=`${this.className} ${this.view.dom.className}`}captureTransaction(t){this.isCapturingTransaction=!0,t(),this.isCapturingTransaction=!1;const e=this.capturedTransaction;return this.capturedTransaction=null,e}dispatchTransaction(t){if(this.view.isDestroyed)return;if(this.isCapturingTransaction){if(!this.capturedTransaction){this.capturedTransaction=t;return}t.steps.forEach(u=>{var c;return(c=this.capturedTransaction)==null?void 0:c.step(u)});return}const{state:e,transactions:r}=this.state.applyTransaction(t),n=!this.state.selection.eq(e.selection),i=r.includes(t),a=this.state;if(this.emit("beforeTransaction",{editor:this,transaction:t,nextState:e}),!i)return;this.view.updateState(e),this.emit("transaction",{editor:this,transaction:t,appendedTransactions:r.slice(1)}),n&&this.emit("selectionUpdate",{editor:this,transaction:t});const s=r.findLast(u=>u.getMeta("focus")||u.getMeta("blur")),o=s?.getMeta("focus"),l=s?.getMeta("blur");o&&this.emit("focus",{editor:this,event:o.event,transaction:s}),l&&this.emit("blur",{editor:this,event:l.event,transaction:s}),!(t.getMeta("preventUpdate")||!r.some(u=>u.docChanged)||a.doc.eq(e.doc))&&this.emit("update",{editor:this,transaction:t,appendedTransactions:r.slice(1)})}getAttributes(t){return c6(this.state,t)}isActive(t,e){const r=typeof t=="string"?t:null,n=typeof t=="string"?e:t;return JQ(this.state,r,n)}getJSON(){return this.state.doc.toJSON()}getHTML(){return iC(this.state.doc.content,this.schema)}getText(t){const{blockSeparator:e=`

`,textSerializers:r={}}=t||{};return $Q(this.state.doc,{blockSeparator:e,textSerializers:{...u6(this.schema),...r}})}get isEmpty(){return tb(this.state.doc)}destroy(){this.emit("destroy"),this.unmount(),this.removeAllListeners()}get isDestroyed(){var t,e;return(e=(t=this.editorView)==null?void 0:t.isDestroyed)!=null?e:!0}$node(t,e){var r;return((r=this.$doc)==null?void 0:r.querySelector(t,e))||null}$nodes(t,e){var r;return((r=this.$doc)==null?void 0:r.querySelectorAll(t,e))||null}$pos(t){const e=this.state.doc.resolve(t);return new IJ(e,this)}get $doc(){return this.$pos(0)}};function em(t){return new rb({find:t.find,handler:({state:e,range:r,match:n})=>{const i=ln(t.getAttributes,void 0,n);if(i===!1||i===null)return null;const{tr:a}=e,s=n[n.length-1],o=n[0];if(s){const l=o.search(/\S/),u=r.from+o.indexOf(s),c=u+s.length;if(aC(r.from,r.to,e.doc).filter(v=>v.mark.type.excluded.find(S=>S===t.type&&S!==v.mark.type)).filter(v=>v.to>u).length)return null;c<r.to&&a.delete(c,r.to),u>r.from&&a.delete(r.from+l,u);const p=r.from+l+s.length;a.addMark(r.from+l,p,t.type.create(i||{})),a.removeStoredMark(t.type)}},undoable:t.undoable})}function zJ(t){return new rb({find:t.find,handler:({state:e,range:r,match:n})=>{const i=ln(t.getAttributes,void 0,n)||{},{tr:a}=e,s=r.from;let o=r.to;const l=t.type.create(i);if(n[1]){const u=n[0].lastIndexOf(n[1]);let c=s+u;c>o?c=o:o=c+n[1].length;const h=n[0][n[0].length-1];a.insertText(h,s+n[0].length-1),a.replaceWith(c,o,l)}else if(n[0]){const u=t.type.isInline?s:s-1;a.insert(u,t.type.create(i)).delete(a.mapping.map(s),a.mapping.map(o))}a.scrollIntoView()},undoable:t.undoable})}function Ek(t){return new rb({find:t.find,handler:({state:e,range:r,match:n})=>{const i=e.doc.resolve(r.from),a=ln(t.getAttributes,void 0,n)||{};if(!i.node(-1).canReplaceWith(i.index(-1),i.indexAfter(-1),t.type))return null;e.tr.delete(r.from,r.to).setBlockType(r.from,r.from,t.type,a)},undoable:t.undoable})}function tm(t){return new rb({find:t.find,handler:({state:e,range:r,match:n,chain:i})=>{const a=ln(t.getAttributes,void 0,n)||{},s=e.tr.delete(r.from,r.to),l=s.doc.resolve(r.from).blockRange(),u=l&&F_(l,t.type,a);if(!u)return null;if(s.wrap(l,u),t.keepMarks&&t.editor){const{selection:h,storedMarks:p}=e,{splittableMarks:v}=t.editor.extensionManager,y=p||h.$to.parentOffset&&h.$from.marks();if(y){const S=y.filter(w=>v.includes(w.type.name));s.ensureMarks(S)}}if(t.keepAttributes){const h=t.type.name==="bulletList"||t.type.name==="orderedList"?"listItem":"taskList";i().updateAttributes(h,a).run()}const c=s.doc.resolve(r.from-1).nodeBefore;c&&c.type===t.type&&hh(s.doc,r.from-1)&&(!t.joinPredicate||t.joinPredicate(n,c))&&s.join(r.from-1)},undoable:t.undoable})}function UJ(t,e){const{selection:r}=t,{$from:n}=r;if(r instanceof Zt){const a=n.index();return n.parent.canReplaceWith(a,a+1,e)}let i=n.depth;for(;i>=0;){const a=n.index(i);if(n.node(i).contentMatchAt(a).matchType(e))return!0;i-=1}return!1}function GJ(t){return t.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&")}var VJ={};eC(VJ,{createAtomBlockMarkdownSpec:()=>HJ,createBlockMarkdownSpec:()=>WJ,createInlineMarkdownSpec:()=>P6,parseAttributes:()=>oC,parseIndentedBlocks:()=>Tk,renderNestedMarkdownContent:()=>uC,serializeAttributes:()=>lC});function oC(t){if(!t?.trim())return{};const e={},r=[],n=t.replace(/["']([^"']*)["']/g,u=>(r.push(u),`__QUOTED_${r.length-1}__`)),i=n.match(/(?:^|\s)\.([a-zA-Z][\w-]*)/g);if(i){const u=i.map(c=>c.trim().slice(1));e.class=u.join(" ")}const a=n.match(/(?:^|\s)#([a-zA-Z][\w-]*)/);a&&(e.id=a[1]);const s=/([a-zA-Z][\w-]*)\s*=\s*(__QUOTED_\d+__)/g;Array.from(n.matchAll(s)).forEach(([,u,c])=>{var h;const p=parseInt(((h=c.match(/__QUOTED_(\d+)__/))==null?void 0:h[1])||"0",10),v=r[p];v&&(e[u]=v.slice(1,-1))});const l=n.replace(/(?:^|\s)\.([a-zA-Z][\w-]*)/g,"").replace(/(?:^|\s)#([a-zA-Z][\w-]*)/g,"").replace(/([a-zA-Z][\w-]*)\s*=\s*__QUOTED_\d+__/g,"").trim();return l&&l.split(/\s+/).filter(Boolean).forEach(c=>{c.match(/^[a-zA-Z][\w-]*$/)&&(e[c]=!0)}),e}function lC(t){if(!t||Object.keys(t).length===0)return"";const e=[];return t.class&&String(t.class).split(/\s+/).filter(Boolean).forEach(n=>e.push(`.${n}`)),t.id&&e.push(`#${t.id}`),Object.entries(t).forEach(([r,n])=>{r==="class"||r==="id"||(n===!0?e.push(r):n!==!1&&n!=null&&e.push(`${r}="${String(n)}"`))}),e.join(" ")}function HJ(t){const{nodeName:e,name:r,parseAttributes:n=oC,serializeAttributes:i=lC,defaultAttributes:a={},requiredAttributes:s=[],allowedAttributes:o}=t,l=r||e,u=c=>{if(!o)return c;const h={};return o.forEach(p=>{p in c&&(h[p]=c[p])}),h};return{parseMarkdown:(c,h)=>{const p={...a,...c.attributes};return h.createNode(e,p,[])},markdownTokenizer:{name:e,level:"block",start(c){var h;const p=new RegExp(`^:::${l}(?:\\s|$)`,"m"),v=(h=c.match(p))==null?void 0:h.index;return v!==void 0?v:-1},tokenize(c,h,p){const v=new RegExp(`^:::${l}(?:\\s+\\{([^}]*)\\})?\\s*:::(?:\\n|$)`),y=c.match(v);if(!y)return;const S=y[1]||"",w=n(S);if(!s.find(_=>!(_ in w)))return{type:e,raw:y[0],attributes:w}}},renderMarkdown:c=>{const h=u(c.attrs||{}),p=i(h),v=p?` {${p}}`:"";return`:::${l}${v} :::`}}}function WJ(t){const{nodeName:e,name:r,getContent:n,parseAttributes:i=oC,serializeAttributes:a=lC,defaultAttributes:s={},content:o="block",allowedAttributes:l}=t,u=r||e,c=h=>{if(!l)return h;const p={};return l.forEach(v=>{v in h&&(p[v]=h[v])}),p};return{parseMarkdown:(h,p)=>{let v;if(n){const S=n(h);v=typeof S=="string"?[{type:"text",text:S}]:S}else o==="block"?v=p.parseChildren(h.tokens||[]):v=p.parseInline(h.tokens||[]);const y={...s,...h.attributes};return p.createNode(e,y,v)},markdownTokenizer:{name:e,level:"block",start(h){var p;const v=new RegExp(`^:::${u}`,"m"),y=(p=h.match(v))==null?void 0:p.index;return y!==void 0?y:-1},tokenize(h,p,v){var y;const S=new RegExp(`^:::${u}(?:\\s+\\{([^}]*)\\})?\\s*\\n`),w=h.match(S);if(!w)return;const[T,_=""]=w,C=i(_);let N=1;const A=T.length;let I="";const j=/^:::([\w-]*)(\s.*)?/gm,O=h.slice(A);for(j.lastIndex=0;;){const F=j.exec(O);if(F===null)break;const B=F.index,$=F[1];if(!((y=F[2])!=null&&y.endsWith(":::"))){if($)N+=1;else if(N-=1,N===0){const Z=O.slice(0,B);I=Z.trim();const D=h.slice(0,A+B+F[0].length);let H=[];if(I)if(o==="block")for(H=v.blockTokens(Z),H.forEach(U=>{U.text&&(!U.tokens||U.tokens.length===0)&&(U.tokens=v.inlineTokens(U.text))});H.length>0;){const U=H[H.length-1];if(U.type==="paragraph"&&(!U.text||U.text.trim()===""))H.pop();else break}else H=v.inlineTokens(I);return{type:e,raw:D,attributes:C,content:I,tokens:H}}}}}},renderMarkdown:(h,p)=>{const v=c(h.attrs||{}),y=a(v),S=y?` {${y}}`:"",w=p.renderChildren(h.content||[],`

`);return`:::${u}${S}

${w}

:::`}}}function qJ(t){if(!t.trim())return{};const e={},r=/(\w+)=(?:"([^"]*)"|'([^']*)')/g;let n=r.exec(t);for(;n!==null;){const[,i,a,s]=n;e[i]=a||s,n=r.exec(t)}return e}function $J(t){return Object.entries(t).filter(([,e])=>e!=null).map(([e,r])=>`${e}="${r}"`).join(" ")}function P6(t){const{nodeName:e,name:r,getContent:n,parseAttributes:i=qJ,serializeAttributes:a=$J,defaultAttributes:s={},selfClosing:o=!1,allowedAttributes:l}=t,u=r||e,c=p=>{if(!l)return p;const v={};return l.forEach(y=>{const S=typeof y=="string"?y:y.name,w=typeof y=="string"?void 0:y.skipIfDefault;if(S in p){const T=p[S];if(w!==void 0&&T===w)return;v[S]=T}}),v},h=u.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return{parseMarkdown:(p,v)=>{const y={...s,...p.attributes};if(o)return v.createNode(e,y);const S=n?n(p):p.content||"";return S?v.createNode(e,y,[v.createTextNode(S)]):v.createNode(e,y,[])},markdownTokenizer:{name:e,level:"inline",start(p){const v=o?new RegExp(`\\[${h}\\s*[^\\]]*\\]`):new RegExp(`\\[${h}\\s*[^\\]]*\\][\\s\\S]*?\\[\\/${h}\\]`),y=p.match(v),S=y?.index;return S!==void 0?S:-1},tokenize(p,v,y){const S=o?new RegExp(`^\\[${h}\\s*([^\\]]*)\\]`):new RegExp(`^\\[${h}\\s*([^\\]]*)\\]([\\s\\S]*?)\\[\\/${h}\\]`),w=p.match(S);if(!w)return;let T="",_="";if(o){const[,N]=w;_=N}else{const[,N,A]=w;_=N,T=A||""}const C=i(_.trim());return{type:e,raw:w[0],content:T.trim(),attributes:C}}},renderMarkdown:p=>{let v="";n?v=n(p):p.content&&p.content.length>0&&(v=p.content.filter(T=>T.type==="text").map(T=>T.text).join(""));const y=c(p.attrs||{}),S=a(y),w=S?` ${S}`:"";return o?`[${u}${w}]`:`[${u}${w}]${v}[/${u}]`}}}function Tk(t,e,r){var n,i,a,s;const o=t.split(`
`),l=[];let u="",c=0;const h=e.baseIndentSize||2;for(;c<o.length;){const p=o[c],v=p.match(e.itemPattern);if(!v){if(l.length>0)break;if(p.trim()===""){c+=1,u=`${u}${p}
`;continue}else return}const y=e.extractItemData(v),{indentLevel:S,mainContent:w}=y;u=`${u}${p}
`;const T=[w];for(c+=1;c<o.length;){const A=o[c];if(A.trim()===""){const j=o.slice(c+1).findIndex(B=>B.trim()!=="");if(j===-1)break;if((((i=(n=o[c+1+j].match(/^(\s*)/))==null?void 0:n[1])==null?void 0:i.length)||0)>S){T.push(A),u=`${u}${A}
`,c+=1;continue}else break}if((((s=(a=A.match(/^(\s*)/))==null?void 0:a[1])==null?void 0:s.length)||0)>S)T.push(A),u=`${u}${A}
`,c+=1;else break}let _;const C=T.slice(1);if(C.length>0){const A=C.map(I=>I.slice(S+h)).join(`
`);A.trim()&&(e.customNestedParser?_=e.customNestedParser(A):_=r.blockTokens(A))}const N=e.createToken(y,_);l.push(N)}if(l.length!==0)return{items:l,raw:u}}function uC(t,e,r,n){if(!t||!Array.isArray(t.content))return"";const i=typeof r=="function"?r(n):r,[a,...s]=t.content,o=e.renderChildren([a]),l=[`${i}${o}`];return s&&s.length>0&&s.forEach(u=>{const c=e.renderChildren([u]);if(c){const h=c.split(`
`).map(p=>p?e.indent(p):"").join(`
`);l.push(h)}}),l.join(`
`)}function KJ(t,e,r={}){const{state:n}=e,{doc:i,tr:a}=n,s=t;i.descendants((o,l)=>{const u=a.mapping.map(l),c=a.mapping.map(l)+o.nodeSize;let h=null;if(o.marks.forEach(v=>{if(v!==s)return!1;h=v}),!h)return;let p=!1;if(Object.keys(r).forEach(v=>{r[v]!==h.attrs[v]&&(p=!0)}),p){const v=t.type.create({...t.attrs,...r});a.removeMark(u,c,t.type),a.addMark(u,c,v)}}),a.docChanged&&e.view.dispatch(a)}var eo=class M6 extends sC{constructor(){super(...arguments),this.type="node"}static create(e={}){const r=typeof e=="function"?e():e;return new M6(r)}configure(e){return super.configure(e)}extend(e){const r=typeof e=="function"?e():e;return super.extend(r)}};function Cf(t){return new MJ({find:t.find,handler:({state:e,range:r,match:n,pasteEvent:i})=>{const a=ln(t.getAttributes,void 0,n,i);if(a===!1||a===null)return null;const{tr:s}=e,o=n[n.length-1],l=n[0];let u=r.to;if(o){const c=l.search(/\S/),h=r.from+l.indexOf(o),p=h+o.length;if(aC(r.from,r.to,e.doc).filter(y=>y.mark.type.excluded.find(w=>w===t.type&&w!==y.mark.type)).filter(y=>y.to>h).length)return null;p<r.to&&s.delete(p,r.to),h>r.from&&s.delete(r.from+c,h),u=r.from+c+o.length,s.addMark(r.from+c,u,t.type.create(a||{})),s.removeStoredMark(t.type)}}})}const{getOwnPropertyNames:ZJ,getOwnPropertySymbols:YJ}=Object,{hasOwnProperty:XJ}=Object.prototype;function dS(t,e){return function(n,i,a){return t(n,i,a)&&e(n,i,a)}}function Ty(t){return function(r,n,i){if(!r||!n||typeof r!="object"||typeof n!="object")return t(r,n,i);const{cache:a}=i,s=a.get(r),o=a.get(n);if(s&&o)return s===n&&o===r;a.set(r,n),a.set(n,r);const l=t(r,n,i);return a.delete(r),a.delete(n),l}}function QJ(t){return t?.[Symbol.toStringTag]}function xP(t){return ZJ(t).concat(YJ(t))}const JJ=Object.hasOwn||((t,e)=>XJ.call(t,e));function Lf(t,e){return t===e||!t&&!e&&t!==t&&e!==e}const eee="__v",tee="__o",ree="_owner",{getOwnPropertyDescriptor:bP,keys:wP}=Object;function nee(t,e){return t.byteLength===e.byteLength&&Bx(new Uint8Array(t),new Uint8Array(e))}function iee(t,e,r){let n=t.length;if(e.length!==n)return!1;for(;n-- >0;)if(!r.equals(t[n],e[n],n,n,t,e,r))return!1;return!0}function aee(t,e){return t.byteLength===e.byteLength&&Bx(new Uint8Array(t.buffer,t.byteOffset,t.byteLength),new Uint8Array(e.buffer,e.byteOffset,e.byteLength))}function see(t,e){return Lf(t.getTime(),e.getTime())}function oee(t,e){return t.name===e.name&&t.message===e.message&&t.cause===e.cause&&t.stack===e.stack}function lee(t,e){return t===e}function SP(t,e,r){const n=t.size;if(n!==e.size)return!1;if(!n)return!0;const i=new Array(n),a=t.entries();let s,o,l=0;for(;(s=a.next())&&!s.done;){const u=e.entries();let c=!1,h=0;for(;(o=u.next())&&!o.done;){if(i[h]){h++;continue}const p=s.value,v=o.value;if(r.equals(p[0],v[0],l,h,t,e,r)&&r.equals(p[1],v[1],p[0],v[0],t,e,r)){c=i[h]=!0;break}h++}if(!c)return!1;l++}return!0}const uee=Lf;function cee(t,e,r){const n=wP(t);let i=n.length;if(wP(e).length!==i)return!1;for(;i-- >0;)if(!A6(t,e,r,n[i]))return!1;return!0}function zg(t,e,r){const n=xP(t);let i=n.length;if(xP(e).length!==i)return!1;let a,s,o;for(;i-- >0;)if(a=n[i],!A6(t,e,r,a)||(s=bP(t,a),o=bP(e,a),(s||o)&&(!s||!o||s.configurable!==o.configurable||s.enumerable!==o.enumerable||s.writable!==o.writable)))return!1;return!0}function dee(t,e){return Lf(t.valueOf(),e.valueOf())}function hee(t,e){return t.source===e.source&&t.flags===e.flags}function kP(t,e,r){const n=t.size;if(n!==e.size)return!1;if(!n)return!0;const i=new Array(n),a=t.values();let s,o;for(;(s=a.next())&&!s.done;){const l=e.values();let u=!1,c=0;for(;(o=l.next())&&!o.done;){if(!i[c]&&r.equals(s.value,o.value,s.value,o.value,t,e,r)){u=i[c]=!0;break}c++}if(!u)return!1}return!0}function Bx(t,e){let r=t.byteLength;if(e.byteLength!==r||t.byteOffset!==e.byteOffset)return!1;for(;r-- >0;)if(t[r]!==e[r])return!1;return!0}function fee(t,e){return t.hostname===e.hostname&&t.pathname===e.pathname&&t.protocol===e.protocol&&t.port===e.port&&t.hash===e.hash&&t.username===e.username&&t.password===e.password}function A6(t,e,r,n){return(n===ree||n===tee||n===eee)&&(t.$$typeof||e.$$typeof)?!0:JJ(e,n)&&r.equals(t[n],e[n],n,n,t,e,r)}const pee="[object ArrayBuffer]",mee="[object Arguments]",gee="[object Boolean]",vee="[object DataView]",yee="[object Date]",xee="[object Error]",bee="[object Map]",wee="[object Number]",See="[object Object]",kee="[object RegExp]",_ee="[object Set]",Cee="[object String]",Eee={"[object Int8Array]":!0,"[object Uint8Array]":!0,"[object Uint8ClampedArray]":!0,"[object Int16Array]":!0,"[object Uint16Array]":!0,"[object Int32Array]":!0,"[object Uint32Array]":!0,"[object Float16Array]":!0,"[object Float32Array]":!0,"[object Float64Array]":!0,"[object BigInt64Array]":!0,"[object BigUint64Array]":!0},Tee="[object URL]",Nee=Object.prototype.toString;function Pee({areArrayBuffersEqual:t,areArraysEqual:e,areDataViewsEqual:r,areDatesEqual:n,areErrorsEqual:i,areFunctionsEqual:a,areMapsEqual:s,areNumbersEqual:o,areObjectsEqual:l,arePrimitiveWrappersEqual:u,areRegExpsEqual:c,areSetsEqual:h,areTypedArraysEqual:p,areUrlsEqual:v,unknownTagComparators:y}){return function(w,T,_){if(w===T)return!0;if(w==null||T==null)return!1;const C=typeof w;if(C!==typeof T)return!1;if(C!=="object")return C==="number"?o(w,T,_):C==="function"?a(w,T,_):!1;const N=w.constructor;if(N!==T.constructor)return!1;if(N===Object)return l(w,T,_);if(Array.isArray(w))return e(w,T,_);if(N===Date)return n(w,T,_);if(N===RegExp)return c(w,T,_);if(N===Map)return s(w,T,_);if(N===Set)return h(w,T,_);const A=Nee.call(w);if(A===yee)return n(w,T,_);if(A===kee)return c(w,T,_);if(A===bee)return s(w,T,_);if(A===_ee)return h(w,T,_);if(A===See)return typeof w.then!="function"&&typeof T.then!="function"&&l(w,T,_);if(A===Tee)return v(w,T,_);if(A===xee)return i(w,T,_);if(A===mee)return l(w,T,_);if(Eee[A])return p(w,T,_);if(A===pee)return t(w,T,_);if(A===vee)return r(w,T,_);if(A===gee||A===wee||A===Cee)return u(w,T,_);if(y){let I=y[A];if(!I){const j=QJ(w);j&&(I=y[j])}if(I)return I(w,T,_)}return!1}}function Mee({circular:t,createCustomConfig:e,strict:r}){let n={areArrayBuffersEqual:nee,areArraysEqual:r?zg:iee,areDataViewsEqual:aee,areDatesEqual:see,areErrorsEqual:oee,areFunctionsEqual:lee,areMapsEqual:r?dS(SP,zg):SP,areNumbersEqual:uee,areObjectsEqual:r?zg:cee,arePrimitiveWrappersEqual:dee,areRegExpsEqual:hee,areSetsEqual:r?dS(kP,zg):kP,areTypedArraysEqual:r?dS(Bx,zg):Bx,areUrlsEqual:fee,unknownTagComparators:void 0};if(e&&(n=Object.assign({},n,e(n))),t){const i=Ty(n.areArraysEqual),a=Ty(n.areMapsEqual),s=Ty(n.areObjectsEqual),o=Ty(n.areSetsEqual);n=Object.assign({},n,{areArraysEqual:i,areMapsEqual:a,areObjectsEqual:s,areSetsEqual:o})}return n}function Aee(t){return function(e,r,n,i,a,s,o){return t(e,r,o)}}function Ree({circular:t,comparator:e,createState:r,equals:n,strict:i}){if(r)return function(o,l){const{cache:u=t?new WeakMap:void 0,meta:c}=r();return e(o,l,{cache:u,equals:n,meta:c,strict:i})};if(t)return function(o,l){return e(o,l,{cache:new WeakMap,equals:n,meta:void 0,strict:i})};const a={cache:void 0,equals:n,meta:void 0,strict:i};return function(o,l){return e(o,l,a)}}const Lee=ph();ph({strict:!0});ph({circular:!0});ph({circular:!0,strict:!0});ph({createInternalComparator:()=>Lf});ph({strict:!0,createInternalComparator:()=>Lf});ph({circular:!0,createInternalComparator:()=>Lf});ph({circular:!0,createInternalComparator:()=>Lf,strict:!0});function ph(t={}){const{circular:e=!1,createInternalComparator:r,createState:n,strict:i=!1}=t,a=Mee(t),s=Pee(a),o=r?r(s):Aee(s);return Ree({circular:e,comparator:s,createState:n,equals:o,strict:i})}var hS={exports:{}},fS={};var _P;function Oee(){if(_P)return fS;_P=1;var t=sm(),e=wL();function r(u,c){return u===c&&(u!==0||1/u===1/c)||u!==u&&c!==c}var n=typeof Object.is=="function"?Object.is:r,i=e.useSyncExternalStore,a=t.useRef,s=t.useEffect,o=t.useMemo,l=t.useDebugValue;return fS.useSyncExternalStoreWithSelector=function(u,c,h,p,v){var y=a(null);if(y.current===null){var S={hasValue:!1,value:null};y.current=S}else S=y.current;y=o(function(){function T(I){if(!_){if(_=!0,C=I,I=p(I),v!==void 0&&S.hasValue){var j=S.value;if(v(j,I))return N=j}return N=I}if(j=N,n(C,I))return j;var O=p(I);return v!==void 0&&v(j,O)?(C=I,j):(C=I,N=O)}var _=!1,C,N,A=h===void 0?null:h;return[function(){return T(c())},A===null?void 0:function(){return T(A())}]},[c,h,p,v]);var w=i(u,y[0],y[1]);return s(function(){S.hasValue=!0,S.value=w},[w]),l(w),w},fS}var CP;function Dee(){return CP||(CP=1,hS.exports=Oee()),hS.exports}var Iee=Dee(),jee=(...t)=>e=>{t.forEach(r=>{typeof r=="function"?r(e):r&&(r.current=e)})},Fee=({contentComponent:t})=>{const e=SL.useSyncExternalStore(t.subscribe,t.getSnapshot,t.getServerSnapshot);return m.jsx(m.Fragment,{children:Object.values(e)})};function Bee(){const t=new Set;let e={};return{subscribe(r){return t.add(r),()=>{t.delete(r)}},getSnapshot(){return e},getServerSnapshot(){return e},setRenderer(r,n){e={...e,[r]:r8.createPortal(n.reactElement,n.element,r)},t.forEach(i=>i())},removeRenderer(r){const n={...e};delete n[r],e=n,t.forEach(i=>i())}}}var zee=class extends nr.Component{constructor(t){var e;super(t),this.editorContentRef=nr.createRef(),this.initialized=!1,this.state={hasContentComponentInitialized:!!((e=t.editor)!=null&&e.contentComponent)}}componentDidMount(){this.init()}componentDidUpdate(){this.init()}init(){var t;const e=this.props.editor;if(e&&!e.isDestroyed&&((t=e.view.dom)!=null&&t.parentNode)){if(e.contentComponent)return;const r=this.editorContentRef.current;r.append(...e.view.dom.parentNode.childNodes),e.setOptions({element:r}),e.contentComponent=Bee(),this.state.hasContentComponentInitialized||(this.unsubscribeToContentComponent=e.contentComponent.subscribe(()=>{this.setState(n=>n.hasContentComponentInitialized?n:{hasContentComponentInitialized:!0}),this.unsubscribeToContentComponent&&this.unsubscribeToContentComponent()})),e.createNodeViews(),this.initialized=!0}}componentWillUnmount(){var t;const e=this.props.editor;if(e){this.initialized=!1,e.isDestroyed||e.view.setProps({nodeViews:{}}),this.unsubscribeToContentComponent&&this.unsubscribeToContentComponent(),e.contentComponent=null;try{if(!((t=e.view.dom)!=null&&t.parentNode))return;const r=document.createElement("div");r.append(...e.view.dom.parentNode.childNodes),e.setOptions({element:r})}catch{}}}render(){const{editor:t,innerRef:e,...r}=this.props;return m.jsxs(m.Fragment,{children:[m.jsx("div",{ref:jee(e,this.editorContentRef),...r}),t?.contentComponent&&m.jsx(Fee,{contentComponent:t.contentComponent})]})}},Uee=ie.forwardRef((t,e)=>{const r=nr.useMemo(()=>Math.floor(Math.random()*4294967295).toString(),[t.editor]);return nr.createElement(zee,{key:r,innerRef:e,...t})}),Gee=nr.memo(Uee),Vee=typeof window<"u"?ie.useLayoutEffect:ie.useEffect,Hee=class{constructor(t){this.transactionNumber=0,this.lastTransactionNumber=0,this.subscribers=new Set,this.editor=t,this.lastSnapshot={editor:t,transactionNumber:0},this.getSnapshot=this.getSnapshot.bind(this),this.getServerSnapshot=this.getServerSnapshot.bind(this),this.watch=this.watch.bind(this),this.subscribe=this.subscribe.bind(this)}getSnapshot(){return this.transactionNumber===this.lastTransactionNumber?this.lastSnapshot:(this.lastTransactionNumber=this.transactionNumber,this.lastSnapshot={editor:this.editor,transactionNumber:this.transactionNumber},this.lastSnapshot)}getServerSnapshot(){return{editor:null,transactionNumber:0}}subscribe(t){return this.subscribers.add(t),()=>{this.subscribers.delete(t)}}watch(t){if(this.editor=t,this.editor){const e=()=>{this.transactionNumber+=1,this.subscribers.forEach(n=>n())},r=this.editor;return r.on("transaction",e),()=>{r.off("transaction",e)}}}};function Wee(t){var e;const[r]=ie.useState(()=>new Hee(t.editor)),n=Iee.useSyncExternalStoreWithSelector(r.subscribe,r.getSnapshot,r.getServerSnapshot,t.selector,(e=t.equalityFn)!=null?e:Lee);return Vee(()=>r.watch(t.editor),[t.editor,r]),ie.useDebugValue(n),n}var qee=!1,Nk=typeof window>"u",$ee=Nk||!!(typeof window<"u"&&window.next),Kee=class R6{constructor(e){this.editor=null,this.subscriptions=new Set,this.isComponentMounted=!1,this.previousDeps=null,this.instanceId="",this.options=e,this.subscriptions=new Set,this.setEditor(this.getInitialEditor()),this.scheduleDestroy(),this.getEditor=this.getEditor.bind(this),this.getServerSnapshot=this.getServerSnapshot.bind(this),this.subscribe=this.subscribe.bind(this),this.refreshEditorInstance=this.refreshEditorInstance.bind(this),this.scheduleDestroy=this.scheduleDestroy.bind(this),this.onRender=this.onRender.bind(this),this.createEditor=this.createEditor.bind(this)}setEditor(e){this.editor=e,this.instanceId=Math.random().toString(36).slice(2,9),this.subscriptions.forEach(r=>r())}getInitialEditor(){return this.options.current.immediatelyRender===void 0?Nk||$ee?null:this.createEditor():(this.options.current.immediatelyRender,this.options.current.immediatelyRender?this.createEditor():null)}createEditor(){const e={...this.options.current,onBeforeCreate:(...n)=>{var i,a;return(a=(i=this.options.current).onBeforeCreate)==null?void 0:a.call(i,...n)},onBlur:(...n)=>{var i,a;return(a=(i=this.options.current).onBlur)==null?void 0:a.call(i,...n)},onCreate:(...n)=>{var i,a;return(a=(i=this.options.current).onCreate)==null?void 0:a.call(i,...n)},onDestroy:(...n)=>{var i,a;return(a=(i=this.options.current).onDestroy)==null?void 0:a.call(i,...n)},onFocus:(...n)=>{var i,a;return(a=(i=this.options.current).onFocus)==null?void 0:a.call(i,...n)},onSelectionUpdate:(...n)=>{var i,a;return(a=(i=this.options.current).onSelectionUpdate)==null?void 0:a.call(i,...n)},onTransaction:(...n)=>{var i,a;return(a=(i=this.options.current).onTransaction)==null?void 0:a.call(i,...n)},onUpdate:(...n)=>{var i,a;return(a=(i=this.options.current).onUpdate)==null?void 0:a.call(i,...n)},onContentError:(...n)=>{var i,a;return(a=(i=this.options.current).onContentError)==null?void 0:a.call(i,...n)},onDrop:(...n)=>{var i,a;return(a=(i=this.options.current).onDrop)==null?void 0:a.call(i,...n)},onPaste:(...n)=>{var i,a;return(a=(i=this.options.current).onPaste)==null?void 0:a.call(i,...n)},onDelete:(...n)=>{var i,a;return(a=(i=this.options.current).onDelete)==null?void 0:a.call(i,...n)}};return new BJ(e)}getEditor(){return this.editor}getServerSnapshot(){return null}subscribe(e){return this.subscriptions.add(e),()=>{this.subscriptions.delete(e)}}static compareOptions(e,r){return Object.keys(e).every(n=>["onCreate","onBeforeCreate","onDestroy","onUpdate","onTransaction","onFocus","onBlur","onSelectionUpdate","onContentError","onDrop","onPaste"].includes(n)?!0:n==="extensions"&&e.extensions&&r.extensions?e.extensions.length!==r.extensions.length?!1:e.extensions.every((i,a)=>{var s;return i===((s=r.extensions)==null?void 0:s[a])}):e[n]===r[n])}onRender(e){return()=>(this.isComponentMounted=!0,clearTimeout(this.scheduledDestructionTimeout),this.editor&&!this.editor.isDestroyed&&e.length===0?R6.compareOptions(this.options.current,this.editor.options)||this.editor.setOptions({...this.options.current,editable:this.editor.isEditable}):this.refreshEditorInstance(e),()=>{this.isComponentMounted=!1,this.scheduleDestroy()})}refreshEditorInstance(e){if(this.editor&&!this.editor.isDestroyed){if(this.previousDeps===null){this.previousDeps=e;return}if(this.previousDeps.length===e.length&&this.previousDeps.every((n,i)=>n===e[i]))return}this.editor&&!this.editor.isDestroyed&&this.editor.destroy(),this.setEditor(this.createEditor()),this.previousDeps=e}scheduleDestroy(){const e=this.instanceId,r=this.editor;this.scheduledDestructionTimeout=setTimeout(()=>{if(this.isComponentMounted&&this.instanceId===e){r&&r.setOptions(this.options.current);return}r&&!r.isDestroyed&&(r.destroy(),this.instanceId===e&&this.setEditor(null))},1)}};function Zee(t={},e=[]){const r=ie.useRef(t);r.current=t;const[n]=ie.useState(()=>new Kee(r)),i=SL.useSyncExternalStore(n.subscribe,n.getEditor,n.getServerSnapshot);return ie.useDebugValue(i),ie.useEffect(n.onRender(e)),Wee({editor:i,selector:({transactionNumber:a})=>t.shouldRerenderOnTransaction===!1||t.shouldRerenderOnTransaction===void 0?null:t.immediatelyRender&&a===0?0:a+1}),i}var Yee=ie.createContext({editor:null});Yee.Consumer;var Xee=ie.createContext({onDragStart:()=>{},nodeViewContentChildren:void 0,nodeViewContentRef:()=>{}}),Qee=()=>ie.useContext(Xee);nr.forwardRef((t,e)=>{const{onDragStart:r}=Qee(),n=t.as||"div";return m.jsx(n,{...t,ref:e,"data-node-view-wrapper":"",onDragStart:r,style:{whiteSpace:"normal",...t.style}})});function EP(t){return!!(typeof t=="function"&&t.prototype&&t.prototype.isReactComponent)}function TP(t){return!!(typeof t=="object"&&t.$$typeof&&(t.$$typeof.toString()==="Symbol(react.forward_ref)"||t.$$typeof.description==="react.forward_ref"))}function Jee(t){return!!(typeof t=="object"&&t.$$typeof&&(t.$$typeof.toString()==="Symbol(react.memo)"||t.$$typeof.description==="react.memo"))}function ete(t){if(EP(t)||TP(t))return!0;if(Jee(t)){const e=t.type;if(e)return EP(e)||TP(e)}return!1}function tte(){try{if(ie.version)return parseInt(ie.version.split(".")[0],10)>=19}catch{}return!1}var rte=class{constructor(t,{editor:e,props:r={},as:n="div",className:i=""}){this.ref=null,this.destroyed=!1,this.id=Math.floor(Math.random()*4294967295).toString(),this.component=t,this.editor=e,this.props=r,this.element=document.createElement(n),this.element.classList.add("react-renderer"),i&&this.element.classList.add(...i.split(" ")),this.editor.isInitialized?Il.flushSync(()=>{this.render()}):queueMicrotask(()=>{this.destroyed||this.render()})}render(){var t;if(this.destroyed)return;const e=this.component,r=this.props,n=this.editor,i=tte(),a=ete(e),s={...r};s.ref&&!(i||a)&&delete s.ref,!s.ref&&(i||a)&&(s.ref=o=>{this.ref=o}),this.reactElement=m.jsx(e,{...s}),(t=n?.contentComponent)==null||t.setRenderer(this.id,this)}updateProps(t={}){this.destroyed||(this.props={...this.props,...t},this.render())}destroy(){var t;this.destroyed=!0;const e=this.editor;(t=e?.contentComponent)==null||t.removeRenderer(this.id);try{this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element)}catch{}}updateAttributes(t){Object.keys(t).forEach(e=>{this.element.setAttribute(e,t[e])})}};nr.createContext({markViewContentRef:()=>{}});var zx=(t,e)=>{if(t==="slot")return 0;if(t instanceof Function)return t(e);const{children:r,...n}=e??{};if(t==="svg")throw new Error("SVG elements are not supported in the JSX syntax, use the array syntax instead");return[t,n,r]},nte=/^\s*>\s$/,ite=eo.create({name:"blockquote",addOptions(){return{HTMLAttributes:{}}},content:"block+",group:"block",defining:!0,parseHTML(){return[{tag:"blockquote"}]},renderHTML({HTMLAttributes:t}){return zx("blockquote",{...Zn(this.options.HTMLAttributes,t),children:zx("slot",{})})},parseMarkdown:(t,e)=>e.createNode("blockquote",void 0,e.parseChildren(t.tokens||[])),renderMarkdown:(t,e)=>{if(!t.content)return"";const r=">",n=[];return t.content.forEach(i=>{const o=e.renderChildren([i]).split(`
`).map(l=>l.trim()===""?r:`${r} ${l}`);n.push(o.join(`
`))}),n.join(`
${r}
`)},addCommands(){return{setBlockquote:()=>({commands:t})=>t.wrapIn(this.name),toggleBlockquote:()=>({commands:t})=>t.toggleWrap(this.name),unsetBlockquote:()=>({commands:t})=>t.lift(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[tm({find:nte,type:this.type})]}}),ate=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))$/,ste=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))/g,ote=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))$/,lte=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))/g,ute=Rf.create({name:"bold",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"strong"},{tag:"b",getAttrs:t=>t.style.fontWeight!=="normal"&&null},{style:"font-weight=400",clearMark:t=>t.type.name===this.name},{style:"font-weight",getAttrs:t=>/^(bold(er)?|[5-9]\d{2,})$/.test(t)&&null}]},renderHTML({HTMLAttributes:t}){return zx("strong",{...Zn(this.options.HTMLAttributes,t),children:zx("slot",{})})},markdownTokenName:"strong",parseMarkdown:(t,e)=>e.applyMark("bold",e.parseInline(t.tokens||[])),renderMarkdown:(t,e)=>`**${e.renderChildren(t)}**`,addCommands(){return{setBold:()=>({commands:t})=>t.setMark(this.name),toggleBold:()=>({commands:t})=>t.toggleMark(this.name),unsetBold:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold(),"Mod-B":()=>this.editor.commands.toggleBold()}},addInputRules(){return[em({find:ate,type:this.type}),em({find:ote,type:this.type})]},addPasteRules(){return[Cf({find:ste,type:this.type}),Cf({find:lte,type:this.type})]}}),cte=/(^|[^`])`([^`]+)`(?!`)$/,dte=/(^|[^`])`([^`]+)`(?!`)/g,hte=Rf.create({name:"code",addOptions(){return{HTMLAttributes:{}}},excludes:"_",code:!0,exitable:!0,parseHTML(){return[{tag:"code"}]},renderHTML({HTMLAttributes:t}){return["code",Zn(this.options.HTMLAttributes,t),0]},markdownTokenName:"codespan",parseMarkdown:(t,e)=>e.applyMark("code",[{type:"text",text:t.text||""}]),renderMarkdown:(t,e)=>t.content?`\`${e.renderChildren(t.content)}\``:"",addCommands(){return{setCode:()=>({commands:t})=>t.setMark(this.name),toggleCode:()=>({commands:t})=>t.toggleMark(this.name),unsetCode:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[em({find:cte,type:this.type})]},addPasteRules(){return[Cf({find:dte,type:this.type})]}}),pS=4,fte=/^```([a-z]+)?[\s\n]$/,pte=/^~~~([a-z]+)?[\s\n]$/,mte=eo.create({name:"codeBlock",addOptions(){return{languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,defaultLanguage:null,enableTabIndentation:!1,tabSize:pS,HTMLAttributes:{}}},content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes(){return{language:{default:this.options.defaultLanguage,parseHTML:t=>{var e;const{languageClassPrefix:r}=this.options;if(!r)return null;const a=[...((e=t.firstElementChild)==null?void 0:e.classList)||[]].filter(s=>s.startsWith(r)).map(s=>s.replace(r,""))[0];return a||null},rendered:!1}}},parseHTML(){return[{tag:"pre",preserveWhitespace:"full"}]},renderHTML({node:t,HTMLAttributes:e}){return["pre",Zn(this.options.HTMLAttributes,e),["code",{class:t.attrs.language?this.options.languageClassPrefix+t.attrs.language:null},0]]},markdownTokenName:"code",parseMarkdown:(t,e)=>{var r;return((r=t.raw)==null?void 0:r.startsWith("```"))===!1&&t.codeBlockStyle!=="indented"?[]:e.createNode("codeBlock",{language:t.lang||null},t.text?[e.createTextNode(t.text)]:[])},renderMarkdown:(t,e)=>{var r;let n="";const i=((r=t.attrs)==null?void 0:r.language)||"";return t.content?n=[`\`\`\`${i}`,e.renderChildren(t.content),"```"].join(`
`):n=`\`\`\`${i}

\`\`\``,n},addCommands(){return{setCodeBlock:t=>({commands:e})=>e.setNode(this.name,t),toggleCodeBlock:t=>({commands:e})=>e.toggleNode(this.name,"paragraph",t)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{const{empty:t,$anchor:e}=this.editor.state.selection,r=e.pos===1;return!t||e.parent.type.name!==this.name?!1:r||!e.parent.textContent.length?this.editor.commands.clearNodes():!1},Tab:({editor:t})=>{var e;if(!this.options.enableTabIndentation)return!1;const r=(e=this.options.tabSize)!=null?e:pS,{state:n}=t,{selection:i}=n,{$from:a,empty:s}=i;if(a.parent.type!==this.type)return!1;const o=" ".repeat(r);return s?t.commands.insertContent(o):t.commands.command(({tr:l})=>{const{from:u,to:c}=i,v=n.doc.textBetween(u,c,`
`,`
`).split(`
`).map(y=>o+y).join(`
`);return l.replaceWith(u,c,n.schema.text(v)),!0})},"Shift-Tab":({editor:t})=>{var e;if(!this.options.enableTabIndentation)return!1;const r=(e=this.options.tabSize)!=null?e:pS,{state:n}=t,{selection:i}=n,{$from:a,empty:s}=i;return a.parent.type!==this.type?!1:s?t.commands.command(({tr:o})=>{var l;const{pos:u}=a,c=a.start(),h=a.end(),v=n.doc.textBetween(c,h,`
`,`
`).split(`
`);let y=0,S=0;const w=u-c;for(let I=0;I<v.length;I+=1){if(S+v[I].length>=w){y=I;break}S+=v[I].length+1}const _=((l=v[y].match(/^ */))==null?void 0:l[0])||"",C=Math.min(_.length,r);if(C===0)return!0;let N=c;for(let I=0;I<y;I+=1)N+=v[I].length+1;return o.delete(N,N+C),u-N<=C&&o.setSelection(dr.create(o.doc,N)),!0}):t.commands.command(({tr:o})=>{const{from:l,to:u}=i,p=n.doc.textBetween(l,u,`
`,`
`).split(`
`).map(v=>{var y;const S=((y=v.match(/^ */))==null?void 0:y[0])||"",w=Math.min(S.length,r);return v.slice(w)}).join(`
`);return o.replaceWith(l,u,n.schema.text(p)),!0})},Enter:({editor:t})=>{if(!this.options.exitOnTripleEnter)return!1;const{state:e}=t,{selection:r}=e,{$from:n,empty:i}=r;if(!i||n.parent.type!==this.type)return!1;const a=n.parentOffset===n.parent.nodeSize-2,s=n.parent.textContent.endsWith(`

`);return!a||!s?!1:t.chain().command(({tr:o})=>(o.delete(n.pos-2,n.pos),!0)).exitCode().run()},ArrowDown:({editor:t})=>{if(!this.options.exitOnArrowDown)return!1;const{state:e}=t,{selection:r,doc:n}=e,{$from:i,empty:a}=r;if(!a||i.parent.type!==this.type||!(i.parentOffset===i.parent.nodeSize-2))return!1;const o=i.after();return o===void 0?!1:n.nodeAt(o)?t.commands.command(({tr:u})=>(u.setSelection(_r.near(n.resolve(o))),!0)):t.commands.exitCode()}}},addInputRules(){return[Ek({find:fte,type:this.type,getAttributes:t=>({language:t[1]})}),Ek({find:pte,type:this.type,getAttributes:t=>({language:t[1]})})]},addProseMirrorPlugins(){return[new Xn({key:new Ni("codeBlockVSCodeHandler"),props:{handlePaste:(t,e)=>{if(!e.clipboardData||this.editor.isActive(this.type.name))return!1;const r=e.clipboardData.getData("text/plain"),n=e.clipboardData.getData("vscode-editor-data"),i=n?JSON.parse(n):void 0,a=i?.mode;if(!r||!a)return!1;const{tr:s,schema:o}=t.state,l=o.text(r.replace(/\r\n?/g,`
`));return s.replaceSelectionWith(this.type.create({language:a},l)),s.selection.$from.parent.type!==this.type&&s.setSelection(dr.near(s.doc.resolve(Math.max(0,s.selection.from-2)))),s.setMeta("paste",!0),t.dispatch(s),!0}}})]}}),gte=eo.create({name:"doc",topNode:!0,content:"block+",renderMarkdown:(t,e)=>t.content?e.renderChildren(t.content,`

`):""}),vte=eo.create({name:"hardBreak",markdownTokenName:"br",addOptions(){return{keepMarks:!0,HTMLAttributes:{}}},inline:!0,group:"inline",selectable:!1,linebreakReplacement:!0,parseHTML(){return[{tag:"br"}]},renderHTML({HTMLAttributes:t}){return["br",Zn(this.options.HTMLAttributes,t)]},renderText(){return`
`},renderMarkdown:()=>`  
`,parseMarkdown:()=>({type:"hardBreak"}),addCommands(){return{setHardBreak:()=>({commands:t,chain:e,state:r,editor:n})=>t.first([()=>t.exitCode(),()=>t.command(()=>{const{selection:i,storedMarks:a}=r;if(i.$from.parent.type.spec.isolating)return!1;const{keepMarks:s}=this.options,{splittableMarks:o}=n.extensionManager,l=a||i.$to.parentOffset&&i.$from.marks();return e().insertContent({type:this.name}).command(({tr:u,dispatch:c})=>{if(c&&l&&s){const h=l.filter(p=>o.includes(p.type.name));u.ensureMarks(h)}return!0}).run()})])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}}),yte=eo.create({name:"heading",addOptions(){return{levels:[1,2,3,4,5,6],HTMLAttributes:{}}},content:"inline*",group:"block",defining:!0,addAttributes(){return{level:{default:1,rendered:!1}}},parseHTML(){return this.options.levels.map(t=>({tag:`h${t}`,attrs:{level:t}}))},renderHTML({node:t,HTMLAttributes:e}){return[`h${this.options.levels.includes(t.attrs.level)?t.attrs.level:this.options.levels[0]}`,Zn(this.options.HTMLAttributes,e),0]},parseMarkdown:(t,e)=>e.createNode("heading",{level:t.depth||1},e.parseInline(t.tokens||[])),renderMarkdown:(t,e)=>{var r;const n=(r=t.attrs)!=null&&r.level?parseInt(t.attrs.level,10):1,i="#".repeat(n);return t.content?`${i} ${e.renderChildren(t.content)}`:""},addCommands(){return{setHeading:t=>({commands:e})=>this.options.levels.includes(t.level)?e.setNode(this.name,t):!1,toggleHeading:t=>({commands:e})=>this.options.levels.includes(t.level)?e.toggleNode(this.name,"paragraph",t):!1}},addKeyboardShortcuts(){return this.options.levels.reduce((t,e)=>({...t,[`Mod-Alt-${e}`]:()=>this.editor.commands.toggleHeading({level:e})}),{})},addInputRules(){return this.options.levels.map(t=>Ek({find:new RegExp(`^(#{${Math.min(...this.options.levels)},${t}})\\s$`),type:this.type,getAttributes:{level:t}}))}}),xte=eo.create({name:"horizontalRule",addOptions(){return{HTMLAttributes:{},nextNodeType:"paragraph"}},group:"block",parseHTML(){return[{tag:"hr"}]},renderHTML({HTMLAttributes:t}){return["hr",Zn(this.options.HTMLAttributes,t)]},markdownTokenName:"hr",parseMarkdown:(t,e)=>e.createNode("horizontalRule"),renderMarkdown:()=>"---",addCommands(){return{setHorizontalRule:()=>({chain:t,state:e})=>{if(!UJ(e,e.schema.nodes[this.name]))return!1;const{selection:r}=e,{$to:n}=r,i=t();return h6(r)?i.insertContentAt(n.pos,{type:this.name}):i.insertContent({type:this.name}),i.command(({state:a,tr:s,dispatch:o})=>{if(o){const{$to:l}=s.selection,u=l.end();if(l.nodeAfter)l.nodeAfter.isTextblock?s.setSelection(dr.create(s.doc,l.pos+1)):l.nodeAfter.isBlock?s.setSelection(Zt.create(s.doc,l.pos)):s.setSelection(dr.create(s.doc,l.pos));else{const c=a.schema.nodes[this.options.nextNodeType]||l.parent.type.contentMatch.defaultType,h=c?.create();h&&(s.insert(u,h),s.setSelection(dr.create(s.doc,u+1)))}s.scrollIntoView()}return!0}).run()}}},addInputRules(){return[zJ({find:/^(?:---|-|___\s|\*\*\*\s)$/,type:this.type})]}}),bte=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))$/,wte=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))/g,Ste=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))$/,kte=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))/g,_te=Rf.create({name:"italic",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"em"},{tag:"i",getAttrs:t=>t.style.fontStyle!=="normal"&&null},{style:"font-style=normal",clearMark:t=>t.type.name===this.name},{style:"font-style=italic"}]},renderHTML({HTMLAttributes:t}){return["em",Zn(this.options.HTMLAttributes,t),0]},addCommands(){return{setItalic:()=>({commands:t})=>t.setMark(this.name),toggleItalic:()=>({commands:t})=>t.toggleMark(this.name),unsetItalic:()=>({commands:t})=>t.unsetMark(this.name)}},markdownTokenName:"em",parseMarkdown:(t,e)=>e.applyMark("italic",e.parseInline(t.tokens||[])),renderMarkdown:(t,e)=>`*${e.renderChildren(t)}*`,addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic(),"Mod-I":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[em({find:bte,type:this.type}),em({find:Ste,type:this.type})]},addPasteRules(){return[Cf({find:wte,type:this.type}),Cf({find:kte,type:this.type})]}});const Cte="aaa1rp3bb0ott3vie4c1le2ogado5udhabi7c0ademy5centure6ountant0s9o1tor4d0s1ult4e0g1ro2tna4f0l1rica5g0akhan5ency5i0g1rbus3force5tel5kdn3l0ibaba4pay4lfinanz6state5y2sace3tom5m0azon4ericanexpress7family11x2fam3ica3sterdam8nalytics7droid5quan4z2o0l2partments8p0le4q0uarelle8r0ab1mco4chi3my2pa2t0e3s0da2ia2sociates9t0hleta5torney7u0ction5di0ble3o3spost5thor3o0s4w0s2x0a2z0ure5ba0by2idu3namex4d1k2r0celona5laycard4s5efoot5gains6seball5ketball8uhaus5yern5b0c1t1va3cg1n2d1e0ats2uty4er2rlin4st0buy5t2f1g1h0arti5i0ble3d1ke2ng0o3o1z2j1lack0friday9ockbuster8g1omberg7ue3m0s1w2n0pparibas9o0ats3ehringer8fa2m1nd2o0k0ing5sch2tik2on4t1utique6x2r0adesco6idgestone9oadway5ker3ther5ussels7s1t1uild0ers6siness6y1zz3v1w1y1z0h3ca0b1fe2l0l1vinklein9m0era3p2non3petown5ital0one8r0avan4ds2e0er0s4s2sa1e1h1ino4t0ering5holic7ba1n1re3c1d1enter4o1rn3f0a1d2g1h0anel2nel4rity4se2t2eap3intai5ristmas6ome4urch5i0priani6rcle4sco3tadel4i0c2y3k1l0aims4eaning6ick2nic1que6othing5ud3ub0med6m1n1o0ach3des3ffee4llege4ogne5m0mbank4unity6pany2re3uter5sec4ndos3struction8ulting7tact3ractors9oking4l1p2rsica5untry4pon0s4rses6pa2r0edit0card4union9icket5own3s1uise0s6u0isinella9v1w1x1y0mru3ou3z2dad1nce3ta1e1ing3sun4y2clk3ds2e0al0er2s3gree4livery5l1oitte5ta3mocrat6ntal2ist5si0gn4v2hl2iamonds6et2gital5rect0ory7scount3ver5h2y2j1k1m1np2o0cs1tor4g1mains5t1wnload7rive4tv2ubai3nlop4pont4rban5vag2r2z2earth3t2c0o2deka3u0cation8e1g1mail3erck5nergy4gineer0ing9terprises10pson4quipment8r0icsson6ni3s0q1tate5t1u0rovision8s2vents5xchange6pert3osed4ress5traspace10fage2il1rwinds6th3mily4n0s2rm0ers5shion4t3edex3edback6rrari3ero6i0delity5o2lm2nal1nce1ial7re0stone6mdale6sh0ing5t0ness6j1k1lickr3ghts4r2orist4wers5y2m1o0o0d1tball6rd1ex2sale4um3undation8x2r0ee1senius7l1ogans4ntier7tr2ujitsu5n0d2rniture7tbol5yi3ga0l0lery3o1up4me0s3p1rden4y2b0iz3d0n2e0a1nt0ing5orge5f1g0ee3h1i0ft0s3ves2ing5l0ass3e1obal2o4m0ail3bh2o1x2n1odaddy5ld0point6f2o0dyear5g0le4p1t1v2p1q1r0ainger5phics5tis4een3ipe3ocery4up4s1t1u0cci3ge2ide2tars5ru3w1y2hair2mburg5ngout5us3bo2dfc0bank7ealth0care8lp1sinki6re1mes5iphop4samitsu7tachi5v2k0t2m1n1ockey4ldings5iday5medepot5goods5s0ense7nda3rse3spital5t0ing5t0els3mail5use3w2r1sbc3t1u0ghes5yatt3undai7ibm2cbc2e1u2d1e0ee3fm2kano4l1m0amat4db2mo0bilien9n0c1dustries8finiti5o2g1k1stitute6urance4e4t0ernational10uit4vestments10o1piranga7q1r0ish4s0maili5t0anbul7t0au2v3jaguar4va3cb2e0ep2tzt3welry6io2ll2m0p2nj2o0bs1urg4t1y2p0morgan6rs3uegos4niper7kaufen5ddi3e0rryhotels6properties14fh2g1h1i0a1ds2m1ndle4tchen5wi3m1n1oeln3matsu5sher5p0mg2n2r0d1ed3uokgroup8w1y0oto4z2la0caixa5mborghini8er3nd0rover6xess5salle5t0ino3robe5w0yer5b1c1ds2ease3clerc5frak4gal2o2xus4gbt3i0dl2fe0insurance9style7ghting6ke2lly3mited4o2ncoln4k2ve1ing5k1lc1p2oan0s3cker3us3l1ndon4tte1o3ve3pl0financial11r1s1t0d0a3u0ndbeck6xe1ury5v1y2ma0drid4if1son4keup4n0agement7go3p1rket0ing3s4riott5shalls7ttel5ba2c0kinsey7d1e0d0ia3et2lbourne7me1orial6n0u2rckmsd7g1h1iami3crosoft7l1ni1t2t0subishi9k1l0b1s2m0a2n1o0bi0le4da2e1i1m1nash3ey2ster5rmon3tgage6scow4to0rcycles9v0ie4p1q1r1s0d2t0n1r2u0seum3ic4v1w1x1y1z2na0b1goya4me2vy3ba2c1e0c1t0bank4flix4work5ustar5w0s2xt0direct7us4f0l2g0o2hk2i0co2ke1on3nja3ssan1y5l1o0kia3rton4w0ruz3tv4p1r0a1w2tt2u1yc2z2obi1server7ffice5kinawa6layan0group9lo3m0ega4ne1g1l0ine5oo2pen3racle3nge4g0anic5igins6saka4tsuka4t2vh3pa0ge2nasonic7ris2s1tners4s1y3y2ccw3e0t2f0izer5g1h0armacy6d1ilips5one2to0graphy6s4ysio5ics1tet2ures6d1n0g1k2oneer5zza4k1l0ace2y0station9umbing5s3m1n0c2ohl2ker3litie5rn2st3r0axi3ess3ime3o0d0uctions8f1gressive8mo2perties3y5tection8u0dential9s1t1ub2w0c2y2qa1pon3uebec3st5racing4dio4e0ad1lestate6tor2y4cipes5d0stone5umbrella9hab3ise0n3t2liance6n0t0als5pair3ort3ublican8st0aurant8view0s5xroth6ich0ardli6oh3l1o1p2o0cks3deo3gers4om3s0vp3u0gby3hr2n2w0e2yukyu6sa0arland6fe0ty4kura4le1on3msclub4ung5ndvik0coromant12ofi4p1rl2s1ve2xo3b0i1s2c0b1haeffler7midt4olarships8ol3ule3warz5ience5ot3d1e0arch3t2cure1ity6ek2lect4ner3rvices6ven3w1x0y3fr2g1h0angrila6rp3ell3ia1ksha5oes2p0ping5uji3w3i0lk2na1gles5te3j1k0i0n2y0pe4l0ing4m0art3ile4n0cf3o0ccer3ial4ftbank4ware6hu2lar2utions7ng1y2y2pa0ce3ort2t3r0l2s1t0ada2ples4r1tebank4farm7c0group6ockholm6rage3e3ream4udio2y3yle4u0cks3pplies3y2ort5rf1gery5zuki5v1watch4iss4x1y0dney4stems6z2tab1ipei4lk2obao4rget4tamotors6r2too4x0i3c0i2d0k2eam2ch0nology8l1masek5nnis4va3f1g1h0d1eater2re6iaa2ckets5enda4ps2res2ol4j0maxx4x2k0maxx5l1m0all4n1o0day3kyo3ols3p1ray3shiba5tal3urs3wn2yota3s3r0ade1ing4ining5vel0ers0insurance16ust3v2t1ube2i1nes3shu4v0s2w1z2ua1bank3s2g1k1nicom3versity8o2ol2ps2s1y1z2va0cations7na1guard7c1e0gas3ntures6risign5mgensberater2ung14sicherung10t2g1i0ajes4deo3g1king4llas4n1p1rgin4sa1ion4va1o3laanderen9n1odka3lvo3te1ing3o2yage5u2wales2mart4ter4ng0gou5tch0es6eather0channel12bcam3er2site5d0ding5ibo2r3f1hoswho6ien2ki2lliamhill9n0dows4e1ners6me2olterskluwer11odside6rk0s2ld3w2s1tc1f3xbox3erox4ihuan4n2xx2yz3yachts4hoo3maxun5ndex5e1odobashi7ga2kohama6u0tube6t1un3za0ppos4ra3ero3ip2m1one3uerich6w2",Ete="121342632165322333335355455655552435435422463632574574330355524444661154543332344423364211133222221212112052232222232212222223222241112222224322321222",Pk="numeric",Mk="ascii",Ak="alpha",ov="asciinumeric",Qg="alphanumeric",Rk="domain",L6="emoji",Tte="scheme",Nte="slashscheme",mS="whitespace";function Pte(t,e){return t in e||(e[t]=[]),e[t]}function af(t,e,r){e[Pk]&&(e[ov]=!0,e[Qg]=!0),e[Mk]&&(e[ov]=!0,e[Ak]=!0),e[ov]&&(e[Qg]=!0),e[Ak]&&(e[Qg]=!0),e[Qg]&&(e[Rk]=!0),e[L6]&&(e[Rk]=!0);for(const n in e){const i=Pte(n,r);i.indexOf(t)<0&&i.push(t)}}function Mte(t,e){const r={};for(const n in e)e[n].indexOf(t)>=0&&(r[n]=!0);return r}function Zs(t=null){this.j={},this.jr=[],this.jd=null,this.t=t}Zs.groups={};Zs.prototype={accepts(){return!!this.t},go(t){const e=this,r=e.j[t];if(r)return r;for(let n=0;n<e.jr.length;n++){const i=e.jr[n][0],a=e.jr[n][1];if(a&&i.test(t))return a}return e.jd},has(t,e=!1){return e?t in this.j:!!this.go(t)},ta(t,e,r,n){for(let i=0;i<t.length;i++)this.tt(t[i],e,r,n)},tr(t,e,r,n){n=n||Zs.groups;let i;return e&&e.j?i=e:(i=new Zs(e),r&&n&&af(e,r,n)),this.jr.push([t,i]),i},ts(t,e,r,n){let i=this;const a=t.length;if(!a)return i;for(let s=0;s<a-1;s++)i=i.tt(t[s]);return i.tt(t[a-1],e,r,n)},tt(t,e,r,n){n=n||Zs.groups;const i=this;if(e&&e.j)return i.j[t]=e,e;const a=e;let s,o=i.go(t);if(o?(s=new Zs,Object.assign(s.j,o.j),s.jr.push.apply(s.jr,o.jr),s.jd=o.jd,s.t=o.t):s=new Zs,a){if(n)if(s.t&&typeof s.t=="string"){const l=Object.assign(Mte(s.t,n),r);af(a,l,n)}else r&&af(a,r,n);s.t=a}return i.j[t]=s,s}};const kr=(t,e,r,n,i)=>t.ta(e,r,n,i),di=(t,e,r,n,i)=>t.tr(e,r,n,i),NP=(t,e,r,n,i)=>t.ts(e,r,n,i),ut=(t,e,r,n,i)=>t.tt(e,r,n,i),oc="WORD",Lk="UWORD",O6="ASCIINUMERICAL",D6="ALPHANUMERICAL",Uv="LOCALHOST",Ok="TLD",Dk="UTLD",Xy="SCHEME",Mp="SLASH_SCHEME",cC="NUM",Ik="WS",dC="NL",lv="OPENBRACE",uv="CLOSEBRACE",Ux="OPENBRACKET",Gx="CLOSEBRACKET",Vx="OPENPAREN",Hx="CLOSEPAREN",Wx="OPENANGLEBRACKET",qx="CLOSEANGLEBRACKET",$x="FULLWIDTHLEFTPAREN",Kx="FULLWIDTHRIGHTPAREN",Zx="LEFTCORNERBRACKET",Yx="RIGHTCORNERBRACKET",Xx="LEFTWHITECORNERBRACKET",Qx="RIGHTWHITECORNERBRACKET",Jx="FULLWIDTHLESSTHAN",e1="FULLWIDTHGREATERTHAN",t1="AMPERSAND",r1="APOSTROPHE",n1="ASTERISK",Nd="AT",i1="BACKSLASH",a1="BACKTICK",s1="CARET",Ad="COLON",hC="COMMA",o1="DOLLAR",xu="DOT",l1="EQUALS",fC="EXCLAMATION",Uo="HYPHEN",cv="PERCENT",u1="PIPE",c1="PLUS",d1="POUND",dv="QUERY",pC="QUOTE",I6="FULLWIDTHMIDDLEDOT",mC="SEMI",bu="SLASH",hv="TILDE",h1="UNDERSCORE",j6="EMOJI",f1="SYM";var F6=Object.freeze({__proto__:null,ALPHANUMERICAL:D6,AMPERSAND:t1,APOSTROPHE:r1,ASCIINUMERICAL:O6,ASTERISK:n1,AT:Nd,BACKSLASH:i1,BACKTICK:a1,CARET:s1,CLOSEANGLEBRACKET:qx,CLOSEBRACE:uv,CLOSEBRACKET:Gx,CLOSEPAREN:Hx,COLON:Ad,COMMA:hC,DOLLAR:o1,DOT:xu,EMOJI:j6,EQUALS:l1,EXCLAMATION:fC,FULLWIDTHGREATERTHAN:e1,FULLWIDTHLEFTPAREN:$x,FULLWIDTHLESSTHAN:Jx,FULLWIDTHMIDDLEDOT:I6,FULLWIDTHRIGHTPAREN:Kx,HYPHEN:Uo,LEFTCORNERBRACKET:Zx,LEFTWHITECORNERBRACKET:Xx,LOCALHOST:Uv,NL:dC,NUM:cC,OPENANGLEBRACKET:Wx,OPENBRACE:lv,OPENBRACKET:Ux,OPENPAREN:Vx,PERCENT:cv,PIPE:u1,PLUS:c1,POUND:d1,QUERY:dv,QUOTE:pC,RIGHTCORNERBRACKET:Yx,RIGHTWHITECORNERBRACKET:Qx,SCHEME:Xy,SEMI:mC,SLASH:bu,SLASH_SCHEME:Mp,SYM:f1,TILDE:hv,TLD:Ok,UNDERSCORE:h1,UTLD:Dk,UWORD:Lk,WORD:oc,WS:Ik});const ac=/[a-z]/,Ug=new RegExp("\\p{L}","u"),gS=new RegExp("\\p{Emoji}","u"),sc=/\d/,vS=/\s/,PP="\r",yS=`
`,Ate="",Rte="",xS="";let Ny=null,Py=null;function Lte(t=[]){const e={};Zs.groups=e;const r=new Zs;Ny==null&&(Ny=MP(Cte)),Py==null&&(Py=MP(Ete)),ut(r,"'",r1),ut(r,"{",lv),ut(r,"}",uv),ut(r,"[",Ux),ut(r,"]",Gx),ut(r,"(",Vx),ut(r,")",Hx),ut(r,"<",Wx),ut(r,">",qx),ut(r,"",$x),ut(r,"",Kx),ut(r,"",Zx),ut(r,"",Yx),ut(r,"",Xx),ut(r,"",Qx),ut(r,"",Jx),ut(r,"",e1),ut(r,"&",t1),ut(r,"*",n1),ut(r,"@",Nd),ut(r,"`",a1),ut(r,"^",s1),ut(r,":",Ad),ut(r,",",hC),ut(r,"$",o1),ut(r,".",xu),ut(r,"=",l1),ut(r,"!",fC),ut(r,"-",Uo),ut(r,"%",cv),ut(r,"|",u1),ut(r,"+",c1),ut(r,"#",d1),ut(r,"?",dv),ut(r,'"',pC),ut(r,"/",bu),ut(r,";",mC),ut(r,"~",hv),ut(r,"_",h1),ut(r,"\\",i1),ut(r,"",I6);const n=di(r,sc,cC,{[Pk]:!0});di(n,sc,n);const i=di(n,ac,O6,{[ov]:!0}),a=di(n,Ug,D6,{[Qg]:!0}),s=di(r,ac,oc,{[Mk]:!0});di(s,sc,i),di(s,ac,s),di(i,sc,i),di(i,ac,i);const o=di(r,Ug,Lk,{[Ak]:!0});di(o,ac),di(o,sc,a),di(o,Ug,o),di(a,sc,a),di(a,ac),di(a,Ug,a);const l=ut(r,yS,dC,{[mS]:!0}),u=ut(r,PP,Ik,{[mS]:!0}),c=di(r,vS,Ik,{[mS]:!0});ut(r,xS,c),ut(u,yS,l),ut(u,xS,c),di(u,vS,c),ut(c,PP),ut(c,yS),di(c,vS,c),ut(c,xS,c);const h=di(r,gS,j6,{[L6]:!0});ut(h,"#"),di(h,gS,h),ut(h,Ate,h);const p=ut(h,Rte);ut(p,"#"),di(p,gS,h);const v=[[ac,s],[sc,i]],y=[[ac,null],[Ug,o],[sc,a]];for(let S=0;S<Ny.length;S++)kd(r,Ny[S],Ok,oc,v);for(let S=0;S<Py.length;S++)kd(r,Py[S],Dk,Lk,y);af(Ok,{tld:!0,ascii:!0},e),af(Dk,{utld:!0,alpha:!0},e),kd(r,"file",Xy,oc,v),kd(r,"mailto",Xy,oc,v),kd(r,"http",Mp,oc,v),kd(r,"https",Mp,oc,v),kd(r,"ftp",Mp,oc,v),kd(r,"ftps",Mp,oc,v),af(Xy,{scheme:!0,ascii:!0},e),af(Mp,{slashscheme:!0,ascii:!0},e),t=t.sort((S,w)=>S[0]>w[0]?1:-1);for(let S=0;S<t.length;S++){const w=t[S][0],_=t[S][1]?{[Tte]:!0}:{[Nte]:!0};w.indexOf("-")>=0?_[Rk]=!0:ac.test(w)?sc.test(w)?_[ov]=!0:_[Mk]=!0:_[Pk]=!0,NP(r,w,w,_)}return NP(r,"localhost",Uv,{ascii:!0}),r.jd=new Zs(f1),{start:r,tokens:Object.assign({groups:e},F6)}}function B6(t,e){const r=Ote(e.replace(/[A-Z]/g,o=>o.toLowerCase())),n=r.length,i=[];let a=0,s=0;for(;s<n;){let o=t,l=null,u=0,c=null,h=-1,p=-1;for(;s<n&&(l=o.go(r[s]));)o=l,o.accepts()?(h=0,p=0,c=o):h>=0&&(h+=r[s].length,p++),u+=r[s].length,a+=r[s].length,s++;a-=h,s-=p,u-=h,i.push({t:c.t,v:e.slice(a-u,a),s:a-u,e:a})}return i}function Ote(t){const e=[],r=t.length;let n=0;for(;n<r;){let i=t.charCodeAt(n),a,s=i<55296||i>56319||n+1===r||(a=t.charCodeAt(n+1))<56320||a>57343?t[n]:t.slice(n,n+2);e.push(s),n+=s.length}return e}function kd(t,e,r,n,i){let a;const s=e.length;for(let o=0;o<s-1;o++){const l=e[o];t.j[l]?a=t.j[l]:(a=new Zs(n),a.jr=i.slice(),t.j[l]=a),t=a}return a=new Zs(r),a.jr=i.slice(),t.j[e[s-1]]=a,a}function MP(t){const e=[],r=[];let n=0,i="0123456789";for(;n<t.length;){let a=0;for(;i.indexOf(t[n+a])>=0;)a++;if(a>0){e.push(r.join(""));for(let s=parseInt(t.substring(n,n+a),10);s>0;s--)r.pop();n+=a}else r.push(t[n]),n++}return e}const Gv={defaultProtocol:"http",events:null,format:AP,formatHref:AP,nl2br:!1,tagName:"a",target:null,rel:null,validate:!0,truncate:1/0,className:null,attributes:null,ignoreTags:[],render:null};function gC(t,e=null){let r=Object.assign({},Gv);t&&(r=Object.assign(r,t instanceof gC?t.o:t));const n=r.ignoreTags,i=[];for(let a=0;a<n.length;a++)i.push(n[a].toUpperCase());this.o=r,e&&(this.defaultRender=e),this.ignoreTags=i}gC.prototype={o:Gv,ignoreTags:[],defaultRender(t){return t},check(t){return this.get("validate",t.toString(),t)},get(t,e,r){const n=e!=null;let i=this.o[t];return i&&(typeof i=="object"?(i=r.t in i?i[r.t]:Gv[t],typeof i=="function"&&n&&(i=i(e,r))):typeof i=="function"&&n&&(i=i(e,r.t,r)),i)},getObj(t,e,r){let n=this.o[t];return typeof n=="function"&&e!=null&&(n=n(e,r.t,r)),n},render(t){const e=t.render(this);return(this.get("render",null,t)||this.defaultRender)(e,t.t,t)}};function AP(t){return t}function z6(t,e){this.t="token",this.v=t,this.tk=e}z6.prototype={isLink:!1,toString(){return this.v},toHref(t){return this.toString()},toFormattedString(t){const e=this.toString(),r=t.get("truncate",e,this),n=t.get("format",e,this);return r&&n.length>r?n.substring(0,r)+"":n},toFormattedHref(t){return t.get("formatHref",this.toHref(t.get("defaultProtocol")),this)},startIndex(){return this.tk[0].s},endIndex(){return this.tk[this.tk.length-1].e},toObject(t=Gv.defaultProtocol){return{type:this.t,value:this.toString(),isLink:this.isLink,href:this.toHref(t),start:this.startIndex(),end:this.endIndex()}},toFormattedObject(t){return{type:this.t,value:this.toFormattedString(t),isLink:this.isLink,href:this.toFormattedHref(t),start:this.startIndex(),end:this.endIndex()}},validate(t){return t.get("validate",this.toString(),this)},render(t){const e=this,r=this.toHref(t.get("defaultProtocol")),n=t.get("formatHref",r,this),i=t.get("tagName",r,e),a=this.toFormattedString(t),s={},o=t.get("className",r,e),l=t.get("target",r,e),u=t.get("rel",r,e),c=t.getObj("attributes",r,e),h=t.getObj("events",r,e);return s.href=n,o&&(s.class=o),l&&(s.target=l),u&&(s.rel=u),c&&Object.assign(s,c),{tagName:i,attributes:s,content:a,eventListeners:h}}};function ib(t,e){class r extends z6{constructor(i,a){super(i,a),this.t=t}}for(const n in e)r.prototype[n]=e[n];return r.t=t,r}const RP=ib("email",{isLink:!0,toHref(){return"mailto:"+this.toString()}}),LP=ib("text"),Dte=ib("nl"),My=ib("url",{isLink:!0,toHref(t=Gv.defaultProtocol){return this.hasProtocol()?this.v:`${t}://${this.v}`},hasProtocol(){const t=this.tk;return t.length>=2&&t[0].t!==Uv&&t[1].t===Ad}}),Bo=t=>new Zs(t);function Ite({groups:t}){const e=t.domain.concat([t1,n1,Nd,i1,a1,s1,o1,l1,Uo,cC,cv,u1,c1,d1,bu,f1,hv,h1]),r=[r1,Ad,hC,xu,fC,cv,dv,pC,mC,Wx,qx,lv,uv,Gx,Ux,Vx,Hx,$x,Kx,Zx,Yx,Xx,Qx,Jx,e1],n=[t1,r1,n1,i1,a1,s1,o1,l1,Uo,lv,uv,cv,u1,c1,d1,dv,bu,f1,hv,h1],i=Bo(),a=ut(i,hv);kr(a,n,a),kr(a,t.domain,a);const s=Bo(),o=Bo(),l=Bo();kr(i,t.domain,s),kr(i,t.scheme,o),kr(i,t.slashscheme,l),kr(s,n,a),kr(s,t.domain,s);const u=ut(s,Nd);ut(a,Nd,u),ut(o,Nd,u),ut(l,Nd,u);const c=ut(a,xu);kr(c,n,a),kr(c,t.domain,a);const h=Bo();kr(u,t.domain,h),kr(h,t.domain,h);const p=ut(h,xu);kr(p,t.domain,h);const v=Bo(RP);kr(p,t.tld,v),kr(p,t.utld,v),ut(u,Uv,v);const y=ut(h,Uo);ut(y,Uo,y),kr(y,t.domain,h),kr(v,t.domain,h),ut(v,xu,p),ut(v,Uo,y);const S=ut(v,Ad);kr(S,t.numeric,RP);const w=ut(s,Uo),T=ut(s,xu);ut(w,Uo,w),kr(w,t.domain,s),kr(T,n,a),kr(T,t.domain,s);const _=Bo(My);kr(T,t.tld,_),kr(T,t.utld,_),kr(_,t.domain,s),kr(_,n,a),ut(_,xu,T),ut(_,Uo,w),ut(_,Nd,u);const C=ut(_,Ad),N=Bo(My);kr(C,t.numeric,N);const A=Bo(My),I=Bo();kr(A,e,A),kr(A,r,I),kr(I,e,A),kr(I,r,I),ut(_,bu,A),ut(N,bu,A);const j=ut(o,Ad),O=ut(l,Ad),F=ut(O,bu),B=ut(F,bu);kr(o,t.domain,s),ut(o,xu,T),ut(o,Uo,w),kr(l,t.domain,s),ut(l,xu,T),ut(l,Uo,w),kr(j,t.domain,A),ut(j,bu,A),ut(j,dv,A),kr(B,t.domain,A),kr(B,e,A),ut(B,bu,A);const $=[[lv,uv],[Ux,Gx],[Vx,Hx],[Wx,qx],[$x,Kx],[Zx,Yx],[Xx,Qx],[Jx,e1]];for(let Z=0;Z<$.length;Z++){const[D,H]=$[Z],U=ut(A,D);ut(I,D,U),ut(U,H,A);const W=Bo(My);kr(U,e,W);const Y=Bo();kr(U,r),kr(W,e,W),kr(W,r,Y),kr(Y,e,W),kr(Y,r,Y),ut(W,H,A),ut(Y,H,A)}return ut(i,Uv,_),ut(i,dC,Dte),{start:i,tokens:F6}}function jte(t,e,r){let n=r.length,i=0,a=[],s=[];for(;i<n;){let o=t,l=null,u=null,c=0,h=null,p=-1;for(;i<n&&!(l=o.go(r[i].t));)s.push(r[i++]);for(;i<n&&(u=l||o.go(r[i].t));)l=null,o=u,o.accepts()?(p=0,h=o):p>=0&&p++,i++,c++;if(p<0)i-=c,i<n&&(s.push(r[i]),i++);else{s.length>0&&(a.push(bS(LP,e,s)),s=[]),i-=p,c-=p;const v=h.t,y=r.slice(i-c,i);a.push(bS(v,e,y))}}return s.length>0&&a.push(bS(LP,e,s)),a}function bS(t,e,r){const n=r[0].s,i=r[r.length-1].e,a=e.slice(n,i);return new t(a,r)}const Fte=typeof console<"u"&&console&&console.warn||(()=>{}),Bte="until manual call of linkify.init(). Register all schemes and plugins before invoking linkify the first time.",Mn={scanner:null,parser:null,tokenQueue:[],pluginQueue:[],customSchemes:[],initialized:!1};function zte(){return Zs.groups={},Mn.scanner=null,Mn.parser=null,Mn.tokenQueue=[],Mn.pluginQueue=[],Mn.customSchemes=[],Mn.initialized=!1,Mn}function OP(t,e=!1){if(Mn.initialized&&Fte(`linkifyjs: already initialized - will not register custom scheme "${t}" ${Bte}`),!/^[0-9a-z]+(-[0-9a-z]+)*$/.test(t))throw new Error(`linkifyjs: incorrect scheme format.
1. Must only contain digits, lowercase ASCII letters or "-"
2. Cannot start or end with "-"
3. "-" cannot repeat`);Mn.customSchemes.push([t,e])}function Ute(){Mn.scanner=Lte(Mn.customSchemes);for(let t=0;t<Mn.tokenQueue.length;t++)Mn.tokenQueue[t][1]({scanner:Mn.scanner});Mn.parser=Ite(Mn.scanner.tokens);for(let t=0;t<Mn.pluginQueue.length;t++)Mn.pluginQueue[t][1]({scanner:Mn.scanner,parser:Mn.parser});return Mn.initialized=!0,Mn}function vC(t){return Mn.initialized||Ute(),jte(Mn.parser.start,t,B6(Mn.scanner.start,t))}vC.scan=B6;function U6(t,e=null,r=null){if(e&&typeof e=="object"){if(r)throw Error(`linkifyjs: Invalid link type ${e}; must be a string`);r=e,e=null}const n=new gC(r),i=vC(t),a=[];for(let s=0;s<i.length;s++){const o=i[s];o.isLink&&(!e||o.t===e)&&n.check(o)&&a.push(o.toFormattedObject(n))}return a}var yC="[\0- -\u2029]",Gte=new RegExp(yC),Vte=new RegExp(`${yC}$`),Hte=new RegExp(yC,"g");function Wte(t){return t.length===1?t[0].isLink:t.length===3&&t[1].isLink?["()","[]"].includes(t[0].value+t[2].value):!1}function qte(t){return new Xn({key:new Ni("autolink"),appendTransaction:(e,r,n)=>{const i=e.some(u=>u.docChanged)&&!r.doc.eq(n.doc),a=e.some(u=>u.getMeta("preventAutolink"));if(!i||a)return;const{tr:s}=n,o=i6(r.doc,[...e]);if(d6(o).forEach(({newRange:u})=>{const c=UQ(n.doc,u,v=>v.isTextblock);let h,p;if(c.length>1)h=c[0],p=n.doc.textBetween(h.pos,h.pos+h.node.nodeSize,void 0," ");else if(c.length){const v=n.doc.textBetween(u.from,u.to," "," ");if(!Vte.test(v))return;h=c[0],p=n.doc.textBetween(h.pos,u.to,void 0," ")}if(h&&p){const v=p.split(Gte).filter(Boolean);if(v.length<=0)return!1;const y=v[v.length-1],S=h.pos+p.lastIndexOf(y);if(!y)return!1;const w=vC(y).map(T=>T.toObject(t.defaultProtocol));if(!Wte(w))return!1;w.filter(T=>T.isLink).map(T=>({...T,from:S+T.start+1,to:S+T.end+1})).filter(T=>n.schema.marks.code?!n.doc.rangeHasMark(T.from,T.to,n.schema.marks.code):!0).filter(T=>t.validate(T.value)).filter(T=>t.shouldAutoLink(T.value)).forEach(T=>{aC(T.from,T.to,n.doc).some(_=>_.mark.type===t.type)||s.addMark(T.from,T.to,t.type.create({href:T.href}))})}}),!!s.steps.length)return s}})}function $te(t){return new Xn({key:new Ni("handleClickLink"),props:{handleClick:(e,r,n)=>{var i,a;if(n.button!==0||!e.editable)return!1;let s=null;if(n.target instanceof HTMLAnchorElement)s=n.target;else{const l=n.target;if(!l)return!1;const u=t.editor.view.dom;s=l.closest("a"),s&&!u.contains(s)&&(s=null)}if(!s)return!1;let o=!1;if(t.enableClickSelection&&(o=t.editor.commands.extendMarkRange(t.type.name)),t.openOnClick){const l=c6(e.state,t.type.name),u=(i=s.href)!=null?i:l.href,c=(a=s.target)!=null?a:l.target;u&&(window.open(u,c),o=!0)}return o}}})}function Kte(t){return new Xn({key:new Ni("handlePasteLink"),props:{handlePaste:(e,r,n)=>{const{shouldAutoLink:i}=t,{state:a}=e,{selection:s}=a,{empty:o}=s;if(o)return!1;let l="";n.content.forEach(c=>{l+=c.textContent});const u=U6(l,{defaultProtocol:t.defaultProtocol}).find(c=>c.isLink&&c.value===l);return!l||!u||i!==void 0&&!i(u.value)?!1:t.editor.commands.setMark(t.type,{href:u.href})}}})}function qh(t,e){const r=["http","https","ftp","ftps","mailto","tel","callto","sms","cid","xmpp"];return e&&e.forEach(n=>{const i=typeof n=="string"?n:n.scheme;i&&r.push(i)}),!t||t.replace(Hte,"").match(new RegExp(`^(?:(?:${r.join("|")}):|[^a-z]|[a-z0-9+.-]+(?:[^a-z+.-:]|$))`,"i"))}var Zte=Rf.create({name:"link",priority:1e3,keepOnSplit:!1,exitable:!0,onCreate(){this.options.validate&&!this.options.shouldAutoLink&&(this.options.shouldAutoLink=this.options.validate,console.warn("The `validate` option is deprecated. Rename to the `shouldAutoLink` option instead.")),this.options.protocols.forEach(t=>{if(typeof t=="string"){OP(t);return}OP(t.scheme,t.optionalSlashes)})},onDestroy(){zte()},inclusive(){return this.options.autolink},addOptions(){return{openOnClick:!0,enableClickSelection:!1,linkOnPaste:!0,autolink:!0,protocols:[],defaultProtocol:"http",HTMLAttributes:{target:"_blank",rel:"noopener noreferrer nofollow",class:null},isAllowedUri:(t,e)=>!!qh(t,e.protocols),validate:t=>!!t,shouldAutoLink:t=>{const e=/^[a-z][a-z0-9+.-]*:\/\//i.test(t),r=/^[a-z][a-z0-9+.-]*:/i.test(t);if(e||r&&!t.includes("@"))return!0;const i=(t.includes("@")?t.split("@").pop():t).split(/[/?#:]/)[0];return!(/^\d{1,3}(\.\d{1,3}){3}$/.test(i)||!/\./.test(i))}}},addAttributes(){return{href:{default:null,parseHTML(t){return t.getAttribute("href")}},target:{default:this.options.HTMLAttributes.target},rel:{default:this.options.HTMLAttributes.rel},class:{default:this.options.HTMLAttributes.class}}},parseHTML(){return[{tag:"a[href]",getAttrs:t=>{const e=t.getAttribute("href");return!e||!this.options.isAllowedUri(e,{defaultValidate:r=>!!qh(r,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?!1:null}}]},renderHTML({HTMLAttributes:t}){return this.options.isAllowedUri(t.href,{defaultValidate:e=>!!qh(e,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?["a",Zn(this.options.HTMLAttributes,t),0]:["a",Zn(this.options.HTMLAttributes,{...t,href:""}),0]},markdownTokenName:"link",parseMarkdown:(t,e)=>e.applyMark("link",e.parseInline(t.tokens||[]),{href:t.href,title:t.title||null}),renderMarkdown:(t,e)=>{var r;const n=((r=t.attrs)==null?void 0:r.href)||"";return`[${e.renderChildren(t)}](${n})`},addCommands(){return{setLink:t=>({chain:e})=>{const{href:r}=t;return this.options.isAllowedUri(r,{defaultValidate:n=>!!qh(n,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?e().setMark(this.name,t).setMeta("preventAutolink",!0).run():!1},toggleLink:t=>({chain:e})=>{const{href:r}=t||{};return r&&!this.options.isAllowedUri(r,{defaultValidate:n=>!!qh(n,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?!1:e().toggleMark(this.name,t,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()},unsetLink:()=>({chain:t})=>t().unsetMark(this.name,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()}},addPasteRules(){return[Cf({find:t=>{const e=[];if(t){const{protocols:r,defaultProtocol:n}=this.options,i=U6(t).filter(a=>a.isLink&&this.options.isAllowedUri(a.value,{defaultValidate:s=>!!qh(s,r),protocols:r,defaultProtocol:n}));i.length&&i.forEach(a=>{this.options.shouldAutoLink(a.value)&&e.push({text:a.value,data:{href:a.href},index:a.start})})}return e},type:this.type,getAttributes:t=>{var e;return{href:(e=t.data)==null?void 0:e.href}}})]},addProseMirrorPlugins(){const t=[],{protocols:e,defaultProtocol:r}=this.options;return this.options.autolink&&t.push(qte({type:this.type,defaultProtocol:this.options.defaultProtocol,validate:n=>this.options.isAllowedUri(n,{defaultValidate:i=>!!qh(i,e),protocols:e,defaultProtocol:r}),shouldAutoLink:this.options.shouldAutoLink})),t.push($te({type:this.type,editor:this.editor,openOnClick:this.options.openOnClick==="whenNotEditable"?!0:this.options.openOnClick,enableClickSelection:this.options.enableClickSelection})),this.options.linkOnPaste&&t.push(Kte({editor:this.editor,defaultProtocol:this.options.defaultProtocol,type:this.type,shouldAutoLink:this.options.shouldAutoLink})),t}}),Yte=Object.defineProperty,Xte=(t,e)=>{for(var r in e)Yte(t,r,{get:e[r],enumerable:!0})},Qte="listItem",DP="textStyle",IP=/^\s*([-+*])\s$/,G6=eo.create({name:"bulletList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:"ul"}]},renderHTML({HTMLAttributes:t}){return["ul",Zn(this.options.HTMLAttributes,t),0]},markdownTokenName:"list",parseMarkdown:(t,e)=>t.type!=="list"||t.ordered?[]:{type:"bulletList",content:t.items?e.parseChildren(t.items):[]},renderMarkdown:(t,e)=>t.content?e.renderChildren(t.content,`
`):"",markdownOptions:{indentsContent:!0},addCommands(){return{toggleBulletList:()=>({commands:t,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(Qte,this.editor.getAttributes(DP)).run():t.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){let t=tm({find:IP,type:this.type});return(this.options.keepMarks||this.options.keepAttributes)&&(t=tm({find:IP,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:()=>this.editor.getAttributes(DP),editor:this.editor})),[t]}}),V6=eo.create({name:"listItem",addOptions(){return{HTMLAttributes:{},bulletListTypeName:"bulletList",orderedListTypeName:"orderedList"}},content:"paragraph block*",defining:!0,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:t}){return["li",Zn(this.options.HTMLAttributes,t),0]},markdownTokenName:"list_item",parseMarkdown:(t,e)=>{if(t.type!=="list_item")return[];let r=[];if(t.tokens&&t.tokens.length>0)if(t.tokens.some(i=>i.type==="paragraph"))r=e.parseChildren(t.tokens);else{const i=t.tokens[0];if(i&&i.type==="text"&&i.tokens&&i.tokens.length>0){if(r=[{type:"paragraph",content:e.parseInline(i.tokens)}],t.tokens.length>1){const s=t.tokens.slice(1),o=e.parseChildren(s);r.push(...o)}}else r=e.parseChildren(t.tokens)}return r.length===0&&(r=[{type:"paragraph",content:[]}]),{type:"listItem",content:r}},renderMarkdown:(t,e,r)=>uC(t,e,n=>n.parentType==="bulletList"?"- ":n.parentType==="orderedList"?`${n.index+1}. `:"- ",r),addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),Jte={};Xte(Jte,{findListItemPos:()=>f0,getNextListDepth:()=>xC,handleBackspace:()=>jk,handleDelete:()=>Fk,hasListBefore:()=>H6,hasListItemAfter:()=>ere,hasListItemBefore:()=>W6,listItemHasSubList:()=>q6,nextListIsDeeper:()=>$6,nextListIsHigher:()=>K6});var f0=(t,e)=>{const{$from:r}=e.selection,n=Bi(t,e.schema);let i=null,a=r.depth,s=r.pos,o=null;for(;a>0&&o===null;)i=r.node(a),i.type===n?o=a:(a-=1,s-=1);return o===null?null:{$pos:e.doc.resolve(s),depth:o}},xC=(t,e)=>{const r=f0(t,e);if(!r)return!1;const[,n]=XQ(e,t,r.$pos.pos+4);return n},H6=(t,e,r)=>{const{$anchor:n}=t.selection,i=Math.max(0,n.pos-2),a=t.doc.resolve(i).node();return!(!a||!r.includes(a.type.name))},W6=(t,e)=>{var r;const{$anchor:n}=e.selection,i=e.doc.resolve(n.pos-2);return!(i.index()===0||((r=i.nodeBefore)==null?void 0:r.type.name)!==t)},q6=(t,e,r)=>{if(!r)return!1;const n=Bi(t,e.schema);let i=!1;return r.descendants(a=>{a.type===n&&(i=!0)}),i},jk=(t,e,r)=>{if(t.commands.undoInputRule())return!0;if(t.state.selection.from!==t.state.selection.to)return!1;if(!nh(t.state,e)&&H6(t.state,e,r)){const{$anchor:o}=t.state.selection,l=t.state.doc.resolve(o.before()-1),u=[];l.node().descendants((p,v)=>{p.type.name===e&&u.push({node:p,pos:v})});const c=u.at(-1);if(!c)return!1;const h=t.state.doc.resolve(l.start()+c.pos+1);return t.chain().cut({from:o.start()-1,to:o.end()+1},h.end()).joinForward().run()}if(!nh(t.state,e)||!tJ(t.state))return!1;const n=f0(e,t.state);if(!n)return!1;const a=t.state.doc.resolve(n.$pos.pos-2).node(n.depth),s=q6(e,t.state,a);return W6(e,t.state)&&!s?t.commands.joinItemBackward():t.chain().liftListItem(e).run()},$6=(t,e)=>{const r=xC(t,e),n=f0(t,e);return!n||!r?!1:r>n.depth},K6=(t,e)=>{const r=xC(t,e),n=f0(t,e);return!n||!r?!1:r<n.depth},Fk=(t,e)=>{if(!nh(t.state,e)||!eJ(t.state,e))return!1;const{selection:r}=t.state,{$from:n,$to:i}=r;return!r.empty&&n.sameParent(i)?!1:$6(e,t.state)?t.chain().focus(t.state.selection.from+4).lift(e).joinBackward().run():K6(e,t.state)?t.chain().joinForward().joinBackward().run():t.commands.joinItemForward()},ere=(t,e)=>{var r;const{$anchor:n}=e.selection,i=e.doc.resolve(n.pos-n.parentOffset-2);return!(i.index()===i.parent.childCount-1||((r=i.nodeAfter)==null?void 0:r.type.name)!==t)},Z6=Pi.create({name:"listKeymap",addOptions(){return{listTypes:[{itemName:"listItem",wrapperNames:["bulletList","orderedList"]},{itemName:"taskItem",wrapperNames:["taskList"]}]}},addKeyboardShortcuts(){return{Delete:({editor:t})=>{let e=!1;return this.options.listTypes.forEach(({itemName:r})=>{t.state.schema.nodes[r]!==void 0&&Fk(t,r)&&(e=!0)}),e},"Mod-Delete":({editor:t})=>{let e=!1;return this.options.listTypes.forEach(({itemName:r})=>{t.state.schema.nodes[r]!==void 0&&Fk(t,r)&&(e=!0)}),e},Backspace:({editor:t})=>{let e=!1;return this.options.listTypes.forEach(({itemName:r,wrapperNames:n})=>{t.state.schema.nodes[r]!==void 0&&jk(t,r,n)&&(e=!0)}),e},"Mod-Backspace":({editor:t})=>{let e=!1;return this.options.listTypes.forEach(({itemName:r,wrapperNames:n})=>{t.state.schema.nodes[r]!==void 0&&jk(t,r,n)&&(e=!0)}),e}}}}),jP=/^(\s*)(\d+)\.\s+(.*)$/,tre=/^\s/;function rre(t){const e=[];let r=0,n=0;for(;r<t.length;){const i=t[r],a=i.match(jP);if(!a)break;const[,s,o,l]=a,u=s.length;let c=l,h=r+1;const p=[i];for(;h<t.length;){const v=t[h];if(v.match(jP))break;if(v.trim()==="")p.push(v),c+=`
`,h+=1;else if(v.match(tre))p.push(v),c+=`
${v.slice(u+2)}`,h+=1;else break}e.push({indent:u,number:parseInt(o,10),content:c.trim(),raw:p.join(`
`)}),n=h,r=h}return[e,n]}function Y6(t,e,r){var n;const i=[];let a=0;for(;a<t.length;){const s=t[a];if(s.indent===e){const o=s.content.split(`
`),l=((n=o[0])==null?void 0:n.trim())||"",u=[];l&&u.push({type:"paragraph",raw:l,tokens:r.inlineTokens(l)});const c=o.slice(1).join(`
`).trim();if(c){const v=r.blockTokens(c);u.push(...v)}let h=a+1;const p=[];for(;h<t.length&&t[h].indent>e;)p.push(t[h]),h+=1;if(p.length>0){const v=Math.min(...p.map(S=>S.indent)),y=Y6(p,v,r);u.push({type:"list",ordered:!0,start:p[0].number,items:y,raw:p.map(S=>S.raw).join(`
`)})}i.push({type:"list_item",raw:s.raw,tokens:u}),a=h}else a+=1}return i}function nre(t,e){return t.map(r=>{if(r.type!=="list_item")return e.parseChildren([r])[0];const n=[];return r.tokens&&r.tokens.length>0&&r.tokens.forEach(i=>{if(i.type==="paragraph"||i.type==="list"||i.type==="blockquote"||i.type==="code")n.push(...e.parseChildren([i]));else if(i.type==="text"&&i.tokens){const a=e.parseChildren([i]);n.push({type:"paragraph",content:a})}else{const a=e.parseChildren([i]);a.length>0&&n.push(...a)}}),{type:"listItem",content:n}})}var ire="listItem",FP="textStyle",BP=/^(\d+)\.\s$/,X6=eo.create({name:"orderedList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},addAttributes(){return{start:{default:1,parseHTML:t=>t.hasAttribute("start")?parseInt(t.getAttribute("start")||"",10):1},type:{default:null,parseHTML:t=>t.getAttribute("type")}}},parseHTML(){return[{tag:"ol"}]},renderHTML({HTMLAttributes:t}){const{start:e,...r}=t;return e===1?["ol",Zn(this.options.HTMLAttributes,r),0]:["ol",Zn(this.options.HTMLAttributes,t),0]},markdownTokenName:"list",parseMarkdown:(t,e)=>{if(t.type!=="list"||!t.ordered)return[];const r=t.start||1,n=t.items?nre(t.items,e):[];return r!==1?{type:"orderedList",attrs:{start:r},content:n}:{type:"orderedList",content:n}},renderMarkdown:(t,e)=>t.content?e.renderChildren(t.content,`
`):"",markdownTokenizer:{name:"orderedList",level:"block",start:t=>{const e=t.match(/^(\s*)(\d+)\.\s+/),r=e?.index;return r!==void 0?r:-1},tokenize:(t,e,r)=>{var n;const i=t.split(`
`),[a,s]=rre(i);if(a.length===0)return;const o=Y6(a,0,r);return o.length===0?void 0:{type:"list",ordered:!0,start:((n=a[0])==null?void 0:n.number)||1,items:o,raw:i.slice(0,s).join(`
`)}}},markdownOptions:{indentsContent:!0},addCommands(){return{toggleOrderedList:()=>({commands:t,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(ire,this.editor.getAttributes(FP)).run():t.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){let t=tm({find:BP,type:this.type,getAttributes:e=>({start:+e[1]}),joinPredicate:(e,r)=>r.childCount+r.attrs.start===+e[1]});return(this.options.keepMarks||this.options.keepAttributes)&&(t=tm({find:BP,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:e=>({start:+e[1],...this.editor.getAttributes(FP)}),joinPredicate:(e,r)=>r.childCount+r.attrs.start===+e[1],editor:this.editor})),[t]}}),are=/^\s*(\[([( |x])?\])\s$/,sre=eo.create({name:"taskItem",addOptions(){return{nested:!1,HTMLAttributes:{},taskListTypeName:"taskList",a11y:void 0}},content(){return this.options.nested?"paragraph block*":"paragraph+"},defining:!0,addAttributes(){return{checked:{default:!1,keepOnSplit:!1,parseHTML:t=>{const e=t.getAttribute("data-checked");return e===""||e==="true"},renderHTML:t=>({"data-checked":t.checked})}}},parseHTML(){return[{tag:`li[data-type="${this.name}"]`,priority:51}]},renderHTML({node:t,HTMLAttributes:e}){return["li",Zn(this.options.HTMLAttributes,e,{"data-type":this.name}),["label",["input",{type:"checkbox",checked:t.attrs.checked?"checked":null}],["span"]],["div",0]]},parseMarkdown:(t,e)=>{const r=[];if(t.tokens&&t.tokens.length>0?r.push(e.createNode("paragraph",{},e.parseInline(t.tokens))):t.text?r.push(e.createNode("paragraph",{},[e.createNode("text",{text:t.text})])):r.push(e.createNode("paragraph",{},[])),t.nestedTokens&&t.nestedTokens.length>0){const n=e.parseChildren(t.nestedTokens);r.push(...n)}return e.createNode("taskItem",{checked:t.checked||!1},r)},renderMarkdown:(t,e)=>{var r;const i=`- [${(r=t.attrs)!=null&&r.checked?"x":" "}] `;return uC(t,e,i)},addKeyboardShortcuts(){const t={Enter:()=>this.editor.commands.splitListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)};return this.options.nested?{...t,Tab:()=>this.editor.commands.sinkListItem(this.name)}:t},addNodeView(){return({node:t,HTMLAttributes:e,getPos:r,editor:n})=>{const i=document.createElement("li"),a=document.createElement("label"),s=document.createElement("span"),o=document.createElement("input"),l=document.createElement("div"),u=h=>{var p,v;o.ariaLabel=((v=(p=this.options.a11y)==null?void 0:p.checkboxLabel)==null?void 0:v.call(p,h,o.checked))||`Task item checkbox for ${h.textContent||"empty task item"}`};u(t),a.contentEditable="false",o.type="checkbox",o.addEventListener("mousedown",h=>h.preventDefault()),o.addEventListener("change",h=>{if(!n.isEditable&&!this.options.onReadOnlyChecked){o.checked=!o.checked;return}const{checked:p}=h.target;n.isEditable&&typeof r=="function"&&n.chain().focus(void 0,{scrollIntoView:!1}).command(({tr:v})=>{const y=r();if(typeof y!="number")return!1;const S=v.doc.nodeAt(y);return v.setNodeMarkup(y,void 0,{...S?.attrs,checked:p}),!0}).run(),!n.isEditable&&this.options.onReadOnlyChecked&&(this.options.onReadOnlyChecked(t,p)||(o.checked=!o.checked))}),Object.entries(this.options.HTMLAttributes).forEach(([h,p])=>{i.setAttribute(h,p)}),i.dataset.checked=t.attrs.checked,o.checked=t.attrs.checked,a.append(o,s),i.append(a,l),Object.entries(e).forEach(([h,p])=>{i.setAttribute(h,p)});let c=new Set(Object.keys(e));return{dom:i,contentDOM:l,update:h=>{if(h.type!==this.type)return!1;i.dataset.checked=h.attrs.checked,o.checked=h.attrs.checked,u(h);const p=n.extensionManager.attributes,v=zv(h,p),y=new Set(Object.keys(v)),S=this.options.HTMLAttributes;return c.forEach(w=>{y.has(w)||(w in S?i.setAttribute(w,S[w]):i.removeAttribute(w))}),Object.entries(v).forEach(([w,T])=>{T==null?w in S?i.setAttribute(w,S[w]):i.removeAttribute(w):i.setAttribute(w,T)}),c=y,!0}}}},addInputRules(){return[tm({find:are,type:this.type,getAttributes:t=>({checked:t[t.length-1]==="x"})})]}}),ore=eo.create({name:"taskList",addOptions(){return{itemTypeName:"taskItem",HTMLAttributes:{}}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:`ul[data-type="${this.name}"]`,priority:51}]},renderHTML({HTMLAttributes:t}){return["ul",Zn(this.options.HTMLAttributes,t,{"data-type":this.name}),0]},parseMarkdown:(t,e)=>e.createNode("taskList",{},e.parseChildren(t.items||[])),renderMarkdown:(t,e)=>t.content?e.renderChildren(t.content,`
`):"",markdownTokenizer:{name:"taskList",level:"block",start(t){var e;const r=(e=t.match(/^\s*[-+*]\s+\[([ xX])\]\s+/))==null?void 0:e.index;return r!==void 0?r:-1},tokenize(t,e,r){const n=a=>{const s=Tk(a,{itemPattern:/^(\s*)([-+*])\s+\[([ xX])\]\s+(.*)$/,extractItemData:o=>({indentLevel:o[1].length,mainContent:o[4],checked:o[3].toLowerCase()==="x"}),createToken:(o,l)=>({type:"taskItem",raw:"",mainContent:o.mainContent,indentLevel:o.indentLevel,checked:o.checked,text:o.mainContent,tokens:r.inlineTokens(o.mainContent),nestedTokens:l}),customNestedParser:n},r);return s?[{type:"taskList",raw:s.raw,items:s.items}]:r.blockTokens(a)},i=Tk(t,{itemPattern:/^(\s*)([-+*])\s+\[([ xX])\]\s+(.*)$/,extractItemData:a=>({indentLevel:a[1].length,mainContent:a[4],checked:a[3].toLowerCase()==="x"}),createToken:(a,s)=>({type:"taskItem",raw:"",mainContent:a.mainContent,indentLevel:a.indentLevel,checked:a.checked,text:a.mainContent,tokens:r.inlineTokens(a.mainContent),nestedTokens:s}),customNestedParser:n},r);if(i)return{type:"taskList",raw:i.raw,items:i.items}}},markdownOptions:{indentsContent:!0},addCommands(){return{toggleTaskList:()=>({commands:t})=>t.toggleList(this.name,this.options.itemTypeName)}},addKeyboardShortcuts(){return{"Mod-Shift-9":()=>this.editor.commands.toggleTaskList()}}});Pi.create({name:"listKit",addExtensions(){const t=[];return this.options.bulletList!==!1&&t.push(G6.configure(this.options.bulletList)),this.options.listItem!==!1&&t.push(V6.configure(this.options.listItem)),this.options.listKeymap!==!1&&t.push(Z6.configure(this.options.listKeymap)),this.options.orderedList!==!1&&t.push(X6.configure(this.options.orderedList)),this.options.taskItem!==!1&&t.push(sre.configure(this.options.taskItem)),this.options.taskList!==!1&&t.push(ore.configure(this.options.taskList)),t}});var lre=eo.create({name:"paragraph",priority:1e3,addOptions(){return{HTMLAttributes:{}}},group:"block",content:"inline*",parseHTML(){return[{tag:"p"}]},renderHTML({HTMLAttributes:t}){return["p",Zn(this.options.HTMLAttributes,t),0]},parseMarkdown:(t,e)=>{const r=t.tokens||[];return r.length===1&&r[0].type==="image"?e.parseChildren([r[0]]):e.createNode("paragraph",void 0,e.parseInline(r))},renderMarkdown:(t,e)=>!t||!Array.isArray(t.content)?"":e.renderChildren(t.content),addCommands(){return{setParagraph:()=>({commands:t})=>t.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),ure=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))$/,cre=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))/g,dre=Rf.create({name:"strike",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:t=>t.includes("line-through")?{}:!1}]},renderHTML({HTMLAttributes:t}){return["s",Zn(this.options.HTMLAttributes,t),0]},markdownTokenName:"del",parseMarkdown:(t,e)=>e.applyMark("strike",e.parseInline(t.tokens||[])),renderMarkdown:(t,e)=>`~~${e.renderChildren(t)}~~`,addCommands(){return{setStrike:()=>({commands:t})=>t.setMark(this.name),toggleStrike:()=>({commands:t})=>t.toggleMark(this.name),unsetStrike:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-s":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[em({find:ure,type:this.type})]},addPasteRules(){return[Cf({find:cre,type:this.type})]}}),hre=eo.create({name:"text",group:"inline",parseMarkdown:t=>({type:"text",text:t.text||""}),renderMarkdown:t=>t.text||""}),fre=Rf.create({name:"underline",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"u"},{style:"text-decoration",consuming:!1,getAttrs:t=>t.includes("underline")?{}:!1}]},renderHTML({HTMLAttributes:t}){return["u",Zn(this.options.HTMLAttributes,t),0]},parseMarkdown(t,e){return e.applyMark(this.name||"underline",e.parseInline(t.tokens||[]))},renderMarkdown(t,e){return`++${e.renderChildren(t)}++`},markdownTokenizer:{name:"underline",level:"inline",start(t){return t.indexOf("++")},tokenize(t,e,r){const i=/^(\+\+)([\s\S]+?)(\+\+)/.exec(t);if(!i)return;const a=i[2].trim();return{type:"underline",raw:i[0],text:a,tokens:r.inlineTokens(a)}}},addCommands(){return{setUnderline:()=>({commands:t})=>t.setMark(this.name),toggleUnderline:()=>({commands:t})=>t.toggleMark(this.name),unsetUnderline:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-u":()=>this.editor.commands.toggleUnderline(),"Mod-U":()=>this.editor.commands.toggleUnderline()}}});function pre(t={}){return new Xn({view(e){return new mre(e,t)}})}class mre{constructor(e,r){var n;this.editorView=e,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=(n=r.width)!==null&&n!==void 0?n:1,this.color=r.color===!1?void 0:r.color||"black",this.class=r.class,this.handlers=["dragover","dragend","drop","dragleave"].map(i=>{let a=s=>{this[i](s)};return e.dom.addEventListener(i,a),{name:i,handler:a}})}destroy(){this.handlers.forEach(({name:e,handler:r})=>this.editorView.dom.removeEventListener(e,r))}update(e,r){this.cursorPos!=null&&r.doc!=e.state.doc&&(this.cursorPos>e.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(e){e!=this.cursorPos&&(this.cursorPos=e,e==null?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let e=this.editorView.state.doc.resolve(this.cursorPos),r=!e.parent.inlineContent,n,i=this.editorView.dom,a=i.getBoundingClientRect(),s=a.width/i.offsetWidth,o=a.height/i.offsetHeight;if(r){let h=e.nodeBefore,p=e.nodeAfter;if(h||p){let v=this.editorView.nodeDOM(this.cursorPos-(h?h.nodeSize:0));if(v){let y=v.getBoundingClientRect(),S=h?y.bottom:y.top;h&&p&&(S=(S+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2);let w=this.width/2*o;n={left:y.left,right:y.right,top:S-w,bottom:S+w}}}}if(!n){let h=this.editorView.coordsAtPos(this.cursorPos),p=this.width/2*s;n={left:h.left-p,right:h.left+p,top:h.top,bottom:h.bottom}}let l=this.editorView.dom.offsetParent;this.element||(this.element=l.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",r),this.element.classList.toggle("prosemirror-dropcursor-inline",!r);let u,c;if(!l||l==document.body&&getComputedStyle(l).position=="static")u=-pageXOffset,c=-pageYOffset;else{let h=l.getBoundingClientRect(),p=h.width/l.offsetWidth,v=h.height/l.offsetHeight;u=h.left-l.scrollLeft*p,c=h.top-l.scrollTop*v}this.element.style.left=(n.left-u)/s+"px",this.element.style.top=(n.top-c)/o+"px",this.element.style.width=(n.right-n.left)/s+"px",this.element.style.height=(n.bottom-n.top)/o+"px"}scheduleRemoval(e){clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.setCursor(null),e)}dragover(e){if(!this.editorView.editable)return;let r=this.editorView.posAtCoords({left:e.clientX,top:e.clientY}),n=r&&r.inside>=0&&this.editorView.state.doc.nodeAt(r.inside),i=n&&n.type.spec.disableDropCursor,a=typeof i=="function"?i(this.editorView,r,e):i;if(r&&!a){let s=r.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let o=ZL(this.editorView.state.doc,s,this.editorView.dragging.slice);o!=null&&(s=o)}this.setCursor(s),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(e){this.editorView.dom.contains(e.relatedTarget)||this.setCursor(null)}}class hi extends _r{constructor(e){super(e,e)}map(e,r){let n=e.resolve(r.map(this.head));return hi.valid(n)?new hi(n):_r.near(n)}content(){return Mt.empty}eq(e){return e instanceof hi&&e.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(e,r){if(typeof r.pos!="number")throw new RangeError("Invalid input for GapCursor.fromJSON");return new hi(e.resolve(r.pos))}getBookmark(){return new bC(this.anchor)}static valid(e){let r=e.parent;if(r.isTextblock||!gre(e)||!vre(e))return!1;let n=r.type.spec.allowGapCursor;if(n!=null)return n;let i=r.contentMatchAt(e.index()).defaultType;return i&&i.isTextblock}static findGapCursorFrom(e,r,n=!1){e:for(;;){if(!n&&hi.valid(e))return e;let i=e.pos,a=null;for(let s=e.depth;;s--){let o=e.node(s);if(r>0?e.indexAfter(s)<o.childCount:e.index(s)>0){a=o.child(r>0?e.indexAfter(s):e.index(s)-1);break}else if(s==0)return null;i+=r;let l=e.doc.resolve(i);if(hi.valid(l))return l}for(;;){let s=r>0?a.firstChild:a.lastChild;if(!s){if(a.isAtom&&!a.isText&&!Zt.isSelectable(a)){e=e.doc.resolve(i+a.nodeSize*r),n=!1;continue e}break}a=s,i+=r;let o=e.doc.resolve(i);if(hi.valid(o))return o}return null}}}hi.prototype.visible=!1;hi.findFrom=hi.findGapCursorFrom;_r.jsonID("gapcursor",hi);class bC{constructor(e){this.pos=e}map(e){return new bC(e.map(this.pos))}resolve(e){let r=e.resolve(this.pos);return hi.valid(r)?new hi(r):_r.near(r)}}function Q6(t){return t.isAtom||t.spec.isolating||t.spec.createGapCursor}function gre(t){for(let e=t.depth;e>=0;e--){let r=t.index(e),n=t.node(e);if(r==0){if(n.type.spec.isolating)return!0;continue}for(let i=n.child(r-1);;i=i.lastChild){if(i.childCount==0&&!i.inlineContent||Q6(i.type))return!0;if(i.inlineContent)return!1}}return!0}function vre(t){for(let e=t.depth;e>=0;e--){let r=t.indexAfter(e),n=t.node(e);if(r==n.childCount){if(n.type.spec.isolating)return!0;continue}for(let i=n.child(r);;i=i.firstChild){if(i.childCount==0&&!i.inlineContent||Q6(i.type))return!0;if(i.inlineContent)return!1}}return!0}function yre(){return new Xn({props:{decorations:Sre,createSelectionBetween(t,e,r){return e.pos==r.pos&&hi.valid(r)?new hi(r):null},handleClick:bre,handleKeyDown:xre,handleDOMEvents:{beforeinput:wre}}})}const xre=YO({ArrowLeft:Ay("horiz",-1),ArrowRight:Ay("horiz",1),ArrowUp:Ay("vert",-1),ArrowDown:Ay("vert",1)});function Ay(t,e){const r=t=="vert"?e>0?"down":"up":e>0?"right":"left";return function(n,i,a){let s=n.selection,o=e>0?s.$to:s.$from,l=s.empty;if(s instanceof dr){if(!a.endOfTextblock(r)||o.depth==0)return!1;l=!1,o=n.doc.resolve(e>0?o.after():o.before())}let u=hi.findGapCursorFrom(o,e,l);return u?(i&&i(n.tr.setSelection(new hi(u))),!0):!1}}function bre(t,e,r){if(!t||!t.editable)return!1;let n=t.state.doc.resolve(e);if(!hi.valid(n))return!1;let i=t.posAtCoords({left:r.clientX,top:r.clientY});return i&&i.inside>-1&&Zt.isSelectable(t.state.doc.nodeAt(i.inside))?!1:(t.dispatch(t.state.tr.setSelection(new hi(n))),!0)}function wre(t,e){if(e.inputType!="insertCompositionText"||!(t.state.selection instanceof hi))return!1;let{$from:r}=t.state.selection,n=r.parent.contentMatchAt(r.index()).findWrapping(t.state.schema.nodes.text);if(!n)return!1;let i=at.empty;for(let s=n.length-1;s>=0;s--)i=at.from(n[s].createAndFill(null,i));let a=t.state.tr.replace(r.pos,r.pos,new Mt(i,0,0));return a.setSelection(dr.near(a.doc.resolve(r.pos+1))),t.dispatch(a),!1}function Sre(t){if(!(t.selection instanceof hi))return null;let e=document.createElement("div");return e.className="ProseMirror-gapcursor",$n.create(t.doc,[ls.widget(t.selection.head,e,{key:"gapcursor"})])}var p1=200,ba=function(){};ba.prototype.append=function(e){return e.length?(e=ba.from(e),!this.length&&e||e.length<p1&&this.leafAppend(e)||this.length<p1&&e.leafPrepend(this)||this.appendInner(e)):this};ba.prototype.prepend=function(e){return e.length?ba.from(e).append(this):this};ba.prototype.appendInner=function(e){return new kre(this,e)};ba.prototype.slice=function(e,r){return e===void 0&&(e=0),r===void 0&&(r=this.length),e>=r?ba.empty:this.sliceInner(Math.max(0,e),Math.min(this.length,r))};ba.prototype.get=function(e){if(!(e<0||e>=this.length))return this.getInner(e)};ba.prototype.forEach=function(e,r,n){r===void 0&&(r=0),n===void 0&&(n=this.length),r<=n?this.forEachInner(e,r,n,0):this.forEachInvertedInner(e,r,n,0)};ba.prototype.map=function(e,r,n){r===void 0&&(r=0),n===void 0&&(n=this.length);var i=[];return this.forEach(function(a,s){return i.push(e(a,s))},r,n),i};ba.from=function(e){return e instanceof ba?e:e&&e.length?new J6(e):ba.empty};var J6=(function(t){function e(n){t.call(this),this.values=n}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={length:{configurable:!0},depth:{configurable:!0}};return e.prototype.flatten=function(){return this.values},e.prototype.sliceInner=function(i,a){return i==0&&a==this.length?this:new e(this.values.slice(i,a))},e.prototype.getInner=function(i){return this.values[i]},e.prototype.forEachInner=function(i,a,s,o){for(var l=a;l<s;l++)if(i(this.values[l],o+l)===!1)return!1},e.prototype.forEachInvertedInner=function(i,a,s,o){for(var l=a-1;l>=s;l--)if(i(this.values[l],o+l)===!1)return!1},e.prototype.leafAppend=function(i){if(this.length+i.length<=p1)return new e(this.values.concat(i.flatten()))},e.prototype.leafPrepend=function(i){if(this.length+i.length<=p1)return new e(i.flatten().concat(this.values))},r.length.get=function(){return this.values.length},r.depth.get=function(){return 0},Object.defineProperties(e.prototype,r),e})(ba);ba.empty=new J6([]);var kre=(function(t){function e(r,n){t.call(this),this.left=r,this.right=n,this.length=r.length+n.length,this.depth=Math.max(r.depth,n.depth)+1}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},e.prototype.getInner=function(n){return n<this.left.length?this.left.get(n):this.right.get(n-this.left.length)},e.prototype.forEachInner=function(n,i,a,s){var o=this.left.length;if(i<o&&this.left.forEachInner(n,i,Math.min(a,o),s)===!1||a>o&&this.right.forEachInner(n,Math.max(i-o,0),Math.min(this.length,a)-o,s+o)===!1)return!1},e.prototype.forEachInvertedInner=function(n,i,a,s){var o=this.left.length;if(i>o&&this.right.forEachInvertedInner(n,i-o,Math.max(a,o)-o,s+o)===!1||a<o&&this.left.forEachInvertedInner(n,Math.min(i,o),a,s)===!1)return!1},e.prototype.sliceInner=function(n,i){if(n==0&&i==this.length)return this;var a=this.left.length;return i<=a?this.left.slice(n,i):n>=a?this.right.slice(n-a,i-a):this.left.slice(n,a).append(this.right.slice(0,i-a))},e.prototype.leafAppend=function(n){var i=this.right.leafAppend(n);if(i)return new e(this.left,i)},e.prototype.leafPrepend=function(n){var i=this.left.leafPrepend(n);if(i)return new e(i,this.right)},e.prototype.appendInner=function(n){return this.left.depth>=Math.max(this.right.depth,n.depth)+1?new e(this.left,new e(this.right,n)):new e(this,n)},e})(ba);const _re=500;class Pl{constructor(e,r){this.items=e,this.eventCount=r}popEvent(e,r){if(this.eventCount==0)return null;let n=this.items.length;for(;;n--)if(this.items.get(n-1).selection){--n;break}let i,a;r&&(i=this.remapping(n,this.items.length),a=i.maps.length);let s=e.tr,o,l,u=[],c=[];return this.items.forEach((h,p)=>{if(!h.step){i||(i=this.remapping(n,p+1),a=i.maps.length),a--,c.push(h);return}if(i){c.push(new wu(h.map));let v=h.step.map(i.slice(a)),y;v&&s.maybeStep(v).doc&&(y=s.mapping.maps[s.mapping.maps.length-1],u.push(new wu(y,void 0,void 0,u.length+c.length))),a--,y&&i.appendMap(y,a)}else s.maybeStep(h.step);if(h.selection)return o=i?h.selection.map(i.slice(a)):h.selection,l=new Pl(this.items.slice(0,n).append(c.reverse().concat(u)),this.eventCount-1),!1},this.items.length,0),{remaining:l,transform:s,selection:o}}addTransform(e,r,n,i){let a=[],s=this.eventCount,o=this.items,l=!i&&o.length?o.get(o.length-1):null;for(let c=0;c<e.steps.length;c++){let h=e.steps[c].invert(e.docs[c]),p=new wu(e.mapping.maps[c],h,r),v;(v=l&&l.merge(p))&&(p=v,c?a.pop():o=o.slice(0,o.length-1)),a.push(p),r&&(s++,r=void 0),i||(l=p)}let u=s-n.depth;return u>Ere&&(o=Cre(o,u),s-=u),new Pl(o.append(a),s)}remapping(e,r){let n=new Ov;return this.items.forEach((i,a)=>{let s=i.mirrorOffset!=null&&a-i.mirrorOffset>=e?n.maps.length-i.mirrorOffset:void 0;n.appendMap(i.map,s)},e,r),n}addMaps(e){return this.eventCount==0?this:new Pl(this.items.append(e.map(r=>new wu(r))),this.eventCount)}rebased(e,r){if(!this.eventCount)return this;let n=[],i=Math.max(0,this.items.length-r),a=e.mapping,s=e.steps.length,o=this.eventCount;this.items.forEach(p=>{p.selection&&o--},i);let l=r;this.items.forEach(p=>{let v=a.getMirror(--l);if(v==null)return;s=Math.min(s,v);let y=a.maps[v];if(p.step){let S=e.steps[v].invert(e.docs[v]),w=p.selection&&p.selection.map(a.slice(l+1,v));w&&o++,n.push(new wu(y,S,w))}else n.push(new wu(y))},i);let u=[];for(let p=r;p<s;p++)u.push(new wu(a.maps[p]));let c=this.items.slice(0,i).append(u).append(n),h=new Pl(c,o);return h.emptyItemCount()>_re&&(h=h.compress(this.items.length-n.length)),h}emptyItemCount(){let e=0;return this.items.forEach(r=>{r.step||e++}),e}compress(e=this.items.length){let r=this.remapping(0,e),n=r.maps.length,i=[],a=0;return this.items.forEach((s,o)=>{if(o>=e)i.push(s),s.selection&&a++;else if(s.step){let l=s.step.map(r.slice(n)),u=l&&l.getMap();if(n--,u&&r.appendMap(u,n),l){let c=s.selection&&s.selection.map(r.slice(n));c&&a++;let h=new wu(u.invert(),l,c),p,v=i.length-1;(p=i.length&&i[v].merge(h))?i[v]=p:i.push(h)}}else s.map&&n--},this.items.length,0),new Pl(ba.from(i.reverse()),a)}}Pl.empty=new Pl(ba.empty,0);function Cre(t,e){let r;return t.forEach((n,i)=>{if(n.selection&&e--==0)return r=i,!1}),t.slice(r)}class wu{constructor(e,r,n,i){this.map=e,this.step=r,this.selection=n,this.mirrorOffset=i}merge(e){if(this.step&&e.step&&!e.selection){let r=e.step.merge(this.step);if(r)return new wu(r.getMap().invert(),r,this.selection)}}}class Pd{constructor(e,r,n,i,a){this.done=e,this.undone=r,this.prevRanges=n,this.prevTime=i,this.prevComposition=a}}const Ere=20;function Tre(t,e,r,n){let i=r.getMeta(df),a;if(i)return i.historyState;r.getMeta(Mre)&&(t=new Pd(t.done,t.undone,null,0,-1));let s=r.getMeta("appendedTransaction");if(r.steps.length==0)return t;if(s&&s.getMeta(df))return s.getMeta(df).redo?new Pd(t.done.addTransform(r,void 0,n,Qy(e)),t.undone,zP(r.mapping.maps),t.prevTime,t.prevComposition):new Pd(t.done,t.undone.addTransform(r,void 0,n,Qy(e)),null,t.prevTime,t.prevComposition);if(r.getMeta("addToHistory")!==!1&&!(s&&s.getMeta("addToHistory")===!1)){let o=r.getMeta("composition"),l=t.prevTime==0||!s&&t.prevComposition!=o&&(t.prevTime<(r.time||0)-n.newGroupDelay||!Nre(r,t.prevRanges)),u=s?wS(t.prevRanges,r.mapping):zP(r.mapping.maps);return new Pd(t.done.addTransform(r,l?e.selection.getBookmark():void 0,n,Qy(e)),Pl.empty,u,r.time,o??t.prevComposition)}else return(a=r.getMeta("rebased"))?new Pd(t.done.rebased(r,a),t.undone.rebased(r,a),wS(t.prevRanges,r.mapping),t.prevTime,t.prevComposition):new Pd(t.done.addMaps(r.mapping.maps),t.undone.addMaps(r.mapping.maps),wS(t.prevRanges,r.mapping),t.prevTime,t.prevComposition)}function Nre(t,e){if(!e)return!1;if(!t.docChanged)return!0;let r=!1;return t.mapping.maps[0].forEach((n,i)=>{for(let a=0;a<e.length;a+=2)n<=e[a+1]&&i>=e[a]&&(r=!0)}),r}function zP(t){let e=[];for(let r=t.length-1;r>=0&&e.length==0;r--)t[r].forEach((n,i,a,s)=>e.push(a,s));return e}function wS(t,e){if(!t)return null;let r=[];for(let n=0;n<t.length;n+=2){let i=e.map(t[n],1),a=e.map(t[n+1],-1);i<=a&&r.push(i,a)}return r}function Pre(t,e,r){let n=Qy(e),i=df.get(e).spec.config,a=(r?t.undone:t.done).popEvent(e,n);if(!a)return null;let s=a.selection.resolve(a.transform.doc),o=(r?t.done:t.undone).addTransform(a.transform,e.selection.getBookmark(),i,n),l=new Pd(r?o:a.remaining,r?a.remaining:o,null,0,-1);return a.transform.setSelection(s).setMeta(df,{redo:r,historyState:l})}let SS=!1,UP=null;function Qy(t){let e=t.plugins;if(UP!=e){SS=!1,UP=e;for(let r=0;r<e.length;r++)if(e[r].spec.historyPreserveItems){SS=!0;break}}return SS}const df=new Ni("history"),Mre=new Ni("closeHistory");function Are(t={}){return t={depth:t.depth||100,newGroupDelay:t.newGroupDelay||500},new Xn({key:df,state:{init(){return new Pd(Pl.empty,Pl.empty,null,0,-1)},apply(e,r,n){return Tre(r,n,e,t)}},config:t,props:{handleDOMEvents:{beforeinput(e,r){let n=r.inputType,i=n=="historyUndo"?tD:n=="historyRedo"?rD:null;return!i||!e.editable?!1:(r.preventDefault(),i(e.state,e.dispatch))}}}})}function eD(t,e){return(r,n)=>{let i=df.getState(r);if(!i||(t?i.undone:i.done).eventCount==0)return!1;if(n){let a=Pre(i,r,t);a&&n(e?a.scrollIntoView():a)}return!0}}const tD=eD(!1,!0),rD=eD(!0,!0);Pi.create({name:"characterCount",addOptions(){return{limit:null,mode:"textSize",textCounter:t=>t.length,wordCounter:t=>t.split(" ").filter(e=>e!=="").length}},addStorage(){return{characters:()=>0,words:()=>0}},onBeforeCreate(){this.storage.characters=t=>{const e=t?.node||this.editor.state.doc;if((t?.mode||this.options.mode)==="textSize"){const n=e.textBetween(0,e.content.size,void 0," ");return this.options.textCounter(n)}return e.nodeSize},this.storage.words=t=>{const e=t?.node||this.editor.state.doc,r=e.textBetween(0,e.content.size," "," ");return this.options.wordCounter(r)}},addProseMirrorPlugins(){let t=!1;return[new Xn({key:new Ni("characterCount"),appendTransaction:(e,r,n)=>{if(t)return;const i=this.options.limit;if(i==null||i===0){t=!0;return}const a=this.storage.characters({node:n.doc});if(a>i){const s=a-i,o=0,l=s;console.warn(`[CharacterCount] Initial content exceeded limit of ${i} characters. Content was automatically trimmed.`);const u=n.tr.deleteRange(o,l);return t=!0,u}t=!0},filterTransaction:(e,r)=>{const n=this.options.limit;if(!e.docChanged||n===0||n===null||n===void 0)return!0;const i=this.storage.characters({node:r.doc}),a=this.storage.characters({node:e.doc});if(a<=n||i>n&&a>n&&a<=i)return!0;if(i>n&&a>n&&a>i||!e.getMeta("paste"))return!1;const o=e.selection.$head.pos,l=a-n,u=o-l,c=o;return e.deleteRange(u,c),!(this.storage.characters({node:e.doc})>n)}})]}});var Rre=Pi.create({name:"dropCursor",addOptions(){return{color:"currentColor",width:1,class:void 0}},addProseMirrorPlugins(){return[pre(this.options)]}});Pi.create({name:"focus",addOptions(){return{className:"has-focus",mode:"all"}},addProseMirrorPlugins(){return[new Xn({key:new Ni("focus"),props:{decorations:({doc:t,selection:e})=>{const{isEditable:r,isFocused:n}=this.editor,{anchor:i}=e,a=[];if(!r||!n)return $n.create(t,[]);let s=0;this.options.mode==="deepest"&&t.descendants((l,u)=>{if(l.isText)return;if(!(i>=u&&i<=u+l.nodeSize-1))return!1;s+=1});let o=0;return t.descendants((l,u)=>{if(l.isText||!(i>=u&&i<=u+l.nodeSize-1))return!1;if(o+=1,this.options.mode==="deepest"&&s-o>0||this.options.mode==="shallowest"&&o>1)return this.options.mode==="deepest";a.push(ls.node(u,u+l.nodeSize,{class:this.options.className}))}),$n.create(t,a)}}})]}});var Lre=Pi.create({name:"gapCursor",addProseMirrorPlugins(){return[yre()]},extendNodeSchema(t){var e;const r={name:t.name,options:t.options,storage:t.storage};return{allowGapCursor:(e=ln(Ht(t,"allowGapCursor",r)))!=null?e:null}}}),Ore=Pi.create({name:"placeholder",addOptions(){return{emptyEditorClass:"is-editor-empty",emptyNodeClass:"is-empty",placeholder:"Write something ",showOnlyWhenEditable:!0,showOnlyCurrent:!0,includeChildren:!1}},addProseMirrorPlugins(){return[new Xn({key:new Ni("placeholder"),props:{decorations:({doc:t,selection:e})=>{const r=this.editor.isEditable||!this.options.showOnlyWhenEditable,{anchor:n}=e,i=[];if(!r)return null;const a=this.editor.isEmpty;return t.descendants((s,o)=>{const l=n>=o&&n<=o+s.nodeSize,u=!s.isLeaf&&tb(s);if((l||!this.options.showOnlyCurrent)&&u){const c=[this.options.emptyNodeClass];a&&c.push(this.options.emptyEditorClass);const h=ls.node(o,o+s.nodeSize,{class:c.join(" "),"data-placeholder":typeof this.options.placeholder=="function"?this.options.placeholder({editor:this.editor,node:s,pos:o,hasAnchor:l}):this.options.placeholder});i.push(h)}return this.options.includeChildren}),$n.create(t,i)}}})]}});Pi.create({name:"selection",addOptions(){return{className:"selection"}},addProseMirrorPlugins(){const{editor:t,options:e}=this;return[new Xn({key:new Ni("selection"),props:{decorations(r){return r.selection.empty||t.isFocused||!t.isEditable||h6(r.selection)||t.view.dragging?null:$n.create(r.doc,[ls.inline(r.selection.from,r.selection.to,{class:e.className})])}}})]}});function GP({types:t,node:e}){return e&&Array.isArray(t)&&t.includes(e.type)||e?.type===t}var Dre=Pi.create({name:"trailingNode",addOptions(){return{node:void 0,notAfter:[]}},addProseMirrorPlugins(){var t;const e=new Ni(this.name),r=this.options.node||((t=this.editor.schema.topNodeType.contentMatch.defaultType)==null?void 0:t.name)||"paragraph",n=Object.entries(this.editor.schema.nodes).map(([,i])=>i).filter(i=>(this.options.notAfter||[]).concat(r).includes(i.name));return[new Xn({key:e,appendTransaction:(i,a,s)=>{const{doc:o,tr:l,schema:u}=s,c=e.getState(s),h=o.content.size,p=u.nodes[r];if(c)return l.insert(h,p.create())},state:{init:(i,a)=>{const s=a.tr.doc.lastChild;return!GP({node:s,types:n})},apply:(i,a)=>{if(!i.docChanged||i.getMeta("__uniqueIDTransaction"))return a;const s=i.doc.lastChild;return!GP({node:s,types:n})}}})]}}),Ire=Pi.create({name:"undoRedo",addOptions(){return{depth:100,newGroupDelay:500}},addCommands(){return{undo:()=>({state:t,dispatch:e})=>tD(t,e),redo:()=>({state:t,dispatch:e})=>rD(t,e)}},addProseMirrorPlugins(){return[Are(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-y":()=>this.editor.commands.redo(),"Mod-":()=>this.editor.commands.undo(),"Shift-Mod-":()=>this.editor.commands.redo()}}}),jre=Pi.create({name:"starterKit",addExtensions(){var t,e,r,n;const i=[];return this.options.bold!==!1&&i.push(ute.configure(this.options.bold)),this.options.blockquote!==!1&&i.push(ite.configure(this.options.blockquote)),this.options.bulletList!==!1&&i.push(G6.configure(this.options.bulletList)),this.options.code!==!1&&i.push(hte.configure(this.options.code)),this.options.codeBlock!==!1&&i.push(mte.configure(this.options.codeBlock)),this.options.document!==!1&&i.push(gte.configure(this.options.document)),this.options.dropcursor!==!1&&i.push(Rre.configure(this.options.dropcursor)),this.options.gapcursor!==!1&&i.push(Lre.configure(this.options.gapcursor)),this.options.hardBreak!==!1&&i.push(vte.configure(this.options.hardBreak)),this.options.heading!==!1&&i.push(yte.configure(this.options.heading)),this.options.undoRedo!==!1&&i.push(Ire.configure(this.options.undoRedo)),this.options.horizontalRule!==!1&&i.push(xte.configure(this.options.horizontalRule)),this.options.italic!==!1&&i.push(_te.configure(this.options.italic)),this.options.listItem!==!1&&i.push(V6.configure(this.options.listItem)),this.options.listKeymap!==!1&&i.push(Z6.configure((t=this.options)==null?void 0:t.listKeymap)),this.options.link!==!1&&i.push(Zte.configure((e=this.options)==null?void 0:e.link)),this.options.orderedList!==!1&&i.push(X6.configure(this.options.orderedList)),this.options.paragraph!==!1&&i.push(lre.configure(this.options.paragraph)),this.options.strike!==!1&&i.push(dre.configure(this.options.strike)),this.options.text!==!1&&i.push(hre.configure(this.options.text)),this.options.underline!==!1&&i.push(fre.configure((r=this.options)==null?void 0:r.underline)),this.options.trailingNode!==!1&&i.push(Dre.configure((n=this.options)==null?void 0:n.trailingNode)),i}}),Fre=jre,Bre=Ore;function zre(t){var e;const{char:r,allowSpaces:n,allowToIncludeChar:i,allowedPrefixes:a,startOfLine:s,$position:o}=t,l=n&&!i,u=GJ(r),c=new RegExp(`\\s${u}$`),h=s?"^":"",p=i?"":u,v=l?new RegExp(`${h}${u}.*?(?=\\s${p}|$)`,"gm"):new RegExp(`${h}(?:^)?${u}[^\\s${p}]*`,"gm"),y=((e=o.nodeBefore)==null?void 0:e.isText)&&o.nodeBefore.text;if(!y)return null;const S=o.pos-y.length,w=Array.from(y.matchAll(v)).pop();if(!w||w.input===void 0||w.index===void 0)return null;const T=w.input.slice(Math.max(0,w.index-1),w.index),_=new RegExp(`^[${a?.join("")}\0]?$`).test(T);if(a!==null&&!_)return null;const C=S+w.index;let N=C+w[0].length;return l&&c.test(y.slice(N-1,N+1))&&(w[0]+=" ",N+=1),C<o.pos&&N>=o.pos?{range:{from:C,to:N},query:w[0].slice(r.length),text:w[0]}:null}var Ure=new Ni("suggestion");function Gre({pluginKey:t=Ure,editor:e,char:r="@",allowSpaces:n=!1,allowToIncludeChar:i=!1,allowedPrefixes:a=[" "],startOfLine:s=!1,decorationTag:o="span",decorationClass:l="suggestion",decorationContent:u="",decorationEmptyClass:c="is-empty",command:h=()=>null,items:p=()=>[],render:v=()=>({}),allow:y=()=>!0,findSuggestionMatch:S=zre,shouldShow:w}){let T;const _=v?.(),C=()=>{const j=e.state.selection.$anchor.pos,O=e.view.coordsAtPos(j),{top:F,right:B,bottom:$,left:Z}=O;try{return new DOMRect(Z,F,B-Z,$-F)}catch{return null}},N=(j,O)=>O?()=>{const F=t.getState(e.state),B=F?.decorationId,$=j.dom.querySelector(`[data-decoration-id="${B}"]`);return $?.getBoundingClientRect()||null}:C;function A(j,O){var F;try{const $=t.getState(j.state),Z=$?.decorationId?j.dom.querySelector(`[data-decoration-id="${$.decorationId}"]`):null,D={editor:e,range:$?.range||{from:0,to:0},query:$?.query||null,text:$?.text||null,items:[],command:H=>h({editor:e,range:$?.range||{from:0,to:0},props:H}),decorationNode:Z,clientRect:N(j,Z)};(F=_?.onExit)==null||F.call(_,D)}catch{}const B=j.state.tr.setMeta(O,{exit:!0});j.dispatch(B)}const I=new Xn({key:t,view(){return{update:async(j,O)=>{var F,B,$,Z,D,H,U;const W=(F=this.key)==null?void 0:F.getState(O),Y=(B=this.key)==null?void 0:B.getState(j.state),Q=W.active&&Y.active&&W.range.from!==Y.range.from,ne=!W.active&&Y.active,re=W.active&&!Y.active,q=!ne&&!re&&W.query!==Y.query,te=ne||Q&&q,ae=q||Q,de=re||Q&&q;if(!te&&!ae&&!de)return;const ge=de&&!te?W:Y,ye=j.dom.querySelector(`[data-decoration-id="${ge.decorationId}"]`);T={editor:e,range:ge.range,query:ge.query,text:ge.text,items:[],command:se=>h({editor:e,range:ge.range,props:se}),decorationNode:ye,clientRect:N(j,ye)},te&&(($=_?.onBeforeStart)==null||$.call(_,T)),ae&&((Z=_?.onBeforeUpdate)==null||Z.call(_,T)),(ae||te)&&(T.items=await p({editor:e,query:ge.query})),de&&((D=_?.onExit)==null||D.call(_,T)),ae&&((H=_?.onUpdate)==null||H.call(_,T)),te&&((U=_?.onStart)==null||U.call(_,T))},destroy:()=>{var j;T&&((j=_?.onExit)==null||j.call(_,T))}}},state:{init(){return{active:!1,range:{from:0,to:0},query:null,text:null,composing:!1}},apply(j,O,F,B){const{isEditable:$}=e,{composing:Z}=e.view,{selection:D}=j,{empty:H,from:U}=D,W={...O},Y=j.getMeta(t);if(Y&&Y.exit)return W.active=!1,W.decorationId=null,W.range={from:0,to:0},W.query=null,W.text=null,W;if(W.composing=Z,$&&(H||e.view.composing)){(U<O.range.from||U>O.range.to)&&!Z&&!O.composing&&(W.active=!1);const Q=S({char:r,allowSpaces:n,allowToIncludeChar:i,allowedPrefixes:a,startOfLine:s,$position:D.$from}),ne=`id_${Math.floor(Math.random()*4294967295)}`;Q&&y({editor:e,state:B,range:Q.range,isActive:O.active})&&(!w||w({editor:e,range:Q.range,query:Q.query,text:Q.text,transaction:j}))?(W.active=!0,W.decorationId=O.decorationId?O.decorationId:ne,W.range=Q.range,W.query=Q.query,W.text=Q.text):W.active=!1}else W.active=!1;return W.active||(W.decorationId=null,W.range={from:0,to:0},W.query=null,W.text=null),W}},props:{handleKeyDown(j,O){var F,B,$,Z;const{active:D,range:H}=I.getState(j.state);if(!D)return!1;if(O.key==="Escape"||O.key==="Esc"){const W=I.getState(j.state),Y=(F=T?.decorationNode)!=null?F:null,Q=Y??(W?.decorationId?j.dom.querySelector(`[data-decoration-id="${W.decorationId}"]`):null);if(((B=_?.onKeyDown)==null?void 0:B.call(_,{view:j,event:O,range:W.range}))||!1)return!0;const re={editor:e,range:W.range,query:W.query,text:W.text,items:[],command:q=>h({editor:e,range:W.range,props:q}),decorationNode:Q,clientRect:Q?()=>Q.getBoundingClientRect()||null:null};return($=_?.onExit)==null||$.call(_,re),A(j,t),!0}return((Z=_?.onKeyDown)==null?void 0:Z.call(_,{view:j,event:O,range:H}))||!1},decorations(j){const{active:O,range:F,decorationId:B,query:$}=I.getState(j);if(!O)return null;const Z=!$?.length,D=[l];return Z&&D.push(c),$n.create(j.doc,[ls.inline(F.from,F.to,{nodeName:o,class:D.join(" "),"data-decoration-id":B,"data-decoration-content":u})])}}});return I}function Vre({editor:t,overrideSuggestionOptions:e,extensionName:r,char:n="@"}){const i=new Ni;return{editor:t,char:n,pluginKey:i,command:({editor:a,range:s,props:o})=>{var l,u,c;const h=a.view.state.selection.$to.nodeAfter;(l=h?.text)!=null&&l.startsWith(" ")&&(s.to+=1),a.chain().focus().insertContentAt(s,[{type:r,attrs:{...o,mentionSuggestionChar:n}},{type:"text",text:" "}]).run(),(c=(u=a.view.dom.ownerDocument.defaultView)==null?void 0:u.getSelection())==null||c.collapseToEnd()},allow:({state:a,range:s})=>{const o=a.doc.resolve(s.from),l=a.schema.nodes[r];return!!o.parent.type.contentMatch.matchType(l)},...e}}function nD(t){return(t.options.suggestions.length?t.options.suggestions:[t.options.suggestion]).map(e=>Vre({editor:t.editor,overrideSuggestionOptions:e,extensionName:t.name,char:e.char}))}function VP(t,e){const r=nD(t),n=r.find(i=>i.char===e);return n||(r.length?r[0]:null)}var Hre=eo.create({name:"mention",priority:101,addOptions(){return{HTMLAttributes:{},renderText({node:t,suggestion:e}){var r,n;return`${(r=e?.char)!=null?r:"@"}${(n=t.attrs.label)!=null?n:t.attrs.id}`},deleteTriggerWithBackspace:!1,renderHTML({options:t,node:e,suggestion:r}){var n,i;return["span",Zn(this.HTMLAttributes,t.HTMLAttributes),`${(n=r?.char)!=null?n:"@"}${(i=e.attrs.label)!=null?i:e.attrs.id}`]},suggestions:[],suggestion:{}}},group:"inline",inline:!0,selectable:!1,atom:!0,addAttributes(){return{id:{default:null,parseHTML:t=>t.getAttribute("data-id"),renderHTML:t=>t.id?{"data-id":t.id}:{}},label:{default:null,parseHTML:t=>t.getAttribute("data-label"),renderHTML:t=>t.label?{"data-label":t.label}:{}},mentionSuggestionChar:{default:"@",parseHTML:t=>t.getAttribute("data-mention-suggestion-char"),renderHTML:t=>({"data-mention-suggestion-char":t.mentionSuggestionChar})}}},parseHTML(){return[{tag:`span[data-type="${this.name}"]`}]},renderHTML({node:t,HTMLAttributes:e}){const r=VP(this,t.attrs.mentionSuggestionChar);if(this.options.renderLabel!==void 0)return console.warn("renderLabel is deprecated use renderText and renderHTML instead"),["span",Zn({"data-type":this.name},this.options.HTMLAttributes,e),this.options.renderLabel({options:this.options,node:t,suggestion:r})];const n={...this.options};n.HTMLAttributes=Zn({"data-type":this.name},this.options.HTMLAttributes,e);const i=this.options.renderHTML({options:n,node:t,suggestion:r});return typeof i=="string"?["span",Zn({"data-type":this.name},this.options.HTMLAttributes,e),i]:i},...P6({nodeName:"mention",name:"@",selfClosing:!0,allowedAttributes:["id","label",{name:"mentionSuggestionChar",skipIfDefault:"@"}],parseAttributes:t=>{const e={},r=/(\w+)=(?:"([^"]*)"|'([^']*)')/g;let n=r.exec(t);for(;n!==null;){const[,i,a,s]=n,o=a??s;e[i==="char"?"mentionSuggestionChar":i]=o,n=r.exec(t)}return e},serializeAttributes:t=>Object.entries(t).filter(([,e])=>e!=null).map(([e,r])=>`${e==="mentionSuggestionChar"?"char":e}="${r}"`).join(" ")}),renderText({node:t}){const e={options:this.options,node:t,suggestion:VP(this,t.attrs.mentionSuggestionChar)};return this.options.renderLabel!==void 0?(console.warn("renderLabel is deprecated use renderText and renderHTML instead"),this.options.renderLabel(e)):this.options.renderText(e)},addKeyboardShortcuts(){return{Backspace:()=>this.editor.commands.command(({tr:t,state:e})=>{let r=!1;const{selection:n}=e,{empty:i,anchor:a}=n;if(!i)return!1;let s=new qo,o=0;return e.doc.nodesBetween(a-1,a,(l,u)=>{if(l.type.name===this.name)return r=!0,s=l,o=u,!1}),r&&t.insertText(this.options.deleteTriggerWithBackspace?"":s.attrs.mentionSuggestionChar,o,o+s.nodeSize),r})}},addProseMirrorPlugins(){return nD(this).map(Gre)}}),Wre=Hre,Qs="top",Yo="bottom",Xo="right",Js="left",wC="auto",p0=[Qs,Yo,Xo,Js],rm="start",Vv="end",qre="clippingParents",iD="viewport",Gg="popper",$re="reference",HP=p0.reduce(function(t,e){return t.concat([e+"-"+rm,e+"-"+Vv])},[]),aD=[].concat(p0,[wC]).reduce(function(t,e){return t.concat([e,e+"-"+rm,e+"-"+Vv])},[]),Kre="beforeRead",Zre="read",Yre="afterRead",Xre="beforeMain",Qre="main",Jre="afterMain",ene="beforeWrite",tne="write",rne="afterWrite",nne=[Kre,Zre,Yre,Xre,Qre,Jre,ene,tne,rne];function Mu(t){return t?(t.nodeName||"").toLowerCase():null}function go(t){if(t==null)return window;if(t.toString()!=="[object Window]"){var e=t.ownerDocument;return e&&e.defaultView||window}return t}function Ef(t){var e=go(t).Element;return t instanceof e||t instanceof Element}function Zo(t){var e=go(t).HTMLElement;return t instanceof e||t instanceof HTMLElement}function SC(t){if(typeof ShadowRoot>"u")return!1;var e=go(t).ShadowRoot;return t instanceof e||t instanceof ShadowRoot}function ine(t){var e=t.state;Object.keys(e.elements).forEach(function(r){var n=e.styles[r]||{},i=e.attributes[r]||{},a=e.elements[r];!Zo(a)||!Mu(a)||(Object.assign(a.style,n),Object.keys(i).forEach(function(s){var o=i[s];o===!1?a.removeAttribute(s):a.setAttribute(s,o===!0?"":o)}))})}function ane(t){var e=t.state,r={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,r.popper),e.styles=r,e.elements.arrow&&Object.assign(e.elements.arrow.style,r.arrow),function(){Object.keys(e.elements).forEach(function(n){var i=e.elements[n],a=e.attributes[n]||{},s=Object.keys(e.styles.hasOwnProperty(n)?e.styles[n]:r[n]),o=s.reduce(function(l,u){return l[u]="",l},{});!Zo(i)||!Mu(i)||(Object.assign(i.style,o),Object.keys(a).forEach(function(l){i.removeAttribute(l)}))})}}const sD={name:"applyStyles",enabled:!0,phase:"write",fn:ine,effect:ane,requires:["computeStyles"]};function Eu(t){return t.split("-")[0]}var hf=Math.max,m1=Math.min,nm=Math.round;function Bk(){var t=navigator.userAgentData;return t!=null&&t.brands&&Array.isArray(t.brands)?t.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function oD(){return!/^((?!chrome|android).)*safari/i.test(Bk())}function im(t,e,r){e===void 0&&(e=!1),r===void 0&&(r=!1);var n=t.getBoundingClientRect(),i=1,a=1;e&&Zo(t)&&(i=t.offsetWidth>0&&nm(n.width)/t.offsetWidth||1,a=t.offsetHeight>0&&nm(n.height)/t.offsetHeight||1);var s=Ef(t)?go(t):window,o=s.visualViewport,l=!oD()&&r,u=(n.left+(l&&o?o.offsetLeft:0))/i,c=(n.top+(l&&o?o.offsetTop:0))/a,h=n.width/i,p=n.height/a;return{width:h,height:p,top:c,right:u+h,bottom:c+p,left:u,x:u,y:c}}function kC(t){var e=im(t),r=t.offsetWidth,n=t.offsetHeight;return Math.abs(e.width-r)<=1&&(r=e.width),Math.abs(e.height-n)<=1&&(n=e.height),{x:t.offsetLeft,y:t.offsetTop,width:r,height:n}}function lD(t,e){var r=e.getRootNode&&e.getRootNode();if(t.contains(e))return!0;if(r&&SC(r)){var n=e;do{if(n&&t.isSameNode(n))return!0;n=n.parentNode||n.host}while(n)}return!1}function yc(t){return go(t).getComputedStyle(t)}function sne(t){return["table","td","th"].indexOf(Mu(t))>=0}function mh(t){return((Ef(t)?t.ownerDocument:t.document)||window.document).documentElement}function ab(t){return Mu(t)==="html"?t:t.assignedSlot||t.parentNode||(SC(t)?t.host:null)||mh(t)}function WP(t){return!Zo(t)||yc(t).position==="fixed"?null:t.offsetParent}function one(t){var e=/firefox/i.test(Bk()),r=/Trident/i.test(Bk());if(r&&Zo(t)){var n=yc(t);if(n.position==="fixed")return null}var i=ab(t);for(SC(i)&&(i=i.host);Zo(i)&&["html","body"].indexOf(Mu(i))<0;){var a=yc(i);if(a.transform!=="none"||a.perspective!=="none"||a.contain==="paint"||["transform","perspective"].indexOf(a.willChange)!==-1||e&&a.willChange==="filter"||e&&a.filter&&a.filter!=="none")return i;i=i.parentNode}return null}function m0(t){for(var e=go(t),r=WP(t);r&&sne(r)&&yc(r).position==="static";)r=WP(r);return r&&(Mu(r)==="html"||Mu(r)==="body"&&yc(r).position==="static")?e:r||one(t)||e}function _C(t){return["top","bottom"].indexOf(t)>=0?"x":"y"}function fv(t,e,r){return hf(t,m1(e,r))}function lne(t,e,r){var n=fv(t,e,r);return n>r?r:n}function uD(){return{top:0,right:0,bottom:0,left:0}}function cD(t){return Object.assign({},uD(),t)}function dD(t,e){return e.reduce(function(r,n){return r[n]=t,r},{})}var une=function(e,r){return e=typeof e=="function"?e(Object.assign({},r.rects,{placement:r.placement})):e,cD(typeof e!="number"?e:dD(e,p0))};function cne(t){var e,r=t.state,n=t.name,i=t.options,a=r.elements.arrow,s=r.modifiersData.popperOffsets,o=Eu(r.placement),l=_C(o),u=[Js,Xo].indexOf(o)>=0,c=u?"height":"width";if(!(!a||!s)){var h=une(i.padding,r),p=kC(a),v=l==="y"?Qs:Js,y=l==="y"?Yo:Xo,S=r.rects.reference[c]+r.rects.reference[l]-s[l]-r.rects.popper[c],w=s[l]-r.rects.reference[l],T=m0(a),_=T?l==="y"?T.clientHeight||0:T.clientWidth||0:0,C=S/2-w/2,N=h[v],A=_-p[c]-h[y],I=_/2-p[c]/2+C,j=fv(N,I,A),O=l;r.modifiersData[n]=(e={},e[O]=j,e.centerOffset=j-I,e)}}function dne(t){var e=t.state,r=t.options,n=r.element,i=n===void 0?"[data-popper-arrow]":n;i!=null&&(typeof i=="string"&&(i=e.elements.popper.querySelector(i),!i)||lD(e.elements.popper,i)&&(e.elements.arrow=i))}const hne={name:"arrow",enabled:!0,phase:"main",fn:cne,effect:dne,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function am(t){return t.split("-")[1]}var fne={top:"auto",right:"auto",bottom:"auto",left:"auto"};function pne(t,e){var r=t.x,n=t.y,i=e.devicePixelRatio||1;return{x:nm(r*i)/i||0,y:nm(n*i)/i||0}}function qP(t){var e,r=t.popper,n=t.popperRect,i=t.placement,a=t.variation,s=t.offsets,o=t.position,l=t.gpuAcceleration,u=t.adaptive,c=t.roundOffsets,h=t.isFixed,p=s.x,v=p===void 0?0:p,y=s.y,S=y===void 0?0:y,w=typeof c=="function"?c({x:v,y:S}):{x:v,y:S};v=w.x,S=w.y;var T=s.hasOwnProperty("x"),_=s.hasOwnProperty("y"),C=Js,N=Qs,A=window;if(u){var I=m0(r),j="clientHeight",O="clientWidth";if(I===go(r)&&(I=mh(r),yc(I).position!=="static"&&o==="absolute"&&(j="scrollHeight",O="scrollWidth")),I=I,i===Qs||(i===Js||i===Xo)&&a===Vv){N=Yo;var F=h&&I===A&&A.visualViewport?A.visualViewport.height:I[j];S-=F-n.height,S*=l?1:-1}if(i===Js||(i===Qs||i===Yo)&&a===Vv){C=Xo;var B=h&&I===A&&A.visualViewport?A.visualViewport.width:I[O];v-=B-n.width,v*=l?1:-1}}var $=Object.assign({position:o},u&&fne),Z=c===!0?pne({x:v,y:S},go(r)):{x:v,y:S};if(v=Z.x,S=Z.y,l){var D;return Object.assign({},$,(D={},D[N]=_?"0":"",D[C]=T?"0":"",D.transform=(A.devicePixelRatio||1)<=1?"translate("+v+"px, "+S+"px)":"translate3d("+v+"px, "+S+"px, 0)",D))}return Object.assign({},$,(e={},e[N]=_?S+"px":"",e[C]=T?v+"px":"",e.transform="",e))}function mne(t){var e=t.state,r=t.options,n=r.gpuAcceleration,i=n===void 0?!0:n,a=r.adaptive,s=a===void 0?!0:a,o=r.roundOffsets,l=o===void 0?!0:o,u={placement:Eu(e.placement),variation:am(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:i,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,qP(Object.assign({},u,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:s,roundOffsets:l})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,qP(Object.assign({},u,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:l})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}const gne={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:mne,data:{}};var Ry={passive:!0};function vne(t){var e=t.state,r=t.instance,n=t.options,i=n.scroll,a=i===void 0?!0:i,s=n.resize,o=s===void 0?!0:s,l=go(e.elements.popper),u=[].concat(e.scrollParents.reference,e.scrollParents.popper);return a&&u.forEach(function(c){c.addEventListener("scroll",r.update,Ry)}),o&&l.addEventListener("resize",r.update,Ry),function(){a&&u.forEach(function(c){c.removeEventListener("scroll",r.update,Ry)}),o&&l.removeEventListener("resize",r.update,Ry)}}const yne={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:vne,data:{}};var xne={left:"right",right:"left",bottom:"top",top:"bottom"};function Jy(t){return t.replace(/left|right|bottom|top/g,function(e){return xne[e]})}var bne={start:"end",end:"start"};function $P(t){return t.replace(/start|end/g,function(e){return bne[e]})}function CC(t){var e=go(t),r=e.pageXOffset,n=e.pageYOffset;return{scrollLeft:r,scrollTop:n}}function EC(t){return im(mh(t)).left+CC(t).scrollLeft}function wne(t,e){var r=go(t),n=mh(t),i=r.visualViewport,a=n.clientWidth,s=n.clientHeight,o=0,l=0;if(i){a=i.width,s=i.height;var u=oD();(u||!u&&e==="fixed")&&(o=i.offsetLeft,l=i.offsetTop)}return{width:a,height:s,x:o+EC(t),y:l}}function Sne(t){var e,r=mh(t),n=CC(t),i=(e=t.ownerDocument)==null?void 0:e.body,a=hf(r.scrollWidth,r.clientWidth,i?i.scrollWidth:0,i?i.clientWidth:0),s=hf(r.scrollHeight,r.clientHeight,i?i.scrollHeight:0,i?i.clientHeight:0),o=-n.scrollLeft+EC(t),l=-n.scrollTop;return yc(i||r).direction==="rtl"&&(o+=hf(r.clientWidth,i?i.clientWidth:0)-a),{width:a,height:s,x:o,y:l}}function TC(t){var e=yc(t),r=e.overflow,n=e.overflowX,i=e.overflowY;return/auto|scroll|overlay|hidden/.test(r+i+n)}function hD(t){return["html","body","#document"].indexOf(Mu(t))>=0?t.ownerDocument.body:Zo(t)&&TC(t)?t:hD(ab(t))}function pv(t,e){var r;e===void 0&&(e=[]);var n=hD(t),i=n===((r=t.ownerDocument)==null?void 0:r.body),a=go(n),s=i?[a].concat(a.visualViewport||[],TC(n)?n:[]):n,o=e.concat(s);return i?o:o.concat(pv(ab(s)))}function zk(t){return Object.assign({},t,{left:t.x,top:t.y,right:t.x+t.width,bottom:t.y+t.height})}function kne(t,e){var r=im(t,!1,e==="fixed");return r.top=r.top+t.clientTop,r.left=r.left+t.clientLeft,r.bottom=r.top+t.clientHeight,r.right=r.left+t.clientWidth,r.width=t.clientWidth,r.height=t.clientHeight,r.x=r.left,r.y=r.top,r}function KP(t,e,r){return e===iD?zk(wne(t,r)):Ef(e)?kne(e,r):zk(Sne(mh(t)))}function _ne(t){var e=pv(ab(t)),r=["absolute","fixed"].indexOf(yc(t).position)>=0,n=r&&Zo(t)?m0(t):t;return Ef(n)?e.filter(function(i){return Ef(i)&&lD(i,n)&&Mu(i)!=="body"}):[]}function Cne(t,e,r,n){var i=e==="clippingParents"?_ne(t):[].concat(e),a=[].concat(i,[r]),s=a[0],o=a.reduce(function(l,u){var c=KP(t,u,n);return l.top=hf(c.top,l.top),l.right=m1(c.right,l.right),l.bottom=m1(c.bottom,l.bottom),l.left=hf(c.left,l.left),l},KP(t,s,n));return o.width=o.right-o.left,o.height=o.bottom-o.top,o.x=o.left,o.y=o.top,o}function fD(t){var e=t.reference,r=t.element,n=t.placement,i=n?Eu(n):null,a=n?am(n):null,s=e.x+e.width/2-r.width/2,o=e.y+e.height/2-r.height/2,l;switch(i){case Qs:l={x:s,y:e.y-r.height};break;case Yo:l={x:s,y:e.y+e.height};break;case Xo:l={x:e.x+e.width,y:o};break;case Js:l={x:e.x-r.width,y:o};break;default:l={x:e.x,y:e.y}}var u=i?_C(i):null;if(u!=null){var c=u==="y"?"height":"width";switch(a){case rm:l[u]=l[u]-(e[c]/2-r[c]/2);break;case Vv:l[u]=l[u]+(e[c]/2-r[c]/2);break}}return l}function Hv(t,e){e===void 0&&(e={});var r=e,n=r.placement,i=n===void 0?t.placement:n,a=r.strategy,s=a===void 0?t.strategy:a,o=r.boundary,l=o===void 0?qre:o,u=r.rootBoundary,c=u===void 0?iD:u,h=r.elementContext,p=h===void 0?Gg:h,v=r.altBoundary,y=v===void 0?!1:v,S=r.padding,w=S===void 0?0:S,T=cD(typeof w!="number"?w:dD(w,p0)),_=p===Gg?$re:Gg,C=t.rects.popper,N=t.elements[y?_:p],A=Cne(Ef(N)?N:N.contextElement||mh(t.elements.popper),l,c,s),I=im(t.elements.reference),j=fD({reference:I,element:C,placement:i}),O=zk(Object.assign({},C,j)),F=p===Gg?O:I,B={top:A.top-F.top+T.top,bottom:F.bottom-A.bottom+T.bottom,left:A.left-F.left+T.left,right:F.right-A.right+T.right},$=t.modifiersData.offset;if(p===Gg&&$){var Z=$[i];Object.keys(B).forEach(function(D){var H=[Xo,Yo].indexOf(D)>=0?1:-1,U=[Qs,Yo].indexOf(D)>=0?"y":"x";B[D]+=Z[U]*H})}return B}function Ene(t,e){e===void 0&&(e={});var r=e,n=r.placement,i=r.boundary,a=r.rootBoundary,s=r.padding,o=r.flipVariations,l=r.allowedAutoPlacements,u=l===void 0?aD:l,c=am(n),h=c?o?HP:HP.filter(function(y){return am(y)===c}):p0,p=h.filter(function(y){return u.indexOf(y)>=0});p.length===0&&(p=h);var v=p.reduce(function(y,S){return y[S]=Hv(t,{placement:S,boundary:i,rootBoundary:a,padding:s})[Eu(S)],y},{});return Object.keys(v).sort(function(y,S){return v[y]-v[S]})}function Tne(t){if(Eu(t)===wC)return[];var e=Jy(t);return[$P(t),e,$P(e)]}function Nne(t){var e=t.state,r=t.options,n=t.name;if(!e.modifiersData[n]._skip){for(var i=r.mainAxis,a=i===void 0?!0:i,s=r.altAxis,o=s===void 0?!0:s,l=r.fallbackPlacements,u=r.padding,c=r.boundary,h=r.rootBoundary,p=r.altBoundary,v=r.flipVariations,y=v===void 0?!0:v,S=r.allowedAutoPlacements,w=e.options.placement,T=Eu(w),_=T===w,C=l||(_||!y?[Jy(w)]:Tne(w)),N=[w].concat(C).reduce(function(de,ge){return de.concat(Eu(ge)===wC?Ene(e,{placement:ge,boundary:c,rootBoundary:h,padding:u,flipVariations:y,allowedAutoPlacements:S}):ge)},[]),A=e.rects.reference,I=e.rects.popper,j=new Map,O=!0,F=N[0],B=0;B<N.length;B++){var $=N[B],Z=Eu($),D=am($)===rm,H=[Qs,Yo].indexOf(Z)>=0,U=H?"width":"height",W=Hv(e,{placement:$,boundary:c,rootBoundary:h,altBoundary:p,padding:u}),Y=H?D?Xo:Js:D?Yo:Qs;A[U]>I[U]&&(Y=Jy(Y));var Q=Jy(Y),ne=[];if(a&&ne.push(W[Z]<=0),o&&ne.push(W[Y]<=0,W[Q]<=0),ne.every(function(de){return de})){F=$,O=!1;break}j.set($,ne)}if(O)for(var re=y?3:1,q=function(ge){var ye=N.find(function(se){var fe=j.get(se);if(fe)return fe.slice(0,ge).every(function(le){return le})});if(ye)return F=ye,"break"},te=re;te>0;te--){var ae=q(te);if(ae==="break")break}e.placement!==F&&(e.modifiersData[n]._skip=!0,e.placement=F,e.reset=!0)}}const Pne={name:"flip",enabled:!0,phase:"main",fn:Nne,requiresIfExists:["offset"],data:{_skip:!1}};function ZP(t,e,r){return r===void 0&&(r={x:0,y:0}),{top:t.top-e.height-r.y,right:t.right-e.width+r.x,bottom:t.bottom-e.height+r.y,left:t.left-e.width-r.x}}function YP(t){return[Qs,Xo,Yo,Js].some(function(e){return t[e]>=0})}function Mne(t){var e=t.state,r=t.name,n=e.rects.reference,i=e.rects.popper,a=e.modifiersData.preventOverflow,s=Hv(e,{elementContext:"reference"}),o=Hv(e,{altBoundary:!0}),l=ZP(s,n),u=ZP(o,i,a),c=YP(l),h=YP(u);e.modifiersData[r]={referenceClippingOffsets:l,popperEscapeOffsets:u,isReferenceHidden:c,hasPopperEscaped:h},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":c,"data-popper-escaped":h})}const Ane={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:Mne};function Rne(t,e,r){var n=Eu(t),i=[Js,Qs].indexOf(n)>=0?-1:1,a=typeof r=="function"?r(Object.assign({},e,{placement:t})):r,s=a[0],o=a[1];return s=s||0,o=(o||0)*i,[Js,Xo].indexOf(n)>=0?{x:o,y:s}:{x:s,y:o}}function Lne(t){var e=t.state,r=t.options,n=t.name,i=r.offset,a=i===void 0?[0,0]:i,s=aD.reduce(function(c,h){return c[h]=Rne(h,e.rects,a),c},{}),o=s[e.placement],l=o.x,u=o.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=l,e.modifiersData.popperOffsets.y+=u),e.modifiersData[n]=s}const One={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:Lne};function Dne(t){var e=t.state,r=t.name;e.modifiersData[r]=fD({reference:e.rects.reference,element:e.rects.popper,placement:e.placement})}const Ine={name:"popperOffsets",enabled:!0,phase:"read",fn:Dne,data:{}};function jne(t){return t==="x"?"y":"x"}function Fne(t){var e=t.state,r=t.options,n=t.name,i=r.mainAxis,a=i===void 0?!0:i,s=r.altAxis,o=s===void 0?!1:s,l=r.boundary,u=r.rootBoundary,c=r.altBoundary,h=r.padding,p=r.tether,v=p===void 0?!0:p,y=r.tetherOffset,S=y===void 0?0:y,w=Hv(e,{boundary:l,rootBoundary:u,padding:h,altBoundary:c}),T=Eu(e.placement),_=am(e.placement),C=!_,N=_C(T),A=jne(N),I=e.modifiersData.popperOffsets,j=e.rects.reference,O=e.rects.popper,F=typeof S=="function"?S(Object.assign({},e.rects,{placement:e.placement})):S,B=typeof F=="number"?{mainAxis:F,altAxis:F}:Object.assign({mainAxis:0,altAxis:0},F),$=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,Z={x:0,y:0};if(I){if(a){var D,H=N==="y"?Qs:Js,U=N==="y"?Yo:Xo,W=N==="y"?"height":"width",Y=I[N],Q=Y+w[H],ne=Y-w[U],re=v?-O[W]/2:0,q=_===rm?j[W]:O[W],te=_===rm?-O[W]:-j[W],ae=e.elements.arrow,de=v&&ae?kC(ae):{width:0,height:0},ge=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:uD(),ye=ge[H],se=ge[U],fe=fv(0,j[W],de[W]),le=C?j[W]/2-re-fe-ye-B.mainAxis:q-fe-ye-B.mainAxis,pe=C?-j[W]/2+re+fe+se+B.mainAxis:te+fe+se+B.mainAxis,me=e.elements.arrow&&m0(e.elements.arrow),xe=me?N==="y"?me.clientTop||0:me.clientLeft||0:0,Se=(D=$?.[N])!=null?D:0,Ve=Y+le-Se-xe,$e=Y+pe-Se,St=fv(v?m1(Q,Ve):Q,Y,v?hf(ne,$e):ne);I[N]=St,Z[N]=St-Y}if(o){var rt,lt=N==="x"?Qs:Js,De=N==="x"?Yo:Xo,Le=I[A],Qe=A==="y"?"height":"width",Ce=Le+w[lt],Fe=Le-w[De],Ke=[Qs,Js].indexOf(T)!==-1,mt=(rt=$?.[A])!=null?rt:0,gt=Ke?Ce:Le-j[Qe]-O[Qe]-mt+B.altAxis,yt=Ke?Le+j[Qe]+O[Qe]-mt-B.altAxis:Fe,jt=v&&Ke?lne(gt,Le,yt):fv(v?gt:Ce,Le,v?yt:Fe);I[A]=jt,Z[A]=jt-Le}e.modifiersData[n]=Z}}const Bne={name:"preventOverflow",enabled:!0,phase:"main",fn:Fne,requiresIfExists:["offset"]};function zne(t){return{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}}function Une(t){return t===go(t)||!Zo(t)?CC(t):zne(t)}function Gne(t){var e=t.getBoundingClientRect(),r=nm(e.width)/t.offsetWidth||1,n=nm(e.height)/t.offsetHeight||1;return r!==1||n!==1}function Vne(t,e,r){r===void 0&&(r=!1);var n=Zo(e),i=Zo(e)&&Gne(e),a=mh(e),s=im(t,i,r),o={scrollLeft:0,scrollTop:0},l={x:0,y:0};return(n||!n&&!r)&&((Mu(e)!=="body"||TC(a))&&(o=Une(e)),Zo(e)?(l=im(e,!0),l.x+=e.clientLeft,l.y+=e.clientTop):a&&(l.x=EC(a))),{x:s.left+o.scrollLeft-l.x,y:s.top+o.scrollTop-l.y,width:s.width,height:s.height}}function Hne(t){var e=new Map,r=new Set,n=[];t.forEach(function(a){e.set(a.name,a)});function i(a){r.add(a.name);var s=[].concat(a.requires||[],a.requiresIfExists||[]);s.forEach(function(o){if(!r.has(o)){var l=e.get(o);l&&i(l)}}),n.push(a)}return t.forEach(function(a){r.has(a.name)||i(a)}),n}function Wne(t){var e=Hne(t);return nne.reduce(function(r,n){return r.concat(e.filter(function(i){return i.phase===n}))},[])}function qne(t){var e;return function(){return e||(e=new Promise(function(r){Promise.resolve().then(function(){e=void 0,r(t())})})),e}}function $ne(t){var e=t.reduce(function(r,n){var i=r[n.name];return r[n.name]=i?Object.assign({},i,n,{options:Object.assign({},i.options,n.options),data:Object.assign({},i.data,n.data)}):n,r},{});return Object.keys(e).map(function(r){return e[r]})}var XP={placement:"bottom",modifiers:[],strategy:"absolute"};function QP(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return!e.some(function(n){return!(n&&typeof n.getBoundingClientRect=="function")})}function Kne(t){t===void 0&&(t={});var e=t,r=e.defaultModifiers,n=r===void 0?[]:r,i=e.defaultOptions,a=i===void 0?XP:i;return function(o,l,u){u===void 0&&(u=a);var c={placement:"bottom",orderedModifiers:[],options:Object.assign({},XP,a),modifiersData:{},elements:{reference:o,popper:l},attributes:{},styles:{}},h=[],p=!1,v={state:c,setOptions:function(T){var _=typeof T=="function"?T(c.options):T;S(),c.options=Object.assign({},a,c.options,_),c.scrollParents={reference:Ef(o)?pv(o):o.contextElement?pv(o.contextElement):[],popper:pv(l)};var C=Wne($ne([].concat(n,c.options.modifiers)));return c.orderedModifiers=C.filter(function(N){return N.enabled}),y(),v.update()},forceUpdate:function(){if(!p){var T=c.elements,_=T.reference,C=T.popper;if(QP(_,C)){c.rects={reference:Vne(_,m0(C),c.options.strategy==="fixed"),popper:kC(C)},c.reset=!1,c.placement=c.options.placement,c.orderedModifiers.forEach(function(B){return c.modifiersData[B.name]=Object.assign({},B.data)});for(var N=0;N<c.orderedModifiers.length;N++){if(c.reset===!0){c.reset=!1,N=-1;continue}var A=c.orderedModifiers[N],I=A.fn,j=A.options,O=j===void 0?{}:j,F=A.name;typeof I=="function"&&(c=I({state:c,options:O,name:F,instance:v})||c)}}}},update:qne(function(){return new Promise(function(w){v.forceUpdate(),w(c)})}),destroy:function(){S(),p=!0}};if(!QP(o,l))return v;v.setOptions(u).then(function(w){!p&&u.onFirstUpdate&&u.onFirstUpdate(w)});function y(){c.orderedModifiers.forEach(function(w){var T=w.name,_=w.options,C=_===void 0?{}:_,N=w.effect;if(typeof N=="function"){var A=N({state:c,name:T,instance:v,options:C}),I=function(){};h.push(A||I)}})}function S(){h.forEach(function(w){return w()}),h=[]}return v}}var Zne=[yne,Ine,gne,sD,One,Pne,Bne,hne,Ane],Yne=Kne({defaultModifiers:Zne}),Xne="tippy-box",pD="tippy-content",Qne="tippy-backdrop",mD="tippy-arrow",gD="tippy-svg-arrow",Zh={passive:!0,capture:!0},vD=function(){return document.body};function kS(t,e,r){if(Array.isArray(t)){var n=t[e];return n??(Array.isArray(r)?r[e]:r)}return t}function NC(t,e){var r={}.toString.call(t);return r.indexOf("[object")===0&&r.indexOf(e+"]")>-1}function yD(t,e){return typeof t=="function"?t.apply(void 0,e):t}function JP(t,e){if(e===0)return t;var r;return function(n){clearTimeout(r),r=setTimeout(function(){t(n)},e)}}function Jne(t){return t.split(/\s+/).filter(Boolean)}function Ap(t){return[].concat(t)}function eM(t,e){t.indexOf(e)===-1&&t.push(e)}function eie(t){return t.filter(function(e,r){return t.indexOf(e)===r})}function tie(t){return t.split("-")[0]}function g1(t){return[].slice.call(t)}function tM(t){return Object.keys(t).reduce(function(e,r){return t[r]!==void 0&&(e[r]=t[r]),e},{})}function mv(){return document.createElement("div")}function sb(t){return["Element","Fragment"].some(function(e){return NC(t,e)})}function rie(t){return NC(t,"NodeList")}function nie(t){return NC(t,"MouseEvent")}function iie(t){return!!(t&&t._tippy&&t._tippy.reference===t)}function aie(t){return sb(t)?[t]:rie(t)?g1(t):Array.isArray(t)?t:g1(document.querySelectorAll(t))}function _S(t,e){t.forEach(function(r){r&&(r.style.transitionDuration=e+"ms")})}function rM(t,e){t.forEach(function(r){r&&r.setAttribute("data-state",e)})}function sie(t){var e,r=Ap(t),n=r[0];return n!=null&&(e=n.ownerDocument)!=null&&e.body?n.ownerDocument:document}function oie(t,e){var r=e.clientX,n=e.clientY;return t.every(function(i){var a=i.popperRect,s=i.popperState,o=i.props,l=o.interactiveBorder,u=tie(s.placement),c=s.modifiersData.offset;if(!c)return!0;var h=u==="bottom"?c.top.y:0,p=u==="top"?c.bottom.y:0,v=u==="right"?c.left.x:0,y=u==="left"?c.right.x:0,S=a.top-n+h>l,w=n-a.bottom-p>l,T=a.left-r+v>l,_=r-a.right-y>l;return S||w||T||_})}function CS(t,e,r){var n=e+"EventListener";["transitionend","webkitTransitionEnd"].forEach(function(i){t[n](i,r)})}function nM(t,e){for(var r=e;r;){var n;if(t.contains(r))return!0;r=r.getRootNode==null||(n=r.getRootNode())==null?void 0:n.host}return!1}var Su={isTouch:!1},iM=0;function lie(){Su.isTouch||(Su.isTouch=!0,window.performance&&document.addEventListener("mousemove",xD))}function xD(){var t=performance.now();t-iM<20&&(Su.isTouch=!1,document.removeEventListener("mousemove",xD)),iM=t}function uie(){var t=document.activeElement;if(iie(t)){var e=t._tippy;t.blur&&!e.state.isVisible&&t.blur()}}function cie(){document.addEventListener("touchstart",lie,Zh),window.addEventListener("blur",uie)}var die=typeof window<"u"&&typeof document<"u",hie=die?!!window.msCrypto:!1,fie={animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},pie={allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999},Al=Object.assign({appendTo:vD,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},fie,pie),mie=Object.keys(Al),gie=function(e){var r=Object.keys(e);r.forEach(function(n){Al[n]=e[n]})};function bD(t){var e=t.plugins||[],r=e.reduce(function(n,i){var a=i.name,s=i.defaultValue;if(a){var o;n[a]=t[a]!==void 0?t[a]:(o=Al[a])!=null?o:s}return n},{});return Object.assign({},t,r)}function vie(t,e){var r=e?Object.keys(bD(Object.assign({},Al,{plugins:e}))):mie,n=r.reduce(function(i,a){var s=(t.getAttribute("data-tippy-"+a)||"").trim();if(!s)return i;if(a==="content")i[a]=s;else try{i[a]=JSON.parse(s)}catch{i[a]=s}return i},{});return n}function aM(t,e){var r=Object.assign({},e,{content:yD(e.content,[t])},e.ignoreAttributes?{}:vie(t,e.plugins));return r.aria=Object.assign({},Al.aria,r.aria),r.aria={expanded:r.aria.expanded==="auto"?e.interactive:r.aria.expanded,content:r.aria.content==="auto"?e.interactive?null:"describedby":r.aria.content},r}var yie=function(){return"innerHTML"};function Uk(t,e){t[yie()]=e}function sM(t){var e=mv();return t===!0?e.className=mD:(e.className=gD,sb(t)?e.appendChild(t):Uk(e,t)),e}function oM(t,e){sb(e.content)?(Uk(t,""),t.appendChild(e.content)):typeof e.content!="function"&&(e.allowHTML?Uk(t,e.content):t.textContent=e.content)}function Gk(t){var e=t.firstElementChild,r=g1(e.children);return{box:e,content:r.find(function(n){return n.classList.contains(pD)}),arrow:r.find(function(n){return n.classList.contains(mD)||n.classList.contains(gD)}),backdrop:r.find(function(n){return n.classList.contains(Qne)})}}function wD(t){var e=mv(),r=mv();r.className=Xne,r.setAttribute("data-state","hidden"),r.setAttribute("tabindex","-1");var n=mv();n.className=pD,n.setAttribute("data-state","hidden"),oM(n,t.props),e.appendChild(r),r.appendChild(n),i(t.props,t.props);function i(a,s){var o=Gk(e),l=o.box,u=o.content,c=o.arrow;s.theme?l.setAttribute("data-theme",s.theme):l.removeAttribute("data-theme"),typeof s.animation=="string"?l.setAttribute("data-animation",s.animation):l.removeAttribute("data-animation"),s.inertia?l.setAttribute("data-inertia",""):l.removeAttribute("data-inertia"),l.style.maxWidth=typeof s.maxWidth=="number"?s.maxWidth+"px":s.maxWidth,s.role?l.setAttribute("role",s.role):l.removeAttribute("role"),(a.content!==s.content||a.allowHTML!==s.allowHTML)&&oM(u,t.props),s.arrow?c?a.arrow!==s.arrow&&(l.removeChild(c),l.appendChild(sM(s.arrow))):l.appendChild(sM(s.arrow)):c&&l.removeChild(c)}return{popper:e,onUpdate:i}}wD.$$tippy=!0;var xie=1,Ly=[],ES=[];function bie(t,e){var r=aM(t,Object.assign({},Al,bD(tM(e)))),n,i,a,s=!1,o=!1,l=!1,u=!1,c,h,p,v=[],y=JP(Ve,r.interactiveDebounce),S,w=xie++,T=null,_=eie(r.plugins),C={isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},N={id:w,reference:t,popper:mv(),popperInstance:T,props:r,state:C,plugins:_,clearDelayTimeouts:gt,setProps:yt,setContent:jt,show:qt,hide:wt,hideWithInteractivity:ft,enable:Ke,disable:mt,unmount:qe,destroy:ce};if(!r.render)return N;var A=r.render(N),I=A.popper,j=A.onUpdate;I.setAttribute("data-tippy-root",""),I.id="tippy-"+N.id,N.popper=I,t._tippy=N,I._tippy=N;var O=_.map(function(ve){return ve.fn(N)}),F=t.hasAttribute("aria-expanded");return me(),re(),Y(),Q("onCreate",[N]),r.showOnCreate&&Ce(),I.addEventListener("mouseenter",function(){N.props.interactive&&N.state.isVisible&&N.clearDelayTimeouts()}),I.addEventListener("mouseleave",function(){N.props.interactive&&N.props.trigger.indexOf("mouseenter")>=0&&H().addEventListener("mousemove",y)}),N;function B(){var ve=N.props.touch;return Array.isArray(ve)?ve:[ve,0]}function $(){return B()[0]==="hold"}function Z(){var ve;return!!((ve=N.props.render)!=null&&ve.$$tippy)}function D(){return S||t}function H(){var ve=D().parentNode;return ve?sie(ve):document}function U(){return Gk(I)}function W(ve){return N.state.isMounted&&!N.state.isVisible||Su.isTouch||c&&c.type==="focus"?0:kS(N.props.delay,ve?0:1,Al.delay)}function Y(ve){ve===void 0&&(ve=!1),I.style.pointerEvents=N.props.interactive&&!ve?"":"none",I.style.zIndex=""+N.props.zIndex}function Q(ve,ke,Te){if(Te===void 0&&(Te=!0),O.forEach(function(Je){Je[ve]&&Je[ve].apply(Je,ke)}),Te){var Re;(Re=N.props)[ve].apply(Re,ke)}}function ne(){var ve=N.props.aria;if(ve.content){var ke="aria-"+ve.content,Te=I.id,Re=Ap(N.props.triggerTarget||t);Re.forEach(function(Je){var ze=Je.getAttribute(ke);if(N.state.isVisible)Je.setAttribute(ke,ze?ze+" "+Te:Te);else{var vt=ze&&ze.replace(Te,"").trim();vt?Je.setAttribute(ke,vt):Je.removeAttribute(ke)}})}}function re(){if(!(F||!N.props.aria.expanded)){var ve=Ap(N.props.triggerTarget||t);ve.forEach(function(ke){N.props.interactive?ke.setAttribute("aria-expanded",N.state.isVisible&&ke===D()?"true":"false"):ke.removeAttribute("aria-expanded")})}}function q(){H().removeEventListener("mousemove",y),Ly=Ly.filter(function(ve){return ve!==y})}function te(ve){if(!(Su.isTouch&&(l||ve.type==="mousedown"))){var ke=ve.composedPath&&ve.composedPath()[0]||ve.target;if(!(N.props.interactive&&nM(I,ke))){if(Ap(N.props.triggerTarget||t).some(function(Te){return nM(Te,ke)})){if(Su.isTouch||N.state.isVisible&&N.props.trigger.indexOf("click")>=0)return}else Q("onClickOutside",[N,ve]);N.props.hideOnClick===!0&&(N.clearDelayTimeouts(),N.hide(),o=!0,setTimeout(function(){o=!1}),N.state.isMounted||ye())}}}function ae(){l=!0}function de(){l=!1}function ge(){var ve=H();ve.addEventListener("mousedown",te,!0),ve.addEventListener("touchend",te,Zh),ve.addEventListener("touchstart",de,Zh),ve.addEventListener("touchmove",ae,Zh)}function ye(){var ve=H();ve.removeEventListener("mousedown",te,!0),ve.removeEventListener("touchend",te,Zh),ve.removeEventListener("touchstart",de,Zh),ve.removeEventListener("touchmove",ae,Zh)}function se(ve,ke){le(ve,function(){!N.state.isVisible&&I.parentNode&&I.parentNode.contains(I)&&ke()})}function fe(ve,ke){le(ve,ke)}function le(ve,ke){var Te=U().box;function Re(Je){Je.target===Te&&(CS(Te,"remove",Re),ke())}if(ve===0)return ke();CS(Te,"remove",h),CS(Te,"add",Re),h=Re}function pe(ve,ke,Te){Te===void 0&&(Te=!1);var Re=Ap(N.props.triggerTarget||t);Re.forEach(function(Je){Je.addEventListener(ve,ke,Te),v.push({node:Je,eventType:ve,handler:ke,options:Te})})}function me(){$()&&(pe("touchstart",Se,{passive:!0}),pe("touchend",$e,{passive:!0})),Jne(N.props.trigger).forEach(function(ve){if(ve!=="manual")switch(pe(ve,Se),ve){case"mouseenter":pe("mouseleave",$e);break;case"focus":pe(hie?"focusout":"blur",St);break;case"focusin":pe("focusout",St);break}})}function xe(){v.forEach(function(ve){var ke=ve.node,Te=ve.eventType,Re=ve.handler,Je=ve.options;ke.removeEventListener(Te,Re,Je)}),v=[]}function Se(ve){var ke,Te=!1;if(!(!N.state.isEnabled||rt(ve)||o)){var Re=((ke=c)==null?void 0:ke.type)==="focus";c=ve,S=ve.currentTarget,re(),!N.state.isVisible&&nie(ve)&&Ly.forEach(function(Je){return Je(ve)}),ve.type==="click"&&(N.props.trigger.indexOf("mouseenter")<0||s)&&N.props.hideOnClick!==!1&&N.state.isVisible?Te=!0:Ce(ve),ve.type==="click"&&(s=!Te),Te&&!Re&&Fe(ve)}}function Ve(ve){var ke=ve.target,Te=D().contains(ke)||I.contains(ke);if(!(ve.type==="mousemove"&&Te)){var Re=Qe().concat(I).map(function(Je){var ze,vt=Je._tippy,pt=(ze=vt.popperInstance)==null?void 0:ze.state;return pt?{popperRect:Je.getBoundingClientRect(),popperState:pt,props:r}:null}).filter(Boolean);oie(Re,ve)&&(q(),Fe(ve))}}function $e(ve){var ke=rt(ve)||N.props.trigger.indexOf("click")>=0&&s;if(!ke){if(N.props.interactive){N.hideWithInteractivity(ve);return}Fe(ve)}}function St(ve){N.props.trigger.indexOf("focusin")<0&&ve.target!==D()||N.props.interactive&&ve.relatedTarget&&I.contains(ve.relatedTarget)||Fe(ve)}function rt(ve){return Su.isTouch?$()!==ve.type.indexOf("touch")>=0:!1}function lt(){De();var ve=N.props,ke=ve.popperOptions,Te=ve.placement,Re=ve.offset,Je=ve.getReferenceClientRect,ze=ve.moveTransition,vt=Z()?Gk(I).arrow:null,pt=Je?{getBoundingClientRect:Je,contextElement:Je.contextElement||D()}:t,At={name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(Ct){var Yt=Ct.state;if(Z()){var Xt=U(),Lr=Xt.box;["placement","reference-hidden","escaped"].forEach(function(ar){ar==="placement"?Lr.setAttribute("data-placement",Yt.placement):Yt.attributes.popper["data-popper-"+ar]?Lr.setAttribute("data-"+ar,""):Lr.removeAttribute("data-"+ar)}),Yt.attributes.popper={}}}},Ut=[{name:"offset",options:{offset:Re}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!ze}},At];Z()&&vt&&Ut.push({name:"arrow",options:{element:vt,padding:3}}),Ut.push.apply(Ut,ke?.modifiers||[]),N.popperInstance=Yne(pt,I,Object.assign({},ke,{placement:Te,onFirstUpdate:p,modifiers:Ut}))}function De(){N.popperInstance&&(N.popperInstance.destroy(),N.popperInstance=null)}function Le(){var ve=N.props.appendTo,ke,Te=D();N.props.interactive&&ve===vD||ve==="parent"?ke=Te.parentNode:ke=yD(ve,[Te]),ke.contains(I)||ke.appendChild(I),N.state.isMounted=!0,lt()}function Qe(){return g1(I.querySelectorAll("[data-tippy-root]"))}function Ce(ve){N.clearDelayTimeouts(),ve&&Q("onTrigger",[N,ve]),ge();var ke=W(!0),Te=B(),Re=Te[0],Je=Te[1];Su.isTouch&&Re==="hold"&&Je&&(ke=Je),ke?n=setTimeout(function(){N.show()},ke):N.show()}function Fe(ve){if(N.clearDelayTimeouts(),Q("onUntrigger",[N,ve]),!N.state.isVisible){ye();return}if(!(N.props.trigger.indexOf("mouseenter")>=0&&N.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(ve.type)>=0&&s)){var ke=W(!1);ke?i=setTimeout(function(){N.state.isVisible&&N.hide()},ke):a=requestAnimationFrame(function(){N.hide()})}}function Ke(){N.state.isEnabled=!0}function mt(){N.hide(),N.state.isEnabled=!1}function gt(){clearTimeout(n),clearTimeout(i),cancelAnimationFrame(a)}function yt(ve){if(!N.state.isDestroyed){Q("onBeforeUpdate",[N,ve]),xe();var ke=N.props,Te=aM(t,Object.assign({},ke,tM(ve),{ignoreAttributes:!0}));N.props=Te,me(),ke.interactiveDebounce!==Te.interactiveDebounce&&(q(),y=JP(Ve,Te.interactiveDebounce)),ke.triggerTarget&&!Te.triggerTarget?Ap(ke.triggerTarget).forEach(function(Re){Re.removeAttribute("aria-expanded")}):Te.triggerTarget&&t.removeAttribute("aria-expanded"),re(),Y(),j&&j(ke,Te),N.popperInstance&&(lt(),Qe().forEach(function(Re){requestAnimationFrame(Re._tippy.popperInstance.forceUpdate)})),Q("onAfterUpdate",[N,ve])}}function jt(ve){N.setProps({content:ve})}function qt(){var ve=N.state.isVisible,ke=N.state.isDestroyed,Te=!N.state.isEnabled,Re=Su.isTouch&&!N.props.touch,Je=kS(N.props.duration,0,Al.duration);if(!(ve||ke||Te||Re)&&!D().hasAttribute("disabled")&&(Q("onShow",[N],!1),N.props.onShow(N)!==!1)){if(N.state.isVisible=!0,Z()&&(I.style.visibility="visible"),Y(),ge(),N.state.isMounted||(I.style.transition="none"),Z()){var ze=U(),vt=ze.box,pt=ze.content;_S([vt,pt],0)}p=function(){var Ut;if(!(!N.state.isVisible||u)){if(u=!0,I.offsetHeight,I.style.transition=N.props.moveTransition,Z()&&N.props.animation){var Kt=U(),Ct=Kt.box,Yt=Kt.content;_S([Ct,Yt],Je),rM([Ct,Yt],"visible")}ne(),re(),eM(ES,N),(Ut=N.popperInstance)==null||Ut.forceUpdate(),Q("onMount",[N]),N.props.animation&&Z()&&fe(Je,function(){N.state.isShown=!0,Q("onShown",[N])})}},Le()}}function wt(){var ve=!N.state.isVisible,ke=N.state.isDestroyed,Te=!N.state.isEnabled,Re=kS(N.props.duration,1,Al.duration);if(!(ve||ke||Te)&&(Q("onHide",[N],!1),N.props.onHide(N)!==!1)){if(N.state.isVisible=!1,N.state.isShown=!1,u=!1,s=!1,Z()&&(I.style.visibility="hidden"),q(),ye(),Y(!0),Z()){var Je=U(),ze=Je.box,vt=Je.content;N.props.animation&&(_S([ze,vt],Re),rM([ze,vt],"hidden"))}ne(),re(),N.props.animation?Z()&&se(Re,N.unmount):N.unmount()}}function ft(ve){H().addEventListener("mousemove",y),eM(Ly,y),y(ve)}function qe(){N.state.isVisible&&N.hide(),N.state.isMounted&&(De(),Qe().forEach(function(ve){ve._tippy.unmount()}),I.parentNode&&I.parentNode.removeChild(I),ES=ES.filter(function(ve){return ve!==N}),N.state.isMounted=!1,Q("onHidden",[N]))}function ce(){N.state.isDestroyed||(N.clearDelayTimeouts(),N.unmount(),xe(),delete t._tippy,N.state.isDestroyed=!0,Q("onDestroy",[N]))}}function g0(t,e){e===void 0&&(e={});var r=Al.plugins.concat(e.plugins||[]);cie();var n=Object.assign({},e,{plugins:r}),i=aie(t),a=i.reduce(function(s,o){var l=o&&bie(o,n);return l&&s.push(l),s},[]);return sb(t)?a[0]:a}g0.defaultProps=Al;g0.setDefaultProps=gie;g0.currentInput=Su;Object.assign({},sD,{effect:function(e){var r=e.state,n={popper:{position:r.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(r.elements.popper.style,n.popper),r.styles=n,r.elements.arrow&&Object.assign(r.elements.arrow.style,n.arrow)}});g0.setDefaultProps({render:wD});const wie=ie.forwardRef((t,e)=>{const[r,n]=ie.useState(0),i=l=>{const u=t.items[l];u&&t.command({id:u.id,label:u.label})},a=()=>{n((r+t.items.length-1)%t.items.length)},s=()=>{n((r+1)%t.items.length)},o=()=>{i(r)};return ie.useEffect(()=>n(0),[t.items]),ie.useImperativeHandle(e,()=>({onKeyDown:({event:l})=>l.key==="ArrowUp"?(a(),!0):l.key==="ArrowDown"?(s(),!0):l.key==="Enter"?(o(),!0):!1})),m.jsx("div",{className:"items bg-white border border-slate-200 rounded-xl shadow-2xl overflow-hidden min-w-[200px] p-2 animate-in zoom-in-95 duration-200",children:t.items.length?t.items.map((l,u)=>m.jsxs("button",{className:`flex w-full items-center text-xs px-4 py-2.5 rounded-lg outline-none text-left transition-all ${u===r?"bg-primary text-white shadow-lg":"text-slate-700 hover:bg-slate-50"}`,onClick:()=>i(u),children:[m.jsx("span",{className:"material-symbols-outlined text-[14px] mr-2 opacity-50",children:"auto_stories"}),m.jsx("span",{className:"font-serif font-bold",children:l.label})]},u)):m.jsx("div",{className:"item text-sm px-2 py-1.5 text-muted-foreground",children:"No result"})})}),Sie={items:async({query:t})=>{try{return(await et.get("/world-bible/entities")).filter(r=>r.nombre.toLowerCase().startsWith(t.toLowerCase())).slice(0,5).map(r=>({id:r.id,label:r.nombre}))}catch(e){return console.error(e),[]}},render:()=>{let t,e;return{onStart:r=>{t=new rte(wie,{props:r,editor:r.editor}),r.clientRect&&(e=g0("body",{getReferenceClientRect:r.clientRect,appendTo:()=>document.body,content:t.element,showOnCreate:!0,interactive:!0,trigger:"manual",placement:"bottom-start"}))},onUpdate(r){t.updateProps(r),r.clientRect&&e[0].setProps({getReferenceClientRect:r.clientRect})},onKeyDown(r){return r.event.key==="Escape"?(e[0].hide(),!0):t.ref?.onKeyDown(r)},onExit(){e[0].destroy(),t.destroy()}}}},kie=({content:t,onUpdate:e,editable:r=!0,paperMode:n=!1})=>{const[i,a]=nr.useState({font:"Cormorant Garamond",fontSize:18});nr.useEffect(()=>{const o=localStorage.getItem("app_settings");o&&a(JSON.parse(o))},[]);const s=Zee({extensions:[Fre,Bre.configure({placeholder:"Escribe tu historia aqu... Usa @ para mencionar entidades."}),Wre.configure({HTMLAttributes:{class:"mention"},suggestion:Sie})],content:t,editable:r,onUpdate:({editor:o})=>{e(o.getHTML())},editorProps:{attributes:{class:`prose ${n?"prose-slate":"prose-invert"} max-w-none focus:outline-none min-h-[300px] p-8 ${n?"text-slate-900":"text-foreground/90"} leading-relaxed text-lg transition-all`,style:`font-family: "${i.font}", serif; font-size: ${i.fontSize}px;`}}});return ie.useEffect(()=>{s&&t!==s.getHTML()&&s.commands.setContent(t)},[t,s]),s?m.jsx("div",{className:`zen-editor-container w-full h-full overflow-y-auto no-scrollbar ${n?"bg-transparent border-none shadow-none":"bg-card/20 rounded-lg border border-border/50"}`,children:m.jsx(Gee,{editor:s,className:"h-full"})}):null},_ie=()=>{const{notebookId:t}=Zi(),e=Wa(),{setRightPanelMode:r,setRightOpen:n,setRightPanelTitle:i}=jl(),{t:a}=bc(),[s,o]=ie.useState(null),[l,u]=ie.useState([]),[c,h]=ie.useState(0),[p,v]=ie.useState(!1),[y,S]=ie.useState(!0),w=ie.useRef(null),T=ie.useRef(l),_=ie.useRef(c),C=ie.useRef(!0);ie.useEffect(()=>{T.current=l},[l]),ie.useEffect(()=>{_.current=c},[c]);const[N,A]=ie.useState(null),[I,j]=ie.useState("index");ie.useEffect(()=>{r("CUSTOM"),n(!0),i(a("writing.tools")),t&&O(t)},[t]),ie.useEffect(()=>{const W=setInterval(()=>{const Y=document.getElementById("architect-right-panel-portal");Y&&(A(Y),clearInterval(W))},100);return()=>clearInterval(W)},[]),ie.useEffect(()=>{C.current=!0;const W=Y=>{w.current&&(Y.preventDefault(),Y.returnValue="")};return window.addEventListener("beforeunload",W),()=>{if(C.current=!1,window.removeEventListener("beforeunload",W),w.current){clearTimeout(w.current);const Y=T.current[_.current];Y&&(console.log("Saving on unmount (keepalive):",Y.id),et.request(`/escritura/hoja/${Y.id}`,{method:"PUT",body:JSON.stringify({contenido:Y.contenido}),keepalive:!0}).catch(Q=>console.error("Error preventing data loss:",Q)))}}},[]);const O=async W=>{try{S(!0);const Y=await et.get(`/escritura/cuaderno/${W}`);o(Y);const Q=await et.get(`/escritura/cuaderno/${W}/hojas`);if(Q&&Q.length>0)u(Q),h(0);else{const ne=await et.post(`/escritura/cuaderno/${W}/hoja`,{});u([ne]),h(0)}}catch(Y){console.error("Error loading notebook/pages:",Y),e(-1)}finally{S(!1)}},F=W=>{if(!l[c])return;const Y=[...l];Y[c].contenido=W,u(Y),w.current&&clearTimeout(w.current),w.current=setTimeout(()=>{B(Y[c])},800)},B=async W=>{C.current&&v(!0);try{await et.put(`/escritura/hoja/${W.id}`,{contenido:W.contenido})}catch(Y){console.error("Error saving page:",Y)}finally{C.current&&v(!1)}},$=async()=>{if(s)try{const W=await et.post(`/escritura/cuaderno/${s.id}/hoja`,{});u([...l,W]),h(l.length)}catch(W){console.error("Error creating page:",W)}},Z=W=>{h(W)},D=async(W,Y,Q)=>{if(W.stopPropagation(),l.length<=1){alert(a("writing.one_page_error"));return}if(window.confirm(a("writing.delete_page_confirm")))try{await et.delete(`/escritura/hoja/${Y}`);const ne=l.filter(re=>re.id!==Y);u(ne),c===Q?h(Math.max(0,Q-1)):c>Q&&h(c-1)}catch(ne){console.error("Error deleting page:",ne)}},H=()=>m.jsxs("div",{className:"flex flex-col h-full bg-surface-dark/95",children:[m.jsxs("div",{className:"p-4 border-b border-white/5 flex items-center justify-between bg-black/40",children:[m.jsxs("button",{onClick:()=>e(`/${Zi().username}/${Zi().projectName}/writing`),className:"flex items-center gap-2 text-slate-400 hover:text-white transition-colors",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"arrow_back"}),m.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest",children:a("nav.writing")})]}),m.jsx("div",{className:`w-2 h-2 rounded-full ${p?"bg-amber-500 animate-pulse":"bg-emerald-500/50"}`,title:a(p?"common.saving":"common.saved")})]}),m.jsxs("div",{className:"flex p-2 gap-2 border-b border-white/5 bg-black/20",children:[m.jsx("button",{onClick:()=>j("index"),className:`flex-1 py-2 rounded-xl text-[10px] font-black uppercase tracking-widest transition-all ${I==="index"?"bg-primary text-white shadow-lg":"text-slate-500 hover:text-white"}`,children:a("writing.index")}),m.jsx("button",{onClick:()=>j("format"),className:`flex-1 py-2 rounded-xl text-[10px] font-black uppercase tracking-widest transition-all ${I==="format"?"bg-primary text-white shadow-lg":"text-slate-500 hover:text-white"}`,children:a("writing.format")})]}),m.jsx("div",{className:"flex-1 overflow-hidden",children:I==="index"?m.jsxs("div",{className:"flex flex-col h-full",children:[m.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-2 custom-scrollbar",children:l.map((W,Y)=>m.jsxs("div",{className:"group relative",children:[m.jsxs("button",{onClick:()=>Z(Y),className:`w-full text-left p-4 rounded-2xl border transition-all ${Y===c?"bg-primary/10 border-primary/30 text-primary":"bg-white/5 border-transparent hover:bg-white/10 text-slate-400"}`,children:[m.jsxs("div",{className:"flex justify-between items-center mb-1",children:[m.jsxs("span",{className:"font-serif font-bold text-sm truncate",children:[a("writing.page")," ",Y+1]}),Y===c&&m.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-primary shrink-0 ml-2"})]}),m.jsx("p",{className:"text-[10px] line-clamp-2 opacity-50 font-mono break-words leading-relaxed",children:W.contenido?.replace(/<[^>]+>/g,"").substring(0,40)||a("writing.empty")})]}),m.jsx("button",{onClick:Q=>D(Q,W.id,Y),className:"absolute top-2 right-2 p-1.5 rounded-lg text-slate-600 hover:text-red-400 hover:bg-red-400/10 transition-all opacity-0 group-hover:opacity-100",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})})]},W.id))}),m.jsx("div",{className:"p-4 bg-black/20 border-t border-white/5",children:m.jsxs("button",{onClick:$,className:"w-full py-3 bg-primary text-white rounded-2xl text-[10px] font-black uppercase tracking-widest flex items-center justify-center gap-2 transition-all hover:scale-[1.02] shadow-xl shadow-primary/20",children:[m.jsx("span",{className:"material-symbols-outlined text-base",children:"add"}),m.jsx("span",{children:a("writing.new_page")})]})})]}):m.jsx("div",{className:"p-6 space-y-8 animate-in fade-in slide-in-from-right-4",children:m.jsxs("div",{className:"space-y-4",children:[m.jsxs("h3",{className:"text-[10px] font-black uppercase tracking-widest text-slate-500 flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"format_size"})," ",a("writing.typography")]}),m.jsx("div",{className:"grid grid-cols-1 gap-2",children:m.jsx("p",{className:"text-[9px] text-slate-600 uppercase font-bold italic",children:a("writing.typography_desc")})})]})})})]}),U=l[c];return y?m.jsx("div",{className:"flex-1 flex items-center justify-center bg-background-dark",children:m.jsx("div",{className:"animate-pulse text-slate-500 font-serif text-2xl italic tracking-widest",children:a("writing.opening_chronicle")})}):m.jsxs("div",{className:"flex-1 flex w-full h-full bg-background-dark relative overflow-hidden font-sans",children:[N&&Il.createPortal(H(),N),m.jsx("div",{className:"flex-1 flex flex-col relative z-10 overflow-hidden",children:m.jsx("main",{className:"flex-1 overflow-y-auto custom-scrollbar flex justify-center bg-transparent relative no-scrollbar",children:U&&m.jsx("div",{className:"w-full min-h-full flex flex-col animate-in slide-in-from-bottom-8 duration-700",children:m.jsxs("div",{className:"flex-1 bg-white overflow-hidden flex flex-col transition-all duration-500 group",children:[m.jsx("div",{className:"h-24 flex items-end px-16 pb-4 border-b border-slate-50",children:m.jsx("input",{type:"text",className:"w-full bg-transparent text-4xl font-serif font-black text-slate-800 placeholder:text-slate-100 border-none outline-none",defaultValue:`${a("writing.chapter")} ${c+1}`,placeholder:a("writing.title_placeholder")})}),m.jsx("div",{className:"flex-1 px-16 py-12 text-slate-900",children:m.jsx(kie,{content:U.contenido,onUpdate:F,paperMode:!0})}),m.jsxs("footer",{className:"h-16 border-t border-slate-100 flex items-center justify-between px-16 text-[10px] font-mono text-slate-400 select-none",children:[m.jsxs("span",{children:[a("writing.page").toUpperCase()," ",c+1," ",a("writing.of")," ",l.length]}),m.jsx("span",{className:"opacity-0 group-hover:opacity-100 transition-opacity uppercase font-black tracking-widest",children:s?.titulo||a("common.no_results")})]})]})})})})]})},Cie=()=>{const{username:t,projectName:e}=Zi(),r=Wa(),{t:n}=bc(),{setRightPanelMode:i,setRightOpen:a,setRightPanelTitle:s}=jl(),[o,l]=ie.useState([]),[u,c]=ie.useState(!0),[h,p]=ie.useState(!1),[v,y]=ie.useState("");ie.useEffect(()=>{i("NOTES"),a(!1),s(n("writing.library")),S()},[]);const S=async()=>{try{c(!0);const _=await et.get("/escritura/cuadernos");l(_||[])}catch(_){console.error("Error loading notebooks:",_)}finally{c(!1)}},w=async _=>{_.preventDefault();try{const C=await et.post("/escritura/cuaderno",{titulo:v||n("writing.new_notebook")});l([...o,C]),p(!1),y(""),r(`/${t}/${e}/writing/${C.id}`)}catch(C){console.error("Error creating notebook:",C)}},T=async(_,C)=>{if(_.stopPropagation(),!!window.confirm(n("writing.delete_confirm")))try{await et.delete(`/escritura/cuaderno/${C}`),l(o.filter(N=>N.id!==C))}catch(N){console.error("Error deleting notebook:",N)}};return u?m.jsx("div",{className:"flex-1 flex items-center justify-center bg-background-dark",children:m.jsx("div",{className:"animate-spin text-primary material-symbols-outlined text-4xl",children:"sync"})}):m.jsxs("div",{className:"flex-1 flex flex-col bg-background-dark overflow-y-auto no-scrollbar p-12",children:[m.jsxs("header",{className:"mb-12 flex justify-between items-end",children:[m.jsxs("div",{children:[m.jsx("h1",{className:"text-4xl font-serif font-bold text-white mb-2",children:n("writing.library")}),m.jsx("p",{className:"text-slate-500 uppercase text-[10px] font-black tracking-[0.2em]",children:n("writing.library_desc")})]}),m.jsx("button",{onClick:()=>p(!0),className:"group relative px-6 py-3 bg-primary/10 hover:bg-primary/20 border border-primary/30 rounded-2xl transition-all overflow-hidden",children:m.jsxs("div",{className:"flex items-center gap-2 text-primary",children:[m.jsx("span",{className:"material-symbols-outlined text-sm transition-transform group-hover:rotate-90",children:"add"}),m.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest",children:n("writing.new_notebook")})]})})]}),m.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:o.map(_=>m.jsxs("div",{onClick:()=>r(`/${t}/${e}/writing/${_.id}`),className:"group relative h-64 bg-surface-dark border border-white/5 rounded-3xl p-6 cursor-pointer hover:border-primary/50 hover:bg-white/[0.02] transition-all hover:-translate-y-2 flex flex-col justify-between overflow-hidden shadow-2xl",children:[m.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-1.5 bg-primary/40 group-hover:bg-primary transition-colors"}),m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{className:"flex justify-between items-start",children:[m.jsx("div",{className:"size-10 rounded-xl bg-primary/10 flex items-center justify-center text-primary group-hover:scale-110 transition-transform",children:m.jsx("span",{className:"material-symbols-outlined",children:"folder_open"})}),m.jsx("button",{onClick:C=>T(C,_.id),className:"p-1.5 rounded-lg text-slate-600 hover:text-red-400 hover:bg-red-400/10 transition-all opacity-0 group-hover:opacity-100",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})})]}),m.jsxs("div",{children:[m.jsx("h3",{className:"text-xl font-serif font-bold text-slate-100 group-hover:text-primary transition-colors line-clamp-2",children:_.titulo||n("common.no_results")}),m.jsxs("p",{className:"text-[10px] text-slate-500 font-mono mt-1",children:["ID: #",_.id]})]})]}),m.jsxs("div",{className:"flex items-center gap-2 pt-4 border-t border-white/5 opacity-50 group-hover:opacity-100 transition-opacity",children:[m.jsx("span",{className:"material-symbols-outlined text-sm text-primary",children:"auto_stories"}),m.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest text-slate-400",children:n("writing.open_archivador")})]})]},_.id))}),h&&m.jsx("div",{className:"fixed inset-0 z-[100] bg-black/80 backdrop-blur-sm flex items-center justify-center p-4",children:m.jsxs("div",{className:"bg-surface-dark border border-white/10 rounded-[2rem] p-10 w-full max-w-lg shadow-2xl animate-in zoom-in-95 duration-300",children:[m.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[m.jsx("div",{className:"size-12 rounded-2xl bg-primary flex items-center justify-center text-white shadow-xl shadow-primary/30",children:m.jsx("span",{className:"material-symbols-outlined",children:"create_new_folder"})}),m.jsxs("div",{children:[m.jsx("h2",{className:"text-2xl font-serif font-bold text-white",children:"New Archivador"}),m.jsx("p",{className:"text-[10px] text-slate-500 uppercase font-black tracking-widest",children:"Library Expansion"})]})]}),m.jsxs("form",{onSubmit:w,className:"space-y-6",children:[m.jsxs("div",{className:"space-y-2",children:[m.jsx("label",{className:"text-[10px] uppercase font-black text-slate-500 tracking-[0.2em] ml-2",children:"Book Title"}),m.jsx("input",{autoFocus:!0,className:"w-full bg-white/5 border border-white/10 rounded-2xl px-6 py-4 text-white focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all placeholder:text-slate-700",placeholder:"The Chronicles of Void...",value:v,onChange:_=>y(_.target.value),required:!0})]}),m.jsxs("div",{className:"flex gap-4 pt-4",children:[m.jsx("button",{type:"button",onClick:()=>p(!1),className:"flex-1 py-4 text-slate-400 hover:text-white font-black uppercase text-[10px] tracking-widest transition-colors",children:"Cancel"}),m.jsx("button",{type:"submit",className:"flex-[2] py-4 bg-primary hover:bg-primary-dark text-white rounded-2xl font-black uppercase text-[10px] tracking-widest shadow-xl shadow-primary/20 hover:scale-[1.02] active:scale-95 transition-all",children:"Create and Open"})]})]})]})})]})};function Eie(){const{id:t}=Zi();Wa();const[e,r]=ie.useState([]),[n,i]=ie.useState(!0),[a,s]=ie.useState(null);ie.useEffect(()=>{o()},[t]);const o=async()=>{try{i(!0);const c=await et.get("/api/papelera/items");r(c),s(null)}catch(c){console.error("Error loading trash:",c),s("Failed to load trash items.")}finally{i(!1)}},l=async(c,h)=>{try{await et.post(`/api/papelera/restaurar/${c}/${h}`),o()}catch(p){console.error("Restoration failed",p)}},u=async(c,h)=>{if(window.confirm("Are you sure you want to PERMANENTLY delete this item? This cannot be undone."))try{await et.delete(`/api/papelera/eliminar/${c}/${h}`),o()}catch(p){console.error("Deletion failed",p)}};return n?m.jsx("div",{className:"text-white p-8",children:"Loading Trash Bin..."}):m.jsxs("div",{className:"flex flex-col h-full bg-[#09090b] text-white p-8 overflow-y-auto",children:[m.jsx("h1",{className:"text-3xl font-light mb-2 text-white/90",children:"Trash Bin"}),m.jsx("p",{className:"text-white/50 mb-8 font-light text-sm",children:"Items are automatically deleted after 30 days."}),a&&m.jsx("div",{className:"bg-red-500/10 border border-red-500/20 text-red-400 p-4 rounded mb-6",children:a}),e.length===0?m.jsxs("div",{className:"flex flex-col items-center justify-center py-20 opacity-50 border border-dashed border-white/10 rounded-xl",children:[m.jsx("span",{className:"material-symbols-outlined text-4xl mb-2",children:"delete_outline"}),m.jsx("p",{children:"Trash is empty"})]}):m.jsx("div",{className:"bg-zinc-900/50 rounded-xl border border-white/5 overflow-hidden",children:m.jsxs("table",{className:"w-full text-left border-collapse",children:[m.jsx("thead",{children:m.jsxs("tr",{className:"border-b border-white/5 text-xs text-white/40 uppercase tracking-wider",children:[m.jsx("th",{className:"p-4 font-normal",children:"Name"}),m.jsx("th",{className:"p-4 font-normal",children:"Type"}),m.jsx("th",{className:"p-4 font-normal",children:"Deleted Date"}),m.jsx("th",{className:"p-4 font-normal text-right",children:"Actions"})]})}),m.jsx("tbody",{className:"divide-y divide-white/5",children:e.map(c=>m.jsxs("tr",{className:"hover:bg-white/5 transition-colors",children:[m.jsx("td",{className:"p-4 text-white/80 font-medium",children:c.nombre||"Untitled"}),m.jsx("td",{className:"p-4 text-white/50 text-sm",children:c.tipo}),m.jsx("td",{className:"p-4 text-white/50 text-sm font-mono",children:c.deleted_date?new Date(c.deleted_date).toLocaleDateString():"-"}),m.jsxs("td",{className:"p-4 text-right space-x-2",children:[m.jsx("button",{onClick:()=>l(c.tipo,c.id),className:"px-3 py-1.5 text-xs bg-emerald-500/10 text-emerald-400 hover:bg-emerald-500/20 rounded-md transition-colors border border-emerald-500/20",children:"RESTORE"}),m.jsx("button",{onClick:()=>u(c.tipo,c.id),className:"px-3 py-1.5 text-xs bg-red-500/10 text-red-400 hover:bg-red-500/20 rounded-md transition-colors border border-red-500/20",children:"DELETE"})]})]},`${c.tipo}-${c.id}`))})]})})]})}const Tie=({attribute:t,value:e,onChange:r,onRemove:n,linkableEntities:i=[]})=>{const a=t.plantilla||t,s=()=>{switch(a.tipo){case"text":return m.jsx("textarea",{className:"w-full bg-transparent text-white text-sm font-medium focus:outline-none resize-none no-scrollbar h-auto min-h-[100px]",value:e||"",onChange:p=>r(p.target.value),placeholder:"..."});case"short_text":return m.jsx("input",{type:"text",className:"w-full bg-transparent text-white text-sm font-medium focus:outline-none",value:e||"",onChange:p=>r(p.target.value),placeholder:"..."});case"number":return m.jsx("input",{type:"number",className:"w-full bg-transparent text-white text-sm font-medium focus:outline-none",value:e||"",onChange:p=>r(p.target.value)});case"boolean":return m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsx("button",{onClick:()=>r(e==="true"?"false":"true"),className:`size-6 rounded-lg border flex items-center justify-center transition-all ${e==="true"?"bg-primary border-primary text-white":"border-glass-border text-transparent hover:border-primary/50"}`,children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"check"})}),m.jsx("span",{className:"text-xs text-text-muted",children:e==="true"?"Enabled":"Disabled"})]});case"select":let o=[];try{o=(typeof a.metadata=="string"?JSON.parse(a.metadata||"{}"):a.metadata||{}).options||[]}catch{}return m.jsxs("div",{className:"relative",children:[m.jsxs("select",{className:"w-full bg-black/30 border border-white/5 rounded-xl px-4 py-2.5 text-sm text-white focus:outline-none focus:border-primary/50 appearance-none cursor-pointer",value:e||"",onChange:p=>r(p.target.value),children:[m.jsx("option",{value:"",children:"Select an option..."}),o.map((p,v)=>m.jsx("option",{value:p,className:"bg-surface-dark text-white p-2",children:p},v))]}),m.jsx("div",{className:"absolute right-4 top-1/2 -translate-y-1/2 pointer-events-none text-white/50",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"unfold_more"})})]});case"multi_select":let l=[];try{l=(typeof a.metadata=="string"?JSON.parse(a.metadata||"{}"):a.metadata||{}).options||[]}catch{}let u=[];try{u=e?JSON.parse(e):[],Array.isArray(u)||(u=[])}catch(p){console.error("Error parsing select values",p)}const c=p=>{const v=u.includes(p)?u.filter(y=>y!==p):[...u,p];r(JSON.stringify(v))};return m.jsxs("div",{className:"bg-black/20 border border-white/5 rounded-xl p-2 space-y-1 max-h-40 overflow-y-auto custom-scrollbar",children:[l.map((p,v)=>m.jsxs("label",{onClick:y=>{y.preventDefault(),c(p)},className:"flex items-center gap-3 p-2 hover:bg-white/5 rounded-lg cursor-pointer group transition-colors",children:[m.jsx("div",{className:`size-4 rounded border flex items-center justify-center transition-all ${u.includes(p)?"bg-primary border-primary":"border-white/10 group-hover:border-white/30"}`,children:u.includes(p)&&m.jsx("span",{className:"material-symbols-outlined text-[10px] text-white",children:"check"})}),m.jsx("span",{className:`text-xs font-medium ${u.includes(p)?"text-white":"text-slate-400 group-hover:text-slate-200"}`,children:p})]},v)),l.length===0&&m.jsx("div",{className:"text-xs text-slate-500 p-2 italic",children:"No options defined."})]});case"date":return m.jsx("input",{type:"date",className:"w-full bg-transparent text-white text-sm font-medium focus:outline-none [color-scheme:dark]",value:e||"",onChange:p=>r(p.target.value)});case"entity_link":return m.jsxs("div",{className:"relative",children:[m.jsxs("select",{className:"w-full bg-black/30 border border-white/5 rounded-xl px-4 py-2.5 text-sm text-white focus:outline-none focus:border-primary/50 appearance-none cursor-pointer",value:e||"",onChange:p=>r(p.target.value),children:[m.jsx("option",{value:"",children:"Select an Entity Link..."}),i.map(p=>m.jsx("option",{value:p.id,className:"bg-surface-dark text-white p-2",children:p.nombre},p.id))]}),m.jsx("div",{className:"absolute right-4 top-1/2 -translate-y-1/2 pointer-events-none text-white/50",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"link"})})]});case"image":return m.jsxs("div",{className:"space-y-2",children:[m.jsx("div",{className:"flex gap-2",children:m.jsx("input",{type:"text",className:"flex-1 bg-black/30 border border-white/5 rounded-xl px-4 py-2 text-xs text-text-muted focus:text-white focus:outline-none",placeholder:"Image URL...",value:e||"",onChange:p=>r(p.target.value)})}),e&&m.jsx("div",{className:"w-full aspect-video rounded-xl bg-black/40 border border-white/5 overflow-hidden relative group",children:m.jsx("img",{src:e,alt:"Preview",className:"w-full h-full object-cover opacity-80 group-hover:opacity-100 transition-opacity"})}),!e&&m.jsx("div",{className:"w-full h-20 rounded-xl bg-white/5 border border-dashed border-white/10 flex items-center justify-center text-text-muted/30",children:m.jsx("span",{className:"material-symbols-outlined",children:"image"})})]});case"table":const h=e||"[]";return m.jsxs("div",{className:"space-y-2",children:[m.jsx("textarea",{className:"w-full h-32 bg-black/30 border border-white/5 rounded-xl p-3 text-xs font-mono text-white/70 focus:outline-none focus:border-primary/50",value:h,onChange:p=>r(p.target.value),placeholder:'[{"Item": "Sword", "Qty": 1}, ...]'}),m.jsxs("div",{className:"text-[10px] text-text-muted flex justify-between",children:[m.jsx("span",{children:"JSON Format supported"}),m.jsx("span",{className:"material-symbols-outlined text-xs",children:"data_array"})]})]});default:return m.jsxs("div",{className:"text-sm font-medium text-white/70 italic p-2 rounded-lg bg-white/5 border border-white/5",children:[m.jsx("span",{className:"text-[10px] uppercase font-bold text-slate-500 mr-2",children:a.tipo}),e]})}};return m.jsxs("div",{className:"p-4 border border-white/5 rounded-2xl bg-surface-dark/50 backdrop-blur-sm relative overflow-hidden h-full flex flex-col group hover:border-primary/20 transition-all",children:[m.jsxs("label",{className:"text-[10px] font-black uppercase tracking-widest text-text-muted mb-3 flex items-center justify-between gap-2",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-xs opacity-50",children:"label"}),a.nombre]}),n&&m.jsx("button",{onClick:o=>{o.preventDefault(),n()},className:"text-white/20 hover:text-red-400 transition-colors",title:"Remove Attribute",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"close"})})]}),m.jsx("div",{className:"flex-1 nodrag",children:s()}),m.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-primary/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none"})]})},Nie=[{value:"Individual",label:"Personaje"},{value:"Group",label:"Grupo/Faccin"},{value:"Location",label:"Lugar"},{value:"Item",label:"Objeto"},{value:"Event",label:"Evento"},{value:"Timeline",label:"Lnea de Tiempo"},{value:"Map",label:"Mapa"},{value:"Structure",label:"Construccin"},{value:"Creature",label:"Criatura"},{value:"Plant",label:"Flora"}],Pie=({entityId:t,entityType:e})=>{console.log(">>> RELATIONSHIP MANAGER V2 LOADED");const[r,n]=ie.useState([]),[i,a]=ie.useState(!1),[s,o]=ie.useState(!1),[l,u]=ie.useState("Individual"),[c,h]=ie.useState([]),[p,v]=ie.useState(""),[y,S]=ie.useState(""),[w,T]=ie.useState(""),[_,C]=ie.useState(!1);ie.useEffect(()=>{t&&N()},[t,e]),ie.useEffect(()=>{s&&l&&A(l)},[s,l]);const N=async()=>{a(!0);try{const B=(await et.get("/bd/relacion")).filter(Z=>Z.nodoOrigenId===parseInt(t)&&(Z.tipoOrigen===e||Z.tipoOrigen==="GenericEntity")||Z.nodoDestinoId===parseInt(t)&&(Z.tipoDestino===e||Z.tipoDestino==="GenericEntity")),$=await Promise.all(B.map(async Z=>{const D=Z.nodoOrigenId===parseInt(t),H=D?Z.nodoDestinoId:Z.nodoOrigenId,U=await et.get(`/world-bible/entities/${H}`);if(!U)throw new Error(`Entity ${H} not found`);return{...Z,otherName:U.nombre,otherType:U.categoria||"Entity",isOutgoing:D}}));n($)}catch(F){console.error("Failed to load relationships",F)}finally{a(!1)}},A=async F=>{C(!0);try{const $=(await et.get("/world-bible/entities")).filter(Z=>(Z.categoria||"Generic").toLowerCase()===F.toLowerCase()||Z.tipoEspecial&&Z.tipoEspecial.toLowerCase()===F.toLowerCase());h($||[])}catch(B){console.error("Failed to fetch targets",B),h([])}finally{C(!1)}},I=async()=>{if(!(!p||!y))try{const F={nodoOrigenId:parseInt(t),tipoOrigen:e,nodoDestinoId:parseInt(p),tipoDestino:"GenericEntity",tipoRelacion:y,descripcion:w,metadata:JSON.stringify({originalCategory:l}),tipoEntidad:"relacion"};await et.put("/bd/insertar",F),o(!1),O(),N()}catch(F){console.error("Failed to save relationship",F),alert("Error saving relationship")}},j=async F=>{if(confirm("Are you sure?"))try{await et.delete(`/bd/relacion/${F}`),N()}catch(B){console.error("Failed to delete",B)}},O=()=>{u("Individual"),v(""),S(""),T("")};return m.jsxs("div",{className:"p-6 space-y-6",children:[m.jsxs("header",{className:"flex justify-between items-center",children:[m.jsx("h3",{className:"text-lg font-bold text-white uppercase tracking-widest",children:"Relationships"}),m.jsx(Yn,{variant:"secondary",icon:"add_link",onClick:()=>o(!s),children:s?"Cancel":"Connect"})]}),s&&m.jsxs("div",{className:"p-4 rounded-2xl bg-white/5 border border-white/10 space-y-4 animate-in fade-in slide-in-from-top-4",children:[m.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[m.jsxs("div",{className:"space-y-1",children:[m.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-slate-500",children:"Target Type"}),m.jsx("select",{className:"w-full bg-black/40 border border-white/10 rounded-xl p-2 text-sm text-white outline-none focus:border-primary",value:l,onChange:F=>u(F.target.value),children:Nie.map(F=>m.jsx("option",{value:F.value,children:F.label},F.value))})]}),m.jsxs("div",{className:"space-y-1",children:[m.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-slate-500",children:"Target Entity"}),m.jsxs("select",{className:"w-full bg-black/40 border border-white/10 rounded-xl p-2 text-sm text-white outline-none focus:border-primary",value:p,onChange:F=>v(F.target.value),disabled:_,children:[m.jsx("option",{value:"",children:"Select Target..."}),c.map(F=>m.jsx("option",{value:F.id,children:F.nombre},F.id))]})]})]}),m.jsxs("div",{className:"space-y-1",children:[m.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-slate-500",children:"Relationship Type"}),m.jsx("input",{type:"text",placeholder:"e.g. Father of, Located in, Enemy of...",className:"w-full bg-black/40 border border-white/10 rounded-xl p-2 text-sm text-white outline-none focus:border-primary",value:y,onChange:F=>S(F.target.value)})]}),m.jsxs("div",{className:"space-y-1",children:[m.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-slate-500",children:"Description (The Why)"}),m.jsx("textarea",{placeholder:"Explain the nature of this connection...",className:"w-full bg-black/40 border border-white/10 rounded-xl p-2 text-sm text-white outline-none focus:border-primary h-20 resize-none",value:w,onChange:F=>T(F.target.value)})]}),m.jsx("div",{className:"flex justify-end pt-2",children:m.jsx(Yn,{variant:"primary",icon:"save",onClick:I,disabled:!p||!y,children:"Save Connection"})})]}),m.jsx("div",{className:"space-y-3",children:i?m.jsx("div",{className:"text-center text-slate-500 py-8",children:"Scanning connections..."}):r.length===0?m.jsx("div",{className:"text-center text-slate-500 py-8 italic border border-dashed border-white/10 rounded-2xl",children:"No connections established"}):r.map((F,B)=>m.jsxs("div",{className:"group relative p-4 rounded-2xl bg-surface-dark border border-white/5 hover:border-primary/50 transition-all flex items-start gap-4",children:[m.jsx("div",{className:"mt-1",children:m.jsx("span",{className:"material-symbols-outlined text-slate-500",children:F.isOutgoing?"arrow_outward":"arrow_inward"})}),m.jsxs("div",{className:"flex-1",children:[m.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[m.jsx("span",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider",children:F.isOutgoing?"To:":"From:"}),m.jsx("span",{className:"text-sm font-bold text-white",children:F.otherName}),m.jsx("span",{className:"text-[9px] px-1.5 py-0.5 rounded bg-white/10 text-slate-400 font-bold uppercase tracking-wider",children:F.otherType})]}),m.jsx("div",{className:"text-primary text-xs font-black uppercase tracking-widest mb-2",children:F.tipoRelacion}),F.descripcion&&m.jsxs("p",{className:"text-xs text-slate-400 leading-relaxed bg-black/20 p-2 rounded-lg border border-white/5",children:['"',F.descripcion,'"']})]}),m.jsx("button",{onClick:()=>j(F.id),className:"opacity-0 group-hover:opacity-100 p-2 text-slate-600 hover:text-red-400 transition-all",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})})]},F.id||B))})]})},Vg=({mode:t})=>{const{username:e,projectName:r,entitySlug:n,folderSlug:i,type:a}=Zi(),s=Wa(),o=t==="creation",{setRightOpen:l,setAvailableTemplates:u,setRightPanelMode:c,setAddAttributeHandler:h,setEntityTabs:p,activeEntityTab:v,setActiveEntityTab:y}=jl(),[S,w]=ie.useState({nombre:"",tipo:"entidadindividual",descripcion:"",color:"#6366f1",apariencia:"",notas:"",iconUrl:null,tipoEspecial:a||null,carpeta:null,categoria:"Individual"}),[T,_]=ie.useState([]),[C,N]=ie.useState(!0),[A,I]=ie.useState(!1),[j,O]=ie.useState([]),[F,B]=ie.useState([]),[$,Z]=ie.useState(!1);ie.useEffect(()=>(l(!0),c("ENTITY"),p(["identity","narrative","attributes"]),y("identity"),()=>{c("NOTES"),p([])}),[]),ie.useEffect(()=>{o?H():U()},[n,i,o]);const D=q=>{u(q),B(q),h(te=>{const ae=q.find(de=>de.id===te);ae&&_(de=>[...de,{id:`temp-${ae.id}-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,attribute:ae,value:ae.valorDefecto||"",isTemp:!0}])})},H=async()=>{N(!0);try{const q=await et.get(`/world-bible/folders/${i}`),te=await et.get(`/world-bible/folders/${i}/templates`);D(te),w(de=>({...de,nombre:`Nuevo ${a==="map"?"Mapa":a==="timeline"?"Cronograma":"Ente"}`,carpeta:q,tipoEspecial:a||"entidadindividual",tipo:a||"entidadindividual"}));const ae=te.filter(de=>de.esObligatorio).map(de=>({id:`temp-${de.id}-${Math.random().toString(36).substr(2,9)}`,attribute:de,value:de.valorDefecto||"",isTemp:!0}));_(ae)}catch(q){console.error("Error creating draft:",q)}finally{N(!1)}},U=async()=>{N(!0);try{const q=await et.get(`/world-bible/entities/${n}`);if(w({...q,apariencia:q.apariencia||"",notas:q.notas||"",iconUrl:q.iconUrl||null,tags:q.tags||"",tipo:q.tipoEspecial||getHierarchyType(q.tipo).id,color:q.color||"#6366f1",categoria:q.categoria||"Individual",attributes:q.attributes||{}}),q.carpeta?.id){const ae=await et.get(`/world-bible/folders/${q.carpeta.id}/templates`);D(ae)}const te=(q.valores||[]).filter(ae=>ae.plantilla).map(ae=>({id:ae.id.toString(),attribute:ae.plantilla,value:ae.valor,isTemp:!1}));_(te)}catch(q){console.error("Error loading entity:",q)}finally{N(!1)}},W=(q,te)=>{w(ae=>({...ae,[q]:te}))},Y=q=>{const te=q.target.files[0];if(te){const ae=new FileReader;ae.onloadend=()=>{W("iconUrl",ae.result)},ae.readAsDataURL(te)}},Q=(q,te)=>{_(ae=>ae.map(de=>de.id===q?{...de,value:te}:de))},ne=q=>{q.toString().startsWith("temp-")||O(te=>[...te,q]),_(te=>te.filter(ae=>ae.id!==q))},re=async(q=!0)=>{I(!0);try{const te={nombre:S.nombre,descripcion:S.descripcion,tags:S.tags,apariencia:S.apariencia,notas:S.notas,iconUrl:S.iconUrl,tipoEspecial:S.tipoEspecial||"entidadindividual",color:S.color,categoria:S.categoria,attributes:S.attributes};let ae=S.id;if(o){if(!S.carpeta&&!i){alert("Error: Missing context (no folder). Redirecting."),s(`/${e}/${r}/bible`);return}if(te.carpetaId=S.carpeta?.id,!te.carpetaId&&i)try{const le=await et.get(`/world-bible/folders/${i}`);te.carpetaId=le.id}catch(le){console.error("Could not resolve folder",le)}const se=await et.post("/world-bible/entities",te);ae=se.id;const fe=[...T];for(let le=0;le<fe.length;le++){const pe=fe[le];if(pe.isTemp)try{const me=await et.post(`/world-bible/entities/${se.id}/attributes`,{plantillaId:pe.attribute.id});await et.patch(`/world-bible/entities/${se.id}/values`,[{valorId:me.id,nuevoValor:pe.value}]),fe[le]={...pe,id:me.id.toString(),isTemp:!1}}catch(me){console.error("Attr save failed",me)}}if(_(fe),I(!1),q){const le=se.carpeta?se.carpeta.slug||se.carpeta.id:i;s(`/${e}/${r}/bible/folder/${le}`)}else{const le=se.carpeta?se.carpeta.slug||se.carpeta.id:i;s(`/${e}/${r}/bible/folder/${le}/entity/${se.slug||se.id}`,{replace:!0})}return}await et.put(`/world-bible/entities/${ae}`,{nombre:te.nombre,color:te.color,iconUrl:te.iconUrl}),await et.patch(`/world-bible/entities/${ae}/details`,{descripcion:te.descripcion,tags:te.tags,apariencia:te.apariencia,notas:te.notas,iconUrl:te.iconUrl,attributes:te.attributes}),j.length>0&&(await Promise.all(j.map(se=>et.delete(`/world-bible/values/${se}`))),O([]));const de=T.filter(se=>!se.isTemp).map(se=>({valorId:parseInt(se.id),nuevoValor:se.value}));de.length>0&&await et.patch(`/world-bible/entities/${ae}/values`,de);let ge=!1;const ye=[...T];for(let se=0;se<ye.length;se++){const fe=ye[se];if(fe.isTemp)try{const le=await et.post(`/world-bible/entities/${ae}/attributes`,{plantillaId:fe.attribute.id});await et.patch(`/world-bible/entities/${ae}/values`,[{valorId:le.id,nuevoValor:fe.value}]),ye[se]={...fe,id:le.id.toString(),isTemp:!1},ge=!0}catch(le){console.error("Error saving field:",fe,le)}}if(ge&&_(ye),I(!1),q){const fe=i||(S.carpeta?S.carpeta.slug||S.carpeta.id:"root")||"root";s(`/${e}/${r}/bible/folder/${fe}`)}}catch(te){console.error("Save error",te),I(!1)}};return C?m.jsx("div",{className:"p-20 text-center animate-pulse",children:"Loading Builder..."}):m.jsx("div",{className:"flex h-full w-full bg-background-dark overflow-hidden",children:m.jsxs("div",{className:"flex-1 flex flex-col min-w-0 overflow-y-auto custom-scrollbar relative",children:[m.jsxs("div",{className:"border-b border-white/5 p-4 flex justify-between items-center bg-background-dark/80 backdrop-blur sticky top-0 z-30",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx(rx,{url:S.iconUrl,name:S.nombre,className:"size-10 rounded-lg border border-white/10"}),m.jsxs("div",{children:[m.jsx("h1",{className:"text-lg font-bold text-white leading-tight",children:S.nombre||"Sin Nombre"}),m.jsx("span",{className:"text-[10px] uppercase font-black tracking-widest text-slate-500",children:o?"Creando Nueva Entidad":"Editando Entidad"})]})]}),m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsx("button",{onClick:()=>s(`/${e}/${r}/bible/folder/${i}`),className:"px-4 py-2 rounded-xl text-slate-400 hover:text-white hover:bg-white/5 text-xs font-bold uppercase tracking-widest transition-all",children:"Cancelar"}),m.jsxs("div",{className:"flex bg-white/5 rounded-xl p-1 gap-1 border border-white/10",children:[m.jsxs("button",{onClick:()=>re(!0),disabled:A,className:"h-9 px-4 rounded-lg bg-primary hover:bg-primary-light text-white text-[10px] font-black uppercase tracking-widest transition-all flex items-center gap-2 disabled:opacity-50",children:[A?m.jsx("span",{className:"material-symbols-outlined animate-spin text-sm",children:"refresh"}):m.jsx("span",{className:"material-symbols-outlined text-sm",children:"save"}),"Guardar"]}),m.jsx("div",{className:"w-px bg-white/10 my-1"}),m.jsx("button",{onClick:()=>re(!1),disabled:A,className:"h-9 px-3 rounded-lg bg-transparent hover:bg-white/10 text-white transition-all flex items-center justify-center disabled:opacity-50",title:"Guardar y Seguir Editando",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"edit_document"})})]})]})]}),m.jsxs("div",{className:"p-8 pb-32 max-w-5xl mx-auto w-full",children:[v==="identity"&&m.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[m.jsxs(An,{className:`p-6 space-y-6 ${S.tipoEspecial==="map"?"lg:col-span-2":""}`,children:[m.jsxs("h3",{className:"text-xs font-black uppercase tracking-widest text-primary flex items-center gap-2 mb-6",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"badge"})," Identity"]}),m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{children:[m.jsx("label",{className:"text-[10px] uppercase font-bold text-slate-500 mb-1 block",children:"Full Name"}),m.jsx("input",{value:S.nombre,onChange:q=>W("nombre",q.target.value),className:"w-full bg-black/30 border border-white/10 rounded-xl p-3 text-sm text-white focus:border-primary/50 outline-none transition-colors",placeholder:"E.g. King Alaric"})]}),m.jsxs("div",{children:[m.jsx("label",{className:"text-[10px] uppercase font-bold text-slate-500 mb-1 block",children:"Entity Type / Category"}),m.jsxs("select",{value:S.categoria||"Individual",onChange:q=>W("categoria",q.target.value),className:"w-full bg-black/30 border border-white/10 rounded-xl p-3 text-sm text-white focus:border-primary/50 outline-none transition-colors appearance-none",children:[m.jsx("option",{value:"Individual",children:"Individual (Character/Person)"}),m.jsx("option",{value:"Group",children:"Group / Faction"}),m.jsx("option",{value:"Location",children:"Location"}),m.jsx("option",{value:"Event",children:"Event"}),m.jsx("option",{value:"Object",children:"Object / Item"}),m.jsx("option",{value:"Concept",children:"Concept / Magic"})]})]}),m.jsxs("div",{children:[m.jsx("label",{className:"text-[10px] uppercase font-bold text-slate-500 mb-1 block",children:"Tags (comma separated)"}),m.jsx("input",{value:S.tags,onChange:q=>W("tags",q.target.value),className:"w-full bg-black/30 border border-white/10 rounded-xl p-3 text-sm text-slate-300 focus:border-primary/50 outline-none transition-colors",placeholder:"Warrior, Leader, Human..."})]}),m.jsxs("div",{children:[m.jsx("label",{className:"text-[10px] uppercase font-bold text-slate-500 mb-1 block",children:"Icon / Portrait"}),m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx(rx,{url:S.iconUrl,name:S.nombre,size:"lg",className:"rounded-xl"}),m.jsxs("label",{className:"cursor-pointer px-4 py-2 bg-white/5 hover:bg-white/10 rounded-lg border border-white/10 text-xs font-bold text-slate-300 transition-colors",children:["Upload Image",m.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:Y})]}),S.iconUrl&&m.jsx("button",{onClick:()=>W("iconUrl",""),className:"p-2 hover:text-red-400 transition-colors",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})})]})]})]})]}),S.tipoEspecial!=="map"&&m.jsxs(An,{className:"p-6 space-y-6",children:[m.jsxs("div",{className:"flex justify-between items-center mb-6",children:[m.jsxs("h3",{className:"text-xs font-black uppercase tracking-widest text-primary flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"palette"})," Appearance"]}),m.jsx("div",{className:"flex gap-2",children:m.jsxs("label",{className:"cursor-pointer text-[10px] font-bold uppercase tracking-wider text-slate-500 hover:text-white transition-colors flex items-center gap-1",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"add_photo_alternate"}),"Insert Image",m.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:q=>{const te=q.target.files[0];if(te){const ae=new FileReader;ae.onloadend=()=>{const de=`

![${te.name}](${ae.result})
`;W("apariencia",(S.apariencia||"")+de)},ae.readAsDataURL(te)}}})]})})]}),m.jsx("textarea",{value:S.apariencia,onChange:q=>W("apariencia",q.target.value),className:"w-full h-80 bg-black/30 border border-white/10 rounded-xl p-4 text-sm text-slate-300 leading-relaxed focus:border-primary/50 outline-none transition-colors custom-scrollbar font-mono",placeholder:"Describe their physical appearance, clothing, distinct marks... (Markdown Supported)"})]}),S.tipoEspecial==="map"&&m.jsxs(An,{className:"p-6 lg:col-span-2 space-y-6",children:[m.jsxs("h3",{className:"text-xs font-black uppercase tracking-widest text-primary flex items-center gap-2 mb-6",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"map"})," Cartography"]}),m.jsx("div",{onClick:()=>{Z(!0)},className:"w-full aspect-[21/9] bg-black/30 border border-white/10 rounded-xl overflow-hidden cursor-pointer group relative",children:(()=>{let q=S.attributes?.snapshotUrl||S.attributes?.bgImage||S.iconUrl;if(!q)try{const te=JSON.parse(S.descripcion||"{}");te.snapshotUrl&&(q=te.snapshotUrl)}catch{}return q?m.jsxs(m.Fragment,{children:[m.jsx("img",{src:q,alt:"Map Preview",className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"}),m.jsx("div",{className:"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center",children:m.jsx("span",{className:"material-symbols-outlined text-white text-3xl",children:"zoom_in"})})]}):m.jsx("div",{className:"w-full h-full flex items-center justify-center text-slate-500 text-xs italic",children:"No map preview available"})})()}),m.jsx("div",{className:"flex justify-end",children:m.jsx(Yn,{variant:"secondary",size:"sm",icon:"edit",onClick:()=>window.open(`/${e}/${r}/map-editor/edit/${S.id}`,"_self"),children:"Open Editor"})})]}),S.tipoEspecial!=="map"&&m.jsxs(An,{className:"p-6 lg:col-span-2",children:[m.jsxs("h3",{className:"text-xs font-black uppercase tracking-widest text-primary flex items-center gap-2 mb-6",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"sticky_note_2"})," Quick Notes"]}),m.jsx("textarea",{className:"w-full h-40 bg-black/30 border border-white/10 rounded-xl p-4 text-sm text-slate-300 leading-relaxed resize-none focus:border-primary/50 outline-none transition-colors custom-scrollbar font-mono placeholder:text-slate-600",placeholder:"Quick notes about this entity...",value:S.notas||"",onChange:q=>W("notas",q.target.value)})]})]}),v==="narrative"&&m.jsxs("div",{className:"animate-in fade-in duration-500 space-y-8",children:[m.jsxs(An,{className:"min-h-[40vh] flex flex-col p-8",children:[m.jsxs("div",{className:"flex items-center justify-between mb-6",children:[m.jsxs("h3",{className:"text-xs font-black uppercase tracking-widest text-primary flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"history_edu"})," Biography"]}),m.jsx("span",{className:"text-[10px] text-slate-500 bg-white/5 px-2 py-1 rounded",children:"Markdown Supported"})]}),m.jsx("textarea",{className:"flex-1 w-full bg-transparent border-none outline-none text-slate-300 leading-relaxed resize-none focus:ring-0 placeholder:text-slate-600 custom-scrollbar text-base min-h-[300px]",placeholder:"Write the origin story...",value:S.descripcion||"",onChange:q=>W("descripcion",q.target.value)})]}),m.jsxs(An,{className:"min-h-[40vh]",children:[m.jsxs("h3",{className:"text-xs font-black uppercase tracking-widest text-primary p-6 pb-0 flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"hub"})," Relationships"]}),o?m.jsxs("div",{className:"p-12 text-center text-slate-500",children:[m.jsx("span",{className:"material-symbols-outlined text-4xl mb-4",children:"save_as"}),m.jsx("p",{className:"text-sm font-bold",children:"Please save the entity first to manage relationships."})]}):m.jsx(Pie,{entityId:S.id,entityType:S.tipo||"entidadindividual"})]})]}),v==="attributes"&&m.jsxs("div",{className:`animate-in fade-in duration-500 space-y-6 min-h-[50vh] transition-colors rounded-2xl p-4 ${window.isDraggingOver?"bg-primary/10 border-2 border-dashed border-primary":""}`,onDragOver:q=>{q.preventDefault(),q.dataTransfer.dropEffect="copy",q.currentTarget.classList.add("bg-primary/10","border-primary","border-dashed","border-2")},onDragLeave:q=>{q.preventDefault(),q.currentTarget.classList.remove("bg-primary/10","border-primary","border-dashed","border-2")},onDrop:q=>{if(q.preventDefault(),q.currentTarget.classList.remove("bg-primary/10","border-primary","border-dashed","border-2"),q.dataTransfer.getData("application/reactflow/type")!=="attribute")return;let ae=null;try{const de=q.dataTransfer.getData("templateData");if(de)ae=JSON.parse(de);else{const ge=parseInt(q.dataTransfer.getData("templateId"));ae=F.find(ye=>ye.id===ge)}}catch(de){console.error("Drop error",de)}ae&&_(de=>[...de,{id:`temp-${ae.id}-${Date.now()}`,attribute:ae,value:ae.valorDefecto||"",isTemp:!0}])},children:[m.jsxs("h3",{className:"text-xs font-black uppercase tracking-widest text-primary border-b border-white/5 pb-4 flex items-center justify-between",children:[m.jsx("span",{children:"Atributos especiales"}),m.jsx("span",{className:"text-[10px] text-slate-500 font-normal normal-case opacity-50 hidden md:block",children:"Arraste atributos desde el panel derecho"})]}),m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 p-4 border-2 border-dashed border-white/5 rounded-2xl hover:border-primary/20 transition-colors bg-white/[0.01]",children:[T.length===0&&m.jsxs("div",{className:"col-span-full py-12 text-center text-slate-500 text-sm pointer-events-none",children:[m.jsx("span",{className:"material-symbols-outlined text-4xl mb-2 opacity-50",children:"drag_indicator"}),m.jsx("p",{children:"Arrastra plantillas aqu para aadir atributos"})]}),T.filter(q=>q.attribute).map(q=>m.jsx(Tie,{attribute:q.attribute,value:q.value,onChange:te=>Q(q.id,te),onRemove:()=>ne(q.id)},q.id))]})]})]}),$&&S.iconUrl&&m.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/90 backdrop-blur-sm animate-in fade-in duration-300",onClick:()=>Z(!1),children:m.jsxs("div",{className:"relative max-w-[90vw] max-h-[90vh] p-2",children:[m.jsx("button",{onClick:()=>Z(!1),className:"absolute -top-12 right-0 p-2 text-white hover:text-primary transition-colors",children:m.jsx("span",{className:"material-symbols-outlined text-3xl",children:"close"})}),m.jsx("img",{src:S.iconUrl,alt:S.nombre,className:"max-w-full max-h-[85vh] object-contain rounded-lg shadow-2xl border border-white/10",onClick:q=>q.stopPropagation()})]})})]})})},Mie=t=>{switch(t?.toLowerCase()){case"text":return"notes";case"short_text":return"short_text";case"number":return"pin";case"date":return"calendar_today";case"select":return"list";case"boolean":return"check_box";case"map":return"map";case"timeline":return"timeline";case"character":case"entidadindividual":return"person";case"location":case"zona":case"construccion":return"location_on";case"culture":case"entidadcolectiva":return"groups";case"universe":case"galaxy":case"system":case"planet":return"public";case"entity_link":return"link";default:return"description"}},Vk=({item:t,type:e,linkTo:r,onContextMenu:n,onDelete:i})=>{const a=e==="folder";return m.jsxs(ff,{to:r,onContextMenu:n,className:"group relative flex flex-col p-4 rounded-3xl bg-surface-dark border border-glass-border hover:border-primary/50 hover:bg-white/5 transition-all duration-300 backdrop-blur-sm overflow-hidden",children:[t.iconUrl&&m.jsxs(m.Fragment,{children:[m.jsx("div",{className:"absolute inset-0 z-0",children:m.jsx("img",{src:t.iconUrl,alt:"",className:"w-full h-full object-cover opacity-60 group-hover:scale-105 transition-transform duration-700"})}),m.jsx("div",{className:"absolute inset-0 z-0 bg-gradient-to-t from-[#0a0a0c] via-[#0a0a0c]/80 to-transparent"})]}),m.jsxs("div",{className:"relative z-10 flex items-start justify-between mb-4",children:[m.jsx("div",{className:`
                    size-12 rounded-2xl flex items-center justify-center text-xl transition-transform group-hover:scale-110 
                    ${a?"bg-primary/20 text-primary":"bg-white/5 text-text-muted group-hover:text-white backdrop-blur-md border border-white/5"}
                `,children:m.jsx("span",{className:"material-symbols-outlined",children:a?"folder":Mie(t.tipoEspecial)})}),a&&m.jsx("div",{className:"px-2 py-1 rounded-lg bg-surface-light/50 border border-glass-border text-[10px] font-black text-white shadow-sm backdrop-blur-md",children:t.itemCount||0})]}),m.jsxs("div",{className:"relative z-10 mt-auto",children:[m.jsx("h3",{className:"text-sm font-bold text-white truncate group-hover:text-primary transition-colors drop-shadow-md",children:t.nombre}),m.jsx("p",{className:"text-[10px] font-bold uppercase tracking-widest text-text-muted mt-1 opacity-70 group-hover:opacity-100 transition-opacity",children:a?"Folder":t.tipoEspecial||"Entity"})]}),m.jsxs("div",{className:"absolute top-4 right-4 z-20 flex items-center gap-2 opacity-0 group-hover:opacity-100 transition-opacity duration-300",children:[i&&m.jsx("button",{onClick:s=>{s.preventDefault(),s.stopPropagation(),i(t)},className:"p-1.5 rounded-lg bg-red-500/10 hover:bg-red-500 text-red-500 hover:text-white transition-all border border-red-500/20 shadow-lg shadow-red-500/5 group/del backdrop-blur-md",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})}),m.jsx("span",{className:"material-symbols-outlined text-primary text-sm transform group-hover:translate-x-1 transition-transform drop-shadow-md",children:"arrow_forward"})]})]})},Aie=({path:t,currentFolder:e})=>{const{username:r,projectName:n}=Zi(),i=`/${r}/${n}/bible`;return!t&&!e?null:m.jsxs("nav",{className:"flex items-center gap-2 text-[10px] uppercase font-bold tracking-wider text-slate-500 mb-4 overflow-x-auto no-scrollbar whitespace-nowrap",children:[m.jsxs(ff,{to:i,className:"hover:text-primary transition-colors flex items-center gap-1",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"home"}),"Bible"]}),t&&t.map((a,s)=>m.jsxs(nr.Fragment,{children:[m.jsx("span",{className:"text-slate-700",children:"/"}),m.jsx(ff,{to:`${i}/folder/${a.slug||a.id}`,className:"hover:text-primary transition-colors",children:a.nombre})]},a.id)),e&&m.jsxs(m.Fragment,{children:[m.jsx("span",{className:"text-slate-700",children:"/"}),m.jsx("span",{className:"text-white bg-white/5 px-2 py-0.5 rounded",children:e.nombre})]})]})},Rie=({entities:t=[],onAddEvent:e})=>{const r=[...t].sort((n,i)=>n.id-i.id);return m.jsx("div",{className:"w-full max-w-3xl mx-auto p-4 animate-slide-up",children:m.jsxs("div",{className:"relative border-l-2 border-white/10 ml-6 space-y-12 py-8",children:[r.length===0&&m.jsx("div",{className:"pl-12 opacity-50",children:m.jsx("p",{className:"text-white text-sm",children:"No events recorded in this timeline yet."})}),r.map((n,i)=>m.jsxs("div",{className:"relative pl-12 group",children:[m.jsx("div",{className:"absolute left-[-9px] top-0 size-4 rounded-full bg-background-dark border-2 border-primary group-hover:scale-125 group-hover:bg-primary transition-all shadow-[0_0_10px_rgba(99,102,241,0.3)]"}),m.jsxs(An,{className:"p-6 border-white/5 hover:border-primary/30 transition-all hover:-translate-y-1 cursor-pointer",children:[m.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:n.nombre}),m.jsx("p",{className:"text-sm text-text-muted leading-relaxed line-clamp-3",children:n.descripcion||"No description provided."})]})]},n.id)),m.jsxs("div",{onClick:e,className:"relative pl-12 group cursor-pointer opacity-50 hover:opacity-100 transition-opacity",children:[m.jsx("div",{className:"absolute left-[-9px] top-2 size-4 rounded-full bg-background-dark border-2 border-dashed border-white/30"}),m.jsxs("div",{className:"p-4 border-2 border-dashed border-white/10 rounded-2xl flex items-center justify-center text-text-muted hover:border-primary/50 hover:text-white transition-all",children:[m.jsx("span",{className:"material-symbols-outlined mr-2",children:"add_circle"}),m.jsx("span",{className:"text-xs font-black uppercase tracking-widest",children:"Add Historical Event"})]})]})]})})},sf={UNIVERSE:{id:"UNIVERSE",label:"Universo / Multiverso",description:"Contenedor supremo de realidades.",icon:"public",color:"text-purple-400",bgColor:"bg-purple-900/20"},GALAXY:{id:"GALAXY",label:"Galaxia",description:"Agrupacin masiva de sistemas estelares.",icon:"auto_awesome",color:"text-indigo-400",bgColor:"bg-indigo-900/20"},SYSTEM:{id:"SYSTEM",label:"Sistema Solar",description:"Estrella central y sus cuerpos orbitales.",icon:"wb_sunny",color:"text-yellow-400",bgColor:"bg-yellow-900/20"},PLANET:{id:"PLANET",label:"Planeta / Mundo",description:"Cuerpo celeste o plano de existencia principal.",icon:"public",color:"text-emerald-400",bgColor:"bg-emerald-900/20"},GEOGRAPHY:{id:"GEOGRAPHY",label:"Geografa",icon:"map",color:"text-green-300"},ENTITIES:{id:"ENTITIES",label:"Entidades",icon:"groups",color:"text-blue-300"},MAGIC:{id:"MAGIC",label:"Magia",icon:"auto_fix_high",color:"text-pink-300"},TIMELINE:{id:"TIMELINE",label:"Cronologa",icon:"history",color:"text-orange-300"},FACTIONS:{id:"FACTIONS",label:"Facciones",icon:"security",color:"text-red-300"},ITEMS:{id:"ITEMS",label:"Objetos",icon:"inventory_2",color:"text-gray-300"},FOLDER:{id:"FOLDER",label:"Carpeta",icon:"folder",color:"text-gray-400"}},Hk=t=>sf[t]||sf.FOLDER,Lie=()=>{const{username:t,projectName:e,folderSlug:r}=Zi(),n=Wa(),{handleCreateEntity:i,handleDeleteEntity:a,handleCreateSimpleFolder:s,folderSearchTerm:o,folderFilterType:l}=jl(),[u,c]=ie.useState([]),[h,p]=ie.useState(null),[v,y]=ie.useState([]),[S,w]=ie.useState(!0),[T,_]=ie.useState(!1),C=u.filter(j=>{const O=j.nombre.toLowerCase().includes(o||""),F=l==="ALL"||l==="MAP"&&j.tipoEspecial==="map"||l==="TIMELINE"&&j.tipoEspecial==="timeline"||l==="ENTITY"&&(!j.tipoEspecial||j.tipoEspecial==="entidadindividual");return O&&F});ie.useEffect(()=>{const j=O=>{const{folderId:F,removeId:B,type:$,item:Z,expand:D}=O.detail||{};F===(h?.id||r)&&(B?c(H=>H.filter(U=>U.id!==B)):Z&&Z.slug&&Z.slug!==r?n(`/${t}/${e}/bible/folder/${Z.slug}`,{replace:!0}):N())};return window.addEventListener("folder-update",j),()=>window.removeEventListener("folder-update",j)},[r,h?.id]),ie.useEffect(()=>{N()},[r]);const N=async()=>{w(!0);try{const[j,O]=await Promise.all([et.get(`/world-bible/folders/${r}/entities`),et.get(`/world-bible/folders/${r}`)]);c(j),O.folder?(p(O.folder),y(O.path||[])):(p(O||{name:"Folder"}),y([]))}catch(j){console.error("Error loading folder content:",j),p(null),y([])}finally{w(!1)}};if(S)return m.jsx("div",{className:"p-20 text-center animate-pulse text-text-muted",children:"Loading sector..."});if(!h)return m.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-20 text-text-muted",children:[m.jsx("span",{className:"material-symbols-outlined text-6xl mb-4 opacity-20",children:"folder_off"}),m.jsx("h2",{className:"text-xl font-bold opacity-50",children:"Folder Not Found"}),m.jsx("p",{className:"text-sm opacity-30 mt-2",children:"The sector you are looking for does not exist or has been moved."}),m.jsx(ff,{to:`/${t}/${e}/bible`,className:"mt-6 px-6 py-2 bg-white/5 hover:bg-white/10 rounded-full text-xs font-bold transition-colors",children:"Return to Root"})]});const A=h&&h.tipo&&(["UNIVERSE","GALAXY","SYSTEM","PLANET"].includes(h.tipo)||h.tipo==="MAGIC"),I=h?Hk(h.tipo):sf.FOLDER;return A?m.jsxs("div",{className:"flex-1 overflow-y-auto bg-[#0a0a0c] text-white w-full h-full relative",children:[m.jsxs("div",{className:`w-full min-h-[300px] ${I.bgColor} relative flex items-end p-10 border-b border-white/5`,children:[m.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-[#0a0a0c] to-transparent opacity-80 pointer-events-none"}),m.jsx("div",{className:"absolute top-6 left-10 z-20",children:m.jsx(Aie,{path:v,currentFolder:h})}),m.jsxs("div",{className:"relative z-10 flex gap-8 items-end w-full max-w-7xl mx-auto",children:[m.jsx("div",{className:`w-32 h-32 rounded-3xl ${I.bgColor} border border-white/10 flex items-center justify-center shadow-2xl`,children:m.jsx("span",{className:`material-symbols-outlined text-6xl ${I.color}`,children:I.icon})}),m.jsxs("div",{className:"flex-1 mb-2",children:[m.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[m.jsx("div",{className:`px-3 py-1 rounded-full text-[10px] font-black uppercase tracking-widest border border-white/10 ${I.bgColor} ${I.color}`,children:I.label}),m.jsxs("span",{className:"text-white/30 text-xs font-mono tracking-widest uppercase",children:["ID: ",h.id]})]}),m.jsx("h1",{className:"text-6xl font-black tracking-tighter text-white mb-2",children:h.nombre}),m.jsx("p",{className:"text-lg text-white/50 max-w-2xl font-light leading-relaxed",children:h.descripcion||"Sin descripcin definida para este sector cosmolgico."})]}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsxs("button",{onClick:()=>n(`/${t}/${e}/bible/folder/${r}/entity/new/entidadindividual`),className:"px-4 py-2 bg-primary/20 hover:bg-primary/30 text-primary rounded-xl text-[10px] font-black uppercase tracking-widest flex items-center gap-2 transition-all",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"person_add"})," Nueva Entidad"]}),m.jsxs("button",{onClick:()=>n(`/${t}/${e}/map-editor/create/${r}`,{state:{folderId:h?.id}}),className:"px-4 py-2 bg-white/5 hover:bg-white/10 text-white rounded-xl text-[10px] font-black uppercase tracking-widest flex items-center gap-2 transition-all border border-glass-border",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"map"})," Mapa"]})]})]})]}),m.jsxs("div",{className:"max-w-7xl mx-auto p-10 grid grid-cols-1 lg:grid-cols-3 gap-8",children:[m.jsxs("div",{className:"space-y-6",children:[m.jsxs("div",{className:"bg-[#13141f] border border-white/5 rounded-2xl p-6",children:[m.jsx("h3",{className:"text-xs font-bold text-white/40 uppercase tracking-widest mb-4",children:"Estadsticas"}),m.jsx("div",{className:"grid grid-cols-2 gap-4",children:m.jsxs("div",{children:[m.jsx("div",{className:"text-2xl font-black text-white",children:u.length}),m.jsx("div",{className:"text-[10px] text-white/40 uppercase",children:"Entidades"})]})})]}),m.jsxs("div",{className:"bg-[#13141f] border border-white/5 rounded-2xl p-6 h-64 flex flex-col",children:[m.jsx("h3",{className:"text-xs font-bold text-white/40 uppercase tracking-widest mb-4",children:"Notas Rpidas"}),m.jsx("textarea",{className:"flex-1 bg-transparent resize-none outline-none text-sm text-white/70 placeholder-white/20",placeholder:"Escribir notas de la zona..."})]})]}),m.jsxs("div",{className:"lg:col-span-2",children:[m.jsx("h3",{className:"text-xs font-bold text-white/40 uppercase tracking-widest mb-4",children:"Contenido Interno"}),u.length===0&&m.jsxs("div",{className:"p-12 border border-dashed border-white/10 rounded-2xl text-center",children:[m.jsx("span",{className:"material-symbols-outlined text-4xl text-white/20 mb-2",children:"folder_open"}),m.jsx("p",{className:"text-white/30 text-sm",children:"Este sector est vaco."})]}),m.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:u.map(j=>m.jsx(Vk,{item:j,type:"entity",linkTo:`/${t}/${e}/bible/folder/${h.slug||r}/entity/${j.slug||j.id}`,onDelete:()=>a(j.id,h?.id||r)},j.id))})]})]})]}):m.jsxs("div",{className:"flex-1 p-8 max-w-[1600px] mx-auto w-full h-full overflow-y-auto",children:[m.jsxs("header",{className:"mb-8 flex items-end justify-between",children:[m.jsxs("div",{children:[m.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[m.jsxs(ff,{to:`/${t}/${e}/bible`,className:"text-xs font-bold text-text-muted hover:text-primary transition-colors flex items-center gap-1",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"arrow_back"})," Root"]}),h&&m.jsx("span",{className:`px-2 py-0.5 rounded text-[10px] bg-white/5 border border-white/10 ${I.color}`,children:I.label})]}),m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsx("span",{className:`material-symbols-outlined text-3xl ${I.color}`,children:I.icon}),m.jsx("h1",{className:"text-4xl font-black text-white tracking-tighter",children:h?.nombre||"Unnamed Folder"})]}),m.jsx("p",{className:"text-white/50 text-sm mt-2 max-w-xl",children:h?.descripcion})]}),m.jsxs("div",{className:"flex items-center gap-3 relative",children:[m.jsxs("button",{onClick:()=>_(!T),className:"h-10 px-6 rounded-xl bg-primary hover:bg-primary-light transition flex items-center gap-2 text-xs font-bold text-white shadow-lg shadow-primary/20",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"add"}),m.jsx("span",{children:"Aadir Elemento"})]}),T&&m.jsxs("div",{className:"absolute top-full right-0 mt-2 w-56 bg-surface-dark border border-glass-border rounded-2xl shadow-2xl py-2 z-50 animate-in fade-in slide-in-from-top-2",children:[m.jsxs("button",{onClick:()=>{n(`/${t}/${e}/bible/folder/${r}/entity/new/entidadindividual`),_(!1)},className:"w-full px-4 py-2.5 hover:bg-white/5 text-left text-xs font-bold flex items-center gap-3 text-white/70 hover:text-white",children:[m.jsx("span",{className:"material-symbols-outlined text-sm text-primary",children:"person"})," Personaje"]}),m.jsxs("button",{onClick:()=>{n(`/${t}/${e}/bible/folder/${r}/entity/new/entidadcolectiva`),_(!1)},className:"w-full px-4 py-2.5 hover:bg-white/5 text-left text-xs font-bold flex items-center gap-3 text-white/70 hover:text-white",children:[m.jsx("span",{className:"material-symbols-outlined text-sm text-blue-400",children:"groups"})," Cultura / Grupo"]}),m.jsxs("button",{onClick:()=>{n(`/${t}/${e}/bible/folder/${r}/entity/new/zona`),_(!1)},className:"w-full px-4 py-2.5 hover:bg-white/5 text-left text-xs font-bold flex items-center gap-3 text-white/70 hover:text-white",children:[m.jsx("span",{className:"material-symbols-outlined text-sm text-green-400",children:"location_on"})," Lugar / Geografa"]}),m.jsxs("button",{onClick:()=>{n(`/${t}/${e}/bible/folder/${r}/entity/new/interaccion`),_(!1)},className:"w-full px-4 py-2.5 hover:bg-white/5 text-left text-xs font-bold flex items-center gap-3 text-white/70 hover:text-white",children:[m.jsx("span",{className:"material-symbols-outlined text-sm text-amber-400",children:"history_edu"})," Lore / Interaccin"]}),m.jsxs("button",{onClick:()=>{n(`/${t}/${e}/bible/folder/${r}/entity/new/efectos`),_(!1)},className:"w-full px-4 py-2.5 hover:bg-white/5 text-left text-xs font-bold flex items-center gap-3 text-white/70 hover:text-white",children:[m.jsx("span",{className:"material-symbols-outlined text-sm text-purple-400",children:"magic_button"})," Objeto / Efecto"]}),m.jsx("div",{className:"h-px bg-white/5 my-1"}),m.jsxs("button",{onClick:()=>{n(`/${t}/${e}/map-editor/create/${r}`,{state:{folderId:h?.id}}),_(!1)},className:"w-full px-4 py-2.5 hover:bg-white/5 text-left text-xs font-bold flex items-center gap-3 text-white/70 hover:text-white",children:[m.jsx("span",{className:"material-symbols-outlined text-sm text-red-400",children:"map"})," Nuevo Mapa"]}),m.jsxs("button",{onClick:()=>{s(h,"TIMELINE"),_(!1)},className:"w-full px-4 py-2.5 hover:bg-white/5 text-left text-xs font-bold flex items-center gap-3 text-white/70 hover:text-white",children:[m.jsx("span",{className:"material-symbols-outlined text-sm text-cyan-400",children:"timeline"})," Timeline"]})]})]})]}),h?.tipo==="TIMELINE"?m.jsx(Rie,{entities:C,folderId:r,onAddEvent:()=>n(`/${t}/${e}/bible/folder/${r}/entity/new/evento`)}):m.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4",children:C.map(j=>{const O=j.tipoEspecial==="map"||j.tipoEspecial==="timeline"?j.tipoEspecial:"entity";return m.jsx(Vk,{item:j,type:"entity",linkTo:`/${t}/${e}/bible/folder/${h?.slug||r}/${O}/${j.slug||j.id}`,onDelete:()=>a(j.id,h?.id||r)},j.id)})}),u.length===0&&m.jsx("div",{className:"p-20 text-center border-2 border-dashed border-glass-border rounded-[3rem] opacity-30 mt-8",children:m.jsx("p",{className:"text-text-muted font-bold uppercase tracking-widest",children:"Empty Folder"})})]})},Oie=t=>{switch(t?.toLowerCase()){case"text":return"notes";case"short_text":return"short_text";case"number":return"pin";case"date":return"calendar_today";case"select":return"list";case"boolean":return"check_box";case"map":return"map";case"timeline":return"timeline";case"character":case"entidadindividual":return"person";case"location":case"zona":case"construccion":return"location_on";case"culture":case"entidadcolectiva":return"groups";case"universe":case"galaxy":case"system":case"planet":return"public";case"entity_link":return"link";default:return"description"}},Die=(t,e,r,n)=>{const i=r.slug||r.id;return`/${t}/${e}/bible/folder/${n||"root"}/entity/${i}`},SD=({folder:t,onCreateSubfolder:e,onRename:r,onDeleteFolder:n,onDeleteEntity:i,onCreateTemplate:a,onMoveEntity:s,onCreateEntity:o,onConfirmCreate:l,className:u})=>{const{username:c,projectName:h}=Zi(),p=Wa(),[v,y]=ie.useState(!1),[S,w]=ie.useState({folders:[],entities:[]}),[T,_]=ie.useState(!1),[C,N]=ie.useState(null),[A,I]=ie.useState(t.nombre),[j,O]=ie.useState(!1),[F,B]=ie.useState(null);ie.useEffect(()=>{I(t.nombre)},[t.nombre]),ie.useEffect(()=>{const q=te=>{const{folderId:ae,optimisticType:de,confirmedType:ge,removeId:ye,item:se,oldId:fe,expand:le,type:pe}=te.detail||{};if(ae===t.id){if(le&&(y(!0),T||$()),T)if(de){const me=de==="folder"?"folders":"entities";w(xe=>({...xe,[me]:[...xe[me].filter(Se=>Se.id!==se.id),se]}))}else if(ge){const me=ge==="folder"?"folders":"entities";w(xe=>({...xe,[me]:xe[me].map(Se=>Se.id===fe?se:Se)}))}else if(ye){const me=pe==="folder"?"folders":"entities";w(xe=>({...xe,[me]:xe[me].filter(Se=>Se.id!==ye)}))}else!de&&!ge&&!ye&&$()}else te.detail?.targetFolderId===t.id&&te.detail?.type==="move-in"?T&&$():te.detail?.sourceFolderId===t.id&&te.detail?.type==="move-out"&&T&&w(me=>({...me,entities:me.entities.filter(xe=>xe.id!==xe.detail.entityId)}))};return window.addEventListener("folder-update",q),()=>window.removeEventListener("folder-update",q)},[t.id,T]);const $=async()=>{try{console.log("Loading content for folder:",t.id,"Slug:",t.slug);const[q,te]=await Promise.all([et.get(`/world-bible/folders/${t.id}/subfolders`),et.get(`/world-bible/folders/${t.id}/entities`)]);w({folders:q,entities:te}),_(!0)}catch(q){console.error("Error reloading folder content:",q),q.message&&q.message.includes("404")&&console.error(`404 for folder ${t.id} (${t.nombre})`)}},Z=q=>{q.stopPropagation(),y(!v),!T&&!v&&$()},D=()=>p(`/${c}/${h}/bible/folder/${t.slug||t.id}`),H=(q,te,ae,de)=>{q.preventDefault(),q.stopPropagation(),N({x:q.clientX,y:q.clientY,type:te,id:ae,name:de})},U=()=>N(null);ie.useEffect(()=>{if(C)return window.addEventListener("click",U),()=>window.removeEventListener("click",U)},[C]);const W=q=>{if(q.key==="Enter"){q.preventDefault();const te=q.target.value.trim();te?l(t.id,te,"folder",t.parentId,t.tipoEspecial):t.isNew&&i(t.id,t.parentId)}};if(t.isNew)return m.jsx("div",{className:"px-3 py-1 animate-in fade-in zoom-in-95 duration-200",children:m.jsx("input",{autoFocus:!0,type:"text",className:"w-full bg-surface-light border border-primary/50 rounded px-2 py-1 text-xs text-white outline-none",placeholder:"Folder Name...",onKeyDown:W,onBlur:q=>{const te=q.target.value.trim();te?l(t.id,te,"folder",t.parentId):i(t.id,t.parentId)}})});const Y=({item:q,type:te})=>m.jsx("div",{className:"px-3 py-1 animate-in fade-in zoom-in-95 duration-200",children:m.jsx("input",{autoFocus:!0,type:"text",defaultValue:q.nombre||"",className:"w-full bg-surface-light border border-primary/50 rounded px-2 py-1 text-xs text-white outline-none",placeholder:"Name...",onKeyDown:ae=>{if(ae.key==="Enter"){ae.preventDefault();const de=ae.target.value.trim();de?l(q.id,de,te,t.id,q.tipoEspecial):q.isNew&&i(q.id,t.id),B(null)}else ae.key==="Escape"&&(B(null),q.isNew&&i(q.id,t.id))},onBlur:ae=>{const de=ae.target.value.trim();de?l(q.id,de,te,t.id,q.tipoEspecial):q.isNew&&i(q.id,t.id),B(null)}})}),Q=q=>{q.preventDefault(),q.stopPropagation(),q.currentTarget.classList.add("bg-primary/20")},ne=q=>{q.preventDefault(),q.stopPropagation(),q.currentTarget.classList.remove("bg-primary/20")},re=q=>{q.preventDefault(),q.stopPropagation(),q.currentTarget.classList.remove("bg-primary/20");const te=q.dataTransfer.getData("entityId"),ae=q.dataTransfer.getData("sourceFolderId");te&&ae&&ae!==String(t.id)&&s(te,t.id,ae)};return m.jsxs("div",{className:`space-y-1 select-none ${u||""}`,children:[m.jsxs("div",{className:"flex items-center gap-3 px-3 py-2 rounded-xl text-xs font-bold text-text-muted hover:text-white hover:bg-white/5 cursor-pointer transition-all group relative",onClick:D,onContextMenu:q=>H(q,"folder",t.id,t.nombre),onDragOver:Q,onDragLeave:ne,onDrop:re,children:[m.jsx("span",{onClick:Z,className:`material-symbols-outlined text-lg transition-transform hover:text-primary ${v?"rotate-90 text-primary":"opacity-50"}`,children:"chevron_right"}),m.jsx("span",{className:`material-symbols-outlined text-lg ${Hk(t.tipo).color}`,children:Hk(t.tipo).icon}),j?m.jsx("input",{autoFocus:!0,className:"bg-surface-light border border-primary/50 rounded px-2 py-0.5 text-xs text-white outline-none flex-1 min-w-0",defaultValue:A,onKeyDown:async q=>{if(q.key==="Enter"){q.preventDefault(),q.stopPropagation();const te=q.target.value.trim();if(te&&te!==A)try{await r(t.id,te),I(te)}catch(ae){console.error("Rename failed",ae)}O(!1)}else q.key==="Escape"&&(q.preventDefault(),q.stopPropagation(),O(!1))},onBlur:()=>O(!1),onClick:q=>q.stopPropagation()}):m.jsx("span",{className:"truncate flex-1",children:A})]}),C&&m.jsxs("div",{className:"fixed bg-surface-dark border border-glass-border shadow-2xl rounded-xl py-2 z-50 w-48 text-xs font-medium flex flex-col",style:{top:C.y,left:C.x},onClick:q=>q.stopPropagation(),children:[m.jsx("div",{className:"px-4 py-2 border-b border-white/5 font-bold text-text-muted truncate",children:C.name}),C.type==="folder"?m.jsxs(m.Fragment,{children:[m.jsxs("button",{className:"px-4 py-2 hover:bg-white/5 text-left flex items-center gap-2",onClick:()=>{o(t.id,"entidadindividual"),U()},children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"person"})," Add Character"]}),m.jsxs("button",{className:"px-4 py-2 hover:bg-white/5 text-left flex items-center gap-2",onClick:()=>{p(`/${c}/${h}/map-editor/create/${t.id}`),U()},children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"map"})," Add Map"]}),m.jsx("div",{className:"h-px bg-white/5 my-1"}),m.jsxs("button",{className:"px-4 py-2 hover:bg-white/5 text-left flex items-center gap-2",onClick:()=>{O(!0),U()},children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"edit"})," Rename Folder"]}),m.jsxs("button",{className:"px-4 py-2 hover:bg-red-500/10 text-red-400 text-left flex items-center gap-2",onClick:()=>{n(t.id,t.parentId),U()},children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})," Delete Folder"]})]}):m.jsxs(m.Fragment,{children:[m.jsxs("button",{className:"px-4 py-2 hover:bg-white/5 text-left flex items-center gap-2 cursor-pointer",onClick:()=>{B(C.id),U()},children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"edit"})," Rename"]}),m.jsxs("button",{className:"px-4 py-2 hover:bg-white/5 text-left flex items-center gap-2 cursor-pointer",onClick:async()=>{try{await et.entityService.toggleFavorite(C.id),window.dispatchEvent(new CustomEvent("favorites-update")),window.dispatchEvent(new CustomEvent("folder-update",{detail:{folderId:t.id}}))}catch(q){console.error(q)}U()},children:[m.jsx("span",{className:"material-symbols-outlined text-sm text-yellow-500",children:"star"})," Toggle Favorite"]}),m.jsxs("button",{className:"px-4 py-2 hover:bg-red-500/10 text-red-400 text-left flex items-center gap-2",onClick:()=>{i(C.id,t.id),U()},children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})," Delete Entity"]})]})]}),v&&m.jsxs("div",{className:"ml-6 pl-4 border-l border-glass-border space-y-1 animate-slide-in",children:[S.folders.map(q=>m.jsx(SD,{folder:q,onCreateSubfolder:e,onRename:r,onDeleteFolder:n,onDeleteEntity:i,onCreateTemplate:a,onMoveEntity:s,onCreateEntity:o,onConfirmCreate:l},q.id)),S.entities.map(q=>q.isNew||q.id===F?m.jsx(Y,{item:q,type:"entity"},q.id):m.jsxs(ff,{to:Die(c,h,q,t.slug||t.id),onContextMenu:te=>H(te,"entity",q.id,q.nombre),className:`flex items-center gap-3 px-3 py-2 rounded-xl text-[11px] font-medium text-text-muted hover:text-white hover:bg-primary/10 transition-all group cursor-grab active:cursor-grabbing ${q.pending?"opacity-50 pointer-events-none":""}`,draggable:!q.pending,onDragStart:te=>{te.dataTransfer.setData("entityId",q.id),te.dataTransfer.setData("sourceFolderId",t.id)},children:[m.jsx("span",{className:"material-symbols-outlined text-sm opacity-70 group-hover:text-primary transition-colors",children:Oie(q.tipoEspecial)}),m.jsx("span",{className:"truncate flex-1",children:q.nombre}),q.favorite&&m.jsx("span",{className:"material-symbols-outlined text-[10px] text-yellow-500",title:"Favorito",children:"star"})]},q.id)),T&&S.folders.length===0&&S.entities.length===0&&m.jsx("div",{className:"px-3 py-2 text-[10px] text-text-muted/30 uppercase font-black italic tracking-tighter",children:"Empty Sector"})]})]})},Iie=({isOpen:t,onClose:e,onCreate:r,parentFolder:n})=>{const[i,a]=ie.useState({nombre:"",descripcion:"",tipo:"FOLDER",canvasType:"BLANK"});if(!t)return null;const s=()=>{r(i),e(),a({nombre:"",descripcion:"",tipo:"FOLDER",canvasType:"BLANK"})},o=[sf.UNIVERSE,sf.GALAXY,sf.SYSTEM,sf.PLANET];return m.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm",children:m.jsxs("div",{className:"bg-[#1a1b26] w-full max-w-4xl rounded-2xl shadow-2xl border border-white/10 overflow-hidden flex flex-col max-h-[90vh]",children:[m.jsxs("div",{className:"p-6 border-b border-white/5 flex justify-between items-center bg-[#1f202e]",children:[m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsx("div",{className:"w-8 h-8 rounded-full bg-indigo-500/20 flex items-center justify-center text-indigo-400",children:m.jsx("span",{className:"material-icons text-sm",children:"add"})}),m.jsx("h2",{className:"text-xl font-semibold text-white",children:n?"Crear Nuevo Espacio":"Crear Nuevo Mapa"})]}),m.jsx("button",{onClick:e,className:"text-gray-400 hover:text-white transition",children:m.jsx("span",{className:"material-icons",children:"close"})})]}),m.jsx("div",{className:"p-8 overflow-y-auto flex-1",children:m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[m.jsxs("div",{className:"space-y-6",children:[m.jsx("h3",{className:"text-sm font-black uppercase tracking-widest text-indigo-400",children:"Identidad"}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-[10px] font-black text-white/30 uppercase mb-2",children:"Nombre del Espacio"}),m.jsx("input",{autoFocus:!0,type:"text",value:i.nombre,onChange:l=>a({...i,nombre:l.target.value}),className:"w-full bg-black/40 border border-white/5 rounded-2xl px-5 py-4 text-white focus:outline-none focus:border-indigo-500/50 transition-all shadow-inner",placeholder:"ej. Sistema Solar"})]}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-[10px] font-black text-white/30 uppercase mb-2",children:"Descripcin"}),m.jsx("textarea",{value:i.descripcion,onChange:l=>a({...i,descripcion:l.target.value}),className:"w-full h-32 bg-black/40 border border-white/5 rounded-2xl px-5 py-4 text-white focus:outline-none focus:border-indigo-500/50 resize-none transition-all",placeholder:"Detalles sobre este nivel jerrquico..."})]})]}),m.jsxs("div",{className:"space-y-6",children:[m.jsx("h3",{className:"text-sm font-black uppercase tracking-widest text-indigo-400",children:"Configuracin"}),m.jsxs("div",{className:"space-y-3",children:[m.jsx("label",{className:"block text-[10px] font-black text-white/30 uppercase mb-1",children:"Tipo de Jerarqua"}),m.jsx("div",{className:"grid grid-cols-2 gap-2",children:o.concat([{id:"FOLDER",label:"Carpeta",icon:"folder",color:"text-white/50"}]).map(l=>m.jsxs("div",{onClick:()=>a({...i,tipo:l.id}),className:`flex items-center gap-3 p-3 rounded-xl border cursor-pointer transition-all ${i.tipo===l.id?"bg-indigo-500/10 border-indigo-500/50":"bg-white/5 border-white/5 hover:bg-white/10"}`,children:[m.jsx("span",{className:`material-icons text-lg ${l.color||""}`,children:l.icon}),m.jsx("span",{className:"text-xs font-bold text-white/80",children:l.label})]},l.id||"FOLDER"))})]}),m.jsx("div",{className:"p-4 rounded-2xl bg-indigo-500/5 border border-indigo-500/10",children:m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("div",{className:"w-10 h-10 rounded-full bg-indigo-500/20 flex items-center justify-center text-indigo-400",children:m.jsx("span",{className:"material-icons",children:"info"})}),m.jsxs("div",{children:[m.jsx("p",{className:"text-[10px] uppercase font-black text-indigo-300",children:"Ubicacin Actual"}),m.jsx("p",{className:"text-xs text-indigo-100/50",children:n?n.nombre:"Raz del Mundo"})]})]})})]})]})}),m.jsxs("div",{className:"p-6 border-t border-white/5 flex justify-end gap-3 bg-[#1f202e]",children:[m.jsx("button",{onClick:e,className:"px-6 py-3 rounded-xl text-xs font-black uppercase tracking-widest text-text-muted hover:text-white transition",children:"Cancelar"}),m.jsx("button",{onClick:s,disabled:!i.nombre,className:"px-8 py-3 rounded-xl bg-indigo-600 hover:bg-indigo-500 text-white text-xs font-black uppercase tracking-widest shadow-lg shadow-indigo-500/20 transition-all disabled:opacity-30 disabled:pointer-events-none",children:"Confirmar y Crear"})]})]})})},jie=()=>{const{username:t,projectName:e}=Zi(),r=Wa(),{handleCreateEntity:n,...i}=jl()||{},{t:a}=bc(),[s,o]=ie.useState([]),[l,u]=ie.useState([]),[c,h]=ie.useState(!1),[p,v]=ie.useState(!1),[y,S]=ie.useState(null),[w,T]=ie.useState(!1),[_,C]=ie.useState(null),N=`/${t}/${e}/bible`;ie.useEffect(()=>{A(),I();const W=()=>I();return window.addEventListener("favorites-update",W),()=>window.removeEventListener("favorites-update",W)},[e]);const A=async()=>{try{const W=await et.get("/world-bible/folders");o(W)}catch(W){console.error("Error loading folders:",W)}},I=async()=>{try{const W=await et.get("/world-bible/favorites");u(W)}catch(W){console.error("Error loading favorites:",W)}},j=(W=null)=>{S(W),v(!0),h(!1)},O=async(W=null,Y="FOLDER")=>{try{const Q=W?typeof W=="object"?W.id:W:null,ne=await et.post("/world-bible/folders",{nombre:a(Y==="TIMELINE"?"bible.new_timeline":"bible.new_folder"),padreId:Q,tipo:Y});if(Q===null){const re=await et.get("/world-bible/folders");o(re),window.dispatchEvent(new CustomEvent("folder-update",{detail:{folderId:null}}))}else window.dispatchEvent(new CustomEvent("folder-update",{detail:{folderId:Q,optimisticType:"folder",item:ne,expand:!0}}))}catch(Q){console.error("Error creating simple folder:",Q)}},F=async W=>{try{const Y=y?y.id:null,Q=await et.post("/world-bible/folders",{nombre:W.nombre,descripcion:W.descripcion,padreId:Y,tipo:W.tipo});if(Y===null){const ne=await et.get("/world-bible/folders");o(ne),window.dispatchEvent(new CustomEvent("folder-update",{detail:{folderId:null}}))}else Q.id||console.error("CRITICAL: Created folder has no ID!",Q),window.dispatchEvent(new CustomEvent("folder-update",{detail:{folderId:Y,optimisticType:"folder",item:Q,expand:!0}}))}catch(Y){console.error(Y),alert("Error creating folder/zone.")}},B=async(W,Y="entidadindividual")=>{const Q=typeof W=="object"?W.slug||W.id:W;r(`${N}/folder/${Q}/entity/new/${Y}`)},$=async(W,Y)=>{try{await et.put(`/world-bible/folders/${W}`,{nombre:Y}),o(Q=>Q.map(ne=>ne.id===W?{...ne,nombre:Y}:ne))}catch(Q){throw Q}},Z=(W,Y=null)=>{C({id:W,parentId:Y,type:"folder"}),T(!0)},D=async()=>{if(!_)return;const{id:W,parentId:Y,type:Q,folderId:ne}=_;try{Q==="folder"?(await et.delete(`/world-bible/folders/${W}`),Y===null&&o(re=>re.filter(q=>q.id!==W)),window.dispatchEvent(new CustomEvent("folder-update",{detail:{folderId:Y,removeId:W,type:"folder"}}))):Q==="entity"&&(await et.delete(`/world-bible/entities/${W}`),window.dispatchEvent(new CustomEvent("folder-update",{detail:{folderId:ne,removeId:W,type:"entity"}})))}catch(re){console.error("Deletion failed:",re),alert("Error trying to delete item.")}finally{C(null)}},H=(W,Y)=>{C({id:W,folderId:Y,type:"entity"}),T(!0)},U=async(W,Y,Q,ne,re)=>{try{if(Q==="folder")typeof W=="number"&&!W.toString().startsWith("temp")&&(await et.put(`/world-bible/folders/${W}`,{nombre:Y}),window.dispatchEvent(new CustomEvent("folder-update",{detail:{folderId:ne,confirmedType:"folder",oldId:W,item:{id:W,nombre:Y,parentId:ne,tipo:re,uiKey:Date.now()}}})),ne||o(q=>q.map(te=>te.id===W?{...te,nombre:Y}:te)));else if(Q==="entity")if(typeof W=="string"&&W.startsWith("new-")){const q=await et.post("/world-bible/entities",{nombre:Y,carpetaId:ne,tipoEspecial:re||"entidadindividual"});window.dispatchEvent(new CustomEvent("folder-update",{detail:{folderId:ne,confirmedType:"entity",oldId:W,item:q}}))}else await et.put(`/world-bible/entities/${W}`,{nombre:Y}),window.dispatchEvent(new CustomEvent("folder-update",{detail:{folderId:ne,confirmedType:"entity",oldId:W,item:{id:W,nombre:Y,carpeta:{id:ne},tipoEspecial:re,slug:W}}})),window.dispatchEvent(new CustomEvent("folder-update",{detail:{folderId:ne}}))}catch(q){console.error("Creation/Rename failed",q),Q==="folder"&&Z(W,ne)}};return m.jsxs("div",{className:"flex h-full w-full bg-background-dark max-w-[1920px] mx-auto",children:[m.jsxs("aside",{className:"w-80 flex-none flex flex-col border-r border-glass-border bg-surface-dark/50 z-10",children:[m.jsx("div",{className:"p-4 border-b border-glass-border",children:m.jsxs("div",{className:"relative group mb-3",children:[m.jsx("span",{className:"material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-text-muted text-sm group-focus-within:text-primary transition-colors",children:"search"}),m.jsx("input",{type:"text",placeholder:a("bible.search_entity"),className:"w-full bg-surface-light/50 border border-glass-border rounded-xl py-2 pl-9 pr-3 text-xs focus:border-primary/50 outline-none transition-all text-white placeholder:text-text-muted/50"})]})}),m.jsxs("div",{className:"px-2 pt-2",children:[m.jsx("div",{className:"flex items-center justify-between px-2 mb-1",children:m.jsx("h2",{className:"text-[10px] font-black uppercase tracking-widest text-text-muted",children:a("bible.favorites")})}),l.length>0?m.jsx("div",{className:"space-y-0.5",children:l.map(W=>m.jsxs("div",{onClick:()=>r(`${N}/folder/${W.carpeta.slug||W.carpeta.id}/entity/${W.slug||W.id}`),className:"flex items-center gap-3 px-3 py-1.5 rounded-lg text-[11px] font-medium text-text-muted hover:text-white hover:bg-white/5 cursor-pointer transition-all group",children:[m.jsx("span",{className:"material-symbols-outlined text-sm text-yellow-500/70 group-hover:text-yellow-400",children:"star"}),m.jsx("span",{className:"truncate",children:W.nombre})]},W.id))}):m.jsx("div",{className:"px-4 py-2 text-[10px] text-text-muted/30 italic",children:a("bible.no_favorites")}),m.jsx("div",{className:"h-px bg-glass-border my-2 opacity-50"})]}),m.jsx("div",{className:"p-4 border-b border-glass-border pt-0",children:m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsx("h2",{className:"text-[10px] font-black uppercase tracking-widest text-text-muted",children:a("bible.explorer")}),m.jsx("div",{className:"relative",children:m.jsx("button",{className:"transition-colors hover:text-white text-primary",onClick:()=>O(null),title:a("bible.new_folder"),children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"create_new_folder"})})})]})}),m.jsx("div",{className:"flex-1 overflow-y-auto no-scrollbar p-2 space-y-0.5",children:s.length===0?m.jsxs("div",{className:"p-8 text-center opacity-30",children:[m.jsx("span",{className:"material-symbols-outlined text-3xl mb-2",children:"folder_off"}),m.jsx("p",{className:"text-[10px] uppercase font-bold",children:a("bible.empty_archive")})]}):s.map(W=>m.jsx(SD,{folder:W,onCreateSubfolder:()=>{},onRename:$,onDeleteFolder:Z,onDeleteEntity:Z,onCreateTemplate:()=>{},onMoveEntity:(Y,Q,ne)=>console.log("move",Y,Q,ne),onCreateEntity:B,onConfirmCreate:U},W.uiKey||W.id))})]}),m.jsx("main",{className:"flex-1 overflow-hidden relative bg-gradient-to-br from-background-dark to-surface-dark/20",children:m.jsx($k,{context:{...i,folders:s,handleCreateEntity:B,handleOpenCreateModal:j,handleDeleteFolder:Z,handleDeleteEntity:H,handleCreateSimpleFolder:O}})}),m.jsx(Iie,{isOpen:p,onClose:()=>v(!1),onCreate:F,parentFolder:y}),m.jsx(qv,{isOpen:w,onClose:()=>T(!1),onConfirm:D,title:_?.type==="folder"?a("bible.delete_folder"):a("bible.delete_entity"),message:_?.type==="folder"?a("bible.delete_folder_msg"):a("bible.delete_entity_msg"),confirmText:a("common.confirm_delete")})]})},Fie=()=>{const{username:t,projectName:e}=Zi();Wa();const{handleOpenCreateModal:r,handleDeleteFolder:n,handleCreateSimpleFolder:i,handleRenameFolder:a,folders:s=[]}=jl(),{t:o}=bc(),[l,u]=ie.useState(null),[c,h]=ie.useState(null),[p,v]=ie.useState(""),y=(T,_)=>{T.preventDefault(),T.stopPropagation(),u({x:T.clientX,y:T.clientY,folder:_})},S=()=>u(null);ie.useEffect(()=>{if(l){const T=()=>S();return window.addEventListener("click",T),()=>window.removeEventListener("click",T)}},[l]);const w=async(T,_)=>{_.trim()&&a&&await a(T,_.trim()),h(null),v("")};return s===void 0?m.jsx("div",{className:"p-20 text-center animate-pulse text-text-muted",children:o("common.loading")}):m.jsxs("div",{className:"flex-1 p-8 max-w-[1600px] mx-auto w-full h-full overflow-y-auto",children:[m.jsxs("header",{className:"mb-8 flex items-end justify-between",children:[m.jsxs("div",{children:[m.jsxs("div",{className:"flex items-center gap-3 text-xs font-black uppercase tracking-widest text-primary italic mb-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"auto_stories"}),o("nav.bible")]}),m.jsx("h1",{className:"text-4xl font-black text-white tracking-tighter",children:o("bible.root_index")}),m.jsx("p",{className:"text-text-muted mt-2 max-w-lg text-sm",children:o("bible.central_archive")})]}),m.jsx("div",{className:"flex items-center gap-2",children:m.jsxs("button",{onClick:()=>i(null,"FOLDER"),className:"px-6 py-2 bg-primary hover:bg-primary-light text-white rounded-xl text-xs font-bold flex items-center gap-2 transition-all shadow-lg shadow-primary/20",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"create_new_folder"})," ",o("bible.new_folder")]})})]}),m.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4",children:s.map(T=>c===T.id?m.jsx("div",{className:"p-4 rounded-3xl bg-surface-dark border border-primary/50",children:m.jsx("input",{autoFocus:!0,type:"text",value:p,onChange:_=>v(_.target.value),onKeyDown:_=>{_.key==="Enter"&&w(T.id,p),_.key==="Escape"&&(h(null),v(""))},onBlur:()=>w(T.id,p),className:"w-full bg-black/30 border border-white/10 rounded-xl p-3 text-sm text-white focus:border-primary/50 outline-none",placeholder:o("common.rename")})},T.id):m.jsx(Vk,{item:T,type:"folder",linkTo:`/${t}/${e}/bible/folder/${T.slug||T.id}`,onDelete:()=>n(T.id),onContextMenu:_=>y(_,T)},T.id))}),s.length===0&&m.jsxs("div",{className:"p-20 text-center border-2 border-dashed border-glass-border rounded-[3rem] opacity-30 mt-8",children:[m.jsx("span",{className:"material-symbols-outlined text-6xl mb-4 text-text-muted",children:"library_books"}),m.jsx("h3",{className:"text-xl font-bold text-white uppercase tracking-widest",children:o("bible.empty_archive")}),m.jsx("p",{className:"text-text-muted mt-2",children:o("bible.empty_archive_desc")})]}),l&&m.jsxs("div",{className:"fixed bg-surface-dark border border-glass-border shadow-2xl rounded-xl py-2 z-50 w-52 text-xs font-medium flex flex-col animate-in fade-in zoom-in-95 duration-150",style:{top:l.y,left:l.x},onClick:T=>T.stopPropagation(),children:[m.jsxs("div",{className:"px-4 py-2 border-b border-white/5 font-bold text-text-muted truncate flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm text-primary",children:"folder"}),l.folder.nombre]}),m.jsxs("button",{className:"px-4 py-2.5 hover:bg-white/5 text-left flex items-center gap-3 text-white/80 hover:text-white transition-colors",onClick:()=>{h(l.folder.id),v(l.folder.nombre),S()},children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"edit"})," ",o("common.rename")]}),m.jsxs("button",{className:"px-4 py-2.5 hover:bg-red-500/10 text-red-400 text-left flex items-center gap-3 transition-colors",onClick:()=>{n(l.folder.id),S()},children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})," ",o("bible.delete_folder")]})]})]})};function Bie(){const[t,e]=ie.useState("deep_space"),[r,n]=ie.useState(null);return ie.useEffect(()=>{const i=localStorage.getItem("app_settings");if(i){const o=JSON.parse(i);o.theme&&e(o.theme)}const a=localStorage.getItem("user");a&&a!=="undefined"&&n(JSON.parse(a));const s=()=>{const o=localStorage.getItem("app_settings");if(o){const u=JSON.parse(o);u.theme&&e(u.theme)}const l=localStorage.getItem("user");l&&l!=="undefined"&&n(JSON.parse(l))};return window.addEventListener("storage_update",s),()=>window.removeEventListener("storage_update",s)},[]),ie.useEffect(()=>{document.body.classList.forEach(i=>{i.startsWith("theme-")&&document.body.classList.remove(i)}),document.body.classList.add(`theme-${t}`)},[t]),m.jsx(fj,{children:m.jsx("div",{className:`app-container theme-${t} h-screen w-screen overflow-hidden`,children:m.jsx(tI,{children:m.jsxs($8,{children:[m.jsx(qn,{path:"/",element:m.jsx(WI,{})}),m.jsxs(qn,{element:m.jsx(BI,{}),children:[m.jsx(qn,{path:"/settings",element:m.jsx(mj,{})}),m.jsxs(qn,{path:"/:username/:projectName",element:m.jsx(vj,{}),children:[m.jsx(qn,{index:!0,element:m.jsx(pj,{})}),m.jsx(qn,{path:"writing",element:m.jsx(Cie,{})}),m.jsx(qn,{path:"writing/:notebookId",element:m.jsx(_ie,{})}),m.jsx(qn,{path:"entities/:type/:entityId",element:m.jsx(pG,{})}),m.jsx(qn,{path:"map-editor/create/:folderId",element:m.jsx(ek,{mode:"create"})}),m.jsx(qn,{path:"map-editor/edit/:entityId",element:m.jsx(ek,{mode:"edit"})}),m.jsxs(qn,{path:"bible",element:m.jsx(jie,{}),children:[m.jsx(qn,{index:!0,element:m.jsx(Fie,{})}),m.jsx(qn,{path:"folder/:folderSlug/entity/new/:type",element:m.jsx(Vg,{mode:"creation"})}),m.jsx(qn,{path:"folder/:folderSlug",element:m.jsx(Lie,{})}),m.jsx(qn,{path:"entity/:entitySlug",element:m.jsx(Vg,{})}),m.jsx(qn,{path:"folder/:folderSlug/entity/:entitySlug",element:m.jsx(Vg,{})}),m.jsx(qn,{path:"folder/:folderSlug/map/:entitySlug",element:m.jsx(Vg,{})}),m.jsx(qn,{path:"folder/:folderSlug/timeline/:entitySlug",element:m.jsx(Vg,{})})]}),m.jsx(qn,{path:"map",element:m.jsx(FH,{})}),m.jsx(qn,{path:"timeline",element:m.jsx(mG,{})}),m.jsx(qn,{path:"languages",element:m.jsx(GK,{})}),m.jsx(qn,{path:"trash",element:m.jsx(Eie,{})}),m.jsx(qn,{path:"graph",element:m.jsx(uG,{})})]})]})]})})})})}const PC=(t,e,r,n="")=>{fetch("/api/logs/error",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({source:t,message:e,stack:r,componentStack:n})}).catch(i=>console.error("Failed to send error log:",i))};window.onerror=(t,e,r,n,i)=>{PC("Global Window Error",t,i?i.stack:`${e}:${r}:${n}`)};window.onunhandledrejection=t=>{PC("Unhandled Promise Rejection",t.reason?t.reason.message:"Unknown reason",t.reason?t.reason.stack:"")};class zie extends nr.Component{constructor(e){super(e),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(e){return{hasError:!0}}componentDidCatch(e,r){this.setState({error:e,errorInfo:r}),console.error("Uncaught Error:",e,r),PC("React ErrorBoundary",e.message,e.stack,r.componentStack)}render(){return this.state.hasError?m.jsxs("div",{style:{padding:20,background:"#222",color:"red",height:"100vh"},children:[m.jsx("h1",{children:"Something went wrong."}),m.jsxs("details",{style:{whiteSpace:"pre-wrap"},children:[this.state.error&&this.state.error.toString(),m.jsx("br",{}),this.state.errorInfo&&this.state.errorInfo.componentStack]})]}):this.props.children}}const lM=document.getElementById("root");lM?t8.createRoot(lM).render(m.jsx(nr.StrictMode,{children:m.jsx(zie,{children:m.jsx(Bie,{})})})):console.error("React root element not found (looked for #root)")});export default Uie();
