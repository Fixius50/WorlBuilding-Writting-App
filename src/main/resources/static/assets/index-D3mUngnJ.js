var UD=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var Hie=UD(Ye=>{function GD(t,e){for(var r=0;r<e.length;r++){const n=e[r];if(typeof n!="string"&&!Array.isArray(n)){for(const i in n)if(i!=="default"&&!(i in t)){const a=Object.getOwnPropertyDescriptor(n,i);a&&Object.defineProperty(t,i,a.get?a:{enumerable:!0,get:()=>n[i]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function r(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(i){if(i.ep)return;i.ep=!0;const a=r(i);fetch(i.href,a)}})();var iE=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Th(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Ob={exports:{}},Fm={},Db={exports:{}},Mr={};var aE;function VD(){if(aE)return Mr;aE=1;var t=Symbol.for("react.element"),e=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),a=Symbol.for("react.provider"),s=Symbol.for("react.context"),o=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),c=Symbol.for("react.lazy"),f=Symbol.iterator;function p(Y){return Y===null||typeof Y!="object"?null:(Y=f&&Y[f]||Y["@@iterator"],typeof Y=="function"?Y:null)}var v={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},y=Object.assign,S={};function w(Y,J,ie){this.props=Y,this.context=J,this.refs=S,this.updater=ie||v}w.prototype.isReactComponent={},w.prototype.setState=function(Y,J){if(typeof Y!="object"&&typeof Y!="function"&&Y!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,Y,J,"setState")},w.prototype.forceUpdate=function(Y){this.updater.enqueueForceUpdate(this,Y,"forceUpdate")};function E(){}E.prototype=w.prototype;function _(Y,J,ie){this.props=Y,this.context=J,this.refs=S,this.updater=ie||v}var T=_.prototype=new E;T.constructor=_,y(T,w.prototype),T.isPureReactComponent=!0;var N=Array.isArray,R=Object.prototype.hasOwnProperty,I={current:null},F={key:!0,ref:!0,__self:!0,__source:!0};function D(Y,J,ie){var de,he={},xe=null,le=null;if(J!=null)for(de in J.ref!==void 0&&(le=J.ref),J.key!==void 0&&(xe=""+J.key),J)R.call(J,de)&&!F.hasOwnProperty(de)&&(he[de]=J[de]);var fe=arguments.length-2;if(fe===1)he.children=ie;else if(1<fe){for(var ve=Array(fe),ge=0;ge<fe;ge++)ve[ge]=arguments[ge+2];he.children=ve}if(Y&&Y.defaultProps)for(de in fe=Y.defaultProps,fe)he[de]===void 0&&(he[de]=fe[de]);return{$$typeof:t,type:Y,key:xe,ref:le,props:he,_owner:I.current}}function j(Y,J){return{$$typeof:t,type:Y.type,key:J,ref:Y.ref,props:Y.props,_owner:Y._owner}}function B(Y){return typeof Y=="object"&&Y!==null&&Y.$$typeof===t}function G(Y){var J={"=":"=0",":":"=2"};return"$"+Y.replace(/[=:]/g,function(ie){return J[ie]})}var K=/\/+/g;function O(Y,J){return typeof Y=="object"&&Y!==null&&Y.key!=null?G(""+Y.key):J.toString(36)}function W(Y,J,ie,de,he){var xe=typeof Y;(xe==="undefined"||xe==="boolean")&&(Y=null);var le=!1;if(Y===null)le=!0;else switch(xe){case"string":case"number":le=!0;break;case"object":switch(Y.$$typeof){case t:case e:le=!0}}if(le)return le=Y,he=he(le),Y=de===""?"."+O(le,0):de,N(he)?(ie="",Y!=null&&(ie=Y.replace(K,"$&/")+"/"),W(he,J,ie,"",function(ge){return ge})):he!=null&&(B(he)&&(he=j(he,ie+(!he.key||le&&le.key===he.key?"":(""+he.key).replace(K,"$&/")+"/")+Y)),J.push(he)),1;if(le=0,de=de===""?".":de+":",N(Y))for(var fe=0;fe<Y.length;fe++){xe=Y[fe];var ve=de+O(xe,fe);le+=W(xe,J,ie,ve,he)}else if(ve=p(Y),typeof ve=="function")for(Y=ve.call(Y),fe=0;!(xe=Y.next()).done;)xe=xe.value,ve=de+O(xe,fe++),le+=W(xe,J,ie,ve,he);else if(xe==="object")throw J=String(Y),Error("Objects are not valid as a React child (found: "+(J==="[object Object]"?"object with keys {"+Object.keys(Y).join(", ")+"}":J)+"). If you meant to render a collection of children, use an array instead.");return le}function U(Y,J,ie){if(Y==null)return Y;var de=[],he=0;return W(Y,de,"","",function(xe){return J.call(ie,xe,he++)}),de}function q(Y){if(Y._status===-1){var J=Y._result;J=J(),J.then(function(ie){(Y._status===0||Y._status===-1)&&(Y._status=1,Y._result=ie)},function(ie){(Y._status===0||Y._status===-1)&&(Y._status=2,Y._result=ie)}),Y._status===-1&&(Y._status=0,Y._result=J)}if(Y._status===1)return Y._result.default;throw Y._result}var Z={current:null},Q={transition:null},ne={ReactCurrentDispatcher:Z,ReactCurrentBatchConfig:Q,ReactCurrentOwner:I};function re(){throw Error("act(...) is not supported in production builds of React.")}return Mr.Children={map:U,forEach:function(Y,J,ie){U(Y,function(){J.apply(this,arguments)},ie)},count:function(Y){var J=0;return U(Y,function(){J++}),J},toArray:function(Y){return U(Y,function(J){return J})||[]},only:function(Y){if(!B(Y))throw Error("React.Children.only expected to receive a single React element child.");return Y}},Mr.Component=w,Mr.Fragment=r,Mr.Profiler=i,Mr.PureComponent=_,Mr.StrictMode=n,Mr.Suspense=l,Mr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ne,Mr.act=re,Mr.cloneElement=function(Y,J,ie){if(Y==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+Y+".");var de=y({},Y.props),he=Y.key,xe=Y.ref,le=Y._owner;if(J!=null){if(J.ref!==void 0&&(xe=J.ref,le=I.current),J.key!==void 0&&(he=""+J.key),Y.type&&Y.type.defaultProps)var fe=Y.type.defaultProps;for(ve in J)R.call(J,ve)&&!F.hasOwnProperty(ve)&&(de[ve]=J[ve]===void 0&&fe!==void 0?fe[ve]:J[ve])}var ve=arguments.length-2;if(ve===1)de.children=ie;else if(1<ve){fe=Array(ve);for(var ge=0;ge<ve;ge++)fe[ge]=arguments[ge+2];de.children=fe}return{$$typeof:t,type:Y.type,key:he,ref:xe,props:de,_owner:le}},Mr.createContext=function(Y){return Y={$$typeof:s,_currentValue:Y,_currentValue2:Y,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},Y.Provider={$$typeof:a,_context:Y},Y.Consumer=Y},Mr.createElement=D,Mr.createFactory=function(Y){var J=D.bind(null,Y);return J.type=Y,J},Mr.createRef=function(){return{current:null}},Mr.forwardRef=function(Y){return{$$typeof:o,render:Y}},Mr.isValidElement=B,Mr.lazy=function(Y){return{$$typeof:c,_payload:{_status:-1,_result:Y},_init:q}},Mr.memo=function(Y,J){return{$$typeof:u,type:Y,compare:J===void 0?null:J}},Mr.startTransition=function(Y){var J=Q.transition;Q.transition={};try{Y()}finally{Q.transition=J}},Mr.unstable_act=re,Mr.useCallback=function(Y,J){return Z.current.useCallback(Y,J)},Mr.useContext=function(Y){return Z.current.useContext(Y)},Mr.useDebugValue=function(){},Mr.useDeferredValue=function(Y){return Z.current.useDeferredValue(Y)},Mr.useEffect=function(Y,J){return Z.current.useEffect(Y,J)},Mr.useId=function(){return Z.current.useId()},Mr.useImperativeHandle=function(Y,J,ie){return Z.current.useImperativeHandle(Y,J,ie)},Mr.useInsertionEffect=function(Y,J){return Z.current.useInsertionEffect(Y,J)},Mr.useLayoutEffect=function(Y,J){return Z.current.useLayoutEffect(Y,J)},Mr.useMemo=function(Y,J){return Z.current.useMemo(Y,J)},Mr.useReducer=function(Y,J,ie){return Z.current.useReducer(Y,J,ie)},Mr.useRef=function(Y){return Z.current.useRef(Y)},Mr.useState=function(Y){return Z.current.useState(Y)},Mr.useSyncExternalStore=function(Y,J,ie){return Z.current.useSyncExternalStore(Y,J,ie)},Mr.useTransition=function(){return Z.current.useTransition()},Mr.version="18.3.1",Mr}var sE;function sm(){return sE||(sE=1,Db.exports=VD()),Db.exports}var oE;function HD(){if(oE)return Fm;oE=1;var t=sm(),e=Symbol.for("react.element"),r=Symbol.for("react.fragment"),n=Object.prototype.hasOwnProperty,i=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,a={key:!0,ref:!0,__self:!0,__source:!0};function s(o,l,u){var c,f={},p=null,v=null;u!==void 0&&(p=""+u),l.key!==void 0&&(p=""+l.key),l.ref!==void 0&&(v=l.ref);for(c in l)n.call(l,c)&&!a.hasOwnProperty(c)&&(f[c]=l[c]);if(o&&o.defaultProps)for(c in l=o.defaultProps,l)f[c]===void 0&&(f[c]=l[c]);return{$$typeof:e,type:o,key:p,ref:v,props:f,_owner:i.current}}return Fm.Fragment=r,Fm.jsx=s,Fm.jsxs=s,Fm}var lE;function WD(){return lE||(lE=1,Ob.exports=HD()),Ob.exports}var m=WD(),ae=sm();const nr=Th(ae),qD=GD({__proto__:null,default:nr},[ae]);var K0={},Ib={exports:{}},Ws={},jb={exports:{}},Fb={};var uE;function $D(){return uE||(uE=1,(function(t){function e(Q,ne){var re=Q.length;Q.push(ne);e:for(;0<re;){var Y=re-1>>>1,J=Q[Y];if(0<i(J,ne))Q[Y]=ne,Q[re]=J,re=Y;else break e}}function r(Q){return Q.length===0?null:Q[0]}function n(Q){if(Q.length===0)return null;var ne=Q[0],re=Q.pop();if(re!==ne){Q[0]=re;e:for(var Y=0,J=Q.length,ie=J>>>1;Y<ie;){var de=2*(Y+1)-1,he=Q[de],xe=de+1,le=Q[xe];if(0>i(he,re))xe<J&&0>i(le,he)?(Q[Y]=le,Q[xe]=re,Y=xe):(Q[Y]=he,Q[de]=re,Y=de);else if(xe<J&&0>i(le,re))Q[Y]=le,Q[xe]=re,Y=xe;else break e}}return ne}function i(Q,ne){var re=Q.sortIndex-ne.sortIndex;return re!==0?re:Q.id-ne.id}if(typeof performance=="object"&&typeof performance.now=="function"){var a=performance;t.unstable_now=function(){return a.now()}}else{var s=Date,o=s.now();t.unstable_now=function(){return s.now()-o}}var l=[],u=[],c=1,f=null,p=3,v=!1,y=!1,S=!1,w=typeof setTimeout=="function"?setTimeout:null,E=typeof clearTimeout=="function"?clearTimeout:null,_=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function T(Q){for(var ne=r(u);ne!==null;){if(ne.callback===null)n(u);else if(ne.startTime<=Q)n(u),ne.sortIndex=ne.expirationTime,e(l,ne);else break;ne=r(u)}}function N(Q){if(S=!1,T(Q),!y)if(r(l)!==null)y=!0,q(R);else{var ne=r(u);ne!==null&&Z(N,ne.startTime-Q)}}function R(Q,ne){y=!1,S&&(S=!1,E(D),D=-1),v=!0;var re=p;try{for(T(ne),f=r(l);f!==null&&(!(f.expirationTime>ne)||Q&&!G());){var Y=f.callback;if(typeof Y=="function"){f.callback=null,p=f.priorityLevel;var J=Y(f.expirationTime<=ne);ne=t.unstable_now(),typeof J=="function"?f.callback=J:f===r(l)&&n(l),T(ne)}else n(l);f=r(l)}if(f!==null)var ie=!0;else{var de=r(u);de!==null&&Z(N,de.startTime-ne),ie=!1}return ie}finally{f=null,p=re,v=!1}}var I=!1,F=null,D=-1,j=5,B=-1;function G(){return!(t.unstable_now()-B<j)}function K(){if(F!==null){var Q=t.unstable_now();B=Q;var ne=!0;try{ne=F(!0,Q)}finally{ne?O():(I=!1,F=null)}}else I=!1}var O;if(typeof _=="function")O=function(){_(K)};else if(typeof MessageChannel<"u"){var W=new MessageChannel,U=W.port2;W.port1.onmessage=K,O=function(){U.postMessage(null)}}else O=function(){w(K,0)};function q(Q){F=Q,I||(I=!0,O())}function Z(Q,ne){D=w(function(){Q(t.unstable_now())},ne)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(Q){Q.callback=null},t.unstable_continueExecution=function(){y||v||(y=!0,q(R))},t.unstable_forceFrameRate=function(Q){0>Q||125<Q?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):j=0<Q?Math.floor(1e3/Q):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_getFirstCallbackNode=function(){return r(l)},t.unstable_next=function(Q){switch(p){case 1:case 2:case 3:var ne=3;break;default:ne=p}var re=p;p=ne;try{return Q()}finally{p=re}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(Q,ne){switch(Q){case 1:case 2:case 3:case 4:case 5:break;default:Q=3}var re=p;p=Q;try{return ne()}finally{p=re}},t.unstable_scheduleCallback=function(Q,ne,re){var Y=t.unstable_now();switch(typeof re=="object"&&re!==null?(re=re.delay,re=typeof re=="number"&&0<re?Y+re:Y):re=Y,Q){case 1:var J=-1;break;case 2:J=250;break;case 5:J=1073741823;break;case 4:J=1e4;break;default:J=5e3}return J=re+J,Q={id:c++,callback:ne,priorityLevel:Q,startTime:re,expirationTime:J,sortIndex:-1},re>Y?(Q.sortIndex=re,e(u,Q),r(l)===null&&Q===r(u)&&(S?(E(D),D=-1):S=!0,Z(N,re-Y))):(Q.sortIndex=J,e(l,Q),y||v||(y=!0,q(R))),Q},t.unstable_shouldYield=G,t.unstable_wrapCallback=function(Q){var ne=p;return function(){var re=p;p=ne;try{return Q.apply(this,arguments)}finally{p=re}}}})(Fb)),Fb}var cE;function Hk(){return cE||(cE=1,jb.exports=$D()),jb.exports}var dE;function KD(){if(dE)return Ws;dE=1;var t=sm(),e=Hk();function r(d){for(var g="https://reactjs.org/docs/error-decoder.html?invariant="+d,C=1;C<arguments.length;C++)g+="&args[]="+encodeURIComponent(arguments[C]);return"Minified React error #"+d+"; visit "+g+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var n=new Set,i={};function a(d,g){s(d,g),s(d+"Capture",g)}function s(d,g){for(i[d]=g,d=0;d<g.length;d++)n.add(g[d])}var o=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),l=Object.prototype.hasOwnProperty,u=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,c={},f={};function p(d){return l.call(f,d)?!0:l.call(c,d)?!1:u.test(d)?f[d]=!0:(c[d]=!0,!1)}function v(d,g,C,A){if(C!==null&&C.type===0)return!1;switch(typeof g){case"function":case"symbol":return!0;case"boolean":return A?!1:C!==null?!C.acceptsBooleans:(d=d.toLowerCase().slice(0,5),d!=="data-"&&d!=="aria-");default:return!1}}function y(d,g,C,A){if(g===null||typeof g>"u"||v(d,g,C,A))return!0;if(A)return!1;if(C!==null)switch(C.type){case 3:return!g;case 4:return g===!1;case 5:return isNaN(g);case 6:return isNaN(g)||1>g}return!1}function S(d,g,C,A,H,X,oe){this.acceptsBooleans=g===2||g===3||g===4,this.attributeName=A,this.attributeNamespace=H,this.mustUseProperty=C,this.propertyName=d,this.type=g,this.sanitizeURL=X,this.removeEmptyString=oe}var w={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(d){w[d]=new S(d,0,!1,d,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(d){var g=d[0];w[g]=new S(g,1,!1,d[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(d){w[d]=new S(d,2,!1,d.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(d){w[d]=new S(d,2,!1,d,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(d){w[d]=new S(d,3,!1,d.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(d){w[d]=new S(d,3,!0,d,null,!1,!1)}),["capture","download"].forEach(function(d){w[d]=new S(d,4,!1,d,null,!1,!1)}),["cols","rows","size","span"].forEach(function(d){w[d]=new S(d,6,!1,d,null,!1,!1)}),["rowSpan","start"].forEach(function(d){w[d]=new S(d,5,!1,d.toLowerCase(),null,!1,!1)});var E=/[\-:]([a-z])/g;function _(d){return d[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(d){var g=d.replace(E,_);w[g]=new S(g,1,!1,d,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(d){var g=d.replace(E,_);w[g]=new S(g,1,!1,d,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(d){var g=d.replace(E,_);w[g]=new S(g,1,!1,d,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(d){w[d]=new S(d,1,!1,d.toLowerCase(),null,!1,!1)}),w.xlinkHref=new S("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(d){w[d]=new S(d,1,!1,d.toLowerCase(),null,!0,!0)});function T(d,g,C,A){var H=w.hasOwnProperty(g)?w[g]:null;(H!==null?H.type!==0:A||!(2<g.length)||g[0]!=="o"&&g[0]!=="O"||g[1]!=="n"&&g[1]!=="N")&&(y(g,C,H,A)&&(C=null),A||H===null?p(g)&&(C===null?d.removeAttribute(g):d.setAttribute(g,""+C)):H.mustUseProperty?d[H.propertyName]=C===null?H.type===3?!1:"":C:(g=H.attributeName,A=H.attributeNamespace,C===null?d.removeAttribute(g):(H=H.type,C=H===3||H===4&&C===!0?"":""+C,A?d.setAttributeNS(A,g,C):d.setAttribute(g,C))))}var N=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,R=Symbol.for("react.element"),I=Symbol.for("react.portal"),F=Symbol.for("react.fragment"),D=Symbol.for("react.strict_mode"),j=Symbol.for("react.profiler"),B=Symbol.for("react.provider"),G=Symbol.for("react.context"),K=Symbol.for("react.forward_ref"),O=Symbol.for("react.suspense"),W=Symbol.for("react.suspense_list"),U=Symbol.for("react.memo"),q=Symbol.for("react.lazy"),Z=Symbol.for("react.offscreen"),Q=Symbol.iterator;function ne(d){return d===null||typeof d!="object"?null:(d=Q&&d[Q]||d["@@iterator"],typeof d=="function"?d:null)}var re=Object.assign,Y;function J(d){if(Y===void 0)try{throw Error()}catch(C){var g=C.stack.trim().match(/\n( *(at )?)/);Y=g&&g[1]||""}return`
`+Y+d}var ie=!1;function de(d,g){if(!d||ie)return"";ie=!0;var C=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(g)if(g=function(){throw Error()},Object.defineProperty(g.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(g,[])}catch(Fe){var A=Fe}Reflect.construct(d,[],g)}else{try{g.call()}catch(Fe){A=Fe}d.call(g.prototype)}else{try{throw Error()}catch(Fe){A=Fe}d()}}catch(Fe){if(Fe&&A&&typeof Fe.stack=="string"){for(var H=Fe.stack.split(`
`),X=A.stack.split(`
`),oe=H.length-1,be=X.length-1;1<=oe&&0<=be&&H[oe]!==X[be];)be--;for(;1<=oe&&0<=be;oe--,be--)if(H[oe]!==X[be]){if(oe!==1||be!==1)do if(oe--,be--,0>be||H[oe]!==X[be]){var _e=`
`+H[oe].replace(" at new "," at ");return d.displayName&&_e.includes("<anonymous>")&&(_e=_e.replace("<anonymous>",d.displayName)),_e}while(1<=oe&&0<=be);break}}}finally{ie=!1,Error.prepareStackTrace=C}return(d=d?d.displayName||d.name:"")?J(d):""}function he(d){switch(d.tag){case 5:return J(d.type);case 16:return J("Lazy");case 13:return J("Suspense");case 19:return J("SuspenseList");case 0:case 2:case 15:return d=de(d.type,!1),d;case 11:return d=de(d.type.render,!1),d;case 1:return d=de(d.type,!0),d;default:return""}}function xe(d){if(d==null)return null;if(typeof d=="function")return d.displayName||d.name||null;if(typeof d=="string")return d;switch(d){case F:return"Fragment";case I:return"Portal";case j:return"Profiler";case D:return"StrictMode";case O:return"Suspense";case W:return"SuspenseList"}if(typeof d=="object")switch(d.$$typeof){case G:return(d.displayName||"Context")+".Consumer";case B:return(d._context.displayName||"Context")+".Provider";case K:var g=d.render;return d=d.displayName,d||(d=g.displayName||g.name||"",d=d!==""?"ForwardRef("+d+")":"ForwardRef"),d;case U:return g=d.displayName||null,g!==null?g:xe(d.type)||"Memo";case q:g=d._payload,d=d._init;try{return xe(d(g))}catch{}}return null}function le(d){var g=d.type;switch(d.tag){case 24:return"Cache";case 9:return(g.displayName||"Context")+".Consumer";case 10:return(g._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return d=g.render,d=d.displayName||d.name||"",g.displayName||(d!==""?"ForwardRef("+d+")":"ForwardRef");case 7:return"Fragment";case 5:return g;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return xe(g);case 8:return g===D?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof g=="function")return g.displayName||g.name||null;if(typeof g=="string")return g}return null}function fe(d){switch(typeof d){case"boolean":case"number":case"string":case"undefined":return d;case"object":return d;default:return""}}function ve(d){var g=d.type;return(d=d.nodeName)&&d.toLowerCase()==="input"&&(g==="checkbox"||g==="radio")}function ge(d){var g=ve(d)?"checked":"value",C=Object.getOwnPropertyDescriptor(d.constructor.prototype,g),A=""+d[g];if(!d.hasOwnProperty(g)&&typeof C<"u"&&typeof C.get=="function"&&typeof C.set=="function"){var H=C.get,X=C.set;return Object.defineProperty(d,g,{configurable:!0,get:function(){return H.call(this)},set:function(oe){A=""+oe,X.call(this,oe)}}),Object.defineProperty(d,g,{enumerable:C.enumerable}),{getValue:function(){return A},setValue:function(oe){A=""+oe},stopTracking:function(){d._valueTracker=null,delete d[g]}}}}function se(d){d._valueTracker||(d._valueTracker=ge(d))}function ye(d){if(!d)return!1;var g=d._valueTracker;if(!g)return!0;var C=g.getValue(),A="";return d&&(A=ve(d)?d.checked?"true":"false":d.value),d=A,d!==C?(g.setValue(d),!0):!1}function Se(d){if(d=d||(typeof document<"u"?document:void 0),typeof d>"u")return null;try{return d.activeElement||d.body}catch{return d.body}}function Ue(d,g){var C=g.checked;return re({},g,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:C??d._wrapperState.initialChecked})}function Oe(d,g){var C=g.defaultValue==null?"":g.defaultValue,A=g.checked!=null?g.checked:g.defaultChecked;C=fe(g.value!=null?g.value:C),d._wrapperState={initialChecked:A,initialValue:C,controlled:g.type==="checkbox"||g.type==="radio"?g.checked!=null:g.value!=null}}function mt(d,g){g=g.checked,g!=null&&T(d,"checked",g,!1)}function lt(d,g){mt(d,g);var C=fe(g.value),A=g.type;if(C!=null)A==="number"?(C===0&&d.value===""||d.value!=C)&&(d.value=""+C):d.value!==""+C&&(d.value=""+C);else if(A==="submit"||A==="reset"){d.removeAttribute("value");return}g.hasOwnProperty("value")?wt(d,g.type,C):g.hasOwnProperty("defaultValue")&&wt(d,g.type,fe(g.defaultValue)),g.checked==null&&g.defaultChecked!=null&&(d.defaultChecked=!!g.defaultChecked)}function at(d,g,C){if(g.hasOwnProperty("value")||g.hasOwnProperty("defaultValue")){var A=g.type;if(!(A!=="submit"&&A!=="reset"||g.value!==void 0&&g.value!==null))return;g=""+d._wrapperState.initialValue,C||g===d.value||(d.value=g),d.defaultValue=g}C=d.name,C!==""&&(d.name=""),d.defaultChecked=!!d._wrapperState.initialChecked,C!==""&&(d.name=C)}function wt(d,g,C){(g!=="number"||Se(d.ownerDocument)!==d)&&(C==null?d.defaultValue=""+d._wrapperState.initialValue:d.defaultValue!==""+C&&(d.defaultValue=""+C))}var $e=Array.isArray;function Ce(d,g,C,A){if(d=d.options,g){g={};for(var H=0;H<C.length;H++)g["$"+C[H]]=!0;for(C=0;C<d.length;C++)H=g.hasOwnProperty("$"+d[C].value),d[C].selected!==H&&(d[C].selected=H),H&&A&&(d[C].defaultSelected=!0)}else{for(C=""+fe(C),g=null,H=0;H<d.length;H++){if(d[H].value===C){d[H].selected=!0,A&&(d[H].defaultSelected=!0);return}g!==null||d[H].disabled||(g=d[H])}g!==null&&(g.selected=!0)}}function Ie(d,g){if(g.dangerouslySetInnerHTML!=null)throw Error(r(91));return re({},g,{value:void 0,defaultValue:void 0,children:""+d._wrapperState.initialValue})}function Je(d,g){var C=g.value;if(C==null){if(C=g.children,g=g.defaultValue,C!=null){if(g!=null)throw Error(r(92));if($e(C)){if(1<C.length)throw Error(r(93));C=C[0]}g=C}g==null&&(g=""),C=g}d._wrapperState={initialValue:fe(C)}}function Qe(d,g){var C=fe(g.value),A=fe(g.defaultValue);C!=null&&(C=""+C,C!==d.value&&(d.value=C),g.defaultValue==null&&d.defaultValue!==C&&(d.defaultValue=C)),A!=null&&(d.defaultValue=""+A)}function gt(d){var g=d.textContent;g===d._wrapperState.initialValue&&g!==""&&g!==null&&(d.value=g)}function At(d){switch(d){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Rt(d,g){return d==null||d==="http://www.w3.org/1999/xhtml"?At(g):d==="http://www.w3.org/2000/svg"&&g==="foreignObject"?"http://www.w3.org/1999/xhtml":d}var Ut,Vt=(function(d){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(g,C,A,H){MSApp.execUnsafeLocalFunction(function(){return d(g,C,A,H)})}:d})(function(d,g){if(d.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in d)d.innerHTML=g;else{for(Ut=Ut||document.createElement("div"),Ut.innerHTML="<svg>"+g.valueOf().toString()+"</svg>",g=Ut.firstChild;d.firstChild;)d.removeChild(d.firstChild);for(;g.firstChild;)d.appendChild(g.firstChild)}});function pt(d,g){if(g){var C=d.firstChild;if(C&&C===d.lastChild&&C.nodeType===3){C.nodeValue=g;return}}d.textContent=g}var dt={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Ge=["Webkit","ms","Moz","O"];Object.keys(dt).forEach(function(d){Ge.forEach(function(g){g=g+d.charAt(0).toUpperCase()+d.substring(1),dt[g]=dt[d]})});function ce(d,g,C){return g==null||typeof g=="boolean"||g===""?"":C||typeof g!="number"||g===0||dt.hasOwnProperty(d)&&dt[d]?(""+g).trim():g+"px"}function me(d,g){d=d.style;for(var C in g)if(g.hasOwnProperty(C)){var A=C.indexOf("--")===0,H=ce(C,g[C],A);C==="float"&&(C="cssFloat"),A?d.setProperty(C,H):d[C]=H}}var ke=re({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Te(d,g){if(g){if(ke[d]&&(g.children!=null||g.dangerouslySetInnerHTML!=null))throw Error(r(137,d));if(g.dangerouslySetInnerHTML!=null){if(g.children!=null)throw Error(r(60));if(typeof g.dangerouslySetInnerHTML!="object"||!("__html"in g.dangerouslySetInnerHTML))throw Error(r(61))}if(g.style!=null&&typeof g.style!="object")throw Error(r(62))}}function Ae(d,g){if(d.indexOf("-")===-1)return typeof g.is=="string";switch(d){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Xe=null;function Ve(d){return d=d.target||d.srcElement||window,d.correspondingUseElement&&(d=d.correspondingUseElement),d.nodeType===3?d.parentNode:d}var yt=null,vt=null,ft=null;function Zt(d){if(d=wl(d)){if(typeof yt!="function")throw Error(r(280));var g=d.stateNode;g&&(g=si(g),yt(d.stateNode,d.type,g))}}function Ht(d){vt?ft?ft.push(d):ft=[d]:vt=d}function Et(){if(vt){var d=vt,g=ft;if(ft=vt=null,Zt(d),g)for(d=0;d<g.length;d++)Zt(g[d])}}function Wt(d,g){return d(g)}function ar(){}var Rr=!1;function kr(d,g,C){if(Rr)return d(g,C);Rr=!0;try{return Wt(d,g,C)}finally{Rr=!1,(vt!==null||ft!==null)&&(ar(),Et())}}function Qr(d,g){var C=d.stateNode;if(C===null)return null;var A=si(C);if(A===null)return null;C=A[g];e:switch(g){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(A=!A.disabled)||(d=d.type,A=!(d==="button"||d==="input"||d==="select"||d==="textarea")),d=!A;break e;default:d=!1}if(d)return null;if(C&&typeof C!="function")throw Error(r(231,g,typeof C));return C}var Jr=!1;if(o)try{var _r={};Object.defineProperty(_r,"passive",{get:function(){Jr=!0}}),window.addEventListener("test",_r,_r),window.removeEventListener("test",_r,_r)}catch{Jr=!1}function fn(d,g,C,A,H,X,oe,be,_e){var Fe=Array.prototype.slice.call(arguments,3);try{g.apply(C,Fe)}catch(nt){this.onError(nt)}}var vr=!1,St=null,Br=!1,Xn=null,Yi={onError:function(d){vr=!0,St=d}};function ds(d,g,C,A,H,X,oe,be,_e){vr=!1,St=null,fn.apply(Yi,arguments)}function As(d,g,C,A,H,X,oe,be,_e){if(ds.apply(this,arguments),vr){if(vr){var Fe=St;vr=!1,St=null}else throw Error(r(198));Br||(Br=!0,Xn=Fe)}}function ni(d){var g=d,C=d;if(d.alternate)for(;g.return;)g=g.return;else{d=g;do g=d,(g.flags&4098)!==0&&(C=g.return),d=g.return;while(d)}return g.tag===3?C:null}function sn(d){if(d.tag===13){var g=d.memoizedState;if(g===null&&(d=d.alternate,d!==null&&(g=d.memoizedState)),g!==null)return g.dehydrated}return null}function kn(d){if(ni(d)!==d)throw Error(r(188))}function In(d){var g=d.alternate;if(!g){if(g=ni(d),g===null)throw Error(r(188));return g!==d?null:d}for(var C=d,A=g;;){var H=C.return;if(H===null)break;var X=H.alternate;if(X===null){if(A=H.return,A!==null){C=A;continue}break}if(H.child===X.child){for(X=H.child;X;){if(X===C)return kn(H),d;if(X===A)return kn(H),g;X=X.sibling}throw Error(r(188))}if(C.return!==A.return)C=H,A=X;else{for(var oe=!1,be=H.child;be;){if(be===C){oe=!0,C=H,A=X;break}if(be===A){oe=!0,A=H,C=X;break}be=be.sibling}if(!oe){for(be=X.child;be;){if(be===C){oe=!0,C=X,A=H;break}if(be===A){oe=!0,A=X,C=H;break}be=be.sibling}if(!oe)throw Error(r(189))}}if(C.alternate!==A)throw Error(r(190))}if(C.tag!==3)throw Error(r(188));return C.stateNode.current===C?d:g}function Rs(d){return d=In(d),d!==null?gi(d):null}function gi(d){if(d.tag===5||d.tag===6)return d;for(d=d.child;d!==null;){var g=gi(d);if(g!==null)return g;d=d.sibling}return null}var So=e.unstable_scheduleCallback,qa=e.unstable_cancelCallback,Lu=e.unstable_shouldYield,ko=e.unstable_requestPaint,on=e.unstable_now,_o=e.unstable_getCurrentPriorityLevel,fs=e.unstable_ImmediatePriority,to=e.unstable_UserBlockingPriority,Xi=e.unstable_NormalPriority,ro=e.unstable_LowPriority,ze=e.unstable_IdlePriority,Ke=null,tt=null;function ot(d){if(tt&&typeof tt.onCommitFiberRoot=="function")try{tt.onCommitFiberRoot(Ke,d,void 0,(d.current.flags&128)===128)}catch{}}var qe=Math.clz32?Math.clz32:Pr,Mt=Math.log,Nr=Math.LN2;function Pr(d){return d>>>=0,d===0?32:31-(Mt(d)/Nr|0)|0}var Fr=64,vi=4194304;function It(d){switch(d&-d){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return d&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return d&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return d}}function Ir(d,g){var C=d.pendingLanes;if(C===0)return 0;var A=0,H=d.suspendedLanes,X=d.pingedLanes,oe=C&268435455;if(oe!==0){var be=oe&~H;be!==0?A=It(be):(X&=oe,X!==0&&(A=It(X)))}else oe=C&~H,oe!==0?A=It(oe):X!==0&&(A=It(X));if(A===0)return 0;if(g!==0&&g!==A&&(g&H)===0&&(H=A&-A,X=g&-g,H>=X||H===16&&(X&4194240)!==0))return g;if((A&4)!==0&&(A|=C&16),g=d.entangledLanes,g!==0)for(d=d.entanglements,g&=A;0<g;)C=31-qe(g),H=1<<C,A|=d[C],g&=~H;return A}function al(d,g){switch(d){case 1:case 2:case 4:return g+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return g+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Qt(d,g){for(var C=d.suspendedLanes,A=d.pingedLanes,H=d.expirationTimes,X=d.pendingLanes;0<X;){var oe=31-qe(X),be=1<<oe,_e=H[oe];_e===-1?((be&C)===0||(be&A)!==0)&&(H[oe]=al(be,g)):_e<=g&&(d.expiredLanes|=be),X&=~be}}function er(d){return d=d.pendingLanes&-1073741825,d!==0?d:d&1073741824?1073741824:0}function Lr(){var d=Fr;return Fr<<=1,(Fr&4194240)===0&&(Fr=64),d}function Jt(d){for(var g=[],C=0;31>C;C++)g.push(d);return g}function en(d,g,C){d.pendingLanes|=g,g!==536870912&&(d.suspendedLanes=0,d.pingedLanes=0),d=d.eventTimes,g=31-qe(g),d[g]=C}function yn(d,g){var C=d.pendingLanes&~g;d.pendingLanes=g,d.suspendedLanes=0,d.pingedLanes=0,d.expiredLanes&=g,d.mutableReadLanes&=g,d.entangledLanes&=g,g=d.entanglements;var A=d.eventTimes;for(d=d.expirationTimes;0<C;){var H=31-qe(C),X=1<<H;g[H]=0,A[H]=-1,d[H]=-1,C&=~X}}function no(d,g){var C=d.entangledLanes|=g;for(d=d.entanglements;C;){var A=31-qe(C),H=1<<A;H&g|d[A]&g&&(d[A]|=g),C&=~H}}var xr=0;function io(d){return d&=-d,1<d?4<d?(d&268435455)!==0?16:536870912:4:1}var Co,Ls,Cc,Ec,sl,Gl=!1,Eo=[],Fi=null,ao=null,$a=null,br=new Map,sr=new Map,Qn=[],$r="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function vf(d,g){switch(d){case"focusin":case"focusout":Fi=null;break;case"dragenter":case"dragleave":ao=null;break;case"mouseover":case"mouseout":$a=null;break;case"pointerover":case"pointerout":br.delete(g.pointerId);break;case"gotpointercapture":case"lostpointercapture":sr.delete(g.pointerId)}}function ol(d,g,C,A,H,X){return d===null||d.nativeEvent!==X?(d={blockedOn:g,domEventName:C,eventSystemFlags:A,nativeEvent:X,targetContainers:[H]},g!==null&&(g=wl(g),g!==null&&Ls(g)),d):(d.eventSystemFlags|=A,g=d.targetContainers,H!==null&&g.indexOf(H)===-1&&g.push(H),d)}function jn(d,g,C,A,H){switch(g){case"focusin":return Fi=ol(Fi,d,g,C,A,H),!0;case"dragenter":return ao=ol(ao,d,g,C,A,H),!0;case"mouseover":return $a=ol($a,d,g,C,A,H),!0;case"pointerover":var X=H.pointerId;return br.set(X,ol(br.get(X)||null,d,g,C,A,H)),!0;case"gotpointercapture":return X=H.pointerId,sr.set(X,ol(sr.get(X)||null,d,g,C,A,H)),!0}return!1}function Vl(d){var g=Oo(d.target);if(g!==null){var C=ni(g);if(C!==null){if(g=C.tag,g===13){if(g=sn(C),g!==null){d.blockedOn=g,sl(d.priority,function(){Cc(C)});return}}else if(g===3&&C.stateNode.current.memoizedState.isDehydrated){d.blockedOn=C.tag===3?C.stateNode.containerInfo:null;return}}}d.blockedOn=null}function Os(d){if(d.blockedOn!==null)return!1;for(var g=d.targetContainers;0<g.length;){var C=Iu(d.domEventName,d.eventSystemFlags,g[0],d.nativeEvent);if(C===null){C=d.nativeEvent;var A=new C.constructor(C.type,C);Xe=A,C.target.dispatchEvent(A),Xe=null}else return g=wl(C),g!==null&&Ls(g),d.blockedOn=C,!1;g.shift()}return!0}function Hl(d,g,C){Os(d)&&C.delete(g)}function Ou(){Gl=!1,Fi!==null&&Os(Fi)&&(Fi=null),ao!==null&&Os(ao)&&(ao=null),$a!==null&&Os($a)&&($a=null),br.forEach(Hl),sr.forEach(Hl)}function hn(d,g){d.blockedOn===g&&(d.blockedOn=null,Gl||(Gl=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,Ou)))}function Fn(d){function g(H){return hn(H,d)}if(0<Eo.length){hn(Eo[0],d);for(var C=1;C<Eo.length;C++){var A=Eo[C];A.blockedOn===d&&(A.blockedOn=null)}}for(Fi!==null&&hn(Fi,d),ao!==null&&hn(ao,d),$a!==null&&hn($a,d),br.forEach(g),sr.forEach(g),C=0;C<Qn.length;C++)A=Qn[C],A.blockedOn===d&&(A.blockedOn=null);for(;0<Qn.length&&(C=Qn[0],C.blockedOn===null);)Vl(C),C.blockedOn===null&&Qn.shift()}var ll=N.ReactCurrentBatchConfig,Du=!0;function hs(d,g,C,A){var H=xr,X=ll.transition;ll.transition=null;try{xr=1,To(d,g,C,A)}finally{xr=H,ll.transition=X}}function Ds(d,g,C,A){var H=xr,X=ll.transition;ll.transition=null;try{xr=4,To(d,g,C,A)}finally{xr=H,ll.transition=X}}function To(d,g,C,A){if(Du){var H=Iu(d,g,C,A);if(H===null)h(d,g,A,Wl,C),vf(d,A);else if(jn(H,d,g,C,A))A.stopPropagation();else if(vf(d,A),g&4&&-1<$r.indexOf(d)){for(;H!==null;){var X=wl(H);if(X!==null&&Co(X),X=Iu(d,g,C,A),X===null&&h(d,g,A,Wl,C),X===H)break;H=X}H!==null&&A.stopPropagation()}else h(d,g,A,null,C)}}var Wl=null;function Iu(d,g,C,A){if(Wl=null,d=Ve(A),d=Oo(d),d!==null)if(g=ni(d),g===null)d=null;else if(C=g.tag,C===13){if(d=sn(g),d!==null)return d;d=null}else if(C===3){if(g.stateNode.current.memoizedState.isDehydrated)return g.tag===3?g.stateNode.containerInfo:null;d=null}else g!==d&&(d=null);return Wl=d,null}function Cr(d){switch(d){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(_o()){case fs:return 1;case to:return 4;case Xi:case ro:return 16;case ze:return 536870912;default:return 16}default:return 16}}var yi=null,ii=null,wa=null;function ql(){if(wa)return wa;var d,g=ii,C=g.length,A,H="value"in yi?yi.value:yi.textContent,X=H.length;for(d=0;d<C&&g[d]===H[d];d++);var oe=C-d;for(A=1;A<=oe&&g[C-A]===H[X-A];A++);return wa=H.slice(d,1<A?1-A:void 0)}function ul(d){var g=d.keyCode;return"charCode"in d?(d=d.charCode,d===0&&g===13&&(d=13)):d=g,d===10&&(d=13),32<=d||d===13?d:0}function xi(){return!0}function Sa(){return!1}function Bn(d){function g(C,A,H,X,oe){this._reactName=C,this._targetInst=H,this.type=A,this.nativeEvent=X,this.target=oe,this.currentTarget=null;for(var be in d)d.hasOwnProperty(be)&&(C=d[be],this[be]=C?C(X):X[be]);return this.isDefaultPrevented=(X.defaultPrevented!=null?X.defaultPrevented:X.returnValue===!1)?xi:Sa,this.isPropagationStopped=Sa,this}return re(g.prototype,{preventDefault:function(){this.defaultPrevented=!0;var C=this.nativeEvent;C&&(C.preventDefault?C.preventDefault():typeof C.returnValue!="unknown"&&(C.returnValue=!1),this.isDefaultPrevented=xi)},stopPropagation:function(){var C=this.nativeEvent;C&&(C.stopPropagation?C.stopPropagation():typeof C.cancelBubble!="unknown"&&(C.cancelBubble=!0),this.isPropagationStopped=xi)},persist:function(){},isPersistent:xi}),g}var Qi={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(d){return d.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ps=Bn(Qi),ka=re({},Qi,{view:0,detail:0}),Oh=Bn(ka),Ji,ju,ai,_n=re({},ka,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ms,button:0,buttons:0,relatedTarget:function(d){return d.relatedTarget===void 0?d.fromElement===d.srcElement?d.toElement:d.fromElement:d.relatedTarget},movementX:function(d){return"movementX"in d?d.movementX:(d!==ai&&(ai&&d.type==="mousemove"?(Ji=d.screenX-ai.screenX,ju=d.screenY-ai.screenY):ju=Ji=0,ai=d),Ji)},movementY:function(d){return"movementY"in d?d.movementY:ju}}),tn=Bn(_n),$l=re({},_n,{dataTransfer:0}),_a=Bn($l),Dh=re({},ka,{relatedTarget:0}),Fu=Bn(Dh),Tc=re({},Qi,{animationName:0,elapsedTime:0,pseudoElement:0}),yf=Bn(Tc),Ih=re({},Qi,{clipboardData:function(d){return"clipboardData"in d?d.clipboardData:window.clipboardData}}),Kl=Bn(Ih),jh=re({},Qi,{data:0}),No=Bn(jh),Nc={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Pc={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Is={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function ym(d){var g=this.nativeEvent;return g.getModifierState?g.getModifierState(d):(d=Is[d])?!!g[d]:!1}function ms(){return ym}var Bi=re({},ka,{key:function(d){if(d.key){var g=Nc[d.key]||d.key;if(g!=="Unidentified")return g}return d.type==="keypress"?(d=ul(d),d===13?"Enter":String.fromCharCode(d)):d.type==="keydown"||d.type==="keyup"?Pc[d.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ms,charCode:function(d){return d.type==="keypress"?ul(d):0},keyCode:function(d){return d.type==="keydown"||d.type==="keyup"?d.keyCode:0},which:function(d){return d.type==="keypress"?ul(d):d.type==="keydown"||d.type==="keyup"?d.keyCode:0}}),xf=Bn(Bi),bf=re({},_n,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),cl=Bn(bf),Mc=re({},ka,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ms}),Zl=Bn(Mc),Ac=re({},Qi,{propertyName:0,elapsedTime:0,pseudoElement:0}),Yl=Bn(Ac),Rc=re({},_n,{deltaX:function(d){return"deltaX"in d?d.deltaX:"wheelDeltaX"in d?-d.wheelDeltaX:0},deltaY:function(d){return"deltaY"in d?d.deltaY:"wheelDeltaY"in d?-d.wheelDeltaY:"wheelDelta"in d?-d.wheelDelta:0},deltaZ:0,deltaMode:0}),wf=Bn(Rc),Ka=[9,13,27,32],js=o&&"CompositionEvent"in window,dl=null;o&&"documentMode"in document&&(dl=document.documentMode);var ea=o&&"TextEvent"in window&&!dl,Ca=o&&(!js||dl&&8<dl&&11>=dl),Ea=" ",Lc=!1;function fl(d,g){switch(d){case"keyup":return Ka.indexOf(g.keyCode)!==-1;case"keydown":return g.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Za(d){return d=d.detail,typeof d=="object"&&"data"in d?d.data:null}var Pi=!1;function Sf(d,g){switch(d){case"compositionend":return Za(g);case"keypress":return g.which!==32?null:(Lc=!0,Ea);case"textInput":return d=g.data,d===Ea&&Lc?null:d;default:return null}}function so(d,g){if(Pi)return d==="compositionend"||!js&&fl(d,g)?(d=ql(),wa=ii=yi=null,Pi=!1,d):null;switch(d){case"paste":return null;case"keypress":if(!(g.ctrlKey||g.altKey||g.metaKey)||g.ctrlKey&&g.altKey){if(g.char&&1<g.char.length)return g.char;if(g.which)return String.fromCharCode(g.which)}return null;case"compositionend":return Ca&&g.locale!=="ko"?null:g.data;default:return null}}var Ya={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function oo(d){var g=d&&d.nodeName&&d.nodeName.toLowerCase();return g==="input"?!!Ya[d.type]:g==="textarea"}function hl(d,g,C,A){Ht(A),g=P(g,"onChange"),0<g.length&&(C=new ps("onChange","change",null,C,A),d.push({event:C,listeners:g}))}var Xl=null,Mi=null;function Fh(d){Bc(d,0)}function Ta(d){var g=Vn(d);if(ye(g))return d}function Xa(d,g){if(d==="change")return g}var ta=!1;if(o){var gs;if(o){var Na="oninput"in document;if(!Na){var Ql=document.createElement("div");Ql.setAttribute("oninput","return;"),Na=typeof Ql.oninput=="function"}gs=Na}else gs=!1;ta=gs&&(!document.documentMode||9<document.documentMode)}function Fs(){Xl&&(Xl.detachEvent("onpropertychange",Bu),Mi=Xl=null)}function Bu(d){if(d.propertyName==="value"&&Ta(Mi)){var g=[];hl(g,Mi,d,Ve(d)),kr(Fh,g)}}function Jl(d,g,C){d==="focusin"?(Fs(),Xl=g,Mi=C,Xl.attachEvent("onpropertychange",Bu)):d==="focusout"&&Fs()}function Hr(d){if(d==="selectionchange"||d==="keyup"||d==="keydown")return Ta(Mi)}function pl(d,g){if(d==="click")return Ta(g)}function zu(d,g){if(d==="input"||d==="change")return Ta(g)}function Oc(d,g){return d===g&&(d!==0||1/d===1/g)||d!==d&&g!==g}var ra=typeof Object.is=="function"?Object.is:Oc;function Bs(d,g){if(ra(d,g))return!0;if(typeof d!="object"||d===null||typeof g!="object"||g===null)return!1;var C=Object.keys(d),A=Object.keys(g);if(C.length!==A.length)return!1;for(A=0;A<C.length;A++){var H=C[A];if(!l.call(g,H)||!ra(d[H],g[H]))return!1}return!0}function Po(d){for(;d&&d.firstChild;)d=d.firstChild;return d}function ln(d,g){var C=Po(d);d=0;for(var A;C;){if(C.nodeType===3){if(A=d+C.textContent.length,d<=g&&A>=g)return{node:C,offset:g-d};d=A}e:{for(;C;){if(C.nextSibling){C=C.nextSibling;break e}C=C.parentNode}C=void 0}C=Po(C)}}function zn(d,g){return d&&g?d===g?!0:d&&d.nodeType===3?!1:g&&g.nodeType===3?zn(d,g.parentNode):"contains"in d?d.contains(g):d.compareDocumentPosition?!!(d.compareDocumentPosition(g)&16):!1:!1}function Un(){for(var d=window,g=Se();g instanceof d.HTMLIFrameElement;){try{var C=typeof g.contentWindow.location.href=="string"}catch{C=!1}if(C)d=g.contentWindow;else break;g=Se(d.document)}return g}function eu(d){var g=d&&d.nodeName&&d.nodeName.toLowerCase();return g&&(g==="input"&&(d.type==="text"||d.type==="search"||d.type==="tel"||d.type==="url"||d.type==="password")||g==="textarea"||d.contentEditable==="true")}function na(d){var g=Un(),C=d.focusedElem,A=d.selectionRange;if(g!==C&&C&&C.ownerDocument&&zn(C.ownerDocument.documentElement,C)){if(A!==null&&eu(C)){if(g=A.start,d=A.end,d===void 0&&(d=g),"selectionStart"in C)C.selectionStart=g,C.selectionEnd=Math.min(d,C.value.length);else if(d=(g=C.ownerDocument||document)&&g.defaultView||window,d.getSelection){d=d.getSelection();var H=C.textContent.length,X=Math.min(A.start,H);A=A.end===void 0?X:Math.min(A.end,H),!d.extend&&X>A&&(H=A,A=X,X=H),H=ln(C,X);var oe=ln(C,A);H&&oe&&(d.rangeCount!==1||d.anchorNode!==H.node||d.anchorOffset!==H.offset||d.focusNode!==oe.node||d.focusOffset!==oe.offset)&&(g=g.createRange(),g.setStart(H.node,H.offset),d.removeAllRanges(),X>A?(d.addRange(g),d.extend(oe.node,oe.offset)):(g.setEnd(oe.node,oe.offset),d.addRange(g)))}}for(g=[],d=C;d=d.parentNode;)d.nodeType===1&&g.push({element:d,left:d.scrollLeft,top:d.scrollTop});for(typeof C.focus=="function"&&C.focus(),C=0;C<g.length;C++)d=g[C],d.element.scrollLeft=d.left,d.element.scrollTop=d.top}}var Mo=o&&"documentMode"in document&&11>=document.documentMode,tu=null,An=null,ml=null,ru=!1;function Dc(d,g,C){var A=C.window===C?C.document:C.nodeType===9?C:C.ownerDocument;ru||tu==null||tu!==Se(A)||(A=tu,"selectionStart"in A&&eu(A)?A={start:A.selectionStart,end:A.selectionEnd}:(A=(A.ownerDocument&&A.ownerDocument.defaultView||window).getSelection(),A={anchorNode:A.anchorNode,anchorOffset:A.anchorOffset,focusNode:A.focusNode,focusOffset:A.focusOffset}),ml&&Bs(ml,A)||(ml=A,A=P(An,"onSelect"),0<A.length&&(g=new ps("onSelect","select",null,g,C),d.push({event:g,listeners:A}),g.target=tu)))}function bi(d,g){var C={};return C[d.toLowerCase()]=g.toLowerCase(),C["Webkit"+d]="webkit"+g,C["Moz"+d]="moz"+g,C}var wi={animationend:bi("Animation","AnimationEnd"),animationiteration:bi("Animation","AnimationIteration"),animationstart:bi("Animation","AnimationStart"),transitionend:bi("Transition","TransitionEnd")},Qa={},Uu={};o&&(Uu=document.createElement("div").style,"AnimationEvent"in window||(delete wi.animationend.animation,delete wi.animationiteration.animation,delete wi.animationstart.animation),"TransitionEvent"in window||delete wi.transitionend.transition);function gl(d){if(Qa[d])return Qa[d];if(!wi[d])return d;var g=wi[d],C;for(C in g)if(g.hasOwnProperty(C)&&C in Uu)return Qa[d]=g[C];return d}var kf=gl("animationend"),vs=gl("animationiteration"),Ic=gl("animationstart"),jc=gl("transitionend"),vl=new Map,_f="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ja(d,g){vl.set(d,g),a(g,[d])}for(var Ao=0;Ao<_f.length;Ao++){var Ro=_f[Ao],Cf=Ro.toLowerCase(),Fc=Ro[0].toUpperCase()+Ro.slice(1);Ja(Cf,"on"+Fc)}Ja(kf,"onAnimationEnd"),Ja(vs,"onAnimationIteration"),Ja(Ic,"onAnimationStart"),Ja("dblclick","onDoubleClick"),Ja("focusin","onFocus"),Ja("focusout","onBlur"),Ja(jc,"onTransitionEnd"),s("onMouseEnter",["mouseout","mouseover"]),s("onMouseLeave",["mouseout","mouseover"]),s("onPointerEnter",["pointerout","pointerover"]),s("onPointerLeave",["pointerout","pointerover"]),a("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),a("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),a("onBeforeInput",["compositionend","keypress","textInput","paste"]),a("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),a("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),a("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var lo="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Ef=new Set("cancel close invalid load scroll toggle".split(" ").concat(lo));function Gu(d,g,C){var A=d.type||"unknown-event";d.currentTarget=C,As(A,g,void 0,d),d.currentTarget=null}function Bc(d,g){g=(g&4)!==0;for(var C=0;C<d.length;C++){var A=d[C],H=A.event;A=A.listeners;e:{var X=void 0;if(g)for(var oe=A.length-1;0<=oe;oe--){var be=A[oe],_e=be.instance,Fe=be.currentTarget;if(be=be.listener,_e!==X&&H.isPropagationStopped())break e;Gu(H,be,Fe),X=_e}else for(oe=0;oe<A.length;oe++){if(be=A[oe],_e=be.instance,Fe=be.currentTarget,be=be.listener,_e!==X&&H.isPropagationStopped())break e;Gu(H,be,Fe),X=_e}}}if(Br)throw d=Xn,Br=!1,Xn=null,d}function Kr(d,g){var C=g[bl];C===void 0&&(C=g[bl]=new Set);var A=d+"__bubble";C.has(A)||(Tf(g,d,2,!1),C.add(A))}function zc(d,g,C){var A=0;g&&(A|=4),Tf(C,d,A,g)}var nu="_reactListening"+Math.random().toString(36).slice(2);function Lo(d){if(!d[nu]){d[nu]=!0,n.forEach(function(C){C!=="selectionchange"&&(Ef.has(C)||zc(C,!1,d),zc(C,!0,d))});var g=d.nodeType===9?d:d.ownerDocument;g===null||g[nu]||(g[nu]=!0,zc("selectionchange",!1,g))}}function Tf(d,g,C,A){switch(Cr(g)){case 1:var H=hs;break;case 4:H=Ds;break;default:H=To}C=H.bind(null,g,C,d),H=void 0,!Jr||g!=="touchstart"&&g!=="touchmove"&&g!=="wheel"||(H=!0),A?H!==void 0?d.addEventListener(g,C,{capture:!0,passive:H}):d.addEventListener(g,C,!0):H!==void 0?d.addEventListener(g,C,{passive:H}):d.addEventListener(g,C,!1)}function h(d,g,C,A,H){var X=A;if((g&1)===0&&(g&2)===0&&A!==null)e:for(;;){if(A===null)return;var oe=A.tag;if(oe===3||oe===4){var be=A.stateNode.containerInfo;if(be===H||be.nodeType===8&&be.parentNode===H)break;if(oe===4)for(oe=A.return;oe!==null;){var _e=oe.tag;if((_e===3||_e===4)&&(_e=oe.stateNode.containerInfo,_e===H||_e.nodeType===8&&_e.parentNode===H))return;oe=oe.return}for(;be!==null;){if(oe=Oo(be),oe===null)return;if(_e=oe.tag,_e===5||_e===6){A=X=oe;continue e}be=be.parentNode}}A=A.return}kr(function(){var Fe=X,nt=Ve(C),st=[];e:{var rt=vl.get(d);if(rt!==void 0){var Nt=ps,jt=d;switch(d){case"keypress":if(ul(C)===0)break e;case"keydown":case"keyup":Nt=xf;break;case"focusin":jt="focus",Nt=Fu;break;case"focusout":jt="blur",Nt=Fu;break;case"beforeblur":case"afterblur":Nt=Fu;break;case"click":if(C.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Nt=tn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Nt=_a;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Nt=Zl;break;case kf:case vs:case Ic:Nt=yf;break;case jc:Nt=Yl;break;case"scroll":Nt=Oh;break;case"wheel":Nt=wf;break;case"copy":case"cut":case"paste":Nt=Kl;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Nt=cl}var zt=(g&4)!==0,Ci=!zt&&d==="scroll",Re=zt?rt!==null?rt+"Capture":null:rt;zt=[];for(var Ee=Fe,Le;Ee!==null;){Le=Ee;var ht=Le.stateNode;if(Le.tag===5&&ht!==null&&(Le=ht,Re!==null&&(ht=Qr(Ee,Re),ht!=null&&zt.push(k(Ee,ht,Le)))),Ci)break;Ee=Ee.return}0<zt.length&&(rt=new Nt(rt,jt,null,C,nt),st.push({event:rt,listeners:zt}))}}if((g&7)===0){e:{if(rt=d==="mouseover"||d==="pointerover",Nt=d==="mouseout"||d==="pointerout",rt&&C!==Xe&&(jt=C.relatedTarget||C.fromElement)&&(Oo(jt)||jt[zr]))break e;if((Nt||rt)&&(rt=nt.window===nt?nt:(rt=nt.ownerDocument)?rt.defaultView||rt.parentWindow:window,Nt?(jt=C.relatedTarget||C.toElement,Nt=Fe,jt=jt?Oo(jt):null,jt!==null&&(Ci=ni(jt),jt!==Ci||jt.tag!==5&&jt.tag!==6)&&(jt=null)):(Nt=null,jt=Fe),Nt!==jt)){if(zt=tn,ht="onMouseLeave",Re="onMouseEnter",Ee="mouse",(d==="pointerout"||d==="pointerover")&&(zt=cl,ht="onPointerLeave",Re="onPointerEnter",Ee="pointer"),Ci=Nt==null?rt:Vn(Nt),Le=jt==null?rt:Vn(jt),rt=new zt(ht,Ee+"leave",Nt,C,nt),rt.target=Ci,rt.relatedTarget=Le,ht=null,Oo(nt)===Fe&&(zt=new zt(Re,Ee+"enter",jt,C,nt),zt.target=Le,zt.relatedTarget=Ci,ht=zt),Ci=ht,Nt&&jt)t:{for(zt=Nt,Re=jt,Ee=0,Le=zt;Le;Le=V(Le))Ee++;for(Le=0,ht=Re;ht;ht=V(ht))Le++;for(;0<Ee-Le;)zt=V(zt),Ee--;for(;0<Le-Ee;)Re=V(Re),Le--;for(;Ee--;){if(zt===Re||Re!==null&&zt===Re.alternate)break t;zt=V(zt),Re=V(Re)}zt=null}else zt=null;Nt!==null&&ee(st,rt,Nt,zt,!1),jt!==null&&Ci!==null&&ee(st,Ci,jt,zt,!0)}}e:{if(rt=Fe?Vn(Fe):window,Nt=rt.nodeName&&rt.nodeName.toLowerCase(),Nt==="select"||Nt==="input"&&rt.type==="file")var Gt=Xa;else if(oo(rt))if(ta)Gt=zu;else{Gt=Hr;var tr=Jl}else(Nt=rt.nodeName)&&Nt.toLowerCase()==="input"&&(rt.type==="checkbox"||rt.type==="radio")&&(Gt=pl);if(Gt&&(Gt=Gt(d,Fe))){hl(st,Gt,C,nt);break e}tr&&tr(d,rt,Fe),d==="focusout"&&(tr=rt._wrapperState)&&tr.controlled&&rt.type==="number"&&wt(rt,"number",rt.value)}switch(tr=Fe?Vn(Fe):window,d){case"focusin":(oo(tr)||tr.contentEditable==="true")&&(tu=tr,An=Fe,ml=null);break;case"focusout":ml=An=tu=null;break;case"mousedown":ru=!0;break;case"contextmenu":case"mouseup":case"dragend":ru=!1,Dc(st,C,nt);break;case"selectionchange":if(Mo)break;case"keydown":case"keyup":Dc(st,C,nt)}var rr;if(js)e:{switch(d){case"compositionstart":var or="onCompositionStart";break e;case"compositionend":or="onCompositionEnd";break e;case"compositionupdate":or="onCompositionUpdate";break e}or=void 0}else Pi?fl(d,C)&&(or="onCompositionEnd"):d==="keydown"&&C.keyCode===229&&(or="onCompositionStart");or&&(Ca&&C.locale!=="ko"&&(Pi||or!=="onCompositionStart"?or==="onCompositionEnd"&&Pi&&(rr=ql()):(yi=nt,ii="value"in yi?yi.value:yi.textContent,Pi=!0)),tr=P(Fe,or),0<tr.length&&(or=new No(or,d,null,C,nt),st.push({event:or,listeners:tr}),rr?or.data=rr:(rr=Za(C),rr!==null&&(or.data=rr)))),(rr=ea?Sf(d,C):so(d,C))&&(Fe=P(Fe,"onBeforeInput"),0<Fe.length&&(nt=new No("onBeforeInput","beforeinput",null,C,nt),st.push({event:nt,listeners:Fe}),nt.data=rr))}Bc(st,g)})}function k(d,g,C){return{instance:d,listener:g,currentTarget:C}}function P(d,g){for(var C=g+"Capture",A=[];d!==null;){var H=d,X=H.stateNode;H.tag===5&&X!==null&&(H=X,X=Qr(d,C),X!=null&&A.unshift(k(d,X,H)),X=Qr(d,g),X!=null&&A.push(k(d,X,H))),d=d.return}return A}function V(d){if(d===null)return null;do d=d.return;while(d&&d.tag!==5);return d||null}function ee(d,g,C,A,H){for(var X=g._reactName,oe=[];C!==null&&C!==A;){var be=C,_e=be.alternate,Fe=be.stateNode;if(_e!==null&&_e===A)break;be.tag===5&&Fe!==null&&(be=Fe,H?(_e=Qr(C,X),_e!=null&&oe.unshift(k(C,_e,be))):H||(_e=Qr(C,X),_e!=null&&oe.push(k(C,_e,be)))),C=C.return}oe.length!==0&&d.push({event:g,listeners:oe})}var ue=/\r\n?/g,we=/\u0000|\uFFFD/g;function Me(d){return(typeof d=="string"?d:""+d).replace(ue,`
`).replace(we,"")}function De(d,g,C){if(g=Me(g),Me(d)!==g&&C)throw Error(r(425))}function Ze(){}var kt=null,Yt=null;function fr(d,g){return d==="textarea"||d==="noscript"||typeof g.children=="string"||typeof g.children=="number"||typeof g.dangerouslySetInnerHTML=="object"&&g.dangerouslySetInnerHTML!==null&&g.dangerouslySetInnerHTML.__html!=null}var Zr=typeof setTimeout=="function"?setTimeout:void 0,Gn=typeof clearTimeout=="function"?clearTimeout:void 0,Ai=typeof Promise=="function"?Promise:void 0,zi=typeof queueMicrotask=="function"?queueMicrotask:typeof Ai<"u"?function(d){return Ai.resolve(null).then(d).catch(yl)}:Zr;function yl(d){setTimeout(function(){throw d})}function Uc(d,g){var C=g,A=0;do{var H=C.nextSibling;if(d.removeChild(C),H&&H.nodeType===8)if(C=H.data,C==="/$"){if(A===0){d.removeChild(H),Fn(g);return}A--}else C!=="$"&&C!=="$?"&&C!=="$!"||A++;C=H}while(C);Fn(g)}function zs(d){for(;d!=null;d=d.nextSibling){var g=d.nodeType;if(g===1||g===3)break;if(g===8){if(g=d.data,g==="$"||g==="$!"||g==="$?")break;if(g==="/$")return null}}return d}function xl(d){d=d.previousSibling;for(var g=0;d;){if(d.nodeType===8){var C=d.data;if(C==="$"||C==="$!"||C==="$?"){if(g===0)return d;g--}else C==="/$"&&g++}d=d.previousSibling}return null}var uo=Math.random().toString(36).slice(2),es="__reactFiber$"+uo,iu="__reactProps$"+uo,zr="__reactContainer$"+uo,bl="__reactEvents$"+uo,Bh="__reactListeners$"+uo,zh="__reactHandles$"+uo;function Oo(d){var g=d[es];if(g)return g;for(var C=d.parentNode;C;){if(g=C[zr]||C[es]){if(C=g.alternate,g.child!==null||C!==null&&C.child!==null)for(d=xl(d);d!==null;){if(C=d[es])return C;d=xl(d)}return g}d=C,C=d.parentNode}return null}function wl(d){return d=d[es]||d[zr],!d||d.tag!==5&&d.tag!==6&&d.tag!==13&&d.tag!==3?null:d}function Vn(d){if(d.tag===5||d.tag===6)return d.stateNode;throw Error(r(33))}function si(d){return d[iu]||null}var Uh=[],Vu=-1;function Sl(d){return{current:d}}function pn(d){0>Vu||(d.current=Uh[Vu],Uh[Vu]=null,Vu--)}function un(d,g){Vu++,Uh[Vu]=d.current,d.current=g}var Do={},Ui=Sl(Do),ia=Sl(!1),au=Do;function Hu(d,g){var C=d.type.contextTypes;if(!C)return Do;var A=d.stateNode;if(A&&A.__reactInternalMemoizedUnmaskedChildContext===g)return A.__reactInternalMemoizedMaskedChildContext;var H={},X;for(X in C)H[X]=g[X];return A&&(d=d.stateNode,d.__reactInternalMemoizedUnmaskedChildContext=g,d.__reactInternalMemoizedMaskedChildContext=H),H}function aa(d){return d=d.childContextTypes,d!=null}function Gc(){pn(ia),pn(Ui)}function xm(d,g,C){if(Ui.current!==Do)throw Error(r(168));un(Ui,g),un(ia,C)}function Gh(d,g,C){var A=d.stateNode;if(g=g.childContextTypes,typeof A.getChildContext!="function")return C;A=A.getChildContext();for(var H in A)if(!(H in g))throw Error(r(108,le(d)||"Unknown",H));return re({},C,A)}function Wu(d){return d=(d=d.stateNode)&&d.__reactInternalMemoizedMergedChildContext||Do,au=Ui.current,un(Ui,d),un(ia,ia.current),!0}function v0(d,g,C){var A=d.stateNode;if(!A)throw Error(r(169));C?(d=Gh(d,g,au),A.__reactInternalMemoizedMergedChildContext=d,pn(ia),pn(Ui),un(Ui,d)):pn(ia),un(ia,C)}var Io=null,Vc=!1,Vh=!1;function Nf(d){Io===null?Io=[d]:Io.push(d)}function kl(d){Vc=!0,Nf(d)}function su(){if(!Vh&&Io!==null){Vh=!0;var d=0,g=xr;try{var C=Io;for(xr=1;d<C.length;d++){var A=C[d];do A=A(!0);while(A!==null)}Io=null,Vc=!1}catch(H){throw Io!==null&&(Io=Io.slice(d+1)),So(fs,su),H}finally{xr=g,Vh=!1}}return null}var Pa=[],qu=0,ou=null,lu=0,Ma=[],Aa=0,uu=null,ys=1,Cn="";function $u(d,g){Pa[qu++]=lu,Pa[qu++]=ou,ou=d,lu=g}function y0(d,g,C){Ma[Aa++]=ys,Ma[Aa++]=Cn,Ma[Aa++]=uu,uu=d;var A=ys;d=Cn;var H=32-qe(A)-1;A&=~(1<<H),C+=1;var X=32-qe(g)+H;if(30<X){var oe=H-H%5;X=(A&(1<<oe)-1).toString(32),A>>=oe,H-=oe,ys=1<<32-qe(g)+H|C<<H|A,Cn=X+d}else ys=1<<X|C<<H|A,Cn=d}function Hc(d){d.return!==null&&($u(d,1),y0(d,1,0))}function Ri(d){for(;d===ou;)ou=Pa[--qu],Pa[qu]=null,lu=Pa[--qu],Pa[qu]=null;for(;d===uu;)uu=Ma[--Aa],Ma[Aa]=null,Cn=Ma[--Aa],Ma[Aa]=null,ys=Ma[--Aa],Ma[Aa]=null}var xs=null,xt=null,Yr=!1,bs=null;function bm(d,g){var C=Vo(5,null,null,0);C.elementType="DELETED",C.stateNode=g,C.return=d,g=d.deletions,g===null?(d.deletions=[C],d.flags|=16):g.push(C)}function x0(d,g){switch(d.tag){case 5:var C=d.type;return g=g.nodeType!==1||C.toLowerCase()!==g.nodeName.toLowerCase()?null:g,g!==null?(d.stateNode=g,xs=d,xt=zs(g.firstChild),!0):!1;case 6:return g=d.pendingProps===""||g.nodeType!==3?null:g,g!==null?(d.stateNode=g,xs=d,xt=null,!0):!1;case 13:return g=g.nodeType!==8?null:g,g!==null?(C=uu!==null?{id:ys,overflow:Cn}:null,d.memoizedState={dehydrated:g,treeContext:C,retryLane:1073741824},C=Vo(18,null,null,0),C.stateNode=g,C.return=d,d.child=C,xs=d,xt=null,!0):!1;default:return!1}}function Ku(d){return(d.mode&1)!==0&&(d.flags&128)===0}function Wc(d){if(Yr){var g=xt;if(g){var C=g;if(!x0(d,g)){if(Ku(d))throw Error(r(418));g=zs(C.nextSibling);var A=xs;g&&x0(d,g)?bm(A,C):(d.flags=d.flags&-4097|2,Yr=!1,xs=d)}}else{if(Ku(d))throw Error(r(418));d.flags=d.flags&-4097|2,Yr=!1,xs=d}}}function Hh(d){for(d=d.return;d!==null&&d.tag!==5&&d.tag!==3&&d.tag!==13;)d=d.return;xs=d}function Pf(d){if(d!==xs)return!1;if(!Yr)return Hh(d),Yr=!0,!1;var g;if((g=d.tag!==3)&&!(g=d.tag!==5)&&(g=d.type,g=g!=="head"&&g!=="body"&&!fr(d.type,d.memoizedProps)),g&&(g=xt)){if(Ku(d))throw wm(),Error(r(418));for(;g;)bm(d,g),g=zs(g.nextSibling)}if(Hh(d),d.tag===13){if(d=d.memoizedState,d=d!==null?d.dehydrated:null,!d)throw Error(r(317));e:{for(d=d.nextSibling,g=0;d;){if(d.nodeType===8){var C=d.data;if(C==="/$"){if(g===0){xt=zs(d.nextSibling);break e}g--}else C!=="$"&&C!=="$!"&&C!=="$?"||g++}d=d.nextSibling}xt=null}}else xt=xs?zs(d.stateNode.nextSibling):null;return!0}function wm(){for(var d=xt;d;)d=zs(d.nextSibling)}function Zu(){xt=xs=null,Yr=!1}function Mf(d){bs===null?bs=[d]:bs.push(d)}var Sm=N.ReactCurrentBatchConfig;function Jn(d,g,C){if(d=C.ref,d!==null&&typeof d!="function"&&typeof d!="object"){if(C._owner){if(C=C._owner,C){if(C.tag!==1)throw Error(r(309));var A=C.stateNode}if(!A)throw Error(r(147,d));var H=A,X=""+d;return g!==null&&g.ref!==null&&typeof g.ref=="function"&&g.ref._stringRef===X?g.ref:(g=function(oe){var be=H.refs;oe===null?delete be[X]:be[X]=oe},g._stringRef=X,g)}if(typeof d!="string")throw Error(r(284));if(!C._owner)throw Error(r(290,d))}return d}function ts(d,g){throw d=Object.prototype.toString.call(g),Error(r(31,d==="[object Object]"?"object with keys {"+Object.keys(g).join(", ")+"}":d))}function co(d){var g=d._init;return g(d._payload)}function Wh(d){function g(Re,Ee){if(d){var Le=Re.deletions;Le===null?(Re.deletions=[Ee],Re.flags|=16):Le.push(Ee)}}function C(Re,Ee){if(!d)return null;for(;Ee!==null;)g(Re,Ee),Ee=Ee.sibling;return null}function A(Re,Ee){for(Re=new Map;Ee!==null;)Ee.key!==null?Re.set(Ee.key,Ee):Re.set(Ee.index,Ee),Ee=Ee.sibling;return Re}function H(Re,Ee){return Re=fd(Re,Ee),Re.index=0,Re.sibling=null,Re}function X(Re,Ee,Le){return Re.index=Le,d?(Le=Re.alternate,Le!==null?(Le=Le.index,Le<Ee?(Re.flags|=2,Ee):Le):(Re.flags|=2,Ee)):(Re.flags|=1048576,Ee)}function oe(Re){return d&&Re.alternate===null&&(Re.flags|=2),Re}function be(Re,Ee,Le,ht){return Ee===null||Ee.tag!==6?(Ee=Nb(Le,Re.mode,ht),Ee.return=Re,Ee):(Ee=H(Ee,Le),Ee.return=Re,Ee)}function _e(Re,Ee,Le,ht){var Gt=Le.type;return Gt===F?nt(Re,Ee,Le.props.children,ht,Le.key):Ee!==null&&(Ee.elementType===Gt||typeof Gt=="object"&&Gt!==null&&Gt.$$typeof===q&&co(Gt)===Ee.type)?(ht=H(Ee,Le.props),ht.ref=Jn(Re,Ee,Le),ht.return=Re,ht):(ht=z0(Le.type,Le.key,Le.props,null,Re.mode,ht),ht.ref=Jn(Re,Ee,Le),ht.return=Re,ht)}function Fe(Re,Ee,Le,ht){return Ee===null||Ee.tag!==4||Ee.stateNode.containerInfo!==Le.containerInfo||Ee.stateNode.implementation!==Le.implementation?(Ee=Pb(Le,Re.mode,ht),Ee.return=Re,Ee):(Ee=H(Ee,Le.children||[]),Ee.return=Re,Ee)}function nt(Re,Ee,Le,ht,Gt){return Ee===null||Ee.tag!==7?(Ee=Uf(Le,Re.mode,ht,Gt),Ee.return=Re,Ee):(Ee=H(Ee,Le),Ee.return=Re,Ee)}function st(Re,Ee,Le){if(typeof Ee=="string"&&Ee!==""||typeof Ee=="number")return Ee=Nb(""+Ee,Re.mode,Le),Ee.return=Re,Ee;if(typeof Ee=="object"&&Ee!==null){switch(Ee.$$typeof){case R:return Le=z0(Ee.type,Ee.key,Ee.props,null,Re.mode,Le),Le.ref=Jn(Re,null,Ee),Le.return=Re,Le;case I:return Ee=Pb(Ee,Re.mode,Le),Ee.return=Re,Ee;case q:var ht=Ee._init;return st(Re,ht(Ee._payload),Le)}if($e(Ee)||ne(Ee))return Ee=Uf(Ee,Re.mode,Le,null),Ee.return=Re,Ee;ts(Re,Ee)}return null}function rt(Re,Ee,Le,ht){var Gt=Ee!==null?Ee.key:null;if(typeof Le=="string"&&Le!==""||typeof Le=="number")return Gt!==null?null:be(Re,Ee,""+Le,ht);if(typeof Le=="object"&&Le!==null){switch(Le.$$typeof){case R:return Le.key===Gt?_e(Re,Ee,Le,ht):null;case I:return Le.key===Gt?Fe(Re,Ee,Le,ht):null;case q:return Gt=Le._init,rt(Re,Ee,Gt(Le._payload),ht)}if($e(Le)||ne(Le))return Gt!==null?null:nt(Re,Ee,Le,ht,null);ts(Re,Le)}return null}function Nt(Re,Ee,Le,ht,Gt){if(typeof ht=="string"&&ht!==""||typeof ht=="number")return Re=Re.get(Le)||null,be(Ee,Re,""+ht,Gt);if(typeof ht=="object"&&ht!==null){switch(ht.$$typeof){case R:return Re=Re.get(ht.key===null?Le:ht.key)||null,_e(Ee,Re,ht,Gt);case I:return Re=Re.get(ht.key===null?Le:ht.key)||null,Fe(Ee,Re,ht,Gt);case q:var tr=ht._init;return Nt(Re,Ee,Le,tr(ht._payload),Gt)}if($e(ht)||ne(ht))return Re=Re.get(Le)||null,nt(Ee,Re,ht,Gt,null);ts(Ee,ht)}return null}function jt(Re,Ee,Le,ht){for(var Gt=null,tr=null,rr=Ee,or=Ee=0,da=null;rr!==null&&or<Le.length;or++){rr.index>or?(da=rr,rr=null):da=rr.sibling;var Wr=rt(Re,rr,Le[or],ht);if(Wr===null){rr===null&&(rr=da);break}d&&rr&&Wr.alternate===null&&g(Re,rr),Ee=X(Wr,Ee,or),tr===null?Gt=Wr:tr.sibling=Wr,tr=Wr,rr=da}if(or===Le.length)return C(Re,rr),Yr&&$u(Re,or),Gt;if(rr===null){for(;or<Le.length;or++)rr=st(Re,Le[or],ht),rr!==null&&(Ee=X(rr,Ee,or),tr===null?Gt=rr:tr.sibling=rr,tr=rr);return Yr&&$u(Re,or),Gt}for(rr=A(Re,rr);or<Le.length;or++)da=Nt(rr,Re,or,Le[or],ht),da!==null&&(d&&da.alternate!==null&&rr.delete(da.key===null?or:da.key),Ee=X(da,Ee,or),tr===null?Gt=da:tr.sibling=da,tr=da);return d&&rr.forEach(function(hd){return g(Re,hd)}),Yr&&$u(Re,or),Gt}function zt(Re,Ee,Le,ht){var Gt=ne(Le);if(typeof Gt!="function")throw Error(r(150));if(Le=Gt.call(Le),Le==null)throw Error(r(151));for(var tr=Gt=null,rr=Ee,or=Ee=0,da=null,Wr=Le.next();rr!==null&&!Wr.done;or++,Wr=Le.next()){rr.index>or?(da=rr,rr=null):da=rr.sibling;var hd=rt(Re,rr,Wr.value,ht);if(hd===null){rr===null&&(rr=da);break}d&&rr&&hd.alternate===null&&g(Re,rr),Ee=X(hd,Ee,or),tr===null?Gt=hd:tr.sibling=hd,tr=hd,rr=da}if(Wr.done)return C(Re,rr),Yr&&$u(Re,or),Gt;if(rr===null){for(;!Wr.done;or++,Wr=Le.next())Wr=st(Re,Wr.value,ht),Wr!==null&&(Ee=X(Wr,Ee,or),tr===null?Gt=Wr:tr.sibling=Wr,tr=Wr);return Yr&&$u(Re,or),Gt}for(rr=A(Re,rr);!Wr.done;or++,Wr=Le.next())Wr=Nt(rr,Re,or,Wr.value,ht),Wr!==null&&(d&&Wr.alternate!==null&&rr.delete(Wr.key===null?or:Wr.key),Ee=X(Wr,Ee,or),tr===null?Gt=Wr:tr.sibling=Wr,tr=Wr);return d&&rr.forEach(function(zD){return g(Re,zD)}),Yr&&$u(Re,or),Gt}function Ci(Re,Ee,Le,ht){if(typeof Le=="object"&&Le!==null&&Le.type===F&&Le.key===null&&(Le=Le.props.children),typeof Le=="object"&&Le!==null){switch(Le.$$typeof){case R:e:{for(var Gt=Le.key,tr=Ee;tr!==null;){if(tr.key===Gt){if(Gt=Le.type,Gt===F){if(tr.tag===7){C(Re,tr.sibling),Ee=H(tr,Le.props.children),Ee.return=Re,Re=Ee;break e}}else if(tr.elementType===Gt||typeof Gt=="object"&&Gt!==null&&Gt.$$typeof===q&&co(Gt)===tr.type){C(Re,tr.sibling),Ee=H(tr,Le.props),Ee.ref=Jn(Re,tr,Le),Ee.return=Re,Re=Ee;break e}C(Re,tr);break}else g(Re,tr);tr=tr.sibling}Le.type===F?(Ee=Uf(Le.props.children,Re.mode,ht,Le.key),Ee.return=Re,Re=Ee):(ht=z0(Le.type,Le.key,Le.props,null,Re.mode,ht),ht.ref=Jn(Re,Ee,Le),ht.return=Re,Re=ht)}return oe(Re);case I:e:{for(tr=Le.key;Ee!==null;){if(Ee.key===tr)if(Ee.tag===4&&Ee.stateNode.containerInfo===Le.containerInfo&&Ee.stateNode.implementation===Le.implementation){C(Re,Ee.sibling),Ee=H(Ee,Le.children||[]),Ee.return=Re,Re=Ee;break e}else{C(Re,Ee);break}else g(Re,Ee);Ee=Ee.sibling}Ee=Pb(Le,Re.mode,ht),Ee.return=Re,Re=Ee}return oe(Re);case q:return tr=Le._init,Ci(Re,Ee,tr(Le._payload),ht)}if($e(Le))return jt(Re,Ee,Le,ht);if(ne(Le))return zt(Re,Ee,Le,ht);ts(Re,Le)}return typeof Le=="string"&&Le!==""||typeof Le=="number"?(Le=""+Le,Ee!==null&&Ee.tag===6?(C(Re,Ee.sibling),Ee=H(Ee,Le),Ee.return=Re,Re=Ee):(C(Re,Ee),Ee=Nb(Le,Re.mode,ht),Ee.return=Re,Re=Ee),oe(Re)):C(Re,Ee)}return Ci}var Yu=Wh(!0),Us=Wh(!1),Af=Sl(null),ws=null,qc=null,qh=null;function $h(){qh=qc=ws=null}function Kh(d){var g=Af.current;pn(Af),d._currentValue=g}function Zh(d,g,C){for(;d!==null;){var A=d.alternate;if((d.childLanes&g)!==g?(d.childLanes|=g,A!==null&&(A.childLanes|=g)):A!==null&&(A.childLanes&g)!==g&&(A.childLanes|=g),d===C)break;d=d.return}}function _l(d,g){ws=d,qh=qc=null,d=d.dependencies,d!==null&&d.firstContext!==null&&((d.lanes&g)!==0&&(te=!0),d.firstContext=null)}function Ra(d){var g=d._currentValue;if(qh!==d)if(d={context:d,memoizedValue:g,next:null},qc===null){if(ws===null)throw Error(r(308));qc=d,ws.dependencies={lanes:0,firstContext:d}}else qc=qc.next=d;return g}var jo=null;function $c(d){jo===null?jo=[d]:jo.push(d)}function Rf(d,g,C,A){var H=g.interleaved;return H===null?(C.next=C,$c(g)):(C.next=H.next,H.next=C),g.interleaved=C,Ss(d,A)}function Ss(d,g){d.lanes|=g;var C=d.alternate;for(C!==null&&(C.lanes|=g),C=d,d=d.return;d!==null;)d.childLanes|=g,C=d.alternate,C!==null&&(C.childLanes|=g),C=d,d=d.return;return C.tag===3?C.stateNode:null}var Fo=!1;function Lf(d){d.updateQueue={baseState:d.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Yh(d,g){d=d.updateQueue,g.updateQueue===d&&(g.updateQueue={baseState:d.baseState,firstBaseUpdate:d.firstBaseUpdate,lastBaseUpdate:d.lastBaseUpdate,shared:d.shared,effects:d.effects})}function Bo(d,g){return{eventTime:d,lane:g,tag:0,payload:null,callback:null,next:null}}function zo(d,g,C){var A=d.updateQueue;if(A===null)return null;if(A=A.shared,(Ur&2)!==0){var H=A.pending;return H===null?g.next=g:(g.next=H.next,H.next=g),A.pending=g,Ss(d,C)}return H=A.interleaved,H===null?(g.next=g,$c(A)):(g.next=H.next,H.next=g),A.interleaved=g,Ss(d,C)}function Xh(d,g,C){if(g=g.updateQueue,g!==null&&(g=g.shared,(C&4194240)!==0)){var A=g.lanes;A&=d.pendingLanes,C|=A,g.lanes=C,no(d,C)}}function Of(d,g){var C=d.updateQueue,A=d.alternate;if(A!==null&&(A=A.updateQueue,C===A)){var H=null,X=null;if(C=C.firstBaseUpdate,C!==null){do{var oe={eventTime:C.eventTime,lane:C.lane,tag:C.tag,payload:C.payload,callback:C.callback,next:null};X===null?H=X=oe:X=X.next=oe,C=C.next}while(C!==null);X===null?H=X=g:X=X.next=g}else H=X=g;C={baseState:A.baseState,firstBaseUpdate:H,lastBaseUpdate:X,shared:A.shared,effects:A.effects},d.updateQueue=C;return}d=C.lastBaseUpdate,d===null?C.firstBaseUpdate=g:d.next=g,C.lastBaseUpdate=g}function Kc(d,g,C,A){var H=d.updateQueue;Fo=!1;var X=H.firstBaseUpdate,oe=H.lastBaseUpdate,be=H.shared.pending;if(be!==null){H.shared.pending=null;var _e=be,Fe=_e.next;_e.next=null,oe===null?X=Fe:oe.next=Fe,oe=_e;var nt=d.alternate;nt!==null&&(nt=nt.updateQueue,be=nt.lastBaseUpdate,be!==oe&&(be===null?nt.firstBaseUpdate=Fe:be.next=Fe,nt.lastBaseUpdate=_e))}if(X!==null){var st=H.baseState;oe=0,nt=Fe=_e=null,be=X;do{var rt=be.lane,Nt=be.eventTime;if((A&rt)===rt){nt!==null&&(nt=nt.next={eventTime:Nt,lane:0,tag:be.tag,payload:be.payload,callback:be.callback,next:null});e:{var jt=d,zt=be;switch(rt=g,Nt=C,zt.tag){case 1:if(jt=zt.payload,typeof jt=="function"){st=jt.call(Nt,st,rt);break e}st=jt;break e;case 3:jt.flags=jt.flags&-65537|128;case 0:if(jt=zt.payload,rt=typeof jt=="function"?jt.call(Nt,st,rt):jt,rt==null)break e;st=re({},st,rt);break e;case 2:Fo=!0}}be.callback!==null&&be.lane!==0&&(d.flags|=64,rt=H.effects,rt===null?H.effects=[be]:rt.push(be))}else Nt={eventTime:Nt,lane:rt,tag:be.tag,payload:be.payload,callback:be.callback,next:null},nt===null?(Fe=nt=Nt,_e=st):nt=nt.next=Nt,oe|=rt;if(be=be.next,be===null){if(be=H.shared.pending,be===null)break;rt=be,be=rt.next,rt.next=null,H.lastBaseUpdate=rt,H.shared.pending=null}}while(!0);if(nt===null&&(_e=st),H.baseState=_e,H.firstBaseUpdate=Fe,H.lastBaseUpdate=nt,g=H.shared.interleaved,g!==null){H=g;do oe|=H.lane,H=H.next;while(H!==g)}else X===null&&(H.shared.lanes=0);jf|=oe,d.lanes=oe,d.memoizedState=st}}function Hn(d,g,C){if(d=g.effects,g.effects=null,d!==null)for(g=0;g<d.length;g++){var A=d[g],H=A.callback;if(H!==null){if(A.callback=null,A=C,typeof H!="function")throw Error(r(191,H));H.call(A)}}}var hr={},cn=Sl(hr),En=Sl(hr),ei=Sl(hr);function Si(d){if(d===hr)throw Error(r(174));return d}function cu(d,g){switch(un(ei,g),un(En,d),un(cn,hr),d=g.nodeType,d){case 9:case 11:g=(g=g.documentElement)?g.namespaceURI:Rt(null,"");break;default:d=d===8?g.parentNode:g,g=d.namespaceURI||null,d=d.tagName,g=Rt(g,d)}pn(cn),un(cn,g)}function Tn(){pn(cn),pn(En),pn(ei)}function Zc(d){Si(ei.current);var g=Si(cn.current),C=Rt(g,d.type);g!==C&&(un(En,d),un(cn,C))}function Cl(d){En.current===d&&(pn(cn),pn(En))}var mn=Sl(0);function Yc(d){for(var g=d;g!==null;){if(g.tag===13){var C=g.memoizedState;if(C!==null&&(C=C.dehydrated,C===null||C.data==="$?"||C.data==="$!"))return g}else if(g.tag===19&&g.memoizedProps.revealOrder!==void 0){if((g.flags&128)!==0)return g}else if(g.child!==null){g.child.return=g,g=g.child;continue}if(g===d)break;for(;g.sibling===null;){if(g.return===null||g.return===d)return null;g=g.return}g.sibling.return=g.return,g=g.sibling}return null}var Xu=[];function sa(){for(var d=0;d<Xu.length;d++)Xu[d]._workInProgressVersionPrimary=null;Xu.length=0}var Xc=N.ReactCurrentDispatcher,Df=N.ReactCurrentBatchConfig,La=0,rn=null,Wn=null,oi=null,fo=!1,du=!1,Gs=0,Qh=0;function li(){throw Error(r(321))}function If(d,g){if(g===null)return!1;for(var C=0;C<g.length&&C<d.length;C++)if(!ra(d[C],g[C]))return!1;return!0}function Qc(d,g,C,A,H,X){if(La=X,rn=g,g.memoizedState=null,g.updateQueue=null,g.lanes=0,Xc.current=d===null||d.memoizedState===null?ub:pu,d=C(A,H),du){X=0;do{if(du=!1,Gs=0,25<=X)throw Error(r(301));X+=1,oi=Wn=null,g.updateQueue=null,Xc.current=np,d=C(A,H)}while(du)}if(Xc.current=rd,g=Wn!==null&&Wn.next!==null,La=0,oi=Wn=rn=null,fo=!1,g)throw Error(r(300));return d}function Jc(){var d=Gs!==0;return Gs=0,d}function xn(){var d={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return oi===null?rn.memoizedState=oi=d:oi=oi.next=d,oi}function ki(){if(Wn===null){var d=rn.alternate;d=d!==null?d.memoizedState:null}else d=Wn.next;var g=oi===null?rn.memoizedState:oi.next;if(g!==null)oi=g,Wn=d;else{if(d===null)throw Error(r(310));Wn=d,d={memoizedState:Wn.memoizedState,baseState:Wn.baseState,baseQueue:Wn.baseQueue,queue:Wn.queue,next:null},oi===null?rn.memoizedState=oi=d:oi=oi.next=d}return oi}function oa(d,g){return typeof g=="function"?g(d):g}function la(d){var g=ki(),C=g.queue;if(C===null)throw Error(r(311));C.lastRenderedReducer=d;var A=Wn,H=A.baseQueue,X=C.pending;if(X!==null){if(H!==null){var oe=H.next;H.next=X.next,X.next=oe}A.baseQueue=H=X,C.pending=null}if(H!==null){X=H.next,A=A.baseState;var be=oe=null,_e=null,Fe=X;do{var nt=Fe.lane;if((La&nt)===nt)_e!==null&&(_e=_e.next={lane:0,action:Fe.action,hasEagerState:Fe.hasEagerState,eagerState:Fe.eagerState,next:null}),A=Fe.hasEagerState?Fe.eagerState:d(A,Fe.action);else{var st={lane:nt,action:Fe.action,hasEagerState:Fe.hasEagerState,eagerState:Fe.eagerState,next:null};_e===null?(be=_e=st,oe=A):_e=_e.next=st,rn.lanes|=nt,jf|=nt}Fe=Fe.next}while(Fe!==null&&Fe!==X);_e===null?oe=A:_e.next=be,ra(A,g.memoizedState)||(te=!0),g.memoizedState=A,g.baseState=oe,g.baseQueue=_e,C.lastRenderedState=A}if(d=C.interleaved,d!==null){H=d;do X=H.lane,rn.lanes|=X,jf|=X,H=H.next;while(H!==d)}else H===null&&(C.lanes=0);return[g.memoizedState,C.dispatch]}function Jh(d){var g=ki(),C=g.queue;if(C===null)throw Error(r(311));C.lastRenderedReducer=d;var A=C.dispatch,H=C.pending,X=g.memoizedState;if(H!==null){C.pending=null;var oe=H=H.next;do X=d(X,oe.action),oe=oe.next;while(oe!==H);ra(X,g.memoizedState)||(te=!0),g.memoizedState=X,g.baseQueue===null&&(g.baseState=X),C.lastRenderedState=X}return[X,A]}function ep(){}function tp(d,g){var C=rn,A=ki(),H=g(),X=!ra(A.memoizedState,H);if(X&&(A.memoizedState=H,te=!0),A=A.queue,Em(km.bind(null,C,A,d),[d]),A.getSnapshot!==g||X||oi!==null&&oi.memoizedState.tag&1){if(C.flags|=2048,ed(9,El.bind(null,C,A,H,g),void 0,null),ca===null)throw Error(r(349));(La&30)!==0||b0(C,g,H)}return H}function b0(d,g,C){d.flags|=16384,d={getSnapshot:g,value:C},g=rn.updateQueue,g===null?(g={lastEffect:null,stores:null},rn.updateQueue=g,g.stores=[d]):(C=g.stores,C===null?g.stores=[d]:C.push(d))}function El(d,g,C,A){g.value=C,g.getSnapshot=A,_m(g)&&rp(d)}function km(d,g,C){return C(function(){_m(g)&&rp(d)})}function _m(d){var g=d.getSnapshot;d=d.value;try{var C=g();return!ra(d,C)}catch{return!0}}function rp(d){var g=Ss(d,1);g!==null&&Ml(g,d,1,-1)}function fu(d){var g=xn();return typeof d=="function"&&(d=d()),g.memoizedState=g.baseState=d,d={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:oa,lastRenderedState:d},g.queue=d,d=d.dispatch=E0.bind(null,rn,d),[g.memoizedState,d]}function ed(d,g,C,A){return d={tag:d,create:g,destroy:C,deps:A,next:null},g=rn.updateQueue,g===null?(g={lastEffect:null,stores:null},rn.updateQueue=g,g.lastEffect=d.next=d):(C=g.lastEffect,C===null?g.lastEffect=d.next=d:(A=C.next,C.next=d,d.next=A,g.lastEffect=d)),d}function Cm(){return ki().memoizedState}function td(d,g,C,A){var H=xn();rn.flags|=d,H.memoizedState=ed(1|g,C,void 0,A===void 0?null:A)}function Qu(d,g,C,A){var H=ki();A=A===void 0?null:A;var X=void 0;if(Wn!==null){var oe=Wn.memoizedState;if(X=oe.destroy,A!==null&&If(A,oe.deps)){H.memoizedState=ed(g,C,X,A);return}}rn.flags|=d,H.memoizedState=ed(1|g,C,X,A)}function w0(d,g){return td(8390656,8,d,g)}function Em(d,g){return Qu(2048,8,d,g)}function Tm(d,g){return Qu(4,2,d,g)}function Nm(d,g){return Qu(4,4,d,g)}function hu(d,g){if(typeof g=="function")return d=d(),g(d),function(){g(null)};if(g!=null)return d=d(),g.current=d,function(){g.current=null}}function S0(d,g,C){return C=C!=null?C.concat([d]):null,Qu(4,4,hu.bind(null,g,d),C)}function Tl(){}function Pm(d,g){var C=ki();g=g===void 0?null:g;var A=C.memoizedState;return A!==null&&g!==null&&If(g,A[1])?A[0]:(C.memoizedState=[d,g],d)}function bn(d,g){var C=ki();g=g===void 0?null:g;var A=C.memoizedState;return A!==null&&g!==null&&If(g,A[1])?A[0]:(d=d(),C.memoizedState=[d,g],d)}function k0(d,g,C){return(La&21)===0?(d.baseState&&(d.baseState=!1,te=!0),d.memoizedState=C):(ra(C,g)||(C=Lr(),rn.lanes|=C,jf|=C,d.baseState=!0),g)}function _0(d,g){var C=xr;xr=C!==0&&4>C?C:4,d(!0);var A=Df.transition;Df.transition={};try{d(!1),g()}finally{xr=C,Df.transition=A}}function C0(){return ki().memoizedState}function lb(d,g,C){var A=cd(d);if(C={lane:A,action:C,hasEagerState:!1,eagerState:null,next:null},Mm(d))T0(g,C);else if(C=Rf(d,g,C,A),C!==null){var H=_s();Ml(C,d,A,H),ks(C,g,A)}}function E0(d,g,C){var A=cd(d),H={lane:A,action:C,hasEagerState:!1,eagerState:null,next:null};if(Mm(d))T0(g,H);else{var X=d.alternate;if(d.lanes===0&&(X===null||X.lanes===0)&&(X=g.lastRenderedReducer,X!==null))try{var oe=g.lastRenderedState,be=X(oe,C);if(H.hasEagerState=!0,H.eagerState=be,ra(be,oe)){var _e=g.interleaved;_e===null?(H.next=H,$c(g)):(H.next=_e.next,_e.next=H),g.interleaved=H;return}}catch{}C=Rf(d,g,H,A),C!==null&&(H=_s(),Ml(C,d,A,H),ks(C,g,A))}}function Mm(d){var g=d.alternate;return d===rn||g!==null&&g===rn}function T0(d,g){du=fo=!0;var C=d.pending;C===null?g.next=g:(g.next=C.next,C.next=g),d.pending=g}function ks(d,g,C){if((C&4194240)!==0){var A=g.lanes;A&=d.pendingLanes,C|=A,g.lanes=C,no(d,C)}}var rd={readContext:Ra,useCallback:li,useContext:li,useEffect:li,useImperativeHandle:li,useInsertionEffect:li,useLayoutEffect:li,useMemo:li,useReducer:li,useRef:li,useState:li,useDebugValue:li,useDeferredValue:li,useTransition:li,useMutableSource:li,useSyncExternalStore:li,useId:li,unstable_isNewReconciler:!1},ub={readContext:Ra,useCallback:function(d,g){return xn().memoizedState=[d,g===void 0?null:g],d},useContext:Ra,useEffect:w0,useImperativeHandle:function(d,g,C){return C=C!=null?C.concat([d]):null,td(4194308,4,hu.bind(null,g,d),C)},useLayoutEffect:function(d,g){return td(4194308,4,d,g)},useInsertionEffect:function(d,g){return td(4,2,d,g)},useMemo:function(d,g){var C=xn();return g=g===void 0?null:g,d=d(),C.memoizedState=[d,g],d},useReducer:function(d,g,C){var A=xn();return g=C!==void 0?C(g):g,A.memoizedState=A.baseState=g,d={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:d,lastRenderedState:g},A.queue=d,d=d.dispatch=lb.bind(null,rn,d),[A.memoizedState,d]},useRef:function(d){var g=xn();return d={current:d},g.memoizedState=d},useState:fu,useDebugValue:Tl,useDeferredValue:function(d){return xn().memoizedState=d},useTransition:function(){var d=fu(!1),g=d[0];return d=_0.bind(null,d[1]),xn().memoizedState=d,[g,d]},useMutableSource:function(){},useSyncExternalStore:function(d,g,C){var A=rn,H=xn();if(Yr){if(C===void 0)throw Error(r(407));C=C()}else{if(C=g(),ca===null)throw Error(r(349));(La&30)!==0||b0(A,g,C)}H.memoizedState=C;var X={value:C,getSnapshot:g};return H.queue=X,w0(km.bind(null,A,X,d),[d]),A.flags|=2048,ed(9,El.bind(null,A,X,C,g),void 0,null),C},useId:function(){var d=xn(),g=ca.identifierPrefix;if(Yr){var C=Cn,A=ys;C=(A&~(1<<32-qe(A)-1)).toString(32)+C,g=":"+g+"R"+C,C=Gs++,0<C&&(g+="H"+C.toString(32)),g+=":"}else C=Qh++,g=":"+g+"r"+C.toString(32)+":";return d.memoizedState=g},unstable_isNewReconciler:!1},pu={readContext:Ra,useCallback:Pm,useContext:Ra,useEffect:Em,useImperativeHandle:S0,useInsertionEffect:Tm,useLayoutEffect:Nm,useMemo:bn,useReducer:la,useRef:Cm,useState:function(){return la(oa)},useDebugValue:Tl,useDeferredValue:function(d){var g=ki();return k0(g,Wn.memoizedState,d)},useTransition:function(){var d=la(oa)[0],g=ki().memoizedState;return[d,g]},useMutableSource:ep,useSyncExternalStore:tp,useId:C0,unstable_isNewReconciler:!1},np={readContext:Ra,useCallback:Pm,useContext:Ra,useEffect:Em,useImperativeHandle:S0,useInsertionEffect:Tm,useLayoutEffect:Nm,useMemo:bn,useReducer:Jh,useRef:Cm,useState:function(){return Jh(oa)},useDebugValue:Tl,useDeferredValue:function(d){var g=ki();return Wn===null?g.memoizedState=d:k0(g,Wn.memoizedState,d)},useTransition:function(){var d=Jh(oa)[0],g=ki().memoizedState;return[d,g]},useMutableSource:ep,useSyncExternalStore:tp,useId:C0,unstable_isNewReconciler:!1};function Gi(d,g){if(d&&d.defaultProps){g=re({},g),d=d.defaultProps;for(var C in d)g[C]===void 0&&(g[C]=d[C]);return g}return g}function nd(d,g,C,A){g=d.memoizedState,C=C(A,g),C=C==null?g:re({},g,C),d.memoizedState=C,d.lanes===0&&(d.updateQueue.baseState=C)}var ad={isMounted:function(d){return(d=d._reactInternals)?ni(d)===d:!1},enqueueSetState:function(d,g,C){d=d._reactInternals;var A=_s(),H=cd(d),X=Bo(A,H);X.payload=g,C!=null&&(X.callback=C),g=zo(d,X,H),g!==null&&(Ml(g,d,H,A),Xh(g,d,H))},enqueueReplaceState:function(d,g,C){d=d._reactInternals;var A=_s(),H=cd(d),X=Bo(A,H);X.tag=1,X.payload=g,C!=null&&(X.callback=C),g=zo(d,X,H),g!==null&&(Ml(g,d,H,A),Xh(g,d,H))},enqueueForceUpdate:function(d,g){d=d._reactInternals;var C=_s(),A=cd(d),H=Bo(C,A);H.tag=2,g!=null&&(H.callback=g),g=zo(d,H,A),g!==null&&(Ml(g,d,A,C),Xh(g,d,A))}};function ip(d,g,C,A,H,X,oe){return d=d.stateNode,typeof d.shouldComponentUpdate=="function"?d.shouldComponentUpdate(A,X,oe):g.prototype&&g.prototype.isPureReactComponent?!Bs(C,A)||!Bs(H,X):!0}function N0(d,g,C){var A=!1,H=Do,X=g.contextType;return typeof X=="object"&&X!==null?X=Ra(X):(H=aa(g)?au:Ui.current,A=g.contextTypes,X=(A=A!=null)?Hu(d,H):Do),g=new g(C,X),d.memoizedState=g.state!==null&&g.state!==void 0?g.state:null,g.updater=ad,d.stateNode=g,g._reactInternals=d,A&&(d=d.stateNode,d.__reactInternalMemoizedUnmaskedChildContext=H,d.__reactInternalMemoizedMaskedChildContext=X),g}function Am(d,g,C,A){d=g.state,typeof g.componentWillReceiveProps=="function"&&g.componentWillReceiveProps(C,A),typeof g.UNSAFE_componentWillReceiveProps=="function"&&g.UNSAFE_componentWillReceiveProps(C,A),g.state!==d&&ad.enqueueReplaceState(g,g.state,null)}function ap(d,g,C,A){var H=d.stateNode;H.props=C,H.state=d.memoizedState,H.refs={},Lf(d);var X=g.contextType;typeof X=="object"&&X!==null?H.context=Ra(X):(X=aa(g)?au:Ui.current,H.context=Hu(d,X)),H.state=d.memoizedState,X=g.getDerivedStateFromProps,typeof X=="function"&&(nd(d,g,X,C),H.state=d.memoizedState),typeof g.getDerivedStateFromProps=="function"||typeof H.getSnapshotBeforeUpdate=="function"||typeof H.UNSAFE_componentWillMount!="function"&&typeof H.componentWillMount!="function"||(g=H.state,typeof H.componentWillMount=="function"&&H.componentWillMount(),typeof H.UNSAFE_componentWillMount=="function"&&H.UNSAFE_componentWillMount(),g!==H.state&&ad.enqueueReplaceState(H,H.state,null),Kc(d,C,H,A),H.state=d.memoizedState),typeof H.componentDidMount=="function"&&(d.flags|=4194308)}function Ju(d,g){try{var C="",A=g;do C+=he(A),A=A.return;while(A);var H=C}catch(X){H=`
Error generating stack: `+X.message+`
`+X.stack}return{value:d,source:g,stack:H,digest:null}}function sp(d,g,C){return{value:d,source:null,stack:C??null,digest:g??null}}function sd(d,g){try{console.error(g.value)}catch(C){setTimeout(function(){throw C})}}var cb=typeof WeakMap=="function"?WeakMap:Map;function P0(d,g,C){C=Bo(-1,C),C.tag=3,C.payload={element:null};var A=g.value;return C.callback=function(){O0||(O0=!0,bb=A),sd(d,g)},C}function x(d,g,C){C=Bo(-1,C),C.tag=3;var A=d.type.getDerivedStateFromError;if(typeof A=="function"){var H=g.value;C.payload=function(){return A(H)},C.callback=function(){sd(d,g)}}var X=d.stateNode;return X!==null&&typeof X.componentDidCatch=="function"&&(C.callback=function(){sd(d,g),typeof A!="function"&&(ld===null?ld=new Set([this]):ld.add(this));var oe=g.stack;this.componentDidCatch(g.value,{componentStack:oe!==null?oe:""})}),C}function b(d,g,C){var A=d.pingCache;if(A===null){A=d.pingCache=new cb;var H=new Set;A.set(g,H)}else H=A.get(g),H===void 0&&(H=new Set,A.set(g,H));H.has(C)||(H.add(C),d=PD.bind(null,d,g,C),g.then(d,d))}function M(d){do{var g;if((g=d.tag===13)&&(g=d.memoizedState,g=g!==null?g.dehydrated!==null:!0),g)return d;d=d.return}while(d!==null);return null}function z(d,g,C,A,H){return(d.mode&1)===0?(d===g?d.flags|=65536:(d.flags|=128,C.flags|=131072,C.flags&=-52805,C.tag===1&&(C.alternate===null?C.tag=17:(g=Bo(-1,1),g.tag=2,zo(C,g,1))),C.lanes|=1),d):(d.flags|=65536,d.lanes=H,d)}var $=N.ReactCurrentOwner,te=!1;function pe(d,g,C,A){g.child=d===null?Us(g,null,C,A):Yu(g,d.child,C,A)}function Ne(d,g,C,A,H){C=C.render;var X=g.ref;return _l(g,H),A=Qc(d,g,C,A,X,H),C=Jc(),d!==null&&!te?(g.updateQueue=d.updateQueue,g.flags&=-2053,d.lanes&=~H,ua(d,g,H)):(Yr&&C&&Hc(g),g.flags|=1,pe(d,g,A,H),g.child)}function Be(d,g,C,A,H){if(d===null){var X=C.type;return typeof X=="function"&&!Tb(X)&&X.defaultProps===void 0&&C.compare===null&&C.defaultProps===void 0?(g.tag=15,g.type=X,ct(d,g,X,A,H)):(d=z0(C.type,null,A,g,g.mode,H),d.ref=g.ref,d.return=g,g.child=d)}if(X=d.child,(d.lanes&H)===0){var oe=X.memoizedProps;if(C=C.compare,C=C!==null?C:Bs,C(oe,A)&&d.ref===g.ref)return ua(d,g,H)}return g.flags|=1,d=fd(X,A),d.ref=g.ref,d.return=g,g.child=d}function ct(d,g,C,A,H){if(d!==null){var X=d.memoizedProps;if(Bs(X,A)&&d.ref===g.ref)if(te=!1,g.pendingProps=A=X,(d.lanes&H)!==0)(d.flags&131072)!==0&&(te=!0);else return g.lanes=d.lanes,ua(d,g,H)}return Ct(d,g,C,A,H)}function Lt(d,g,C){var A=g.pendingProps,H=A.children,X=d!==null?d.memoizedState:null;if(A.mode==="hidden")if((g.mode&1)===0)g.memoizedState={baseLanes:0,cachePool:null,transitions:null},un(lp,ho),ho|=C;else{if((C&1073741824)===0)return d=X!==null?X.baseLanes|C:C,g.lanes=g.childLanes=1073741824,g.memoizedState={baseLanes:d,cachePool:null,transitions:null},g.updateQueue=null,un(lp,ho),ho|=d,null;g.memoizedState={baseLanes:0,cachePool:null,transitions:null},A=X!==null?X.baseLanes:C,un(lp,ho),ho|=A}else X!==null?(A=X.baseLanes|C,g.memoizedState=null):A=C,un(lp,ho),ho|=A;return pe(d,g,H,C),g.child}function ur(d,g){var C=g.ref;(d===null&&C!==null||d!==null&&d.ref!==C)&&(g.flags|=512,g.flags|=2097152)}function Ct(d,g,C,A,H){var X=aa(C)?au:Ui.current;return X=Hu(g,X),_l(g,H),C=Qc(d,g,C,A,X,H),A=Jc(),d!==null&&!te?(g.updateQueue=d.updateQueue,g.flags&=-2053,d.lanes&=~H,ua(d,g,H)):(Yr&&A&&Hc(g),g.flags|=1,pe(d,g,C,H),g.child)}function gn(d,g,C,A,H){if(aa(C)){var X=!0;Wu(g)}else X=!1;if(_l(g,H),g.stateNode===null)Or(d,g),N0(g,C,A),ap(g,C,A,H),A=!0;else if(d===null){var oe=g.stateNode,be=g.memoizedProps;oe.props=be;var _e=oe.context,Fe=C.contextType;typeof Fe=="object"&&Fe!==null?Fe=Ra(Fe):(Fe=aa(C)?au:Ui.current,Fe=Hu(g,Fe));var nt=C.getDerivedStateFromProps,st=typeof nt=="function"||typeof oe.getSnapshotBeforeUpdate=="function";st||typeof oe.UNSAFE_componentWillReceiveProps!="function"&&typeof oe.componentWillReceiveProps!="function"||(be!==A||_e!==Fe)&&Am(g,oe,A,Fe),Fo=!1;var rt=g.memoizedState;oe.state=rt,Kc(g,A,oe,H),_e=g.memoizedState,be!==A||rt!==_e||ia.current||Fo?(typeof nt=="function"&&(nd(g,C,nt,A),_e=g.memoizedState),(be=Fo||ip(g,C,be,A,rt,_e,Fe))?(st||typeof oe.UNSAFE_componentWillMount!="function"&&typeof oe.componentWillMount!="function"||(typeof oe.componentWillMount=="function"&&oe.componentWillMount(),typeof oe.UNSAFE_componentWillMount=="function"&&oe.UNSAFE_componentWillMount()),typeof oe.componentDidMount=="function"&&(g.flags|=4194308)):(typeof oe.componentDidMount=="function"&&(g.flags|=4194308),g.memoizedProps=A,g.memoizedState=_e),oe.props=A,oe.state=_e,oe.context=Fe,A=be):(typeof oe.componentDidMount=="function"&&(g.flags|=4194308),A=!1)}else{oe=g.stateNode,Yh(d,g),be=g.memoizedProps,Fe=g.type===g.elementType?be:Gi(g.type,be),oe.props=Fe,st=g.pendingProps,rt=oe.context,_e=C.contextType,typeof _e=="object"&&_e!==null?_e=Ra(_e):(_e=aa(C)?au:Ui.current,_e=Hu(g,_e));var Nt=C.getDerivedStateFromProps;(nt=typeof Nt=="function"||typeof oe.getSnapshotBeforeUpdate=="function")||typeof oe.UNSAFE_componentWillReceiveProps!="function"&&typeof oe.componentWillReceiveProps!="function"||(be!==st||rt!==_e)&&Am(g,oe,A,_e),Fo=!1,rt=g.memoizedState,oe.state=rt,Kc(g,A,oe,H);var jt=g.memoizedState;be!==st||rt!==jt||ia.current||Fo?(typeof Nt=="function"&&(nd(g,C,Nt,A),jt=g.memoizedState),(Fe=Fo||ip(g,C,Fe,A,rt,jt,_e)||!1)?(nt||typeof oe.UNSAFE_componentWillUpdate!="function"&&typeof oe.componentWillUpdate!="function"||(typeof oe.componentWillUpdate=="function"&&oe.componentWillUpdate(A,jt,_e),typeof oe.UNSAFE_componentWillUpdate=="function"&&oe.UNSAFE_componentWillUpdate(A,jt,_e)),typeof oe.componentDidUpdate=="function"&&(g.flags|=4),typeof oe.getSnapshotBeforeUpdate=="function"&&(g.flags|=1024)):(typeof oe.componentDidUpdate!="function"||be===d.memoizedProps&&rt===d.memoizedState||(g.flags|=4),typeof oe.getSnapshotBeforeUpdate!="function"||be===d.memoizedProps&&rt===d.memoizedState||(g.flags|=1024),g.memoizedProps=A,g.memoizedState=jt),oe.props=A,oe.state=jt,oe.context=_e,A=Fe):(typeof oe.componentDidUpdate!="function"||be===d.memoizedProps&&rt===d.memoizedState||(g.flags|=4),typeof oe.getSnapshotBeforeUpdate!="function"||be===d.memoizedProps&&rt===d.memoizedState||(g.flags|=1024),A=!1)}return Xr(d,g,C,A,X,H)}function Xr(d,g,C,A,H,X){ur(d,g);var oe=(g.flags&128)!==0;if(!A&&!oe)return H&&v0(g,C,!1),ua(d,g,X);A=g.stateNode,$.current=g;var be=oe&&typeof C.getDerivedStateFromError!="function"?null:A.render();return g.flags|=1,d!==null&&oe?(g.child=Yu(g,d.child,null,X),g.child=Yu(g,null,be,X)):pe(d,g,be,X),g.memoizedState=A.state,H&&v0(g,C,!0),g.child}function Oa(d){var g=d.stateNode;g.pendingContext?xm(d,g.pendingContext,g.pendingContext!==g.context):g.context&&xm(d,g.context,!1),cu(d,g.containerInfo)}function Uo(d,g,C,A,H){return Zu(),Mf(H),g.flags|=256,pe(d,g,C,A),g.child}var je={dehydrated:null,treeContext:null,retryLane:0};function Pe(d){return{baseLanes:d,cachePool:null,transitions:null}}function He(d,g,C){var A=g.pendingProps,H=mn.current,X=!1,oe=(g.flags&128)!==0,be;if((be=oe)||(be=d!==null&&d.memoizedState===null?!1:(H&2)!==0),be?(X=!0,g.flags&=-129):(d===null||d.memoizedState!==null)&&(H|=1),un(mn,H&1),d===null)return Wc(g),d=g.memoizedState,d!==null&&(d=d.dehydrated,d!==null)?((g.mode&1)===0?g.lanes=1:d.data==="$!"?g.lanes=8:g.lanes=1073741824,null):(oe=A.children,d=A.fallback,X?(A=g.mode,X=g.child,oe={mode:"hidden",children:oe},(A&1)===0&&X!==null?(X.childLanes=0,X.pendingProps=oe):X=U0(oe,A,0,null),d=Uf(d,A,C,null),X.return=g,d.return=g,X.sibling=d,g.child=X,g.child.memoizedState=Pe(C),g.memoizedState=je,d):Tt(g,oe));if(H=d.memoizedState,H!==null&&(be=H.dehydrated,be!==null))return mr(d,g,oe,A,be,H,C);if(X){X=A.fallback,oe=g.mode,H=d.child,be=H.sibling;var _e={mode:"hidden",children:A.children};return(oe&1)===0&&g.child!==H?(A=g.child,A.childLanes=0,A.pendingProps=_e,g.deletions=null):(A=fd(H,_e),A.subtreeFlags=H.subtreeFlags&14680064),be!==null?X=fd(be,X):(X=Uf(X,oe,C,null),X.flags|=2),X.return=g,A.return=g,A.sibling=X,g.child=A,A=X,X=g.child,oe=d.child.memoizedState,oe=oe===null?Pe(C):{baseLanes:oe.baseLanes|C,cachePool:null,transitions:oe.transitions},X.memoizedState=oe,X.childLanes=d.childLanes&~C,g.memoizedState=je,A}return X=d.child,d=X.sibling,A=fd(X,{mode:"visible",children:A.children}),(g.mode&1)===0&&(A.lanes=C),A.return=g,A.sibling=null,d!==null&&(C=g.deletions,C===null?(g.deletions=[d],g.flags|=16):C.push(d)),g.child=A,g.memoizedState=null,A}function Tt(d,g){return g=U0({mode:"visible",children:g},d.mode,0,null),g.return=d,d.child=g}function qt(d,g,C,A){return A!==null&&Mf(A),Yu(g,d.child,null,C),d=Tt(g,g.pendingProps.children),d.flags|=2,g.memoizedState=null,d}function mr(d,g,C,A,H,X,oe){if(C)return g.flags&256?(g.flags&=-257,A=sp(Error(r(422))),qt(d,g,oe,A)):g.memoizedState!==null?(g.child=d.child,g.flags|=128,null):(X=A.fallback,H=g.mode,A=U0({mode:"visible",children:A.children},H,0,null),X=Uf(X,H,oe,null),X.flags|=2,A.return=g,X.return=g,A.sibling=X,g.child=A,(g.mode&1)!==0&&Yu(g,d.child,null,oe),g.child.memoizedState=Pe(oe),g.memoizedState=je,X);if((g.mode&1)===0)return qt(d,g,oe,null);if(H.data==="$!"){if(A=H.nextSibling&&H.nextSibling.dataset,A)var be=A.dgst;return A=be,X=Error(r(419)),A=sp(X,A,void 0),qt(d,g,oe,A)}if(be=(oe&d.childLanes)!==0,te||be){if(A=ca,A!==null){switch(oe&-oe){case 4:H=2;break;case 16:H=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:H=32;break;case 536870912:H=268435456;break;default:H=0}H=(H&(A.suspendedLanes|oe))!==0?0:H,H!==0&&H!==X.retryLane&&(X.retryLane=H,Ss(d,H),Ml(A,d,H,-1))}return Eb(),A=sp(Error(r(421))),qt(d,g,oe,A)}return H.data==="$?"?(g.flags|=128,g.child=d.child,g=MD.bind(null,d),H._reactRetry=g,null):(d=X.treeContext,xt=zs(H.nextSibling),xs=g,Yr=!0,bs=null,d!==null&&(Ma[Aa++]=ys,Ma[Aa++]=Cn,Ma[Aa++]=uu,ys=d.id,Cn=d.overflow,uu=g),g=Tt(g,A.children),g.flags|=4096,g)}function cr(d,g,C){d.lanes|=g;var A=d.alternate;A!==null&&(A.lanes|=g),Zh(d.return,g,C)}function jr(d,g,C,A,H){var X=d.memoizedState;X===null?d.memoizedState={isBackwards:g,rendering:null,renderingStartTime:0,last:A,tail:C,tailMode:H}:(X.isBackwards=g,X.rendering=null,X.renderingStartTime=0,X.last=A,X.tail=C,X.tailMode=H)}function _i(d,g,C){var A=g.pendingProps,H=A.revealOrder,X=A.tail;if(pe(d,g,A.children,C),A=mn.current,(A&2)!==0)A=A&1|2,g.flags|=128;else{if(d!==null&&(d.flags&128)!==0)e:for(d=g.child;d!==null;){if(d.tag===13)d.memoizedState!==null&&cr(d,C,g);else if(d.tag===19)cr(d,C,g);else if(d.child!==null){d.child.return=d,d=d.child;continue}if(d===g)break e;for(;d.sibling===null;){if(d.return===null||d.return===g)break e;d=d.return}d.sibling.return=d.return,d=d.sibling}A&=1}if(un(mn,A),(g.mode&1)===0)g.memoizedState=null;else switch(H){case"forwards":for(C=g.child,H=null;C!==null;)d=C.alternate,d!==null&&Yc(d)===null&&(H=C),C=C.sibling;C=H,C===null?(H=g.child,g.child=null):(H=C.sibling,C.sibling=null),jr(g,!1,H,C,X);break;case"backwards":for(C=null,H=g.child,g.child=null;H!==null;){if(d=H.alternate,d!==null&&Yc(d)===null){g.child=H;break}d=H.sibling,H.sibling=C,C=H,H=d}jr(g,!0,C,null,X);break;case"together":jr(g,!1,null,null,void 0);break;default:g.memoizedState=null}return g.child}function Or(d,g){(g.mode&1)===0&&d!==null&&(d.alternate=null,g.alternate=null,g.flags|=2)}function ua(d,g,C){if(d!==null&&(g.dependencies=d.dependencies),jf|=g.lanes,(C&g.childLanes)===0)return null;if(d!==null&&g.child!==d.child)throw Error(r(153));if(g.child!==null){for(d=g.child,C=fd(d,d.pendingProps),g.child=C,C.return=g;d.sibling!==null;)d=d.sibling,C=C.sibling=fd(d,d.pendingProps),C.return=g;C.sibling=null}return g.child}function db(d,g,C){switch(g.tag){case 3:Oa(g),Zu();break;case 5:Zc(g);break;case 1:aa(g.type)&&Wu(g);break;case 4:cu(g,g.stateNode.containerInfo);break;case 10:var A=g.type._context,H=g.memoizedProps.value;un(Af,A._currentValue),A._currentValue=H;break;case 13:if(A=g.memoizedState,A!==null)return A.dehydrated!==null?(un(mn,mn.current&1),g.flags|=128,null):(C&g.child.childLanes)!==0?He(d,g,C):(un(mn,mn.current&1),d=ua(d,g,C),d!==null?d.sibling:null);un(mn,mn.current&1);break;case 19:if(A=(C&g.childLanes)!==0,(d.flags&128)!==0){if(A)return _i(d,g,C);g.flags|=128}if(H=g.memoizedState,H!==null&&(H.rendering=null,H.tail=null,H.lastEffect=null),un(mn,mn.current),A)break;return null;case 22:case 23:return g.lanes=0,Lt(d,g,C)}return ua(d,g,C)}var PC,fb,MC,AC;PC=function(d,g){for(var C=g.child;C!==null;){if(C.tag===5||C.tag===6)d.appendChild(C.stateNode);else if(C.tag!==4&&C.child!==null){C.child.return=C,C=C.child;continue}if(C===g)break;for(;C.sibling===null;){if(C.return===null||C.return===g)return;C=C.return}C.sibling.return=C.return,C=C.sibling}},fb=function(){},MC=function(d,g,C,A){var H=d.memoizedProps;if(H!==A){d=g.stateNode,Si(cn.current);var X=null;switch(C){case"input":H=Ue(d,H),A=Ue(d,A),X=[];break;case"select":H=re({},H,{value:void 0}),A=re({},A,{value:void 0}),X=[];break;case"textarea":H=Ie(d,H),A=Ie(d,A),X=[];break;default:typeof H.onClick!="function"&&typeof A.onClick=="function"&&(d.onclick=Ze)}Te(C,A);var oe;C=null;for(Fe in H)if(!A.hasOwnProperty(Fe)&&H.hasOwnProperty(Fe)&&H[Fe]!=null)if(Fe==="style"){var be=H[Fe];for(oe in be)be.hasOwnProperty(oe)&&(C||(C={}),C[oe]="")}else Fe!=="dangerouslySetInnerHTML"&&Fe!=="children"&&Fe!=="suppressContentEditableWarning"&&Fe!=="suppressHydrationWarning"&&Fe!=="autoFocus"&&(i.hasOwnProperty(Fe)?X||(X=[]):(X=X||[]).push(Fe,null));for(Fe in A){var _e=A[Fe];if(be=H?.[Fe],A.hasOwnProperty(Fe)&&_e!==be&&(_e!=null||be!=null))if(Fe==="style")if(be){for(oe in be)!be.hasOwnProperty(oe)||_e&&_e.hasOwnProperty(oe)||(C||(C={}),C[oe]="");for(oe in _e)_e.hasOwnProperty(oe)&&be[oe]!==_e[oe]&&(C||(C={}),C[oe]=_e[oe])}else C||(X||(X=[]),X.push(Fe,C)),C=_e;else Fe==="dangerouslySetInnerHTML"?(_e=_e?_e.__html:void 0,be=be?be.__html:void 0,_e!=null&&be!==_e&&(X=X||[]).push(Fe,_e)):Fe==="children"?typeof _e!="string"&&typeof _e!="number"||(X=X||[]).push(Fe,""+_e):Fe!=="suppressContentEditableWarning"&&Fe!=="suppressHydrationWarning"&&(i.hasOwnProperty(Fe)?(_e!=null&&Fe==="onScroll"&&Kr("scroll",d),X||be===_e||(X=[])):(X=X||[]).push(Fe,_e))}C&&(X=X||[]).push("style",C);var Fe=X;(g.updateQueue=Fe)&&(g.flags|=4)}},AC=function(d,g,C,A){C!==A&&(g.flags|=4)};function Rm(d,g){if(!Yr)switch(d.tailMode){case"hidden":g=d.tail;for(var C=null;g!==null;)g.alternate!==null&&(C=g),g=g.sibling;C===null?d.tail=null:C.sibling=null;break;case"collapsed":C=d.tail;for(var A=null;C!==null;)C.alternate!==null&&(A=C),C=C.sibling;A===null?g||d.tail===null?d.tail=null:d.tail.sibling=null:A.sibling=null}}function rs(d){var g=d.alternate!==null&&d.alternate.child===d.child,C=0,A=0;if(g)for(var H=d.child;H!==null;)C|=H.lanes|H.childLanes,A|=H.subtreeFlags&14680064,A|=H.flags&14680064,H.return=d,H=H.sibling;else for(H=d.child;H!==null;)C|=H.lanes|H.childLanes,A|=H.subtreeFlags,A|=H.flags,H.return=d,H=H.sibling;return d.subtreeFlags|=A,d.childLanes=C,g}function xD(d,g,C){var A=g.pendingProps;switch(Ri(g),g.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return rs(g),null;case 1:return aa(g.type)&&Gc(),rs(g),null;case 3:return A=g.stateNode,Tn(),pn(ia),pn(Ui),sa(),A.pendingContext&&(A.context=A.pendingContext,A.pendingContext=null),(d===null||d.child===null)&&(Pf(g)?g.flags|=4:d===null||d.memoizedState.isDehydrated&&(g.flags&256)===0||(g.flags|=1024,bs!==null&&(kb(bs),bs=null))),fb(d,g),rs(g),null;case 5:Cl(g);var H=Si(ei.current);if(C=g.type,d!==null&&g.stateNode!=null)MC(d,g,C,A,H),d.ref!==g.ref&&(g.flags|=512,g.flags|=2097152);else{if(!A){if(g.stateNode===null)throw Error(r(166));return rs(g),null}if(d=Si(cn.current),Pf(g)){A=g.stateNode,C=g.type;var X=g.memoizedProps;switch(A[es]=g,A[iu]=X,d=(g.mode&1)!==0,C){case"dialog":Kr("cancel",A),Kr("close",A);break;case"iframe":case"object":case"embed":Kr("load",A);break;case"video":case"audio":for(H=0;H<lo.length;H++)Kr(lo[H],A);break;case"source":Kr("error",A);break;case"img":case"image":case"link":Kr("error",A),Kr("load",A);break;case"details":Kr("toggle",A);break;case"input":Oe(A,X),Kr("invalid",A);break;case"select":A._wrapperState={wasMultiple:!!X.multiple},Kr("invalid",A);break;case"textarea":Je(A,X),Kr("invalid",A)}Te(C,X),H=null;for(var oe in X)if(X.hasOwnProperty(oe)){var be=X[oe];oe==="children"?typeof be=="string"?A.textContent!==be&&(X.suppressHydrationWarning!==!0&&De(A.textContent,be,d),H=["children",be]):typeof be=="number"&&A.textContent!==""+be&&(X.suppressHydrationWarning!==!0&&De(A.textContent,be,d),H=["children",""+be]):i.hasOwnProperty(oe)&&be!=null&&oe==="onScroll"&&Kr("scroll",A)}switch(C){case"input":se(A),at(A,X,!0);break;case"textarea":se(A),gt(A);break;case"select":case"option":break;default:typeof X.onClick=="function"&&(A.onclick=Ze)}A=H,g.updateQueue=A,A!==null&&(g.flags|=4)}else{oe=H.nodeType===9?H:H.ownerDocument,d==="http://www.w3.org/1999/xhtml"&&(d=At(C)),d==="http://www.w3.org/1999/xhtml"?C==="script"?(d=oe.createElement("div"),d.innerHTML="<script><\/script>",d=d.removeChild(d.firstChild)):typeof A.is=="string"?d=oe.createElement(C,{is:A.is}):(d=oe.createElement(C),C==="select"&&(oe=d,A.multiple?oe.multiple=!0:A.size&&(oe.size=A.size))):d=oe.createElementNS(d,C),d[es]=g,d[iu]=A,PC(d,g,!1,!1),g.stateNode=d;e:{switch(oe=Ae(C,A),C){case"dialog":Kr("cancel",d),Kr("close",d),H=A;break;case"iframe":case"object":case"embed":Kr("load",d),H=A;break;case"video":case"audio":for(H=0;H<lo.length;H++)Kr(lo[H],d);H=A;break;case"source":Kr("error",d),H=A;break;case"img":case"image":case"link":Kr("error",d),Kr("load",d),H=A;break;case"details":Kr("toggle",d),H=A;break;case"input":Oe(d,A),H=Ue(d,A),Kr("invalid",d);break;case"option":H=A;break;case"select":d._wrapperState={wasMultiple:!!A.multiple},H=re({},A,{value:void 0}),Kr("invalid",d);break;case"textarea":Je(d,A),H=Ie(d,A),Kr("invalid",d);break;default:H=A}Te(C,H),be=H;for(X in be)if(be.hasOwnProperty(X)){var _e=be[X];X==="style"?me(d,_e):X==="dangerouslySetInnerHTML"?(_e=_e?_e.__html:void 0,_e!=null&&Vt(d,_e)):X==="children"?typeof _e=="string"?(C!=="textarea"||_e!=="")&&pt(d,_e):typeof _e=="number"&&pt(d,""+_e):X!=="suppressContentEditableWarning"&&X!=="suppressHydrationWarning"&&X!=="autoFocus"&&(i.hasOwnProperty(X)?_e!=null&&X==="onScroll"&&Kr("scroll",d):_e!=null&&T(d,X,_e,oe))}switch(C){case"input":se(d),at(d,A,!1);break;case"textarea":se(d),gt(d);break;case"option":A.value!=null&&d.setAttribute("value",""+fe(A.value));break;case"select":d.multiple=!!A.multiple,X=A.value,X!=null?Ce(d,!!A.multiple,X,!1):A.defaultValue!=null&&Ce(d,!!A.multiple,A.defaultValue,!0);break;default:typeof H.onClick=="function"&&(d.onclick=Ze)}switch(C){case"button":case"input":case"select":case"textarea":A=!!A.autoFocus;break e;case"img":A=!0;break e;default:A=!1}}A&&(g.flags|=4)}g.ref!==null&&(g.flags|=512,g.flags|=2097152)}return rs(g),null;case 6:if(d&&g.stateNode!=null)AC(d,g,d.memoizedProps,A);else{if(typeof A!="string"&&g.stateNode===null)throw Error(r(166));if(C=Si(ei.current),Si(cn.current),Pf(g)){if(A=g.stateNode,C=g.memoizedProps,A[es]=g,(X=A.nodeValue!==C)&&(d=xs,d!==null))switch(d.tag){case 3:De(A.nodeValue,C,(d.mode&1)!==0);break;case 5:d.memoizedProps.suppressHydrationWarning!==!0&&De(A.nodeValue,C,(d.mode&1)!==0)}X&&(g.flags|=4)}else A=(C.nodeType===9?C:C.ownerDocument).createTextNode(A),A[es]=g,g.stateNode=A}return rs(g),null;case 13:if(pn(mn),A=g.memoizedState,d===null||d.memoizedState!==null&&d.memoizedState.dehydrated!==null){if(Yr&&xt!==null&&(g.mode&1)!==0&&(g.flags&128)===0)wm(),Zu(),g.flags|=98560,X=!1;else if(X=Pf(g),A!==null&&A.dehydrated!==null){if(d===null){if(!X)throw Error(r(318));if(X=g.memoizedState,X=X!==null?X.dehydrated:null,!X)throw Error(r(317));X[es]=g}else Zu(),(g.flags&128)===0&&(g.memoizedState=null),g.flags|=4;rs(g),X=!1}else bs!==null&&(kb(bs),bs=null),X=!0;if(!X)return g.flags&65536?g:null}return(g.flags&128)!==0?(g.lanes=C,g):(A=A!==null,A!==(d!==null&&d.memoizedState!==null)&&A&&(g.child.flags|=8192,(g.mode&1)!==0&&(d===null||(mn.current&1)!==0?Vi===0&&(Vi=3):Eb())),g.updateQueue!==null&&(g.flags|=4),rs(g),null);case 4:return Tn(),fb(d,g),d===null&&Lo(g.stateNode.containerInfo),rs(g),null;case 10:return Kh(g.type._context),rs(g),null;case 17:return aa(g.type)&&Gc(),rs(g),null;case 19:if(pn(mn),X=g.memoizedState,X===null)return rs(g),null;if(A=(g.flags&128)!==0,oe=X.rendering,oe===null)if(A)Rm(X,!1);else{if(Vi!==0||d!==null&&(d.flags&128)!==0)for(d=g.child;d!==null;){if(oe=Yc(d),oe!==null){for(g.flags|=128,Rm(X,!1),A=oe.updateQueue,A!==null&&(g.updateQueue=A,g.flags|=4),g.subtreeFlags=0,A=C,C=g.child;C!==null;)X=C,d=A,X.flags&=14680066,oe=X.alternate,oe===null?(X.childLanes=0,X.lanes=d,X.child=null,X.subtreeFlags=0,X.memoizedProps=null,X.memoizedState=null,X.updateQueue=null,X.dependencies=null,X.stateNode=null):(X.childLanes=oe.childLanes,X.lanes=oe.lanes,X.child=oe.child,X.subtreeFlags=0,X.deletions=null,X.memoizedProps=oe.memoizedProps,X.memoizedState=oe.memoizedState,X.updateQueue=oe.updateQueue,X.type=oe.type,d=oe.dependencies,X.dependencies=d===null?null:{lanes:d.lanes,firstContext:d.firstContext}),C=C.sibling;return un(mn,mn.current&1|2),g.child}d=d.sibling}X.tail!==null&&on()>up&&(g.flags|=128,A=!0,Rm(X,!1),g.lanes=4194304)}else{if(!A)if(d=Yc(oe),d!==null){if(g.flags|=128,A=!0,C=d.updateQueue,C!==null&&(g.updateQueue=C,g.flags|=4),Rm(X,!0),X.tail===null&&X.tailMode==="hidden"&&!oe.alternate&&!Yr)return rs(g),null}else 2*on()-X.renderingStartTime>up&&C!==1073741824&&(g.flags|=128,A=!0,Rm(X,!1),g.lanes=4194304);X.isBackwards?(oe.sibling=g.child,g.child=oe):(C=X.last,C!==null?C.sibling=oe:g.child=oe,X.last=oe)}return X.tail!==null?(g=X.tail,X.rendering=g,X.tail=g.sibling,X.renderingStartTime=on(),g.sibling=null,C=mn.current,un(mn,A?C&1|2:C&1),g):(rs(g),null);case 22:case 23:return Cb(),A=g.memoizedState!==null,d!==null&&d.memoizedState!==null!==A&&(g.flags|=8192),A&&(g.mode&1)!==0?(ho&1073741824)!==0&&(rs(g),g.subtreeFlags&6&&(g.flags|=8192)):rs(g),null;case 24:return null;case 25:return null}throw Error(r(156,g.tag))}function bD(d,g){switch(Ri(g),g.tag){case 1:return aa(g.type)&&Gc(),d=g.flags,d&65536?(g.flags=d&-65537|128,g):null;case 3:return Tn(),pn(ia),pn(Ui),sa(),d=g.flags,(d&65536)!==0&&(d&128)===0?(g.flags=d&-65537|128,g):null;case 5:return Cl(g),null;case 13:if(pn(mn),d=g.memoizedState,d!==null&&d.dehydrated!==null){if(g.alternate===null)throw Error(r(340));Zu()}return d=g.flags,d&65536?(g.flags=d&-65537|128,g):null;case 19:return pn(mn),null;case 4:return Tn(),null;case 10:return Kh(g.type._context),null;case 22:case 23:return Cb(),null;case 24:return null;default:return null}}var M0=!1,ns=!1,wD=typeof WeakSet=="function"?WeakSet:Set,Ot=null;function op(d,g){var C=d.ref;if(C!==null)if(typeof C=="function")try{C(null)}catch(A){ui(d,g,A)}else C.current=null}function hb(d,g,C){try{C()}catch(A){ui(d,g,A)}}var RC=!1;function SD(d,g){if(kt=Du,d=Un(),eu(d)){if("selectionStart"in d)var C={start:d.selectionStart,end:d.selectionEnd};else e:{C=(C=d.ownerDocument)&&C.defaultView||window;var A=C.getSelection&&C.getSelection();if(A&&A.rangeCount!==0){C=A.anchorNode;var H=A.anchorOffset,X=A.focusNode;A=A.focusOffset;try{C.nodeType,X.nodeType}catch{C=null;break e}var oe=0,be=-1,_e=-1,Fe=0,nt=0,st=d,rt=null;t:for(;;){for(var Nt;st!==C||H!==0&&st.nodeType!==3||(be=oe+H),st!==X||A!==0&&st.nodeType!==3||(_e=oe+A),st.nodeType===3&&(oe+=st.nodeValue.length),(Nt=st.firstChild)!==null;)rt=st,st=Nt;for(;;){if(st===d)break t;if(rt===C&&++Fe===H&&(be=oe),rt===X&&++nt===A&&(_e=oe),(Nt=st.nextSibling)!==null)break;st=rt,rt=st.parentNode}st=Nt}C=be===-1||_e===-1?null:{start:be,end:_e}}else C=null}C=C||{start:0,end:0}}else C=null;for(Yt={focusedElem:d,selectionRange:C},Du=!1,Ot=g;Ot!==null;)if(g=Ot,d=g.child,(g.subtreeFlags&1028)!==0&&d!==null)d.return=g,Ot=d;else for(;Ot!==null;){g=Ot;try{var jt=g.alternate;if((g.flags&1024)!==0)switch(g.tag){case 0:case 11:case 15:break;case 1:if(jt!==null){var zt=jt.memoizedProps,Ci=jt.memoizedState,Re=g.stateNode,Ee=Re.getSnapshotBeforeUpdate(g.elementType===g.type?zt:Gi(g.type,zt),Ci);Re.__reactInternalSnapshotBeforeUpdate=Ee}break;case 3:var Le=g.stateNode.containerInfo;Le.nodeType===1?Le.textContent="":Le.nodeType===9&&Le.documentElement&&Le.removeChild(Le.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(r(163))}}catch(ht){ui(g,g.return,ht)}if(d=g.sibling,d!==null){d.return=g.return,Ot=d;break}Ot=g.return}return jt=RC,RC=!1,jt}function Lm(d,g,C){var A=g.updateQueue;if(A=A!==null?A.lastEffect:null,A!==null){var H=A=A.next;do{if((H.tag&d)===d){var X=H.destroy;H.destroy=void 0,X!==void 0&&hb(g,C,X)}H=H.next}while(H!==A)}}function A0(d,g){if(g=g.updateQueue,g=g!==null?g.lastEffect:null,g!==null){var C=g=g.next;do{if((C.tag&d)===d){var A=C.create;C.destroy=A()}C=C.next}while(C!==g)}}function pb(d){var g=d.ref;if(g!==null){var C=d.stateNode;d.tag,d=C,typeof g=="function"?g(d):g.current=d}}function LC(d){var g=d.alternate;g!==null&&(d.alternate=null,LC(g)),d.child=null,d.deletions=null,d.sibling=null,d.tag===5&&(g=d.stateNode,g!==null&&(delete g[es],delete g[iu],delete g[bl],delete g[Bh],delete g[zh])),d.stateNode=null,d.return=null,d.dependencies=null,d.memoizedProps=null,d.memoizedState=null,d.pendingProps=null,d.stateNode=null,d.updateQueue=null}function OC(d){return d.tag===5||d.tag===3||d.tag===4}function DC(d){e:for(;;){for(;d.sibling===null;){if(d.return===null||OC(d.return))return null;d=d.return}for(d.sibling.return=d.return,d=d.sibling;d.tag!==5&&d.tag!==6&&d.tag!==18;){if(d.flags&2||d.child===null||d.tag===4)continue e;d.child.return=d,d=d.child}if(!(d.flags&2))return d.stateNode}}function mb(d,g,C){var A=d.tag;if(A===5||A===6)d=d.stateNode,g?C.nodeType===8?C.parentNode.insertBefore(d,g):C.insertBefore(d,g):(C.nodeType===8?(g=C.parentNode,g.insertBefore(d,C)):(g=C,g.appendChild(d)),C=C._reactRootContainer,C!=null||g.onclick!==null||(g.onclick=Ze));else if(A!==4&&(d=d.child,d!==null))for(mb(d,g,C),d=d.sibling;d!==null;)mb(d,g,C),d=d.sibling}function gb(d,g,C){var A=d.tag;if(A===5||A===6)d=d.stateNode,g?C.insertBefore(d,g):C.appendChild(d);else if(A!==4&&(d=d.child,d!==null))for(gb(d,g,C),d=d.sibling;d!==null;)gb(d,g,C),d=d.sibling}var Da=null,Nl=!1;function od(d,g,C){for(C=C.child;C!==null;)IC(d,g,C),C=C.sibling}function IC(d,g,C){if(tt&&typeof tt.onCommitFiberUnmount=="function")try{tt.onCommitFiberUnmount(Ke,C)}catch{}switch(C.tag){case 5:ns||op(C,g);case 6:var A=Da,H=Nl;Da=null,od(d,g,C),Da=A,Nl=H,Da!==null&&(Nl?(d=Da,C=C.stateNode,d.nodeType===8?d.parentNode.removeChild(C):d.removeChild(C)):Da.removeChild(C.stateNode));break;case 18:Da!==null&&(Nl?(d=Da,C=C.stateNode,d.nodeType===8?Uc(d.parentNode,C):d.nodeType===1&&Uc(d,C),Fn(d)):Uc(Da,C.stateNode));break;case 4:A=Da,H=Nl,Da=C.stateNode.containerInfo,Nl=!0,od(d,g,C),Da=A,Nl=H;break;case 0:case 11:case 14:case 15:if(!ns&&(A=C.updateQueue,A!==null&&(A=A.lastEffect,A!==null))){H=A=A.next;do{var X=H,oe=X.destroy;X=X.tag,oe!==void 0&&((X&2)!==0||(X&4)!==0)&&hb(C,g,oe),H=H.next}while(H!==A)}od(d,g,C);break;case 1:if(!ns&&(op(C,g),A=C.stateNode,typeof A.componentWillUnmount=="function"))try{A.props=C.memoizedProps,A.state=C.memoizedState,A.componentWillUnmount()}catch(be){ui(C,g,be)}od(d,g,C);break;case 21:od(d,g,C);break;case 22:C.mode&1?(ns=(A=ns)||C.memoizedState!==null,od(d,g,C),ns=A):od(d,g,C);break;default:od(d,g,C)}}function jC(d){var g=d.updateQueue;if(g!==null){d.updateQueue=null;var C=d.stateNode;C===null&&(C=d.stateNode=new wD),g.forEach(function(A){var H=AD.bind(null,d,A);C.has(A)||(C.add(A),A.then(H,H))})}}function Pl(d,g){var C=g.deletions;if(C!==null)for(var A=0;A<C.length;A++){var H=C[A];try{var X=d,oe=g,be=oe;e:for(;be!==null;){switch(be.tag){case 5:Da=be.stateNode,Nl=!1;break e;case 3:Da=be.stateNode.containerInfo,Nl=!0;break e;case 4:Da=be.stateNode.containerInfo,Nl=!0;break e}be=be.return}if(Da===null)throw Error(r(160));IC(X,oe,H),Da=null,Nl=!1;var _e=H.alternate;_e!==null&&(_e.return=null),H.return=null}catch(Fe){ui(H,g,Fe)}}if(g.subtreeFlags&12854)for(g=g.child;g!==null;)FC(g,d),g=g.sibling}function FC(d,g){var C=d.alternate,A=d.flags;switch(d.tag){case 0:case 11:case 14:case 15:if(Pl(g,d),mu(d),A&4){try{Lm(3,d,d.return),A0(3,d)}catch(zt){ui(d,d.return,zt)}try{Lm(5,d,d.return)}catch(zt){ui(d,d.return,zt)}}break;case 1:Pl(g,d),mu(d),A&512&&C!==null&&op(C,C.return);break;case 5:if(Pl(g,d),mu(d),A&512&&C!==null&&op(C,C.return),d.flags&32){var H=d.stateNode;try{pt(H,"")}catch(zt){ui(d,d.return,zt)}}if(A&4&&(H=d.stateNode,H!=null)){var X=d.memoizedProps,oe=C!==null?C.memoizedProps:X,be=d.type,_e=d.updateQueue;if(d.updateQueue=null,_e!==null)try{be==="input"&&X.type==="radio"&&X.name!=null&&mt(H,X),Ae(be,oe);var Fe=Ae(be,X);for(oe=0;oe<_e.length;oe+=2){var nt=_e[oe],st=_e[oe+1];nt==="style"?me(H,st):nt==="dangerouslySetInnerHTML"?Vt(H,st):nt==="children"?pt(H,st):T(H,nt,st,Fe)}switch(be){case"input":lt(H,X);break;case"textarea":Qe(H,X);break;case"select":var rt=H._wrapperState.wasMultiple;H._wrapperState.wasMultiple=!!X.multiple;var Nt=X.value;Nt!=null?Ce(H,!!X.multiple,Nt,!1):rt!==!!X.multiple&&(X.defaultValue!=null?Ce(H,!!X.multiple,X.defaultValue,!0):Ce(H,!!X.multiple,X.multiple?[]:"",!1))}H[iu]=X}catch(zt){ui(d,d.return,zt)}}break;case 6:if(Pl(g,d),mu(d),A&4){if(d.stateNode===null)throw Error(r(162));H=d.stateNode,X=d.memoizedProps;try{H.nodeValue=X}catch(zt){ui(d,d.return,zt)}}break;case 3:if(Pl(g,d),mu(d),A&4&&C!==null&&C.memoizedState.isDehydrated)try{Fn(g.containerInfo)}catch(zt){ui(d,d.return,zt)}break;case 4:Pl(g,d),mu(d);break;case 13:Pl(g,d),mu(d),H=d.child,H.flags&8192&&(X=H.memoizedState!==null,H.stateNode.isHidden=X,!X||H.alternate!==null&&H.alternate.memoizedState!==null||(xb=on())),A&4&&jC(d);break;case 22:if(nt=C!==null&&C.memoizedState!==null,d.mode&1?(ns=(Fe=ns)||nt,Pl(g,d),ns=Fe):Pl(g,d),mu(d),A&8192){if(Fe=d.memoizedState!==null,(d.stateNode.isHidden=Fe)&&!nt&&(d.mode&1)!==0)for(Ot=d,nt=d.child;nt!==null;){for(st=Ot=nt;Ot!==null;){switch(rt=Ot,Nt=rt.child,rt.tag){case 0:case 11:case 14:case 15:Lm(4,rt,rt.return);break;case 1:op(rt,rt.return);var jt=rt.stateNode;if(typeof jt.componentWillUnmount=="function"){A=rt,C=rt.return;try{g=A,jt.props=g.memoizedProps,jt.state=g.memoizedState,jt.componentWillUnmount()}catch(zt){ui(A,C,zt)}}break;case 5:op(rt,rt.return);break;case 22:if(rt.memoizedState!==null){UC(st);continue}}Nt!==null?(Nt.return=rt,Ot=Nt):UC(st)}nt=nt.sibling}e:for(nt=null,st=d;;){if(st.tag===5){if(nt===null){nt=st;try{H=st.stateNode,Fe?(X=H.style,typeof X.setProperty=="function"?X.setProperty("display","none","important"):X.display="none"):(be=st.stateNode,_e=st.memoizedProps.style,oe=_e!=null&&_e.hasOwnProperty("display")?_e.display:null,be.style.display=ce("display",oe))}catch(zt){ui(d,d.return,zt)}}}else if(st.tag===6){if(nt===null)try{st.stateNode.nodeValue=Fe?"":st.memoizedProps}catch(zt){ui(d,d.return,zt)}}else if((st.tag!==22&&st.tag!==23||st.memoizedState===null||st===d)&&st.child!==null){st.child.return=st,st=st.child;continue}if(st===d)break e;for(;st.sibling===null;){if(st.return===null||st.return===d)break e;nt===st&&(nt=null),st=st.return}nt===st&&(nt=null),st.sibling.return=st.return,st=st.sibling}}break;case 19:Pl(g,d),mu(d),A&4&&jC(d);break;case 21:break;default:Pl(g,d),mu(d)}}function mu(d){var g=d.flags;if(g&2){try{e:{for(var C=d.return;C!==null;){if(OC(C)){var A=C;break e}C=C.return}throw Error(r(160))}switch(A.tag){case 5:var H=A.stateNode;A.flags&32&&(pt(H,""),A.flags&=-33);var X=DC(d);gb(d,X,H);break;case 3:case 4:var oe=A.stateNode.containerInfo,be=DC(d);mb(d,be,oe);break;default:throw Error(r(161))}}catch(_e){ui(d,d.return,_e)}d.flags&=-3}g&4096&&(d.flags&=-4097)}function kD(d,g,C){Ot=d,BC(d)}function BC(d,g,C){for(var A=(d.mode&1)!==0;Ot!==null;){var H=Ot,X=H.child;if(H.tag===22&&A){var oe=H.memoizedState!==null||M0;if(!oe){var be=H.alternate,_e=be!==null&&be.memoizedState!==null||ns;be=M0;var Fe=ns;if(M0=oe,(ns=_e)&&!Fe)for(Ot=H;Ot!==null;)oe=Ot,_e=oe.child,oe.tag===22&&oe.memoizedState!==null?GC(H):_e!==null?(_e.return=oe,Ot=_e):GC(H);for(;X!==null;)Ot=X,BC(X),X=X.sibling;Ot=H,M0=be,ns=Fe}zC(d)}else(H.subtreeFlags&8772)!==0&&X!==null?(X.return=H,Ot=X):zC(d)}}function zC(d){for(;Ot!==null;){var g=Ot;if((g.flags&8772)!==0){var C=g.alternate;try{if((g.flags&8772)!==0)switch(g.tag){case 0:case 11:case 15:ns||A0(5,g);break;case 1:var A=g.stateNode;if(g.flags&4&&!ns)if(C===null)A.componentDidMount();else{var H=g.elementType===g.type?C.memoizedProps:Gi(g.type,C.memoizedProps);A.componentDidUpdate(H,C.memoizedState,A.__reactInternalSnapshotBeforeUpdate)}var X=g.updateQueue;X!==null&&Hn(g,X,A);break;case 3:var oe=g.updateQueue;if(oe!==null){if(C=null,g.child!==null)switch(g.child.tag){case 5:C=g.child.stateNode;break;case 1:C=g.child.stateNode}Hn(g,oe,C)}break;case 5:var be=g.stateNode;if(C===null&&g.flags&4){C=be;var _e=g.memoizedProps;switch(g.type){case"button":case"input":case"select":case"textarea":_e.autoFocus&&C.focus();break;case"img":_e.src&&(C.src=_e.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(g.memoizedState===null){var Fe=g.alternate;if(Fe!==null){var nt=Fe.memoizedState;if(nt!==null){var st=nt.dehydrated;st!==null&&Fn(st)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(r(163))}ns||g.flags&512&&pb(g)}catch(rt){ui(g,g.return,rt)}}if(g===d){Ot=null;break}if(C=g.sibling,C!==null){C.return=g.return,Ot=C;break}Ot=g.return}}function UC(d){for(;Ot!==null;){var g=Ot;if(g===d){Ot=null;break}var C=g.sibling;if(C!==null){C.return=g.return,Ot=C;break}Ot=g.return}}function GC(d){for(;Ot!==null;){var g=Ot;try{switch(g.tag){case 0:case 11:case 15:var C=g.return;try{A0(4,g)}catch(_e){ui(g,C,_e)}break;case 1:var A=g.stateNode;if(typeof A.componentDidMount=="function"){var H=g.return;try{A.componentDidMount()}catch(_e){ui(g,H,_e)}}var X=g.return;try{pb(g)}catch(_e){ui(g,X,_e)}break;case 5:var oe=g.return;try{pb(g)}catch(_e){ui(g,oe,_e)}}}catch(_e){ui(g,g.return,_e)}if(g===d){Ot=null;break}var be=g.sibling;if(be!==null){be.return=g.return,Ot=be;break}Ot=g.return}}var _D=Math.ceil,R0=N.ReactCurrentDispatcher,vb=N.ReactCurrentOwner,Go=N.ReactCurrentBatchConfig,Ur=0,ca=null,Li=null,Ia=0,ho=0,lp=Sl(0),Vi=0,Om=null,jf=0,L0=0,yb=0,Dm=null,Vs=null,xb=0,up=1/0,ec=null,O0=!1,bb=null,ld=null,D0=!1,ud=null,I0=0,Im=0,wb=null,j0=-1,F0=0;function _s(){return(Ur&6)!==0?on():j0!==-1?j0:j0=on()}function cd(d){return(d.mode&1)===0?1:(Ur&2)!==0&&Ia!==0?Ia&-Ia:Sm.transition!==null?(F0===0&&(F0=Lr()),F0):(d=xr,d!==0||(d=window.event,d=d===void 0?16:Cr(d.type)),d)}function Ml(d,g,C,A){if(50<Im)throw Im=0,wb=null,Error(r(185));en(d,C,A),((Ur&2)===0||d!==ca)&&(d===ca&&((Ur&2)===0&&(L0|=C),Vi===4&&dd(d,Ia)),Hs(d,A),C===1&&Ur===0&&(g.mode&1)===0&&(up=on()+500,Vc&&su()))}function Hs(d,g){var C=d.callbackNode;Qt(d,g);var A=Ir(d,d===ca?Ia:0);if(A===0)C!==null&&qa(C),d.callbackNode=null,d.callbackPriority=0;else if(g=A&-A,d.callbackPriority!==g){if(C!=null&&qa(C),g===1)d.tag===0?kl(HC.bind(null,d)):Nf(HC.bind(null,d)),zi(function(){(Ur&6)===0&&su()}),C=null;else{switch(io(A)){case 1:C=fs;break;case 4:C=to;break;case 16:C=Xi;break;case 536870912:C=ze;break;default:C=Xi}C=QC(C,VC.bind(null,d))}d.callbackPriority=g,d.callbackNode=C}}function VC(d,g){if(j0=-1,F0=0,(Ur&6)!==0)throw Error(r(327));var C=d.callbackNode;if(cp()&&d.callbackNode!==C)return null;var A=Ir(d,d===ca?Ia:0);if(A===0)return null;if((A&30)!==0||(A&d.expiredLanes)!==0||g)g=B0(d,A);else{g=A;var H=Ur;Ur|=2;var X=qC();(ca!==d||Ia!==g)&&(ec=null,up=on()+500,Bf(d,g));do try{TD();break}catch(be){WC(d,be)}while(!0);$h(),R0.current=X,Ur=H,Li!==null?g=0:(ca=null,Ia=0,g=Vi)}if(g!==0){if(g===2&&(H=er(d),H!==0&&(A=H,g=Sb(d,H))),g===1)throw C=Om,Bf(d,0),dd(d,A),Hs(d,on()),C;if(g===6)dd(d,A);else{if(H=d.current.alternate,(A&30)===0&&!CD(H)&&(g=B0(d,A),g===2&&(X=er(d),X!==0&&(A=X,g=Sb(d,X))),g===1))throw C=Om,Bf(d,0),dd(d,A),Hs(d,on()),C;switch(d.finishedWork=H,d.finishedLanes=A,g){case 0:case 1:throw Error(r(345));case 2:zf(d,Vs,ec);break;case 3:if(dd(d,A),(A&130023424)===A&&(g=xb+500-on(),10<g)){if(Ir(d,0)!==0)break;if(H=d.suspendedLanes,(H&A)!==A){_s(),d.pingedLanes|=d.suspendedLanes&H;break}d.timeoutHandle=Zr(zf.bind(null,d,Vs,ec),g);break}zf(d,Vs,ec);break;case 4:if(dd(d,A),(A&4194240)===A)break;for(g=d.eventTimes,H=-1;0<A;){var oe=31-qe(A);X=1<<oe,oe=g[oe],oe>H&&(H=oe),A&=~X}if(A=H,A=on()-A,A=(120>A?120:480>A?480:1080>A?1080:1920>A?1920:3e3>A?3e3:4320>A?4320:1960*_D(A/1960))-A,10<A){d.timeoutHandle=Zr(zf.bind(null,d,Vs,ec),A);break}zf(d,Vs,ec);break;case 5:zf(d,Vs,ec);break;default:throw Error(r(329))}}}return Hs(d,on()),d.callbackNode===C?VC.bind(null,d):null}function Sb(d,g){var C=Dm;return d.current.memoizedState.isDehydrated&&(Bf(d,g).flags|=256),d=B0(d,g),d!==2&&(g=Vs,Vs=C,g!==null&&kb(g)),d}function kb(d){Vs===null?Vs=d:Vs.push.apply(Vs,d)}function CD(d){for(var g=d;;){if(g.flags&16384){var C=g.updateQueue;if(C!==null&&(C=C.stores,C!==null))for(var A=0;A<C.length;A++){var H=C[A],X=H.getSnapshot;H=H.value;try{if(!ra(X(),H))return!1}catch{return!1}}}if(C=g.child,g.subtreeFlags&16384&&C!==null)C.return=g,g=C;else{if(g===d)break;for(;g.sibling===null;){if(g.return===null||g.return===d)return!0;g=g.return}g.sibling.return=g.return,g=g.sibling}}return!0}function dd(d,g){for(g&=~yb,g&=~L0,d.suspendedLanes|=g,d.pingedLanes&=~g,d=d.expirationTimes;0<g;){var C=31-qe(g),A=1<<C;d[C]=-1,g&=~A}}function HC(d){if((Ur&6)!==0)throw Error(r(327));cp();var g=Ir(d,0);if((g&1)===0)return Hs(d,on()),null;var C=B0(d,g);if(d.tag!==0&&C===2){var A=er(d);A!==0&&(g=A,C=Sb(d,A))}if(C===1)throw C=Om,Bf(d,0),dd(d,g),Hs(d,on()),C;if(C===6)throw Error(r(345));return d.finishedWork=d.current.alternate,d.finishedLanes=g,zf(d,Vs,ec),Hs(d,on()),null}function _b(d,g){var C=Ur;Ur|=1;try{return d(g)}finally{Ur=C,Ur===0&&(up=on()+500,Vc&&su())}}function Ff(d){ud!==null&&ud.tag===0&&(Ur&6)===0&&cp();var g=Ur;Ur|=1;var C=Go.transition,A=xr;try{if(Go.transition=null,xr=1,d)return d()}finally{xr=A,Go.transition=C,Ur=g,(Ur&6)===0&&su()}}function Cb(){ho=lp.current,pn(lp)}function Bf(d,g){d.finishedWork=null,d.finishedLanes=0;var C=d.timeoutHandle;if(C!==-1&&(d.timeoutHandle=-1,Gn(C)),Li!==null)for(C=Li.return;C!==null;){var A=C;switch(Ri(A),A.tag){case 1:A=A.type.childContextTypes,A!=null&&Gc();break;case 3:Tn(),pn(ia),pn(Ui),sa();break;case 5:Cl(A);break;case 4:Tn();break;case 13:pn(mn);break;case 19:pn(mn);break;case 10:Kh(A.type._context);break;case 22:case 23:Cb()}C=C.return}if(ca=d,Li=d=fd(d.current,null),Ia=ho=g,Vi=0,Om=null,yb=L0=jf=0,Vs=Dm=null,jo!==null){for(g=0;g<jo.length;g++)if(C=jo[g],A=C.interleaved,A!==null){C.interleaved=null;var H=A.next,X=C.pending;if(X!==null){var oe=X.next;X.next=H,A.next=oe}C.pending=A}jo=null}return d}function WC(d,g){do{var C=Li;try{if($h(),Xc.current=rd,fo){for(var A=rn.memoizedState;A!==null;){var H=A.queue;H!==null&&(H.pending=null),A=A.next}fo=!1}if(La=0,oi=Wn=rn=null,du=!1,Gs=0,vb.current=null,C===null||C.return===null){Vi=1,Om=g,Li=null;break}e:{var X=d,oe=C.return,be=C,_e=g;if(g=Ia,be.flags|=32768,_e!==null&&typeof _e=="object"&&typeof _e.then=="function"){var Fe=_e,nt=be,st=nt.tag;if((nt.mode&1)===0&&(st===0||st===11||st===15)){var rt=nt.alternate;rt?(nt.updateQueue=rt.updateQueue,nt.memoizedState=rt.memoizedState,nt.lanes=rt.lanes):(nt.updateQueue=null,nt.memoizedState=null)}var Nt=M(oe);if(Nt!==null){Nt.flags&=-257,z(Nt,oe,be,X,g),Nt.mode&1&&b(X,Fe,g),g=Nt,_e=Fe;var jt=g.updateQueue;if(jt===null){var zt=new Set;zt.add(_e),g.updateQueue=zt}else jt.add(_e);break e}else{if((g&1)===0){b(X,Fe,g),Eb();break e}_e=Error(r(426))}}else if(Yr&&be.mode&1){var Ci=M(oe);if(Ci!==null){(Ci.flags&65536)===0&&(Ci.flags|=256),z(Ci,oe,be,X,g),Mf(Ju(_e,be));break e}}X=_e=Ju(_e,be),Vi!==4&&(Vi=2),Dm===null?Dm=[X]:Dm.push(X),X=oe;do{switch(X.tag){case 3:X.flags|=65536,g&=-g,X.lanes|=g;var Re=P0(X,_e,g);Of(X,Re);break e;case 1:be=_e;var Ee=X.type,Le=X.stateNode;if((X.flags&128)===0&&(typeof Ee.getDerivedStateFromError=="function"||Le!==null&&typeof Le.componentDidCatch=="function"&&(ld===null||!ld.has(Le)))){X.flags|=65536,g&=-g,X.lanes|=g;var ht=x(X,be,g);Of(X,ht);break e}}X=X.return}while(X!==null)}KC(C)}catch(Gt){g=Gt,Li===C&&C!==null&&(Li=C=C.return);continue}break}while(!0)}function qC(){var d=R0.current;return R0.current=rd,d===null?rd:d}function Eb(){(Vi===0||Vi===3||Vi===2)&&(Vi=4),ca===null||(jf&268435455)===0&&(L0&268435455)===0||dd(ca,Ia)}function B0(d,g){var C=Ur;Ur|=2;var A=qC();(ca!==d||Ia!==g)&&(ec=null,Bf(d,g));do try{ED();break}catch(H){WC(d,H)}while(!0);if($h(),Ur=C,R0.current=A,Li!==null)throw Error(r(261));return ca=null,Ia=0,Vi}function ED(){for(;Li!==null;)$C(Li)}function TD(){for(;Li!==null&&!Lu();)$C(Li)}function $C(d){var g=XC(d.alternate,d,ho);d.memoizedProps=d.pendingProps,g===null?KC(d):Li=g,vb.current=null}function KC(d){var g=d;do{var C=g.alternate;if(d=g.return,(g.flags&32768)===0){if(C=xD(C,g,ho),C!==null){Li=C;return}}else{if(C=bD(C,g),C!==null){C.flags&=32767,Li=C;return}if(d!==null)d.flags|=32768,d.subtreeFlags=0,d.deletions=null;else{Vi=6,Li=null;return}}if(g=g.sibling,g!==null){Li=g;return}Li=g=d}while(g!==null);Vi===0&&(Vi=5)}function zf(d,g,C){var A=xr,H=Go.transition;try{Go.transition=null,xr=1,ND(d,g,C,A)}finally{Go.transition=H,xr=A}return null}function ND(d,g,C,A){do cp();while(ud!==null);if((Ur&6)!==0)throw Error(r(327));C=d.finishedWork;var H=d.finishedLanes;if(C===null)return null;if(d.finishedWork=null,d.finishedLanes=0,C===d.current)throw Error(r(177));d.callbackNode=null,d.callbackPriority=0;var X=C.lanes|C.childLanes;if(yn(d,X),d===ca&&(Li=ca=null,Ia=0),(C.subtreeFlags&2064)===0&&(C.flags&2064)===0||D0||(D0=!0,QC(Xi,function(){return cp(),null})),X=(C.flags&15990)!==0,(C.subtreeFlags&15990)!==0||X){X=Go.transition,Go.transition=null;var oe=xr;xr=1;var be=Ur;Ur|=4,vb.current=null,SD(d,C),FC(C,d),na(Yt),Du=!!kt,Yt=kt=null,d.current=C,kD(C),ko(),Ur=be,xr=oe,Go.transition=X}else d.current=C;if(D0&&(D0=!1,ud=d,I0=H),X=d.pendingLanes,X===0&&(ld=null),ot(C.stateNode),Hs(d,on()),g!==null)for(A=d.onRecoverableError,C=0;C<g.length;C++)H=g[C],A(H.value,{componentStack:H.stack,digest:H.digest});if(O0)throw O0=!1,d=bb,bb=null,d;return(I0&1)!==0&&d.tag!==0&&cp(),X=d.pendingLanes,(X&1)!==0?d===wb?Im++:(Im=0,wb=d):Im=0,su(),null}function cp(){if(ud!==null){var d=io(I0),g=Go.transition,C=xr;try{if(Go.transition=null,xr=16>d?16:d,ud===null)var A=!1;else{if(d=ud,ud=null,I0=0,(Ur&6)!==0)throw Error(r(331));var H=Ur;for(Ur|=4,Ot=d.current;Ot!==null;){var X=Ot,oe=X.child;if((Ot.flags&16)!==0){var be=X.deletions;if(be!==null){for(var _e=0;_e<be.length;_e++){var Fe=be[_e];for(Ot=Fe;Ot!==null;){var nt=Ot;switch(nt.tag){case 0:case 11:case 15:Lm(8,nt,X)}var st=nt.child;if(st!==null)st.return=nt,Ot=st;else for(;Ot!==null;){nt=Ot;var rt=nt.sibling,Nt=nt.return;if(LC(nt),nt===Fe){Ot=null;break}if(rt!==null){rt.return=Nt,Ot=rt;break}Ot=Nt}}}var jt=X.alternate;if(jt!==null){var zt=jt.child;if(zt!==null){jt.child=null;do{var Ci=zt.sibling;zt.sibling=null,zt=Ci}while(zt!==null)}}Ot=X}}if((X.subtreeFlags&2064)!==0&&oe!==null)oe.return=X,Ot=oe;else e:for(;Ot!==null;){if(X=Ot,(X.flags&2048)!==0)switch(X.tag){case 0:case 11:case 15:Lm(9,X,X.return)}var Re=X.sibling;if(Re!==null){Re.return=X.return,Ot=Re;break e}Ot=X.return}}var Ee=d.current;for(Ot=Ee;Ot!==null;){oe=Ot;var Le=oe.child;if((oe.subtreeFlags&2064)!==0&&Le!==null)Le.return=oe,Ot=Le;else e:for(oe=Ee;Ot!==null;){if(be=Ot,(be.flags&2048)!==0)try{switch(be.tag){case 0:case 11:case 15:A0(9,be)}}catch(Gt){ui(be,be.return,Gt)}if(be===oe){Ot=null;break e}var ht=be.sibling;if(ht!==null){ht.return=be.return,Ot=ht;break e}Ot=be.return}}if(Ur=H,su(),tt&&typeof tt.onPostCommitFiberRoot=="function")try{tt.onPostCommitFiberRoot(Ke,d)}catch{}A=!0}return A}finally{xr=C,Go.transition=g}}return!1}function ZC(d,g,C){g=Ju(C,g),g=P0(d,g,1),d=zo(d,g,1),g=_s(),d!==null&&(en(d,1,g),Hs(d,g))}function ui(d,g,C){if(d.tag===3)ZC(d,d,C);else for(;g!==null;){if(g.tag===3){ZC(g,d,C);break}else if(g.tag===1){var A=g.stateNode;if(typeof g.type.getDerivedStateFromError=="function"||typeof A.componentDidCatch=="function"&&(ld===null||!ld.has(A))){d=Ju(C,d),d=x(g,d,1),g=zo(g,d,1),d=_s(),g!==null&&(en(g,1,d),Hs(g,d));break}}g=g.return}}function PD(d,g,C){var A=d.pingCache;A!==null&&A.delete(g),g=_s(),d.pingedLanes|=d.suspendedLanes&C,ca===d&&(Ia&C)===C&&(Vi===4||Vi===3&&(Ia&130023424)===Ia&&500>on()-xb?Bf(d,0):yb|=C),Hs(d,g)}function YC(d,g){g===0&&((d.mode&1)===0?g=1:(g=vi,vi<<=1,(vi&130023424)===0&&(vi=4194304)));var C=_s();d=Ss(d,g),d!==null&&(en(d,g,C),Hs(d,C))}function MD(d){var g=d.memoizedState,C=0;g!==null&&(C=g.retryLane),YC(d,C)}function AD(d,g){var C=0;switch(d.tag){case 13:var A=d.stateNode,H=d.memoizedState;H!==null&&(C=H.retryLane);break;case 19:A=d.stateNode;break;default:throw Error(r(314))}A!==null&&A.delete(g),YC(d,C)}var XC;XC=function(d,g,C){if(d!==null)if(d.memoizedProps!==g.pendingProps||ia.current)te=!0;else{if((d.lanes&C)===0&&(g.flags&128)===0)return te=!1,db(d,g,C);te=(d.flags&131072)!==0}else te=!1,Yr&&(g.flags&1048576)!==0&&y0(g,lu,g.index);switch(g.lanes=0,g.tag){case 2:var A=g.type;Or(d,g),d=g.pendingProps;var H=Hu(g,Ui.current);_l(g,C),H=Qc(null,g,A,d,H,C);var X=Jc();return g.flags|=1,typeof H=="object"&&H!==null&&typeof H.render=="function"&&H.$$typeof===void 0?(g.tag=1,g.memoizedState=null,g.updateQueue=null,aa(A)?(X=!0,Wu(g)):X=!1,g.memoizedState=H.state!==null&&H.state!==void 0?H.state:null,Lf(g),H.updater=ad,g.stateNode=H,H._reactInternals=g,ap(g,A,d,C),g=Xr(null,g,A,!0,X,C)):(g.tag=0,Yr&&X&&Hc(g),pe(null,g,H,C),g=g.child),g;case 16:A=g.elementType;e:{switch(Or(d,g),d=g.pendingProps,H=A._init,A=H(A._payload),g.type=A,H=g.tag=LD(A),d=Gi(A,d),H){case 0:g=Ct(null,g,A,d,C);break e;case 1:g=gn(null,g,A,d,C);break e;case 11:g=Ne(null,g,A,d,C);break e;case 14:g=Be(null,g,A,Gi(A.type,d),C);break e}throw Error(r(306,A,""))}return g;case 0:return A=g.type,H=g.pendingProps,H=g.elementType===A?H:Gi(A,H),Ct(d,g,A,H,C);case 1:return A=g.type,H=g.pendingProps,H=g.elementType===A?H:Gi(A,H),gn(d,g,A,H,C);case 3:e:{if(Oa(g),d===null)throw Error(r(387));A=g.pendingProps,X=g.memoizedState,H=X.element,Yh(d,g),Kc(g,A,null,C);var oe=g.memoizedState;if(A=oe.element,X.isDehydrated)if(X={element:A,isDehydrated:!1,cache:oe.cache,pendingSuspenseBoundaries:oe.pendingSuspenseBoundaries,transitions:oe.transitions},g.updateQueue.baseState=X,g.memoizedState=X,g.flags&256){H=Ju(Error(r(423)),g),g=Uo(d,g,A,C,H);break e}else if(A!==H){H=Ju(Error(r(424)),g),g=Uo(d,g,A,C,H);break e}else for(xt=zs(g.stateNode.containerInfo.firstChild),xs=g,Yr=!0,bs=null,C=Us(g,null,A,C),g.child=C;C;)C.flags=C.flags&-3|4096,C=C.sibling;else{if(Zu(),A===H){g=ua(d,g,C);break e}pe(d,g,A,C)}g=g.child}return g;case 5:return Zc(g),d===null&&Wc(g),A=g.type,H=g.pendingProps,X=d!==null?d.memoizedProps:null,oe=H.children,fr(A,H)?oe=null:X!==null&&fr(A,X)&&(g.flags|=32),ur(d,g),pe(d,g,oe,C),g.child;case 6:return d===null&&Wc(g),null;case 13:return He(d,g,C);case 4:return cu(g,g.stateNode.containerInfo),A=g.pendingProps,d===null?g.child=Yu(g,null,A,C):pe(d,g,A,C),g.child;case 11:return A=g.type,H=g.pendingProps,H=g.elementType===A?H:Gi(A,H),Ne(d,g,A,H,C);case 7:return pe(d,g,g.pendingProps,C),g.child;case 8:return pe(d,g,g.pendingProps.children,C),g.child;case 12:return pe(d,g,g.pendingProps.children,C),g.child;case 10:e:{if(A=g.type._context,H=g.pendingProps,X=g.memoizedProps,oe=H.value,un(Af,A._currentValue),A._currentValue=oe,X!==null)if(ra(X.value,oe)){if(X.children===H.children&&!ia.current){g=ua(d,g,C);break e}}else for(X=g.child,X!==null&&(X.return=g);X!==null;){var be=X.dependencies;if(be!==null){oe=X.child;for(var _e=be.firstContext;_e!==null;){if(_e.context===A){if(X.tag===1){_e=Bo(-1,C&-C),_e.tag=2;var Fe=X.updateQueue;if(Fe!==null){Fe=Fe.shared;var nt=Fe.pending;nt===null?_e.next=_e:(_e.next=nt.next,nt.next=_e),Fe.pending=_e}}X.lanes|=C,_e=X.alternate,_e!==null&&(_e.lanes|=C),Zh(X.return,C,g),be.lanes|=C;break}_e=_e.next}}else if(X.tag===10)oe=X.type===g.type?null:X.child;else if(X.tag===18){if(oe=X.return,oe===null)throw Error(r(341));oe.lanes|=C,be=oe.alternate,be!==null&&(be.lanes|=C),Zh(oe,C,g),oe=X.sibling}else oe=X.child;if(oe!==null)oe.return=X;else for(oe=X;oe!==null;){if(oe===g){oe=null;break}if(X=oe.sibling,X!==null){X.return=oe.return,oe=X;break}oe=oe.return}X=oe}pe(d,g,H.children,C),g=g.child}return g;case 9:return H=g.type,A=g.pendingProps.children,_l(g,C),H=Ra(H),A=A(H),g.flags|=1,pe(d,g,A,C),g.child;case 14:return A=g.type,H=Gi(A,g.pendingProps),H=Gi(A.type,H),Be(d,g,A,H,C);case 15:return ct(d,g,g.type,g.pendingProps,C);case 17:return A=g.type,H=g.pendingProps,H=g.elementType===A?H:Gi(A,H),Or(d,g),g.tag=1,aa(A)?(d=!0,Wu(g)):d=!1,_l(g,C),N0(g,A,H),ap(g,A,H,C),Xr(null,g,A,!0,d,C);case 19:return _i(d,g,C);case 22:return Lt(d,g,C)}throw Error(r(156,g.tag))};function QC(d,g){return So(d,g)}function RD(d,g,C,A){this.tag=d,this.key=C,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=g,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=A,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Vo(d,g,C,A){return new RD(d,g,C,A)}function Tb(d){return d=d.prototype,!(!d||!d.isReactComponent)}function LD(d){if(typeof d=="function")return Tb(d)?1:0;if(d!=null){if(d=d.$$typeof,d===K)return 11;if(d===U)return 14}return 2}function fd(d,g){var C=d.alternate;return C===null?(C=Vo(d.tag,g,d.key,d.mode),C.elementType=d.elementType,C.type=d.type,C.stateNode=d.stateNode,C.alternate=d,d.alternate=C):(C.pendingProps=g,C.type=d.type,C.flags=0,C.subtreeFlags=0,C.deletions=null),C.flags=d.flags&14680064,C.childLanes=d.childLanes,C.lanes=d.lanes,C.child=d.child,C.memoizedProps=d.memoizedProps,C.memoizedState=d.memoizedState,C.updateQueue=d.updateQueue,g=d.dependencies,C.dependencies=g===null?null:{lanes:g.lanes,firstContext:g.firstContext},C.sibling=d.sibling,C.index=d.index,C.ref=d.ref,C}function z0(d,g,C,A,H,X){var oe=2;if(A=d,typeof d=="function")Tb(d)&&(oe=1);else if(typeof d=="string")oe=5;else e:switch(d){case F:return Uf(C.children,H,X,g);case D:oe=8,H|=8;break;case j:return d=Vo(12,C,g,H|2),d.elementType=j,d.lanes=X,d;case O:return d=Vo(13,C,g,H),d.elementType=O,d.lanes=X,d;case W:return d=Vo(19,C,g,H),d.elementType=W,d.lanes=X,d;case Z:return U0(C,H,X,g);default:if(typeof d=="object"&&d!==null)switch(d.$$typeof){case B:oe=10;break e;case G:oe=9;break e;case K:oe=11;break e;case U:oe=14;break e;case q:oe=16,A=null;break e}throw Error(r(130,d==null?d:typeof d,""))}return g=Vo(oe,C,g,H),g.elementType=d,g.type=A,g.lanes=X,g}function Uf(d,g,C,A){return d=Vo(7,d,A,g),d.lanes=C,d}function U0(d,g,C,A){return d=Vo(22,d,A,g),d.elementType=Z,d.lanes=C,d.stateNode={isHidden:!1},d}function Nb(d,g,C){return d=Vo(6,d,null,g),d.lanes=C,d}function Pb(d,g,C){return g=Vo(4,d.children!==null?d.children:[],d.key,g),g.lanes=C,g.stateNode={containerInfo:d.containerInfo,pendingChildren:null,implementation:d.implementation},g}function OD(d,g,C,A,H){this.tag=g,this.containerInfo=d,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Jt(0),this.expirationTimes=Jt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Jt(0),this.identifierPrefix=A,this.onRecoverableError=H,this.mutableSourceEagerHydrationData=null}function Mb(d,g,C,A,H,X,oe,be,_e){return d=new OD(d,g,C,be,_e),g===1?(g=1,X===!0&&(g|=8)):g=0,X=Vo(3,null,null,g),d.current=X,X.stateNode=d,X.memoizedState={element:A,isDehydrated:C,cache:null,transitions:null,pendingSuspenseBoundaries:null},Lf(X),d}function DD(d,g,C){var A=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:I,key:A==null?null:""+A,children:d,containerInfo:g,implementation:C}}function JC(d){if(!d)return Do;d=d._reactInternals;e:{if(ni(d)!==d||d.tag!==1)throw Error(r(170));var g=d;do{switch(g.tag){case 3:g=g.stateNode.context;break e;case 1:if(aa(g.type)){g=g.stateNode.__reactInternalMemoizedMergedChildContext;break e}}g=g.return}while(g!==null);throw Error(r(171))}if(d.tag===1){var C=d.type;if(aa(C))return Gh(d,C,g)}return g}function eE(d,g,C,A,H,X,oe,be,_e){return d=Mb(C,A,!0,d,H,X,oe,be,_e),d.context=JC(null),C=d.current,A=_s(),H=cd(C),X=Bo(A,H),X.callback=g??null,zo(C,X,H),d.current.lanes=H,en(d,H,A),Hs(d,A),d}function G0(d,g,C,A){var H=g.current,X=_s(),oe=cd(H);return C=JC(C),g.context===null?g.context=C:g.pendingContext=C,g=Bo(X,oe),g.payload={element:d},A=A===void 0?null:A,A!==null&&(g.callback=A),d=zo(H,g,oe),d!==null&&(Ml(d,H,oe,X),Xh(d,H,oe)),oe}function V0(d){return d=d.current,d.child?(d.child.tag===5,d.child.stateNode):null}function tE(d,g){if(d=d.memoizedState,d!==null&&d.dehydrated!==null){var C=d.retryLane;d.retryLane=C!==0&&C<g?C:g}}function Ab(d,g){tE(d,g),(d=d.alternate)&&tE(d,g)}function ID(){return null}var rE=typeof reportError=="function"?reportError:function(d){console.error(d)};function Rb(d){this._internalRoot=d}H0.prototype.render=Rb.prototype.render=function(d){var g=this._internalRoot;if(g===null)throw Error(r(409));G0(d,g,null,null)},H0.prototype.unmount=Rb.prototype.unmount=function(){var d=this._internalRoot;if(d!==null){this._internalRoot=null;var g=d.containerInfo;Ff(function(){G0(null,d,null,null)}),g[zr]=null}};function H0(d){this._internalRoot=d}H0.prototype.unstable_scheduleHydration=function(d){if(d){var g=Ec();d={blockedOn:null,target:d,priority:g};for(var C=0;C<Qn.length&&g!==0&&g<Qn[C].priority;C++);Qn.splice(C,0,d),C===0&&Vl(d)}};function Lb(d){return!(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11)}function W0(d){return!(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11&&(d.nodeType!==8||d.nodeValue!==" react-mount-point-unstable "))}function nE(){}function jD(d,g,C,A,H){if(H){if(typeof A=="function"){var X=A;A=function(){var Fe=V0(oe);X.call(Fe)}}var oe=eE(g,A,d,0,null,!1,!1,"",nE);return d._reactRootContainer=oe,d[zr]=oe.current,Lo(d.nodeType===8?d.parentNode:d),Ff(),oe}for(;H=d.lastChild;)d.removeChild(H);if(typeof A=="function"){var be=A;A=function(){var Fe=V0(_e);be.call(Fe)}}var _e=Mb(d,0,!1,null,null,!1,!1,"",nE);return d._reactRootContainer=_e,d[zr]=_e.current,Lo(d.nodeType===8?d.parentNode:d),Ff(function(){G0(g,_e,C,A)}),_e}function q0(d,g,C,A,H){var X=C._reactRootContainer;if(X){var oe=X;if(typeof H=="function"){var be=H;H=function(){var _e=V0(oe);be.call(_e)}}G0(g,oe,d,H)}else oe=jD(C,g,d,H,A);return V0(oe)}Co=function(d){switch(d.tag){case 3:var g=d.stateNode;if(g.current.memoizedState.isDehydrated){var C=It(g.pendingLanes);C!==0&&(no(g,C|1),Hs(g,on()),(Ur&6)===0&&(up=on()+500,su()))}break;case 13:Ff(function(){var A=Ss(d,1);if(A!==null){var H=_s();Ml(A,d,1,H)}}),Ab(d,1)}},Ls=function(d){if(d.tag===13){var g=Ss(d,134217728);if(g!==null){var C=_s();Ml(g,d,134217728,C)}Ab(d,134217728)}},Cc=function(d){if(d.tag===13){var g=cd(d),C=Ss(d,g);if(C!==null){var A=_s();Ml(C,d,g,A)}Ab(d,g)}},Ec=function(){return xr},sl=function(d,g){var C=xr;try{return xr=d,g()}finally{xr=C}},yt=function(d,g,C){switch(g){case"input":if(lt(d,C),g=C.name,C.type==="radio"&&g!=null){for(C=d;C.parentNode;)C=C.parentNode;for(C=C.querySelectorAll("input[name="+JSON.stringify(""+g)+'][type="radio"]'),g=0;g<C.length;g++){var A=C[g];if(A!==d&&A.form===d.form){var H=si(A);if(!H)throw Error(r(90));ye(A),lt(A,H)}}}break;case"textarea":Qe(d,C);break;case"select":g=C.value,g!=null&&Ce(d,!!C.multiple,g,!1)}},Wt=_b,ar=Ff;var FD={usingClientEntryPoint:!1,Events:[wl,Vn,si,Ht,Et,_b]},jm={findFiberByHostInstance:Oo,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},BD={bundleType:jm.bundleType,version:jm.version,rendererPackageName:jm.rendererPackageName,rendererConfig:jm.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:N.ReactCurrentDispatcher,findHostInstanceByFiber:function(d){return d=Rs(d),d===null?null:d.stateNode},findFiberByHostInstance:jm.findFiberByHostInstance||ID,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var $0=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!$0.isDisabled&&$0.supportsFiber)try{Ke=$0.inject(BD),tt=$0}catch{}}return Ws.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=FD,Ws.createPortal=function(d,g){var C=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Lb(g))throw Error(r(200));return DD(d,g,null,C)},Ws.createRoot=function(d,g){if(!Lb(d))throw Error(r(299));var C=!1,A="",H=rE;return g!=null&&(g.unstable_strictMode===!0&&(C=!0),g.identifierPrefix!==void 0&&(A=g.identifierPrefix),g.onRecoverableError!==void 0&&(H=g.onRecoverableError)),g=Mb(d,1,!1,null,null,C,!1,A,H),d[zr]=g.current,Lo(d.nodeType===8?d.parentNode:d),new Rb(g)},Ws.findDOMNode=function(d){if(d==null)return null;if(d.nodeType===1)return d;var g=d._reactInternals;if(g===void 0)throw typeof d.render=="function"?Error(r(188)):(d=Object.keys(d).join(","),Error(r(268,d)));return d=Rs(g),d=d===null?null:d.stateNode,d},Ws.flushSync=function(d){return Ff(d)},Ws.hydrate=function(d,g,C){if(!W0(g))throw Error(r(200));return q0(null,d,g,!0,C)},Ws.hydrateRoot=function(d,g,C){if(!Lb(d))throw Error(r(405));var A=C!=null&&C.hydratedSources||null,H=!1,X="",oe=rE;if(C!=null&&(C.unstable_strictMode===!0&&(H=!0),C.identifierPrefix!==void 0&&(X=C.identifierPrefix),C.onRecoverableError!==void 0&&(oe=C.onRecoverableError)),g=eE(g,null,d,1,C??null,H,!1,X,oe),d[zr]=g.current,Lo(d),A)for(d=0;d<A.length;d++)C=A[d],H=C._getVersion,H=H(C._source),g.mutableSourceEagerHydrationData==null?g.mutableSourceEagerHydrationData=[C,H]:g.mutableSourceEagerHydrationData.push(C,H);return new H0(g)},Ws.render=function(d,g,C){if(!W0(g))throw Error(r(200));return q0(null,d,g,!1,C)},Ws.unmountComponentAtNode=function(d){if(!W0(d))throw Error(r(40));return d._reactRootContainer?(Ff(function(){q0(null,null,d,!1,function(){d._reactRootContainer=null,d[zr]=null})}),!0):!1},Ws.unstable_batchedUpdates=_b,Ws.unstable_renderSubtreeIntoContainer=function(d,g,C,A){if(!W0(C))throw Error(r(200));if(d==null||d._reactInternals===void 0)throw Error(r(38));return q0(d,g,C,!1,A)},Ws.version="18.3.1-next-f1338f8080-20240426",Ws}var fE;function aM(){if(fE)return Ib.exports;fE=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),Ib.exports=KD(),Ib.exports}var hE;function ZD(){if(hE)return K0;hE=1;var t=aM();return K0.createRoot=t.createRoot,K0.hydrateRoot=t.hydrateRoot,K0}var YD=ZD();const XD=Th(YD);var xo=aM();const QD=Th(xo);function vv(){return vv=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},vv.apply(this,arguments)}var Rd;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(Rd||(Rd={}));const pE="popstate";function JD(t){t===void 0&&(t={});function e(n,i){let{pathname:a,search:s,hash:o}=n.location;return NS("",{pathname:a,search:s,hash:o},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function r(n,i){return typeof i=="string"?i:ex(i)}return t8(e,r,null,t)}function fi(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function Wk(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function e8(){return Math.random().toString(36).substr(2,8)}function mE(t,e){return{usr:t.state,key:t.key,idx:e}}function NS(t,e,r,n){return r===void 0&&(r=null),vv({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof e=="string"?om(e):e,{state:r,key:e&&e.key||n||e8()})}function ex(t){let{pathname:e="/",search:r="",hash:n=""}=t;return r&&r!=="?"&&(e+=r.charAt(0)==="?"?r:"?"+r),n&&n!=="#"&&(e+=n.charAt(0)==="#"?n:"#"+n),e}function om(t){let e={};if(t){let r=t.indexOf("#");r>=0&&(e.hash=t.substr(r),t=t.substr(0,r));let n=t.indexOf("?");n>=0&&(e.search=t.substr(n),t=t.substr(0,n)),t&&(e.pathname=t)}return e}function t8(t,e,r,n){n===void 0&&(n={});let{window:i=document.defaultView,v5Compat:a=!1}=n,s=i.history,o=Rd.Pop,l=null,u=c();u==null&&(u=0,s.replaceState(vv({},s.state,{idx:u}),""));function c(){return(s.state||{idx:null}).idx}function f(){o=Rd.Pop;let w=c(),E=w==null?null:w-u;u=w,l&&l({action:o,location:S.location,delta:E})}function p(w,E){o=Rd.Push;let _=NS(S.location,w,E);u=c()+1;let T=mE(_,u),N=S.createHref(_);try{s.pushState(T,"",N)}catch(R){if(R instanceof DOMException&&R.name==="DataCloneError")throw R;i.location.assign(N)}a&&l&&l({action:o,location:S.location,delta:1})}function v(w,E){o=Rd.Replace;let _=NS(S.location,w,E);u=c();let T=mE(_,u),N=S.createHref(_);s.replaceState(T,"",N),a&&l&&l({action:o,location:S.location,delta:0})}function y(w){let E=i.location.origin!=="null"?i.location.origin:i.location.href,_=typeof w=="string"?w:ex(w);return _=_.replace(/ $/,"%20"),fi(E,"No window.location.(origin|href) available to create URL for href: "+_),new URL(_,E)}let S={get action(){return o},get location(){return t(i,s)},listen(w){if(l)throw new Error("A history only accepts one active listener");return i.addEventListener(pE,f),l=w,()=>{i.removeEventListener(pE,f),l=null}},createHref(w){return e(i,w)},createURL:y,encodeLocation(w){let E=y(w);return{pathname:E.pathname,search:E.search,hash:E.hash}},push:p,replace:v,go(w){return s.go(w)}};return S}var gE;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(gE||(gE={}));function r8(t,e,r){return r===void 0&&(r="/"),n8(t,e,r)}function n8(t,e,r,n){let i=typeof e=="string"?om(e):e,a=Hp(i.pathname||"/",r);if(a==null)return null;let s=sM(t);i8(s);let o=null;for(let l=0;o==null&&l<s.length;++l){let u=m8(a);o=h8(s[l],u)}return o}function sM(t,e,r,n){e===void 0&&(e=[]),r===void 0&&(r=[]),n===void 0&&(n="");let i=(a,s,o)=>{let l={relativePath:o===void 0?a.path||"":o,caseSensitive:a.caseSensitive===!0,childrenIndex:s,route:a};l.relativePath.startsWith("/")&&(fi(l.relativePath.startsWith(n),'Absolute route path "'+l.relativePath+'" nested under path '+('"'+n+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),l.relativePath=l.relativePath.slice(n.length));let u=zd([n,l.relativePath]),c=r.concat(l);a.children&&a.children.length>0&&(fi(a.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+u+'".')),sM(a.children,e,c,u)),!(a.path==null&&!a.index)&&e.push({path:u,score:d8(u,a.index),routesMeta:c})};return t.forEach((a,s)=>{var o;if(a.path===""||!((o=a.path)!=null&&o.includes("?")))i(a,s);else for(let l of oM(a.path))i(a,s,l)}),e}function oM(t){let e=t.split("/");if(e.length===0)return[];let[r,...n]=e,i=r.endsWith("?"),a=r.replace(/\?$/,"");if(n.length===0)return i?[a,""]:[a];let s=oM(n.join("/")),o=[];return o.push(...s.map(l=>l===""?a:[a,l].join("/"))),i&&o.push(...s),o.map(l=>t.startsWith("/")&&l===""?"/":l)}function i8(t){t.sort((e,r)=>e.score!==r.score?r.score-e.score:f8(e.routesMeta.map(n=>n.childrenIndex),r.routesMeta.map(n=>n.childrenIndex)))}const a8=/^:[\w-]+$/,s8=3,o8=2,l8=1,u8=10,c8=-2,vE=t=>t==="*";function d8(t,e){let r=t.split("/"),n=r.length;return r.some(vE)&&(n+=c8),e&&(n+=o8),r.filter(i=>!vE(i)).reduce((i,a)=>i+(a8.test(a)?s8:a===""?l8:u8),n)}function f8(t,e){return t.length===e.length&&t.slice(0,-1).every((n,i)=>n===e[i])?t[t.length-1]-e[e.length-1]:0}function h8(t,e,r){let{routesMeta:n}=t,i={},a="/",s=[];for(let o=0;o<n.length;++o){let l=n[o],u=o===n.length-1,c=a==="/"?e:e.slice(a.length)||"/",f=PS({path:l.relativePath,caseSensitive:l.caseSensitive,end:u},c),p=l.route;if(!f)return null;Object.assign(i,f.params),s.push({params:i,pathname:zd([a,f.pathname]),pathnameBase:b8(zd([a,f.pathnameBase])),route:p}),f.pathnameBase!=="/"&&(a=zd([a,f.pathnameBase]))}return s}function PS(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[r,n]=p8(t.path,t.caseSensitive,t.end),i=e.match(r);if(!i)return null;let a=i[0],s=a.replace(/(.)\/+$/,"$1"),o=i.slice(1);return{params:n.reduce((u,c,f)=>{let{paramName:p,isOptional:v}=c;if(p==="*"){let S=o[f]||"";s=a.slice(0,a.length-S.length).replace(/(.)\/+$/,"$1")}const y=o[f];return v&&!y?u[p]=void 0:u[p]=(y||"").replace(/%2F/g,"/"),u},{}),pathname:a,pathnameBase:s,pattern:t}}function p8(t,e,r){e===void 0&&(e=!1),r===void 0&&(r=!0),Wk(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let n=[],i="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(s,o,l)=>(n.push({paramName:o,isOptional:l!=null}),l?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(n.push({paramName:"*"}),i+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):r?i+="\\/*$":t!==""&&t!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,e?void 0:"i"),n]}function m8(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Wk(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),t}}function Hp(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let r=e.endsWith("/")?e.length-1:e.length,n=t.charAt(r);return n&&n!=="/"?null:t.slice(r)||"/"}const g8=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,v8=t=>g8.test(t);function y8(t,e){e===void 0&&(e="/");let{pathname:r,search:n="",hash:i=""}=typeof t=="string"?om(t):t,a;if(r)if(v8(r))a=r;else{if(r.includes("//")){let s=r;r=r.replace(/\/\/+/g,"/"),Wk(!1,"Pathnames cannot have embedded double slashes - normalizing "+(s+" -> "+r))}r.startsWith("/")?a=yE(r.substring(1),"/"):a=yE(r,e)}else a=e;return{pathname:a,search:w8(n),hash:S8(i)}}function yE(t,e){let r=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(i=>{i===".."?r.length>1&&r.pop():i!=="."&&r.push(i)}),r.length>1?r.join("/"):"/"}function Bb(t,e,r,n){return"Cannot include a '"+t+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(n)+"].  Please separate it out to the ")+("`to."+r+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function x8(t){return t.filter((e,r)=>r===0||e.route.path&&e.route.path.length>0)}function lM(t,e){let r=x8(t);return e?r.map((n,i)=>i===r.length-1?n.pathname:n.pathnameBase):r.map(n=>n.pathnameBase)}function uM(t,e,r,n){n===void 0&&(n=!1);let i;typeof t=="string"?i=om(t):(i=vv({},t),fi(!i.pathname||!i.pathname.includes("?"),Bb("?","pathname","search",i)),fi(!i.pathname||!i.pathname.includes("#"),Bb("#","pathname","hash",i)),fi(!i.search||!i.search.includes("#"),Bb("#","search","hash",i)));let a=t===""||i.pathname==="",s=a?"/":i.pathname,o;if(s==null)o=r;else{let f=e.length-1;if(!n&&s.startsWith("..")){let p=s.split("/");for(;p[0]==="..";)p.shift(),f-=1;i.pathname=p.join("/")}o=f>=0?e[f]:"/"}let l=y8(i,o),u=s&&s!=="/"&&s.endsWith("/"),c=(a||s===".")&&r.endsWith("/");return!l.pathname.endsWith("/")&&(u||c)&&(l.pathname+="/"),l}const zd=t=>t.join("/").replace(/\/\/+/g,"/"),b8=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),w8=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,S8=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function k8(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}const cM=["post","put","patch","delete"];new Set(cM);const _8=["get",...cM];new Set(_8);function yv(){return yv=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},yv.apply(this,arguments)}const v1=ae.createContext(null),dM=ae.createContext(null),af=ae.createContext(null),y1=ae.createContext(null),bc=ae.createContext({outlet:null,matches:[],isDataRoute:!1}),fM=ae.createContext(null);function C8(t,e){let{relative:r}=e===void 0?{}:e;qv()||fi(!1);let{basename:n,navigator:i}=ae.useContext(af),{hash:a,pathname:s,search:o}=x1(t,{relative:r}),l=s;return n!=="/"&&(l=s==="/"?n:zd([n,s])),i.createHref({pathname:l,search:o,hash:a})}function qv(){return ae.useContext(y1)!=null}function Nh(){return qv()||fi(!1),ae.useContext(y1).location}function hM(t){ae.useContext(af).static||ae.useLayoutEffect(t)}function Va(){let{isDataRoute:t}=ae.useContext(bc);return t?B8():E8()}function E8(){qv()||fi(!1);let t=ae.useContext(v1),{basename:e,future:r,navigator:n}=ae.useContext(af),{matches:i}=ae.useContext(bc),{pathname:a}=Nh(),s=JSON.stringify(lM(i,r.v7_relativeSplatPath)),o=ae.useRef(!1);return hM(()=>{o.current=!0}),ae.useCallback(function(u,c){if(c===void 0&&(c={}),!o.current)return;if(typeof u=="number"){n.go(u);return}let f=uM(u,JSON.parse(s),a,c.relative==="path");t==null&&e!=="/"&&(f.pathname=f.pathname==="/"?e:zd([e,f.pathname])),(c.replace?n.replace:n.push)(f,c.state,c)},[e,n,s,a,t])}const pM=ae.createContext(null);function nl(){return ae.useContext(pM)}function T8(t){let e=ae.useContext(bc).outlet;return e&&ae.createElement(pM.Provider,{value:t},e)}function qi(){let{matches:t}=ae.useContext(bc),e=t[t.length-1];return e?e.params:{}}function x1(t,e){let{relative:r}=e===void 0?{}:e,{future:n}=ae.useContext(af),{matches:i}=ae.useContext(bc),{pathname:a}=Nh(),s=JSON.stringify(lM(i,n.v7_relativeSplatPath));return ae.useMemo(()=>uM(t,JSON.parse(s),a,r==="path"),[t,s,a,r])}function N8(t,e){return P8(t,e)}function P8(t,e,r,n){qv()||fi(!1);let{navigator:i}=ae.useContext(af),{matches:a}=ae.useContext(bc),s=a[a.length-1],o=s?s.params:{};s&&s.pathname;let l=s?s.pathnameBase:"/";s&&s.route;let u=Nh(),c;if(e){var f;let w=typeof e=="string"?om(e):e;l==="/"||(f=w.pathname)!=null&&f.startsWith(l)||fi(!1),c=w}else c=u;let p=c.pathname||"/",v=p;if(l!=="/"){let w=l.replace(/^\//,"").split("/");v="/"+p.replace(/^\//,"").split("/").slice(w.length).join("/")}let y=r8(t,{pathname:v}),S=O8(y&&y.map(w=>Object.assign({},w,{params:Object.assign({},o,w.params),pathname:zd([l,i.encodeLocation?i.encodeLocation(w.pathname).pathname:w.pathname]),pathnameBase:w.pathnameBase==="/"?l:zd([l,i.encodeLocation?i.encodeLocation(w.pathnameBase).pathname:w.pathnameBase])})),a,r,n);return e&&S?ae.createElement(y1.Provider,{value:{location:yv({pathname:"/",search:"",hash:"",state:null,key:"default"},c),navigationType:Rd.Pop}},S):S}function M8(){let t=F8(),e=k8(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),r=t instanceof Error?t.stack:null,i={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return ae.createElement(ae.Fragment,null,ae.createElement("h2",null,"Unexpected Application Error!"),ae.createElement("h3",{style:{fontStyle:"italic"}},e),r?ae.createElement("pre",{style:i},r):null,null)}const A8=ae.createElement(M8,null);class R8 extends ae.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,r){return r.location!==e.location||r.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:r.error,location:r.location,revalidation:e.revalidation||r.revalidation}}componentDidCatch(e,r){console.error("React Router caught the following error during render",e,r)}render(){return this.state.error!==void 0?ae.createElement(bc.Provider,{value:this.props.routeContext},ae.createElement(fM.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function L8(t){let{routeContext:e,match:r,children:n}=t,i=ae.useContext(v1);return i&&i.static&&i.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=r.route.id),ae.createElement(bc.Provider,{value:e},n)}function O8(t,e,r,n){var i;if(e===void 0&&(e=[]),r===void 0&&(r=null),n===void 0&&(n=null),t==null){var a;if(!r)return null;if(r.errors)t=r.matches;else if((a=n)!=null&&a.v7_partialHydration&&e.length===0&&!r.initialized&&r.matches.length>0)t=r.matches;else return null}let s=t,o=(i=r)==null?void 0:i.errors;if(o!=null){let c=s.findIndex(f=>f.route.id&&o?.[f.route.id]!==void 0);c>=0||fi(!1),s=s.slice(0,Math.min(s.length,c+1))}let l=!1,u=-1;if(r&&n&&n.v7_partialHydration)for(let c=0;c<s.length;c++){let f=s[c];if((f.route.HydrateFallback||f.route.hydrateFallbackElement)&&(u=c),f.route.id){let{loaderData:p,errors:v}=r,y=f.route.loader&&p[f.route.id]===void 0&&(!v||v[f.route.id]===void 0);if(f.route.lazy||y){l=!0,u>=0?s=s.slice(0,u+1):s=[s[0]];break}}}return s.reduceRight((c,f,p)=>{let v,y=!1,S=null,w=null;r&&(v=o&&f.route.id?o[f.route.id]:void 0,S=f.route.errorElement||A8,l&&(u<0&&p===0?(z8("route-fallback"),y=!0,w=null):u===p&&(y=!0,w=f.route.hydrateFallbackElement||null)));let E=e.concat(s.slice(0,p+1)),_=()=>{let T;return v?T=S:y?T=w:f.route.Component?T=ae.createElement(f.route.Component,null):f.route.element?T=f.route.element:T=c,ae.createElement(L8,{match:f,routeContext:{outlet:c,matches:E,isDataRoute:r!=null},children:T})};return r&&(f.route.ErrorBoundary||f.route.errorElement||p===0)?ae.createElement(R8,{location:r.location,revalidation:r.revalidation,component:S,error:v,children:_(),routeContext:{outlet:null,matches:E,isDataRoute:!0}}):_()},null)}var mM=(function(t){return t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t})(mM||{}),gM=(function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t})(gM||{});function D8(t){let e=ae.useContext(v1);return e||fi(!1),e}function I8(t){let e=ae.useContext(dM);return e||fi(!1),e}function j8(t){let e=ae.useContext(bc);return e||fi(!1),e}function vM(t){let e=j8(),r=e.matches[e.matches.length-1];return r.route.id||fi(!1),r.route.id}function F8(){var t;let e=ae.useContext(fM),r=I8(),n=vM();return e!==void 0?e:(t=r.errors)==null?void 0:t[n]}function B8(){let{router:t}=D8(mM.UseNavigateStable),e=vM(gM.UseNavigateStable),r=ae.useRef(!1);return hM(()=>{r.current=!0}),ae.useCallback(function(i,a){a===void 0&&(a={}),r.current&&(typeof i=="number"?t.navigate(i):t.navigate(i,yv({fromRouteId:e},a)))},[t,e])}const xE={};function z8(t,e,r){xE[t]||(xE[t]=!0)}function U8(t,e){t?.v7_startTransition,t?.v7_relativeSplatPath}function qk(t){return T8(t.context)}function qn(t){fi(!1)}function G8(t){let{basename:e="/",children:r=null,location:n,navigationType:i=Rd.Pop,navigator:a,static:s=!1,future:o}=t;qv()&&fi(!1);let l=e.replace(/^\/*/,"/"),u=ae.useMemo(()=>({basename:l,navigator:a,static:s,future:yv({v7_relativeSplatPath:!1},o)}),[l,o,a,s]);typeof n=="string"&&(n=om(n));let{pathname:c="/",search:f="",hash:p="",state:v=null,key:y="default"}=n,S=ae.useMemo(()=>{let w=Hp(c,l);return w==null?null:{location:{pathname:w,search:f,hash:p,state:v,key:y},navigationType:i}},[l,c,f,p,v,y,i]);return S==null?null:ae.createElement(af.Provider,{value:u},ae.createElement(y1.Provider,{children:r,value:S}))}function V8(t){let{children:e,location:r}=t;return N8(MS(e),r)}new Promise(()=>{});function MS(t,e){e===void 0&&(e=[]);let r=[];return ae.Children.forEach(t,(n,i)=>{if(!ae.isValidElement(n))return;let a=[...e,i];if(n.type===ae.Fragment){r.push.apply(r,MS(n.props.children,a));return}n.type!==qn&&fi(!1),!n.props.index||!n.props.children||fi(!1);let s={id:n.props.id||a.join("-"),caseSensitive:n.props.caseSensitive,element:n.props.element,Component:n.props.Component,index:n.props.index,path:n.props.path,loader:n.props.loader,action:n.props.action,errorElement:n.props.errorElement,ErrorBoundary:n.props.ErrorBoundary,hasErrorBoundary:n.props.ErrorBoundary!=null||n.props.errorElement!=null,shouldRevalidate:n.props.shouldRevalidate,handle:n.props.handle,lazy:n.props.lazy};n.props.children&&(s.children=MS(n.props.children,a)),r.push(s)}),r}function tx(){return tx=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},tx.apply(this,arguments)}function yM(t,e){if(t==null)return{};var r={},n=Object.keys(t),i,a;for(a=0;a<n.length;a++)i=n[a],!(e.indexOf(i)>=0)&&(r[i]=t[i]);return r}function H8(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function W8(t,e){return t.button===0&&(!e||e==="_self")&&!H8(t)}const q8=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],$8=["aria-current","caseSensitive","className","end","style","to","viewTransition","children"],K8="6";try{window.__reactRouterVersion=K8}catch{}const Z8=ae.createContext({isTransitioning:!1}),Y8="startTransition",bE=qD[Y8];function X8(t){let{basename:e,children:r,future:n,window:i}=t,a=ae.useRef();a.current==null&&(a.current=JD({window:i,v5Compat:!0}));let s=a.current,[o,l]=ae.useState({action:s.action,location:s.location}),{v7_startTransition:u}=n||{},c=ae.useCallback(f=>{u&&bE?bE(()=>l(f)):l(f)},[l,u]);return ae.useLayoutEffect(()=>s.listen(c),[s,c]),ae.useEffect(()=>U8(n),[n]),ae.createElement(G8,{basename:e,children:r,location:o.location,navigationType:o.action,navigator:s,future:n})}const Q8=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",J8=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,hh=ae.forwardRef(function(e,r){let{onClick:n,relative:i,reloadDocument:a,replace:s,state:o,target:l,to:u,preventScrollReset:c,viewTransition:f}=e,p=yM(e,q8),{basename:v}=ae.useContext(af),y,S=!1;if(typeof u=="string"&&J8.test(u)&&(y=u,Q8))try{let T=new URL(window.location.href),N=u.startsWith("//")?new URL(T.protocol+u):new URL(u),R=Hp(N.pathname,v);N.origin===T.origin&&R!=null?u=R+N.search+N.hash:S=!0}catch{}let w=C8(u,{relative:i}),E=rI(u,{replace:s,state:o,target:l,preventScrollReset:c,relative:i,viewTransition:f});function _(T){n&&n(T),T.defaultPrevented||E(T)}return ae.createElement("a",tx({},p,{href:y||w,onClick:S||a?n:_,ref:r,target:l}))}),eI=ae.forwardRef(function(e,r){let{"aria-current":n="page",caseSensitive:i=!1,className:a="",end:s=!1,style:o,to:l,viewTransition:u,children:c}=e,f=yM(e,$8),p=x1(l,{relative:f.relative}),v=Nh(),y=ae.useContext(dM),{navigator:S,basename:w}=ae.useContext(af),E=y!=null&&nI(p)&&u===!0,_=S.encodeLocation?S.encodeLocation(p).pathname:p.pathname,T=v.pathname,N=y&&y.navigation&&y.navigation.location?y.navigation.location.pathname:null;i||(T=T.toLowerCase(),N=N?N.toLowerCase():null,_=_.toLowerCase()),N&&w&&(N=Hp(N,w)||N);const R=_!=="/"&&_.endsWith("/")?_.length-1:_.length;let I=T===_||!s&&T.startsWith(_)&&T.charAt(R)==="/",F=N!=null&&(N===_||!s&&N.startsWith(_)&&N.charAt(_.length)==="/"),D={isActive:I,isPending:F,isTransitioning:E},j=I?n:void 0,B;typeof a=="function"?B=a(D):B=[a,I?"active":null,F?"pending":null,E?"transitioning":null].filter(Boolean).join(" ");let G=typeof o=="function"?o(D):o;return ae.createElement(hh,tx({},f,{"aria-current":j,className:B,ref:r,style:G,to:l,viewTransition:u}),typeof c=="function"?c(D):c)});var AS;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher",t.useViewTransitionState="useViewTransitionState"})(AS||(AS={}));var wE;(function(t){t.UseFetcher="useFetcher",t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(wE||(wE={}));function tI(t){let e=ae.useContext(v1);return e||fi(!1),e}function rI(t,e){let{target:r,replace:n,state:i,preventScrollReset:a,relative:s,viewTransition:o}=e===void 0?{}:e,l=Va(),u=Nh(),c=x1(t,{relative:s});return ae.useCallback(f=>{if(W8(f,r)){f.preventDefault();let p=n!==void 0?n:ex(u)===ex(c);l(t,{replace:p,state:i,preventScrollReset:a,relative:s,viewTransition:o})}},[u,l,c,n,i,r,t,a,s,o])}function nI(t,e){e===void 0&&(e={});let r=ae.useContext(Z8);r==null&&fi(!1);let{basename:n}=tI(AS.useViewTransitionState),i=x1(t,{relative:e.relative});if(!r.isTransitioning)return!1;let a=Hp(r.currentLocation.pathname,n)||r.currentLocation.pathname,s=Hp(r.nextLocation.pathname,n)||r.nextLocation.pathname;return PS(i.pathname,s)!=null||PS(i.pathname,a)!=null}const $k="-",iI=t=>{const e=sI(t),{conflictingClassGroups:r,conflictingClassGroupModifiers:n}=t;return{getClassGroupId:s=>{const o=s.split($k);return o[0]===""&&o.length!==1&&o.shift(),xM(o,e)||aI(s)},getConflictingClassGroupIds:(s,o)=>{const l=r[s]||[];return o&&n[s]?[...l,...n[s]]:l}}},xM=(t,e)=>{if(t.length===0)return e.classGroupId;const r=t[0],n=e.nextPart.get(r),i=n?xM(t.slice(1),n):void 0;if(i)return i;if(e.validators.length===0)return;const a=t.join($k);return e.validators.find(({validator:s})=>s(a))?.classGroupId},SE=/^\[(.+)\]$/,aI=t=>{if(SE.test(t)){const e=SE.exec(t)[1],r=e?.substring(0,e.indexOf(":"));if(r)return"arbitrary.."+r}},sI=t=>{const{theme:e,prefix:r}=t,n={nextPart:new Map,validators:[]};return lI(Object.entries(t.classGroups),r).forEach(([a,s])=>{RS(s,n,a,e)}),n},RS=(t,e,r,n)=>{t.forEach(i=>{if(typeof i=="string"){const a=i===""?e:kE(e,i);a.classGroupId=r;return}if(typeof i=="function"){if(oI(i)){RS(i(n),e,r,n);return}e.validators.push({validator:i,classGroupId:r});return}Object.entries(i).forEach(([a,s])=>{RS(s,kE(e,a),r,n)})})},kE=(t,e)=>{let r=t;return e.split($k).forEach(n=>{r.nextPart.has(n)||r.nextPart.set(n,{nextPart:new Map,validators:[]}),r=r.nextPart.get(n)}),r},oI=t=>t.isThemeGetter,lI=(t,e)=>e?t.map(([r,n])=>{const i=n.map(a=>typeof a=="string"?e+a:typeof a=="object"?Object.fromEntries(Object.entries(a).map(([s,o])=>[e+s,o])):a);return[r,i]}):t,uI=t=>{if(t<1)return{get:()=>{},set:()=>{}};let e=0,r=new Map,n=new Map;const i=(a,s)=>{r.set(a,s),e++,e>t&&(e=0,n=r,r=new Map)};return{get(a){let s=r.get(a);if(s!==void 0)return s;if((s=n.get(a))!==void 0)return i(a,s),s},set(a,s){r.has(a)?r.set(a,s):i(a,s)}}},bM="!",cI=t=>{const{separator:e,experimentalParseClassName:r}=t,n=e.length===1,i=e[0],a=e.length,s=o=>{const l=[];let u=0,c=0,f;for(let w=0;w<o.length;w++){let E=o[w];if(u===0){if(E===i&&(n||o.slice(w,w+a)===e)){l.push(o.slice(c,w)),c=w+a;continue}if(E==="/"){f=w;continue}}E==="["?u++:E==="]"&&u--}const p=l.length===0?o:o.substring(c),v=p.startsWith(bM),y=v?p.substring(1):p,S=f&&f>c?f-c:void 0;return{modifiers:l,hasImportantModifier:v,baseClassName:y,maybePostfixModifierPosition:S}};return r?o=>r({className:o,parseClassName:s}):s},dI=t=>{if(t.length<=1)return t;const e=[];let r=[];return t.forEach(n=>{n[0]==="["?(e.push(...r.sort(),n),r=[]):r.push(n)}),e.push(...r.sort()),e},fI=t=>({cache:uI(t.cacheSize),parseClassName:cI(t),...iI(t)}),hI=/\s+/,pI=(t,e)=>{const{parseClassName:r,getClassGroupId:n,getConflictingClassGroupIds:i}=e,a=[],s=t.trim().split(hI);let o="";for(let l=s.length-1;l>=0;l-=1){const u=s[l],{modifiers:c,hasImportantModifier:f,baseClassName:p,maybePostfixModifierPosition:v}=r(u);let y=!!v,S=n(y?p.substring(0,v):p);if(!S){if(!y){o=u+(o.length>0?" "+o:o);continue}if(S=n(p),!S){o=u+(o.length>0?" "+o:o);continue}y=!1}const w=dI(c).join(":"),E=f?w+bM:w,_=E+S;if(a.includes(_))continue;a.push(_);const T=i(S,y);for(let N=0;N<T.length;++N){const R=T[N];a.push(E+R)}o=u+(o.length>0?" "+o:o)}return o};function mI(){let t=0,e,r,n="";for(;t<arguments.length;)(e=arguments[t++])&&(r=wM(e))&&(n&&(n+=" "),n+=r);return n}const wM=t=>{if(typeof t=="string")return t;let e,r="";for(let n=0;n<t.length;n++)t[n]&&(e=wM(t[n]))&&(r&&(r+=" "),r+=e);return r};function gI(t,...e){let r,n,i,a=s;function s(l){const u=e.reduce((c,f)=>f(c),t());return r=fI(u),n=r.cache.get,i=r.cache.set,a=o,o(l)}function o(l){const u=n(l);if(u)return u;const c=pI(l,r);return i(l,c),c}return function(){return a(mI.apply(null,arguments))}}const Rn=t=>{const e=r=>r[t]||[];return e.isThemeGetter=!0,e},SM=/^\[(?:([a-z-]+):)?(.+)\]$/i,vI=/^\d+\/\d+$/,yI=new Set(["px","full","screen"]),xI=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,bI=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,wI=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,SI=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,kI=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,tc=t=>Ip(t)||yI.has(t)||vI.test(t),pd=t=>lm(t,"length",AI),Ip=t=>!!t&&!Number.isNaN(Number(t)),zb=t=>lm(t,"number",Ip),Bm=t=>!!t&&Number.isInteger(Number(t)),_I=t=>t.endsWith("%")&&Ip(t.slice(0,-1)),yr=t=>SM.test(t),md=t=>xI.test(t),CI=new Set(["length","size","percentage"]),EI=t=>lm(t,CI,kM),TI=t=>lm(t,"position",kM),NI=new Set(["image","url"]),PI=t=>lm(t,NI,LI),MI=t=>lm(t,"",RI),zm=()=>!0,lm=(t,e,r)=>{const n=SM.exec(t);return n?n[1]?typeof e=="string"?n[1]===e:e.has(n[1]):r(n[2]):!1},AI=t=>bI.test(t)&&!wI.test(t),kM=()=>!1,RI=t=>SI.test(t),LI=t=>kI.test(t),OI=()=>{const t=Rn("colors"),e=Rn("spacing"),r=Rn("blur"),n=Rn("brightness"),i=Rn("borderColor"),a=Rn("borderRadius"),s=Rn("borderSpacing"),o=Rn("borderWidth"),l=Rn("contrast"),u=Rn("grayscale"),c=Rn("hueRotate"),f=Rn("invert"),p=Rn("gap"),v=Rn("gradientColorStops"),y=Rn("gradientColorStopPositions"),S=Rn("inset"),w=Rn("margin"),E=Rn("opacity"),_=Rn("padding"),T=Rn("saturate"),N=Rn("scale"),R=Rn("sepia"),I=Rn("skew"),F=Rn("space"),D=Rn("translate"),j=()=>["auto","contain","none"],B=()=>["auto","hidden","clip","visible","scroll"],G=()=>["auto",yr,e],K=()=>[yr,e],O=()=>["",tc,pd],W=()=>["auto",Ip,yr],U=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],q=()=>["solid","dashed","dotted","double","none"],Z=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],Q=()=>["start","end","center","between","around","evenly","stretch"],ne=()=>["","0",yr],re=()=>["auto","avoid","all","avoid-page","page","left","right","column"],Y=()=>[Ip,yr];return{cacheSize:500,separator:":",theme:{colors:[zm],spacing:[tc,pd],blur:["none","",md,yr],brightness:Y(),borderColor:[t],borderRadius:["none","","full",md,yr],borderSpacing:K(),borderWidth:O(),contrast:Y(),grayscale:ne(),hueRotate:Y(),invert:ne(),gap:K(),gradientColorStops:[t],gradientColorStopPositions:[_I,pd],inset:G(),margin:G(),opacity:Y(),padding:K(),saturate:Y(),scale:Y(),sepia:ne(),skew:Y(),space:K(),translate:K()},classGroups:{aspect:[{aspect:["auto","square","video",yr]}],container:["container"],columns:[{columns:[md]}],"break-after":[{"break-after":re()}],"break-before":[{"break-before":re()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...U(),yr]}],overflow:[{overflow:B()}],"overflow-x":[{"overflow-x":B()}],"overflow-y":[{"overflow-y":B()}],overscroll:[{overscroll:j()}],"overscroll-x":[{"overscroll-x":j()}],"overscroll-y":[{"overscroll-y":j()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[S]}],"inset-x":[{"inset-x":[S]}],"inset-y":[{"inset-y":[S]}],start:[{start:[S]}],end:[{end:[S]}],top:[{top:[S]}],right:[{right:[S]}],bottom:[{bottom:[S]}],left:[{left:[S]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",Bm,yr]}],basis:[{basis:G()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",yr]}],grow:[{grow:ne()}],shrink:[{shrink:ne()}],order:[{order:["first","last","none",Bm,yr]}],"grid-cols":[{"grid-cols":[zm]}],"col-start-end":[{col:["auto",{span:["full",Bm,yr]},yr]}],"col-start":[{"col-start":W()}],"col-end":[{"col-end":W()}],"grid-rows":[{"grid-rows":[zm]}],"row-start-end":[{row:["auto",{span:[Bm,yr]},yr]}],"row-start":[{"row-start":W()}],"row-end":[{"row-end":W()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",yr]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",yr]}],gap:[{gap:[p]}],"gap-x":[{"gap-x":[p]}],"gap-y":[{"gap-y":[p]}],"justify-content":[{justify:["normal",...Q()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...Q(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...Q(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[_]}],px:[{px:[_]}],py:[{py:[_]}],ps:[{ps:[_]}],pe:[{pe:[_]}],pt:[{pt:[_]}],pr:[{pr:[_]}],pb:[{pb:[_]}],pl:[{pl:[_]}],m:[{m:[w]}],mx:[{mx:[w]}],my:[{my:[w]}],ms:[{ms:[w]}],me:[{me:[w]}],mt:[{mt:[w]}],mr:[{mr:[w]}],mb:[{mb:[w]}],ml:[{ml:[w]}],"space-x":[{"space-x":[F]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[F]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",yr,e]}],"min-w":[{"min-w":[yr,e,"min","max","fit"]}],"max-w":[{"max-w":[yr,e,"none","full","min","max","fit","prose",{screen:[md]},md]}],h:[{h:[yr,e,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[yr,e,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[yr,e,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[yr,e,"auto","min","max","fit"]}],"font-size":[{text:["base",md,pd]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",zb]}],"font-family":[{font:[zm]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",yr]}],"line-clamp":[{"line-clamp":["none",Ip,zb]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",tc,yr]}],"list-image":[{"list-image":["none",yr]}],"list-style-type":[{list:["none","disc","decimal",yr]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[t]}],"placeholder-opacity":[{"placeholder-opacity":[E]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[t]}],"text-opacity":[{"text-opacity":[E]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...q(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",tc,pd]}],"underline-offset":[{"underline-offset":["auto",tc,yr]}],"text-decoration-color":[{decoration:[t]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:K()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",yr]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",yr]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[E]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...U(),TI]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",EI]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},PI]}],"bg-color":[{bg:[t]}],"gradient-from-pos":[{from:[y]}],"gradient-via-pos":[{via:[y]}],"gradient-to-pos":[{to:[y]}],"gradient-from":[{from:[v]}],"gradient-via":[{via:[v]}],"gradient-to":[{to:[v]}],rounded:[{rounded:[a]}],"rounded-s":[{"rounded-s":[a]}],"rounded-e":[{"rounded-e":[a]}],"rounded-t":[{"rounded-t":[a]}],"rounded-r":[{"rounded-r":[a]}],"rounded-b":[{"rounded-b":[a]}],"rounded-l":[{"rounded-l":[a]}],"rounded-ss":[{"rounded-ss":[a]}],"rounded-se":[{"rounded-se":[a]}],"rounded-ee":[{"rounded-ee":[a]}],"rounded-es":[{"rounded-es":[a]}],"rounded-tl":[{"rounded-tl":[a]}],"rounded-tr":[{"rounded-tr":[a]}],"rounded-br":[{"rounded-br":[a]}],"rounded-bl":[{"rounded-bl":[a]}],"border-w":[{border:[o]}],"border-w-x":[{"border-x":[o]}],"border-w-y":[{"border-y":[o]}],"border-w-s":[{"border-s":[o]}],"border-w-e":[{"border-e":[o]}],"border-w-t":[{"border-t":[o]}],"border-w-r":[{"border-r":[o]}],"border-w-b":[{"border-b":[o]}],"border-w-l":[{"border-l":[o]}],"border-opacity":[{"border-opacity":[E]}],"border-style":[{border:[...q(),"hidden"]}],"divide-x":[{"divide-x":[o]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[o]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[E]}],"divide-style":[{divide:q()}],"border-color":[{border:[i]}],"border-color-x":[{"border-x":[i]}],"border-color-y":[{"border-y":[i]}],"border-color-s":[{"border-s":[i]}],"border-color-e":[{"border-e":[i]}],"border-color-t":[{"border-t":[i]}],"border-color-r":[{"border-r":[i]}],"border-color-b":[{"border-b":[i]}],"border-color-l":[{"border-l":[i]}],"divide-color":[{divide:[i]}],"outline-style":[{outline:["",...q()]}],"outline-offset":[{"outline-offset":[tc,yr]}],"outline-w":[{outline:[tc,pd]}],"outline-color":[{outline:[t]}],"ring-w":[{ring:O()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[t]}],"ring-opacity":[{"ring-opacity":[E]}],"ring-offset-w":[{"ring-offset":[tc,pd]}],"ring-offset-color":[{"ring-offset":[t]}],shadow:[{shadow:["","inner","none",md,MI]}],"shadow-color":[{shadow:[zm]}],opacity:[{opacity:[E]}],"mix-blend":[{"mix-blend":[...Z(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":Z()}],filter:[{filter:["","none"]}],blur:[{blur:[r]}],brightness:[{brightness:[n]}],contrast:[{contrast:[l]}],"drop-shadow":[{"drop-shadow":["","none",md,yr]}],grayscale:[{grayscale:[u]}],"hue-rotate":[{"hue-rotate":[c]}],invert:[{invert:[f]}],saturate:[{saturate:[T]}],sepia:[{sepia:[R]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[r]}],"backdrop-brightness":[{"backdrop-brightness":[n]}],"backdrop-contrast":[{"backdrop-contrast":[l]}],"backdrop-grayscale":[{"backdrop-grayscale":[u]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[c]}],"backdrop-invert":[{"backdrop-invert":[f]}],"backdrop-opacity":[{"backdrop-opacity":[E]}],"backdrop-saturate":[{"backdrop-saturate":[T]}],"backdrop-sepia":[{"backdrop-sepia":[R]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[s]}],"border-spacing-x":[{"border-spacing-x":[s]}],"border-spacing-y":[{"border-spacing-y":[s]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",yr]}],duration:[{duration:Y()}],ease:[{ease:["linear","in","out","in-out",yr]}],delay:[{delay:Y()}],animate:[{animate:["none","spin","ping","pulse","bounce",yr]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[N]}],"scale-x":[{"scale-x":[N]}],"scale-y":[{"scale-y":[N]}],rotate:[{rotate:[Bm,yr]}],"translate-x":[{"translate-x":[D]}],"translate-y":[{"translate-y":[D]}],"skew-x":[{"skew-x":[I]}],"skew-y":[{"skew-y":[I]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",yr]}],accent:[{accent:["auto",t]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",yr]}],"caret-color":[{caret:[t]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":K()}],"scroll-mx":[{"scroll-mx":K()}],"scroll-my":[{"scroll-my":K()}],"scroll-ms":[{"scroll-ms":K()}],"scroll-me":[{"scroll-me":K()}],"scroll-mt":[{"scroll-mt":K()}],"scroll-mr":[{"scroll-mr":K()}],"scroll-mb":[{"scroll-mb":K()}],"scroll-ml":[{"scroll-ml":K()}],"scroll-p":[{"scroll-p":K()}],"scroll-px":[{"scroll-px":K()}],"scroll-py":[{"scroll-py":K()}],"scroll-ps":[{"scroll-ps":K()}],"scroll-pe":[{"scroll-pe":K()}],"scroll-pt":[{"scroll-pt":K()}],"scroll-pr":[{"scroll-pr":K()}],"scroll-pb":[{"scroll-pb":K()}],"scroll-pl":[{"scroll-pl":K()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",yr]}],fill:[{fill:[t,"none"]}],"stroke-w":[{stroke:[tc,pd,zb]}],stroke:[{stroke:[t,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},Kk=gI(OI),ti=({children:t,className:e,...r})=>m.jsx("div",{className:Kk("bg-glass backdrop-blur-xl border border-glass-border rounded-xl",e),...r,children:t}),rx=({url:t,name:e,alt:r="User",size:n="md",className:i})=>{const a={sm:"size-8 text-xs",md:"size-10 text-sm",lg:"size-16 text-lg",xl:"size-32 text-2xl"},s=e?e.charAt(0).toUpperCase():r?r.charAt(0).toUpperCase():"?";return m.jsx("div",{className:Kk("rounded-full bg-surface-light border border-white/10 flex items-center justify-center overflow-hidden shrink-0 text-slate-400 font-bold select-none",a[n],i),children:t?m.jsx("img",{src:t,alt:e||r,className:"w-full h-full object-cover"}):m.jsx("span",{children:s})})},DI=()=>m.jsx("div",{className:"flex h-screen w-full overflow-hidden bg-background-dark relative",children:m.jsx("main",{className:"flex-1 min-w-0 relative overflow-hidden flex flex-col",children:m.jsx(qk,{})})}),II="/api",et={async request(t,e={}){const r=`${II}${t}`,i={...e.body instanceof FormData?{}:{"Content-Type":"application/json"},...e.headers},a=await fetch(r,{...e,headers:i,credentials:"include"});if(!a.ok){const s=await a.json().catch(()=>({}));throw new Error(s.error||`HTTP error! status: ${a.status}`)}return a.status===204||a.headers.get("content-length")==="0"?null:a.json()},get(t,e={}){return this.request(t,{method:"GET",headers:e})},post(t,e,r={}){return this.request(t,{method:"POST",body:e instanceof FormData?e:JSON.stringify(e),headers:r})},put(t,e,r={}){return this.request(t,{method:"PUT",body:e instanceof FormData?e:JSON.stringify(e),headers:r})},patch(t,e,r={}){return this.request(t,{method:"PATCH",body:e instanceof FormData?e:JSON.stringify(e),headers:r})},delete(t,e={}){return this.request(t,{method:"DELETE",headers:e})}},Gf={list:()=>et.get("/workspaces"),create:(t,e,r,n)=>et.post("/workspaces",{name:t,title:e,genre:r,imageUrl:n}),delete:t=>et.delete("/workspaces/"+t),update:(t,e)=>et.put("/workspaces/"+t,e),select:t=>et.post("/workspaces/select",{projectName:t}),restartBackend:()=>et.post("/system/restart",{}),healthCheck:()=>et.get("/system/health")},jI=["FANTASA","SCI-FI","HORROR","LORE","MISTERIO","HISTRICO","CYBERPUNK","STEAMPUNK"],FI=({isOpen:t,onClose:e,onCreate:r})=>{if(!t)return null;const[n,i]=ae.useState(!1),[a,s]=ae.useState({name:"",title:"",genre:"FANTASA",imageUrl:"https://images.unsplash.com/photo-1518709268805-4e9042af9f23?auto=format&fit=crop&q=80&w=800"}),o=u=>{const{name:c,value:f}=u.target;s(p=>({...p,[c]:f}))},l=u=>{u.preventDefault();let c=a.name;if(!c&&a.title&&(c=a.title.toLowerCase().replace(/[^a-z0-9]/g,"-")),!c){alert("Project ID/Name is required");return}r({...a,name:c}),e(),s({name:"",title:"",genre:"FANTASA",imageUrl:"https://images.unsplash.com/photo-1518709268805-4e9042af9f23?auto=format&fit=crop&q=80&w=800"})};return xo.createPortal(m.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[m.jsx("div",{className:"absolute inset-0 bg-black/80 backdrop-blur-sm animate-in fade-in duration-200",onClick:e}),m.jsxs("div",{className:"relative w-full max-w-2xl bg-[#0a0a0c] border border-white/10 rounded-3xl shadow-2xl overflow-hidden flex animate-in zoom-in-95 duration-200",children:[m.jsxs("div",{className:"w-1/3 bg-black relative hidden sm:block",children:[m.jsx("img",{src:a.imageUrl,onError:()=>i(!0),className:`absolute inset-0 w-full h-full object-cover opacity-60 transition-opacity duration-500 ${n?"hidden":""}`,alt:"Preview"}),m.jsxs("div",{className:"absolute inset-x-0 bottom-0 p-6 bg-gradient-to-t from-black to-transparent",children:[m.jsx("h4",{className:"text-white font-black text-xl leading-none",children:a.title||"Untitled"}),m.jsx("span",{className:"text-[10px] font-bold text-primary uppercase tracking-widest mt-2 block",children:a.genre})]})]}),m.jsxs("div",{className:"flex-1 p-8",children:[m.jsx("h2",{className:"text-2xl font-black text-white mb-6",children:"Nuevo Cuaderno"}),m.jsxs("form",{onSubmit:l,className:"space-y-5",children:[m.jsxs("div",{className:"space-y-1.5",children:[m.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-text-muted",children:"Ttulo del Proyecto"}),m.jsx("input",{type:"text",name:"title",value:a.title,onChange:o,placeholder:"e.g. Las Crnicas de Etheria",className:"w-full bg-[#13141f] border border-white/10 rounded-xl px-4 py-3 text-white text-sm focus:border-primary/50 focus:ring-1 focus:ring-primary/50 outline-none transition-all",autoFocus:!0})]}),m.jsxs("div",{className:"space-y-1.5",children:[m.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-text-muted",children:"ID de Archivo (Slug)"}),m.jsx("input",{type:"text",name:"name",value:a.name,onChange:o,placeholder:"e.g. etheria-v1",className:"w-full bg-[#13141f] border border-white/10 rounded-xl px-4 py-3 text-white font-mono text-xs focus:border-primary/50 focus:ring-1 focus:ring-primary/50 outline-none transition-all placeholder:text-white/10"}),m.jsx("p",{className:"text-[10px] text-white/20",children:"Se usar como nombre del archivo .db"})]}),m.jsxs("div",{className:"space-y-1.5",children:[m.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-text-muted",children:"Gnero"}),m.jsx("div",{className:"grid grid-cols-2 gap-2",children:jI.slice(0,4).map(u=>m.jsx("button",{type:"button",onClick:()=>s(c=>({...c,genre:u})),className:`px-3 py-2 rounded-lg text-[10px] font-bold border transition-all ${a.genre===u?"bg-primary text-white border-primary":"bg-[#13141f] border-white/10 text-text-muted hover:border-white/20"}`,children:u},u))})]}),m.jsxs("div",{className:"space-y-1.5",children:[m.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-text-muted",children:"Imagen de Portada (URL)"}),m.jsx("input",{type:"text",name:"imageUrl",value:a.imageUrl,onChange:u=>{s(c=>({...c,imageUrl:u.target.value})),i(!1)},className:"w-full bg-[#13141f] border border-white/10 rounded-xl px-4 py-3 text-white text-xs focus:border-primary/50 focus:ring-1 focus:ring-primary/50 outline-none transition-all truncate"})]}),m.jsxs("div",{className:"pt-4 flex gap-3",children:[m.jsx("button",{type:"button",onClick:e,className:"flex-1 px-4 py-3 bg-[#13141f] hover:bg-white/5 border border-white/10 rounded-xl text-xs font-bold text-text-muted transition-all",children:"Cancelar"}),m.jsxs("button",{type:"submit",className:"flex-1 px-4 py-3 bg-primary hover:bg-primary-light text-white rounded-xl text-xs font-bold transition-all shadow-lg shadow-primary/20 flex items-center justify-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"rocket_launch"}),"Crear Universo"]})]})]})]})]})]}),document.body)},BI=["FANTASA","SCI-FI","HORROR","LORE","MISTERIO","HISTRICO","CYBERPUNK","STEAMPUNK"],zI=({isOpen:t,onClose:e,onUpdate:r,project:n})=>{if(!t||!n)return null;const[i,a]=ae.useState(!1),[s,o]=ae.useState({name:n,title:n,genre:"FANTASA",imageUrl:"https://images.unsplash.com/photo-1518709268805-4e9042af9f23?auto=format&fit=crop&q=80&w=800"});ae.useEffect(()=>{n&&o(u=>({...u,name:n,title:n}))},[n]);const l=u=>{u.preventDefault(),r(s.name,{title:s.title,genre:s.genre,imageUrl:s.imageUrl}),e()};return xo.createPortal(m.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[m.jsx("div",{className:"absolute inset-0 bg-black/80 backdrop-blur-sm animate-in fade-in duration-200",onClick:e}),m.jsxs("div",{className:"relative w-full max-w-2xl bg-[#0a0a0c] border border-white/10 rounded-3xl shadow-2xl overflow-hidden flex animate-in zoom-in-95 duration-200",children:[m.jsxs("div",{className:"w-1/3 bg-black relative hidden sm:block",children:[m.jsx("img",{src:s.imageUrl,onError:()=>a(!0),className:`absolute inset-0 w-full h-full object-cover opacity-60 transition-opacity duration-500 ${i?"hidden":""}`,alt:"Preview"}),m.jsxs("div",{className:"absolute inset-x-0 bottom-0 p-6 bg-gradient-to-t from-black to-transparent",children:[m.jsx("h4",{className:"text-white font-black text-xl leading-none",children:s.title||"Untitled"}),m.jsx("span",{className:"text-[10px] font-bold text-primary uppercase tracking-widest mt-2 block",children:s.genre})]})]}),m.jsxs("div",{className:"flex-1 p-8",children:[m.jsx("h2",{className:"text-2xl font-black text-white mb-6",children:"Editar Cuaderno"}),m.jsxs("form",{onSubmit:l,className:"space-y-5",children:[m.jsxs("div",{className:"space-y-1.5",children:[m.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-text-muted",children:"Ttulo del Proyecto"}),m.jsx("input",{type:"text",name:"title",value:s.title,onChange:u=>o(c=>({...c,title:u.target.value})),className:"w-full bg-[#13141f] border border-white/10 rounded-xl px-4 py-3 text-white text-sm focus:border-primary/50 focus:ring-1 focus:ring-primary/50 outline-none transition-all",autoFocus:!0})]}),m.jsxs("div",{className:"space-y-1.5 opacity-50",children:[m.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-text-muted",children:"ID de Archivo (Inmutable)"}),m.jsx("input",{type:"text",value:s.name,readOnly:!0,className:"w-full bg-[#0a0a0c] border border-white/5 rounded-xl px-4 py-3 text-white/50 font-mono text-xs outline-none cursor-not-allowed"})]}),m.jsxs("div",{className:"space-y-1.5",children:[m.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-text-muted",children:"Gnero"}),m.jsx("div",{className:"grid grid-cols-2 gap-2",children:BI.slice(0,4).map(u=>m.jsx("button",{type:"button",onClick:()=>o(c=>({...c,genre:u})),className:`px-3 py-2 rounded-lg text-[10px] font-bold border transition-all ${s.genre===u?"bg-primary text-white border-primary":"bg-[#13141f] border-white/10 text-text-muted hover:border-white/20"}`,children:u},u))})]}),m.jsxs("div",{className:"space-y-1.5",children:[m.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-text-muted",children:"Imagen de Portada (URL)"}),m.jsx("input",{type:"text",value:s.imageUrl,onChange:u=>{o(c=>({...c,imageUrl:u.target.value})),a(!1)},className:"w-full bg-[#13141f] border border-white/10 rounded-xl px-4 py-3 text-white text-xs focus:border-primary/50 focus:ring-1 focus:ring-primary/50 outline-none transition-all truncate"})]}),m.jsxs("div",{className:"pt-4 flex gap-3",children:[m.jsx("button",{type:"button",onClick:e,className:"flex-1 px-4 py-3 bg-[#13141f] hover:bg-white/5 border border-white/10 rounded-xl text-xs font-bold text-text-muted transition-all",children:"Cancelar"}),m.jsxs("button",{type:"submit",className:"flex-1 px-4 py-3 bg-primary hover:bg-primary-light text-white rounded-xl text-xs font-bold transition-all shadow-lg shadow-primary/20 flex items-center justify-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"save"}),"Guardar Cambios"]})]})]})]})]})]}),document.body)},Dn=ae.forwardRef(({children:t,variant:e="primary",size:r="md",className:n,icon:i,isLoading:a,...s},o)=>{const l="inline-flex items-center justify-center rounded-lg font-medium transition-all focus:outline-none disabled:opacity-50 disabled:cursor-not-allowed active:scale-95",u={primary:"bg-primary text-white shadow-lg shadow-primary/25 hover:bg-primary-light hover:shadow-primary/40 border border-transparent",secondary:"bg-surface-light text-slate-200 border border-white/10 hover:bg-white/5 hover:text-white hover:border-white/20",ghost:"bg-transparent text-slate-400 hover:text-white hover:bg-white/5",danger:"bg-red-500/10 text-red-500 border border-red-500/20 hover:bg-red-500/20 hover:border-red-500/50 hover:shadow-lg hover:shadow-red-500/10",outline:"bg-transparent border border-primary/50 text-primary hover:bg-primary/10"},c={xs:"px-2.5 py-1 text-xs gap-1.5",sm:"px-3 py-1.5 text-xs gap-1.5",md:"px-4 py-2 text-sm gap-2",lg:"px-6 py-3 text-base gap-3",icon:"size-9 p-0"};return m.jsxs("button",{ref:o,className:Kk(l,u[e],c[r],n),disabled:a,...s,children:[a?m.jsx("span",{className:"material-symbols-outlined animate-spin text-[18px]",children:"progress_activity"}):i?m.jsx("span",{className:"material-symbols-outlined text-[18px]",children:i}):null,t]})});Dn.displayName="Button";const _M=({isOpen:t,onClose:e,onConfirm:r,title:n,message:i,confirmText:a="Confirm",cancelText:s="Cancel",isDestructive:o=!0})=>t?m.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[m.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm animate-in fade-in duration-300",onClick:e}),m.jsx("div",{className:"relative z-10 w-full max-w-md animate-in zoom-in-95 duration-300",children:m.jsxs(ti,{className:"p-6 border-red-500/20 shadow-2xl shadow-black/50",children:[m.jsxs("div",{className:"flex items-start gap-4 mb-6",children:[m.jsx("div",{className:`
                            size-12 rounded-xl flex items-center justify-center shrink-0
                            ${o?"bg-red-500/10 text-red-500":"bg-primary/10 text-primary"}
                        `,children:m.jsx("span",{className:"material-symbols-outlined text-2xl",children:o?"warning":"help"})}),m.jsxs("div",{children:[m.jsx("h3",{className:"text-lg font-black text-white mb-2 leading-tight",children:n}),m.jsx("p",{className:"text-sm text-slate-400 leading-relaxed",children:i})]})]}),m.jsxs("div",{className:"flex items-center justify-end gap-3",children:[m.jsx(Dn,{variant:"ghost",onClick:e,children:s}),m.jsx(Dn,{variant:o?"danger":"primary",onClick:()=>{r(),e()},icon:o?"delete":"check",children:a})]})]})})]}):null,UI=()=>{const t=Va(),[e,r]=ae.useState([]),[n,i]=ae.useState(!0),[a,s]=ae.useState(null),[o,l]=ae.useState(""),[u,c]=ae.useState(!1),[f,p]=ae.useState(null),[v,y]=ae.useState(null),[S,w]=ae.useState(!1),[E,_]=ae.useState(0),[T,N]=ae.useState("idle");ae.useEffect(()=>{R()},[]);const R=async()=>{try{i(!0);const O=await Gf.list();r(O)}catch(O){console.error("Failed to load workspaces",O),s("Error al cargar cuadernos. Est el servidor encendido?")}finally{i(!1)}},I=async O=>{try{i(!0);const W=await Gf.select(O);W.success&&W.redirect&&(localStorage.setItem("user",JSON.stringify({username:"local",success:!0})),t(W.redirect))}catch(W){s(W.message||"Fallo al entrar al cuaderno"),i(!1)}},F=async O=>{try{i(!0),(await Gf.create(O.name,O.title,O.genre,O.imageUrl)).success&&await I(O.name)}catch{s("Error al crear cuaderno"),i(!1)}},D=async()=>{if(f)try{i(!0),await Gf.delete(f),await R(),p(null)}catch{s("Error al borrar el cuaderno"),i(!1)}},j=async(O,W)=>{try{i(!0),await Gf.update(O,W),await R(),y(null)}catch{s("Error al actualizar cuaderno"),i(!1)}},B=()=>{window.location.href="/api/backup/download"},G=async()=>{w(!0),N("restarting"),_(10);try{await Gf.restartBackend(),_(30),await new Promise(q=>setTimeout(q,2e3)),_(50),N("checking");let O=0;const W=30,U=async()=>{try{await Gf.healthCheck(),_(100),N("complete"),setTimeout(()=>{w(!1),N("idle"),_(0),R()},1500)}catch{O++,O>=W?(N("error"),_(0)):(_(50+O/W*50),setTimeout(U,1e3))}};U()}catch{N("error"),_(0)}},K=e.filter(O=>(O.title||O.filename||"").toLowerCase().includes(o.toLowerCase()));return m.jsxs("div",{className:"h-screen w-full bg-[#0a0b14] text-white flex flex-col items-center font-sans selection:bg-indigo-500/30 overflow-hidden",children:[m.jsxs("div",{className:"w-full max-w-6xl flex-1 flex flex-col overflow-y-auto custom-scrollbar p-8",children:[m.jsxs("header",{className:"w-full mt-24 mb-12 flex flex-col lg:flex-row lg:items-end justify-between gap-8 flex-shrink-0",children:[m.jsx("div",{className:"space-y-4",children:m.jsx("div",{className:"flex items-center gap-4",children:m.jsxs("h1",{className:"text-6xl font-black tracking-tighter leading-none",children:[m.jsx("span",{className:"block text-indigo-400",children:"Mis"}),m.jsx("span",{className:"block text-white",children:"Cuadernos"})]})})}),m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsxs("button",{onClick:()=>t("/settings"),className:"flex items-center gap-2 px-5 py-3 bg-white/5 hover:bg-white/10 border border-white/10 rounded-2xl transition-all text-xs font-bold text-slate-400 hover:text-white group",title:"Configuracin Global",children:[m.jsx("span",{className:"material-symbols-outlined text-lg group-hover:rotate-90 transition-transform duration-500",children:"settings"}),m.jsx("span",{className:"hidden sm:inline",children:"Ajustes"})]}),m.jsxs("button",{onClick:B,className:"flex items-center gap-2 px-5 py-3 bg-white/5 hover:bg-white/10 border border-white/10 rounded-2xl transition-all text-xs font-bold text-slate-400 hover:text-white group",title:"Descargar copia de seguridad de todos los universos",children:[m.jsx("span",{className:"material-symbols-outlined text-lg group-hover:scale-110 transition-transform",children:"cloud_download"}),m.jsx("span",{className:"hidden sm:inline",children:"Backup Global"})]}),m.jsxs("button",{onClick:G,className:"flex items-center gap-2 px-5 py-3 bg-orange-500/10 hover:bg-orange-500/20 border border-orange-500/20 rounded-2xl transition-all text-xs font-bold text-orange-400 hover:text-orange-300 group",title:"Reiniciar servidor backend (til tras migraciones)",children:[m.jsx("span",{className:"material-symbols-outlined text-lg group-hover:rotate-180 transition-transform duration-500",children:"refresh"}),m.jsx("span",{className:"hidden sm:inline",children:"Reiniciar Backend"})]}),m.jsxs("div",{className:"relative group min-w-[300px]",children:[m.jsx("span",{className:"material-symbols-outlined absolute left-4 top-1/2 -translate-y-1/2 text-white/20 text-xl group-focus-within:text-indigo-400 transition-colors pointer-events-none",children:"search"}),m.jsx("input",{type:"text",placeholder:"Buscar...",value:o,onChange:O=>l(O.target.value),className:"w-full bg-[#13141f] border border-white/5 rounded-2xl py-3 pl-12 pr-4 text-sm text-white focus:outline-none focus:border-indigo-500/50 transition-all placeholder:text-white/10"})]})]})]}),m.jsx("section",{className:"w-full max-w-6xl",children:n?m.jsxs("div",{className:"flex flex-col items-center gap-6 py-20 opacity-20",children:[m.jsx("div",{className:"w-12 h-12 border-4 border-indigo-500 border-t-transparent rounded-full animate-spin"}),m.jsx("p",{className:"text-[10px] font-black uppercase tracking-[0.3em]",children:"Accediendo al Sector Local..."})]}):m.jsxs("div",{className:"flex flex-wrap gap-6 justify-start pb-20",children:[m.jsxs("div",{onClick:()=>c(!0),className:"group relative h-[380px] rounded-[2.5rem] border-2 border-dashed border-white/5 flex flex-col items-center justify-center gap-6 hover:bg-white/5 hover:border-indigo-500/30 transition-all cursor-pointer overflow-hidden animate-in fade-in duration-700 w-full md:w-[calc(50%-0.75rem)] lg:w-[calc(33.333%-1rem)]",children:[m.jsx("div",{className:"w-20 h-20 rounded-full bg-[#13141f] border border-white/5 flex items-center justify-center text-4xl text-white/20 group-hover:scale-110 group-hover:text-indigo-400 transition-all",children:m.jsx("span",{className:"material-symbols-outlined text-4xl",children:"add"})}),m.jsxs("div",{className:"text-center",children:[m.jsx("h3",{className:"text-xl font-black tracking-tight text-white/50 group-hover:text-white transition-colors",children:"Nuevo Cuaderno"}),m.jsx("p",{className:"text-[10px] font-bold text-white/20 uppercase tracking-widest mt-2 group-hover:text-white/40",children:"Inicia un nuevo universo"})]})]}),K.map(O=>{const W=O.imageUrl||"https://images.unsplash.com/photo-1451187580459-43490279c0fa?auto=format&fit=crop&q=80&w=800";return m.jsxs("div",{onClick:()=>I(O.filename),className:"group relative h-[380px] rounded-[2.5rem] bg-[#13141f] border border-white/5 overflow-hidden transition-all hover:-translate-y-2 hover:shadow-2xl hover:shadow-indigo-500/10 cursor-pointer animate-in fade-in slide-in-from-bottom-4 w-full md:w-[calc(50%-0.75rem)] lg:w-[calc(33.333%-1rem)]",children:[m.jsxs("div",{className:"absolute inset-x-0 top-0 h-2/3",children:[m.jsx("img",{src:W,className:"w-full h-full object-cover opacity-40 group-hover:opacity-60 transition-opacity",alt:""}),m.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-[#13141f] via-transparent to-transparent"})]}),m.jsxs("div",{className:"absolute top-6 right-6 flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity duration-300 z-20",children:[m.jsx("button",{onClick:U=>{U.stopPropagation(),y(O.filename)},className:"w-10 h-10 rounded-full bg-black/50 backdrop-blur-md border border-white/10 flex items-center justify-center text-white/70 hover:text-white hover:bg-indigo-500 hover:border-indigo-400 transition-all",title:"Editar",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"edit"})}),m.jsx("button",{onClick:U=>{U.stopPropagation(),p(O.filename)},className:"w-10 h-10 rounded-full bg-black/50 backdrop-blur-md border border-white/10 flex items-center justify-center text-white/70 hover:text-white hover:bg-red-500 hover:border-red-400 transition-all",title:"Eliminar",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})})]}),m.jsx("div",{className:"absolute inset-0 flex flex-col justify-end p-8",children:m.jsxs("div",{className:"mt-auto space-y-3",children:[m.jsx("span",{className:"inline-block px-3 py-1 bg-red-500/20 border border-red-500/30 text-[9px] font-black text-red-100 rounded-lg tracking-widest uppercase",children:O.tag}),m.jsx("h3",{className:"text-3xl font-black text-white tracking-tighter leading-tight group-hover:text-indigo-400 transition-colors",children:O.title}),O.title!==O.filename&&m.jsx("p",{className:"text-[10px] text-white/30 font-mono mb-1",children:O.filename}),m.jsx("p",{className:"text-xs text-white/40 line-clamp-2 leading-relaxed",children:"Una tierra dividida por la magia y la tecnologa antigua..."}),m.jsxs("div",{className:"flex items-center justify-between pt-6 border-t border-white/5 mt-4",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-emerald-500 shadow-[0_0_8px_rgba(16,185,129,0.5)]"}),m.jsxs("span",{className:"text-[9px] font-black uppercase tracking-widest text-white/20",children:["ltima edicin: ",m.jsx("span",{className:"text-white/40",children:O.lastModified})]})]}),m.jsx("div",{className:"w-8 h-8 rounded-full bg-white/5 border border-white/10 flex items-center justify-center text-[10px] font-black text-indigo-300",children:O.initials})]})]})})]},O.filename)})]})})]}),a&&m.jsx("div",{className:"fixed bottom-8 left-1/2 -translate-x-1/2 px-6 py-3 bg-red-500/20 border border-red-500/30 text-red-200 rounded-2xl text-xs font-bold shadow-2xl animate-bounce",children:a}),m.jsx(FI,{isOpen:u,onClose:()=>c(!1),onCreate:F}),m.jsx(zI,{isOpen:!!v,onClose:()=>y(null),project:v,onUpdate:j}),m.jsx(_M,{isOpen:!!f,onClose:()=>p(null),onConfirm:D,title:"Eliminar Proyecto?",message:`Ests a punto de borrar "${f}" y todo su contenido permanentemente. Esta accin no se puede deshacer.`,confirmText:"Eliminar Universo",isDestructive:!0}),S&&m.jsx("div",{className:"fixed inset-0 z-[200] flex items-center justify-center p-6 bg-black/80 backdrop-blur-sm animate-in fade-in duration-300",children:m.jsxs("div",{className:"w-full max-w-md bg-[#0A0A0F] border border-orange-500/20 rounded-[2.5rem] overflow-hidden shadow-2xl shadow-orange-500/10 animate-in zoom-in-95 duration-500",children:[m.jsx("div",{className:"p-8 border-b border-white/5 bg-gradient-to-r from-orange-500/10 to-transparent",children:m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("div",{className:"w-12 h-12 rounded-full bg-orange-500/20 border border-orange-500/30 flex items-center justify-center",children:m.jsx("span",{className:"material-symbols-outlined text-2xl text-orange-400 animate-spin",children:"refresh"})}),m.jsxs("div",{children:[m.jsx("h2",{className:"text-xl font-black text-white",children:"Reiniciando Backend"}),m.jsxs("p",{className:"text-[10px] text-slate-500 font-bold uppercase tracking-widest",children:[T==="restarting"&&"Deteniendo servidor...",T==="checking"&&"Esperando reconexin...",T==="complete"&&"Reinicio completado!",T==="error"&&"Error en el reinicio"]})]})]})}),m.jsxs("div",{className:"p-8 space-y-6",children:[m.jsxs("div",{className:"space-y-2",children:[m.jsxs("div",{className:"flex justify-between text-xs",children:[m.jsx("span",{className:"text-slate-500 font-bold",children:"Progreso"}),m.jsxs("span",{className:"text-orange-400 font-black",children:[Math.round(E),"%"]})]}),m.jsx("div",{className:"h-2 bg-white/5 rounded-full overflow-hidden",children:m.jsx("div",{className:"h-full bg-gradient-to-r from-orange-500 to-orange-400 transition-all duration-500 ease-out",style:{width:`${E}%`}})})]}),m.jsxs("div",{className:"space-y-2 text-xs text-slate-400",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("div",{className:`w-2 h-2 rounded-full ${E>=30?"bg-green-500":"bg-slate-700"}`}),m.jsx("span",{children:"Seal de reinicio enviada"})]}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("div",{className:`w-2 h-2 rounded-full ${E>=50?"bg-green-500":"bg-slate-700"}`}),m.jsx("span",{children:"Servidor detenido"})]}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("div",{className:`w-2 h-2 rounded-full ${E>=100?"bg-green-500":E>50?"bg-orange-500 animate-pulse":"bg-slate-700"}`}),m.jsx("span",{children:"Servidor iniciado y listo"})]})]}),T==="error"&&m.jsxs("div",{className:"p-4 bg-red-500/10 border border-red-500/20 rounded-xl text-xs text-red-400",children:[m.jsx("p",{className:"font-bold",children:"Error: El servidor no respondi despus de 30 segundos."}),m.jsx("p",{className:"mt-2 text-red-300/70",children:"Por favor, reinicia manualmente desde la terminal."})]})]}),T==="complete"&&m.jsxs("div",{className:"p-6 bg-green-500/10 border-t border-green-500/20 flex items-center justify-center gap-2 text-green-400 text-sm font-bold",children:[m.jsx("span",{className:"material-symbols-outlined",children:"check_circle"}),m.jsx("span",{children:"Backend reiniciado correctamente"})]}),T==="error"&&m.jsx("div",{className:"p-6 border-t border-white/5 flex justify-end",children:m.jsx("button",{onClick:()=>{w(!1),N("idle"),_(0)},className:"px-6 py-3 rounded-2xl bg-white/5 hover:bg-white/10 text-white text-xs font-bold transition-all",children:"Cerrar"})})]})})]})},GI={save:"Guardar",saved:"Guardado",saving:"Guardando...",cancel:"Cancelar",delete:"Borrar",edit:"Editar",create:"Crear",back:"Volver",loading:"Cargando...",search:"Buscar...",no_results:"Sin resultados",confirm_delete:"Eliminar",are_you_sure:"Ests seguro de que quieres eliminar este elemento? Esta accin no se puede deshacer.",architect:"Arquitecto",confirm_delete_btn:"S, borrar",view_all:"Ver todos",rename:"Renombrar",error_delete:"Error al eliminar el elemento"},VI={dashboard:"Panel de Control",bible:"Biblia del Mundo",atlas:"Atlas",writing:"Escritura",settings:"Ajustes",logout:"Salir al Hub",chronology:"Cronologa",graph:"Grafo",languages:"Lingstica"},HI={title:"Ajustes",general:"General",appearance:"Apariencia",language:"Idioma",theme:"Tema",font:"Tipografa",font_size:"Tamao del Texto",unauthorized:"No autorizado",sync:"Sincronizacin",backup:"Respaldo",edit_template:"Editar Plantilla",available_templates:"Plantillas Disponibles",no_templates:"Sin Plantillas",is_global:"Es Global?",name:"Nombre",type:"Tipo"},WI={title:"Escritura",library:"Biblioteca del Arquitecto",library_desc:"Gestiona tus Archivadores y Crnicas",new_notebook:"Nuevo Archivador",new_page:"Nueva Hoja",index:"ndice",notes:"Notas",format:"Formato",empty:"Pgina vaca...",active_notebook:"Archivador Activo",open_archivador:"Abrir Archivador",book_title:"Ttulo del Libro",placeholder_title:"Las Crnicas del Vaco...",create_and_open:"Crear y Abrir",expansion:"Expansin de la Biblioteca",delete_confirm:"Seguro que quieres borrar este archivador? Se perdern todas sus hojas.",chapter:"Captulo",page:"Pgina",of:"de"},qI={grid_system:"Sistema de Rejilla",size:"Tamao",canvas_data:"Datos del Lienzo",width:"Ancho (px)",height:"Alto (px)",background_image:"Imagen de Fondo",upload_image:"Subir Nueva Imagen",remove_image:"Eliminar Imagen",explorer:"Explorador de Mundo",not_found:"Imagen del Mapa no Encontrada",upload_desc:"Sube una imagen del mapa en el editor para comenzar",fullscreen:"Pantalla Completa",share:"Compartir",inhabitants:"Habitantes Clave",related_events:"Eventos Relacionados",open_bible:"Abrir en la Biblia",place:"Lugar",capital:"Capital",new_map:"Nuevo Mapa"},$I={explore:"Explorar",explorer:"Explorador",templates:"Plantillas",drag_attributes:"Arrastrar Atributos",search_entity:"Buscar entidad...",filter_type:"Filtrar por Tipo",all:"Todos",entities:"Entidades",maps:"Mapas",timelines:"Lneas de Tiempo",new_folder:"Nueva Carpeta",new_timeline:"Nueva Lnea de Tiempo",delete_folder:"Borrar Carpeta",delete_folder_msg:"Seguro que quieres borrar esta carpeta y todo su contenido?",delete_entity:"Borrar Entidad",delete_entity_msg:"Seguro que quieres borrar esta entidad de la Biblia?",no_favorites:"Sin favoritos an",favorites:"Favoritos",root_index:"ndice Raz",central_archive:"Archivo central de todas las entidades, cronologas y registros geogrficos del mundo.",empty_archive:"Archivo Vaco",empty_archive_desc:"Comienza creando tu primera carpeta o lnea de tiempo para organizar el conocimiento."},KI={title:"Lnea de Tiempo",add_event:"Aadir Evento",add_line:"Nueva Lnea de Tiempo",edit_event:"Editar Evento",edit_line:"Editar Lnea de Tiempo",delete_event:"Eliminar Evento",delete_line:"Eliminar Lnea de Tiempo",events_tab:"Eventos",annexes_tab:"Anexos",linked_timelines:"Lneas de Tiempo Vinculadas",available_timelines:"Lneas de Tiempo Disponibles",multiverse:"Multiverso",new_universe:"Nuevo Universo",universe_settings:"Ajustes del Universo",delete_universe_confirm:"Eliminar este universo y TODAS sus lneas de tiempo? Esta accin no se puede deshacer.",select_timeline:"Seleccionar Lnea",no_events:"Sin eventos an. Usa el panel derecho para aadir uno.",event_name:"Nombre del Evento",date_label:"Etiqueta de Fecha",order:"Orden (Sorteo)",description:"Descripcin",save_changes:"Guardar Cambios",create_event:"Crear Evento",delete_event_btn:"Eliminar Evento",annexed_desc:"Vincula otras lneas de tiempo localizadas a esta para verificar la consistencia cronolgica.",no_linked:"Sin lneas vinculadas.",available_to_link:"Disponibles para Vincular",no_available:"No hay otras lneas disponibles.",universe_name:"Nombre del Universo",universe_desc:"Contexto para este universo...",add_timeline_here:"Aadir Lnea de Tiempo aqu",no_timelines:"No hay lneas aqu"},ZI={title:"Lingstica",lexicon:"Lxico",grammar:"Reglas de Gramtica",writing_system:"Sistema de Escritura",phonology:"Fonologa",translator:"Traductor",new_word:"Aadir Nueva Palabra",new_rule:"Definir Nueva Regla",open_editor:"Abrir Editor",auto_saved:"Auto-guardado",desc:"Una lengua perteneciente a {{projectName}}. Gestiona su lxico, reglas gramaticales y sistemas de escritura aqu.",stats:{words:"Palabras",rules:"Reglas",glyphs:"Glifos"},search_lexicon:"Buscar palabra o significado...",manage:"Gestionar",moon_script:"Escritura Lunar",inventory:"Inventario de Vocales",vectors:"Smbolos Vectoriales",upload_svg:"Subir SVG",live_stream:"Flujo Logogrfico en Vivo",rendered_output:"Salida Renderizada",source_text:"Texto de origen aqu..."},YI={dashboard_desc:"Panel de Control del Proyecto",welcome:"Bienvenido,",welcome_desc:"Tu mundo est esperando ser esculpido. Utiliza el Codex para documentar entidades, el Atlas para trazar geografas o las Crnicas para escribir su historia.",codex_title:"Codex",codex_desc:"Biblia del Mundo y Base de Datos de Entidades",atlas_title:"Atlas",atlas_desc:"Cartografa y Geografa Interactiva",chronicles_title:"Crnicas",chronicles_desc:"Escritura Narrativa y Gestin de Cuadernos",graph_title:"Grafo",graph_desc:"Visualizacin de Conexiones y Relaciones",timeline_title:"Cronologa",timeline_desc:"Lneas de Tiempo y Eventos Histricos",linguistics_title:"Lingstica",linguistics_desc:"Creacin de Lenguas y Glifos",explore_tool:"Explorar Herramienta"},XI={common:GI,nav:VI,settings:HI,writing:WI,atlas:qI,bible:$I,timeline:KI,linguistics:ZI,project:YI},QI={save:"Save",saved:"Saved",saving:"Saving...",cancel:"Cancel",delete:"Delete",edit:"Edit",create:"Create",back:"Back",loading:"Loading...",search:"Search...",no_results:"No results",confirm_delete:"Delete",are_you_sure:"Are you sure you want to delete this item? This action cannot be undone.",architect:"Architect",confirm_delete_btn:"Yes, delete",view_all:"View All",rename:"Rename",error_delete:"Error deleting item"},JI={dashboard:"Dashboard",bible:"World Bible",atlas:"Atlas",writing:"Writing",settings:"Settings",logout:"Exit to Hub",chronology:"Chronology",graph:"Graph",languages:"Linguistics"},ej={title:"Settings",general:"General",appearance:"Appearance",language:"Language",theme:"Theme",font:"Typography",font_size:"Font Size",unauthorized:"Unauthorized",sync:"Synchronization",backup:"Backup",edit_template:"Edit Template",available_templates:"Available Templates",no_templates:"No Templates",is_global:"Is Global?",name:"Name",type:"Type"},tj={title:"Writing",library:"Architect's Library",library_desc:"Manage your Archives and Chronicles",new_notebook:"New Archivador",new_page:"New Page",index:"Index",notes:"Notes",format:"Format",empty:"Empty page...",active_notebook:"Active Archivador",open_archivador:"Open Archivador",book_title:"Book Title",placeholder_title:"The Chronicles of the Void...",create_and_open:"Create and Open",expansion:"Library Expansion",delete_confirm:"Are you sure you want to delete this archivador? All its pages will be lost.",chapter:"Chapter",page:"Page",of:"of"},rj={grid_system:"Grid System",size:"Size",canvas_data:"Canvas Data",width:"Width (px)",height:"Height (px)",background_image:"Background Image",upload_image:"Upload New Image",remove_image:"Remove Image",explorer:"World Explorer",not_found:"Map Image Not Found",upload_desc:"Upload a map image in the editor to get started",fullscreen:"Fullscreen",share:"Share",inhabitants:"Key Inhabitants",related_events:"Related Events",open_bible:"Open in Bible",place:"Place",capital:"Capital",new_map:"New Map"},nj={explore:"Explore",explorer:"Explorer",templates:"Templates",drag_attributes:"Drag Attributes",search_entity:"Search entity...",filter_type:"Filter by Type",all:"All",entities:"Entities",maps:"Maps",timelines:"Timelines",new_folder:"New Folder",new_timeline:"New Timeline",delete_folder:"Delete Folder",delete_folder_msg:"Are you sure you want to delete this folder and all its contents?",delete_entity:"Delete Entity",delete_entity_msg:"Are you sure you want to delete this entity from the Bible?",no_favorites:"No favorites yet",favorites:"Favorites",root_index:"Root Index",central_archive:"Central archive of all entities, timelines, and world geographical records.",empty_archive:"Empty Archive",empty_archive_desc:"Start by creating your first folder or timeline to organize knowledge."},ij={title:"Timeline",add_event:"Add Event",add_line:"New Timeline",edit_event:"Edit Event",edit_line:"Edit Timeline",delete_event:"Delete Event",delete_line:"Delete Timeline",events_tab:"Events",annexes_tab:"Annexes",linked_timelines:"Linked Timelines",available_timelines:"Available Timelines",multiverse:"Multiverse",new_universe:"New Universe",universe_settings:"Universe Settings",delete_universe_confirm:"Delete this universe and ALL its timelines? This cannot be undone.",select_timeline:"Select Timeline",no_events:"No events yet. Use the right panel to add one.",event_name:"Event Name",date_label:"Date Label",order:"Order (Sort)",description:"Description",save_changes:"Save Changes",create_event:"Create Event",delete_event_btn:"Delete Event",annexed_desc:"Link other localized timelines to this one to verify chronological consistency.",no_linked:"No linked timelines.",available_to_link:"Available to Link",no_available:"No other timelines available.",universe_name:"Universe Name",universe_desc:"Context for this universe...",add_timeline_here:"Add Timeline here",no_timelines:"No timelines here"},aj={title:"Linguistics",lexicon:"Lexicon",grammar:"Grammar Rules",writing_system:"Writing System",phonology:"Phonology",translator:"Translator",new_word:"Add New Word",new_rule:"Define New Rule",open_editor:"Open Editor",auto_saved:"Auto-Saved",desc:"A conlang belonging to {{projectName}}. Manage its lexicon, grammar rules, and writing systems here.",stats:{words:"Words",rules:"Rules",glyphs:"Glyphs"},search_lexicon:"Search word or meaning...",manage:"Manage",moon_script:"Moon Script",inventory:"Vowel Inventory",vectors:"Vector Symbols",upload_svg:"Upload SVG",live_stream:"Live Logographic Stream",rendered_output:"Rendered Output",source_text:"Source text here..."},sj={dashboard_desc:"Project Dashboard",welcome:"Welcome,",welcome_desc:"Your world is waiting to be shaped. Use the Codex to document entities, the Atlas to map out geographies, or the Chronicles to write its history.",codex_title:"Codex",codex_desc:"World Bible and Entity Database",atlas_title:"Atlas",atlas_desc:"Interactive Cartography and Geography",chronicles_title:"Chronicles",chronicles_desc:"Narrative Writing and Notebook Management",graph_title:"Graph",graph_desc:"Visualization of Connections and Relations",timeline_title:"Chronology",timeline_desc:"Timelines and Historical Events",linguistics_title:"Linguistics",linguistics_desc:"Conlang Creation and Glyphs",explore_tool:"Explore Tool"},oj={common:QI,nav:JI,settings:ej,writing:tj,atlas:rj,bible:nj,timeline:ij,linguistics:aj,project:sj},CM=ae.createContext(),lj={es:XI,en:oj},uj=({children:t})=>{const[e,r]=ae.useState(()=>{const a=localStorage.getItem("app_settings");if(a)try{return JSON.parse(a).language||"es"}catch{return"es"}return"es"}),n=a=>{const s=a.split(".");let o=lj[e];for(const l of s)if(o&&o[l])o=o[l];else return a;return o},i=a=>{r(a);const s=localStorage.getItem("app_settings");let o={};if(s)try{o=JSON.parse(s)}catch{}localStorage.setItem("app_settings",JSON.stringify({...o,language:a}))};return m.jsx(CM.Provider,{value:{language:e,t:n,changeLanguage:i},children:t})},Ps=()=>{const t=ae.useContext(CM);if(!t)throw new Error("useLanguage must be used within a LanguageProvider");return t},dp=({icon:t,title:e,desc:r,color:n,onClick:i,t:a})=>m.jsxs("div",{onClick:i,className:"group relative p-8 rounded-[32px] bg-surface-dark border border-white/5 hover:border-white/10 transition-all cursor-pointer flex flex-col h-full gap-6 hover:shadow-2xl hover:shadow-black/40",children:[m.jsx("div",{className:`size-14 rounded-2xl ${n} flex items-center justify-center text-white shadow-lg group-hover:scale-110 transition-all duration-500`,children:m.jsx("span",{className:"material-symbols-outlined text-3xl",children:t})}),m.jsxs("div",{className:"space-y-4",children:[m.jsx("h3",{className:"text-2xl font-bold text-white tracking-tight",children:e}),m.jsx("p",{className:"text-slate-500 text-sm leading-relaxed",children:r})]}),m.jsxs("div",{className:"mt-auto pt-6 border-t border-white/5 flex items-center justify-between text-[10px] font-black uppercase tracking-widest text-slate-500 group-hover:text-white transition-colors",children:[m.jsx("span",{children:a("project.explore_tool")}),m.jsx("span",{className:"material-symbols-outlined text-sm group-hover:translate-x-1 transition-transform",children:"arrow_forward"})]})]}),cj=()=>{const{projectName:t}=nl(),e=Va(),{username:r}=qi(),{t:n}=Ps(),i=`/${r}/${t}`,[a,s]=nr.useState(null);return nr.useEffect(()=>{const o=localStorage.getItem("user");o&&o!=="undefined"&&s(JSON.parse(o))},[]),m.jsxs("div",{className:"flex-1 flex flex-col h-screen overflow-hidden bg-background-dark",children:[m.jsxs("div",{className:"h-20 border-b border-white/5 flex items-center justify-between px-12 bg-surface-dark/20 backdrop-blur-xl shrink-0",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("div",{className:"size-10 rounded-xl bg-primary/20 flex items-center justify-center text-primary shadow-lg shadow-primary/10",children:m.jsx("span",{className:"material-symbols-outlined",children:"auto_stories"})}),m.jsxs("div",{children:[m.jsx("h1",{className:"text-xl font-black text-white tracking-tight uppercase",children:t}),m.jsx("p",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:n("project.dashboard_desc")})]})]}),m.jsx("div",{className:"flex items-center gap-4",children:m.jsx("div",{className:"flex -space-x-2",children:m.jsx("div",{className:"size-8 rounded-full border-2 border-surface-dark bg-indigo-500 overflow-hidden flex items-center justify-center text-[10px] font-black text-white shadow-lg",children:a?.avatarUrl?m.jsx("img",{src:a.avatarUrl,alt:"Me",className:"w-full h-full object-cover"}):m.jsx("span",{children:(a?.displayName||r)?.substring(0,2).toUpperCase()})})})})]}),m.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar",children:m.jsxs("div",{className:"max-w-7xl mx-auto p-12 space-y-16 animate-in fade-in slide-in-from-bottom-8 duration-700",children:[m.jsxs("div",{className:"space-y-4 max-w-2xl",children:[m.jsxs("h2",{className:"text-4xl font-black text-white tracking-tighter leading-tight",children:[n("project.welcome")," ",m.jsx("span",{className:"text-indigo-400",children:a?.displayName||n("common.architect")}),"."]}),m.jsx("p",{className:"text-slate-400 text-lg font-serif italic leading-relaxed opacity-80",children:n("project.welcome_desc")})]}),m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:[m.jsx(dp,{icon:"menu_book",title:n("project.codex_title"),desc:n("project.codex_desc"),color:"bg-indigo-600 shadow-indigo-500/20",onClick:()=>e(`${i}/bible`),t:n}),m.jsx(dp,{icon:"map",title:n("project.atlas_title"),desc:n("project.atlas_desc"),color:"bg-emerald-600 shadow-emerald-500/20",onClick:()=>e(`${i}/map`),t:n}),m.jsx(dp,{icon:"edit_note",title:n("project.chronicles_title"),desc:n("project.chronicles_desc"),color:"bg-amber-600 shadow-amber-500/20",onClick:()=>e(`${i}/writing`),t:n}),m.jsx(dp,{icon:"hub",title:n("project.graph_title"),desc:n("project.graph_desc"),color:"bg-purple-600 shadow-purple-500/20",onClick:()=>e(`${i}/graph`),t:n}),m.jsx(dp,{icon:"calendar_month",title:n("project.timeline_title"),desc:n("project.timeline_desc"),color:"bg-rose-600 shadow-rose-500/20",onClick:()=>e(`${i}/timeline`),t:n}),m.jsx(dp,{icon:"translate",title:n("project.linguistics_title"),desc:n("project.linguistics_desc"),color:"bg-blue-600 shadow-blue-500/20",onClick:()=>e(`${i}/linguistics`),t:n})]})]})})]})},dj=()=>{const t=Va(),[e,r]=ae.useState(null),[n,i]=ae.useState([]),[a,s]=ae.useState([]),[o,l]=ae.useState("general"),[u,c]=ae.useState([]),[f,p]=ae.useState({theme:"deep_space",font:"Outfit",fontSize:16});ae.useEffect(()=>{try{const D=localStorage.getItem("user");D&&D!=="undefined"&&r(JSON.parse(D));const j=localStorage.getItem("app_settings");j&&p(JSON.parse(j));const B=localStorage.getItem("sync_projects");B&&s(JSON.parse(B)),v()}catch(D){console.error("Failed to parse user settings",D)}},[]);const v=async()=>{try{const D=await et.get("/workspaces");D&&i(D)}catch(D){console.error("Error loading projects for sync",D)}},y=(D,j="success")=>{const B=Date.now();c(G=>[...G,{id:B,message:D,type:j}]),setTimeout(()=>{c(G=>G.filter(K=>K.id!==B))},3e3)},S=(D,j)=>{const B={...f,[D]:j};p(B),localStorage.setItem("app_settings",JSON.stringify(B)),window.dispatchEvent(new Event("storage_update")),y(`Ajuste actualizado: ${D}`)},w=D=>{const j=a.includes(D),B=j?a.filter(G=>G!==D):[...a,D];s(B),localStorage.setItem("sync_projects",JSON.stringify(B)),y(j?"Universo desmarcado de sincronizacin":"Universo incluido en sincronizacin")},E=()=>{y("Iniciando descarga de backup...","info");const D=document.createElement("a"),j="/api/backup/download",B=a.length>0?`?projects=${a.join(",")}`:"";D.href=j+B,D.setAttribute("download",`worldbuilding_backup_${Date.now()}.zip`),document.body.appendChild(D),D.click(),document.body.removeChild(D)},_=nr.useRef(null),T=async D=>{const j=D.target.files[0];if(!j)return;if(!j.name.endsWith(".db")){y("Solo se permiten archivos .db","error");return}const B=new FormData;B.append("file",j),y("Importando universo...","info");try{const G=await et.post("/import/database",B);y(G.message||"Universo importado con xito"),v()}catch(G){console.error("Import error",G);const K=G.response?.data?.error||"Error al importar el archivo";y(K,"error")}_.current&&(_.current.value="")},N=D=>{const j=D.target.files[0];if(!j)return;if(j.size>1024*1024){y("Imagen demasiado grande (mx 1MB)","error");return}const B=new FileReader;B.onload=G=>{const K=G.target.result,O={...e||{},avatarUrl:K};r(O);try{localStorage.setItem("user",JSON.stringify(O)),y("Foto de perfil actualizada","success")}catch(W){y("Error al guardar imagen (memoria llena)","error"),console.error("Storage error",W)}},B.readAsDataURL(j)},R=(D,j)=>{const B={...e||{},[D]:j};r(B),localStorage.setItem("user",JSON.stringify(B)),window.dispatchEvent(new Event("storage_update"))},I=[{id:"general",label:"General / Sincro",icon:"person"},{id:"appearance",label:"Apariencia y Editor",icon:"palette"}],F=[{id:"deep_space",label:"Deep Space",color:"#0f172a"},{id:"nebula",label:"Nebula",color:"#312e81"},{id:"high_contrast",label:"High Contrast",color:"#000000"}];return m.jsxs("div",{className:"flex flex-col w-full h-full bg-[#050508] text-white font-sans overflow-hidden relative",children:[m.jsxs("div",{className:"absolute inset-0 pointer-events-none overflow-hidden opacity-50",children:[m.jsx("div",{className:"absolute -top-[10%] -left-[10%] size-[40%] bg-indigo-500/10 blur-[120px] rounded-full animate-pulse"}),m.jsx("div",{className:"absolute -bottom-[10%] -right-[10%] size-[40%] bg-purple-500/5 blur-[120px] rounded-full animate-pulse",style:{animationDelay:"1s"}})]}),m.jsx("div",{className:"fixed top-24 right-8 z-[100] flex flex-col gap-3",children:u.map(D=>m.jsxs("div",{className:"flex items-center gap-3 px-6 py-4 bg-surface-dark border border-white/10 rounded-2xl shadow-2xl animate-slide-in-right",children:[m.jsx("span",{className:`material-symbols-outlined ${D.type==="success"?"text-green-400":"text-indigo-400"}`,children:D.type==="success"?"check_circle":"info"}),m.jsx("span",{className:"text-sm font-bold",children:D.message})]},D.id))}),m.jsxs("header",{className:"h-20 flex-none flex items-center justify-between px-12 border-b border-white/5 bg-[#0a0a0e] z-30",children:[m.jsxs("div",{className:"flex items-center gap-8",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("div",{className:"size-10 rounded-xl bg-indigo-500 flex items-center justify-center text-white shadow-lg shadow-indigo-500/20",children:m.jsx("span",{className:"material-symbols-outlined text-2xl",children:"settings"})}),m.jsx("h1",{className:"text-xl font-bold tracking-tight hidden sm:block",children:"Ajustes"})]}),m.jsx("nav",{className:"flex items-center gap-2 p-1 bg-white/5 rounded-2xl",children:I.map(D=>m.jsxs("button",{onClick:()=>l(D.id),className:`flex items-center gap-2 px-5 py-2.5 rounded-xl text-xs font-bold transition-all ${o===D.id?"bg-indigo-500 text-white shadow-lg shadow-indigo-500/20":"text-slate-400 hover:text-white hover:bg-white/5"}`,children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:D.icon}),D.label]},D.id))})]}),m.jsxs("button",{onClick:()=>t(-1),className:"flex items-center gap-2 px-6 py-2.5 bg-white/5 hover:bg-white/10 border border-white/10 rounded-2xl transition-all text-xs font-bold text-slate-400 hover:text-white",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"arrow_back"}),m.jsx("span",{children:"Volver"})]})]}),m.jsx("main",{className:"flex-1 overflow-y-auto p-12 custom-scrollbar",children:m.jsxs("div",{className:"max-w-3xl mx-auto pb-24 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[o==="general"&&m.jsxs("div",{className:"space-y-6",children:[m.jsxs("section",{className:"bg-[#0f0f13] border border-white/5 rounded-3xl p-8",children:[m.jsxs("h3",{className:"text-lg font-bold mb-6 flex items-center gap-2 text-indigo-400",children:[m.jsx("span",{className:"material-symbols-outlined",children:"person"}),"Perfil de Arquitecto"]}),m.jsxs("div",{className:"flex items-center gap-6 p-6 bg-white/5 rounded-3xl border border-white/5 group relative overflow-hidden",children:[m.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-indigo-500/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none"}),m.jsxs("div",{className:"relative",children:[m.jsx("div",{className:"size-20 rounded-full bg-indigo-500 flex items-center justify-center text-white text-3xl font-black shadow-2xl border-4 border-white/10 overflow-hidden",children:e?.avatarUrl?m.jsx("img",{src:e.avatarUrl,alt:"Profile",className:"w-full h-full object-cover"}):e?.displayName?.substring(0,2).toUpperCase()||e?.username?.substring(0,2).toUpperCase()||"AR"}),m.jsxs("label",{className:"absolute -bottom-1 -right-1 size-8 bg-indigo-500 rounded-full flex items-center justify-center text-white cursor-pointer hover:scale-110 transition-all border-4 border-[#0f0f13] shadow-lg",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"photo_camera"}),m.jsx("input",{type:"file",accept:"image/*",onChange:N,className:"hidden"})]})]}),m.jsxs("div",{className:"flex-1 space-y-2",children:[m.jsx("input",{type:"text",value:e?.displayName??"",onChange:D=>R("displayName",D.target.value),placeholder:e?.username||"Tu nombre de arquitecto...",className:"bg-transparent border-none text-2xl font-black text-white outline-none focus:ring-0 w-full p-0 placeholder-white/20"}),m.jsx("p",{className:"text-[10px] font-black uppercase tracking-widest text-indigo-400",children:"Architect Rank  Local Session"})]})]})]}),m.jsxs("section",{className:"bg-[#0f0f13] border border-white/5 rounded-3xl p-8 space-y-6",children:[m.jsxs("div",{className:"flex justify-between items-center",children:[m.jsxs("h3",{className:"text-lg font-bold flex items-center gap-2 text-indigo-400",children:[m.jsx("span",{className:"material-symbols-outlined",children:"sync_lock"}),"Sincronizacin y Respaldo"]}),m.jsxs("div",{className:"flex gap-3",children:[m.jsx("input",{type:"file",ref:_,onChange:T,accept:".db",className:"hidden"}),m.jsxs("button",{onClick:()=>_.current?.click(),className:"flex items-center gap-2 px-6 py-3 border border-white/5 bg-white/5 hover:bg-white/10 text-white rounded-2xl text-xs font-black uppercase tracking-widest transition-all",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"upload_file"}),"Importar Universo"]}),m.jsxs("button",{onClick:E,className:"flex items-center gap-2 px-6 py-3 bg-indigo-500 hover:bg-indigo-600 text-white rounded-2xl text-xs font-black uppercase tracking-widest transition-all shadow-lg shadow-indigo-500/30",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"cloud_download"}),"Descargar Backup ZIP"]})]})]}),m.jsxs("div",{className:"space-y-4",children:[m.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-slate-500 block",children:"Universos para sincronizacin"}),m.jsx("div",{className:"grid grid-cols-2 gap-3",children:n.length>0?n.map(D=>m.jsxs("button",{onClick:()=>w(D.filename),className:`flex items-center gap-3 p-4 rounded-2xl border transition-all text-left ${a.includes(D.filename)?"border-indigo-500 bg-indigo-500/10 text-white":"border-white/5 bg-black/20 text-slate-400 hover:border-white/10"}`,children:[m.jsx("span",{className:"material-symbols-outlined text-lg",children:a.includes(D.filename)?"check_circle":"circle"}),m.jsx("div",{className:"truncate",children:m.jsx("p",{className:"text-xs font-bold truncate",children:D.title})})]},D.filename)):m.jsx("div",{className:"col-span-2 p-8 border border-dashed border-white/5 rounded-2xl text-center text-slate-600 text-xs italic text-glass-muted",children:"No hay universos detectados..."})})]})]})]}),o==="appearance"&&m.jsxs("div",{className:"space-y-6",children:[m.jsxs("section",{className:"bg-[#0f0f13] border border-white/5 rounded-3xl p-8",children:[m.jsxs("h3",{className:"text-lg font-bold mb-6 flex items-center gap-2 text-indigo-400",children:[m.jsx("span",{className:"material-symbols-outlined",children:"palette"}),"Esttica del Sistema"]}),m.jsx("div",{className:"grid grid-cols-3 gap-6",children:F.map(D=>m.jsxs("button",{onClick:()=>S("theme",D.id),className:`relative flex flex-col gap-3 group text-left transition-all p-3 rounded-2xl border ${f.theme===D.id?"border-indigo-500 bg-indigo-500/5 ring-1 ring-indigo-500/50":"border-white/5 bg-black/20 hover:border-white/20"}`,children:[m.jsx("div",{className:"h-24 rounded-xl flex items-center justify-center overflow-hidden",style:{backgroundColor:D.color},children:m.jsx("div",{className:"size-10 rounded-full bg-white/10 backdrop-blur-xl border border-white/10"})}),m.jsx("span",{className:"text-xs font-bold text-center",children:D.label})]},D.id))})]}),m.jsxs("section",{className:"bg-[#0f0f13] border border-white/5 rounded-3xl p-8",children:[m.jsxs("h3",{className:"text-lg font-bold mb-6 flex items-center gap-2 text-indigo-400",children:[m.jsx("span",{className:"material-symbols-outlined",children:"text_fields"}),"Tipografa y Lectura"]}),m.jsxs("div",{className:"grid grid-cols-2 gap-12",children:[m.jsxs("div",{className:"space-y-4",children:[m.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-slate-500",children:"Fuente del Codex"}),m.jsxs("div",{className:"relative",children:[m.jsxs("select",{value:f.font,onChange:D=>S("font",D.target.value),className:"w-full bg-[#0f0f13] border border-white/10 rounded-xl px-5 py-3.5 text-sm text-white appearance-none outline-none focus:border-indigo-500 transition-all",style:{fontFamily:f.font},children:[m.jsx("option",{value:"Lexend",className:"bg-[#0f0f13] text-white",children:"Lexend (UI Moderna)"}),m.jsx("option",{value:"Outfit",className:"bg-[#0f0f13] text-white",children:"Outfit (Sleek)"}),m.jsx("option",{value:"Cormorant Garamond",className:"bg-[#0f0f13] text-white",children:"Cormorant (Legendaria)"}),m.jsx("option",{value:"Playfair Display",className:"bg-[#0f0f13] text-white",children:"Playfair (Elegante)"}),m.jsx("option",{value:"JetBrains Mono",className:"bg-[#0f0f13] text-white",children:"JetBrains Mono (Codex)"})]}),m.jsx("span",{className:"material-symbols-outlined absolute right-4 top-1/2 -translate-y-1/2 pointer-events-none text-slate-500",children:"expand_more"})]})]}),m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{className:"flex justify-between items-center",children:[m.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-slate-500",children:"Tamao del Texto"}),m.jsxs("span",{className:"text-xs font-bold text-indigo-400",children:[f.fontSize,"px"]})]}),m.jsx("div",{className:"flex items-center gap-4 py-3",children:m.jsx("input",{type:"range",min:"12",max:"24",value:f.fontSize,onChange:D=>S("fontSize",parseInt(D.target.value)),className:"flex-1 accent-indigo-500 h-1 bg-white/10 rounded-full appearance-none cursor-pointer"})})]})]}),m.jsxs("div",{className:"mt-12 space-y-4 border-t border-white/5 pt-8",children:[m.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-slate-500",children:"Preferencia de Idioma / Language"}),m.jsxs("div",{className:"flex gap-4",children:[m.jsxs("button",{onClick:()=>S("language","es"),className:`flex-1 py-4 rounded-2xl border transition-all flex items-center justify-center gap-3 font-bold text-xs ${f.language==="es"||!f.language?"border-primary bg-primary/10 text-white shadow-lg":"border-white/5 bg-black/20 text-slate-400"}`,children:[m.jsx("span",{className:"text-xl",children:""}),"Castellano"]}),m.jsxs("button",{onClick:()=>S("language","en"),className:`flex-1 py-4 rounded-2xl border transition-all flex items-center justify-center gap-3 font-bold text-xs ${f.language==="en"?"border-primary bg-primary/10 text-white shadow-lg":"border-white/5 bg-black/20 text-slate-400"}`,children:[m.jsx("span",{className:"text-xl",children:""}),"English"]})]})]}),m.jsx("div",{className:"mt-8 p-6 bg-black/40 rounded-2xl border border-white/5 text-center shadow-inner",children:m.jsx("p",{style:{fontFamily:f.font,fontSize:`${f.fontSize}px`},className:"text-slate-200 transition-all duration-300",children:'"El universo es un libro escrito en el lenguaje de las historias."'})})]})]})]})})]})},b1=({isOpen:t,onClose:e,onConfirm:r,title:n,message:i,confirmText:a="Confirmar",cancelText:s="Cancelar",type:o="danger"})=>t?xo.createPortal(m.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[m.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",onClick:e}),m.jsxs("div",{className:"relative w-full max-w-md bg-[#0a0a0c] border border-white/10 rounded-3xl shadow-2xl p-6 animate-in zoom-in-95 duration-200 overflow-hidden",children:[m.jsx("div",{className:"absolute top-0 left-0 right-0 h-32 bg-gradient-to-b from-white/5 to-transparent pointer-events-none"}),m.jsxs("div",{className:"relative z-10 text-center",children:[m.jsx("div",{className:`mx-auto mb-4 size-16 rounded-2xl flex items-center justify-center ${o==="danger"?"bg-red-500/10 text-red-500":"bg-yellow-500/10 text-yellow-500"}`,children:m.jsx("span",{className:"material-symbols-outlined text-3xl",children:o==="danger"?"delete_forever":"warning"})}),m.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:n}),m.jsx("p",{className:"text-text-muted text-sm mb-8 leading-relaxed",children:i}),m.jsxs("div",{className:"flex gap-3",children:[m.jsx("button",{onClick:e,className:"flex-1 px-4 py-3 rounded-xl bg-surface-light hover:bg-white/10 text-text-muted hover:text-white text-xs font-bold transition-all border border-white/5",children:s}),m.jsx("button",{onClick:()=>{r(),e()},className:`flex-1 px-4 py-3 rounded-xl text-white text-xs font-bold transition-all shadow-lg flex items-center justify-center gap-2
                                ${o==="danger"?"bg-red-500 hover:bg-red-600 shadow-red-500/20":"bg-primary hover:bg-primary-light shadow-primary/20"}`,children:m.jsx("span",{children:a})})]})]})]})]}),document.body):null,fj=t=>{const e=`notebooks_v2_${t}`,[r,n]=ae.useState(()=>{const a=localStorage.getItem(e);return a?JSON.parse(a):[]});return[r,a=>{n(a),localStorage.setItem(e,JSON.stringify(a))}]},hj=({projectId:t})=>{const{t:e}=Ps(),[r,n]=fj(t||"global"),[i,a]=ae.useState(null),[s,o]=ae.useState(null),[l,u]=ae.useState(null),c=()=>{const v={id:Date.now().toString(),title:"Nuevo Cuaderno",content:"",updatedAt:new Date().toISOString()};n([v,...r]),o(v.id)},f=(v,y,S)=>{const w=r.map(E=>E.id===v?{...E,[y]:S,updatedAt:new Date().toISOString()}:E);n(w),i&&i.id===v&&a({...i,[y]:S})},p=()=>{l&&(n(r.filter(v=>v.id!==l)),i&&i.id===l&&a(null),u(null))};return i?m.jsxs("div",{className:"flex flex-col h-full bg-surface-dark/50 animate-in slide-in-from-right-4 duration-300",children:[m.jsxs("div",{className:"flex items-center gap-2 p-3 border-b border-white/5 bg-white/[0.02]",children:[m.jsx("button",{onClick:()=>a(null),className:"p-1.5 rounded-lg hover:bg-white/10 text-slate-400 hover:text-white transition-colors",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"arrow_back"})}),m.jsx("input",{className:"bg-transparent border-none outline-none font-bold text-white text-sm w-full placeholder-slate-600",value:i.title,onChange:v=>f(i.id,"title",v.target.value),placeholder:"Ttulo del Cuaderno..."})]}),m.jsx("textarea",{className:"flex-1 w-full bg-transparent p-4 text-sm text-slate-300 outline-none resize-none custom-scrollbar leading-relaxed",placeholder:"Escribe aqu tus ideas...",value:i.content||"",onChange:v=>f(i.id,"content",v.target.value),autoFocus:!0}),m.jsx("div",{className:"p-2 text-[10px] text-slate-600 text-right border-t border-white/5",children:i.updatedAt?`Guardado: ${new Date(i.updatedAt).toLocaleTimeString()}`:"Sin guardar"})]}):m.jsxs("div",{className:"flex flex-col h-full bg-surface-dark/50",children:[m.jsxs("div",{className:"flex items-center justify-between p-3 border-b border-white/5 bg-white/[0.02]",children:[m.jsx("h3",{className:"text-xs font-black uppercase tracking-widest text-slate-400",children:"Tus Cuadernos"}),m.jsxs("button",{onClick:c,className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-primary/20 text-primary hover:bg-primary/30 transition-all text-[10px] font-bold uppercase tracking-wide border border-primary/20",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"add"}),"Nuevo"]})]}),m.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-3 space-y-2",children:r.length===0?m.jsxs("div",{className:"flex flex-col items-center justify-center py-10 text-slate-600 space-y-2 opacity-60",children:[m.jsx("span",{className:"material-symbols-outlined text-3xl",children:"library_books"}),m.jsx("p",{className:"text-xs",children:"No hay cuadernos"})]}):r.map(v=>m.jsxs("div",{onClick:()=>a(v),className:"group relative bg-white/5 hover:bg-white/10 border border-white/5 hover:border-primary/30 rounded-xl p-3 cursor-pointer transition-all hover:translate-x-1",children:[m.jsxs("div",{className:"flex justify-between items-start mb-2",children:[s===v.id?m.jsx("input",{className:"bg-black/50 border border-primary/50 text-white text-xs font-bold rounded px-1 outline-none w-full mr-6",value:v.title,onChange:y=>f(v.id,"title",y.target.value),onBlur:()=>o(null),onKeyDown:y=>y.key==="Enter"&&o(null),autoFocus:!0,onClick:y=>y.stopPropagation()}):m.jsx("h4",{className:"text-xs font-bold text-white truncate pr-6",children:v.title}),m.jsx("button",{onClick:y=>{y.stopPropagation(),u(v.id)},className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 p-1 hover:text-red-400 text-slate-500 transition-all bg-surface-dark rounded-md",children:m.jsx("span",{className:"material-symbols-outlined text-[14px]",children:"delete"})})]}),m.jsx("p",{className:"text-[10px] text-slate-500 line-clamp-2",children:v.content||"Sin contenido..."})]},v.id))}),m.jsx(b1,{isOpen:!!l,onClose:()=>u(null),onConfirm:p,title:"Eliminar Cuaderno",message:"Ests seguro? Esta accin no se puede deshacer.",confirmText:"Eliminar",type:"danger"})]})},pj=({isOpen:t,onClose:e,contextContent:r,projectId:n,activeTab:i,setActiveTab:a})=>{const{t:s}=Ps();return nr.useEffect(()=>{r&&a("CONTEXT")},[r]),m.jsxs("aside",{className:`
                fixed top-0 right-0 h-full bg-surface-dark border-l border-glass-border shadow-2xl z-40 transition-all duration-500 ease-in-out flex flex-col
                ${t?"w-96 translate-x-0":"w-96 translate-x-full"}
            `,children:[m.jsxs("div",{className:"flex items-center border-b border-glass-border bg-white/[0.02]",children:[m.jsxs("button",{onClick:()=>a("CONTEXT"),className:`flex-1 py-4 flex items-center justify-center gap-2 text-xs font-black uppercase tracking-widest transition-colors relative ${i==="CONTEXT"?"text-primary":"text-slate-500 hover:text-white"}`,children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"view_sidebar"}),"Contexto",i==="CONTEXT"&&m.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-primary"})]}),m.jsxs("button",{onClick:()=>a("NOTEBOOKS"),className:`flex-1 py-4 flex items-center justify-center gap-2 text-xs font-black uppercase tracking-widest transition-colors relative ${i==="NOTEBOOKS"?"text-primary":"text-slate-500 hover:text-white"}`,children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"book"}),"Cuadernos",i==="NOTEBOOKS"&&m.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-primary"})]}),m.jsx("button",{onClick:e,className:"p-4 text-slate-500 hover:text-white transition-colors border-l border-white/5",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"close_fullscreen"})})]}),m.jsxs("div",{className:"flex-1 overflow-hidden relative bg-black/20",children:[m.jsx("div",{className:`absolute inset-0 transition-opacity duration-300 flex flex-col ${i==="CONTEXT"?"opacity-100 z-10":"opacity-0 z-0 pointer-events-none"}`,children:r||m.jsx("div",{id:"global-right-panel-portal",className:"h-full flex flex-col relative"})}),m.jsx("div",{className:`absolute inset-0 transition-opacity duration-300 flex flex-col ${i==="NOTEBOOKS"?"opacity-100 z-10":"opacity-0 z-0 pointer-events-none"}`,children:m.jsx(hj,{projectId:n})})]})]})},gd=({to:t,icon:e,label:r,collapsed:n,end:i})=>m.jsxs(eI,{to:t,end:i,className:({isActive:a})=>`
            flex items-center gap-3 px-3 py-2.5 rounded-xl transition-all group
            ${a?"bg-primary text-white shadow-lg shadow-primary/20":"text-text-muted hover:text-white hover:bg-white/5"}
            ${n?"justify-center":""}
        `,title:n?r:"",children:[m.jsx("span",{className:"material-symbols-outlined text-xl",children:e}),!n&&m.jsx("span",{className:"text-sm font-bold tracking-wide",children:r})]}),mj=()=>{console.log("ArchitectLayout Mounting");const{username:t,projectName:e,folderSlug:r}=qi(),n=Va(),{t:i}=Ps(),a=Nh(),[s,o]=ae.useState(!0),[l,u]=ae.useState(!1),[c,f]=ae.useState("Loading..."),[p,v]=ae.useState(null),[y,S]=ae.useState(null),[w,E]=ae.useState("NOTEBOOKS"),[_,T]=ae.useState({name:"",description:"",type:"regional",showGrid:!0,gridSize:50,width:800,height:600,bgImage:null}),[N,R]=ae.useState(null),I=se=>{S(se),se&&u(!0)},[F,D]=ae.useState("identity"),[j,B]=ae.useState("notes"),[G,K]=ae.useState(""),[O,W]=ae.useState("ALL");a.pathname.includes("/bible"),a.pathname.includes("/writing");const[U,q]=ae.useState("index");a.pathname.includes("/languages");const[Z,Q]=ae.useState(null),[ne,re]=ae.useState([]),[Y,J]=ae.useState("identity"),[ie,de]=ae.useState(null),he=async()=>{if(ie){try{await et.delete(`/world-bible/templates/${ie}`),setAvailableTemplates(se=>se.filter(ye=>ye.id!==ie))}catch(se){console.error("Delete failed",se)}de(null)}},xe=async se=>{se.preventDefault();try{await et.put(`/world-bible/templates/${Z.id}`,Z),setAvailableTemplates(ye=>ye.map(Se=>Se.id===Z.id?Z:Se)),Q(null)}catch(ye){console.error("Update failed",ye)}},le=`/${t}/${e}`;ae.useEffect(()=>{e&&fe(e);const se=()=>{e&&fe(e)};return window.addEventListener("focus",se),()=>window.removeEventListener("focus",se)},[e]);const fe=async se=>{try{const ye=await et.get(`/proyectos/${se}`);ye&&(f(ye.nombreProyecto),v(ye.id))}catch(ye){console.error("Error loading project:",ye),f("Error"),n("/")}},[ve,ge]=ae.useState(null);return ae.useEffect(()=>{const se=localStorage.getItem("user");se&&se!=="undefined"&&ge(JSON.parse(se))},[]),m.jsxs("div",{className:"flex h-screen w-full overflow-hidden bg-background-dark text-text-main font-sans selection:bg-primary/30",children:[m.jsxs("aside",{className:`
                    flex-none bg-surface-dark border-r border-glass-border transition-all duration-500 relative flex flex-col z-30
                    ${s?"w-80":"w-20"}
                `,children:[m.jsxs("div",{className:"h-16 flex items-center justify-center border-b border-glass-border relative",children:[s?m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("div",{className:"size-8 rounded-lg bg-surface-light flex items-center justify-center text-primary shadow-inner",children:m.jsx("span",{className:"material-symbols-outlined",children:a.pathname.includes("/writing")?"edit_note":a.pathname.includes("/graph")?"hub":a.pathname.includes("/bible")?"auto_stories":a.pathname.includes("/map")?"map":a.pathname.includes("/timeline")?"timeline":a.pathname.includes("/languages")?"translate":"auto_stories"})}),m.jsx("h2",{className:"text-sm font-black uppercase tracking-widest text-white truncate max-w-[150px]",children:c})]}):m.jsx("button",{onClick:()=>o(!0),className:"size-10 rounded-xl hover:bg-white/5 flex items-center justify-center text-text-muted hover:text-white transition-all",children:m.jsx("span",{className:"material-symbols-outlined",children:"menu"})}),s&&m.jsx("button",{onClick:()=>o(!1),className:"absolute right-4 text-text-muted hover:text-white transition-colors",children:m.jsx("span",{className:"material-symbols-outlined text-lg",children:"dock_to_left"})})]}),m.jsx("div",{className:"flex-1 overflow-y-auto no-scrollbar flex flex-col",children:m.jsxs("div",{className:"p-3 space-y-1",children:[m.jsx(gd,{to:le,icon:"home",label:i("nav.dashboard"),collapsed:!s,end:!0}),m.jsx(gd,{to:`${le}/bible`,icon:"menu_book",label:i("nav.bible"),collapsed:!s}),m.jsx(gd,{to:`${le}/map`,icon:"map",label:i("nav.atlas"),collapsed:!s}),m.jsx(gd,{to:`${le}/timeline`,icon:"calendar_month",label:i("nav.chronology"),collapsed:!s}),m.jsx(gd,{to:`${le}/languages`,icon:"translate",label:i("nav.languages"),collapsed:!s}),m.jsx(gd,{to:`${le}/graph`,icon:"hub",label:i("nav.graph"),collapsed:!s}),m.jsx("div",{className:"h-px bg-glass-border my-2 mx-2 opacity-50"}),m.jsx(gd,{to:`${le}/writing`,icon:"edit_note",label:i("nav.writing"),collapsed:!s}),m.jsx("div",{className:"h-px bg-glass-border my-2 mx-2 opacity-10"}),m.jsx(gd,{to:"/",icon:"logout",label:i("nav.logout"),collapsed:!s})]})}),m.jsx("footer",{className:"p-4 border-t border-glass-border",children:m.jsxs("div",{className:`flex items-center gap-3 ${!s&&"justify-center"}`,children:[m.jsx("div",{className:"size-10 rounded-full border border-glass-border p-1 bg-surface-light relative overflow-hidden",children:ve?.avatarUrl?m.jsx("img",{src:ve.avatarUrl,alt:"Me",className:"w-full h-full rounded-full object-cover"}):m.jsx("div",{className:"w-full h-full rounded-full bg-gradient-to-br from-primary to-purple-500 flex items-center justify-center text-white font-black text-xs",children:(ve?.displayName||t)?.substring(0,2).toUpperCase()||"US"})}),s&&m.jsxs("div",{className:"overflow-hidden",children:[m.jsx("h4",{className:"text-xs font-bold text-white truncate",children:ve?.displayName||t||"User"}),m.jsx("p",{className:"text-[10px] text-text-muted uppercase font-black tracking-tighter",children:i("common.architect")})]})]})})]}),m.jsxs("main",{className:"flex-1 flex flex-col min-w-0 bg-background-dark relative",children:[m.jsx("div",{className:"h-16 w-full absolute top-0 left-0 bg-gradient-to-b from-background-dark to-transparent pointer-events-none"}),m.jsx("div",{className:"flex-1 flex flex-col min-w-0 bg-background-dark relative overflow-hidden",children:m.jsx(qk,{context:{setRightPanelContent:I,setRightOpen:u,rightPanelTab:w,setRightPanelTab:E,projectId:p,mapSettings:_,setMapSettings:T,onMapSettingsChange:N,setOnMapSettingsChange:R}})}),m.jsx(pj,{isOpen:l,onClose:()=>u(!1),contextContent:y,projectId:p,activeTab:w,setActiveTab:E})]}),m.jsx("aside",{className:"flex-none bg-surface-dark border-l border-glass-border transition-all duration-500 relative flex flex-col z-30 w-20 shrink-0",children:m.jsx("div",{className:"flex-1 flex flex-col items-center gap-4 py-4 w-full",children:m.jsx("button",{onClick:()=>u(se=>!se),className:`size-12 rounded-xl flex items-center justify-center transition-all ${l?"bg-primary text-white shadow-lg shadow-primary/20":"bg-white/5 text-slate-400 hover:text-white hover:bg-white/10"}`,title:"Panel Global",children:m.jsx("span",{className:"material-symbols-outlined text-xl",children:"side_navigation"})})})}),Z&&m.jsx("div",{className:"fixed inset-0 z-[100] bg-black/60 backdrop-blur-sm flex items-center justify-center p-4",children:m.jsxs("div",{className:"bg-surface-dark border border-glass-border rounded-2xl p-6 w-full max-w-md shadow-2xl animate-scale-in",children:[m.jsx("h3",{className:"text-xl font-black text-white mb-4",children:i("settings.edit_template")}),m.jsxs("form",{onSubmit:xe,className:"space-y-4",children:[m.jsxs("div",{children:[m.jsx("label",{className:"text-xs uppercase font-bold text-text-muted block mb-1",children:i("settings.name")}),m.jsx("input",{autoFocus:!0,className:"w-full bg-black/30 border border-white/10 rounded-xl p-3 text-white focus:border-primary outline-none",value:Z.nombre,onChange:se=>Q({...Z,nombre:se.target.value}),required:!0})]}),m.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[m.jsxs("div",{children:[m.jsx("label",{className:"text-xs uppercase font-bold text-text-muted block mb-1",children:i("settings.type")}),m.jsxs("select",{className:"w-full bg-black/30 border border-white/10 rounded-xl p-3 text-white focus:border-primary outline-none",value:Z.tipo,onChange:se=>Q({...Z,tipo:se.target.value}),children:[m.jsx("option",{className:"bg-[#1a1a20] text-white",value:"text",children:"Texto Largo"}),m.jsx("option",{className:"bg-[#1a1a20] text-white",value:"short_text",children:"Texto Corto"}),m.jsx("option",{className:"bg-[#1a1a20] text-white",value:"number",children:"Nmero"}),m.jsx("option",{className:"bg-[#1a1a20] text-white",value:"boolean",children:"Si/No"}),m.jsx("option",{className:"bg-[#1a1a20] text-white",value:"date",children:"Fecha"}),m.jsx("option",{className:"bg-[#1a1a20] text-white",value:"entity_link",children:"Vnculo Entidad"}),m.jsx("option",{className:"bg-[#1a1a20] text-white",value:"image",children:"Imagen URL"})]})]}),m.jsx("div",{className:"flex items-center",children:m.jsxs("label",{className:"flex items-center gap-2 cursor-pointer p-3 bg-white/5 rounded-xl w-full hover:bg-white/10 transition-colors",children:[m.jsx("input",{type:"checkbox",checked:Z.global,onChange:se=>Q({...Z,global:se.target.checked}),className:"accent-primary size-4"}),m.jsx("span",{className:"text-sm font-bold text-white",children:i("settings.is_global")})]})})]}),m.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[m.jsx("button",{type:"button",onClick:()=>Q(null),className:"px-4 py-2 text-text-muted hover:text-white font-bold transition-colors",children:i("common.cancel")}),m.jsx("button",{type:"submit",className:"px-6 py-2 bg-primary text-white rounded-xl font-bold shadow-lg shadow-primary/20 hover:scale-105 transition-transform",children:i("common.save")})]})]})]})}),m.jsx(b1,{isOpen:!!ie,onClose:()=>de(null),onConfirm:he,title:i("settings.delete_template"),message:i("common.are_you_sure"),confirmText:i("common.confirm_delete"),type:"danger"})]})};var Ub={exports:{}},Gb,_E;function gj(){if(_E)return Gb;_E=1;var t="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return Gb=t,Gb}var Vb,CE;function vj(){if(CE)return Vb;CE=1;var t=gj();function e(){}function r(){}return r.resetWarningCache=e,Vb=function(){function n(s,o,l,u,c,f){if(f!==t){var p=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw p.name="Invariant Violation",p}}n.isRequired=n;function i(){return n}var a={array:n,bigint:n,bool:n,func:n,number:n,object:n,string:n,symbol:n,any:n,arrayOf:i,element:n,elementType:n,instanceOf:i,node:n,objectOf:i,oneOf:i,oneOfType:i,shape:i,exact:i,checkPropTypes:r,resetWarningCache:e};return a.PropTypes=a,a},Vb}var EE;function yj(){return EE||(EE=1,Ub.exports=vj()()),Ub.exports}var xj=yj();const bj=Th(xj);function LS(t,e){(e==null||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function wj(t){if(Array.isArray(t))return t}function Sj(t){if(Array.isArray(t))return LS(t)}function sf(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function kj(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,TM(n.key),n)}}function of(t,e,r){return e&&kj(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function Ys(t,e){var r=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=Zk(t))||e){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a,s=!0,o=!1;return{s:function(){r=r.call(t)},n:function(){var l=r.next();return s=l.done,l},e:function(l){o=!0,a=l},f:function(){try{s||r.return==null||r.return()}finally{if(o)throw a}}}}function EM(t,e,r){return(e=TM(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function _j(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function Cj(t,e){var r=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(r!=null){var n,i,a,s,o=[],l=!0,u=!1;try{if(a=(r=r.call(t)).next,e===0){if(Object(r)!==r)return;l=!1}else for(;!(l=(n=a.call(r)).done)&&(o.push(n.value),o.length!==e);l=!0);}catch(c){u=!0,i=c}finally{try{if(!l&&r.return!=null&&(s=r.return(),Object(s)!==s))return}finally{if(u)throw i}}return o}}function Ej(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Tj(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Di(t,e){return wj(t)||Cj(t,e)||Zk(t,e)||Ej()}function nx(t){return Sj(t)||_j(t)||Zk(t)||Tj()}function Nj(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}function TM(t){var e=Nj(t,"string");return typeof e=="symbol"?e:e+""}function $i(t){"@babel/helpers - typeof";return $i=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},$i(t)}function Zk(t,e){if(t){if(typeof t=="string")return LS(t,e);var r={}.toString.call(t).slice(8,-1);return r==="Object"&&t.constructor&&(r=t.constructor.name),r==="Map"||r==="Set"?Array.from(t):r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?LS(t,e):void 0}}var Hi=typeof window>"u"?null:window,TE=Hi?Hi.navigator:null;Hi&&Hi.document;var Pj=$i(""),NM=$i({}),Mj=$i(function(){}),Aj=typeof HTMLElement>"u"?"undefined":$i(HTMLElement),$v=function(e){return e&&e.instanceString&&ri(e.instanceString)?e.instanceString():null},Kt=function(e){return e!=null&&$i(e)==Pj},ri=function(e){return e!=null&&$i(e)===Mj},Sn=function(e){return!go(e)&&(Array.isArray?Array.isArray(e):e!=null&&e instanceof Array)},Vr=function(e){return e!=null&&$i(e)===NM&&!Sn(e)&&e.constructor===Object},Rj=function(e){return e!=null&&$i(e)===NM},bt=function(e){return e!=null&&$i(e)===$i(1)&&!isNaN(e)},Lj=function(e){return bt(e)&&Math.floor(e)===e},ix=function(e){if(Aj!=="undefined")return e!=null&&e instanceof HTMLElement},go=function(e){return Kv(e)||PM(e)},Kv=function(e){return $v(e)==="collection"&&e._private.single},PM=function(e){return $v(e)==="collection"&&!e._private.single},Yk=function(e){return $v(e)==="core"},MM=function(e){return $v(e)==="stylesheet"},Oj=function(e){return $v(e)==="event"},Zd=function(e){return e==null?!0:!!(e===""||e.match(/^\s+$/))},Dj=function(e){return typeof HTMLElement>"u"?!1:e instanceof HTMLElement},Ij=function(e){return Vr(e)&&bt(e.x1)&&bt(e.x2)&&bt(e.y1)&&bt(e.y2)},jj=function(e){return Rj(e)&&ri(e.then)},Fj=function(){return TE&&TE.userAgent.match(/msie|trident|edge/i)},Wp=function(e,r){r||(r=function(){if(arguments.length===1)return arguments[0];if(arguments.length===0)return"undefined";for(var a=[],s=0;s<arguments.length;s++)a.push(arguments[s]);return a.join("$")});var n=function(){var a=this,s=arguments,o,l=r.apply(a,s),u=n.cache;return(o=u[l])||(o=u[l]=e.apply(a,s)),o};return n.cache={},n},Xk=Wp(function(t){return t.replace(/([A-Z])/g,function(e){return"-"+e.toLowerCase()})}),w1=Wp(function(t){return t.replace(/(-\w)/g,function(e){return e[1].toUpperCase()})}),AM=Wp(function(t,e){return t+e[0].toUpperCase()+e.substring(1)},function(t,e){return t+"$"+e}),NE=function(e){return Zd(e)?e:e.charAt(0).toUpperCase()+e.substring(1)},Ld=function(e,r){return e.slice(-1*r.length)===r},Wi="(?:[-+]?(?:(?:\\d+|\\d*\\.\\d+)(?:[Ee][+-]?\\d+)?))",Bj="rgb[a]?\\(("+Wi+"[%]?)\\s*,\\s*("+Wi+"[%]?)\\s*,\\s*("+Wi+"[%]?)(?:\\s*,\\s*("+Wi+"))?\\)",zj="rgb[a]?\\((?:"+Wi+"[%]?)\\s*,\\s*(?:"+Wi+"[%]?)\\s*,\\s*(?:"+Wi+"[%]?)(?:\\s*,\\s*(?:"+Wi+"))?\\)",Uj="hsl[a]?\\(("+Wi+")\\s*,\\s*("+Wi+"[%])\\s*,\\s*("+Wi+"[%])(?:\\s*,\\s*("+Wi+"))?\\)",Gj="hsl[a]?\\((?:"+Wi+")\\s*,\\s*(?:"+Wi+"[%])\\s*,\\s*(?:"+Wi+"[%])(?:\\s*,\\s*(?:"+Wi+"))?\\)",Vj="\\#[0-9a-fA-F]{3}",Hj="\\#[0-9a-fA-F]{6}",RM=function(e,r){return e<r?-1:e>r?1:0},Wj=function(e,r){return-1*RM(e,r)},ir=Object.assign!=null?Object.assign.bind(Object):function(t){for(var e=arguments,r=1;r<e.length;r++){var n=e[r];if(n!=null)for(var i=Object.keys(n),a=0;a<i.length;a++){var s=i[a];t[s]=n[s]}}return t},qj=function(e){if(!(!(e.length===4||e.length===7)||e[0]!=="#")){var r=e.length===4,n,i,a,s=16;return r?(n=parseInt(e[1]+e[1],s),i=parseInt(e[2]+e[2],s),a=parseInt(e[3]+e[3],s)):(n=parseInt(e[1]+e[2],s),i=parseInt(e[3]+e[4],s),a=parseInt(e[5]+e[6],s)),[n,i,a]}},$j=function(e){var r,n,i,a,s,o,l,u;function c(y,S,w){return w<0&&(w+=1),w>1&&(w-=1),w<1/6?y+(S-y)*6*w:w<1/2?S:w<2/3?y+(S-y)*(2/3-w)*6:y}var f=new RegExp("^"+Uj+"$").exec(e);if(f){if(n=parseInt(f[1]),n<0?n=(360- -1*n%360)%360:n>360&&(n=n%360),n/=360,i=parseFloat(f[2]),i<0||i>100||(i=i/100,a=parseFloat(f[3]),a<0||a>100)||(a=a/100,s=f[4],s!==void 0&&(s=parseFloat(s),s<0||s>1)))return;if(i===0)o=l=u=Math.round(a*255);else{var p=a<.5?a*(1+i):a+i-a*i,v=2*a-p;o=Math.round(255*c(v,p,n+1/3)),l=Math.round(255*c(v,p,n)),u=Math.round(255*c(v,p,n-1/3))}r=[o,l,u,s]}return r},Kj=function(e){var r,n=new RegExp("^"+Bj+"$").exec(e);if(n){r=[];for(var i=[],a=1;a<=3;a++){var s=n[a];if(s[s.length-1]==="%"&&(i[a]=!0),s=parseFloat(s),i[a]&&(s=s/100*255),s<0||s>255)return;r.push(Math.floor(s))}var o=i[1]||i[2]||i[3],l=i[1]&&i[2]&&i[3];if(o&&!l)return;var u=n[4];if(u!==void 0){if(u=parseFloat(u),u<0||u>1)return;r.push(u)}}return r},Zj=function(e){return Yj[e.toLowerCase()]},LM=function(e){return(Sn(e)?e:null)||Zj(e)||qj(e)||Kj(e)||$j(e)},Yj={transparent:[0,0,0,0],aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],grey:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},OM=function(e){for(var r=e.map,n=e.keys,i=n.length,a=0;a<i;a++){var s=n[a];if(Vr(s))throw Error("Tried to set map with object key");a<n.length-1?(r[s]==null&&(r[s]={}),r=r[s]):r[s]=e.value}},DM=function(e){for(var r=e.map,n=e.keys,i=n.length,a=0;a<i;a++){var s=n[a];if(Vr(s))throw Error("Tried to get map with object key");if(r=r[s],r==null)return r}return r},Z0=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Zv(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Hb,PE;function Yv(){if(PE)return Hb;PE=1;function t(e){var r=typeof e;return e!=null&&(r=="object"||r=="function")}return Hb=t,Hb}var Wb,ME;function Xj(){if(ME)return Wb;ME=1;var t=typeof Z0=="object"&&Z0&&Z0.Object===Object&&Z0;return Wb=t,Wb}var qb,AE;function S1(){if(AE)return qb;AE=1;var t=Xj(),e=typeof self=="object"&&self&&self.Object===Object&&self,r=t||e||Function("return this")();return qb=r,qb}var $b,RE;function Qj(){if(RE)return $b;RE=1;var t=S1(),e=function(){return t.Date.now()};return $b=e,$b}var Kb,LE;function Jj(){if(LE)return Kb;LE=1;var t=/\s/;function e(r){for(var n=r.length;n--&&t.test(r.charAt(n)););return n}return Kb=e,Kb}var Zb,OE;function e9(){if(OE)return Zb;OE=1;var t=Jj(),e=/^\s+/;function r(n){return n&&n.slice(0,t(n)+1).replace(e,"")}return Zb=r,Zb}var Yb,DE;function Qk(){if(DE)return Yb;DE=1;var t=S1(),e=t.Symbol;return Yb=e,Yb}var Xb,IE;function t9(){if(IE)return Xb;IE=1;var t=Qk(),e=Object.prototype,r=e.hasOwnProperty,n=e.toString,i=t?t.toStringTag:void 0;function a(s){var o=r.call(s,i),l=s[i];try{s[i]=void 0;var u=!0}catch{}var c=n.call(s);return u&&(o?s[i]=l:delete s[i]),c}return Xb=a,Xb}var Qb,jE;function r9(){if(jE)return Qb;jE=1;var t=Object.prototype,e=t.toString;function r(n){return e.call(n)}return Qb=r,Qb}var Jb,FE;function IM(){if(FE)return Jb;FE=1;var t=Qk(),e=t9(),r=r9(),n="[object Null]",i="[object Undefined]",a=t?t.toStringTag:void 0;function s(o){return o==null?o===void 0?i:n:a&&a in Object(o)?e(o):r(o)}return Jb=s,Jb}var ew,BE;function n9(){if(BE)return ew;BE=1;function t(e){return e!=null&&typeof e=="object"}return ew=t,ew}var tw,zE;function Xv(){if(zE)return tw;zE=1;var t=IM(),e=n9(),r="[object Symbol]";function n(i){return typeof i=="symbol"||e(i)&&t(i)==r}return tw=n,tw}var rw,UE;function i9(){if(UE)return rw;UE=1;var t=e9(),e=Yv(),r=Xv(),n=NaN,i=/^[-+]0x[0-9a-f]+$/i,a=/^0b[01]+$/i,s=/^0o[0-7]+$/i,o=parseInt;function l(u){if(typeof u=="number")return u;if(r(u))return n;if(e(u)){var c=typeof u.valueOf=="function"?u.valueOf():u;u=e(c)?c+"":c}if(typeof u!="string")return u===0?u:+u;u=t(u);var f=a.test(u);return f||s.test(u)?o(u.slice(2),f?2:8):i.test(u)?n:+u}return rw=l,rw}var nw,GE;function a9(){if(GE)return nw;GE=1;var t=Yv(),e=Qj(),r=i9(),n="Expected a function",i=Math.max,a=Math.min;function s(o,l,u){var c,f,p,v,y,S,w=0,E=!1,_=!1,T=!0;if(typeof o!="function")throw new TypeError(n);l=r(l)||0,t(u)&&(E=!!u.leading,_="maxWait"in u,p=_?i(r(u.maxWait)||0,l):p,T="trailing"in u?!!u.trailing:T);function N(O){var W=c,U=f;return c=f=void 0,w=O,v=o.apply(U,W),v}function R(O){return w=O,y=setTimeout(D,l),E?N(O):v}function I(O){var W=O-S,U=O-w,q=l-W;return _?a(q,p-U):q}function F(O){var W=O-S,U=O-w;return S===void 0||W>=l||W<0||_&&U>=p}function D(){var O=e();if(F(O))return j(O);y=setTimeout(D,I(O))}function j(O){return y=void 0,T&&c?N(O):(c=f=void 0,v)}function B(){y!==void 0&&clearTimeout(y),w=0,c=S=f=y=void 0}function G(){return y===void 0?v:j(e())}function K(){var O=e(),W=F(O);if(c=arguments,f=this,S=O,W){if(y===void 0)return R(S);if(_)return clearTimeout(y),y=setTimeout(D,l),N(S)}return y===void 0&&(y=setTimeout(D,l)),v}return K.cancel=B,K.flush=G,K}return nw=s,nw}var s9=a9(),Qv=Zv(s9),iw=Hi?Hi.performance:null,jM=iw&&iw.now?function(){return iw.now()}:function(){return Date.now()},o9=(function(){if(Hi){if(Hi.requestAnimationFrame)return function(t){Hi.requestAnimationFrame(t)};if(Hi.mozRequestAnimationFrame)return function(t){Hi.mozRequestAnimationFrame(t)};if(Hi.webkitRequestAnimationFrame)return function(t){Hi.webkitRequestAnimationFrame(t)};if(Hi.msRequestAnimationFrame)return function(t){Hi.msRequestAnimationFrame(t)}}return function(t){t&&setTimeout(function(){t(jM())},1e3/60)}})(),ax=function(e){return o9(e)},vc=jM,Xf=9261,FM=65599,Cp=5381,BM=function(e){for(var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Xf,n=r,i;i=e.next(),!i.done;)n=n*FM+i.value|0;return n},xv=function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Xf;return r*FM+e|0},bv=function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Cp;return(r<<5)+r+e|0},l9=function(e,r){return e*2097152+r},vd=function(e){return e[0]*2097152+e[1]},Y0=function(e,r){return[xv(e[0],r[0]),bv(e[1],r[1])]},VE=function(e,r){var n={value:0,done:!1},i=0,a=e.length,s={next:function(){return i<a?n.value=e[i++]:n.done=!0,n}};return BM(s,r)},ph=function(e,r){var n={value:0,done:!1},i=0,a=e.length,s={next:function(){return i<a?n.value=e.charCodeAt(i++):n.done=!0,n}};return BM(s,r)},zM=function(){return u9(arguments)},u9=function(e){for(var r,n=0;n<e.length;n++){var i=e[n];n===0?r=ph(i):r=ph(i,r)}return r};function c9(t,e,r,n,i){var a=i*Math.PI/180,s=Math.cos(a)*(t-r)-Math.sin(a)*(e-n)+r,o=Math.sin(a)*(t-r)+Math.cos(a)*(e-n)+n;return{x:s,y:o}}var d9=function(e,r,n,i,a,s){return{x:(e-n)*a+n,y:(r-i)*s+i}};function f9(t,e,r){if(r===0)return t;var n=(e.x1+e.x2)/2,i=(e.y1+e.y2)/2,a=e.w/e.h,s=1/a,o=c9(t.x,t.y,n,i,r),l=d9(o.x,o.y,n,i,a,s);return{x:l.x,y:l.y}}var HE=!0,h9=console.warn!=null,p9=console.trace!=null,Jk=Number.MAX_SAFE_INTEGER||9007199254740991,UM=function(){return!0},sx=function(){return!1},WE=function(){return 0},e_=function(){},Kn=function(e){throw new Error(e)},GM=function(e){if(e!==void 0)HE=!!e;else return HE},an=function(e){GM()&&(h9?console.warn(e):(console.log(e),p9&&console.trace()))},m9=function(e){return ir({},e)},ku=function(e){return e==null?e:Sn(e)?e.slice():Vr(e)?m9(e):e},g9=function(e){return e.slice()},VM=function(e,r){for(r=e="";e++<36;r+=e*51&52?(e^15?8^Math.random()*(e^20?16:4):4).toString(16):"-");return r},v9={},HM=function(){return v9},Ha=function(e){var r=Object.keys(e);return function(n){for(var i={},a=0;a<r.length;a++){var s=r[a],o=n?.[s];i[s]=o===void 0?e[s]:o}return i}},Yd=function(e,r,n){for(var i=e.length-1;i>=0;i--)e[i]===r&&e.splice(i,1)},t_=function(e){e.splice(0,e.length)},y9=function(e,r){for(var n=0;n<r.length;n++){var i=r[n];e.push(i)}},$s=function(e,r,n){return n&&(r=AM(n,r)),e[r]},cc=function(e,r,n,i){n&&(r=AM(n,r)),e[r]=i},x9=(function(){function t(){sf(this,t),this._obj={}}return of(t,[{key:"set",value:function(r,n){return this._obj[r]=n,this}},{key:"delete",value:function(r){return this._obj[r]=void 0,this}},{key:"clear",value:function(){this._obj={}}},{key:"has",value:function(r){return this._obj[r]!==void 0}},{key:"get",value:function(r){return this._obj[r]}}])})(),dc=typeof Map<"u"?Map:x9,b9="undefined",w9=(function(){function t(e){if(sf(this,t),this._obj=Object.create(null),this.size=0,e!=null){var r;e.instanceString!=null&&e.instanceString()===this.instanceString()?r=e.toArray():r=e;for(var n=0;n<r.length;n++)this.add(r[n])}}return of(t,[{key:"instanceString",value:function(){return"set"}},{key:"add",value:function(r){var n=this._obj;n[r]!==1&&(n[r]=1,this.size++)}},{key:"delete",value:function(r){var n=this._obj;n[r]===1&&(n[r]=0,this.size--)}},{key:"clear",value:function(){this._obj=Object.create(null)}},{key:"has",value:function(r){return this._obj[r]===1}},{key:"toArray",value:function(){var r=this;return Object.keys(this._obj).filter(function(n){return r.has(n)})}},{key:"forEach",value:function(r,n){return this.toArray().forEach(r,n)}}])})(),um=(typeof Set>"u"?"undefined":$i(Set))!==b9?Set:w9,k1=function(e,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(e===void 0||r===void 0||!Yk(e)){Kn("An element must have a core reference and parameters set");return}var i=r.group;if(i==null&&(r.data&&r.data.source!=null&&r.data.target!=null?i="edges":i="nodes"),i!=="nodes"&&i!=="edges"){Kn("An element must be of type `nodes` or `edges`; you specified `"+i+"`");return}this.length=1,this[0]=this;var a=this._private={cy:e,single:!0,data:r.data||{},position:r.position||{x:0,y:0},autoWidth:void 0,autoHeight:void 0,autoPadding:void 0,compoundBoundsClean:!1,listeners:[],group:i,style:{},rstyle:{},styleCxts:[],styleKeys:{},removed:!0,selected:!!r.selected,selectable:r.selectable===void 0?!0:!!r.selectable,locked:!!r.locked,grabbed:!1,grabbable:r.grabbable===void 0?!0:!!r.grabbable,pannable:r.pannable===void 0?i==="edges":!!r.pannable,active:!1,classes:new um,animation:{current:[],queue:[]},rscratch:{},scratch:r.scratch||{},edges:[],children:[],parent:r.parent&&r.parent.isNode()?r.parent:null,traversalCache:{},backgrounding:!1,bbCache:null,bbCacheShift:{x:0,y:0},bodyBounds:null,overlayBounds:null,labelBounds:{all:null,source:null,target:null,main:null},arrowBounds:{source:null,target:null,"mid-source":null,"mid-target":null}};if(a.position.x==null&&(a.position.x=0),a.position.y==null&&(a.position.y=0),r.renderedPosition){var s=r.renderedPosition,o=e.pan(),l=e.zoom();a.position={x:(s.x-o.x)/l,y:(s.y-o.y)/l}}var u=[];Sn(r.classes)?u=r.classes:Kt(r.classes)&&(u=r.classes.split(/\s+/));for(var c=0,f=u.length;c<f;c++){var p=u[c];!p||p===""||a.classes.add(p)}this.createEmitter(),(n===void 0||n)&&this.restore();var v=r.style||r.css;v&&(an("Setting a `style` bypass at element creation should be done only when absolutely necessary.  Try to use the stylesheet instead."),this.style(v))},qE=function(e){return e={bfs:e.bfs||!e.dfs,dfs:e.dfs||!e.bfs},function(n,i,a){var s;Vr(n)&&!go(n)&&(s=n,n=s.roots||s.root,i=s.visit,a=s.directed),a=arguments.length===2&&!ri(i)?i:a,i=ri(i)?i:function(){};for(var o=this._private.cy,l=n=Kt(n)?this.filter(n):n,u=[],c=[],f={},p={},v={},y=0,S,w=this.byGroup(),E=w.nodes,_=w.edges,T=0;T<l.length;T++){var N=l[T],R=N.id();N.isNode()&&(u.unshift(N),e.bfs&&(v[R]=!0,c.push(N)),p[R]=0)}for(var I=function(){var O=e.bfs?u.shift():u.pop(),W=O.id();if(e.dfs){if(v[W])return 0;v[W]=!0,c.push(O)}var U=p[W],q=f[W],Z=q!=null?q.source():null,Q=q!=null?q.target():null,ne=q==null?void 0:O.same(Z)?Q[0]:Z[0],re;if(re=i(O,q,ne,y++,U),re===!0)return S=O,1;if(re===!1)return 1;for(var Y=O.connectedEdges().filter(function(xe){return(!a||xe.source().same(O))&&_.has(xe)}),J=0;J<Y.length;J++){var ie=Y[J],de=ie.connectedNodes().filter(function(xe){return!xe.same(O)&&E.has(xe)}),he=de.id();de.length!==0&&!v[he]&&(de=de[0],u.push(de),e.bfs&&(v[he]=!0,c.push(de)),f[he]=ie,p[he]=p[W]+1)}},F;u.length!==0&&(F=I(),!(F!==0&&F===1)););for(var D=o.collection(),j=0;j<c.length;j++){var B=c[j],G=f[B.id()];G!=null&&D.push(G),D.push(B)}return{path:o.collection(D),found:o.collection(S)}}},wv={breadthFirstSearch:qE({bfs:!0}),depthFirstSearch:qE({dfs:!0})};wv.bfs=wv.breadthFirstSearch;wv.dfs=wv.depthFirstSearch;var Oy={exports:{}},S9=Oy.exports,$E;function k9(){return $E||($E=1,(function(t,e){(function(){var r,n,i,a,s,o,l,u,c,f,p,v,y,S,w;i=Math.floor,f=Math.min,n=function(E,_){return E<_?-1:E>_?1:0},c=function(E,_,T,N,R){var I;if(T==null&&(T=0),R==null&&(R=n),T<0)throw new Error("lo must be non-negative");for(N==null&&(N=E.length);T<N;)I=i((T+N)/2),R(_,E[I])<0?N=I:T=I+1;return[].splice.apply(E,[T,T-T].concat(_)),_},o=function(E,_,T){return T==null&&(T=n),E.push(_),S(E,0,E.length-1,T)},s=function(E,_){var T,N;return _==null&&(_=n),T=E.pop(),E.length?(N=E[0],E[0]=T,w(E,0,_)):N=T,N},u=function(E,_,T){var N;return T==null&&(T=n),N=E[0],E[0]=_,w(E,0,T),N},l=function(E,_,T){var N;return T==null&&(T=n),E.length&&T(E[0],_)<0&&(N=[E[0],_],_=N[0],E[0]=N[1],w(E,0,T)),_},a=function(E,_){var T,N,R,I,F,D;for(_==null&&(_=n),I=(function(){D=[];for(var j=0,B=i(E.length/2);0<=B?j<B:j>B;0<=B?j++:j--)D.push(j);return D}).apply(this).reverse(),F=[],N=0,R=I.length;N<R;N++)T=I[N],F.push(w(E,T,_));return F},y=function(E,_,T){var N;if(T==null&&(T=n),N=E.indexOf(_),N!==-1)return S(E,0,N,T),w(E,N,T)},p=function(E,_,T){var N,R,I,F,D;if(T==null&&(T=n),R=E.slice(0,_),!R.length)return R;for(a(R,T),D=E.slice(_),I=0,F=D.length;I<F;I++)N=D[I],l(R,N,T);return R.sort(T).reverse()},v=function(E,_,T){var N,R,I,F,D,j,B,G,K;if(T==null&&(T=n),_*10<=E.length){if(I=E.slice(0,_).sort(T),!I.length)return I;for(R=I[I.length-1],B=E.slice(_),F=0,j=B.length;F<j;F++)N=B[F],T(N,R)<0&&(c(I,N,0,null,T),I.pop(),R=I[I.length-1]);return I}for(a(E,T),K=[],D=0,G=f(_,E.length);0<=G?D<G:D>G;0<=G?++D:--D)K.push(s(E,T));return K},S=function(E,_,T,N){var R,I,F;for(N==null&&(N=n),R=E[T];T>_;){if(F=T-1>>1,I=E[F],N(R,I)<0){E[T]=I,T=F;continue}break}return E[T]=R},w=function(E,_,T){var N,R,I,F,D;for(T==null&&(T=n),R=E.length,D=_,I=E[_],N=2*_+1;N<R;)F=N+1,F<R&&!(T(E[N],E[F])<0)&&(N=F),E[_]=E[N],_=N,N=2*_+1;return E[_]=I,S(E,D,_,T)},r=(function(){E.push=o,E.pop=s,E.replace=u,E.pushpop=l,E.heapify=a,E.updateItem=y,E.nlargest=p,E.nsmallest=v;function E(_){this.cmp=_??n,this.nodes=[]}return E.prototype.push=function(_){return o(this.nodes,_,this.cmp)},E.prototype.pop=function(){return s(this.nodes,this.cmp)},E.prototype.peek=function(){return this.nodes[0]},E.prototype.contains=function(_){return this.nodes.indexOf(_)!==-1},E.prototype.replace=function(_){return u(this.nodes,_,this.cmp)},E.prototype.pushpop=function(_){return l(this.nodes,_,this.cmp)},E.prototype.heapify=function(){return a(this.nodes,this.cmp)},E.prototype.updateItem=function(_){return y(this.nodes,_,this.cmp)},E.prototype.clear=function(){return this.nodes=[]},E.prototype.empty=function(){return this.nodes.length===0},E.prototype.size=function(){return this.nodes.length},E.prototype.clone=function(){var _;return _=new E,_.nodes=this.nodes.slice(0),_},E.prototype.toArray=function(){return this.nodes.slice(0)},E.prototype.insert=E.prototype.push,E.prototype.top=E.prototype.peek,E.prototype.front=E.prototype.peek,E.prototype.has=E.prototype.contains,E.prototype.copy=E.prototype.clone,E})(),(function(E,_){return t.exports=_()})(this,function(){return r})}).call(S9)})(Oy)),Oy.exports}var aw,KE;function _9(){return KE||(KE=1,aw=k9()),aw}var C9=_9(),Jv=Zv(C9),E9=Ha({root:null,weight:function(e){return 1},directed:!1}),T9={dijkstra:function(e){if(!Vr(e)){var r=arguments;e={root:r[0],weight:r[1],directed:r[2]}}var n=E9(e),i=n.root,a=n.weight,s=n.directed,o=this,l=a,u=Kt(i)?this.filter(i)[0]:i[0],c={},f={},p={},v=this.byGroup(),y=v.nodes,S=v.edges;S.unmergeBy(function(U){return U.isLoop()});for(var w=function(q){return c[q.id()]},E=function(q,Z){c[q.id()]=Z,_.updateItem(q)},_=new Jv(function(U,q){return w(U)-w(q)}),T=0;T<y.length;T++){var N=y[T];c[N.id()]=N.same(u)?0:1/0,_.push(N)}for(var R=function(q,Z){for(var Q=(s?q.edgesTo(Z):q.edgesWith(Z)).intersect(S),ne=1/0,re,Y=0;Y<Q.length;Y++){var J=Q[Y],ie=l(J);(ie<ne||!re)&&(ne=ie,re=J)}return{edge:re,dist:ne}};_.size()>0;){var I=_.pop(),F=w(I),D=I.id();if(p[D]=F,F!==1/0)for(var j=I.neighborhood().intersect(y),B=0;B<j.length;B++){var G=j[B],K=G.id(),O=R(I,G),W=F+O.dist;W<w(G)&&(E(G,W),f[K]={node:I,edge:O.edge})}}return{distanceTo:function(q){var Z=Kt(q)?y.filter(q)[0]:q[0];return p[Z.id()]},pathTo:function(q){var Z=Kt(q)?y.filter(q)[0]:q[0],Q=[],ne=Z,re=ne.id();if(Z.length>0)for(Q.unshift(Z);f[re];){var Y=f[re];Q.unshift(Y.edge),Q.unshift(Y.node),ne=Y.node,re=ne.id()}return o.spawn(Q)}}}},N9={kruskal:function(e){e=e||function(T){return 1};for(var r=this.byGroup(),n=r.nodes,i=r.edges,a=n.length,s=new Array(a),o=n,l=function(N){for(var R=0;R<s.length;R++){var I=s[R];if(I.has(N))return R}},u=0;u<a;u++)s[u]=this.spawn(n[u]);for(var c=i.sort(function(T,N){return e(T)-e(N)}),f=0;f<c.length;f++){var p=c[f],v=p.source()[0],y=p.target()[0],S=l(v),w=l(y),E=s[S],_=s[w];S!==w&&(o.merge(p),E.merge(_),s.splice(w,1))}return o}},P9=Ha({root:null,goal:null,weight:function(e){return 1},heuristic:function(e){return 0},directed:!1}),M9={aStar:function(e){var r=this.cy(),n=P9(e),i=n.root,a=n.goal,s=n.heuristic,o=n.directed,l=n.weight;i=r.collection(i)[0],a=r.collection(a)[0];var u=i.id(),c=a.id(),f={},p={},v={},y=new Jv(function(re,Y){return p[re.id()]-p[Y.id()]}),S=new um,w={},E={},_=function(Y,J){y.push(Y),S.add(J)},T,N,R=function(){T=y.pop(),N=T.id(),S.delete(N)},I=function(Y){return S.has(Y)};_(i,u),f[u]=0,p[u]=s(i);for(var F=0;y.size()>0;){if(R(),F++,N===c){for(var D=[],j=a,B=c,G=E[B];D.unshift(j),G!=null&&D.unshift(G),j=w[B],j!=null;)B=j.id(),G=E[B];return{found:!0,distance:f[N],path:this.spawn(D),steps:F}}v[N]=!0;for(var K=T._private.edges,O=0;O<K.length;O++){var W=K[O];if(this.hasElementWithId(W.id())&&!(o&&W.data("source")!==N)){var U=W.source(),q=W.target(),Z=U.id()!==N?U:q,Q=Z.id();if(this.hasElementWithId(Q)&&!v[Q]){var ne=f[N]+l(W);if(!I(Q)){f[Q]=ne,p[Q]=ne+s(Z),_(Z,Q),w[Q]=T,E[Q]=W;continue}ne<f[Q]&&(f[Q]=ne,p[Q]=ne+s(Z),w[Q]=T,E[Q]=W)}}}}return{found:!1,distance:void 0,path:void 0,steps:F}}},A9=Ha({weight:function(e){return 1},directed:!1}),R9={floydWarshall:function(e){for(var r=this.cy(),n=A9(e),i=n.weight,a=n.directed,s=i,o=this.byGroup(),l=o.nodes,u=o.edges,c=l.length,f=c*c,p=function(ie){return l.indexOf(ie)},v=function(ie){return l[ie]},y=new Array(f),S=0;S<f;S++){var w=S%c,E=(S-w)/c;E===w?y[S]=0:y[S]=1/0}for(var _=new Array(f),T=new Array(f),N=0;N<u.length;N++){var R=u[N],I=R.source()[0],F=R.target()[0];if(I!==F){var D=p(I),j=p(F),B=D*c+j,G=s(R);if(y[B]>G&&(y[B]=G,_[B]=j,T[B]=R),!a){var K=j*c+D;!a&&y[K]>G&&(y[K]=G,_[K]=D,T[K]=R)}}}for(var O=0;O<c;O++)for(var W=0;W<c;W++)for(var U=W*c+O,q=0;q<c;q++){var Z=W*c+q,Q=O*c+q;y[U]+y[Q]<y[Z]&&(y[Z]=y[U]+y[Q],_[Z]=_[U])}var ne=function(ie){return(Kt(ie)?r.filter(ie):ie)[0]},re=function(ie){return p(ne(ie))},Y={distance:function(ie,de){var he=re(ie),xe=re(de);return y[he*c+xe]},path:function(ie,de){var he=re(ie),xe=re(de),le=v(he);if(he===xe)return le.collection();if(_[he*c+xe]==null)return r.collection();var fe=r.collection(),ve=he,ge;for(fe.merge(le);he!==xe;)ve=he,he=_[he*c+xe],ge=T[ve*c+he],fe.merge(ge),fe.merge(v(he));return fe}};return Y}},L9=Ha({weight:function(e){return 1},directed:!1,root:null}),O9={bellmanFord:function(e){var r=this,n=L9(e),i=n.weight,a=n.directed,s=n.root,o=i,l=this,u=this.cy(),c=this.byGroup(),f=c.edges,p=c.nodes,v=p.length,y=new dc,S=!1,w=[];s=u.collection(s)[0],f.unmergeBy(function(lt){return lt.isLoop()});for(var E=f.length,_=function(at){var wt=y.get(at.id());return wt||(wt={},y.set(at.id(),wt)),wt},T=function(at){return(Kt(at)?u.$(at):at)[0]},N=function(at){return _(T(at)).dist},R=function(at){for(var wt=arguments.length>1&&arguments[1]!==void 0?arguments[1]:s,$e=T(at),Ce=[],Ie=$e;;){if(Ie==null)return r.spawn();var Je=_(Ie),Qe=Je.edge,gt=Je.pred;if(Ce.unshift(Ie[0]),Ie.same(wt)&&Ce.length>0)break;Qe!=null&&Ce.unshift(Qe),Ie=gt}return l.spawn(Ce)},I=0;I<v;I++){var F=p[I],D=_(F);F.same(s)?D.dist=0:D.dist=1/0,D.pred=null,D.edge=null}for(var j=!1,B=function(at,wt,$e,Ce,Ie,Je){var Qe=Ce.dist+Je;Qe<Ie.dist&&!$e.same(Ce.edge)&&(Ie.dist=Qe,Ie.pred=at,Ie.edge=$e,j=!0)},G=1;G<v;G++){j=!1;for(var K=0;K<E;K++){var O=f[K],W=O.source(),U=O.target(),q=o(O),Z=_(W),Q=_(U);B(W,U,O,Z,Q,q),a||B(U,W,O,Q,Z,q)}if(!j)break}if(j)for(var ne=[],re=0;re<E;re++){var Y=f[re],J=Y.source(),ie=Y.target(),de=o(Y),he=_(J).dist,xe=_(ie).dist;if(he+de<xe||!a&&xe+de<he)if(S||(an("Graph contains a negative weight cycle for Bellman-Ford"),S=!0),e.findNegativeWeightCycles!==!1){var le=[];he+de<xe&&le.push(J),!a&&xe+de<he&&le.push(ie);for(var fe=le.length,ve=0;ve<fe;ve++){var ge=le[ve],se=[ge];se.push(_(ge).edge);for(var ye=_(ge).pred;se.indexOf(ye)===-1;)se.push(ye),se.push(_(ye).edge),ye=_(ye).pred;se=se.slice(se.indexOf(ye));for(var Se=se[0].id(),Ue=0,Oe=2;Oe<se.length;Oe+=2)se[Oe].id()<Se&&(Se=se[Oe].id(),Ue=Oe);se=se.slice(Ue).concat(se.slice(0,Ue)),se.push(se[0]);var mt=se.map(function(lt){return lt.id()}).join(",");ne.indexOf(mt)===-1&&(w.push(l.spawn(se)),ne.push(mt))}}else break}return{distanceTo:N,pathTo:R,hasNegativeWeightCycle:S,negativeWeightCycles:w}}},D9=Math.sqrt(2),I9=function(e,r,n){n.length===0&&Kn("Karger-Stein must be run on a connected (sub)graph");for(var i=n[e],a=i[1],s=i[2],o=r[a],l=r[s],u=n,c=u.length-1;c>=0;c--){var f=u[c],p=f[1],v=f[2];(r[p]===o&&r[v]===l||r[p]===l&&r[v]===o)&&u.splice(c,1)}for(var y=0;y<u.length;y++){var S=u[y];S[1]===l?(u[y]=S.slice(),u[y][1]=o):S[2]===l&&(u[y]=S.slice(),u[y][2]=o)}for(var w=0;w<r.length;w++)r[w]===l&&(r[w]=o);return u},sw=function(e,r,n,i){for(;n>i;){var a=Math.floor(Math.random()*r.length);r=I9(a,e,r),n--}return r},j9={kargerStein:function(){var e=this,r=this.byGroup(),n=r.nodes,i=r.edges;i.unmergeBy(function(Q){return Q.isLoop()});var a=n.length,s=i.length,o=Math.ceil(Math.pow(Math.log(a)/Math.LN2,2)),l=Math.floor(a/D9);if(a<2){Kn("At least 2 nodes are required for Karger-Stein algorithm");return}for(var u=[],c=0;c<s;c++){var f=i[c];u.push([c,n.indexOf(f.source()),n.indexOf(f.target())])}for(var p=1/0,v=[],y=new Array(a),S=new Array(a),w=new Array(a),E=function(ne,re){for(var Y=0;Y<a;Y++)re[Y]=ne[Y]},_=0;_<=o;_++){for(var T=0;T<a;T++)S[T]=T;var N=sw(S,u.slice(),a,l),R=N.slice();E(S,w);var I=sw(S,N,l,2),F=sw(w,R,l,2);I.length<=F.length&&I.length<p?(p=I.length,v=I,E(S,y)):F.length<=I.length&&F.length<p&&(p=F.length,v=F,E(w,y))}for(var D=this.spawn(v.map(function(Q){return i[Q[0]]})),j=this.spawn(),B=this.spawn(),G=y[0],K=0;K<y.length;K++){var O=y[K],W=n[K];O===G?j.merge(W):B.merge(W)}var U=function(ne){var re=e.spawn();return ne.forEach(function(Y){re.merge(Y),Y.connectedEdges().forEach(function(J){e.contains(J)&&!D.contains(J)&&re.merge(J)})}),re},q=[U(j),U(B)],Z={cut:D,components:q,partition1:j,partition2:B};return Z}},ow,F9=function(e){return{x:e.x,y:e.y}},_1=function(e,r,n){return{x:e.x*r+n.x,y:e.y*r+n.y}},WM=function(e,r,n){return{x:(e.x-n.x)/r,y:(e.y-n.y)/r}},Rp=function(e){return{x:e[0],y:e[1]}},B9=function(e){for(var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:e.length,i=1/0,a=r;a<n;a++){var s=e[a];isFinite(s)&&(i=Math.min(s,i))}return i},z9=function(e){for(var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:e.length,i=-1/0,a=r;a<n;a++){var s=e[a];isFinite(s)&&(i=Math.max(s,i))}return i},U9=function(e){for(var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:e.length,i=0,a=0,s=r;s<n;s++){var o=e[s];isFinite(o)&&(i+=o,a++)}return i/a},G9=function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:e.length,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0,a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!0;i?e=e.slice(r,n):(n<e.length&&e.splice(n,e.length-n),r>0&&e.splice(0,r));for(var o=0,l=e.length-1;l>=0;l--){var u=e[l];s?isFinite(u)||(e[l]=-1/0,o++):e.splice(l,1)}a&&e.sort(function(p,v){return p-v});var c=e.length,f=Math.floor(c/2);return c%2!==0?e[f+1+o]:(e[f-1+o]+e[f+o])/2},V9=function(e){return Math.PI*e/180},X0=function(e,r){return Math.atan2(r,e)-Math.PI/2},r_=Math.log2||function(t){return Math.log(t)/Math.log(2)},n_=function(e){return e>0?1:e<0?-1:0},mh=function(e,r){return Math.sqrt(Kf(e,r))},Kf=function(e,r){var n=r.x-e.x,i=r.y-e.y;return n*n+i*i},H9=function(e){for(var r=e.length,n=0,i=0;i<r;i++)n+=e[i];for(var a=0;a<r;a++)e[a]=e[a]/n;return e},fa=function(e,r,n,i){return(1-i)*(1-i)*e+2*(1-i)*i*r+i*i*n},jp=function(e,r,n,i){return{x:fa(e.x,r.x,n.x,i),y:fa(e.y,r.y,n.y,i)}},W9=function(e,r,n,i){var a={x:r.x-e.x,y:r.y-e.y},s=mh(e,r),o={x:a.x/s,y:a.y/s};return n=n??0,i=i??n*s,{x:e.x+o.x*i,y:e.y+o.y*i}},Sv=function(e,r,n){return Math.max(e,Math.min(n,r))},Es=function(e){if(e==null)return{x1:1/0,y1:1/0,x2:-1/0,y2:-1/0,w:0,h:0};if(e.x1!=null&&e.y1!=null){if(e.x2!=null&&e.y2!=null&&e.x2>=e.x1&&e.y2>=e.y1)return{x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,w:e.x2-e.x1,h:e.y2-e.y1};if(e.w!=null&&e.h!=null&&e.w>=0&&e.h>=0)return{x1:e.x1,y1:e.y1,x2:e.x1+e.w,y2:e.y1+e.h,w:e.w,h:e.h}}},q9=function(e){return{x1:e.x1,x2:e.x2,w:e.w,y1:e.y1,y2:e.y2,h:e.h}},$9=function(e){e.x1=1/0,e.y1=1/0,e.x2=-1/0,e.y2=-1/0,e.w=0,e.h=0},K9=function(e,r){e.x1=Math.min(e.x1,r.x1),e.x2=Math.max(e.x2,r.x2),e.w=e.x2-e.x1,e.y1=Math.min(e.y1,r.y1),e.y2=Math.max(e.y2,r.y2),e.h=e.y2-e.y1},qM=function(e,r,n){e.x1=Math.min(e.x1,r),e.x2=Math.max(e.x2,r),e.w=e.x2-e.x1,e.y1=Math.min(e.y1,n),e.y2=Math.max(e.y2,n),e.h=e.y2-e.y1},Dy=function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return e.x1-=r,e.x2+=r,e.y1-=r,e.y2+=r,e.w=e.x2-e.x1,e.h=e.y2-e.y1,e},Iy=function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0],n,i,a,s;if(r.length===1)n=i=a=s=r[0];else if(r.length===2)n=a=r[0],s=i=r[1];else if(r.length===4){var o=Di(r,4);n=o[0],i=o[1],a=o[2],s=o[3]}return e.x1-=s,e.x2+=i,e.y1-=n,e.y2+=a,e.w=e.x2-e.x1,e.h=e.y2-e.y1,e},ZE=function(e,r){e.x1=r.x1,e.y1=r.y1,e.x2=r.x2,e.y2=r.y2,e.w=e.x2-e.x1,e.h=e.y2-e.y1},i_=function(e,r){return!(e.x1>r.x2||r.x1>e.x2||e.x2<r.x1||r.x2<e.x1||e.y2<r.y1||r.y2<e.y1||e.y1>r.y2||r.y1>e.y2)},Od=function(e,r,n){return e.x1<=r&&r<=e.x2&&e.y1<=n&&n<=e.y2},YE=function(e,r){return Od(e,r.x,r.y)},$M=function(e,r){return Od(e,r.x1,r.y1)&&Od(e,r.x2,r.y2)},Z9=(ow=Math.hypot)!==null&&ow!==void 0?ow:function(t,e){return Math.sqrt(t*t+e*e)};function Y9(t,e){if(t.length<3)throw new Error("Need at least 3 vertices");var r=function(D,j){return{x:D.x+j.x,y:D.y+j.y}},n=function(D,j){return{x:D.x-j.x,y:D.y-j.y}},i=function(D,j){return{x:D.x*j,y:D.y*j}},a=function(D,j){return D.x*j.y-D.y*j.x},s=function(D){var j=Z9(D.x,D.y);return j===0?{x:0,y:0}:{x:D.x/j,y:D.y/j}},o=function(D){for(var j=0,B=0;B<D.length;B++){var G=D[B],K=D[(B+1)%D.length];j+=G.x*K.y-K.x*G.y}return j/2},l=function(D,j,B,G){var K=n(j,D),O=n(G,B),W=a(K,O);if(Math.abs(W)<1e-9)return r(D,i(K,.5));var U=a(n(B,D),O)/W;return r(D,i(K,U))},u=t.map(function(F){return{x:F.x,y:F.y}});o(u)<0&&u.reverse();for(var c=u.length,f=[],p=0;p<c;p++){var v=u[p],y=u[(p+1)%c],S=n(y,v),w=s({x:S.y,y:-S.x});f.push(w)}for(var E=f.map(function(F,D){var j=r(u[D],i(F,e)),B=r(u[(D+1)%c],i(F,e));return{p1:j,p2:B}}),_=[],T=0;T<c;T++){var N=E[(T-1+c)%c],R=E[T],I=l(N.p1,N.p2,R.p1,R.p2);_.push(I)}return _}function X9(t,e,r,n,i,a){var s=sF(t,e,r,n,i),o=Y9(s,a),l=Es();return o.forEach(function(u){return qM(l,u.x,u.y)}),l}var KM=function(e,r,n,i,a,s,o){var l=arguments.length>7&&arguments[7]!==void 0?arguments[7]:"auto",u=l==="auto"?Xd(a,s):l,c=a/2,f=s/2;u=Math.min(u,c,f);var p=u!==c,v=u!==f,y;if(p){var S=n-c+u-o,w=i-f-o,E=n+c-u+o,_=w;if(y=Dd(e,r,n,i,S,w,E,_,!1),y.length>0)return y}if(v){var T=n+c+o,N=i-f+u-o,R=T,I=i+f-u+o;if(y=Dd(e,r,n,i,T,N,R,I,!1),y.length>0)return y}if(p){var F=n-c+u-o,D=i+f+o,j=n+c-u+o,B=D;if(y=Dd(e,r,n,i,F,D,j,B,!1),y.length>0)return y}if(v){var G=n-c-o,K=i-f+u-o,O=G,W=i+f-u+o;if(y=Dd(e,r,n,i,G,K,O,W,!1),y.length>0)return y}var U;{var q=n-c+u,Z=i-f+u;if(U=Hg(e,r,n,i,q,Z,u+o),U.length>0&&U[0]<=q&&U[1]<=Z)return[U[0],U[1]]}{var Q=n+c-u,ne=i-f+u;if(U=Hg(e,r,n,i,Q,ne,u+o),U.length>0&&U[0]>=Q&&U[1]<=ne)return[U[0],U[1]]}{var re=n+c-u,Y=i+f-u;if(U=Hg(e,r,n,i,re,Y,u+o),U.length>0&&U[0]>=re&&U[1]>=Y)return[U[0],U[1]]}{var J=n-c+u,ie=i+f-u;if(U=Hg(e,r,n,i,J,ie,u+o),U.length>0&&U[0]<=J&&U[1]>=ie)return[U[0],U[1]]}return[]},Q9=function(e,r,n,i,a,s,o){var l=o,u=Math.min(n,a),c=Math.max(n,a),f=Math.min(i,s),p=Math.max(i,s);return u-l<=e&&e<=c+l&&f-l<=r&&r<=p+l},J9=function(e,r,n,i,a,s,o,l,u){var c={x1:Math.min(n,o,a)-u,x2:Math.max(n,o,a)+u,y1:Math.min(i,l,s)-u,y2:Math.max(i,l,s)+u};return!(e<c.x1||e>c.x2||r<c.y1||r>c.y2)},eF=function(e,r,n,i){n-=i;var a=r*r-4*e*n;if(a<0)return[];var s=Math.sqrt(a),o=2*e,l=(-r+s)/o,u=(-r-s)/o;return[l,u]},tF=function(e,r,n,i,a){var s=1e-5;e===0&&(e=s),r/=e,n/=e,i/=e;var o,l,u,c,f,p,v,y;if(l=(3*n-r*r)/9,u=-(27*i)+r*(9*n-2*(r*r)),u/=54,o=l*l*l+u*u,a[1]=0,v=r/3,o>0){f=u+Math.sqrt(o),f=f<0?-Math.pow(-f,1/3):Math.pow(f,1/3),p=u-Math.sqrt(o),p=p<0?-Math.pow(-p,1/3):Math.pow(p,1/3),a[0]=-v+f+p,v+=(f+p)/2,a[4]=a[2]=-v,v=Math.sqrt(3)*(-p+f)/2,a[3]=v,a[5]=-v;return}if(a[5]=a[3]=0,o===0){y=u<0?-Math.pow(-u,1/3):Math.pow(u,1/3),a[0]=-v+2*y,a[4]=a[2]=-(y+v);return}l=-l,c=l*l*l,c=Math.acos(u/Math.sqrt(c)),y=2*Math.sqrt(l),a[0]=-v+y*Math.cos(c/3),a[2]=-v+y*Math.cos((c+2*Math.PI)/3),a[4]=-v+y*Math.cos((c+4*Math.PI)/3)},rF=function(e,r,n,i,a,s,o,l){var u=1*n*n-4*n*a+2*n*o+4*a*a-4*a*o+o*o+i*i-4*i*s+2*i*l+4*s*s-4*s*l+l*l,c=9*n*a-3*n*n-3*n*o-6*a*a+3*a*o+9*i*s-3*i*i-3*i*l-6*s*s+3*s*l,f=3*n*n-6*n*a+n*o-n*e+2*a*a+2*a*e-o*e+3*i*i-6*i*s+i*l-i*r+2*s*s+2*s*r-l*r,p=1*n*a-n*n+n*e-a*e+i*s-i*i+i*r-s*r,v=[];tF(u,c,f,p,v);for(var y=1e-7,S=[],w=0;w<6;w+=2)Math.abs(v[w+1])<y&&v[w]>=0&&v[w]<=1&&S.push(v[w]);S.push(1),S.push(0);for(var E=-1,_,T,N,R=0;R<S.length;R++)_=Math.pow(1-S[R],2)*n+2*(1-S[R])*S[R]*a+S[R]*S[R]*o,T=Math.pow(1-S[R],2)*i+2*(1-S[R])*S[R]*s+S[R]*S[R]*l,N=Math.pow(_-e,2)+Math.pow(T-r,2),E>=0?N<E&&(E=N):E=N;return E},nF=function(e,r,n,i,a,s){var o=[e-n,r-i],l=[a-n,s-i],u=l[0]*l[0]+l[1]*l[1],c=o[0]*o[0]+o[1]*o[1],f=o[0]*l[0]+o[1]*l[1],p=f*f/u;return f<0?c:p>u?(e-a)*(e-a)+(r-s)*(r-s):c-p},Ks=function(e,r,n){for(var i,a,s,o,l,u=0,c=0;c<n.length/2;c++)if(i=n[c*2],a=n[c*2+1],c+1<n.length/2?(s=n[(c+1)*2],o=n[(c+1)*2+1]):(s=n[(c+1-n.length/2)*2],o=n[(c+1-n.length/2)*2+1]),!(i==e&&s==e))if(i>=e&&e>=s||i<=e&&e<=s)l=(e-i)/(s-i)*(o-a)+a,l>r&&u++;else continue;return u%2!==0},yc=function(e,r,n,i,a,s,o,l,u){var c=new Array(n.length),f;l[0]!=null?(f=Math.atan(l[1]/l[0]),l[0]<0?f=f+Math.PI/2:f=-f-Math.PI/2):f=l;for(var p=Math.cos(-f),v=Math.sin(-f),y=0;y<c.length/2;y++)c[y*2]=s/2*(n[y*2]*p-n[y*2+1]*v),c[y*2+1]=o/2*(n[y*2+1]*p+n[y*2]*v),c[y*2]+=i,c[y*2+1]+=a;var S;if(u>0){var w=lx(c,-u);S=ox(w)}else S=c;return Ks(e,r,S)},iF=function(e,r,n,i,a,s,o,l){for(var u=new Array(n.length*2),c=0;c<l.length;c++){var f=l[c];u[c*4+0]=f.startX,u[c*4+1]=f.startY,u[c*4+2]=f.stopX,u[c*4+3]=f.stopY;var p=Math.pow(f.cx-e,2)+Math.pow(f.cy-r,2);if(p<=Math.pow(f.radius,2))return!0}return Ks(e,r,u)},ox=function(e){for(var r=new Array(e.length/2),n,i,a,s,o,l,u,c,f=0;f<e.length/4;f++){n=e[f*4],i=e[f*4+1],a=e[f*4+2],s=e[f*4+3],f<e.length/4-1?(o=e[(f+1)*4],l=e[(f+1)*4+1],u=e[(f+1)*4+2],c=e[(f+1)*4+3]):(o=e[0],l=e[1],u=e[2],c=e[3]);var p=Dd(n,i,a,s,o,l,u,c,!0);r[f*2]=p[0],r[f*2+1]=p[1]}return r},lx=function(e,r){for(var n=new Array(e.length*2),i,a,s,o,l=0;l<e.length/2;l++){i=e[l*2],a=e[l*2+1],l<e.length/2-1?(s=e[(l+1)*2],o=e[(l+1)*2+1]):(s=e[0],o=e[1]);var u=o-a,c=-(s-i),f=Math.sqrt(u*u+c*c),p=u/f,v=c/f;n[l*4]=i+p*r,n[l*4+1]=a+v*r,n[l*4+2]=s+p*r,n[l*4+3]=o+v*r}return n},aF=function(e,r,n,i,a,s){var o=n-e,l=i-r;o/=a,l/=s;var u=Math.sqrt(o*o+l*l),c=u-1;if(c<0)return[];var f=c/u;return[(n-e)*f+e,(i-r)*f+r]},th=function(e,r,n,i,a,s,o){return e-=a,r-=s,e/=n/2+o,r/=i/2+o,e*e+r*r<=1},Hg=function(e,r,n,i,a,s,o){var l=[n-e,i-r],u=[e-a,r-s],c=l[0]*l[0]+l[1]*l[1],f=2*(u[0]*l[0]+u[1]*l[1]),p=u[0]*u[0]+u[1]*u[1]-o*o,v=f*f-4*c*p;if(v<0)return[];var y=(-f+Math.sqrt(v))/(2*c),S=(-f-Math.sqrt(v))/(2*c),w=Math.min(y,S),E=Math.max(y,S),_=[];if(w>=0&&w<=1&&_.push(w),E>=0&&E<=1&&_.push(E),_.length===0)return[];var T=_[0]*l[0]+e,N=_[0]*l[1]+r;if(_.length>1){if(_[0]==_[1])return[T,N];var R=_[1]*l[0]+e,I=_[1]*l[1]+r;return[T,N,R,I]}else return[T,N]},lw=function(e,r,n){return r<=e&&e<=n||n<=e&&e<=r?e:e<=r&&r<=n||n<=r&&r<=e?r:n},Dd=function(e,r,n,i,a,s,o,l,u){var c=e-a,f=n-e,p=o-a,v=r-s,y=i-r,S=l-s,w=p*v-S*c,E=f*v-y*c,_=S*f-p*y;if(_!==0){var T=w/_,N=E/_,R=.001,I=0-R,F=1+R;return I<=T&&T<=F&&I<=N&&N<=F?[e+T*f,r+T*y]:u?[e+T*f,r+T*y]:[]}else return w===0||E===0?lw(e,n,o)===o?[o,l]:lw(e,n,a)===a?[a,s]:lw(a,o,n)===n?[n,i]:[]:[]},sF=function(e,r,n,i,a){var s=[],o=i/2,l=a/2,u=r,c=n;s.push({x:u+o*e[0],y:c+l*e[1]});for(var f=1;f<e.length/2;f++)s.push({x:u+o*e[f*2],y:c+l*e[f*2+1]});return s},kv=function(e,r,n,i,a,s,o,l){var u=[],c,f=new Array(n.length),p=!0;s==null&&(p=!1);var v;if(p){for(var y=0;y<f.length/2;y++)f[y*2]=n[y*2]*s+i,f[y*2+1]=n[y*2+1]*o+a;if(l>0){var S=lx(f,-l);v=ox(S)}else v=f}else v=n;for(var w,E,_,T,N=0;N<v.length/2;N++)w=v[N*2],E=v[N*2+1],N<v.length/2-1?(_=v[(N+1)*2],T=v[(N+1)*2+1]):(_=v[0],T=v[1]),c=Dd(e,r,i,a,w,E,_,T),c.length!==0&&u.push(c[0],c[1]);return u},oF=function(e,r,n,i,a,s,o,l,u){var c=[],f,p=new Array(n.length*2);u.forEach(function(_,T){T===0?(p[p.length-2]=_.startX,p[p.length-1]=_.startY):(p[T*4-2]=_.startX,p[T*4-1]=_.startY),p[T*4]=_.stopX,p[T*4+1]=_.stopY,f=Hg(e,r,i,a,_.cx,_.cy,_.radius),f.length!==0&&c.push(f[0],f[1])});for(var v=0;v<p.length/4;v++)f=Dd(e,r,i,a,p[v*4],p[v*4+1],p[v*4+2],p[v*4+3],!1),f.length!==0&&c.push(f[0],f[1]);if(c.length>2){for(var y=[c[0],c[1]],S=Math.pow(y[0]-e,2)+Math.pow(y[1]-r,2),w=1;w<c.length/2;w++){var E=Math.pow(c[w*2]-e,2)+Math.pow(c[w*2+1]-r,2);E<=S&&(y[0]=c[w*2],y[1]=c[w*2+1],S=E)}return y}return c},Q0=function(e,r,n){var i=[e[0]-r[0],e[1]-r[1]],a=Math.sqrt(i[0]*i[0]+i[1]*i[1]),s=(a-n)/a;return s<0&&(s=1e-5),[r[0]+s*i[0],r[1]+s*i[1]]},Cs=function(e,r){var n=OS(e,r);return n=ZM(n),n},ZM=function(e){for(var r,n,i=e.length/2,a=1/0,s=1/0,o=-1/0,l=-1/0,u=0;u<i;u++)r=e[2*u],n=e[2*u+1],a=Math.min(a,r),o=Math.max(o,r),s=Math.min(s,n),l=Math.max(l,n);for(var c=2/(o-a),f=2/(l-s),p=0;p<i;p++)r=e[2*p]=e[2*p]*c,n=e[2*p+1]=e[2*p+1]*f,a=Math.min(a,r),o=Math.max(o,r),s=Math.min(s,n),l=Math.max(l,n);if(s<-1)for(var v=0;v<i;v++)n=e[2*v+1]=e[2*v+1]+(-1-s);return e},OS=function(e,r){var n=1/e*2*Math.PI,i=e%2===0?Math.PI/2+n/2:Math.PI/2;i+=r;for(var a=new Array(e*2),s,o=0;o<e;o++)s=o*n+i,a[2*o]=Math.cos(s),a[2*o+1]=Math.sin(-s);return a},Xd=function(e,r){return Math.min(e/4,r/4,8)},YM=function(e,r){return Math.min(e/10,r/10,8)},a_=function(){return 8},lF=function(e,r,n){return[e-2*r+n,2*(r-e),e]},DS=function(e,r){return{heightOffset:Math.min(15,.05*r),widthOffset:Math.min(100,.25*e),ctrlPtOffsetPct:.05}};function uw(t,e){function r(f){for(var p=[],v=0;v<f.length;v++){var y=f[v],S=f[(v+1)%f.length],w={x:S.x-y.x,y:S.y-y.y},E={x:-w.y,y:w.x},_=Math.sqrt(E.x*E.x+E.y*E.y);p.push({x:E.x/_,y:E.y/_})}return p}function n(f,p){var v=1/0,y=-1/0,S=Ys(f),w;try{for(S.s();!(w=S.n()).done;){var E=w.value,_=E.x*p.x+E.y*p.y;v=Math.min(v,_),y=Math.max(y,_)}}catch(T){S.e(T)}finally{S.f()}return{min:v,max:y}}function i(f,p){return!(f.max<p.min||p.max<f.min)}var a=[].concat(nx(r(t)),nx(r(e))),s=Ys(a),o;try{for(s.s();!(o=s.n()).done;){var l=o.value,u=n(t,l),c=n(e,l);if(!i(u,c))return!1}}catch(f){s.e(f)}finally{s.f()}return!0}var uF=Ha({dampingFactor:.8,precision:1e-6,iterations:200,weight:function(e){return 1}}),cF={pageRank:function(e){for(var r=uF(e),n=r.dampingFactor,i=r.precision,a=r.iterations,s=r.weight,o=this._private.cy,l=this.byGroup(),u=l.nodes,c=l.edges,f=u.length,p=f*f,v=c.length,y=new Array(p),S=new Array(f),w=(1-n)/f,E=0;E<f;E++){for(var _=0;_<f;_++){var T=E*f+_;y[T]=0}S[E]=0}for(var N=0;N<v;N++){var R=c[N],I=R.data("source"),F=R.data("target");if(I!==F){var D=u.indexOfId(I),j=u.indexOfId(F),B=s(R),G=j*f+D;y[G]+=B,S[D]+=B}}for(var K=1/f+w,O=0;O<f;O++)if(S[O]===0)for(var W=0;W<f;W++){var U=W*f+O;y[U]=K}else for(var q=0;q<f;q++){var Z=q*f+O;y[Z]=y[Z]/S[O]+w}for(var Q=new Array(f),ne=new Array(f),re,Y=0;Y<f;Y++)Q[Y]=1;for(var J=0;J<a;J++){for(var ie=0;ie<f;ie++)ne[ie]=0;for(var de=0;de<f;de++)for(var he=0;he<f;he++){var xe=de*f+he;ne[de]+=y[xe]*Q[he]}H9(ne),re=Q,Q=ne,ne=re;for(var le=0,fe=0;fe<f;fe++){var ve=re[fe]-Q[fe];le+=ve*ve}if(le<i)break}var ge={rank:function(ye){return ye=o.collection(ye)[0],Q[u.indexOf(ye)]}};return ge}},XE=Ha({root:null,weight:function(e){return 1},directed:!1,alpha:0}),Fp={degreeCentralityNormalized:function(e){e=XE(e);var r=this.cy(),n=this.nodes(),i=n.length;if(e.directed){for(var c={},f={},p=0,v=0,y=0;y<i;y++){var S=n[y],w=S.id();e.root=S;var E=this.degreeCentrality(e);p<E.indegree&&(p=E.indegree),v<E.outdegree&&(v=E.outdegree),c[w]=E.indegree,f[w]=E.outdegree}return{indegree:function(T){return p==0?0:(Kt(T)&&(T=r.filter(T)),c[T.id()]/p)},outdegree:function(T){return v===0?0:(Kt(T)&&(T=r.filter(T)),f[T.id()]/v)}}}else{for(var a={},s=0,o=0;o<i;o++){var l=n[o];e.root=l;var u=this.degreeCentrality(e);s<u.degree&&(s=u.degree),a[l.id()]=u.degree}return{degree:function(T){return s===0?0:(Kt(T)&&(T=r.filter(T)),a[T.id()]/s)}}}},degreeCentrality:function(e){e=XE(e);var r=this.cy(),n=this,i=e,a=i.root,s=i.weight,o=i.directed,l=i.alpha;if(a=r.collection(a)[0],o){for(var v=a.connectedEdges(),y=v.filter(function(I){return I.target().same(a)&&n.has(I)}),S=v.filter(function(I){return I.source().same(a)&&n.has(I)}),w=y.length,E=S.length,_=0,T=0,N=0;N<y.length;N++)_+=s(y[N]);for(var R=0;R<S.length;R++)T+=s(S[R]);return{indegree:Math.pow(w,1-l)*Math.pow(_,l),outdegree:Math.pow(E,1-l)*Math.pow(T,l)}}else{for(var u=a.connectedEdges().intersection(n),c=u.length,f=0,p=0;p<u.length;p++)f+=s(u[p]);return{degree:Math.pow(c,1-l)*Math.pow(f,l)}}}};Fp.dc=Fp.degreeCentrality;Fp.dcn=Fp.degreeCentralityNormalised=Fp.degreeCentralityNormalized;var QE=Ha({harmonic:!0,weight:function(){return 1},directed:!1,root:null}),Bp={closenessCentralityNormalized:function(e){for(var r=QE(e),n=r.harmonic,i=r.weight,a=r.directed,s=this.cy(),o={},l=0,u=this.nodes(),c=this.floydWarshall({weight:i,directed:a}),f=0;f<u.length;f++){for(var p=0,v=u[f],y=0;y<u.length;y++)if(f!==y){var S=c.distance(v,u[y]);n?p+=1/S:p+=S}n||(p=1/p),l<p&&(l=p),o[v.id()]=p}return{closeness:function(E){return l==0?0:(Kt(E)?E=s.filter(E)[0].id():E=E.id(),o[E]/l)}}},closenessCentrality:function(e){var r=QE(e),n=r.root,i=r.weight,a=r.directed,s=r.harmonic;n=this.filter(n)[0];for(var o=this.dijkstra({root:n,weight:i,directed:a}),l=0,u=this.nodes(),c=0;c<u.length;c++){var f=u[c];if(!f.same(n)){var p=o.distanceTo(f);s?l+=1/p:l+=p}}return s?l:1/l}};Bp.cc=Bp.closenessCentrality;Bp.ccn=Bp.closenessCentralityNormalised=Bp.closenessCentralityNormalized;var dF=Ha({weight:null,directed:!1}),IS={betweennessCentrality:function(e){for(var r=dF(e),n=r.directed,i=r.weight,a=i!=null,s=this.cy(),o=this.nodes(),l={},u={},c=0,f={set:function(T,N){u[T]=N,N>c&&(c=N)},get:function(T){return u[T]}},p=0;p<o.length;p++){var v=o[p],y=v.id();n?l[y]=v.outgoers().nodes():l[y]=v.openNeighborhood().nodes(),f.set(y,0)}for(var S=function(){for(var T=o[w].id(),N=[],R={},I={},F={},D=new Jv(function(de,he){return F[de]-F[he]}),j=0;j<o.length;j++){var B=o[j].id();R[B]=[],I[B]=0,F[B]=1/0}for(I[T]=1,F[T]=0,D.push(T);!D.empty();){var G=D.pop();if(N.push(G),a)for(var K=0;K<l[G].length;K++){var O=l[G][K],W=s.getElementById(G),U=void 0;W.edgesTo(O).length>0?U=W.edgesTo(O)[0]:U=O.edgesTo(W)[0];var q=i(U);O=O.id(),F[O]>F[G]+q&&(F[O]=F[G]+q,D.nodes.indexOf(O)<0?D.push(O):D.updateItem(O),I[O]=0,R[O]=[]),F[O]==F[G]+q&&(I[O]=I[O]+I[G],R[O].push(G))}else for(var Z=0;Z<l[G].length;Z++){var Q=l[G][Z].id();F[Q]==1/0&&(D.push(Q),F[Q]=F[G]+1),F[Q]==F[G]+1&&(I[Q]=I[Q]+I[G],R[Q].push(G))}}for(var ne={},re=0;re<o.length;re++)ne[o[re].id()]=0;for(;N.length>0;){for(var Y=N.pop(),J=0;J<R[Y].length;J++){var ie=R[Y][J];ne[ie]=ne[ie]+I[ie]/I[Y]*(1+ne[Y])}Y!=o[w].id()&&f.set(Y,f.get(Y)+ne[Y])}},w=0;w<o.length;w++)S();var E={betweenness:function(T){var N=s.collection(T).id();return f.get(N)},betweennessNormalized:function(T){if(c==0)return 0;var N=s.collection(T).id();return f.get(N)/c}};return E.betweennessNormalised=E.betweennessNormalized,E}};IS.bc=IS.betweennessCentrality;var fF=Ha({expandFactor:2,inflateFactor:2,multFactor:1,maxIterations:20,attributes:[function(t){return 1}]}),hF=function(e){return fF(e)},pF=function(e,r){for(var n=0,i=0;i<r.length;i++)n+=r[i](e);return n},mF=function(e,r,n){for(var i=0;i<r;i++)e[i*r+i]=n},XM=function(e,r){for(var n,i=0;i<r;i++){n=0;for(var a=0;a<r;a++)n+=e[a*r+i];for(var s=0;s<r;s++)e[s*r+i]=e[s*r+i]/n}},gF=function(e,r,n){for(var i=new Array(n*n),a=0;a<n;a++){for(var s=0;s<n;s++)i[a*n+s]=0;for(var o=0;o<n;o++)for(var l=0;l<n;l++)i[a*n+l]+=e[a*n+o]*r[o*n+l]}return i},vF=function(e,r,n){for(var i=e.slice(0),a=1;a<n;a++)e=gF(e,i,r);return e},yF=function(e,r,n){for(var i=new Array(r*r),a=0;a<r*r;a++)i[a]=Math.pow(e[a],n);return XM(i,r),i},xF=function(e,r,n,i){for(var a=0;a<n;a++){var s=Math.round(e[a]*Math.pow(10,i))/Math.pow(10,i),o=Math.round(r[a]*Math.pow(10,i))/Math.pow(10,i);if(s!==o)return!1}return!0},bF=function(e,r,n,i){for(var a=[],s=0;s<r;s++){for(var o=[],l=0;l<r;l++)Math.round(e[s*r+l]*1e3)/1e3>0&&o.push(n[l]);o.length!==0&&a.push(i.collection(o))}return a},wF=function(e,r){for(var n=0;n<e.length;n++)if(!r[n]||e[n].id()!==r[n].id())return!1;return!0},SF=function(e){for(var r=0;r<e.length;r++)for(var n=0;n<e.length;n++)r!=n&&wF(e[r],e[n])&&e.splice(n,1);return e},JE=function(e){for(var r=this.nodes(),n=this.edges(),i=this.cy(),a=hF(e),s={},o=0;o<r.length;o++)s[r[o].id()]=o;for(var l=r.length,u=l*l,c=new Array(u),f,p=0;p<u;p++)c[p]=0;for(var v=0;v<n.length;v++){var y=n[v],S=s[y.source().id()],w=s[y.target().id()],E=pF(y,a.attributes);c[S*l+w]+=E,c[w*l+S]+=E}mF(c,l,a.multFactor),XM(c,l);for(var _=!0,T=0;_&&T<a.maxIterations;)_=!1,f=vF(c,l,a.expandFactor),c=yF(f,l,a.inflateFactor),xF(c,f,u,4)||(_=!0),T++;var N=bF(c,l,r,i);return N=SF(N),N},kF={markovClustering:JE,mcl:JE},_F=function(e){return e},QM=function(e,r){return Math.abs(r-e)},eT=function(e,r,n){return e+QM(r,n)},tT=function(e,r,n){return e+Math.pow(n-r,2)},CF=function(e){return Math.sqrt(e)},EF=function(e,r,n){return Math.max(e,QM(r,n))},Um=function(e,r,n,i,a){for(var s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:_F,o=i,l,u,c=0;c<e;c++)l=r(c),u=n(c),o=a(o,l,u);return s(o)},qp={euclidean:function(e,r,n){return e>=2?Um(e,r,n,0,tT,CF):Um(e,r,n,0,eT)},squaredEuclidean:function(e,r,n){return Um(e,r,n,0,tT)},manhattan:function(e,r,n){return Um(e,r,n,0,eT)},max:function(e,r,n){return Um(e,r,n,-1/0,EF)}};qp["squared-euclidean"]=qp.squaredEuclidean;qp.squaredeuclidean=qp.squaredEuclidean;function C1(t,e,r,n,i,a){var s;return ri(t)?s=t:s=qp[t]||qp.euclidean,e===0&&ri(t)?s(i,a):s(e,r,n,i,a)}var TF=Ha({k:2,m:2,sensitivityThreshold:1e-4,distance:"euclidean",maxIterations:10,attributes:[],testMode:!1,testCentroids:null}),s_=function(e){return TF(e)},ux=function(e,r,n,i,a){var s=a!=="kMedoids",o=s?function(f){return n[f]}:function(f){return i[f](n)},l=function(p){return i[p](r)},u=n,c=r;return C1(e,i.length,o,l,u,c)},cw=function(e,r,n){for(var i=n.length,a=new Array(i),s=new Array(i),o=new Array(r),l=null,u=0;u<i;u++)a[u]=e.min(n[u]).value,s[u]=e.max(n[u]).value;for(var c=0;c<r;c++){l=[];for(var f=0;f<i;f++)l[f]=Math.random()*(s[f]-a[f])+a[f];o[c]=l}return o},JM=function(e,r,n,i,a){for(var s=1/0,o=0,l=0;l<r.length;l++){var u=ux(n,e,r[l],i,a);u<s&&(s=u,o=l)}return o},eA=function(e,r,n){for(var i=[],a=null,s=0;s<r.length;s++)a=r[s],n[a.id()]===e&&i.push(a);return i},NF=function(e,r,n){return Math.abs(r-e)<=n},PF=function(e,r,n){for(var i=0;i<e.length;i++)for(var a=0;a<e[i].length;a++){var s=Math.abs(e[i][a]-r[i][a]);if(s>n)return!1}return!0},MF=function(e,r,n){for(var i=0;i<n;i++)if(e===r[i])return!0;return!1},rT=function(e,r){var n=new Array(r);if(e.length<50)for(var i=0;i<r;i++){for(var a=e[Math.floor(Math.random()*e.length)];MF(a,n,i);)a=e[Math.floor(Math.random()*e.length)];n[i]=a}else for(var s=0;s<r;s++)n[s]=e[Math.floor(Math.random()*e.length)];return n},nT=function(e,r,n){for(var i=0,a=0;a<r.length;a++)i+=ux("manhattan",r[a],e,n,"kMedoids");return i},AF=function(e){var r=this.cy(),n=this.nodes(),i=null,a=s_(e),s=new Array(a.k),o={},l;a.testMode?typeof a.testCentroids=="number"?(a.testCentroids,l=cw(n,a.k,a.attributes)):$i(a.testCentroids)==="object"?l=a.testCentroids:l=cw(n,a.k,a.attributes):l=cw(n,a.k,a.attributes);for(var u=!0,c=0;u&&c<a.maxIterations;){for(var f=0;f<n.length;f++)i=n[f],o[i.id()]=JM(i,l,a.distance,a.attributes,"kMeans");u=!1;for(var p=0;p<a.k;p++){var v=eA(p,n,o);if(v.length!==0){for(var y=a.attributes.length,S=l[p],w=new Array(y),E=new Array(y),_=0;_<y;_++){E[_]=0;for(var T=0;T<v.length;T++)i=v[T],E[_]+=a.attributes[_](i);w[_]=E[_]/v.length,NF(w[_],S[_],a.sensitivityThreshold)||(u=!0)}l[p]=w,s[p]=r.collection(v)}}c++}return s},RF=function(e){var r=this.cy(),n=this.nodes(),i=null,a=s_(e),s=new Array(a.k),o,l={},u,c=new Array(a.k);a.testMode?typeof a.testCentroids=="number"||($i(a.testCentroids)==="object"?o=a.testCentroids:o=rT(n,a.k)):o=rT(n,a.k);for(var f=!0,p=0;f&&p<a.maxIterations;){for(var v=0;v<n.length;v++)i=n[v],l[i.id()]=JM(i,o,a.distance,a.attributes,"kMedoids");f=!1;for(var y=0;y<o.length;y++){var S=eA(y,n,l);if(S.length!==0){c[y]=nT(o[y],S,a.attributes);for(var w=0;w<S.length;w++)u=nT(S[w],S,a.attributes),u<c[y]&&(c[y]=u,o[y]=S[w],f=!0);s[y]=r.collection(S)}}p++}return s},LF=function(e,r,n,i,a){for(var s,o,l=0;l<r.length;l++)for(var u=0;u<e.length;u++)i[l][u]=Math.pow(n[l][u],a.m);for(var c=0;c<e.length;c++)for(var f=0;f<a.attributes.length;f++){s=0,o=0;for(var p=0;p<r.length;p++)s+=i[p][c]*a.attributes[f](r[p]),o+=i[p][c];e[c][f]=s/o}},OF=function(e,r,n,i,a){for(var s=0;s<e.length;s++)r[s]=e[s].slice();for(var o,l,u,c=2/(a.m-1),f=0;f<n.length;f++)for(var p=0;p<i.length;p++){o=0;for(var v=0;v<n.length;v++)l=ux(a.distance,i[p],n[f],a.attributes,"cmeans"),u=ux(a.distance,i[p],n[v],a.attributes,"cmeans"),o+=Math.pow(l/u,c);e[p][f]=1/o}},DF=function(e,r,n,i){for(var a=new Array(n.k),s=0;s<a.length;s++)a[s]=[];for(var o,l,u=0;u<r.length;u++){o=-1/0,l=-1;for(var c=0;c<r[0].length;c++)r[u][c]>o&&(o=r[u][c],l=c);a[l].push(e[u])}for(var f=0;f<a.length;f++)a[f]=i.collection(a[f]);return a},iT=function(e){var r=this.cy(),n=this.nodes(),i=s_(e),a,s,o,l,u;l=new Array(n.length);for(var c=0;c<n.length;c++)l[c]=new Array(i.k);o=new Array(n.length);for(var f=0;f<n.length;f++)o[f]=new Array(i.k);for(var p=0;p<n.length;p++){for(var v=0,y=0;y<i.k;y++)o[p][y]=Math.random(),v+=o[p][y];for(var S=0;S<i.k;S++)o[p][S]=o[p][S]/v}s=new Array(i.k);for(var w=0;w<i.k;w++)s[w]=new Array(i.attributes.length);u=new Array(n.length);for(var E=0;E<n.length;E++)u[E]=new Array(i.k);for(var _=!0,T=0;_&&T<i.maxIterations;)_=!1,LF(s,n,o,u,i),OF(o,l,s,n,i),PF(o,l,i.sensitivityThreshold)||(_=!0),T++;return a=DF(n,o,i,r),{clusters:a,degreeOfMembership:o}},IF={kMeans:AF,kMedoids:RF,fuzzyCMeans:iT,fcm:iT},jF=Ha({distance:"euclidean",linkage:"min",mode:"threshold",threshold:1/0,addDendrogram:!1,dendrogramDepth:0,attributes:[]}),FF={single:"min",complete:"max"},BF=function(e){var r=jF(e),n=FF[r.linkage];return n!=null&&(r.linkage=n),r},aT=function(e,r,n,i,a){for(var s=0,o=1/0,l,u=a.attributes,c=function(j,B){return C1(a.distance,u.length,function(G){return u[G](j)},function(G){return u[G](B)},j,B)},f=0;f<e.length;f++){var p=e[f].key,v=n[p][i[p]];v<o&&(s=p,o=v)}if(a.mode==="threshold"&&o>=a.threshold||a.mode==="dendrogram"&&e.length===1)return!1;var y=r[s],S=r[i[s]],w;a.mode==="dendrogram"?w={left:y,right:S,key:y.key}:w={value:y.value.concat(S.value),key:y.key},e[y.index]=w,e.splice(S.index,1),r[y.key]=w;for(var E=0;E<e.length;E++){var _=e[E];y.key===_.key?l=1/0:a.linkage==="min"?(l=n[y.key][_.key],n[y.key][_.key]>n[S.key][_.key]&&(l=n[S.key][_.key])):a.linkage==="max"?(l=n[y.key][_.key],n[y.key][_.key]<n[S.key][_.key]&&(l=n[S.key][_.key])):a.linkage==="mean"?l=(n[y.key][_.key]*y.size+n[S.key][_.key]*S.size)/(y.size+S.size):a.mode==="dendrogram"?l=c(_.value,y.value):l=c(_.value[0],y.value[0]),n[y.key][_.key]=n[_.key][y.key]=l}for(var T=0;T<e.length;T++){var N=e[T].key;if(i[N]===y.key||i[N]===S.key){for(var R=N,I=0;I<e.length;I++){var F=e[I].key;n[N][F]<n[N][R]&&(R=F)}i[N]=R}e[T].index=T}return y.key=S.key=y.index=S.index=null,!0},Lp=function(e,r,n){e&&(e.value?r.push(e.value):(e.left&&Lp(e.left,r),e.right&&Lp(e.right,r)))},jS=function(e,r){if(!e)return"";if(e.left&&e.right){var n=jS(e.left,r),i=jS(e.right,r),a=r.add({group:"nodes",data:{id:n+","+i}});return r.add({group:"edges",data:{source:n,target:a.id()}}),r.add({group:"edges",data:{source:i,target:a.id()}}),a.id()}else if(e.value)return e.value.id()},FS=function(e,r,n){if(!e)return[];var i=[],a=[],s=[];return r===0?(e.left&&Lp(e.left,i),e.right&&Lp(e.right,a),s=i.concat(a),[n.collection(s)]):r===1?e.value?[n.collection(e.value)]:(e.left&&Lp(e.left,i),e.right&&Lp(e.right,a),[n.collection(i),n.collection(a)]):e.value?[n.collection(e.value)]:(e.left&&(i=FS(e.left,r-1,n)),e.right&&(a=FS(e.right,r-1,n)),i.concat(a))},sT=function(e){for(var r=this.cy(),n=this.nodes(),i=BF(e),a=i.attributes,s=function(T,N){return C1(i.distance,a.length,function(R){return a[R](T)},function(R){return a[R](N)},T,N)},o=[],l=[],u=[],c=[],f=0;f<n.length;f++){var p={value:i.mode==="dendrogram"?n[f]:[n[f]],key:f,index:f};o[f]=p,c[f]=p,l[f]=[],u[f]=0}for(var v=0;v<o.length;v++)for(var y=0;y<=v;y++){var S=void 0;i.mode==="dendrogram"?S=v===y?1/0:s(o[v].value,o[y].value):S=v===y?1/0:s(o[v].value[0],o[y].value[0]),l[v][y]=S,l[y][v]=S,S<l[v][u[v]]&&(u[v]=y)}for(var w=aT(o,c,l,u,i);w;)w=aT(o,c,l,u,i);var E;return i.mode==="dendrogram"?(E=FS(o[0],i.dendrogramDepth,r),i.addDendrogram&&jS(o[0],r)):(E=new Array(o.length),o.forEach(function(_,T){_.key=_.index=null,E[T]=r.collection(_.value)})),E},zF={hierarchicalClustering:sT,hca:sT},UF=Ha({distance:"euclidean",preference:"median",damping:.8,maxIterations:1e3,minIterations:100,attributes:[]}),GF=function(e){var r=e.damping,n=e.preference;.5<=r&&r<1||Kn("Damping must range on [0.5, 1).  Got: ".concat(r));var i=["median","mean","min","max"];return i.some(function(a){return a===n})||bt(n)||Kn("Preference must be one of [".concat(i.map(function(a){return"'".concat(a,"'")}).join(", "),"] or a number.  Got: ").concat(n)),UF(e)},VF=function(e,r,n,i){var a=function(o,l){return i[l](o)};return-C1(e,i.length,function(s){return a(r,s)},function(s){return a(n,s)},r,n)},HF=function(e,r){var n=null;return r==="median"?n=G9(e):r==="mean"?n=U9(e):r==="min"?n=B9(e):r==="max"?n=z9(e):n=r,n},WF=function(e,r,n){for(var i=[],a=0;a<e;a++)r[a*e+a]+n[a*e+a]>0&&i.push(a);return i},oT=function(e,r,n){for(var i=[],a=0;a<e;a++){for(var s=-1,o=-1/0,l=0;l<n.length;l++){var u=n[l];r[a*e+u]>o&&(s=u,o=r[a*e+u])}s>0&&i.push(s)}for(var c=0;c<n.length;c++)i[n[c]]=n[c];return i},qF=function(e,r,n){for(var i=oT(e,r,n),a=0;a<n.length;a++){for(var s=[],o=0;o<i.length;o++)i[o]===n[a]&&s.push(o);for(var l=-1,u=-1/0,c=0;c<s.length;c++){for(var f=0,p=0;p<s.length;p++)f+=r[s[p]*e+s[c]];f>u&&(l=c,u=f)}n[a]=s[l]}return i=oT(e,r,n),i},lT=function(e){for(var r=this.cy(),n=this.nodes(),i=GF(e),a={},s=0;s<n.length;s++)a[n[s].id()]=s;var o,l,u,c,f,p;o=n.length,l=o*o,u=new Array(l);for(var v=0;v<l;v++)u[v]=-1/0;for(var y=0;y<o;y++)for(var S=0;S<o;S++)y!==S&&(u[y*o+S]=VF(i.distance,n[y],n[S],i.attributes));c=HF(u,i.preference);for(var w=0;w<o;w++)u[w*o+w]=c;f=new Array(l);for(var E=0;E<l;E++)f[E]=0;p=new Array(l);for(var _=0;_<l;_++)p[_]=0;for(var T=new Array(o),N=new Array(o),R=new Array(o),I=0;I<o;I++)T[I]=0,N[I]=0,R[I]=0;for(var F=new Array(o*i.minIterations),D=0;D<F.length;D++)F[D]=0;var j;for(j=0;j<i.maxIterations;j++){for(var B=0;B<o;B++){for(var G=-1/0,K=-1/0,O=-1,W=0,U=0;U<o;U++)T[U]=f[B*o+U],W=p[B*o+U]+u[B*o+U],W>=G?(K=G,G=W,O=U):W>K&&(K=W);for(var q=0;q<o;q++)f[B*o+q]=(1-i.damping)*(u[B*o+q]-G)+i.damping*T[q];f[B*o+O]=(1-i.damping)*(u[B*o+O]-K)+i.damping*T[O]}for(var Z=0;Z<o;Z++){for(var Q=0,ne=0;ne<o;ne++)T[ne]=p[ne*o+Z],N[ne]=Math.max(0,f[ne*o+Z]),Q+=N[ne];Q-=N[Z],N[Z]=f[Z*o+Z],Q+=N[Z];for(var re=0;re<o;re++)p[re*o+Z]=(1-i.damping)*Math.min(0,Q-N[re])+i.damping*T[re];p[Z*o+Z]=(1-i.damping)*(Q-N[Z])+i.damping*T[Z]}for(var Y=0,J=0;J<o;J++){var ie=p[J*o+J]+f[J*o+J]>0?1:0;F[j%i.minIterations*o+J]=ie,Y+=ie}if(Y>0&&(j>=i.minIterations-1||j==i.maxIterations-1)){for(var de=0,he=0;he<o;he++){R[he]=0;for(var xe=0;xe<i.minIterations;xe++)R[he]+=F[xe*o+he];(R[he]===0||R[he]===i.minIterations)&&de++}if(de===o)break}}for(var le=WF(o,f,p),fe=qF(o,u,le),ve={},ge=0;ge<le.length;ge++)ve[le[ge]]=[];for(var se=0;se<n.length;se++){var ye=a[n[se].id()],Se=fe[ye];Se!=null&&ve[Se].push(n[se])}for(var Ue=new Array(le.length),Oe=0;Oe<le.length;Oe++)Ue[Oe]=r.collection(ve[le[Oe]]);return Ue},$F={affinityPropagation:lT,ap:lT},KF=Ha({root:void 0,directed:!1}),ZF={hierholzer:function(e){if(!Vr(e)){var r=arguments;e={root:r[0],directed:r[1]}}var n=KF(e),i=n.root,a=n.directed,s=this,o=!1,l,u,c;i&&(c=Kt(i)?this.filter(i)[0].id():i[0].id());var f={},p={};a?s.forEach(function(_){var T=_.id();if(_.isNode()){var N=_.indegree(!0),R=_.outdegree(!0),I=N-R,F=R-N;I==1?l?o=!0:l=T:F==1?u?o=!0:u=T:(F>1||I>1)&&(o=!0),f[T]=[],_.outgoers().forEach(function(D){D.isEdge()&&f[T].push(D.id())})}else p[T]=[void 0,_.target().id()]}):s.forEach(function(_){var T=_.id();if(_.isNode()){var N=_.degree(!0);N%2&&(l?u?o=!0:u=T:l=T),f[T]=[],_.connectedEdges().forEach(function(R){return f[T].push(R.id())})}else p[T]=[_.source().id(),_.target().id()]});var v={found:!1,trail:void 0};if(o)return v;if(u&&l)if(a){if(c&&u!=c)return v;c=u}else{if(c&&u!=c&&l!=c)return v;c||(c=u)}else c||(c=s[0].id());var y=function(T){for(var N=T,R=[T],I,F,D;f[N].length;)I=f[N].shift(),F=p[I][0],D=p[I][1],N!=D?(f[D]=f[D].filter(function(j){return j!=I}),N=D):!a&&N!=F&&(f[F]=f[F].filter(function(j){return j!=I}),N=F),R.unshift(I),R.unshift(N);return R},S=[],w=[];for(w=y(c);w.length!=1;)f[w[0]].length==0?(S.unshift(s.getElementById(w.shift())),S.unshift(s.getElementById(w.shift()))):w=y(w.shift()).concat(w);S.unshift(s.getElementById(w.shift()));for(var E in f)if(f[E].length)return v;return v.found=!0,v.trail=this.spawn(S,!0),v}},J0=function(){var e=this,r={},n=0,i=0,a=[],s=[],o={},l=function(p,v){for(var y=s.length-1,S=[],w=e.spawn();s[y].x!=p||s[y].y!=v;)S.push(s.pop().edge),y--;S.push(s.pop().edge),S.forEach(function(E){var _=E.connectedNodes().intersection(e);w.merge(E),_.forEach(function(T){var N=T.id(),R=T.connectedEdges().intersection(e);w.merge(T),r[N].cutVertex?w.merge(R.filter(function(I){return I.isLoop()})):w.merge(R)})}),a.push(w)},u=function(p,v,y){p===y&&(i+=1),r[v]={id:n,low:n++,cutVertex:!1};var S=e.getElementById(v).connectedEdges().intersection(e);if(S.size()===0)a.push(e.spawn(e.getElementById(v)));else{var w,E,_,T;S.forEach(function(N){w=N.source().id(),E=N.target().id(),_=w===v?E:w,_!==y&&(T=N.id(),o[T]||(o[T]=!0,s.push({x:v,y:_,edge:N})),_ in r?r[v].low=Math.min(r[v].low,r[_].id):(u(p,_,v),r[v].low=Math.min(r[v].low,r[_].low),r[v].id<=r[_].low&&(r[v].cutVertex=!0,l(v,_))))})}};e.forEach(function(f){if(f.isNode()){var p=f.id();p in r||(i=0,u(p,p),r[p].cutVertex=i>1)}});var c=Object.keys(r).filter(function(f){return r[f].cutVertex}).map(function(f){return e.getElementById(f)});return{cut:e.spawn(c),components:a}},YF={hopcroftTarjanBiconnected:J0,htbc:J0,htb:J0,hopcroftTarjanBiconnectedComponents:J0},ey=function(){var e=this,r={},n=0,i=[],a=[],s=e.spawn(e),o=function(u){a.push(u),r[u]={index:n,low:n++,explored:!1};var c=e.getElementById(u).connectedEdges().intersection(e);if(c.forEach(function(S){var w=S.target().id();w!==u&&(w in r||o(w),r[w].explored||(r[u].low=Math.min(r[u].low,r[w].low)))}),r[u].index===r[u].low){for(var f=e.spawn();;){var p=a.pop();if(f.merge(e.getElementById(p)),r[p].low=r[u].index,r[p].explored=!0,p===u)break}var v=f.edgesWith(f),y=f.merge(v);i.push(y),s=s.difference(y)}};return e.forEach(function(l){if(l.isNode()){var u=l.id();u in r||o(u)}}),{cut:s,components:i}},XF={tarjanStronglyConnected:ey,tsc:ey,tscc:ey,tarjanStronglyConnectedComponents:ey},tA={};[wv,T9,N9,M9,R9,O9,j9,cF,Fp,Bp,IS,kF,IF,zF,$F,ZF,YF,XF].forEach(function(t){ir(tA,t)});var rA=0,nA=1,iA=2,jl=function(e){if(!(this instanceof jl))return new jl(e);this.id="Thenable/1.0.7",this.state=rA,this.fulfillValue=void 0,this.rejectReason=void 0,this.onFulfilled=[],this.onRejected=[],this.proxy={then:this.then.bind(this)},typeof e=="function"&&e.call(this,this.fulfill.bind(this),this.reject.bind(this))};jl.prototype={fulfill:function(e){return uT(this,nA,"fulfillValue",e)},reject:function(e){return uT(this,iA,"rejectReason",e)},then:function(e,r){var n=this,i=new jl;return n.onFulfilled.push(dT(e,i,"fulfill")),n.onRejected.push(dT(r,i,"reject")),aA(n),i.proxy}};var uT=function(e,r,n,i){return e.state===rA&&(e.state=r,e[n]=i,aA(e)),e},aA=function(e){e.state===nA?cT(e,"onFulfilled",e.fulfillValue):e.state===iA&&cT(e,"onRejected",e.rejectReason)},cT=function(e,r,n){if(e[r].length!==0){var i=e[r];e[r]=[];var a=function(){for(var o=0;o<i.length;o++)i[o](n)};typeof setImmediate=="function"?setImmediate(a):setTimeout(a,0)}},dT=function(e,r,n){return function(i){if(typeof e!="function")r[n].call(r,i);else{var a;try{a=e(i)}catch(s){r.reject(s);return}sA(r,a)}}},sA=function(e,r){if(e===r||e.proxy===r){e.reject(new TypeError("cannot resolve promise with itself"));return}var n;if($i(r)==="object"&&r!==null||typeof r=="function")try{n=r.then}catch(a){e.reject(a);return}if(typeof n=="function"){var i=!1;try{n.call(r,function(a){i||(i=!0,a===r?e.reject(new TypeError("circular thenable chain")):sA(e,a))},function(a){i||(i=!0,e.reject(a))})}catch(a){i||e.reject(a)}return}e.fulfill(r)};jl.all=function(t){return new jl(function(e,r){for(var n=new Array(t.length),i=0,a=function(l,u){n[l]=u,i++,i===t.length&&e(n)},s=0;s<t.length;s++)(function(o){var l=t[o],u=l!=null&&l.then!=null;if(u)l.then(function(f){a(o,f)},function(f){r(f)});else{var c=l;a(o,c)}})(s)})};jl.resolve=function(t){return new jl(function(e,r){e(t)})};jl.reject=function(t){return new jl(function(e,r){r(t)})};var cm=typeof Promise<"u"?Promise:jl,BS=function(e,r,n){var i=Yk(e),a=!i,s=this._private=ir({duration:1e3},r,n);if(s.target=e,s.style=s.style||s.css,s.started=!1,s.playing=!1,s.hooked=!1,s.applying=!1,s.progress=0,s.completes=[],s.frames=[],s.complete&&ri(s.complete)&&s.completes.push(s.complete),a){var o=e.position();s.startPosition=s.startPosition||{x:o.x,y:o.y},s.startStyle=s.startStyle||e.cy().style().getAnimationStartStyle(e,s.style)}if(i){var l=e.pan();s.startPan={x:l.x,y:l.y},s.startZoom=e.zoom()}this.length=1,this[0]=this},gh=BS.prototype;ir(gh,{instanceString:function(){return"animation"},hook:function(){var e=this._private;if(!e.hooked){var r,n=e.target._private.animation;e.queue?r=n.queue:r=n.current,r.push(this),go(e.target)&&e.target.cy().addToAnimationPool(e.target),e.hooked=!0}return this},play:function(){var e=this._private;return e.progress===1&&(e.progress=0),e.playing=!0,e.started=!1,e.stopped=!1,this.hook(),this},playing:function(){return this._private.playing},apply:function(){var e=this._private;return e.applying=!0,e.started=!1,e.stopped=!1,this.hook(),this},applying:function(){return this._private.applying},pause:function(){var e=this._private;return e.playing=!1,e.started=!1,this},stop:function(){var e=this._private;return e.playing=!1,e.started=!1,e.stopped=!0,this},rewind:function(){return this.progress(0)},fastforward:function(){return this.progress(1)},time:function(e){var r=this._private;return e===void 0?r.progress*r.duration:this.progress(e/r.duration)},progress:function(e){var r=this._private,n=r.playing;return e===void 0?r.progress:(n&&this.pause(),r.progress=e,r.started=!1,n&&this.play(),this)},completed:function(){return this._private.progress===1},reverse:function(){var e=this._private,r=e.playing;r&&this.pause(),e.progress=1-e.progress,e.started=!1;var n=function(u,c){var f=e[u];f!=null&&(e[u]=e[c],e[c]=f)};if(n("zoom","startZoom"),n("pan","startPan"),n("position","startPosition"),e.style)for(var i=0;i<e.style.length;i++){var a=e.style[i],s=a.name,o=e.startStyle[s];e.startStyle[s]=a,e.style[i]=o}return r&&this.play(),this},promise:function(e){var r=this._private,n;switch(e){case"frame":n=r.frames;break;default:case"complete":case"completed":n=r.completes}return new cm(function(i,a){n.push(function(){i()})})}});gh.complete=gh.completed;gh.run=gh.play;gh.running=gh.playing;var QF={animated:function(){return function(){var r=this,n=r.length!==void 0,i=n?r:[r],a=this._private.cy||this;if(!a.styleEnabled())return!1;var s=i[0];if(s)return s._private.animation.current.length>0}},clearQueue:function(){return function(){var r=this,n=r.length!==void 0,i=n?r:[r],a=this._private.cy||this;if(!a.styleEnabled())return this;for(var s=0;s<i.length;s++){var o=i[s];o._private.animation.queue=[]}return this}},delay:function(){return function(r,n){var i=this._private.cy||this;return i.styleEnabled()?this.animate({delay:r,duration:r,complete:n}):this}},delayAnimation:function(){return function(r,n){var i=this._private.cy||this;return i.styleEnabled()?this.animation({delay:r,duration:r,complete:n}):this}},animation:function(){return function(r,n){var i=this,a=i.length!==void 0,s=a?i:[i],o=this._private.cy||this,l=!a,u=!l;if(!o.styleEnabled())return this;var c=o.style();r=ir({},r,n);var f=Object.keys(r).length===0;if(f)return new BS(s[0],r);switch(r.duration===void 0&&(r.duration=400),r.duration){case"slow":r.duration=600;break;case"fast":r.duration=200;break}if(u&&(r.style=c.getPropsList(r.style||r.css),r.css=void 0),u&&r.renderedPosition!=null){var p=r.renderedPosition,v=o.pan(),y=o.zoom();r.position=WM(p,y,v)}if(l&&r.panBy!=null){var S=r.panBy,w=o.pan();r.pan={x:w.x+S.x,y:w.y+S.y}}var E=r.center||r.centre;if(l&&E!=null){var _=o.getCenterPan(E.eles,r.zoom);_!=null&&(r.pan=_)}if(l&&r.fit!=null){var T=r.fit,N=o.getFitViewport(T.eles||T.boundingBox,T.padding);N!=null&&(r.pan=N.pan,r.zoom=N.zoom)}if(l&&Vr(r.zoom)){var R=o.getZoomedViewport(r.zoom);R!=null?(R.zoomed&&(r.zoom=R.zoom),R.panned&&(r.pan=R.pan)):r.zoom=null}return new BS(s[0],r)}},animate:function(){return function(r,n){var i=this,a=i.length!==void 0,s=a?i:[i],o=this._private.cy||this;if(!o.styleEnabled())return this;n&&(r=ir({},r,n));for(var l=0;l<s.length;l++){var u=s[l],c=u.animated()&&(r.queue===void 0||r.queue),f=u.animation(r,c?{queue:!0}:void 0);f.play()}return this}},stop:function(){return function(r,n){var i=this,a=i.length!==void 0,s=a?i:[i],o=this._private.cy||this;if(!o.styleEnabled())return this;for(var l=0;l<s.length;l++){for(var u=s[l],c=u._private,f=c.animation.current,p=0;p<f.length;p++){var v=f[p],y=v._private;n&&(y.duration=0)}r&&(c.animation.queue=[]),n||(c.animation.current=[])}return o.notify("draw"),this}}},dw,fT;function E1(){if(fT)return dw;fT=1;var t=Array.isArray;return dw=t,dw}var fw,hT;function JF(){if(hT)return fw;hT=1;var t=E1(),e=Xv(),r=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,n=/^\w*$/;function i(a,s){if(t(a))return!1;var o=typeof a;return o=="number"||o=="symbol"||o=="boolean"||a==null||e(a)?!0:n.test(a)||!r.test(a)||s!=null&&a in Object(s)}return fw=i,fw}var hw,pT;function eB(){if(pT)return hw;pT=1;var t=IM(),e=Yv(),r="[object AsyncFunction]",n="[object Function]",i="[object GeneratorFunction]",a="[object Proxy]";function s(o){if(!e(o))return!1;var l=t(o);return l==n||l==i||l==r||l==a}return hw=s,hw}var pw,mT;function tB(){if(mT)return pw;mT=1;var t=S1(),e=t["__core-js_shared__"];return pw=e,pw}var mw,gT;function rB(){if(gT)return mw;gT=1;var t=tB(),e=(function(){var n=/[^.]+$/.exec(t&&t.keys&&t.keys.IE_PROTO||"");return n?"Symbol(src)_1."+n:""})();function r(n){return!!e&&e in n}return mw=r,mw}var gw,vT;function nB(){if(vT)return gw;vT=1;var t=Function.prototype,e=t.toString;function r(n){if(n!=null){try{return e.call(n)}catch{}try{return n+""}catch{}}return""}return gw=r,gw}var vw,yT;function iB(){if(yT)return vw;yT=1;var t=eB(),e=rB(),r=Yv(),n=nB(),i=/[\\^$.*+?()[\]{}|]/g,a=/^\[object .+?Constructor\]$/,s=Function.prototype,o=Object.prototype,l=s.toString,u=o.hasOwnProperty,c=RegExp("^"+l.call(u).replace(i,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function f(p){if(!r(p)||e(p))return!1;var v=t(p)?c:a;return v.test(n(p))}return vw=f,vw}var yw,xT;function aB(){if(xT)return yw;xT=1;function t(e,r){return e?.[r]}return yw=t,yw}var xw,bT;function o_(){if(bT)return xw;bT=1;var t=iB(),e=aB();function r(n,i){var a=e(n,i);return t(a)?a:void 0}return xw=r,xw}var bw,wT;function T1(){if(wT)return bw;wT=1;var t=o_(),e=t(Object,"create");return bw=e,bw}var ww,ST;function sB(){if(ST)return ww;ST=1;var t=T1();function e(){this.__data__=t?t(null):{},this.size=0}return ww=e,ww}var Sw,kT;function oB(){if(kT)return Sw;kT=1;function t(e){var r=this.has(e)&&delete this.__data__[e];return this.size-=r?1:0,r}return Sw=t,Sw}var kw,_T;function lB(){if(_T)return kw;_T=1;var t=T1(),e="__lodash_hash_undefined__",r=Object.prototype,n=r.hasOwnProperty;function i(a){var s=this.__data__;if(t){var o=s[a];return o===e?void 0:o}return n.call(s,a)?s[a]:void 0}return kw=i,kw}var _w,CT;function uB(){if(CT)return _w;CT=1;var t=T1(),e=Object.prototype,r=e.hasOwnProperty;function n(i){var a=this.__data__;return t?a[i]!==void 0:r.call(a,i)}return _w=n,_w}var Cw,ET;function cB(){if(ET)return Cw;ET=1;var t=T1(),e="__lodash_hash_undefined__";function r(n,i){var a=this.__data__;return this.size+=this.has(n)?0:1,a[n]=t&&i===void 0?e:i,this}return Cw=r,Cw}var Ew,TT;function dB(){if(TT)return Ew;TT=1;var t=sB(),e=oB(),r=lB(),n=uB(),i=cB();function a(s){var o=-1,l=s==null?0:s.length;for(this.clear();++o<l;){var u=s[o];this.set(u[0],u[1])}}return a.prototype.clear=t,a.prototype.delete=e,a.prototype.get=r,a.prototype.has=n,a.prototype.set=i,Ew=a,Ew}var Tw,NT;function fB(){if(NT)return Tw;NT=1;function t(){this.__data__=[],this.size=0}return Tw=t,Tw}var Nw,PT;function oA(){if(PT)return Nw;PT=1;function t(e,r){return e===r||e!==e&&r!==r}return Nw=t,Nw}var Pw,MT;function N1(){if(MT)return Pw;MT=1;var t=oA();function e(r,n){for(var i=r.length;i--;)if(t(r[i][0],n))return i;return-1}return Pw=e,Pw}var Mw,AT;function hB(){if(AT)return Mw;AT=1;var t=N1(),e=Array.prototype,r=e.splice;function n(i){var a=this.__data__,s=t(a,i);if(s<0)return!1;var o=a.length-1;return s==o?a.pop():r.call(a,s,1),--this.size,!0}return Mw=n,Mw}var Aw,RT;function pB(){if(RT)return Aw;RT=1;var t=N1();function e(r){var n=this.__data__,i=t(n,r);return i<0?void 0:n[i][1]}return Aw=e,Aw}var Rw,LT;function mB(){if(LT)return Rw;LT=1;var t=N1();function e(r){return t(this.__data__,r)>-1}return Rw=e,Rw}var Lw,OT;function gB(){if(OT)return Lw;OT=1;var t=N1();function e(r,n){var i=this.__data__,a=t(i,r);return a<0?(++this.size,i.push([r,n])):i[a][1]=n,this}return Lw=e,Lw}var Ow,DT;function vB(){if(DT)return Ow;DT=1;var t=fB(),e=hB(),r=pB(),n=mB(),i=gB();function a(s){var o=-1,l=s==null?0:s.length;for(this.clear();++o<l;){var u=s[o];this.set(u[0],u[1])}}return a.prototype.clear=t,a.prototype.delete=e,a.prototype.get=r,a.prototype.has=n,a.prototype.set=i,Ow=a,Ow}var Dw,IT;function yB(){if(IT)return Dw;IT=1;var t=o_(),e=S1(),r=t(e,"Map");return Dw=r,Dw}var Iw,jT;function xB(){if(jT)return Iw;jT=1;var t=dB(),e=vB(),r=yB();function n(){this.size=0,this.__data__={hash:new t,map:new(r||e),string:new t}}return Iw=n,Iw}var jw,FT;function bB(){if(FT)return jw;FT=1;function t(e){var r=typeof e;return r=="string"||r=="number"||r=="symbol"||r=="boolean"?e!=="__proto__":e===null}return jw=t,jw}var Fw,BT;function P1(){if(BT)return Fw;BT=1;var t=bB();function e(r,n){var i=r.__data__;return t(n)?i[typeof n=="string"?"string":"hash"]:i.map}return Fw=e,Fw}var Bw,zT;function wB(){if(zT)return Bw;zT=1;var t=P1();function e(r){var n=t(this,r).delete(r);return this.size-=n?1:0,n}return Bw=e,Bw}var zw,UT;function SB(){if(UT)return zw;UT=1;var t=P1();function e(r){return t(this,r).get(r)}return zw=e,zw}var Uw,GT;function kB(){if(GT)return Uw;GT=1;var t=P1();function e(r){return t(this,r).has(r)}return Uw=e,Uw}var Gw,VT;function _B(){if(VT)return Gw;VT=1;var t=P1();function e(r,n){var i=t(this,r),a=i.size;return i.set(r,n),this.size+=i.size==a?0:1,this}return Gw=e,Gw}var Vw,HT;function CB(){if(HT)return Vw;HT=1;var t=xB(),e=wB(),r=SB(),n=kB(),i=_B();function a(s){var o=-1,l=s==null?0:s.length;for(this.clear();++o<l;){var u=s[o];this.set(u[0],u[1])}}return a.prototype.clear=t,a.prototype.delete=e,a.prototype.get=r,a.prototype.has=n,a.prototype.set=i,Vw=a,Vw}var Hw,WT;function EB(){if(WT)return Hw;WT=1;var t=CB(),e="Expected a function";function r(n,i){if(typeof n!="function"||i!=null&&typeof i!="function")throw new TypeError(e);var a=function(){var s=arguments,o=i?i.apply(this,s):s[0],l=a.cache;if(l.has(o))return l.get(o);var u=n.apply(this,s);return a.cache=l.set(o,u)||l,u};return a.cache=new(r.Cache||t),a}return r.Cache=t,Hw=r,Hw}var Ww,qT;function TB(){if(qT)return Ww;qT=1;var t=EB(),e=500;function r(n){var i=t(n,function(s){return a.size===e&&a.clear(),s}),a=i.cache;return i}return Ww=r,Ww}var qw,$T;function lA(){if($T)return qw;$T=1;var t=TB(),e=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,r=/\\(\\)?/g,n=t(function(i){var a=[];return i.charCodeAt(0)===46&&a.push(""),i.replace(e,function(s,o,l,u){a.push(l?u.replace(r,"$1"):o||s)}),a});return qw=n,qw}var $w,KT;function uA(){if(KT)return $w;KT=1;function t(e,r){for(var n=-1,i=e==null?0:e.length,a=Array(i);++n<i;)a[n]=r(e[n],n,e);return a}return $w=t,$w}var Kw,ZT;function NB(){if(ZT)return Kw;ZT=1;var t=Qk(),e=uA(),r=E1(),n=Xv(),i=t?t.prototype:void 0,a=i?i.toString:void 0;function s(o){if(typeof o=="string")return o;if(r(o))return e(o,s)+"";if(n(o))return a?a.call(o):"";var l=o+"";return l=="0"&&1/o==-1/0?"-0":l}return Kw=s,Kw}var Zw,YT;function cA(){if(YT)return Zw;YT=1;var t=NB();function e(r){return r==null?"":t(r)}return Zw=e,Zw}var Yw,XT;function dA(){if(XT)return Yw;XT=1;var t=E1(),e=JF(),r=lA(),n=cA();function i(a,s){return t(a)?a:e(a,s)?[a]:r(n(a))}return Yw=i,Yw}var Xw,QT;function l_(){if(QT)return Xw;QT=1;var t=Xv();function e(r){if(typeof r=="string"||t(r))return r;var n=r+"";return n=="0"&&1/r==-1/0?"-0":n}return Xw=e,Xw}var Qw,JT;function PB(){if(JT)return Qw;JT=1;var t=dA(),e=l_();function r(n,i){i=t(i,n);for(var a=0,s=i.length;n!=null&&a<s;)n=n[e(i[a++])];return a&&a==s?n:void 0}return Qw=r,Qw}var Jw,eN;function MB(){if(eN)return Jw;eN=1;var t=PB();function e(r,n,i){var a=r==null?void 0:t(r,n);return a===void 0?i:a}return Jw=e,Jw}var AB=MB(),RB=Zv(AB),e2,tN;function LB(){if(tN)return e2;tN=1;var t=o_(),e=(function(){try{var r=t(Object,"defineProperty");return r({},"",{}),r}catch{}})();return e2=e,e2}var t2,rN;function OB(){if(rN)return t2;rN=1;var t=LB();function e(r,n,i){n=="__proto__"&&t?t(r,n,{configurable:!0,enumerable:!0,value:i,writable:!0}):r[n]=i}return t2=e,t2}var r2,nN;function DB(){if(nN)return r2;nN=1;var t=OB(),e=oA(),r=Object.prototype,n=r.hasOwnProperty;function i(a,s,o){var l=a[s];(!(n.call(a,s)&&e(l,o))||o===void 0&&!(s in a))&&t(a,s,o)}return r2=i,r2}var n2,iN;function IB(){if(iN)return n2;iN=1;var t=9007199254740991,e=/^(?:0|[1-9]\d*)$/;function r(n,i){var a=typeof n;return i=i??t,!!i&&(a=="number"||a!="symbol"&&e.test(n))&&n>-1&&n%1==0&&n<i}return n2=r,n2}var i2,aN;function jB(){if(aN)return i2;aN=1;var t=DB(),e=dA(),r=IB(),n=Yv(),i=l_();function a(s,o,l,u){if(!n(s))return s;o=e(o,s);for(var c=-1,f=o.length,p=f-1,v=s;v!=null&&++c<f;){var y=i(o[c]),S=l;if(y==="__proto__"||y==="constructor"||y==="prototype")return s;if(c!=p){var w=v[y];S=u?u(w,y,v):void 0,S===void 0&&(S=n(w)?w:r(o[c+1])?[]:{})}t(v,y,S),v=v[y]}return s}return i2=a,i2}var a2,sN;function FB(){if(sN)return a2;sN=1;var t=jB();function e(r,n,i){return r==null?r:t(r,n,i)}return a2=e,a2}var BB=FB(),zB=Zv(BB),s2,oN;function UB(){if(oN)return s2;oN=1;function t(e,r){var n=-1,i=e.length;for(r||(r=Array(i));++n<i;)r[n]=e[n];return r}return s2=t,s2}var o2,lN;function GB(){if(lN)return o2;lN=1;var t=uA(),e=UB(),r=E1(),n=Xv(),i=lA(),a=l_(),s=cA();function o(l){return r(l)?t(l,a):n(l)?[l]:e(i(s(l)))}return o2=o,o2}var VB=GB(),HB=Zv(VB),WB={data:function(e){var r={field:"data",bindingEvent:"data",allowBinding:!1,allowSetting:!1,allowGetting:!1,settingEvent:"data",settingTriggersEvent:!1,triggerFnName:"trigger",immutableKeys:{},updateStyle:!1,beforeGet:function(i){},beforeSet:function(i,a){},onSet:function(i){},canSet:function(i){return!0}};return e=ir({},r,e),function(i,a){var s=e,o=this,l=o.length!==void 0,u=l?o:[o],c=l?o[0]:o;if(Kt(i)){var f=i.indexOf(".")!==-1,p=f&&HB(i);if(s.allowGetting&&a===void 0){var v;return c&&(s.beforeGet(c),p&&c._private[s.field][i]===void 0?v=RB(c._private[s.field],p):v=c._private[s.field][i]),v}else if(s.allowSetting&&a!==void 0){var y=!s.immutableKeys[i];if(y){var S=EM({},i,a);s.beforeSet(o,S);for(var w=0,E=u.length;w<E;w++){var _=u[w];s.canSet(_)&&(p&&c._private[s.field][i]===void 0?zB(_._private[s.field],p,a):_._private[s.field][i]=a)}s.updateStyle&&o.updateStyle(),s.onSet(o),s.settingTriggersEvent&&o[s.triggerFnName](s.settingEvent)}}}else if(s.allowSetting&&Vr(i)){var T=i,N,R,I=Object.keys(T);s.beforeSet(o,T);for(var F=0;F<I.length;F++){N=I[F],R=T[N];var D=!s.immutableKeys[N];if(D)for(var j=0;j<u.length;j++){var B=u[j];s.canSet(B)&&(B._private[s.field][N]=R)}}s.updateStyle&&o.updateStyle(),s.onSet(o),s.settingTriggersEvent&&o[s.triggerFnName](s.settingEvent)}else if(s.allowBinding&&ri(i)){var G=i;o.on(s.bindingEvent,G)}else if(s.allowGetting&&i===void 0){var K;return c&&(s.beforeGet(c),K=c._private[s.field]),K}return o}},removeData:function(e){var r={field:"data",event:"data",triggerFnName:"trigger",triggerEvent:!1,immutableKeys:{}};return e=ir({},r,e),function(i){var a=e,s=this,o=s.length!==void 0,l=o?s:[s];if(Kt(i)){for(var u=i.split(/\s+/),c=u.length,f=0;f<c;f++){var p=u[f];if(!Zd(p)){var v=!a.immutableKeys[p];if(v)for(var y=0,S=l.length;y<S;y++)l[y]._private[a.field][p]=void 0}}a.triggerEvent&&s[a.triggerFnName](a.event)}else if(i===void 0){for(var w=0,E=l.length;w<E;w++)for(var _=l[w]._private[a.field],T=Object.keys(_),N=0;N<T.length;N++){var R=T[N],I=!a.immutableKeys[R];I&&(_[R]=void 0)}a.triggerEvent&&s[a.triggerFnName](a.event)}return s}}},qB={eventAliasesOn:function(e){var r=e;r.addListener=r.listen=r.bind=r.on,r.unlisten=r.unbind=r.off=r.removeListener,r.trigger=r.emit,r.pon=r.promiseOn=function(n,i){var a=this,s=Array.prototype.slice.call(arguments,0);return new cm(function(o,l){var u=function(v){a.off.apply(a,f),o(v)},c=s.concat([u]),f=c.concat([]);a.on.apply(a,c)})}}},nn={};[QF,WB,qB].forEach(function(t){ir(nn,t)});var $B={animate:nn.animate(),animation:nn.animation(),animated:nn.animated(),clearQueue:nn.clearQueue(),delay:nn.delay(),delayAnimation:nn.delayAnimation(),stop:nn.stop()},jy={classes:function(e){var r=this;if(e===void 0){var n=[];return r[0]._private.classes.forEach(function(y){return n.push(y)}),n}else Sn(e)||(e=(e||"").match(/\S+/g)||[]);for(var i=[],a=new um(e),s=0;s<r.length;s++){for(var o=r[s],l=o._private,u=l.classes,c=!1,f=0;f<e.length;f++){var p=e[f],v=u.has(p);if(!v){c=!0;break}}c||(c=u.size!==e.length),c&&(l.classes=a,i.push(o))}return i.length>0&&this.spawn(i).updateStyle().emit("class"),r},addClass:function(e){return this.toggleClass(e,!0)},hasClass:function(e){var r=this[0];return r!=null&&r._private.classes.has(e)},toggleClass:function(e,r){Sn(e)||(e=e.match(/\S+/g)||[]);for(var n=this,i=r===void 0,a=[],s=0,o=n.length;s<o;s++)for(var l=n[s],u=l._private.classes,c=!1,f=0;f<e.length;f++){var p=e[f],v=u.has(p),y=!1;r||i&&!v?(u.add(p),y=!0):(!r||i&&v)&&(u.delete(p),y=!0),!c&&y&&(a.push(l),c=!0)}return a.length>0&&this.spawn(a).updateStyle().emit("class"),n},removeClass:function(e){return this.toggleClass(e,!1)},flashClass:function(e,r){var n=this;if(r==null)r=250;else if(r===0)return n;return n.addClass(e),setTimeout(function(){n.removeClass(e)},r),n}};jy.className=jy.classNames=jy.classes;var Gr={metaChar:"[\\!\\\"\\#\\$\\%\\&\\'\\(\\)\\*\\+\\,\\.\\/\\:\\;\\<\\=\\>\\?\\@\\[\\]\\^\\`\\{\\|\\}\\~]",comparatorOp:"=|\\!=|>|>=|<|<=|\\$=|\\^=|\\*=",boolOp:"\\?|\\!|\\^",string:`"(?:\\\\"|[^"])*"|'(?:\\\\'|[^'])*'`,number:Wi,meta:"degree|indegree|outdegree",separator:"\\s*,\\s*",descendant:"\\s+",child:"\\s+>\\s+",subject:"\\$",group:"node|edge|\\*",directedEdge:"\\s+->\\s+",undirectedEdge:"\\s+<->\\s+"};Gr.variable="(?:[\\w-.]|(?:\\\\"+Gr.metaChar+"))+";Gr.className="(?:[\\w-]|(?:\\\\"+Gr.metaChar+"))+";Gr.value=Gr.string+"|"+Gr.number;Gr.id=Gr.variable;(function(){var t,e,r;for(t=Gr.comparatorOp.split("|"),r=0;r<t.length;r++)e=t[r],Gr.comparatorOp+="|@"+e;for(t=Gr.comparatorOp.split("|"),r=0;r<t.length;r++)e=t[r],!(e.indexOf("!")>=0)&&e!=="="&&(Gr.comparatorOp+="|\\!"+e)})();var vn=function(){return{checks:[]}},Dt={GROUP:0,COLLECTION:1,FILTER:2,DATA_COMPARE:3,DATA_EXIST:4,DATA_BOOL:5,META_COMPARE:6,STATE:7,ID:8,CLASS:9,UNDIRECTED_EDGE:10,DIRECTED_EDGE:11,NODE_SOURCE:12,NODE_TARGET:13,NODE_NEIGHBOR:14,CHILD:15,DESCENDANT:16,PARENT:17,ANCESTOR:18,COMPOUND_SPLIT:19,TRUE:20},zS=[{selector:":selected",matches:function(e){return e.selected()}},{selector:":unselected",matches:function(e){return!e.selected()}},{selector:":selectable",matches:function(e){return e.selectable()}},{selector:":unselectable",matches:function(e){return!e.selectable()}},{selector:":locked",matches:function(e){return e.locked()}},{selector:":unlocked",matches:function(e){return!e.locked()}},{selector:":visible",matches:function(e){return e.visible()}},{selector:":hidden",matches:function(e){return!e.visible()}},{selector:":transparent",matches:function(e){return e.transparent()}},{selector:":grabbed",matches:function(e){return e.grabbed()}},{selector:":free",matches:function(e){return!e.grabbed()}},{selector:":removed",matches:function(e){return e.removed()}},{selector:":inside",matches:function(e){return!e.removed()}},{selector:":grabbable",matches:function(e){return e.grabbable()}},{selector:":ungrabbable",matches:function(e){return!e.grabbable()}},{selector:":animated",matches:function(e){return e.animated()}},{selector:":unanimated",matches:function(e){return!e.animated()}},{selector:":parent",matches:function(e){return e.isParent()}},{selector:":childless",matches:function(e){return e.isChildless()}},{selector:":child",matches:function(e){return e.isChild()}},{selector:":orphan",matches:function(e){return e.isOrphan()}},{selector:":nonorphan",matches:function(e){return e.isChild()}},{selector:":compound",matches:function(e){return e.isNode()?e.isParent():e.source().isParent()||e.target().isParent()}},{selector:":loop",matches:function(e){return e.isLoop()}},{selector:":simple",matches:function(e){return e.isSimple()}},{selector:":active",matches:function(e){return e.active()}},{selector:":inactive",matches:function(e){return!e.active()}},{selector:":backgrounding",matches:function(e){return e.backgrounding()}},{selector:":nonbackgrounding",matches:function(e){return!e.backgrounding()}}].sort(function(t,e){return Wj(t.selector,e.selector)}),KB=(function(){for(var t={},e,r=0;r<zS.length;r++)e=zS[r],t[e.selector]=e.matches;return t})(),ZB=function(e,r){return KB[e](r)},YB="("+zS.map(function(t){return t.selector}).join("|")+")",fp=function(e){return e.replace(new RegExp("\\\\("+Gr.metaChar+")","g"),function(r,n){return n})},yd=function(e,r,n){e[e.length-1]=n},US=[{name:"group",query:!0,regex:"("+Gr.group+")",populate:function(e,r,n){var i=Di(n,1),a=i[0];r.checks.push({type:Dt.GROUP,value:a==="*"?a:a+"s"})}},{name:"state",query:!0,regex:YB,populate:function(e,r,n){var i=Di(n,1),a=i[0];r.checks.push({type:Dt.STATE,value:a})}},{name:"id",query:!0,regex:"\\#("+Gr.id+")",populate:function(e,r,n){var i=Di(n,1),a=i[0];r.checks.push({type:Dt.ID,value:fp(a)})}},{name:"className",query:!0,regex:"\\.("+Gr.className+")",populate:function(e,r,n){var i=Di(n,1),a=i[0];r.checks.push({type:Dt.CLASS,value:fp(a)})}},{name:"dataExists",query:!0,regex:"\\[\\s*("+Gr.variable+")\\s*\\]",populate:function(e,r,n){var i=Di(n,1),a=i[0];r.checks.push({type:Dt.DATA_EXIST,field:fp(a)})}},{name:"dataCompare",query:!0,regex:"\\[\\s*("+Gr.variable+")\\s*("+Gr.comparatorOp+")\\s*("+Gr.value+")\\s*\\]",populate:function(e,r,n){var i=Di(n,3),a=i[0],s=i[1],o=i[2],l=new RegExp("^"+Gr.string+"$").exec(o)!=null;l?o=o.substring(1,o.length-1):o=parseFloat(o),r.checks.push({type:Dt.DATA_COMPARE,field:fp(a),operator:s,value:o})}},{name:"dataBool",query:!0,regex:"\\[\\s*("+Gr.boolOp+")\\s*("+Gr.variable+")\\s*\\]",populate:function(e,r,n){var i=Di(n,2),a=i[0],s=i[1];r.checks.push({type:Dt.DATA_BOOL,field:fp(s),operator:a})}},{name:"metaCompare",query:!0,regex:"\\[\\[\\s*("+Gr.meta+")\\s*("+Gr.comparatorOp+")\\s*("+Gr.number+")\\s*\\]\\]",populate:function(e,r,n){var i=Di(n,3),a=i[0],s=i[1],o=i[2];r.checks.push({type:Dt.META_COMPARE,field:fp(a),operator:s,value:parseFloat(o)})}},{name:"nextQuery",separator:!0,regex:Gr.separator,populate:function(e,r){var n=e.currentSubject,i=e.edgeCount,a=e.compoundCount,s=e[e.length-1];n!=null&&(s.subject=n,e.currentSubject=null),s.edgeCount=i,s.compoundCount=a,e.edgeCount=0,e.compoundCount=0;var o=e[e.length++]=vn();return o}},{name:"directedEdge",separator:!0,regex:Gr.directedEdge,populate:function(e,r){if(e.currentSubject==null){var n=vn(),i=r,a=vn();return n.checks.push({type:Dt.DIRECTED_EDGE,source:i,target:a}),yd(e,r,n),e.edgeCount++,a}else{var s=vn(),o=r,l=vn();return s.checks.push({type:Dt.NODE_SOURCE,source:o,target:l}),yd(e,r,s),e.edgeCount++,l}}},{name:"undirectedEdge",separator:!0,regex:Gr.undirectedEdge,populate:function(e,r){if(e.currentSubject==null){var n=vn(),i=r,a=vn();return n.checks.push({type:Dt.UNDIRECTED_EDGE,nodes:[i,a]}),yd(e,r,n),e.edgeCount++,a}else{var s=vn(),o=r,l=vn();return s.checks.push({type:Dt.NODE_NEIGHBOR,node:o,neighbor:l}),yd(e,r,s),l}}},{name:"child",separator:!0,regex:Gr.child,populate:function(e,r){if(e.currentSubject==null){var n=vn(),i=vn(),a=e[e.length-1];return n.checks.push({type:Dt.CHILD,parent:a,child:i}),yd(e,r,n),e.compoundCount++,i}else if(e.currentSubject===r){var s=vn(),o=e[e.length-1],l=vn(),u=vn(),c=vn(),f=vn();return s.checks.push({type:Dt.COMPOUND_SPLIT,left:o,right:l,subject:u}),u.checks=r.checks,r.checks=[{type:Dt.TRUE}],f.checks.push({type:Dt.TRUE}),l.checks.push({type:Dt.PARENT,parent:f,child:c}),yd(e,o,s),e.currentSubject=u,e.compoundCount++,c}else{var p=vn(),v=vn(),y=[{type:Dt.PARENT,parent:p,child:v}];return p.checks=r.checks,r.checks=y,e.compoundCount++,v}}},{name:"descendant",separator:!0,regex:Gr.descendant,populate:function(e,r){if(e.currentSubject==null){var n=vn(),i=vn(),a=e[e.length-1];return n.checks.push({type:Dt.DESCENDANT,ancestor:a,descendant:i}),yd(e,r,n),e.compoundCount++,i}else if(e.currentSubject===r){var s=vn(),o=e[e.length-1],l=vn(),u=vn(),c=vn(),f=vn();return s.checks.push({type:Dt.COMPOUND_SPLIT,left:o,right:l,subject:u}),u.checks=r.checks,r.checks=[{type:Dt.TRUE}],f.checks.push({type:Dt.TRUE}),l.checks.push({type:Dt.ANCESTOR,ancestor:f,descendant:c}),yd(e,o,s),e.currentSubject=u,e.compoundCount++,c}else{var p=vn(),v=vn(),y=[{type:Dt.ANCESTOR,ancestor:p,descendant:v}];return p.checks=r.checks,r.checks=y,e.compoundCount++,v}}},{name:"subject",modifier:!0,regex:Gr.subject,populate:function(e,r){if(e.currentSubject!=null&&e.currentSubject!==r)return an("Redefinition of subject in selector `"+e.toString()+"`"),!1;e.currentSubject=r;var n=e[e.length-1],i=n.checks[0],a=i==null?null:i.type;a===Dt.DIRECTED_EDGE?i.type=Dt.NODE_TARGET:a===Dt.UNDIRECTED_EDGE&&(i.type=Dt.NODE_NEIGHBOR,i.node=i.nodes[1],i.neighbor=i.nodes[0],i.nodes=null)}}];US.forEach(function(t){return t.regexObj=new RegExp("^"+t.regex)});var XB=function(e){for(var r,n,i,a=0;a<US.length;a++){var s=US[a],o=s.name,l=e.match(s.regexObj);if(l!=null){n=l,r=s,i=o;var u=l[0];e=e.substring(u.length);break}}return{expr:r,match:n,name:i,remaining:e}},QB=function(e){var r=e.match(/^\s+/);if(r){var n=r[0];e=e.substring(n.length)}return e},JB=function(e){var r=this,n=r.inputText=e,i=r[0]=vn();for(r.length=1,n=QB(n);;){var a=XB(n);if(a.expr==null)return an("The selector `"+e+"`is invalid"),!1;var s=a.match.slice(1),o=a.expr.populate(r,i,s);if(o===!1)return!1;if(o!=null&&(i=o),n=a.remaining,n.match(/^\s*$/))break}var l=r[r.length-1];r.currentSubject!=null&&(l.subject=r.currentSubject),l.edgeCount=r.edgeCount,l.compoundCount=r.compoundCount;for(var u=0;u<r.length;u++){var c=r[u];if(c.compoundCount>0&&c.edgeCount>0)return an("The selector `"+e+"` is invalid because it uses both a compound selector and an edge selector"),!1;if(c.edgeCount>1)return an("The selector `"+e+"` is invalid because it uses multiple edge selectors"),!1;c.edgeCount===1&&an("The selector `"+e+"` is deprecated.  Edge selectors do not take effect on changes to source and target nodes after an edge is added, for performance reasons.  Use a class or data selector on edges instead, updating the class or data of an edge when your app detects a change in source or target nodes.")}return!0},e7=function(){if(this.toStringCache!=null)return this.toStringCache;for(var e=function(c){return c??""},r=function(c){return Kt(c)?'"'+c+'"':e(c)},n=function(c){return" "+c+" "},i=function(c,f){var p=c.type,v=c.value;switch(p){case Dt.GROUP:{var y=e(v);return y.substring(0,y.length-1)}case Dt.DATA_COMPARE:{var S=c.field,w=c.operator;return"["+S+n(e(w))+r(v)+"]"}case Dt.DATA_BOOL:{var E=c.operator,_=c.field;return"["+e(E)+_+"]"}case Dt.DATA_EXIST:{var T=c.field;return"["+T+"]"}case Dt.META_COMPARE:{var N=c.operator,R=c.field;return"[["+R+n(e(N))+r(v)+"]]"}case Dt.STATE:return v;case Dt.ID:return"#"+v;case Dt.CLASS:return"."+v;case Dt.PARENT:case Dt.CHILD:return a(c.parent,f)+n(">")+a(c.child,f);case Dt.ANCESTOR:case Dt.DESCENDANT:return a(c.ancestor,f)+" "+a(c.descendant,f);case Dt.COMPOUND_SPLIT:{var I=a(c.left,f),F=a(c.subject,f),D=a(c.right,f);return I+(I.length>0?" ":"")+F+D}case Dt.TRUE:return""}},a=function(c,f){return c.checks.reduce(function(p,v,y){return p+(f===c&&y===0?"$":"")+i(v,f)},"")},s="",o=0;o<this.length;o++){var l=this[o];s+=a(l,l.subject),this.length>1&&o<this.length-1&&(s+=", ")}return this.toStringCache=s,s},t7={parse:JB,toString:e7},fA=function(e,r,n){var i,a=Kt(e),s=bt(e),o=Kt(n),l,u,c=!1,f=!1,p=!1;switch(r.indexOf("!")>=0&&(r=r.replace("!",""),f=!0),r.indexOf("@")>=0&&(r=r.replace("@",""),c=!0),(a||o||c)&&(l=!a&&!s?"":""+e,u=""+n),c&&(e=l=l.toLowerCase(),n=u=u.toLowerCase()),r){case"*=":i=l.indexOf(u)>=0;break;case"$=":i=l.indexOf(u,l.length-u.length)>=0;break;case"^=":i=l.indexOf(u)===0;break;case"=":i=e===n;break;case">":p=!0,i=e>n;break;case">=":p=!0,i=e>=n;break;case"<":p=!0,i=e<n;break;case"<=":p=!0,i=e<=n;break;default:i=!1;break}return f&&(e!=null||!p)&&(i=!i),i},r7=function(e,r){switch(r){case"?":return!!e;case"!":return!e;case"^":return e===void 0}},n7=function(e){return e!==void 0},u_=function(e,r){return e.data(r)},i7=function(e,r){return e[r]()},hi=[],On=function(e,r){return e.checks.every(function(n){return hi[n.type](n,r)})};hi[Dt.GROUP]=function(t,e){var r=t.value;return r==="*"||r===e.group()};hi[Dt.STATE]=function(t,e){var r=t.value;return ZB(r,e)};hi[Dt.ID]=function(t,e){var r=t.value;return e.id()===r};hi[Dt.CLASS]=function(t,e){var r=t.value;return e.hasClass(r)};hi[Dt.META_COMPARE]=function(t,e){var r=t.field,n=t.operator,i=t.value;return fA(i7(e,r),n,i)};hi[Dt.DATA_COMPARE]=function(t,e){var r=t.field,n=t.operator,i=t.value;return fA(u_(e,r),n,i)};hi[Dt.DATA_BOOL]=function(t,e){var r=t.field,n=t.operator;return r7(u_(e,r),n)};hi[Dt.DATA_EXIST]=function(t,e){var r=t.field;return t.operator,n7(u_(e,r))};hi[Dt.UNDIRECTED_EDGE]=function(t,e){var r=t.nodes[0],n=t.nodes[1],i=e.source(),a=e.target();return On(r,i)&&On(n,a)||On(n,i)&&On(r,a)};hi[Dt.NODE_NEIGHBOR]=function(t,e){return On(t.node,e)&&e.neighborhood().some(function(r){return r.isNode()&&On(t.neighbor,r)})};hi[Dt.DIRECTED_EDGE]=function(t,e){return On(t.source,e.source())&&On(t.target,e.target())};hi[Dt.NODE_SOURCE]=function(t,e){return On(t.source,e)&&e.outgoers().some(function(r){return r.isNode()&&On(t.target,r)})};hi[Dt.NODE_TARGET]=function(t,e){return On(t.target,e)&&e.incomers().some(function(r){return r.isNode()&&On(t.source,r)})};hi[Dt.CHILD]=function(t,e){return On(t.child,e)&&On(t.parent,e.parent())};hi[Dt.PARENT]=function(t,e){return On(t.parent,e)&&e.children().some(function(r){return On(t.child,r)})};hi[Dt.DESCENDANT]=function(t,e){return On(t.descendant,e)&&e.ancestors().some(function(r){return On(t.ancestor,r)})};hi[Dt.ANCESTOR]=function(t,e){return On(t.ancestor,e)&&e.descendants().some(function(r){return On(t.descendant,r)})};hi[Dt.COMPOUND_SPLIT]=function(t,e){return On(t.subject,e)&&On(t.left,e)&&On(t.right,e)};hi[Dt.TRUE]=function(){return!0};hi[Dt.COLLECTION]=function(t,e){var r=t.value;return r.has(e)};hi[Dt.FILTER]=function(t,e){var r=t.value;return r(e)};var a7=function(e){var r=this;if(r.length===1&&r[0].checks.length===1&&r[0].checks[0].type===Dt.ID)return e.getElementById(r[0].checks[0].value).collection();var n=function(a){for(var s=0;s<r.length;s++){var o=r[s];if(On(o,a))return!0}return!1};return r.text()==null&&(n=function(){return!0}),e.filter(n)},s7=function(e){for(var r=this,n=0;n<r.length;n++){var i=r[n];if(On(i,e))return!0}return!1},o7={matches:s7,filter:a7},Qd=function(e){this.inputText=e,this.currentSubject=null,this.compoundCount=0,this.edgeCount=0,this.length=0,e==null||Kt(e)&&e.match(/^\s*$/)||(go(e)?this.addQuery({checks:[{type:Dt.COLLECTION,value:e.collection()}]}):ri(e)?this.addQuery({checks:[{type:Dt.FILTER,value:e}]}):Kt(e)?this.parse(e)||(this.invalid=!0):Kn("A selector must be created from a string; found "))},Jd=Qd.prototype;[t7,o7].forEach(function(t){return ir(Jd,t)});Jd.text=function(){return this.inputText};Jd.size=function(){return this.length};Jd.eq=function(t){return this[t]};Jd.sameText=function(t){return!this.invalid&&!t.invalid&&this.text()===t.text()};Jd.addQuery=function(t){this[this.length++]=t};Jd.selector=Jd.toString;var Ud={allAre:function(e){var r=new Qd(e);return this.every(function(n){return r.matches(n)})},is:function(e){var r=new Qd(e);return this.some(function(n){return r.matches(n)})},some:function(e,r){for(var n=0;n<this.length;n++){var i=r?e.apply(r,[this[n],n,this]):e(this[n],n,this);if(i)return!0}return!1},every:function(e,r){for(var n=0;n<this.length;n++){var i=r?e.apply(r,[this[n],n,this]):e(this[n],n,this);if(!i)return!1}return!0},same:function(e){if(this===e)return!0;e=this.cy().collection(e);var r=this.length,n=e.length;return r!==n?!1:r===1?this[0]===e[0]:this.every(function(i){return e.hasElementWithId(i.id())})},anySame:function(e){return e=this.cy().collection(e),this.some(function(r){return e.hasElementWithId(r.id())})},allAreNeighbors:function(e){e=this.cy().collection(e);var r=this.neighborhood();return e.every(function(n){return r.hasElementWithId(n.id())})},contains:function(e){e=this.cy().collection(e);var r=this;return e.every(function(n){return r.hasElementWithId(n.id())})}};Ud.allAreNeighbours=Ud.allAreNeighbors;Ud.has=Ud.contains;Ud.equal=Ud.equals=Ud.same;var Yo=function(e,r){return function(i,a,s,o){var l=i,u=this,c;if(l==null?c="":go(l)&&l.length===1&&(c=l.id()),u.length===1&&c){var f=u[0]._private,p=f.traversalCache=f.traversalCache||{},v=p[r]=p[r]||[],y=ph(c),S=v[y];return S||(v[y]=e.call(u,i,a,s,o))}else return e.call(u,i,a,s,o)}},$p={parent:function(e){var r=[];if(this.length===1){var n=this[0]._private.parent;if(n)return n}for(var i=0;i<this.length;i++){var a=this[i],s=a._private.parent;s&&r.push(s)}return this.spawn(r,!0).filter(e)},parents:function(e){for(var r=[],n=this.parent();n.nonempty();){for(var i=0;i<n.length;i++){var a=n[i];r.push(a)}n=n.parent()}return this.spawn(r,!0).filter(e)},commonAncestors:function(e){for(var r,n=0;n<this.length;n++){var i=this[n],a=i.parents();r=r||a,r=r.intersect(a)}return r.filter(e)},orphans:function(e){return this.stdFilter(function(r){return r.isOrphan()}).filter(e)},nonorphans:function(e){return this.stdFilter(function(r){return r.isChild()}).filter(e)},children:Yo(function(t){for(var e=[],r=0;r<this.length;r++)for(var n=this[r],i=n._private.children,a=0;a<i.length;a++)e.push(i[a]);return this.spawn(e,!0).filter(t)},"children"),siblings:function(e){return this.parent().children().not(this).filter(e)},isParent:function(){var e=this[0];if(e)return e.isNode()&&e._private.children.length!==0},isChildless:function(){var e=this[0];if(e)return e.isNode()&&e._private.children.length===0},isChild:function(){var e=this[0];if(e)return e.isNode()&&e._private.parent!=null},isOrphan:function(){var e=this[0];if(e)return e.isNode()&&e._private.parent==null},descendants:function(e){var r=[];function n(i){for(var a=0;a<i.length;a++){var s=i[a];r.push(s),s.children().nonempty()&&n(s.children())}}return n(this.children()),this.spawn(r,!0).filter(e)}};function c_(t,e,r,n){for(var i=[],a=new um,s=t.cy(),o=s.hasCompoundNodes(),l=0;l<t.length;l++){var u=t[l];r?i.push(u):o&&n(i,a,u)}for(;i.length>0;){var c=i.shift();e(c),a.add(c.id()),o&&n(i,a,c)}return t}function hA(t,e,r){if(r.isParent())for(var n=r._private.children,i=0;i<n.length;i++){var a=n[i];e.has(a.id())||t.push(a)}}$p.forEachDown=function(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return c_(this,t,e,hA)};function pA(t,e,r){if(r.isChild()){var n=r._private.parent;e.has(n.id())||t.push(n)}}$p.forEachUp=function(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return c_(this,t,e,pA)};function l7(t,e,r){pA(t,e,r),hA(t,e,r)}$p.forEachUpAndDown=function(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return c_(this,t,e,l7)};$p.ancestors=$p.parents;var _v,mA;_v=mA={data:nn.data({field:"data",bindingEvent:"data",allowBinding:!0,allowSetting:!0,settingEvent:"data",settingTriggersEvent:!0,triggerFnName:"trigger",allowGetting:!0,immutableKeys:{id:!0,source:!0,target:!0,parent:!0},updateStyle:!0}),removeData:nn.removeData({field:"data",event:"data",triggerFnName:"trigger",triggerEvent:!0,immutableKeys:{id:!0,source:!0,target:!0,parent:!0},updateStyle:!0}),scratch:nn.data({field:"scratch",bindingEvent:"scratch",allowBinding:!0,allowSetting:!0,settingEvent:"scratch",settingTriggersEvent:!0,triggerFnName:"trigger",allowGetting:!0,updateStyle:!0}),removeScratch:nn.removeData({field:"scratch",event:"scratch",triggerFnName:"trigger",triggerEvent:!0,updateStyle:!0}),rscratch:nn.data({field:"rscratch",allowBinding:!1,allowSetting:!0,settingTriggersEvent:!1,allowGetting:!0}),removeRscratch:nn.removeData({field:"rscratch",triggerEvent:!1}),id:function(){var e=this[0];if(e)return e._private.data.id}};_v.attr=_v.data;_v.removeAttr=_v.removeData;var u7=mA,M1={};function l2(t){return function(e){var r=this;if(e===void 0&&(e=!0),r.length!==0)if(r.isNode()&&!r.removed()){for(var n=0,i=r[0],a=i._private.edges,s=0;s<a.length;s++){var o=a[s];!e&&o.isLoop()||(n+=t(i,o))}return n}else return}}ir(M1,{degree:l2(function(t,e){return e.source().same(e.target())?2:1}),indegree:l2(function(t,e){return e.target().same(t)?1:0}),outdegree:l2(function(t,e){return e.source().same(t)?1:0})});function hp(t,e){return function(r){for(var n,i=this.nodes(),a=0;a<i.length;a++){var s=i[a],o=s[t](r);o!==void 0&&(n===void 0||e(o,n))&&(n=o)}return n}}ir(M1,{minDegree:hp("degree",function(t,e){return t<e}),maxDegree:hp("degree",function(t,e){return t>e}),minIndegree:hp("indegree",function(t,e){return t<e}),maxIndegree:hp("indegree",function(t,e){return t>e}),minOutdegree:hp("outdegree",function(t,e){return t<e}),maxOutdegree:hp("outdegree",function(t,e){return t>e})});ir(M1,{totalDegree:function(e){for(var r=0,n=this.nodes(),i=0;i<n.length;i++)r+=n[i].degree(e);return r}});var Il,gA,vA=function(e,r,n){for(var i=0;i<e.length;i++){var a=e[i];if(!a.locked()){var s=a._private.position,o={x:r.x!=null?r.x-s.x:0,y:r.y!=null?r.y-s.y:0};a.isParent()&&!(o.x===0&&o.y===0)&&a.children().shift(o,n),a.dirtyBoundingBoxCache()}}},uN={field:"position",bindingEvent:"position",allowBinding:!0,allowSetting:!0,settingEvent:"position",settingTriggersEvent:!0,triggerFnName:"emitAndNotify",allowGetting:!0,validKeys:["x","y"],beforeGet:function(e){e.updateCompoundBounds()},beforeSet:function(e,r){vA(e,r,!1)},onSet:function(e){e.dirtyCompoundBoundsCache()},canSet:function(e){return!e.locked()}};Il=gA={position:nn.data(uN),silentPosition:nn.data(ir({},uN,{allowBinding:!1,allowSetting:!0,settingTriggersEvent:!1,allowGetting:!1,beforeSet:function(e,r){vA(e,r,!0)},onSet:function(e){e.dirtyCompoundBoundsCache()}})),positions:function(e,r){if(Vr(e))r?this.silentPosition(e):this.position(e);else if(ri(e)){var n=e,i=this.cy();i.startBatch();for(var a=0;a<this.length;a++){var s=this[a],o=void 0;(o=n(s,a))&&(r?s.silentPosition(o):s.position(o))}i.endBatch()}return this},silentPositions:function(e){return this.positions(e,!0)},shift:function(e,r,n){var i;if(Vr(e)?(i={x:bt(e.x)?e.x:0,y:bt(e.y)?e.y:0},n=r):Kt(e)&&bt(r)&&(i={x:0,y:0},i[e]=r),i!=null){var a=this.cy();a.startBatch();for(var s=0;s<this.length;s++){var o=this[s];if(!(a.hasCompoundNodes()&&o.isChild()&&o.ancestors().anySame(this))){var l=o.position(),u={x:l.x+i.x,y:l.y+i.y};n?o.silentPosition(u):o.position(u)}}a.endBatch()}return this},silentShift:function(e,r){return Vr(e)?this.shift(e,!0):Kt(e)&&bt(r)&&this.shift(e,r,!0),this},renderedPosition:function(e,r){var n=this[0],i=this.cy(),a=i.zoom(),s=i.pan(),o=Vr(e)?e:void 0,l=o!==void 0||r!==void 0&&Kt(e);if(n&&n.isNode())if(l)for(var u=0;u<this.length;u++){var c=this[u];r!==void 0?c.position(e,(r-s[e])/a):o!==void 0&&c.position(WM(o,a,s))}else{var f=n.position();return o=_1(f,a,s),e===void 0?o:o[e]}else if(!l)return;return this},relativePosition:function(e,r){var n=this[0],i=this.cy(),a=Vr(e)?e:void 0,s=a!==void 0||r!==void 0&&Kt(e),o=i.hasCompoundNodes();if(n&&n.isNode())if(s)for(var l=0;l<this.length;l++){var u=this[l],c=o?u.parent():null,f=c&&c.length>0,p=f;f&&(c=c[0]);var v=p?c.position():{x:0,y:0};r!==void 0?u.position(e,r+v[e]):a!==void 0&&u.position({x:a.x+v.x,y:a.y+v.y})}else{var y=n.position(),S=o?n.parent():null,w=S&&S.length>0,E=w;w&&(S=S[0]);var _=E?S.position():{x:0,y:0};return a={x:y.x-_.x,y:y.y-_.y},e===void 0?a:a[e]}else if(!s)return;return this}};Il.modelPosition=Il.point=Il.position;Il.modelPositions=Il.points=Il.positions;Il.renderedPoint=Il.renderedPosition;Il.relativePoint=Il.relativePosition;var c7=gA,zp,lf;zp=lf={};lf.renderedBoundingBox=function(t){var e=this.boundingBox(t),r=this.cy(),n=r.zoom(),i=r.pan(),a=e.x1*n+i.x,s=e.x2*n+i.x,o=e.y1*n+i.y,l=e.y2*n+i.y;return{x1:a,x2:s,y1:o,y2:l,w:s-a,h:l-o}};lf.dirtyCompoundBoundsCache=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,e=this.cy();return!e.styleEnabled()||!e.hasCompoundNodes()?this:(this.forEachUp(function(r){if(r.isParent()){var n=r._private;n.compoundBoundsClean=!1,n.bbCache=null,t||r.emitAndNotify("bounds")}}),this)};lf.updateCompoundBounds=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,e=this.cy();if(!e.styleEnabled()||!e.hasCompoundNodes())return this;if(!t&&e.batching())return this;function r(s){if(!s.isParent())return;var o=s._private,l=s.children(),u=s.pstyle("compound-sizing-wrt-labels").value==="include",c={width:{val:s.pstyle("min-width").pfValue,left:s.pstyle("min-width-bias-left"),right:s.pstyle("min-width-bias-right")},height:{val:s.pstyle("min-height").pfValue,top:s.pstyle("min-height-bias-top"),bottom:s.pstyle("min-height-bias-bottom")}},f=l.boundingBox({includeLabels:u,includeOverlays:!1,useCache:!1}),p=o.position;(f.w===0||f.h===0)&&(f={w:s.pstyle("width").pfValue,h:s.pstyle("height").pfValue},f.x1=p.x-f.w/2,f.x2=p.x+f.w/2,f.y1=p.y-f.h/2,f.y2=p.y+f.h/2);function v(j,B,G){var K=0,O=0,W=B+G;return j>0&&W>0&&(K=B/W*j,O=G/W*j),{biasDiff:K,biasComplementDiff:O}}function y(j,B,G,K){if(G.units==="%")switch(K){case"width":return j>0?G.pfValue*j:0;case"height":return B>0?G.pfValue*B:0;case"average":return j>0&&B>0?G.pfValue*(j+B)/2:0;case"min":return j>0&&B>0?j>B?G.pfValue*B:G.pfValue*j:0;case"max":return j>0&&B>0?j>B?G.pfValue*j:G.pfValue*B:0;default:return 0}else return G.units==="px"?G.pfValue:0}var S=c.width.left.value;c.width.left.units==="px"&&c.width.val>0&&(S=S*100/c.width.val);var w=c.width.right.value;c.width.right.units==="px"&&c.width.val>0&&(w=w*100/c.width.val);var E=c.height.top.value;c.height.top.units==="px"&&c.height.val>0&&(E=E*100/c.height.val);var _=c.height.bottom.value;c.height.bottom.units==="px"&&c.height.val>0&&(_=_*100/c.height.val);var T=v(c.width.val-f.w,S,w),N=T.biasDiff,R=T.biasComplementDiff,I=v(c.height.val-f.h,E,_),F=I.biasDiff,D=I.biasComplementDiff;o.autoPadding=y(f.w,f.h,s.pstyle("padding"),s.pstyle("padding-relative-to").value),o.autoWidth=Math.max(f.w,c.width.val),p.x=(-N+f.x1+f.x2+R)/2,o.autoHeight=Math.max(f.h,c.height.val),p.y=(-F+f.y1+f.y2+D)/2}for(var n=0;n<this.length;n++){var i=this[n],a=i._private;(!a.compoundBoundsClean||t)&&(r(i),e.batching()||(a.compoundBoundsClean=!0))}return this};var Ko=function(e){return e===1/0||e===-1/0?0:e},Rl=function(e,r,n,i,a){i-r===0||a-n===0||r==null||n==null||i==null||a==null||(e.x1=r<e.x1?r:e.x1,e.x2=i>e.x2?i:e.x2,e.y1=n<e.y1?n:e.y1,e.y2=a>e.y2?a:e.y2,e.w=e.x2-e.x1,e.h=e.y2-e.y1)},Ed=function(e,r){return r==null?e:Rl(e,r.x1,r.y1,r.x2,r.y2)},Gm=function(e,r,n){return $s(e,r,n)},ty=function(e,r,n){if(!r.cy().headless()){var i=r._private,a=i.rstyle,s=a.arrowWidth/2,o=r.pstyle(n+"-arrow-shape").value,l,u;if(o!=="none"){n==="source"?(l=a.srcX,u=a.srcY):n==="target"?(l=a.tgtX,u=a.tgtY):(l=a.midX,u=a.midY);var c=i.arrowBounds=i.arrowBounds||{},f=c[n]=c[n]||{};f.x1=l-s,f.y1=u-s,f.x2=l+s,f.y2=u+s,f.w=f.x2-f.x1,f.h=f.y2-f.y1,Dy(f,1),Rl(e,f.x1,f.y1,f.x2,f.y2)}}},u2=function(e,r,n){if(!r.cy().headless()){var i;n?i=n+"-":i="";var a=r._private,s=a.rstyle,o=r.pstyle(i+"label").strValue;if(o){var l=r.pstyle("text-halign"),u=r.pstyle("text-valign"),c=Gm(s,"labelWidth",n),f=Gm(s,"labelHeight",n),p=Gm(s,"labelX",n),v=Gm(s,"labelY",n),y=r.pstyle(i+"text-margin-x").pfValue,S=r.pstyle(i+"text-margin-y").pfValue,w=r.isEdge(),E=r.pstyle(i+"text-rotation"),_=r.pstyle("text-outline-width").pfValue,T=r.pstyle("text-border-width").pfValue,N=T/2,R=r.pstyle("text-background-padding").pfValue,I=2,F=f,D=c,j=D/2,B=F/2,G,K,O,W;if(w)G=p-j,K=p+j,O=v-B,W=v+B;else{switch(l.value){case"left":G=p-D,K=p;break;case"center":G=p-j,K=p+j;break;case"right":G=p,K=p+D;break}switch(u.value){case"top":O=v-F,W=v;break;case"center":O=v-B,W=v+B;break;case"bottom":O=v,W=v+F;break}}var U=y-Math.max(_,N)-R-I,q=y+Math.max(_,N)+R+I,Z=S-Math.max(_,N)-R-I,Q=S+Math.max(_,N)+R+I;G+=U,K+=q,O+=Z,W+=Q;var ne=n||"main",re=a.labelBounds,Y=re[ne]=re[ne]||{};Y.x1=G,Y.y1=O,Y.x2=K,Y.y2=W,Y.w=K-G,Y.h=W-O,Y.leftPad=U,Y.rightPad=q,Y.topPad=Z,Y.botPad=Q;var J=w&&E.strValue==="autorotate",ie=E.pfValue!=null&&E.pfValue!==0;if(J||ie){var de=J?Gm(a.rstyle,"labelAngle",n):E.pfValue,he=Math.cos(de),xe=Math.sin(de),le=(G+K)/2,fe=(O+W)/2;if(!w){switch(l.value){case"left":le=K;break;case"right":le=G;break}switch(u.value){case"top":fe=W;break;case"bottom":fe=O;break}}var ve=function(lt,at){return lt=lt-le,at=at-fe,{x:lt*he-at*xe+le,y:lt*xe+at*he+fe}},ge=ve(G,O),se=ve(G,W),ye=ve(K,O),Se=ve(K,W);G=Math.min(ge.x,se.x,ye.x,Se.x),K=Math.max(ge.x,se.x,ye.x,Se.x),O=Math.min(ge.y,se.y,ye.y,Se.y),W=Math.max(ge.y,se.y,ye.y,Se.y)}var Ue=ne+"Rot",Oe=re[Ue]=re[Ue]||{};Oe.x1=G,Oe.y1=O,Oe.x2=K,Oe.y2=W,Oe.w=K-G,Oe.h=W-O,Rl(e,G,O,K,W),Rl(a.labelBounds.all,G,O,K,W)}return e}},cN=function(e,r){if(!r.cy().headless()){var n=r.pstyle("outline-opacity").value,i=r.pstyle("outline-width").value,a=r.pstyle("outline-offset").value,s=i+a;yA(e,r,n,s,"outside",s/2)}},yA=function(e,r,n,i,a,s){if(!(n===0||i<=0||a==="inside")){var o=r.cy(),l=r.pstyle("shape").value,u=o.renderer().nodeShapes[l],c=r.position(),f=c.x,p=c.y,v=r.width(),y=r.height();if(u.hasMiterBounds){a==="center"&&(i/=2);var S=u.miterBounds(f,p,v,y,i);Ed(e,S)}else s!=null&&s>0&&Iy(e,[s,s,s,s])}},d7=function(e,r){if(!r.cy().headless()){var n=r.pstyle("border-opacity").value,i=r.pstyle("border-width").pfValue,a=r.pstyle("border-position").value;yA(e,r,n,i,a)}},f7=function(e,r){var n=e._private.cy,i=n.styleEnabled(),a=n.headless(),s=Es(),o=e._private,l=e.isNode(),u=e.isEdge(),c,f,p,v,y,S,w=o.rstyle,E=l&&i?e.pstyle("bounds-expansion").pfValue:[0],_=function(mt){return mt.pstyle("display").value!=="none"},T=!i||_(e)&&(!u||_(e.source())&&_(e.target()));if(T){var N=0,R=0;i&&r.includeOverlays&&(N=e.pstyle("overlay-opacity").value,N!==0&&(R=e.pstyle("overlay-padding").value));var I=0,F=0;i&&r.includeUnderlays&&(I=e.pstyle("underlay-opacity").value,I!==0&&(F=e.pstyle("underlay-padding").value));var D=Math.max(R,F),j=0,B=0;if(i&&(j=e.pstyle("width").pfValue,B=j/2),l&&r.includeNodes){var G=e.position();y=G.x,S=G.y;var K=e.outerWidth(),O=K/2,W=e.outerHeight(),U=W/2;c=y-O,f=y+O,p=S-U,v=S+U,Rl(s,c,p,f,v),i&&cN(s,e),i&&r.includeOutlines&&!a&&cN(s,e),i&&d7(s,e)}else if(u&&r.includeEdges)if(i&&!a){var q=e.pstyle("curve-style").strValue;if(c=Math.min(w.srcX,w.midX,w.tgtX),f=Math.max(w.srcX,w.midX,w.tgtX),p=Math.min(w.srcY,w.midY,w.tgtY),v=Math.max(w.srcY,w.midY,w.tgtY),c-=B,f+=B,p-=B,v+=B,Rl(s,c,p,f,v),q==="haystack"){var Z=w.haystackPts;if(Z&&Z.length===2){if(c=Z[0].x,p=Z[0].y,f=Z[1].x,v=Z[1].y,c>f){var Q=c;c=f,f=Q}if(p>v){var ne=p;p=v,v=ne}Rl(s,c-B,p-B,f+B,v+B)}}else if(q==="bezier"||q==="unbundled-bezier"||Ld(q,"segments")||Ld(q,"taxi")){var re;switch(q){case"bezier":case"unbundled-bezier":re=w.bezierPts;break;case"segments":case"taxi":case"round-segments":case"round-taxi":re=w.linePts;break}if(re!=null)for(var Y=0;Y<re.length;Y++){var J=re[Y];c=J.x-B,f=J.x+B,p=J.y-B,v=J.y+B,Rl(s,c,p,f,v)}}}else{var ie=e.source(),de=ie.position(),he=e.target(),xe=he.position();if(c=de.x,f=xe.x,p=de.y,v=xe.y,c>f){var le=c;c=f,f=le}if(p>v){var fe=p;p=v,v=fe}c-=B,f+=B,p-=B,v+=B,Rl(s,c,p,f,v)}if(i&&r.includeEdges&&u&&(ty(s,e,"mid-source"),ty(s,e,"mid-target"),ty(s,e,"source"),ty(s,e,"target")),i){var ve=e.pstyle("ghost").value==="yes";if(ve){var ge=e.pstyle("ghost-offset-x").pfValue,se=e.pstyle("ghost-offset-y").pfValue;Rl(s,s.x1+ge,s.y1+se,s.x2+ge,s.y2+se)}}var ye=o.bodyBounds=o.bodyBounds||{};ZE(ye,s),Iy(ye,E),Dy(ye,1),i&&(c=s.x1,f=s.x2,p=s.y1,v=s.y2,Rl(s,c-D,p-D,f+D,v+D));var Se=o.overlayBounds=o.overlayBounds||{};ZE(Se,s),Iy(Se,E),Dy(Se,1);var Ue=o.labelBounds=o.labelBounds||{};Ue.all!=null?$9(Ue.all):Ue.all=Es(),i&&r.includeLabels&&(r.includeMainLabels&&u2(s,e,null),u&&(r.includeSourceLabels&&u2(s,e,"source"),r.includeTargetLabels&&u2(s,e,"target")))}return s.x1=Ko(s.x1),s.y1=Ko(s.y1),s.x2=Ko(s.x2),s.y2=Ko(s.y2),s.w=Ko(s.x2-s.x1),s.h=Ko(s.y2-s.y1),s.w>0&&s.h>0&&T&&(Iy(s,E),Dy(s,1)),s},xA=function(e){var r=0,n=function(s){return(s?1:0)<<r++},i=0;return i+=n(e.incudeNodes),i+=n(e.includeEdges),i+=n(e.includeLabels),i+=n(e.includeMainLabels),i+=n(e.includeSourceLabels),i+=n(e.includeTargetLabels),i+=n(e.includeOverlays),i+=n(e.includeOutlines),i},bA=function(e){var r=function(o){return Math.round(o)};if(e.isEdge()){var n=e.source().position(),i=e.target().position();return VE([r(n.x),r(n.y),r(i.x),r(i.y)])}else{var a=e.position();return VE([r(a.x),r(a.y)])}},dN=function(e,r){var n=e._private,i,a=e.isEdge(),s=r==null?fN:xA(r),o=s===fN;if(n.bbCache==null?(i=f7(e,Cv),n.bbCache=i,n.bbCachePosKey=bA(e)):i=n.bbCache,!o){var l=e.isNode();i=Es(),(r.includeNodes&&l||r.includeEdges&&!l)&&(r.includeOverlays?Ed(i,n.overlayBounds):Ed(i,n.bodyBounds)),r.includeLabels&&(r.includeMainLabels&&(!a||r.includeSourceLabels&&r.includeTargetLabels)?Ed(i,n.labelBounds.all):(r.includeMainLabels&&Ed(i,n.labelBounds.mainRot),r.includeSourceLabels&&Ed(i,n.labelBounds.sourceRot),r.includeTargetLabels&&Ed(i,n.labelBounds.targetRot))),i.w=i.x2-i.x1,i.h=i.y2-i.y1}return i},Cv={includeNodes:!0,includeEdges:!0,includeLabels:!0,includeMainLabels:!0,includeSourceLabels:!0,includeTargetLabels:!0,includeOverlays:!0,includeUnderlays:!0,includeOutlines:!0,useCache:!0},fN=xA(Cv),hN=Ha(Cv);lf.boundingBox=function(t){var e,r=t===void 0||t.useCache===void 0||t.useCache===!0,n=Wp(function(c){var f=c._private;return f.bbCache==null||f.styleDirty||f.bbCachePosKey!==bA(c)},function(c){return c.id()});if(r&&this.length===1&&!n(this[0]))t===void 0?t=Cv:t=hN(t),e=dN(this[0],t);else{e=Es(),t=t||Cv;var i=hN(t),a=this,s=a.cy(),o=s.styleEnabled();this.edges().forEach(n),this.nodes().forEach(n),o&&this.recalculateRenderedStyle(r),this.updateCompoundBounds(!r);for(var l=0;l<a.length;l++){var u=a[l];n(u)&&u.dirtyBoundingBoxCache(),Ed(e,dN(u,i))}}return e.x1=Ko(e.x1),e.y1=Ko(e.y1),e.x2=Ko(e.x2),e.y2=Ko(e.y2),e.w=Ko(e.x2-e.x1),e.h=Ko(e.y2-e.y1),e};lf.dirtyBoundingBoxCache=function(){for(var t=0;t<this.length;t++){var e=this[t]._private;e.bbCache=null,e.bbCachePosKey=null,e.bodyBounds=null,e.overlayBounds=null,e.labelBounds.all=null,e.labelBounds.source=null,e.labelBounds.target=null,e.labelBounds.main=null,e.labelBounds.sourceRot=null,e.labelBounds.targetRot=null,e.labelBounds.mainRot=null,e.arrowBounds.source=null,e.arrowBounds.target=null,e.arrowBounds["mid-source"]=null,e.arrowBounds["mid-target"]=null}return this.emitAndNotify("bounds"),this};lf.boundingBoxAt=function(t){var e=this.nodes(),r=this.cy(),n=r.hasCompoundNodes(),i=r.collection();if(n&&(i=e.filter(function(u){return u.isParent()}),e=e.not(i)),Vr(t)){var a=t;t=function(){return a}}var s=function(c,f){return c._private.bbAtOldPos=t(c,f)},o=function(c){return c._private.bbAtOldPos};r.startBatch(),e.forEach(s).silentPositions(t),n&&(i.dirtyCompoundBoundsCache(),i.dirtyBoundingBoxCache(),i.updateCompoundBounds(!0));var l=q9(this.boundingBox({useCache:!1}));return e.silentPositions(o),n&&(i.dirtyCompoundBoundsCache(),i.dirtyBoundingBoxCache(),i.updateCompoundBounds(!0)),r.endBatch(),l};zp.boundingbox=zp.bb=zp.boundingBox;zp.renderedBoundingbox=zp.renderedBoundingBox;var h7=lf,Wg,e0;Wg=e0={};var wA=function(e){e.uppercaseName=NE(e.name),e.autoName="auto"+e.uppercaseName,e.labelName="label"+e.uppercaseName,e.outerName="outer"+e.uppercaseName,e.uppercaseOuterName=NE(e.outerName),Wg[e.name]=function(){var n=this[0],i=n._private,a=i.cy,s=a._private.styleEnabled;if(n)if(s){if(n.isParent())return n.updateCompoundBounds(),i[e.autoName]||0;var o=n.pstyle(e.name);return o.strValue==="label"?(n.recalculateRenderedStyle(),i.rstyle[e.labelName]||0):o.pfValue}else return 1},Wg["outer"+e.uppercaseName]=function(){var n=this[0],i=n._private,a=i.cy,s=a._private.styleEnabled;if(n)if(s){var o=n[e.name](),l=n.pstyle("border-position").value,u;l==="center"?u=n.pstyle("border-width").pfValue:l==="outside"?u=2*n.pstyle("border-width").pfValue:u=0;var c=2*n.padding();return o+u+c}else return 1},Wg["rendered"+e.uppercaseName]=function(){var n=this[0];if(n){var i=n[e.name]();return i*this.cy().zoom()}},Wg["rendered"+e.uppercaseOuterName]=function(){var n=this[0];if(n){var i=n[e.outerName]();return i*this.cy().zoom()}}};wA({name:"width"});wA({name:"height"});e0.padding=function(){var t=this[0],e=t._private;return t.isParent()?(t.updateCompoundBounds(),e.autoPadding!==void 0?e.autoPadding:t.pstyle("padding").pfValue):t.pstyle("padding").pfValue};e0.paddedHeight=function(){var t=this[0];return t.height()+2*t.padding()};e0.paddedWidth=function(){var t=this[0];return t.width()+2*t.padding()};var p7=e0,m7=function(e,r){if(e.isEdge()&&e.takesUpSpace())return r(e)},g7=function(e,r){if(e.isEdge()&&e.takesUpSpace()){var n=e.cy();return _1(r(e),n.zoom(),n.pan())}},v7=function(e,r){if(e.isEdge()&&e.takesUpSpace()){var n=e.cy(),i=n.pan(),a=n.zoom();return r(e).map(function(s){return _1(s,a,i)})}},y7=function(e){return e.renderer().getControlPoints(e)},x7=function(e){return e.renderer().getSegmentPoints(e)},b7=function(e){return e.renderer().getSourceEndpoint(e)},w7=function(e){return e.renderer().getTargetEndpoint(e)},S7=function(e){return e.renderer().getEdgeMidpoint(e)},pN={controlPoints:{get:y7,mult:!0},segmentPoints:{get:x7,mult:!0},sourceEndpoint:{get:b7},targetEndpoint:{get:w7},midpoint:{get:S7}},k7=function(e){return"rendered"+e[0].toUpperCase()+e.substr(1)},_7=Object.keys(pN).reduce(function(t,e){var r=pN[e],n=k7(e);return t[e]=function(){return m7(this,r.get)},r.mult?t[n]=function(){return v7(this,r.get)}:t[n]=function(){return g7(this,r.get)},t},{}),C7=ir({},c7,h7,p7,_7);var SA=function(e,r){this.recycle(e,r)};function Vm(){return!1}function ry(){return!0}SA.prototype={instanceString:function(){return"event"},recycle:function(e,r){if(this.isImmediatePropagationStopped=this.isPropagationStopped=this.isDefaultPrevented=Vm,e!=null&&e.preventDefault?(this.type=e.type,this.isDefaultPrevented=e.defaultPrevented?ry:Vm):e!=null&&e.type?r=e:this.type=e,r!=null&&(this.originalEvent=r.originalEvent,this.type=r.type!=null?r.type:this.type,this.cy=r.cy,this.target=r.target,this.position=r.position,this.renderedPosition=r.renderedPosition,this.namespace=r.namespace,this.layout=r.layout),this.cy!=null&&this.position!=null&&this.renderedPosition==null){var n=this.position,i=this.cy.zoom(),a=this.cy.pan();this.renderedPosition={x:n.x*i+a.x,y:n.y*i+a.y}}this.timeStamp=e&&e.timeStamp||Date.now()},preventDefault:function(){this.isDefaultPrevented=ry;var e=this.originalEvent;e&&e.preventDefault&&e.preventDefault()},stopPropagation:function(){this.isPropagationStopped=ry;var e=this.originalEvent;e&&e.stopPropagation&&e.stopPropagation()},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=ry,this.stopPropagation()},isDefaultPrevented:Vm,isPropagationStopped:Vm,isImmediatePropagationStopped:Vm};var kA=/^([^.]+)(\.(?:[^.]+))?$/,E7=".*",_A={qualifierCompare:function(e,r){return e===r},eventMatches:function(){return!0},addEventFields:function(){},callbackContext:function(e){return e},beforeEmit:function(){},afterEmit:function(){},bubble:function(){return!1},parent:function(){return null},context:null},mN=Object.keys(_A),T7={};function A1(){for(var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:T7,e=arguments.length>1?arguments[1]:void 0,r=0;r<mN.length;r++){var n=mN[r];this[n]=t[n]||_A[n]}this.context=e||this.context,this.listeners=[],this.emitting=0}var ef=A1.prototype,CA=function(e,r,n,i,a,s,o){ri(i)&&(a=i,i=null),o&&(s==null?s=o:s=ir({},s,o));for(var l=Sn(n)?n:n.split(/\s+/),u=0;u<l.length;u++){var c=l[u];if(!Zd(c)){var f=c.match(kA);if(f){var p=f[1],v=f[2]?f[2]:null,y=r(e,c,p,v,i,a,s);if(y===!1)break}}}},gN=function(e,r){return e.addEventFields(e.context,r),new SA(r.type,r)},N7=function(e,r,n){if(Oj(n)){r(e,n);return}else if(Vr(n)){r(e,gN(e,n));return}for(var i=Sn(n)?n:n.split(/\s+/),a=0;a<i.length;a++){var s=i[a];if(!Zd(s)){var o=s.match(kA);if(o){var l=o[1],u=o[2]?o[2]:null,c=gN(e,{type:l,namespace:u,target:e.context});r(e,c)}}}};ef.on=ef.addListener=function(t,e,r,n,i){return CA(this,function(a,s,o,l,u,c,f){ri(c)&&a.listeners.push({event:s,callback:c,type:o,namespace:l,qualifier:u,conf:f})},t,e,r,n,i),this};ef.one=function(t,e,r,n){return this.on(t,e,r,n,{one:!0})};ef.removeListener=ef.off=function(t,e,r,n){var i=this;this.emitting!==0&&(this.listeners=g9(this.listeners));for(var a=this.listeners,s=function(u){var c=a[u];CA(i,function(f,p,v,y,S,w){if((c.type===v||t==="*")&&(!y&&c.namespace!==".*"||c.namespace===y)&&(!S||f.qualifierCompare(c.qualifier,S))&&(!w||c.callback===w))return a.splice(u,1),!1},t,e,r,n)},o=a.length-1;o>=0;o--)s(o);return this};ef.removeAllListeners=function(){return this.removeListener("*")};ef.emit=ef.trigger=function(t,e,r){var n=this.listeners,i=n.length;return this.emitting++,Sn(e)||(e=[e]),N7(this,function(a,s){r!=null&&(n=[{event:s.event,type:s.type,namespace:s.namespace,callback:r}],i=n.length);for(var o=function(){var c=n[l];if(c.type===s.type&&(!c.namespace||c.namespace===s.namespace||c.namespace===E7)&&a.eventMatches(a.context,c,s)){var f=[s];e!=null&&y9(f,e),a.beforeEmit(a.context,c,s),c.conf&&c.conf.one&&(a.listeners=a.listeners.filter(function(y){return y!==c}));var p=a.callbackContext(a.context,c,s),v=c.callback.apply(p,f);a.afterEmit(a.context,c,s),v===!1&&(s.stopPropagation(),s.preventDefault())}},l=0;l<i;l++)o();a.bubble(a.context)&&!s.isPropagationStopped()&&a.parent(a.context).emit(s,e)},t),this.emitting--,this};var P7={qualifierCompare:function(e,r){return e==null||r==null?e==null&&r==null:e.sameText(r)},eventMatches:function(e,r,n){var i=r.qualifier;return i!=null?e!==n.target&&Kv(n.target)&&i.matches(n.target):!0},addEventFields:function(e,r){r.cy=e.cy(),r.target=e},callbackContext:function(e,r,n){return r.qualifier!=null?n.target:e},beforeEmit:function(e,r){r.conf&&r.conf.once&&r.conf.onceCollection.removeListener(r.event,r.qualifier,r.callback)},bubble:function(){return!0},parent:function(e){return e.isChild()?e.parent():e.cy()}},ny=function(e){return Kt(e)?new Qd(e):e},EA={createEmitter:function(){for(var e=0;e<this.length;e++){var r=this[e],n=r._private;n.emitter||(n.emitter=new A1(P7,r))}return this},emitter:function(){return this._private.emitter},on:function(e,r,n){for(var i=ny(r),a=0;a<this.length;a++){var s=this[a];s.emitter().on(e,i,n)}return this},removeListener:function(e,r,n){for(var i=ny(r),a=0;a<this.length;a++){var s=this[a];s.emitter().removeListener(e,i,n)}return this},removeAllListeners:function(){for(var e=0;e<this.length;e++){var r=this[e];r.emitter().removeAllListeners()}return this},one:function(e,r,n){for(var i=ny(r),a=0;a<this.length;a++){var s=this[a];s.emitter().one(e,i,n)}return this},once:function(e,r,n){for(var i=ny(r),a=0;a<this.length;a++){var s=this[a];s.emitter().on(e,i,n,{once:!0,onceCollection:this})}},emit:function(e,r){for(var n=0;n<this.length;n++){var i=this[n];i.emitter().emit(e,r)}return this},emitAndNotify:function(e,r){if(this.length!==0)return this.cy().notify(e,this),this.emit(e,r),this}};nn.eventAliasesOn(EA);var TA={nodes:function(e){return this.filter(function(r){return r.isNode()}).filter(e)},edges:function(e){return this.filter(function(r){return r.isEdge()}).filter(e)},byGroup:function(){for(var e=this.spawn(),r=this.spawn(),n=0;n<this.length;n++){var i=this[n];i.isNode()?e.push(i):r.push(i)}return{nodes:e,edges:r}},filter:function(e,r){if(e===void 0)return this;if(Kt(e)||go(e))return new Qd(e).filter(this);if(ri(e)){for(var n=this.spawn(),i=this,a=0;a<i.length;a++){var s=i[a],o=r?e.apply(r,[s,a,i]):e(s,a,i);o&&n.push(s)}return n}return this.spawn()},not:function(e){if(e){Kt(e)&&(e=this.filter(e));for(var r=this.spawn(),n=0;n<this.length;n++){var i=this[n],a=e.has(i);a||r.push(i)}return r}else return this},absoluteComplement:function(){var e=this.cy();return e.mutableElements().not(this)},intersect:function(e){if(Kt(e)){var r=e;return this.filter(r)}for(var n=this.spawn(),i=this,a=e,s=this.length<e.length,o=s?i:a,l=s?a:i,u=0;u<o.length;u++){var c=o[u];l.has(c)&&n.push(c)}return n},xor:function(e){var r=this._private.cy;Kt(e)&&(e=r.$(e));var n=this.spawn(),i=this,a=e,s=function(l,u){for(var c=0;c<l.length;c++){var f=l[c],p=f._private.data.id,v=u.hasElementWithId(p);v||n.push(f)}};return s(i,a),s(a,i),n},diff:function(e){var r=this._private.cy;Kt(e)&&(e=r.$(e));var n=this.spawn(),i=this.spawn(),a=this.spawn(),s=this,o=e,l=function(c,f,p){for(var v=0;v<c.length;v++){var y=c[v],S=y._private.data.id,w=f.hasElementWithId(S);w?a.merge(y):p.push(y)}};return l(s,o,n),l(o,s,i),{left:n,right:i,both:a}},add:function(e){var r=this._private.cy;if(!e)return this;if(Kt(e)){var n=e;e=r.mutableElements().filter(n)}for(var i=this.spawnSelf(),a=0;a<e.length;a++){var s=e[a],o=!this.has(s);o&&i.push(s)}return i},merge:function(e){var r=this._private,n=r.cy;if(!e)return this;if(e&&Kt(e)){var i=e;e=n.mutableElements().filter(i)}for(var a=r.map,s=0;s<e.length;s++){var o=e[s],l=o._private.data.id,u=!a.has(l);if(u){var c=this.length++;this[c]=o,a.set(l,{ele:o,index:c})}}return this},unmergeAt:function(e){var r=this[e],n=r.id(),i=this._private,a=i.map;this[e]=void 0,a.delete(n);var s=e===this.length-1;if(this.length>1&&!s){var o=this.length-1,l=this[o],u=l._private.data.id;this[o]=void 0,this[e]=l,a.set(u,{ele:l,index:e})}return this.length--,this},unmergeOne:function(e){e=e[0];var r=this._private,n=e._private.data.id,i=r.map,a=i.get(n);if(!a)return this;var s=a.index;return this.unmergeAt(s),this},unmerge:function(e){var r=this._private.cy;if(!e)return this;if(e&&Kt(e)){var n=e;e=r.mutableElements().filter(n)}for(var i=0;i<e.length;i++)this.unmergeOne(e[i]);return this},unmergeBy:function(e){for(var r=this.length-1;r>=0;r--){var n=this[r];e(n)&&this.unmergeAt(r)}return this},map:function(e,r){for(var n=[],i=this,a=0;a<i.length;a++){var s=i[a],o=r?e.apply(r,[s,a,i]):e(s,a,i);n.push(o)}return n},reduce:function(e,r){for(var n=r,i=this,a=0;a<i.length;a++)n=e(n,i[a],a,i);return n},max:function(e,r){for(var n=-1/0,i,a=this,s=0;s<a.length;s++){var o=a[s],l=r?e.apply(r,[o,s,a]):e(o,s,a);l>n&&(n=l,i=o)}return{value:n,ele:i}},min:function(e,r){for(var n=1/0,i,a=this,s=0;s<a.length;s++){var o=a[s],l=r?e.apply(r,[o,s,a]):e(o,s,a);l<n&&(n=l,i=o)}return{value:n,ele:i}}},qr=TA;qr.u=qr["|"]=qr["+"]=qr.union=qr.or=qr.add;qr["\\"]=qr["!"]=qr["-"]=qr.difference=qr.relativeComplement=qr.subtract=qr.not;qr.n=qr["&"]=qr["."]=qr.and=qr.intersection=qr.intersect;qr["^"]=qr["(+)"]=qr["(-)"]=qr.symmetricDifference=qr.symdiff=qr.xor;qr.fnFilter=qr.filterFn=qr.stdFilter=qr.filter;qr.complement=qr.abscomp=qr.absoluteComplement;var M7={isNode:function(){return this.group()==="nodes"},isEdge:function(){return this.group()==="edges"},isLoop:function(){return this.isEdge()&&this.source()[0]===this.target()[0]},isSimple:function(){return this.isEdge()&&this.source()[0]!==this.target()[0]},group:function(){var e=this[0];if(e)return e._private.group}},NA=function(e,r){var n=e.cy(),i=n.hasCompoundNodes();function a(c){var f=c.pstyle("z-compound-depth");return f.value==="auto"?i?c.zDepth():0:f.value==="bottom"?-1:f.value==="top"?Jk:0}var s=a(e)-a(r);if(s!==0)return s;function o(c){var f=c.pstyle("z-index-compare");return f.value==="auto"&&c.isNode()?1:0}var l=o(e)-o(r);if(l!==0)return l;var u=e.pstyle("z-index").value-r.pstyle("z-index").value;return u!==0?u:e.poolIndex()-r.poolIndex()},cx={forEach:function(e,r){if(ri(e))for(var n=this.length,i=0;i<n;i++){var a=this[i],s=r?e.apply(r,[a,i,this]):e(a,i,this);if(s===!1)break}return this},toArray:function(){for(var e=[],r=0;r<this.length;r++)e.push(this[r]);return e},slice:function(e,r){var n=[],i=this.length;r==null&&(r=i),e==null&&(e=0),e<0&&(e=i+e),r<0&&(r=i+r);for(var a=e;a>=0&&a<r&&a<i;a++)n.push(this[a]);return this.spawn(n)},size:function(){return this.length},eq:function(e){return this[e]||this.spawn()},first:function(){return this[0]||this.spawn()},last:function(){return this[this.length-1]||this.spawn()},empty:function(){return this.length===0},nonempty:function(){return!this.empty()},sort:function(e){if(!ri(e))return this;var r=this.toArray().sort(e);return this.spawn(r)},sortByZIndex:function(){return this.sort(NA)},zDepth:function(){var e=this[0];if(e){var r=e._private,n=r.group;if(n==="nodes"){var i=r.data.parent?e.parents().size():0;return e.isParent()?i:Jk-1}else{var a=r.source,s=r.target,o=a.zDepth(),l=s.zDepth();return Math.max(o,l,0)}}}};cx.each=cx.forEach;var A7=function(){var e="undefined",r=(typeof Symbol>"u"?"undefined":$i(Symbol))!=e&&$i(Symbol.iterator)!=e;r&&(cx[Symbol.iterator]=function(){var n=this,i={value:void 0,done:!1},a=0,s=this.length;return EM({next:function(){return a<s?i.value=n[a++]:(i.value=void 0,i.done=!0),i}},Symbol.iterator,function(){return this})})};A7();var R7=Ha({nodeDimensionsIncludeLabels:!1}),Fy={layoutDimensions:function(e){e=R7(e);var r;if(!this.takesUpSpace())r={w:0,h:0};else if(e.nodeDimensionsIncludeLabels){var n=this.boundingBox();r={w:n.w,h:n.h}}else r={w:this.outerWidth(),h:this.outerHeight()};return(r.w===0||r.h===0)&&(r.w=r.h=1),r},layoutPositions:function(e,r,n){var i=this.nodes().filter(function(R){return!R.isParent()}),a=this.cy(),s=r.eles,o=function(I){return I.id()},l=Wp(n,o);e.emit({type:"layoutstart",layout:e}),e.animations=[];var u=function(I,F,D){var j={x:F.x1+F.w/2,y:F.y1+F.h/2},B={x:(D.x-j.x)*I,y:(D.y-j.y)*I};return{x:j.x+B.x,y:j.y+B.y}},c=r.spacingFactor&&r.spacingFactor!==1,f=function(){if(!c)return null;for(var I=Es(),F=0;F<i.length;F++){var D=i[F],j=l(D,F);qM(I,j.x,j.y)}return I},p=f(),v=Wp(function(R,I){var F=l(R,I);if(c){var D=Math.abs(r.spacingFactor);F=u(D,p,F)}return r.transform!=null&&(F=r.transform(R,F)),F},o);if(r.animate){for(var y=0;y<i.length;y++){var S=i[y],w=v(S,y),E=r.animateFilter==null||r.animateFilter(S,y);if(E){var _=S.animation({position:w,duration:r.animationDuration,easing:r.animationEasing});e.animations.push(_)}else S.position(w)}if(r.fit){var T=a.animation({fit:{boundingBox:s.boundingBoxAt(v),padding:r.padding},duration:r.animationDuration,easing:r.animationEasing});e.animations.push(T)}else if(r.zoom!==void 0&&r.pan!==void 0){var N=a.animation({zoom:r.zoom,pan:r.pan,duration:r.animationDuration,easing:r.animationEasing});e.animations.push(N)}e.animations.forEach(function(R){return R.play()}),e.one("layoutready",r.ready),e.emit({type:"layoutready",layout:e}),cm.all(e.animations.map(function(R){return R.promise()})).then(function(){e.one("layoutstop",r.stop),e.emit({type:"layoutstop",layout:e})})}else i.positions(v),r.fit&&a.fit(r.eles,r.padding),r.zoom!=null&&a.zoom(r.zoom),r.pan&&a.pan(r.pan),e.one("layoutready",r.ready),e.emit({type:"layoutready",layout:e}),e.one("layoutstop",r.stop),e.emit({type:"layoutstop",layout:e});return this},layout:function(e){var r=this.cy();return r.makeLayout(ir({},e,{eles:this}))}};Fy.createLayout=Fy.makeLayout=Fy.layout;function PA(t,e,r){var n=r._private,i=n.styleCache=n.styleCache||[],a;return(a=i[t])!=null||(a=i[t]=e(r)),a}function R1(t,e){return t=ph(t),function(n){return PA(t,e,n)}}function L1(t,e){t=ph(t);var r=function(i){return e.call(i)};return function(){var i=this[0];if(i)return PA(t,r,i)}}var za={recalculateRenderedStyle:function(e){var r=this.cy(),n=r.renderer(),i=r.styleEnabled();return n&&i&&n.recalculateRenderedStyle(this,e),this},dirtyStyleCache:function(){var e=this.cy(),r=function(a){return a._private.styleCache=null};if(e.hasCompoundNodes()){var n;n=this.spawnSelf().merge(this.descendants()).merge(this.parents()),n.merge(n.connectedEdges()),n.forEach(r)}else this.forEach(function(i){r(i),i.connectedEdges().forEach(r)});return this},updateStyle:function(e){var r=this._private.cy;if(!r.styleEnabled())return this;if(r.batching()){var n=r._private.batchStyleEles;return n.merge(this),this}var i=r.hasCompoundNodes(),a=this;e=!!(e||e===void 0),i&&(a=this.spawnSelf().merge(this.descendants()).merge(this.parents()));var s=a;return e?s.emitAndNotify("style"):s.emit("style"),a.forEach(function(o){return o._private.styleDirty=!0}),this},cleanStyle:function(){var e=this.cy();if(e.styleEnabled())for(var r=0;r<this.length;r++){var n=this[r];n._private.styleDirty&&(n._private.styleDirty=!1,e.style().apply(n))}},parsedStyle:function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,n=this[0],i=n.cy();if(i.styleEnabled()&&n){n._private.styleDirty&&(n._private.styleDirty=!1,i.style().apply(n));var a=n._private.style[e];return a??(r?i.style().getDefaultProperty(e):null)}},numericStyle:function(e){var r=this[0];if(r.cy().styleEnabled()&&r){var n=r.pstyle(e);return n.pfValue!==void 0?n.pfValue:n.value}},numericStyleUnits:function(e){var r=this[0];if(r.cy().styleEnabled()&&r)return r.pstyle(e).units},renderedStyle:function(e){var r=this.cy();if(!r.styleEnabled())return this;var n=this[0];if(n)return r.style().getRenderedStyle(n,e)},style:function(e,r){var n=this.cy();if(!n.styleEnabled())return this;var i=!1,a=n.style();if(Vr(e)){var s=e;a.applyBypass(this,s,i),this.emitAndNotify("style")}else if(Kt(e))if(r===void 0){var o=this[0];return o?a.getStylePropertyValue(o,e):void 0}else a.applyBypass(this,e,r,i),this.emitAndNotify("style");else if(e===void 0){var l=this[0];return l?a.getRawStyle(l):void 0}return this},removeStyle:function(e){var r=this.cy();if(!r.styleEnabled())return this;var n=!1,i=r.style(),a=this;if(e===void 0)for(var s=0;s<a.length;s++){var o=a[s];i.removeAllBypasses(o,n)}else{e=e.split(/\s+/);for(var l=0;l<a.length;l++){var u=a[l];i.removeBypasses(u,e,n)}}return this.emitAndNotify("style"),this},show:function(){return this.css("display","element"),this},hide:function(){return this.css("display","none"),this},effectiveOpacity:function(){var e=this.cy();if(!e.styleEnabled())return 1;var r=e.hasCompoundNodes(),n=this[0];if(n){var i=n._private,a=n.pstyle("opacity").value;if(!r)return a;var s=i.data.parent?n.parents():null;if(s)for(var o=0;o<s.length;o++){var l=s[o],u=l.pstyle("opacity").value;a=u*a}return a}},transparent:function(){var e=this.cy();if(!e.styleEnabled())return!1;var r=this[0],n=r.cy().hasCompoundNodes();if(r)return n?r.effectiveOpacity()===0:r.pstyle("opacity").value===0},backgrounding:function(){var e=this.cy();if(!e.styleEnabled())return!1;var r=this[0];return!!r._private.backgrounding}};function c2(t,e){var r=t._private,n=r.data.parent?t.parents():null;if(n)for(var i=0;i<n.length;i++){var a=n[i];if(!e(a))return!1}return!0}function d_(t){var e=t.ok,r=t.edgeOkViaNode||t.ok,n=t.parentOk||t.ok;return function(){var i=this.cy();if(!i.styleEnabled())return!0;var a=this[0],s=i.hasCompoundNodes();if(a){var o=a._private;if(!e(a))return!1;if(a.isNode())return!s||c2(a,n);var l=o.source,u=o.target;return r(l)&&(!s||c2(l,r))&&(l===u||r(u)&&(!s||c2(u,r)))}}}var dm=R1("eleTakesUpSpace",function(t){return t.pstyle("display").value==="element"&&t.width()!==0&&(t.isNode()?t.height()!==0:!0)});za.takesUpSpace=L1("takesUpSpace",d_({ok:dm}));var L7=R1("eleInteractive",function(t){return t.pstyle("events").value==="yes"&&t.pstyle("visibility").value==="visible"&&dm(t)}),O7=R1("parentInteractive",function(t){return t.pstyle("visibility").value==="visible"&&dm(t)});za.interactive=L1("interactive",d_({ok:L7,parentOk:O7,edgeOkViaNode:dm}));za.noninteractive=function(){var t=this[0];if(t)return!t.interactive()};var D7=R1("eleVisible",function(t){return t.pstyle("visibility").value==="visible"&&t.pstyle("opacity").pfValue!==0&&dm(t)}),I7=dm;za.visible=L1("visible",d_({ok:D7,edgeOkViaNode:I7}));za.hidden=function(){var t=this[0];if(t)return!t.visible()};za.isBundledBezier=L1("isBundledBezier",function(){return this.cy().styleEnabled()?!this.removed()&&this.pstyle("curve-style").value==="bezier"&&this.takesUpSpace():!1});za.bypass=za.css=za.style;za.renderedCss=za.renderedStyle;za.removeBypass=za.removeCss=za.removeStyle;za.pstyle=za.parsedStyle;var Gd={};function vN(t){return function(){var e=arguments,r=[];if(e.length===2){var n=e[0],i=e[1];this.on(t.event,n,i)}else if(e.length===1&&ri(e[0])){var a=e[0];this.on(t.event,a)}else if(e.length===0||e.length===1&&Sn(e[0])){for(var s=e.length===1?e[0]:null,o=0;o<this.length;o++){var l=this[o],u=!t.ableField||l._private[t.ableField],c=l._private[t.field]!=t.value;if(t.overrideAble){var f=t.overrideAble(l);if(f!==void 0&&(u=f,!f))return this}u&&(l._private[t.field]=t.value,c&&r.push(l))}var p=this.spawn(r);p.updateStyle(),p.emit(t.event),s&&p.emit(s)}return this}}function fm(t){Gd[t.field]=function(){var e=this[0];if(e){if(t.overrideField){var r=t.overrideField(e);if(r!==void 0)return r}return e._private[t.field]}},Gd[t.on]=vN({event:t.on,field:t.field,ableField:t.ableField,overrideAble:t.overrideAble,value:!0}),Gd[t.off]=vN({event:t.off,field:t.field,ableField:t.ableField,overrideAble:t.overrideAble,value:!1})}fm({field:"locked",overrideField:function(e){return e.cy().autolock()?!0:void 0},on:"lock",off:"unlock"});fm({field:"grabbable",overrideField:function(e){return e.cy().autoungrabify()||e.pannable()?!1:void 0},on:"grabify",off:"ungrabify"});fm({field:"selected",ableField:"selectable",overrideAble:function(e){return e.cy().autounselectify()?!1:void 0},on:"select",off:"unselect"});fm({field:"selectable",overrideField:function(e){return e.cy().autounselectify()?!1:void 0},on:"selectify",off:"unselectify"});Gd.deselect=Gd.unselect;Gd.grabbed=function(){var t=this[0];if(t)return t._private.grabbed};fm({field:"active",on:"activate",off:"unactivate"});fm({field:"pannable",on:"panify",off:"unpanify"});Gd.inactive=function(){var t=this[0];if(t)return!t._private.active};var ss={},yN=function(e){return function(n){for(var i=this,a=[],s=0;s<i.length;s++){var o=i[s];if(o.isNode()){for(var l=!1,u=o.connectedEdges(),c=0;c<u.length;c++){var f=u[c],p=f.source(),v=f.target();if(e.noIncomingEdges&&v===o&&p!==o||e.noOutgoingEdges&&p===o&&v!==o){l=!0;break}}l||a.push(o)}}return this.spawn(a,!0).filter(n)}},xN=function(e){return function(r){for(var n=this,i=[],a=0;a<n.length;a++){var s=n[a];if(s.isNode())for(var o=s.connectedEdges(),l=0;l<o.length;l++){var u=o[l],c=u.source(),f=u.target();e.outgoing&&c===s?(i.push(u),i.push(f)):e.incoming&&f===s&&(i.push(u),i.push(c))}}return this.spawn(i,!0).filter(r)}},bN=function(e){return function(r){for(var n=this,i=[],a={};;){var s=e.outgoing?n.outgoers():n.incomers();if(s.length===0)break;for(var o=!1,l=0;l<s.length;l++){var u=s[l],c=u.id();a[c]||(a[c]=!0,i.push(u),o=!0)}if(!o)break;n=s}return this.spawn(i,!0).filter(r)}};ss.clearTraversalCache=function(){for(var t=0;t<this.length;t++)this[t]._private.traversalCache=null};ir(ss,{roots:yN({noIncomingEdges:!0}),leaves:yN({noOutgoingEdges:!0}),outgoers:Yo(xN({outgoing:!0}),"outgoers"),successors:bN({outgoing:!0}),incomers:Yo(xN({incoming:!0}),"incomers"),predecessors:bN({})});ir(ss,{neighborhood:Yo(function(t){for(var e=[],r=this.nodes(),n=0;n<r.length;n++)for(var i=r[n],a=i.connectedEdges(),s=0;s<a.length;s++){var o=a[s],l=o.source(),u=o.target(),c=i===l?u:l;c.length>0&&e.push(c[0]),e.push(o[0])}return this.spawn(e,!0).filter(t)},"neighborhood"),closedNeighborhood:function(e){return this.neighborhood().add(this).filter(e)},openNeighborhood:function(e){return this.neighborhood(e)}});ss.neighbourhood=ss.neighborhood;ss.closedNeighbourhood=ss.closedNeighborhood;ss.openNeighbourhood=ss.openNeighborhood;ir(ss,{source:Yo(function(e){var r=this[0],n;return r&&(n=r._private.source||r.cy().collection()),n&&e?n.filter(e):n},"source"),target:Yo(function(e){var r=this[0],n;return r&&(n=r._private.target||r.cy().collection()),n&&e?n.filter(e):n},"target"),sources:wN({attr:"source"}),targets:wN({attr:"target"})});function wN(t){return function(r){for(var n=[],i=0;i<this.length;i++){var a=this[i],s=a._private[t.attr];s&&n.push(s)}return this.spawn(n,!0).filter(r)}}ir(ss,{edgesWith:Yo(SN(),"edgesWith"),edgesTo:Yo(SN({thisIsSrc:!0}),"edgesTo")});function SN(t){return function(r){var n=[],i=this._private.cy,a=t||{};Kt(r)&&(r=i.$(r));for(var s=0;s<r.length;s++)for(var o=r[s]._private.edges,l=0;l<o.length;l++){var u=o[l],c=u._private.data,f=this.hasElementWithId(c.source)&&r.hasElementWithId(c.target),p=r.hasElementWithId(c.source)&&this.hasElementWithId(c.target),v=f||p;v&&((a.thisIsSrc||a.thisIsTgt)&&(a.thisIsSrc&&!f||a.thisIsTgt&&!p)||n.push(u))}return this.spawn(n,!0)}}ir(ss,{connectedEdges:Yo(function(t){for(var e=[],r=this,n=0;n<r.length;n++){var i=r[n];if(i.isNode())for(var a=i._private.edges,s=0;s<a.length;s++){var o=a[s];e.push(o)}}return this.spawn(e,!0).filter(t)},"connectedEdges"),connectedNodes:Yo(function(t){for(var e=[],r=this,n=0;n<r.length;n++){var i=r[n];i.isEdge()&&(e.push(i.source()[0]),e.push(i.target()[0]))}return this.spawn(e,!0).filter(t)},"connectedNodes"),parallelEdges:Yo(kN(),"parallelEdges"),codirectedEdges:Yo(kN({codirected:!0}),"codirectedEdges")});function kN(t){var e={codirected:!1};return t=ir({},e,t),function(n){for(var i=[],a=this.edges(),s=t,o=0;o<a.length;o++)for(var l=a[o],u=l._private,c=u.source,f=c._private.data.id,p=u.data.target,v=c._private.edges,y=0;y<v.length;y++){var S=v[y],w=S._private.data,E=w.target,_=w.source,T=E===p&&_===f,N=f===E&&p===_;(s.codirected&&T||!s.codirected&&(T||N))&&i.push(S)}return this.spawn(i,!0).filter(n)}}ir(ss,{components:function(e){var r=this,n=r.cy(),i=n.collection(),a=e==null?r.nodes():e.nodes(),s=[];e!=null&&a.empty()&&(a=e.sources());var o=function(c,f){i.merge(c),a.unmerge(c),f.merge(c)};if(a.empty())return r.spawn();var l=function(){var c=n.collection();s.push(c);var f=a[0];o(f,c),r.bfs({directed:!1,roots:f,visit:function(v){return o(v,c)}}),c.forEach(function(p){p.connectedEdges().forEach(function(v){r.has(v)&&c.has(v.source())&&c.has(v.target())&&c.merge(v)})})};do l();while(a.length>0);return s},component:function(){var e=this[0];return e.cy().mutableElements().components(e)[0]}});ss.componentsOf=ss.components;var Ua=function(e,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(e===void 0){Kn("A collection must have a reference to the core");return}var a=new dc,s=!1;if(!r)r=[];else if(r.length>0&&Vr(r[0])&&!Kv(r[0])){s=!0;for(var o=[],l=new um,u=0,c=r.length;u<c;u++){var f=r[u];f.data==null&&(f.data={});var p=f.data;if(p.id==null)p.id=VM();else if(e.hasElementWithId(p.id)||l.has(p.id))continue;var v=new k1(e,f,!1);o.push(v),l.add(p.id)}r=o}this.length=0;for(var y=0,S=r.length;y<S;y++){var w=r[y][0];if(w!=null){var E=w._private.data.id;(!n||!a.has(E))&&(n&&a.set(E,{index:this.length,ele:w}),this[this.length]=w,this.length++)}}this._private={eles:this,cy:e,get map(){return this.lazyMap==null&&this.rebuildMap(),this.lazyMap},set map(_){this.lazyMap=_},rebuildMap:function(){for(var T=this.lazyMap=new dc,N=this.eles,R=0;R<N.length;R++){var I=N[R];T.set(I.id(),{index:R,ele:I})}}},n&&(this._private.map=a),s&&!i&&this.restore()},Pn=k1.prototype=Ua.prototype=Object.create(Array.prototype);Pn.instanceString=function(){return"collection"};Pn.spawn=function(t,e){return new Ua(this.cy(),t,e)};Pn.spawnSelf=function(){return this.spawn(this)};Pn.cy=function(){return this._private.cy};Pn.renderer=function(){return this._private.cy.renderer()};Pn.element=function(){return this[0]};Pn.collection=function(){return PM(this)?this:new Ua(this._private.cy,[this])};Pn.unique=function(){return new Ua(this._private.cy,this,!0)};Pn.hasElementWithId=function(t){return t=""+t,this._private.map.has(t)};Pn.getElementById=function(t){t=""+t;var e=this._private.cy,r=this._private.map.get(t);return r?r.ele:new Ua(e)};Pn.$id=Pn.getElementById;Pn.poolIndex=function(){var t=this._private.cy,e=t._private.elements,r=this[0]._private.data.id;return e._private.map.get(r).index};Pn.indexOf=function(t){var e=t[0]._private.data.id;return this._private.map.get(e).index};Pn.indexOfId=function(t){return t=""+t,this._private.map.get(t).index};Pn.json=function(t){var e=this.element(),r=this.cy();if(e==null&&t)return this;if(e!=null){var n=e._private;if(Vr(t)){if(r.startBatch(),t.data){e.data(t.data);var i=n.data;if(e.isEdge()){var a=!1,s={},o=t.data.source,l=t.data.target;o!=null&&o!=i.source&&(s.source=""+o,a=!0),l!=null&&l!=i.target&&(s.target=""+l,a=!0),a&&(e=e.move(s))}else{var u="parent"in t.data,c=t.data.parent;u&&(c!=null||i.parent!=null)&&c!=i.parent&&(c===void 0&&(c=null),c!=null&&(c=""+c),e=e.move({parent:c}))}}t.position&&e.position(t.position);var f=function(S,w,E){var _=t[S];_!=null&&_!==n[S]&&(_?e[w]():e[E]())};return f("removed","remove","restore"),f("selected","select","unselect"),f("selectable","selectify","unselectify"),f("locked","lock","unlock"),f("grabbable","grabify","ungrabify"),f("pannable","panify","unpanify"),t.classes!=null&&e.classes(t.classes),r.endBatch(),this}else if(t===void 0){var p={data:ku(n.data),position:ku(n.position),group:n.group,removed:n.removed,selected:n.selected,selectable:n.selectable,locked:n.locked,grabbable:n.grabbable,pannable:n.pannable,classes:null};p.classes="";var v=0;return n.classes.forEach(function(y){return p.classes+=v++===0?y:" "+y}),p}}};Pn.jsons=function(){for(var t=[],e=0;e<this.length;e++){var r=this[e],n=r.json();t.push(n)}return t};Pn.clone=function(){for(var t=this.cy(),e=[],r=0;r<this.length;r++){var n=this[r],i=n.json(),a=new k1(t,i,!1);e.push(a)}return new Ua(t,e)};Pn.copy=Pn.clone;Pn.restore=function(){for(var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=this,n=r.cy(),i=n._private,a=[],s=[],o,l=0,u=r.length;l<u;l++){var c=r[l];e&&!c.removed()||(c.isNode()?a.push(c):s.push(c))}o=a.concat(s);var f,p=function(){o.splice(f,1),f--};for(f=0;f<o.length;f++){var v=o[f],y=v._private,S=y.data;if(v.clearTraversalCache(),!(!e&&!y.removed)){if(S.id===void 0)S.id=VM();else if(bt(S.id))S.id=""+S.id;else if(Zd(S.id)||!Kt(S.id)){Kn("Can not create element with invalid string ID `"+S.id+"`"),p();continue}else if(n.hasElementWithId(S.id)){Kn("Can not create second element with ID `"+S.id+"`"),p();continue}}var w=S.id;if(v.isNode()){var E=y.position;E.x==null&&(E.x=0),E.y==null&&(E.y=0)}if(v.isEdge()){for(var _=v,T=["source","target"],N=T.length,R=!1,I=0;I<N;I++){var F=T[I],D=S[F];bt(D)&&(D=S[F]=""+S[F]),D==null||D===""?(Kn("Can not create edge `"+w+"` with unspecified "+F),R=!0):n.hasElementWithId(D)||(Kn("Can not create edge `"+w+"` with nonexistant "+F+" `"+D+"`"),R=!0)}if(R){p();continue}var j=n.getElementById(S.source),B=n.getElementById(S.target);j.same(B)?j._private.edges.push(_):(j._private.edges.push(_),B._private.edges.push(_)),_._private.source=j,_._private.target=B}y.map=new dc,y.map.set(w,{ele:v,index:0}),y.removed=!1,e&&n.addToPool(v)}for(var G=0;G<a.length;G++){var K=a[G],O=K._private.data;bt(O.parent)&&(O.parent=""+O.parent);var W=O.parent,U=W!=null;if(U||K._private.parent){var q=K._private.parent?n.collection().merge(K._private.parent):n.getElementById(W);if(q.empty())O.parent=void 0;else if(q[0].removed())an("Node added with missing parent, reference to parent removed"),O.parent=void 0,K._private.parent=null;else{for(var Z=!1,Q=q;!Q.empty();){if(K.same(Q)){Z=!0,O.parent=void 0;break}Q=Q.parent()}Z||(q[0]._private.children.push(K),K._private.parent=q[0],i.hasCompoundNodes=!0)}}}if(o.length>0){for(var ne=o.length===r.length?r:new Ua(n,o),re=0;re<ne.length;re++){var Y=ne[re];Y.isNode()||(Y.parallelEdges().clearTraversalCache(),Y.source().clearTraversalCache(),Y.target().clearTraversalCache())}var J;i.hasCompoundNodes?J=n.collection().merge(ne).merge(ne.connectedNodes()).merge(ne.parent()):J=ne,J.dirtyCompoundBoundsCache().dirtyBoundingBoxCache().updateStyle(t),t?ne.emitAndNotify("add"):e&&ne.emit("add")}return r};Pn.removed=function(){var t=this[0];return t&&t._private.removed};Pn.inside=function(){var t=this[0];return t&&!t._private.removed};Pn.remove=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=this,n=[],i={},a=r._private.cy;function s(W){for(var U=W._private.edges,q=0;q<U.length;q++)l(U[q])}function o(W){for(var U=W._private.children,q=0;q<U.length;q++)l(U[q])}function l(W){var U=i[W.id()];e&&W.removed()||U||(i[W.id()]=!0,W.isNode()?(n.push(W),s(W),o(W)):n.unshift(W))}for(var u=0,c=r.length;u<c;u++){var f=r[u];l(f)}function p(W,U){var q=W._private.edges;Yd(q,U),W.clearTraversalCache()}function v(W){W.clearTraversalCache()}var y=[];y.ids={};function S(W,U){U=U[0],W=W[0];var q=W._private.children,Z=W.id();Yd(q,U),U._private.parent=null,y.ids[Z]||(y.ids[Z]=!0,y.push(W))}r.dirtyCompoundBoundsCache(),e&&a.removeFromPool(n);for(var w=0;w<n.length;w++){var E=n[w];if(E.isEdge()){var _=E.source()[0],T=E.target()[0];p(_,E),p(T,E);for(var N=E.parallelEdges(),R=0;R<N.length;R++){var I=N[R];v(I),I.isBundledBezier()&&I.dirtyBoundingBoxCache()}}else{var F=E.parent();F.length!==0&&S(F,E)}e&&(E._private.removed=!0)}var D=a._private.elements;a._private.hasCompoundNodes=!1;for(var j=0;j<D.length;j++){var B=D[j];if(B.isParent()){a._private.hasCompoundNodes=!0;break}}var G=new Ua(this.cy(),n);G.size()>0&&(t?G.emitAndNotify("remove"):e&&G.emit("remove"));for(var K=0;K<y.length;K++){var O=y[K];(!e||!O.removed())&&O.updateStyle()}return G};Pn.move=function(t){var e=this._private.cy,r=this,n=!1,i=!1,a=function(y){return y==null?y:""+y};if(t.source!==void 0||t.target!==void 0){var s=a(t.source),o=a(t.target),l=s!=null&&e.hasElementWithId(s),u=o!=null&&e.hasElementWithId(o);(l||u)&&(e.batch(function(){r.remove(n,i),r.emitAndNotify("moveout");for(var v=0;v<r.length;v++){var y=r[v],S=y._private.data;y.isEdge()&&(l&&(S.source=s),u&&(S.target=o))}r.restore(n,i)}),r.emitAndNotify("move"))}else if(t.parent!==void 0){var c=a(t.parent),f=c===null||e.hasElementWithId(c);if(f){var p=c===null?void 0:c;e.batch(function(){var v=r.remove(n,i);v.emitAndNotify("moveout");for(var y=0;y<r.length;y++){var S=r[y],w=S._private.data;S.isNode()&&(w.parent=p)}v.restore(n,i)}),r.emitAndNotify("move")}}return this};[tA,$B,jy,Ud,$p,u7,M1,C7,EA,TA,M7,cx,Fy,za,Gd,ss].forEach(function(t){ir(Pn,t)});var j7={add:function(e){var r,n=this;if(go(e)){var i=e;if(i._private.cy===n)r=i.restore();else{for(var a=[],s=0;s<i.length;s++){var o=i[s];a.push(o.json())}r=new Ua(n,a)}}else if(Sn(e)){var l=e;r=new Ua(n,l)}else if(Vr(e)&&(Sn(e.nodes)||Sn(e.edges))){for(var u=e,c=[],f=["nodes","edges"],p=0,v=f.length;p<v;p++){var y=f[p],S=u[y];if(Sn(S))for(var w=0,E=S.length;w<E;w++){var _=ir({group:y},S[w]);c.push(_)}}r=new Ua(n,c)}else{var T=e;r=new k1(n,T).collection()}return r},remove:function(e){if(!go(e)){if(Kt(e)){var r=e;e=this.$(r)}}return e.remove()}};function F7(t,e,r,n){var i=4,a=.001,s=1e-7,o=10,l=11,u=1/(l-1),c=typeof Float32Array<"u";if(arguments.length!==4)return!1;for(var f=0;f<4;++f)if(typeof arguments[f]!="number"||isNaN(arguments[f])||!isFinite(arguments[f]))return!1;t=Math.min(t,1),r=Math.min(r,1),t=Math.max(t,0),r=Math.max(r,0);var p=c?new Float32Array(l):new Array(l);function v(B,G){return 1-3*G+3*B}function y(B,G){return 3*G-6*B}function S(B){return 3*B}function w(B,G,K){return((v(G,K)*B+y(G,K))*B+S(G))*B}function E(B,G,K){return 3*v(G,K)*B*B+2*y(G,K)*B+S(G)}function _(B,G){for(var K=0;K<i;++K){var O=E(G,t,r);if(O===0)return G;var W=w(G,t,r)-B;G-=W/O}return G}function T(){for(var B=0;B<l;++B)p[B]=w(B*u,t,r)}function N(B,G,K){var O,W,U=0;do W=G+(K-G)/2,O=w(W,t,r)-B,O>0?K=W:G=W;while(Math.abs(O)>s&&++U<o);return W}function R(B){for(var G=0,K=1,O=l-1;K!==O&&p[K]<=B;++K)G+=u;--K;var W=(B-p[K])/(p[K+1]-p[K]),U=G+W*u,q=E(U,t,r);return q>=a?_(B,U):q===0?U:N(B,G,G+u)}var I=!1;function F(){I=!0,(t!==e||r!==n)&&T()}var D=function(G){return I||F(),t===e&&r===n?G:G===0?0:G===1?1:w(R(G),e,n)};D.getControlPoints=function(){return[{x:t,y:e},{x:r,y:n}]};var j="generateBezier("+[t,e,r,n]+")";return D.toString=function(){return j},D}var B7=(function(){function t(n){return-n.tension*n.x-n.friction*n.v}function e(n,i,a){var s={x:n.x+a.dx*i,v:n.v+a.dv*i,tension:n.tension,friction:n.friction};return{dx:s.v,dv:t(s)}}function r(n,i){var a={dx:n.v,dv:t(n)},s=e(n,i*.5,a),o=e(n,i*.5,s),l=e(n,i,o),u=1/6*(a.dx+2*(s.dx+o.dx)+l.dx),c=1/6*(a.dv+2*(s.dv+o.dv)+l.dv);return n.x=n.x+u*i,n.v=n.v+c*i,n}return function n(i,a,s){var o={x:-1,v:0,tension:null,friction:null},l=[0],u=0,c=1/1e4,f=16/1e3,p,v,y;for(i=parseFloat(i)||500,a=parseFloat(a)||20,s=s||null,o.tension=i,o.friction=a,p=s!==null,p?(u=n(i,a),v=u/s*f):v=f;y=r(y||o,v),l.push(1+y.x),u+=16,Math.abs(y.x)>c&&Math.abs(y.v)>c;);return p?function(S){return l[S*(l.length-1)|0]}:u}})(),Nn=function(e,r,n,i){var a=F7(e,r,n,i);return function(s,o,l){return s+(o-s)*a(l)}},By={linear:function(e,r,n){return e+(r-e)*n},ease:Nn(.25,.1,.25,1),"ease-in":Nn(.42,0,1,1),"ease-out":Nn(0,0,.58,1),"ease-in-out":Nn(.42,0,.58,1),"ease-in-sine":Nn(.47,0,.745,.715),"ease-out-sine":Nn(.39,.575,.565,1),"ease-in-out-sine":Nn(.445,.05,.55,.95),"ease-in-quad":Nn(.55,.085,.68,.53),"ease-out-quad":Nn(.25,.46,.45,.94),"ease-in-out-quad":Nn(.455,.03,.515,.955),"ease-in-cubic":Nn(.55,.055,.675,.19),"ease-out-cubic":Nn(.215,.61,.355,1),"ease-in-out-cubic":Nn(.645,.045,.355,1),"ease-in-quart":Nn(.895,.03,.685,.22),"ease-out-quart":Nn(.165,.84,.44,1),"ease-in-out-quart":Nn(.77,0,.175,1),"ease-in-quint":Nn(.755,.05,.855,.06),"ease-out-quint":Nn(.23,1,.32,1),"ease-in-out-quint":Nn(.86,0,.07,1),"ease-in-expo":Nn(.95,.05,.795,.035),"ease-out-expo":Nn(.19,1,.22,1),"ease-in-out-expo":Nn(1,0,0,1),"ease-in-circ":Nn(.6,.04,.98,.335),"ease-out-circ":Nn(.075,.82,.165,1),"ease-in-out-circ":Nn(.785,.135,.15,.86),spring:function(e,r,n){if(n===0)return By.linear;var i=B7(e,r,n);return function(a,s,o){return a+(s-a)*i(o)}},"cubic-bezier":Nn};function _N(t,e,r,n,i){if(n===1||e===r)return r;var a=i(e,r,n);return t==null||((t.roundValue||t.color)&&(a=Math.round(a)),t.min!==void 0&&(a=Math.max(a,t.min)),t.max!==void 0&&(a=Math.min(a,t.max))),a}function CN(t,e){return t.pfValue!=null||t.value!=null?t.pfValue!=null&&(e==null||e.type.units!=="%")?t.pfValue:t.value:t}function pp(t,e,r,n,i){var a=i!=null?i.type:null;r<0?r=0:r>1&&(r=1);var s=CN(t,i),o=CN(e,i);if(bt(s)&&bt(o))return _N(a,s,o,r,n);if(Sn(s)&&Sn(o)){for(var l=[],u=0;u<o.length;u++){var c=s[u],f=o[u];if(c!=null&&f!=null){var p=_N(a,c,f,r,n);l.push(p)}else l.push(f)}return l}}function z7(t,e,r,n){var i=!n,a=t._private,s=e._private,o=s.easing,l=s.startTime,u=n?t:t.cy(),c=u.style();if(!s.easingImpl)if(o==null)s.easingImpl=By.linear;else{var f;if(Kt(o)){var p=c.parse("transition-timing-function",o);f=p.value}else f=o;var v,y;Kt(f)?(v=f,y=[]):(v=f[1],y=f.slice(2).map(function(ne){return+ne})),y.length>0?(v==="spring"&&y.push(s.duration),s.easingImpl=By[v].apply(null,y)):s.easingImpl=By[v]}var S=s.easingImpl,w;if(s.duration===0?w=1:w=(r-l)/s.duration,s.applying&&(w=s.progress),w<0?w=0:w>1&&(w=1),s.delay==null){var E=s.startPosition,_=s.position;if(_&&i&&!t.locked()){var T={};Hm(E.x,_.x)&&(T.x=pp(E.x,_.x,w,S)),Hm(E.y,_.y)&&(T.y=pp(E.y,_.y,w,S)),t.position(T)}var N=s.startPan,R=s.pan,I=a.pan,F=R!=null&&n;F&&(Hm(N.x,R.x)&&(I.x=pp(N.x,R.x,w,S)),Hm(N.y,R.y)&&(I.y=pp(N.y,R.y,w,S)),t.emit("pan"));var D=s.startZoom,j=s.zoom,B=j!=null&&n;B&&(Hm(D,j)&&(a.zoom=Sv(a.minZoom,pp(D,j,w,S),a.maxZoom)),t.emit("zoom")),(F||B)&&t.emit("viewport");var G=s.style;if(G&&G.length>0&&i){for(var K=0;K<G.length;K++){var O=G[K],W=O.name,U=O,q=s.startStyle[W],Z=c.properties[q.name],Q=pp(q,U,w,S,Z);c.overrideBypass(t,W,Q)}t.emit("style")}}return s.progress=w,w}function Hm(t,e){return t==null||e==null?!1:bt(t)&&bt(e)?!0:!!(t&&e)}function U7(t,e,r,n){var i=e._private;i.started=!0,i.startTime=r-i.progress*i.duration}function EN(t,e){var r=e._private.aniEles,n=[];function i(c,f){var p=c._private,v=p.animation.current,y=p.animation.queue,S=!1;if(v.length===0){var w=y.shift();w&&v.push(w)}for(var E=function(I){for(var F=I.length-1;F>=0;F--){var D=I[F];D()}I.splice(0,I.length)},_=v.length-1;_>=0;_--){var T=v[_],N=T._private;if(N.stopped){v.splice(_,1),N.hooked=!1,N.playing=!1,N.started=!1,E(N.frames);continue}!N.playing&&!N.applying||(N.playing&&N.applying&&(N.applying=!1),N.started||U7(c,T,t),z7(c,T,t,f),N.applying&&(N.applying=!1),E(N.frames),N.step!=null&&N.step(t),T.completed()&&(v.splice(_,1),N.hooked=!1,N.playing=!1,N.started=!1,E(N.completes)),S=!0)}return!f&&v.length===0&&y.length===0&&n.push(c),S}for(var a=!1,s=0;s<r.length;s++){var o=r[s],l=i(o);a=a||l}var u=i(e,!0);(a||u)&&(r.length>0?e.notify("draw",r):e.notify("draw")),r.unmerge(n),e.emit("step")}var G7={animate:nn.animate(),animation:nn.animation(),animated:nn.animated(),clearQueue:nn.clearQueue(),delay:nn.delay(),delayAnimation:nn.delayAnimation(),stop:nn.stop(),addToAnimationPool:function(e){var r=this;r.styleEnabled()&&r._private.aniEles.merge(e)},stopAnimationLoop:function(){this._private.animationsRunning=!1},startAnimationLoop:function(){var e=this;if(e._private.animationsRunning=!0,!e.styleEnabled())return;function r(){e._private.animationsRunning&&ax(function(a){EN(a,e),r()})}var n=e.renderer();n&&n.beforeRender?n.beforeRender(function(a,s){EN(s,e)},n.beforeRenderPriorities.animations):r()}},V7={qualifierCompare:function(e,r){return e==null||r==null?e==null&&r==null:e.sameText(r)},eventMatches:function(e,r,n){var i=r.qualifier;return i!=null?e!==n.target&&Kv(n.target)&&i.matches(n.target):!0},addEventFields:function(e,r){r.cy=e,r.target=e},callbackContext:function(e,r,n){return r.qualifier!=null?n.target:e}},iy=function(e){return Kt(e)?new Qd(e):e},MA={createEmitter:function(){var e=this._private;return e.emitter||(e.emitter=new A1(V7,this)),this},emitter:function(){return this._private.emitter},on:function(e,r,n){return this.emitter().on(e,iy(r),n),this},removeListener:function(e,r,n){return this.emitter().removeListener(e,iy(r),n),this},removeAllListeners:function(){return this.emitter().removeAllListeners(),this},one:function(e,r,n){return this.emitter().one(e,iy(r),n),this},once:function(e,r,n){return this.emitter().one(e,iy(r),n),this},emit:function(e,r){return this.emitter().emit(e,r),this},emitAndNotify:function(e,r){return this.emit(e),this.notify(e,r),this}};nn.eventAliasesOn(MA);var GS={png:function(e){var r=this._private.renderer;return e=e||{},r.png(e)},jpg:function(e){var r=this._private.renderer;return e=e||{},e.bg=e.bg||"#fff",r.jpg(e)}};GS.jpeg=GS.jpg;var zy={layout:function(e){var r=this;if(e==null){Kn("Layout options must be specified to make a layout");return}if(e.name==null){Kn("A `name` must be specified to make a layout");return}var n=e.name,i=r.extension("layout",n);if(i==null){Kn("No such layout `"+n+"` found.  Did you forget to import it and `cytoscape.use()` it?");return}var a;Kt(e.eles)?a=r.$(e.eles):a=e.eles!=null?e.eles:r.$();var s=new i(ir({},e,{cy:r,eles:a}));return s}};zy.createLayout=zy.makeLayout=zy.layout;var H7={notify:function(e,r){var n=this._private;if(this.batching()){n.batchNotifications=n.batchNotifications||{};var i=n.batchNotifications[e]=n.batchNotifications[e]||this.collection();r!=null&&i.merge(r);return}if(n.notificationsEnabled){var a=this.renderer();this.destroyed()||!a||a.notify(e,r)}},notifications:function(e){var r=this._private;return e===void 0?r.notificationsEnabled:(r.notificationsEnabled=!!e,this)},noNotifications:function(e){this.notifications(!1),e(),this.notifications(!0)},batching:function(){return this._private.batchCount>0},startBatch:function(){var e=this._private;return e.batchCount==null&&(e.batchCount=0),e.batchCount===0&&(e.batchStyleEles=this.collection(),e.batchNotifications={}),e.batchCount++,this},endBatch:function(){var e=this._private;if(e.batchCount===0)return this;if(e.batchCount--,e.batchCount===0){e.batchStyleEles.updateStyle();var r=this.renderer();Object.keys(e.batchNotifications).forEach(function(n){var i=e.batchNotifications[n];i.empty()?r.notify(n):r.notify(n,i)})}return this},batch:function(e){return this.startBatch(),e(),this.endBatch(),this},batchData:function(e){var r=this;return this.batch(function(){for(var n=Object.keys(e),i=0;i<n.length;i++){var a=n[i],s=e[a],o=r.getElementById(a);o.data(s)}})}},W7=Ha({hideEdgesOnViewport:!1,textureOnViewport:!1,motionBlur:!1,motionBlurOpacity:.05,pixelRatio:void 0,desktopTapThreshold:4,touchTapThreshold:8,wheelSensitivity:1,debug:!1,showFps:!1,webgl:!1,webglDebug:!1,webglDebugShowAtlases:!1,webglTexSize:2048,webglTexRows:36,webglTexRowsNodes:18,webglBatchSize:2048,webglTexPerBatch:14,webglBgColor:[255,255,255]}),VS={renderTo:function(e,r,n,i){var a=this._private.renderer;return a.renderTo(e,r,n,i),this},renderer:function(){return this._private.renderer},forceRender:function(){return this.notify("draw"),this},resize:function(){return this.invalidateSize(),this.emitAndNotify("resize"),this},initRenderer:function(e){var r=this,n=r.extension("renderer",e.name);if(n==null){Kn("Can not initialise: No such renderer `".concat(e.name,"` found. Did you forget to import it and `cytoscape.use()` it?"));return}e.wheelSensitivity!==void 0&&an("You have set a custom wheel sensitivity.  This will make your app zoom unnaturally when using mainstream mice.  You should change this value from the default only if you can guarantee that all your users will use the same hardware and OS configuration as your current machine.");var i=W7(e);i.cy=r,r._private.renderer=new n(i),this.notify("init")},destroyRenderer:function(){var e=this;e.notify("destroy");var r=e.container();if(r)for(r._cyreg=null;r.childNodes.length>0;)r.removeChild(r.childNodes[0]);e._private.renderer=null,e.mutableElements().forEach(function(n){var i=n._private;i.rscratch={},i.rstyle={},i.animation.current=[],i.animation.queue=[]})},onRender:function(e){return this.on("render",e)},offRender:function(e){return this.off("render",e)}};VS.invalidateDimensions=VS.resize;var Uy={collection:function(e,r){return Kt(e)?this.$(e):go(e)?e.collection():Sn(e)?(r||(r={}),new Ua(this,e,r.unique,r.removed)):new Ua(this)},nodes:function(e){var r=this.$(function(n){return n.isNode()});return e?r.filter(e):r},edges:function(e){var r=this.$(function(n){return n.isEdge()});return e?r.filter(e):r},$:function(e){var r=this._private.elements;return e?r.filter(e):r.spawnSelf()},mutableElements:function(){return this._private.elements}};Uy.elements=Uy.filter=Uy.$;var xa={},ev="t",q7="f";xa.apply=function(t){for(var e=this,r=e._private,n=r.cy,i=n.collection(),a=0;a<t.length;a++){var s=t[a],o=e.getContextMeta(s);if(!o.empty){var l=e.getContextStyle(o),u=e.applyContextStyle(o,l,s);s._private.appliedInitStyle?e.updateTransitions(s,u.diffProps):s._private.appliedInitStyle=!0;var c=e.updateStyleHints(s);c&&i.push(s)}}return i};xa.getPropertiesDiff=function(t,e){var r=this,n=r._private.propDiffs=r._private.propDiffs||{},i=t+"-"+e,a=n[i];if(a)return a;for(var s=[],o={},l=0;l<r.length;l++){var u=r[l],c=t[l]===ev,f=e[l]===ev,p=c!==f,v=u.mappedProperties.length>0;if(p||f&&v){var y=void 0;p&&v||p?y=u.properties:v&&(y=u.mappedProperties);for(var S=0;S<y.length;S++){for(var w=y[S],E=w.name,_=!1,T=l+1;T<r.length;T++){var N=r[T],R=e[T]===ev;if(R&&(_=N.properties[w.name]!=null,_))break}!o[E]&&!_&&(o[E]=!0,s.push(E))}}}return n[i]=s,s};xa.getContextMeta=function(t){for(var e=this,r="",n,i=t._private.styleCxtKey||"",a=0;a<e.length;a++){var s=e[a],o=s.selector&&s.selector.matches(t);o?r+=ev:r+=q7}return n=e.getPropertiesDiff(i,r),t._private.styleCxtKey=r,{key:r,diffPropNames:n,empty:n.length===0}};xa.getContextStyle=function(t){var e=t.key,r=this,n=this._private.contextStyles=this._private.contextStyles||{};if(n[e])return n[e];for(var i={_private:{key:e}},a=0;a<r.length;a++){var s=r[a],o=e[a]===ev;if(o)for(var l=0;l<s.properties.length;l++){var u=s.properties[l];i[u.name]=u}}return n[e]=i,i};xa.applyContextStyle=function(t,e,r){for(var n=this,i=t.diffPropNames,a={},s=n.types,o=0;o<i.length;o++){var l=i[o],u=e[l],c=r.pstyle(l);if(!u)if(c)c.bypass?u={name:l,deleteBypassed:!0}:u={name:l,delete:!0};else continue;if(c!==u){if(u.mapped===s.fn&&c!=null&&c.mapping!=null&&c.mapping.value===u.value){var f=c.mapping,p=f.fnValue=u.value(r);if(p===f.prevFnValue)continue}var v=a[l]={prev:c};n.applyParsedProperty(r,u),v.next=r.pstyle(l),v.next&&v.next.bypass&&(v.next=v.next.bypassed)}}return{diffProps:a}};xa.updateStyleHints=function(t){var e=t._private,r=this,n=r.propertyGroupNames,i=r.propertyGroupKeys,a=function(ye,Se,Ue){return r.getPropertiesHash(ye,Se,Ue)},s=e.styleKey;if(t.removed())return!1;var o=e.group==="nodes",l=t._private.style;n=Object.keys(l);for(var u=0;u<i.length;u++){var c=i[u];e.styleKeys[c]=[Xf,Cp]}for(var f=function(ye,Se){return e.styleKeys[Se][0]=xv(ye,e.styleKeys[Se][0])},p=function(ye,Se){return e.styleKeys[Se][1]=bv(ye,e.styleKeys[Se][1])},v=function(ye,Se){f(ye,Se),p(ye,Se)},y=function(ye,Se){for(var Ue=0;Ue<ye.length;Ue++){var Oe=ye.charCodeAt(Ue);f(Oe,Se),p(Oe,Se)}},S=2e9,w=function(ye){return-128<ye&&ye<128&&Math.floor(ye)!==ye?S-(ye*1024|0):ye},E=0;E<n.length;E++){var _=n[E],T=l[_];if(T!=null){var N=this.properties[_],R=N.type,I=N.groupKey,F=void 0;N.hashOverride!=null?F=N.hashOverride(t,T):T.pfValue!=null&&(F=T.pfValue);var D=N.enums==null?T.value:null,j=F!=null,B=D!=null,G=j||B,K=T.units;if(R.number&&G&&!R.multiple){var O=j?F:D;v(w(O),I),!j&&K!=null&&y(K,I)}else y(T.strValue,I)}}for(var W=[Xf,Cp],U=0;U<i.length;U++){var q=i[U],Z=e.styleKeys[q];W[0]=xv(Z[0],W[0]),W[1]=bv(Z[1],W[1])}e.styleKey=l9(W[0],W[1]);var Q=e.styleKeys;e.labelDimsKey=vd(Q.labelDimensions);var ne=a(t,["label"],Q.labelDimensions);if(e.labelKey=vd(ne),e.labelStyleKey=vd(Y0(Q.commonLabel,ne)),!o){var re=a(t,["source-label"],Q.labelDimensions);e.sourceLabelKey=vd(re),e.sourceLabelStyleKey=vd(Y0(Q.commonLabel,re));var Y=a(t,["target-label"],Q.labelDimensions);e.targetLabelKey=vd(Y),e.targetLabelStyleKey=vd(Y0(Q.commonLabel,Y))}if(o){var J=e.styleKeys,ie=J.nodeBody,de=J.nodeBorder,he=J.nodeOutline,xe=J.backgroundImage,le=J.compound,fe=J.pie,ve=J.stripe,ge=[ie,de,he,xe,le,fe,ve].filter(function(se){return se!=null}).reduce(Y0,[Xf,Cp]);e.nodeKey=vd(ge),e.hasPie=fe!=null&&fe[0]!==Xf&&fe[1]!==Cp,e.hasStripe=ve!=null&&ve[0]!==Xf&&ve[1]!==Cp}return s!==e.styleKey};xa.clearStyleHints=function(t){var e=t._private;e.styleCxtKey="",e.styleKeys={},e.styleKey=null,e.labelKey=null,e.labelStyleKey=null,e.sourceLabelKey=null,e.sourceLabelStyleKey=null,e.targetLabelKey=null,e.targetLabelStyleKey=null,e.nodeKey=null,e.hasPie=null,e.hasStripe=null};xa.applyParsedProperty=function(t,e){var r=this,n=e,i=t._private.style,a,s=r.types,o=r.properties[n.name].type,l=n.bypass,u=i[n.name],c=u&&u.bypass,f=t._private,p="mapping",v=function(ie){return ie==null?null:ie.pfValue!=null?ie.pfValue:ie.value},y=function(){var ie=v(u),de=v(n);r.checkTriggers(t,n.name,ie,de)};if(e.name==="curve-style"&&t.isEdge()&&(e.value!=="bezier"&&t.isLoop()||e.value==="haystack"&&(t.source().isParent()||t.target().isParent()))&&(n=e=this.parse(e.name,"bezier",l)),n.delete)return i[n.name]=void 0,y(),!0;if(n.deleteBypassed)return u?u.bypass?(u.bypassed=void 0,y(),!0):!1:(y(),!0);if(n.deleteBypass)return u?u.bypass?(i[n.name]=u.bypassed,y(),!0):!1:(y(),!0);var S=function(){an("Do not assign mappings to elements without corresponding data (i.e. ele `"+t.id()+"` has no mapping for property `"+n.name+"` with data field `"+n.field+"`); try a `["+n.field+"]` selector to limit scope to elements with `"+n.field+"` defined")};switch(n.mapped){case s.mapData:{for(var w=n.field.split("."),E=f.data,_=0;_<w.length&&E;_++){var T=w[_];E=E[T]}if(E==null)return S(),!1;var N;if(bt(E)){var R=n.fieldMax-n.fieldMin;R===0?N=0:N=(E-n.fieldMin)/R}else return an("Do not use continuous mappers without specifying numeric data (i.e. `"+n.field+": "+E+"` for `"+t.id()+"` is non-numeric)"),!1;if(N<0?N=0:N>1&&(N=1),o.color){var I=n.valueMin[0],F=n.valueMax[0],D=n.valueMin[1],j=n.valueMax[1],B=n.valueMin[2],G=n.valueMax[2],K=n.valueMin[3]==null?1:n.valueMin[3],O=n.valueMax[3]==null?1:n.valueMax[3],W=[Math.round(I+(F-I)*N),Math.round(D+(j-D)*N),Math.round(B+(G-B)*N),Math.round(K+(O-K)*N)];a={bypass:n.bypass,name:n.name,value:W,strValue:"rgb("+W[0]+", "+W[1]+", "+W[2]+")"}}else if(o.number){var U=n.valueMin+(n.valueMax-n.valueMin)*N;a=this.parse(n.name,U,n.bypass,p)}else return!1;if(!a)return S(),!1;a.mapping=n,n=a;break}case s.data:{for(var q=n.field.split("."),Z=f.data,Q=0;Q<q.length&&Z;Q++){var ne=q[Q];Z=Z[ne]}if(Z!=null&&(a=this.parse(n.name,Z,n.bypass,p)),!a)return S(),!1;a.mapping=n,n=a;break}case s.fn:{var re=n.value,Y=n.fnValue!=null?n.fnValue:re(t);if(n.prevFnValue=Y,Y==null)return an("Custom function mappers may not return null (i.e. `"+n.name+"` for ele `"+t.id()+"` is null)"),!1;if(a=this.parse(n.name,Y,n.bypass,p),!a)return an("Custom function mappers may not return invalid values for the property type (i.e. `"+n.name+"` for ele `"+t.id()+"` is invalid)"),!1;a.mapping=ku(n),n=a;break}case void 0:break;default:return!1}return l?(c?n.bypassed=u.bypassed:n.bypassed=u,i[n.name]=n):c?u.bypassed=n:i[n.name]=n,y(),!0};xa.cleanElements=function(t,e){for(var r=0;r<t.length;r++){var n=t[r];if(this.clearStyleHints(n),n.dirtyCompoundBoundsCache(),n.dirtyBoundingBoxCache(),!e)n._private.style={};else for(var i=n._private.style,a=Object.keys(i),s=0;s<a.length;s++){var o=a[s],l=i[o];l!=null&&(l.bypass?l.bypassed=null:i[o]=null)}}};xa.update=function(){var t=this._private.cy,e=t.mutableElements();e.updateStyle()};xa.updateTransitions=function(t,e){var r=this,n=t._private,i=t.pstyle("transition-property").value,a=t.pstyle("transition-duration").pfValue,s=t.pstyle("transition-delay").pfValue;if(i.length>0&&a>0){for(var o={},l=!1,u=0;u<i.length;u++){var c=i[u],f=t.pstyle(c),p=e[c];if(p){var v=p.prev,y=v,S=p.next!=null?p.next:f,w=!1,E=void 0,_=1e-6;y&&(bt(y.pfValue)&&bt(S.pfValue)?(w=S.pfValue-y.pfValue,E=y.pfValue+_*w):bt(y.value)&&bt(S.value)?(w=S.value-y.value,E=y.value+_*w):Sn(y.value)&&Sn(S.value)&&(w=y.value[0]!==S.value[0]||y.value[1]!==S.value[1]||y.value[2]!==S.value[2],E=y.strValue),w&&(o[c]=S.strValue,this.applyBypass(t,c,E),l=!0))}}if(!l)return;n.transitioning=!0,new cm(function(T){s>0?t.delayAnimation(s).play().promise().then(T):T()}).then(function(){return t.animation({style:o,duration:a,easing:t.pstyle("transition-timing-function").value,queue:!1}).play().promise()}).then(function(){r.removeBypasses(t,i),t.emitAndNotify("style"),n.transitioning=!1})}else n.transitioning&&(this.removeBypasses(t,i),t.emitAndNotify("style"),n.transitioning=!1)};xa.checkTrigger=function(t,e,r,n,i,a){var s=this.properties[e],o=i(s);t.removed()||o!=null&&o(r,n,t)&&a(s)};xa.checkZOrderTrigger=function(t,e,r,n){var i=this;this.checkTrigger(t,e,r,n,function(a){return a.triggersZOrder},function(){i._private.cy.notify("zorder",t)})};xa.checkBoundsTrigger=function(t,e,r,n){this.checkTrigger(t,e,r,n,function(i){return i.triggersBounds},function(i){t.dirtyCompoundBoundsCache(),t.dirtyBoundingBoxCache()})};xa.checkConnectedEdgesBoundsTrigger=function(t,e,r,n){this.checkTrigger(t,e,r,n,function(i){return i.triggersBoundsOfConnectedEdges},function(i){t.connectedEdges().forEach(function(a){a.dirtyBoundingBoxCache()})})};xa.checkParallelEdgesBoundsTrigger=function(t,e,r,n){this.checkTrigger(t,e,r,n,function(i){return i.triggersBoundsOfParallelEdges},function(i){t.parallelEdges().forEach(function(a){a.dirtyBoundingBoxCache()})})};xa.checkTriggers=function(t,e,r,n){t.dirtyStyleCache(),this.checkZOrderTrigger(t,e,r,n),this.checkBoundsTrigger(t,e,r,n),this.checkConnectedEdgesBoundsTrigger(t,e,r,n),this.checkParallelEdgesBoundsTrigger(t,e,r,n)};var t0={};t0.applyBypass=function(t,e,r,n){var i=this,a=[],s=!0;if(e==="*"||e==="**"){if(r!==void 0)for(var o=0;o<i.properties.length;o++){var l=i.properties[o],u=l.name,c=this.parse(u,r,!0);c&&a.push(c)}}else if(Kt(e)){var f=this.parse(e,r,!0);f&&a.push(f)}else if(Vr(e)){var p=e;n=r;for(var v=Object.keys(p),y=0;y<v.length;y++){var S=v[y],w=p[S];if(w===void 0&&(w=p[w1(S)]),w!==void 0){var E=this.parse(S,w,!0);E&&a.push(E)}}}else return!1;if(a.length===0)return!1;for(var _=!1,T=0;T<t.length;T++){for(var N=t[T],R={},I=void 0,F=0;F<a.length;F++){var D=a[F];if(n){var j=N.pstyle(D.name);I=R[D.name]={prev:j}}_=this.applyParsedProperty(N,ku(D))||_,n&&(I.next=N.pstyle(D.name))}_&&this.updateStyleHints(N),n&&this.updateTransitions(N,R,s)}return _};t0.overrideBypass=function(t,e,r){e=Xk(e);for(var n=0;n<t.length;n++){var i=t[n],a=i._private.style[e],s=this.properties[e].type,o=s.color,l=s.mutiple,u=a?a.pfValue!=null?a.pfValue:a.value:null;!a||!a.bypass?this.applyBypass(i,e,r):(a.value=r,a.pfValue!=null&&(a.pfValue=r),o?a.strValue="rgb("+r.join(",")+")":l?a.strValue=r.join(" "):a.strValue=""+r,this.updateStyleHints(i)),this.checkTriggers(i,e,u,r)}};t0.removeAllBypasses=function(t,e){return this.removeBypasses(t,this.propertyNames,e)};t0.removeBypasses=function(t,e,r){for(var n=!0,i=0;i<t.length;i++){for(var a=t[i],s={},o=0;o<e.length;o++){var l=e[o],u=this.properties[l],c=a.pstyle(u.name);if(!(!c||!c.bypass)){var f="",p=this.parse(l,f,!0),v=s[u.name]={prev:c};this.applyParsedProperty(a,p),v.next=a.pstyle(u.name)}}this.updateStyleHints(a),r&&this.updateTransitions(a,s,n)}};var f_={};f_.getEmSizeInPixels=function(){var t=this.containerCss("font-size");return t!=null?parseFloat(t):1};f_.containerCss=function(t){var e=this._private.cy,r=e.container(),n=e.window();if(n&&r&&n.getComputedStyle)return n.getComputedStyle(r).getPropertyValue(t)};var Tu={};Tu.getRenderedStyle=function(t,e){return e?this.getStylePropertyValue(t,e,!0):this.getRawStyle(t,!0)};Tu.getRawStyle=function(t,e){var r=this;if(t=t[0],t){for(var n={},i=0;i<r.properties.length;i++){var a=r.properties[i],s=r.getStylePropertyValue(t,a.name,e);s!=null&&(n[a.name]=s,n[w1(a.name)]=s)}return n}};Tu.getIndexedStyle=function(t,e,r,n){var i=t.pstyle(e)[r][n];return i??t.cy().style().getDefaultProperty(e)[r][0]};Tu.getStylePropertyValue=function(t,e,r){var n=this;if(t=t[0],t){var i=n.properties[e];i.alias&&(i=i.pointsTo);var a=i.type,s=t.pstyle(i.name);if(s){var o=s.value,l=s.units,u=s.strValue;if(r&&a.number&&o!=null&&bt(o)){var c=t.cy().zoom(),f=function(w){return w*c},p=function(w,E){return f(w)+E},v=Sn(o),y=v?l.every(function(S){return S!=null}):l!=null;return y?v?o.map(function(S,w){return p(S,l[w])}).join(" "):p(o,l):v?o.map(function(S){return Kt(S)?S:""+f(S)}).join(" "):""+f(o)}else if(u!=null)return u}return null}};Tu.getAnimationStartStyle=function(t,e){for(var r={},n=0;n<e.length;n++){var i=e[n],a=i.name,s=t.pstyle(a);s!==void 0&&(Vr(s)?s=this.parse(a,s.strValue):s=this.parse(a,s)),s&&(r[a]=s)}return r};Tu.getPropsList=function(t){var e=this,r=[],n=t,i=e.properties;if(n)for(var a=Object.keys(n),s=0;s<a.length;s++){var o=a[s],l=n[o],u=i[o]||i[Xk(o)],c=this.parse(u.name,l);c&&r.push(c)}return r};Tu.getNonDefaultPropertiesHash=function(t,e,r){var n=r.slice(),i,a,s,o,l,u;for(l=0;l<e.length;l++)if(i=e[l],a=t.pstyle(i,!1),a!=null)if(a.pfValue!=null)n[0]=xv(o,n[0]),n[1]=bv(o,n[1]);else for(s=a.strValue,u=0;u<s.length;u++)o=s.charCodeAt(u),n[0]=xv(o,n[0]),n[1]=bv(o,n[1]);return n};Tu.getPropertiesHash=Tu.getNonDefaultPropertiesHash;var O1={};O1.appendFromJson=function(t){for(var e=this,r=0;r<t.length;r++){var n=t[r],i=n.selector,a=n.style||n.css,s=Object.keys(a);e.selector(i);for(var o=0;o<s.length;o++){var l=s[o],u=a[l];e.css(l,u)}}return e};O1.fromJson=function(t){var e=this;return e.resetToDefault(),e.appendFromJson(t),e};O1.json=function(){for(var t=[],e=this.defaultLength;e<this.length;e++){for(var r=this[e],n=r.selector,i=r.properties,a={},s=0;s<i.length;s++){var o=i[s];a[o.name]=o.strValue}t.push({selector:n?n.toString():"core",style:a})}return t};var h_={};h_.appendFromString=function(t){var e=this,r=this,n=""+t,i,a,s;n=n.replace(/[/][*](\s|.)+?[*][/]/g,"");function o(){n.length>i.length?n=n.substr(i.length):n=""}function l(){a.length>s.length?a=a.substr(s.length):a=""}for(;;){var u=n.match(/^\s*$/);if(u)break;var c=n.match(/^\s*((?:.|\s)+?)\s*\{((?:.|\s)+?)\}/);if(!c){an("Halting stylesheet parsing: String stylesheet contains more to parse but no selector and block found in: "+n);break}i=c[0];var f=c[1];if(f!=="core"){var p=new Qd(f);if(p.invalid){an("Skipping parsing of block: Invalid selector found in string stylesheet: "+f),o();continue}}var v=c[2],y=!1;a=v;for(var S=[];;){var w=a.match(/^\s*$/);if(w)break;var E=a.match(/^\s*(.+?)\s*:\s*(.+?)(?:\s*;|\s*$)/);if(!E){an("Skipping parsing of block: Invalid formatting of style property and value definitions found in:"+v),y=!0;break}s=E[0];var _=E[1],T=E[2],N=e.properties[_];if(!N){an("Skipping property: Invalid property name in: "+s),l();continue}var R=r.parse(_,T);if(!R){an("Skipping property: Invalid property definition in: "+s),l();continue}S.push({name:_,val:T}),l()}if(y){o();break}r.selector(f);for(var I=0;I<S.length;I++){var F=S[I];r.css(F.name,F.val)}o()}return r};h_.fromString=function(t){var e=this;return e.resetToDefault(),e.appendFromString(t),e};var Oi={};(function(){var t=Wi,e=zj,r=Gj,n=Vj,i=Hj,a=function(se){return"^"+se+"\\s*\\(\\s*([\\w\\.]+)\\s*\\)$"},s=function(se){var ye=t+"|\\w+|"+e+"|"+r+"|"+n+"|"+i;return"^"+se+"\\s*\\(([\\w\\.]+)\\s*\\,\\s*("+t+")\\s*\\,\\s*("+t+")\\s*,\\s*("+ye+")\\s*\\,\\s*("+ye+")\\)$"},o=[`^url\\s*\\(\\s*['"]?(.+?)['"]?\\s*\\)$`,"^(none)$","^(.+)$"];Oi.types={time:{number:!0,min:0,units:"s|ms",implicitUnits:"ms"},percent:{number:!0,min:0,max:100,units:"%",implicitUnits:"%"},percentages:{number:!0,min:0,max:100,units:"%",implicitUnits:"%",multiple:!0},zeroOneNumber:{number:!0,min:0,max:1,unitless:!0},zeroOneNumbers:{number:!0,min:0,max:1,unitless:!0,multiple:!0},nOneOneNumber:{number:!0,min:-1,max:1,unitless:!0},nonNegativeInt:{number:!0,min:0,integer:!0,unitless:!0},nonNegativeNumber:{number:!0,min:0,unitless:!0},position:{enums:["parent","origin"]},nodeSize:{number:!0,min:0,enums:["label"]},number:{number:!0,unitless:!0},numbers:{number:!0,unitless:!0,multiple:!0},positiveNumber:{number:!0,unitless:!0,min:0,strictMin:!0},size:{number:!0,min:0},bidirectionalSize:{number:!0},bidirectionalSizeMaybePercent:{number:!0,allowPercent:!0},bidirectionalSizes:{number:!0,multiple:!0},sizeMaybePercent:{number:!0,min:0,allowPercent:!0},axisDirection:{enums:["horizontal","leftward","rightward","vertical","upward","downward","auto"]},axisDirectionExplicit:{enums:["leftward","rightward","upward","downward"]},axisDirectionPrimary:{enums:["horizontal","vertical"]},paddingRelativeTo:{enums:["width","height","average","min","max"]},bgWH:{number:!0,min:0,allowPercent:!0,enums:["auto"],multiple:!0},bgPos:{number:!0,allowPercent:!0,multiple:!0},bgRelativeTo:{enums:["inner","include-padding"],multiple:!0},bgRepeat:{enums:["repeat","repeat-x","repeat-y","no-repeat"],multiple:!0},bgFit:{enums:["none","contain","cover"],multiple:!0},bgCrossOrigin:{enums:["anonymous","use-credentials","null"],multiple:!0},bgClip:{enums:["none","node"],multiple:!0},bgContainment:{enums:["inside","over"],multiple:!0},boxSelection:{enums:["contain","overlap","none"]},color:{color:!0},colors:{color:!0,multiple:!0},fill:{enums:["solid","linear-gradient","radial-gradient"]},bool:{enums:["yes","no"]},bools:{enums:["yes","no"],multiple:!0},lineStyle:{enums:["solid","dotted","dashed"]},lineCap:{enums:["butt","round","square"]},linePosition:{enums:["center","inside","outside"]},lineJoin:{enums:["round","bevel","miter"]},borderStyle:{enums:["solid","dotted","dashed","double"]},curveStyle:{enums:["bezier","unbundled-bezier","haystack","segments","straight","straight-triangle","taxi","round-segments","round-taxi"]},radiusType:{enums:["arc-radius","influence-radius"],multiple:!0},fontFamily:{regex:'^([\\w- \\"]+(?:\\s*,\\s*[\\w- \\"]+)*)$'},fontStyle:{enums:["italic","normal","oblique"]},fontWeight:{enums:["normal","bold","bolder","lighter","100","200","300","400","500","600","800","900",100,200,300,400,500,600,700,800,900]},textDecoration:{enums:["none","underline","overline","line-through"]},textTransform:{enums:["none","uppercase","lowercase"]},textWrap:{enums:["none","wrap","ellipsis"]},textOverflowWrap:{enums:["whitespace","anywhere"]},textBackgroundShape:{enums:["rectangle","roundrectangle","round-rectangle","circle"]},nodeShape:{enums:["rectangle","roundrectangle","round-rectangle","cutrectangle","cut-rectangle","bottomroundrectangle","bottom-round-rectangle","barrel","ellipse","triangle","round-triangle","square","pentagon","round-pentagon","hexagon","round-hexagon","concavehexagon","concave-hexagon","heptagon","round-heptagon","octagon","round-octagon","tag","round-tag","star","diamond","round-diamond","vee","rhomboid","right-rhomboid","polygon"]},overlayShape:{enums:["roundrectangle","round-rectangle","ellipse"]},cornerRadius:{number:!0,min:0,units:"px|em",implicitUnits:"px",enums:["auto"]},compoundIncludeLabels:{enums:["include","exclude"]},arrowShape:{enums:["tee","triangle","triangle-tee","circle-triangle","triangle-cross","triangle-backcurve","vee","square","circle","diamond","chevron","none"]},arrowFill:{enums:["filled","hollow"]},arrowWidth:{number:!0,units:"%|px|em",implicitUnits:"px",enums:["match-line"]},display:{enums:["element","none"]},visibility:{enums:["hidden","visible"]},zCompoundDepth:{enums:["bottom","orphan","auto","top"]},zIndexCompare:{enums:["auto","manual"]},valign:{enums:["top","center","bottom"]},halign:{enums:["left","center","right"]},justification:{enums:["left","center","right","auto"]},text:{string:!0},data:{mapping:!0,regex:a("data")},layoutData:{mapping:!0,regex:a("layoutData")},scratch:{mapping:!0,regex:a("scratch")},mapData:{mapping:!0,regex:s("mapData")},mapLayoutData:{mapping:!0,regex:s("mapLayoutData")},mapScratch:{mapping:!0,regex:s("mapScratch")},fn:{mapping:!0,fn:!0},url:{regexes:o,singleRegexMatchValue:!0},urls:{regexes:o,singleRegexMatchValue:!0,multiple:!0},propList:{propList:!0},angle:{number:!0,units:"deg|rad",implicitUnits:"rad"},textRotation:{number:!0,units:"deg|rad",implicitUnits:"rad",enums:["none","autorotate"]},polygonPointList:{number:!0,multiple:!0,evenMultiple:!0,min:-1,max:1,unitless:!0},edgeDistances:{enums:["intersection","node-position","endpoints"]},edgeEndpoint:{number:!0,multiple:!0,units:"%|px|em|deg|rad",implicitUnits:"px",enums:["inside-to-node","outside-to-node","outside-to-node-or-label","outside-to-line","outside-to-line-or-label"],singleEnum:!0,validate:function(se,ye){switch(se.length){case 2:return ye[0]!=="deg"&&ye[0]!=="rad"&&ye[1]!=="deg"&&ye[1]!=="rad";case 1:return Kt(se[0])||ye[0]==="deg"||ye[0]==="rad";default:return!1}}},easing:{regexes:["^(spring)\\s*\\(\\s*("+t+")\\s*,\\s*("+t+")\\s*\\)$","^(cubic-bezier)\\s*\\(\\s*("+t+")\\s*,\\s*("+t+")\\s*,\\s*("+t+")\\s*,\\s*("+t+")\\s*\\)$"],enums:["linear","ease","ease-in","ease-out","ease-in-out","ease-in-sine","ease-out-sine","ease-in-out-sine","ease-in-quad","ease-out-quad","ease-in-out-quad","ease-in-cubic","ease-out-cubic","ease-in-out-cubic","ease-in-quart","ease-out-quart","ease-in-out-quart","ease-in-quint","ease-out-quint","ease-in-out-quint","ease-in-expo","ease-out-expo","ease-in-out-expo","ease-in-circ","ease-out-circ","ease-in-out-circ"]},gradientDirection:{enums:["to-bottom","to-top","to-left","to-right","to-bottom-right","to-bottom-left","to-top-right","to-top-left","to-right-bottom","to-left-bottom","to-right-top","to-left-top"]},boundsExpansion:{number:!0,multiple:!0,min:0,validate:function(se){var ye=se.length;return ye===1||ye===2||ye===4}}};var l={zeroNonZero:function(se,ye){return(se==null||ye==null)&&se!==ye||se==0&&ye!=0?!0:se!=0&&ye==0},any:function(se,ye){return se!=ye},emptyNonEmpty:function(se,ye){var Se=Zd(se),Ue=Zd(ye);return Se&&!Ue||!Se&&Ue}},u=Oi.types,c=[{name:"label",type:u.text,triggersBounds:l.any,triggersZOrder:l.emptyNonEmpty},{name:"text-rotation",type:u.textRotation,triggersBounds:l.any},{name:"text-margin-x",type:u.bidirectionalSize,triggersBounds:l.any},{name:"text-margin-y",type:u.bidirectionalSize,triggersBounds:l.any}],f=[{name:"source-label",type:u.text,triggersBounds:l.any},{name:"source-text-rotation",type:u.textRotation,triggersBounds:l.any},{name:"source-text-margin-x",type:u.bidirectionalSize,triggersBounds:l.any},{name:"source-text-margin-y",type:u.bidirectionalSize,triggersBounds:l.any},{name:"source-text-offset",type:u.size,triggersBounds:l.any}],p=[{name:"target-label",type:u.text,triggersBounds:l.any},{name:"target-text-rotation",type:u.textRotation,triggersBounds:l.any},{name:"target-text-margin-x",type:u.bidirectionalSize,triggersBounds:l.any},{name:"target-text-margin-y",type:u.bidirectionalSize,triggersBounds:l.any},{name:"target-text-offset",type:u.size,triggersBounds:l.any}],v=[{name:"font-family",type:u.fontFamily,triggersBounds:l.any},{name:"font-style",type:u.fontStyle,triggersBounds:l.any},{name:"font-weight",type:u.fontWeight,triggersBounds:l.any},{name:"font-size",type:u.size,triggersBounds:l.any},{name:"text-transform",type:u.textTransform,triggersBounds:l.any},{name:"text-wrap",type:u.textWrap,triggersBounds:l.any},{name:"text-overflow-wrap",type:u.textOverflowWrap,triggersBounds:l.any},{name:"text-max-width",type:u.size,triggersBounds:l.any},{name:"text-outline-width",type:u.size,triggersBounds:l.any},{name:"line-height",type:u.positiveNumber,triggersBounds:l.any}],y=[{name:"text-valign",type:u.valign,triggersBounds:l.any},{name:"text-halign",type:u.halign,triggersBounds:l.any},{name:"color",type:u.color},{name:"text-outline-color",type:u.color},{name:"text-outline-opacity",type:u.zeroOneNumber},{name:"text-background-color",type:u.color},{name:"text-background-opacity",type:u.zeroOneNumber},{name:"text-background-padding",type:u.size,triggersBounds:l.any},{name:"text-border-opacity",type:u.zeroOneNumber},{name:"text-border-color",type:u.color},{name:"text-border-width",type:u.size,triggersBounds:l.any},{name:"text-border-style",type:u.borderStyle,triggersBounds:l.any},{name:"text-background-shape",type:u.textBackgroundShape,triggersBounds:l.any},{name:"text-justification",type:u.justification},{name:"box-select-labels",type:u.bool,triggersBounds:l.any}],S=[{name:"events",type:u.bool,triggersZOrder:l.any},{name:"text-events",type:u.bool,triggersZOrder:l.any},{name:"box-selection",type:u.boxSelection,triggersZOrder:l.any}],w=[{name:"display",type:u.display,triggersZOrder:l.any,triggersBounds:l.any,triggersBoundsOfConnectedEdges:l.any,triggersBoundsOfParallelEdges:function(se,ye,Se){return se===ye?!1:Se.pstyle("curve-style").value==="bezier"}},{name:"visibility",type:u.visibility,triggersZOrder:l.any},{name:"opacity",type:u.zeroOneNumber,triggersZOrder:l.zeroNonZero},{name:"text-opacity",type:u.zeroOneNumber},{name:"min-zoomed-font-size",type:u.size},{name:"z-compound-depth",type:u.zCompoundDepth,triggersZOrder:l.any},{name:"z-index-compare",type:u.zIndexCompare,triggersZOrder:l.any},{name:"z-index",type:u.number,triggersZOrder:l.any}],E=[{name:"overlay-padding",type:u.size,triggersBounds:l.any},{name:"overlay-color",type:u.color},{name:"overlay-opacity",type:u.zeroOneNumber,triggersBounds:l.zeroNonZero},{name:"overlay-shape",type:u.overlayShape,triggersBounds:l.any},{name:"overlay-corner-radius",type:u.cornerRadius}],_=[{name:"underlay-padding",type:u.size,triggersBounds:l.any},{name:"underlay-color",type:u.color},{name:"underlay-opacity",type:u.zeroOneNumber,triggersBounds:l.zeroNonZero},{name:"underlay-shape",type:u.overlayShape,triggersBounds:l.any},{name:"underlay-corner-radius",type:u.cornerRadius}],T=[{name:"transition-property",type:u.propList},{name:"transition-duration",type:u.time},{name:"transition-delay",type:u.time},{name:"transition-timing-function",type:u.easing}],N=function(se,ye){return ye.value==="label"?-se.poolIndex():ye.pfValue},R=[{name:"height",type:u.nodeSize,triggersBounds:l.any,hashOverride:N},{name:"width",type:u.nodeSize,triggersBounds:l.any,hashOverride:N},{name:"shape",type:u.nodeShape,triggersBounds:l.any},{name:"shape-polygon-points",type:u.polygonPointList,triggersBounds:l.any},{name:"corner-radius",type:u.cornerRadius},{name:"background-color",type:u.color},{name:"background-fill",type:u.fill},{name:"background-opacity",type:u.zeroOneNumber},{name:"background-blacken",type:u.nOneOneNumber},{name:"background-gradient-stop-colors",type:u.colors},{name:"background-gradient-stop-positions",type:u.percentages},{name:"background-gradient-direction",type:u.gradientDirection},{name:"padding",type:u.sizeMaybePercent,triggersBounds:l.any},{name:"padding-relative-to",type:u.paddingRelativeTo,triggersBounds:l.any},{name:"bounds-expansion",type:u.boundsExpansion,triggersBounds:l.any}],I=[{name:"border-color",type:u.color},{name:"border-opacity",type:u.zeroOneNumber},{name:"border-width",type:u.size,triggersBounds:l.any},{name:"border-style",type:u.borderStyle},{name:"border-cap",type:u.lineCap},{name:"border-join",type:u.lineJoin},{name:"border-dash-pattern",type:u.numbers},{name:"border-dash-offset",type:u.number},{name:"border-position",type:u.linePosition}],F=[{name:"outline-color",type:u.color},{name:"outline-opacity",type:u.zeroOneNumber},{name:"outline-width",type:u.size,triggersBounds:l.any},{name:"outline-style",type:u.borderStyle},{name:"outline-offset",type:u.size,triggersBounds:l.any}],D=[{name:"background-image",type:u.urls},{name:"background-image-crossorigin",type:u.bgCrossOrigin},{name:"background-image-opacity",type:u.zeroOneNumbers},{name:"background-image-containment",type:u.bgContainment},{name:"background-image-smoothing",type:u.bools},{name:"background-position-x",type:u.bgPos},{name:"background-position-y",type:u.bgPos},{name:"background-width-relative-to",type:u.bgRelativeTo},{name:"background-height-relative-to",type:u.bgRelativeTo},{name:"background-repeat",type:u.bgRepeat},{name:"background-fit",type:u.bgFit},{name:"background-clip",type:u.bgClip},{name:"background-width",type:u.bgWH},{name:"background-height",type:u.bgWH},{name:"background-offset-x",type:u.bgPos},{name:"background-offset-y",type:u.bgPos}],j=[{name:"position",type:u.position,triggersBounds:l.any},{name:"compound-sizing-wrt-labels",type:u.compoundIncludeLabels,triggersBounds:l.any},{name:"min-width",type:u.size,triggersBounds:l.any},{name:"min-width-bias-left",type:u.sizeMaybePercent,triggersBounds:l.any},{name:"min-width-bias-right",type:u.sizeMaybePercent,triggersBounds:l.any},{name:"min-height",type:u.size,triggersBounds:l.any},{name:"min-height-bias-top",type:u.sizeMaybePercent,triggersBounds:l.any},{name:"min-height-bias-bottom",type:u.sizeMaybePercent,triggersBounds:l.any}],B=[{name:"line-style",type:u.lineStyle},{name:"line-color",type:u.color},{name:"line-fill",type:u.fill},{name:"line-cap",type:u.lineCap},{name:"line-opacity",type:u.zeroOneNumber},{name:"line-dash-pattern",type:u.numbers},{name:"line-dash-offset",type:u.number},{name:"line-outline-width",type:u.size},{name:"line-outline-color",type:u.color},{name:"line-gradient-stop-colors",type:u.colors},{name:"line-gradient-stop-positions",type:u.percentages},{name:"curve-style",type:u.curveStyle,triggersBounds:l.any,triggersBoundsOfParallelEdges:function(se,ye){return se===ye?!1:se==="bezier"||ye==="bezier"}},{name:"haystack-radius",type:u.zeroOneNumber,triggersBounds:l.any},{name:"source-endpoint",type:u.edgeEndpoint,triggersBounds:l.any},{name:"target-endpoint",type:u.edgeEndpoint,triggersBounds:l.any},{name:"control-point-step-size",type:u.size,triggersBounds:l.any},{name:"control-point-distances",type:u.bidirectionalSizes,triggersBounds:l.any},{name:"control-point-weights",type:u.numbers,triggersBounds:l.any},{name:"segment-distances",type:u.bidirectionalSizes,triggersBounds:l.any},{name:"segment-weights",type:u.numbers,triggersBounds:l.any},{name:"segment-radii",type:u.numbers,triggersBounds:l.any},{name:"radius-type",type:u.radiusType,triggersBounds:l.any},{name:"taxi-turn",type:u.bidirectionalSizeMaybePercent,triggersBounds:l.any},{name:"taxi-turn-min-distance",type:u.size,triggersBounds:l.any},{name:"taxi-direction",type:u.axisDirection,triggersBounds:l.any},{name:"taxi-radius",type:u.number,triggersBounds:l.any},{name:"edge-distances",type:u.edgeDistances,triggersBounds:l.any},{name:"arrow-scale",type:u.positiveNumber,triggersBounds:l.any},{name:"loop-direction",type:u.angle,triggersBounds:l.any},{name:"loop-sweep",type:u.angle,triggersBounds:l.any},{name:"source-distance-from-node",type:u.size,triggersBounds:l.any},{name:"target-distance-from-node",type:u.size,triggersBounds:l.any}],G=[{name:"ghost",type:u.bool,triggersBounds:l.any},{name:"ghost-offset-x",type:u.bidirectionalSize,triggersBounds:l.any},{name:"ghost-offset-y",type:u.bidirectionalSize,triggersBounds:l.any},{name:"ghost-opacity",type:u.zeroOneNumber}],K=[{name:"selection-box-color",type:u.color},{name:"selection-box-opacity",type:u.zeroOneNumber},{name:"selection-box-border-color",type:u.color},{name:"selection-box-border-width",type:u.size},{name:"active-bg-color",type:u.color},{name:"active-bg-opacity",type:u.zeroOneNumber},{name:"active-bg-size",type:u.size},{name:"outside-texture-bg-color",type:u.color},{name:"outside-texture-bg-opacity",type:u.zeroOneNumber}],O=[];Oi.pieBackgroundN=16,O.push({name:"pie-size",type:u.sizeMaybePercent}),O.push({name:"pie-hole",type:u.sizeMaybePercent}),O.push({name:"pie-start-angle",type:u.angle});for(var W=1;W<=Oi.pieBackgroundN;W++)O.push({name:"pie-"+W+"-background-color",type:u.color}),O.push({name:"pie-"+W+"-background-size",type:u.percent}),O.push({name:"pie-"+W+"-background-opacity",type:u.zeroOneNumber});var U=[];Oi.stripeBackgroundN=16,U.push({name:"stripe-size",type:u.sizeMaybePercent}),U.push({name:"stripe-direction",type:u.axisDirectionPrimary});for(var q=1;q<=Oi.stripeBackgroundN;q++)U.push({name:"stripe-"+q+"-background-color",type:u.color}),U.push({name:"stripe-"+q+"-background-size",type:u.percent}),U.push({name:"stripe-"+q+"-background-opacity",type:u.zeroOneNumber});var Z=[],Q=Oi.arrowPrefixes=["source","mid-source","target","mid-target"];[{name:"arrow-shape",type:u.arrowShape,triggersBounds:l.any},{name:"arrow-color",type:u.color},{name:"arrow-fill",type:u.arrowFill},{name:"arrow-width",type:u.arrowWidth}].forEach(function(ge){Q.forEach(function(se){var ye=se+"-"+ge.name,Se=ge.type,Ue=ge.triggersBounds;Z.push({name:ye,type:Se,triggersBounds:Ue})})},{});var ne=Oi.properties=[].concat(S,T,w,E,_,G,y,v,c,f,p,R,I,F,D,O,U,j,B,Z,K),re=Oi.propertyGroups={behavior:S,transition:T,visibility:w,overlay:E,underlay:_,ghost:G,commonLabel:y,labelDimensions:v,mainLabel:c,sourceLabel:f,targetLabel:p,nodeBody:R,nodeBorder:I,nodeOutline:F,backgroundImage:D,pie:O,stripe:U,compound:j,edgeLine:B,edgeArrow:Z,core:K},Y=Oi.propertyGroupNames={},J=Oi.propertyGroupKeys=Object.keys(re);J.forEach(function(ge){Y[ge]=re[ge].map(function(se){return se.name}),re[ge].forEach(function(se){return se.groupKey=ge})});var ie=Oi.aliases=[{name:"content",pointsTo:"label"},{name:"control-point-distance",pointsTo:"control-point-distances"},{name:"control-point-weight",pointsTo:"control-point-weights"},{name:"segment-distance",pointsTo:"segment-distances"},{name:"segment-weight",pointsTo:"segment-weights"},{name:"segment-radius",pointsTo:"segment-radii"},{name:"edge-text-rotation",pointsTo:"text-rotation"},{name:"padding-left",pointsTo:"padding"},{name:"padding-right",pointsTo:"padding"},{name:"padding-top",pointsTo:"padding"},{name:"padding-bottom",pointsTo:"padding"}];Oi.propertyNames=ne.map(function(ge){return ge.name});for(var de=0;de<ne.length;de++){var he=ne[de];ne[he.name]=he}for(var xe=0;xe<ie.length;xe++){var le=ie[xe],fe=ne[le.pointsTo],ve={name:le.name,alias:!0,pointsTo:fe};ne.push(ve),ne[le.name]=ve}})();Oi.getDefaultProperty=function(t){return this.getDefaultProperties()[t]};Oi.getDefaultProperties=function(){var t=this._private;if(t.defaultProperties!=null)return t.defaultProperties;for(var e=ir({"selection-box-color":"#ddd","selection-box-opacity":.65,"selection-box-border-color":"#aaa","selection-box-border-width":1,"active-bg-color":"black","active-bg-opacity":.15,"active-bg-size":30,"outside-texture-bg-color":"#000","outside-texture-bg-opacity":.125,events:"yes","text-events":"no","text-valign":"top","text-halign":"center","text-justification":"auto","line-height":1,color:"#000","box-selection":"contain","text-outline-color":"#000","text-outline-width":0,"text-outline-opacity":1,"text-opacity":1,"text-decoration":"none","text-transform":"none","text-wrap":"none","text-overflow-wrap":"whitespace","text-max-width":9999,"text-background-color":"#000","text-background-opacity":0,"text-background-shape":"rectangle","text-background-padding":0,"text-border-opacity":0,"text-border-width":0,"text-border-style":"solid","text-border-color":"#000","font-family":"Helvetica Neue, Helvetica, sans-serif","font-style":"normal","font-weight":"normal","font-size":16,"min-zoomed-font-size":0,"text-rotation":"none","source-text-rotation":"none","target-text-rotation":"none",visibility:"visible",display:"element",opacity:1,"z-compound-depth":"auto","z-index-compare":"auto","z-index":0,label:"","text-margin-x":0,"text-margin-y":0,"source-label":"","source-text-offset":0,"source-text-margin-x":0,"source-text-margin-y":0,"target-label":"","target-text-offset":0,"target-text-margin-x":0,"target-text-margin-y":0,"overlay-opacity":0,"overlay-color":"#000","overlay-padding":10,"overlay-shape":"round-rectangle","overlay-corner-radius":"auto","underlay-opacity":0,"underlay-color":"#000","underlay-padding":10,"underlay-shape":"round-rectangle","underlay-corner-radius":"auto","transition-property":"none","transition-duration":0,"transition-delay":0,"transition-timing-function":"linear","box-select-labels":"no","background-blacken":0,"background-color":"#999","background-fill":"solid","background-opacity":1,"background-image":"none","background-image-crossorigin":"anonymous","background-image-opacity":1,"background-image-containment":"inside","background-image-smoothing":"yes","background-position-x":"50%","background-position-y":"50%","background-offset-x":0,"background-offset-y":0,"background-width-relative-to":"include-padding","background-height-relative-to":"include-padding","background-repeat":"no-repeat","background-fit":"none","background-clip":"node","background-width":"auto","background-height":"auto","border-color":"#000","border-opacity":1,"border-width":0,"border-style":"solid","border-dash-pattern":[4,2],"border-dash-offset":0,"border-cap":"butt","border-join":"miter","border-position":"center","outline-color":"#999","outline-opacity":1,"outline-width":0,"outline-offset":0,"outline-style":"solid",height:30,width:30,shape:"ellipse","shape-polygon-points":"-1, -1,   1, -1,   1, 1,   -1, 1","corner-radius":"auto","bounds-expansion":0,"background-gradient-direction":"to-bottom","background-gradient-stop-colors":"#999","background-gradient-stop-positions":"0%",ghost:"no","ghost-offset-y":0,"ghost-offset-x":0,"ghost-opacity":0,padding:0,"padding-relative-to":"width",position:"origin","compound-sizing-wrt-labels":"include","min-width":0,"min-width-bias-left":0,"min-width-bias-right":0,"min-height":0,"min-height-bias-top":0,"min-height-bias-bottom":0},{"pie-size":"100%","pie-hole":0,"pie-start-angle":"0deg"},[{name:"pie-{{i}}-background-color",value:"black"},{name:"pie-{{i}}-background-size",value:"0%"},{name:"pie-{{i}}-background-opacity",value:1}].reduce(function(l,u){for(var c=1;c<=Oi.pieBackgroundN;c++){var f=u.name.replace("{{i}}",c),p=u.value;l[f]=p}return l},{}),{"stripe-size":"100%","stripe-direction":"horizontal"},[{name:"stripe-{{i}}-background-color",value:"black"},{name:"stripe-{{i}}-background-size",value:"0%"},{name:"stripe-{{i}}-background-opacity",value:1}].reduce(function(l,u){for(var c=1;c<=Oi.stripeBackgroundN;c++){var f=u.name.replace("{{i}}",c),p=u.value;l[f]=p}return l},{}),{"line-style":"solid","line-color":"#999","line-fill":"solid","line-cap":"butt","line-opacity":1,"line-outline-width":0,"line-outline-color":"#000","line-gradient-stop-colors":"#999","line-gradient-stop-positions":"0%","control-point-step-size":40,"control-point-weights":.5,"segment-weights":.5,"segment-distances":20,"segment-radii":15,"radius-type":"arc-radius","taxi-turn":"50%","taxi-radius":15,"taxi-turn-min-distance":10,"taxi-direction":"auto","edge-distances":"intersection","curve-style":"haystack","haystack-radius":0,"arrow-scale":1,"loop-direction":"-45deg","loop-sweep":"-90deg","source-distance-from-node":0,"target-distance-from-node":0,"source-endpoint":"outside-to-node","target-endpoint":"outside-to-node","line-dash-pattern":[6,3],"line-dash-offset":0},[{name:"arrow-shape",value:"none"},{name:"arrow-color",value:"#999"},{name:"arrow-fill",value:"filled"},{name:"arrow-width",value:1}].reduce(function(l,u){return Oi.arrowPrefixes.forEach(function(c){var f=c+"-"+u.name,p=u.value;l[f]=p}),l},{})),r={},n=0;n<this.properties.length;n++){var i=this.properties[n];if(!i.pointsTo){var a=i.name,s=e[a],o=this.parse(a,s);r[a]=o}}return t.defaultProperties=r,t.defaultProperties};Oi.addDefaultStylesheet=function(){this.selector(":parent").css({shape:"rectangle",padding:10,"background-color":"#eee","border-color":"#ccc","border-width":1}).selector("edge").css({width:3}).selector(":loop").css({"curve-style":"bezier"}).selector("edge:compound").css({"curve-style":"bezier","source-endpoint":"outside-to-line","target-endpoint":"outside-to-line"}).selector(":selected").css({"background-color":"#0169D9","line-color":"#0169D9","source-arrow-color":"#0169D9","target-arrow-color":"#0169D9","mid-source-arrow-color":"#0169D9","mid-target-arrow-color":"#0169D9"}).selector(":parent:selected").css({"background-color":"#CCE1F9","border-color":"#aec8e5"}).selector(":active").css({"overlay-color":"black","overlay-padding":10,"overlay-opacity":.25}),this.defaultLength=this.length};var D1={};D1.parse=function(t,e,r,n){var i=this;if(ri(e))return i.parseImplWarn(t,e,r,n);var a=n==="mapping"||n===!0||n===!1||n==null?"dontcare":n,s=r?"t":"f",o=""+e,l=zM(t,o,s,a),u=i.propCache=i.propCache||[],c;return(c=u[l])||(c=u[l]=i.parseImplWarn(t,e,r,n)),(r||n==="mapping")&&(c=ku(c),c&&(c.value=ku(c.value))),c};D1.parseImplWarn=function(t,e,r,n){var i=this.parseImpl(t,e,r,n);return!i&&e!=null&&an("The style property `".concat(t,": ").concat(e,"` is invalid")),i&&(i.name==="width"||i.name==="height")&&e==="label"&&an("The style value of `label` is deprecated for `"+i.name+"`"),i};D1.parseImpl=function(t,e,r,n){var i=this;t=Xk(t);var a=i.properties[t],s=e,o=i.types;if(!a||e===void 0)return null;a.alias&&(a=a.pointsTo,t=a.name);var l=Kt(e);l&&(e=e.trim());var u=a.type;if(!u)return null;if(r&&(e===""||e===null))return{name:t,value:e,bypass:!0,deleteBypass:!0};if(ri(e))return{name:t,value:e,strValue:"fn",mapped:o.fn,bypass:r};var c,f;if(!(!l||n||e.length<7||e[1]!=="a")){if(e.length>=7&&e[0]==="d"&&(c=new RegExp(o.data.regex).exec(e))){if(r)return!1;var p=o.data;return{name:t,value:c,strValue:""+e,mapped:p,field:c[1],bypass:r}}else if(e.length>=10&&e[0]==="m"&&(f=new RegExp(o.mapData.regex).exec(e))){if(r||u.multiple)return!1;var v=o.mapData;if(!(u.color||u.number))return!1;var y=this.parse(t,f[4]);if(!y||y.mapped)return!1;var S=this.parse(t,f[5]);if(!S||S.mapped)return!1;if(y.pfValue===S.pfValue||y.strValue===S.strValue)return an("`"+t+": "+e+"` is not a valid mapper because the output range is zero; converting to `"+t+": "+y.strValue+"`"),this.parse(t,y.strValue);if(u.color){var w=y.value,E=S.value,_=w[0]===E[0]&&w[1]===E[1]&&w[2]===E[2]&&(w[3]===E[3]||(w[3]==null||w[3]===1)&&(E[3]==null||E[3]===1));if(_)return!1}return{name:t,value:f,strValue:""+e,mapped:v,field:f[1],fieldMin:parseFloat(f[2]),fieldMax:parseFloat(f[3]),valueMin:y.value,valueMax:S.value,bypass:r}}}if(u.multiple&&n!=="multiple"){var T;if(l?T=e.split(/\s+/):Sn(e)?T=e:T=[e],u.evenMultiple&&T.length%2!==0)return null;for(var N=[],R=[],I=[],F="",D=!1,j=0;j<T.length;j++){var B=i.parse(t,T[j],r,"multiple");D=D||Kt(B.value),N.push(B.value),I.push(B.pfValue!=null?B.pfValue:B.value),R.push(B.units),F+=(j>0?" ":"")+B.strValue}return u.validate&&!u.validate(N,R)?null:u.singleEnum&&D?N.length===1&&Kt(N[0])?{name:t,value:N[0],strValue:N[0],bypass:r}:null:{name:t,value:N,pfValue:I,strValue:F,bypass:r,units:R}}var G=function(){for(var ve=0;ve<u.enums.length;ve++){var ge=u.enums[ve];if(ge===e)return{name:t,value:e,strValue:""+e,bypass:r}}return null};if(u.number){var K,O="px";if(u.units&&(K=u.units),u.implicitUnits&&(O=u.implicitUnits),!u.unitless)if(l){var W="px|em"+(u.allowPercent?"|\\%":"");K&&(W=K);var U=e.match("^("+Wi+")("+W+")?$");U&&(e=U[1],K=U[2]||O)}else(!K||u.implicitUnits)&&(K=O);if(e=parseFloat(e),isNaN(e)&&u.enums===void 0)return null;if(isNaN(e)&&u.enums!==void 0)return e=s,G();if(u.integer&&!Lj(e)||u.min!==void 0&&(e<u.min||u.strictMin&&e===u.min)||u.max!==void 0&&(e>u.max||u.strictMax&&e===u.max))return null;var q={name:t,value:e,strValue:""+e+(K||""),units:K,bypass:r};return u.unitless||K!=="px"&&K!=="em"?q.pfValue=e:q.pfValue=K==="px"||!K?e:this.getEmSizeInPixels()*e,(K==="ms"||K==="s")&&(q.pfValue=K==="ms"?e:1e3*e),(K==="deg"||K==="rad")&&(q.pfValue=K==="rad"?e:V9(e)),K==="%"&&(q.pfValue=e/100),q}else if(u.propList){var Z=[],Q=""+e;if(Q!=="none"){for(var ne=Q.split(/\s*,\s*|\s+/),re=0;re<ne.length;re++){var Y=ne[re].trim();i.properties[Y]?Z.push(Y):an("`"+Y+"` is not a valid property name")}if(Z.length===0)return null}return{name:t,value:Z,strValue:Z.length===0?"none":Z.join(" "),bypass:r}}else if(u.color){var J=LM(e);return J?{name:t,value:J,pfValue:J,strValue:"rgb("+J[0]+","+J[1]+","+J[2]+")",bypass:r}:null}else if(u.regex||u.regexes){if(u.enums){var ie=G();if(ie)return ie}for(var de=u.regexes?u.regexes:[u.regex],he=0;he<de.length;he++){var xe=new RegExp(de[he]),le=xe.exec(e);if(le)return{name:t,value:u.singleRegexMatchValue?le[1]:le,strValue:""+e,bypass:r}}return null}else return u.string?{name:t,value:""+e,strValue:""+e,bypass:r}:u.enums?G():null};var ga=function(e){if(!(this instanceof ga))return new ga(e);if(!Yk(e)){Kn("A style must have a core reference");return}this._private={cy:e,coreStyle:{}},this.length=0,this.resetToDefault()},ls=ga.prototype;ls.instanceString=function(){return"style"};ls.clear=function(){for(var t=this._private,e=t.cy,r=e.elements(),n=0;n<this.length;n++)this[n]=void 0;return this.length=0,t.contextStyles={},t.propDiffs={},this.cleanElements(r,!0),r.forEach(function(i){var a=i[0]._private;a.styleDirty=!0,a.appliedInitStyle=!1}),this};ls.resetToDefault=function(){return this.clear(),this.addDefaultStylesheet(),this};ls.core=function(t){return this._private.coreStyle[t]||this.getDefaultProperty(t)};ls.selector=function(t){var e=t==="core"?null:new Qd(t),r=this.length++;return this[r]={selector:e,properties:[],mappedProperties:[],index:r},this};ls.css=function(){var t=this,e=arguments;if(e.length===1)for(var r=e[0],n=0;n<t.properties.length;n++){var i=t.properties[n],a=r[i.name];a===void 0&&(a=r[w1(i.name)]),a!==void 0&&this.cssRule(i.name,a)}else e.length===2&&this.cssRule(e[0],e[1]);return this};ls.style=ls.css;ls.cssRule=function(t,e){var r=this.parse(t,e);if(r){var n=this.length-1;this[n].properties.push(r),this[n].properties[r.name]=r,r.name.match(/pie-(\d+)-background-size/)&&r.value&&(this._private.hasPie=!0),r.name.match(/stripe-(\d+)-background-size/)&&r.value&&(this._private.hasStripe=!0),r.mapped&&this[n].mappedProperties.push(r);var i=!this[n].selector;i&&(this._private.coreStyle[r.name]=r)}return this};ls.append=function(t){return MM(t)?t.appendToStyle(this):Sn(t)?this.appendFromJson(t):Kt(t)&&this.appendFromString(t),this};ga.fromJson=function(t,e){var r=new ga(t);return r.fromJson(e),r};ga.fromString=function(t,e){return new ga(t).fromString(e)};[xa,t0,f_,Tu,O1,h_,Oi,D1].forEach(function(t){ir(ls,t)});ga.types=ls.types;ga.properties=ls.properties;ga.propertyGroups=ls.propertyGroups;ga.propertyGroupNames=ls.propertyGroupNames;ga.propertyGroupKeys=ls.propertyGroupKeys;var $7={style:function(e){if(e){var r=this.setStyle(e);r.update()}return this._private.style},setStyle:function(e){var r=this._private;return MM(e)?r.style=e.generateStyle(this):Sn(e)?r.style=ga.fromJson(this,e):Kt(e)?r.style=ga.fromString(this,e):r.style=ga(this),r.style},updateStyle:function(){this.mutableElements().updateStyle()}},K7="single",vh={autolock:function(e){if(e!==void 0)this._private.autolock=!!e;else return this._private.autolock;return this},autoungrabify:function(e){if(e!==void 0)this._private.autoungrabify=!!e;else return this._private.autoungrabify;return this},autounselectify:function(e){if(e!==void 0)this._private.autounselectify=!!e;else return this._private.autounselectify;return this},selectionType:function(e){var r=this._private;if(r.selectionType==null&&(r.selectionType=K7),e!==void 0)(e==="additive"||e==="single")&&(r.selectionType=e);else return r.selectionType;return this},panningEnabled:function(e){if(e!==void 0)this._private.panningEnabled=!!e;else return this._private.panningEnabled;return this},userPanningEnabled:function(e){if(e!==void 0)this._private.userPanningEnabled=!!e;else return this._private.userPanningEnabled;return this},zoomingEnabled:function(e){if(e!==void 0)this._private.zoomingEnabled=!!e;else return this._private.zoomingEnabled;return this},userZoomingEnabled:function(e){if(e!==void 0)this._private.userZoomingEnabled=!!e;else return this._private.userZoomingEnabled;return this},boxSelectionEnabled:function(e){if(e!==void 0)this._private.boxSelectionEnabled=!!e;else return this._private.boxSelectionEnabled;return this},pan:function(){var e=arguments,r=this._private.pan,n,i,a,s,o;switch(e.length){case 0:return r;case 1:if(Kt(e[0]))return n=e[0],r[n];if(Vr(e[0])){if(!this._private.panningEnabled)return this;a=e[0],s=a.x,o=a.y,bt(s)&&(r.x=s),bt(o)&&(r.y=o),this.emit("pan viewport")}break;case 2:if(!this._private.panningEnabled)return this;n=e[0],i=e[1],(n==="x"||n==="y")&&bt(i)&&(r[n]=i),this.emit("pan viewport");break}return this.notify("viewport"),this},panBy:function(e,r){var n=arguments,i=this._private.pan,a,s,o,l,u;if(!this._private.panningEnabled)return this;switch(n.length){case 1:Vr(e)&&(o=n[0],l=o.x,u=o.y,bt(l)&&(i.x+=l),bt(u)&&(i.y+=u),this.emit("pan viewport"));break;case 2:a=e,s=r,(a==="x"||a==="y")&&bt(s)&&(i[a]+=s),this.emit("pan viewport");break}return this.notify("viewport"),this},gc:function(){this.notify("gc")},fit:function(e,r){var n=this.getFitViewport(e,r);if(n){var i=this._private;i.zoom=n.zoom,i.pan=n.pan,this.emit("pan zoom viewport"),this.notify("viewport")}return this},getFitViewport:function(e,r){if(bt(e)&&r===void 0&&(r=e,e=void 0),!(!this._private.panningEnabled||!this._private.zoomingEnabled)){var n;if(Kt(e)){var i=e;e=this.$(i)}else if(Ij(e)){var a=e;n={x1:a.x1,y1:a.y1,x2:a.x2,y2:a.y2},n.w=n.x2-n.x1,n.h=n.y2-n.y1}else go(e)||(e=this.mutableElements());if(!(go(e)&&e.empty())){n=n||e.boundingBox();var s=this.width(),o=this.height(),l;if(r=bt(r)?r:0,!isNaN(s)&&!isNaN(o)&&s>0&&o>0&&!isNaN(n.w)&&!isNaN(n.h)&&n.w>0&&n.h>0){l=Math.min((s-2*r)/n.w,(o-2*r)/n.h),l=l>this._private.maxZoom?this._private.maxZoom:l,l=l<this._private.minZoom?this._private.minZoom:l;var u={x:(s-l*(n.x1+n.x2))/2,y:(o-l*(n.y1+n.y2))/2};return{zoom:l,pan:u}}}}},zoomRange:function(e,r){var n=this._private;if(r==null){var i=e;e=i.min,r=i.max}return bt(e)&&bt(r)&&e<=r?(n.minZoom=e,n.maxZoom=r):bt(e)&&r===void 0&&e<=n.maxZoom?n.minZoom=e:bt(r)&&e===void 0&&r>=n.minZoom&&(n.maxZoom=r),this},minZoom:function(e){return e===void 0?this._private.minZoom:this.zoomRange({min:e})},maxZoom:function(e){return e===void 0?this._private.maxZoom:this.zoomRange({max:e})},getZoomedViewport:function(e){var r=this._private,n=r.pan,i=r.zoom,a,s,o=!1;if(r.zoomingEnabled||(o=!0),bt(e)?s=e:Vr(e)&&(s=e.level,e.position!=null?a=_1(e.position,i,n):e.renderedPosition!=null&&(a=e.renderedPosition),a!=null&&!r.panningEnabled&&(o=!0)),s=s>r.maxZoom?r.maxZoom:s,s=s<r.minZoom?r.minZoom:s,o||!bt(s)||s===i||a!=null&&(!bt(a.x)||!bt(a.y)))return null;if(a!=null){var l=n,u=i,c=s,f={x:-c/u*(a.x-l.x)+a.x,y:-c/u*(a.y-l.y)+a.y};return{zoomed:!0,panned:!0,zoom:c,pan:f}}else return{zoomed:!0,panned:!1,zoom:s,pan:n}},zoom:function(e){if(e===void 0)return this._private.zoom;var r=this.getZoomedViewport(e),n=this._private;return r==null||!r.zoomed?this:(n.zoom=r.zoom,r.panned&&(n.pan.x=r.pan.x,n.pan.y=r.pan.y),this.emit("zoom"+(r.panned?" pan":"")+" viewport"),this.notify("viewport"),this)},viewport:function(e){var r=this._private,n=!0,i=!0,a=[],s=!1,o=!1;if(!e)return this;if(bt(e.zoom)||(n=!1),Vr(e.pan)||(i=!1),!n&&!i)return this;if(n){var l=e.zoom;l<r.minZoom||l>r.maxZoom||!r.zoomingEnabled?s=!0:(r.zoom=l,a.push("zoom"))}if(i&&(!s||!e.cancelOnFailedZoom)&&r.panningEnabled){var u=e.pan;bt(u.x)&&(r.pan.x=u.x,o=!1),bt(u.y)&&(r.pan.y=u.y,o=!1),o||a.push("pan")}return a.length>0&&(a.push("viewport"),this.emit(a.join(" ")),this.notify("viewport")),this},center:function(e){var r=this.getCenterPan(e);return r&&(this._private.pan=r,this.emit("pan viewport"),this.notify("viewport")),this},getCenterPan:function(e,r){if(this._private.panningEnabled){if(Kt(e)){var n=e;e=this.mutableElements().filter(n)}else go(e)||(e=this.mutableElements());if(e.length!==0){var i=e.boundingBox(),a=this.width(),s=this.height();r=r===void 0?this._private.zoom:r;var o={x:(a-r*(i.x1+i.x2))/2,y:(s-r*(i.y1+i.y2))/2};return o}}},reset:function(){return!this._private.panningEnabled||!this._private.zoomingEnabled?this:(this.viewport({pan:{x:0,y:0},zoom:1}),this)},invalidateSize:function(){this._private.sizeCache=null},size:function(){var e=this._private,r=e.container,n=this;return e.sizeCache=e.sizeCache||(r?(function(){var i=n.window().getComputedStyle(r),a=function(o){return parseFloat(i.getPropertyValue(o))};return{width:r.clientWidth-a("padding-left")-a("padding-right"),height:r.clientHeight-a("padding-top")-a("padding-bottom")}})():{width:1,height:1})},width:function(){return this.size().width},height:function(){return this.size().height},extent:function(){var e=this._private.pan,r=this._private.zoom,n=this.renderedExtent(),i={x1:(n.x1-e.x)/r,x2:(n.x2-e.x)/r,y1:(n.y1-e.y)/r,y2:(n.y2-e.y)/r};return i.w=i.x2-i.x1,i.h=i.y2-i.y1,i},renderedExtent:function(){var e=this.width(),r=this.height();return{x1:0,y1:0,x2:e,y2:r,w:e,h:r}},multiClickDebounceTime:function(e){if(e)this._private.multiClickDebounceTime=e;else return this._private.multiClickDebounceTime;return this}};vh.centre=vh.center;vh.autolockNodes=vh.autolock;vh.autoungrabifyNodes=vh.autoungrabify;var Ev={data:nn.data({field:"data",bindingEvent:"data",allowBinding:!0,allowSetting:!0,settingEvent:"data",settingTriggersEvent:!0,triggerFnName:"trigger",allowGetting:!0,updateStyle:!0}),removeData:nn.removeData({field:"data",event:"data",triggerFnName:"trigger",triggerEvent:!0,updateStyle:!0}),scratch:nn.data({field:"scratch",bindingEvent:"scratch",allowBinding:!0,allowSetting:!0,settingEvent:"scratch",settingTriggersEvent:!0,triggerFnName:"trigger",allowGetting:!0,updateStyle:!0}),removeScratch:nn.removeData({field:"scratch",event:"scratch",triggerFnName:"trigger",triggerEvent:!0,updateStyle:!0})};Ev.attr=Ev.data;Ev.removeAttr=Ev.removeData;var Tv=function(e){var r=this;e=ir({},e);var n=e.container;n&&!ix(n)&&ix(n[0])&&(n=n[0]);var i=n?n._cyreg:null;i=i||{},i&&i.cy&&(i.cy.destroy(),i={});var a=i.readies=i.readies||[];n&&(n._cyreg=i),i.cy=r;var s=Hi!==void 0&&n!==void 0&&!e.headless,o=e;o.layout=ir({name:s?"grid":"null"},o.layout),o.renderer=ir({name:s?"canvas":"null"},o.renderer);var l=function(y,S,w){return S!==void 0?S:w!==void 0?w:y},u=this._private={container:n,ready:!1,options:o,elements:new Ua(this),listeners:[],aniEles:new Ua(this),data:o.data||{},scratch:{},layout:null,renderer:null,destroyed:!1,notificationsEnabled:!0,minZoom:1e-50,maxZoom:1e50,zoomingEnabled:l(!0,o.zoomingEnabled),userZoomingEnabled:l(!0,o.userZoomingEnabled),panningEnabled:l(!0,o.panningEnabled),userPanningEnabled:l(!0,o.userPanningEnabled),boxSelectionEnabled:l(!0,o.boxSelectionEnabled),autolock:l(!1,o.autolock,o.autolockNodes),autoungrabify:l(!1,o.autoungrabify,o.autoungrabifyNodes),autounselectify:l(!1,o.autounselectify),styleEnabled:o.styleEnabled===void 0?s:o.styleEnabled,zoom:bt(o.zoom)?o.zoom:1,pan:{x:Vr(o.pan)&&bt(o.pan.x)?o.pan.x:0,y:Vr(o.pan)&&bt(o.pan.y)?o.pan.y:0},animation:{current:[],queue:[]},hasCompoundNodes:!1,multiClickDebounceTime:l(250,o.multiClickDebounceTime)};this.createEmitter(),this.selectionType(o.selectionType),this.zoomRange({min:o.minZoom,max:o.maxZoom});var c=function(y,S){var w=y.some(jj);if(w)return cm.all(y).then(S);S(y)};u.styleEnabled&&r.setStyle([]);var f=ir({},o,o.renderer);r.initRenderer(f);var p=function(y,S,w){r.notifications(!1);var E=r.mutableElements();E.length>0&&E.remove(),y!=null&&(Vr(y)||Sn(y))&&r.add(y),r.one("layoutready",function(T){r.notifications(!0),r.emit(T),r.one("load",S),r.emitAndNotify("load")}).one("layoutstop",function(){r.one("done",w),r.emit("done")});var _=ir({},r._private.options.layout);_.eles=r.elements(),r.layout(_).run()};c([o.style,o.elements],function(v){var y=v[0],S=v[1];u.styleEnabled&&r.style().append(y),p(S,function(){r.startAnimationLoop(),u.ready=!0,ri(o.ready)&&r.on("ready",o.ready);for(var w=0;w<a.length;w++){var E=a[w];r.on("ready",E)}i&&(i.readies=[]),r.emit("ready")},o.done)})},dx=Tv.prototype;ir(dx,{instanceString:function(){return"core"},isReady:function(){return this._private.ready},destroyed:function(){return this._private.destroyed},ready:function(e){return this.isReady()?this.emitter().emit("ready",[],e):this.on("ready",e),this},destroy:function(){var e=this;if(!e.destroyed())return e.stopAnimationLoop(),e.destroyRenderer(),this.emit("destroy"),e._private.destroyed=!0,e},hasElementWithId:function(e){return this._private.elements.hasElementWithId(e)},getElementById:function(e){return this._private.elements.getElementById(e)},hasCompoundNodes:function(){return this._private.hasCompoundNodes},headless:function(){return this._private.renderer.isHeadless()},styleEnabled:function(){return this._private.styleEnabled},addToPool:function(e){return this._private.elements.merge(e),this},removeFromPool:function(e){return this._private.elements.unmerge(e),this},container:function(){return this._private.container||null},window:function(){var e=this._private.container;if(e==null)return Hi;var r=this._private.container.ownerDocument;return r===void 0||r==null?Hi:r.defaultView||Hi},mount:function(e){if(e!=null){var r=this,n=r._private,i=n.options;return!ix(e)&&ix(e[0])&&(e=e[0]),r.stopAnimationLoop(),r.destroyRenderer(),n.container=e,n.styleEnabled=!0,r.invalidateSize(),r.initRenderer(ir({},i,i.renderer,{name:i.renderer.name==="null"?"canvas":i.renderer.name})),r.startAnimationLoop(),r.style(i.style),r.emit("mount"),r}},unmount:function(){var e=this;return e.stopAnimationLoop(),e.destroyRenderer(),e.initRenderer({name:"null"}),e.emit("unmount"),e},options:function(){return ku(this._private.options)},json:function(e){var r=this,n=r._private,i=r.mutableElements(),a=function(N){return r.getElementById(N.id())};if(Vr(e)){if(r.startBatch(),e.elements){var s={},o=function(N,R){for(var I=[],F=[],D=0;D<N.length;D++){var j=N[D];if(!j.data.id){an("cy.json() cannot handle elements without an ID attribute");continue}var B=""+j.data.id,G=r.getElementById(B);s[B]=!0,G.length!==0?F.push({ele:G,json:j}):(R&&(j.group=R),I.push(j))}r.add(I);for(var K=0;K<F.length;K++){var O=F[K],W=O.ele,U=O.json;W.json(U)}};if(Sn(e.elements))o(e.elements);else for(var l=["nodes","edges"],u=0;u<l.length;u++){var c=l[u],f=e.elements[c];Sn(f)&&o(f,c)}var p=r.collection();i.filter(function(T){return!s[T.id()]}).forEach(function(T){T.isParent()?p.merge(T):T.remove()}),p.forEach(function(T){return T.children().move({parent:null})}),p.forEach(function(T){return a(T).remove()})}e.style&&r.style(e.style),e.zoom!=null&&e.zoom!==n.zoom&&r.zoom(e.zoom),e.pan&&(e.pan.x!==n.pan.x||e.pan.y!==n.pan.y)&&r.pan(e.pan),e.data&&r.data(e.data);for(var v=["minZoom","maxZoom","zoomingEnabled","userZoomingEnabled","panningEnabled","userPanningEnabled","boxSelectionEnabled","autolock","autoungrabify","autounselectify","multiClickDebounceTime"],y=0;y<v.length;y++){var S=v[y];e[S]!=null&&r[S](e[S])}return r.endBatch(),this}else{var w=!!e,E={};w?E.elements=this.elements().map(function(T){return T.json()}):(E.elements={},i.forEach(function(T){var N=T.group();E.elements[N]||(E.elements[N]=[]),E.elements[N].push(T.json())})),this._private.styleEnabled&&(E.style=r.style().json()),E.data=ku(r.data());var _=n.options;return E.zoomingEnabled=n.zoomingEnabled,E.userZoomingEnabled=n.userZoomingEnabled,E.zoom=n.zoom,E.minZoom=n.minZoom,E.maxZoom=n.maxZoom,E.panningEnabled=n.panningEnabled,E.userPanningEnabled=n.userPanningEnabled,E.pan=ku(n.pan),E.boxSelectionEnabled=n.boxSelectionEnabled,E.renderer=ku(_.renderer),E.hideEdgesOnViewport=_.hideEdgesOnViewport,E.textureOnViewport=_.textureOnViewport,E.wheelSensitivity=_.wheelSensitivity,E.motionBlur=_.motionBlur,E.multiClickDebounceTime=_.multiClickDebounceTime,E}}});dx.$id=dx.getElementById;[j7,G7,MA,GS,zy,H7,VS,Uy,$7,vh,Ev].forEach(function(t){ir(dx,t)});var Z7={fit:!0,directed:!1,direction:"downward",padding:30,circle:!1,grid:!1,spacingFactor:1.75,boundingBox:void 0,avoidOverlap:!0,nodeDimensionsIncludeLabels:!1,roots:void 0,depthSort:void 0,animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function(e,r){return!0},ready:void 0,stop:void 0,transform:function(e,r){return r}},Y7={maximal:!1,acyclic:!1},mp=function(e){return e.scratch("breadthfirst")},TN=function(e,r){return e.scratch("breadthfirst",r)};function AA(t){this.options=ir({},Z7,Y7,t)}AA.prototype.run=function(){var t=this.options,e=t.cy,r=t.eles,n=r.nodes().filter(function(wt){return wt.isChildless()}),i=r,a=t.directed,s=t.acyclic||t.maximal||t.maximalAdjustments>0,o=!!t.boundingBox,l=Es(o?t.boundingBox:structuredClone(e.extent())),u;if(go(t.roots))u=t.roots;else if(Sn(t.roots)){for(var c=[],f=0;f<t.roots.length;f++){var p=t.roots[f],v=e.getElementById(p);c.push(v)}u=e.collection(c)}else if(Kt(t.roots))u=e.$(t.roots);else if(a)u=n.roots();else{var y=r.components();u=e.collection();for(var S=function(){var $e=y[w],Ce=$e.maxDegree(!1),Ie=$e.filter(function(Je){return Je.degree(!1)===Ce});u=u.add(Ie)},w=0;w<y.length;w++)S()}var E=[],_={},T=function($e,Ce){E[Ce]==null&&(E[Ce]=[]);var Ie=E[Ce].length;E[Ce].push($e),TN($e,{index:Ie,depth:Ce})},N=function($e,Ce){var Ie=mp($e),Je=Ie.depth,Qe=Ie.index;E[Je][Qe]=null,$e.isChildless()&&T($e,Ce)};i.bfs({roots:u,directed:t.directed,visit:function($e,Ce,Ie,Je,Qe){var gt=$e[0],At=gt.id();gt.isChildless()&&T(gt,Qe),_[At]=!0}});for(var R=[],I=0;I<n.length;I++){var F=n[I];_[F.id()]||R.push(F)}var D=function($e){for(var Ce=E[$e],Ie=0;Ie<Ce.length;Ie++){var Je=Ce[Ie];if(Je==null){Ce.splice(Ie,1),Ie--;continue}TN(Je,{depth:$e,index:Ie})}},j=function($e,Ce){for(var Ie=mp($e),Je=$e.incomers().filter(function(pt){return pt.isNode()&&r.has(pt)}),Qe=-1,gt=$e.id(),At=0;At<Je.length;At++){var Rt=Je[At],Ut=mp(Rt);Qe=Math.max(Qe,Ut.depth)}if(Ie.depth<=Qe){if(!t.acyclic&&Ce[gt])return null;var Vt=Qe+1;return N($e,Vt),Ce[gt]=Vt,!0}return!1};if(a&&s){var B=[],G={},K=function($e){return B.push($e)},O=function(){return B.shift()};for(n.forEach(function(wt){return B.push(wt)});B.length>0;){var W=O(),U=j(W,G);if(U)W.outgoers().filter(function(wt){return wt.isNode()&&r.has(wt)}).forEach(K);else if(U===null){an("Detected double maximal shift for node `"+W.id()+"`.  Bailing maximal adjustment due to cycle.  Use `options.maximal: true` only on DAGs.");break}}}var q=0;if(t.avoidOverlap)for(var Z=0;Z<n.length;Z++){var Q=n[Z],ne=Q.layoutDimensions(t),re=ne.w,Y=ne.h;q=Math.max(q,re,Y)}var J={},ie=function($e){if(J[$e.id()])return J[$e.id()];for(var Ce=mp($e).depth,Ie=$e.neighborhood(),Je=0,Qe=0,gt=0;gt<Ie.length;gt++){var At=Ie[gt];if(!(At.isEdge()||At.isParent()||!n.has(At))){var Rt=mp(At);if(Rt!=null){var Ut=Rt.index,Vt=Rt.depth;if(!(Ut==null||Vt==null)){var pt=E[Vt].length;Vt<Ce&&(Je+=Ut/pt,Qe++)}}}}return Qe=Math.max(1,Qe),Je=Je/Qe,Qe===0&&(Je=0),J[$e.id()]=Je,Je},de=function($e,Ce){var Ie=ie($e),Je=ie(Ce),Qe=Ie-Je;return Qe===0?RM($e.id(),Ce.id()):Qe};t.depthSort!==void 0&&(de=t.depthSort);for(var he=E.length,xe=0;xe<he;xe++)E[xe].sort(de),D(xe);for(var le=[],fe=0;fe<R.length;fe++)le.push(R[fe]);var ve=function(){for(var $e=0;$e<he;$e++)D($e)};le.length&&(E.unshift(le),he=E.length,ve());for(var ge=0,se=0;se<he;se++)ge=Math.max(E[se].length,ge);var ye={x:l.x1+l.w/2,y:l.y1+l.h/2},Se=n.reduce(function(wt,$e){return(function(Ce){return{w:wt.w===-1?Ce.w:(wt.w+Ce.w)/2,h:wt.h===-1?Ce.h:(wt.h+Ce.h)/2}})($e.boundingBox({includeLabels:t.nodeDimensionsIncludeLabels}))},{w:-1,h:-1}),Ue=Math.max(he===1?0:o?(l.h-t.padding*2-Se.h)/(he-1):(l.h-t.padding*2-Se.h)/(he+1),q),Oe=E.reduce(function(wt,$e){return Math.max(wt,$e.length)},0),mt=function($e){var Ce=mp($e),Ie=Ce.depth,Je=Ce.index;if(t.circle){var Qe=Math.min(l.w/2/he,l.h/2/he);Qe=Math.max(Qe,q);var gt=Qe*Ie+Qe-(he>0&&E[0].length<=3?Qe/2:0),At=2*Math.PI/E[Ie].length*Je;return Ie===0&&E[0].length===1&&(gt=1),{x:ye.x+gt*Math.cos(At),y:ye.y+gt*Math.sin(At)}}else{var Rt=E[Ie].length,Ut=Math.max(Rt===1?0:o?(l.w-t.padding*2-Se.w)/((t.grid?Oe:Rt)-1):(l.w-t.padding*2-Se.w)/((t.grid?Oe:Rt)+1),q),Vt={x:ye.x+(Je+1-(Rt+1)/2)*Ut,y:ye.y+(Ie+1-(he+1)/2)*Ue};return Vt}},lt={downward:0,leftward:90,upward:180,rightward:-90};Object.keys(lt).indexOf(t.direction)===-1&&Kn("Invalid direction '".concat(t.direction,"' specified for breadthfirst layout. Valid values are: ").concat(Object.keys(lt).join(", ")));var at=function($e){return f9(mt($e),l,lt[t.direction])};return r.nodes().layoutPositions(this,t,at),this};var X7={fit:!0,padding:30,boundingBox:void 0,avoidOverlap:!0,nodeDimensionsIncludeLabels:!1,spacingFactor:void 0,radius:void 0,startAngle:3/2*Math.PI,sweep:void 0,clockwise:!0,sort:void 0,animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function(e,r){return!0},ready:void 0,stop:void 0,transform:function(e,r){return r}};function RA(t){this.options=ir({},X7,t)}RA.prototype.run=function(){var t=this.options,e=t,r=t.cy,n=e.eles,i=e.counterclockwise!==void 0?!e.counterclockwise:e.clockwise,a=n.nodes().not(":parent");e.sort&&(a=a.sort(e.sort));for(var s=Es(e.boundingBox?e.boundingBox:{x1:0,y1:0,w:r.width(),h:r.height()}),o={x:s.x1+s.w/2,y:s.y1+s.h/2},l=e.sweep===void 0?2*Math.PI-2*Math.PI/a.length:e.sweep,u=l/Math.max(1,a.length-1),c,f=0,p=0;p<a.length;p++){var v=a[p],y=v.layoutDimensions(e),S=y.w,w=y.h;f=Math.max(f,S,w)}if(bt(e.radius)?c=e.radius:a.length<=1?c=0:c=Math.min(s.h,s.w)/2-f,a.length>1&&e.avoidOverlap){f*=1.75;var E=Math.cos(u)-Math.cos(0),_=Math.sin(u)-Math.sin(0),T=Math.sqrt(f*f/(E*E+_*_));c=Math.max(T,c)}var N=function(I,F){var D=e.startAngle+F*u*(i?1:-1),j=c*Math.cos(D),B=c*Math.sin(D),G={x:o.x+j,y:o.y+B};return G};return n.nodes().layoutPositions(this,e,N),this};var Q7={fit:!0,padding:30,startAngle:3/2*Math.PI,sweep:void 0,clockwise:!0,equidistant:!1,minNodeSpacing:10,boundingBox:void 0,avoidOverlap:!0,nodeDimensionsIncludeLabels:!1,height:void 0,width:void 0,spacingFactor:void 0,concentric:function(e){return e.degree()},levelWidth:function(e){return e.maxDegree()/4},animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function(e,r){return!0},ready:void 0,stop:void 0,transform:function(e,r){return r}};function LA(t){this.options=ir({},Q7,t)}LA.prototype.run=function(){for(var t=this.options,e=t,r=e.counterclockwise!==void 0?!e.counterclockwise:e.clockwise,n=t.cy,i=e.eles,a=i.nodes().not(":parent"),s=Es(e.boundingBox?e.boundingBox:{x1:0,y1:0,w:n.width(),h:n.height()}),o={x:s.x1+s.w/2,y:s.y1+s.h/2},l=[],u=0,c=0;c<a.length;c++){var f=a[c],p=void 0;p=e.concentric(f),l.push({value:p,node:f}),f._private.scratch.concentric=p}a.updateStyle();for(var v=0;v<a.length;v++){var y=a[v],S=y.layoutDimensions(e);u=Math.max(u,S.w,S.h)}l.sort(function(Ue,Oe){return Oe.value-Ue.value});for(var w=e.levelWidth(a),E=[[]],_=E[0],T=0;T<l.length;T++){var N=l[T];if(_.length>0){var R=Math.abs(_[0].value-N.value);R>=w&&(_=[],E.push(_))}_.push(N)}var I=u+e.minNodeSpacing;if(!e.avoidOverlap){var F=E.length>0&&E[0].length>1,D=Math.min(s.w,s.h)/2-I,j=D/(E.length+F?1:0);I=Math.min(I,j)}for(var B=0,G=0;G<E.length;G++){var K=E[G],O=e.sweep===void 0?2*Math.PI-2*Math.PI/K.length:e.sweep,W=K.dTheta=O/Math.max(1,K.length-1);if(K.length>1&&e.avoidOverlap){var U=Math.cos(W)-Math.cos(0),q=Math.sin(W)-Math.sin(0),Z=Math.sqrt(I*I/(U*U+q*q));B=Math.max(Z,B)}K.r=B,B+=I}if(e.equidistant){for(var Q=0,ne=0,re=0;re<E.length;re++){var Y=E[re],J=Y.r-ne;Q=Math.max(Q,J)}ne=0;for(var ie=0;ie<E.length;ie++){var de=E[ie];ie===0&&(ne=de.r),de.r=ne,ne+=Q}}for(var he={},xe=0;xe<E.length;xe++)for(var le=E[xe],fe=le.dTheta,ve=le.r,ge=0;ge<le.length;ge++){var se=le[ge],ye=e.startAngle+(r?1:-1)*fe*ge,Se={x:o.x+ve*Math.cos(ye),y:o.y+ve*Math.sin(ye)};he[se.node.id()]=Se}return i.nodes().layoutPositions(this,e,function(Ue){var Oe=Ue.id();return he[Oe]}),this};var d2,J7={ready:function(){},stop:function(){},animate:!0,animationEasing:void 0,animationDuration:void 0,animateFilter:function(e,r){return!0},animationThreshold:250,refresh:20,fit:!0,padding:30,boundingBox:void 0,nodeDimensionsIncludeLabels:!1,randomize:!1,componentSpacing:40,nodeRepulsion:function(e){return 2048},nodeOverlap:4,idealEdgeLength:function(e){return 32},edgeElasticity:function(e){return 32},nestingFactor:1.2,gravity:1,numIter:1e3,initialTemp:1e3,coolingFactor:.99,minTemp:1};function I1(t){this.options=ir({},J7,t),this.options.layout=this;var e=this.options.eles.nodes(),r=this.options.eles.edges(),n=r.filter(function(i){var a=i.source().data("id"),s=i.target().data("id"),o=e.some(function(u){return u.data("id")===a}),l=e.some(function(u){return u.data("id")===s});return!o||!l});this.options.eles=this.options.eles.not(n)}I1.prototype.run=function(){var t=this.options,e=t.cy,r=this;r.stopped=!1,(t.animate===!0||t.animate===!1)&&r.emit({type:"layoutstart",layout:r}),t.debug===!0?d2=!0:d2=!1;var n=ez(e,r,t);d2&&rz(n),t.randomize&&nz(n);var i=vc(),a=function(){iz(n,e,t),t.fit===!0&&e.fit(t.padding)},s=function(p){return!(r.stopped||p>=t.numIter||(az(n,t),n.temperature=n.temperature*t.coolingFactor,n.temperature<t.minTemp))},o=function(){if(t.animate===!0||t.animate===!1)a(),r.one("layoutstop",t.stop),r.emit({type:"layoutstop",layout:r});else{var p=t.eles.nodes(),v=DA(n,t,p);p.layoutPositions(r,t,v)}},l=0,u=!0;if(t.animate===!0){var c=function(){for(var p=0;u&&p<t.refresh;)u=s(l),l++,p++;if(!u)PN(n,t),o();else{var v=vc();v-i>=t.animationThreshold&&a(),ax(c)}};c()}else{for(;u;)u=s(l),l++;PN(n,t),o()}return this};I1.prototype.stop=function(){return this.stopped=!0,this.thread&&this.thread.stop(),this.emit("layoutstop"),this};I1.prototype.destroy=function(){return this.thread&&this.thread.stop(),this};var ez=function(e,r,n){for(var i=n.eles.edges(),a=n.eles.nodes(),s=Es(n.boundingBox?n.boundingBox:{x1:0,y1:0,w:e.width(),h:e.height()}),o={isCompound:e.hasCompoundNodes(),layoutNodes:[],idToIndex:{},nodeSize:a.size(),graphSet:[],indexToGraph:[],layoutEdges:[],edgeSize:i.size(),temperature:n.initialTemp,clientWidth:s.w,clientHeight:s.h,boundingBox:s},l=n.eles.components(),u={},c=0;c<l.length;c++)for(var f=l[c],p=0;p<f.length;p++){var v=f[p];u[v.id()]=c}for(var c=0;c<o.nodeSize;c++){var y=a[c],S=y.layoutDimensions(n),w={};w.isLocked=y.locked(),w.id=y.data("id"),w.parentId=y.data("parent"),w.cmptId=u[y.id()],w.children=[],w.positionX=y.position("x"),w.positionY=y.position("y"),w.offsetX=0,w.offsetY=0,w.height=S.w,w.width=S.h,w.maxX=w.positionX+w.width/2,w.minX=w.positionX-w.width/2,w.maxY=w.positionY+w.height/2,w.minY=w.positionY-w.height/2,w.padLeft=parseFloat(y.style("padding")),w.padRight=parseFloat(y.style("padding")),w.padTop=parseFloat(y.style("padding")),w.padBottom=parseFloat(y.style("padding")),w.nodeRepulsion=ri(n.nodeRepulsion)?n.nodeRepulsion(y):n.nodeRepulsion,o.layoutNodes.push(w),o.idToIndex[w.id]=c}for(var E=[],_=0,T=-1,N=[],c=0;c<o.nodeSize;c++){var y=o.layoutNodes[c],R=y.parentId;R!=null?o.layoutNodes[o.idToIndex[R]].children.push(y.id):(E[++T]=y.id,N.push(y.id))}for(o.graphSet.push(N);_<=T;){var I=E[_++],F=o.idToIndex[I],v=o.layoutNodes[F],D=v.children;if(D.length>0){o.graphSet.push(D);for(var c=0;c<D.length;c++)E[++T]=D[c]}}for(var c=0;c<o.graphSet.length;c++)for(var j=o.graphSet[c],p=0;p<j.length;p++){var B=o.idToIndex[j[p]];o.indexToGraph[B]=c}for(var c=0;c<o.edgeSize;c++){var G=i[c],K={};K.id=G.data("id"),K.sourceId=G.data("source"),K.targetId=G.data("target");var O=ri(n.idealEdgeLength)?n.idealEdgeLength(G):n.idealEdgeLength,W=ri(n.edgeElasticity)?n.edgeElasticity(G):n.edgeElasticity,U=o.idToIndex[K.sourceId],q=o.idToIndex[K.targetId],Z=o.indexToGraph[U],Q=o.indexToGraph[q];if(Z!=Q){for(var ne=tz(K.sourceId,K.targetId,o),re=o.graphSet[ne],Y=0,w=o.layoutNodes[U];re.indexOf(w.id)===-1;)w=o.layoutNodes[o.idToIndex[w.parentId]],Y++;for(w=o.layoutNodes[q];re.indexOf(w.id)===-1;)w=o.layoutNodes[o.idToIndex[w.parentId]],Y++;O*=Y*n.nestingFactor}K.idealLength=O,K.elasticity=W,o.layoutEdges.push(K)}return o},tz=function(e,r,n){var i=OA(e,r,0,n);return 2>i.count?0:i.graph},OA=function(e,r,n,i){var a=i.graphSet[n];if(-1<a.indexOf(e)&&-1<a.indexOf(r))return{count:2,graph:n};for(var s=0,o=0;o<a.length;o++){var l=a[o],u=i.idToIndex[l],c=i.layoutNodes[u].children;if(c.length!==0){var f=i.indexToGraph[i.idToIndex[c[0]]],p=OA(e,r,f,i);if(p.count!==0)if(p.count===1){if(s++,s===2)break}else return p}}return{count:s,graph:n}},rz,nz=function(e,r){for(var n=e.clientWidth,i=e.clientHeight,a=0;a<e.nodeSize;a++){var s=e.layoutNodes[a];s.children.length===0&&!s.isLocked&&(s.positionX=Math.random()*n,s.positionY=Math.random()*i)}},DA=function(e,r,n){var i=e.boundingBox,a={x1:1/0,x2:-1/0,y1:1/0,y2:-1/0};return r.boundingBox&&(n.forEach(function(s){var o=e.layoutNodes[e.idToIndex[s.data("id")]];a.x1=Math.min(a.x1,o.positionX),a.x2=Math.max(a.x2,o.positionX),a.y1=Math.min(a.y1,o.positionY),a.y2=Math.max(a.y2,o.positionY)}),a.w=a.x2-a.x1,a.h=a.y2-a.y1),function(s,o){var l=e.layoutNodes[e.idToIndex[s.data("id")]];if(r.boundingBox){var u=a.w===0?.5:(l.positionX-a.x1)/a.w,c=a.h===0?.5:(l.positionY-a.y1)/a.h;return{x:i.x1+u*i.w,y:i.y1+c*i.h}}else return{x:l.positionX,y:l.positionY}}},iz=function(e,r,n){var i=n.layout,a=n.eles.nodes(),s=DA(e,n,a);a.positions(s),e.ready!==!0&&(e.ready=!0,i.one("layoutready",n.ready),i.emit({type:"layoutready",layout:this}))},az=function(e,r,n){sz(e,r),uz(e),cz(e,r),dz(e),fz(e)},sz=function(e,r){for(var n=0;n<e.graphSet.length;n++)for(var i=e.graphSet[n],a=i.length,s=0;s<a;s++)for(var o=e.layoutNodes[e.idToIndex[i[s]]],l=s+1;l<a;l++){var u=e.layoutNodes[e.idToIndex[i[l]]];oz(o,u,e,r)}},NN=function(e){return-1+2*e*Math.random()},oz=function(e,r,n,i){var a=e.cmptId,s=r.cmptId;if(!(a!==s&&!n.isCompound)){var o=r.positionX-e.positionX,l=r.positionY-e.positionY,u=1;o===0&&l===0&&(o=NN(u),l=NN(u));var c=lz(e,r,o,l);if(c>0)var f=i.nodeOverlap*c,p=Math.sqrt(o*o+l*l),v=f*o/p,y=f*l/p;else var S=fx(e,o,l),w=fx(r,-1*o,-1*l),E=w.x-S.x,_=w.y-S.y,T=E*E+_*_,p=Math.sqrt(T),f=(e.nodeRepulsion+r.nodeRepulsion)/T,v=f*E/p,y=f*_/p;e.isLocked||(e.offsetX-=v,e.offsetY-=y),r.isLocked||(r.offsetX+=v,r.offsetY+=y)}},lz=function(e,r,n,i){if(n>0)var a=e.maxX-r.minX;else var a=r.maxX-e.minX;if(i>0)var s=e.maxY-r.minY;else var s=r.maxY-e.minY;return a>=0&&s>=0?Math.sqrt(a*a+s*s):0},fx=function(e,r,n){var i=e.positionX,a=e.positionY,s=e.height||1,o=e.width||1,l=n/r,u=s/o,c={};return r===0&&0<n||r===0&&0>n?(c.x=i,c.y=a+s/2,c):0<r&&-1*u<=l&&l<=u?(c.x=i+o/2,c.y=a+o*n/2/r,c):0>r&&-1*u<=l&&l<=u?(c.x=i-o/2,c.y=a-o*n/2/r,c):0<n&&(l<=-1*u||l>=u)?(c.x=i+s*r/2/n,c.y=a+s/2,c):(0>n&&(l<=-1*u||l>=u)&&(c.x=i-s*r/2/n,c.y=a-s/2),c)},uz=function(e,r){for(var n=0;n<e.edgeSize;n++){var i=e.layoutEdges[n],a=e.idToIndex[i.sourceId],s=e.layoutNodes[a],o=e.idToIndex[i.targetId],l=e.layoutNodes[o],u=l.positionX-s.positionX,c=l.positionY-s.positionY;if(!(u===0&&c===0)){var f=fx(s,u,c),p=fx(l,-1*u,-1*c),v=p.x-f.x,y=p.y-f.y,S=Math.sqrt(v*v+y*y),w=Math.pow(i.idealLength-S,2)/i.elasticity;if(S!==0)var E=w*v/S,_=w*y/S;else var E=0,_=0;s.isLocked||(s.offsetX+=E,s.offsetY+=_),l.isLocked||(l.offsetX-=E,l.offsetY-=_)}}},cz=function(e,r){if(r.gravity!==0)for(var n=1,i=0;i<e.graphSet.length;i++){var a=e.graphSet[i],s=a.length;if(i===0)var o=e.clientHeight/2,l=e.clientWidth/2;else var u=e.layoutNodes[e.idToIndex[a[0]]],c=e.layoutNodes[e.idToIndex[u.parentId]],o=c.positionX,l=c.positionY;for(var f=0;f<s;f++){var p=e.layoutNodes[e.idToIndex[a[f]]];if(!p.isLocked){var v=o-p.positionX,y=l-p.positionY,S=Math.sqrt(v*v+y*y);if(S>n){var w=r.gravity*v/S,E=r.gravity*y/S;p.offsetX+=w,p.offsetY+=E}}}}},dz=function(e,r){var n=[],i=0,a=-1;for(n.push.apply(n,e.graphSet[0]),a+=e.graphSet[0].length;i<=a;){var s=n[i++],o=e.idToIndex[s],l=e.layoutNodes[o],u=l.children;if(0<u.length&&!l.isLocked){for(var c=l.offsetX,f=l.offsetY,p=0;p<u.length;p++){var v=e.layoutNodes[e.idToIndex[u[p]]];v.offsetX+=c,v.offsetY+=f,n[++a]=u[p]}l.offsetX=0,l.offsetY=0}}},fz=function(e,r){for(var n=0;n<e.nodeSize;n++){var i=e.layoutNodes[n];0<i.children.length&&(i.maxX=void 0,i.minX=void 0,i.maxY=void 0,i.minY=void 0)}for(var n=0;n<e.nodeSize;n++){var i=e.layoutNodes[n];if(!(0<i.children.length||i.isLocked)){var a=hz(i.offsetX,i.offsetY,e.temperature);i.positionX+=a.x,i.positionY+=a.y,i.offsetX=0,i.offsetY=0,i.minX=i.positionX-i.width,i.maxX=i.positionX+i.width,i.minY=i.positionY-i.height,i.maxY=i.positionY+i.height,IA(i,e)}}for(var n=0;n<e.nodeSize;n++){var i=e.layoutNodes[n];0<i.children.length&&!i.isLocked&&(i.positionX=(i.maxX+i.minX)/2,i.positionY=(i.maxY+i.minY)/2,i.width=i.maxX-i.minX,i.height=i.maxY-i.minY)}},hz=function(e,r,n){var i=Math.sqrt(e*e+r*r);if(i>n)var a={x:n*e/i,y:n*r/i};else var a={x:e,y:r};return a},IA=function(e,r){var n=e.parentId;if(n!=null){var i=r.layoutNodes[r.idToIndex[n]],a=!1;if((i.maxX==null||e.maxX+i.padRight>i.maxX)&&(i.maxX=e.maxX+i.padRight,a=!0),(i.minX==null||e.minX-i.padLeft<i.minX)&&(i.minX=e.minX-i.padLeft,a=!0),(i.maxY==null||e.maxY+i.padBottom>i.maxY)&&(i.maxY=e.maxY+i.padBottom,a=!0),(i.minY==null||e.minY-i.padTop<i.minY)&&(i.minY=e.minY-i.padTop,a=!0),a)return IA(i,r)}},PN=function(e,r){for(var n=e.layoutNodes,i=[],a=0;a<n.length;a++){var s=n[a],o=s.cmptId,l=i[o]=i[o]||[];l.push(s)}for(var u=0,a=0;a<i.length;a++){var c=i[a];if(c){c.x1=1/0,c.x2=-1/0,c.y1=1/0,c.y2=-1/0;for(var f=0;f<c.length;f++){var p=c[f];c.x1=Math.min(c.x1,p.positionX-p.width/2),c.x2=Math.max(c.x2,p.positionX+p.width/2),c.y1=Math.min(c.y1,p.positionY-p.height/2),c.y2=Math.max(c.y2,p.positionY+p.height/2)}c.w=c.x2-c.x1,c.h=c.y2-c.y1,u+=c.w*c.h}}i.sort(function(_,T){return T.w*T.h-_.w*_.h});for(var v=0,y=0,S=0,w=0,E=Math.sqrt(u)*e.clientWidth/e.clientHeight,a=0;a<i.length;a++){var c=i[a];if(c){for(var f=0;f<c.length;f++){var p=c[f];p.isLocked||(p.positionX+=v-c.x1,p.positionY+=y-c.y1)}v+=c.w+r.componentSpacing,S+=c.w+r.componentSpacing,w=Math.max(w,c.h),S>E&&(y+=w+r.componentSpacing,v=0,S=0,w=0)}}},pz={fit:!0,padding:30,boundingBox:void 0,avoidOverlap:!0,avoidOverlapPadding:10,nodeDimensionsIncludeLabels:!1,spacingFactor:void 0,condense:!1,rows:void 0,cols:void 0,position:function(e){},sort:void 0,animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function(e,r){return!0},ready:void 0,stop:void 0,transform:function(e,r){return r}};function jA(t){this.options=ir({},pz,t)}jA.prototype.run=function(){var t=this.options,e=t,r=t.cy,n=e.eles,i=n.nodes().not(":parent");e.sort&&(i=i.sort(e.sort));var a=Es(e.boundingBox?e.boundingBox:{x1:0,y1:0,w:r.width(),h:r.height()});if(a.h===0||a.w===0)n.nodes().layoutPositions(this,e,function(ie){return{x:a.x1,y:a.y1}});else{var s=i.size(),o=Math.sqrt(s*a.h/a.w),l=Math.round(o),u=Math.round(a.w/a.h*o),c=function(de){if(de==null)return Math.min(l,u);var he=Math.min(l,u);he==l?l=de:u=de},f=function(de){if(de==null)return Math.max(l,u);var he=Math.max(l,u);he==l?l=de:u=de},p=e.rows,v=e.cols!=null?e.cols:e.columns;if(p!=null&&v!=null)l=p,u=v;else if(p!=null&&v==null)l=p,u=Math.ceil(s/l);else if(p==null&&v!=null)u=v,l=Math.ceil(s/u);else if(u*l>s){var y=c(),S=f();(y-1)*S>=s?c(y-1):(S-1)*y>=s&&f(S-1)}else for(;u*l<s;){var w=c(),E=f();(E+1)*w>=s?f(E+1):c(w+1)}var _=a.w/u,T=a.h/l;if(e.condense&&(_=0,T=0),e.avoidOverlap)for(var N=0;N<i.length;N++){var R=i[N],I=R._private.position;(I.x==null||I.y==null)&&(I.x=0,I.y=0);var F=R.layoutDimensions(e),D=e.avoidOverlapPadding,j=F.w+D,B=F.h+D;_=Math.max(_,j),T=Math.max(T,B)}for(var G={},K=function(de,he){return!!G["c-"+de+"-"+he]},O=function(de,he){G["c-"+de+"-"+he]=!0},W=0,U=0,q=function(){U++,U>=u&&(U=0,W++)},Z={},Q=0;Q<i.length;Q++){var ne=i[Q],re=e.position(ne);if(re&&(re.row!==void 0||re.col!==void 0)){var Y={row:re.row,col:re.col};if(Y.col===void 0)for(Y.col=0;K(Y.row,Y.col);)Y.col++;else if(Y.row===void 0)for(Y.row=0;K(Y.row,Y.col);)Y.row++;Z[ne.id()]=Y,O(Y.row,Y.col)}}var J=function(de,he){var xe,le;if(de.locked()||de.isParent())return!1;var fe=Z[de.id()];if(fe)xe=fe.col*_+_/2+a.x1,le=fe.row*T+T/2+a.y1;else{for(;K(W,U);)q();xe=U*_+_/2+a.x1,le=W*T+T/2+a.y1,O(W,U),q()}return{x:xe,y:le}};i.layoutPositions(this,e,J)}return this};var mz={ready:function(){},stop:function(){}};function p_(t){this.options=ir({},mz,t)}p_.prototype.run=function(){var t=this.options,e=t.eles,r=this;return t.cy,r.emit("layoutstart"),e.nodes().positions(function(){return{x:0,y:0}}),r.one("layoutready",t.ready),r.emit("layoutready"),r.one("layoutstop",t.stop),r.emit("layoutstop"),this};p_.prototype.stop=function(){return this};var gz={positions:void 0,zoom:void 0,pan:void 0,fit:!0,padding:30,spacingFactor:void 0,animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function(e,r){return!0},ready:void 0,stop:void 0,transform:function(e,r){return r}};function FA(t){this.options=ir({},gz,t)}FA.prototype.run=function(){var t=this.options,e=t.eles,r=e.nodes(),n=ri(t.positions);function i(a){if(t.positions==null)return F9(a.position());if(n)return t.positions(a);var s=t.positions[a._private.data.id];return s??null}return r.layoutPositions(this,t,function(a,s){var o=i(a);return a.locked()||o==null?!1:o}),this};var vz={fit:!0,padding:30,boundingBox:void 0,animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function(e,r){return!0},ready:void 0,stop:void 0,transform:function(e,r){return r}};function BA(t){this.options=ir({},vz,t)}BA.prototype.run=function(){var t=this.options,e=t.cy,r=t.eles,n=Es(t.boundingBox?t.boundingBox:{x1:0,y1:0,w:e.width(),h:e.height()}),i=function(s,o){return{x:n.x1+Math.round(Math.random()*n.w),y:n.y1+Math.round(Math.random()*n.h)}};return r.nodes().layoutPositions(this,t,i),this};var yz=[{name:"breadthfirst",impl:AA},{name:"circle",impl:RA},{name:"concentric",impl:LA},{name:"cose",impl:I1},{name:"grid",impl:jA},{name:"null",impl:p_},{name:"preset",impl:FA},{name:"random",impl:BA}];function zA(t){this.options=t,this.notifications=0}var MN=function(){},AN=function(){throw new Error("A headless instance can not render images")};zA.prototype={recalculateRenderedStyle:MN,notify:function(){this.notifications++},init:MN,isHeadless:function(){return!0},png:AN,jpg:AN};var m_={};m_.arrowShapeWidth=.3;m_.registerArrowShapes=function(){var t=this.arrowShapes={},e=this,r=function(u,c,f,p,v,y,S){var w=v.x-f/2-S,E=v.x+f/2+S,_=v.y-f/2-S,T=v.y+f/2+S,N=w<=u&&u<=E&&_<=c&&c<=T;return N},n=function(u,c,f,p,v){var y=u*Math.cos(p)-c*Math.sin(p),S=u*Math.sin(p)+c*Math.cos(p),w=y*f,E=S*f,_=w+v.x,T=E+v.y;return{x:_,y:T}},i=function(u,c,f,p){for(var v=[],y=0;y<u.length;y+=2){var S=u[y],w=u[y+1];v.push(n(S,w,c,f,p))}return v},a=function(u){for(var c=[],f=0;f<u.length;f++){var p=u[f];c.push(p.x,p.y)}return c},s=function(u){return u.pstyle("width").pfValue*u.pstyle("arrow-scale").pfValue*2},o=function(u,c){Kt(c)&&(c=t[c]),t[u]=ir({name:u,points:[-.15,-.3,.15,-.3,.15,.3,-.15,.3],collide:function(p,v,y,S,w,E){var _=a(i(this.points,y+2*E,S,w)),T=Ks(p,v,_);return T},roughCollide:r,draw:function(p,v,y,S){var w=i(this.points,v,y,S);e.arrowShapeImpl("polygon")(p,w)},spacing:function(p){return 0},gap:s},c)};o("none",{collide:sx,roughCollide:sx,draw:e_,spacing:WE,gap:WE}),o("triangle",{points:[-.15,-.3,0,0,.15,-.3]}),o("arrow","triangle"),o("triangle-backcurve",{points:t.triangle.points,controlPoint:[0,-.15],roughCollide:r,draw:function(u,c,f,p,v){var y=i(this.points,c,f,p),S=this.controlPoint,w=n(S[0],S[1],c,f,p);e.arrowShapeImpl(this.name)(u,y,w)},gap:function(u){return s(u)*.8}}),o("triangle-tee",{points:[0,0,.15,-.3,-.15,-.3,0,0],pointsTee:[-.15,-.4,-.15,-.5,.15,-.5,.15,-.4],collide:function(u,c,f,p,v,y,S){var w=a(i(this.points,f+2*S,p,v)),E=a(i(this.pointsTee,f+2*S,p,v)),_=Ks(u,c,w)||Ks(u,c,E);return _},draw:function(u,c,f,p,v){var y=i(this.points,c,f,p),S=i(this.pointsTee,c,f,p);e.arrowShapeImpl(this.name)(u,y,S)}}),o("circle-triangle",{radius:.15,pointsTr:[0,-.15,.15,-.45,-.15,-.45,0,-.15],collide:function(u,c,f,p,v,y,S){var w=v,E=Math.pow(w.x-u,2)+Math.pow(w.y-c,2)<=Math.pow((f+2*S)*this.radius,2),_=a(i(this.points,f+2*S,p,v));return Ks(u,c,_)||E},draw:function(u,c,f,p,v){var y=i(this.pointsTr,c,f,p);e.arrowShapeImpl(this.name)(u,y,p.x,p.y,this.radius*c)},spacing:function(u){return e.getArrowWidth(u.pstyle("width").pfValue,u.pstyle("arrow-scale").value)*this.radius}}),o("triangle-cross",{points:[0,0,.15,-.3,-.15,-.3,0,0],baseCrossLinePts:[-.15,-.4,-.15,-.4,.15,-.4,.15,-.4],crossLinePts:function(u,c){var f=this.baseCrossLinePts.slice(),p=c/u,v=3,y=5;return f[v]=f[v]-p,f[y]=f[y]-p,f},collide:function(u,c,f,p,v,y,S){var w=a(i(this.points,f+2*S,p,v)),E=a(i(this.crossLinePts(f,y),f+2*S,p,v)),_=Ks(u,c,w)||Ks(u,c,E);return _},draw:function(u,c,f,p,v){var y=i(this.points,c,f,p),S=i(this.crossLinePts(c,v),c,f,p);e.arrowShapeImpl(this.name)(u,y,S)}}),o("vee",{points:[-.15,-.3,0,0,.15,-.3,0,-.15],gap:function(u){return s(u)*.525}}),o("circle",{radius:.15,collide:function(u,c,f,p,v,y,S){var w=v,E=Math.pow(w.x-u,2)+Math.pow(w.y-c,2)<=Math.pow((f+2*S)*this.radius,2);return E},draw:function(u,c,f,p,v){e.arrowShapeImpl(this.name)(u,p.x,p.y,this.radius*c)},spacing:function(u){return e.getArrowWidth(u.pstyle("width").pfValue,u.pstyle("arrow-scale").value)*this.radius}}),o("tee",{points:[-.15,0,-.15,-.1,.15,-.1,.15,0],spacing:function(u){return 1},gap:function(u){return 1}}),o("square",{points:[-.15,0,.15,0,.15,-.3,-.15,-.3]}),o("diamond",{points:[-.15,-.15,0,-.3,.15,-.15,0,0],gap:function(u){return u.pstyle("width").pfValue*u.pstyle("arrow-scale").value}}),o("chevron",{points:[0,0,-.15,-.15,-.1,-.2,0,-.1,.1,-.2,.15,-.15],gap:function(u){return .95*u.pstyle("width").pfValue*u.pstyle("arrow-scale").value}})};var Ph={};Ph.projectIntoViewport=function(t,e){var r=this.cy,n=this.findContainerClientCoords(),i=n[0],a=n[1],s=n[4],o=r.pan(),l=r.zoom(),u=((t-i)/s-o.x)/l,c=((e-a)/s-o.y)/l;return[u,c]};Ph.findContainerClientCoords=function(){if(this.containerBB)return this.containerBB;var t=this.container,e=t.getBoundingClientRect(),r=this.cy.window().getComputedStyle(t),n=function(E){return parseFloat(r.getPropertyValue(E))},i={left:n("padding-left"),right:n("padding-right"),top:n("padding-top"),bottom:n("padding-bottom")},a={left:n("border-left-width"),right:n("border-right-width"),top:n("border-top-width"),bottom:n("border-bottom-width")},s=t.clientWidth,o=t.clientHeight,l=i.left+i.right,u=i.top+i.bottom,c=a.left+a.right,f=e.width/(s+c),p=s-l,v=o-u,y=e.left+i.left+a.left,S=e.top+i.top+a.top;return this.containerBB=[y,S,p,v,f]};Ph.invalidateContainerClientCoordsCache=function(){this.containerBB=null};Ph.findNearestElement=function(t,e,r,n){return this.findNearestElements(t,e,r,n)[0]};Ph.findNearestElements=function(t,e,r,n){var i=this,a=this,s=a.getCachedZSortedEles(),o=[],l=a.cy.zoom(),u=a.cy.hasCompoundNodes(),c=(n?24:8)/l,f=(n?8:2)/l,p=(n?8:2)/l,v=1/0,y,S;r&&(s=s.interactive);function w(F,D){if(F.isNode()){if(S)return;S=F,o.push(F)}if(F.isEdge()&&(D==null||D<v))if(y){if(y.pstyle("z-compound-depth").value===F.pstyle("z-compound-depth").value&&y.pstyle("z-compound-depth").value===F.pstyle("z-compound-depth").value){for(var j=0;j<o.length;j++)if(o[j].isEdge()){o[j]=F,y=F,v=D??v;break}}}else o.push(F),y=F,v=D??v}function E(F){var D=F.outerWidth()+2*f,j=F.outerHeight()+2*f,B=D/2,G=j/2,K=F.position(),O=F.pstyle("corner-radius").value==="auto"?"auto":F.pstyle("corner-radius").pfValue,W=F._private.rscratch;if(K.x-B<=t&&t<=K.x+B&&K.y-G<=e&&e<=K.y+G){var U=a.nodeShapes[i.getNodeShape(F)];if(U.checkPoint(t,e,0,D,j,K.x,K.y,O,W))return w(F,0),!0}}function _(F){var D=F._private,j=D.rscratch,B=F.pstyle("width").pfValue,G=F.pstyle("arrow-scale").value,K=B/2+c,O=K*K,W=K*2,Q=D.source,ne=D.target,U;if(j.edgeType==="segments"||j.edgeType==="straight"||j.edgeType==="haystack"){for(var q=j.allpts,Z=0;Z+3<q.length;Z+=2)if(Q9(t,e,q[Z],q[Z+1],q[Z+2],q[Z+3],W)&&O>(U=nF(t,e,q[Z],q[Z+1],q[Z+2],q[Z+3])))return w(F,U),!0}else if(j.edgeType==="bezier"||j.edgeType==="multibezier"||j.edgeType==="self"||j.edgeType==="compound"){for(var q=j.allpts,Z=0;Z+5<j.allpts.length;Z+=4)if(J9(t,e,q[Z],q[Z+1],q[Z+2],q[Z+3],q[Z+4],q[Z+5],W)&&O>(U=rF(t,e,q[Z],q[Z+1],q[Z+2],q[Z+3],q[Z+4],q[Z+5])))return w(F,U),!0}for(var Q=Q||D.source,ne=ne||D.target,re=i.getArrowWidth(B,G),Y=[{name:"source",x:j.arrowStartX,y:j.arrowStartY,angle:j.srcArrowAngle},{name:"target",x:j.arrowEndX,y:j.arrowEndY,angle:j.tgtArrowAngle},{name:"mid-source",x:j.midX,y:j.midY,angle:j.midsrcArrowAngle},{name:"mid-target",x:j.midX,y:j.midY,angle:j.midtgtArrowAngle}],Z=0;Z<Y.length;Z++){var J=Y[Z],ie=a.arrowShapes[F.pstyle(J.name+"-arrow-shape").value],de=F.pstyle("width").pfValue;if(ie.roughCollide(t,e,re,J.angle,{x:J.x,y:J.y},de,c)&&ie.collide(t,e,re,J.angle,{x:J.x,y:J.y},de,c))return w(F),!0}u&&o.length>0&&(E(Q),E(ne))}function T(F,D,j){return $s(F,D,j)}function N(F,D){var j=F._private,B=p,G;D?G=D+"-":G="",F.boundingBox();var K=j.labelBounds[D||"main"],O=F.pstyle(G+"label").value,W=F.pstyle("text-events").strValue==="yes";if(!(!W||!O)){var U=T(j.rscratch,"labelX",D),q=T(j.rscratch,"labelY",D),Z=T(j.rscratch,"labelAngle",D),Q=F.pstyle(G+"text-margin-x").pfValue,ne=F.pstyle(G+"text-margin-y").pfValue,re=K.x1-B-Q,Y=K.x2+B-Q,J=K.y1-B-ne,ie=K.y2+B-ne;if(Z){var de=Math.cos(Z),he=Math.sin(Z),xe=function(Se,Ue){return Se=Se-U,Ue=Ue-q,{x:Se*de-Ue*he+U,y:Se*he+Ue*de+q}},le=xe(re,J),fe=xe(re,ie),ve=xe(Y,J),ge=xe(Y,ie),se=[le.x+Q,le.y+ne,ve.x+Q,ve.y+ne,ge.x+Q,ge.y+ne,fe.x+Q,fe.y+ne];if(Ks(t,e,se))return w(F),!0}else if(Od(K,t,e))return w(F),!0}}for(var R=s.length-1;R>=0;R--){var I=s[R];I.isNode()?E(I)||N(I):_(I)||N(I)||N(I,"source")||N(I,"target")}return o};Ph.getAllInBox=function(t,e,r,n){var i=this.getCachedZSortedEles().interactive,a=this.cy.zoom(),s=2/a,o=[],l=Math.min(t,r),u=Math.max(t,r),c=Math.min(e,n),f=Math.max(e,n);t=l,r=u,e=c,n=f;var p=Es({x1:t,y1:e,x2:r,y2:n}),v=[{x:p.x1,y:p.y1},{x:p.x2,y:p.y1},{x:p.x2,y:p.y2},{x:p.x1,y:p.y2}],y=[[v[0],v[1]],[v[1],v[2]],[v[2],v[3]],[v[3],v[0]]];function S(Se,Ue,Oe){return $s(Se,Ue,Oe)}function w(Se,Ue){var Oe=Se._private,mt=s,lt="";Se.boundingBox();var at=Oe.labelBounds.main;if(!at)return null;var wt=S(Oe.rscratch,"labelX",Ue),$e=S(Oe.rscratch,"labelY",Ue),Ce=S(Oe.rscratch,"labelAngle",Ue),Ie=Se.pstyle(lt+"text-margin-x").pfValue,Je=Se.pstyle(lt+"text-margin-y").pfValue,Qe=at.x1-mt-Ie,gt=at.x2+mt-Ie,At=at.y1-mt-Je,Rt=at.y2+mt-Je;if(Ce){var Ut=Math.cos(Ce),Vt=Math.sin(Ce),pt=function(Ge,ce){return Ge=Ge-wt,ce=ce-$e,{x:Ge*Ut-ce*Vt+wt,y:Ge*Vt+ce*Ut+$e}};return[pt(Qe,At),pt(gt,At),pt(gt,Rt),pt(Qe,Rt)]}else return[{x:Qe,y:At},{x:gt,y:At},{x:gt,y:Rt},{x:Qe,y:Rt}]}function E(Se,Ue,Oe,mt){function lt(at,wt,$e){return($e.y-at.y)*(wt.x-at.x)>(wt.y-at.y)*($e.x-at.x)}return lt(Se,Oe,mt)!==lt(Ue,Oe,mt)&&lt(Se,Ue,Oe)!==lt(Se,Ue,mt)}for(var _=0;_<i.length;_++){var T=i[_];if(T.isNode()){var N=T,R=N.pstyle("text-events").strValue==="yes",I=N.pstyle("box-selection").strValue,F=N.pstyle("box-select-labels").strValue==="yes";if(I==="none")continue;var D=(I==="overlap"||F)&&R,j=N.boundingBox({includeNodes:!0,includeEdges:!1,includeLabels:D});if(I==="contain"){var B=!1;if(F&&R){var G=w(N);G&&uw(G,v)&&(o.push(N),B=!0)}!B&&$M(p,j)&&o.push(N)}else if(I==="overlap"&&i_(p,j)){var K=N.boundingBox({includeNodes:!0,includeEdges:!0,includeLabels:!1,includeMainLabels:!1,includeSourceLabels:!1,includeTargetLabels:!1}),O=[{x:K.x1,y:K.y1},{x:K.x2,y:K.y1},{x:K.x2,y:K.y2},{x:K.x1,y:K.y2}];if(uw(O,v))o.push(N);else{var W=w(N);W&&uw(W,v)&&o.push(N)}}}else{var U=T,q=U._private,Z=q.rscratch,Q=U.pstyle("box-selection").strValue;if(Q==="none")continue;if(Q==="contain"){if(Z.startX!=null&&Z.startY!=null&&!Od(p,Z.startX,Z.startY)||Z.endX!=null&&Z.endY!=null&&!Od(p,Z.endX,Z.endY))continue;if(Z.edgeType==="bezier"||Z.edgeType==="multibezier"||Z.edgeType==="self"||Z.edgeType==="compound"||Z.edgeType==="segments"||Z.edgeType==="haystack"){for(var ne=q.rstyle.bezierPts||q.rstyle.linePts||q.rstyle.haystackPts,re=!0,Y=0;Y<ne.length;Y++)if(!YE(p,ne[Y])){re=!1;break}re&&o.push(U)}else Z.edgeType==="straight"&&o.push(U)}else if(Q==="overlap"){var J=!1;if(Z.startX!=null&&Z.startY!=null&&Z.endX!=null&&Z.endY!=null&&(Od(p,Z.startX,Z.startY)||Od(p,Z.endX,Z.endY)))o.push(U),J=!0;else if(!J&&Z.edgeType==="haystack"){for(var ie=q.rstyle.haystackPts,de=0;de<ie.length;de++)if(YE(p,ie[de])){o.push(U),J=!0;break}}if(!J){var he=q.rstyle.bezierPts||q.rstyle.linePts||q.rstyle.haystackPts;if((!he||he.length<2)&&Z.edgeType==="straight"&&Z.startX!=null&&Z.startY!=null&&Z.endX!=null&&Z.endY!=null&&(he=[{x:Z.startX,y:Z.startY},{x:Z.endX,y:Z.endY}]),!he||he.length<2)continue;for(var xe=0;xe<he.length-1;xe++){for(var le=he[xe],fe=he[xe+1],ve=0;ve<y.length;ve++){var ge=Di(y[ve],2),se=ge[0],ye=ge[1];if(E(le,fe,se,ye)){o.push(U),J=!0;break}}if(J)break}}}}}return o};var hx={};hx.calculateArrowAngles=function(t){var e=t._private.rscratch,r=e.edgeType==="haystack",n=e.edgeType==="bezier",i=e.edgeType==="multibezier",a=e.edgeType==="segments",s=e.edgeType==="compound",o=e.edgeType==="self",l,u,c,f,p,v,E,_;if(r?(c=e.haystackPts[0],f=e.haystackPts[1],p=e.haystackPts[2],v=e.haystackPts[3]):(c=e.arrowStartX,f=e.arrowStartY,p=e.arrowEndX,v=e.arrowEndY),E=e.midX,_=e.midY,a)l=c-e.segpts[0],u=f-e.segpts[1];else if(i||s||o||n){var y=e.allpts,S=fa(y[0],y[2],y[4],.1),w=fa(y[1],y[3],y[5],.1);l=c-S,u=f-w}else l=c-E,u=f-_;e.srcArrowAngle=X0(l,u);var E=e.midX,_=e.midY;if(r&&(E=(c+p)/2,_=(f+v)/2),l=p-c,u=v-f,a){var y=e.allpts;if(y.length/2%2===0){var T=y.length/2,N=T-2;l=y[T]-y[N],u=y[T+1]-y[N+1]}else if(e.isRound)l=e.midVector[1],u=-e.midVector[0];else{var T=y.length/2-1,N=T-2;l=y[T]-y[N],u=y[T+1]-y[N+1]}}else if(i||s||o){var y=e.allpts,R=e.ctrlpts,I,F,D,j;if(R.length/2%2===0){var B=y.length/2-1,G=B+2,K=G+2;I=fa(y[B],y[G],y[K],0),F=fa(y[B+1],y[G+1],y[K+1],0),D=fa(y[B],y[G],y[K],1e-4),j=fa(y[B+1],y[G+1],y[K+1],1e-4)}else{var G=y.length/2-1,B=G-2,K=G+2;I=fa(y[B],y[G],y[K],.4999),F=fa(y[B+1],y[G+1],y[K+1],.4999),D=fa(y[B],y[G],y[K],.5),j=fa(y[B+1],y[G+1],y[K+1],.5)}l=D-I,u=j-F}if(e.midtgtArrowAngle=X0(l,u),e.midDispX=l,e.midDispY=u,l*=-1,u*=-1,a){var y=e.allpts;if(y.length/2%2!==0){if(!e.isRound){var T=y.length/2-1,O=T+2;l=-(y[O]-y[T]),u=-(y[O+1]-y[T+1])}}}if(e.midsrcArrowAngle=X0(l,u),a)l=p-e.segpts[e.segpts.length-2],u=v-e.segpts[e.segpts.length-1];else if(i||s||o||n){var y=e.allpts,W=y.length,S=fa(y[W-6],y[W-4],y[W-2],.9),w=fa(y[W-5],y[W-3],y[W-1],.9);l=p-S,u=v-w}else l=p-E,u=v-_;e.tgtArrowAngle=X0(l,u)};hx.getArrowWidth=hx.getArrowHeight=function(t,e){var r=this.arrowWidthCache=this.arrowWidthCache||{},n=r[t+", "+e];return n||(n=Math.max(Math.pow(t*13.37,.9),29)*e,r[t+", "+e]=n,n)};var HS,WS,yu={},Wo={},RN,LN,Qf,Gy,rc,Vf,Zf,gu,gp,ay,UA,GA,qS,$S,ON,DN=function(e,r,n){n.x=r.x-e.x,n.y=r.y-e.y,n.len=Math.sqrt(n.x*n.x+n.y*n.y),n.nx=n.x/n.len,n.ny=n.y/n.len,n.ang=Math.atan2(n.ny,n.nx)},xz=function(e,r){r.x=e.x*-1,r.y=e.y*-1,r.nx=e.nx*-1,r.ny=e.ny*-1,r.ang=e.ang>0?-(Math.PI-e.ang):Math.PI+e.ang},bz=function(e,r,n,i,a){if(e!==ON?DN(r,e,yu):xz(Wo,yu),DN(r,n,Wo),RN=yu.nx*Wo.ny-yu.ny*Wo.nx,LN=yu.nx*Wo.nx-yu.ny*-Wo.ny,rc=Math.asin(Math.max(-1,Math.min(1,RN))),Math.abs(rc)<1e-6){HS=r.x,WS=r.y,Zf=gp=0;return}Qf=1,Gy=!1,LN<0?rc<0?rc=Math.PI+rc:(rc=Math.PI-rc,Qf=-1,Gy=!0):rc>0&&(Qf=-1,Gy=!0),r.radius!==void 0?gp=r.radius:gp=i,Vf=rc/2,ay=Math.min(yu.len/2,Wo.len/2),a?(gu=Math.abs(Math.cos(Vf)*gp/Math.sin(Vf)),gu>ay?(gu=ay,Zf=Math.abs(gu*Math.sin(Vf)/Math.cos(Vf))):Zf=gp):(gu=Math.min(ay,gp),Zf=Math.abs(gu*Math.sin(Vf)/Math.cos(Vf))),qS=r.x+Wo.nx*gu,$S=r.y+Wo.ny*gu,HS=qS-Wo.ny*Zf*Qf,WS=$S+Wo.nx*Zf*Qf,UA=r.x+yu.nx*gu,GA=r.y+yu.ny*gu,ON=r};function VA(t,e){e.radius===0?t.lineTo(e.cx,e.cy):t.arc(e.cx,e.cy,e.radius,e.startAngle,e.endAngle,e.counterClockwise)}function g_(t,e,r,n){var i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0;return n===0||e.radius===0?{cx:e.x,cy:e.y,radius:0,startX:e.x,startY:e.y,stopX:e.x,stopY:e.y,startAngle:void 0,endAngle:void 0,counterClockwise:void 0}:(bz(t,e,r,n,i),{cx:HS,cy:WS,radius:Zf,startX:UA,startY:GA,stopX:qS,stopY:$S,startAngle:yu.ang+Math.PI/2*Qf,endAngle:Wo.ang-Math.PI/2*Qf,counterClockwise:Gy})}var Nv=.01,wz=Math.sqrt(2*Nv),us={};us.findMidptPtsEtc=function(t,e){var r=e.posPts,n=e.intersectionPts,i=e.vectorNormInverse,a,s=t.pstyle("source-endpoint"),o=t.pstyle("target-endpoint"),l=s.units!=null&&o.units!=null,u=function(R,I,F,D){var j=D-I,B=F-R,G=Math.sqrt(B*B+j*j);return{x:-j/G,y:B/G}},c=t.pstyle("edge-distances").value;switch(c){case"node-position":a=r;break;case"intersection":a=n;break;case"endpoints":{if(l){var f=this.manualEndptToPx(t.source()[0],s),p=Di(f,2),v=p[0],y=p[1],S=this.manualEndptToPx(t.target()[0],o),w=Di(S,2),E=w[0],_=w[1],T={x1:v,y1:y,x2:E,y2:_};i=u(v,y,E,_),a=T}else an("Edge ".concat(t.id()," has edge-distances:endpoints specified without manual endpoints specified via source-endpoint and target-endpoint.  Falling back on edge-distances:intersection (default).")),a=n;break}}return{midptPts:a,vectorNormInverse:i}};us.findHaystackPoints=function(t){for(var e=0;e<t.length;e++){var r=t[e],n=r._private,i=n.rscratch;if(!i.haystack){var a=Math.random()*2*Math.PI;i.source={x:Math.cos(a),y:Math.sin(a)},a=Math.random()*2*Math.PI,i.target={x:Math.cos(a),y:Math.sin(a)}}var s=n.source,o=n.target,l=s.position(),u=o.position(),c=s.width(),f=o.width(),p=s.height(),v=o.height(),y=r.pstyle("haystack-radius").value,S=y/2;i.haystackPts=i.allpts=[i.source.x*c*S+l.x,i.source.y*p*S+l.y,i.target.x*f*S+u.x,i.target.y*v*S+u.y],i.midX=(i.allpts[0]+i.allpts[2])/2,i.midY=(i.allpts[1]+i.allpts[3])/2,i.edgeType="haystack",i.haystack=!0,this.storeEdgeProjections(r),this.calculateArrowAngles(r),this.recalculateEdgeLabelProjections(r),this.calculateLabelAngles(r)}};us.findSegmentsPoints=function(t,e){var r=t._private.rscratch,n=t.pstyle("segment-weights"),i=t.pstyle("segment-distances"),a=t.pstyle("segment-radii"),s=t.pstyle("radius-type"),o=Math.min(n.pfValue.length,i.pfValue.length),l=a.pfValue[a.pfValue.length-1],u=s.pfValue[s.pfValue.length-1];r.edgeType="segments",r.segpts=[],r.radii=[],r.isArcRadius=[];for(var c=0;c<o;c++){var f=n.pfValue[c],p=i.pfValue[c],v=1-f,y=f,S=this.findMidptPtsEtc(t,e),w=S.midptPts,E=S.vectorNormInverse,_={x:w.x1*v+w.x2*y,y:w.y1*v+w.y2*y};r.segpts.push(_.x+E.x*p,_.y+E.y*p),r.radii.push(a.pfValue[c]!==void 0?a.pfValue[c]:l),r.isArcRadius.push((s.pfValue[c]!==void 0?s.pfValue[c]:u)==="arc-radius")}};us.findLoopPoints=function(t,e,r,n){var i=t._private.rscratch,a=e.dirCounts,s=e.srcPos,o=t.pstyle("control-point-distances"),l=o?o.pfValue[0]:void 0,u=t.pstyle("loop-direction").pfValue,c=t.pstyle("loop-sweep").pfValue,f=t.pstyle("control-point-step-size").pfValue;i.edgeType="self";var p=r,v=f;n&&(p=0,v=l);var y=u-Math.PI/2,S=y-c/2,w=y+c/2,E=u+"_"+c;p=a[E]===void 0?a[E]=0:++a[E],i.ctrlpts=[s.x+Math.cos(S)*1.4*v*(p/3+1),s.y+Math.sin(S)*1.4*v*(p/3+1),s.x+Math.cos(w)*1.4*v*(p/3+1),s.y+Math.sin(w)*1.4*v*(p/3+1)]};us.findCompoundLoopPoints=function(t,e,r,n){var i=t._private.rscratch;i.edgeType="compound";var a=e.srcPos,s=e.tgtPos,o=e.srcW,l=e.srcH,u=e.tgtW,c=e.tgtH,f=t.pstyle("control-point-step-size").pfValue,p=t.pstyle("control-point-distances"),v=p?p.pfValue[0]:void 0,y=r,S=f;n&&(y=0,S=v);var w=50,E={x:a.x-o/2,y:a.y-l/2},_={x:s.x-u/2,y:s.y-c/2},T={x:Math.min(E.x,_.x),y:Math.min(E.y,_.y)},N=.5,R=Math.max(N,Math.log(o*Nv)),I=Math.max(N,Math.log(u*Nv));i.ctrlpts=[T.x,T.y-(1+Math.pow(w,1.12)/100)*S*(y/3+1)*R,T.x-(1+Math.pow(w,1.12)/100)*S*(y/3+1)*I,T.y]};us.findStraightEdgePoints=function(t){t._private.rscratch.edgeType="straight"};us.findBezierPoints=function(t,e,r,n,i){var a=t._private.rscratch,s=t.pstyle("control-point-step-size").pfValue,o=t.pstyle("control-point-distances"),l=t.pstyle("control-point-weights"),u=o&&l?Math.min(o.value.length,l.value.length):1,c=o?o.pfValue[0]:void 0,f=l.value[0],p=n;a.edgeType=p?"multibezier":"bezier",a.ctrlpts=[];for(var v=0;v<u;v++){var y=(.5-e.eles.length/2+r)*s*(i?-1:1),S=void 0,w=n_(y);p&&(c=o?o.pfValue[v]:s,f=l.value[v]),n?S=c:S=c!==void 0?w*c:void 0;var E=S!==void 0?S:y,_=1-f,T=f,N=this.findMidptPtsEtc(t,e),R=N.midptPts,I=N.vectorNormInverse,F={x:R.x1*_+R.x2*T,y:R.y1*_+R.y2*T};a.ctrlpts.push(F.x+I.x*E,F.y+I.y*E)}};us.findTaxiPoints=function(t,e){var r=t._private.rscratch;r.edgeType="segments";var n="vertical",i="horizontal",a="leftward",s="rightward",o="downward",l="upward",u="auto",c=e.posPts,f=e.srcW,p=e.srcH,v=e.tgtW,y=e.tgtH,S=t.pstyle("edge-distances").value,w=S!=="node-position",E=t.pstyle("taxi-direction").value,_=E,T=t.pstyle("taxi-turn"),N=T.units==="%",R=T.pfValue,I=R<0,F=t.pstyle("taxi-turn-min-distance").pfValue,D=w?(f+v)/2:0,j=w?(p+y)/2:0,B=c.x2-c.x1,G=c.y2-c.y1,K=function(ce,me){return ce>0?Math.max(ce-me,0):Math.min(ce+me,0)},O=K(B,D),W=K(G,j),U=!1;_===u?E=Math.abs(O)>Math.abs(W)?i:n:_===l||_===o?(E=n,U=!0):(_===a||_===s)&&(E=i,U=!0);var q=E===n,Z=q?W:O,Q=q?G:B,ne=n_(Q),re=!1;!(U&&(N||I))&&(_===o&&Q<0||_===l&&Q>0||_===a&&Q>0||_===s&&Q<0)&&(ne*=-1,Z=ne*Math.abs(Z),re=!0);var Y;if(N){var J=R<0?1+R:R;Y=J*Z}else{var ie=R<0?Z:0;Y=ie+R*ne}var de=function(ce){return Math.abs(ce)<F||Math.abs(ce)>=Math.abs(Z)},he=de(Y),xe=de(Math.abs(Z)-Math.abs(Y)),le=he||xe;if(le&&!re)if(q){var fe=Math.abs(Q)<=p/2,ve=Math.abs(B)<=v/2;if(fe){var ge=(c.x1+c.x2)/2,se=c.y1,ye=c.y2;r.segpts=[ge,se,ge,ye]}else if(ve){var Se=(c.y1+c.y2)/2,Ue=c.x1,Oe=c.x2;r.segpts=[Ue,Se,Oe,Se]}else r.segpts=[c.x1,c.y2]}else{var mt=Math.abs(Q)<=f/2,lt=Math.abs(G)<=y/2;if(mt){var at=(c.y1+c.y2)/2,wt=c.x1,$e=c.x2;r.segpts=[wt,at,$e,at]}else if(lt){var Ce=(c.x1+c.x2)/2,Ie=c.y1,Je=c.y2;r.segpts=[Ce,Ie,Ce,Je]}else r.segpts=[c.x2,c.y1]}else if(q){var Qe=c.y1+Y+(w?p/2*ne:0),gt=c.x1,At=c.x2;r.segpts=[gt,Qe,At,Qe]}else{var Rt=c.x1+Y+(w?f/2*ne:0),Ut=c.y1,Vt=c.y2;r.segpts=[Rt,Ut,Rt,Vt]}if(r.isRound){var pt=t.pstyle("taxi-radius").value,dt=t.pstyle("radius-type").value[0]==="arc-radius";r.radii=new Array(r.segpts.length/2).fill(pt),r.isArcRadius=new Array(r.segpts.length/2).fill(dt)}};us.tryToCorrectInvalidPoints=function(t,e){var r=t._private.rscratch;if(r.edgeType==="bezier"){var n=e.srcPos,i=e.tgtPos,a=e.srcW,s=e.srcH,o=e.tgtW,l=e.tgtH,u=e.srcShape,c=e.tgtShape,f=e.srcCornerRadius,p=e.tgtCornerRadius,v=e.srcRs,y=e.tgtRs,S=!bt(r.startX)||!bt(r.startY),w=!bt(r.arrowStartX)||!bt(r.arrowStartY),E=!bt(r.endX)||!bt(r.endY),_=!bt(r.arrowEndX)||!bt(r.arrowEndY),T=3,N=this.getArrowWidth(t.pstyle("width").pfValue,t.pstyle("arrow-scale").value)*this.arrowShapeWidth,R=T*N,I=mh({x:r.ctrlpts[0],y:r.ctrlpts[1]},{x:r.startX,y:r.startY}),F=I<R,D=mh({x:r.ctrlpts[0],y:r.ctrlpts[1]},{x:r.endX,y:r.endY}),j=D<R,B=!1;if(S||w||F){B=!0;var G={x:r.ctrlpts[0]-n.x,y:r.ctrlpts[1]-n.y},K=Math.sqrt(G.x*G.x+G.y*G.y),O={x:G.x/K,y:G.y/K},W=Math.max(a,s),U={x:r.ctrlpts[0]+O.x*2*W,y:r.ctrlpts[1]+O.y*2*W},q=u.intersectLine(n.x,n.y,a,s,U.x,U.y,0,f,v);F?(r.ctrlpts[0]=r.ctrlpts[0]+O.x*(R-I),r.ctrlpts[1]=r.ctrlpts[1]+O.y*(R-I)):(r.ctrlpts[0]=q[0]+O.x*R,r.ctrlpts[1]=q[1]+O.y*R)}if(E||_||j){B=!0;var Z={x:r.ctrlpts[0]-i.x,y:r.ctrlpts[1]-i.y},Q=Math.sqrt(Z.x*Z.x+Z.y*Z.y),ne={x:Z.x/Q,y:Z.y/Q},re=Math.max(a,s),Y={x:r.ctrlpts[0]+ne.x*2*re,y:r.ctrlpts[1]+ne.y*2*re},J=c.intersectLine(i.x,i.y,o,l,Y.x,Y.y,0,p,y);j?(r.ctrlpts[0]=r.ctrlpts[0]+ne.x*(R-D),r.ctrlpts[1]=r.ctrlpts[1]+ne.y*(R-D)):(r.ctrlpts[0]=J[0]+ne.x*R,r.ctrlpts[1]=J[1]+ne.y*R)}B&&this.findEndpoints(t)}};us.storeAllpts=function(t){var e=t._private.rscratch;if(e.edgeType==="multibezier"||e.edgeType==="bezier"||e.edgeType==="self"||e.edgeType==="compound"){e.allpts=[],e.allpts.push(e.startX,e.startY);for(var r=0;r+1<e.ctrlpts.length;r+=2)e.allpts.push(e.ctrlpts[r],e.ctrlpts[r+1]),r+3<e.ctrlpts.length&&e.allpts.push((e.ctrlpts[r]+e.ctrlpts[r+2])/2,(e.ctrlpts[r+1]+e.ctrlpts[r+3])/2);e.allpts.push(e.endX,e.endY);var n,i;e.ctrlpts.length/2%2===0?(n=e.allpts.length/2-1,e.midX=e.allpts[n],e.midY=e.allpts[n+1]):(n=e.allpts.length/2-3,i=.5,e.midX=fa(e.allpts[n],e.allpts[n+2],e.allpts[n+4],i),e.midY=fa(e.allpts[n+1],e.allpts[n+3],e.allpts[n+5],i))}else if(e.edgeType==="straight")e.allpts=[e.startX,e.startY,e.endX,e.endY],e.midX=(e.startX+e.endX+e.arrowStartX+e.arrowEndX)/4,e.midY=(e.startY+e.endY+e.arrowStartY+e.arrowEndY)/4;else if(e.edgeType==="segments"){if(e.allpts=[],e.allpts.push(e.startX,e.startY),e.allpts.push.apply(e.allpts,e.segpts),e.allpts.push(e.endX,e.endY),e.isRound){e.roundCorners=[];for(var a=2;a+3<e.allpts.length;a+=2){var s=e.radii[a/2-1],o=e.isArcRadius[a/2-1];e.roundCorners.push(g_({x:e.allpts[a-2],y:e.allpts[a-1]},{x:e.allpts[a],y:e.allpts[a+1],radius:s},{x:e.allpts[a+2],y:e.allpts[a+3]},s,o))}}if(e.segpts.length%4===0){var l=e.segpts.length/2,u=l-2;e.midX=(e.segpts[u]+e.segpts[l])/2,e.midY=(e.segpts[u+1]+e.segpts[l+1])/2}else{var c=e.segpts.length/2-1;if(!e.isRound)e.midX=e.segpts[c],e.midY=e.segpts[c+1];else{var f={x:e.segpts[c],y:e.segpts[c+1]},p=e.roundCorners[c/2];if(p.radius===0){var v={x:e.segpts[c+2],y:e.segpts[c+3]};e.midX=f.x,e.midY=f.y,e.midVector=[f.y-v.y,v.x-f.x]}else{var y=[f.x-p.cx,f.y-p.cy],S=p.radius/Math.sqrt(Math.pow(y[0],2)+Math.pow(y[1],2));y=y.map(function(w){return w*S}),e.midX=p.cx+y[0],e.midY=p.cy+y[1],e.midVector=y}}}}};us.checkForInvalidEdgeWarning=function(t){var e=t[0]._private.rscratch;e.nodesOverlap||bt(e.startX)&&bt(e.startY)&&bt(e.endX)&&bt(e.endY)?e.loggedErr=!1:e.loggedErr||(e.loggedErr=!0,an("Edge `"+t.id()+"` has invalid endpoints and so it is impossible to draw.  Adjust your edge style (e.g. control points) accordingly or use an alternative edge type.  This is expected behaviour when the source node and the target node overlap."))};us.findEdgeControlPoints=function(t){var e=this;if(!(!t||t.length===0)){for(var r=this,n=r.cy,i=n.hasCompoundNodes(),a=new dc,s=function(j,B){return[].concat(nx(j),[B?1:0]).join("-")},o=[],l=[],u=0;u<t.length;u++){var c=t[u],f=c._private,p=c.pstyle("curve-style").value;if(!(c.removed()||!c.takesUpSpace())){if(p==="haystack"){l.push(c);continue}var v=p==="unbundled-bezier"||Ld(p,"segments")||p==="straight"||p==="straight-triangle"||Ld(p,"taxi"),y=p==="unbundled-bezier"||p==="bezier",S=f.source,w=f.target,E=S.poolIndex(),_=w.poolIndex(),T=[E,_].sort(),N=s(T,v),R=a.get(N);R==null&&(R={eles:[]},o.push({pairId:T,edgeIsUnbundled:v}),a.set(N,R)),R.eles.push(c),v&&(R.hasUnbundled=!0),y&&(R.hasBezier=!0)}}for(var I=function(){var j=o[F],B=j.pairId,G=j.edgeIsUnbundled,K=s(B,G),O=a.get(K),W;if(!O.hasUnbundled){var U=O.eles[0].parallelEdges().filter(function(dt){return dt.isBundledBezier()});t_(O.eles),U.forEach(function(dt){return O.eles.push(dt)}),O.eles.sort(function(dt,Ge){return dt.poolIndex()-Ge.poolIndex()})}var q=O.eles[0],Z=q.source(),Q=q.target();if(Z.poolIndex()>Q.poolIndex()){var ne=Z;Z=Q,Q=ne}var re=O.srcPos=Z.position(),Y=O.tgtPos=Q.position(),J=O.srcW=Z.outerWidth(),ie=O.srcH=Z.outerHeight(),de=O.tgtW=Q.outerWidth(),he=O.tgtH=Q.outerHeight(),xe=O.srcShape=r.nodeShapes[e.getNodeShape(Z)],le=O.tgtShape=r.nodeShapes[e.getNodeShape(Q)],fe=O.srcCornerRadius=Z.pstyle("corner-radius").value==="auto"?"auto":Z.pstyle("corner-radius").pfValue,ve=O.tgtCornerRadius=Q.pstyle("corner-radius").value==="auto"?"auto":Q.pstyle("corner-radius").pfValue,ge=O.tgtRs=Q._private.rscratch,se=O.srcRs=Z._private.rscratch;O.dirCounts={north:0,west:0,south:0,east:0,northwest:0,southwest:0,northeast:0,southeast:0};for(var ye=0;ye<O.eles.length;ye++){var Se=O.eles[ye],Ue=Se[0]._private.rscratch,Oe=Se.pstyle("curve-style").value,mt=Oe==="unbundled-bezier"||Ld(Oe,"segments")||Ld(Oe,"taxi"),lt=!Z.same(Se.source());if(!O.calculatedIntersection&&Z!==Q&&(O.hasBezier||O.hasUnbundled)){O.calculatedIntersection=!0;var at=xe.intersectLine(re.x,re.y,J,ie,Y.x,Y.y,0,fe,se),wt=O.srcIntn=at,$e=le.intersectLine(Y.x,Y.y,de,he,re.x,re.y,0,ve,ge),Ce=O.tgtIntn=$e,Ie=O.intersectionPts={x1:at[0],x2:$e[0],y1:at[1],y2:$e[1]},Je=O.posPts={x1:re.x,x2:Y.x,y1:re.y,y2:Y.y},Qe=$e[1]-at[1],gt=$e[0]-at[0],At=Math.sqrt(gt*gt+Qe*Qe);bt(At)&&At>=wz||(At=Math.sqrt(Math.max(gt*gt,Nv)+Math.max(Qe*Qe,Nv)));var Rt=O.vector={x:gt,y:Qe},Ut=O.vectorNorm={x:Rt.x/At,y:Rt.y/At},Vt={x:-Ut.y,y:Ut.x};O.nodesOverlap=!bt(At)||le.checkPoint(at[0],at[1],0,de,he,Y.x,Y.y,ve,ge)||xe.checkPoint($e[0],$e[1],0,J,ie,re.x,re.y,fe,se),O.vectorNormInverse=Vt,W={nodesOverlap:O.nodesOverlap,dirCounts:O.dirCounts,calculatedIntersection:!0,hasBezier:O.hasBezier,hasUnbundled:O.hasUnbundled,eles:O.eles,srcPos:Y,srcRs:ge,tgtPos:re,tgtRs:se,srcW:de,srcH:he,tgtW:J,tgtH:ie,srcIntn:Ce,tgtIntn:wt,srcShape:le,tgtShape:xe,posPts:{x1:Je.x2,y1:Je.y2,x2:Je.x1,y2:Je.y1},intersectionPts:{x1:Ie.x2,y1:Ie.y2,x2:Ie.x1,y2:Ie.y1},vector:{x:-Rt.x,y:-Rt.y},vectorNorm:{x:-Ut.x,y:-Ut.y},vectorNormInverse:{x:-Vt.x,y:-Vt.y}}}var pt=lt?W:O;Ue.nodesOverlap=pt.nodesOverlap,Ue.srcIntn=pt.srcIntn,Ue.tgtIntn=pt.tgtIntn,Ue.isRound=Oe.startsWith("round"),i&&(Z.isParent()||Z.isChild()||Q.isParent()||Q.isChild())&&(Z.parents().anySame(Q)||Q.parents().anySame(Z)||Z.same(Q)&&Z.isParent())?e.findCompoundLoopPoints(Se,pt,ye,mt):Z===Q?e.findLoopPoints(Se,pt,ye,mt):Oe.endsWith("segments")?e.findSegmentsPoints(Se,pt):Oe.endsWith("taxi")?e.findTaxiPoints(Se,pt):Oe==="straight"||!mt&&O.eles.length%2===1&&ye===Math.floor(O.eles.length/2)?e.findStraightEdgePoints(Se):e.findBezierPoints(Se,pt,ye,mt,lt),e.findEndpoints(Se),e.tryToCorrectInvalidPoints(Se,pt),e.checkForInvalidEdgeWarning(Se),e.storeAllpts(Se),e.storeEdgeProjections(Se),e.calculateArrowAngles(Se),e.recalculateEdgeLabelProjections(Se),e.calculateLabelAngles(Se)}},F=0;F<o.length;F++)I();this.findHaystackPoints(l)}};function HA(t){var e=[];if(t!=null){for(var r=0;r<t.length;r+=2){var n=t[r],i=t[r+1];e.push({x:n,y:i})}return e}}us.getSegmentPoints=function(t){var e=t[0]._private.rscratch;this.recalculateRenderedStyle(t);var r=e.edgeType;if(r==="segments")return HA(e.segpts)};us.getControlPoints=function(t){var e=t[0]._private.rscratch;this.recalculateRenderedStyle(t);var r=e.edgeType;if(r==="bezier"||r==="multibezier"||r==="self"||r==="compound")return HA(e.ctrlpts)};us.getEdgeMidpoint=function(t){var e=t[0]._private.rscratch;return this.recalculateRenderedStyle(t),{x:e.midX,y:e.midY}};var r0={};r0.manualEndptToPx=function(t,e){var r=this,n=t.position(),i=t.outerWidth(),a=t.outerHeight(),s=t._private.rscratch;if(e.value.length===2){var o=[e.pfValue[0],e.pfValue[1]];return e.units[0]==="%"&&(o[0]=o[0]*i),e.units[1]==="%"&&(o[1]=o[1]*a),o[0]+=n.x,o[1]+=n.y,o}else{var l=e.pfValue[0];l=-Math.PI/2+l;var u=2*Math.max(i,a),c=[n.x+Math.cos(l)*u,n.y+Math.sin(l)*u];return r.nodeShapes[this.getNodeShape(t)].intersectLine(n.x,n.y,i,a,c[0],c[1],0,t.pstyle("corner-radius").value==="auto"?"auto":t.pstyle("corner-radius").pfValue,s)}};r0.findEndpoints=function(t){var e,r,n,i,a=this,s,o=t.source()[0],l=t.target()[0],u=o.position(),c=l.position(),f=t.pstyle("target-arrow-shape").value,p=t.pstyle("source-arrow-shape").value,v=t.pstyle("target-distance-from-node").pfValue,y=t.pstyle("source-distance-from-node").pfValue,S=o._private.rscratch,w=l._private.rscratch,E=t.pstyle("curve-style").value,_=t._private.rscratch,T=_.edgeType,N=Ld(E,"taxi"),R=T==="self"||T==="compound",I=T==="bezier"||T==="multibezier"||R,F=T!=="bezier",D=T==="straight"||T==="segments",j=T==="segments",B=I||F||D,G=R||N,K=t.pstyle("source-endpoint"),O=G?"outside-to-node":K.value,W=o.pstyle("corner-radius").value==="auto"?"auto":o.pstyle("corner-radius").pfValue,U=t.pstyle("target-endpoint"),q=G?"outside-to-node":U.value,Z=l.pstyle("corner-radius").value==="auto"?"auto":l.pstyle("corner-radius").pfValue;_.srcManEndpt=K,_.tgtManEndpt=U;var Q,ne,re,Y,J=(e=(U==null||(r=U.pfValue)===null||r===void 0?void 0:r.length)===2?U.pfValue:null)!==null&&e!==void 0?e:[0,0],ie=(n=(K==null||(i=K.pfValue)===null||i===void 0?void 0:i.length)===2?K.pfValue:null)!==null&&n!==void 0?n:[0,0];if(I){var de=[_.ctrlpts[0],_.ctrlpts[1]],he=F?[_.ctrlpts[_.ctrlpts.length-2],_.ctrlpts[_.ctrlpts.length-1]]:de;Q=he,ne=de}else if(D){var xe=j?_.segpts.slice(0,2):[c.x+J[0],c.y+J[1]],le=j?_.segpts.slice(_.segpts.length-2):[u.x+ie[0],u.y+ie[1]];Q=le,ne=xe}if(q==="inside-to-node")s=[c.x,c.y];else if(U.units)s=this.manualEndptToPx(l,U);else if(q==="outside-to-line")s=_.tgtIntn;else if(q==="outside-to-node"||q==="outside-to-node-or-label"?re=Q:(q==="outside-to-line"||q==="outside-to-line-or-label")&&(re=[u.x,u.y]),s=a.nodeShapes[this.getNodeShape(l)].intersectLine(c.x,c.y,l.outerWidth(),l.outerHeight(),re[0],re[1],0,Z,w),q==="outside-to-node-or-label"||q==="outside-to-line-or-label"){var fe=l._private.rscratch,ve=fe.labelWidth,ge=fe.labelHeight,se=fe.labelX,ye=fe.labelY,Se=ve/2,Ue=ge/2,Oe=l.pstyle("text-valign").value;Oe==="top"?ye-=Ue:Oe==="bottom"&&(ye+=Ue);var mt=l.pstyle("text-halign").value;mt==="left"?se-=Se:mt==="right"&&(se+=Se);var lt=kv(re[0],re[1],[se-Se,ye-Ue,se+Se,ye-Ue,se+Se,ye+Ue,se-Se,ye+Ue],c.x,c.y);if(lt.length>0){var at=u,wt=Kf(at,Rp(s)),$e=Kf(at,Rp(lt)),Ce=wt;if($e<wt&&(s=lt,Ce=$e),lt.length>2){var Ie=Kf(at,{x:lt[2],y:lt[3]});Ie<Ce&&(s=[lt[2],lt[3]])}}}var Je=Q0(s,Q,a.arrowShapes[f].spacing(t)+v),Qe=Q0(s,Q,a.arrowShapes[f].gap(t)+v);if(_.endX=Qe[0],_.endY=Qe[1],_.arrowEndX=Je[0],_.arrowEndY=Je[1],O==="inside-to-node")s=[u.x,u.y];else if(K.units)s=this.manualEndptToPx(o,K);else if(O==="outside-to-line")s=_.srcIntn;else if(O==="outside-to-node"||O==="outside-to-node-or-label"?Y=ne:(O==="outside-to-line"||O==="outside-to-line-or-label")&&(Y=[c.x,c.y]),s=a.nodeShapes[this.getNodeShape(o)].intersectLine(u.x,u.y,o.outerWidth(),o.outerHeight(),Y[0],Y[1],0,W,S),O==="outside-to-node-or-label"||O==="outside-to-line-or-label"){var gt=o._private.rscratch,At=gt.labelWidth,Rt=gt.labelHeight,Ut=gt.labelX,Vt=gt.labelY,pt=At/2,dt=Rt/2,Ge=o.pstyle("text-valign").value;Ge==="top"?Vt-=dt:Ge==="bottom"&&(Vt+=dt);var ce=o.pstyle("text-halign").value;ce==="left"?Ut-=pt:ce==="right"&&(Ut+=pt);var me=kv(Y[0],Y[1],[Ut-pt,Vt-dt,Ut+pt,Vt-dt,Ut+pt,Vt+dt,Ut-pt,Vt+dt],u.x,u.y);if(me.length>0){var ke=c,Te=Kf(ke,Rp(s)),Ae=Kf(ke,Rp(me)),Xe=Te;if(Ae<Te&&(s=[me[0],me[1]],Xe=Ae),me.length>2){var Ve=Kf(ke,{x:me[2],y:me[3]});Ve<Xe&&(s=[me[2],me[3]])}}}var yt=Q0(s,ne,a.arrowShapes[p].spacing(t)+y),vt=Q0(s,ne,a.arrowShapes[p].gap(t)+y);_.startX=vt[0],_.startY=vt[1],_.arrowStartX=yt[0],_.arrowStartY=yt[1],B&&(!bt(_.startX)||!bt(_.startY)||!bt(_.endX)||!bt(_.endY)?_.badLine=!0:_.badLine=!1)};r0.getSourceEndpoint=function(t){var e=t[0]._private.rscratch;return this.recalculateRenderedStyle(t),e.edgeType==="haystack"?{x:e.haystackPts[0],y:e.haystackPts[1]}:{x:e.arrowStartX,y:e.arrowStartY}};r0.getTargetEndpoint=function(t){var e=t[0]._private.rscratch;return this.recalculateRenderedStyle(t),e.edgeType==="haystack"?{x:e.haystackPts[2],y:e.haystackPts[3]}:{x:e.arrowEndX,y:e.arrowEndY}};var v_={};function Sz(t,e,r){for(var n=function(u,c,f,p){return fa(u,c,f,p)},i=e._private,a=i.rstyle.bezierPts,s=0;s<t.bezierProjPcts.length;s++){var o=t.bezierProjPcts[s];a.push({x:n(r[0],r[2],r[4],o),y:n(r[1],r[3],r[5],o)})}}v_.storeEdgeProjections=function(t){var e=t._private,r=e.rscratch,n=r.edgeType;if(e.rstyle.bezierPts=null,e.rstyle.linePts=null,e.rstyle.haystackPts=null,n==="multibezier"||n==="bezier"||n==="self"||n==="compound"){e.rstyle.bezierPts=[];for(var i=0;i+5<r.allpts.length;i+=4)Sz(this,t,r.allpts.slice(i,i+6))}else if(n==="segments")for(var a=e.rstyle.linePts=[],i=0;i+1<r.allpts.length;i+=2)a.push({x:r.allpts[i],y:r.allpts[i+1]});else if(n==="haystack"){var s=r.haystackPts;e.rstyle.haystackPts=[{x:s[0],y:s[1]},{x:s[2],y:s[3]}]}e.rstyle.arrowWidth=this.getArrowWidth(t.pstyle("width").pfValue,t.pstyle("arrow-scale").value)*this.arrowShapeWidth};v_.recalculateEdgeProjections=function(t){this.findEdgeControlPoints(t)};var Au={};Au.recalculateNodeLabelProjection=function(t){var e=t.pstyle("label").strValue;if(!Zd(e)){var r,n,i=t._private,a=t.width(),s=t.height(),o=t.padding(),l=t.position(),u=t.pstyle("text-halign").strValue,c=t.pstyle("text-valign").strValue,f=i.rscratch,p=i.rstyle;switch(u){case"left":r=l.x-a/2-o;break;case"right":r=l.x+a/2+o;break;default:r=l.x}switch(c){case"top":n=l.y-s/2-o;break;case"bottom":n=l.y+s/2+o;break;default:n=l.y}f.labelX=r,f.labelY=n,p.labelX=r,p.labelY=n,this.calculateLabelAngles(t),this.applyLabelDimensions(t)}};var WA=function(e,r){var n=Math.atan(r/e);return e===0&&n<0&&(n=n*-1),n},qA=function(e,r){var n=r.x-e.x,i=r.y-e.y;return WA(n,i)},kz=function(e,r,n,i){var a=Sv(0,i-.001,1),s=Sv(0,i+.001,1),o=jp(e,r,n,a),l=jp(e,r,n,s);return qA(o,l)};Au.recalculateEdgeLabelProjections=function(t){var e,r=t._private,n=r.rscratch,i=this,a={mid:t.pstyle("label").strValue,source:t.pstyle("source-label").strValue,target:t.pstyle("target-label").strValue};if(a.mid||a.source||a.target){e={x:n.midX,y:n.midY};var s=function(f,p,v){cc(r.rscratch,f,p,v),cc(r.rstyle,f,p,v)};s("labelX",null,e.x),s("labelY",null,e.y);var o=WA(n.midDispX,n.midDispY);s("labelAutoAngle",null,o);var l=function(){if(l.cache)return l.cache;for(var f=[],p=0;p+5<n.allpts.length;p+=4){var v={x:n.allpts[p],y:n.allpts[p+1]},y={x:n.allpts[p+2],y:n.allpts[p+3]},S={x:n.allpts[p+4],y:n.allpts[p+5]};f.push({p0:v,p1:y,p2:S,startDist:0,length:0,segments:[]})}var w=r.rstyle.bezierPts,E=i.bezierProjPcts.length;function _(F,D,j,B,G){var K=mh(D,j),O=F.segments[F.segments.length-1],W={p0:D,p1:j,t0:B,t1:G,startDist:O?O.startDist+O.length:0,length:K};F.segments.push(W),F.length+=K}for(var T=0;T<f.length;T++){var N=f[T],R=f[T-1];R&&(N.startDist=R.startDist+R.length),_(N,N.p0,w[T*E],0,i.bezierProjPcts[0]);for(var I=0;I<E-1;I++)_(N,w[T*E+I],w[T*E+I+1],i.bezierProjPcts[I],i.bezierProjPcts[I+1]);_(N,w[T*E+E-1],N.p2,i.bezierProjPcts[E-1],1)}return l.cache=f},u=function(f){var p,v=f==="source";if(a[f]){var y=t.pstyle(f+"-text-offset").pfValue;switch(n.edgeType){case"self":case"compound":case"bezier":case"multibezier":{for(var S=l(),w,E=0,_=0,T=0;T<S.length;T++){for(var N=S[v?T:S.length-1-T],R=0;R<N.segments.length;R++){var I=N.segments[v?R:N.segments.length-1-R],F=T===S.length-1&&R===N.segments.length-1;if(E=_,_+=I.length,_>=y||F){w={cp:N,segment:I};break}}if(w)break}var D=w.cp,j=w.segment,B=(y-E)/j.length,G=j.t1-j.t0,K=v?j.t0+G*B:j.t1-G*B;K=Sv(0,K,1),e=jp(D.p0,D.p1,D.p2,K),p=kz(D.p0,D.p1,D.p2,K);break}case"straight":case"segments":case"haystack":{for(var O=0,W,U,q,Z,Q=n.allpts.length,ne=0;ne+3<Q&&(v?(q={x:n.allpts[ne],y:n.allpts[ne+1]},Z={x:n.allpts[ne+2],y:n.allpts[ne+3]}):(q={x:n.allpts[Q-2-ne],y:n.allpts[Q-1-ne]},Z={x:n.allpts[Q-4-ne],y:n.allpts[Q-3-ne]}),W=mh(q,Z),U=O,O+=W,!(O>=y));ne+=2);var re=y-U,Y=re/W;Y=Sv(0,Y,1),e=W9(q,Z,Y),p=qA(q,Z);break}}s("labelX",f,e.x),s("labelY",f,e.y),s("labelAutoAngle",f,p)}};u("source"),u("target"),this.applyLabelDimensions(t)}};Au.applyLabelDimensions=function(t){this.applyPrefixedLabelDimensions(t),t.isEdge()&&(this.applyPrefixedLabelDimensions(t,"source"),this.applyPrefixedLabelDimensions(t,"target"))};Au.applyPrefixedLabelDimensions=function(t,e){var r=t._private,n=this.getLabelText(t,e),i=ph(n,t._private.labelDimsKey);if($s(r.rscratch,"prefixedLabelDimsKey",e)!==i){cc(r.rscratch,"prefixedLabelDimsKey",e,i);var a=this.calculateLabelDimensions(t,n),s=t.pstyle("line-height").pfValue,o=t.pstyle("text-wrap").strValue,l=$s(r.rscratch,"labelWrapCachedLines",e)||[],u=o!=="wrap"?1:Math.max(l.length,1),c=a.height/u,f=c*s,p=a.width,v=a.height+(u-1)*(s-1)*c;cc(r.rstyle,"labelWidth",e,p),cc(r.rscratch,"labelWidth",e,p),cc(r.rstyle,"labelHeight",e,v),cc(r.rscratch,"labelHeight",e,v),cc(r.rscratch,"labelLineHeight",e,f)}};Au.getLabelText=function(t,e){var r=t._private,n=e?e+"-":"",i=t.pstyle(n+"label").strValue,a=t.pstyle("text-transform").value,s=function(ie,de){return de?(cc(r.rscratch,ie,e,de),de):$s(r.rscratch,ie,e)};if(!i)return"";a=="none"||(a=="uppercase"?i=i.toUpperCase():a=="lowercase"&&(i=i.toLowerCase()));var o=t.pstyle("text-wrap").value;if(o==="wrap"){var l=s("labelKey");if(l!=null&&s("labelWrapKey")===l)return s("labelWrapCachedText");for(var u="",c=i.split(`
`),f=t.pstyle("text-max-width").pfValue,p=t.pstyle("text-overflow-wrap").value,v=p==="anywhere",y=[],S=/[\s\u200b]+|$/g,w=0;w<c.length;w++){var E=c[w],_=this.calculateLabelDimensions(t,E),T=_.width;if(v){var N=E.split("").join(u);E=N}if(T>f){var R=E.matchAll(S),I="",F=0,D=Ys(R),j;try{for(D.s();!(j=D.n()).done;){var B=j.value,G=B[0],K=E.substring(F,B.index);F=B.index+G.length;var O=I.length===0?K:I+K+G,W=this.calculateLabelDimensions(t,O),U=W.width;U<=f?I+=K+G:(I&&y.push(I),I=K+G)}}catch(J){D.e(J)}finally{D.f()}I.match(/^[\s\u200b]+$/)||y.push(I)}else y.push(E)}s("labelWrapCachedLines",y),i=s("labelWrapCachedText",y.join(`
`)),s("labelWrapKey",l)}else if(o==="ellipsis"){var q=t.pstyle("text-max-width").pfValue,Z="",Q="",ne=!1;if(this.calculateLabelDimensions(t,i).width<q)return i;for(var re=0;re<i.length;re++){var Y=this.calculateLabelDimensions(t,Z+i[re]+Q).width;if(Y>q)break;Z+=i[re],re===i.length-1&&(ne=!0)}return ne||(Z+=Q),Z}return i};Au.getLabelJustification=function(t){var e=t.pstyle("text-justification").strValue,r=t.pstyle("text-halign").strValue;if(e==="auto")if(t.isNode())switch(r){case"left":return"right";case"right":return"left";default:return"center"}else return"center";else return e};Au.calculateLabelDimensions=function(t,e){var r=this,n=r.cy.window(),i=n.document,a=0,s=t.pstyle("font-style").strValue,o=t.pstyle("font-size").pfValue,l=t.pstyle("font-family").strValue,u=t.pstyle("font-weight").strValue,c=this.labelCalcCanvas,f=this.labelCalcCanvasContext;if(!c){c=this.labelCalcCanvas=i.createElement("canvas"),f=this.labelCalcCanvasContext=c.getContext("2d");var p=c.style;p.position="absolute",p.left="-9999px",p.top="-9999px",p.zIndex="-1",p.visibility="hidden",p.pointerEvents="none"}f.font="".concat(s," ").concat(u," ").concat(o,"px ").concat(l);for(var v=0,y=0,S=e.split(`
`),w=0;w<S.length;w++){var E=S[w],_=f.measureText(E),T=Math.ceil(_.width),N=o;v=Math.max(T,v),y+=N}return v+=a,y+=a,{width:v,height:y}};Au.calculateLabelAngle=function(t,e){var r=t._private,n=r.rscratch,i=t.isEdge(),a=e?e+"-":"",s=t.pstyle(a+"text-rotation"),o=s.strValue;return o==="none"?0:i&&o==="autorotate"?n.labelAutoAngle:o==="autorotate"?0:s.pfValue};Au.calculateLabelAngles=function(t){var e=this,r=t.isEdge(),n=t._private,i=n.rscratch;i.labelAngle=e.calculateLabelAngle(t),r&&(i.sourceLabelAngle=e.calculateLabelAngle(t,"source"),i.targetLabelAngle=e.calculateLabelAngle(t,"target"))};var $A={},IN=28,jN=!1;$A.getNodeShape=function(t){var e=this,r=t.pstyle("shape").value;if(r==="cutrectangle"&&(t.width()<IN||t.height()<IN))return jN||(an("The `cutrectangle` node shape can not be used at small sizes so `rectangle` is used instead"),jN=!0),"rectangle";if(t.isParent())return r==="rectangle"||r==="roundrectangle"||r==="round-rectangle"||r==="cutrectangle"||r==="cut-rectangle"||r==="barrel"?r:"rectangle";if(r==="polygon"){var n=t.pstyle("shape-polygon-points").value;return e.nodeShapes.makePolygon(n).name}return r};var j1={};j1.registerCalculationListeners=function(){var t=this.cy,e=t.collection(),r=this,n=function(s){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(e.merge(s),o)for(var l=0;l<s.length;l++){var u=s[l],c=u._private,f=c.rstyle;f.clean=!1,f.cleanConnected=!1}};r.binder(t).on("bounds.* dirty.*",function(s){var o=s.target;n(o)}).on("style.* background.*",function(s){var o=s.target;n(o,!1)});var i=function(s){if(s){var o=r.onUpdateEleCalcsFns;e.cleanStyle();for(var l=0;l<e.length;l++){var u=e[l],c=u._private.rstyle;u.isNode()&&!c.cleanConnected&&(n(u.connectedEdges()),c.cleanConnected=!0)}if(o)for(var f=0;f<o.length;f++){var p=o[f];p(s,e)}r.recalculateRenderedStyle(e),e=t.collection()}};r.flushRenderedStyleQueue=function(){i(!0)},r.beforeRender(i,r.beforeRenderPriorities.eleCalcs)};j1.onUpdateEleCalcs=function(t){var e=this.onUpdateEleCalcsFns=this.onUpdateEleCalcsFns||[];e.push(t)};j1.recalculateRenderedStyle=function(t,e){var r=function(N){return N._private.rstyle.cleanConnected};if(t.length!==0){var n=[],i=[];if(!this.destroyed){e===void 0&&(e=!0);for(var a=0;a<t.length;a++){var s=t[a],o=s._private,l=o.rstyle;s.isEdge()&&(!r(s.source())||!r(s.target()))&&(l.clean=!1),s.isEdge()&&s.isBundledBezier()&&s.parallelEdges().some(function(T){return!T._private.rstyle.clean&&T.isBundledBezier()})&&(l.clean=!1),!(e&&l.clean||s.removed())&&s.pstyle("display").value!=="none"&&(o.group==="nodes"?i.push(s):n.push(s),l.clean=!0)}for(var u=0;u<i.length;u++){var c=i[u],f=c._private,p=f.rstyle,v=c.position();this.recalculateNodeLabelProjection(c),p.nodeX=v.x,p.nodeY=v.y,p.nodeW=c.pstyle("width").pfValue,p.nodeH=c.pstyle("height").pfValue}this.recalculateEdgeProjections(n);for(var y=0;y<n.length;y++){var S=n[y],w=S._private,E=w.rstyle,_=w.rscratch;E.srcX=_.arrowStartX,E.srcY=_.arrowStartY,E.tgtX=_.arrowEndX,E.tgtY=_.arrowEndY,E.midX=_.midX,E.midY=_.midY,E.labelAngle=_.labelAngle,E.sourceLabelAngle=_.sourceLabelAngle,E.targetLabelAngle=_.targetLabelAngle}}}};var F1={};F1.updateCachedGrabbedEles=function(){var t=this.cachedZSortedEles;if(t){t.drag=[],t.nondrag=[];for(var e=[],r=0;r<t.length;r++){var n=t[r],i=n._private.rscratch;n.grabbed()&&!n.isParent()?e.push(n):i.inDragLayer?t.drag.push(n):t.nondrag.push(n)}for(var r=0;r<e.length;r++){var n=e[r];t.drag.push(n)}}};F1.invalidateCachedZSortedEles=function(){this.cachedZSortedEles=null};F1.getCachedZSortedEles=function(t){if(t||!this.cachedZSortedEles){var e=this.cy.mutableElements().toArray();e.sort(NA),e.interactive=e.filter(function(r){return r.interactive()}),this.cachedZSortedEles=e,this.updateCachedGrabbedEles()}else e=this.cachedZSortedEles;return e};var KA={};[Ph,hx,us,r0,v_,Au,$A,j1,F1].forEach(function(t){ir(KA,t)});var ZA={};ZA.getCachedImage=function(t,e,r){var n=this,i=n.imageCache=n.imageCache||{},a=i[t];if(a)return a.image.complete||a.image.addEventListener("load",r),a.image;a=i[t]=i[t]||{};var s=a.image=new Image;s.addEventListener("load",r),s.addEventListener("error",function(){s.error=!0});var o="data:",l=t.substring(0,o.length).toLowerCase()===o;return l||(e=e==="null"?null:e,s.crossOrigin=e),s.src=t,s};var hm={};hm.registerBinding=function(t,e,r,n){var i=Array.prototype.slice.apply(arguments,[1]);if(Array.isArray(t)){for(var a=[],s=0;s<t.length;s++){var o=t[s];if(o!==void 0){var l=this.binder(o);a.push(l.on.apply(l,i))}}return a}var l=this.binder(t);return l.on.apply(l,i)};hm.binder=function(t){var e=this,r=e.cy.window(),n=t===r||t===r.document||t===r.document.body||Dj(t);if(e.supportsPassiveEvents==null){var i=!1;try{var a=Object.defineProperty({},"passive",{get:function(){return i=!0,!0}});r.addEventListener("test",null,a)}catch{}e.supportsPassiveEvents=i}var s=function(l,u,c){var f=Array.prototype.slice.call(arguments);return n&&e.supportsPassiveEvents&&(f[2]={capture:c??!1,passive:!1,once:!1}),e.bindings.push({target:t,args:f}),(t.addEventListener||t.on).apply(t,f),this};return{on:s,addEventListener:s,addListener:s,bind:s}};hm.nodeIsDraggable=function(t){return t&&t.isNode()&&!t.locked()&&t.grabbable()};hm.nodeIsGrabbable=function(t){return this.nodeIsDraggable(t)&&t.interactive()};hm.load=function(){var t=this,e=t.cy.window(),r=function(ce){return ce.selected()},n=function(ce){var me=ce.getRootNode();if(me&&me.nodeType===11&&me.host!==void 0)return me},i=function(ce,me,ke,Te){ce==null&&(ce=t.cy);for(var Ae=0;Ae<me.length;Ae++){var Xe=me[Ae];ce.emit({originalEvent:ke,type:Xe,position:Te})}},a=function(ce){return ce.shiftKey||ce.metaKey||ce.ctrlKey},s=function(ce,me){var ke=!0;if(t.cy.hasCompoundNodes()&&ce&&ce.pannable())for(var Te=0;me&&Te<me.length;Te++){var ce=me[Te];if(ce.isNode()&&ce.isParent()&&!ce.pannable()){ke=!1;break}}else ke=!0;return ke},o=function(ce){ce[0]._private.grabbed=!0},l=function(ce){ce[0]._private.grabbed=!1},u=function(ce){ce[0]._private.rscratch.inDragLayer=!0},c=function(ce){ce[0]._private.rscratch.inDragLayer=!1},f=function(ce){ce[0]._private.rscratch.isGrabTarget=!0},p=function(ce){ce[0]._private.rscratch.isGrabTarget=!1},v=function(ce,me){var ke=me.addToList,Te=ke.has(ce);!Te&&ce.grabbable()&&!ce.locked()&&(ke.merge(ce),o(ce))},y=function(ce,me){if(ce.cy().hasCompoundNodes()&&!(me.inDragLayer==null&&me.addToList==null)){var ke=ce.descendants();me.inDragLayer&&(ke.forEach(u),ke.connectedEdges().forEach(u)),me.addToList&&v(ke,me)}},S=function(ce,me){me=me||{};var ke=ce.cy().hasCompoundNodes();me.inDragLayer&&(ce.forEach(u),ce.neighborhood().stdFilter(function(Te){return!ke||Te.isEdge()}).forEach(u)),me.addToList&&ce.forEach(function(Te){v(Te,me)}),y(ce,me),_(ce,{inDragLayer:me.inDragLayer}),t.updateCachedGrabbedEles()},w=S,E=function(ce){ce&&(t.getCachedZSortedEles().forEach(function(me){l(me),c(me),p(me)}),t.updateCachedGrabbedEles())},_=function(ce,me){if(!(me.inDragLayer==null&&me.addToList==null)&&ce.cy().hasCompoundNodes()){var ke=ce.ancestors().orphans();if(!ke.same(ce)){var Te=ke.descendants().spawnSelf().merge(ke).unmerge(ce).unmerge(ce.descendants()),Ae=Te.connectedEdges();me.inDragLayer&&(Ae.forEach(u),Te.forEach(u)),me.addToList&&Te.forEach(function(Xe){v(Xe,me)})}}},T=function(){document.activeElement!=null&&document.activeElement.blur!=null&&document.activeElement.blur()},N=typeof MutationObserver<"u",R=typeof ResizeObserver<"u";N?(t.removeObserver=new MutationObserver(function(Ge){for(var ce=0;ce<Ge.length;ce++){var me=Ge[ce],ke=me.removedNodes;if(ke)for(var Te=0;Te<ke.length;Te++){var Ae=ke[Te];if(Ae===t.container){t.destroy();break}}}}),t.container.parentNode&&t.removeObserver.observe(t.container.parentNode,{childList:!0})):t.registerBinding(t.container,"DOMNodeRemoved",function(Ge){t.destroy()});var I=Qv(function(){t.cy.resize()},100);N&&(t.styleObserver=new MutationObserver(I),t.styleObserver.observe(t.container,{attributes:!0})),t.registerBinding(e,"resize",I),R&&(t.resizeObserver=new ResizeObserver(I),t.resizeObserver.observe(t.container));var F=function(ce,me){for(;ce!=null;)me(ce),ce=ce.parentNode},D=function(){t.invalidateContainerClientCoordsCache()};F(t.container,function(Ge){t.registerBinding(Ge,"transitionend",D),t.registerBinding(Ge,"animationend",D),t.registerBinding(Ge,"scroll",D)}),t.registerBinding(t.container,"contextmenu",function(Ge){Ge.preventDefault()});var j=function(){return t.selection[4]!==0},B=function(ce){for(var me=t.findContainerClientCoords(),ke=me[0],Te=me[1],Ae=me[2],Xe=me[3],Ve=ce.touches?ce.touches:[ce],yt=!1,vt=0;vt<Ve.length;vt++){var ft=Ve[vt];if(ke<=ft.clientX&&ft.clientX<=ke+Ae&&Te<=ft.clientY&&ft.clientY<=Te+Xe){yt=!0;break}}if(!yt)return!1;for(var Zt=t.container,Ht=ce.target,Et=Ht.parentNode,Wt=!1;Et;){if(Et===Zt){Wt=!0;break}Et=Et.parentNode}return!!Wt};t.registerBinding(t.container,"mousedown",function(ce){if(B(ce)&&!(t.hoverData.which===1&&ce.which!==1)){ce.preventDefault(),T(),t.hoverData.capture=!0,t.hoverData.which=ce.which;var me=t.cy,ke=[ce.clientX,ce.clientY],Te=t.projectIntoViewport(ke[0],ke[1]),Ae=t.selection,Xe=t.findNearestElements(Te[0],Te[1],!0,!1),Ve=Xe[0],yt=t.dragData.possibleDragElements;t.hoverData.mdownPos=Te,t.hoverData.mdownGPos=ke;var vt=function(ar){return{originalEvent:ce,type:ar,position:{x:Te[0],y:Te[1]}}},ft=function(){t.hoverData.tapholdCancelled=!1,clearTimeout(t.hoverData.tapholdTimeout),t.hoverData.tapholdTimeout=setTimeout(function(){if(!t.hoverData.tapholdCancelled){var ar=t.hoverData.down;ar?ar.emit(vt("taphold")):me.emit(vt("taphold"))}},t.tapholdDuration)};if(ce.which==3){t.hoverData.cxtStarted=!0;var Zt={originalEvent:ce,type:"cxttapstart",position:{x:Te[0],y:Te[1]}};Ve?(Ve.activate(),Ve.emit(Zt),t.hoverData.down=Ve):me.emit(Zt),t.hoverData.downTime=new Date().getTime(),t.hoverData.cxtDragged=!1}else if(ce.which==1){Ve&&Ve.activate();{if(Ve!=null&&t.nodeIsGrabbable(Ve)){var Ht=function(ar){ar.emit(vt("grab"))};if(f(Ve),!Ve.selected())yt=t.dragData.possibleDragElements=me.collection(),w(Ve,{addToList:yt}),Ve.emit(vt("grabon")).emit(vt("grab"));else{yt=t.dragData.possibleDragElements=me.collection();var Et=me.$(function(Wt){return Wt.isNode()&&Wt.selected()&&t.nodeIsGrabbable(Wt)});S(Et,{addToList:yt}),Ve.emit(vt("grabon")),Et.forEach(Ht)}t.redrawHint("eles",!0),t.redrawHint("drag",!0)}t.hoverData.down=Ve,t.hoverData.downs=Xe,t.hoverData.downTime=new Date().getTime()}i(Ve,["mousedown","tapstart","vmousedown"],ce,{x:Te[0],y:Te[1]}),Ve==null?(Ae[4]=1,t.data.bgActivePosistion={x:Te[0],y:Te[1]},t.redrawHint("select",!0),t.redraw()):Ve.pannable()&&(Ae[4]=1),ft()}Ae[0]=Ae[2]=Te[0],Ae[1]=Ae[3]=Te[1]}},!1);var G=n(t.container);t.registerBinding([e,G],"mousemove",function(ce){var me=t.hoverData.capture;if(!(!me&&!B(ce))){var ke=!1,Te=t.cy,Ae=Te.zoom(),Xe=[ce.clientX,ce.clientY],Ve=t.projectIntoViewport(Xe[0],Xe[1]),yt=t.hoverData.mdownPos,vt=t.hoverData.mdownGPos,ft=t.selection,Zt=null;!t.hoverData.draggingEles&&!t.hoverData.dragging&&!t.hoverData.selecting&&(Zt=t.findNearestElement(Ve[0],Ve[1],!0,!1));var Ht=t.hoverData.last,Et=t.hoverData.down,Wt=[Ve[0]-ft[2],Ve[1]-ft[3]],ar=t.dragData.possibleDragElements,Rr;if(vt){var kr=Xe[0]-vt[0],Qr=kr*kr,Jr=Xe[1]-vt[1],_r=Jr*Jr,fn=Qr+_r;t.hoverData.isOverThresholdDrag=Rr=fn>=t.desktopTapThreshold2}var vr=a(ce);Rr&&(t.hoverData.tapholdCancelled=!0);var St=function(){var gi=t.hoverData.dragDelta=t.hoverData.dragDelta||[];gi.length===0?(gi.push(Wt[0]),gi.push(Wt[1])):(gi[0]+=Wt[0],gi[1]+=Wt[1])};ke=!0,i(Zt,["mousemove","vmousemove","tapdrag"],ce,{x:Ve[0],y:Ve[1]});var Br=function(gi){return{originalEvent:ce,type:gi,position:{x:Ve[0],y:Ve[1]}}},Xn=function(){t.data.bgActivePosistion=void 0,t.hoverData.selecting||Te.emit(Br("boxstart")),ft[4]=1,t.hoverData.selecting=!0,t.redrawHint("select",!0),t.redraw()};if(t.hoverData.which===3){if(Rr){var Yi=Br("cxtdrag");Et?Et.emit(Yi):Te.emit(Yi),t.hoverData.cxtDragged=!0,(!t.hoverData.cxtOver||Zt!==t.hoverData.cxtOver)&&(t.hoverData.cxtOver&&t.hoverData.cxtOver.emit(Br("cxtdragout")),t.hoverData.cxtOver=Zt,Zt&&Zt.emit(Br("cxtdragover")))}}else if(t.hoverData.dragging){if(ke=!0,Te.panningEnabled()&&Te.userPanningEnabled()){var ds;if(t.hoverData.justStartedPan){var As=t.hoverData.mdownPos;ds={x:(Ve[0]-As[0])*Ae,y:(Ve[1]-As[1])*Ae},t.hoverData.justStartedPan=!1}else ds={x:Wt[0]*Ae,y:Wt[1]*Ae};Te.panBy(ds),Te.emit(Br("dragpan")),t.hoverData.dragged=!0}Ve=t.projectIntoViewport(ce.clientX,ce.clientY)}else if(ft[4]==1&&(Et==null||Et.pannable())){if(Rr){if(!t.hoverData.dragging&&Te.boxSelectionEnabled()&&(vr||!Te.panningEnabled()||!Te.userPanningEnabled()))Xn();else if(!t.hoverData.selecting&&Te.panningEnabled()&&Te.userPanningEnabled()){var ni=s(Et,t.hoverData.downs);ni&&(t.hoverData.dragging=!0,t.hoverData.justStartedPan=!0,ft[4]=0,t.data.bgActivePosistion=Rp(yt),t.redrawHint("select",!0),t.redraw())}Et&&Et.pannable()&&Et.active()&&Et.unactivate()}}else{if(Et&&Et.pannable()&&Et.active()&&Et.unactivate(),(!Et||!Et.grabbed())&&Zt!=Ht&&(Ht&&i(Ht,["mouseout","tapdragout"],ce,{x:Ve[0],y:Ve[1]}),Zt&&i(Zt,["mouseover","tapdragover"],ce,{x:Ve[0],y:Ve[1]}),t.hoverData.last=Zt),Et)if(Rr){if(Te.boxSelectionEnabled()&&vr)Et&&Et.grabbed()&&(E(ar),Et.emit(Br("freeon")),ar.emit(Br("free")),t.dragData.didDrag&&(Et.emit(Br("dragfreeon")),ar.emit(Br("dragfree")))),Xn();else if(Et&&Et.grabbed()&&t.nodeIsDraggable(Et)){var sn=!t.dragData.didDrag;sn&&t.redrawHint("eles",!0),t.dragData.didDrag=!0,t.hoverData.draggingEles||S(ar,{inDragLayer:!0});var kn={x:0,y:0};if(bt(Wt[0])&&bt(Wt[1])&&(kn.x+=Wt[0],kn.y+=Wt[1],sn)){var In=t.hoverData.dragDelta;In&&bt(In[0])&&bt(In[1])&&(kn.x+=In[0],kn.y+=In[1])}t.hoverData.draggingEles=!0,ar.silentShift(kn).emit(Br("position")).emit(Br("drag")),t.redrawHint("drag",!0),t.redraw()}}else St();ke=!0}if(ft[2]=Ve[0],ft[3]=Ve[1],ke)return ce.stopPropagation&&ce.stopPropagation(),ce.preventDefault&&ce.preventDefault(),!1}},!1);var K,O,W;t.registerBinding(e,"mouseup",function(ce){if(!(t.hoverData.which===1&&ce.which!==1&&t.hoverData.capture)){var me=t.hoverData.capture;if(me){t.hoverData.capture=!1;var ke=t.cy,Te=t.projectIntoViewport(ce.clientX,ce.clientY),Ae=t.selection,Xe=t.findNearestElement(Te[0],Te[1],!0,!1),Ve=t.dragData.possibleDragElements,yt=t.hoverData.down,vt=a(ce);t.data.bgActivePosistion&&(t.redrawHint("select",!0),t.redraw()),t.hoverData.tapholdCancelled=!0,t.data.bgActivePosistion=void 0,yt&&yt.unactivate();var ft=function(kr){return{originalEvent:ce,type:kr,position:{x:Te[0],y:Te[1]}}};if(t.hoverData.which===3){var Zt=ft("cxttapend");if(yt?yt.emit(Zt):ke.emit(Zt),!t.hoverData.cxtDragged){var Ht=ft("cxttap");yt?yt.emit(Ht):ke.emit(Ht)}t.hoverData.cxtDragged=!1,t.hoverData.which=null}else if(t.hoverData.which===1){if(i(Xe,["mouseup","tapend","vmouseup"],ce,{x:Te[0],y:Te[1]}),!t.dragData.didDrag&&!t.hoverData.dragged&&!t.hoverData.selecting&&!t.hoverData.isOverThresholdDrag&&(i(yt,["click","tap","vclick"],ce,{x:Te[0],y:Te[1]}),O=!1,ce.timeStamp-W<=ke.multiClickDebounceTime()?(K&&clearTimeout(K),O=!0,W=null,i(yt,["dblclick","dbltap","vdblclick"],ce,{x:Te[0],y:Te[1]})):(K=setTimeout(function(){O||i(yt,["oneclick","onetap","voneclick"],ce,{x:Te[0],y:Te[1]})},ke.multiClickDebounceTime()),W=ce.timeStamp)),yt==null&&!t.dragData.didDrag&&!t.hoverData.selecting&&!t.hoverData.dragged&&!a(ce)&&(ke.$(r).unselect(["tapunselect"]),Ve.length>0&&t.redrawHint("eles",!0),t.dragData.possibleDragElements=Ve=ke.collection()),Xe==yt&&!t.dragData.didDrag&&!t.hoverData.selecting&&Xe!=null&&Xe._private.selectable&&(t.hoverData.dragging||(ke.selectionType()==="additive"||vt?Xe.selected()?Xe.unselect(["tapunselect"]):Xe.select(["tapselect"]):vt||(ke.$(r).unmerge(Xe).unselect(["tapunselect"]),Xe.select(["tapselect"]))),t.redrawHint("eles",!0)),t.hoverData.selecting){var Et=ke.collection(t.getAllInBox(Ae[0],Ae[1],Ae[2],Ae[3]));t.redrawHint("select",!0),Et.length>0&&t.redrawHint("eles",!0),ke.emit(ft("boxend"));var Wt=function(kr){return kr.selectable()&&!kr.selected()};ke.selectionType()==="additive"||vt||ke.$(r).unmerge(Et).unselect(),Et.emit(ft("box")).stdFilter(Wt).select().emit(ft("boxselect")),t.redraw()}if(t.hoverData.dragging&&(t.hoverData.dragging=!1,t.redrawHint("select",!0),t.redrawHint("eles",!0),t.redraw()),!Ae[4]){t.redrawHint("drag",!0),t.redrawHint("eles",!0);var ar=yt&&yt.grabbed();E(Ve),ar&&(yt.emit(ft("freeon")),Ve.emit(ft("free")),t.dragData.didDrag&&(yt.emit(ft("dragfreeon")),Ve.emit(ft("dragfree"))))}}Ae[4]=0,t.hoverData.down=null,t.hoverData.cxtStarted=!1,t.hoverData.draggingEles=!1,t.hoverData.selecting=!1,t.hoverData.isOverThresholdDrag=!1,t.dragData.didDrag=!1,t.hoverData.dragged=!1,t.hoverData.dragDelta=[],t.hoverData.mdownPos=null,t.hoverData.mdownGPos=null,t.hoverData.which=null}}},!1);var U=[],q=4,Z,Q=1e5,ne=function(ce,me){for(var ke=0;ke<ce.length;ke++)if(ce[ke]%me!==0)return!1;return!0},re=function(ce){for(var me=Math.abs(ce[0]),ke=1;ke<ce.length;ke++)if(Math.abs(ce[ke])!==me)return!1;return!0},Y=function(ce){var me=!1,ke=ce.deltaY;if(ke==null&&(ce.wheelDeltaY!=null?ke=ce.wheelDeltaY/4:ce.wheelDelta!=null&&(ke=ce.wheelDelta/4)),ke!==0){if(Z==null)if(U.length>=q){var Te=U;if(Z=ne(Te,5),!Z){var Ae=Math.abs(Te[0]);Z=re(Te)&&Ae>5}if(Z)for(var Xe=0;Xe<Te.length;Xe++)Q=Math.min(Math.abs(Te[Xe]),Q)}else U.push(ke),me=!0;else Z&&(Q=Math.min(Math.abs(ke),Q));if(!t.scrollingPage){var Ve=t.cy,yt=Ve.zoom(),vt=Ve.pan(),ft=t.projectIntoViewport(ce.clientX,ce.clientY),Zt=[ft[0]*yt+vt.x,ft[1]*yt+vt.y];if(t.hoverData.draggingEles||t.hoverData.dragging||t.hoverData.cxtStarted||j()){ce.preventDefault();return}if(Ve.panningEnabled()&&Ve.userPanningEnabled()&&Ve.zoomingEnabled()&&Ve.userZoomingEnabled()){ce.preventDefault(),t.data.wheelZooming=!0,clearTimeout(t.data.wheelTimeout),t.data.wheelTimeout=setTimeout(function(){t.data.wheelZooming=!1,t.redrawHint("eles",!0),t.redraw()},150);var Ht;me&&Math.abs(ke)>5&&(ke=n_(ke)*5),Ht=ke/-250,Z&&(Ht/=Q,Ht*=3),Ht=Ht*t.wheelSensitivity;var Et=ce.deltaMode===1;Et&&(Ht*=33);var Wt=Ve.zoom()*Math.pow(10,Ht);ce.type==="gesturechange"&&(Wt=t.gestureStartZoom*ce.scale),Ve.zoom({level:Wt,renderedPosition:{x:Zt[0],y:Zt[1]}}),Ve.emit({type:ce.type==="gesturechange"?"pinchzoom":"scrollzoom",originalEvent:ce,position:{x:ft[0],y:ft[1]}})}}}};t.registerBinding(t.container,"wheel",Y,!0),t.registerBinding(e,"scroll",function(ce){t.scrollingPage=!0,clearTimeout(t.scrollingPageTimeout),t.scrollingPageTimeout=setTimeout(function(){t.scrollingPage=!1},250)},!0),t.registerBinding(t.container,"gesturestart",function(ce){t.gestureStartZoom=t.cy.zoom(),t.hasTouchStarted||ce.preventDefault()},!0),t.registerBinding(t.container,"gesturechange",function(Ge){t.hasTouchStarted||Y(Ge)},!0),t.registerBinding(t.container,"mouseout",function(ce){var me=t.projectIntoViewport(ce.clientX,ce.clientY);t.cy.emit({originalEvent:ce,type:"mouseout",position:{x:me[0],y:me[1]}})},!1),t.registerBinding(t.container,"mouseover",function(ce){var me=t.projectIntoViewport(ce.clientX,ce.clientY);t.cy.emit({originalEvent:ce,type:"mouseover",position:{x:me[0],y:me[1]}})},!1);var J,ie,de,he,xe,le,fe,ve,ge,se,ye,Se,Ue,Oe=function(ce,me,ke,Te){return Math.sqrt((ke-ce)*(ke-ce)+(Te-me)*(Te-me))},mt=function(ce,me,ke,Te){return(ke-ce)*(ke-ce)+(Te-me)*(Te-me)},lt;t.registerBinding(t.container,"touchstart",lt=function(ce){if(t.hasTouchStarted=!0,!!B(ce)){T(),t.touchData.capture=!0,t.data.bgActivePosistion=void 0;var me=t.cy,ke=t.touchData.now,Te=t.touchData.earlier;if(ce.touches[0]){var Ae=t.projectIntoViewport(ce.touches[0].clientX,ce.touches[0].clientY);ke[0]=Ae[0],ke[1]=Ae[1]}if(ce.touches[1]){var Ae=t.projectIntoViewport(ce.touches[1].clientX,ce.touches[1].clientY);ke[2]=Ae[0],ke[3]=Ae[1]}if(ce.touches[2]){var Ae=t.projectIntoViewport(ce.touches[2].clientX,ce.touches[2].clientY);ke[4]=Ae[0],ke[5]=Ae[1]}var Xe=function(vr){return{originalEvent:ce,type:vr,position:{x:ke[0],y:ke[1]}}};if(ce.touches[1]){t.touchData.singleTouchMoved=!0,E(t.dragData.touchDragEles);var Ve=t.findContainerClientCoords();ge=Ve[0],se=Ve[1],ye=Ve[2],Se=Ve[3],J=ce.touches[0].clientX-ge,ie=ce.touches[0].clientY-se,de=ce.touches[1].clientX-ge,he=ce.touches[1].clientY-se,Ue=0<=J&&J<=ye&&0<=de&&de<=ye&&0<=ie&&ie<=Se&&0<=he&&he<=Se;var yt=me.pan(),vt=me.zoom();xe=Oe(J,ie,de,he),le=mt(J,ie,de,he),fe=[(J+de)/2,(ie+he)/2],ve=[(fe[0]-yt.x)/vt,(fe[1]-yt.y)/vt];var ft=200,Zt=ft*ft;if(le<Zt&&!ce.touches[2]){var Ht=t.findNearestElement(ke[0],ke[1],!0,!0),Et=t.findNearestElement(ke[2],ke[3],!0,!0);Ht&&Ht.isNode()?(Ht.activate().emit(Xe("cxttapstart")),t.touchData.start=Ht):Et&&Et.isNode()?(Et.activate().emit(Xe("cxttapstart")),t.touchData.start=Et):me.emit(Xe("cxttapstart")),t.touchData.start&&(t.touchData.start._private.grabbed=!1),t.touchData.cxt=!0,t.touchData.cxtDragged=!1,t.data.bgActivePosistion=void 0,t.redraw();return}}if(ce.touches[2])me.boxSelectionEnabled()&&ce.preventDefault();else if(!ce.touches[1]){if(ce.touches[0]){var Wt=t.findNearestElements(ke[0],ke[1],!0,!0),ar=Wt[0];if(ar!=null&&(ar.activate(),t.touchData.start=ar,t.touchData.starts=Wt,t.nodeIsGrabbable(ar))){var Rr=t.dragData.touchDragEles=me.collection(),kr=null;t.redrawHint("eles",!0),t.redrawHint("drag",!0),ar.selected()?(kr=me.$(function(fn){return fn.selected()&&t.nodeIsGrabbable(fn)}),S(kr,{addToList:Rr})):w(ar,{addToList:Rr}),f(ar),ar.emit(Xe("grabon")),kr?kr.forEach(function(fn){fn.emit(Xe("grab"))}):ar.emit(Xe("grab"))}i(ar,["touchstart","tapstart","vmousedown"],ce,{x:ke[0],y:ke[1]}),ar==null&&(t.data.bgActivePosistion={x:Ae[0],y:Ae[1]},t.redrawHint("select",!0),t.redraw()),t.touchData.singleTouchMoved=!1,t.touchData.singleTouchStartTime=+new Date,clearTimeout(t.touchData.tapholdTimeout),t.touchData.tapholdTimeout=setTimeout(function(){t.touchData.singleTouchMoved===!1&&!t.pinching&&!t.touchData.selecting&&i(t.touchData.start,["taphold"],ce,{x:ke[0],y:ke[1]})},t.tapholdDuration)}}if(ce.touches.length>=1){for(var Qr=t.touchData.startPosition=[null,null,null,null,null,null],Jr=0;Jr<ke.length;Jr++)Qr[Jr]=Te[Jr]=ke[Jr];var _r=ce.touches[0];t.touchData.startGPosition=[_r.clientX,_r.clientY]}}},!1);var at;t.registerBinding(e,"touchmove",at=function(ce){var me=t.touchData.capture;if(!(!me&&!B(ce))){var ke=t.selection,Te=t.cy,Ae=t.touchData.now,Xe=t.touchData.earlier,Ve=Te.zoom();if(ce.touches[0]){var yt=t.projectIntoViewport(ce.touches[0].clientX,ce.touches[0].clientY);Ae[0]=yt[0],Ae[1]=yt[1]}if(ce.touches[1]){var yt=t.projectIntoViewport(ce.touches[1].clientX,ce.touches[1].clientY);Ae[2]=yt[0],Ae[3]=yt[1]}if(ce.touches[2]){var yt=t.projectIntoViewport(ce.touches[2].clientX,ce.touches[2].clientY);Ae[4]=yt[0],Ae[5]=yt[1]}var vt=function(Ir){return{originalEvent:ce,type:Ir,position:{x:Ae[0],y:Ae[1]}}},ft=t.touchData.startGPosition,Zt;if(me&&ce.touches[0]&&ft){for(var Ht=[],Et=0;Et<Ae.length;Et++)Ht[Et]=Ae[Et]-Xe[Et];var Wt=ce.touches[0].clientX-ft[0],ar=Wt*Wt,Rr=ce.touches[0].clientY-ft[1],kr=Rr*Rr,Qr=ar+kr;Zt=Qr>=t.touchTapThreshold2}if(me&&t.touchData.cxt){ce.preventDefault();var Jr=ce.touches[0].clientX-ge,_r=ce.touches[0].clientY-se,fn=ce.touches[1].clientX-ge,vr=ce.touches[1].clientY-se,St=mt(Jr,_r,fn,vr),Br=St/le,Xn=150,Yi=Xn*Xn,ds=1.5,As=ds*ds;if(Br>=As||St>=Yi){t.touchData.cxt=!1,t.data.bgActivePosistion=void 0,t.redrawHint("select",!0);var ni=vt("cxttapend");t.touchData.start?(t.touchData.start.unactivate().emit(ni),t.touchData.start=null):Te.emit(ni)}}if(me&&t.touchData.cxt){var ni=vt("cxtdrag");t.data.bgActivePosistion=void 0,t.redrawHint("select",!0),t.touchData.start?t.touchData.start.emit(ni):Te.emit(ni),t.touchData.start&&(t.touchData.start._private.grabbed=!1),t.touchData.cxtDragged=!0;var sn=t.findNearestElement(Ae[0],Ae[1],!0,!0);(!t.touchData.cxtOver||sn!==t.touchData.cxtOver)&&(t.touchData.cxtOver&&t.touchData.cxtOver.emit(vt("cxtdragout")),t.touchData.cxtOver=sn,sn&&sn.emit(vt("cxtdragover")))}else if(me&&ce.touches[2]&&Te.boxSelectionEnabled())ce.preventDefault(),t.data.bgActivePosistion=void 0,this.lastThreeTouch=+new Date,t.touchData.selecting||Te.emit(vt("boxstart")),t.touchData.selecting=!0,t.touchData.didSelect=!0,ke[4]=1,!ke||ke.length===0||ke[0]===void 0?(ke[0]=(Ae[0]+Ae[2]+Ae[4])/3,ke[1]=(Ae[1]+Ae[3]+Ae[5])/3,ke[2]=(Ae[0]+Ae[2]+Ae[4])/3+1,ke[3]=(Ae[1]+Ae[3]+Ae[5])/3+1):(ke[2]=(Ae[0]+Ae[2]+Ae[4])/3,ke[3]=(Ae[1]+Ae[3]+Ae[5])/3),t.redrawHint("select",!0),t.redraw();else if(me&&ce.touches[1]&&!t.touchData.didSelect&&Te.zoomingEnabled()&&Te.panningEnabled()&&Te.userZoomingEnabled()&&Te.userPanningEnabled()){ce.preventDefault(),t.data.bgActivePosistion=void 0,t.redrawHint("select",!0);var kn=t.dragData.touchDragEles;if(kn){t.redrawHint("drag",!0);for(var In=0;In<kn.length;In++){var Rs=kn[In]._private;Rs.grabbed=!1,Rs.rscratch.inDragLayer=!1}}var gi=t.touchData.start,Jr=ce.touches[0].clientX-ge,_r=ce.touches[0].clientY-se,fn=ce.touches[1].clientX-ge,vr=ce.touches[1].clientY-se,So=Oe(Jr,_r,fn,vr),qa=So/xe;if(Ue){var Lu=Jr-J,ko=_r-ie,on=fn-de,_o=vr-he,fs=(Lu+on)/2,to=(ko+_o)/2,Xi=Te.zoom(),ro=Xi*qa,ze=Te.pan(),Ke=ve[0]*Xi+ze.x,tt=ve[1]*Xi+ze.y,ot={x:-ro/Xi*(Ke-ze.x-fs)+Ke,y:-ro/Xi*(tt-ze.y-to)+tt};if(gi&&gi.active()){var kn=t.dragData.touchDragEles;E(kn),t.redrawHint("drag",!0),t.redrawHint("eles",!0),gi.unactivate().emit(vt("freeon")),kn.emit(vt("free")),t.dragData.didDrag&&(gi.emit(vt("dragfreeon")),kn.emit(vt("dragfree")))}Te.viewport({zoom:ro,pan:ot,cancelOnFailedZoom:!0}),Te.emit(vt("pinchzoom")),xe=So,J=Jr,ie=_r,de=fn,he=vr,t.pinching=!0}if(ce.touches[0]){var yt=t.projectIntoViewport(ce.touches[0].clientX,ce.touches[0].clientY);Ae[0]=yt[0],Ae[1]=yt[1]}if(ce.touches[1]){var yt=t.projectIntoViewport(ce.touches[1].clientX,ce.touches[1].clientY);Ae[2]=yt[0],Ae[3]=yt[1]}if(ce.touches[2]){var yt=t.projectIntoViewport(ce.touches[2].clientX,ce.touches[2].clientY);Ae[4]=yt[0],Ae[5]=yt[1]}}else if(ce.touches[0]&&!t.touchData.didSelect){var qe=t.touchData.start,Mt=t.touchData.last,sn;if(!t.hoverData.draggingEles&&!t.swipePanning&&(sn=t.findNearestElement(Ae[0],Ae[1],!0,!0)),me&&qe!=null&&ce.preventDefault(),me&&qe!=null&&t.nodeIsDraggable(qe))if(Zt){var kn=t.dragData.touchDragEles,Nr=!t.dragData.didDrag;Nr&&S(kn,{inDragLayer:!0}),t.dragData.didDrag=!0;var Pr={x:0,y:0};if(bt(Ht[0])&&bt(Ht[1])&&(Pr.x+=Ht[0],Pr.y+=Ht[1],Nr)){t.redrawHint("eles",!0);var Fr=t.touchData.dragDelta;Fr&&bt(Fr[0])&&bt(Fr[1])&&(Pr.x+=Fr[0],Pr.y+=Fr[1])}t.hoverData.draggingEles=!0,kn.silentShift(Pr).emit(vt("position")).emit(vt("drag")),t.redrawHint("drag",!0),t.touchData.startPosition[0]==Xe[0]&&t.touchData.startPosition[1]==Xe[1]&&t.redrawHint("eles",!0),t.redraw()}else{var Fr=t.touchData.dragDelta=t.touchData.dragDelta||[];Fr.length===0?(Fr.push(Ht[0]),Fr.push(Ht[1])):(Fr[0]+=Ht[0],Fr[1]+=Ht[1])}if(i(qe||sn,["touchmove","tapdrag","vmousemove"],ce,{x:Ae[0],y:Ae[1]}),(!qe||!qe.grabbed())&&sn!=Mt&&(Mt&&Mt.emit(vt("tapdragout")),sn&&sn.emit(vt("tapdragover"))),t.touchData.last=sn,me)for(var In=0;In<Ae.length;In++)Ae[In]&&t.touchData.startPosition[In]&&Zt&&(t.touchData.singleTouchMoved=!0);if(me&&(qe==null||qe.pannable())&&Te.panningEnabled()&&Te.userPanningEnabled()){var vi=s(qe,t.touchData.starts);vi&&(ce.preventDefault(),t.data.bgActivePosistion||(t.data.bgActivePosistion=Rp(t.touchData.startPosition)),t.swipePanning?(Te.panBy({x:Ht[0]*Ve,y:Ht[1]*Ve}),Te.emit(vt("dragpan"))):Zt&&(t.swipePanning=!0,Te.panBy({x:Wt*Ve,y:Rr*Ve}),Te.emit(vt("dragpan")),qe&&(qe.unactivate(),t.redrawHint("select",!0),t.touchData.start=null)));var yt=t.projectIntoViewport(ce.touches[0].clientX,ce.touches[0].clientY);Ae[0]=yt[0],Ae[1]=yt[1]}}for(var Et=0;Et<Ae.length;Et++)Xe[Et]=Ae[Et];me&&ce.touches.length>0&&!t.hoverData.draggingEles&&!t.swipePanning&&t.data.bgActivePosistion!=null&&(t.data.bgActivePosistion=void 0,t.redrawHint("select",!0),t.redraw())}},!1);var wt;t.registerBinding(e,"touchcancel",wt=function(ce){var me=t.touchData.start;t.touchData.capture=!1,me&&me.unactivate()});var $e,Ce,Ie,Je;if(t.registerBinding(e,"touchend",$e=function(ce){var me=t.touchData.start,ke=t.touchData.capture;if(ke)ce.touches.length===0&&(t.touchData.capture=!1),ce.preventDefault();else return;var Te=t.selection;t.swipePanning=!1,t.hoverData.draggingEles=!1;var Ae=t.cy,Xe=Ae.zoom(),Ve=t.touchData.now,yt=t.touchData.earlier;if(ce.touches[0]){var vt=t.projectIntoViewport(ce.touches[0].clientX,ce.touches[0].clientY);Ve[0]=vt[0],Ve[1]=vt[1]}if(ce.touches[1]){var vt=t.projectIntoViewport(ce.touches[1].clientX,ce.touches[1].clientY);Ve[2]=vt[0],Ve[3]=vt[1]}if(ce.touches[2]){var vt=t.projectIntoViewport(ce.touches[2].clientX,ce.touches[2].clientY);Ve[4]=vt[0],Ve[5]=vt[1]}var ft=function(Yi){return{originalEvent:ce,type:Yi,position:{x:Ve[0],y:Ve[1]}}};me&&me.unactivate();var Zt;if(t.touchData.cxt){if(Zt=ft("cxttapend"),me?me.emit(Zt):Ae.emit(Zt),!t.touchData.cxtDragged){var Ht=ft("cxttap");me?me.emit(Ht):Ae.emit(Ht)}t.touchData.start&&(t.touchData.start._private.grabbed=!1),t.touchData.cxt=!1,t.touchData.start=null,t.redraw();return}if(!ce.touches[2]&&Ae.boxSelectionEnabled()&&t.touchData.selecting){t.touchData.selecting=!1;var Et=Ae.collection(t.getAllInBox(Te[0],Te[1],Te[2],Te[3]));Te[0]=void 0,Te[1]=void 0,Te[2]=void 0,Te[3]=void 0,Te[4]=0,t.redrawHint("select",!0),Ae.emit(ft("boxend"));var Wt=function(Yi){return Yi.selectable()&&!Yi.selected()};Et.emit(ft("box")).stdFilter(Wt).select().emit(ft("boxselect")),Et.nonempty()&&t.redrawHint("eles",!0),t.redraw()}if(me?.unactivate(),ce.touches[2])t.data.bgActivePosistion=void 0,t.redrawHint("select",!0);else if(!ce.touches[1]){if(!ce.touches[0]){if(!ce.touches[0]){t.data.bgActivePosistion=void 0,t.redrawHint("select",!0);var ar=t.dragData.touchDragEles;if(me!=null){var Rr=me._private.grabbed;E(ar),t.redrawHint("drag",!0),t.redrawHint("eles",!0),Rr&&(me.emit(ft("freeon")),ar.emit(ft("free")),t.dragData.didDrag&&(me.emit(ft("dragfreeon")),ar.emit(ft("dragfree")))),i(me,["touchend","tapend","vmouseup","tapdragout"],ce,{x:Ve[0],y:Ve[1]}),me.unactivate(),t.touchData.start=null}else{var kr=t.findNearestElement(Ve[0],Ve[1],!0,!0);i(kr,["touchend","tapend","vmouseup","tapdragout"],ce,{x:Ve[0],y:Ve[1]})}var Qr=t.touchData.startPosition[0]-Ve[0],Jr=Qr*Qr,_r=t.touchData.startPosition[1]-Ve[1],fn=_r*_r,vr=Jr+fn,St=vr*Xe*Xe;t.touchData.singleTouchMoved||(me||Ae.$(":selected").unselect(["tapunselect"]),i(me,["tap","vclick"],ce,{x:Ve[0],y:Ve[1]}),Ce=!1,ce.timeStamp-Je<=Ae.multiClickDebounceTime()?(Ie&&clearTimeout(Ie),Ce=!0,Je=null,i(me,["dbltap","vdblclick"],ce,{x:Ve[0],y:Ve[1]})):(Ie=setTimeout(function(){Ce||i(me,["onetap","voneclick"],ce,{x:Ve[0],y:Ve[1]})},Ae.multiClickDebounceTime()),Je=ce.timeStamp)),me!=null&&!t.dragData.didDrag&&me._private.selectable&&St<t.touchTapThreshold2&&!t.pinching&&(Ae.selectionType()==="single"?(Ae.$(r).unmerge(me).unselect(["tapunselect"]),me.select(["tapselect"])):me.selected()?me.unselect(["tapunselect"]):me.select(["tapselect"]),t.redrawHint("eles",!0)),t.touchData.singleTouchMoved=!0}}}for(var Br=0;Br<Ve.length;Br++)yt[Br]=Ve[Br];t.dragData.didDrag=!1,ce.touches.length===0&&(t.touchData.dragDelta=[],t.touchData.startPosition=[null,null,null,null,null,null],t.touchData.startGPosition=null,t.touchData.didSelect=!1),ce.touches.length<2&&(ce.touches.length===1&&(t.touchData.startGPosition=[ce.touches[0].clientX,ce.touches[0].clientY]),t.pinching=!1,t.redrawHint("eles",!0),t.redraw())},!1),typeof TouchEvent>"u"){var Qe=[],gt=function(ce){return{clientX:ce.clientX,clientY:ce.clientY,force:1,identifier:ce.pointerId,pageX:ce.pageX,pageY:ce.pageY,radiusX:ce.width/2,radiusY:ce.height/2,screenX:ce.screenX,screenY:ce.screenY,target:ce.target}},At=function(ce){return{event:ce,touch:gt(ce)}},Rt=function(ce){Qe.push(At(ce))},Ut=function(ce){for(var me=0;me<Qe.length;me++){var ke=Qe[me];if(ke.event.pointerId===ce.pointerId){Qe.splice(me,1);return}}},Vt=function(ce){var me=Qe.filter(function(ke){return ke.event.pointerId===ce.pointerId})[0];me.event=ce,me.touch=gt(ce)},pt=function(ce){ce.touches=Qe.map(function(me){return me.touch})},dt=function(ce){return ce.pointerType==="mouse"||ce.pointerType===4};t.registerBinding(t.container,"pointerdown",function(Ge){dt(Ge)||(Ge.preventDefault(),Rt(Ge),pt(Ge),lt(Ge))}),t.registerBinding(t.container,"pointerup",function(Ge){dt(Ge)||(Ut(Ge),pt(Ge),$e(Ge))}),t.registerBinding(t.container,"pointercancel",function(Ge){dt(Ge)||(Ut(Ge),pt(Ge),wt(Ge))}),t.registerBinding(t.container,"pointermove",function(Ge){dt(Ge)||(Ge.preventDefault(),Vt(Ge),pt(Ge),at(Ge))})}};var wc={};wc.generatePolygon=function(t,e){return this.nodeShapes[t]={renderer:this,name:t,points:e,draw:function(n,i,a,s,o,l){this.renderer.nodeShapeImpl("polygon",n,i,a,s,o,this.points)},intersectLine:function(n,i,a,s,o,l,u,c){return kv(o,l,this.points,n,i,a/2,s/2,u)},checkPoint:function(n,i,a,s,o,l,u,c){return yc(n,i,this.points,l,u,s,o,[0,-1],a)},hasMiterBounds:t!=="rectangle",miterBounds:function(n,i,a,s,o,l){return X9(this.points,n,i,a,s,o)}}};wc.generateEllipse=function(){return this.nodeShapes.ellipse={renderer:this,name:"ellipse",draw:function(e,r,n,i,a,s){this.renderer.nodeShapeImpl(this.name,e,r,n,i,a)},intersectLine:function(e,r,n,i,a,s,o,l){return aF(a,s,e,r,n/2+o,i/2+o)},checkPoint:function(e,r,n,i,a,s,o,l){return th(e,r,i,a,s,o,n)}}};wc.generateRoundPolygon=function(t,e){return this.nodeShapes[t]={renderer:this,name:t,points:e,getOrCreateCorners:function(n,i,a,s,o,l,u){if(l[u]!==void 0&&l[u+"-cx"]===n&&l[u+"-cy"]===i)return l[u];l[u]=new Array(e.length/2),l[u+"-cx"]=n,l[u+"-cy"]=i;var c=a/2,f=s/2;o=o==="auto"?YM(a,s):o;for(var p=new Array(e.length/2),v=0;v<e.length/2;v++)p[v]={x:n+c*e[v*2],y:i+f*e[v*2+1]};var y,S,w,E,_=p.length;for(S=p[_-1],y=0;y<_;y++)w=p[y%_],E=p[(y+1)%_],l[u][y]=g_(S,w,E,o),S=w,w=E;return l[u]},draw:function(n,i,a,s,o,l,u){this.renderer.nodeShapeImpl("round-polygon",n,i,a,s,o,this.points,this.getOrCreateCorners(i,a,s,o,l,u,"drawCorners"))},intersectLine:function(n,i,a,s,o,l,u,c,f){return oF(o,l,this.points,n,i,a,s,u,this.getOrCreateCorners(n,i,a,s,c,f,"corners"))},checkPoint:function(n,i,a,s,o,l,u,c,f){return iF(n,i,this.points,l,u,s,o,this.getOrCreateCorners(l,u,s,o,c,f,"corners"))}}};wc.generateRoundRectangle=function(){return this.nodeShapes["round-rectangle"]=this.nodeShapes.roundrectangle={renderer:this,name:"round-rectangle",points:Cs(4,0),draw:function(e,r,n,i,a,s){this.renderer.nodeShapeImpl(this.name,e,r,n,i,a,this.points,s)},intersectLine:function(e,r,n,i,a,s,o,l){return KM(a,s,e,r,n,i,o,l)},checkPoint:function(e,r,n,i,a,s,o,l){var u=i/2,c=a/2;l=l==="auto"?Xd(i,a):l,l=Math.min(u,c,l);var f=l*2;return!!(yc(e,r,this.points,s,o,i,a-f,[0,-1],n)||yc(e,r,this.points,s,o,i-f,a,[0,-1],n)||th(e,r,f,f,s-u+l,o-c+l,n)||th(e,r,f,f,s+u-l,o-c+l,n)||th(e,r,f,f,s+u-l,o+c-l,n)||th(e,r,f,f,s-u+l,o+c-l,n))}}};wc.generateCutRectangle=function(){return this.nodeShapes["cut-rectangle"]=this.nodeShapes.cutrectangle={renderer:this,name:"cut-rectangle",cornerLength:a_(),points:Cs(4,0),draw:function(e,r,n,i,a,s){this.renderer.nodeShapeImpl(this.name,e,r,n,i,a,null,s)},generateCutTrianglePts:function(e,r,n,i,a){var s=a==="auto"?this.cornerLength:a,o=r/2,l=e/2,u=n-l,c=n+l,f=i-o,p=i+o;return{topLeft:[u,f+s,u+s,f,u+s,f+s],topRight:[c-s,f,c,f+s,c-s,f+s],bottomRight:[c,p-s,c-s,p,c-s,p-s],bottomLeft:[u+s,p,u,p-s,u+s,p-s]}},intersectLine:function(e,r,n,i,a,s,o,l){var u=this.generateCutTrianglePts(n+2*o,i+2*o,e,r,l),c=[].concat.apply([],[u.topLeft.splice(0,4),u.topRight.splice(0,4),u.bottomRight.splice(0,4),u.bottomLeft.splice(0,4)]);return kv(a,s,c,e,r)},checkPoint:function(e,r,n,i,a,s,o,l){var u=l==="auto"?this.cornerLength:l;if(yc(e,r,this.points,s,o,i,a-2*u,[0,-1],n)||yc(e,r,this.points,s,o,i-2*u,a,[0,-1],n))return!0;var c=this.generateCutTrianglePts(i,a,s,o);return Ks(e,r,c.topLeft)||Ks(e,r,c.topRight)||Ks(e,r,c.bottomRight)||Ks(e,r,c.bottomLeft)}}};wc.generateBarrel=function(){return this.nodeShapes.barrel={renderer:this,name:"barrel",points:Cs(4,0),draw:function(e,r,n,i,a,s){this.renderer.nodeShapeImpl(this.name,e,r,n,i,a)},intersectLine:function(e,r,n,i,a,s,o,l){var u=.15,c=.5,f=.85,p=this.generateBarrelBezierPts(n+2*o,i+2*o,e,r),v=function(w){var E=jp({x:w[0],y:w[1]},{x:w[2],y:w[3]},{x:w[4],y:w[5]},u),_=jp({x:w[0],y:w[1]},{x:w[2],y:w[3]},{x:w[4],y:w[5]},c),T=jp({x:w[0],y:w[1]},{x:w[2],y:w[3]},{x:w[4],y:w[5]},f);return[w[0],w[1],E.x,E.y,_.x,_.y,T.x,T.y,w[4],w[5]]},y=[].concat(v(p.topLeft),v(p.topRight),v(p.bottomRight),v(p.bottomLeft));return kv(a,s,y,e,r)},generateBarrelBezierPts:function(e,r,n,i){var a=r/2,s=e/2,o=n-s,l=n+s,u=i-a,c=i+a,f=DS(e,r),p=f.heightOffset,v=f.widthOffset,y=f.ctrlPtOffsetPct*e,S={topLeft:[o,u+p,o+y,u,o+v,u],topRight:[l-v,u,l-y,u,l,u+p],bottomRight:[l,c-p,l-y,c,l-v,c],bottomLeft:[o+v,c,o+y,c,o,c-p]};return S.topLeft.isTop=!0,S.topRight.isTop=!0,S.bottomLeft.isBottom=!0,S.bottomRight.isBottom=!0,S},checkPoint:function(e,r,n,i,a,s,o,l){var u=DS(i,a),c=u.heightOffset,f=u.widthOffset;if(yc(e,r,this.points,s,o,i,a-2*c,[0,-1],n)||yc(e,r,this.points,s,o,i-2*f,a,[0,-1],n))return!0;for(var p=this.generateBarrelBezierPts(i,a,s,o),v=function(D,j,B){var G=B[4],K=B[2],O=B[0],W=B[5],U=B[1],q=Math.min(G,O),Z=Math.max(G,O),Q=Math.min(W,U),ne=Math.max(W,U);if(q<=D&&D<=Z&&Q<=j&&j<=ne){var re=lF(G,K,O),Y=eF(re[0],re[1],re[2],D),J=Y.filter(function(ie){return 0<=ie&&ie<=1});if(J.length>0)return J[0]}return null},y=Object.keys(p),S=0;S<y.length;S++){var w=y[S],E=p[w],_=v(e,r,E);if(_!=null){var T=E[5],N=E[3],R=E[1],I=fa(T,N,R,_);if(E.isTop&&I<=r||E.isBottom&&r<=I)return!0}}return!1}}};wc.generateBottomRoundrectangle=function(){return this.nodeShapes["bottom-round-rectangle"]=this.nodeShapes.bottomroundrectangle={renderer:this,name:"bottom-round-rectangle",points:Cs(4,0),draw:function(e,r,n,i,a,s){this.renderer.nodeShapeImpl(this.name,e,r,n,i,a,this.points,s)},intersectLine:function(e,r,n,i,a,s,o,l){var u=e-(n/2+o),c=r-(i/2+o),f=c,p=e+(n/2+o),v=Dd(a,s,e,r,u,c,p,f,!1);return v.length>0?v:KM(a,s,e,r,n,i,o,l)},checkPoint:function(e,r,n,i,a,s,o,l){l=l==="auto"?Xd(i,a):l;var u=2*l;if(yc(e,r,this.points,s,o,i,a-u,[0,-1],n)||yc(e,r,this.points,s,o,i-u,a,[0,-1],n))return!0;var c=i/2+2*n,f=a/2+2*n,p=[s-c,o-f,s-c,o,s+c,o,s+c,o-f];return!!(Ks(e,r,p)||th(e,r,u,u,s+i/2-l,o+a/2-l,n)||th(e,r,u,u,s-i/2+l,o+a/2-l,n))}}};wc.registerNodeShapes=function(){var t=this.nodeShapes={},e=this;this.generateEllipse(),this.generatePolygon("triangle",Cs(3,0)),this.generateRoundPolygon("round-triangle",Cs(3,0)),this.generatePolygon("rectangle",Cs(4,0)),t.square=t.rectangle,this.generateRoundRectangle(),this.generateCutRectangle(),this.generateBarrel(),this.generateBottomRoundrectangle();{var r=[0,1,1,0,0,-1,-1,0];this.generatePolygon("diamond",r),this.generateRoundPolygon("round-diamond",r)}this.generatePolygon("pentagon",Cs(5,0)),this.generateRoundPolygon("round-pentagon",Cs(5,0)),this.generatePolygon("hexagon",Cs(6,0)),this.generateRoundPolygon("round-hexagon",Cs(6,0)),this.generatePolygon("heptagon",Cs(7,0)),this.generateRoundPolygon("round-heptagon",Cs(7,0)),this.generatePolygon("octagon",Cs(8,0)),this.generateRoundPolygon("round-octagon",Cs(8,0));var n=new Array(20);{var i=OS(5,0),a=OS(5,Math.PI/5),s=.5*(3-Math.sqrt(5));s*=1.57;for(var o=0;o<a.length/2;o++)a[o*2]*=s,a[o*2+1]*=s;for(var o=0;o<20/4;o++)n[o*4]=i[o*2],n[o*4+1]=i[o*2+1],n[o*4+2]=a[o*2],n[o*4+3]=a[o*2+1]}n=ZM(n),this.generatePolygon("star",n),this.generatePolygon("vee",[-1,-1,0,-.333,1,-1,0,1]),this.generatePolygon("rhomboid",[-1,-1,.333,-1,1,1,-.333,1]),this.generatePolygon("right-rhomboid",[-.333,-1,1,-1,.333,1,-1,1]),this.nodeShapes.concavehexagon=this.generatePolygon("concave-hexagon",[-1,-.95,-.75,0,-1,.95,1,.95,.75,0,1,-.95]);{var l=[-1,-1,.25,-1,1,0,.25,1,-1,1];this.generatePolygon("tag",l),this.generateRoundPolygon("round-tag",l)}t.makePolygon=function(u){var c=u.join("$"),f="polygon-"+c,p;return(p=this[f])?p:e.generatePolygon(f,u)}};var n0={};n0.timeToRender=function(){return this.redrawTotalTime/this.redrawCount};n0.redraw=function(t){t=t||HM();var e=this;e.averageRedrawTime===void 0&&(e.averageRedrawTime=0),e.lastRedrawTime===void 0&&(e.lastRedrawTime=0),e.lastDrawTime===void 0&&(e.lastDrawTime=0),e.requestedFrame=!0,e.renderOptions=t};n0.beforeRender=function(t,e){if(!this.destroyed){e==null&&Kn("Priority is not optional for beforeRender");var r=this.beforeRenderCallbacks;r.push({fn:t,priority:e}),r.sort(function(n,i){return i.priority-n.priority})}};var FN=function(e,r,n){for(var i=e.beforeRenderCallbacks,a=0;a<i.length;a++)i[a].fn(r,n)};n0.startRenderLoop=function(){var t=this,e=t.cy;if(!t.renderLoopStarted){t.renderLoopStarted=!0;var r=function(i){if(!t.destroyed){if(!e.batching())if(t.requestedFrame&&!t.skipFrame){FN(t,!0,i);var a=vc();t.render(t.renderOptions);var s=t.lastDrawTime=vc();t.averageRedrawTime===void 0&&(t.averageRedrawTime=s-a),t.redrawCount===void 0&&(t.redrawCount=0),t.redrawCount++,t.redrawTotalTime===void 0&&(t.redrawTotalTime=0);var o=s-a;t.redrawTotalTime+=o,t.lastRedrawTime=o,t.averageRedrawTime=t.averageRedrawTime/2+o/2,t.requestedFrame=!1}else FN(t,!1,i);t.skipFrame=!1,ax(r)}};ax(r)}};var _z=function(e){this.init(e)},YA=_z,pm=YA.prototype;pm.clientFunctions=["redrawHint","render","renderTo","matchCanvasSize","nodeShapeImpl","arrowShapeImpl"];pm.init=function(t){var e=this;e.options=t,e.cy=t.cy;var r=e.container=t.cy.container(),n=e.cy.window();if(n){var i=n.document,a=i.head,s="__________cytoscape_stylesheet",o="__________cytoscape_container",l=i.getElementById(s)!=null;if(r.className.indexOf(o)<0&&(r.className=(r.className||"")+" "+o),!l){var u=i.createElement("style");u.id=s,u.textContent="."+o+" { position: relative; }",a.insertBefore(u,a.children[0])}var c=n.getComputedStyle(r),f=c.getPropertyValue("position");f==="static"&&an("A Cytoscape container has style position:static and so can not use UI extensions properly")}e.selection=[void 0,void 0,void 0,void 0,0],e.bezierProjPcts=[.05,.225,.4,.5,.6,.775,.95],e.hoverData={down:null,last:null,downTime:null,triggerMode:null,dragging:!1,initialPan:[null,null],capture:!1},e.dragData={possibleDragElements:[]},e.touchData={start:null,capture:!1,startPosition:[null,null,null,null,null,null],singleTouchStartTime:null,singleTouchMoved:!0,now:[null,null,null,null,null,null],earlier:[null,null,null,null,null,null]},e.redraws=0,e.showFps=t.showFps,e.debug=t.debug,e.webgl=t.webgl,e.hideEdgesOnViewport=t.hideEdgesOnViewport,e.textureOnViewport=t.textureOnViewport,e.wheelSensitivity=t.wheelSensitivity,e.motionBlurEnabled=t.motionBlur,e.forcedPixelRatio=bt(t.pixelRatio)?t.pixelRatio:null,e.motionBlur=t.motionBlur,e.motionBlurOpacity=t.motionBlurOpacity,e.motionBlurTransparency=1-e.motionBlurOpacity,e.motionBlurPxRatio=1,e.mbPxRBlurry=1,e.minMbLowQualFrames=4,e.fullQualityMb=!1,e.clearedForMotionBlur=[],e.desktopTapThreshold=t.desktopTapThreshold,e.desktopTapThreshold2=t.desktopTapThreshold*t.desktopTapThreshold,e.touchTapThreshold=t.touchTapThreshold,e.touchTapThreshold2=t.touchTapThreshold*t.touchTapThreshold,e.tapholdDuration=500,e.bindings=[],e.beforeRenderCallbacks=[],e.beforeRenderPriorities={animations:400,eleCalcs:300,eleTxrDeq:200,lyrTxrDeq:150,lyrTxrSkip:100},e.registerNodeShapes(),e.registerArrowShapes(),e.registerCalculationListeners()};pm.notify=function(t,e){var r=this,n=r.cy;if(!this.destroyed){if(t==="init"){r.load();return}if(t==="destroy"){r.destroy();return}(t==="add"||t==="remove"||t==="move"&&n.hasCompoundNodes()||t==="load"||t==="zorder"||t==="mount")&&r.invalidateCachedZSortedEles(),t==="viewport"&&r.redrawHint("select",!0),t==="gc"&&r.redrawHint("gc",!0),(t==="load"||t==="resize"||t==="mount")&&(r.invalidateContainerClientCoordsCache(),r.matchCanvasSize(r.container)),r.redrawHint("eles",!0),r.redrawHint("drag",!0),this.startRenderLoop(),this.redraw()}};pm.destroy=function(){var t=this;t.destroyed=!0,t.cy.stopAnimationLoop();for(var e=0;e<t.bindings.length;e++){var r=t.bindings[e],n=r,i=n.target;(i.off||i.removeEventListener).apply(i,n.args)}if(t.bindings=[],t.beforeRenderCallbacks=[],t.onUpdateEleCalcsFns=[],t.removeObserver&&t.removeObserver.disconnect(),t.styleObserver&&t.styleObserver.disconnect(),t.resizeObserver&&t.resizeObserver.disconnect(),t.labelCalcDiv)try{document.body.removeChild(t.labelCalcDiv)}catch{}};pm.isHeadless=function(){return!1};[m_,KA,ZA,hm,wc,n0].forEach(function(t){ir(pm,t)});var f2=1e3/60,XA={setupDequeueing:function(e){return function(){var n=this,i=this.renderer;if(!n.dequeueingSetup){n.dequeueingSetup=!0;var a=Qv(function(){i.redrawHint("eles",!0),i.redrawHint("drag",!0),i.redraw()},e.deqRedrawThreshold),s=function(u,c){var f=vc(),p=i.averageRedrawTime,v=i.lastRedrawTime,y=[],S=i.cy.extent(),w=i.getPixelRatio();for(u||i.flushRenderedStyleQueue();;){var E=vc(),_=E-f,T=E-c;if(v<f2){var N=f2-(u?p:0);if(T>=e.deqFastCost*N)break}else if(u){if(_>=e.deqCost*v||_>=e.deqAvgCost*p)break}else if(T>=e.deqNoDrawCost*f2)break;var R=e.deq(n,w,S);if(R.length>0)for(var I=0;I<R.length;I++)y.push(R[I]);else break}y.length>0&&(e.onDeqd(n,y),!u&&e.shouldRedraw(n,y,w,S)&&a())},o=e.priority||e_;i.beforeRender(s,o(n))}}}},Cz=(function(){function t(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:sx;sf(this,t),this.idsByKey=new dc,this.keyForId=new dc,this.cachesByLvl=new dc,this.lvls=[],this.getKey=e,this.doesEleInvalidateKey=r}return of(t,[{key:"getIdsFor",value:function(r){r==null&&Kn("Can not get id list for null key");var n=this.idsByKey,i=this.idsByKey.get(r);return i||(i=new um,n.set(r,i)),i}},{key:"addIdForKey",value:function(r,n){r!=null&&this.getIdsFor(r).add(n)}},{key:"deleteIdForKey",value:function(r,n){r!=null&&this.getIdsFor(r).delete(n)}},{key:"getNumberOfIdsForKey",value:function(r){return r==null?0:this.getIdsFor(r).size}},{key:"updateKeyMappingFor",value:function(r){var n=r.id(),i=this.keyForId.get(n),a=this.getKey(r);this.deleteIdForKey(i,n),this.addIdForKey(a,n),this.keyForId.set(n,a)}},{key:"deleteKeyMappingFor",value:function(r){var n=r.id(),i=this.keyForId.get(n);this.deleteIdForKey(i,n),this.keyForId.delete(n)}},{key:"keyHasChangedFor",value:function(r){var n=r.id(),i=this.keyForId.get(n),a=this.getKey(r);return i!==a}},{key:"isInvalid",value:function(r){return this.keyHasChangedFor(r)||this.doesEleInvalidateKey(r)}},{key:"getCachesAt",value:function(r){var n=this.cachesByLvl,i=this.lvls,a=n.get(r);return a||(a=new dc,n.set(r,a),i.push(r)),a}},{key:"getCache",value:function(r,n){return this.getCachesAt(n).get(r)}},{key:"get",value:function(r,n){var i=this.getKey(r),a=this.getCache(i,n);return a!=null&&this.updateKeyMappingFor(r),a}},{key:"getForCachedKey",value:function(r,n){var i=this.keyForId.get(r.id()),a=this.getCache(i,n);return a}},{key:"hasCache",value:function(r,n){return this.getCachesAt(n).has(r)}},{key:"has",value:function(r,n){var i=this.getKey(r);return this.hasCache(i,n)}},{key:"setCache",value:function(r,n,i){i.key=r,this.getCachesAt(n).set(r,i)}},{key:"set",value:function(r,n,i){var a=this.getKey(r);this.setCache(a,n,i),this.updateKeyMappingFor(r)}},{key:"deleteCache",value:function(r,n){this.getCachesAt(n).delete(r)}},{key:"delete",value:function(r,n){var i=this.getKey(r);this.deleteCache(i,n)}},{key:"invalidateKey",value:function(r){var n=this;this.lvls.forEach(function(i){return n.deleteCache(r,i)})}},{key:"invalidate",value:function(r){var n=r.id(),i=this.keyForId.get(n);this.deleteKeyMappingFor(r);var a=this.doesEleInvalidateKey(r);return a&&this.invalidateKey(i),a||this.getNumberOfIdsForKey(i)===0}}])})(),BN=25,sy=50,Vy=-4,KS=3,QA=7.99,Ez=8,Tz=1024,Nz=1024,Pz=1024,Mz=.2,Az=.8,Rz=10,Lz=.15,Oz=.1,Dz=.9,Iz=.9,jz=100,Fz=1,Op={dequeue:"dequeue",downscale:"downscale",highQuality:"highQuality"},Bz=Ha({getKey:null,doesEleInvalidateKey:sx,drawElement:null,getBoundingBox:null,getRotationPoint:null,getRotationOffset:null,isVisible:UM,allowEdgeTxrCaching:!0,allowParentTxrCaching:!0}),qg=function(e,r){var n=this;n.renderer=e,n.onDequeues=[];var i=Bz(r);ir(n,i),n.lookup=new Cz(i.getKey,i.doesEleInvalidateKey),n.setupDequeueing()},Zi=qg.prototype;Zi.reasons=Op;Zi.getTextureQueue=function(t){var e=this;return e.eleImgCaches=e.eleImgCaches||{},e.eleImgCaches[t]=e.eleImgCaches[t]||[]};Zi.getRetiredTextureQueue=function(t){var e=this,r=e.eleImgCaches.retired=e.eleImgCaches.retired||{},n=r[t]=r[t]||[];return n};Zi.getElementQueue=function(){var t=this,e=t.eleCacheQueue=t.eleCacheQueue||new Jv(function(r,n){return n.reqs-r.reqs});return e};Zi.getElementKeyToQueue=function(){var t=this,e=t.eleKeyToCacheQueue=t.eleKeyToCacheQueue||{};return e};Zi.getElement=function(t,e,r,n,i){var a=this,s=this.renderer,o=s.cy.zoom(),l=this.lookup;if(!e||e.w===0||e.h===0||isNaN(e.w)||isNaN(e.h)||!t.visible()||t.removed()||!a.allowEdgeTxrCaching&&t.isEdge()||!a.allowParentTxrCaching&&t.isParent())return null;if(n==null&&(n=Math.ceil(r_(o*r))),n<Vy)n=Vy;else if(o>=QA||n>KS)return null;var u=Math.pow(2,n),c=e.h*u,f=e.w*u,p=s.eleTextBiggerThanMin(t,u);if(!this.isVisible(t,p))return null;var v=l.get(t,n);if(v&&v.invalidated&&(v.invalidated=!1,v.texture.invalidatedWidth-=v.width),v)return v;var y;if(c<=BN?y=BN:c<=sy?y=sy:y=Math.ceil(c/sy)*sy,c>Pz||f>Nz)return null;var S=a.getTextureQueue(y),w=S[S.length-2],E=function(){return a.recycleTexture(y,f)||a.addTexture(y,f)};w||(w=S[S.length-1]),w||(w=E()),w.width-w.usedWidth<f&&(w=E());for(var _=function(q){return q&&q.scaledLabelShown===p},T=i&&i===Op.dequeue,N=i&&i===Op.highQuality,R=i&&i===Op.downscale,I,F=n+1;F<=KS;F++){var D=l.get(t,F);if(D){I=D;break}}var j=I&&I.level===n+1?I:null,B=function(){w.context.drawImage(j.texture.canvas,j.x,0,j.width,j.height,w.usedWidth,0,f,c)};if(w.context.setTransform(1,0,0,1,0,0),w.context.clearRect(w.usedWidth,0,f,y),_(j))B();else if(_(I))if(N){for(var G=I.level;G>n;G--)j=a.getElement(t,e,r,G,Op.downscale);B()}else return a.queueElement(t,I.level-1),I;else{var K;if(!T&&!N&&!R)for(var O=n-1;O>=Vy;O--){var W=l.get(t,O);if(W){K=W;break}}if(_(K))return a.queueElement(t,n),K;w.context.translate(w.usedWidth,0),w.context.scale(u,u),this.drawElement(w.context,t,e,p,!1),w.context.scale(1/u,1/u),w.context.translate(-w.usedWidth,0)}return v={x:w.usedWidth,texture:w,level:n,scale:u,width:f,height:c,scaledLabelShown:p},w.usedWidth+=Math.ceil(f+Ez),w.eleCaches.push(v),l.set(t,n,v),a.checkTextureFullness(w),v};Zi.invalidateElements=function(t){for(var e=0;e<t.length;e++)this.invalidateElement(t[e])};Zi.invalidateElement=function(t){var e=this,r=e.lookup,n=[],i=r.isInvalid(t);if(i){for(var a=Vy;a<=KS;a++){var s=r.getForCachedKey(t,a);s&&n.push(s)}var o=r.invalidate(t);if(o)for(var l=0;l<n.length;l++){var u=n[l],c=u.texture;c.invalidatedWidth+=u.width,u.invalidated=!0,e.checkTextureUtility(c)}e.removeFromQueue(t)}};Zi.checkTextureUtility=function(t){t.invalidatedWidth>=Mz*t.width&&this.retireTexture(t)};Zi.checkTextureFullness=function(t){var e=this,r=e.getTextureQueue(t.height);t.usedWidth/t.width>Az&&t.fullnessChecks>=Rz?Yd(r,t):t.fullnessChecks++};Zi.retireTexture=function(t){var e=this,r=t.height,n=e.getTextureQueue(r),i=this.lookup;Yd(n,t),t.retired=!0;for(var a=t.eleCaches,s=0;s<a.length;s++){var o=a[s];i.deleteCache(o.key,o.level)}t_(a);var l=e.getRetiredTextureQueue(r);l.push(t)};Zi.addTexture=function(t,e){var r=this,n=r.getTextureQueue(t),i={};return n.push(i),i.eleCaches=[],i.height=t,i.width=Math.max(Tz,e),i.usedWidth=0,i.invalidatedWidth=0,i.fullnessChecks=0,i.canvas=r.renderer.makeOffscreenCanvas(i.width,i.height),i.context=i.canvas.getContext("2d"),i};Zi.recycleTexture=function(t,e){for(var r=this,n=r.getTextureQueue(t),i=r.getRetiredTextureQueue(t),a=0;a<i.length;a++){var s=i[a];if(s.width>=e)return s.retired=!1,s.usedWidth=0,s.invalidatedWidth=0,s.fullnessChecks=0,t_(s.eleCaches),s.context.setTransform(1,0,0,1,0,0),s.context.clearRect(0,0,s.width,s.height),Yd(i,s),n.push(s),s}};Zi.queueElement=function(t,e){var r=this,n=r.getElementQueue(),i=r.getElementKeyToQueue(),a=this.getKey(t),s=i[a];if(s)s.level=Math.max(s.level,e),s.eles.merge(t),s.reqs++,n.updateItem(s);else{var o={eles:t.spawn().merge(t),level:e,reqs:1,key:a};n.push(o),i[a]=o}};Zi.dequeue=function(t){for(var e=this,r=e.getElementQueue(),n=e.getElementKeyToQueue(),i=[],a=e.lookup,s=0;s<Fz&&r.size()>0;s++){var o=r.pop(),l=o.key,u=o.eles[0],c=a.hasCache(u,o.level);if(n[l]=null,c)continue;i.push(o);var f=e.getBoundingBox(u);e.getElement(u,f,t,o.level,Op.dequeue)}return i};Zi.removeFromQueue=function(t){var e=this,r=e.getElementQueue(),n=e.getElementKeyToQueue(),i=this.getKey(t),a=n[i];a!=null&&(a.eles.length===1?(a.reqs=Jk,r.updateItem(a),r.pop(),n[i]=null):a.eles.unmerge(t))};Zi.onDequeue=function(t){this.onDequeues.push(t)};Zi.offDequeue=function(t){Yd(this.onDequeues,t)};Zi.setupDequeueing=XA.setupDequeueing({deqRedrawThreshold:jz,deqCost:Lz,deqAvgCost:Oz,deqNoDrawCost:Dz,deqFastCost:Iz,deq:function(e,r,n){return e.dequeue(r,n)},onDeqd:function(e,r){for(var n=0;n<e.onDequeues.length;n++){var i=e.onDequeues[n];i(r)}},shouldRedraw:function(e,r,n,i){for(var a=0;a<r.length;a++)for(var s=r[a].eles,o=0;o<s.length;o++){var l=s[o].boundingBox();if(i_(l,i))return!0}return!1},priority:function(e){return e.renderer.beforeRenderPriorities.eleTxrDeq}});var zz=1,tv=-4,px=2,Uz=3.99,Gz=50,Vz=50,Hz=.15,Wz=.1,qz=.9,$z=.9,Kz=1,zN=250,Zz=4e3*4e3,UN=32767,Yz=!0,JA=function(e){var r=this,n=r.renderer=e,i=n.cy;r.layersByLevel={},r.firstGet=!0,r.lastInvalidationTime=vc()-2*zN,r.skipping=!1,r.eleTxrDeqs=i.collection(),r.scheduleElementRefinement=Qv(function(){r.refineElementTextures(r.eleTxrDeqs),r.eleTxrDeqs.unmerge(r.eleTxrDeqs)},Vz),n.beforeRender(function(s,o){o-r.lastInvalidationTime<=zN?r.skipping=!0:r.skipping=!1},n.beforeRenderPriorities.lyrTxrSkip);var a=function(o,l){return l.reqs-o.reqs};r.layersQueue=new Jv(a),r.setupDequeueing()},Wa=JA.prototype,GN=0,Xz=Math.pow(2,53)-1;Wa.makeLayer=function(t,e){var r=Math.pow(2,e),n=Math.ceil(t.w*r),i=Math.ceil(t.h*r),a=this.renderer.makeOffscreenCanvas(n,i),s={id:GN=++GN%Xz,bb:t,level:e,width:n,height:i,canvas:a,context:a.getContext("2d"),eles:[],elesQueue:[],reqs:0},o=s.context,l=-s.bb.x1,u=-s.bb.y1;return o.scale(r,r),o.translate(l,u),s};Wa.getLayers=function(t,e,r){var n=this,i=n.renderer,a=i.cy,s=a.zoom(),o=n.firstGet;if(n.firstGet=!1,r==null){if(r=Math.ceil(r_(s*e)),r<tv)r=tv;else if(s>=Uz||r>px)return null}n.validateLayersElesOrdering(r,t);var l=n.layersByLevel,u=Math.pow(2,r),c=l[r]=l[r]||[],f,p=n.levelIsComplete(r,t),v,y=function(){var B=function(U){if(n.validateLayersElesOrdering(U,t),n.levelIsComplete(U,t))return v=l[U],!0},G=function(U){if(!v)for(var q=r+U;tv<=q&&q<=px&&!B(q);q+=U);};G(1),G(-1);for(var K=c.length-1;K>=0;K--){var O=c[K];O.invalid&&Yd(c,O)}};if(!p)y();else return c;var S=function(){if(!f){f=Es();for(var B=0;B<t.length;B++)K9(f,t[B].boundingBox())}return f},w=function(B){B=B||{};var G=B.after;S();var K=Math.ceil(f.w*u),O=Math.ceil(f.h*u);if(K>UN||O>UN)return null;var W=K*O;if(W>Zz)return null;var U=n.makeLayer(f,r);if(G!=null){var q=c.indexOf(G)+1;c.splice(q,0,U)}else(B.insert===void 0||B.insert)&&c.unshift(U);return U};if(n.skipping&&!o)return null;for(var E=null,_=t.length/zz,T=!o,N=0;N<t.length;N++){var R=t[N],I=R._private.rscratch,F=I.imgLayerCaches=I.imgLayerCaches||{},D=F[r];if(D){E=D;continue}if((!E||E.eles.length>=_||!$M(E.bb,R.boundingBox()))&&(E=w({insert:!0,after:E}),!E))return null;v||T?n.queueLayer(E,R):n.drawEleInLayer(E,R,r,e),E.eles.push(R),F[r]=E}return v||(T?null:c)};Wa.getEleLevelForLayerLevel=function(t,e){return t};Wa.drawEleInLayer=function(t,e,r,n){var i=this,a=this.renderer,s=t.context,o=e.boundingBox();o.w===0||o.h===0||!e.visible()||(r=i.getEleLevelForLayerLevel(r,n),a.setImgSmoothing(s,!1),a.drawCachedElement(s,e,null,null,r,Yz),a.setImgSmoothing(s,!0))};Wa.levelIsComplete=function(t,e){var r=this,n=r.layersByLevel[t];if(!n||n.length===0)return!1;for(var i=0,a=0;a<n.length;a++){var s=n[a];if(s.reqs>0||s.invalid)return!1;i+=s.eles.length}return i===e.length};Wa.validateLayersElesOrdering=function(t,e){var r=this.layersByLevel[t];if(r)for(var n=0;n<r.length;n++){for(var i=r[n],a=-1,s=0;s<e.length;s++)if(i.eles[0]===e[s]){a=s;break}if(a<0){this.invalidateLayer(i);continue}for(var o=a,s=0;s<i.eles.length;s++)if(i.eles[s]!==e[o+s]){this.invalidateLayer(i);break}}};Wa.updateElementsInLayers=function(t,e){for(var r=this,n=Kv(t[0]),i=0;i<t.length;i++)for(var a=n?null:t[i],s=n?t[i]:t[i].ele,o=s._private.rscratch,l=o.imgLayerCaches=o.imgLayerCaches||{},u=tv;u<=px;u++){var c=l[u];c&&(a&&r.getEleLevelForLayerLevel(c.level)!==a.level||e(c,s,a))}};Wa.haveLayers=function(){for(var t=this,e=!1,r=tv;r<=px;r++){var n=t.layersByLevel[r];if(n&&n.length>0){e=!0;break}}return e};Wa.invalidateElements=function(t){var e=this;t.length!==0&&(e.lastInvalidationTime=vc(),!(t.length===0||!e.haveLayers())&&e.updateElementsInLayers(t,function(n,i,a){e.invalidateLayer(n)}))};Wa.invalidateLayer=function(t){if(this.lastInvalidationTime=vc(),!t.invalid){var e=t.level,r=t.eles,n=this.layersByLevel[e];Yd(n,t),t.elesQueue=[],t.invalid=!0,t.replacement&&(t.replacement.invalid=!0);for(var i=0;i<r.length;i++){var a=r[i]._private.rscratch.imgLayerCaches;a&&(a[e]=null)}}};Wa.refineElementTextures=function(t){var e=this;e.updateElementsInLayers(t,function(n,i,a){var s=n.replacement;if(s||(s=n.replacement=e.makeLayer(n.bb,n.level),s.replaces=n,s.eles=n.eles),!s.reqs)for(var o=0;o<s.eles.length;o++)e.queueLayer(s,s.eles[o])})};Wa.enqueueElementRefinement=function(t){this.eleTxrDeqs.merge(t),this.scheduleElementRefinement()};Wa.queueLayer=function(t,e){var r=this,n=r.layersQueue,i=t.elesQueue,a=i.hasId=i.hasId||{};if(!t.replacement){if(e){if(a[e.id()])return;i.push(e),a[e.id()]=!0}t.reqs?(t.reqs++,n.updateItem(t)):(t.reqs=1,n.push(t))}};Wa.dequeue=function(t){for(var e=this,r=e.layersQueue,n=[],i=0;i<Kz&&r.size()!==0;){var a=r.peek();if(a.replacement){r.pop();continue}if(a.replaces&&a!==a.replaces.replacement){r.pop();continue}if(a.invalid){r.pop();continue}var s=a.elesQueue.shift();s&&(e.drawEleInLayer(a,s,a.level,t),i++),n.length===0&&n.push(!0),a.elesQueue.length===0&&(r.pop(),a.reqs=0,a.replaces&&e.applyLayerReplacement(a),e.requestRedraw())}return n};Wa.applyLayerReplacement=function(t){var e=this,r=e.layersByLevel[t.level],n=t.replaces,i=r.indexOf(n);if(!(i<0||n.invalid)){r[i]=t;for(var a=0;a<t.eles.length;a++){var s=t.eles[a]._private,o=s.imgLayerCaches=s.imgLayerCaches||{};o&&(o[t.level]=t)}e.requestRedraw()}};Wa.requestRedraw=Qv(function(){var t=this.renderer;t.redrawHint("eles",!0),t.redrawHint("drag",!0),t.redraw()},100);Wa.setupDequeueing=XA.setupDequeueing({deqRedrawThreshold:Gz,deqCost:Hz,deqAvgCost:Wz,deqNoDrawCost:qz,deqFastCost:$z,deq:function(e,r){return e.dequeue(r)},onDeqd:e_,shouldRedraw:UM,priority:function(e){return e.renderer.beforeRenderPriorities.lyrTxrDeq}});var eR={},VN;function Qz(t,e){for(var r=0;r<e.length;r++){var n=e[r];t.lineTo(n.x,n.y)}}function Jz(t,e,r){for(var n,i=0;i<e.length;i++){var a=e[i];i===0&&(n=a),t.lineTo(a.x,a.y)}t.quadraticCurveTo(r.x,r.y,n.x,n.y)}function HN(t,e,r){t.beginPath&&t.beginPath();for(var n=e,i=0;i<n.length;i++){var a=n[i];t.lineTo(a.x,a.y)}var s=r,o=r[0];t.moveTo(o.x,o.y);for(var i=1;i<s.length;i++){var a=s[i];t.lineTo(a.x,a.y)}t.closePath&&t.closePath()}function eU(t,e,r,n,i){t.beginPath&&t.beginPath(),t.arc(r,n,i,0,Math.PI*2,!1);var a=e,s=a[0];t.moveTo(s.x,s.y);for(var o=0;o<a.length;o++){var l=a[o];t.lineTo(l.x,l.y)}t.closePath&&t.closePath()}function tU(t,e,r,n){t.arc(e,r,n,0,Math.PI*2,!1)}eR.arrowShapeImpl=function(t){return(VN||(VN={polygon:Qz,"triangle-backcurve":Jz,"triangle-tee":HN,"circle-triangle":eU,"triangle-cross":HN,circle:tU}))[t]};var Ru={};Ru.drawElement=function(t,e,r,n,i,a){var s=this;e.isNode()?s.drawNode(t,e,r,n,i,a):s.drawEdge(t,e,r,n,i,a)};Ru.drawElementOverlay=function(t,e){var r=this;e.isNode()?r.drawNodeOverlay(t,e):r.drawEdgeOverlay(t,e)};Ru.drawElementUnderlay=function(t,e){var r=this;e.isNode()?r.drawNodeUnderlay(t,e):r.drawEdgeUnderlay(t,e)};Ru.drawCachedElementPortion=function(t,e,r,n,i,a,s,o){var l=this,u=r.getBoundingBox(e);if(!(u.w===0||u.h===0)){var c=r.getElement(e,u,n,i,a);if(c!=null){var f=o(l,e);if(f===0)return;var p=s(l,e),v=u.x1,y=u.y1,S=u.w,w=u.h,E,_,T,N,R;if(p!==0){var I=r.getRotationPoint(e);T=I.x,N=I.y,t.translate(T,N),t.rotate(p),R=l.getImgSmoothing(t),R||l.setImgSmoothing(t,!0);var F=r.getRotationOffset(e);E=F.x,_=F.y}else E=v,_=y;var D;f!==1&&(D=t.globalAlpha,t.globalAlpha=D*f),t.drawImage(c.texture.canvas,c.x,0,c.width,c.height,E,_,S,w),f!==1&&(t.globalAlpha=D),p!==0&&(t.rotate(-p),t.translate(-T,-N),R||l.setImgSmoothing(t,!1))}else r.drawElement(t,e)}};var rU=function(){return 0},nU=function(e,r){return e.getTextAngle(r,null)},iU=function(e,r){return e.getTextAngle(r,"source")},aU=function(e,r){return e.getTextAngle(r,"target")},sU=function(e,r){return r.effectiveOpacity()},h2=function(e,r){return r.pstyle("text-opacity").pfValue*r.effectiveOpacity()};Ru.drawCachedElement=function(t,e,r,n,i,a){var s=this,o=s.data,l=o.eleTxrCache,u=o.lblTxrCache,c=o.slbTxrCache,f=o.tlbTxrCache,p=e.boundingBox(),v=a===!0?l.reasons.highQuality:null;if(!(p.w===0||p.h===0||!e.visible())&&(!n||i_(p,n))){var y=e.isEdge(),S=e.element()._private.rscratch.badLine;s.drawElementUnderlay(t,e),s.drawCachedElementPortion(t,e,l,r,i,v,rU,sU),(!y||!S)&&s.drawCachedElementPortion(t,e,u,r,i,v,nU,h2),y&&!S&&(s.drawCachedElementPortion(t,e,c,r,i,v,iU,h2),s.drawCachedElementPortion(t,e,f,r,i,v,aU,h2)),s.drawElementOverlay(t,e)}};Ru.drawElements=function(t,e){for(var r=this,n=0;n<e.length;n++){var i=e[n];r.drawElement(t,i)}};Ru.drawCachedElements=function(t,e,r,n){for(var i=this,a=0;a<e.length;a++){var s=e[a];i.drawCachedElement(t,s,r,n)}};Ru.drawCachedNodes=function(t,e,r,n){for(var i=this,a=0;a<e.length;a++){var s=e[a];s.isNode()&&i.drawCachedElement(t,s,r,n)}};Ru.drawLayeredElements=function(t,e,r,n){var i=this,a=i.data.lyrTxrCache.getLayers(e,r);if(a)for(var s=0;s<a.length;s++){var o=a[s],l=o.bb;l.w===0||l.h===0||t.drawImage(o.canvas,l.x1,l.y1,l.w,l.h)}else i.drawCachedElements(t,e,r,n)};var Sc={};Sc.drawEdge=function(t,e,r){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!0,s=this,o=e._private.rscratch;if(!(a&&!e.visible())&&!(o.badLine||o.allpts==null||isNaN(o.allpts[0]))){var l;r&&(l=r,t.translate(-l.x1,-l.y1));var u=a?e.pstyle("opacity").value:1,c=a?e.pstyle("line-opacity").value:1,f=e.pstyle("curve-style").value,p=e.pstyle("line-style").value,v=e.pstyle("width").pfValue,y=e.pstyle("line-cap").value,S=e.pstyle("line-outline-width").value,w=e.pstyle("line-outline-color").value,E=u*c,_=u*c,T=function(){var U=arguments.length>0&&arguments[0]!==void 0?arguments[0]:E;f==="straight-triangle"?(s.eleStrokeStyle(t,e,U),s.drawEdgeTrianglePath(e,t,o.allpts)):(t.lineWidth=v,t.lineCap=y,s.eleStrokeStyle(t,e,U),s.drawEdgePath(e,t,o.allpts,p),t.lineCap="butt")},N=function(){var U=arguments.length>0&&arguments[0]!==void 0?arguments[0]:E;if(t.lineWidth=v+S,t.lineCap=y,S>0)s.colorStrokeStyle(t,w[0],w[1],w[2],U);else{t.lineCap="butt";return}f==="straight-triangle"?s.drawEdgeTrianglePath(e,t,o.allpts):(s.drawEdgePath(e,t,o.allpts,p),t.lineCap="butt")},R=function(){i&&s.drawEdgeOverlay(t,e)},I=function(){i&&s.drawEdgeUnderlay(t,e)},F=function(){var U=arguments.length>0&&arguments[0]!==void 0?arguments[0]:_;s.drawArrowheads(t,e,U)},D=function(){s.drawElementText(t,e,null,n)};t.lineJoin="round";var j=e.pstyle("ghost").value==="yes";if(j){var B=e.pstyle("ghost-offset-x").pfValue,G=e.pstyle("ghost-offset-y").pfValue,K=e.pstyle("ghost-opacity").value,O=E*K;t.translate(B,G),T(O),F(O),t.translate(-B,-G)}else N();I(),T(),F(),R(),D(),r&&t.translate(l.x1,l.y1)}};var tR=function(e){if(!["overlay","underlay"].includes(e))throw new Error("Invalid state");return function(r,n){if(n.visible()){var i=n.pstyle("".concat(e,"-opacity")).value;if(i!==0){var a=this,s=a.usePaths(),o=n._private.rscratch,l=n.pstyle("".concat(e,"-padding")).pfValue,u=2*l,c=n.pstyle("".concat(e,"-color")).value;r.lineWidth=u,o.edgeType==="self"&&!s?r.lineCap="butt":r.lineCap="round",a.colorStrokeStyle(r,c[0],c[1],c[2],i),a.drawEdgePath(n,r,o.allpts,"solid")}}}};Sc.drawEdgeOverlay=tR("overlay");Sc.drawEdgeUnderlay=tR("underlay");Sc.drawEdgePath=function(t,e,r,n){var i=t._private.rscratch,a=e,s,o=!1,l=this.usePaths(),u=t.pstyle("line-dash-pattern").pfValue,c=t.pstyle("line-dash-offset").pfValue;if(l){var f=r.join("$"),p=i.pathCacheKey&&i.pathCacheKey===f;p?(s=e=i.pathCache,o=!0):(s=e=new Path2D,i.pathCacheKey=f,i.pathCache=s)}if(a.setLineDash)switch(n){case"dotted":a.setLineDash([1,1]);break;case"dashed":a.setLineDash(u),a.lineDashOffset=c;break;case"solid":a.setLineDash([]);break}if(!o&&!i.badLine)switch(e.beginPath&&e.beginPath(),e.moveTo(r[0],r[1]),i.edgeType){case"bezier":case"self":case"compound":case"multibezier":for(var v=2;v+3<r.length;v+=4)e.quadraticCurveTo(r[v],r[v+1],r[v+2],r[v+3]);break;case"straight":case"haystack":for(var y=2;y+1<r.length;y+=2)e.lineTo(r[y],r[y+1]);break;case"segments":if(i.isRound){var S=Ys(i.roundCorners),w;try{for(S.s();!(w=S.n()).done;){var E=w.value;VA(e,E)}}catch(T){S.e(T)}finally{S.f()}e.lineTo(r[r.length-2],r[r.length-1])}else for(var _=2;_+1<r.length;_+=2)e.lineTo(r[_],r[_+1]);break}e=a,l?e.stroke(s):e.stroke(),e.setLineDash&&e.setLineDash([])};Sc.drawEdgeTrianglePath=function(t,e,r){e.fillStyle=e.strokeStyle;for(var n=t.pstyle("width").pfValue,i=0;i+1<r.length;i+=2){var a=[r[i+2]-r[i],r[i+3]-r[i+1]],s=Math.sqrt(a[0]*a[0]+a[1]*a[1]),o=[a[1]/s,-a[0]/s],l=[o[0]*n/2,o[1]*n/2];e.beginPath(),e.moveTo(r[i]-l[0],r[i+1]-l[1]),e.lineTo(r[i]+l[0],r[i+1]+l[1]),e.lineTo(r[i+2],r[i+3]),e.closePath(),e.fill()}};Sc.drawArrowheads=function(t,e,r){var n=e._private.rscratch,i=n.edgeType==="haystack";i||this.drawArrowhead(t,e,"source",n.arrowStartX,n.arrowStartY,n.srcArrowAngle,r),this.drawArrowhead(t,e,"mid-target",n.midX,n.midY,n.midtgtArrowAngle,r),this.drawArrowhead(t,e,"mid-source",n.midX,n.midY,n.midsrcArrowAngle,r),i||this.drawArrowhead(t,e,"target",n.arrowEndX,n.arrowEndY,n.tgtArrowAngle,r)};Sc.drawArrowhead=function(t,e,r,n,i,a,s){if(!(isNaN(n)||n==null||isNaN(i)||i==null||isNaN(a)||a==null)){var o=this,l=e.pstyle(r+"-arrow-shape").value;if(l!=="none"){var u=e.pstyle(r+"-arrow-fill").value==="hollow"?"both":"filled",c=e.pstyle(r+"-arrow-fill").value,f=e.pstyle("width").pfValue,p=e.pstyle(r+"-arrow-width"),v=p.value==="match-line"?f:p.pfValue;p.units==="%"&&(v*=f);var y=e.pstyle("opacity").value;s===void 0&&(s=y);var S=t.globalCompositeOperation;(s!==1||c==="hollow")&&(t.globalCompositeOperation="destination-out",o.colorFillStyle(t,255,255,255,1),o.colorStrokeStyle(t,255,255,255,1),o.drawArrowShape(e,t,u,f,l,v,n,i,a),t.globalCompositeOperation=S);var w=e.pstyle(r+"-arrow-color").value;o.colorFillStyle(t,w[0],w[1],w[2],s),o.colorStrokeStyle(t,w[0],w[1],w[2],s),o.drawArrowShape(e,t,c,f,l,v,n,i,a)}}};Sc.drawArrowShape=function(t,e,r,n,i,a,s,o,l){var u=this,c=this.usePaths()&&i!=="triangle-cross",f=!1,p,v=e,y={x:s,y:o},S=t.pstyle("arrow-scale").value,w=this.getArrowWidth(n,S),E=u.arrowShapes[i];if(c){var _=u.arrowPathCache=u.arrowPathCache||[],T=ph(i),N=_[T];N!=null?(p=e=N,f=!0):(p=e=new Path2D,_[T]=p)}f||(e.beginPath&&e.beginPath(),c?E.draw(e,1,0,{x:0,y:0},1):E.draw(e,w,l,y,n),e.closePath&&e.closePath()),e=v,c&&(e.translate(s,o),e.rotate(l),e.scale(w,w)),(r==="filled"||r==="both")&&(c?e.fill(p):e.fill()),(r==="hollow"||r==="both")&&(e.lineWidth=a/(c?w:1),e.lineJoin="miter",c?e.stroke(p):e.stroke()),c&&(e.scale(1/w,1/w),e.rotate(-l),e.translate(-s,-o))};var y_={};y_.safeDrawImage=function(t,e,r,n,i,a,s,o,l,u){if(!(i<=0||a<=0||l<=0||u<=0))try{t.drawImage(e,r,n,i,a,s,o,l,u)}catch(c){an(c)}};y_.drawInscribedImage=function(t,e,r,n,i){var a=this,s=r.position(),o=s.x,l=s.y,u=r.cy().style(),c=u.getIndexedStyle.bind(u),f=c(r,"background-fit","value",n),p=c(r,"background-repeat","value",n),v=r.width(),y=r.height(),S=r.padding()*2,w=v+(c(r,"background-width-relative-to","value",n)==="inner"?0:S),E=y+(c(r,"background-height-relative-to","value",n)==="inner"?0:S),_=r._private.rscratch,T=c(r,"background-clip","value",n),N=T==="node",R=c(r,"background-image-opacity","value",n)*i,I=c(r,"background-image-smoothing","value",n),F=r.pstyle("corner-radius").value;F!=="auto"&&(F=r.pstyle("corner-radius").pfValue);var D=e.width||e.cachedW,j=e.height||e.cachedH;(D==null||j==null)&&(document.body.appendChild(e),D=e.cachedW=e.width||e.offsetWidth,j=e.cachedH=e.height||e.offsetHeight,document.body.removeChild(e));var B=D,G=j;if(c(r,"background-width","value",n)!=="auto"&&(c(r,"background-width","units",n)==="%"?B=c(r,"background-width","pfValue",n)*w:B=c(r,"background-width","pfValue",n)),c(r,"background-height","value",n)!=="auto"&&(c(r,"background-height","units",n)==="%"?G=c(r,"background-height","pfValue",n)*E:G=c(r,"background-height","pfValue",n)),!(B===0||G===0)){if(f==="contain"){var K=Math.min(w/B,E/G);B*=K,G*=K}else if(f==="cover"){var K=Math.max(w/B,E/G);B*=K,G*=K}var O=o-w/2,W=c(r,"background-position-x","units",n),U=c(r,"background-position-x","pfValue",n);W==="%"?O+=(w-B)*U:O+=U;var q=c(r,"background-offset-x","units",n),Z=c(r,"background-offset-x","pfValue",n);q==="%"?O+=(w-B)*Z:O+=Z;var Q=l-E/2,ne=c(r,"background-position-y","units",n),re=c(r,"background-position-y","pfValue",n);ne==="%"?Q+=(E-G)*re:Q+=re;var Y=c(r,"background-offset-y","units",n),J=c(r,"background-offset-y","pfValue",n);Y==="%"?Q+=(E-G)*J:Q+=J,_.pathCache&&(O-=o,Q-=l,o=0,l=0);var ie=t.globalAlpha;t.globalAlpha=R;var de=a.getImgSmoothing(t),he=!1;if(I==="no"&&de?(a.setImgSmoothing(t,!1),he=!0):I==="yes"&&!de&&(a.setImgSmoothing(t,!0),he=!0),p==="no-repeat")N&&(t.save(),_.pathCache?t.clip(_.pathCache):(a.nodeShapes[a.getNodeShape(r)].draw(t,o,l,w,E,F,_),t.clip())),a.safeDrawImage(t,e,0,0,D,j,O,Q,B,G),N&&t.restore();else{var xe=t.createPattern(e,p);t.fillStyle=xe,a.nodeShapes[a.getNodeShape(r)].draw(t,o,l,w,E,F,_),t.translate(O,Q),t.fill(),t.translate(-O,-Q)}t.globalAlpha=ie,he&&a.setImgSmoothing(t,de)}};var Mh={};Mh.eleTextBiggerThanMin=function(t,e){if(!e){var r=t.cy().zoom(),n=this.getPixelRatio(),i=Math.ceil(r_(r*n));e=Math.pow(2,i)}var a=t.pstyle("font-size").pfValue*e,s=t.pstyle("min-zoomed-font-size").pfValue;return!(a<s)};Mh.drawElementText=function(t,e,r,n,i){var a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!0,s=this;if(n==null){if(a&&!s.eleTextBiggerThanMin(e))return}else if(n===!1)return;if(e.isNode()){var o=e.pstyle("label");if(!o||!o.value)return;var l=s.getLabelJustification(e);t.textAlign=l,t.textBaseline="bottom"}else{var u=e.element()._private.rscratch.badLine,c=e.pstyle("label"),f=e.pstyle("source-label"),p=e.pstyle("target-label");if(u||(!c||!c.value)&&(!f||!f.value)&&(!p||!p.value))return;t.textAlign="center",t.textBaseline="bottom"}var v=!r,y;r&&(y=r,t.translate(-y.x1,-y.y1)),i==null?(s.drawText(t,e,null,v,a),e.isEdge()&&(s.drawText(t,e,"source",v,a),s.drawText(t,e,"target",v,a))):s.drawText(t,e,i,v,a),r&&t.translate(y.x1,y.y1)};Mh.getFontCache=function(t){var e;this.fontCaches=this.fontCaches||[];for(var r=0;r<this.fontCaches.length;r++)if(e=this.fontCaches[r],e.context===t)return e;return e={context:t},this.fontCaches.push(e),e};Mh.setupTextStyle=function(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,n=e.pstyle("font-style").strValue,i=e.pstyle("font-size").pfValue+"px",a=e.pstyle("font-family").strValue,s=e.pstyle("font-weight").strValue,o=r?e.effectiveOpacity()*e.pstyle("text-opacity").value:1,l=e.pstyle("text-outline-opacity").value*o,u=e.pstyle("color").value,c=e.pstyle("text-outline-color").value;t.font=n+" "+s+" "+i+" "+a,t.lineJoin="round",this.colorFillStyle(t,u[0],u[1],u[2],o),this.colorStrokeStyle(t,c[0],c[1],c[2],l)};function oU(t,e,r,n,i){var a=Math.min(n,i),s=a/2,o=e+n/2,l=r+i/2;t.beginPath(),t.arc(o,l,s,0,Math.PI*2),t.closePath()}function WN(t,e,r,n,i){var a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:5,s=Math.min(a,n/2,i/2);t.beginPath(),t.moveTo(e+s,r),t.lineTo(e+n-s,r),t.quadraticCurveTo(e+n,r,e+n,r+s),t.lineTo(e+n,r+i-s),t.quadraticCurveTo(e+n,r+i,e+n-s,r+i),t.lineTo(e+s,r+i),t.quadraticCurveTo(e,r+i,e,r+i-s),t.lineTo(e,r+s),t.quadraticCurveTo(e,r,e+s,r),t.closePath()}Mh.getTextAngle=function(t,e){var r,n=t._private,i=n.rscratch,a=e?e+"-":"",s=t.pstyle(a+"text-rotation");if(s.strValue==="autorotate"){var o=$s(i,"labelAngle",e);r=t.isEdge()?o:0}else s.strValue==="none"?r=0:r=s.pfValue;return r};Mh.drawText=function(t,e,r){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,a=e._private,s=a.rscratch,o=i?e.effectiveOpacity():1;if(!(i&&(o===0||e.pstyle("text-opacity").value===0))){r==="main"&&(r=null);var l=$s(s,"labelX",r),u=$s(s,"labelY",r),c,f,p=this.getLabelText(e,r);if(p!=null&&p!==""&&!isNaN(l)&&!isNaN(u)){this.setupTextStyle(t,e,i);var v=r?r+"-":"",y=$s(s,"labelWidth",r),S=$s(s,"labelHeight",r),w=e.pstyle(v+"text-margin-x").pfValue,E=e.pstyle(v+"text-margin-y").pfValue,_=e.isEdge(),T=e.pstyle("text-halign").value,N=e.pstyle("text-valign").value;_&&(T="center",N="center"),l+=w,u+=E;var R;switch(n?R=this.getTextAngle(e,r):R=0,R!==0&&(c=l,f=u,t.translate(c,f),t.rotate(R),l=0,u=0),N){case"top":break;case"center":u+=S/2;break;case"bottom":u+=S;break}var I=e.pstyle("text-background-opacity").value,F=e.pstyle("text-border-opacity").value,D=e.pstyle("text-border-width").pfValue,j=e.pstyle("text-background-padding").pfValue,B=e.pstyle("text-background-shape").strValue,G=B==="round-rectangle"||B==="roundrectangle",K=B==="circle",O=2;if(I>0||D>0&&F>0){var W=t.fillStyle,U=t.strokeStyle,q=t.lineWidth,Z=e.pstyle("text-background-color").value,Q=e.pstyle("text-border-color").value,ne=e.pstyle("text-border-style").value,re=I>0,Y=D>0&&F>0,J=l-j;switch(T){case"left":J-=y;break;case"center":J-=y/2;break}var ie=u-S-j,de=y+2*j,he=S+2*j;if(re&&(t.fillStyle="rgba(".concat(Z[0],",").concat(Z[1],",").concat(Z[2],",").concat(I*o,")")),Y&&(t.strokeStyle="rgba(".concat(Q[0],",").concat(Q[1],",").concat(Q[2],",").concat(F*o,")"),t.lineWidth=D,t.setLineDash))switch(ne){case"dotted":t.setLineDash([1,1]);break;case"dashed":t.setLineDash([4,2]);break;case"double":t.lineWidth=D/4,t.setLineDash([]);break;default:t.setLineDash([]);break}if(G?(t.beginPath(),WN(t,J,ie,de,he,O)):K?(t.beginPath(),oU(t,J,ie,de,he)):(t.beginPath(),t.rect(J,ie,de,he)),re&&t.fill(),Y&&t.stroke(),Y&&ne==="double"){var xe=D/2;t.beginPath(),G?WN(t,J+xe,ie+xe,de-2*xe,he-2*xe,O):t.rect(J+xe,ie+xe,de-2*xe,he-2*xe),t.stroke()}t.fillStyle=W,t.strokeStyle=U,t.lineWidth=q,t.setLineDash&&t.setLineDash([])}var le=2*e.pstyle("text-outline-width").pfValue;if(le>0&&(t.lineWidth=le),e.pstyle("text-wrap").value==="wrap"){var fe=$s(s,"labelWrapCachedLines",r),ve=$s(s,"labelLineHeight",r),ge=y/2,se=this.getLabelJustification(e);switch(se==="auto"||(T==="left"?se==="left"?l+=-y:se==="center"&&(l+=-ge):T==="center"?se==="left"?l+=-ge:se==="right"&&(l+=ge):T==="right"&&(se==="center"?l+=ge:se==="right"&&(l+=y))),N){case"top":u-=(fe.length-1)*ve;break;case"center":case"bottom":u-=(fe.length-1)*ve;break}for(var ye=0;ye<fe.length;ye++)le>0&&t.strokeText(fe[ye],l,u),t.fillText(fe[ye],l,u),u+=ve}else le>0&&t.strokeText(p,l,u),t.fillText(p,l,u);R!==0&&(t.rotate(-R),t.translate(-c,-f))}}};var uf={};uf.drawNode=function(t,e,r){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!0,s=this,o,l,u=e._private,c=u.rscratch,f=e.position();if(!(!bt(f.x)||!bt(f.y))&&!(a&&!e.visible())){var p=a?e.effectiveOpacity():1,v=s.usePaths(),y,S=!1,w=e.padding();o=e.width()+2*w,l=e.height()+2*w;var E;r&&(E=r,t.translate(-E.x1,-E.y1));for(var _=e.pstyle("background-image"),T=_.value,N=new Array(T.length),R=new Array(T.length),I=0,F=0;F<T.length;F++){var D=T[F],j=N[F]=D!=null&&D!=="none";if(j){var B=e.cy().style().getIndexedStyle(e,"background-image-crossorigin","value",F);I++,R[F]=s.getCachedImage(D,B,function(){u.backgroundTimestamp=Date.now(),e.emitAndNotify("background")})}}var G=e.pstyle("background-blacken").value,K=e.pstyle("border-width").pfValue,O=e.pstyle("background-opacity").value*p,W=e.pstyle("border-color").value,U=e.pstyle("border-style").value,q=e.pstyle("border-join").value,Z=e.pstyle("border-cap").value,Q=e.pstyle("border-position").value,ne=e.pstyle("border-dash-pattern").pfValue,re=e.pstyle("border-dash-offset").pfValue,Y=e.pstyle("border-opacity").value*p,J=e.pstyle("outline-width").pfValue,ie=e.pstyle("outline-color").value,de=e.pstyle("outline-style").value,he=e.pstyle("outline-opacity").value*p,xe=e.pstyle("outline-offset").value,le=e.pstyle("corner-radius").value;le!=="auto"&&(le=e.pstyle("corner-radius").pfValue);var fe=function(){var dt=arguments.length>0&&arguments[0]!==void 0?arguments[0]:O;s.eleFillStyle(t,e,dt)},ve=function(){var dt=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Y;s.colorStrokeStyle(t,W[0],W[1],W[2],dt)},ge=function(){var dt=arguments.length>0&&arguments[0]!==void 0?arguments[0]:he;s.colorStrokeStyle(t,ie[0],ie[1],ie[2],dt)},se=function(dt,Ge,ce,me){var ke=s.nodePathCache=s.nodePathCache||[],Te=zM(ce==="polygon"?ce+","+me.join(","):ce,""+Ge,""+dt,""+le),Ae=ke[Te],Xe,Ve=!1;return Ae!=null?(Xe=Ae,Ve=!0,c.pathCache=Xe):(Xe=new Path2D,ke[Te]=c.pathCache=Xe),{path:Xe,cacheHit:Ve}},ye=e.pstyle("shape").strValue,Se=e.pstyle("shape-polygon-points").pfValue;if(v){t.translate(f.x,f.y);var Ue=se(o,l,ye,Se);y=Ue.path,S=Ue.cacheHit}var Oe=function(){if(!S){var dt=f;v&&(dt={x:0,y:0}),s.nodeShapes[s.getNodeShape(e)].draw(y||t,dt.x,dt.y,o,l,le,c)}v?t.fill(y):t.fill()},mt=function(){for(var dt=arguments.length>0&&arguments[0]!==void 0?arguments[0]:p,Ge=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,ce=u.backgrounding,me=0,ke=0;ke<R.length;ke++){var Te=e.cy().style().getIndexedStyle(e,"background-image-containment","value",ke);if(Ge&&Te==="over"||!Ge&&Te==="inside"){me++;continue}N[ke]&&R[ke].complete&&!R[ke].error&&(me++,s.drawInscribedImage(t,R[ke],e,ke,dt))}u.backgrounding=me!==I,ce!==u.backgrounding&&e.updateStyle(!1)},lt=function(){var dt=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,Ge=arguments.length>1&&arguments[1]!==void 0?arguments[1]:p;s.hasPie(e)&&(s.drawPie(t,e,Ge),dt&&(v||s.nodeShapes[s.getNodeShape(e)].draw(t,f.x,f.y,o,l,le,c)))},at=function(){var dt=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,Ge=arguments.length>1&&arguments[1]!==void 0?arguments[1]:p;s.hasStripe(e)&&(t.save(),v?t.clip(c.pathCache):(s.nodeShapes[s.getNodeShape(e)].draw(t,f.x,f.y,o,l,le,c),t.clip()),s.drawStripe(t,e,Ge),t.restore(),dt&&(v||s.nodeShapes[s.getNodeShape(e)].draw(t,f.x,f.y,o,l,le,c)))},wt=function(){var dt=arguments.length>0&&arguments[0]!==void 0?arguments[0]:p,Ge=(G>0?G:-G)*dt,ce=G>0?0:255;G!==0&&(s.colorFillStyle(t,ce,ce,ce,Ge),v?t.fill(y):t.fill())},$e=function(){if(K>0){if(t.lineWidth=K,t.lineCap=Z,t.lineJoin=q,t.setLineDash)switch(U){case"dotted":t.setLineDash([1,1]);break;case"dashed":t.setLineDash(ne),t.lineDashOffset=re;break;case"solid":case"double":t.setLineDash([]);break}if(Q!=="center"){if(t.save(),t.lineWidth*=2,Q==="inside")v?t.clip(y):t.clip();else{var dt=new Path2D;dt.rect(-o/2-K,-l/2-K,o+2*K,l+2*K),dt.addPath(y),t.clip(dt,"evenodd")}v?t.stroke(y):t.stroke(),t.restore()}else v?t.stroke(y):t.stroke();if(U==="double"){t.lineWidth=K/3;var Ge=t.globalCompositeOperation;t.globalCompositeOperation="destination-out",v?t.stroke(y):t.stroke(),t.globalCompositeOperation=Ge}t.setLineDash&&t.setLineDash([])}},Ce=function(){if(J>0){if(t.lineWidth=J,t.lineCap="butt",t.setLineDash)switch(de){case"dotted":t.setLineDash([1,1]);break;case"dashed":t.setLineDash([4,2]);break;case"solid":case"double":t.setLineDash([]);break}var dt=f;v&&(dt={x:0,y:0});var Ge=s.getNodeShape(e),ce=K;Q==="inside"&&(ce=0),Q==="outside"&&(ce*=2);var me=(o+ce+(J+xe))/o,ke=(l+ce+(J+xe))/l,Te=o*me,Ae=l*ke,Xe=s.nodeShapes[Ge].points,Ve;if(v){var yt=se(Te,Ae,Ge,Xe);Ve=yt.path}if(Ge==="ellipse")s.drawEllipsePath(Ve||t,dt.x,dt.y,Te,Ae);else if(["round-diamond","round-heptagon","round-hexagon","round-octagon","round-pentagon","round-polygon","round-triangle","round-tag"].includes(Ge)){var vt=0,ft=0,Zt=0;Ge==="round-diamond"?vt=(ce+xe+J)*1.4:Ge==="round-heptagon"?(vt=(ce+xe+J)*1.075,Zt=-(ce/2+xe+J)/35):Ge==="round-hexagon"?vt=(ce+xe+J)*1.12:Ge==="round-pentagon"?(vt=(ce+xe+J)*1.13,Zt=-(ce/2+xe+J)/15):Ge==="round-tag"?(vt=(ce+xe+J)*1.12,ft=(ce/2+J+xe)*.07):Ge==="round-triangle"&&(vt=(ce+xe+J)*(Math.PI/2),Zt=-(ce+xe/2+J)/Math.PI),vt!==0&&(me=(o+vt)/o,Te=o*me,["round-hexagon","round-tag"].includes(Ge)||(ke=(l+vt)/l,Ae=l*ke)),le=le==="auto"?YM(Te,Ae):le;for(var Ht=Te/2,Et=Ae/2,Wt=le+(ce+J+xe)/2,ar=new Array(Xe.length/2),Rr=new Array(Xe.length/2),kr=0;kr<Xe.length/2;kr++)ar[kr]={x:dt.x+ft+Ht*Xe[kr*2],y:dt.y+Zt+Et*Xe[kr*2+1]};var Qr,Jr,_r,fn,vr=ar.length;for(Jr=ar[vr-1],Qr=0;Qr<vr;Qr++)_r=ar[Qr%vr],fn=ar[(Qr+1)%vr],Rr[Qr]=g_(Jr,_r,fn,Wt),Jr=_r,_r=fn;s.drawRoundPolygonPath(Ve||t,dt.x+ft,dt.y+Zt,o*me,l*ke,Xe,Rr)}else if(["roundrectangle","round-rectangle"].includes(Ge))le=le==="auto"?Xd(Te,Ae):le,s.drawRoundRectanglePath(Ve||t,dt.x,dt.y,Te,Ae,le+(ce+J+xe)/2);else if(["cutrectangle","cut-rectangle"].includes(Ge))le=le==="auto"?a_():le,s.drawCutRectanglePath(Ve||t,dt.x,dt.y,Te,Ae,null,le+(ce+J+xe)/4);else if(["bottomroundrectangle","bottom-round-rectangle"].includes(Ge))le=le==="auto"?Xd(Te,Ae):le,s.drawBottomRoundRectanglePath(Ve||t,dt.x,dt.y,Te,Ae,le+(ce+J+xe)/2);else if(Ge==="barrel")s.drawBarrelPath(Ve||t,dt.x,dt.y,Te,Ae);else if(Ge.startsWith("polygon")||["rhomboid","right-rhomboid","round-tag","tag","vee"].includes(Ge)){var St=(ce+J+xe)/o;Xe=ox(lx(Xe,St)),s.drawPolygonPath(Ve||t,dt.x,dt.y,o,l,Xe)}else{var Br=(ce+J+xe)/o;Xe=ox(lx(Xe,-Br)),s.drawPolygonPath(Ve||t,dt.x,dt.y,o,l,Xe)}if(v?t.stroke(Ve):t.stroke(),de==="double"){t.lineWidth=ce/3;var Xn=t.globalCompositeOperation;t.globalCompositeOperation="destination-out",v?t.stroke(Ve):t.stroke(),t.globalCompositeOperation=Xn}t.setLineDash&&t.setLineDash([])}},Ie=function(){i&&s.drawNodeOverlay(t,e,f,o,l)},Je=function(){i&&s.drawNodeUnderlay(t,e,f,o,l)},Qe=function(){s.drawElementText(t,e,null,n)},gt=e.pstyle("ghost").value==="yes";if(gt){var At=e.pstyle("ghost-offset-x").pfValue,Rt=e.pstyle("ghost-offset-y").pfValue,Ut=e.pstyle("ghost-opacity").value,Vt=Ut*p;t.translate(At,Rt),ge(),Ce(),fe(Ut*O),Oe(),mt(Vt,!0),ve(Ut*Y),$e(),lt(G!==0||K!==0),at(G!==0||K!==0),mt(Vt,!1),wt(Vt),t.translate(-At,-Rt)}v&&t.translate(-f.x,-f.y),Je(),v&&t.translate(f.x,f.y),ge(),Ce(),fe(),Oe(),mt(p,!0),ve(),$e(),lt(G!==0||K!==0),at(G!==0||K!==0),mt(p,!1),wt(),v&&t.translate(-f.x,-f.y),Qe(),Ie(),r&&t.translate(E.x1,E.y1)}};var rR=function(e){if(!["overlay","underlay"].includes(e))throw new Error("Invalid state");return function(r,n,i,a,s){var o=this;if(n.visible()){var l=n.pstyle("".concat(e,"-padding")).pfValue,u=n.pstyle("".concat(e,"-opacity")).value,c=n.pstyle("".concat(e,"-color")).value,f=n.pstyle("".concat(e,"-shape")).value,p=n.pstyle("".concat(e,"-corner-radius")).value;if(u>0){if(i=i||n.position(),a==null||s==null){var v=n.padding();a=n.width()+2*v,s=n.height()+2*v}o.colorFillStyle(r,c[0],c[1],c[2],u),o.nodeShapes[f].draw(r,i.x,i.y,a+l*2,s+l*2,p),r.fill()}}}};uf.drawNodeOverlay=rR("overlay");uf.drawNodeUnderlay=rR("underlay");uf.hasPie=function(t){return t=t[0],t._private.hasPie};uf.hasStripe=function(t){return t=t[0],t._private.hasStripe};uf.drawPie=function(t,e,r,n){e=e[0],n=n||e.position();var i=e.cy().style(),a=e.pstyle("pie-size"),s=e.pstyle("pie-hole"),o=e.pstyle("pie-start-angle").pfValue,l=n.x,u=n.y,c=e.width(),f=e.height(),p=Math.min(c,f)/2,v,y=0,S=this.usePaths();if(S&&(l=0,u=0),a.units==="%"?p=p*a.pfValue:a.pfValue!==void 0&&(p=a.pfValue/2),s.units==="%"?v=p*s.pfValue:s.pfValue!==void 0&&(v=s.pfValue/2),!(v>=p))for(var w=1;w<=i.pieBackgroundN;w++){var E=e.pstyle("pie-"+w+"-background-size").value,_=e.pstyle("pie-"+w+"-background-color").value,T=e.pstyle("pie-"+w+"-background-opacity").value*r,N=E/100;N+y>1&&(N=1-y);var R=1.5*Math.PI+2*Math.PI*y;R+=o;var I=2*Math.PI*N,F=R+I;E===0||y>=1||y+N>1||(v===0?(t.beginPath(),t.moveTo(l,u),t.arc(l,u,p,R,F),t.closePath()):(t.beginPath(),t.arc(l,u,p,R,F),t.arc(l,u,v,F,R,!0),t.closePath()),this.colorFillStyle(t,_[0],_[1],_[2],T),t.fill(),y+=N)}};uf.drawStripe=function(t,e,r,n){e=e[0],n=n||e.position();var i=e.cy().style(),a=n.x,s=n.y,o=e.width(),l=e.height(),u=0,c=this.usePaths();t.save();var f=e.pstyle("stripe-direction").value,p=e.pstyle("stripe-size");switch(f){case"vertical":break;case"righward":t.rotate(-Math.PI/2);break}var v=o,y=l;p.units==="%"?(v=v*p.pfValue,y=y*p.pfValue):p.pfValue!==void 0&&(v=p.pfValue,y=p.pfValue),c&&(a=0,s=0),s-=v/2,a-=y/2;for(var S=1;S<=i.stripeBackgroundN;S++){var w=e.pstyle("stripe-"+S+"-background-size").value,E=e.pstyle("stripe-"+S+"-background-color").value,_=e.pstyle("stripe-"+S+"-background-opacity").value*r,T=w/100;T+u>1&&(T=1-u),!(w===0||u>=1||u+T>1)&&(t.beginPath(),t.rect(a,s+y*u,v,y*T),t.closePath(),this.colorFillStyle(t,E[0],E[1],E[2],_),t.fill(),u+=T)}t.restore()};var Ms={},lU=100;Ms.getPixelRatio=function(){var t=this.data.contexts[0];if(this.forcedPixelRatio!=null)return this.forcedPixelRatio;var e=this.cy.window(),r=t.backingStorePixelRatio||t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1;return(e.devicePixelRatio||1)/r};Ms.paintCache=function(t){for(var e=this.paintCaches=this.paintCaches||[],r=!0,n,i=0;i<e.length;i++)if(n=e[i],n.context===t){r=!1;break}return r&&(n={context:t},e.push(n)),n};Ms.createGradientStyleFor=function(t,e,r,n,i){var a,s=this.usePaths(),o=r.pstyle(e+"-gradient-stop-colors").value,l=r.pstyle(e+"-gradient-stop-positions").pfValue;if(n==="radial-gradient")if(r.isEdge()){var u=r.sourceEndpoint(),c=r.targetEndpoint(),f=r.midpoint(),p=mh(u,f),v=mh(c,f);a=t.createRadialGradient(f.x,f.y,0,f.x,f.y,Math.max(p,v))}else{var y=s?{x:0,y:0}:r.position(),S=r.paddedWidth(),w=r.paddedHeight();a=t.createRadialGradient(y.x,y.y,0,y.x,y.y,Math.max(S,w))}else if(r.isEdge()){var E=r.sourceEndpoint(),_=r.targetEndpoint();a=t.createLinearGradient(E.x,E.y,_.x,_.y)}else{var T=s?{x:0,y:0}:r.position(),N=r.paddedWidth(),R=r.paddedHeight(),I=N/2,F=R/2,D=r.pstyle("background-gradient-direction").value;switch(D){case"to-bottom":a=t.createLinearGradient(T.x,T.y-F,T.x,T.y+F);break;case"to-top":a=t.createLinearGradient(T.x,T.y+F,T.x,T.y-F);break;case"to-left":a=t.createLinearGradient(T.x+I,T.y,T.x-I,T.y);break;case"to-right":a=t.createLinearGradient(T.x-I,T.y,T.x+I,T.y);break;case"to-bottom-right":case"to-right-bottom":a=t.createLinearGradient(T.x-I,T.y-F,T.x+I,T.y+F);break;case"to-top-right":case"to-right-top":a=t.createLinearGradient(T.x-I,T.y+F,T.x+I,T.y-F);break;case"to-bottom-left":case"to-left-bottom":a=t.createLinearGradient(T.x+I,T.y-F,T.x-I,T.y+F);break;case"to-top-left":case"to-left-top":a=t.createLinearGradient(T.x+I,T.y+F,T.x-I,T.y-F);break}}if(!a)return null;for(var j=l.length===o.length,B=o.length,G=0;G<B;G++)a.addColorStop(j?l[G]:G/(B-1),"rgba("+o[G][0]+","+o[G][1]+","+o[G][2]+","+i+")");return a};Ms.gradientFillStyle=function(t,e,r,n){var i=this.createGradientStyleFor(t,"background",e,r,n);if(!i)return null;t.fillStyle=i};Ms.colorFillStyle=function(t,e,r,n,i){t.fillStyle="rgba("+e+","+r+","+n+","+i+")"};Ms.eleFillStyle=function(t,e,r){var n=e.pstyle("background-fill").value;if(n==="linear-gradient"||n==="radial-gradient")this.gradientFillStyle(t,e,n,r);else{var i=e.pstyle("background-color").value;this.colorFillStyle(t,i[0],i[1],i[2],r)}};Ms.gradientStrokeStyle=function(t,e,r,n){var i=this.createGradientStyleFor(t,"line",e,r,n);if(!i)return null;t.strokeStyle=i};Ms.colorStrokeStyle=function(t,e,r,n,i){t.strokeStyle="rgba("+e+","+r+","+n+","+i+")"};Ms.eleStrokeStyle=function(t,e,r){var n=e.pstyle("line-fill").value;if(n==="linear-gradient"||n==="radial-gradient")this.gradientStrokeStyle(t,e,n,r);else{var i=e.pstyle("line-color").value;this.colorStrokeStyle(t,i[0],i[1],i[2],r)}};Ms.matchCanvasSize=function(t){var e=this,r=e.data,n=e.findContainerClientCoords(),i=n[2],a=n[3],s=e.getPixelRatio(),o=e.motionBlurPxRatio;(t===e.data.bufferCanvases[e.MOTIONBLUR_BUFFER_NODE]||t===e.data.bufferCanvases[e.MOTIONBLUR_BUFFER_DRAG])&&(s=o);var l=i*s,u=a*s,c;if(!(l===e.canvasWidth&&u===e.canvasHeight)){e.fontCaches=null;var f=r.canvasContainer;f.style.width=i+"px",f.style.height=a+"px";for(var p=0;p<e.CANVAS_LAYERS;p++)c=r.canvases[p],c.width=l,c.height=u,c.style.width=i+"px",c.style.height=a+"px";for(var p=0;p<e.BUFFER_COUNT;p++)c=r.bufferCanvases[p],c.width=l,c.height=u,c.style.width=i+"px",c.style.height=a+"px";e.textureMult=1,s<=1&&(c=r.bufferCanvases[e.TEXTURE_BUFFER],e.textureMult=2,c.width=l*e.textureMult,c.height=u*e.textureMult),e.canvasWidth=l,e.canvasHeight=u,e.pixelRatio=s}};Ms.renderTo=function(t,e,r,n){this.render({forcedContext:t,forcedZoom:e,forcedPan:r,drawAllLayers:!0,forcedPxRatio:n})};Ms.clearCanvas=function(){var t=this,e=t.data;function r(n){n.clearRect(0,0,t.canvasWidth,t.canvasHeight)}r(e.contexts[t.NODE]),r(e.contexts[t.DRAG])};Ms.render=function(t){var e=this;t=t||HM();var r=e.cy,n=t.forcedContext,i=t.drawAllLayers,a=t.drawOnlyNodeLayer,s=t.forcedZoom,o=t.forcedPan,l=t.forcedPxRatio===void 0?this.getPixelRatio():t.forcedPxRatio,u=e.data,c=u.canvasNeedsRedraw,f=e.textureOnViewport&&!n&&(e.pinching||e.hoverData.dragging||e.swipePanning||e.data.wheelZooming),p=t.motionBlur!==void 0?t.motionBlur:e.motionBlur,v=e.motionBlurPxRatio,y=r.hasCompoundNodes(),S=e.hoverData.draggingEles,w=!!(e.hoverData.selecting||e.touchData.selecting);p=p&&!n&&e.motionBlurEnabled&&!w;var E=p;n||(e.prevPxRatio!==l&&(e.invalidateContainerClientCoordsCache(),e.matchCanvasSize(e.container),e.redrawHint("eles",!0),e.redrawHint("drag",!0)),e.prevPxRatio=l),!n&&e.motionBlurTimeout&&clearTimeout(e.motionBlurTimeout),p&&(e.mbFrames==null&&(e.mbFrames=0),e.mbFrames++,e.mbFrames<3&&(E=!1),e.mbFrames>e.minMbLowQualFrames&&(e.motionBlurPxRatio=e.mbPxRBlurry)),e.clearingMotionBlur&&(e.motionBlurPxRatio=1),e.textureDrawLastFrame&&!f&&(c[e.NODE]=!0,c[e.SELECT_BOX]=!0);var _=r.style(),T=r.zoom(),N=s!==void 0?s:T,R=r.pan(),I={x:R.x,y:R.y},F={zoom:T,pan:{x:R.x,y:R.y}},D=e.prevViewport,j=D===void 0||F.zoom!==D.zoom||F.pan.x!==D.pan.x||F.pan.y!==D.pan.y;!j&&!(S&&!y)&&(e.motionBlurPxRatio=1),o&&(I=o),N*=l,I.x*=l,I.y*=l;var B=e.getCachedZSortedEles();function G(ve,ge,se,ye,Se){var Ue=ve.globalCompositeOperation;ve.globalCompositeOperation="destination-out",e.colorFillStyle(ve,255,255,255,e.motionBlurTransparency),ve.fillRect(ge,se,ye,Se),ve.globalCompositeOperation=Ue}function K(ve,ge){var se,ye,Se,Ue;!e.clearingMotionBlur&&(ve===u.bufferContexts[e.MOTIONBLUR_BUFFER_NODE]||ve===u.bufferContexts[e.MOTIONBLUR_BUFFER_DRAG])?(se={x:R.x*v,y:R.y*v},ye=T*v,Se=e.canvasWidth*v,Ue=e.canvasHeight*v):(se=I,ye=N,Se=e.canvasWidth,Ue=e.canvasHeight),ve.setTransform(1,0,0,1,0,0),ge==="motionBlur"?G(ve,0,0,Se,Ue):!n&&(ge===void 0||ge)&&ve.clearRect(0,0,Se,Ue),i||(ve.translate(se.x,se.y),ve.scale(ye,ye)),o&&ve.translate(o.x,o.y),s&&ve.scale(s,s)}if(f||(e.textureDrawLastFrame=!1),f){if(e.textureDrawLastFrame=!0,!e.textureCache){e.textureCache={},e.textureCache.bb=r.mutableElements().boundingBox(),e.textureCache.texture=e.data.bufferCanvases[e.TEXTURE_BUFFER];var O=e.data.bufferContexts[e.TEXTURE_BUFFER];O.setTransform(1,0,0,1,0,0),O.clearRect(0,0,e.canvasWidth*e.textureMult,e.canvasHeight*e.textureMult),e.render({forcedContext:O,drawOnlyNodeLayer:!0,forcedPxRatio:l*e.textureMult});var F=e.textureCache.viewport={zoom:r.zoom(),pan:r.pan(),width:e.canvasWidth,height:e.canvasHeight};F.mpan={x:(0-F.pan.x)/F.zoom,y:(0-F.pan.y)/F.zoom}}c[e.DRAG]=!1,c[e.NODE]=!1;var W=u.contexts[e.NODE],U=e.textureCache.texture,F=e.textureCache.viewport;W.setTransform(1,0,0,1,0,0),p?G(W,0,0,F.width,F.height):W.clearRect(0,0,F.width,F.height);var q=_.core("outside-texture-bg-color").value,Z=_.core("outside-texture-bg-opacity").value;e.colorFillStyle(W,q[0],q[1],q[2],Z),W.fillRect(0,0,F.width,F.height);var T=r.zoom();K(W,!1),W.clearRect(F.mpan.x,F.mpan.y,F.width/F.zoom/l,F.height/F.zoom/l),W.drawImage(U,F.mpan.x,F.mpan.y,F.width/F.zoom/l,F.height/F.zoom/l)}else e.textureOnViewport&&!n&&(e.textureCache=null);var Q=r.extent(),ne=e.pinching||e.hoverData.dragging||e.swipePanning||e.data.wheelZooming||e.hoverData.draggingEles||e.cy.animated(),re=e.hideEdgesOnViewport&&ne,Y=[];if(Y[e.NODE]=!c[e.NODE]&&p&&!e.clearedForMotionBlur[e.NODE]||e.clearingMotionBlur,Y[e.NODE]&&(e.clearedForMotionBlur[e.NODE]=!0),Y[e.DRAG]=!c[e.DRAG]&&p&&!e.clearedForMotionBlur[e.DRAG]||e.clearingMotionBlur,Y[e.DRAG]&&(e.clearedForMotionBlur[e.DRAG]=!0),c[e.NODE]||i||a||Y[e.NODE]){var J=p&&!Y[e.NODE]&&v!==1,W=n||(J?e.data.bufferContexts[e.MOTIONBLUR_BUFFER_NODE]:u.contexts[e.NODE]),ie=p&&!J?"motionBlur":void 0;K(W,ie),re?e.drawCachedNodes(W,B.nondrag,l,Q):e.drawLayeredElements(W,B.nondrag,l,Q),e.debug&&e.drawDebugPoints(W,B.nondrag),!i&&!p&&(c[e.NODE]=!1)}if(!a&&(c[e.DRAG]||i||Y[e.DRAG])){var J=p&&!Y[e.DRAG]&&v!==1,W=n||(J?e.data.bufferContexts[e.MOTIONBLUR_BUFFER_DRAG]:u.contexts[e.DRAG]);K(W,p&&!J?"motionBlur":void 0),re?e.drawCachedNodes(W,B.drag,l,Q):e.drawCachedElements(W,B.drag,l,Q),e.debug&&e.drawDebugPoints(W,B.drag),!i&&!p&&(c[e.DRAG]=!1)}if(this.drawSelectionRectangle(t,K),p&&v!==1){var de=u.contexts[e.NODE],he=e.data.bufferCanvases[e.MOTIONBLUR_BUFFER_NODE],xe=u.contexts[e.DRAG],le=e.data.bufferCanvases[e.MOTIONBLUR_BUFFER_DRAG],fe=function(ge,se,ye){ge.setTransform(1,0,0,1,0,0),ye||!E?ge.clearRect(0,0,e.canvasWidth,e.canvasHeight):G(ge,0,0,e.canvasWidth,e.canvasHeight);var Se=v;ge.drawImage(se,0,0,e.canvasWidth*Se,e.canvasHeight*Se,0,0,e.canvasWidth,e.canvasHeight)};(c[e.NODE]||Y[e.NODE])&&(fe(de,he,Y[e.NODE]),c[e.NODE]=!1),(c[e.DRAG]||Y[e.DRAG])&&(fe(xe,le,Y[e.DRAG]),c[e.DRAG]=!1)}e.prevViewport=F,e.clearingMotionBlur&&(e.clearingMotionBlur=!1,e.motionBlurCleared=!0,e.motionBlur=!0),p&&(e.motionBlurTimeout=setTimeout(function(){e.motionBlurTimeout=null,e.clearedForMotionBlur[e.NODE]=!1,e.clearedForMotionBlur[e.DRAG]=!1,e.motionBlur=!1,e.clearingMotionBlur=!f,e.mbFrames=0,c[e.NODE]=!0,c[e.DRAG]=!0,e.redraw()},lU)),n||r.emit("render")};var Wm;Ms.drawSelectionRectangle=function(t,e){var r=this,n=r.cy,i=r.data,a=n.style(),s=t.drawOnlyNodeLayer,o=t.drawAllLayers,l=i.canvasNeedsRedraw,u=t.forcedContext;if(r.showFps||!s&&l[r.SELECT_BOX]&&!o){var c=u||i.contexts[r.SELECT_BOX];if(e(c),r.selection[4]==1&&(r.hoverData.selecting||r.touchData.selecting)){var f=r.cy.zoom(),p=a.core("selection-box-border-width").value/f;c.lineWidth=p,c.fillStyle="rgba("+a.core("selection-box-color").value[0]+","+a.core("selection-box-color").value[1]+","+a.core("selection-box-color").value[2]+","+a.core("selection-box-opacity").value+")",c.fillRect(r.selection[0],r.selection[1],r.selection[2]-r.selection[0],r.selection[3]-r.selection[1]),p>0&&(c.strokeStyle="rgba("+a.core("selection-box-border-color").value[0]+","+a.core("selection-box-border-color").value[1]+","+a.core("selection-box-border-color").value[2]+","+a.core("selection-box-opacity").value+")",c.strokeRect(r.selection[0],r.selection[1],r.selection[2]-r.selection[0],r.selection[3]-r.selection[1]))}if(i.bgActivePosistion&&!r.hoverData.selecting){var f=r.cy.zoom(),v=i.bgActivePosistion;c.fillStyle="rgba("+a.core("active-bg-color").value[0]+","+a.core("active-bg-color").value[1]+","+a.core("active-bg-color").value[2]+","+a.core("active-bg-opacity").value+")",c.beginPath(),c.arc(v.x,v.y,a.core("active-bg-size").pfValue/f,0,2*Math.PI),c.fill()}var y=r.lastRedrawTime;if(r.showFps&&y){y=Math.round(y);var S=Math.round(1e3/y),w="1 frame = "+y+" ms = "+S+" fps";if(c.setTransform(1,0,0,1,0,0),c.fillStyle="rgba(255, 0, 0, 0.75)",c.strokeStyle="rgba(255, 0, 0, 0.75)",c.font="30px Arial",!Wm){var E=c.measureText(w);Wm=E.actualBoundingBoxAscent}c.fillText(w,0,Wm);var _=60;c.strokeRect(0,Wm+10,250,20),c.fillRect(0,Wm+10,250*Math.min(S/_,1),20)}o||(l[r.SELECT_BOX]=!1)}};function qN(t,e,r){var n=t.createShader(e);if(t.shaderSource(n,r),t.compileShader(n),!t.getShaderParameter(n,t.COMPILE_STATUS))throw new Error(t.getShaderInfoLog(n));return n}function uU(t,e,r){var n=qN(t,t.VERTEX_SHADER,e),i=qN(t,t.FRAGMENT_SHADER,r),a=t.createProgram();if(t.attachShader(a,n),t.attachShader(a,i),t.linkProgram(a),!t.getProgramParameter(a,t.LINK_STATUS))throw new Error("Could not initialize shaders");return a}function cU(t,e,r){r===void 0&&(r=e);var n=t.makeOffscreenCanvas(e,r),i=n.context=n.getContext("2d");return n.clear=function(){return i.clearRect(0,0,n.width,n.height)},n.clear(),n}function x_(t){var e=t.pixelRatio,r=t.cy.zoom(),n=t.cy.pan();return{zoom:r*e,pan:{x:n.x*e,y:n.y*e}}}function dU(t){var e=t.pixelRatio,r=t.cy.zoom();return r*e}function fU(t,e,r,n,i){var a=n*r+e.x,s=i*r+e.y;return s=Math.round(t.canvasHeight-s),[a,s]}function hU(t){return t.pstyle("background-fill").value!=="solid"||t.pstyle("background-image").strValue!=="none"?!1:t.pstyle("border-width").value===0||t.pstyle("border-opacity").value===0?!0:t.pstyle("border-style").value==="solid"}function pU(t,e){if(t.length!==e.length)return!1;for(var r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function Hf(t,e,r){var n=t[0]/255,i=t[1]/255,a=t[2]/255,s=e,o=r||new Array(4);return o[0]=n*s,o[1]=i*s,o[2]=a*s,o[3]=s,o}function vp(t,e){var r=e||new Array(4);return r[0]=(t>>0&255)/255,r[1]=(t>>8&255)/255,r[2]=(t>>16&255)/255,r[3]=(t>>24&255)/255,r}function mU(t){return t[0]+(t[1]<<8)+(t[2]<<16)+(t[3]<<24)}function gU(t,e){var r=t.createTexture();return r.buffer=function(n){t.bindTexture(t.TEXTURE_2D,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR_MIPMAP_NEAREST),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n),t.generateMipmap(t.TEXTURE_2D),t.bindTexture(t.TEXTURE_2D,null)},r.deleteTexture=function(){t.deleteTexture(r)},r}function nR(t,e){switch(e){case"float":return[1,t.FLOAT,4];case"vec2":return[2,t.FLOAT,4];case"vec3":return[3,t.FLOAT,4];case"vec4":return[4,t.FLOAT,4];case"int":return[1,t.INT,4];case"ivec2":return[2,t.INT,4]}}function iR(t,e,r){switch(e){case t.FLOAT:return new Float32Array(r);case t.INT:return new Int32Array(r)}}function vU(t,e,r,n,i,a){switch(e){case t.FLOAT:return new Float32Array(r.buffer,a*n,i);case t.INT:return new Int32Array(r.buffer,a*n,i)}}function yU(t,e,r,n){var i=nR(t,e),a=Di(i,2),s=a[0],o=a[1],l=iR(t,o,n),u=t.createBuffer();return t.bindBuffer(t.ARRAY_BUFFER,u),t.bufferData(t.ARRAY_BUFFER,l,t.STATIC_DRAW),o===t.FLOAT?t.vertexAttribPointer(r,s,o,!1,0,0):o===t.INT&&t.vertexAttribIPointer(r,s,o,0,0),t.enableVertexAttribArray(r),t.bindBuffer(t.ARRAY_BUFFER,null),u}function vu(t,e,r,n){var i=nR(t,r),a=Di(i,3),s=a[0],o=a[1],l=a[2],u=iR(t,o,e*s),c=s*l,f=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,f),t.bufferData(t.ARRAY_BUFFER,e*c,t.DYNAMIC_DRAW),t.enableVertexAttribArray(n),o===t.FLOAT?t.vertexAttribPointer(n,s,o,!1,c,0):o===t.INT&&t.vertexAttribIPointer(n,s,o,c,0),t.vertexAttribDivisor(n,1),t.bindBuffer(t.ARRAY_BUFFER,null);for(var p=new Array(e),v=0;v<e;v++)p[v]=vU(t,o,u,c,s,v);return f.dataArray=u,f.stride=c,f.size=s,f.getView=function(y){return p[y]},f.setPoint=function(y,S,w){var E=p[y];E[0]=S,E[1]=w},f.bufferSubData=function(y){t.bindBuffer(t.ARRAY_BUFFER,f),y?t.bufferSubData(t.ARRAY_BUFFER,0,u,0,y*s):t.bufferSubData(t.ARRAY_BUFFER,0,u)},f}function xU(t,e,r){for(var n=9,i=new Float32Array(e*n),a=new Array(e),s=0;s<e;s++){var o=s*n*4;a[s]=new Float32Array(i.buffer,o,n)}var l=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,l),t.bufferData(t.ARRAY_BUFFER,i.byteLength,t.DYNAMIC_DRAW);for(var u=0;u<3;u++){var c=r+u;t.enableVertexAttribArray(c),t.vertexAttribPointer(c,3,t.FLOAT,!1,36,u*12),t.vertexAttribDivisor(c,1)}return t.bindBuffer(t.ARRAY_BUFFER,null),l.getMatrixView=function(f){return a[f]},l.setData=function(f,p){a[p].set(f,0)},l.bufferSubData=function(){t.bindBuffer(t.ARRAY_BUFFER,l),t.bufferSubData(t.ARRAY_BUFFER,0,i)},l}function bU(t){var e=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,e);var r=t.createTexture();return t.bindTexture(t.TEXTURE_2D,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r,0),t.bindFramebuffer(t.FRAMEBUFFER,null),e.setFramebufferAttachmentSizes=function(n,i){t.bindTexture(t.TEXTURE_2D,r),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,n,i,0,t.RGBA,t.UNSIGNED_BYTE,null)},e}var $N=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});function p2(){var t=new $N(9);return $N!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function KN(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function wU(t,e,r){var n=e[0],i=e[1],a=e[2],s=e[3],o=e[4],l=e[5],u=e[6],c=e[7],f=e[8],p=r[0],v=r[1],y=r[2],S=r[3],w=r[4],E=r[5],_=r[6],T=r[7],N=r[8];return t[0]=p*n+v*s+y*u,t[1]=p*i+v*o+y*c,t[2]=p*a+v*l+y*f,t[3]=S*n+w*s+E*u,t[4]=S*i+w*o+E*c,t[5]=S*a+w*l+E*f,t[6]=_*n+T*s+N*u,t[7]=_*i+T*o+N*c,t[8]=_*a+T*l+N*f,t}function Hy(t,e,r){var n=e[0],i=e[1],a=e[2],s=e[3],o=e[4],l=e[5],u=e[6],c=e[7],f=e[8],p=r[0],v=r[1];return t[0]=n,t[1]=i,t[2]=a,t[3]=s,t[4]=o,t[5]=l,t[6]=p*n+v*s+u,t[7]=p*i+v*o+c,t[8]=p*a+v*l+f,t}function ZN(t,e,r){var n=e[0],i=e[1],a=e[2],s=e[3],o=e[4],l=e[5],u=e[6],c=e[7],f=e[8],p=Math.sin(r),v=Math.cos(r);return t[0]=v*n+p*s,t[1]=v*i+p*o,t[2]=v*a+p*l,t[3]=v*s-p*n,t[4]=v*o-p*i,t[5]=v*l-p*a,t[6]=u,t[7]=c,t[8]=f,t}function ZS(t,e,r){var n=r[0],i=r[1];return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=i*e[3],t[4]=i*e[4],t[5]=i*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function SU(t,e,r){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/r,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}var kU=(function(){function t(e,r,n,i){sf(this,t),this.debugID=Math.floor(Math.random()*1e4),this.r=e,this.texSize=r,this.texRows=n,this.texHeight=Math.floor(r/n),this.enableWrapping=!0,this.locked=!1,this.texture=null,this.needsBuffer=!0,this.freePointer={x:0,row:0},this.keyToLocation=new Map,this.canvas=i(e,r,r),this.scratch=i(e,r,this.texHeight,"scratch")}return of(t,[{key:"lock",value:function(){this.locked=!0}},{key:"getKeys",value:function(){return new Set(this.keyToLocation.keys())}},{key:"getScale",value:function(r){var n=r.w,i=r.h,a=this.texHeight,s=this.texSize,o=a/i,l=n*o,u=i*o;return l>s&&(o=s/n,l=n*o,u=i*o),{scale:o,texW:l,texH:u}}},{key:"draw",value:function(r,n,i){var a=this;if(this.locked)throw new Error("can't draw, atlas is locked");var s=this.texSize,o=this.texRows,l=this.texHeight,u=this.getScale(n),c=u.scale,f=u.texW,p=u.texH,v=function(T,N){if(i&&N){var R=N.context,I=T.x,F=T.row,D=I,j=l*F;R.save(),R.translate(D,j),R.scale(c,c),i(R,n),R.restore()}},y=[null,null],S=function(){v(a.freePointer,a.canvas),y[0]={x:a.freePointer.x,y:a.freePointer.row*l,w:f,h:p},y[1]={x:a.freePointer.x+f,y:a.freePointer.row*l,w:0,h:p},a.freePointer.x+=f,a.freePointer.x==s&&(a.freePointer.x=0,a.freePointer.row++)},w=function(){var T=a.scratch,N=a.canvas;T.clear(),v({x:0,row:0},T);var R=s-a.freePointer.x,I=f-R,F=l;{var D=a.freePointer.x,j=a.freePointer.row*l,B=R;N.context.drawImage(T,0,0,B,F,D,j,B,F),y[0]={x:D,y:j,w:B,h:p}}{var G=R,K=(a.freePointer.row+1)*l,O=I;N&&N.context.drawImage(T,G,0,O,F,0,K,O,F),y[1]={x:0,y:K,w:O,h:p}}a.freePointer.x=I,a.freePointer.row++},E=function(){a.freePointer.x=0,a.freePointer.row++};if(this.freePointer.x+f<=s)S();else{if(this.freePointer.row>=o-1)return!1;this.freePointer.x===s?(E(),S()):this.enableWrapping?w():(E(),S())}return this.keyToLocation.set(r,y),this.needsBuffer=!0,y}},{key:"getOffsets",value:function(r){return this.keyToLocation.get(r)}},{key:"isEmpty",value:function(){return this.freePointer.x===0&&this.freePointer.row===0}},{key:"canFit",value:function(r){if(this.locked)return!1;var n=this.texSize,i=this.texRows,a=this.getScale(r),s=a.texW;return this.freePointer.x+s>n?this.freePointer.row<i-1:!0}},{key:"bufferIfNeeded",value:function(r){this.texture||(this.texture=gU(r,this.debugID)),this.needsBuffer&&(this.texture.buffer(this.canvas),this.needsBuffer=!1,this.locked&&(this.canvas=null,this.scratch=null))}},{key:"dispose",value:function(){this.texture&&(this.texture.deleteTexture(),this.texture=null),this.canvas=null,this.scratch=null,this.locked=!0}}])})(),_U=(function(){function t(e,r,n,i){sf(this,t),this.r=e,this.texSize=r,this.texRows=n,this.createTextureCanvas=i,this.atlases=[],this.styleKeyToAtlas=new Map,this.markedKeys=new Set}return of(t,[{key:"getKeys",value:function(){return new Set(this.styleKeyToAtlas.keys())}},{key:"_createAtlas",value:function(){var r=this.r,n=this.texSize,i=this.texRows,a=this.createTextureCanvas;return new kU(r,n,i,a)}},{key:"_getScratchCanvas",value:function(){if(!this.scratch){var r=this.r,n=this.texSize,i=this.texRows,a=this.createTextureCanvas,s=Math.floor(n/i);this.scratch=a(r,n,s,"scratch")}return this.scratch}},{key:"draw",value:function(r,n,i){var a=this.styleKeyToAtlas.get(r);return a||(a=this.atlases[this.atlases.length-1],(!a||!a.canFit(n))&&(a&&a.lock(),a=this._createAtlas(),this.atlases.push(a)),a.draw(r,n,i),this.styleKeyToAtlas.set(r,a)),a}},{key:"getAtlas",value:function(r){return this.styleKeyToAtlas.get(r)}},{key:"hasAtlas",value:function(r){return this.styleKeyToAtlas.has(r)}},{key:"markKeyForGC",value:function(r){this.markedKeys.add(r)}},{key:"gc",value:function(){var r=this,n=this.markedKeys;if(n.size===0){console.log("nothing to garbage collect");return}var i=[],a=new Map,s=null,o=Ys(this.atlases),l;try{var u=function(){var f=l.value,p=f.getKeys(),v=CU(n,p);if(v.size===0)return i.push(f),p.forEach(function(R){return a.set(R,f)}),1;s||(s=r._createAtlas(),i.push(s));var y=Ys(p),S;try{for(y.s();!(S=y.n()).done;){var w=S.value;if(!v.has(w)){var E=f.getOffsets(w),_=Di(E,2),T=_[0],N=_[1];s.canFit({w:T.w+N.w,h:T.h})||(s.lock(),s=r._createAtlas(),i.push(s)),f.canvas&&(r._copyTextureToNewAtlas(w,f,s),a.set(w,s))}}}catch(R){y.e(R)}finally{y.f()}f.dispose()};for(o.s();!(l=o.n()).done;)u()}catch(c){o.e(c)}finally{o.f()}this.atlases=i,this.styleKeyToAtlas=a,this.markedKeys=new Set}},{key:"_copyTextureToNewAtlas",value:function(r,n,i){var a=n.getOffsets(r),s=Di(a,2),o=s[0],l=s[1];if(l.w===0)i.draw(r,o,function(p){p.drawImage(n.canvas,o.x,o.y,o.w,o.h,0,0,o.w,o.h)});else{var u=this._getScratchCanvas();u.clear(),u.context.drawImage(n.canvas,o.x,o.y,o.w,o.h,0,0,o.w,o.h),u.context.drawImage(n.canvas,l.x,l.y,l.w,l.h,o.w,0,l.w,l.h);var c=o.w+l.w,f=o.h;i.draw(r,{w:c,h:f},function(p){p.drawImage(u,0,0,c,f,0,0,c,f)})}}},{key:"getCounts",value:function(){return{keyCount:this.styleKeyToAtlas.size,atlasCount:new Set(this.styleKeyToAtlas.values()).size}}}])})();function CU(t,e){return t.intersection?t.intersection(e):new Set(nx(t).filter(function(r){return e.has(r)}))}var EU=(function(){function t(e,r){sf(this,t),this.r=e,this.globalOptions=r,this.atlasSize=r.webglTexSize,this.maxAtlasesPerBatch=r.webglTexPerBatch,this.renderTypes=new Map,this.collections=new Map,this.typeAndIdToKey=new Map}return of(t,[{key:"getAtlasSize",value:function(){return this.atlasSize}},{key:"addAtlasCollection",value:function(r,n){var i=this.globalOptions,a=i.webglTexSize,s=i.createTextureCanvas,o=n.texRows,l=this._cacheScratchCanvas(s),u=new _U(this.r,a,o,l);this.collections.set(r,u)}},{key:"addRenderType",value:function(r,n){var i=n.collection;if(!this.collections.has(i))throw new Error("invalid atlas collection name '".concat(i,"'"));var a=this.collections.get(i),s=ir({type:r,atlasCollection:a},n);this.renderTypes.set(r,s)}},{key:"getRenderTypeOpts",value:function(r){return this.renderTypes.get(r)}},{key:"getAtlasCollection",value:function(r){return this.collections.get(r)}},{key:"_cacheScratchCanvas",value:function(r){var n=-1,i=-1,a=null;return function(s,o,l,u){return u?((!a||o!=n||l!=i)&&(n=o,i=l,a=r(s,o,l)),a):r(s,o,l)}}},{key:"_key",value:function(r,n){return"".concat(r,"-").concat(n)}},{key:"invalidate",value:function(r){var n=this,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=i.forceRedraw,s=a===void 0?!1:a,o=i.filterEle,l=o===void 0?function(){return!0}:o,u=i.filterType,c=u===void 0?function(){return!0}:u,f=!1,p=!1,v=Ys(r),y;try{for(v.s();!(y=v.n()).done;){var S=y.value;if(l(S)){var w=Ys(this.renderTypes.values()),E;try{var _=function(){var N=E.value,R=N.type;if(c(R)){var I=n.collections.get(N.collection),F=N.getKey(S),D=Array.isArray(F)?F:[F];if(s)D.forEach(function(K){return I.markKeyForGC(K)}),p=!0;else{var j=N.getID?N.getID(S):S.id(),B=n._key(R,j),G=n.typeAndIdToKey.get(B);G!==void 0&&!pU(D,G)&&(f=!0,n.typeAndIdToKey.delete(B),G.forEach(function(K){return I.markKeyForGC(K)}))}}};for(w.s();!(E=w.n()).done;)_()}catch(T){w.e(T)}finally{w.f()}}}}catch(T){v.e(T)}finally{v.f()}return p&&(this.gc(),f=!1),f}},{key:"gc",value:function(){var r=Ys(this.collections.values()),n;try{for(r.s();!(n=r.n()).done;){var i=n.value;i.gc()}}catch(a){r.e(a)}finally{r.f()}}},{key:"getOrCreateAtlas",value:function(r,n,i,a){var s=this.renderTypes.get(n),o=this.collections.get(s.collection),l=!1,u=o.draw(a,i,function(p){s.drawClipped?(p.save(),p.beginPath(),p.rect(0,0,i.w,i.h),p.clip(),s.drawElement(p,r,i,!0,!0),p.restore()):s.drawElement(p,r,i,!0,!0),l=!0});if(l){var c=s.getID?s.getID(r):r.id(),f=this._key(n,c);this.typeAndIdToKey.has(f)?this.typeAndIdToKey.get(f).push(a):this.typeAndIdToKey.set(f,[a])}return u}},{key:"getAtlasInfo",value:function(r,n){var i=this,a=this.renderTypes.get(n),s=a.getKey(r),o=Array.isArray(s)?s:[s];return o.map(function(l){var u=a.getBoundingBox(r,l),c=i.getOrCreateAtlas(r,n,u,l),f=c.getOffsets(l),p=Di(f,2),v=p[0],y=p[1];return{atlas:c,tex:v,tex1:v,tex2:y,bb:u}})}},{key:"getDebugInfo",value:function(){var r=[],n=Ys(this.collections),i;try{for(n.s();!(i=n.n()).done;){var a=Di(i.value,2),s=a[0],o=a[1],l=o.getCounts(),u=l.keyCount,c=l.atlasCount;r.push({type:s,keyCount:u,atlasCount:c})}}catch(f){n.e(f)}finally{n.f()}return r}}])})(),TU=(function(){function t(e){sf(this,t),this.globalOptions=e,this.atlasSize=e.webglTexSize,this.maxAtlasesPerBatch=e.webglTexPerBatch,this.batchAtlases=[]}return of(t,[{key:"getMaxAtlasesPerBatch",value:function(){return this.maxAtlasesPerBatch}},{key:"getAtlasSize",value:function(){return this.atlasSize}},{key:"getIndexArray",value:function(){return Array.from({length:this.maxAtlasesPerBatch},function(r,n){return n})}},{key:"startBatch",value:function(){this.batchAtlases=[]}},{key:"getAtlasCount",value:function(){return this.batchAtlases.length}},{key:"getAtlases",value:function(){return this.batchAtlases}},{key:"canAddToCurrentBatch",value:function(r){return this.batchAtlases.length===this.maxAtlasesPerBatch?this.batchAtlases.includes(r):!0}},{key:"getAtlasIndexForBatch",value:function(r){var n=this.batchAtlases.indexOf(r);if(n<0){if(this.batchAtlases.length===this.maxAtlasesPerBatch)throw new Error("cannot add more atlases to batch");this.batchAtlases.push(r),n=this.batchAtlases.length-1}return n}}])})(),NU=`
  float circleSD(vec2 p, float r) {
    return distance(vec2(0), p) - r; // signed distance
  }
`,PU=`
  float rectangleSD(vec2 p, vec2 b) {
    vec2 d = abs(p)-b;
    return distance(vec2(0),max(d,0.0)) + min(max(d.x,d.y),0.0);
  }
`,MU=`
  float roundRectangleSD(vec2 p, vec2 b, vec4 cr) {
    cr.xy = (p.x > 0.0) ? cr.xy : cr.zw;
    cr.x  = (p.y > 0.0) ? cr.x  : cr.y;
    vec2 q = abs(p) - b + cr.x;
    return min(max(q.x, q.y), 0.0) + distance(vec2(0), max(q, 0.0)) - cr.x;
  }
`,AU=`
  float ellipseSD(vec2 p, vec2 ab) {
    p = abs( p ); // symmetry

    // find root with Newton solver
    vec2 q = ab*(p-ab);
    float w = (q.x<q.y)? 1.570796327 : 0.0;
    for( int i=0; i<5; i++ ) {
      vec2 cs = vec2(cos(w),sin(w));
      vec2 u = ab*vec2( cs.x,cs.y);
      vec2 v = ab*vec2(-cs.y,cs.x);
      w = w + dot(p-u,v)/(dot(p-u,u)+dot(v,v));
    }
    
    // compute final point and distance
    float d = length(p-ab*vec2(cos(w),sin(w)));
    
    // return signed distance
    return (dot(p/ab,p/ab)>1.0) ? d : -d;
  }
`,rv={SCREEN:{name:"screen",screen:!0},PICKING:{name:"picking",picking:!0}},mx={IGNORE:1,USE_BB:2},m2=0,YN=1,XN=2,g2=3,yp=4,oy=5,qm=6,$m=7,RU=(function(){function t(e,r,n){sf(this,t),this.r=e,this.gl=r,this.maxInstances=n.webglBatchSize,this.atlasSize=n.webglTexSize,this.bgColor=n.bgColor,this.debug=n.webglDebug,this.batchDebugInfo=[],n.enableWrapping=!0,n.createTextureCanvas=cU,this.atlasManager=new EU(e,n),this.batchManager=new TU(n),this.simpleShapeOptions=new Map,this.program=this._createShaderProgram(rv.SCREEN),this.pickingProgram=this._createShaderProgram(rv.PICKING),this.vao=this._createVAO()}return of(t,[{key:"addAtlasCollection",value:function(r,n){this.atlasManager.addAtlasCollection(r,n)}},{key:"addTextureAtlasRenderType",value:function(r,n){this.atlasManager.addRenderType(r,n)}},{key:"addSimpleShapeRenderType",value:function(r,n){this.simpleShapeOptions.set(r,n)}},{key:"invalidate",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=n.type,a=this.atlasManager;return i?a.invalidate(r,{filterType:function(o){return o===i},forceRedraw:!0}):a.invalidate(r)}},{key:"gc",value:function(){this.atlasManager.gc()}},{key:"_createShaderProgram",value:function(r){var n=this.gl,i=`#version 300 es
      precision highp float;

      uniform mat3 uPanZoomMatrix;
      uniform int  uAtlasSize;
      
      // instanced
      in vec2 aPosition; // a vertex from the unit square
      
      in mat3 aTransform; // used to transform verticies, eg into a bounding box
      in int aVertType; // the type of thing we are rendering

      // the z-index that is output when using picking mode
      in vec4 aIndex;
      
      // For textures
      in int aAtlasId; // which shader unit/atlas to use
      in vec4 aTex; // x/y/w/h of texture in atlas

      // for edges
      in vec4 aPointAPointB;
      in vec4 aPointCPointD;
      in vec2 aLineWidth; // also used for node border width

      // simple shapes
      in vec4 aCornerRadius; // for round-rectangle [top-right, bottom-right, top-left, bottom-left]
      in vec4 aColor; // also used for edges
      in vec4 aBorderColor; // aLineWidth is used for border width

      // output values passed to the fragment shader
      out vec2 vTexCoord;
      out vec4 vColor;
      out vec2 vPosition;
      // flat values are not interpolated
      flat out int vAtlasId; 
      flat out int vVertType;
      flat out vec2 vTopRight;
      flat out vec2 vBotLeft;
      flat out vec4 vCornerRadius;
      flat out vec4 vBorderColor;
      flat out vec2 vBorderWidth;
      flat out vec4 vIndex;
      
      void main(void) {
        int vid = gl_VertexID;
        vec2 position = aPosition; // TODO make this a vec3, simplifies some code below

        if(aVertType == `.concat(m2,`) {
          float texX = aTex.x; // texture coordinates
          float texY = aTex.y;
          float texW = aTex.z;
          float texH = aTex.w;

          if(vid == 1 || vid == 2 || vid == 4) {
            texX += texW;
          }
          if(vid == 2 || vid == 4 || vid == 5) {
            texY += texH;
          }

          float d = float(uAtlasSize);
          vTexCoord = vec2(texX / d, texY / d); // tex coords must be between 0 and 1

          gl_Position = vec4(uPanZoomMatrix * aTransform * vec3(position, 1.0), 1.0);
        }
        else if(aVertType == `).concat(yp," || aVertType == ").concat($m,` 
             || aVertType == `).concat(oy," || aVertType == ").concat(qm,`) { // simple shapes

          // the bounding box is needed by the fragment shader
          vBotLeft  = (aTransform * vec3(0, 0, 1)).xy; // flat
          vTopRight = (aTransform * vec3(1, 1, 1)).xy; // flat
          vPosition = (aTransform * vec3(position, 1)).xy; // will be interpolated

          // calculations are done in the fragment shader, just pass these along
          vColor = aColor;
          vCornerRadius = aCornerRadius;
          vBorderColor = aBorderColor;
          vBorderWidth = aLineWidth;

          gl_Position = vec4(uPanZoomMatrix * aTransform * vec3(position, 1.0), 1.0);
        }
        else if(aVertType == `).concat(YN,`) {
          vec2 source = aPointAPointB.xy;
          vec2 target = aPointAPointB.zw;

          // adjust the geometry so that the line is centered on the edge
          position.y = position.y - 0.5;

          // stretch the unit square into a long skinny rectangle
          vec2 xBasis = target - source;
          vec2 yBasis = normalize(vec2(-xBasis.y, xBasis.x));
          vec2 point = source + xBasis * position.x + yBasis * aLineWidth[0] * position.y;

          gl_Position = vec4(uPanZoomMatrix * vec3(point, 1.0), 1.0);
          vColor = aColor;
        } 
        else if(aVertType == `).concat(XN,`) {
          vec2 pointA = aPointAPointB.xy;
          vec2 pointB = aPointAPointB.zw;
          vec2 pointC = aPointCPointD.xy;
          vec2 pointD = aPointCPointD.zw;

          // adjust the geometry so that the line is centered on the edge
          position.y = position.y - 0.5;

          vec2 p0, p1, p2, pos;
          if(position.x == 0.0) { // The left side of the unit square
            p0 = pointA;
            p1 = pointB;
            p2 = pointC;
            pos = position;
          } else { // The right side of the unit square, use same approach but flip the geometry upside down
            p0 = pointD;
            p1 = pointC;
            p2 = pointB;
            pos = vec2(0.0, -position.y);
          }

          vec2 p01 = p1 - p0;
          vec2 p12 = p2 - p1;
          vec2 p21 = p1 - p2;

          // Find the normal vector.
          vec2 tangent = normalize(normalize(p12) + normalize(p01));
          vec2 normal = vec2(-tangent.y, tangent.x);

          // Find the vector perpendicular to p0 -> p1.
          vec2 p01Norm = normalize(vec2(-p01.y, p01.x));

          // Determine the bend direction.
          float sigma = sign(dot(p01 + p21, normal));
          float width = aLineWidth[0];

          if(sign(pos.y) == -sigma) {
            // This is an intersecting vertex. Adjust the position so that there's no overlap.
            vec2 point = 0.5 * width * normal * -sigma / dot(normal, p01Norm);
            gl_Position = vec4(uPanZoomMatrix * vec3(p1 + point, 1.0), 1.0);
          } else {
            // This is a non-intersecting vertex. Treat it like a mitre join.
            vec2 point = 0.5 * width * normal * sigma * dot(normal, p01Norm);
            gl_Position = vec4(uPanZoomMatrix * vec3(p1 + point, 1.0), 1.0);
          }

          vColor = aColor;
        } 
        else if(aVertType == `).concat(g2,` && vid < 3) {
          // massage the first triangle into an edge arrow
          if(vid == 0)
            position = vec2(-0.15, -0.3);
          if(vid == 1)
            position = vec2(  0.0,  0.0);
          if(vid == 2)
            position = vec2( 0.15, -0.3);

          gl_Position = vec4(uPanZoomMatrix * aTransform * vec3(position, 1.0), 1.0);
          vColor = aColor;
        }
        else {
          gl_Position = vec4(2.0, 0.0, 0.0, 1.0); // discard vertex by putting it outside webgl clip space
        }

        vAtlasId = aAtlasId;
        vVertType = aVertType;
        vIndex = aIndex;
      }
    `),a=this.batchManager.getIndexArray(),s=`#version 300 es
      precision highp float;

      // declare texture unit for each texture atlas in the batch
      `.concat(a.map(function(u){return"uniform sampler2D uTexture".concat(u,";")}).join(`
	`),`

      uniform vec4 uBGColor;
      uniform float uZoom;

      in vec2 vTexCoord;
      in vec4 vColor;
      in vec2 vPosition; // model coordinates

      flat in int vAtlasId;
      flat in vec4 vIndex;
      flat in int vVertType;
      flat in vec2 vTopRight;
      flat in vec2 vBotLeft;
      flat in vec4 vCornerRadius;
      flat in vec4 vBorderColor;
      flat in vec2 vBorderWidth;

      out vec4 outColor;

      `).concat(NU,`
      `).concat(PU,`
      `).concat(MU,`
      `).concat(AU,`

      vec4 blend(vec4 top, vec4 bot) { // blend colors with premultiplied alpha
        return vec4( 
          top.rgb + (bot.rgb * (1.0 - top.a)),
          top.a   + (bot.a   * (1.0 - top.a)) 
        );
      }

      vec4 distInterp(vec4 cA, vec4 cB, float d) { // interpolate color using Signed Distance
        // scale to the zoom level so that borders don't look blurry when zoomed in
        // note 1.5 is an aribitrary value chosen because it looks good
        return mix(cA, cB, 1.0 - smoothstep(0.0, 1.5 / uZoom, abs(d))); 
      }

      void main(void) {
        if(vVertType == `).concat(m2,`) {
          // look up the texel from the texture unit
          `).concat(a.map(function(u){return"if(vAtlasId == ".concat(u,") outColor = texture(uTexture").concat(u,", vTexCoord);")}).join(`
	else `),`
        } 
        else if(vVertType == `).concat(g2,`) {
          // mimics how canvas renderer uses context.globalCompositeOperation = 'destination-out';
          outColor = blend(vColor, uBGColor);
          outColor.a = 1.0; // make opaque, masks out line under arrow
        }
        else if(vVertType == `).concat(yp,` && vBorderWidth == vec2(0.0)) { // simple rectangle with no border
          outColor = vColor; // unit square is already transformed to the rectangle, nothing else needs to be done
        }
        else if(vVertType == `).concat(yp," || vVertType == ").concat($m,` 
          || vVertType == `).concat(oy," || vVertType == ").concat(qm,`) { // use SDF

          float outerBorder = vBorderWidth[0];
          float innerBorder = vBorderWidth[1];
          float borderPadding = outerBorder * 2.0;
          float w = vTopRight.x - vBotLeft.x - borderPadding;
          float h = vTopRight.y - vBotLeft.y - borderPadding;
          vec2 b = vec2(w/2.0, h/2.0); // half width, half height
          vec2 p = vPosition - vec2(vTopRight.x - b[0] - outerBorder, vTopRight.y - b[1] - outerBorder); // translate to center

          float d; // signed distance
          if(vVertType == `).concat(yp,`) {
            d = rectangleSD(p, b);
          } else if(vVertType == `).concat($m,` && w == h) {
            d = circleSD(p, b.x); // faster than ellipse
          } else if(vVertType == `).concat($m,`) {
            d = ellipseSD(p, b);
          } else {
            d = roundRectangleSD(p, b, vCornerRadius.wzyx);
          }

          // use the distance to interpolate a color to smooth the edges of the shape, doesn't need multisampling
          // we must smooth colors inwards, because we can't change pixels outside the shape's bounding box
          if(d > 0.0) {
            if(d > outerBorder) {
              discard;
            } else {
              outColor = distInterp(vBorderColor, vec4(0), d - outerBorder);
            }
          } else {
            if(d > innerBorder) {
              vec4 outerColor = outerBorder == 0.0 ? vec4(0) : vBorderColor;
              vec4 innerBorderColor = blend(vBorderColor, vColor);
              outColor = distInterp(innerBorderColor, outerColor, d);
            } 
            else {
              vec4 outerColor;
              if(innerBorder == 0.0 && outerBorder == 0.0) {
                outerColor = vec4(0);
              } else if(innerBorder == 0.0) {
                outerColor = vBorderColor;
              } else {
                outerColor = blend(vBorderColor, vColor);
              }
              outColor = distInterp(vColor, outerColor, d - innerBorder);
            }
          }
        }
        else {
          outColor = vColor;
        }

        `).concat(r.picking?`if(outColor.a == 0.0) discard;
             else outColor = vIndex;`:"",`
      }
    `),o=uU(n,i,s);o.aPosition=n.getAttribLocation(o,"aPosition"),o.aIndex=n.getAttribLocation(o,"aIndex"),o.aVertType=n.getAttribLocation(o,"aVertType"),o.aTransform=n.getAttribLocation(o,"aTransform"),o.aAtlasId=n.getAttribLocation(o,"aAtlasId"),o.aTex=n.getAttribLocation(o,"aTex"),o.aPointAPointB=n.getAttribLocation(o,"aPointAPointB"),o.aPointCPointD=n.getAttribLocation(o,"aPointCPointD"),o.aLineWidth=n.getAttribLocation(o,"aLineWidth"),o.aColor=n.getAttribLocation(o,"aColor"),o.aCornerRadius=n.getAttribLocation(o,"aCornerRadius"),o.aBorderColor=n.getAttribLocation(o,"aBorderColor"),o.uPanZoomMatrix=n.getUniformLocation(o,"uPanZoomMatrix"),o.uAtlasSize=n.getUniformLocation(o,"uAtlasSize"),o.uBGColor=n.getUniformLocation(o,"uBGColor"),o.uZoom=n.getUniformLocation(o,"uZoom"),o.uTextures=[];for(var l=0;l<this.batchManager.getMaxAtlasesPerBatch();l++)o.uTextures.push(n.getUniformLocation(o,"uTexture".concat(l)));return o}},{key:"_createVAO",value:function(){var r=[0,0,1,0,1,1,0,0,1,1,0,1];this.vertexCount=r.length/2;var n=this.maxInstances,i=this.gl,a=this.program,s=i.createVertexArray();return i.bindVertexArray(s),yU(i,"vec2",a.aPosition,r),this.transformBuffer=xU(i,n,a.aTransform),this.indexBuffer=vu(i,n,"vec4",a.aIndex),this.vertTypeBuffer=vu(i,n,"int",a.aVertType),this.atlasIdBuffer=vu(i,n,"int",a.aAtlasId),this.texBuffer=vu(i,n,"vec4",a.aTex),this.pointAPointBBuffer=vu(i,n,"vec4",a.aPointAPointB),this.pointCPointDBuffer=vu(i,n,"vec4",a.aPointCPointD),this.lineWidthBuffer=vu(i,n,"vec2",a.aLineWidth),this.colorBuffer=vu(i,n,"vec4",a.aColor),this.cornerRadiusBuffer=vu(i,n,"vec4",a.aCornerRadius),this.borderColorBuffer=vu(i,n,"vec4",a.aBorderColor),i.bindVertexArray(null),s}},{key:"buffers",get:function(){var r=this;return this._buffers||(this._buffers=Object.keys(this).filter(function(n){return Ld(n,"Buffer")}).map(function(n){return r[n]})),this._buffers}},{key:"startFrame",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:rv.SCREEN;this.panZoomMatrix=r,this.renderTarget=n,this.batchDebugInfo=[],this.wrappedCount=0,this.simpleCount=0,this.startBatch()}},{key:"startBatch",value:function(){this.instanceCount=0,this.batchManager.startBatch()}},{key:"endFrame",value:function(){this.endBatch()}},{key:"_isVisible",value:function(r,n){return r.visible()?n&&n.isVisible?n.isVisible(r):!0:!1}},{key:"drawTexture",value:function(r,n,i){var a=this.atlasManager,s=this.batchManager,o=a.getRenderTypeOpts(i);if(this._isVisible(r,o)&&!(r.isEdge()&&!this._isValidEdge(r))){if(this.renderTarget.picking&&o.getTexPickingMode){var l=o.getTexPickingMode(r);if(l===mx.IGNORE)return;if(l==mx.USE_BB){this.drawPickingRectangle(r,n,i);return}}var u=a.getAtlasInfo(r,i),c=Ys(u),f;try{for(c.s();!(f=c.n()).done;){var p=f.value,v=p.atlas,y=p.tex1,S=p.tex2;s.canAddToCurrentBatch(v)||this.endBatch();for(var w=s.getAtlasIndexForBatch(v),E=0,_=[[y,!0],[S,!1]];E<_.length;E++){var T=Di(_[E],2),N=T[0],R=T[1];if(N.w!=0){var I=this.instanceCount;this.vertTypeBuffer.getView(I)[0]=m2;var F=this.indexBuffer.getView(I);vp(n,F);var D=this.atlasIdBuffer.getView(I);D[0]=w;var j=this.texBuffer.getView(I);j[0]=N.x,j[1]=N.y,j[2]=N.w,j[3]=N.h;var B=this.transformBuffer.getMatrixView(I);this.setTransformMatrix(r,B,o,p,R),this.instanceCount++,R||this.wrappedCount++,this.instanceCount>=this.maxInstances&&this.endBatch()}}}}catch(G){c.e(G)}finally{c.f()}}}},{key:"setTransformMatrix",value:function(r,n,i,a){var s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,o=0;if(i.shapeProps&&i.shapeProps.padding&&(o=r.pstyle(i.shapeProps.padding).pfValue),a){var l=a.bb,u=a.tex1,c=a.tex2,f=u.w/(u.w+c.w);s||(f=1-f);var p=this._getAdjustedBB(l,o,s,f);this._applyTransformMatrix(n,p,i,r)}else{var v=i.getBoundingBox(r),y=this._getAdjustedBB(v,o,!0,1);this._applyTransformMatrix(n,y,i,r)}}},{key:"_applyTransformMatrix",value:function(r,n,i,a){var s,o;KN(r);var l=i.getRotation?i.getRotation(a):0;if(l!==0){var u=i.getRotationPoint(a),c=u.x,f=u.y;Hy(r,r,[c,f]),ZN(r,r,l);var p=i.getRotationOffset(a);s=p.x+(n.xOffset||0),o=p.y+(n.yOffset||0)}else s=n.x1,o=n.y1;Hy(r,r,[s,o]),ZS(r,r,[n.w,n.h])}},{key:"_getAdjustedBB",value:function(r,n,i,a){var s=r.x1,o=r.y1,l=r.w,u=r.h,c=r.yOffset;n&&(s-=n,o-=n,l+=2*n,u+=2*n);var f=0,p=l*a;return i&&a<1?l=p:!i&&a<1&&(f=l-p,s+=f,l=p),{x1:s,y1:o,w:l,h:u,xOffset:f,yOffset:c}}},{key:"drawPickingRectangle",value:function(r,n,i){var a=this.atlasManager.getRenderTypeOpts(i),s=this.instanceCount;this.vertTypeBuffer.getView(s)[0]=yp;var o=this.indexBuffer.getView(s);vp(n,o);var l=this.colorBuffer.getView(s);Hf([0,0,0],1,l);var u=this.transformBuffer.getMatrixView(s);this.setTransformMatrix(r,u,a),this.simpleCount++,this.instanceCount++,this.instanceCount>=this.maxInstances&&this.endBatch()}},{key:"drawNode",value:function(r,n,i){var a=this.simpleShapeOptions.get(i);if(this._isVisible(r,a)){var s=a.shapeProps,o=this._getVertTypeForShape(r,s.shape);if(o===void 0||a.isSimple&&!a.isSimple(r)){this.drawTexture(r,n,i);return}var l=this.instanceCount;if(this.vertTypeBuffer.getView(l)[0]=o,o===oy||o===qm){var u=a.getBoundingBox(r),c=this._getCornerRadius(r,s.radius,u),f=this.cornerRadiusBuffer.getView(l);f[0]=c,f[1]=c,f[2]=c,f[3]=c,o===qm&&(f[0]=0,f[2]=0)}var p=this.indexBuffer.getView(l);vp(n,p);var v=r.pstyle(s.color).value,y=r.pstyle(s.opacity).value,S=this.colorBuffer.getView(l);Hf(v,y,S);var w=this.lineWidthBuffer.getView(l);if(w[0]=0,w[1]=0,s.border){var E=r.pstyle("border-width").value;if(E>0){var _=r.pstyle("border-color").value,T=r.pstyle("border-opacity").value,N=this.borderColorBuffer.getView(l);Hf(_,T,N);var R=r.pstyle("border-position").value;if(R==="inside")w[0]=0,w[1]=-E;else if(R==="outside")w[0]=E,w[1]=0;else{var I=E/2;w[0]=I,w[1]=-I}}}var F=this.transformBuffer.getMatrixView(l);this.setTransformMatrix(r,F,a),this.simpleCount++,this.instanceCount++,this.instanceCount>=this.maxInstances&&this.endBatch()}}},{key:"_getVertTypeForShape",value:function(r,n){var i=r.pstyle(n).value;switch(i){case"rectangle":return yp;case"ellipse":return $m;case"roundrectangle":case"round-rectangle":return oy;case"bottom-round-rectangle":return qm;default:return}}},{key:"_getCornerRadius",value:function(r,n,i){var a=i.w,s=i.h;if(r.pstyle(n).value==="auto")return Xd(a,s);var o=r.pstyle(n).pfValue,l=a/2,u=s/2;return Math.min(o,u,l)}},{key:"drawEdgeArrow",value:function(r,n,i){if(r.visible()){var a=r._private.rscratch,s,o,l;if(i==="source"?(s=a.arrowStartX,o=a.arrowStartY,l=a.srcArrowAngle):(s=a.arrowEndX,o=a.arrowEndY,l=a.tgtArrowAngle),!(isNaN(s)||s==null||isNaN(o)||o==null||isNaN(l)||l==null)){var u=r.pstyle(i+"-arrow-shape").value;if(u!=="none"){var c=r.pstyle(i+"-arrow-color").value,f=r.pstyle("opacity").value,p=r.pstyle("line-opacity").value,v=f*p,y=r.pstyle("width").pfValue,S=r.pstyle("arrow-scale").value,w=this.r.getArrowWidth(y,S),E=this.instanceCount,_=this.transformBuffer.getMatrixView(E);KN(_),Hy(_,_,[s,o]),ZS(_,_,[w,w]),ZN(_,_,l),this.vertTypeBuffer.getView(E)[0]=g2;var T=this.indexBuffer.getView(E);vp(n,T);var N=this.colorBuffer.getView(E);Hf(c,v,N),this.instanceCount++,this.instanceCount>=this.maxInstances&&this.endBatch()}}}}},{key:"drawEdgeLine",value:function(r,n){if(r.visible()){var i=this._getEdgePoints(r);if(i){var a=r.pstyle("opacity").value,s=r.pstyle("line-opacity").value,o=r.pstyle("width").pfValue,l=r.pstyle("line-color").value,u=a*s;if(i.length/2+this.instanceCount>this.maxInstances&&this.endBatch(),i.length==4){var c=this.instanceCount;this.vertTypeBuffer.getView(c)[0]=YN;var f=this.indexBuffer.getView(c);vp(n,f);var p=this.colorBuffer.getView(c);Hf(l,u,p);var v=this.lineWidthBuffer.getView(c);v[0]=o;var y=this.pointAPointBBuffer.getView(c);y[0]=i[0],y[1]=i[1],y[2]=i[2],y[3]=i[3],this.instanceCount++,this.instanceCount>=this.maxInstances&&this.endBatch()}else for(var S=0;S<i.length-2;S+=2){var w=this.instanceCount;this.vertTypeBuffer.getView(w)[0]=XN;var E=this.indexBuffer.getView(w);vp(n,E);var _=this.colorBuffer.getView(w);Hf(l,u,_);var T=this.lineWidthBuffer.getView(w);T[0]=o;var N=i[S-2],R=i[S-1],I=i[S],F=i[S+1],D=i[S+2],j=i[S+3],B=i[S+4],G=i[S+5];S==0&&(N=2*I-D+.001,R=2*F-j+.001),S==i.length-4&&(B=2*D-I+.001,G=2*j-F+.001);var K=this.pointAPointBBuffer.getView(w);K[0]=N,K[1]=R,K[2]=I,K[3]=F;var O=this.pointCPointDBuffer.getView(w);O[0]=D,O[1]=j,O[2]=B,O[3]=G,this.instanceCount++,this.instanceCount>=this.maxInstances&&this.endBatch()}}}}},{key:"_isValidEdge",value:function(r){var n=r._private.rscratch;return!(n.badLine||n.allpts==null||isNaN(n.allpts[0]))}},{key:"_getEdgePoints",value:function(r){var n=r._private.rscratch;if(this._isValidEdge(r)){var i=n.allpts;if(i.length==4)return i;var a=this._getNumSegments(r);return this._getCurveSegmentPoints(i,a)}}},{key:"_getNumSegments",value:function(r){var n=15;return Math.min(Math.max(n,5),this.maxInstances)}},{key:"_getCurveSegmentPoints",value:function(r,n){if(r.length==4)return r;for(var i=Array((n+1)*2),a=0;a<=n;a++)if(a==0)i[0]=r[0],i[1]=r[1];else if(a==n)i[a*2]=r[r.length-2],i[a*2+1]=r[r.length-1];else{var s=a/n;this._setCurvePoint(r,s,i,a*2)}return i}},{key:"_setCurvePoint",value:function(r,n,i,a){if(r.length<=2)i[a]=r[0],i[a+1]=r[1];else{for(var s=Array(r.length-2),o=0;o<s.length;o+=2){var l=(1-n)*r[o]+n*r[o+2],u=(1-n)*r[o+1]+n*r[o+3];s[o]=l,s[o+1]=u}return this._setCurvePoint(s,n,i,a)}}},{key:"endBatch",value:function(){var r=this.gl,n=this.vao,i=this.vertexCount,a=this.instanceCount;if(a!==0){var s=this.renderTarget.picking?this.pickingProgram:this.program;r.useProgram(s),r.bindVertexArray(n);var o=Ys(this.buffers),l;try{for(o.s();!(l=o.n()).done;){var u=l.value;u.bufferSubData(a)}}catch(y){o.e(y)}finally{o.f()}for(var c=this.batchManager.getAtlases(),f=0;f<c.length;f++)c[f].bufferIfNeeded(r);for(var p=0;p<c.length;p++)r.activeTexture(r.TEXTURE0+p),r.bindTexture(r.TEXTURE_2D,c[p].texture),r.uniform1i(s.uTextures[p],p);r.uniform1f(s.uZoom,dU(this.r)),r.uniformMatrix3fv(s.uPanZoomMatrix,!1,this.panZoomMatrix),r.uniform1i(s.uAtlasSize,this.batchManager.getAtlasSize());var v=Hf(this.bgColor,1);r.uniform4fv(s.uBGColor,v),r.drawArraysInstanced(r.TRIANGLES,0,i,a),r.bindVertexArray(null),r.bindTexture(r.TEXTURE_2D,null),this.debug&&this.batchDebugInfo.push({count:a,atlasCount:c.length}),this.startBatch()}}},{key:"getDebugInfo",value:function(){var r=this.atlasManager.getDebugInfo(),n=r.reduce(function(s,o){return s+o.atlasCount},0),i=this.batchDebugInfo,a=i.reduce(function(s,o){return s+o.count},0);return{atlasInfo:r,totalAtlases:n,wrappedCount:this.wrappedCount,simpleCount:this.simpleCount,batchCount:i.length,batchInfo:i,totalInstances:a}}}])})(),aR={};aR.initWebgl=function(t,e){var r=this,n=r.data.contexts[r.WEBGL];t.bgColor=LU(r),t.webglTexSize=Math.min(t.webglTexSize,n.getParameter(n.MAX_TEXTURE_SIZE)),t.webglTexRows=Math.min(t.webglTexRows,54),t.webglTexRowsNodes=Math.min(t.webglTexRowsNodes,54),t.webglBatchSize=Math.min(t.webglBatchSize,16384),t.webglTexPerBatch=Math.min(t.webglTexPerBatch,n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS)),r.webglDebug=t.webglDebug,r.webglDebugShowAtlases=t.webglDebugShowAtlases,r.pickingFrameBuffer=bU(n),r.pickingFrameBuffer.needsDraw=!0,r.drawing=new RU(r,n,t);var i=function(f){return function(p){return r.getTextAngle(p,f)}},a=function(f){return function(p){var v=p.pstyle(f);return v&&v.value}},s=function(f){return function(p){return p.pstyle("".concat(f,"-opacity")).value>0}},o=function(f){var p=f.pstyle("text-events").strValue==="yes";return p?mx.USE_BB:mx.IGNORE},l=function(f){var p=f.position(),v=p.x,y=p.y,S=f.outerWidth(),w=f.outerHeight();return{w:S,h:w,x1:v-S/2,y1:y-w/2}};r.drawing.addAtlasCollection("node",{texRows:t.webglTexRowsNodes}),r.drawing.addAtlasCollection("label",{texRows:t.webglTexRows}),r.drawing.addTextureAtlasRenderType("node-body",{collection:"node",getKey:e.getStyleKey,getBoundingBox:e.getElementBox,drawElement:e.drawElement}),r.drawing.addSimpleShapeRenderType("node-body",{getBoundingBox:l,isSimple:hU,shapeProps:{shape:"shape",color:"background-color",opacity:"background-opacity",radius:"corner-radius",border:!0}}),r.drawing.addSimpleShapeRenderType("node-overlay",{getBoundingBox:l,isVisible:s("overlay"),shapeProps:{shape:"overlay-shape",color:"overlay-color",opacity:"overlay-opacity",padding:"overlay-padding",radius:"overlay-corner-radius"}}),r.drawing.addSimpleShapeRenderType("node-underlay",{getBoundingBox:l,isVisible:s("underlay"),shapeProps:{shape:"underlay-shape",color:"underlay-color",opacity:"underlay-opacity",padding:"underlay-padding",radius:"underlay-corner-radius"}}),r.drawing.addTextureAtlasRenderType("label",{collection:"label",getTexPickingMode:o,getKey:v2(e.getLabelKey,null),getBoundingBox:y2(e.getLabelBox,null),drawClipped:!0,drawElement:e.drawLabel,getRotation:i(null),getRotationPoint:e.getLabelRotationPoint,getRotationOffset:e.getLabelRotationOffset,isVisible:a("label")}),r.drawing.addTextureAtlasRenderType("edge-source-label",{collection:"label",getTexPickingMode:o,getKey:v2(e.getSourceLabelKey,"source"),getBoundingBox:y2(e.getSourceLabelBox,"source"),drawClipped:!0,drawElement:e.drawSourceLabel,getRotation:i("source"),getRotationPoint:e.getSourceLabelRotationPoint,getRotationOffset:e.getSourceLabelRotationOffset,isVisible:a("source-label")}),r.drawing.addTextureAtlasRenderType("edge-target-label",{collection:"label",getTexPickingMode:o,getKey:v2(e.getTargetLabelKey,"target"),getBoundingBox:y2(e.getTargetLabelBox,"target"),drawClipped:!0,drawElement:e.drawTargetLabel,getRotation:i("target"),getRotationPoint:e.getTargetLabelRotationPoint,getRotationOffset:e.getTargetLabelRotationOffset,isVisible:a("target-label")});var u=Qv(function(){console.log("garbage collect flag set"),r.data.gc=!0},1e4);r.onUpdateEleCalcs(function(c,f){var p=!1;f&&f.length>0&&(p|=r.drawing.invalidate(f)),p&&u()}),OU(r)};function LU(t){var e=t.cy.container(),r=e&&e.style&&e.style.backgroundColor||"white";return LM(r)}function sR(t,e){var r=t._private.rscratch;return $s(r,"labelWrapCachedLines",e)||[]}var v2=function(e,r){return function(n){var i=e(n),a=sR(n,r);return a.length>1?a.map(function(s,o){return"".concat(i,"_").concat(o)}):i}},y2=function(e,r){return function(n,i){var a=e(n);if(typeof i=="string"){var s=i.indexOf("_");if(s>0){var o=Number(i.substring(s+1)),l=sR(n,r),u=a.h/l.length,c=u*o,f=a.y1+c;return{x1:a.x1,w:a.w,y1:f,h:u,yOffset:c}}}return a}};function OU(t){{var e=t.render;t.render=function(a){a=a||{};var s=t.cy;t.webgl&&(s.zoom()>QA?(DU(t),e.call(t,a)):(IU(t),lR(t,a,rv.SCREEN)))}}{var r=t.matchCanvasSize;t.matchCanvasSize=function(a){r.call(t,a),t.pickingFrameBuffer.setFramebufferAttachmentSizes(t.canvasWidth,t.canvasHeight),t.pickingFrameBuffer.needsDraw=!0}}t.findNearestElements=function(a,s,o,l){return GU(t,a,s)};{var n=t.invalidateCachedZSortedEles;t.invalidateCachedZSortedEles=function(){n.call(t),t.pickingFrameBuffer.needsDraw=!0}}{var i=t.notify;t.notify=function(a,s){i.call(t,a,s),a==="viewport"||a==="bounds"?t.pickingFrameBuffer.needsDraw=!0:a==="background"&&t.drawing.invalidate(s,{type:"node-body"})}}}function DU(t){var e=t.data.contexts[t.WEBGL];e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT)}function IU(t){var e=function(n){n.save(),n.setTransform(1,0,0,1,0,0),n.clearRect(0,0,t.canvasWidth,t.canvasHeight),n.restore()};e(t.data.contexts[t.NODE]),e(t.data.contexts[t.DRAG])}function jU(t){var e=t.canvasWidth,r=t.canvasHeight,n=x_(t),i=n.pan,a=n.zoom,s=p2();Hy(s,s,[i.x,i.y]),ZS(s,s,[a,a]);var o=p2();SU(o,e,r);var l=p2();return wU(l,o,s),l}function oR(t,e){var r=t.canvasWidth,n=t.canvasHeight,i=x_(t),a=i.pan,s=i.zoom;e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,r,n),e.translate(a.x,a.y),e.scale(s,s)}function FU(t,e){t.drawSelectionRectangle(e,function(r){return oR(t,r)})}function BU(t){var e=t.data.contexts[t.NODE];e.save(),oR(t,e),e.strokeStyle="rgba(0, 0, 0, 0.3)",e.beginPath(),e.moveTo(-1e3,0),e.lineTo(1e3,0),e.stroke(),e.beginPath(),e.moveTo(0,-1e3),e.lineTo(0,1e3),e.stroke(),e.restore()}function zU(t){var e=function(i,a,s){for(var o=i.atlasManager.getAtlasCollection(a),l=t.data.contexts[t.NODE],u=o.atlases,c=0;c<u.length;c++){var f=u[c],p=f.canvas;if(p){var v=p.width,y=p.height,S=v*c,w=p.height*s,E=.4;l.save(),l.scale(E,E),l.drawImage(p,S,w),l.strokeStyle="black",l.rect(S,w,v,y),l.stroke(),l.restore()}}},r=0;e(t.drawing,"node",r++),e(t.drawing,"label",r++)}function UU(t,e,r,n,i){var a,s,o,l,u=x_(t),c=u.pan,f=u.zoom;{var p=fU(t,c,f,e,r),v=Di(p,2),y=v[0],S=v[1],w=6;a=y-w/2,s=S-w/2,o=w,l=w}if(o===0||l===0)return[];var E=t.data.contexts[t.WEBGL];E.bindFramebuffer(E.FRAMEBUFFER,t.pickingFrameBuffer),t.pickingFrameBuffer.needsDraw&&(E.viewport(0,0,E.canvas.width,E.canvas.height),lR(t,null,rv.PICKING),t.pickingFrameBuffer.needsDraw=!1);var _=o*l,T=new Uint8Array(_*4);E.readPixels(a,s,o,l,E.RGBA,E.UNSIGNED_BYTE,T),E.bindFramebuffer(E.FRAMEBUFFER,null);for(var N=new Set,R=0;R<_;R++){var I=T.slice(R*4,R*4+4),F=mU(I)-1;F>=0&&N.add(F)}return N}function GU(t,e,r){var n=UU(t,e,r),i=t.getCachedZSortedEles(),a,s,o=Ys(n),l;try{for(o.s();!(l=o.n()).done;){var u=l.value,c=i[u];if(!a&&c.isNode()&&(a=c),!s&&c.isEdge()&&(s=c),a&&s)break}}catch(f){o.e(f)}finally{o.f()}return[a,s].filter(Boolean)}function x2(t,e,r){var n=t.drawing;e+=1,r.isNode()?(n.drawNode(r,e,"node-underlay"),n.drawNode(r,e,"node-body"),n.drawTexture(r,e,"label"),n.drawNode(r,e,"node-overlay")):(n.drawEdgeLine(r,e),n.drawEdgeArrow(r,e,"source"),n.drawEdgeArrow(r,e,"target"),n.drawTexture(r,e,"label"),n.drawTexture(r,e,"edge-source-label"),n.drawTexture(r,e,"edge-target-label"))}function lR(t,e,r){var n;t.webglDebug&&(n=performance.now());var i=t.drawing,a=0;if(r.screen&&t.data.canvasNeedsRedraw[t.SELECT_BOX]&&FU(t,e),t.data.canvasNeedsRedraw[t.NODE]||r.picking){var s=t.data.contexts[t.WEBGL];r.screen?(s.clearColor(0,0,0,0),s.enable(s.BLEND),s.blendFunc(s.ONE,s.ONE_MINUS_SRC_ALPHA)):s.disable(s.BLEND),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT),s.viewport(0,0,s.canvas.width,s.canvas.height);var o=jU(t),l=t.getCachedZSortedEles();if(a=l.length,i.startFrame(o,r),r.screen){for(var u=0;u<l.nondrag.length;u++)x2(t,u,l.nondrag[u]);for(var c=0;c<l.drag.length;c++)x2(t,c,l.drag[c])}else if(r.picking)for(var f=0;f<l.length;f++)x2(t,f,l[f]);i.endFrame(),r.screen&&t.webglDebugShowAtlases&&(BU(t),zU(t)),t.data.canvasNeedsRedraw[t.NODE]=!1,t.data.canvasNeedsRedraw[t.DRAG]=!1}if(t.webglDebug){var p=performance.now(),v=!1,y=Math.ceil(p-n),S=i.getDebugInfo(),w=["".concat(a," elements"),"".concat(S.totalInstances," instances"),"".concat(S.batchCount," batches"),"".concat(S.totalAtlases," atlases"),"".concat(S.wrappedCount," wrapped textures"),"".concat(S.simpleCount," simple shapes")].join(", ");if(v)console.log("WebGL (".concat(r.name,") - time ").concat(y,"ms, ").concat(w));else{console.log("WebGL (".concat(r.name,") - frame time ").concat(y,"ms")),console.log("Totals:"),console.log("  ".concat(w)),console.log("Texture Atlases Used:");var E=S.atlasInfo,_=Ys(E),T;try{for(_.s();!(T=_.n()).done;){var N=T.value;console.log("  ".concat(N.type,": ").concat(N.keyCount," keys, ").concat(N.atlasCount," atlases"))}}catch(R){_.e(R)}finally{_.f()}console.log("")}}t.data.gc&&(console.log("Garbage Collect!"),t.data.gc=!1,i.gc())}var cf={};cf.drawPolygonPath=function(t,e,r,n,i,a){var s=n/2,o=i/2;t.beginPath&&t.beginPath(),t.moveTo(e+s*a[0],r+o*a[1]);for(var l=1;l<a.length/2;l++)t.lineTo(e+s*a[l*2],r+o*a[l*2+1]);t.closePath()};cf.drawRoundPolygonPath=function(t,e,r,n,i,a,s){s.forEach(function(o){return VA(t,o)}),t.closePath()};cf.drawRoundRectanglePath=function(t,e,r,n,i,a){var s=n/2,o=i/2,l=a==="auto"?Xd(n,i):Math.min(a,o,s);t.beginPath&&t.beginPath(),t.moveTo(e,r-o),t.arcTo(e+s,r-o,e+s,r,l),t.arcTo(e+s,r+o,e,r+o,l),t.arcTo(e-s,r+o,e-s,r,l),t.arcTo(e-s,r-o,e,r-o,l),t.lineTo(e,r-o),t.closePath()};cf.drawBottomRoundRectanglePath=function(t,e,r,n,i,a){var s=n/2,o=i/2,l=a==="auto"?Xd(n,i):a;t.beginPath&&t.beginPath(),t.moveTo(e,r-o),t.lineTo(e+s,r-o),t.lineTo(e+s,r),t.arcTo(e+s,r+o,e,r+o,l),t.arcTo(e-s,r+o,e-s,r,l),t.lineTo(e-s,r-o),t.lineTo(e,r-o),t.closePath()};cf.drawCutRectanglePath=function(t,e,r,n,i,a,s){var o=n/2,l=i/2,u=s==="auto"?a_():s;t.beginPath&&t.beginPath(),t.moveTo(e-o+u,r-l),t.lineTo(e+o-u,r-l),t.lineTo(e+o,r-l+u),t.lineTo(e+o,r+l-u),t.lineTo(e+o-u,r+l),t.lineTo(e-o+u,r+l),t.lineTo(e-o,r+l-u),t.lineTo(e-o,r-l+u),t.closePath()};cf.drawBarrelPath=function(t,e,r,n,i){var a=n/2,s=i/2,o=e-a,l=e+a,u=r-s,c=r+s,f=DS(n,i),p=f.widthOffset,v=f.heightOffset,y=f.ctrlPtOffsetPct*p;t.beginPath&&t.beginPath(),t.moveTo(o,u+v),t.lineTo(o,c-v),t.quadraticCurveTo(o+y,c,o+p,c),t.lineTo(l-p,c),t.quadraticCurveTo(l-y,c,l,c-v),t.lineTo(l,u+v),t.quadraticCurveTo(l-y,u,l-p,u),t.lineTo(o+p,u),t.quadraticCurveTo(o+y,u,o,u+v),t.closePath()};var QN=Math.sin(0),JN=Math.cos(0),YS={},XS={},uR=Math.PI/40;for(var xp=0*Math.PI;xp<2*Math.PI;xp+=uR)YS[xp]=Math.sin(xp),XS[xp]=Math.cos(xp);cf.drawEllipsePath=function(t,e,r,n,i){if(t.beginPath&&t.beginPath(),t.ellipse)t.ellipse(e,r,n/2,i/2,0,0,2*Math.PI);else for(var a,s,o=n/2,l=i/2,u=0*Math.PI;u<2*Math.PI;u+=uR)a=e-o*YS[u]*QN+o*XS[u]*JN,s=r+l*XS[u]*QN+l*YS[u]*JN,u===0?t.moveTo(a,s):t.lineTo(a,s);t.closePath()};var i0={};i0.createBuffer=function(t,e){var r=document.createElement("canvas");return r.width=t,r.height=e,[r,r.getContext("2d")]};i0.bufferCanvasImage=function(t){var e=this.cy,r=e.mutableElements(),n=r.boundingBox(),i=this.findContainerClientCoords(),a=t.full?Math.ceil(n.w):i[2],s=t.full?Math.ceil(n.h):i[3],o=bt(t.maxWidth)||bt(t.maxHeight),l=this.getPixelRatio(),u=1;if(t.scale!==void 0)a*=t.scale,s*=t.scale,u=t.scale;else if(o){var c=1/0,f=1/0;bt(t.maxWidth)&&(c=u*t.maxWidth/a),bt(t.maxHeight)&&(f=u*t.maxHeight/s),u=Math.min(c,f),a*=u,s*=u}o||(a*=l,s*=l,u*=l);var p=document.createElement("canvas");p.width=a,p.height=s,p.style.width=a+"px",p.style.height=s+"px";var v=p.getContext("2d");if(a>0&&s>0){v.clearRect(0,0,a,s),v.globalCompositeOperation="source-over";var y=this.getCachedZSortedEles();if(t.full)v.translate(-n.x1*u,-n.y1*u),v.scale(u,u),this.drawElements(v,y),v.scale(1/u,1/u),v.translate(n.x1*u,n.y1*u);else{var S=e.pan(),w={x:S.x*u,y:S.y*u};u*=e.zoom(),v.translate(w.x,w.y),v.scale(u,u),this.drawElements(v,y),v.scale(1/u,1/u),v.translate(-w.x,-w.y)}t.bg&&(v.globalCompositeOperation="destination-over",v.fillStyle=t.bg,v.rect(0,0,a,s),v.fill())}return p};function VU(t,e){for(var r=atob(t),n=new ArrayBuffer(r.length),i=new Uint8Array(n),a=0;a<r.length;a++)i[a]=r.charCodeAt(a);return new Blob([n],{type:e})}function e5(t){var e=t.indexOf(",");return t.substr(e+1)}function cR(t,e,r){var n=function(){return e.toDataURL(r,t.quality)};switch(t.output){case"blob-promise":return new cm(function(i,a){try{e.toBlob(function(s){s!=null?i(s):a(new Error("`canvas.toBlob()` sent a null value in its callback"))},r,t.quality)}catch(s){a(s)}});case"blob":return VU(e5(n()),r);case"base64":return e5(n());default:return n()}}i0.png=function(t){return cR(t,this.bufferCanvasImage(t),"image/png")};i0.jpg=function(t){return cR(t,this.bufferCanvasImage(t),"image/jpeg")};var dR={};dR.nodeShapeImpl=function(t,e,r,n,i,a,s,o){switch(t){case"ellipse":return this.drawEllipsePath(e,r,n,i,a);case"polygon":return this.drawPolygonPath(e,r,n,i,a,s);case"round-polygon":return this.drawRoundPolygonPath(e,r,n,i,a,s,o);case"roundrectangle":case"round-rectangle":return this.drawRoundRectanglePath(e,r,n,i,a,o);case"cutrectangle":case"cut-rectangle":return this.drawCutRectanglePath(e,r,n,i,a,s,o);case"bottomroundrectangle":case"bottom-round-rectangle":return this.drawBottomRoundRectanglePath(e,r,n,i,a,o);case"barrel":return this.drawBarrelPath(e,r,n,i,a)}};var HU=fR,Er=fR.prototype;Er.CANVAS_LAYERS=3;Er.SELECT_BOX=0;Er.DRAG=1;Er.NODE=2;Er.WEBGL=3;Er.CANVAS_TYPES=["2d","2d","2d","webgl2"];Er.BUFFER_COUNT=3;Er.TEXTURE_BUFFER=0;Er.MOTIONBLUR_BUFFER_NODE=1;Er.MOTIONBLUR_BUFFER_DRAG=2;function fR(t){var e=this,r=e.cy.window(),n=r.document;t.webgl&&(Er.CANVAS_LAYERS=e.CANVAS_LAYERS=4,console.log("webgl rendering enabled")),e.data={canvases:new Array(Er.CANVAS_LAYERS),contexts:new Array(Er.CANVAS_LAYERS),canvasNeedsRedraw:new Array(Er.CANVAS_LAYERS),bufferCanvases:new Array(Er.BUFFER_COUNT),bufferContexts:new Array(Er.CANVAS_LAYERS)};var i="-webkit-tap-highlight-color",a="rgba(0,0,0,0)";e.data.canvasContainer=n.createElement("div");var s=e.data.canvasContainer.style;e.data.canvasContainer.style[i]=a,s.position="relative",s.zIndex="0",s.overflow="hidden";var o=t.cy.container();o.appendChild(e.data.canvasContainer),o.style[i]=a;var l={"-webkit-user-select":"none","-moz-user-select":"-moz-none","user-select":"none","-webkit-tap-highlight-color":"rgba(0,0,0,0)","outline-style":"none"};Fj()&&(l["-ms-touch-action"]="none",l["touch-action"]="none");for(var u=0;u<Er.CANVAS_LAYERS;u++){var c=e.data.canvases[u]=n.createElement("canvas"),f=Er.CANVAS_TYPES[u];e.data.contexts[u]=c.getContext(f),e.data.contexts[u]||Kn("Could not create canvas of type "+f),Object.keys(l).forEach(function(ve){c.style[ve]=l[ve]}),c.style.position="absolute",c.setAttribute("data-id","layer"+u),c.style.zIndex=String(Er.CANVAS_LAYERS-u),e.data.canvasContainer.appendChild(c),e.data.canvasNeedsRedraw[u]=!1}e.data.topCanvas=e.data.canvases[0],e.data.canvases[Er.NODE].setAttribute("data-id","layer"+Er.NODE+"-node"),e.data.canvases[Er.SELECT_BOX].setAttribute("data-id","layer"+Er.SELECT_BOX+"-selectbox"),e.data.canvases[Er.DRAG].setAttribute("data-id","layer"+Er.DRAG+"-drag"),e.data.canvases[Er.WEBGL]&&e.data.canvases[Er.WEBGL].setAttribute("data-id","layer"+Er.WEBGL+"-webgl");for(var u=0;u<Er.BUFFER_COUNT;u++)e.data.bufferCanvases[u]=n.createElement("canvas"),e.data.bufferContexts[u]=e.data.bufferCanvases[u].getContext("2d"),e.data.bufferCanvases[u].style.position="absolute",e.data.bufferCanvases[u].setAttribute("data-id","buffer"+u),e.data.bufferCanvases[u].style.zIndex=String(-u-1),e.data.bufferCanvases[u].style.visibility="hidden";e.pathsEnabled=!0;var p=Es(),v=function(ge){return{x:(ge.x1+ge.x2)/2,y:(ge.y1+ge.y2)/2}},y=function(ge){return{x:-ge.w/2,y:-ge.h/2}},S=function(ge){var se=ge[0]._private,ye=se.oldBackgroundTimestamp===se.backgroundTimestamp;return!ye},w=function(ge){return ge[0]._private.nodeKey},E=function(ge){return ge[0]._private.labelStyleKey},_=function(ge){return ge[0]._private.sourceLabelStyleKey},T=function(ge){return ge[0]._private.targetLabelStyleKey},N=function(ge,se,ye,Se,Ue){return e.drawElement(ge,se,ye,!1,!1,Ue)},R=function(ge,se,ye,Se,Ue){return e.drawElementText(ge,se,ye,Se,"main",Ue)},I=function(ge,se,ye,Se,Ue){return e.drawElementText(ge,se,ye,Se,"source",Ue)},F=function(ge,se,ye,Se,Ue){return e.drawElementText(ge,se,ye,Se,"target",Ue)},D=function(ge){return ge.boundingBox(),ge[0]._private.bodyBounds},j=function(ge){return ge.boundingBox(),ge[0]._private.labelBounds.main||p},B=function(ge){return ge.boundingBox(),ge[0]._private.labelBounds.source||p},G=function(ge){return ge.boundingBox(),ge[0]._private.labelBounds.target||p},K=function(ge,se){return se},O=function(ge){return v(D(ge))},W=function(ge,se,ye){var Se=ge?ge+"-":"";return{x:se.x+ye.pstyle(Se+"text-margin-x").pfValue,y:se.y+ye.pstyle(Se+"text-margin-y").pfValue}},U=function(ge,se,ye){var Se=ge[0]._private.rscratch;return{x:Se[se],y:Se[ye]}},q=function(ge){return W("",U(ge,"labelX","labelY"),ge)},Z=function(ge){return W("source",U(ge,"sourceLabelX","sourceLabelY"),ge)},Q=function(ge){return W("target",U(ge,"targetLabelX","targetLabelY"),ge)},ne=function(ge){return y(D(ge))},re=function(ge){return y(B(ge))},Y=function(ge){return y(G(ge))},J=function(ge){var se=j(ge),ye=y(j(ge));if(ge.isNode()){switch(ge.pstyle("text-halign").value){case"left":ye.x=-se.w-(se.leftPad||0);break;case"right":ye.x=-(se.rightPad||0);break}switch(ge.pstyle("text-valign").value){case"top":ye.y=-se.h-(se.topPad||0);break;case"bottom":ye.y=-(se.botPad||0);break}}return ye},ie=e.data.eleTxrCache=new qg(e,{getKey:w,doesEleInvalidateKey:S,drawElement:N,getBoundingBox:D,getRotationPoint:O,getRotationOffset:ne,allowEdgeTxrCaching:!1,allowParentTxrCaching:!1}),de=e.data.lblTxrCache=new qg(e,{getKey:E,drawElement:R,getBoundingBox:j,getRotationPoint:q,getRotationOffset:J,isVisible:K}),he=e.data.slbTxrCache=new qg(e,{getKey:_,drawElement:I,getBoundingBox:B,getRotationPoint:Z,getRotationOffset:re,isVisible:K}),xe=e.data.tlbTxrCache=new qg(e,{getKey:T,drawElement:F,getBoundingBox:G,getRotationPoint:Q,getRotationOffset:Y,isVisible:K}),le=e.data.lyrTxrCache=new JA(e);e.onUpdateEleCalcs(function(ge,se){ie.invalidateElements(se),de.invalidateElements(se),he.invalidateElements(se),xe.invalidateElements(se),le.invalidateElements(se);for(var ye=0;ye<se.length;ye++){var Se=se[ye]._private;Se.oldBackgroundTimestamp=Se.backgroundTimestamp}});var fe=function(ge){for(var se=0;se<ge.length;se++)le.enqueueElementRefinement(ge[se].ele)};ie.onDequeue(fe),de.onDequeue(fe),he.onDequeue(fe),xe.onDequeue(fe),t.webgl&&e.initWebgl(t,{getStyleKey:w,getLabelKey:E,getSourceLabelKey:_,getTargetLabelKey:T,drawElement:N,drawLabel:R,drawSourceLabel:I,drawTargetLabel:F,getElementBox:D,getLabelBox:j,getSourceLabelBox:B,getTargetLabelBox:G,getElementRotationPoint:O,getElementRotationOffset:ne,getLabelRotationPoint:q,getSourceLabelRotationPoint:Z,getTargetLabelRotationPoint:Q,getLabelRotationOffset:J,getSourceLabelRotationOffset:re,getTargetLabelRotationOffset:Y})}Er.redrawHint=function(t,e){var r=this;switch(t){case"eles":r.data.canvasNeedsRedraw[Er.NODE]=e;break;case"drag":r.data.canvasNeedsRedraw[Er.DRAG]=e;break;case"select":r.data.canvasNeedsRedraw[Er.SELECT_BOX]=e;break;case"gc":r.data.gc=!0;break}};var WU=typeof Path2D<"u";Er.path2dEnabled=function(t){if(t===void 0)return this.pathsEnabled;this.pathsEnabled=!!t};Er.usePaths=function(){return WU&&this.pathsEnabled};Er.setImgSmoothing=function(t,e){t.imageSmoothingEnabled!=null?t.imageSmoothingEnabled=e:(t.webkitImageSmoothingEnabled=e,t.mozImageSmoothingEnabled=e,t.msImageSmoothingEnabled=e)};Er.getImgSmoothing=function(t){return t.imageSmoothingEnabled!=null?t.imageSmoothingEnabled:t.webkitImageSmoothingEnabled||t.mozImageSmoothingEnabled||t.msImageSmoothingEnabled};Er.makeOffscreenCanvas=function(t,e){var r;if((typeof OffscreenCanvas>"u"?"undefined":$i(OffscreenCanvas))!=="undefined")r=new OffscreenCanvas(t,e);else{var n=this.cy.window(),i=n.document;r=i.createElement("canvas"),r.width=t,r.height=e}return r};[eR,Ru,Sc,y_,Mh,uf,Ms,aR,cf,i0,dR].forEach(function(t){ir(Er,t)});var qU=[{name:"null",impl:zA},{name:"base",impl:YA},{name:"canvas",impl:HU}],$U=[{type:"layout",extensions:yz},{type:"renderer",extensions:qU}],hR={},pR={};function mR(t,e,r){var n=r,i=function(D){an("Can not register `"+e+"` for `"+t+"` since `"+D+"` already exists in the prototype and can not be overridden")};if(t==="core"){if(Tv.prototype[e])return i(e);Tv.prototype[e]=r}else if(t==="collection"){if(Ua.prototype[e])return i(e);Ua.prototype[e]=r}else if(t==="layout"){for(var a=function(D){this.options=D,r.call(this,D),Vr(this._private)||(this._private={}),this._private.cy=D.cy,this._private.listeners=[],this.createEmitter()},s=a.prototype=Object.create(r.prototype),o=[],l=0;l<o.length;l++){var u=o[l];s[u]=s[u]||function(){return this}}s.start&&!s.run?s.run=function(){return this.start(),this}:!s.start&&s.run&&(s.start=function(){return this.run(),this});var c=r.prototype.stop;s.stop=function(){var F=this.options;if(F&&F.animate){var D=this.animations;if(D)for(var j=0;j<D.length;j++)D[j].stop()}return c?c.call(this):this.emit("layoutstop"),this},s.destroy||(s.destroy=function(){return this}),s.cy=function(){return this._private.cy};var f=function(D){return D._private.cy},p={addEventFields:function(D,j){j.layout=D,j.cy=f(D),j.target=D},bubble:function(){return!0},parent:function(D){return f(D)}};ir(s,{createEmitter:function(){return this._private.emitter=new A1(p,this),this},emitter:function(){return this._private.emitter},on:function(D,j){return this.emitter().on(D,j),this},one:function(D,j){return this.emitter().one(D,j),this},once:function(D,j){return this.emitter().one(D,j),this},removeListener:function(D,j){return this.emitter().removeListener(D,j),this},removeAllListeners:function(){return this.emitter().removeAllListeners(),this},emit:function(D,j){return this.emitter().emit(D,j),this}}),nn.eventAliasesOn(s),n=a}else if(t==="renderer"&&e!=="null"&&e!=="base"){var v=gR("renderer","base"),y=v.prototype,S=r,w=r.prototype,E=function(){v.apply(this,arguments),S.apply(this,arguments)},_=E.prototype;for(var T in y){var N=y[T],R=w[T]!=null;if(R)return i(T);_[T]=N}for(var I in w)_[I]=w[I];y.clientFunctions.forEach(function(F){_[F]=_[F]||function(){Kn("Renderer does not implement `renderer."+F+"()` on its prototype")}}),n=E}else if(t==="__proto__"||t==="constructor"||t==="prototype")return Kn(t+" is an illegal type to be registered, possibly lead to prototype pollutions");return OM({map:hR,keys:[t,e],value:n})}function gR(t,e){return DM({map:hR,keys:[t,e]})}function KU(t,e,r,n,i){return OM({map:pR,keys:[t,e,r,n],value:i})}function ZU(t,e,r,n){return DM({map:pR,keys:[t,e,r,n]})}var QS=function(){if(arguments.length===2)return gR.apply(null,arguments);if(arguments.length===3)return mR.apply(null,arguments);if(arguments.length===4)return ZU.apply(null,arguments);if(arguments.length===5)return KU.apply(null,arguments);Kn("Invalid extension access syntax")};Tv.prototype.extension=QS;$U.forEach(function(t){t.extensions.forEach(function(e){mR(t.type,e.name,e.impl)})});var gx=function(){if(!(this instanceof gx))return new gx;this.length=0},yh=gx.prototype;yh.instanceString=function(){return"stylesheet"};yh.selector=function(t){var e=this.length++;return this[e]={selector:t,properties:[]},this};yh.css=function(t,e){var r=this.length-1;if(Kt(t))this[r].properties.push({name:t,value:e});else if(Vr(t))for(var n=t,i=Object.keys(n),a=0;a<i.length;a++){var s=i[a],o=n[s];if(o!=null){var l=ga.properties[s]||ga.properties[w1(s)];if(l!=null){var u=l.name,c=o;this[r].properties.push({name:u,value:c})}}}return this};yh.style=yh.css;yh.generateStyle=function(t){var e=new ga(t);return this.appendToStyle(e)};yh.appendToStyle=function(t){for(var e=0;e<this.length;e++){var r=this[e],n=r.selector,i=r.properties;t.selector(n);for(var a=0;a<i.length;a++){var s=i[a];t.css(s.name,s.value)}}return t};var YU="3.33.1",xh=function(e){if(e===void 0&&(e={}),Vr(e))return new Tv(e);if(Kt(e))return QS.apply(QS,arguments)};xh.use=function(t){var e=Array.prototype.slice.call(arguments,1);return e.unshift(xh),t.apply(null,e),this};xh.warnings=function(t){return GM(t)};xh.version=YU;xh.stylesheet=xh.Stylesheet=gx;const{string:ly,array:t5,object:uy,number:Km,bool:po,oneOfType:bp,any:cy,func:Zm}=bj,XU={id:ly,className:ly,style:bp([ly,uy]),elements:bp([t5,cy]),stylesheet:bp([t5,cy]),layout:bp([uy,cy]),pan:bp([uy,cy]),zoom:Km,panningEnabled:po,userPanningEnabled:po,minZoom:Km,maxZoom:Km,zoomingEnabled:po,userZoomingEnabled:po,boxSelectionEnabled:po,autoungrabify:po,autolock:po,autounselectify:po,get:Zm,toJson:Zm,diff:Zm,forEach:Zm,cy:Zm,headless:po,styleEnabled:po,hideEdgesOnViewport:po,textureOnViewport:po,motionBlur:po,motionBlurOpacity:Km,wheelSensitivity:Km,pixelRatio:bp([ly,uy])},vR=(t,e)=>{if(((a,s)=>a==null||s==null)(t,e)&&(t!=null||e!=null))return!0;if(t===e)return!1;if(typeof t!="object"||typeof e!="object")return t!==e;const r=Object.keys(t),n=Object.keys(e),i=a=>t[a]!==e[a];return r.length!==n.length||!(!r.some(i)&&!n.some(i))},Al=(t,e)=>t!=null?t[e]:null,QU={diff:vR,get:Al,toJson:t=>t,forEach:(t,e)=>t.forEach(e),elements:[{data:{id:"a",label:"Example node A"}},{data:{id:"b",label:"Example node B"}},{data:{id:"e",source:"a",target:"b"}}],stylesheet:[{selector:"node",style:{label:"data(label)"}}],zoom:1,pan:{x:0,y:0}},dy=(t,e,r,n)=>r(Al(t,n),Al(e,n)),JU=(t,e,r,n,i,a,s)=>{t.batch(()=>{(n===vR||dy(e,r,n,"elements"))&&nG(t,Al(e,"elements"),Al(r,"elements"),i,a,s,n),dy(e,r,n,"stylesheet")&&rG(t,Al(e,"stylesheet"),Al(r,"stylesheet"),i),["zoom","minZoom","maxZoom","zoomingEnabled","userZoomingEnabled","pan","panningEnabled","userPanningEnabled","boxSelectionEnabled","autoungrabify","autolock","autounselectify"].forEach(o=>{dy(e,r,n,o)&&eG(t,o,Al(e,o),Al(r,o),i)})}),dy(e,r,n,"layout")&&tG(t,Al(e,"layout"),Al(r,"layout"),i)},eG=(t,e,r,n,i)=>{t[e](i(n))},tG=(t,e,r,n)=>{const i=n(r);i!=null&&t.layout(i).run()},rG=(t,e,r,n)=>{const i=t.style();i?.fromJson(n(r)).update()},nG=(t,e,r,n,i,a,s)=>{const o=[],l=t.collection(),u=[],c={},f={},p=v=>i(i(v,"data"),"id");a(r,v=>{const y=p(v);f[y]=v}),e!=null&&a(e,v=>{const y=p(v);c[y]=v,(S=>f[S]!=null)(y)||l.merge(t.getElementById(y))}),a(r,v=>{const y=p(v),S=(w=>c[w])(y);(w=>c[w]!=null)(y)?u.push({ele1:S,ele2:v}):o.push(n(v))}),l.length>0&&t.remove(l),o.length>0&&t.add(o),u.forEach(({ele1:v,ele2:y})=>iG(t,v,y,n,i,s))},iG=(t,e,r,n,i,a)=>{const s=i(i(r,"data"),"id"),o=t.getElementById(s),l={};["data","position","selected","selectable","locked","grabbable","classes"].forEach(c=>{const f=i(r,c);a(f,i(e,c))&&(l[c]=n(f))});const u=i(r,"scratch");a(u,i(e,"scratch"))&&o.scratch(n(u)),Object.keys(l).length>0&&o.json(l)};class aG extends nr.Component{static get propTypes(){return XU}static get defaultProps(){return QU}static normalizeElements(e){if(e.length!=null)return e;{let{nodes:r,edges:n}=e;return r==null&&(r=[]),n==null&&(n=[]),r.concat(n)}}constructor(e){super(e),this.displayName="CytoscapeComponent",this.containerRef=nr.createRef()}componentDidMount(){const e=this.containerRef.current,{global:r,headless:n,styleEnabled:i,hideEdgesOnViewport:a,textureOnViewport:s,motionBlur:o,motionBlurOpacity:l,wheelSensitivity:u,pixelRatio:c}=this.props,f=this._cy=new xh({container:e,headless:n,styleEnabled:i,hideEdgesOnViewport:a,textureOnViewport:s,motionBlur:o,motionBlurOpacity:l,wheelSensitivity:u,pixelRatio:c});r&&(window[r]=f),this.updateCytoscape(null,this.props)}updateCytoscape(e,r){const n=this._cy,{diff:i,toJson:a,get:s,forEach:o}=r;JU(n,e,r,i,a,s,o),r.cy!=null&&r.cy(n)}componentDidUpdate(e){this.updateCytoscape(e,this.props)}componentWillUnmount(){this._cy.destroy()}render(){const{id:e,className:r,style:n}=this.props;return nr.createElement("div",{ref:this.containerRef,id:e,className:r,style:n})}}const sG=[{selector:"node",style:{"background-color":"#1f2937",label:"data(label)",color:"#cbd5e1","font-family":"Outfit, sans-serif","font-size":"12px","text-valign":"bottom","text-margin-y":8,width:40,height:40,"border-width":2,"border-color":"#475569","text-outline-width":2,"text-outline-color":"#050508","overlay-padding":6,"z-index":10}},{selector:'node[category="Individual"]',style:{"background-color":"rgba(49, 46, 129, 0.9)","border-color":"#6366f1",shape:"ellipse",width:50,height:50}},{selector:'node[category="Location"]',style:{"background-color":"rgba(6, 78, 59, 0.9)","border-color":"#10b981",shape:"hexagon",width:60,height:60}},{selector:'node[category="Group"]',style:{"background-color":"rgba(88, 28, 135, 0.9)","border-color":"#a855f7",shape:"round-rectangle"}},{selector:"edge",style:{width:2,"line-color":"#334155","target-arrow-color":"#334155","target-arrow-shape":"triangle","curve-style":"bezier"}},{selector:":selected",style:{"border-width":4,"border-color":"#fafafa","line-color":"#fafafa","target-arrow-color":"#fafafa","z-index":999}}],oG=()=>{const{username:t,projectName:e}=qi(),{setRightPanelTab:r,setRightOpen:n}=nl(),i=Va(),[a,s]=ae.useState([]),[o,l]=ae.useState(""),[u,c]=ae.useState(!0),[f,p]=ae.useState(null),v=ae.useRef(null),[y,S]=ae.useState(null);ae.useEffect(()=>{r&&r("CONTEXT"),w()},[]),ae.useEffect(()=>{const N=setInterval(()=>{const R=document.getElementById("global-right-panel-portal");R&&(S(R),clearInterval(N))},100);return()=>{clearInterval(N),r&&r("NOTEBOOKS")}},[]);const w=async()=>{c(!0);try{const N=await et.get("/world-bible/graph");N&&N.nodes&&s([...N.nodes,...N.edges])}catch(N){console.error("Failed to load graph data",N),i("/")}finally{c(!1)}},E=()=>{if(!v.current)return;v.current.layout({name:"cose",animate:!0,padding:50,fit:!0,nodeOverlap:20,componentSpacing:100}).run()};ae.useEffect(()=>{v.current&&(E(),v.current.on("select","node",N=>{const R=N.target;p(R.data()),n(!0)}),v.current.on("unselect","node",()=>{p(null)}))},[a]);const _=()=>{if(!v.current||!o)return;const N=v.current;if(N.elements().removeClass("highlighted faded"),o.length>0){const R=N.nodes().filter(I=>I.data("label").toLowerCase().includes(o.toLowerCase()));R.length>0&&(N.elements().not(R).addClass("faded"),R.addClass("highlighted"),N.animate({fit:{eles:R,padding:50}}))}},T=()=>m.jsxs("div",{className:"p-6 flex flex-col h-full animate-in fade-in slide-in-from-right-4 duration-500 space-y-8",children:[m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsx("div",{className:"size-8 rounded bg-primary flex items-center justify-center",children:m.jsx("span",{className:"material-symbols-outlined text-primary-foreground text-sm",children:"hub"})}),m.jsx("h2",{className:"font-bold text-sm tracking-tight uppercase",children:"Network Controls"})]}),m.jsxs("div",{className:"flex gap-2",children:[m.jsx("input",{className:"bg-white/5 border border-white/10 rounded-xl px-4 py-2 text-xs w-full outline-none focus:ring-1 focus:ring-primary placeholder:text-slate-600 text-slate-200",placeholder:"Find cosmic entity...",value:o,onChange:N=>l(N.target.value),onKeyDown:N=>N.key==="Enter"&&_()}),m.jsx("button",{onClick:_,className:"px-4 bg-primary/20 hover:bg-primary/30 border border-primary/30 rounded-xl text-primary transition-colors",children:m.jsx("span",{className:"material-symbols-outlined text-base",children:"search"})})]}),m.jsxs("div",{className:"flex items-center justify-between pt-2",children:[m.jsxs("div",{className:"flex gap-2",children:[m.jsx("button",{onClick:E,className:"p-2.5 bg-white/5 hover:bg-white/10 rounded-xl text-slate-400 hover:text-white transition-colors border border-white/5",title:"Re-simulate Gravity",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"refresh"})}),m.jsx("button",{onClick:()=>v.current?.fit(),className:"p-2.5 bg-white/5 hover:bg-white/10 rounded-xl text-slate-400 hover:text-white transition-colors border border-white/5",title:"Fit View",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"fit_screen"})})]}),m.jsxs("div",{className:"flex flex-wrap gap-2 text-[8px] uppercase font-black text-slate-500",children:[m.jsxs("div",{className:"flex items-center gap-1",children:[m.jsx("div",{className:"size-1.5 rounded-full bg-indigo-500"})," IND"]}),m.jsxs("div",{className:"flex items-center gap-1",children:[m.jsx("div",{className:"size-1.5 rounded-full bg-emerald-500"})," LOC"]}),m.jsxs("div",{className:"flex items-center gap-1",children:[m.jsx("div",{className:"size-1.5 rounded-full bg-purple-500"})," GRP"]})]})]})]}),m.jsx("div",{className:"h-px bg-white/5"}),f?m.jsxs("div",{className:"space-y-6",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("div",{className:`size-12 rounded-2xl flex items-center justify-center text-white shadow-xl ${f.category==="Individual"?"bg-indigo-600 shadow-indigo-500/20":f.category==="Location"?"bg-emerald-600 shadow-emerald-500/20":"bg-purple-600 shadow-purple-500/20"}`,children:m.jsx("span",{className:"material-symbols-outlined",children:f.category==="Individual"?"person":f.category==="Location"?"location_on":"groups"})}),m.jsxs("div",{children:[m.jsx("h3",{className:"text-xl font-serif font-bold text-white leading-tight",children:f.label}),m.jsx("span",{className:"text-[10px] font-black uppercase tracking-tighter text-slate-500",children:f.category})]})]}),m.jsx("p",{className:"text-sm text-slate-400 font-serif leading-relaxed italic opacity-80",children:f.summary||"No description available for this cosmic entity."}),m.jsxs("div",{className:"pt-6 border-t border-white/5 space-y-3",children:[m.jsxs("button",{onClick:()=>i(`/${t}/${e}/entities/${f.type||"individual"}/${f.id}`),className:"w-full py-3 bg-white/5 hover:bg-white/10 border border-white/10 rounded-xl text-[10px] font-black uppercase tracking-widest text-slate-300 transition-all flex items-center justify-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"open_in_new"}),m.jsx("span",{children:"Open Bible Entry"})]}),m.jsxs("button",{onClick:()=>{if(!v.current)return;const N=v.current.$id(f.id);v.current.animate({center:{eles:N},zoom:2})},className:"w-full py-3 bg-indigo-600/10 hover:bg-indigo-600/20 border border-indigo-500/30 rounded-xl text-[10px] font-black uppercase tracking-widest text-indigo-300 transition-all flex items-center justify-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"center_focus_strong"}),m.jsx("span",{children:"Focus on Graph"})]})]})]}):m.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center text-slate-500 text-center opacity-40 py-12",children:[m.jsx("span",{className:"material-symbols-outlined text-4xl mb-4",children:"touch_app"}),m.jsxs("p",{className:"text-[10px] font-black uppercase tracking-widest leading-loose",children:["Select a node",m.jsx("br",{}),"to reveal its secrets"]})]})]});return m.jsxs("div",{className:"w-full h-full flex bg-background-dark relative overflow-hidden font-display text-foreground",children:[y&&xo.createPortal(T(),y),a.length===0&&!u&&m.jsx("div",{className:"absolute inset-0 flex items-center justify-center z-10 pointer-events-none",children:m.jsx("div",{className:"text-muted text-lg font-serif italic text-slate-600",children:"The void is empty. Document your world in the Bible."})}),m.jsx(aG,{elements:a,stylesheet:sG,style:{width:"100%",height:"100%"},cy:N=>{v.current=N},minZoom:.2,maxZoom:3,wheelSensitivity:.3,className:"bg-background-dark"})]})},lG=({id:t})=>{const{id:e}=qi(),r=Va(),[n,i]=ae.useState("overview"),[a,s]=ae.useState(null),[o,l]=ae.useState(!0),[u,c]=ae.useState(!1);ae.useEffect(()=>{f()},[t]);const f=async()=>{l(!0);try{const S=await et.get(`/bd/entidadindividual/${t}`);s(S)}catch(S){console.error("Error loading character:",S)}finally{l(!1)}},p=async()=>{try{await et.patch("/bd/modificar",{...a,tipoEntidad:"entidadindividual"}),c(!1)}catch(S){console.error("Error saving:",S)}},v=async()=>{if(window.confirm("Move this character to the Trash Bin?"))try{await et.delete(`/bd/entidadindividual/${t}`),r(`/project/${e}`)}catch(S){console.error(S)}},y=(S,w)=>{s(E=>({...E,[S]:w}))};return o?m.jsx("div",{className:"p-20 text-center text-slate-500 animate-pulse",children:"Summoning entity..."}):a?m.jsxs("div",{className:"flex h-full",children:[m.jsxs("div",{className:"flex-1 flex flex-col overflow-y-auto custom-scrollbar p-8 gap-6",children:[m.jsxs("div",{className:"flex items-start gap-6",children:[m.jsx("div",{className:"relative",children:m.jsx(rx,{url:a.imagenUrl||"https://images.unsplash.com/photo-1544005313-94ddf0286df2?q=80&w=1976&auto=format&fit=crop",size:"xl",className:"rounded-2xl border-2 border-primary shadow-[0_0_30px_rgba(99,102,242,0.3)]"})}),m.jsxs("div",{className:"flex-1",children:[m.jsxs("div",{className:"flex items-center gap-3 mb-1",children:[m.jsx("span",{className:"text-xs font-bold text-primary bg-primary/10 px-2 py-0.5 rounded border border-primary/20",children:a.estado||"ACTIVE"}),m.jsx("span",{className:"text-xs font-bold text-slate-400 bg-surface-light px-2 py-0.5 rounded border border-white/5",children:a.tipo||"Unknown"})]}),m.jsxs("h1",{className:"text-4xl font-bold text-white mb-2",children:[a.nombre," ",a.apellidos]}),m.jsx("p",{className:"text-lg text-slate-300",children:a.origen||"Traveling the void"})]}),m.jsxs("div",{className:"flex gap-2",children:[!u&&m.jsx(Dn,{className:"border-red-500/30 text-red-400 hover:bg-red-500/10",icon:"delete",onClick:v,children:"Delete"}),m.jsx(Dn,{variant:"secondary",icon:u?"close":"edit",onClick:()=>c(!u),children:u?"Cancel":"Edit Profile"}),u&&m.jsx(Dn,{variant:"primary",icon:"save",onClick:p,children:"Save Changes"})]})]}),m.jsx("div",{className:"border-b border-glass-border flex gap-6",children:["Overview","Biography","Attributes & Stats","Relationships"].map(S=>m.jsx("button",{onClick:()=>i(S.toLowerCase()),className:`pb-4 px-2 text-sm font-bold border-b-2 transition-colors ${n===S.toLowerCase()?"text-primary border-primary":"text-slate-500 border-transparent hover:text-white"}`,children:S},S))}),m.jsxs("div",{className:"grid grid-cols-3 gap-6",children:[m.jsx("div",{className:"col-span-1 space-y-6",children:m.jsxs(ti,{className:"p-4",children:[m.jsxs("h3",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider mb-4 flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"fingerprint"})," Identity"]}),m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[m.jsxs("div",{children:[m.jsx("label",{className:"text-xs text-slate-400 block mb-1",children:"Name"}),m.jsx("input",{type:"text",value:a.nombre,onChange:S=>y("nombre",S.target.value),className:"w-full bg-surface-light border border-white/10 rounded px-3 py-2 text-white text-sm",readOnly:!u})]}),m.jsxs("div",{children:[m.jsx("label",{className:"text-xs text-slate-400 block mb-1",children:"Surnames"}),m.jsx("input",{type:"text",value:a.apellidos||"",onChange:S=>y("apellidos",S.target.value),className:"w-full bg-surface-light border border-white/10 rounded px-3 py-2 text-white text-sm",readOnly:!u})]})]}),m.jsxs("div",{children:[m.jsx("label",{className:"text-xs text-slate-400 block mb-1",children:"Type / Species"}),m.jsx("input",{type:"text",value:a.tipo||"",onChange:S=>y("tipo",S.target.value),className:"w-full bg-surface-light border border-white/10 rounded px-3 py-2 text-white text-sm",readOnly:!u})]}),m.jsxs("div",{children:[m.jsx("label",{className:"text-xs text-slate-400 block mb-1",children:"Origin"}),m.jsx("input",{type:"text",value:a.origen||"",onChange:S=>y("origen",S.target.value),className:"w-full bg-surface-light border border-white/10 rounded px-3 py-2 text-white text-sm",readOnly:!u})]})]})]})}),m.jsx("div",{className:"col-span-2 space-y-6",children:m.jsxs(ti,{className:"p-6 relative overflow-hidden group",children:[m.jsxs("div",{className:"flex items-center justify-between mb-6",children:[m.jsxs("h3",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"auto_stories"})," Narrative & Connections"]}),!u&&m.jsx("span",{className:"text-[10px] text-slate-600 bg-white/5 px-2 py-1 rounded",children:"Read Only"})]}),m.jsxs("div",{className:"mb-8",children:[m.jsx("h4",{className:"text-[10px] font-black uppercase tracking-widest text-primary mb-3 opacity-80",children:"Biography"}),m.jsx("textarea",{value:a.descripcion||"",onChange:S=>y("descripcion",S.target.value),readOnly:!u,className:`w-full bg-transparent border-none outline-none text-slate-300 text-sm leading-relaxed resize-none custom-scrollbar ${u?"min-h-[150px] placeholder-white/20":"h-auto overflow-hidden"}`,placeholder:"Write the history of this person..."}),m.jsx("h4",{className:"text-[10px] font-black uppercase tracking-widest text-primary mt-6 mb-3 opacity-80",children:"Behavior & Personality"}),m.jsx("textarea",{value:a.comportamiento||"",onChange:S=>y("comportamiento",S.target.value),readOnly:!u,className:`w-full bg-transparent border-none outline-none text-slate-300 text-sm leading-relaxed resize-none custom-scrollbar ${u?"min-h-[100px]":"h-auto overflow-hidden"}`,placeholder:"How does this person act?"})]}),m.jsxs("div",{className:"pt-6 border-t border-white/5",children:[m.jsxs("h4",{className:"text-[10px] font-black uppercase tracking-widest text-primary mb-4 flex items-center gap-2 opacity-80",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"hub"})," Established Connections"]}),a.relaciones&&a.relaciones.length>0?m.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:a.relaciones.map((S,w)=>m.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white/5 rounded-xl border border-white/5 hover:border-primary/30 transition-colors",children:[m.jsx("div",{className:"size-8 rounded-full bg-white/10 flex items-center justify-center text-xs font-bold",children:S.entidadDestino?.nombre?.charAt(0)||"?"}),m.jsxs("div",{className:"flex-1 min-w-0",children:[m.jsx("div",{className:"text-sm font-bold text-white truncate",children:S.entidadDestino?.nombre||"Unknown"}),m.jsx("div",{className:"text-[10px] text-primary truncate",children:S.tipoRelacion||"Connected"})]})]},w))}):m.jsx("div",{className:"p-6 text-center bg-white/5 rounded-xl border border-dashed border-white/10",children:m.jsx("p",{className:"text-xs text-slate-500 italic",children:"No relationships recorded yet."})})]})]})})]})]}),m.jsxs("div",{className:"w-80 border-l border-glass-border bg-surface-dark/50 hidden xl:flex flex-col",children:[m.jsxs("div",{className:"p-4 border-b border-glass-border flex justify-between items-center",children:[m.jsx("span",{className:"text-xs font-bold text-slate-500",children:"QUICK NOTES"}),m.jsx("button",{className:"text-slate-400 hover:text-white",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"open_in_new"})})]}),m.jsx("div",{className:"p-4 flex-1",children:m.jsx("textarea",{className:"w-full h-full bg-transparent border-none outline-none text-sm text-slate-300 placeholder-slate-600 resize-none",placeholder:"Draft a quick scene or jot down notes for Elara here..."})}),m.jsx("div",{className:"p-2 border-t border-glass-border text-right text-[10px] text-slate-600",children:"0 words"})]})]}):m.jsx("div",{className:"p-20 text-center text-red-500",children:"Character not found in the archives."})},r5=({id:t})=>{const[e,r]=ae.useState(null),[n,i]=ae.useState(!0),[a,s]=ae.useState(!1);ae.useEffect(()=>{o()},[t]);const o=async()=>{i(!0);try{const c=await et.get(`/bd/zona/${t}`);r(c)}catch(c){console.error("Error loading location:",c)}finally{i(!1)}},l=async()=>{try{await et.patch("/bd/modificar",{...e,tipoEntidad:"zona"}),s(!1)}catch(c){console.error("Error saving:",c)}},u=(c,f)=>{r(p=>({...p,[c]:f}))};return n?m.jsx("div",{className:"p-20 text-center text-slate-500 animate-pulse",children:"Scanning terrain..."}):e?m.jsxs("div",{className:"flex h-full overflow-y-auto custom-scrollbar p-8 flex-col gap-8",children:[m.jsxs("header",{className:"flex justify-between items-end",children:[m.jsxs("div",{children:[m.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[m.jsx("span",{className:"text-xs font-bold text-emerald-400 bg-emerald-400/10 px-2 py-0.5 rounded border border-emerald-400/20",children:"LOCATION"}),m.jsx("span",{className:"text-xs font-bold text-slate-400 bg-surface-light px-2 py-0.5 rounded border border-white/5",children:e.tipo||"Wilderness"})]}),m.jsx("h1",{className:"text-5xl font-manrope font-black text-white tracking-tight",children:e.nombre}),m.jsx("p",{className:"text-slate-400 mt-2",children:e.apellidos||"Uncharted territory"})]}),m.jsxs("div",{className:"flex gap-2",children:[m.jsx(Dn,{variant:"secondary",icon:a?"close":"edit",onClick:()=>s(!a),children:a?"Cancel":"Edit Location"}),a&&m.jsx(Dn,{variant:"primary",icon:"save",onClick:l,children:"Update Records"})]})]}),m.jsxs("div",{className:"grid grid-cols-3 gap-8",children:[m.jsxs("div",{className:"col-span-1 space-y-6",children:[m.jsxs(ti,{className:"p-6",children:[m.jsxs("h3",{className:"text-xs font-bold text-slate-500 uppercase tracking-widest mb-4 flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"straighten"})," Geography & Scale"]}),m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{children:[m.jsx("label",{className:"text-xs text-slate-400 block mb-1",children:"Size / Scale"}),m.jsx("input",{type:"text",value:e.tamanno||"",onChange:c=>u("tamanno",c.target.value),className:"w-full bg-surface-light border border-white/10 rounded px-3 py-2 text-white text-sm",readOnly:!a})]}),m.jsxs("div",{children:[m.jsx("label",{className:"text-xs text-slate-400 block mb-1",children:"Development Level"}),m.jsx("input",{type:"text",value:e.desarrollo||"",onChange:c=>u("desarrollo",c.target.value),className:"w-full bg-surface-light border border-white/10 rounded px-3 py-2 text-white text-sm",readOnly:!a})]})]})]}),m.jsxs(ti,{className:"p-6",children:[m.jsx("h3",{className:"text-xs font-bold text-slate-500 uppercase tracking-widest mb-4",children:"Quick Stats"}),m.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[m.jsxs("div",{className:"bg-white/5 p-3 rounded-xl border border-white/5",children:[m.jsx("span",{className:"text-[10px] text-slate-500 block",children:"Density"}),m.jsx("span",{className:"text-white font-bold",children:"Medium"})]}),m.jsxs("div",{className:"bg-white/5 p-3 rounded-xl border border-white/5",children:[m.jsx("span",{className:"text-[10px] text-slate-500 block",children:"Security"}),m.jsx("span",{className:"text-emerald-400 font-bold",children:"Stable"})]})]})]})]}),m.jsx("div",{className:"col-span-2 space-y-6",children:m.jsxs(ti,{className:"p-8",children:[m.jsxs("h3",{className:"text-xs font-bold text-slate-500 uppercase tracking-widest mb-4 flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"description"})," Topographic Records & Lore"]}),m.jsx("textarea",{value:e.descripcion||"",onChange:c=>u("descripcion",c.target.value),readOnly:!a,className:"w-full bg-transparent border-none outline-none text-slate-300 text-lg leading-relaxed min-h-[400px] resize-none",placeholder:"Describe the vistas, the smells, and the secrets of this place..."})]})})]})]}):m.jsx("div",{className:"p-20 text-center text-red-500",children:"Location not found in the maps."})},uG=({id:t})=>{const[e,r]=ae.useState(null),[n,i]=ae.useState(!0),[a,s]=ae.useState(!1);ae.useEffect(()=>{o()},[t]);const o=async()=>{i(!0);try{const c=await et.get(`/bd/entidadcolectiva/${t}`);r(c)}catch(c){console.error("Error loading collective:",c)}finally{i(!1)}},l=async()=>{try{await et.patch("/bd/modificar",{...e,tipoEntidad:"entidadcolectiva"}),s(!1)}catch(c){console.error("Error saving:",c)}},u=(c,f)=>{r(p=>({...p,[c]:f}))};return n?m.jsx("div",{className:"p-20 text-center text-slate-500 animate-pulse",children:"Gathering intelligence..."}):e?m.jsxs("div",{className:"flex h-full overflow-y-auto custom-scrollbar p-8 flex-col gap-8",children:[m.jsxs("header",{className:"flex justify-between items-end",children:[m.jsxs("div",{children:[m.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[m.jsx("span",{className:"text-xs font-bold text-indigo-400 bg-indigo-400/10 px-2 py-0.5 rounded border border-indigo-400/20",children:"COLLECTIVE"}),m.jsx("span",{className:"text-xs font-bold text-slate-400 bg-surface-light px-2 py-0.5 rounded border border-white/5",children:e.tipo||"Organization"})]}),m.jsx("h1",{className:"text-5xl font-manrope font-black text-white tracking-tight",children:e.nombre}),m.jsxs("p",{className:"text-slate-400 mt-2",children:[e.cantidadMiembros||"Unknown"," members"]})]}),m.jsxs("div",{className:"flex gap-2",children:[m.jsx(Dn,{variant:"secondary",icon:a?"close":"edit",onClick:()=>s(!a),children:a?"Cancel":"Edit Collective"}),a&&m.jsx(Dn,{variant:"primary",icon:"save",onClick:l,children:"Update Dossier"})]})]}),m.jsxs("div",{className:"grid grid-cols-3 gap-8",children:[m.jsx("div",{className:"col-span-1 space-y-6",children:m.jsxs(ti,{className:"p-6",children:[m.jsxs("h3",{className:"text-xs font-bold text-slate-500 uppercase tracking-widest mb-4 flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"group_work"})," Group Dynamics"]}),m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{children:[m.jsx("label",{className:"text-xs text-slate-400 block mb-1",children:"Scale / Members"}),m.jsx("input",{type:"text",value:e.cantidadMiembros||"",onChange:c=>u("cantidadMiembros",c.target.value),className:"w-full bg-surface-light border border-white/10 rounded px-3 py-2 text-white text-sm",readOnly:!a})]}),m.jsxs("div",{children:[m.jsx("label",{className:"text-xs text-slate-400 block mb-1",children:"Behavior / Alignment"}),m.jsx("input",{type:"text",value:e.comportamiento||"",onChange:c=>u("comportamiento",c.target.value),className:"w-full bg-surface-light border border-white/10 rounded px-3 py-2 text-white text-sm",readOnly:!a})]})]})]})}),m.jsx("div",{className:"col-span-2 space-y-6",children:m.jsxs(ti,{className:"p-8",children:[m.jsxs("h3",{className:"text-xs font-bold text-slate-500 uppercase tracking-widest mb-4 flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"history_edu"})," Mandate & History"]}),m.jsx("textarea",{value:e.descripcion||"",onChange:c=>u("descripcion",c.target.value),readOnly:!a,className:"w-full bg-transparent border-none outline-none text-slate-300 text-lg leading-relaxed min-h-[400px] resize-none",placeholder:"Detail the motives, the structure, and the legacy of this group..."})]})})]})]}):m.jsx("div",{className:"p-20 text-center text-red-500",children:"Collective not found in the records."})},cG=()=>m.jsx("div",{className:"flex-1 flex overflow-hidden bg-background-dark font-sans text-slate-300",children:m.jsxs("main",{className:"flex-1 flex flex-col p-12 overflow-y-auto custom-scrollbar relative",children:[m.jsxs("header",{className:"mb-12 space-y-4",children:[m.jsxs("div",{className:"flex items-center gap-2 text-slate-500 font-bold text-[10px] tracking-widest uppercase",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"grid_view"}),m.jsx("span",{children:"Universo Alpha"}),m.jsx("span",{className:"material-symbols-outlined text-sm",children:"chevron_right"}),m.jsx("span",{children:"Galaxia Andrmeda"}),m.jsx("span",{className:"material-symbols-outlined text-sm",children:"chevron_right"}),m.jsx("span",{className:"text-white",children:"Sistema Solar"})]}),m.jsxs("div",{className:"flex justify-between items-start",children:[m.jsxs("div",{className:"space-y-4 max-w-3xl",children:[m.jsxs("div",{className:"flex items-center gap-3 px-3 py-1 rounded bg-orange-500/10 text-orange-400 border border-orange-500/20 inline-block",children:[m.jsx("span",{className:"material-symbols-outlined text-[14px]",children:"sunny"}),m.jsx("span",{className:"text-[9px] font-black uppercase tracking-widest",children:"Sistema Planetario"}),m.jsx("span",{className:"text-[9px] font-bold text-slate-600 tracking-widest ml-2",children:"ID: SYS-SOL-001"})]}),m.jsx("h1",{className:"text-6xl font-manrope font-black text-white tracking-tight",children:"Sistema Solar"}),m.jsx("p",{className:"text-slate-400 text-lg leading-relaxed",children:"Sistema planetario principal ubicado en el Brazo de Orin, hogar de la nica vida biolgica compleja confirmada en el sector galctico Alpha-9."})]}),m.jsxs("div",{className:"flex gap-3",children:[m.jsx("button",{className:"p-3 rounded-2xl bg-white/5 hover:bg-red-500/10 text-slate-500 hover:text-red-400 border border-white/5 transition-all outline-none",children:m.jsx("span",{className:"material-symbols-outlined",children:"delete"})}),m.jsx(Dn,{variant:"primary",icon:"save",children:"Guardar"})]})]})]}),m.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-12",children:[m.jsxs("div",{className:"lg:col-span-1 space-y-8",children:[m.jsxs("section",{className:"space-y-4",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-primary text-lg",children:"sell"}),m.jsx("h4",{className:"text-[10px] font-black uppercase tracking-[0.2em] text-slate-500",children:"Etiquetas"}),m.jsx("span",{className:"ml-auto text-[9px] font-bold text-slate-600 px-1.5 py-0.5 rounded bg-white/5",children:"3 ACTIVAS"})]}),m.jsxs("div",{className:"flex flex-wrap gap-2",children:[m.jsx(b2,{label:"Estrella Tipo G",color:"amber",icon:"star"}),m.jsx(b2,{label:"Vida Confirmada",color:"emerald",icon:"tempest"}),m.jsx(b2,{label:"Rico en Agua",color:"cyan",icon:"water_drop"}),m.jsx("button",{className:"size-8 rounded-full border border-dashed border-white/10 flex items-center justify-center text-slate-600 hover:text-white hover:border-white/30 transition-all",children:"+"})]})]}),m.jsxs("section",{className:"space-y-6",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-primary text-lg",children:"analytics"}),m.jsx("h4",{className:"text-[10px] font-black uppercase tracking-[0.2em] text-slate-500",children:"Atributos Principales"}),m.jsx("button",{className:"ml-auto text-slate-600 hover:text-white transition-colors",children:m.jsx("span",{className:"material-symbols-outlined text-lg",children:"settings"})})]}),m.jsxs("div",{className:"space-y-4",children:[m.jsx(fy,{label:"Forma / Estructura",value:"Heliosfrica Estndar",icon:"hive"}),m.jsx(fy,{label:"Composicin",value:"Hidrgeno (74%), Helio (24%)",icon:"experiment"}),m.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[m.jsx(fy,{label:"Edad (Aos)",value:"4.6 MM",unit:"Aos"}),m.jsx(fy,{label:"Ciclo Orbital",value:"230 MM",unit:"Aos"})]})]})]}),m.jsxs("section",{className:"space-y-4",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-primary text-lg",children:"menu_book"}),m.jsx("h4",{className:"text-[10px] font-black uppercase tracking-[0.2em] text-slate-500",children:"Notas de Lore"})]}),m.jsx("textarea",{className:"w-full h-48 bg-white/5 border border-white/5 rounded-[2rem] p-6 text-sm text-slate-400 placeholder:text-slate-700 focus:border-primary/50 outline-none transition-all resize-none leading-relaxed italic shadow-inner",defaultValue:"El sistema contiene un cinturn de asteroides inusualmente denso entre el 4 y 5 planeta. Se teoriza que es el remanente de una colisin planetaria antigua conocida como 'El Gran Impacto' en las escrituras sagradas de los habitantes de Terra."})]})]}),m.jsx("div",{className:"lg:col-span-2",children:m.jsxs(ti,{className:"h-full border-white/5 bg-surface-dark/40 overflow-hidden flex flex-col shadow-2xl",children:[m.jsxs("header",{className:"p-8 border-b border-white/5 flex justify-between items-center",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("div",{className:"size-10 rounded-xl bg-primary/20 text-primary flex items-center justify-center",children:m.jsx("span",{className:"material-symbols-outlined",children:"hub"})}),m.jsxs("div",{children:[m.jsx("h3",{className:"font-bold text-white text-lg tracking-tight",children:"Contenido Interno (Planetas)"}),m.jsx("p",{className:"text-[10px] font-medium text-slate-500 mt-0.5",children:"Arrastra para reordenar la jerarqua orbital"})]})]}),m.jsxs("div",{className:"px-3 py-1 rounded-full bg-emerald-500/10 text-emerald-400 border border-emerald-500/20 text-[10px] font-black uppercase tracking-widest flex items-center gap-2",children:[m.jsx("div",{className:"size-1.5 rounded-full bg-emerald-500 animate-pulse"}),"8 Entidades"]})]}),m.jsxs("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-6 space-y-3",children:[m.jsx(Ym,{name:"Mercurio",type:"Rocoso",stats:"430C | 88 Das",icon:"public"}),m.jsx(Ym,{name:"Venus",type:"Atmsfera",stats:"462C | 225 Das",icon:"public"}),m.jsx(Ym,{name:"Tierra",type:"Habitable",stats:"8B Hab | 1 Luna",icon:"public",active:!0}),m.jsx(Ym,{name:"Marte",type:"Desierto",stats:"-60C | 2 Lunas",icon:"public"}),m.jsx(Ym,{name:"Cinturn Asteroides",type:"Anillo",stats:">1M Obj",icon:"grain"})]}),m.jsx("div",{className:"p-8 bg-black/20 border-t border-white/5",children:m.jsxs("button",{className:"w-full py-4 rounded-[1.5rem] border-2 border-dashed border-white/10 text-slate-500 hover:text-white hover:border-primary/50 hover:bg-primary/5 transition-all flex items-center justify-center gap-3 font-black uppercase text-[10px] tracking-[0.2em]",children:[m.jsx("span",{className:"material-symbols-outlined",children:"add"}),"Aadir Nueva Entidad"]})})]})})]})]})}),b2=({label:t,color:e,icon:r})=>m.jsxs("div",{className:`px-4 py-1.5 rounded-xl bg-${e}-500/10 text-${e}-400 border border-${e}-500/20 flex items-center gap-2 text-[10px] font-black uppercase tracking-widest shadow-lg`,children:[m.jsx("span",{className:"material-symbols-outlined text-[14px]",children:r}),t]}),fy=({label:t,value:e,unit:r,icon:n})=>m.jsxs("div",{className:"space-y-2",children:[m.jsx("p",{className:"text-[9px] font-black uppercase tracking-widest text-slate-600 ml-1",children:t}),m.jsxs("div",{className:"w-full bg-white/5 border border-white/5 rounded-2xl px-5 py-3.5 flex items-center justify-between group hover:border-white/10 transition-all",children:[m.jsxs("div",{className:"flex items-center gap-3",children:[n&&m.jsx("span",{className:"material-symbols-outlined text-slate-500 text-lg group-hover:text-primary transition-colors",children:n}),m.jsx("span",{className:"text-sm font-bold text-slate-300",children:e})]}),r&&m.jsx("span",{className:"text-[10px] font-black text-slate-600 uppercase tracking-widest",children:r})]})]}),Ym=({name:t,type:e,stats:r,icon:n,active:i})=>m.jsxs("div",{className:`group flex items-center gap-6 p-4 rounded-2xl transition-all cursor-pointer ${i?"bg-primary/10 border border-primary/20 shadow-xl":"hover:bg-white/5 border border-transparent"}`,children:[m.jsx("span",{className:"material-symbols-outlined text-slate-700 group-hover:text-slate-500",children:"drag_indicator"}),m.jsx("div",{className:`size-12 rounded-xl flex items-center justify-center ${i?"bg-primary text-white shadow-lg shadow-primary/30":"bg-surface-dark border border-white/5 text-slate-500"}`,children:m.jsx("span",{className:"material-symbols-outlined text-3xl",children:n})}),m.jsx("div",{className:"flex-1",children:m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsx("h4",{className:"text-sm font-bold text-white group-hover:text-primary transition-colors",children:t}),m.jsx("span",{className:`text-[8px] font-black px-1.5 py-0.5 rounded uppercase tracking-widest ${i?"bg-emerald-500/20 text-emerald-400 border border-emerald-500/30":"bg-white/5 text-slate-600"}`,children:e})]})}),m.jsx("div",{className:"flex flex-col items-end gap-1",children:m.jsxs("div",{className:"flex items-center gap-1.5 text-slate-500",children:[m.jsx("span",{className:"material-symbols-outlined text-[12px]",children:"analytics"}),m.jsx("span",{className:"text-[10px] font-mono tracking-tight group-hover:text-slate-300",children:r})]})}),m.jsxs("div",{className:"flex gap-2 ml-4",children:[m.jsx("button",{className:"p-2 rounded-lg text-slate-700 hover:text-white hover:bg-white/5 transition-all",children:m.jsx("span",{className:"material-symbols-outlined text-xl",children:"edit_note"})}),i?m.jsx("button",{className:"size-8 rounded-full bg-primary text-white flex items-center justify-center shadow-lg",children:m.jsx("span",{className:"material-symbols-outlined text-lg",children:"arrow_forward"})}):m.jsx("button",{className:"p-2 rounded-lg text-slate-700 hover:text-white hover:bg-white/5 transition-all",children:m.jsx("span",{className:"material-symbols-outlined text-xl",children:"open_in_new"})})]})]}),dG=()=>m.jsx("div",{className:"flex-1 flex overflow-hidden bg-background-dark font-sans text-slate-300",children:m.jsxs("main",{className:"flex-1 flex flex-col p-12 overflow-y-auto custom-scrollbar relative",children:[m.jsxs("header",{className:"mb-12 space-y-4",children:[m.jsxs("div",{className:"flex items-center gap-2 text-slate-500 font-bold text-[10px] tracking-widest uppercase",children:[m.jsx("span",{children:"Sistema Solar"}),m.jsx("span",{className:"material-symbols-outlined text-sm",children:"chevron_right"}),m.jsx("span",{children:"Kepler-186f"}),m.jsx("span",{className:"material-symbols-outlined text-sm",children:"chevron_right"}),m.jsx("span",{className:"text-white",children:"Territorios"})]}),m.jsxs("div",{className:"flex justify-between items-end",children:[m.jsxs("div",{children:[m.jsxs("div",{className:"flex items-center gap-4 mb-2",children:[m.jsx("h1",{className:"text-6xl font-manrope font-black text-white tracking-tight",children:"Kepler-186f"}),m.jsx("span",{className:"material-symbols-outlined text-4xl text-primary",children:"public"})]}),m.jsx("p",{className:"text-slate-400 text-lg max-w-2xl leading-relaxed",children:"Gestin geopoltica y geogrfica de la superficie planetaria. Administra biomas, asentamientos y recursos estratgicos."})]}),m.jsxs("div",{className:"flex gap-3",children:[m.jsx(Dn,{variant:"secondary",icon:"map",children:"Ver Atlas"}),m.jsx(Dn,{variant:"primary",icon:"add",children:"Nuevo Territorio"})]})]})]}),m.jsxs("section",{className:"space-y-8",children:[m.jsxs(ti,{className:"p-2 flex items-center justify-between border-white/5",children:[m.jsxs("div",{className:"flex items-center gap-4 flex-1",children:[m.jsxs("div",{className:"relative flex-1 max-w-sm",children:[m.jsx("span",{className:"material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-slate-500 text-sm",children:"search"}),m.jsx("input",{type:"text",placeholder:"Buscar por nombre...",className:"w-full bg-transparent border-none rounded-xl py-2 pl-9 pr-4 text-xs focus:ring-1 focus:ring-primary/30 outline-none transition-all"})]}),m.jsx("div",{className:"w-px h-6 bg-white/5 mx-2"}),m.jsx(w2,{label:"Bioma: Todos"}),m.jsx(w2,{label:"Poblacin"}),m.jsx(w2,{label:"Estado"})]}),m.jsxs("div",{className:"flex items-center gap-1 p-1 bg-white/5 rounded-lg",children:[m.jsx("button",{className:"p-1.5 rounded-md text-slate-500 hover:text-white transition-colors",children:m.jsx("span",{className:"material-symbols-outlined text-lg",children:"format_list_bulleted"})}),m.jsx("button",{className:"p-1.5 rounded-md bg-white/10 text-white shadow-sm",children:m.jsx("span",{className:"material-symbols-outlined text-lg",children:"grid_view"})})]})]}),m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:[m.jsx(S2,{title:"Nueva Neo-Tokyo",desc:"Metrpolis vertical construida sobre las...",image:"https://lh3.googleusercontent.com/aida-public/AB6AXuAYF5Q6W3o1w1f1",badges:["Capital"],stats:["15M","Templado","Costero"],color:"cyan"}),m.jsx(S2,{title:"Mar de Dunas",desc:"Extensin rida rica en especia slica...",image:"https://lh3.googleusercontent.com/aida-public/AB6AXuBYG6R7X4p2x2g2",stats:["Hostil","rido"],color:"amber"}),m.jsx(S2,{title:"Sanctum Bio-Domo",desc:"Instalacin de investigacin...",image:"https://lh3.googleusercontent.com/aida-public/AB6AXuCZ H7S8Y5q3z3h3",badges:["Ciencia"],stats:["5K","Jungla"],color:"purple"}),m.jsxs("div",{className:"group border-2 border-dashed border-white/5 rounded-[2.5rem] flex flex-col items-center justify-center p-12 gap-4 hover:border-primary/30 hover:bg-primary/5 transition-all cursor-pointer",children:[m.jsx("div",{className:"size-16 rounded-3xl bg-white/5 flex items-center justify-center group-hover:scale-110 transition-transform",children:m.jsx("span",{className:"material-symbols-outlined text-3xl text-slate-600 group-hover:text-primary",children:"add_location_alt"})}),m.jsx("p",{className:"text-xs font-black uppercase tracking-widest text-slate-600 group-hover:text-white",children:"Aadir Territorio"})]})]})]})]})}),w2=({label:t})=>m.jsxs("button",{className:"flex items-center gap-2 px-3 py-1.5 rounded-xl hover:bg-white/5 transition-all group",children:[m.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest text-slate-500 group-hover:text-white",children:t}),m.jsx("span",{className:"material-symbols-outlined text-slate-600 text-[14px]",children:"expand_more"})]}),S2=({title:t,desc:e,image:r,badges:n=[],stats:i=[],color:a})=>m.jsxs("div",{className:"group relative rounded-[2.5rem] overflow-hidden border border-white/5 bg-surface-dark/50 hover:border-white/10 transition-all shadow-2xl",children:[m.jsxs("div",{className:"h-48 overflow-hidden relative",children:[m.jsx("img",{src:r,alt:t,className:"w-full h-full object-cover transition-transform duration-700 group-hover:scale-110 opacity-60 group-hover:opacity-100"}),m.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-surface-dark via-transparent to-transparent"}),m.jsx("div",{className:"absolute top-4 right-4 flex gap-2",children:n.map(s=>m.jsxs("span",{className:`px-3 py-1 rounded-full text-[9px] font-black uppercase tracking-widest bg-${a==="cyan"?"primary":a==="amber"?"amber-500":"purple-500"}/20 text-${a==="cyan"?"primary":a==="amber"?"amber-400":"purple-400"} border border-white/10 backdrop-blur-md flex items-center gap-1.5`,children:[m.jsx("span",{className:"material-symbols-outlined text-[12px]",children:s==="Capital"?"star":"science"}),s]},s))})]}),m.jsxs("div",{className:"p-8 space-y-6",children:[m.jsxs("header",{className:"flex justify-between items-start",children:[m.jsxs("div",{children:[m.jsx("h3",{className:"text-2xl font-manrope font-black text-white mb-2 group-hover:text-primary transition-colors",children:t}),m.jsx("p",{className:"text-xs text-slate-500 leading-relaxed line-clamp-2",children:e})]}),m.jsx("button",{className:"p-2 text-slate-700 hover:text-white",children:m.jsx("span",{className:"material-symbols-outlined",children:"more_vert"})})]}),m.jsx("div",{className:"flex flex-wrap gap-2",children:i.map(s=>m.jsxs("div",{className:"flex items-center gap-1.5 px-3 py-1 rounded-full bg-white/5 border border-white/5 text-[9px] font-black text-slate-400 uppercase tracking-widest",children:[m.jsx("div",{className:`size-1.5 rounded-full bg-${a==="cyan"?"primary":a==="amber"?"amber-500":"purple-500"}/50`}),s]},s))}),m.jsxs("div",{className:"flex gap-3 pt-2",children:[m.jsxs("button",{className:"flex-1 py-2.5 rounded-xl bg-white/5 hover:bg-white/10 border border-white/5 text-[10px] font-black uppercase tracking-widest text-slate-300 flex items-center justify-center gap-2 transition-all",children:[m.jsx("span",{className:"material-symbols-outlined text-sm opacity-50",children:"edit"})," Editar"]}),m.jsxs("button",{className:"flex-1 py-2.5 rounded-xl bg-white/5 hover:bg-white/10 border border-white/5 text-[10px] font-black uppercase tracking-widest text-slate-300 flex items-center justify-center gap-2 transition-all",children:[m.jsx("span",{className:"material-symbols-outlined text-sm opacity-50",children:"map"})," Ubicacin"]})]})]})]}),fG=()=>{const{type:t,entityId:e}=qi(),r=()=>{const n=t?.toLowerCase();switch(n){case"character":case"entidadindividual":return m.jsx(lG,{id:e});case"location":case"zona":return m.jsx(r5,{id:e});case"culture":case"entidadcolectiva":return m.jsx(uG,{id:e});case"universe":case"galaxy":case"system":return m.jsx(cG,{id:e,type:n});case"planet":return m.jsx(dG,{id:e});case"construccion":return m.jsx(r5,{id:e});case"efectos":return m.jsxs("div",{className:"p-8 text-white",children:["Effect/Spell View for ID: ",e]});case"interaccion":return m.jsxs("div",{className:"p-8 text-white",children:["Interaction/Event View for ID: ",e]});case"magic":return m.jsxs("div",{className:"p-8 text-white",children:["Magic System View for ID: ",id]});default:return m.jsxs("div",{className:"p-8 text-white",children:["Unknown Entity Type: ",t]})}};return m.jsx("div",{className:"flex-1 bg-background-dark overflow-hidden",children:r()})},hG=()=>{const{t}=Ps(),{setRightPanelTab:e,setRightOpen:r}=nl(),[n,i]=ae.useState([]),[a,s]=ae.useState(null),[o,l]=ae.useState([]),[u,c]=ae.useState(!0),[f,p]=ae.useState(!1),[v,y]=ae.useState(!1),[S,w]=ae.useState({nombre:"",descripcion:"",fechaTexto:"",ordenAbsoluto:0}),[E,_]=ae.useState({nombre:"",descripcion:""}),[T,N]=ae.useState(null),[R,I]=ae.useState(null),[F,D]=ae.useState("eventos"),[j,B]=ae.useState([]),[G,K]=ae.useState([]),[O,W]=ae.useState(null),U=nr.useRef(!1),q=async Ce=>{try{return(await et.get("/bd/relacion")).filter(gt=>gt.tipoOrigen==="lineatiempo"&&gt.idOrigen===Ce||gt.tipoDestino==="lineatiempo"&&gt.idDestino===Ce).map(gt=>gt.idOrigen===Ce?gt.idDestino:gt.idOrigen)}catch(Ie){return console.error(Ie),[]}},Z=async(Ce,Ie)=>{const Je=await q(Ce),Qe=Ie.filter(At=>Je.includes(At.id));B(Qe);const gt=Ie.filter(At=>At.id!==Ce&&!Je.includes(At.id));K(gt)},Q=async Ce=>{if(!(!a||!Ce))try{await et.put("/bd/insertar",{tipoEntidad:"relacion",tipoOrigen:"lineatiempo",idOrigen:a,tipoDestino:"lineatiempo",idDestino:Ce,descripcion:"Anexo de lnea de tiempo"}),Z(a,n)}catch(Ie){console.error(Ie)}},ne=async Ce=>{const Je=(await et.get("/bd/relacion")).find(Qe=>Qe.tipoOrigen==="lineatiempo"&&Qe.idOrigen===a&&Qe.idDestino===Ce||Qe.tipoDestino==="lineatiempo"&&Qe.idDestino===a&&Qe.idOrigen===Ce);Je&&(await et.delete(`/bd/relacion/${Je.id}`),Z(a,n))};ae.useEffect(()=>{e&&e("CONTEXT");const Ce=setInterval(()=>{const Ie=document.getElementById("global-right-panel-portal");Ie&&(W(Ie),clearInterval(Ce))},50);return()=>{clearInterval(Ce),e&&e("NOTEBOOKS")}},[e]);const[re,Y]=ae.useState([]),[J,ie]=ae.useState(null);ae.useEffect(()=>{U.current||(U.current=!0,he())},[]);const de=Ce=>{setRightPanelTitle(m.jsxs("div",{className:"flex flex-col",children:[m.jsx("span",{children:t("timeline.title").toUpperCase()}),Ce&&m.jsx("span",{className:"text-[10px] text-slate-400 font-medium normal-case tracking-normal mt-0.5",children:Ce})]}))};ae.useEffect(()=>{if(F==="eventos"||F==="anexos")if(a){const Ie=re.flatMap(Je=>Je.lineasTemporales||[]).find(Je=>Je.id===a);de(Ie?.nombre)}else de(null);else F==="universo"&&setRightPanelTitle(t("timeline.multiverse"))},[a,F,re]);const he=async()=>{try{const Ce=await et.get("/multiverso/list");if(Y(Ce),!a&&Ce.length>0){const Ie=Ce[0];Ie.lineasTemporales&&Ie.lineasTemporales.length>0&&s(Ie.lineasTemporales[0].id)}}catch(Ce){console.error("Failed to load multiverse",Ce)}},xe=async Ce=>{try{const Ie=await et.get(`/timeline/linea/${Ce}/eventos`);Ie.sort((Je,Qe)=>(Je.ordenAbsoluto||0)-(Qe.ordenAbsoluto||0)),l(Ie)}catch(Ie){console.error("Failed to load events",Ie)}},le=async()=>{if(!a||!S.nombre)return;const Ce={...S,ordenAbsoluto:parseInt(S.ordenAbsoluto)||0};try{T?await et.put(`/timeline/evento/${T.id}`,{...Ce,lineaTiempo:{id:a}}):await et.post("/timeline/evento",{...Ce,lineaTiempo:{id:a}}),w({nombre:"",descripcion:"",fechaTexto:"",ordenAbsoluto:0}),N(null),xe(a)}catch(Ie){console.error(Ie)}},fe=Ce=>{N(Ce),w({nombre:Ce.nombre,descripcion:Ce.descripcion,fechaTexto:Ce.fechaTexto,ordenAbsoluto:Ce.ordenAbsoluto||0}),D("eventos"),r(!0)},ve=async()=>{if(!(!E.nombre||!E.universoId))try{const Ce=await et.post("/timeline/linea",{...E,esRaiz:!1,universo:{id:E.universoId}});y(!1),_({nombre:"",descripcion:"",universoId:null}),await he(),s(Ce.id)}catch(Ce){console.error("Error creating timeline:",Ce)}},[ge,se]=ae.useState({nombre:"",descripcion:""}),ye=async()=>{if(ge.nombre)try{const Ce=await et.post("/multiverso/crear",ge);se({nombre:"",descripcion:""}),r(!1),await he()}catch(Ce){console.error("Error creating universe",Ce)}},Se=async()=>{if(J)try{await et.put(`/multiverso/${J}`,{nombre:ge.nombre,descripcion:ge.descripcion}),r(!1),await he()}catch(Ce){console.error("Error updating universe",Ce)}},Ue=async()=>{if(J&&window.confirm(t("timeline.delete_universe_confirm")))try{await et.delete(`/multiverso/${J}`),r(!1),ie(null),await he()}catch(Ce){console.error("Error deleting universe",Ce)}};ae.useEffect(()=>{if(F==="universe-create")se({nombre:"",descripcion:""});else if(F==="universe-edit"&&J){const Ce=re.find(Ie=>Ie.id===J);Ce&&se({nombre:Ce.nombre,descripcion:Ce.descripcion||""})}},[F,J,re]);const[Oe,mt]=ae.useState({open:!1,type:null,id:null,title:"",message:""}),lt=(Ce,Ie)=>{Ie.stopPropagation(),mt({open:!0,type:"TIMELINE",id:Ce,title:t("timeline.delete_line"),message:t("bible.delete_folder_msg")})},at=(Ce,Ie)=>{Ie.stopPropagation(),mt({open:!0,type:"EVENT",id:Ce,title:t("timeline.delete_event"),message:t("common.are_you_sure")})},wt=async()=>{const{type:Ce,id:Ie}=Oe;if(!(!Ce||!Ie))try{if(Ce==="TIMELINE"){if(await et.delete(`/timeline/linea/${Ie}`),a===Ie){const Qe=re.flatMap(gt=>gt.lineasTemporales||[]).filter(gt=>gt.id!==Ie);s(Qe.length>0?Qe[0].id:null)}await he()}else Ce==="EVENT"&&(await et.delete(`/timeline/evento/${Ie}`),xe(a),T&&T.id===Ie&&N(null))}catch(Je){console.error(Je),alert(t("common.error_delete"))}},$e=m.jsxs(m.Fragment,{children:[m.jsx("div",{className:"p-4 border-b border-white/5",children:m.jsxs("div",{className:"flex bg-black/40 rounded-lg p-1 overflow-x-auto gap-1",children:[m.jsx("button",{onClick:()=>D("eventos"),className:`flex-1 py-2 text-xs font-bold uppercase tracking-wider rounded-md transition-all ${F==="eventos"?"bg-primary text-white shadow-lg":"text-slate-500 hover:text-slate-300"}`,children:t("timeline.events_tab")}),m.jsx("button",{onClick:()=>D("anexos"),className:`flex-1 py-2 text-xs font-bold uppercase tracking-wider rounded-md transition-all ${F==="anexos"?"bg-primary text-white shadow-lg":"text-slate-500 hover:text-slate-300"}`,children:t("timeline.annexes_tab")}),m.jsx("button",{onClick:()=>D("universo"),className:`flex-1 py-2 text-xs font-bold uppercase tracking-wider rounded-md transition-all ${F==="universo"?"bg-amber-600 text-white shadow-lg":"text-slate-500 hover:text-amber-500/80"}`,children:t("timeline.multiverse")})]})}),m.jsxs("div",{className:"flex-1 overflow-y-auto p-4 custom-scrollbar",children:[F==="eventos"&&m.jsx("div",{className:"space-y-6 animate-in fade-in slide-in-from-right-4",children:m.jsxs("div",{className:"bg-black/20 rounded-xl p-4 border border-white/5",children:[m.jsxs("h3",{className:"text-xs font-black uppercase text-primary mb-4 flex items-center justify-between",children:[t(T?"timeline.edit_event":"timeline.add_event"),T&&m.jsx("button",{onClick:()=>{N(null),w({nombre:"",descripcion:"",fechaTexto:"",ordenAbsoluto:o.length+1})},className:"text-[10px] text-slate-500 hover:text-white underline",children:t("common.cancel").toUpperCase()})]}),m.jsxs("div",{className:"space-y-3",children:[m.jsxs("div",{children:[m.jsx("label",{className:"text-[10px] text-slate-500 uppercase font-bold mb-1 block",children:t("timeline.event_name")}),m.jsx("input",{className:"w-full bg-background-dark border border-white/10 rounded-lg p-2 text-sm text-white outline-none focus:border-primary",value:S.nombre,onChange:Ce=>w({...S,nombre:Ce.target.value}),placeholder:t("timeline.event_name")})]}),m.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[m.jsxs("div",{children:[m.jsx("label",{className:"text-[10px] text-slate-500 uppercase font-bold mb-1 block",children:t("timeline.date_label")}),m.jsx("input",{className:"w-full bg-background-dark border border-white/10 rounded-lg p-2 text-sm text-white outline-none focus:border-primary",value:S.fechaTexto,onChange:Ce=>w({...S,fechaTexto:Ce.target.value}),placeholder:"e.g. Year 500"})]}),m.jsxs("div",{children:[m.jsx("label",{className:"text-[10px] text-slate-500 uppercase font-bold mb-1 block",children:t("timeline.order")}),m.jsx("input",{type:"text",className:"w-full bg-background-dark border border-white/10 rounded-lg p-2 text-sm text-white outline-none focus:border-primary",value:S.ordenAbsoluto,onChange:Ce=>{const Ie=Ce.target.value;/^[-+]?\d*$/.test(Ie)&&w({...S,ordenAbsoluto:Ie})},placeholder:"+/- Num"})]})]}),m.jsxs("div",{children:[m.jsx("label",{className:"text-[10px] text-slate-500 uppercase font-bold mb-1 block",children:t("timeline.description")}),m.jsx("textarea",{className:"w-full bg-background-dark border border-white/10 rounded-lg p-2 text-sm text-white outline-none focus:border-primary h-24 resize-none",value:S.descripcion,onChange:Ce=>w({...S,descripcion:Ce.target.value}),placeholder:t("timeline.description")})]}),m.jsx("div",{className:"pt-2",children:m.jsx(Dn,{variant:"primary",onClick:le,className:"w-full justify-center",children:t(T?"timeline.save_changes":"timeline.create_event")})}),T&&m.jsx("button",{onClick:Ce=>at(T.id,Ce),className:"w-full text-center text-xs text-red-500 hover:text-red-400 py-2 border border-red-500/20 rounded-lg hover:bg-red-500/10 transition-colors",children:t("timeline.delete_event_btn")})]})]})}),F==="anexos"&&m.jsx("div",{className:"space-y-6 animate-in fade-in slide-in-from-right-4",children:m.jsxs("div",{className:"bg-black/20 rounded-xl p-4 border border-white/5",children:[m.jsx("h3",{className:"text-xs font-black uppercase text-primary mb-4",children:t("timeline.linked_timelines")}),m.jsx("p",{className:"text-xs text-slate-500 mb-4",children:t("timeline.annexed_desc")}),m.jsxs("div",{className:"space-y-2 mb-6",children:[j.map(Ce=>m.jsxs("div",{className:"flex items-center justify-between p-2 bg-white/5 rounded-lg border border-white/5",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-xs text-slate-400",children:"timeline"}),m.jsx("span",{className:"text-xs font-bold text-slate-300",children:Ce.nombre})]}),m.jsx("button",{onClick:()=>ne(Ce.id),className:"text-slate-500 hover:text-red-500",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"link_off"})})]},Ce.id)),j.length===0&&m.jsx("span",{className:"text-xs text-slate-600 italic",children:t("timeline.no_linked")})]}),m.jsx("h4",{className:"text-[10px] font-bold uppercase text-slate-400 mb-2",children:t("timeline.available_to_link")}),m.jsxs("div",{className:"space-y-1",children:[G.map(Ce=>m.jsxs("button",{onClick:()=>Q(Ce.id),className:"w-full flex items-center gap-2 p-2 hover:bg-white/5 rounded-lg text-left transition-colors group",children:[m.jsx("span",{className:"material-symbols-outlined text-xs text-green-500/50 group-hover:text-green-500",children:"add_link"}),m.jsx("span",{className:"text-xs text-slate-400 group-hover:text-white",children:Ce.nombre})]},Ce.id)),G.length===0&&m.jsx("span",{className:"text-xs text-slate-600 italic",children:t("timeline.no_available")})]})]})}),F==="universo"&&m.jsx("div",{className:"space-y-6 animate-in fade-in slide-in-from-right-4",children:m.jsxs("div",{className:"bg-black/20 rounded-xl p-4 border border-white/5",children:[m.jsx("h3",{className:"text-xs font-black uppercase text-amber-500 mb-4",children:t(J?"timeline.universe_settings":"timeline.new_universe")}),m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{children:[m.jsx("label",{className:"text-[10px] text-slate-500 uppercase font-bold mb-1 block",children:t("timeline.universe_name")}),m.jsx("input",{className:"w-full bg-background-dark border border-white/10 rounded-lg p-2 text-sm text-white outline-none focus:border-primary",value:ge.nombre,onChange:Ce=>se({...ge,nombre:Ce.target.value}),placeholder:"e.g. Alternate Reality 1"})]}),m.jsxs("div",{children:[m.jsx("label",{className:"text-[10px] text-slate-500 uppercase font-bold mb-1 block",children:"Description"}),m.jsx("textarea",{className:"w-full bg-background-dark border border-white/10 rounded-lg p-2 text-sm text-white outline-none focus:border-primary h-24 resize-none",value:ge.descripcion,onChange:Ce=>se({...ge,descripcion:Ce.target.value}),placeholder:t("timeline.universe_desc")})]}),m.jsx("div",{className:"pt-2",children:m.jsx(Dn,{variant:"primary",onClick:J?Se:ye,className:"w-full justify-center",children:t(J?"common.save":"common.create")})}),J&&m.jsx("button",{onClick:Ue,className:"w-full text-center text-xs text-red-500 hover:text-red-400 py-2 border border-red-500/20 rounded-lg hover:bg-red-500/10 transition-colors",children:t("common.delete")})]})]})})]})]});return m.jsxs("div",{className:"flex h-screen bg-background-dark text-white overflow-hidden",children:[O&&xo.createPortal($e,O),m.jsxs("aside",{className:"w-64 bg-surface-dark border-r border-white/5 flex flex-col p-4 z-20 shrink-0",children:[m.jsxs("header",{className:"flex justify-between items-center mb-6",children:[m.jsx("h2",{className:"text-xs font-black uppercase tracking-widest text-primary",children:t("timeline.multiverse")}),m.jsx("button",{onClick:()=>{setRightPanelMode("CUSTOM"),D("universo"),ie(null),se({nombre:"",descripcion:""}),r(!0)},className:"text-slate-400 hover:text-white",title:"New Universe",children:m.jsx("span",{className:"material-symbols-outlined",children:"add_circle"})})]}),m.jsx("div",{className:"space-y-6 overflow-y-auto flex-1 custom-scrollbar",children:re.map(Ce=>m.jsxs("div",{className:"space-y-2",children:[m.jsxs("div",{className:"flex items-center justify-between group",children:[m.jsx("h3",{className:`text-[10px] font-bold uppercase pl-2 cursor-pointer ${J===Ce.id?"text-white":"text-slate-500"}`,onClick:()=>{ie(Ce.id),se({nombre:Ce.nombre,descripcion:Ce.descripcion||""}),D("universo"),setRightPanelMode("CUSTOM"),r(!0)},children:Ce.nombre}),m.jsx("div",{className:"flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:m.jsx("button",{onClick:()=>{_({...E,universoId:Ce.id}),y(!0)},className:"text-slate-500 hover:text-primary",title:"Add Timeline here",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"add"})})})]}),v&&E.universoId===Ce.id&&m.jsxs("div",{className:"ml-2 mb-2 p-2 bg-black/20 rounded-lg animate-in fade-in",children:[m.jsx("input",{className:"w-full bg-transparent border-b border-white/20 text-xs p-1 outline-none focus:border-primary mb-1",placeholder:"Timeline Name",value:E.nombre,onChange:Ie=>_({...E,nombre:Ie.target.value}),autoFocus:!0,onKeyDown:Ie=>Ie.key==="Enter"&&ve()}),m.jsxs("div",{className:"flex justify-end gap-1",children:[m.jsx("button",{onClick:()=>y(!1),className:"text-[10px] text-slate-500 hover:text-white",children:t("common.cancel").toUpperCase()}),m.jsx("button",{onClick:ve,className:"text-[10px] font-bold text-primary",children:t("common.create").toUpperCase()})]})]}),m.jsxs("div",{className:"space-y-1 pl-2 border-l border-white/5 ml-1",children:[Ce.lineasTemporales&&Ce.lineasTemporales.map(Ie=>m.jsxs("div",{onClick:()=>{s(Ie.id),D("eventos"),setRightPanelMode("CUSTOM"),r(!0)},className:`group flex items-center justify-between p-2 rounded-lg cursor-pointer transition-all ${a===Ie.id?"bg-primary/10 text-white shadow-[0_0_10px_rgba(var(--primary-rgb),0.1)]":"text-slate-400 hover:bg-white/5"}`,children:[m.jsx("span",{className:"text-xs truncate",children:Ie.nombre}),m.jsx("button",{onClick:Je=>lt(Ie.id,Je),className:"opacity-0 group-hover:opacity-100 text-slate-500 hover:text-red-500 transition-opacity",children:m.jsx("span",{className:"material-symbols-outlined text-[10px]",children:"delete"})})]},Ie.id)),(!Ce.lineasTemporales||Ce.lineasTemporales.length===0)&&m.jsx("div",{className:"p-2 text-[10px] italic text-slate-600",children:t("timeline.no_timelines")})]})]},Ce.id))})]}),m.jsxs("main",{className:"flex-1 relative flex flex-col h-full overflow-hidden bg-background-dark",children:[m.jsx("div",{className:"h-16 border-b border-white/5 bg-background-dark/80 backdrop-blur flex items-center px-8 z-10 shrink-0",children:m.jsx("div",{children:(()=>{const Ie=re.flatMap(Je=>Je.lineasTemporales||[]).find(Je=>Je.id===a);return m.jsxs(m.Fragment,{children:[m.jsxs("h1",{className:"text-xl font-bold flex items-center gap-2",children:[Ie?.esRaiz&&m.jsx("span",{className:"text-amber-400 material-symbols-outlined",children:"star"}),Ie?.nombre||t("timeline.select_timeline")]}),m.jsx("p",{className:"text-xs text-slate-500",children:Ie?.descripcion})]})})()})}),m.jsx("div",{className:"flex-1 overflow-y-auto p-8 relative custom-scrollbar z-10",children:m.jsxs("div",{className:"max-w-2xl mx-auto relative pl-8 border-l-2 border-white/10 space-y-8 pb-32",children:[o.length===0&&m.jsx("div",{className:"text-center text-slate-600 italic py-20",children:t("timeline.no_events")}),o.map((Ce,Ie)=>m.jsxs("div",{className:"relative group animate-in fade-in slide-in-from-bottom-4",style:{animationDelay:`${Ie*50}ms`},children:[m.jsx("div",{className:"absolute top-6 -left-[41px] size-4 rounded-full bg-white/20 border-4 border-background-dark group-hover:bg-primary transition-colors cursor-pointer",onClick:()=>fe(Ce)}),m.jsxs("div",{className:"ml-4 bg-surface-dark/50 border border-white/5 p-5 rounded-2xl hover:border-primary/30 transition-all hover:bg-surface-dark group-hover:translate-x-1 duration-300 relative group/card",children:[m.jsxs("div",{className:"absolute top-3 right-3 opacity-0 group-hover/card:opacity-100 transition-opacity flex gap-1 bg-black/50 rounded-lg backdrop-blur-sm border border-white/5 p-1",children:[m.jsx("button",{onClick:()=>fe(Ce),className:"p-1.5 text-slate-400 hover:text-white hover:bg-white/10 rounded transition-colors",title:"Edit",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"edit"})}),m.jsx("button",{onClick:Je=>at(Ce.id,Je),className:"p-1.5 text-slate-400 hover:text-red-500 hover:bg-red-500/10 rounded transition-colors",title:"Delete",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})})]}),m.jsx("div",{className:"flex justify-between items-start",children:m.jsxs("div",{children:[m.jsxs("div",{className:"flex flex-col mb-1",children:[m.jsx("h3",{className:"text-lg font-bold text-white",children:Ce.nombre}),m.jsx("span",{className:"text-xs font-mono font-bold text-primary opacity-80",children:Ce.fechaTexto})]}),m.jsx("p",{className:"text-sm text-slate-400 leading-relaxed",children:Ce.descripcion})]})})]})]},Ce.id))]})})]}),m.jsx(b1,{isOpen:Oe.open,onClose:()=>mt({...Oe,open:!1}),onConfirm:wt,title:Oe.title,message:Oe.message,confirmText:t("common.delete"),type:"danger"})]})},pG=({onCancel:t,onCreate:e})=>{const[r,n]=ae.useState(1),[i,a]=ae.useState("regional"),[s,o]=ae.useState("upload"),[l,u]=ae.useState(null),[c,f]=ae.useState(""),p=nr.useRef(null),v=w=>{const E=w.target.files?.[0];E&&E.type.startsWith("image/")&&(u(E),o("upload"))},y=()=>{p.current?.click()},S=()=>{e(s,c||"Nuevo Mapa",l)};return m.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-background-dark/80 backdrop-blur-xl animate-in fade-in duration-300",children:m.jsx("div",{className:"w-full max-w-4xl max-h-[90vh] overflow-y-auto no-scrollbar relative animate-in zoom-in-95 duration-500",children:m.jsxs(ti,{className:"p-0 border-white/10 shadow-[0_0_100px_rgba(0,0,0,0.5)] overflow-hidden",children:[m.jsxs("header",{className:"p-8 border-b border-white/5 flex justify-between items-center bg-white/[0.02]",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("div",{className:"size-12 rounded-2xl bg-primary/20 text-primary flex items-center justify-center",children:m.jsx("span",{className:"material-symbols-outlined text-2xl",children:"add_location_alt"})}),m.jsxs("div",{children:[m.jsx("h1",{className:"text-2xl font-manrope font-black text-white tracking-tight",children:"Crear Nuevo Mapa / Zona"}),m.jsx("p",{className:"text-xs text-slate-500 font-medium",children:"Configura los detalles para tu nueva entrada cartogrfica."})]})]}),m.jsx("button",{onClick:t,className:"text-slate-500 hover:text-white transition-colors",children:m.jsx("span",{className:"material-symbols-outlined",children:"close"})})]}),m.jsxs("div",{className:"p-12 space-y-12",children:[m.jsxs("section",{className:"space-y-6",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("div",{className:`size-8 rounded-full flex items-center justify-center text-[10px] font-black ${r===1?"bg-primary text-white shadow-lg shadow-primary/30":"bg-white/10 text-slate-500"}`,children:"1"}),m.jsx("h2",{className:"text-sm font-black uppercase tracking-[0.2em] text-white",children:"Identidad y Jerarqua"})]}),m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8 pl-12",children:[m.jsxs("div",{className:"space-y-1.5",children:[m.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-slate-600 ml-1",children:"Nombre del Mapa"}),m.jsx("input",{type:"text",placeholder:"ej. La Costa de Zafiro",value:c,onChange:w=>f(w.target.value),className:"w-full bg-white/5 border border-white/5 rounded-2xl px-4 py-3 text-sm text-white focus:border-primary/50 transition-all outline-none"})]}),m.jsxs("div",{className:"space-y-1.5 row-span-2",children:[m.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-slate-600 ml-1",children:"Descripcin"}),m.jsx("textarea",{placeholder:"Breve descripcin de la geografa, clima o importancia...",className:"w-full h-[120px] bg-white/5 border border-white/5 rounded-2xl p-4 text-sm text-white focus:border-primary/50 outline-none transition-all resize-none"})]}),m.jsxs("div",{className:"space-y-1.5",children:[m.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-slate-600 ml-1",children:"Zona Padre (Opcional)"}),m.jsxs("select",{className:"w-full bg-[#1a1a20] border border-white/5 rounded-2xl px-4 py-3 text-sm text-white focus:border-primary/50 outline-none appearance-none",children:[m.jsx("option",{className:"bg-[#1a1a20] text-white",children:"Ninguna (Nivel Superior)"}),m.jsx("option",{className:"bg-[#1a1a20] text-white",children:"Reino de Aethelgard"}),m.jsx("option",{className:"bg-[#1a1a20] text-white",children:"Continente de Aurum"})]}),m.jsx("p",{className:"text-[9px] text-slate-500 italic mt-1 ml-1 text-primary/70",children:"Seleccionar un padre convierte esto en sub-zona."})]})]})]}),m.jsx("div",{className:"h-px w-full bg-white/5"}),m.jsxs("section",{className:"space-y-6",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("div",{className:`size-8 rounded-full flex items-center justify-center text-[10px] font-black ${r===2?"bg-primary text-white shadow-lg shadow-primary/30":"bg-white/10 text-slate-500"}`,children:"2"}),m.jsx("h2",{className:"text-sm font-black uppercase tracking-[0.2em] text-white",children:"Tipo de Mapa"})]}),m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 pl-12",children:[m.jsx(k2,{active:i==="world",onClick:()=>a("world"),icon:"public",label:"Mapa Mundial",desc:"Continentes, ocanos, escala global."}),m.jsx(k2,{active:i==="regional",onClick:()=>a("regional"),icon:"map",label:"Mapa Regional",desc:"Reinos, provincias, biomas."}),m.jsx(k2,{active:i==="local",onClick:()=>a("local"),icon:"location_city",label:"Ciudad / Local",desc:"Ciudades, mazmorras, mapas de batalla."})]})]}),m.jsx("div",{className:"h-px w-full bg-white/5"}),m.jsxs("section",{className:"space-y-6",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("div",{className:`size-8 rounded-full flex items-center justify-center text-[10px] font-black ${r===3?"bg-primary text-white shadow-lg shadow-primary/30":"bg-white/10 text-slate-500"}`,children:"3"}),m.jsx("h2",{className:"text-sm font-black uppercase tracking-[0.2em] text-white",children:"Fuente del Lienzo"})]}),m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 pl-12",children:[m.jsx("input",{ref:p,type:"file",accept:"image/*",onChange:v,className:"hidden"}),m.jsx(n5,{active:s==="upload",onClick:y,icon:"cloud_upload",label:l?l.name:"Cargar Archivo de Imagen",desc:l?"Archivo seleccionado":"Arrastra y suelta o haz clic para buscar",subdesc:"JPG, PNG, WEBP  MAX 25MB"}),m.jsx(n5,{active:s==="blank",onClick:()=>o("blank"),icon:"brush",label:"Lienzo en Blanco",desc:"Crear un nuevo dibujo desde cero",subdesc:"4096 px x 4096 px"})]})]})]}),m.jsxs("footer",{className:"p-8 bg-white/[0.02] border-t border-white/5 flex justify-between items-center",children:[m.jsx("button",{onClick:t,className:"text-sm font-bold text-slate-500 hover:text-white transition-colors",children:"Cancelar"}),m.jsxs("div",{className:"flex items-center gap-6",children:[m.jsx("span",{className:"text-[9px] font-black uppercase tracking-widest text-slate-600",children:"Cambios guardados localmente"}),m.jsx(Dn,{variant:"primary",className:"px-10 py-3 shadow-xl",onClick:S,children:"Crear Mapa"})]})]})]})})})},k2=({active:t,onClick:e,icon:r,label:n,desc:i})=>m.jsxs("div",{onClick:e,className:`p-6 rounded-3xl border transition-all cursor-pointer group ${t?"bg-primary/10 border-primary shadow-lg shadow-primary/10":"bg-white/5 border-white/5 hover:border-white/10"}`,children:[m.jsx("div",{className:`size-10 rounded-xl mb-4 flex items-center justify-center transition-all ${t?"bg-primary text-white":"bg-white/5 text-slate-500 group-hover:text-slate-300"}`,children:m.jsx("span",{className:"material-symbols-outlined",children:r})}),m.jsx("h3",{className:`text-sm font-bold mb-1 transition-colors ${t?"text-white":"text-slate-400 group-hover:text-slate-200"}`,children:n}),m.jsx("p",{className:"text-[10px] text-slate-500 leading-relaxed font-medium",children:i})]}),n5=({active:t,onClick:e,icon:r,label:n,desc:i,subdesc:a})=>m.jsxs("div",{onClick:e,className:`p-10 rounded-[2.5rem] border transition-all cursor-pointer group flex flex-col items-center text-center gap-4 ${t?"bg-primary/5 border-primary shadow-lg":"bg-white/[0.02] border-white/5 hover:border-white/10 hover:bg-white/[0.04]"}`,children:[m.jsx("div",{className:`size-16 rounded-[2rem] flex items-center justify-center transition-all ${t?"bg-primary text-white shadow-xl shadow-primary/20":"bg-white/5 text-slate-600 group-hover:text-slate-400"}`,children:m.jsx("span",{className:"material-symbols-outlined text-3xl",children:r})}),m.jsxs("div",{className:"space-y-1",children:[m.jsx("h3",{className:`font-bold transition-colors ${t?"text-white":"text-slate-400"}`,children:n}),m.jsx("p",{className:"text-xs text-slate-500 font-medium",children:i})]}),m.jsx("div",{className:"flex gap-2 mt-2",children:a.split("").map((s,o)=>m.jsx("span",{className:"px-2 py-1 rounded bg-black/20 text-[8px] font-black text-slate-600 tracking-tighter uppercase whitespace-nowrap",children:s.trim()},o))})]});var Wy={exports:{}},Xm={},_2={},C2={},i5;function Tr(){return i5||(i5=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t._registerNode=t.Konva=t.glob=void 0;const e=Math.PI/180;function r(){return typeof window<"u"&&({}.toString.call(window)==="[object Window]"||{}.toString.call(window)==="[object global]")}t.glob=typeof iE<"u"?iE:typeof window<"u"?window:typeof WorkerGlobalScope<"u"?self:{},t.Konva={_global:t.glob,version:"9.3.16",isBrowser:r(),isUnminified:/param/.test((function(i){}).toString()),dblClickWindow:400,getAngle(i){return t.Konva.angleDeg?i*e:i},enableTrace:!1,pointerEventsEnabled:!0,autoDrawEnabled:!0,hitOnDragEnabled:!1,capturePointerEventsEnabled:!1,_mouseListenClick:!1,_touchListenClick:!1,_pointerListenClick:!1,_mouseInDblClickWindow:!1,_touchInDblClickWindow:!1,_pointerInDblClickWindow:!1,_mouseDblClickPointerId:null,_touchDblClickPointerId:null,_pointerDblClickPointerId:null,_fixTextRendering:!1,pixelRatio:typeof window<"u"&&window.devicePixelRatio||1,dragDistance:3,angleDeg:!0,showWarnings:!0,dragButtons:[0,1],isDragging(){return t.Konva.DD.isDragging},isTransforming(){var i;return(i=t.Konva.Transformer)===null||i===void 0?void 0:i.isTransforming()},isDragReady(){return!!t.Konva.DD.node},releaseCanvasOnDestroy:!0,document:t.glob.document,_injectGlobal(i){t.glob.Konva=i}};const n=i=>{t.Konva[i.prototype.getClassName()]=i};t._registerNode=n,t.Konva._injectGlobal(t.Konva)})(C2)),C2}var E2={},a5;function pi(){return a5||(a5=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Util=t.Transform=void 0;const e=Tr();class r{constructor(N=[1,0,0,1,0,0]){this.dirty=!1,this.m=N&&N.slice()||[1,0,0,1,0,0]}reset(){this.m[0]=1,this.m[1]=0,this.m[2]=0,this.m[3]=1,this.m[4]=0,this.m[5]=0}copy(){return new r(this.m)}copyInto(N){N.m[0]=this.m[0],N.m[1]=this.m[1],N.m[2]=this.m[2],N.m[3]=this.m[3],N.m[4]=this.m[4],N.m[5]=this.m[5]}point(N){const R=this.m;return{x:R[0]*N.x+R[2]*N.y+R[4],y:R[1]*N.x+R[3]*N.y+R[5]}}translate(N,R){return this.m[4]+=this.m[0]*N+this.m[2]*R,this.m[5]+=this.m[1]*N+this.m[3]*R,this}scale(N,R){return this.m[0]*=N,this.m[1]*=N,this.m[2]*=R,this.m[3]*=R,this}rotate(N){const R=Math.cos(N),I=Math.sin(N),F=this.m[0]*R+this.m[2]*I,D=this.m[1]*R+this.m[3]*I,j=this.m[0]*-I+this.m[2]*R,B=this.m[1]*-I+this.m[3]*R;return this.m[0]=F,this.m[1]=D,this.m[2]=j,this.m[3]=B,this}getTranslation(){return{x:this.m[4],y:this.m[5]}}skew(N,R){const I=this.m[0]+this.m[2]*R,F=this.m[1]+this.m[3]*R,D=this.m[2]+this.m[0]*N,j=this.m[3]+this.m[1]*N;return this.m[0]=I,this.m[1]=F,this.m[2]=D,this.m[3]=j,this}multiply(N){const R=this.m[0]*N.m[0]+this.m[2]*N.m[1],I=this.m[1]*N.m[0]+this.m[3]*N.m[1],F=this.m[0]*N.m[2]+this.m[2]*N.m[3],D=this.m[1]*N.m[2]+this.m[3]*N.m[3],j=this.m[0]*N.m[4]+this.m[2]*N.m[5]+this.m[4],B=this.m[1]*N.m[4]+this.m[3]*N.m[5]+this.m[5];return this.m[0]=R,this.m[1]=I,this.m[2]=F,this.m[3]=D,this.m[4]=j,this.m[5]=B,this}invert(){const N=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),R=this.m[3]*N,I=-this.m[1]*N,F=-this.m[2]*N,D=this.m[0]*N,j=N*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),B=N*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);return this.m[0]=R,this.m[1]=I,this.m[2]=F,this.m[3]=D,this.m[4]=j,this.m[5]=B,this}getMatrix(){return this.m}decompose(){const N=this.m[0],R=this.m[1],I=this.m[2],F=this.m[3],D=this.m[4],j=this.m[5],B=N*F-R*I,G={x:D,y:j,rotation:0,scaleX:0,scaleY:0,skewX:0,skewY:0};if(N!=0||R!=0){const K=Math.sqrt(N*N+R*R);G.rotation=R>0?Math.acos(N/K):-Math.acos(N/K),G.scaleX=K,G.scaleY=B/K,G.skewX=(N*I+R*F)/B,G.skewY=0}else if(I!=0||F!=0){const K=Math.sqrt(I*I+F*F);G.rotation=Math.PI/2-(F>0?Math.acos(-I/K):-Math.acos(I/K)),G.scaleX=B/K,G.scaleY=K,G.skewX=0,G.skewY=(N*I+R*F)/B}return G.rotation=t.Util._getRotation(G.rotation),G}}t.Transform=r;let n="[object Array]",i="[object Number]",a="[object String]",s="[object Boolean]",o=Math.PI/180,l=180/Math.PI,u="#",c="",f="0",p="Konva warning: ",v="Konva error: ",y="rgb(",S={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,132,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,255,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,203],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[119,128,144],slategrey:[119,128,144],snow:[255,255,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],transparent:[255,255,255,0],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,5]},w=/rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)/,E=[];const _=typeof requestAnimationFrame<"u"&&requestAnimationFrame||function(T){setTimeout(T,60)};t.Util={_isElement(T){return!!(T&&T.nodeType==1)},_isFunction(T){return!!(T&&T.constructor&&T.call&&T.apply)},_isPlainObject(T){return!!T&&T.constructor===Object},_isArray(T){return Object.prototype.toString.call(T)===n},_isNumber(T){return Object.prototype.toString.call(T)===i&&!isNaN(T)&&isFinite(T)},_isString(T){return Object.prototype.toString.call(T)===a},_isBoolean(T){return Object.prototype.toString.call(T)===s},isObject(T){return T instanceof Object},isValidSelector(T){if(typeof T!="string")return!1;const N=T[0];return N==="#"||N==="."||N===N.toUpperCase()},_sign(T){return T===0||T>0?1:-1},requestAnimFrame(T){E.push(T),E.length===1&&_(function(){const N=E;E=[],N.forEach(function(R){R()})})},createCanvasElement(){const T=document.createElement("canvas");try{T.style=T.style||{}}catch{}return T},createImageElement(){return document.createElement("img")},_isInDocument(T){for(;T=T.parentNode;)if(T==document)return!0;return!1},_urlToImage(T,N){const R=t.Util.createImageElement();R.onload=function(){N(R)},R.src=T},_rgbToHex(T,N,R){return((1<<24)+(T<<16)+(N<<8)+R).toString(16).slice(1)},_hexToRgb(T){T=T.replace(u,c);const N=parseInt(T,16);return{r:N>>16&255,g:N>>8&255,b:N&255}},getRandomColor(){let T=(Math.random()*16777215<<0).toString(16);for(;T.length<6;)T=f+T;return u+T},getRGB(T){let N;return T in S?(N=S[T],{r:N[0],g:N[1],b:N[2]}):T[0]===u?this._hexToRgb(T.substring(1)):T.substr(0,4)===y?(N=w.exec(T.replace(/ /g,"")),{r:parseInt(N[1],10),g:parseInt(N[2],10),b:parseInt(N[3],10)}):{r:0,g:0,b:0}},colorToRGBA(T){return T=T||"black",t.Util._namedColorToRBA(T)||t.Util._hex3ColorToRGBA(T)||t.Util._hex4ColorToRGBA(T)||t.Util._hex6ColorToRGBA(T)||t.Util._hex8ColorToRGBA(T)||t.Util._rgbColorToRGBA(T)||t.Util._rgbaColorToRGBA(T)||t.Util._hslColorToRGBA(T)},_namedColorToRBA(T){const N=S[T.toLowerCase()];return N?{r:N[0],g:N[1],b:N[2],a:1}:null},_rgbColorToRGBA(T){if(T.indexOf("rgb(")===0){T=T.match(/rgb\(([^)]+)\)/)[1];const N=T.split(/ *, */).map(Number);return{r:N[0],g:N[1],b:N[2],a:1}}},_rgbaColorToRGBA(T){if(T.indexOf("rgba(")===0){T=T.match(/rgba\(([^)]+)\)/)[1];const N=T.split(/ *, */).map((R,I)=>R.slice(-1)==="%"?I===3?parseInt(R)/100:parseInt(R)/100*255:Number(R));return{r:N[0],g:N[1],b:N[2],a:N[3]}}},_hex8ColorToRGBA(T){if(T[0]==="#"&&T.length===9)return{r:parseInt(T.slice(1,3),16),g:parseInt(T.slice(3,5),16),b:parseInt(T.slice(5,7),16),a:parseInt(T.slice(7,9),16)/255}},_hex6ColorToRGBA(T){if(T[0]==="#"&&T.length===7)return{r:parseInt(T.slice(1,3),16),g:parseInt(T.slice(3,5),16),b:parseInt(T.slice(5,7),16),a:1}},_hex4ColorToRGBA(T){if(T[0]==="#"&&T.length===5)return{r:parseInt(T[1]+T[1],16),g:parseInt(T[2]+T[2],16),b:parseInt(T[3]+T[3],16),a:parseInt(T[4]+T[4],16)/255}},_hex3ColorToRGBA(T){if(T[0]==="#"&&T.length===4)return{r:parseInt(T[1]+T[1],16),g:parseInt(T[2]+T[2],16),b:parseInt(T[3]+T[3],16),a:1}},_hslColorToRGBA(T){if(/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.test(T)){const[N,...R]=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(T),I=Number(R[0])/360,F=Number(R[1])/100,D=Number(R[2])/100;let j,B,G;if(F===0)return G=D*255,{r:Math.round(G),g:Math.round(G),b:Math.round(G),a:1};D<.5?j=D*(1+F):j=D+F-D*F;const K=2*D-j,O=[0,0,0];for(let W=0;W<3;W++)B=I+1/3*-(W-1),B<0&&B++,B>1&&B--,6*B<1?G=K+(j-K)*6*B:2*B<1?G=j:3*B<2?G=K+(j-K)*(2/3-B)*6:G=K,O[W]=G*255;return{r:Math.round(O[0]),g:Math.round(O[1]),b:Math.round(O[2]),a:1}}},haveIntersection(T,N){return!(N.x>T.x+T.width||N.x+N.width<T.x||N.y>T.y+T.height||N.y+N.height<T.y)},cloneObject(T){const N={};for(const R in T)this._isPlainObject(T[R])?N[R]=this.cloneObject(T[R]):this._isArray(T[R])?N[R]=this.cloneArray(T[R]):N[R]=T[R];return N},cloneArray(T){return T.slice(0)},degToRad(T){return T*o},radToDeg(T){return T*l},_degToRad(T){return t.Util.warn("Util._degToRad is removed. Please use public Util.degToRad instead."),t.Util.degToRad(T)},_radToDeg(T){return t.Util.warn("Util._radToDeg is removed. Please use public Util.radToDeg instead."),t.Util.radToDeg(T)},_getRotation(T){return e.Konva.angleDeg?t.Util.radToDeg(T):T},_capitalize(T){return T.charAt(0).toUpperCase()+T.slice(1)},throw(T){throw new Error(v+T)},error(T){console.error(v+T)},warn(T){e.Konva.showWarnings&&console.warn(p+T)},each(T,N){for(const R in T)N(R,T[R])},_inRange(T,N,R){return N<=T&&T<R},_getProjectionToSegment(T,N,R,I,F,D){let j,B,G;const K=(T-R)*(T-R)+(N-I)*(N-I);if(K==0)j=T,B=N,G=(F-R)*(F-R)+(D-I)*(D-I);else{const O=((F-T)*(R-T)+(D-N)*(I-N))/K;O<0?(j=T,B=N,G=(T-F)*(T-F)+(N-D)*(N-D)):O>1?(j=R,B=I,G=(R-F)*(R-F)+(I-D)*(I-D)):(j=T+O*(R-T),B=N+O*(I-N),G=(j-F)*(j-F)+(B-D)*(B-D))}return[j,B,G]},_getProjectionToLine(T,N,R){const I=t.Util.cloneObject(T);let F=Number.MAX_VALUE;return N.forEach(function(D,j){if(!R&&j===N.length-1)return;const B=N[(j+1)%N.length],G=t.Util._getProjectionToSegment(D.x,D.y,B.x,B.y,T.x,T.y),K=G[0],O=G[1],W=G[2];W<F&&(I.x=K,I.y=O,F=W)}),I},_prepareArrayForTween(T,N,R){let I,F=[],D=[];if(T.length>N.length){const B=N;N=T,T=B}for(I=0;I<T.length;I+=2)F.push({x:T[I],y:T[I+1]});for(I=0;I<N.length;I+=2)D.push({x:N[I],y:N[I+1]});const j=[];return D.forEach(function(B){const G=t.Util._getProjectionToLine(B,F,R);j.push(G.x),j.push(G.y)}),j},_prepareToStringify(T){let N;T.visitedByCircularReferenceRemoval=!0;for(const R in T)if(T.hasOwnProperty(R)&&T[R]&&typeof T[R]=="object"){if(N=Object.getOwnPropertyDescriptor(T,R),T[R].visitedByCircularReferenceRemoval||t.Util._isElement(T[R]))if(N.configurable)delete T[R];else return null;else if(t.Util._prepareToStringify(T[R])===null)if(N.configurable)delete T[R];else return null}return delete T.visitedByCircularReferenceRemoval,T},_assign(T,N){for(const R in N)T[R]=N[R];return T},_getFirstPointerId(T){return T.touches?T.changedTouches[0].identifier:T.pointerId||999},releaseCanvas(...T){e.Konva.releaseCanvasOnDestroy&&T.forEach(N=>{N.width=0,N.height=0})},drawRoundedRectPath(T,N,R,I){let F=0,D=0,j=0,B=0;typeof I=="number"?F=D=j=B=Math.min(I,N/2,R/2):(F=Math.min(I[0]||0,N/2,R/2),D=Math.min(I[1]||0,N/2,R/2),B=Math.min(I[2]||0,N/2,R/2),j=Math.min(I[3]||0,N/2,R/2)),T.moveTo(F,0),T.lineTo(N-D,0),T.arc(N-D,D,D,Math.PI*3/2,0,!1),T.lineTo(N,R-B),T.arc(N-B,R-B,B,0,Math.PI/2,!1),T.lineTo(j,R),T.arc(j,R-j,j,Math.PI/2,Math.PI,!1),T.lineTo(0,F),T.arc(F,F,F,Math.PI,Math.PI*3/2,!1)}}})(E2)),E2}var Qm={},T2={},qs={},s5;function Dr(){if(s5)return qs;s5=1,Object.defineProperty(qs,"__esModule",{value:!0}),qs.RGBComponent=n,qs.alphaComponent=i,qs.getNumberValidator=a,qs.getNumberOrArrayOfNumbersValidator=s,qs.getNumberOrAutoValidator=o,qs.getStringValidator=l,qs.getStringOrGradientValidator=u,qs.getFunctionValidator=c,qs.getNumberArrayValidator=f,qs.getBooleanValidator=p,qs.getComponentValidator=v;const t=Tr(),e=pi();function r(y){return e.Util._isString(y)?'"'+y+'"':Object.prototype.toString.call(y)==="[object Number]"||e.Util._isBoolean(y)?y:Object.prototype.toString.call(y)}function n(y){return y>255?255:y<0?0:Math.round(y)}function i(y){return y>1?1:y<1e-4?1e-4:y}function a(){if(t.Konva.isUnminified)return function(y,S){return e.Util._isNumber(y)||e.Util.warn(r(y)+' is a not valid value for "'+S+'" attribute. The value should be a number.'),y}}function s(y){if(t.Konva.isUnminified)return function(S,w){const E=e.Util._isNumber(S),_=e.Util._isArray(S)&&S.length==y;return!E&&!_&&e.Util.warn(r(S)+' is a not valid value for "'+w+'" attribute. The value should be a number or Array<number>('+y+")"),S}}function o(){if(t.Konva.isUnminified)return function(y,S){return e.Util._isNumber(y)||y==="auto"||e.Util.warn(r(y)+' is a not valid value for "'+S+'" attribute. The value should be a number or "auto".'),y}}function l(){if(t.Konva.isUnminified)return function(y,S){return e.Util._isString(y)||e.Util.warn(r(y)+' is a not valid value for "'+S+'" attribute. The value should be a string.'),y}}function u(){if(t.Konva.isUnminified)return function(y,S){const w=e.Util._isString(y),E=Object.prototype.toString.call(y)==="[object CanvasGradient]"||y&&y.addColorStop;return w||E||e.Util.warn(r(y)+' is a not valid value for "'+S+'" attribute. The value should be a string or a native gradient.'),y}}function c(){if(t.Konva.isUnminified)return function(y,S){return e.Util._isFunction(y)||e.Util.warn(r(y)+' is a not valid value for "'+S+'" attribute. The value should be a function.'),y}}function f(){if(t.Konva.isUnminified)return function(y,S){const w=Int8Array?Object.getPrototypeOf(Int8Array):null;return w&&y instanceof w||(e.Util._isArray(y)?y.forEach(function(E){e.Util._isNumber(E)||e.Util.warn('"'+S+'" attribute has non numeric element '+E+". Make sure that all elements are numbers.")}):e.Util.warn(r(y)+' is a not valid value for "'+S+'" attribute. The value should be a array of numbers.')),y}}function p(){if(t.Konva.isUnminified)return function(y,S){return y===!0||y===!1||e.Util.warn(r(y)+' is a not valid value for "'+S+'" attribute. The value should be a boolean.'),y}}function v(y){if(t.Konva.isUnminified)return function(S,w){return S==null||e.Util.isObject(S)||e.Util.warn(r(S)+' is a not valid value for "'+w+'" attribute. The value should be an object with properties '+y),S}}return qs}var o5;function Ar(){return o5||(o5=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Factory=void 0;const e=pi(),r=Dr(),n="get",i="set";t.Factory={addGetterSetter(a,s,o,l,u){t.Factory.addGetter(a,s,o),t.Factory.addSetter(a,s,l,u),t.Factory.addOverloadedGetterSetter(a,s)},addGetter(a,s,o){const l=n+e.Util._capitalize(s);a.prototype[l]=a.prototype[l]||function(){const u=this.attrs[s];return u===void 0?o:u}},addSetter(a,s,o,l){const u=i+e.Util._capitalize(s);a.prototype[u]||t.Factory.overWriteSetter(a,s,o,l)},overWriteSetter(a,s,o,l){const u=i+e.Util._capitalize(s);a.prototype[u]=function(c){return o&&c!==void 0&&c!==null&&(c=o.call(this,c,s)),this._setAttr(s,c),l&&l.call(this),this}},addComponentsGetterSetter(a,s,o,l,u){let c=o.length,f=e.Util._capitalize,p=n+f(s),v=i+f(s),y,S;a.prototype[p]=function(){const E={};for(y=0;y<c;y++)S=o[y],E[S]=this.getAttr(s+f(S));return E};const w=(0,r.getComponentValidator)(o);a.prototype[v]=function(E){let _=this.attrs[s],T;l&&(E=l.call(this,E)),w&&w.call(this,E,s);for(T in E)E.hasOwnProperty(T)&&this._setAttr(s+f(T),E[T]);return E||o.forEach(N=>{this._setAttr(s+f(N),void 0)}),this._fireChangeEvent(s,_,E),u&&u.call(this),this},t.Factory.addOverloadedGetterSetter(a,s)},addOverloadedGetterSetter(a,s){const o=e.Util._capitalize(s),l=i+o,u=n+o;a.prototype[s]=function(){return arguments.length?(this[l](arguments[0]),this):this[u]()}},addDeprecatedGetterSetter(a,s,o,l){e.Util.error("Adding deprecated "+s);const u=n+e.Util._capitalize(s),c=s+" property is deprecated and will be removed soon. Look at Konva change log for more information.";a.prototype[u]=function(){e.Util.error(c);const f=this.attrs[s];return f===void 0?o:f},t.Factory.addSetter(a,s,l,function(){e.Util.error(c)}),t.Factory.addOverloadedGetterSetter(a,s)},backCompat(a,s){e.Util.each(s,function(o,l){const u=a.prototype[l],c=n+e.Util._capitalize(o),f=i+e.Util._capitalize(o);function p(){u.apply(this,arguments),e.Util.error('"'+o+'" method is deprecated and will be removed soon. Use ""'+l+'" instead.')}a.prototype[o]=p,a.prototype[c]=p,a.prototype[f]=p})},afterSetFilter(){this._filterUpToDate=!1}}})(T2)),T2}var nc={},ic={},l5;function yR(){if(l5)return ic;l5=1,Object.defineProperty(ic,"__esModule",{value:!0}),ic.HitContext=ic.SceneContext=ic.Context=void 0;const t=pi(),e=Tr();function r(E){let _=[],T=E.length,N=t.Util,R,I;for(R=0;R<T;R++)I=E[R],N._isNumber(I)?I=Math.round(I*1e3)/1e3:N._isString(I)||(I=I+""),_.push(I);return _}const n=",",i="(",a=")",s="([",o="])",l=";",u="()",c="=",f=["arc","arcTo","beginPath","bezierCurveTo","clearRect","clip","closePath","createLinearGradient","createPattern","createRadialGradient","drawImage","ellipse","fill","fillText","getImageData","createImageData","lineTo","moveTo","putImageData","quadraticCurveTo","rect","roundRect","restore","rotate","save","scale","setLineDash","setTransform","stroke","strokeText","transform","translate"],p=["fillStyle","strokeStyle","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","letterSpacing","lineCap","lineDashOffset","lineJoin","lineWidth","miterLimit","direction","font","textAlign","textBaseline","globalAlpha","globalCompositeOperation","imageSmoothingEnabled"],v=100;let y=class{constructor(_){this.canvas=_,e.Konva.enableTrace&&(this.traceArr=[],this._enableTrace())}fillShape(_){_.fillEnabled()&&this._fill(_)}_fill(_){}strokeShape(_){_.hasStroke()&&this._stroke(_)}_stroke(_){}fillStrokeShape(_){_.attrs.fillAfterStrokeEnabled?(this.strokeShape(_),this.fillShape(_)):(this.fillShape(_),this.strokeShape(_))}getTrace(_,T){let N=this.traceArr,R=N.length,I="",F,D,j,B;for(F=0;F<R;F++)D=N[F],j=D.method,j?(B=D.args,I+=j,_?I+=u:t.Util._isArray(B[0])?I+=s+B.join(n)+o:(T&&(B=B.map(G=>typeof G=="number"?Math.floor(G):G)),I+=i+B.join(n)+a)):(I+=D.property,_||(I+=c+D.val)),I+=l;return I}clearTrace(){this.traceArr=[]}_trace(_){let T=this.traceArr,N;T.push(_),N=T.length,N>=v&&T.shift()}reset(){const _=this.getCanvas().getPixelRatio();this.setTransform(1*_,0,0,1*_,0,0)}getCanvas(){return this.canvas}clear(_){const T=this.getCanvas();_?this.clearRect(_.x||0,_.y||0,_.width||0,_.height||0):this.clearRect(0,0,T.getWidth()/T.pixelRatio,T.getHeight()/T.pixelRatio)}_applyLineCap(_){const T=_.attrs.lineCap;T&&this.setAttr("lineCap",T)}_applyOpacity(_){const T=_.getAbsoluteOpacity();T!==1&&this.setAttr("globalAlpha",T)}_applyLineJoin(_){const T=_.attrs.lineJoin;T&&this.setAttr("lineJoin",T)}setAttr(_,T){this._context[_]=T}arc(_,T,N,R,I,F){this._context.arc(_,T,N,R,I,F)}arcTo(_,T,N,R,I){this._context.arcTo(_,T,N,R,I)}beginPath(){this._context.beginPath()}bezierCurveTo(_,T,N,R,I,F){this._context.bezierCurveTo(_,T,N,R,I,F)}clearRect(_,T,N,R){this._context.clearRect(_,T,N,R)}clip(..._){this._context.clip.apply(this._context,_)}closePath(){this._context.closePath()}createImageData(_,T){const N=arguments;if(N.length===2)return this._context.createImageData(_,T);if(N.length===1)return this._context.createImageData(_)}createLinearGradient(_,T,N,R){return this._context.createLinearGradient(_,T,N,R)}createPattern(_,T){return this._context.createPattern(_,T)}createRadialGradient(_,T,N,R,I,F){return this._context.createRadialGradient(_,T,N,R,I,F)}drawImage(_,T,N,R,I,F,D,j,B){const G=arguments,K=this._context;G.length===3?K.drawImage(_,T,N):G.length===5?K.drawImage(_,T,N,R,I):G.length===9&&K.drawImage(_,T,N,R,I,F,D,j,B)}ellipse(_,T,N,R,I,F,D,j){this._context.ellipse(_,T,N,R,I,F,D,j)}isPointInPath(_,T,N,R){return N?this._context.isPointInPath(N,_,T,R):this._context.isPointInPath(_,T,R)}fill(..._){this._context.fill.apply(this._context,_)}fillRect(_,T,N,R){this._context.fillRect(_,T,N,R)}strokeRect(_,T,N,R){this._context.strokeRect(_,T,N,R)}fillText(_,T,N,R){R?this._context.fillText(_,T,N,R):this._context.fillText(_,T,N)}measureText(_){return this._context.measureText(_)}getImageData(_,T,N,R){return this._context.getImageData(_,T,N,R)}lineTo(_,T){this._context.lineTo(_,T)}moveTo(_,T){this._context.moveTo(_,T)}rect(_,T,N,R){this._context.rect(_,T,N,R)}roundRect(_,T,N,R,I){this._context.roundRect(_,T,N,R,I)}putImageData(_,T,N){this._context.putImageData(_,T,N)}quadraticCurveTo(_,T,N,R){this._context.quadraticCurveTo(_,T,N,R)}restore(){this._context.restore()}rotate(_){this._context.rotate(_)}save(){this._context.save()}scale(_,T){this._context.scale(_,T)}setLineDash(_){this._context.setLineDash?this._context.setLineDash(_):"mozDash"in this._context?this._context.mozDash=_:"webkitLineDash"in this._context&&(this._context.webkitLineDash=_)}getLineDash(){return this._context.getLineDash()}setTransform(_,T,N,R,I,F){this._context.setTransform(_,T,N,R,I,F)}stroke(_){_?this._context.stroke(_):this._context.stroke()}strokeText(_,T,N,R){this._context.strokeText(_,T,N,R)}transform(_,T,N,R,I,F){this._context.transform(_,T,N,R,I,F)}translate(_,T){this._context.translate(_,T)}_enableTrace(){let _=this,T=f.length,N=this.setAttr,R,I;const F=function(D){let j=_[D],B;_[D]=function(){return I=r(Array.prototype.slice.call(arguments,0)),B=j.apply(_,arguments),_._trace({method:D,args:I}),B}};for(R=0;R<T;R++)F(f[R]);_.setAttr=function(){N.apply(_,arguments);const D=arguments[0];let j=arguments[1];(D==="shadowOffsetX"||D==="shadowOffsetY"||D==="shadowBlur")&&(j=j/this.canvas.getPixelRatio()),_._trace({property:D,val:j})}}_applyGlobalCompositeOperation(_){const T=_.attrs.globalCompositeOperation;!T||T==="source-over"||this.setAttr("globalCompositeOperation",T)}};ic.Context=y,p.forEach(function(E){Object.defineProperty(y.prototype,E,{get(){return this._context[E]},set(_){this._context[E]=_}})});class S extends y{constructor(_,{willReadFrequently:T=!1}={}){super(_),this._context=_._canvas.getContext("2d",{willReadFrequently:T})}_fillColor(_){const T=_.fill();this.setAttr("fillStyle",T),_._fillFunc(this)}_fillPattern(_){this.setAttr("fillStyle",_._getFillPattern()),_._fillFunc(this)}_fillLinearGradient(_){const T=_._getLinearGradient();T&&(this.setAttr("fillStyle",T),_._fillFunc(this))}_fillRadialGradient(_){const T=_._getRadialGradient();T&&(this.setAttr("fillStyle",T),_._fillFunc(this))}_fill(_){const T=_.fill(),N=_.getFillPriority();if(T&&N==="color"){this._fillColor(_);return}const R=_.getFillPatternImage();if(R&&N==="pattern"){this._fillPattern(_);return}const I=_.getFillLinearGradientColorStops();if(I&&N==="linear-gradient"){this._fillLinearGradient(_);return}const F=_.getFillRadialGradientColorStops();if(F&&N==="radial-gradient"){this._fillRadialGradient(_);return}T?this._fillColor(_):R?this._fillPattern(_):I?this._fillLinearGradient(_):F&&this._fillRadialGradient(_)}_strokeLinearGradient(_){const T=_.getStrokeLinearGradientStartPoint(),N=_.getStrokeLinearGradientEndPoint(),R=_.getStrokeLinearGradientColorStops(),I=this.createLinearGradient(T.x,T.y,N.x,N.y);if(R){for(let F=0;F<R.length;F+=2)I.addColorStop(R[F],R[F+1]);this.setAttr("strokeStyle",I)}}_stroke(_){const T=_.dash(),N=_.getStrokeScaleEnabled();if(_.hasStroke()){if(!N){this.save();const I=this.getCanvas().getPixelRatio();this.setTransform(I,0,0,I,0,0)}this._applyLineCap(_),T&&_.dashEnabled()&&(this.setLineDash(T),this.setAttr("lineDashOffset",_.dashOffset())),this.setAttr("lineWidth",_.strokeWidth()),_.getShadowForStrokeEnabled()||this.setAttr("shadowColor","rgba(0,0,0,0)"),_.getStrokeLinearGradientColorStops()?this._strokeLinearGradient(_):this.setAttr("strokeStyle",_.stroke()),_._strokeFunc(this),N||this.restore()}}_applyShadow(_){var T,N,R;const I=(T=_.getShadowRGBA())!==null&&T!==void 0?T:"black",F=(N=_.getShadowBlur())!==null&&N!==void 0?N:5,D=(R=_.getShadowOffset())!==null&&R!==void 0?R:{x:0,y:0},j=_.getAbsoluteScale(),B=this.canvas.getPixelRatio(),G=j.x*B,K=j.y*B;this.setAttr("shadowColor",I),this.setAttr("shadowBlur",F*Math.min(Math.abs(G),Math.abs(K))),this.setAttr("shadowOffsetX",D.x*G),this.setAttr("shadowOffsetY",D.y*K)}}ic.SceneContext=S;class w extends y{constructor(_){super(_),this._context=_._canvas.getContext("2d",{willReadFrequently:!0})}_fill(_){this.save(),this.setAttr("fillStyle",_.colorKey),_._fillFuncHit(this),this.restore()}strokeShape(_){_.hasHitStroke()&&this._stroke(_)}_stroke(_){if(_.hasHitStroke()){const T=_.getStrokeScaleEnabled();if(!T){this.save();const I=this.getCanvas().getPixelRatio();this.setTransform(I,0,0,I,0,0)}this._applyLineCap(_);const N=_.hitStrokeWidth(),R=N==="auto"?_.strokeWidth():N;this.setAttr("lineWidth",R),this.setAttr("strokeStyle",_.colorKey),_._strokeFuncHit(this),T||this.restore()}}}return ic.HitContext=w,ic}var u5;function B1(){if(u5)return nc;u5=1,Object.defineProperty(nc,"__esModule",{value:!0}),nc.HitCanvas=nc.SceneCanvas=nc.Canvas=void 0;const t=pi(),e=yR(),r=Tr(),n=Ar(),i=Dr();let a;function s(){if(a)return a;const c=t.Util.createCanvasElement(),f=c.getContext("2d");return a=(function(){const p=r.Konva._global.devicePixelRatio||1,v=f.webkitBackingStorePixelRatio||f.mozBackingStorePixelRatio||f.msBackingStorePixelRatio||f.oBackingStorePixelRatio||f.backingStorePixelRatio||1;return p/v})(),t.Util.releaseCanvas(c),a}let o=class{constructor(f){this.pixelRatio=1,this.width=0,this.height=0,this.isCache=!1;const v=(f||{}).pixelRatio||r.Konva.pixelRatio||s();this.pixelRatio=v,this._canvas=t.Util.createCanvasElement(),this._canvas.style.padding="0",this._canvas.style.margin="0",this._canvas.style.border="0",this._canvas.style.background="transparent",this._canvas.style.position="absolute",this._canvas.style.top="0",this._canvas.style.left="0"}getContext(){return this.context}getPixelRatio(){return this.pixelRatio}setPixelRatio(f){const p=this.pixelRatio;this.pixelRatio=f,this.setSize(this.getWidth()/p,this.getHeight()/p)}setWidth(f){this.width=this._canvas.width=f*this.pixelRatio,this._canvas.style.width=f+"px";const p=this.pixelRatio;this.getContext()._context.scale(p,p)}setHeight(f){this.height=this._canvas.height=f*this.pixelRatio,this._canvas.style.height=f+"px";const p=this.pixelRatio;this.getContext()._context.scale(p,p)}getWidth(){return this.width}getHeight(){return this.height}setSize(f,p){this.setWidth(f||0),this.setHeight(p||0)}toDataURL(f,p){try{return this._canvas.toDataURL(f,p)}catch{try{return this._canvas.toDataURL()}catch(y){return t.Util.error("Unable to get data URL. "+y.message+" For more info read https://konvajs.org/docs/posts/Tainted_Canvas.html."),""}}}};nc.Canvas=o,n.Factory.addGetterSetter(o,"pixelRatio",void 0,(0,i.getNumberValidator)());class l extends o{constructor(f={width:0,height:0,willReadFrequently:!1}){super(f),this.context=new e.SceneContext(this,{willReadFrequently:f.willReadFrequently}),this.setSize(f.width,f.height)}}nc.SceneCanvas=l;class u extends o{constructor(f={width:0,height:0}){super(f),this.hitCanvas=!0,this.context=new e.HitContext(this),this.setSize(f.width,f.height)}}return nc.HitCanvas=u,nc}var N2={},c5;function b_(){return c5||(c5=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.DD=void 0;const e=Tr(),r=pi();t.DD={get isDragging(){let n=!1;return t.DD._dragElements.forEach(i=>{i.dragStatus==="dragging"&&(n=!0)}),n},justDragged:!1,get node(){let n;return t.DD._dragElements.forEach(i=>{n=i.node}),n},_dragElements:new Map,_drag(n){const i=[];t.DD._dragElements.forEach((a,s)=>{const{node:o}=a,l=o.getStage();l.setPointersPositions(n),a.pointerId===void 0&&(a.pointerId=r.Util._getFirstPointerId(n));const u=l._changedPointerPositions.find(c=>c.id===a.pointerId);if(u){if(a.dragStatus!=="dragging"){const c=o.dragDistance();if(Math.max(Math.abs(u.x-a.startPointerPos.x),Math.abs(u.y-a.startPointerPos.y))<c||(o.startDrag({evt:n}),!o.isDragging()))return}o._setDragPosition(n,a),i.push(o)}}),i.forEach(a=>{a.fire("dragmove",{type:"dragmove",target:a,evt:n},!0)})},_endDragBefore(n){const i=[];t.DD._dragElements.forEach(a=>{const{node:s}=a,o=s.getStage();if(n&&o.setPointersPositions(n),!o._changedPointerPositions.find(c=>c.id===a.pointerId))return;(a.dragStatus==="dragging"||a.dragStatus==="stopped")&&(t.DD.justDragged=!0,e.Konva._mouseListenClick=!1,e.Konva._touchListenClick=!1,e.Konva._pointerListenClick=!1,a.dragStatus="stopped");const u=a.node.getLayer()||a.node instanceof e.Konva.Stage&&a.node;u&&i.indexOf(u)===-1&&i.push(u)}),i.forEach(a=>{a.draw()})},_endDragAfter(n){t.DD._dragElements.forEach((i,a)=>{i.dragStatus==="stopped"&&i.node.fire("dragend",{type:"dragend",target:i.node,evt:n},!0),i.dragStatus!=="dragging"&&t.DD._dragElements.delete(a)})}},e.Konva.isBrowser&&(window.addEventListener("mouseup",t.DD._endDragBefore,!0),window.addEventListener("touchend",t.DD._endDragBefore,!0),window.addEventListener("touchcancel",t.DD._endDragBefore,!0),window.addEventListener("mousemove",t.DD._drag),window.addEventListener("touchmove",t.DD._drag),window.addEventListener("mouseup",t.DD._endDragAfter,!1),window.addEventListener("touchend",t.DD._endDragAfter,!1),window.addEventListener("touchcancel",t.DD._endDragAfter,!1))})(N2)),N2}var d5;function Ei(){if(d5)return Qm;d5=1,Object.defineProperty(Qm,"__esModule",{value:!0}),Qm.Node=void 0;const t=pi(),e=Ar(),r=B1(),n=Tr(),i=b_(),a=Dr(),s="absoluteOpacity",o="allEventListeners",l="absoluteTransform",u="absoluteScale",c="canvas",f="Change",p="children",v="konva",y="listening",S="mouseenter",w="mouseleave",E="set",_="Shape",T=" ",N="stage",R="transform",I="Stage",F="visible",D=["xChange.konva","yChange.konva","scaleXChange.konva","scaleYChange.konva","skewXChange.konva","skewYChange.konva","rotationChange.konva","offsetXChange.konva","offsetYChange.konva","transformsEnabledChange.konva"].join(T);let j=1;class B{constructor(O){this._id=j++,this.eventListeners={},this.attrs={},this.index=0,this._allEventListeners=null,this.parent=null,this._cache=new Map,this._attachedDepsListeners=new Map,this._lastPos=null,this._batchingTransformChange=!1,this._needClearTransformCache=!1,this._filterUpToDate=!1,this._isUnderCache=!1,this._dragEventId=null,this._shouldFireChangeEvents=!1,this.setAttrs(O),this._shouldFireChangeEvents=!0}hasChildren(){return!1}_clearCache(O){(O===R||O===l)&&this._cache.get(O)?this._cache.get(O).dirty=!0:O?this._cache.delete(O):this._cache.clear()}_getCache(O,W){let U=this._cache.get(O);return(U===void 0||(O===R||O===l)&&U.dirty===!0)&&(U=W.call(this),this._cache.set(O,U)),U}_calculate(O,W,U){if(!this._attachedDepsListeners.get(O)){const q=W.map(Z=>Z+"Change.konva").join(T);this.on(q,()=>{this._clearCache(O)}),this._attachedDepsListeners.set(O,!0)}return this._getCache(O,U)}_getCanvasCache(){return this._cache.get(c)}_clearSelfAndDescendantCache(O){this._clearCache(O),O===l&&this.fire("absoluteTransformChange")}clearCache(){if(this._cache.has(c)){const{scene:O,filter:W,hit:U}=this._cache.get(c);t.Util.releaseCanvas(O,W,U),this._cache.delete(c)}return this._clearSelfAndDescendantCache(),this._requestDraw(),this}cache(O){const W=O||{};let U={};(W.x===void 0||W.y===void 0||W.width===void 0||W.height===void 0)&&(U=this.getClientRect({skipTransform:!0,relativeTo:this.getParent()||void 0}));let q=Math.ceil(W.width||U.width),Z=Math.ceil(W.height||U.height),Q=W.pixelRatio,ne=W.x===void 0?Math.floor(U.x):W.x,re=W.y===void 0?Math.floor(U.y):W.y,Y=W.offset||0,J=W.drawBorder||!1,ie=W.hitCanvasPixelRatio||1;if(!q||!Z){t.Util.error("Can not cache the node. Width or height of the node equals 0. Caching is skipped.");return}const de=Math.abs(Math.round(U.x)-ne)>.5?1:0,he=Math.abs(Math.round(U.y)-re)>.5?1:0;q+=Y*2+de,Z+=Y*2+he,ne-=Y,re-=Y;const xe=new r.SceneCanvas({pixelRatio:Q,width:q,height:Z}),le=new r.SceneCanvas({pixelRatio:Q,width:0,height:0,willReadFrequently:!0}),fe=new r.HitCanvas({pixelRatio:ie,width:q,height:Z}),ve=xe.getContext(),ge=fe.getContext();return fe.isCache=!0,xe.isCache=!0,this._cache.delete(c),this._filterUpToDate=!1,W.imageSmoothingEnabled===!1&&(xe.getContext()._context.imageSmoothingEnabled=!1,le.getContext()._context.imageSmoothingEnabled=!1),ve.save(),ge.save(),ve.translate(-ne,-re),ge.translate(-ne,-re),this._isUnderCache=!0,this._clearSelfAndDescendantCache(s),this._clearSelfAndDescendantCache(u),this.drawScene(xe,this),this.drawHit(fe,this),this._isUnderCache=!1,ve.restore(),ge.restore(),J&&(ve.save(),ve.beginPath(),ve.rect(0,0,q,Z),ve.closePath(),ve.setAttr("strokeStyle","red"),ve.setAttr("lineWidth",5),ve.stroke(),ve.restore()),this._cache.set(c,{scene:xe,filter:le,hit:fe,x:ne,y:re}),this._requestDraw(),this}isCached(){return this._cache.has(c)}getClientRect(O){throw new Error('abstract "getClientRect" method call')}_transformedRect(O,W){const U=[{x:O.x,y:O.y},{x:O.x+O.width,y:O.y},{x:O.x+O.width,y:O.y+O.height},{x:O.x,y:O.y+O.height}];let q=1/0,Z=1/0,Q=-1/0,ne=-1/0;const re=this.getAbsoluteTransform(W);return U.forEach(function(Y){const J=re.point(Y);q===void 0&&(q=Q=J.x,Z=ne=J.y),q=Math.min(q,J.x),Z=Math.min(Z,J.y),Q=Math.max(Q,J.x),ne=Math.max(ne,J.y)}),{x:q,y:Z,width:Q-q,height:ne-Z}}_drawCachedSceneCanvas(O){O.save(),O._applyOpacity(this),O._applyGlobalCompositeOperation(this);const W=this._getCanvasCache();O.translate(W.x,W.y);const U=this._getCachedSceneCanvas(),q=U.pixelRatio;O.drawImage(U._canvas,0,0,U.width/q,U.height/q),O.restore()}_drawCachedHitCanvas(O){const W=this._getCanvasCache(),U=W.hit;O.save(),O.translate(W.x,W.y),O.drawImage(U._canvas,0,0,U.width/U.pixelRatio,U.height/U.pixelRatio),O.restore()}_getCachedSceneCanvas(){let O=this.filters(),W=this._getCanvasCache(),U=W.scene,q=W.filter,Z=q.getContext(),Q,ne,re,Y;if(O){if(!this._filterUpToDate){const J=U.pixelRatio;q.setSize(U.width/U.pixelRatio,U.height/U.pixelRatio);try{for(Q=O.length,Z.clear(),Z.drawImage(U._canvas,0,0,U.getWidth()/J,U.getHeight()/J),ne=Z.getImageData(0,0,q.getWidth(),q.getHeight()),re=0;re<Q;re++){if(Y=O[re],typeof Y!="function"){t.Util.error("Filter should be type of function, but got "+typeof Y+" instead. Please check correct filters");continue}Y.call(this,ne),Z.putImageData(ne,0,0)}}catch(ie){t.Util.error("Unable to apply filter. "+ie.message+" This post my help you https://konvajs.org/docs/posts/Tainted_Canvas.html.")}this._filterUpToDate=!0}return q}return U}on(O,W){if(this._cache&&this._cache.delete(o),arguments.length===3)return this._delegate.apply(this,arguments);let U=O.split(T),q=U.length,Z,Q,ne,re,Y;for(Z=0;Z<q;Z++)Q=U[Z],ne=Q.split("."),re=ne[0],Y=ne[1]||"",this.eventListeners[re]||(this.eventListeners[re]=[]),this.eventListeners[re].push({name:Y,handler:W});return this}off(O,W){let U=(O||"").split(T),q=U.length,Z,Q,ne,re,Y,J;if(this._cache&&this._cache.delete(o),!O)for(Q in this.eventListeners)this._off(Q);for(Z=0;Z<q;Z++)if(ne=U[Z],re=ne.split("."),Y=re[0],J=re[1],Y)this.eventListeners[Y]&&this._off(Y,J,W);else for(Q in this.eventListeners)this._off(Q,J,W);return this}dispatchEvent(O){const W={target:this,type:O.type,evt:O};return this.fire(O.type,W),this}addEventListener(O,W){return this.on(O,function(U){W.call(this,U.evt)}),this}removeEventListener(O){return this.off(O),this}_delegate(O,W,U){const q=this;this.on(O,function(Z){const Q=Z.target.findAncestors(W,!0,q);for(let ne=0;ne<Q.length;ne++)Z=t.Util.cloneObject(Z),Z.currentTarget=Q[ne],U.call(Q[ne],Z)})}remove(){return this.isDragging()&&this.stopDrag(),i.DD._dragElements.delete(this._id),this._remove(),this}_clearCaches(){this._clearSelfAndDescendantCache(l),this._clearSelfAndDescendantCache(s),this._clearSelfAndDescendantCache(u),this._clearSelfAndDescendantCache(N),this._clearSelfAndDescendantCache(F),this._clearSelfAndDescendantCache(y)}_remove(){this._clearCaches();const O=this.getParent();O&&O.children&&(O.children.splice(this.index,1),O._setChildrenIndices(),this.parent=null)}destroy(){return this.remove(),this.clearCache(),this}getAttr(O){const W="get"+t.Util._capitalize(O);return t.Util._isFunction(this[W])?this[W]():this.attrs[O]}getAncestors(){let O=this.getParent(),W=[];for(;O;)W.push(O),O=O.getParent();return W}getAttrs(){return this.attrs||{}}setAttrs(O){return this._batchTransformChanges(()=>{let W,U;if(!O)return this;for(W in O)W!==p&&(U=E+t.Util._capitalize(W),t.Util._isFunction(this[U])?this[U](O[W]):this._setAttr(W,O[W]))}),this}isListening(){return this._getCache(y,this._isListening)}_isListening(O){if(!this.listening())return!1;const U=this.getParent();return U&&U!==O&&this!==O?U._isListening(O):!0}isVisible(){return this._getCache(F,this._isVisible)}_isVisible(O){if(!this.visible())return!1;const U=this.getParent();return U&&U!==O&&this!==O?U._isVisible(O):!0}shouldDrawHit(O,W=!1){if(O)return this._isVisible(O)&&this._isListening(O);const U=this.getLayer();let q=!1;i.DD._dragElements.forEach(Q=>{Q.dragStatus==="dragging"&&(Q.node.nodeType==="Stage"||Q.node.getLayer()===U)&&(q=!0)});const Z=!W&&!n.Konva.hitOnDragEnabled&&(q||n.Konva.isTransforming());return this.isListening()&&this.isVisible()&&!Z}show(){return this.visible(!0),this}hide(){return this.visible(!1),this}getZIndex(){return this.index||0}getAbsoluteZIndex(){let O=this.getDepth(),W=this,U=0,q,Z,Q,ne;function re(J){for(q=[],Z=J.length,Q=0;Q<Z;Q++)ne=J[Q],U++,ne.nodeType!==_&&(q=q.concat(ne.getChildren().slice())),ne._id===W._id&&(Q=Z);q.length>0&&q[0].getDepth()<=O&&re(q)}const Y=this.getStage();return W.nodeType!==I&&Y&&re(Y.getChildren()),U}getDepth(){let O=0,W=this.parent;for(;W;)O++,W=W.parent;return O}_batchTransformChanges(O){this._batchingTransformChange=!0,O(),this._batchingTransformChange=!1,this._needClearTransformCache&&(this._clearCache(R),this._clearSelfAndDescendantCache(l)),this._needClearTransformCache=!1}setPosition(O){return this._batchTransformChanges(()=>{this.x(O.x),this.y(O.y)}),this}getPosition(){return{x:this.x(),y:this.y()}}getRelativePointerPosition(){const O=this.getStage();if(!O)return null;const W=O.getPointerPosition();if(!W)return null;const U=this.getAbsoluteTransform().copy();return U.invert(),U.point(W)}getAbsolutePosition(O){let W=!1,U=this.parent;for(;U;){if(U.isCached()){W=!0;break}U=U.parent}W&&!O&&(O=!0);const q=this.getAbsoluteTransform(O).getMatrix(),Z=new t.Transform,Q=this.offset();return Z.m=q.slice(),Z.translate(Q.x,Q.y),Z.getTranslation()}setAbsolutePosition(O){const{x:W,y:U,...q}=this._clearTransform();this.attrs.x=W,this.attrs.y=U,this._clearCache(R);const Z=this._getAbsoluteTransform().copy();return Z.invert(),Z.translate(O.x,O.y),O={x:this.attrs.x+Z.getTranslation().x,y:this.attrs.y+Z.getTranslation().y},this._setTransform(q),this.setPosition({x:O.x,y:O.y}),this._clearCache(R),this._clearSelfAndDescendantCache(l),this}_setTransform(O){let W;for(W in O)this.attrs[W]=O[W]}_clearTransform(){const O={x:this.x(),y:this.y(),rotation:this.rotation(),scaleX:this.scaleX(),scaleY:this.scaleY(),offsetX:this.offsetX(),offsetY:this.offsetY(),skewX:this.skewX(),skewY:this.skewY()};return this.attrs.x=0,this.attrs.y=0,this.attrs.rotation=0,this.attrs.scaleX=1,this.attrs.scaleY=1,this.attrs.offsetX=0,this.attrs.offsetY=0,this.attrs.skewX=0,this.attrs.skewY=0,O}move(O){let W=O.x,U=O.y,q=this.x(),Z=this.y();return W!==void 0&&(q+=W),U!==void 0&&(Z+=U),this.setPosition({x:q,y:Z}),this}_eachAncestorReverse(O,W){let U=[],q=this.getParent(),Z,Q;if(!(W&&W._id===this._id)){for(U.unshift(this);q&&(!W||q._id!==W._id);)U.unshift(q),q=q.parent;for(Z=U.length,Q=0;Q<Z;Q++)O(U[Q])}}rotate(O){return this.rotation(this.rotation()+O),this}moveToTop(){if(!this.parent)return t.Util.warn("Node has no parent. moveToTop function is ignored."),!1;const O=this.index,W=this.parent.getChildren().length;return O<W-1?(this.parent.children.splice(O,1),this.parent.children.push(this),this.parent._setChildrenIndices(),!0):!1}moveUp(){if(!this.parent)return t.Util.warn("Node has no parent. moveUp function is ignored."),!1;const O=this.index,W=this.parent.getChildren().length;return O<W-1?(this.parent.children.splice(O,1),this.parent.children.splice(O+1,0,this),this.parent._setChildrenIndices(),!0):!1}moveDown(){if(!this.parent)return t.Util.warn("Node has no parent. moveDown function is ignored."),!1;const O=this.index;return O>0?(this.parent.children.splice(O,1),this.parent.children.splice(O-1,0,this),this.parent._setChildrenIndices(),!0):!1}moveToBottom(){if(!this.parent)return t.Util.warn("Node has no parent. moveToBottom function is ignored."),!1;const O=this.index;return O>0?(this.parent.children.splice(O,1),this.parent.children.unshift(this),this.parent._setChildrenIndices(),!0):!1}setZIndex(O){if(!this.parent)return t.Util.warn("Node has no parent. zIndex parameter is ignored."),this;(O<0||O>=this.parent.children.length)&&t.Util.warn("Unexpected value "+O+" for zIndex property. zIndex is just index of a node in children of its parent. Expected value is from 0 to "+(this.parent.children.length-1)+".");const W=this.index;return this.parent.children.splice(W,1),this.parent.children.splice(O,0,this),this.parent._setChildrenIndices(),this}getAbsoluteOpacity(){return this._getCache(s,this._getAbsoluteOpacity)}_getAbsoluteOpacity(){let O=this.opacity();const W=this.getParent();return W&&!W._isUnderCache&&(O*=W.getAbsoluteOpacity()),O}moveTo(O){return this.getParent()!==O&&(this._remove(),O.add(this)),this}toObject(){let O=this.getAttrs(),W,U,q,Z,Q;const ne={attrs:{},className:this.getClassName()};for(W in O)U=O[W],Q=t.Util.isObject(U)&&!t.Util._isPlainObject(U)&&!t.Util._isArray(U),!Q&&(q=typeof this[W]=="function"&&this[W],delete O[W],Z=q?q.call(this):null,O[W]=U,Z!==U&&(ne.attrs[W]=U));return t.Util._prepareToStringify(ne)}toJSON(){return JSON.stringify(this.toObject())}getParent(){return this.parent}findAncestors(O,W,U){const q=[];W&&this._isMatch(O)&&q.push(this);let Z=this.parent;for(;Z;){if(Z===U)return q;Z._isMatch(O)&&q.push(Z),Z=Z.parent}return q}isAncestorOf(O){return!1}findAncestor(O,W,U){return this.findAncestors(O,W,U)[0]}_isMatch(O){if(!O)return!1;if(typeof O=="function")return O(this);let W=O.replace(/ /g,"").split(","),U=W.length,q,Z;for(q=0;q<U;q++)if(Z=W[q],t.Util.isValidSelector(Z)||(t.Util.warn('Selector "'+Z+'" is invalid. Allowed selectors examples are "#foo", ".bar" or "Group".'),t.Util.warn('If you have a custom shape with such className, please change it to start with upper letter like "Triangle".'),t.Util.warn("Konva is awesome, right?")),Z.charAt(0)==="#"){if(this.id()===Z.slice(1))return!0}else if(Z.charAt(0)==="."){if(this.hasName(Z.slice(1)))return!0}else if(this.className===Z||this.nodeType===Z)return!0;return!1}getLayer(){const O=this.getParent();return O?O.getLayer():null}getStage(){return this._getCache(N,this._getStage)}_getStage(){const O=this.getParent();return O?O.getStage():null}fire(O,W={},U){return W.target=W.target||this,U?this._fireAndBubble(O,W):this._fire(O,W),this}getAbsoluteTransform(O){return O?this._getAbsoluteTransform(O):this._getCache(l,this._getAbsoluteTransform)}_getAbsoluteTransform(O){let W;if(O)return W=new t.Transform,this._eachAncestorReverse(function(U){const q=U.transformsEnabled();q==="all"?W.multiply(U.getTransform()):q==="position"&&W.translate(U.x()-U.offsetX(),U.y()-U.offsetY())},O),W;{W=this._cache.get(l)||new t.Transform,this.parent?this.parent.getAbsoluteTransform().copyInto(W):W.reset();const U=this.transformsEnabled();if(U==="all")W.multiply(this.getTransform());else if(U==="position"){const q=this.attrs.x||0,Z=this.attrs.y||0,Q=this.attrs.offsetX||0,ne=this.attrs.offsetY||0;W.translate(q-Q,Z-ne)}return W.dirty=!1,W}}getAbsoluteScale(O){let W=this;for(;W;)W._isUnderCache&&(O=W),W=W.getParent();const q=this.getAbsoluteTransform(O).decompose();return{x:q.scaleX,y:q.scaleY}}getAbsoluteRotation(){return this.getAbsoluteTransform().decompose().rotation}getTransform(){return this._getCache(R,this._getTransform)}_getTransform(){var O,W;const U=this._cache.get(R)||new t.Transform;U.reset();const q=this.x(),Z=this.y(),Q=n.Konva.getAngle(this.rotation()),ne=(O=this.attrs.scaleX)!==null&&O!==void 0?O:1,re=(W=this.attrs.scaleY)!==null&&W!==void 0?W:1,Y=this.attrs.skewX||0,J=this.attrs.skewY||0,ie=this.attrs.offsetX||0,de=this.attrs.offsetY||0;return(q!==0||Z!==0)&&U.translate(q,Z),Q!==0&&U.rotate(Q),(Y!==0||J!==0)&&U.skew(Y,J),(ne!==1||re!==1)&&U.scale(ne,re),(ie!==0||de!==0)&&U.translate(-1*ie,-1*de),U.dirty=!1,U}clone(O){let W=t.Util.cloneObject(this.attrs),U,q,Z,Q,ne;for(U in O)W[U]=O[U];const re=new this.constructor(W);for(U in this.eventListeners)for(q=this.eventListeners[U],Z=q.length,Q=0;Q<Z;Q++)ne=q[Q],ne.name.indexOf(v)<0&&(re.eventListeners[U]||(re.eventListeners[U]=[]),re.eventListeners[U].push(ne));return re}_toKonvaCanvas(O){O=O||{};const W=this.getClientRect(),U=this.getStage(),q=O.x!==void 0?O.x:Math.floor(W.x),Z=O.y!==void 0?O.y:Math.floor(W.y),Q=O.pixelRatio||1,ne=new r.SceneCanvas({width:O.width||Math.ceil(W.width)||(U?U.width():0),height:O.height||Math.ceil(W.height)||(U?U.height():0),pixelRatio:Q}),re=ne.getContext(),Y=new r.SceneCanvas({width:ne.width/ne.pixelRatio+Math.abs(q),height:ne.height/ne.pixelRatio+Math.abs(Z),pixelRatio:ne.pixelRatio});return O.imageSmoothingEnabled===!1&&(re._context.imageSmoothingEnabled=!1),re.save(),(q||Z)&&re.translate(-1*q,-1*Z),this.drawScene(ne,void 0,Y),re.restore(),ne}toCanvas(O){return this._toKonvaCanvas(O)._canvas}toDataURL(O){O=O||{};const W=O.mimeType||null,U=O.quality||null,q=this._toKonvaCanvas(O).toDataURL(W,U);return O.callback&&O.callback(q),q}toImage(O){return new Promise((W,U)=>{try{const q=O?.callback;q&&delete O.callback,t.Util._urlToImage(this.toDataURL(O),function(Z){W(Z),q?.(Z)})}catch(q){U(q)}})}toBlob(O){return new Promise((W,U)=>{try{const q=O?.callback;q&&delete O.callback,this.toCanvas(O).toBlob(Z=>{W(Z),q?.(Z)},O?.mimeType,O?.quality)}catch(q){U(q)}})}setSize(O){return this.width(O.width),this.height(O.height),this}getSize(){return{width:this.width(),height:this.height()}}getClassName(){return this.className||this.nodeType}getType(){return this.nodeType}getDragDistance(){return this.attrs.dragDistance!==void 0?this.attrs.dragDistance:this.parent?this.parent.getDragDistance():n.Konva.dragDistance}_off(O,W,U){let q=this.eventListeners[O],Z,Q,ne;for(Z=0;Z<q.length;Z++)if(Q=q[Z].name,ne=q[Z].handler,(Q!=="konva"||W==="konva")&&(!W||Q===W)&&(!U||U===ne)){if(q.splice(Z,1),q.length===0){delete this.eventListeners[O];break}Z--}}_fireChangeEvent(O,W,U){this._fire(O+f,{oldVal:W,newVal:U})}addName(O){if(!this.hasName(O)){const W=this.name(),U=W?W+" "+O:O;this.name(U)}return this}hasName(O){if(!O)return!1;const W=this.name();return W?(W||"").split(/\s/g).indexOf(O)!==-1:!1}removeName(O){const W=(this.name()||"").split(/\s/g),U=W.indexOf(O);return U!==-1&&(W.splice(U,1),this.name(W.join(" "))),this}setAttr(O,W){const U=this[E+t.Util._capitalize(O)];return t.Util._isFunction(U)?U.call(this,W):this._setAttr(O,W),this}_requestDraw(){if(n.Konva.autoDrawEnabled){const O=this.getLayer()||this.getStage();O?.batchDraw()}}_setAttr(O,W){const U=this.attrs[O];U===W&&!t.Util.isObject(W)||(W==null?delete this.attrs[O]:this.attrs[O]=W,this._shouldFireChangeEvents&&this._fireChangeEvent(O,U,W),this._requestDraw())}_setComponentAttr(O,W,U){let q;U!==void 0&&(q=this.attrs[O],q||(this.attrs[O]=this.getAttr(O)),this.attrs[O][W]=U,this._fireChangeEvent(O,q,U))}_fireAndBubble(O,W,U){if(W&&this.nodeType===_&&(W.target=this),!((O===S||O===w)&&(U&&(this===U||this.isAncestorOf&&this.isAncestorOf(U))||this.nodeType==="Stage"&&!U))){this._fire(O,W);const Z=(O===S||O===w)&&U&&U.isAncestorOf&&U.isAncestorOf(this)&&!U.isAncestorOf(this.parent);(W&&!W.cancelBubble||!W)&&this.parent&&this.parent.isListening()&&!Z&&(U&&U.parent?this._fireAndBubble.call(this.parent,O,W,U):this._fireAndBubble.call(this.parent,O,W))}}_getProtoListeners(O){var W,U,q;const Z=(W=this._cache.get(o))!==null&&W!==void 0?W:{};let Q=Z?.[O];if(Q===void 0){Q=[];let ne=Object.getPrototypeOf(this);for(;ne;){const re=(q=(U=ne.eventListeners)===null||U===void 0?void 0:U[O])!==null&&q!==void 0?q:[];Q.push(...re),ne=Object.getPrototypeOf(ne)}Z[O]=Q,this._cache.set(o,Z)}return Q}_fire(O,W){W=W||{},W.currentTarget=this,W.type=O;const U=this._getProtoListeners(O);if(U)for(var q=0;q<U.length;q++)U[q].handler.call(this,W);const Z=this.eventListeners[O];if(Z)for(var q=0;q<Z.length;q++)Z[q].handler.call(this,W)}draw(){return this.drawScene(),this.drawHit(),this}_createDragElement(O){const W=O?O.pointerId:void 0,U=this.getStage(),q=this.getAbsolutePosition();if(!U)return;const Z=U._getPointerById(W)||U._changedPointerPositions[0]||q;i.DD._dragElements.set(this._id,{node:this,startPointerPos:Z,offset:{x:Z.x-q.x,y:Z.y-q.y},dragStatus:"ready",pointerId:W})}startDrag(O,W=!0){i.DD._dragElements.has(this._id)||this._createDragElement(O);const U=i.DD._dragElements.get(this._id);U.dragStatus="dragging",this.fire("dragstart",{type:"dragstart",target:this,evt:O&&O.evt},W)}_setDragPosition(O,W){const U=this.getStage()._getPointerById(W.pointerId);if(!U)return;let q={x:U.x-W.offset.x,y:U.y-W.offset.y};const Z=this.dragBoundFunc();if(Z!==void 0){const Q=Z.call(this,q,O);Q?q=Q:t.Util.warn("dragBoundFunc did not return any value. That is unexpected behavior. You must return new absolute position from dragBoundFunc.")}(!this._lastPos||this._lastPos.x!==q.x||this._lastPos.y!==q.y)&&(this.setAbsolutePosition(q),this._requestDraw()),this._lastPos=q}stopDrag(O){const W=i.DD._dragElements.get(this._id);W&&(W.dragStatus="stopped"),i.DD._endDragBefore(O),i.DD._endDragAfter(O)}setDraggable(O){this._setAttr("draggable",O),this._dragChange()}isDragging(){const O=i.DD._dragElements.get(this._id);return O?O.dragStatus==="dragging":!1}_listenDrag(){this._dragCleanup(),this.on("mousedown.konva touchstart.konva",function(O){if(!(!(O.evt.button!==void 0)||n.Konva.dragButtons.indexOf(O.evt.button)>=0)||this.isDragging())return;let q=!1;i.DD._dragElements.forEach(Z=>{this.isAncestorOf(Z.node)&&(q=!0)}),q||this._createDragElement(O)})}_dragChange(){if(this.attrs.draggable)this._listenDrag();else{if(this._dragCleanup(),!this.getStage())return;const W=i.DD._dragElements.get(this._id),U=W&&W.dragStatus==="dragging",q=W&&W.dragStatus==="ready";U?this.stopDrag():q&&i.DD._dragElements.delete(this._id)}}_dragCleanup(){this.off("mousedown.konva"),this.off("touchstart.konva")}isClientRectOnScreen(O={x:0,y:0}){const W=this.getStage();if(!W)return!1;const U={x:-O.x,y:-O.y,width:W.width()+2*O.x,height:W.height()+2*O.y};return t.Util.haveIntersection(U,this.getClientRect())}static create(O,W){return t.Util._isString(O)&&(O=JSON.parse(O)),this._createNode(O,W)}static _createNode(O,W){let U=B.prototype.getClassName.call(O),q=O.children,Z,Q,ne;W&&(O.attrs.container=W),n.Konva[U]||(t.Util.warn('Can not find a node with class name "'+U+'". Fallback to "Shape".'),U="Shape");const re=n.Konva[U];if(Z=new re(O.attrs),q)for(Q=q.length,ne=0;ne<Q;ne++)Z.add(B._createNode(q[ne]));return Z}}Qm.Node=B,B.prototype.nodeType="Node",B.prototype._attrsAffectingSize=[],B.prototype.eventListeners={},B.prototype.on.call(B.prototype,D,function(){if(this._batchingTransformChange){this._needClearTransformCache=!0;return}this._clearCache(R),this._clearSelfAndDescendantCache(l)}),B.prototype.on.call(B.prototype,"visibleChange.konva",function(){this._clearSelfAndDescendantCache(F)}),B.prototype.on.call(B.prototype,"listeningChange.konva",function(){this._clearSelfAndDescendantCache(y)}),B.prototype.on.call(B.prototype,"opacityChange.konva",function(){this._clearSelfAndDescendantCache(s)});const G=e.Factory.addGetterSetter;return G(B,"zIndex"),G(B,"absolutePosition"),G(B,"position"),G(B,"x",0,(0,a.getNumberValidator)()),G(B,"y",0,(0,a.getNumberValidator)()),G(B,"globalCompositeOperation","source-over",(0,a.getStringValidator)()),G(B,"opacity",1,(0,a.getNumberValidator)()),G(B,"name","",(0,a.getStringValidator)()),G(B,"id","",(0,a.getStringValidator)()),G(B,"rotation",0,(0,a.getNumberValidator)()),e.Factory.addComponentsGetterSetter(B,"scale",["x","y"]),G(B,"scaleX",1,(0,a.getNumberValidator)()),G(B,"scaleY",1,(0,a.getNumberValidator)()),e.Factory.addComponentsGetterSetter(B,"skew",["x","y"]),G(B,"skewX",0,(0,a.getNumberValidator)()),G(B,"skewY",0,(0,a.getNumberValidator)()),e.Factory.addComponentsGetterSetter(B,"offset",["x","y"]),G(B,"offsetX",0,(0,a.getNumberValidator)()),G(B,"offsetY",0,(0,a.getNumberValidator)()),G(B,"dragDistance",null,(0,a.getNumberValidator)()),G(B,"width",0,(0,a.getNumberValidator)()),G(B,"height",0,(0,a.getNumberValidator)()),G(B,"listening",!0,(0,a.getBooleanValidator)()),G(B,"preventDefault",!0,(0,a.getBooleanValidator)()),G(B,"filters",null,function(K){return this._filterUpToDate=!1,K}),G(B,"visible",!0,(0,a.getBooleanValidator)()),G(B,"transformsEnabled","all",(0,a.getStringValidator)()),G(B,"size"),G(B,"dragBoundFunc"),G(B,"draggable",!1,(0,a.getBooleanValidator)()),e.Factory.backCompat(B,{rotateDeg:"rotate",setRotationDeg:"setRotation",getRotationDeg:"getRotation"}),Qm}var Jm={},f5;function z1(){if(f5)return Jm;f5=1,Object.defineProperty(Jm,"__esModule",{value:!0}),Jm.Container=void 0;const t=Ar(),e=Ei(),r=Dr();let n=class extends e.Node{constructor(){super(...arguments),this.children=[]}getChildren(a){if(!a)return this.children||[];const s=this.children||[],o=[];return s.forEach(function(l){a(l)&&o.push(l)}),o}hasChildren(){return this.getChildren().length>0}removeChildren(){return this.getChildren().forEach(a=>{a.parent=null,a.index=0,a.remove()}),this.children=[],this._requestDraw(),this}destroyChildren(){return this.getChildren().forEach(a=>{a.parent=null,a.index=0,a.destroy()}),this.children=[],this._requestDraw(),this}add(...a){if(a.length===0)return this;if(a.length>1){for(let o=0;o<a.length;o++)this.add(a[o]);return this}const s=a[0];return s.getParent()?(s.moveTo(this),this):(this._validateAdd(s),s.index=this.getChildren().length,s.parent=this,s._clearCaches(),this.getChildren().push(s),this._fire("add",{child:s}),this._requestDraw(),this)}destroy(){return this.hasChildren()&&this.destroyChildren(),super.destroy(),this}find(a){return this._generalFind(a,!1)}findOne(a){const s=this._generalFind(a,!0);return s.length>0?s[0]:void 0}_generalFind(a,s){const o=[];return this._descendants(l=>{const u=l._isMatch(a);return u&&o.push(l),!!(u&&s)}),o}_descendants(a){let s=!1;const o=this.getChildren();for(const l of o){if(s=a(l),s)return!0;if(l.hasChildren()&&(s=l._descendants(a),s))return!0}return!1}toObject(){const a=e.Node.prototype.toObject.call(this);return a.children=[],this.getChildren().forEach(s=>{a.children.push(s.toObject())}),a}isAncestorOf(a){let s=a.getParent();for(;s;){if(s._id===this._id)return!0;s=s.getParent()}return!1}clone(a){const s=e.Node.prototype.clone.call(this,a);return this.getChildren().forEach(function(o){s.add(o.clone())}),s}getAllIntersections(a){const s=[];return this.find("Shape").forEach(o=>{o.isVisible()&&o.intersects(a)&&s.push(o)}),s}_clearSelfAndDescendantCache(a){var s;super._clearSelfAndDescendantCache(a),!this.isCached()&&((s=this.children)===null||s===void 0||s.forEach(function(o){o._clearSelfAndDescendantCache(a)}))}_setChildrenIndices(){var a;(a=this.children)===null||a===void 0||a.forEach(function(s,o){s.index=o}),this._requestDraw()}drawScene(a,s,o){const l=this.getLayer(),u=a||l&&l.getCanvas(),c=u&&u.getContext(),f=this._getCanvasCache(),p=f&&f.scene,v=u&&u.isCache;if(!this.isVisible()&&!v)return this;if(p){c.save();const y=this.getAbsoluteTransform(s).getMatrix();c.transform(y[0],y[1],y[2],y[3],y[4],y[5]),this._drawCachedSceneCanvas(c),c.restore()}else this._drawChildren("drawScene",u,s,o);return this}drawHit(a,s){if(!this.shouldDrawHit(s))return this;const o=this.getLayer(),l=a||o&&o.hitCanvas,u=l&&l.getContext(),c=this._getCanvasCache();if(c&&c.hit){u.save();const p=this.getAbsoluteTransform(s).getMatrix();u.transform(p[0],p[1],p[2],p[3],p[4],p[5]),this._drawCachedHitCanvas(u),u.restore()}else this._drawChildren("drawHit",l,s);return this}_drawChildren(a,s,o,l){var u;const c=s&&s.getContext(),f=this.clipWidth(),p=this.clipHeight(),v=this.clipFunc(),y=typeof f=="number"&&typeof p=="number"||v,S=o===this;if(y){c.save();const E=this.getAbsoluteTransform(o);let _=E.getMatrix();c.transform(_[0],_[1],_[2],_[3],_[4],_[5]),c.beginPath();let T;if(v)T=v.call(this,c,this);else{const N=this.clipX(),R=this.clipY();c.rect(N||0,R||0,f,p)}c.clip.apply(c,T),_=E.copy().invert().getMatrix(),c.transform(_[0],_[1],_[2],_[3],_[4],_[5])}const w=!S&&this.globalCompositeOperation()!=="source-over"&&a==="drawScene";w&&(c.save(),c._applyGlobalCompositeOperation(this)),(u=this.children)===null||u===void 0||u.forEach(function(E){E[a](s,o,l)}),w&&c.restore(),y&&c.restore()}getClientRect(a={}){var s;const o=a.skipTransform,l=a.relativeTo;let u,c,f,p,v={x:1/0,y:1/0,width:0,height:0};const y=this;(s=this.children)===null||s===void 0||s.forEach(function(E){if(!E.visible())return;const _=E.getClientRect({relativeTo:y,skipShadow:a.skipShadow,skipStroke:a.skipStroke});_.width===0&&_.height===0||(u===void 0?(u=_.x,c=_.y,f=_.x+_.width,p=_.y+_.height):(u=Math.min(u,_.x),c=Math.min(c,_.y),f=Math.max(f,_.x+_.width),p=Math.max(p,_.y+_.height)))});const S=this.find("Shape");let w=!1;for(let E=0;E<S.length;E++)if(S[E]._isVisible(this)){w=!0;break}return w&&u!==void 0?v={x:u,y:c,width:f-u,height:p-c}:v={x:0,y:0,width:0,height:0},o?v:this._transformedRect(v,l)}};return Jm.Container=n,t.Factory.addComponentsGetterSetter(n,"clip",["x","y","width","height"]),t.Factory.addGetterSetter(n,"clipX",void 0,(0,r.getNumberValidator)()),t.Factory.addGetterSetter(n,"clipY",void 0,(0,r.getNumberValidator)()),t.Factory.addGetterSetter(n,"clipWidth",void 0,(0,r.getNumberValidator)()),t.Factory.addGetterSetter(n,"clipHeight",void 0,(0,r.getNumberValidator)()),t.Factory.addGetterSetter(n,"clipFunc"),Jm}var P2={},xd={},h5;function xR(){if(h5)return xd;h5=1,Object.defineProperty(xd,"__esModule",{value:!0}),xd.getCapturedShape=n,xd.createEvent=i,xd.hasPointerCapture=a,xd.setPointerCapture=s,xd.releaseCapture=o;const t=Tr(),e=new Map,r=t.Konva._global.PointerEvent!==void 0;function n(l){return e.get(l)}function i(l){return{evt:l,pointerId:l.pointerId}}function a(l,u){return e.get(l)===u}function s(l,u){o(l),u.getStage()&&(e.set(l,u),r&&u._fire("gotpointercapture",i(new PointerEvent("gotpointercapture"))))}function o(l,u){const c=e.get(l);if(!c)return;const f=c.getStage();f&&f.content,e.delete(l),r&&c._fire("lostpointercapture",i(new PointerEvent("lostpointercapture")))}return xd}var p5;function mG(){return p5||(p5=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Stage=t.stages=void 0;const e=pi(),r=Ar(),n=z1(),i=Tr(),a=B1(),s=b_(),o=Tr(),l=xR(),u="Stage",c="string",f="px",p="mouseout",v="mouseleave",y="mouseover",S="mouseenter",w="mousemove",E="mousedown",_="mouseup",T="pointermove",N="pointerdown",R="pointerup",I="pointercancel",F="lostpointercapture",D="pointerout",j="pointerleave",B="pointerover",G="pointerenter",K="contextmenu",O="touchstart",W="touchend",U="touchmove",q="touchcancel",Z="wheel",Q=5,ne=[[S,"_pointerenter"],[E,"_pointerdown"],[w,"_pointermove"],[_,"_pointerup"],[v,"_pointerleave"],[O,"_pointerdown"],[U,"_pointermove"],[W,"_pointerup"],[q,"_pointercancel"],[y,"_pointerover"],[Z,"_wheel"],[K,"_contextmenu"],[N,"_pointerdown"],[T,"_pointermove"],[R,"_pointerup"],[I,"_pointercancel"],[F,"_lostpointercapture"]],re={mouse:{[D]:p,[j]:v,[B]:y,[G]:S,[T]:w,[N]:E,[R]:_,[I]:"mousecancel",pointerclick:"click",pointerdblclick:"dblclick"},touch:{[D]:"touchout",[j]:"touchleave",[B]:"touchover",[G]:"touchenter",[T]:U,[N]:O,[R]:W,[I]:q,pointerclick:"tap",pointerdblclick:"dbltap"},pointer:{[D]:D,[j]:j,[B]:B,[G]:G,[T]:T,[N]:N,[R]:R,[I]:I,pointerclick:"pointerclick",pointerdblclick:"pointerdblclick"}},Y=xe=>xe.indexOf("pointer")>=0?"pointer":xe.indexOf("touch")>=0?"touch":"mouse",J=xe=>{const le=Y(xe);if(le==="pointer")return i.Konva.pointerEventsEnabled&&re.pointer;if(le==="touch")return re.touch;if(le==="mouse")return re.mouse};function ie(xe={}){return(xe.clipFunc||xe.clipWidth||xe.clipHeight)&&e.Util.warn("Stage does not support clipping. Please use clip for Layers or Groups."),xe}const de="Pointer position is missing and not registered by the stage. Looks like it is outside of the stage container. You can set it manually from event: stage.setPointersPositions(event);";t.stages=[];class he extends n.Container{constructor(le){super(ie(le)),this._pointerPositions=[],this._changedPointerPositions=[],this._buildDOM(),this._bindContentEvents(),t.stages.push(this),this.on("widthChange.konva heightChange.konva",this._resizeDOM),this.on("visibleChange.konva",this._checkVisibility),this.on("clipWidthChange.konva clipHeightChange.konva clipFuncChange.konva",()=>{ie(this.attrs)}),this._checkVisibility()}_validateAdd(le){const fe=le.getType()==="Layer",ve=le.getType()==="FastLayer";fe||ve||e.Util.throw("You may only add layers to the stage.")}_checkVisibility(){if(!this.content)return;const le=this.visible()?"":"none";this.content.style.display=le}setContainer(le){if(typeof le===c){if(le.charAt(0)==="."){const ve=le.slice(1);le=document.getElementsByClassName(ve)[0]}else{var fe;le.charAt(0)!=="#"?fe=le:fe=le.slice(1),le=document.getElementById(fe)}if(!le)throw"Can not find container in document with id "+fe}return this._setAttr("container",le),this.content&&(this.content.parentElement&&this.content.parentElement.removeChild(this.content),le.appendChild(this.content)),this}shouldDrawHit(){return!0}clear(){let le=this.children,fe=le.length,ve;for(ve=0;ve<fe;ve++)le[ve].clear();return this}clone(le){return le||(le={}),le.container=typeof document<"u"&&document.createElement("div"),n.Container.prototype.clone.call(this,le)}destroy(){super.destroy();const le=this.content;le&&e.Util._isInDocument(le)&&this.container().removeChild(le);const fe=t.stages.indexOf(this);return fe>-1&&t.stages.splice(fe,1),e.Util.releaseCanvas(this.bufferCanvas._canvas,this.bufferHitCanvas._canvas),this}getPointerPosition(){const le=this._pointerPositions[0]||this._changedPointerPositions[0];return le?{x:le.x,y:le.y}:(e.Util.warn(de),null)}_getPointerById(le){return this._pointerPositions.find(fe=>fe.id===le)}getPointersPositions(){return this._pointerPositions}getStage(){return this}getContent(){return this.content}_toKonvaCanvas(le){le=le||{},le.x=le.x||0,le.y=le.y||0,le.width=le.width||this.width(),le.height=le.height||this.height();const fe=new a.SceneCanvas({width:le.width,height:le.height,pixelRatio:le.pixelRatio||1}),ve=fe.getContext()._context,ge=this.children;return(le.x||le.y)&&ve.translate(-1*le.x,-1*le.y),ge.forEach(function(se){if(!se.isVisible())return;const ye=se._toKonvaCanvas(le);ve.drawImage(ye._canvas,le.x,le.y,ye.getWidth()/ye.getPixelRatio(),ye.getHeight()/ye.getPixelRatio())}),fe}getIntersection(le){if(!le)return null;let fe=this.children,ve=fe.length,ge=ve-1,se;for(se=ge;se>=0;se--){const ye=fe[se].getIntersection(le);if(ye)return ye}return null}_resizeDOM(){const le=this.width(),fe=this.height();this.content&&(this.content.style.width=le+f,this.content.style.height=fe+f),this.bufferCanvas.setSize(le,fe),this.bufferHitCanvas.setSize(le,fe),this.children.forEach(ve=>{ve.setSize({width:le,height:fe}),ve.draw()})}add(le,...fe){if(arguments.length>1){for(let ge=0;ge<arguments.length;ge++)this.add(arguments[ge]);return this}super.add(le);const ve=this.children.length;return ve>Q&&e.Util.warn("The stage has "+ve+" layers. Recommended maximum number of layers is 3-5. Adding more layers into the stage may drop the performance. Rethink your tree structure, you can use Konva.Group."),le.setSize({width:this.width(),height:this.height()}),le.draw(),i.Konva.isBrowser&&this.content.appendChild(le.canvas._canvas),this}getParent(){return null}getLayer(){return null}hasPointerCapture(le){return l.hasPointerCapture(le,this)}setPointerCapture(le){l.setPointerCapture(le,this)}releaseCapture(le){l.releaseCapture(le,this)}getLayers(){return this.children}_bindContentEvents(){i.Konva.isBrowser&&ne.forEach(([le,fe])=>{this.content.addEventListener(le,ve=>{this[fe](ve)},{passive:!1})})}_pointerenter(le){this.setPointersPositions(le);const fe=J(le.type);fe&&this._fire(fe.pointerenter,{evt:le,target:this,currentTarget:this})}_pointerover(le){this.setPointersPositions(le);const fe=J(le.type);fe&&this._fire(fe.pointerover,{evt:le,target:this,currentTarget:this})}_getTargetShape(le){let fe=this[le+"targetShape"];return fe&&!fe.getStage()&&(fe=null),fe}_pointerleave(le){const fe=J(le.type),ve=Y(le.type);if(!fe)return;this.setPointersPositions(le);const ge=this._getTargetShape(ve),se=!(i.Konva.isDragging()||i.Konva.isTransforming())||i.Konva.hitOnDragEnabled;ge&&se?(ge._fireAndBubble(fe.pointerout,{evt:le}),ge._fireAndBubble(fe.pointerleave,{evt:le}),this._fire(fe.pointerleave,{evt:le,target:this,currentTarget:this}),this[ve+"targetShape"]=null):se&&(this._fire(fe.pointerleave,{evt:le,target:this,currentTarget:this}),this._fire(fe.pointerout,{evt:le,target:this,currentTarget:this})),this.pointerPos=null,this._pointerPositions=[]}_pointerdown(le){const fe=J(le.type),ve=Y(le.type);if(!fe)return;this.setPointersPositions(le);let ge=!1;this._changedPointerPositions.forEach(se=>{const ye=this.getIntersection(se);if(s.DD.justDragged=!1,i.Konva["_"+ve+"ListenClick"]=!0,!ye||!ye.isListening()){this[ve+"ClickStartShape"]=void 0;return}i.Konva.capturePointerEventsEnabled&&ye.setPointerCapture(se.id),this[ve+"ClickStartShape"]=ye,ye._fireAndBubble(fe.pointerdown,{evt:le,pointerId:se.id}),ge=!0;const Se=le.type.indexOf("touch")>=0;ye.preventDefault()&&le.cancelable&&Se&&le.preventDefault()}),ge||this._fire(fe.pointerdown,{evt:le,target:this,currentTarget:this,pointerId:this._pointerPositions[0].id})}_pointermove(le){const fe=J(le.type),ve=Y(le.type);if(!fe||(i.Konva.isDragging()&&s.DD.node.preventDefault()&&le.cancelable&&le.preventDefault(),this.setPointersPositions(le),!(!(i.Konva.isDragging()||i.Konva.isTransforming())||i.Konva.hitOnDragEnabled)))return;const se={};let ye=!1;const Se=this._getTargetShape(ve);this._changedPointerPositions.forEach(Ue=>{const Oe=l.getCapturedShape(Ue.id)||this.getIntersection(Ue),mt=Ue.id,lt={evt:le,pointerId:mt},at=Se!==Oe;if(at&&Se&&(Se._fireAndBubble(fe.pointerout,{...lt},Oe),Se._fireAndBubble(fe.pointerleave,{...lt},Oe)),Oe){if(se[Oe._id])return;se[Oe._id]=!0}Oe&&Oe.isListening()?(ye=!0,at&&(Oe._fireAndBubble(fe.pointerover,{...lt},Se),Oe._fireAndBubble(fe.pointerenter,{...lt},Se),this[ve+"targetShape"]=Oe),Oe._fireAndBubble(fe.pointermove,{...lt})):Se&&(this._fire(fe.pointerover,{evt:le,target:this,currentTarget:this,pointerId:mt}),this[ve+"targetShape"]=null)}),ye||this._fire(fe.pointermove,{evt:le,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id})}_pointerup(le){const fe=J(le.type),ve=Y(le.type);if(!fe)return;this.setPointersPositions(le);const ge=this[ve+"ClickStartShape"],se=this[ve+"ClickEndShape"],ye={};let Se=!1;this._changedPointerPositions.forEach(Ue=>{const Oe=l.getCapturedShape(Ue.id)||this.getIntersection(Ue);if(Oe){if(Oe.releaseCapture(Ue.id),ye[Oe._id])return;ye[Oe._id]=!0}const mt=Ue.id,lt={evt:le,pointerId:mt};let at=!1;i.Konva["_"+ve+"InDblClickWindow"]?(at=!0,clearTimeout(this[ve+"DblTimeout"])):s.DD.justDragged||(i.Konva["_"+ve+"InDblClickWindow"]=!0,clearTimeout(this[ve+"DblTimeout"])),this[ve+"DblTimeout"]=setTimeout(function(){i.Konva["_"+ve+"InDblClickWindow"]=!1},i.Konva.dblClickWindow),Oe&&Oe.isListening()?(Se=!0,this[ve+"ClickEndShape"]=Oe,Oe._fireAndBubble(fe.pointerup,{...lt}),i.Konva["_"+ve+"ListenClick"]&&ge&&ge===Oe&&(Oe._fireAndBubble(fe.pointerclick,{...lt}),at&&se&&se===Oe&&Oe._fireAndBubble(fe.pointerdblclick,{...lt}))):(this[ve+"ClickEndShape"]=null,i.Konva["_"+ve+"ListenClick"]&&this._fire(fe.pointerclick,{evt:le,target:this,currentTarget:this,pointerId:mt}),at&&this._fire(fe.pointerdblclick,{evt:le,target:this,currentTarget:this,pointerId:mt}))}),Se||this._fire(fe.pointerup,{evt:le,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id}),i.Konva["_"+ve+"ListenClick"]=!1,le.cancelable&&ve!=="touch"&&le.preventDefault()}_contextmenu(le){this.setPointersPositions(le);const fe=this.getIntersection(this.getPointerPosition());fe&&fe.isListening()?fe._fireAndBubble(K,{evt:le}):this._fire(K,{evt:le,target:this,currentTarget:this})}_wheel(le){this.setPointersPositions(le);const fe=this.getIntersection(this.getPointerPosition());fe&&fe.isListening()?fe._fireAndBubble(Z,{evt:le}):this._fire(Z,{evt:le,target:this,currentTarget:this})}_pointercancel(le){this.setPointersPositions(le);const fe=l.getCapturedShape(le.pointerId)||this.getIntersection(this.getPointerPosition());fe&&fe._fireAndBubble(R,l.createEvent(le)),l.releaseCapture(le.pointerId)}_lostpointercapture(le){l.releaseCapture(le.pointerId)}setPointersPositions(le){let fe=this._getContentPosition(),ve=null,ge=null;le=le||window.event,le.touches!==void 0?(this._pointerPositions=[],this._changedPointerPositions=[],Array.prototype.forEach.call(le.touches,se=>{this._pointerPositions.push({id:se.identifier,x:(se.clientX-fe.left)/fe.scaleX,y:(se.clientY-fe.top)/fe.scaleY})}),Array.prototype.forEach.call(le.changedTouches||le.touches,se=>{this._changedPointerPositions.push({id:se.identifier,x:(se.clientX-fe.left)/fe.scaleX,y:(se.clientY-fe.top)/fe.scaleY})})):(ve=(le.clientX-fe.left)/fe.scaleX,ge=(le.clientY-fe.top)/fe.scaleY,this.pointerPos={x:ve,y:ge},this._pointerPositions=[{x:ve,y:ge,id:e.Util._getFirstPointerId(le)}],this._changedPointerPositions=[{x:ve,y:ge,id:e.Util._getFirstPointerId(le)}])}_setPointerPosition(le){e.Util.warn('Method _setPointerPosition is deprecated. Use "stage.setPointersPositions(event)" instead.'),this.setPointersPositions(le)}_getContentPosition(){if(!this.content||!this.content.getBoundingClientRect)return{top:0,left:0,scaleX:1,scaleY:1};const le=this.content.getBoundingClientRect();return{top:le.top,left:le.left,scaleX:le.width/this.content.clientWidth||1,scaleY:le.height/this.content.clientHeight||1}}_buildDOM(){if(this.bufferCanvas=new a.SceneCanvas({width:this.width(),height:this.height()}),this.bufferHitCanvas=new a.HitCanvas({pixelRatio:1,width:this.width(),height:this.height()}),!i.Konva.isBrowser)return;const le=this.container();if(!le)throw"Stage has no container. A container is required.";le.innerHTML="",this.content=document.createElement("div"),this.content.style.position="relative",this.content.style.userSelect="none",this.content.className="konvajs-content",this.content.setAttribute("role","presentation"),le.appendChild(this.content),this._resizeDOM()}cache(){return e.Util.warn("Cache function is not allowed for stage. You may use cache only for layers, groups and shapes."),this}clearCache(){return this}batchDraw(){return this.getChildren().forEach(function(le){le.batchDraw()}),this}}t.Stage=he,he.prototype.nodeType=u,(0,o._registerNode)(he),r.Factory.addGetterSetter(he,"container"),i.Konva.isBrowser&&document.addEventListener("visibilitychange",()=>{t.stages.forEach(xe=>{xe.batchDraw()})})})(P2)),P2}var eg={},M2={},m5;function ba(){return m5||(m5=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Shape=t.shapes=void 0;const e=Tr(),r=pi(),n=Ar(),i=Ei(),a=Dr(),s=Tr(),o=xR(),l="hasShadow",u="shadowRGBA",c="patternImage",f="linearGradient",p="radialGradient";let v;function y(){return v||(v=r.Util.createCanvasElement().getContext("2d"),v)}t.shapes={};function S(j){const B=this.attrs.fillRule;B?j.fill(B):j.fill()}function w(j){j.stroke()}function E(j){const B=this.attrs.fillRule;B?j.fill(B):j.fill()}function _(j){j.stroke()}function T(){this._clearCache(l)}function N(){this._clearCache(u)}function R(){this._clearCache(c)}function I(){this._clearCache(f)}function F(){this._clearCache(p)}class D extends i.Node{constructor(B){super(B);let G;for(;G=r.Util.getRandomColor(),!(G&&!(G in t.shapes)););this.colorKey=G,t.shapes[G]=this}getContext(){return r.Util.warn("shape.getContext() method is deprecated. Please do not use it."),this.getLayer().getContext()}getCanvas(){return r.Util.warn("shape.getCanvas() method is deprecated. Please do not use it."),this.getLayer().getCanvas()}getSceneFunc(){return this.attrs.sceneFunc||this._sceneFunc}getHitFunc(){return this.attrs.hitFunc||this._hitFunc}hasShadow(){return this._getCache(l,this._hasShadow)}_hasShadow(){return this.shadowEnabled()&&this.shadowOpacity()!==0&&!!(this.shadowColor()||this.shadowBlur()||this.shadowOffsetX()||this.shadowOffsetY())}_getFillPattern(){return this._getCache(c,this.__getFillPattern)}__getFillPattern(){if(this.fillPatternImage()){const G=y().createPattern(this.fillPatternImage(),this.fillPatternRepeat()||"repeat");if(G&&G.setTransform){const K=new r.Transform;K.translate(this.fillPatternX(),this.fillPatternY()),K.rotate(e.Konva.getAngle(this.fillPatternRotation())),K.scale(this.fillPatternScaleX(),this.fillPatternScaleY()),K.translate(-1*this.fillPatternOffsetX(),-1*this.fillPatternOffsetY());const O=K.getMatrix(),W=typeof DOMMatrix>"u"?{a:O[0],b:O[1],c:O[2],d:O[3],e:O[4],f:O[5]}:new DOMMatrix(O);G.setTransform(W)}return G}}_getLinearGradient(){return this._getCache(f,this.__getLinearGradient)}__getLinearGradient(){const B=this.fillLinearGradientColorStops();if(B){const G=y(),K=this.fillLinearGradientStartPoint(),O=this.fillLinearGradientEndPoint(),W=G.createLinearGradient(K.x,K.y,O.x,O.y);for(let U=0;U<B.length;U+=2)W.addColorStop(B[U],B[U+1]);return W}}_getRadialGradient(){return this._getCache(p,this.__getRadialGradient)}__getRadialGradient(){const B=this.fillRadialGradientColorStops();if(B){const G=y(),K=this.fillRadialGradientStartPoint(),O=this.fillRadialGradientEndPoint(),W=G.createRadialGradient(K.x,K.y,this.fillRadialGradientStartRadius(),O.x,O.y,this.fillRadialGradientEndRadius());for(let U=0;U<B.length;U+=2)W.addColorStop(B[U],B[U+1]);return W}}getShadowRGBA(){return this._getCache(u,this._getShadowRGBA)}_getShadowRGBA(){if(!this.hasShadow())return;const B=r.Util.colorToRGBA(this.shadowColor());if(B)return"rgba("+B.r+","+B.g+","+B.b+","+B.a*(this.shadowOpacity()||1)+")"}hasFill(){return this._calculate("hasFill",["fillEnabled","fill","fillPatternImage","fillLinearGradientColorStops","fillRadialGradientColorStops"],()=>this.fillEnabled()&&!!(this.fill()||this.fillPatternImage()||this.fillLinearGradientColorStops()||this.fillRadialGradientColorStops()))}hasStroke(){return this._calculate("hasStroke",["strokeEnabled","strokeWidth","stroke","strokeLinearGradientColorStops"],()=>this.strokeEnabled()&&this.strokeWidth()&&!!(this.stroke()||this.strokeLinearGradientColorStops()))}hasHitStroke(){const B=this.hitStrokeWidth();return B==="auto"?this.hasStroke():this.strokeEnabled()&&!!B}intersects(B){const G=this.getStage();if(!G)return!1;const K=G.bufferHitCanvas;return K.getContext().clear(),this.drawHit(K,void 0,!0),K.context.getImageData(Math.round(B.x),Math.round(B.y),1,1).data[3]>0}destroy(){return i.Node.prototype.destroy.call(this),delete t.shapes[this.colorKey],delete this.colorKey,this}_useBufferCanvas(B){var G;if(!((G=this.attrs.perfectDrawEnabled)!==null&&G!==void 0?G:!0))return!1;const O=B||this.hasFill(),W=this.hasStroke(),U=this.getAbsoluteOpacity()!==1;if(O&&W&&U)return!0;const q=this.hasShadow(),Z=this.shadowForStrokeEnabled();return!!(O&&W&&q&&Z)}setStrokeHitEnabled(B){r.Util.warn("strokeHitEnabled property is deprecated. Please use hitStrokeWidth instead."),B?this.hitStrokeWidth("auto"):this.hitStrokeWidth(0)}getStrokeHitEnabled(){return this.hitStrokeWidth()!==0}getSelfRect(){const B=this.size();return{x:this._centroid?-B.width/2:0,y:this._centroid?-B.height/2:0,width:B.width,height:B.height}}getClientRect(B={}){let G=!1,K=this.getParent();for(;K;){if(K.isCached()){G=!0;break}K=K.getParent()}const O=B.skipTransform,W=B.relativeTo||G&&this.getStage()||void 0,U=this.getSelfRect(),Z=!B.skipStroke&&this.hasStroke()&&this.strokeWidth()||0,Q=U.width+Z,ne=U.height+Z,re=!B.skipShadow&&this.hasShadow(),Y=re?this.shadowOffsetX():0,J=re?this.shadowOffsetY():0,ie=Q+Math.abs(Y),de=ne+Math.abs(J),he=re&&this.shadowBlur()||0,xe=ie+he*2,le=de+he*2,fe={width:xe,height:le,x:-(Z/2+he)+Math.min(Y,0)+U.x,y:-(Z/2+he)+Math.min(J,0)+U.y};return O?fe:this._transformedRect(fe,W)}drawScene(B,G,K){const O=this.getLayer();let W=B||O.getCanvas(),U=W.getContext(),q=this._getCanvasCache(),Z=this.getSceneFunc(),Q=this.hasShadow(),ne,re;const Y=W.isCache,J=G===this;if(!this.isVisible()&&!J)return this;if(q){U.save();const de=this.getAbsoluteTransform(G).getMatrix();return U.transform(de[0],de[1],de[2],de[3],de[4],de[5]),this._drawCachedSceneCanvas(U),U.restore(),this}if(!Z)return this;if(U.save(),this._useBufferCanvas()&&!Y){ne=this.getStage();const de=K||ne.bufferCanvas;re=de.getContext(),re.clear(),re.save(),re._applyLineJoin(this);var ie=this.getAbsoluteTransform(G).getMatrix();re.transform(ie[0],ie[1],ie[2],ie[3],ie[4],ie[5]),Z.call(this,re,this),re.restore();const he=de.pixelRatio;Q&&U._applyShadow(this),U._applyOpacity(this),U._applyGlobalCompositeOperation(this),U.drawImage(de._canvas,0,0,de.width/he,de.height/he)}else{if(U._applyLineJoin(this),!J){var ie=this.getAbsoluteTransform(G).getMatrix();U.transform(ie[0],ie[1],ie[2],ie[3],ie[4],ie[5]),U._applyOpacity(this),U._applyGlobalCompositeOperation(this)}Q&&U._applyShadow(this),Z.call(this,U,this)}return U.restore(),this}drawHit(B,G,K=!1){if(!this.shouldDrawHit(G,K))return this;const O=this.getLayer(),W=B||O.hitCanvas,U=W&&W.getContext(),q=this.hitFunc()||this.sceneFunc(),Z=this._getCanvasCache(),Q=Z&&Z.hit;if(this.colorKey||r.Util.warn("Looks like your canvas has a destroyed shape in it. Do not reuse shape after you destroyed it. If you want to reuse shape you should call remove() instead of destroy()"),Q){U.save();const re=this.getAbsoluteTransform(G).getMatrix();return U.transform(re[0],re[1],re[2],re[3],re[4],re[5]),this._drawCachedHitCanvas(U),U.restore(),this}if(!q)return this;if(U.save(),U._applyLineJoin(this),!(this===G)){const re=this.getAbsoluteTransform(G).getMatrix();U.transform(re[0],re[1],re[2],re[3],re[4],re[5])}return q.call(this,U,this),U.restore(),this}drawHitFromCache(B=0){let G=this._getCanvasCache(),K=this._getCachedSceneCanvas(),O=G.hit,W=O.getContext(),U=O.getWidth(),q=O.getHeight(),Z,Q,ne,re,Y,J;W.clear(),W.drawImage(K._canvas,0,0,U,q);try{for(Z=W.getImageData(0,0,U,q),Q=Z.data,ne=Q.length,re=r.Util._hexToRgb(this.colorKey),Y=0;Y<ne;Y+=4)J=Q[Y+3],J>B?(Q[Y]=re.r,Q[Y+1]=re.g,Q[Y+2]=re.b,Q[Y+3]=255):Q[Y+3]=0;W.putImageData(Z,0,0)}catch(ie){r.Util.error("Unable to draw hit graph from cached scene canvas. "+ie.message)}return this}hasPointerCapture(B){return o.hasPointerCapture(B,this)}setPointerCapture(B){o.setPointerCapture(B,this)}releaseCapture(B){o.releaseCapture(B,this)}}t.Shape=D,D.prototype._fillFunc=S,D.prototype._strokeFunc=w,D.prototype._fillFuncHit=E,D.prototype._strokeFuncHit=_,D.prototype._centroid=!1,D.prototype.nodeType="Shape",(0,s._registerNode)(D),D.prototype.eventListeners={},D.prototype.on.call(D.prototype,"shadowColorChange.konva shadowBlurChange.konva shadowOffsetChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",T),D.prototype.on.call(D.prototype,"shadowColorChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",N),D.prototype.on.call(D.prototype,"fillPriorityChange.konva fillPatternImageChange.konva fillPatternRepeatChange.konva fillPatternScaleXChange.konva fillPatternScaleYChange.konva fillPatternOffsetXChange.konva fillPatternOffsetYChange.konva fillPatternXChange.konva fillPatternYChange.konva fillPatternRotationChange.konva",R),D.prototype.on.call(D.prototype,"fillPriorityChange.konva fillLinearGradientColorStopsChange.konva fillLinearGradientStartPointXChange.konva fillLinearGradientStartPointYChange.konva fillLinearGradientEndPointXChange.konva fillLinearGradientEndPointYChange.konva",I),D.prototype.on.call(D.prototype,"fillPriorityChange.konva fillRadialGradientColorStopsChange.konva fillRadialGradientStartPointXChange.konva fillRadialGradientStartPointYChange.konva fillRadialGradientEndPointXChange.konva fillRadialGradientEndPointYChange.konva fillRadialGradientStartRadiusChange.konva fillRadialGradientEndRadiusChange.konva",F),n.Factory.addGetterSetter(D,"stroke",void 0,(0,a.getStringOrGradientValidator)()),n.Factory.addGetterSetter(D,"strokeWidth",2,(0,a.getNumberValidator)()),n.Factory.addGetterSetter(D,"fillAfterStrokeEnabled",!1),n.Factory.addGetterSetter(D,"hitStrokeWidth","auto",(0,a.getNumberOrAutoValidator)()),n.Factory.addGetterSetter(D,"strokeHitEnabled",!0,(0,a.getBooleanValidator)()),n.Factory.addGetterSetter(D,"perfectDrawEnabled",!0,(0,a.getBooleanValidator)()),n.Factory.addGetterSetter(D,"shadowForStrokeEnabled",!0,(0,a.getBooleanValidator)()),n.Factory.addGetterSetter(D,"lineJoin"),n.Factory.addGetterSetter(D,"lineCap"),n.Factory.addGetterSetter(D,"sceneFunc"),n.Factory.addGetterSetter(D,"hitFunc"),n.Factory.addGetterSetter(D,"dash"),n.Factory.addGetterSetter(D,"dashOffset",0,(0,a.getNumberValidator)()),n.Factory.addGetterSetter(D,"shadowColor",void 0,(0,a.getStringValidator)()),n.Factory.addGetterSetter(D,"shadowBlur",0,(0,a.getNumberValidator)()),n.Factory.addGetterSetter(D,"shadowOpacity",1,(0,a.getNumberValidator)()),n.Factory.addComponentsGetterSetter(D,"shadowOffset",["x","y"]),n.Factory.addGetterSetter(D,"shadowOffsetX",0,(0,a.getNumberValidator)()),n.Factory.addGetterSetter(D,"shadowOffsetY",0,(0,a.getNumberValidator)()),n.Factory.addGetterSetter(D,"fillPatternImage"),n.Factory.addGetterSetter(D,"fill",void 0,(0,a.getStringOrGradientValidator)()),n.Factory.addGetterSetter(D,"fillPatternX",0,(0,a.getNumberValidator)()),n.Factory.addGetterSetter(D,"fillPatternY",0,(0,a.getNumberValidator)()),n.Factory.addGetterSetter(D,"fillLinearGradientColorStops"),n.Factory.addGetterSetter(D,"strokeLinearGradientColorStops"),n.Factory.addGetterSetter(D,"fillRadialGradientStartRadius",0),n.Factory.addGetterSetter(D,"fillRadialGradientEndRadius",0),n.Factory.addGetterSetter(D,"fillRadialGradientColorStops"),n.Factory.addGetterSetter(D,"fillPatternRepeat","repeat"),n.Factory.addGetterSetter(D,"fillEnabled",!0),n.Factory.addGetterSetter(D,"strokeEnabled",!0),n.Factory.addGetterSetter(D,"shadowEnabled",!0),n.Factory.addGetterSetter(D,"dashEnabled",!0),n.Factory.addGetterSetter(D,"strokeScaleEnabled",!0),n.Factory.addGetterSetter(D,"fillPriority","color"),n.Factory.addComponentsGetterSetter(D,"fillPatternOffset",["x","y"]),n.Factory.addGetterSetter(D,"fillPatternOffsetX",0,(0,a.getNumberValidator)()),n.Factory.addGetterSetter(D,"fillPatternOffsetY",0,(0,a.getNumberValidator)()),n.Factory.addComponentsGetterSetter(D,"fillPatternScale",["x","y"]),n.Factory.addGetterSetter(D,"fillPatternScaleX",1,(0,a.getNumberValidator)()),n.Factory.addGetterSetter(D,"fillPatternScaleY",1,(0,a.getNumberValidator)()),n.Factory.addComponentsGetterSetter(D,"fillLinearGradientStartPoint",["x","y"]),n.Factory.addComponentsGetterSetter(D,"strokeLinearGradientStartPoint",["x","y"]),n.Factory.addGetterSetter(D,"fillLinearGradientStartPointX",0),n.Factory.addGetterSetter(D,"strokeLinearGradientStartPointX",0),n.Factory.addGetterSetter(D,"fillLinearGradientStartPointY",0),n.Factory.addGetterSetter(D,"strokeLinearGradientStartPointY",0),n.Factory.addComponentsGetterSetter(D,"fillLinearGradientEndPoint",["x","y"]),n.Factory.addComponentsGetterSetter(D,"strokeLinearGradientEndPoint",["x","y"]),n.Factory.addGetterSetter(D,"fillLinearGradientEndPointX",0),n.Factory.addGetterSetter(D,"strokeLinearGradientEndPointX",0),n.Factory.addGetterSetter(D,"fillLinearGradientEndPointY",0),n.Factory.addGetterSetter(D,"strokeLinearGradientEndPointY",0),n.Factory.addComponentsGetterSetter(D,"fillRadialGradientStartPoint",["x","y"]),n.Factory.addGetterSetter(D,"fillRadialGradientStartPointX",0),n.Factory.addGetterSetter(D,"fillRadialGradientStartPointY",0),n.Factory.addComponentsGetterSetter(D,"fillRadialGradientEndPoint",["x","y"]),n.Factory.addGetterSetter(D,"fillRadialGradientEndPointX",0),n.Factory.addGetterSetter(D,"fillRadialGradientEndPointY",0),n.Factory.addGetterSetter(D,"fillPatternRotation",0),n.Factory.addGetterSetter(D,"fillRule",void 0,(0,a.getStringValidator)()),n.Factory.backCompat(D,{dashArray:"dash",getDashArray:"getDash",setDashArray:"getDash",drawFunc:"sceneFunc",getDrawFunc:"getSceneFunc",setDrawFunc:"setSceneFunc",drawHitFunc:"hitFunc",getDrawHitFunc:"getHitFunc",setDrawHitFunc:"setHitFunc"})})(M2)),M2}var g5;function bR(){if(g5)return eg;g5=1,Object.defineProperty(eg,"__esModule",{value:!0}),eg.Layer=void 0;const t=pi(),e=z1(),r=Ei(),n=Ar(),i=B1(),a=Dr(),s=ba(),o=Tr(),l="#",u="beforeDraw",c="draw",f=[{x:0,y:0},{x:-1,y:-1},{x:1,y:-1},{x:1,y:1},{x:-1,y:1}],p=f.length;class v extends e.Container{constructor(S){super(S),this.canvas=new i.SceneCanvas,this.hitCanvas=new i.HitCanvas({pixelRatio:1}),this._waitingForDraw=!1,this.on("visibleChange.konva",this._checkVisibility),this._checkVisibility(),this.on("imageSmoothingEnabledChange.konva",this._setSmoothEnabled),this._setSmoothEnabled()}createPNGStream(){return this.canvas._canvas.createPNGStream()}getCanvas(){return this.canvas}getNativeCanvasElement(){return this.canvas._canvas}getHitCanvas(){return this.hitCanvas}getContext(){return this.getCanvas().getContext()}clear(S){return this.getContext().clear(S),this.getHitCanvas().getContext().clear(S),this}setZIndex(S){super.setZIndex(S);const w=this.getStage();return w&&w.content&&(w.content.removeChild(this.getNativeCanvasElement()),S<w.children.length-1?w.content.insertBefore(this.getNativeCanvasElement(),w.children[S+1].getCanvas()._canvas):w.content.appendChild(this.getNativeCanvasElement())),this}moveToTop(){r.Node.prototype.moveToTop.call(this);const S=this.getStage();return S&&S.content&&(S.content.removeChild(this.getNativeCanvasElement()),S.content.appendChild(this.getNativeCanvasElement())),!0}moveUp(){if(!r.Node.prototype.moveUp.call(this))return!1;const w=this.getStage();return!w||!w.content?!1:(w.content.removeChild(this.getNativeCanvasElement()),this.index<w.children.length-1?w.content.insertBefore(this.getNativeCanvasElement(),w.children[this.index+1].getCanvas()._canvas):w.content.appendChild(this.getNativeCanvasElement()),!0)}moveDown(){if(r.Node.prototype.moveDown.call(this)){const S=this.getStage();if(S){const w=S.children;S.content&&(S.content.removeChild(this.getNativeCanvasElement()),S.content.insertBefore(this.getNativeCanvasElement(),w[this.index+1].getCanvas()._canvas))}return!0}return!1}moveToBottom(){if(r.Node.prototype.moveToBottom.call(this)){const S=this.getStage();if(S){const w=S.children;S.content&&(S.content.removeChild(this.getNativeCanvasElement()),S.content.insertBefore(this.getNativeCanvasElement(),w[1].getCanvas()._canvas))}return!0}return!1}getLayer(){return this}remove(){const S=this.getNativeCanvasElement();return r.Node.prototype.remove.call(this),S&&S.parentNode&&t.Util._isInDocument(S)&&S.parentNode.removeChild(S),this}getStage(){return this.parent}setSize({width:S,height:w}){return this.canvas.setSize(S,w),this.hitCanvas.setSize(S,w),this._setSmoothEnabled(),this}_validateAdd(S){const w=S.getType();w!=="Group"&&w!=="Shape"&&t.Util.throw("You may only add groups and shapes to a layer.")}_toKonvaCanvas(S){return S=S||{},S.width=S.width||this.getWidth(),S.height=S.height||this.getHeight(),S.x=S.x!==void 0?S.x:this.x(),S.y=S.y!==void 0?S.y:this.y(),r.Node.prototype._toKonvaCanvas.call(this,S)}_checkVisibility(){this.visible()?this.canvas._canvas.style.display="block":this.canvas._canvas.style.display="none"}_setSmoothEnabled(){this.getContext()._context.imageSmoothingEnabled=this.imageSmoothingEnabled()}getWidth(){if(this.parent)return this.parent.width()}setWidth(){t.Util.warn('Can not change width of layer. Use "stage.width(value)" function instead.')}getHeight(){if(this.parent)return this.parent.height()}setHeight(){t.Util.warn('Can not change height of layer. Use "stage.height(value)" function instead.')}batchDraw(){return this._waitingForDraw||(this._waitingForDraw=!0,t.Util.requestAnimFrame(()=>{this.draw(),this._waitingForDraw=!1})),this}getIntersection(S){if(!this.isListening()||!this.isVisible())return null;let w=1,E=!1;for(;;){for(let _=0;_<p;_++){const T=f[_],N=this._getIntersection({x:S.x+T.x*w,y:S.y+T.y*w}),R=N.shape;if(R)return R;if(E=!!N.antialiased,!N.antialiased)break}if(E)w+=1;else return null}}_getIntersection(S){const w=this.hitCanvas.pixelRatio,E=this.hitCanvas.context.getImageData(Math.round(S.x*w),Math.round(S.y*w),1,1).data,_=E[3];if(_===255){const T=t.Util._rgbToHex(E[0],E[1],E[2]),N=s.shapes[l+T];return N?{shape:N}:{antialiased:!0}}else if(_>0)return{antialiased:!0};return{}}drawScene(S,w){const E=this.getLayer(),_=S||E&&E.getCanvas();return this._fire(u,{node:this}),this.clearBeforeDraw()&&_.getContext().clear(),e.Container.prototype.drawScene.call(this,_,w),this._fire(c,{node:this}),this}drawHit(S,w){const E=this.getLayer(),_=S||E&&E.hitCanvas;return E&&E.clearBeforeDraw()&&E.getHitCanvas().getContext().clear(),e.Container.prototype.drawHit.call(this,_,w),this}enableHitGraph(){return this.hitGraphEnabled(!0),this}disableHitGraph(){return this.hitGraphEnabled(!1),this}setHitGraphEnabled(S){t.Util.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening(S)}getHitGraphEnabled(S){return t.Util.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening()}toggleHitCanvas(){if(!this.parent||!this.parent.content)return;const S=this.parent;!!this.hitCanvas._canvas.parentNode?S.content.removeChild(this.hitCanvas._canvas):S.content.appendChild(this.hitCanvas._canvas)}destroy(){return t.Util.releaseCanvas(this.getNativeCanvasElement(),this.getHitCanvas()._canvas),super.destroy()}}return eg.Layer=v,v.prototype.nodeType="Layer",(0,o._registerNode)(v),n.Factory.addGetterSetter(v,"imageSmoothingEnabled",!0),n.Factory.addGetterSetter(v,"clearBeforeDraw",!0),n.Factory.addGetterSetter(v,"hitGraphEnabled",!0,(0,a.getBooleanValidator)()),eg}var tg={},v5;function gG(){if(v5)return tg;v5=1,Object.defineProperty(tg,"__esModule",{value:!0}),tg.FastLayer=void 0;const t=pi(),e=bR(),r=Tr();let n=class extends e.Layer{constructor(a){super(a),this.listening(!1),t.Util.warn('Konva.Fast layer is deprecated. Please use "new Konva.Layer({ listening: false })" instead.')}};return tg.FastLayer=n,n.prototype.nodeType="FastLayer",(0,r._registerNode)(n),tg}var rg={},y5;function w_(){if(y5)return rg;y5=1,Object.defineProperty(rg,"__esModule",{value:!0}),rg.Group=void 0;const t=pi(),e=z1(),r=Tr();let n=class extends e.Container{_validateAdd(a){const s=a.getType();s!=="Group"&&s!=="Shape"&&t.Util.throw("You may only add groups and shapes to groups.")}};return rg.Group=n,n.prototype.nodeType="Group",(0,r._registerNode)(n),rg}var ng={},x5;function S_(){if(x5)return ng;x5=1,Object.defineProperty(ng,"__esModule",{value:!0}),ng.Animation=void 0;const t=Tr(),e=pi(),r=(function(){return t.glob.performance&&t.glob.performance.now?function(){return t.glob.performance.now()}:function(){return new Date().getTime()}})();let n=class Ep{constructor(a,s){this.id=Ep.animIdCounter++,this.frame={time:0,timeDiff:0,lastTime:r(),frameRate:0},this.func=a,this.setLayers(s)}setLayers(a){let s=[];return a&&(s=Array.isArray(a)?a:[a]),this.layers=s,this}getLayers(){return this.layers}addLayer(a){const s=this.layers,o=s.length;for(let l=0;l<o;l++)if(s[l]._id===a._id)return!1;return this.layers.push(a),!0}isRunning(){const s=Ep.animations,o=s.length;for(let l=0;l<o;l++)if(s[l].id===this.id)return!0;return!1}start(){return this.stop(),this.frame.timeDiff=0,this.frame.lastTime=r(),Ep._addAnimation(this),this}stop(){return Ep._removeAnimation(this),this}_updateFrameObject(a){this.frame.timeDiff=a-this.frame.lastTime,this.frame.lastTime=a,this.frame.time+=this.frame.timeDiff,this.frame.frameRate=1e3/this.frame.timeDiff}static _addAnimation(a){this.animations.push(a),this._handleAnimation()}static _removeAnimation(a){const s=a.id,o=this.animations,l=o.length;for(let u=0;u<l;u++)if(o[u].id===s){this.animations.splice(u,1);break}}static _runFrames(){const a={},s=this.animations;for(let o=0;o<s.length;o++){const l=s[o],u=l.layers,c=l.func;l._updateFrameObject(r());const f=u.length;let p;if(c?p=c.call(l,l.frame)!==!1:p=!0,!!p)for(let v=0;v<f;v++){const y=u[v];y._id!==void 0&&(a[y._id]=y)}}for(const o in a)a.hasOwnProperty(o)&&a[o].batchDraw()}static _animationLoop(){const a=Ep;a.animations.length?(a._runFrames(),e.Util.requestAnimFrame(a._animationLoop)):a.animRunning=!1}static _handleAnimation(){this.animRunning||(this.animRunning=!0,e.Util.requestAnimFrame(this._animationLoop))}};return ng.Animation=n,n.animations=[],n.animIdCounter=0,n.animRunning=!1,ng}var A2={},b5;function vG(){return b5||(b5=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Easings=t.Tween=void 0;const e=pi(),r=S_(),n=Ei(),i=Tr();let a={node:1,duration:1,easing:1,onFinish:1,yoyo:1},s=1,o=2,l=3,u=0,c=["fill","stroke","shadowColor"];class f{constructor(y,S,w,E,_,T,N){this.prop=y,this.propFunc=S,this.begin=E,this._pos=E,this.duration=T,this._change=0,this.prevPos=0,this.yoyo=N,this._time=0,this._position=0,this._startTime=0,this._finish=0,this.func=w,this._change=_-this.begin,this.pause()}fire(y){const S=this[y];S&&S()}setTime(y){y>this.duration?this.yoyo?(this._time=this.duration,this.reverse()):this.finish():y<0?this.yoyo?(this._time=0,this.play()):this.reset():(this._time=y,this.update())}getTime(){return this._time}setPosition(y){this.prevPos=this._pos,this.propFunc(y),this._pos=y}getPosition(y){return y===void 0&&(y=this._time),this.func(y,this.begin,this._change,this.duration)}play(){this.state=o,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onPlay")}reverse(){this.state=l,this._time=this.duration-this._time,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onReverse")}seek(y){this.pause(),this._time=y,this.update(),this.fire("onSeek")}reset(){this.pause(),this._time=0,this.update(),this.fire("onReset")}finish(){this.pause(),this._time=this.duration,this.update(),this.fire("onFinish")}update(){this.setPosition(this.getPosition(this._time)),this.fire("onUpdate")}onEnterFrame(){const y=this.getTimer()-this._startTime;this.state===o?this.setTime(y):this.state===l&&this.setTime(this.duration-y)}pause(){this.state=s,this.fire("onPause")}getTimer(){return new Date().getTime()}}class p{constructor(y){let S=this,w=y.node,E=w._id,_,T=y.easing||t.Easings.Linear,N=!!y.yoyo,R;typeof y.duration>"u"?_=.3:y.duration===0?_=.001:_=y.duration,this.node=w,this._id=u++;const I=w.getLayer()||(w instanceof i.Konva.Stage?w.getLayers():null);I||e.Util.error("Tween constructor have `node` that is not in a layer. Please add node into layer first."),this.anim=new r.Animation(function(){S.tween.onEnterFrame()},I),this.tween=new f(R,function(F){S._tweenFunc(F)},T,0,1,_*1e3,N),this._addListeners(),p.attrs[E]||(p.attrs[E]={}),p.attrs[E][this._id]||(p.attrs[E][this._id]={}),p.tweens[E]||(p.tweens[E]={});for(R in y)a[R]===void 0&&this._addAttr(R,y[R]);this.reset(),this.onFinish=y.onFinish,this.onReset=y.onReset,this.onUpdate=y.onUpdate}_addAttr(y,S){let w=this.node,E=w._id,_,T,N,R,I,F,D,j;if(N=p.tweens[E][y],N&&delete p.attrs[E][N][y],_=w.getAttr(y),e.Util._isArray(S))if(T=[],I=Math.max(S.length,_.length),y==="points"&&S.length!==_.length&&(S.length>_.length?(D=_,_=e.Util._prepareArrayForTween(_,S,w.closed())):(F=S,S=e.Util._prepareArrayForTween(S,_,w.closed()))),y.indexOf("fill")===0)for(R=0;R<I;R++)if(R%2===0)T.push(S[R]-_[R]);else{const B=e.Util.colorToRGBA(_[R]);j=e.Util.colorToRGBA(S[R]),_[R]=B,T.push({r:j.r-B.r,g:j.g-B.g,b:j.b-B.b,a:j.a-B.a})}else for(R=0;R<I;R++)T.push(S[R]-_[R]);else c.indexOf(y)!==-1?(_=e.Util.colorToRGBA(_),j=e.Util.colorToRGBA(S),T={r:j.r-_.r,g:j.g-_.g,b:j.b-_.b,a:j.a-_.a}):T=S-_;p.attrs[E][this._id][y]={start:_,diff:T,end:S,trueEnd:F,trueStart:D},p.tweens[E][y]=this._id}_tweenFunc(y){let S=this.node,w=p.attrs[S._id][this._id],E,_,T,N,R,I,F,D;for(E in w){if(_=w[E],T=_.start,N=_.diff,D=_.end,e.Util._isArray(T))if(R=[],F=Math.max(T.length,D.length),E.indexOf("fill")===0)for(I=0;I<F;I++)I%2===0?R.push((T[I]||0)+N[I]*y):R.push("rgba("+Math.round(T[I].r+N[I].r*y)+","+Math.round(T[I].g+N[I].g*y)+","+Math.round(T[I].b+N[I].b*y)+","+(T[I].a+N[I].a*y)+")");else for(I=0;I<F;I++)R.push((T[I]||0)+N[I]*y);else c.indexOf(E)!==-1?R="rgba("+Math.round(T.r+N.r*y)+","+Math.round(T.g+N.g*y)+","+Math.round(T.b+N.b*y)+","+(T.a+N.a*y)+")":R=T+N*y;S.setAttr(E,R)}}_addListeners(){this.tween.onPlay=()=>{this.anim.start()},this.tween.onReverse=()=>{this.anim.start()},this.tween.onPause=()=>{this.anim.stop()},this.tween.onFinish=()=>{const y=this.node,S=p.attrs[y._id][this._id];S.points&&S.points.trueEnd&&y.setAttr("points",S.points.trueEnd),this.onFinish&&this.onFinish.call(this)},this.tween.onReset=()=>{const y=this.node,S=p.attrs[y._id][this._id];S.points&&S.points.trueStart&&y.points(S.points.trueStart),this.onReset&&this.onReset()},this.tween.onUpdate=()=>{this.onUpdate&&this.onUpdate.call(this)}}play(){return this.tween.play(),this}reverse(){return this.tween.reverse(),this}reset(){return this.tween.reset(),this}seek(y){return this.tween.seek(y*1e3),this}pause(){return this.tween.pause(),this}finish(){return this.tween.finish(),this}destroy(){let y=this.node._id,S=this._id,w=p.tweens[y],E;this.pause();for(E in w)delete p.tweens[y][E];delete p.attrs[y][S]}}t.Tween=p,p.attrs={},p.tweens={},n.Node.prototype.to=function(v){const y=v.onFinish;v.node=this,v.onFinish=function(){this.destroy(),y&&y()},new p(v).play()},t.Easings={BackEaseIn(v,y,S,w){return S*(v/=w)*v*((1.70158+1)*v-1.70158)+y},BackEaseOut(v,y,S,w){return S*((v=v/w-1)*v*((1.70158+1)*v+1.70158)+1)+y},BackEaseInOut(v,y,S,w){let E=1.70158;return(v/=w/2)<1?S/2*(v*v*(((E*=1.525)+1)*v-E))+y:S/2*((v-=2)*v*(((E*=1.525)+1)*v+E)+2)+y},ElasticEaseIn(v,y,S,w,E,_){let T=0;return v===0?y:(v/=w)===1?y+S:(_||(_=w*.3),!E||E<Math.abs(S)?(E=S,T=_/4):T=_/(2*Math.PI)*Math.asin(S/E),-(E*Math.pow(2,10*(v-=1))*Math.sin((v*w-T)*(2*Math.PI)/_))+y)},ElasticEaseOut(v,y,S,w,E,_){let T=0;return v===0?y:(v/=w)===1?y+S:(_||(_=w*.3),!E||E<Math.abs(S)?(E=S,T=_/4):T=_/(2*Math.PI)*Math.asin(S/E),E*Math.pow(2,-10*v)*Math.sin((v*w-T)*(2*Math.PI)/_)+S+y)},ElasticEaseInOut(v,y,S,w,E,_){let T=0;return v===0?y:(v/=w/2)===2?y+S:(_||(_=w*(.3*1.5)),!E||E<Math.abs(S)?(E=S,T=_/4):T=_/(2*Math.PI)*Math.asin(S/E),v<1?-.5*(E*Math.pow(2,10*(v-=1))*Math.sin((v*w-T)*(2*Math.PI)/_))+y:E*Math.pow(2,-10*(v-=1))*Math.sin((v*w-T)*(2*Math.PI)/_)*.5+S+y)},BounceEaseOut(v,y,S,w){return(v/=w)<1/2.75?S*(7.5625*v*v)+y:v<2/2.75?S*(7.5625*(v-=1.5/2.75)*v+.75)+y:v<2.5/2.75?S*(7.5625*(v-=2.25/2.75)*v+.9375)+y:S*(7.5625*(v-=2.625/2.75)*v+.984375)+y},BounceEaseIn(v,y,S,w){return S-t.Easings.BounceEaseOut(w-v,0,S,w)+y},BounceEaseInOut(v,y,S,w){return v<w/2?t.Easings.BounceEaseIn(v*2,0,S,w)*.5+y:t.Easings.BounceEaseOut(v*2-w,0,S,w)*.5+S*.5+y},EaseIn(v,y,S,w){return S*(v/=w)*v+y},EaseOut(v,y,S,w){return-S*(v/=w)*(v-2)+y},EaseInOut(v,y,S,w){return(v/=w/2)<1?S/2*v*v+y:-S/2*(--v*(v-2)-1)+y},StrongEaseIn(v,y,S,w){return S*(v/=w)*v*v*v*v+y},StrongEaseOut(v,y,S,w){return S*((v=v/w-1)*v*v*v*v+1)+y},StrongEaseInOut(v,y,S,w){return(v/=w/2)<1?S/2*v*v*v*v*v+y:S/2*((v-=2)*v*v*v*v+2)+y},Linear(v,y,S,w){return S*v/w+y}}})(A2)),A2}var w5;function JS(){return w5||(w5=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Konva=void 0;const e=Tr(),r=pi(),n=Ei(),i=z1(),a=mG(),s=bR(),o=gG(),l=w_(),u=b_(),c=ba(),f=S_(),p=vG(),v=yR(),y=B1();t.Konva=r.Util._assign(e.Konva,{Util:r.Util,Transform:r.Transform,Node:n.Node,Container:i.Container,Stage:a.Stage,stages:a.stages,Layer:s.Layer,FastLayer:o.FastLayer,Group:l.Group,DD:u.DD,Shape:c.Shape,shapes:c.shapes,Animation:f.Animation,Tween:p.Tween,Easings:p.Easings,Context:v.Context,Canvas:y.Canvas}),t.default=t.Konva})(_2)),_2}var ig={},S5;function yG(){if(S5)return ig;S5=1,Object.defineProperty(ig,"__esModule",{value:!0}),ig.Arc=void 0;const t=Ar(),e=ba(),r=Tr(),n=Dr(),i=Tr();let a=class extends e.Shape{_sceneFunc(o){const l=r.Konva.getAngle(this.angle()),u=this.clockwise();o.beginPath(),o.arc(0,0,this.outerRadius(),0,l,u),o.arc(0,0,this.innerRadius(),l,0,!u),o.closePath(),o.fillStrokeShape(this)}getWidth(){return this.outerRadius()*2}getHeight(){return this.outerRadius()*2}setWidth(o){this.outerRadius(o/2)}setHeight(o){this.outerRadius(o/2)}getSelfRect(){const o=this.innerRadius(),l=this.outerRadius(),u=this.clockwise(),c=r.Konva.getAngle(u?360-this.angle():this.angle()),f=Math.cos(Math.min(c,Math.PI)),p=1,v=Math.sin(Math.min(Math.max(Math.PI,c),3*Math.PI/2)),y=Math.sin(Math.min(c,Math.PI/2)),S=f*(f>0?o:l),w=p*l,E=v*(v>0?o:l),_=y*(y>0?l:o);return{x:S,y:u?-1*_:E,width:w-S,height:_-E}}};return ig.Arc=a,a.prototype._centroid=!0,a.prototype.className="Arc",a.prototype._attrsAffectingSize=["innerRadius","outerRadius"],(0,i._registerNode)(a),t.Factory.addGetterSetter(a,"innerRadius",0,(0,n.getNumberValidator)()),t.Factory.addGetterSetter(a,"outerRadius",0,(0,n.getNumberValidator)()),t.Factory.addGetterSetter(a,"angle",0,(0,n.getNumberValidator)()),t.Factory.addGetterSetter(a,"clockwise",!1,(0,n.getBooleanValidator)()),ig}var ag={},sg={},k5;function wR(){if(k5)return sg;k5=1,Object.defineProperty(sg,"__esModule",{value:!0}),sg.Line=void 0;const t=Ar(),e=Tr(),r=ba(),n=Dr();function i(o,l,u,c,f,p,v){const y=Math.sqrt(Math.pow(u-o,2)+Math.pow(c-l,2)),S=Math.sqrt(Math.pow(f-u,2)+Math.pow(p-c,2)),w=v*y/(y+S),E=v*S/(y+S),_=u-w*(f-o),T=c-w*(p-l),N=u+E*(f-o),R=c+E*(p-l);return[_,T,N,R]}function a(o,l){const u=o.length,c=[];for(let f=2;f<u-2;f+=2){const p=i(o[f-2],o[f-1],o[f],o[f+1],o[f+2],o[f+3],l);isNaN(p[0])||(c.push(p[0]),c.push(p[1]),c.push(o[f]),c.push(o[f+1]),c.push(p[2]),c.push(p[3]))}return c}class s extends r.Shape{constructor(l){super(l),this.on("pointsChange.konva tensionChange.konva closedChange.konva bezierChange.konva",function(){this._clearCache("tensionPoints")})}_sceneFunc(l){let u=this.points(),c=u.length,f=this.tension(),p=this.closed(),v=this.bezier(),y,S,w;if(c){if(l.beginPath(),l.moveTo(u[0],u[1]),f!==0&&c>4){for(y=this.getTensionPoints(),S=y.length,w=p?0:4,p||l.quadraticCurveTo(y[0],y[1],y[2],y[3]);w<S-2;)l.bezierCurveTo(y[w++],y[w++],y[w++],y[w++],y[w++],y[w++]);p||l.quadraticCurveTo(y[S-2],y[S-1],u[c-2],u[c-1])}else if(v)for(w=2;w<c;)l.bezierCurveTo(u[w++],u[w++],u[w++],u[w++],u[w++],u[w++]);else for(w=2;w<c;w+=2)l.lineTo(u[w],u[w+1]);p?(l.closePath(),l.fillStrokeShape(this)):l.strokeShape(this)}}getTensionPoints(){return this._getCache("tensionPoints",this._getTensionPoints)}_getTensionPoints(){return this.closed()?this._getTensionPointsClosed():a(this.points(),this.tension())}_getTensionPointsClosed(){const l=this.points(),u=l.length,c=this.tension(),f=i(l[u-2],l[u-1],l[0],l[1],l[2],l[3],c),p=i(l[u-4],l[u-3],l[u-2],l[u-1],l[0],l[1],c),v=a(l,c);return[f[2],f[3]].concat(v).concat([p[0],p[1],l[u-2],l[u-1],p[2],p[3],f[0],f[1],l[0],l[1]])}getWidth(){return this.getSelfRect().width}getHeight(){return this.getSelfRect().height}getSelfRect(){let l=this.points();if(l.length<4)return{x:l[0]||0,y:l[1]||0,width:0,height:0};this.tension()!==0?l=[l[0],l[1],...this._getTensionPoints(),l[l.length-2],l[l.length-1]]:l=this.points();let u=l[0],c=l[0],f=l[1],p=l[1],v,y;for(let S=0;S<l.length/2;S++)v=l[S*2],y=l[S*2+1],u=Math.min(u,v),c=Math.max(c,v),f=Math.min(f,y),p=Math.max(p,y);return{x:u,y:f,width:c-u,height:p-f}}}return sg.Line=s,s.prototype.className="Line",s.prototype._attrsAffectingSize=["points","bezier","tension"],(0,e._registerNode)(s),t.Factory.addGetterSetter(s,"closed",!1),t.Factory.addGetterSetter(s,"bezier",!1),t.Factory.addGetterSetter(s,"tension",0,(0,n.getNumberValidator)()),t.Factory.addGetterSetter(s,"points",[],(0,n.getNumberArrayValidator)()),sg}var og={},R2={},_5;function xG(){return _5||(_5=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.t2length=t.getQuadraticArcLength=t.getCubicArcLength=t.binomialCoefficients=t.cValues=t.tValues=void 0,t.tValues=[[],[],[-.5773502691896257,.5773502691896257],[0,-.7745966692414834,.7745966692414834],[-.33998104358485626,.33998104358485626,-.8611363115940526,.8611363115940526],[0,-.5384693101056831,.5384693101056831,-.906179845938664,.906179845938664],[.6612093864662645,-.6612093864662645,-.2386191860831969,.2386191860831969,-.932469514203152,.932469514203152],[0,.4058451513773972,-.4058451513773972,-.7415311855993945,.7415311855993945,-.9491079123427585,.9491079123427585],[-.1834346424956498,.1834346424956498,-.525532409916329,.525532409916329,-.7966664774136267,.7966664774136267,-.9602898564975363,.9602898564975363],[0,-.8360311073266358,.8360311073266358,-.9681602395076261,.9681602395076261,-.3242534234038089,.3242534234038089,-.6133714327005904,.6133714327005904],[-.14887433898163122,.14887433898163122,-.4333953941292472,.4333953941292472,-.6794095682990244,.6794095682990244,-.8650633666889845,.8650633666889845,-.9739065285171717,.9739065285171717],[0,-.26954315595234496,.26954315595234496,-.5190961292068118,.5190961292068118,-.7301520055740494,.7301520055740494,-.8870625997680953,.8870625997680953,-.978228658146057,.978228658146057],[-.1252334085114689,.1252334085114689,-.3678314989981802,.3678314989981802,-.5873179542866175,.5873179542866175,-.7699026741943047,.7699026741943047,-.9041172563704749,.9041172563704749,-.9815606342467192,.9815606342467192],[0,-.2304583159551348,.2304583159551348,-.44849275103644687,.44849275103644687,-.6423493394403402,.6423493394403402,-.8015780907333099,.8015780907333099,-.9175983992229779,.9175983992229779,-.9841830547185881,.9841830547185881],[-.10805494870734367,.10805494870734367,-.31911236892788974,.31911236892788974,-.5152486363581541,.5152486363581541,-.6872929048116855,.6872929048116855,-.827201315069765,.827201315069765,-.9284348836635735,.9284348836635735,-.9862838086968123,.9862838086968123],[0,-.20119409399743451,.20119409399743451,-.3941513470775634,.3941513470775634,-.5709721726085388,.5709721726085388,-.7244177313601701,.7244177313601701,-.8482065834104272,.8482065834104272,-.937273392400706,.937273392400706,-.9879925180204854,.9879925180204854],[-.09501250983763744,.09501250983763744,-.2816035507792589,.2816035507792589,-.45801677765722737,.45801677765722737,-.6178762444026438,.6178762444026438,-.755404408355003,.755404408355003,-.8656312023878318,.8656312023878318,-.9445750230732326,.9445750230732326,-.9894009349916499,.9894009349916499],[0,-.17848418149584785,.17848418149584785,-.3512317634538763,.3512317634538763,-.5126905370864769,.5126905370864769,-.6576711592166907,.6576711592166907,-.7815140038968014,.7815140038968014,-.8802391537269859,.8802391537269859,-.9506755217687678,.9506755217687678,-.9905754753144174,.9905754753144174],[-.0847750130417353,.0847750130417353,-.2518862256915055,.2518862256915055,-.41175116146284263,.41175116146284263,-.5597708310739475,.5597708310739475,-.6916870430603532,.6916870430603532,-.8037049589725231,.8037049589725231,-.8926024664975557,.8926024664975557,-.9558239495713977,.9558239495713977,-.9915651684209309,.9915651684209309],[0,-.16035864564022537,.16035864564022537,-.31656409996362983,.31656409996362983,-.46457074137596094,.46457074137596094,-.600545304661681,.600545304661681,-.7209661773352294,.7209661773352294,-.8227146565371428,.8227146565371428,-.9031559036148179,.9031559036148179,-.96020815213483,.96020815213483,-.9924068438435844,.9924068438435844],[-.07652652113349734,.07652652113349734,-.22778585114164507,.22778585114164507,-.37370608871541955,.37370608871541955,-.5108670019508271,.5108670019508271,-.636053680726515,.636053680726515,-.7463319064601508,.7463319064601508,-.8391169718222188,.8391169718222188,-.912234428251326,.912234428251326,-.9639719272779138,.9639719272779138,-.9931285991850949,.9931285991850949],[0,-.1455618541608951,.1455618541608951,-.2880213168024011,.2880213168024011,-.4243421202074388,.4243421202074388,-.5516188358872198,.5516188358872198,-.6671388041974123,.6671388041974123,-.7684399634756779,.7684399634756779,-.8533633645833173,.8533633645833173,-.9200993341504008,.9200993341504008,-.9672268385663063,.9672268385663063,-.9937521706203895,.9937521706203895],[-.06973927331972223,.06973927331972223,-.20786042668822127,.20786042668822127,-.34193582089208424,.34193582089208424,-.469355837986757,.469355837986757,-.5876404035069116,.5876404035069116,-.6944872631866827,.6944872631866827,-.7878168059792081,.7878168059792081,-.8658125777203002,.8658125777203002,-.926956772187174,.926956772187174,-.9700604978354287,.9700604978354287,-.9942945854823992,.9942945854823992],[0,-.1332568242984661,.1332568242984661,-.26413568097034495,.26413568097034495,-.3903010380302908,.3903010380302908,-.5095014778460075,.5095014778460075,-.6196098757636461,.6196098757636461,-.7186613631319502,.7186613631319502,-.8048884016188399,.8048884016188399,-.8767523582704416,.8767523582704416,-.9329710868260161,.9329710868260161,-.9725424712181152,.9725424712181152,-.9947693349975522,.9947693349975522],[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213]],t.cValues=[[],[],[1,1],[.8888888888888888,.5555555555555556,.5555555555555556],[.6521451548625461,.6521451548625461,.34785484513745385,.34785484513745385],[.5688888888888889,.47862867049936647,.47862867049936647,.23692688505618908,.23692688505618908],[.3607615730481386,.3607615730481386,.46791393457269104,.46791393457269104,.17132449237917036,.17132449237917036],[.4179591836734694,.3818300505051189,.3818300505051189,.27970539148927664,.27970539148927664,.1294849661688697,.1294849661688697],[.362683783378362,.362683783378362,.31370664587788727,.31370664587788727,.22238103445337448,.22238103445337448,.10122853629037626,.10122853629037626],[.3302393550012598,.1806481606948574,.1806481606948574,.08127438836157441,.08127438836157441,.31234707704000286,.31234707704000286,.26061069640293544,.26061069640293544],[.29552422471475287,.29552422471475287,.26926671930999635,.26926671930999635,.21908636251598204,.21908636251598204,.1494513491505806,.1494513491505806,.06667134430868814,.06667134430868814],[.2729250867779006,.26280454451024665,.26280454451024665,.23319376459199048,.23319376459199048,.18629021092773426,.18629021092773426,.1255803694649046,.1255803694649046,.05566856711617366,.05566856711617366],[.24914704581340277,.24914704581340277,.2334925365383548,.2334925365383548,.20316742672306592,.20316742672306592,.16007832854334622,.16007832854334622,.10693932599531843,.10693932599531843,.04717533638651183,.04717533638651183],[.2325515532308739,.22628318026289723,.22628318026289723,.2078160475368885,.2078160475368885,.17814598076194574,.17814598076194574,.13887351021978725,.13887351021978725,.09212149983772845,.09212149983772845,.04048400476531588,.04048400476531588],[.2152638534631578,.2152638534631578,.2051984637212956,.2051984637212956,.18553839747793782,.18553839747793782,.15720316715819355,.15720316715819355,.12151857068790319,.12151857068790319,.08015808715976021,.08015808715976021,.03511946033175186,.03511946033175186],[.2025782419255613,.19843148532711158,.19843148532711158,.1861610000155622,.1861610000155622,.16626920581699392,.16626920581699392,.13957067792615432,.13957067792615432,.10715922046717194,.10715922046717194,.07036604748810812,.07036604748810812,.03075324199611727,.03075324199611727],[.1894506104550685,.1894506104550685,.18260341504492358,.18260341504492358,.16915651939500254,.16915651939500254,.14959598881657674,.14959598881657674,.12462897125553388,.12462897125553388,.09515851168249279,.09515851168249279,.062253523938647894,.062253523938647894,.027152459411754096,.027152459411754096],[.17944647035620653,.17656270536699264,.17656270536699264,.16800410215645004,.16800410215645004,.15404576107681028,.15404576107681028,.13513636846852548,.13513636846852548,.11188384719340397,.11188384719340397,.08503614831717918,.08503614831717918,.0554595293739872,.0554595293739872,.02414830286854793,.02414830286854793],[.1691423829631436,.1691423829631436,.16427648374583273,.16427648374583273,.15468467512626524,.15468467512626524,.14064291467065065,.14064291467065065,.12255520671147846,.12255520671147846,.10094204410628717,.10094204410628717,.07642573025488905,.07642573025488905,.0497145488949698,.0497145488949698,.02161601352648331,.02161601352648331],[.1610544498487837,.15896884339395434,.15896884339395434,.15276604206585967,.15276604206585967,.1426067021736066,.1426067021736066,.12875396253933621,.12875396253933621,.11156664554733399,.11156664554733399,.09149002162245,.09149002162245,.06904454273764123,.06904454273764123,.0448142267656996,.0448142267656996,.019461788229726478,.019461788229726478],[.15275338713072584,.15275338713072584,.14917298647260374,.14917298647260374,.14209610931838204,.14209610931838204,.13168863844917664,.13168863844917664,.11819453196151841,.11819453196151841,.10193011981724044,.10193011981724044,.08327674157670475,.08327674157670475,.06267204833410907,.06267204833410907,.04060142980038694,.04060142980038694,.017614007139152118,.017614007139152118],[.14608113364969041,.14452440398997005,.14452440398997005,.13988739479107315,.13988739479107315,.13226893863333747,.13226893863333747,.12183141605372853,.12183141605372853,.10879729916714838,.10879729916714838,.09344442345603386,.09344442345603386,.0761001136283793,.0761001136283793,.057134425426857205,.057134425426857205,.036953789770852494,.036953789770852494,.016017228257774335,.016017228257774335],[.13925187285563198,.13925187285563198,.13654149834601517,.13654149834601517,.13117350478706238,.13117350478706238,.12325237681051242,.12325237681051242,.11293229608053922,.11293229608053922,.10041414444288096,.10041414444288096,.08594160621706773,.08594160621706773,.06979646842452049,.06979646842452049,.052293335152683286,.052293335152683286,.03377490158481415,.03377490158481415,.0146279952982722,.0146279952982722],[.13365457218610619,.1324620394046966,.1324620394046966,.12890572218808216,.12890572218808216,.12304908430672953,.12304908430672953,.11499664022241136,.11499664022241136,.10489209146454141,.10489209146454141,.09291576606003515,.09291576606003515,.07928141177671895,.07928141177671895,.06423242140852585,.06423242140852585,.04803767173108467,.04803767173108467,.030988005856979445,.030988005856979445,.013411859487141771,.013411859487141771],[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872]],t.binomialCoefficients=[[1],[1,1],[1,2,1],[1,3,3,1]];const e=(s,o,l)=>{let u,c;const p=l/2;u=0;for(let v=0;v<20;v++)c=p*t.tValues[20][v]+p,u+=t.cValues[20][v]*n(s,o,c);return p*u};t.getCubicArcLength=e;const r=(s,o,l)=>{l===void 0&&(l=1);const u=s[0]-2*s[1]+s[2],c=o[0]-2*o[1]+o[2],f=2*s[1]-2*s[0],p=2*o[1]-2*o[0],v=4*(u*u+c*c),y=4*(u*f+c*p),S=f*f+p*p;if(v===0)return l*Math.sqrt(Math.pow(s[2]-s[0],2)+Math.pow(o[2]-o[0],2));const w=y/(2*v),E=S/v,_=l+w,T=E-w*w,N=_*_+T>0?Math.sqrt(_*_+T):0,R=w*w+T>0?Math.sqrt(w*w+T):0,I=w+Math.sqrt(w*w+T)!==0?T*Math.log(Math.abs((_+N)/(w+R))):0;return Math.sqrt(v)/2*(_*N-w*R+I)};t.getQuadraticArcLength=r;function n(s,o,l){const u=i(1,l,s),c=i(1,l,o),f=u*u+c*c;return Math.sqrt(f)}const i=(s,o,l)=>{const u=l.length-1;let c,f;if(u===0)return 0;if(s===0){f=0;for(let p=0;p<=u;p++)f+=t.binomialCoefficients[u][p]*Math.pow(1-o,u-p)*Math.pow(o,p)*l[p];return f}else{c=new Array(u);for(let p=0;p<u;p++)c[p]=u*(l[p+1]-l[p]);return i(s-1,o,c)}},a=(s,o,l)=>{let u=1,c=s/o,f=(s-l(c))/o,p=0;for(;u>.001;){const v=l(c+f),y=Math.abs(s-v)/o;if(y<u)u=y,c+=f;else{const S=l(c-f),w=Math.abs(s-S)/o;w<u?(u=w,c-=f):f/=2}if(p++,p>500)break}return c};t.t2length=a})(R2)),R2}var C5;function k_(){if(C5)return og;C5=1,Object.defineProperty(og,"__esModule",{value:!0}),og.Path=void 0;const t=Ar(),e=ba(),r=Tr(),n=xG();class i extends e.Shape{constructor(s){super(s),this.dataArray=[],this.pathLength=0,this._readDataAttribute(),this.on("dataChange.konva",function(){this._readDataAttribute()})}_readDataAttribute(){this.dataArray=i.parsePathData(this.data()),this.pathLength=i.getPathLength(this.dataArray)}_sceneFunc(s){const o=this.dataArray;s.beginPath();let l=!1;for(let N=0;N<o.length;N++){const R=o[N].command,I=o[N].points;switch(R){case"L":s.lineTo(I[0],I[1]);break;case"M":s.moveTo(I[0],I[1]);break;case"C":s.bezierCurveTo(I[0],I[1],I[2],I[3],I[4],I[5]);break;case"Q":s.quadraticCurveTo(I[0],I[1],I[2],I[3]);break;case"A":var u=I[0],c=I[1],f=I[2],p=I[3],v=I[4],y=I[5],S=I[6],w=I[7],E=f>p?f:p,_=f>p?1:f/p,T=f>p?p/f:1;s.translate(u,c),s.rotate(S),s.scale(_,T),s.arc(0,0,E,v,v+y,1-w),s.scale(1/_,1/T),s.rotate(-S),s.translate(-u,-c);break;case"z":l=!0,s.closePath();break}}!l&&!this.hasFill()?s.strokeShape(this):s.fillStrokeShape(this)}getSelfRect(){let s=[];this.dataArray.forEach(function(v){if(v.command==="A"){const y=v.points[4],S=v.points[5],w=v.points[4]+S;let E=Math.PI/180;if(Math.abs(y-w)<E&&(E=Math.abs(y-w)),S<0)for(let _=y-E;_>w;_-=E){const T=i.getPointOnEllipticalArc(v.points[0],v.points[1],v.points[2],v.points[3],_,0);s.push(T.x,T.y)}else for(let _=y+E;_<w;_+=E){const T=i.getPointOnEllipticalArc(v.points[0],v.points[1],v.points[2],v.points[3],_,0);s.push(T.x,T.y)}}else if(v.command==="C")for(let y=0;y<=1;y+=.01){const S=i.getPointOnCubicBezier(y,v.start.x,v.start.y,v.points[0],v.points[1],v.points[2],v.points[3],v.points[4],v.points[5]);s.push(S.x,S.y)}else s=s.concat(v.points)});let o=s[0],l=s[0],u=s[1],c=s[1],f,p;for(let v=0;v<s.length/2;v++)f=s[v*2],p=s[v*2+1],isNaN(f)||(o=Math.min(o,f),l=Math.max(l,f)),isNaN(p)||(u=Math.min(u,p),c=Math.max(c,p));return{x:o,y:u,width:l-o,height:c-u}}getLength(){return this.pathLength}getPointAtLength(s){return i.getPointAtLengthOfDataArray(s,this.dataArray)}static getLineLength(s,o,l,u){return Math.sqrt((l-s)*(l-s)+(u-o)*(u-o))}static getPathLength(s){let o=0;for(let l=0;l<s.length;++l)o+=s[l].pathLength;return o}static getPointAtLengthOfDataArray(s,o){let l,u=0,c=o.length;if(!c)return null;for(;u<c&&s>o[u].pathLength;)s-=o[u].pathLength,++u;if(u===c)return l=o[u-1].points.slice(-2),{x:l[0],y:l[1]};if(s<.01)return l=o[u].points.slice(0,2),{x:l[0],y:l[1]};const f=o[u],p=f.points;switch(f.command){case"L":return i.getPointOnLine(s,f.start.x,f.start.y,p[0],p[1]);case"C":return i.getPointOnCubicBezier((0,n.t2length)(s,i.getPathLength(o),N=>(0,n.getCubicArcLength)([f.start.x,p[0],p[2],p[4]],[f.start.y,p[1],p[3],p[5]],N)),f.start.x,f.start.y,p[0],p[1],p[2],p[3],p[4],p[5]);case"Q":return i.getPointOnQuadraticBezier((0,n.t2length)(s,i.getPathLength(o),N=>(0,n.getQuadraticArcLength)([f.start.x,p[0],p[2]],[f.start.y,p[1],p[3]],N)),f.start.x,f.start.y,p[0],p[1],p[2],p[3]);case"A":var v=p[0],y=p[1],S=p[2],w=p[3],E=p[4],_=p[5],T=p[6];return E+=_*s/f.pathLength,i.getPointOnEllipticalArc(v,y,S,w,E,T)}return null}static getPointOnLine(s,o,l,u,c,f,p){f=f??o,p=p??l;const v=this.getLineLength(o,l,u,c);if(v<1e-10)return{x:o,y:l};if(u===o)return{x:f,y:p+(c>l?s:-s)};const y=(c-l)/(u-o),S=Math.sqrt(s*s/(1+y*y))*(u<o?-1:1),w=y*S;if(Math.abs(p-l-y*(f-o))<1e-10)return{x:f+S,y:p+w};const E=((f-o)*(u-o)+(p-l)*(c-l))/(v*v),_=o+E*(u-o),T=l+E*(c-l),N=this.getLineLength(f,p,_,T),R=Math.sqrt(s*s-N*N),I=Math.sqrt(R*R/(1+y*y))*(u<o?-1:1),F=y*I;return{x:_+I,y:T+F}}static getPointOnCubicBezier(s,o,l,u,c,f,p,v,y){function S(R){return R*R*R}function w(R){return 3*R*R*(1-R)}function E(R){return 3*R*(1-R)*(1-R)}function _(R){return(1-R)*(1-R)*(1-R)}const T=v*S(s)+f*w(s)+u*E(s)+o*_(s),N=y*S(s)+p*w(s)+c*E(s)+l*_(s);return{x:T,y:N}}static getPointOnQuadraticBezier(s,o,l,u,c,f,p){function v(_){return _*_}function y(_){return 2*_*(1-_)}function S(_){return(1-_)*(1-_)}const w=f*v(s)+u*y(s)+o*S(s),E=p*v(s)+c*y(s)+l*S(s);return{x:w,y:E}}static getPointOnEllipticalArc(s,o,l,u,c,f){const p=Math.cos(f),v=Math.sin(f),y={x:l*Math.cos(c),y:u*Math.sin(c)};return{x:s+(y.x*p-y.y*v),y:o+(y.x*v+y.y*p)}}static parsePathData(s){if(!s)return[];let o=s;const l=["m","M","l","L","v","V","h","H","z","Z","c","C","q","Q","t","T","s","S","a","A"];o=o.replace(new RegExp(" ","g"),",");for(var u=0;u<l.length;u++)o=o.replace(new RegExp(l[u],"g"),"|"+l[u]);const c=o.split("|"),f=[],p=[];let v=0,y=0;const S=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/gi;let w;for(u=1;u<c.length;u++){let O=c[u],W=O.charAt(0);for(O=O.slice(1),p.length=0;w=S.exec(O);)p.push(w[0]);const U=[];for(let q=0,Z=p.length;q<Z;q++){if(p[q]==="00"){U.push(0,0);continue}const Q=parseFloat(p[q]);isNaN(Q)?U.push(0):U.push(Q)}for(;U.length>0&&!isNaN(U[0]);){let q="",Z=[];const Q=v,ne=y;var E,_,T,N,R,I,F,D,j,B;switch(W){case"l":v+=U.shift(),y+=U.shift(),q="L",Z.push(v,y);break;case"L":v=U.shift(),y=U.shift(),Z.push(v,y);break;case"m":var G=U.shift(),K=U.shift();if(v+=G,y+=K,q="M",f.length>2&&f[f.length-1].command==="z"){for(let re=f.length-2;re>=0;re--)if(f[re].command==="M"){v=f[re].points[0]+G,y=f[re].points[1]+K;break}}Z.push(v,y),W="l";break;case"M":v=U.shift(),y=U.shift(),q="M",Z.push(v,y),W="L";break;case"h":v+=U.shift(),q="L",Z.push(v,y);break;case"H":v=U.shift(),q="L",Z.push(v,y);break;case"v":y+=U.shift(),q="L",Z.push(v,y);break;case"V":y=U.shift(),q="L",Z.push(v,y);break;case"C":Z.push(U.shift(),U.shift(),U.shift(),U.shift()),v=U.shift(),y=U.shift(),Z.push(v,y);break;case"c":Z.push(v+U.shift(),y+U.shift(),v+U.shift(),y+U.shift()),v+=U.shift(),y+=U.shift(),q="C",Z.push(v,y);break;case"S":_=v,T=y,E=f[f.length-1],E.command==="C"&&(_=v+(v-E.points[2]),T=y+(y-E.points[3])),Z.push(_,T,U.shift(),U.shift()),v=U.shift(),y=U.shift(),q="C",Z.push(v,y);break;case"s":_=v,T=y,E=f[f.length-1],E.command==="C"&&(_=v+(v-E.points[2]),T=y+(y-E.points[3])),Z.push(_,T,v+U.shift(),y+U.shift()),v+=U.shift(),y+=U.shift(),q="C",Z.push(v,y);break;case"Q":Z.push(U.shift(),U.shift()),v=U.shift(),y=U.shift(),Z.push(v,y);break;case"q":Z.push(v+U.shift(),y+U.shift()),v+=U.shift(),y+=U.shift(),q="Q",Z.push(v,y);break;case"T":_=v,T=y,E=f[f.length-1],E.command==="Q"&&(_=v+(v-E.points[0]),T=y+(y-E.points[1])),v=U.shift(),y=U.shift(),q="Q",Z.push(_,T,v,y);break;case"t":_=v,T=y,E=f[f.length-1],E.command==="Q"&&(_=v+(v-E.points[0]),T=y+(y-E.points[1])),v+=U.shift(),y+=U.shift(),q="Q",Z.push(_,T,v,y);break;case"A":N=U.shift(),R=U.shift(),I=U.shift(),F=U.shift(),D=U.shift(),j=v,B=y,v=U.shift(),y=U.shift(),q="A",Z=this.convertEndpointToCenterParameterization(j,B,v,y,F,D,N,R,I);break;case"a":N=U.shift(),R=U.shift(),I=U.shift(),F=U.shift(),D=U.shift(),j=v,B=y,v+=U.shift(),y+=U.shift(),q="A",Z=this.convertEndpointToCenterParameterization(j,B,v,y,F,D,N,R,I);break}f.push({command:q||W,points:Z,start:{x:Q,y:ne},pathLength:this.calcLength(Q,ne,q||W,Z)})}(W==="z"||W==="Z")&&f.push({command:"z",points:[],start:void 0,pathLength:0})}return f}static calcLength(s,o,l,u){let c,f,p,v;const y=i;switch(l){case"L":return y.getLineLength(s,o,u[0],u[1]);case"C":return(0,n.getCubicArcLength)([s,u[0],u[2],u[4]],[o,u[1],u[3],u[5]],1);case"Q":return(0,n.getQuadraticArcLength)([s,u[0],u[2]],[o,u[1],u[3]],1);case"A":c=0;var S=u[4],w=u[5],E=u[4]+w,_=Math.PI/180;if(Math.abs(S-E)<_&&(_=Math.abs(S-E)),f=y.getPointOnEllipticalArc(u[0],u[1],u[2],u[3],S,0),w<0)for(v=S-_;v>E;v-=_)p=y.getPointOnEllipticalArc(u[0],u[1],u[2],u[3],v,0),c+=y.getLineLength(f.x,f.y,p.x,p.y),f=p;else for(v=S+_;v<E;v+=_)p=y.getPointOnEllipticalArc(u[0],u[1],u[2],u[3],v,0),c+=y.getLineLength(f.x,f.y,p.x,p.y),f=p;return p=y.getPointOnEllipticalArc(u[0],u[1],u[2],u[3],E,0),c+=y.getLineLength(f.x,f.y,p.x,p.y),c}return 0}static convertEndpointToCenterParameterization(s,o,l,u,c,f,p,v,y){const S=y*(Math.PI/180),w=Math.cos(S)*(s-l)/2+Math.sin(S)*(o-u)/2,E=-1*Math.sin(S)*(s-l)/2+Math.cos(S)*(o-u)/2,_=w*w/(p*p)+E*E/(v*v);_>1&&(p*=Math.sqrt(_),v*=Math.sqrt(_));let T=Math.sqrt((p*p*(v*v)-p*p*(E*E)-v*v*(w*w))/(p*p*(E*E)+v*v*(w*w)));c===f&&(T*=-1),isNaN(T)&&(T=0);const N=T*p*E/v,R=T*-v*w/p,I=(s+l)/2+Math.cos(S)*N-Math.sin(S)*R,F=(o+u)/2+Math.sin(S)*N+Math.cos(S)*R,D=function(U){return Math.sqrt(U[0]*U[0]+U[1]*U[1])},j=function(U,q){return(U[0]*q[0]+U[1]*q[1])/(D(U)*D(q))},B=function(U,q){return(U[0]*q[1]<U[1]*q[0]?-1:1)*Math.acos(j(U,q))},G=B([1,0],[(w-N)/p,(E-R)/v]),K=[(w-N)/p,(E-R)/v],O=[(-1*w-N)/p,(-1*E-R)/v];let W=B(K,O);return j(K,O)<=-1&&(W=Math.PI),j(K,O)>=1&&(W=0),f===0&&W>0&&(W=W-2*Math.PI),f===1&&W<0&&(W=W+2*Math.PI),[I,F,p,v,G,W,S,f]}}return og.Path=i,i.prototype.className="Path",i.prototype._attrsAffectingSize=["data"],(0,r._registerNode)(i),t.Factory.addGetterSetter(i,"data"),og}var E5;function bG(){if(E5)return ag;E5=1,Object.defineProperty(ag,"__esModule",{value:!0}),ag.Arrow=void 0;const t=Ar(),e=wR(),r=Dr(),n=Tr(),i=k_();let a=class extends e.Line{_sceneFunc(o){super._sceneFunc(o);const l=Math.PI*2,u=this.points();let c=u;const f=this.tension()!==0&&u.length>4;f&&(c=this.getTensionPoints());const p=this.pointerLength(),v=u.length;let y,S;if(f){const _=[c[c.length-4],c[c.length-3],c[c.length-2],c[c.length-1],u[v-2],u[v-1]],T=i.Path.calcLength(c[c.length-4],c[c.length-3],"C",_),N=i.Path.getPointOnQuadraticBezier(Math.min(1,1-p/T),_[0],_[1],_[2],_[3],_[4],_[5]);y=u[v-2]-N.x,S=u[v-1]-N.y}else y=u[v-2]-u[v-4],S=u[v-1]-u[v-3];const w=(Math.atan2(S,y)+l)%l,E=this.pointerWidth();this.pointerAtEnding()&&(o.save(),o.beginPath(),o.translate(u[v-2],u[v-1]),o.rotate(w),o.moveTo(0,0),o.lineTo(-p,E/2),o.lineTo(-p,-E/2),o.closePath(),o.restore(),this.__fillStroke(o)),this.pointerAtBeginning()&&(o.save(),o.beginPath(),o.translate(u[0],u[1]),f?(y=(c[0]+c[2])/2-u[0],S=(c[1]+c[3])/2-u[1]):(y=u[2]-u[0],S=u[3]-u[1]),o.rotate((Math.atan2(-S,-y)+l)%l),o.moveTo(0,0),o.lineTo(-p,E/2),o.lineTo(-p,-E/2),o.closePath(),o.restore(),this.__fillStroke(o))}__fillStroke(o){const l=this.dashEnabled();l&&(this.attrs.dashEnabled=!1,o.setLineDash([])),o.fillStrokeShape(this),l&&(this.attrs.dashEnabled=!0)}getSelfRect(){const o=super.getSelfRect(),l=this.pointerWidth()/2;return{x:o.x-l,y:o.y-l,width:o.width+l*2,height:o.height+l*2}}};return ag.Arrow=a,a.prototype.className="Arrow",(0,n._registerNode)(a),t.Factory.addGetterSetter(a,"pointerLength",10,(0,r.getNumberValidator)()),t.Factory.addGetterSetter(a,"pointerWidth",10,(0,r.getNumberValidator)()),t.Factory.addGetterSetter(a,"pointerAtBeginning",!1),t.Factory.addGetterSetter(a,"pointerAtEnding",!0),ag}var lg={},T5;function wG(){if(T5)return lg;T5=1,Object.defineProperty(lg,"__esModule",{value:!0}),lg.Circle=void 0;const t=Ar(),e=ba(),r=Dr(),n=Tr();class i extends e.Shape{_sceneFunc(s){s.beginPath(),s.arc(0,0,this.attrs.radius||0,0,Math.PI*2,!1),s.closePath(),s.fillStrokeShape(this)}getWidth(){return this.radius()*2}getHeight(){return this.radius()*2}setWidth(s){this.radius()!==s/2&&this.radius(s/2)}setHeight(s){this.radius()!==s/2&&this.radius(s/2)}}return lg.Circle=i,i.prototype._centroid=!0,i.prototype.className="Circle",i.prototype._attrsAffectingSize=["radius"],(0,n._registerNode)(i),t.Factory.addGetterSetter(i,"radius",0,(0,r.getNumberValidator)()),lg}var ug={},N5;function SG(){if(N5)return ug;N5=1,Object.defineProperty(ug,"__esModule",{value:!0}),ug.Ellipse=void 0;const t=Ar(),e=ba(),r=Dr(),n=Tr();let i=class extends e.Shape{_sceneFunc(s){const o=this.radiusX(),l=this.radiusY();s.beginPath(),s.save(),o!==l&&s.scale(1,l/o),s.arc(0,0,o,0,Math.PI*2,!1),s.restore(),s.closePath(),s.fillStrokeShape(this)}getWidth(){return this.radiusX()*2}getHeight(){return this.radiusY()*2}setWidth(s){this.radiusX(s/2)}setHeight(s){this.radiusY(s/2)}};return ug.Ellipse=i,i.prototype.className="Ellipse",i.prototype._centroid=!0,i.prototype._attrsAffectingSize=["radiusX","radiusY"],(0,n._registerNode)(i),t.Factory.addComponentsGetterSetter(i,"radius",["x","y"]),t.Factory.addGetterSetter(i,"radiusX",0,(0,r.getNumberValidator)()),t.Factory.addGetterSetter(i,"radiusY",0,(0,r.getNumberValidator)()),ug}var cg={},P5;function kG(){if(P5)return cg;P5=1,Object.defineProperty(cg,"__esModule",{value:!0}),cg.Image=void 0;const t=pi(),e=Ar(),r=ba(),n=Tr(),i=Dr();class a extends r.Shape{constructor(o){super(o),this.on("imageChange.konva",()=>{this._setImageLoad()}),this._setImageLoad()}_setImageLoad(){const o=this.image();o&&o.complete||o&&o.readyState===4||o&&o.addEventListener&&o.addEventListener("load",()=>{this._requestDraw()})}_useBufferCanvas(){const o=!!this.cornerRadius(),l=this.hasShadow();return o&&l?!0:super._useBufferCanvas(!0)}_sceneFunc(o){const l=this.getWidth(),u=this.getHeight(),c=this.cornerRadius(),f=this.attrs.image;let p;if(f){const v=this.attrs.cropWidth,y=this.attrs.cropHeight;v&&y?p=[f,this.cropX(),this.cropY(),v,y,0,0,l,u]:p=[f,0,0,l,u]}(this.hasFill()||this.hasStroke()||c)&&(o.beginPath(),c?t.Util.drawRoundedRectPath(o,l,u,c):o.rect(0,0,l,u),o.closePath(),o.fillStrokeShape(this)),f&&(c&&o.clip(),o.drawImage.apply(o,p))}_hitFunc(o){const l=this.width(),u=this.height(),c=this.cornerRadius();o.beginPath(),c?t.Util.drawRoundedRectPath(o,l,u,c):o.rect(0,0,l,u),o.closePath(),o.fillStrokeShape(this)}getWidth(){var o,l;return(o=this.attrs.width)!==null&&o!==void 0?o:(l=this.image())===null||l===void 0?void 0:l.width}getHeight(){var o,l;return(o=this.attrs.height)!==null&&o!==void 0?o:(l=this.image())===null||l===void 0?void 0:l.height}static fromURL(o,l,u=null){const c=t.Util.createImageElement();c.onload=function(){const f=new a({image:c});l(f)},c.onerror=u,c.crossOrigin="Anonymous",c.src=o}}return cg.Image=a,a.prototype.className="Image",(0,n._registerNode)(a),e.Factory.addGetterSetter(a,"cornerRadius",0,(0,i.getNumberOrArrayOfNumbersValidator)(4)),e.Factory.addGetterSetter(a,"image"),e.Factory.addComponentsGetterSetter(a,"crop",["x","y","width","height"]),e.Factory.addGetterSetter(a,"cropX",0,(0,i.getNumberValidator)()),e.Factory.addGetterSetter(a,"cropY",0,(0,i.getNumberValidator)()),e.Factory.addGetterSetter(a,"cropWidth",0,(0,i.getNumberValidator)()),e.Factory.addGetterSetter(a,"cropHeight",0,(0,i.getNumberValidator)()),cg}var Wf={},M5;function _G(){if(M5)return Wf;M5=1,Object.defineProperty(Wf,"__esModule",{value:!0}),Wf.Tag=Wf.Label=void 0;const t=Ar(),e=ba(),r=w_(),n=Dr(),i=Tr(),a=["fontFamily","fontSize","fontStyle","padding","lineHeight","text","width","height","pointerDirection","pointerWidth","pointerHeight"],s="Change.konva",o="none",l="up",u="right",c="down",f="left",p=a.length;let v=class extends r.Group{constructor(w){super(w),this.on("add.konva",function(E){this._addListeners(E.child),this._sync()})}getText(){return this.find("Text")[0]}getTag(){return this.find("Tag")[0]}_addListeners(w){let E=this,_;const T=function(){E._sync()};for(_=0;_<p;_++)w.on(a[_]+s,T)}getWidth(){return this.getText().width()}getHeight(){return this.getText().height()}_sync(){let w=this.getText(),E=this.getTag(),_,T,N,R,I,F,D;if(w&&E){switch(_=w.width(),T=w.height(),N=E.pointerDirection(),R=E.pointerWidth(),D=E.pointerHeight(),I=0,F=0,N){case l:I=_/2,F=-1*D;break;case u:I=_+R,F=T/2;break;case c:I=_/2,F=T+D;break;case f:I=-1*R,F=T/2;break}E.setAttrs({x:-1*I,y:-1*F,width:_,height:T}),w.setAttrs({x:-1*I,y:-1*F})}}};Wf.Label=v,v.prototype.className="Label",(0,i._registerNode)(v);class y extends e.Shape{_sceneFunc(w){const E=this.width(),_=this.height(),T=this.pointerDirection(),N=this.pointerWidth(),R=this.pointerHeight(),I=this.cornerRadius();let F=0,D=0,j=0,B=0;typeof I=="number"?F=D=j=B=Math.min(I,E/2,_/2):(F=Math.min(I[0]||0,E/2,_/2),D=Math.min(I[1]||0,E/2,_/2),B=Math.min(I[2]||0,E/2,_/2),j=Math.min(I[3]||0,E/2,_/2)),w.beginPath(),w.moveTo(F,0),T===l&&(w.lineTo((E-N)/2,0),w.lineTo(E/2,-1*R),w.lineTo((E+N)/2,0)),w.lineTo(E-D,0),w.arc(E-D,D,D,Math.PI*3/2,0,!1),T===u&&(w.lineTo(E,(_-R)/2),w.lineTo(E+N,_/2),w.lineTo(E,(_+R)/2)),w.lineTo(E,_-B),w.arc(E-B,_-B,B,0,Math.PI/2,!1),T===c&&(w.lineTo((E+N)/2,_),w.lineTo(E/2,_+R),w.lineTo((E-N)/2,_)),w.lineTo(j,_),w.arc(j,_-j,j,Math.PI/2,Math.PI,!1),T===f&&(w.lineTo(0,(_+R)/2),w.lineTo(-1*N,_/2),w.lineTo(0,(_-R)/2)),w.lineTo(0,F),w.arc(F,F,F,Math.PI,Math.PI*3/2,!1),w.closePath(),w.fillStrokeShape(this)}getSelfRect(){let w=0,E=0,_=this.pointerWidth(),T=this.pointerHeight(),N=this.pointerDirection(),R=this.width(),I=this.height();return N===l?(E-=T,I+=T):N===c?I+=T:N===f?(w-=_*1.5,R+=_):N===u&&(R+=_*1.5),{x:w,y:E,width:R,height:I}}}return Wf.Tag=y,y.prototype.className="Tag",(0,i._registerNode)(y),t.Factory.addGetterSetter(y,"pointerDirection",o),t.Factory.addGetterSetter(y,"pointerWidth",0,(0,n.getNumberValidator)()),t.Factory.addGetterSetter(y,"pointerHeight",0,(0,n.getNumberValidator)()),t.Factory.addGetterSetter(y,"cornerRadius",0,(0,n.getNumberOrArrayOfNumbersValidator)(4)),Wf}var dg={},A5;function SR(){if(A5)return dg;A5=1,Object.defineProperty(dg,"__esModule",{value:!0}),dg.Rect=void 0;const t=Ar(),e=ba(),r=Tr(),n=pi(),i=Dr();class a extends e.Shape{_sceneFunc(o){const l=this.cornerRadius(),u=this.width(),c=this.height();o.beginPath(),l?n.Util.drawRoundedRectPath(o,u,c,l):o.rect(0,0,u,c),o.closePath(),o.fillStrokeShape(this)}}return dg.Rect=a,a.prototype.className="Rect",(0,r._registerNode)(a),t.Factory.addGetterSetter(a,"cornerRadius",0,(0,i.getNumberOrArrayOfNumbersValidator)(4)),dg}var fg={},R5;function CG(){if(R5)return fg;R5=1,Object.defineProperty(fg,"__esModule",{value:!0}),fg.RegularPolygon=void 0;const t=Ar(),e=ba(),r=Dr(),n=Tr();let i=class extends e.Shape{_sceneFunc(s){const o=this._getPoints();s.beginPath(),s.moveTo(o[0].x,o[0].y);for(let l=1;l<o.length;l++)s.lineTo(o[l].x,o[l].y);s.closePath(),s.fillStrokeShape(this)}_getPoints(){const s=this.attrs.sides,o=this.attrs.radius||0,l=[];for(let u=0;u<s;u++)l.push({x:o*Math.sin(u*2*Math.PI/s),y:-1*o*Math.cos(u*2*Math.PI/s)});return l}getSelfRect(){const s=this._getPoints();let o=s[0].x,l=s[0].y,u=s[0].x,c=s[0].y;return s.forEach(f=>{o=Math.min(o,f.x),l=Math.max(l,f.x),u=Math.min(u,f.y),c=Math.max(c,f.y)}),{x:o,y:u,width:l-o,height:c-u}}getWidth(){return this.radius()*2}getHeight(){return this.radius()*2}setWidth(s){this.radius(s/2)}setHeight(s){this.radius(s/2)}};return fg.RegularPolygon=i,i.prototype.className="RegularPolygon",i.prototype._centroid=!0,i.prototype._attrsAffectingSize=["radius"],(0,n._registerNode)(i),t.Factory.addGetterSetter(i,"radius",0,(0,r.getNumberValidator)()),t.Factory.addGetterSetter(i,"sides",0,(0,r.getNumberValidator)()),fg}var hg={},L5;function EG(){if(L5)return hg;L5=1,Object.defineProperty(hg,"__esModule",{value:!0}),hg.Ring=void 0;const t=Ar(),e=ba(),r=Dr(),n=Tr(),i=Math.PI*2;let a=class extends e.Shape{_sceneFunc(o){o.beginPath(),o.arc(0,0,this.innerRadius(),0,i,!1),o.moveTo(this.outerRadius(),0),o.arc(0,0,this.outerRadius(),i,0,!0),o.closePath(),o.fillStrokeShape(this)}getWidth(){return this.outerRadius()*2}getHeight(){return this.outerRadius()*2}setWidth(o){this.outerRadius(o/2)}setHeight(o){this.outerRadius(o/2)}};return hg.Ring=a,a.prototype.className="Ring",a.prototype._centroid=!0,a.prototype._attrsAffectingSize=["innerRadius","outerRadius"],(0,n._registerNode)(a),t.Factory.addGetterSetter(a,"innerRadius",0,(0,r.getNumberValidator)()),t.Factory.addGetterSetter(a,"outerRadius",0,(0,r.getNumberValidator)()),hg}var pg={},O5;function TG(){if(O5)return pg;O5=1,Object.defineProperty(pg,"__esModule",{value:!0}),pg.Sprite=void 0;const t=Ar(),e=ba(),r=S_(),n=Dr(),i=Tr();let a=class extends e.Shape{constructor(o){super(o),this._updated=!0,this.anim=new r.Animation(()=>{const l=this._updated;return this._updated=!1,l}),this.on("animationChange.konva",function(){this.frameIndex(0)}),this.on("frameIndexChange.konva",function(){this._updated=!0}),this.on("frameRateChange.konva",function(){this.anim.isRunning()&&(clearInterval(this.interval),this._setInterval())})}_sceneFunc(o){const l=this.animation(),u=this.frameIndex(),c=u*4,f=this.animations()[l],p=this.frameOffsets(),v=f[c+0],y=f[c+1],S=f[c+2],w=f[c+3],E=this.image();if((this.hasFill()||this.hasStroke())&&(o.beginPath(),o.rect(0,0,S,w),o.closePath(),o.fillStrokeShape(this)),E)if(p){const _=p[l],T=u*2;o.drawImage(E,v,y,S,w,_[T+0],_[T+1],S,w)}else o.drawImage(E,v,y,S,w,0,0,S,w)}_hitFunc(o){const l=this.animation(),u=this.frameIndex(),c=u*4,f=this.animations()[l],p=this.frameOffsets(),v=f[c+2],y=f[c+3];if(o.beginPath(),p){const S=p[l],w=u*2;o.rect(S[w+0],S[w+1],v,y)}else o.rect(0,0,v,y);o.closePath(),o.fillShape(this)}_useBufferCanvas(){return super._useBufferCanvas(!0)}_setInterval(){const o=this;this.interval=setInterval(function(){o._updateIndex()},1e3/this.frameRate())}start(){if(this.isRunning())return;const o=this.getLayer();this.anim.setLayers(o),this._setInterval(),this.anim.start()}stop(){this.anim.stop(),clearInterval(this.interval)}isRunning(){return this.anim.isRunning()}_updateIndex(){const o=this.frameIndex(),l=this.animation(),u=this.animations(),c=u[l],f=c.length/4;o<f-1?this.frameIndex(o+1):this.frameIndex(0)}};return pg.Sprite=a,a.prototype.className="Sprite",(0,i._registerNode)(a),t.Factory.addGetterSetter(a,"animation"),t.Factory.addGetterSetter(a,"animations"),t.Factory.addGetterSetter(a,"frameOffsets"),t.Factory.addGetterSetter(a,"image"),t.Factory.addGetterSetter(a,"frameIndex",0,(0,n.getNumberValidator)()),t.Factory.addGetterSetter(a,"frameRate",17,(0,n.getNumberValidator)()),t.Factory.backCompat(a,{index:"frameIndex",getIndex:"getFrameIndex",setIndex:"setFrameIndex"}),pg}var mg={},D5;function NG(){if(D5)return mg;D5=1,Object.defineProperty(mg,"__esModule",{value:!0}),mg.Star=void 0;const t=Ar(),e=ba(),r=Dr(),n=Tr();let i=class extends e.Shape{_sceneFunc(s){const o=this.innerRadius(),l=this.outerRadius(),u=this.numPoints();s.beginPath(),s.moveTo(0,0-l);for(let c=1;c<u*2;c++){const f=c%2===0?l:o,p=f*Math.sin(c*Math.PI/u),v=-1*f*Math.cos(c*Math.PI/u);s.lineTo(p,v)}s.closePath(),s.fillStrokeShape(this)}getWidth(){return this.outerRadius()*2}getHeight(){return this.outerRadius()*2}setWidth(s){this.outerRadius(s/2)}setHeight(s){this.outerRadius(s/2)}};return mg.Star=i,i.prototype.className="Star",i.prototype._centroid=!0,i.prototype._attrsAffectingSize=["innerRadius","outerRadius"],(0,n._registerNode)(i),t.Factory.addGetterSetter(i,"numPoints",5,(0,r.getNumberValidator)()),t.Factory.addGetterSetter(i,"innerRadius",0,(0,r.getNumberValidator)()),t.Factory.addGetterSetter(i,"outerRadius",0,(0,r.getNumberValidator)()),mg}var wp={},I5;function kR(){if(I5)return wp;I5=1,Object.defineProperty(wp,"__esModule",{value:!0}),wp.Text=void 0,wp.stringToArray=s;const t=pi(),e=Ar(),r=ba(),n=Tr(),i=Dr(),a=Tr();function s(J){return[...J].reduce((ie,de,he,xe)=>(new RegExp("\\p{Emoji_Modifier_Base}\\p{Emoji_Modifier}?(?:\\u200D\\p{Emoji_Presentation})+","u").test(de)?ie.push(de):new RegExp("\\p{Regional_Indicator}{2}","u").test(de+(xe[he+1]||""))?ie.push(de+xe[he+1]):he>0&&new RegExp("\\p{Mn}|\\p{Me}|\\p{Mc}","u").test(de)?ie[ie.length-1]+=de:ie.push(de),ie),[])}const o="auto",l="center",u="inherit",c="justify",f="Change.konva",p="2d",v="-",y="left",S="text",w="Text",E="top",_="bottom",T="middle",N="normal",R="px ",I=" ",F="right",D="rtl",j="word",B="char",G="none",K="",O=["direction","fontFamily","fontSize","fontStyle","fontVariant","padding","align","verticalAlign","lineHeight","text","width","height","wrap","ellipsis","letterSpacing"],W=O.length;function U(J){return J.split(",").map(ie=>{ie=ie.trim();const de=ie.indexOf(" ")>=0,he=ie.indexOf('"')>=0||ie.indexOf("'")>=0;return de&&!he&&(ie=`"${ie}"`),ie}).join(", ")}let q;function Z(){return q||(q=t.Util.createCanvasElement().getContext(p),q)}function Q(J){J.fillText(this._partialText,this._partialTextX,this._partialTextY)}function ne(J){J.setAttr("miterLimit",2),J.strokeText(this._partialText,this._partialTextX,this._partialTextY)}function re(J){return J=J||{},!J.fillLinearGradientColorStops&&!J.fillRadialGradientColorStops&&!J.fillPatternImage&&(J.fill=J.fill||"black"),J}class Y extends r.Shape{constructor(ie){super(re(ie)),this._partialTextX=0,this._partialTextY=0;for(let de=0;de<W;de++)this.on(O[de]+f,this._setTextData);this._setTextData()}_sceneFunc(ie){const de=this.textArr,he=de.length;if(!this.text())return;let xe=this.padding(),le=this.fontSize(),fe=this.lineHeight()*le,ve=this.verticalAlign(),ge=this.direction(),se=0,ye=this.align(),Se=this.getWidth(),Ue=this.letterSpacing(),Oe=this.fill(),mt=this.textDecoration(),lt=mt.indexOf("underline")!==-1,at=mt.indexOf("line-through")!==-1,wt;ge=ge===u?ie.direction:ge;let $e=fe/2,Ce=T;if(n.Konva._fixTextRendering){const dt=this.measureSize("M");Ce="alphabetic",$e=(dt.fontBoundingBoxAscent-dt.fontBoundingBoxDescent)/2+fe/2}var Ie=0,Je=0;for(ge===D&&ie.setAttr("direction",ge),ie.setAttr("font",this._getContextFont()),ie.setAttr("textBaseline",Ce),ie.setAttr("textAlign",y),ve===T?se=(this.getHeight()-he*fe-xe*2)/2:ve===_&&(se=this.getHeight()-he*fe-xe*2),ie.translate(xe,se+xe),wt=0;wt<he;wt++){var Ie=0,Je=0,Qe=de[wt],gt=Qe.text,At=Qe.width,Rt=Qe.lastInParagraph,Ut,Vt,pt;if(ie.save(),ye===F?Ie+=Se-At-xe*2:ye===l&&(Ie+=(Se-At-xe*2)/2),lt){ie.save(),ie.beginPath();const ce=n.Konva._fixTextRendering?Math.round(le/4):Math.round(le/2),me=Ie,ke=$e+Je+ce;ie.moveTo(me,ke),Ut=gt.split(" ").length-1,Vt=Ut===0,pt=ye===c&&!Rt?Se-xe*2:At,ie.lineTo(me+Math.round(pt),ke),ie.lineWidth=le/15;const Te=this._getLinearGradient();ie.strokeStyle=Te||Oe,ie.stroke(),ie.restore()}if(at){ie.save(),ie.beginPath();const ce=n.Konva._fixTextRendering?-Math.round(le/4):0;ie.moveTo(Ie,$e+Je+ce),Ut=gt.split(" ").length-1,Vt=Ut===0,pt=ye===c&&Rt&&!Vt?Se-xe*2:At,ie.lineTo(Ie+Math.round(pt),$e+Je+ce),ie.lineWidth=le/15;const me=this._getLinearGradient();ie.strokeStyle=me||Oe,ie.stroke(),ie.restore()}if(ge!==D&&(Ue!==0||ye===c)){Ut=gt.split(" ").length-1;const ce=s(gt);for(let me=0;me<ce.length;me++){const ke=ce[me];ke===" "&&!Rt&&ye===c&&(Ie+=(Se-xe*2-At)/Ut),this._partialTextX=Ie,this._partialTextY=$e+Je,this._partialText=ke,ie.fillStrokeShape(this),Ie+=this.measureSize(ke).width+Ue}}else Ue!==0&&ie.setAttr("letterSpacing",`${Ue}px`),this._partialTextX=Ie,this._partialTextY=$e+Je,this._partialText=gt,ie.fillStrokeShape(this);ie.restore(),he>1&&($e+=fe)}}_hitFunc(ie){const de=this.getWidth(),he=this.getHeight();ie.beginPath(),ie.rect(0,0,de,he),ie.closePath(),ie.fillStrokeShape(this)}setText(ie){const de=t.Util._isString(ie)?ie:ie==null?"":ie+"";return this._setAttr(S,de),this}getWidth(){return this.attrs.width===o||this.attrs.width===void 0?this.getTextWidth()+this.padding()*2:this.attrs.width}getHeight(){return this.attrs.height===o||this.attrs.height===void 0?this.fontSize()*this.textArr.length*this.lineHeight()+this.padding()*2:this.attrs.height}getTextWidth(){return this.textWidth}getTextHeight(){return t.Util.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height."),this.textHeight}measureSize(ie){var de,he,xe,le,fe,ve,ge,se,ye,Se,Ue;let Oe=Z(),mt=this.fontSize(),lt;Oe.save(),Oe.font=this._getContextFont(),lt=Oe.measureText(ie),Oe.restore();const at=mt/100;return{actualBoundingBoxAscent:(de=lt.actualBoundingBoxAscent)!==null&&de!==void 0?de:71.58203125*at,actualBoundingBoxDescent:(he=lt.actualBoundingBoxDescent)!==null&&he!==void 0?he:0,actualBoundingBoxLeft:(xe=lt.actualBoundingBoxLeft)!==null&&xe!==void 0?xe:-7.421875*at,actualBoundingBoxRight:(le=lt.actualBoundingBoxRight)!==null&&le!==void 0?le:75.732421875*at,alphabeticBaseline:(fe=lt.alphabeticBaseline)!==null&&fe!==void 0?fe:0,emHeightAscent:(ve=lt.emHeightAscent)!==null&&ve!==void 0?ve:100*at,emHeightDescent:(ge=lt.emHeightDescent)!==null&&ge!==void 0?ge:-20*at,fontBoundingBoxAscent:(se=lt.fontBoundingBoxAscent)!==null&&se!==void 0?se:91*at,fontBoundingBoxDescent:(ye=lt.fontBoundingBoxDescent)!==null&&ye!==void 0?ye:21*at,hangingBaseline:(Se=lt.hangingBaseline)!==null&&Se!==void 0?Se:72.80000305175781*at,ideographicBaseline:(Ue=lt.ideographicBaseline)!==null&&Ue!==void 0?Ue:-21*at,width:lt.width,height:mt}}_getContextFont(){return this.fontStyle()+I+this.fontVariant()+I+(this.fontSize()+R)+U(this.fontFamily())}_addTextLine(ie){this.align()===c&&(ie=ie.trim());const he=this._getTextWidth(ie);return this.textArr.push({text:ie,width:he,lastInParagraph:!1})}_getTextWidth(ie){const de=this.letterSpacing(),he=ie.length;return Z().measureText(ie).width+(he?de*(he-1):0)}_setTextData(){let ie=this.text().split(`
`),de=+this.fontSize(),he=0,xe=this.lineHeight()*de,le=this.attrs.width,fe=this.attrs.height,ve=le!==o&&le!==void 0,ge=fe!==o&&fe!==void 0,se=this.padding(),ye=le-se*2,Se=fe-se*2,Ue=0,Oe=this.wrap(),mt=Oe!==G,lt=Oe!==B&&mt,at=this.ellipsis();this.textArr=[],Z().font=this._getContextFont();const wt=at?this._getTextWidth(K):0;for(let Ce=0,Ie=ie.length;Ce<Ie;++Ce){let Je=ie[Ce],Qe=this._getTextWidth(Je);if(ve&&Qe>ye)for(;Je.length>0;){let gt=0,At=Je.length,Rt="",Ut=0;for(;gt<At;){const Vt=gt+At>>>1,pt=Je.slice(0,Vt+1),dt=this._getTextWidth(pt)+wt;dt<=ye?(gt=Vt+1,Rt=pt,Ut=dt):At=Vt}if(Rt){if(lt){var $e;const pt=Je[Rt.length];(pt===I||pt===v)&&Ut<=ye?$e=Rt.length:$e=Math.max(Rt.lastIndexOf(I),Rt.lastIndexOf(v))+1,$e>0&&(gt=$e,Rt=Rt.slice(0,gt),Ut=this._getTextWidth(Rt))}if(Rt=Rt.trimRight(),this._addTextLine(Rt),he=Math.max(he,Ut),Ue+=xe,this._shouldHandleEllipsis(Ue)){this._tryToAddEllipsisToLastLine();break}if(Je=Je.slice(gt),Je=Je.trimLeft(),Je.length>0&&(Qe=this._getTextWidth(Je),Qe<=ye)){this._addTextLine(Je),Ue+=xe,he=Math.max(he,Qe);break}}else break}else this._addTextLine(Je),Ue+=xe,he=Math.max(he,Qe),this._shouldHandleEllipsis(Ue)&&Ce<Ie-1&&this._tryToAddEllipsisToLastLine();if(this.textArr[this.textArr.length-1]&&(this.textArr[this.textArr.length-1].lastInParagraph=!0),ge&&Ue+xe>Se)break}this.textHeight=de,this.textWidth=he}_shouldHandleEllipsis(ie){const de=+this.fontSize(),he=this.lineHeight()*de,xe=this.attrs.height,le=xe!==o&&xe!==void 0,fe=this.padding(),ve=xe-fe*2;return!(this.wrap()!==G)||le&&ie+he>ve}_tryToAddEllipsisToLastLine(){const ie=this.attrs.width,de=ie!==o&&ie!==void 0,he=this.padding(),xe=ie-he*2,le=this.ellipsis(),fe=this.textArr[this.textArr.length-1];!fe||!le||(de&&(this._getTextWidth(fe.text+K)<xe||(fe.text=fe.text.slice(0,fe.text.length-3))),this.textArr.splice(this.textArr.length-1,1),this._addTextLine(fe.text+K))}getStrokeScaleEnabled(){return!0}_useBufferCanvas(){const ie=this.textDecoration().indexOf("underline")!==-1||this.textDecoration().indexOf("line-through")!==-1,de=this.hasShadow();return ie&&de?!0:super._useBufferCanvas()}}return wp.Text=Y,Y.prototype._fillFunc=Q,Y.prototype._strokeFunc=ne,Y.prototype.className=w,Y.prototype._attrsAffectingSize=["text","fontSize","padding","wrap","lineHeight","letterSpacing"],(0,a._registerNode)(Y),e.Factory.overWriteSetter(Y,"width",(0,i.getNumberOrAutoValidator)()),e.Factory.overWriteSetter(Y,"height",(0,i.getNumberOrAutoValidator)()),e.Factory.addGetterSetter(Y,"direction",u),e.Factory.addGetterSetter(Y,"fontFamily","Arial"),e.Factory.addGetterSetter(Y,"fontSize",12,(0,i.getNumberValidator)()),e.Factory.addGetterSetter(Y,"fontStyle",N),e.Factory.addGetterSetter(Y,"fontVariant",N),e.Factory.addGetterSetter(Y,"padding",0,(0,i.getNumberValidator)()),e.Factory.addGetterSetter(Y,"align",y),e.Factory.addGetterSetter(Y,"verticalAlign",E),e.Factory.addGetterSetter(Y,"lineHeight",1,(0,i.getNumberValidator)()),e.Factory.addGetterSetter(Y,"wrap",j),e.Factory.addGetterSetter(Y,"ellipsis",!1,(0,i.getBooleanValidator)()),e.Factory.addGetterSetter(Y,"letterSpacing",0,(0,i.getNumberValidator)()),e.Factory.addGetterSetter(Y,"text","",(0,i.getStringValidator)()),e.Factory.addGetterSetter(Y,"textDecoration",""),wp}var gg={},j5;function PG(){if(j5)return gg;j5=1,Object.defineProperty(gg,"__esModule",{value:!0}),gg.TextPath=void 0;const t=pi(),e=Ar(),r=ba(),n=k_(),i=kR(),a=Dr(),s=Tr(),o="",l="normal";function u(p){p.fillText(this.partialText,0,0)}function c(p){p.strokeText(this.partialText,0,0)}let f=class extends r.Shape{constructor(v){super(v),this.dummyCanvas=t.Util.createCanvasElement(),this.dataArray=[],this._readDataAttribute(),this.on("dataChange.konva",function(){this._readDataAttribute(),this._setTextData()}),this.on("textChange.konva alignChange.konva letterSpacingChange.konva kerningFuncChange.konva fontSizeChange.konva fontFamilyChange.konva",this._setTextData),this._setTextData()}_getTextPathLength(){return n.Path.getPathLength(this.dataArray)}_getPointAtLength(v){if(!this.attrs.data)return null;const y=this.pathLength;return v-1>y?null:n.Path.getPointAtLengthOfDataArray(v,this.dataArray)}_readDataAttribute(){this.dataArray=n.Path.parsePathData(this.attrs.data),this.pathLength=this._getTextPathLength()}_sceneFunc(v){v.setAttr("font",this._getContextFont()),v.setAttr("textBaseline",this.textBaseline()),v.setAttr("textAlign","left"),v.save();const y=this.textDecoration(),S=this.fill(),w=this.fontSize(),E=this.glyphInfo;y==="underline"&&v.beginPath();for(let _=0;_<E.length;_++){v.save();const T=E[_].p0;v.translate(T.x,T.y),v.rotate(E[_].rotation),this.partialText=E[_].text,v.fillStrokeShape(this),y==="underline"&&(_===0&&v.moveTo(0,w/2+1),v.lineTo(w,w/2+1)),v.restore()}y==="underline"&&(v.strokeStyle=S,v.lineWidth=w/20,v.stroke()),v.restore()}_hitFunc(v){v.beginPath();const y=this.glyphInfo;if(y.length>=1){const S=y[0].p0;v.moveTo(S.x,S.y)}for(let S=0;S<y.length;S++){const w=y[S].p1;v.lineTo(w.x,w.y)}v.setAttr("lineWidth",this.fontSize()),v.setAttr("strokeStyle",this.colorKey),v.stroke()}getTextWidth(){return this.textWidth}getTextHeight(){return t.Util.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height."),this.textHeight}setText(v){return i.Text.prototype.setText.call(this,v)}_getContextFont(){return i.Text.prototype._getContextFont.call(this)}_getTextSize(v){const S=this.dummyCanvas.getContext("2d");S.save(),S.font=this._getContextFont();const w=S.measureText(v);return S.restore(),{width:w.width,height:parseInt(`${this.fontSize()}`,10)}}_setTextData(){const{width:v,height:y}=this._getTextSize(this.attrs.text);if(this.textWidth=v,this.textHeight=y,this.glyphInfo=[],!this.attrs.data)return null;const S=this.letterSpacing(),w=this.align(),E=this.kerningFunc(),_=Math.max(this.textWidth+((this.attrs.text||"").length-1)*S,0);let T=0;w==="center"&&(T=Math.max(0,this.pathLength/2-_/2)),w==="right"&&(T=Math.max(0,this.pathLength-_));const N=(0,i.stringToArray)(this.text());let R=T;for(let I=0;I<N.length;I++){const F=this._getPointAtLength(R);if(!F)return;let D=this._getTextSize(N[I]).width+S;if(N[I]===" "&&w==="justify"){const W=this.text().split(" ").length-1;D+=(this.pathLength-_)/W}const j=this._getPointAtLength(R+D);if(!j)return;const B=n.Path.getLineLength(F.x,F.y,j.x,j.y);let G=0;if(E)try{G=E(N[I-1],N[I])*this.fontSize()}catch{G=0}F.x+=G,j.x+=G,this.textWidth+=G;const K=n.Path.getPointOnLine(G+B/2,F.x,F.y,j.x,j.y),O=Math.atan2(j.y-F.y,j.x-F.x);this.glyphInfo.push({transposeX:K.x,transposeY:K.y,text:N[I],rotation:O,p0:F,p1:j}),R+=D}}getSelfRect(){if(!this.glyphInfo.length)return{x:0,y:0,width:0,height:0};const v=[];this.glyphInfo.forEach(function(R){v.push(R.p0.x),v.push(R.p0.y),v.push(R.p1.x),v.push(R.p1.y)});let y=v[0]||0,S=v[0]||0,w=v[1]||0,E=v[1]||0,_,T;for(let R=0;R<v.length/2;R++)_=v[R*2],T=v[R*2+1],y=Math.min(y,_),S=Math.max(S,_),w=Math.min(w,T),E=Math.max(E,T);const N=this.fontSize();return{x:y-N/2,y:w-N/2,width:S-y+N,height:E-w+N}}destroy(){return t.Util.releaseCanvas(this.dummyCanvas),super.destroy()}};return gg.TextPath=f,f.prototype._fillFunc=u,f.prototype._strokeFunc=c,f.prototype._fillFuncHit=u,f.prototype._strokeFuncHit=c,f.prototype.className="TextPath",f.prototype._attrsAffectingSize=["text","fontSize","data"],(0,s._registerNode)(f),e.Factory.addGetterSetter(f,"data"),e.Factory.addGetterSetter(f,"fontFamily","Arial"),e.Factory.addGetterSetter(f,"fontSize",12,(0,a.getNumberValidator)()),e.Factory.addGetterSetter(f,"fontStyle",l),e.Factory.addGetterSetter(f,"align","left"),e.Factory.addGetterSetter(f,"letterSpacing",0,(0,a.getNumberValidator)()),e.Factory.addGetterSetter(f,"textBaseline","middle"),e.Factory.addGetterSetter(f,"fontVariant",l),e.Factory.addGetterSetter(f,"text",o),e.Factory.addGetterSetter(f,"textDecoration",null),e.Factory.addGetterSetter(f,"kerningFunc",null),gg}var vg={},F5;function MG(){if(F5)return vg;F5=1,Object.defineProperty(vg,"__esModule",{value:!0}),vg.Transformer=void 0;const t=pi(),e=Ar(),r=Ei(),n=ba(),i=SR(),a=w_(),s=Tr(),o=Dr(),l=Tr(),u="tr-konva",c=["resizeEnabledChange","rotateAnchorOffsetChange","rotateEnabledChange","enabledAnchorsChange","anchorSizeChange","borderEnabledChange","borderStrokeChange","borderStrokeWidthChange","borderDashChange","anchorStrokeChange","anchorStrokeWidthChange","anchorFillChange","anchorCornerRadiusChange","ignoreStrokeChange","anchorStyleFuncChange"].map(D=>D+`.${u}`).join(" "),f="nodesRect",p=["widthChange","heightChange","scaleXChange","scaleYChange","skewXChange","skewYChange","rotationChange","offsetXChange","offsetYChange","transformsEnabledChange","strokeWidthChange"],v={"top-left":-45,"top-center":0,"top-right":45,"middle-right":-90,"middle-left":90,"bottom-left":-135,"bottom-center":180,"bottom-right":135},y="ontouchstart"in s.Konva._global;function S(D,j,B){if(D==="rotater")return B;j+=t.Util.degToRad(v[D]||0);const G=(t.Util.radToDeg(j)%360+360)%360;return t.Util._inRange(G,315+22.5,360)||t.Util._inRange(G,0,22.5)?"ns-resize":t.Util._inRange(G,45-22.5,45+22.5)?"nesw-resize":t.Util._inRange(G,90-22.5,90+22.5)?"ew-resize":t.Util._inRange(G,135-22.5,135+22.5)?"nwse-resize":t.Util._inRange(G,180-22.5,180+22.5)?"ns-resize":t.Util._inRange(G,225-22.5,225+22.5)?"nesw-resize":t.Util._inRange(G,270-22.5,270+22.5)?"ew-resize":t.Util._inRange(G,315-22.5,315+22.5)?"nwse-resize":(t.Util.error("Transformer has unknown angle for cursor detection: "+G),"pointer")}const w=["top-left","top-center","top-right","middle-right","middle-left","bottom-left","bottom-center","bottom-right"];function E(D){return{x:D.x+D.width/2*Math.cos(D.rotation)+D.height/2*Math.sin(-D.rotation),y:D.y+D.height/2*Math.cos(D.rotation)+D.width/2*Math.sin(D.rotation)}}function _(D,j,B){const G=B.x+(D.x-B.x)*Math.cos(j)-(D.y-B.y)*Math.sin(j),K=B.y+(D.x-B.x)*Math.sin(j)+(D.y-B.y)*Math.cos(j);return{...D,rotation:D.rotation+j,x:G,y:K}}function T(D,j){const B=E(D);return _(D,j,B)}function N(D,j,B){let G=j;for(let K=0;K<D.length;K++){const O=s.Konva.getAngle(D[K]),W=Math.abs(O-j)%(Math.PI*2);Math.min(W,Math.PI*2-W)<B&&(G=O)}return G}let R=0;class I extends a.Group{constructor(j){super(j),this._movingAnchorName=null,this._transforming=!1,this._createElements(),this._handleMouseMove=this._handleMouseMove.bind(this),this._handleMouseUp=this._handleMouseUp.bind(this),this.update=this.update.bind(this),this.on(c,this.update),this.getNode()&&this.update()}attachTo(j){return this.setNode(j),this}setNode(j){return t.Util.warn("tr.setNode(shape), tr.node(shape) and tr.attachTo(shape) methods are deprecated. Please use tr.nodes(nodesArray) instead."),this.setNodes([j])}getNode(){return this._nodes&&this._nodes[0]}_getEventNamespace(){return u+this._id}setNodes(j=[]){this._nodes&&this._nodes.length&&this.detach();const B=j.filter(K=>K.isAncestorOf(this)?(t.Util.error("Konva.Transformer cannot be an a child of the node you are trying to attach"),!1):!0);return this._nodes=j=B,j.length===1&&this.useSingleNodeRotation()?this.rotation(j[0].getAbsoluteRotation()):this.rotation(0),this._nodes.forEach(K=>{const O=()=>{this.nodes().length===1&&this.useSingleNodeRotation()&&this.rotation(this.nodes()[0].getAbsoluteRotation()),this._resetTransformCache(),!this._transforming&&!this.isDragging()&&this.update()},W=K._attrsAffectingSize.map(U=>U+"Change."+this._getEventNamespace()).join(" ");K.on(W,O),K.on(p.map(U=>U+`.${this._getEventNamespace()}`).join(" "),O),K.on(`absoluteTransformChange.${this._getEventNamespace()}`,O),this._proxyDrag(K)}),this._resetTransformCache(),this.findOne(".top-left")&&this.update(),this}_proxyDrag(j){let B;j.on(`dragstart.${this._getEventNamespace()}`,G=>{B=j.getAbsolutePosition(),!this.isDragging()&&j!==this.findOne(".back")&&this.startDrag(G,!1)}),j.on(`dragmove.${this._getEventNamespace()}`,G=>{if(!B)return;const K=j.getAbsolutePosition(),O=K.x-B.x,W=K.y-B.y;this.nodes().forEach(U=>{if(U===j||U.isDragging())return;const q=U.getAbsolutePosition();U.setAbsolutePosition({x:q.x+O,y:q.y+W}),U.startDrag(G)}),B=null})}getNodes(){return this._nodes||[]}getActiveAnchor(){return this._movingAnchorName}detach(){this._nodes&&this._nodes.forEach(j=>{j.off("."+this._getEventNamespace())}),this._nodes=[],this._resetTransformCache()}_resetTransformCache(){this._clearCache(f),this._clearCache("transform"),this._clearSelfAndDescendantCache("absoluteTransform")}_getNodeRect(){return this._getCache(f,this.__getNodeRect)}__getNodeShape(j,B=this.rotation(),G){const K=j.getClientRect({skipTransform:!0,skipShadow:!0,skipStroke:this.ignoreStroke()}),O=j.getAbsoluteScale(G),W=j.getAbsolutePosition(G),U=K.x*O.x-j.offsetX()*O.x,q=K.y*O.y-j.offsetY()*O.y,Z=(s.Konva.getAngle(j.getAbsoluteRotation())+Math.PI*2)%(Math.PI*2),Q={x:W.x+U*Math.cos(Z)+q*Math.sin(-Z),y:W.y+q*Math.cos(Z)+U*Math.sin(Z),width:K.width*O.x,height:K.height*O.y,rotation:Z};return _(Q,-s.Konva.getAngle(B),{x:0,y:0})}__getNodeRect(){if(!this.getNode())return{x:-1e8,y:-1e8,width:0,height:0,rotation:0};const B=[];this.nodes().map(Z=>{const Q=Z.getClientRect({skipTransform:!0,skipShadow:!0,skipStroke:this.ignoreStroke()}),ne=[{x:Q.x,y:Q.y},{x:Q.x+Q.width,y:Q.y},{x:Q.x+Q.width,y:Q.y+Q.height},{x:Q.x,y:Q.y+Q.height}],re=Z.getAbsoluteTransform();ne.forEach(function(Y){const J=re.point(Y);B.push(J)})});const G=new t.Transform;G.rotate(-s.Konva.getAngle(this.rotation()));let K=1/0,O=1/0,W=-1/0,U=-1/0;B.forEach(function(Z){const Q=G.point(Z);K===void 0&&(K=W=Q.x,O=U=Q.y),K=Math.min(K,Q.x),O=Math.min(O,Q.y),W=Math.max(W,Q.x),U=Math.max(U,Q.y)}),G.invert();const q=G.point({x:K,y:O});return{x:q.x,y:q.y,width:W-K,height:U-O,rotation:s.Konva.getAngle(this.rotation())}}getX(){return this._getNodeRect().x}getY(){return this._getNodeRect().y}getWidth(){return this._getNodeRect().width}getHeight(){return this._getNodeRect().height}_createElements(){this._createBack(),w.forEach(j=>{this._createAnchor(j)}),this._createAnchor("rotater")}_createAnchor(j){const B=new i.Rect({stroke:"rgb(0, 161, 255)",fill:"white",strokeWidth:1,name:j+" _anchor",dragDistance:0,draggable:!0,hitStrokeWidth:y?10:"auto"}),G=this;B.on("mousedown touchstart",function(K){G._handleMouseDown(K)}),B.on("dragstart",K=>{B.stopDrag(),K.cancelBubble=!0}),B.on("dragend",K=>{K.cancelBubble=!0}),B.on("mouseenter",()=>{const K=s.Konva.getAngle(this.rotation()),O=this.rotateAnchorCursor(),W=S(j,K,O);B.getStage().content&&(B.getStage().content.style.cursor=W),this._cursorChange=!0}),B.on("mouseout",()=>{B.getStage().content&&(B.getStage().content.style.cursor=""),this._cursorChange=!1}),this.add(B)}_createBack(){const j=new n.Shape({name:"back",width:0,height:0,draggable:!0,sceneFunc(B,G){const K=G.getParent(),O=K.padding();B.beginPath(),B.rect(-O,-O,G.width()+O*2,G.height()+O*2),B.moveTo(G.width()/2,-O),K.rotateEnabled()&&K.rotateLineVisible()&&B.lineTo(G.width()/2,-K.rotateAnchorOffset()*t.Util._sign(G.height())-O),B.fillStrokeShape(G)},hitFunc:(B,G)=>{if(!this.shouldOverdrawWholeArea())return;const K=this.padding();B.beginPath(),B.rect(-K,-K,G.width()+K*2,G.height()+K*2),B.fillStrokeShape(G)}});this.add(j),this._proxyDrag(j),j.on("dragstart",B=>{B.cancelBubble=!0}),j.on("dragmove",B=>{B.cancelBubble=!0}),j.on("dragend",B=>{B.cancelBubble=!0}),this.on("dragmove",B=>{this.update()})}_handleMouseDown(j){if(this._transforming)return;this._movingAnchorName=j.target.name().split(" ")[0];const B=this._getNodeRect(),G=B.width,K=B.height,O=Math.sqrt(Math.pow(G,2)+Math.pow(K,2));this.sin=Math.abs(K/O),this.cos=Math.abs(G/O),typeof window<"u"&&(window.addEventListener("mousemove",this._handleMouseMove),window.addEventListener("touchmove",this._handleMouseMove),window.addEventListener("mouseup",this._handleMouseUp,!0),window.addEventListener("touchend",this._handleMouseUp,!0)),this._transforming=!0;const W=j.target.getAbsolutePosition(),U=j.target.getStage().getPointerPosition();this._anchorDragOffset={x:U.x-W.x,y:U.y-W.y},R++,this._fire("transformstart",{evt:j.evt,target:this.getNode()}),this._nodes.forEach(q=>{q._fire("transformstart",{evt:j.evt,target:q})})}_handleMouseMove(j){let B,G,K;const O=this.findOne("."+this._movingAnchorName),W=O.getStage();W.setPointersPositions(j);const U=W.getPointerPosition();let q={x:U.x-this._anchorDragOffset.x,y:U.y-this._anchorDragOffset.y};const Z=O.getAbsolutePosition();this.anchorDragBoundFunc()&&(q=this.anchorDragBoundFunc()(Z,q,j)),O.setAbsolutePosition(q);const Q=O.getAbsolutePosition();if(Z.x===Q.x&&Z.y===Q.y)return;if(this._movingAnchorName==="rotater"){const ve=this._getNodeRect();B=O.x()-ve.width/2,G=-O.y()+ve.height/2;let ge=Math.atan2(-G,B)+Math.PI/2;ve.height<0&&(ge-=Math.PI);const ye=s.Konva.getAngle(this.rotation())+ge,Se=s.Konva.getAngle(this.rotationSnapTolerance()),Oe=N(this.rotationSnaps(),ye,Se)-ve.rotation,mt=T(ve,Oe);this._fitNodesInto(mt,j);return}const ne=this.shiftBehavior();let re;ne==="inverted"?re=this.keepRatio()&&!j.shiftKey:ne==="none"?re=this.keepRatio():re=this.keepRatio()||j.shiftKey;var he=this.centeredScaling()||j.altKey;if(this._movingAnchorName==="top-left"){if(re){var Y=he?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".bottom-right").x(),y:this.findOne(".bottom-right").y()};K=Math.sqrt(Math.pow(Y.x-O.x(),2)+Math.pow(Y.y-O.y(),2));var J=this.findOne(".top-left").x()>Y.x?-1:1,ie=this.findOne(".top-left").y()>Y.y?-1:1;B=K*this.cos*J,G=K*this.sin*ie,this.findOne(".top-left").x(Y.x-B),this.findOne(".top-left").y(Y.y-G)}}else if(this._movingAnchorName==="top-center")this.findOne(".top-left").y(O.y());else if(this._movingAnchorName==="top-right"){if(re){var Y=he?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".bottom-left").x(),y:this.findOne(".bottom-left").y()};K=Math.sqrt(Math.pow(O.x()-Y.x,2)+Math.pow(Y.y-O.y(),2));var J=this.findOne(".top-right").x()<Y.x?-1:1,ie=this.findOne(".top-right").y()>Y.y?-1:1;B=K*this.cos*J,G=K*this.sin*ie,this.findOne(".top-right").x(Y.x+B),this.findOne(".top-right").y(Y.y-G)}var de=O.position();this.findOne(".top-left").y(de.y),this.findOne(".bottom-right").x(de.x)}else if(this._movingAnchorName==="middle-left")this.findOne(".top-left").x(O.x());else if(this._movingAnchorName==="middle-right")this.findOne(".bottom-right").x(O.x());else if(this._movingAnchorName==="bottom-left"){if(re){var Y=he?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".top-right").x(),y:this.findOne(".top-right").y()};K=Math.sqrt(Math.pow(Y.x-O.x(),2)+Math.pow(O.y()-Y.y,2));var J=Y.x<O.x()?-1:1,ie=O.y()<Y.y?-1:1;B=K*this.cos*J,G=K*this.sin*ie,O.x(Y.x-B),O.y(Y.y+G)}de=O.position(),this.findOne(".top-left").x(de.x),this.findOne(".bottom-right").y(de.y)}else if(this._movingAnchorName==="bottom-center")this.findOne(".bottom-right").y(O.y());else if(this._movingAnchorName==="bottom-right"){if(re){var Y=he?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".top-left").x(),y:this.findOne(".top-left").y()};K=Math.sqrt(Math.pow(O.x()-Y.x,2)+Math.pow(O.y()-Y.y,2));var J=this.findOne(".bottom-right").x()<Y.x?-1:1,ie=this.findOne(".bottom-right").y()<Y.y?-1:1;B=K*this.cos*J,G=K*this.sin*ie,this.findOne(".bottom-right").x(Y.x+B),this.findOne(".bottom-right").y(Y.y+G)}}else console.error(new Error("Wrong position argument of selection resizer: "+this._movingAnchorName));var he=this.centeredScaling()||j.altKey;if(he){const ve=this.findOne(".top-left"),ge=this.findOne(".bottom-right"),se=ve.x(),ye=ve.y(),Se=this.getWidth()-ge.x(),Ue=this.getHeight()-ge.y();ge.move({x:-se,y:-ye}),ve.move({x:Se,y:Ue})}const xe=this.findOne(".top-left").getAbsolutePosition();B=xe.x,G=xe.y;const le=this.findOne(".bottom-right").x()-this.findOne(".top-left").x(),fe=this.findOne(".bottom-right").y()-this.findOne(".top-left").y();this._fitNodesInto({x:B,y:G,width:le,height:fe,rotation:s.Konva.getAngle(this.rotation())},j)}_handleMouseUp(j){this._removeEvents(j)}getAbsoluteTransform(){return this.getTransform()}_removeEvents(j){var B;if(this._transforming){this._transforming=!1,typeof window<"u"&&(window.removeEventListener("mousemove",this._handleMouseMove),window.removeEventListener("touchmove",this._handleMouseMove),window.removeEventListener("mouseup",this._handleMouseUp,!0),window.removeEventListener("touchend",this._handleMouseUp,!0));const G=this.getNode();R--,this._fire("transformend",{evt:j,target:G}),(B=this.getLayer())===null||B===void 0||B.batchDraw(),G&&this._nodes.forEach(K=>{var O;K._fire("transformend",{evt:j,target:K}),(O=K.getLayer())===null||O===void 0||O.batchDraw()}),this._movingAnchorName=null}}_fitNodesInto(j,B){const G=this._getNodeRect(),K=1;if(t.Util._inRange(j.width,-this.padding()*2-K,K)){this.update();return}if(t.Util._inRange(j.height,-this.padding()*2-K,K)){this.update();return}const O=new t.Transform;if(O.rotate(s.Konva.getAngle(this.rotation())),this._movingAnchorName&&j.width<0&&this._movingAnchorName.indexOf("left")>=0){const re=O.point({x:-this.padding()*2,y:0});j.x+=re.x,j.y+=re.y,j.width+=this.padding()*2,this._movingAnchorName=this._movingAnchorName.replace("left","right"),this._anchorDragOffset.x-=re.x,this._anchorDragOffset.y-=re.y}else if(this._movingAnchorName&&j.width<0&&this._movingAnchorName.indexOf("right")>=0){const re=O.point({x:this.padding()*2,y:0});this._movingAnchorName=this._movingAnchorName.replace("right","left"),this._anchorDragOffset.x-=re.x,this._anchorDragOffset.y-=re.y,j.width+=this.padding()*2}if(this._movingAnchorName&&j.height<0&&this._movingAnchorName.indexOf("top")>=0){const re=O.point({x:0,y:-this.padding()*2});j.x+=re.x,j.y+=re.y,this._movingAnchorName=this._movingAnchorName.replace("top","bottom"),this._anchorDragOffset.x-=re.x,this._anchorDragOffset.y-=re.y,j.height+=this.padding()*2}else if(this._movingAnchorName&&j.height<0&&this._movingAnchorName.indexOf("bottom")>=0){const re=O.point({x:0,y:this.padding()*2});this._movingAnchorName=this._movingAnchorName.replace("bottom","top"),this._anchorDragOffset.x-=re.x,this._anchorDragOffset.y-=re.y,j.height+=this.padding()*2}if(this.boundBoxFunc()){const re=this.boundBoxFunc()(G,j);re?j=re:t.Util.warn("boundBoxFunc returned falsy. You should return new bound rect from it!")}const W=1e7,U=new t.Transform;U.translate(G.x,G.y),U.rotate(G.rotation),U.scale(G.width/W,G.height/W);const q=new t.Transform,Z=j.width/W,Q=j.height/W;this.flipEnabled()===!1?(q.translate(j.x,j.y),q.rotate(j.rotation),q.translate(j.width<0?j.width:0,j.height<0?j.height:0),q.scale(Math.abs(Z),Math.abs(Q))):(q.translate(j.x,j.y),q.rotate(j.rotation),q.scale(Z,Q));const ne=q.multiply(U.invert());this._nodes.forEach(re=>{var Y;const J=re.getParent().getAbsoluteTransform(),ie=re.getTransform().copy();ie.translate(re.offsetX(),re.offsetY());const de=new t.Transform;de.multiply(J.copy().invert()).multiply(ne).multiply(J).multiply(ie);const he=de.decompose();re.setAttrs(he),(Y=re.getLayer())===null||Y===void 0||Y.batchDraw()}),this.rotation(t.Util._getRotation(j.rotation)),this._nodes.forEach(re=>{this._fire("transform",{evt:B,target:re}),re._fire("transform",{evt:B,target:re})}),this._resetTransformCache(),this.update(),this.getLayer().batchDraw()}forceUpdate(){this._resetTransformCache(),this.update()}_batchChangeChild(j,B){this.findOne(j).setAttrs(B)}update(){var j;const B=this._getNodeRect();this.rotation(t.Util._getRotation(B.rotation));const G=B.width,K=B.height,O=this.enabledAnchors(),W=this.resizeEnabled(),U=this.padding(),q=this.anchorSize(),Z=this.find("._anchor");Z.forEach(ne=>{ne.setAttrs({width:q,height:q,offsetX:q/2,offsetY:q/2,stroke:this.anchorStroke(),strokeWidth:this.anchorStrokeWidth(),fill:this.anchorFill(),cornerRadius:this.anchorCornerRadius()})}),this._batchChangeChild(".top-left",{x:0,y:0,offsetX:q/2+U,offsetY:q/2+U,visible:W&&O.indexOf("top-left")>=0}),this._batchChangeChild(".top-center",{x:G/2,y:0,offsetY:q/2+U,visible:W&&O.indexOf("top-center")>=0}),this._batchChangeChild(".top-right",{x:G,y:0,offsetX:q/2-U,offsetY:q/2+U,visible:W&&O.indexOf("top-right")>=0}),this._batchChangeChild(".middle-left",{x:0,y:K/2,offsetX:q/2+U,visible:W&&O.indexOf("middle-left")>=0}),this._batchChangeChild(".middle-right",{x:G,y:K/2,offsetX:q/2-U,visible:W&&O.indexOf("middle-right")>=0}),this._batchChangeChild(".bottom-left",{x:0,y:K,offsetX:q/2+U,offsetY:q/2-U,visible:W&&O.indexOf("bottom-left")>=0}),this._batchChangeChild(".bottom-center",{x:G/2,y:K,offsetY:q/2-U,visible:W&&O.indexOf("bottom-center")>=0}),this._batchChangeChild(".bottom-right",{x:G,y:K,offsetX:q/2-U,offsetY:q/2-U,visible:W&&O.indexOf("bottom-right")>=0}),this._batchChangeChild(".rotater",{x:G/2,y:-this.rotateAnchorOffset()*t.Util._sign(K)-U,visible:this.rotateEnabled()}),this._batchChangeChild(".back",{width:G,height:K,visible:this.borderEnabled(),stroke:this.borderStroke(),strokeWidth:this.borderStrokeWidth(),dash:this.borderDash(),x:0,y:0});const Q=this.anchorStyleFunc();Q&&Z.forEach(ne=>{Q(ne)}),(j=this.getLayer())===null||j===void 0||j.batchDraw()}isTransforming(){return this._transforming}stopTransform(){if(this._transforming){this._removeEvents();const j=this.findOne("."+this._movingAnchorName);j&&j.stopDrag()}}destroy(){return this.getStage()&&this._cursorChange&&this.getStage().content&&(this.getStage().content.style.cursor=""),a.Group.prototype.destroy.call(this),this.detach(),this._removeEvents(),this}toObject(){return r.Node.prototype.toObject.call(this)}clone(j){return r.Node.prototype.clone.call(this,j)}getClientRect(){return this.nodes().length>0?super.getClientRect():{x:0,y:0,width:0,height:0}}}vg.Transformer=I,I.isTransforming=()=>R>0;function F(D){return D instanceof Array||t.Util.warn("enabledAnchors value should be an array"),D instanceof Array&&D.forEach(function(j){w.indexOf(j)===-1&&t.Util.warn("Unknown anchor name: "+j+". Available names are: "+w.join(", "))}),D||[]}return I.prototype.className="Transformer",(0,l._registerNode)(I),e.Factory.addGetterSetter(I,"enabledAnchors",w,F),e.Factory.addGetterSetter(I,"flipEnabled",!0,(0,o.getBooleanValidator)()),e.Factory.addGetterSetter(I,"resizeEnabled",!0),e.Factory.addGetterSetter(I,"anchorSize",10,(0,o.getNumberValidator)()),e.Factory.addGetterSetter(I,"rotateEnabled",!0),e.Factory.addGetterSetter(I,"rotateLineVisible",!0),e.Factory.addGetterSetter(I,"rotationSnaps",[]),e.Factory.addGetterSetter(I,"rotateAnchorOffset",50,(0,o.getNumberValidator)()),e.Factory.addGetterSetter(I,"rotateAnchorCursor","crosshair"),e.Factory.addGetterSetter(I,"rotationSnapTolerance",5,(0,o.getNumberValidator)()),e.Factory.addGetterSetter(I,"borderEnabled",!0),e.Factory.addGetterSetter(I,"anchorStroke","rgb(0, 161, 255)"),e.Factory.addGetterSetter(I,"anchorStrokeWidth",1,(0,o.getNumberValidator)()),e.Factory.addGetterSetter(I,"anchorFill","white"),e.Factory.addGetterSetter(I,"anchorCornerRadius",0,(0,o.getNumberValidator)()),e.Factory.addGetterSetter(I,"borderStroke","rgb(0, 161, 255)"),e.Factory.addGetterSetter(I,"borderStrokeWidth",1,(0,o.getNumberValidator)()),e.Factory.addGetterSetter(I,"borderDash"),e.Factory.addGetterSetter(I,"keepRatio",!0),e.Factory.addGetterSetter(I,"shiftBehavior","default"),e.Factory.addGetterSetter(I,"centeredScaling",!1),e.Factory.addGetterSetter(I,"ignoreStroke",!1),e.Factory.addGetterSetter(I,"padding",0,(0,o.getNumberValidator)()),e.Factory.addGetterSetter(I,"node"),e.Factory.addGetterSetter(I,"nodes"),e.Factory.addGetterSetter(I,"boundBoxFunc"),e.Factory.addGetterSetter(I,"anchorDragBoundFunc"),e.Factory.addGetterSetter(I,"anchorStyleFunc"),e.Factory.addGetterSetter(I,"shouldOverdrawWholeArea",!1),e.Factory.addGetterSetter(I,"useSingleNodeRotation",!0),e.Factory.backCompat(I,{lineEnabled:"borderEnabled",rotateHandlerOffset:"rotateAnchorOffset",enabledHandlers:"enabledAnchors"}),vg}var yg={},B5;function AG(){if(B5)return yg;B5=1,Object.defineProperty(yg,"__esModule",{value:!0}),yg.Wedge=void 0;const t=Ar(),e=ba(),r=Tr(),n=Dr(),i=Tr();let a=class extends e.Shape{_sceneFunc(o){o.beginPath(),o.arc(0,0,this.radius(),0,r.Konva.getAngle(this.angle()),this.clockwise()),o.lineTo(0,0),o.closePath(),o.fillStrokeShape(this)}getWidth(){return this.radius()*2}getHeight(){return this.radius()*2}setWidth(o){this.radius(o/2)}setHeight(o){this.radius(o/2)}};return yg.Wedge=a,a.prototype.className="Wedge",a.prototype._centroid=!0,a.prototype._attrsAffectingSize=["radius"],(0,i._registerNode)(a),t.Factory.addGetterSetter(a,"radius",0,(0,n.getNumberValidator)()),t.Factory.addGetterSetter(a,"angle",0,(0,n.getNumberValidator)()),t.Factory.addGetterSetter(a,"clockwise",!1),t.Factory.backCompat(a,{angleDeg:"angle",getAngleDeg:"getAngle",setAngleDeg:"setAngle"}),yg}var xg={},z5;function RG(){if(z5)return xg;z5=1,Object.defineProperty(xg,"__esModule",{value:!0}),xg.Blur=void 0;const t=Ar(),e=Ei(),r=Dr();function n(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}const i=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],a=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function s(l,u){const c=l.data,f=l.width,p=l.height;let v,y,S,w,E,_,T,N,R,I,F,D,j,B,G,K,O,W,U,q,Z,Q,ne,re,Y=u+u+1,J=f-1,ie=p-1,de=u+1,he=de*(de+1)/2,xe=new n,le=null,fe=xe,ve=null,ge=null,se=i[u],ye=a[u];for(S=1;S<Y;S++)fe=fe.next=new n,S===de&&(le=fe);for(fe.next=xe,T=_=0,y=0;y<p;y++){for(K=O=W=U=N=R=I=F=0,D=de*(q=c[_]),j=de*(Z=c[_+1]),B=de*(Q=c[_+2]),G=de*(ne=c[_+3]),N+=he*q,R+=he*Z,I+=he*Q,F+=he*ne,fe=xe,S=0;S<de;S++)fe.r=q,fe.g=Z,fe.b=Q,fe.a=ne,fe=fe.next;for(S=1;S<de;S++)w=_+((J<S?J:S)<<2),N+=(fe.r=q=c[w])*(re=de-S),R+=(fe.g=Z=c[w+1])*re,I+=(fe.b=Q=c[w+2])*re,F+=(fe.a=ne=c[w+3])*re,K+=q,O+=Z,W+=Q,U+=ne,fe=fe.next;for(ve=xe,ge=le,v=0;v<f;v++)c[_+3]=ne=F*se>>ye,ne!==0?(ne=255/ne,c[_]=(N*se>>ye)*ne,c[_+1]=(R*se>>ye)*ne,c[_+2]=(I*se>>ye)*ne):c[_]=c[_+1]=c[_+2]=0,N-=D,R-=j,I-=B,F-=G,D-=ve.r,j-=ve.g,B-=ve.b,G-=ve.a,w=T+((w=v+u+1)<J?w:J)<<2,K+=ve.r=c[w],O+=ve.g=c[w+1],W+=ve.b=c[w+2],U+=ve.a=c[w+3],N+=K,R+=O,I+=W,F+=U,ve=ve.next,D+=q=ge.r,j+=Z=ge.g,B+=Q=ge.b,G+=ne=ge.a,K-=q,O-=Z,W-=Q,U-=ne,ge=ge.next,_+=4;T+=f}for(v=0;v<f;v++){for(O=W=U=K=R=I=F=N=0,_=v<<2,D=de*(q=c[_]),j=de*(Z=c[_+1]),B=de*(Q=c[_+2]),G=de*(ne=c[_+3]),N+=he*q,R+=he*Z,I+=he*Q,F+=he*ne,fe=xe,S=0;S<de;S++)fe.r=q,fe.g=Z,fe.b=Q,fe.a=ne,fe=fe.next;for(E=f,S=1;S<=u;S++)_=E+v<<2,N+=(fe.r=q=c[_])*(re=de-S),R+=(fe.g=Z=c[_+1])*re,I+=(fe.b=Q=c[_+2])*re,F+=(fe.a=ne=c[_+3])*re,K+=q,O+=Z,W+=Q,U+=ne,fe=fe.next,S<ie&&(E+=f);for(_=v,ve=xe,ge=le,y=0;y<p;y++)w=_<<2,c[w+3]=ne=F*se>>ye,ne>0?(ne=255/ne,c[w]=(N*se>>ye)*ne,c[w+1]=(R*se>>ye)*ne,c[w+2]=(I*se>>ye)*ne):c[w]=c[w+1]=c[w+2]=0,N-=D,R-=j,I-=B,F-=G,D-=ve.r,j-=ve.g,B-=ve.b,G-=ve.a,w=v+((w=y+de)<ie?w:ie)*f<<2,N+=K+=ve.r=c[w],R+=O+=ve.g=c[w+1],I+=W+=ve.b=c[w+2],F+=U+=ve.a=c[w+3],ve=ve.next,D+=q=ge.r,j+=Z=ge.g,B+=Q=ge.b,G+=ne=ge.a,K-=q,O-=Z,W-=Q,U-=ne,ge=ge.next,_+=f}}const o=function(u){const c=Math.round(this.blurRadius());c>0&&s(u,c)};return xg.Blur=o,t.Factory.addGetterSetter(e.Node,"blurRadius",0,(0,r.getNumberValidator)(),t.Factory.afterSetFilter),xg}var bg={},U5;function LG(){if(U5)return bg;U5=1,Object.defineProperty(bg,"__esModule",{value:!0}),bg.Brighten=void 0;const t=Ar(),e=Ei(),r=Dr(),n=function(i){let a=this.brightness()*255,s=i.data,o=s.length,l;for(l=0;l<o;l+=4)s[l]+=a,s[l+1]+=a,s[l+2]+=a};return bg.Brighten=n,t.Factory.addGetterSetter(e.Node,"brightness",0,(0,r.getNumberValidator)(),t.Factory.afterSetFilter),bg}var wg={},G5;function OG(){if(G5)return wg;G5=1,Object.defineProperty(wg,"__esModule",{value:!0}),wg.Contrast=void 0;const t=Ar(),e=Ei(),r=Dr(),n=function(i){const a=Math.pow((this.contrast()+100)/100,2);let s=i.data,o=s.length,l=150,u=150,c=150,f;for(f=0;f<o;f+=4)l=s[f],u=s[f+1],c=s[f+2],l/=255,l-=.5,l*=a,l+=.5,l*=255,u/=255,u-=.5,u*=a,u+=.5,u*=255,c/=255,c-=.5,c*=a,c+=.5,c*=255,l=l<0?0:l>255?255:l,u=u<0?0:u>255?255:u,c=c<0?0:c>255?255:c,s[f]=l,s[f+1]=u,s[f+2]=c};return wg.Contrast=n,t.Factory.addGetterSetter(e.Node,"contrast",0,(0,r.getNumberValidator)(),t.Factory.afterSetFilter),wg}var Sg={},V5;function DG(){if(V5)return Sg;V5=1,Object.defineProperty(Sg,"__esModule",{value:!0}),Sg.Emboss=void 0;const t=Ar(),e=Ei(),r=pi(),n=Dr(),i=function(a){let s=this.embossStrength()*10,o=this.embossWhiteLevel()*255,l=this.embossDirection(),u=this.embossBlend(),c=0,f=0,p=a.data,v=a.width,y=a.height,S=v*4,w=y;switch(l){case"top-left":c=-1,f=-1;break;case"top":c=-1,f=0;break;case"top-right":c=-1,f=1;break;case"right":c=0,f=1;break;case"bottom-right":c=1,f=1;break;case"bottom":c=1,f=0;break;case"bottom-left":c=1,f=-1;break;case"left":c=0,f=-1;break;default:r.Util.error("Unknown emboss direction: "+l)}do{const E=(w-1)*S;let _=c;w+_<1&&(_=0),w+_>y&&(_=0);const T=(w-1+_)*v*4;let N=v;do{const R=E+(N-1)*4;let I=f;N+I<1&&(I=0),N+I>v&&(I=0);const F=T+(N-1+I)*4,D=p[R]-p[F],j=p[R+1]-p[F+1],B=p[R+2]-p[F+2];let G=D;const K=G>0?G:-G,O=j>0?j:-j,W=B>0?B:-B;if(O>K&&(G=j),W>K&&(G=B),G*=s,u){const U=p[R]+G,q=p[R+1]+G,Z=p[R+2]+G;p[R]=U>255?255:U<0?0:U,p[R+1]=q>255?255:q<0?0:q,p[R+2]=Z>255?255:Z<0?0:Z}else{let U=o-G;U<0?U=0:U>255&&(U=255),p[R]=p[R+1]=p[R+2]=U}}while(--N)}while(--w)};return Sg.Emboss=i,t.Factory.addGetterSetter(e.Node,"embossStrength",.5,(0,n.getNumberValidator)(),t.Factory.afterSetFilter),t.Factory.addGetterSetter(e.Node,"embossWhiteLevel",.5,(0,n.getNumberValidator)(),t.Factory.afterSetFilter),t.Factory.addGetterSetter(e.Node,"embossDirection","top-left",null,t.Factory.afterSetFilter),t.Factory.addGetterSetter(e.Node,"embossBlend",!1,null,t.Factory.afterSetFilter),Sg}var kg={},H5;function IG(){if(H5)return kg;H5=1,Object.defineProperty(kg,"__esModule",{value:!0}),kg.Enhance=void 0;const t=Ar(),e=Ei(),r=Dr();function n(a,s,o,l,u){let c=o-s,f=u-l,p;return c===0?l+f/2:f===0?l:(p=(a-s)/c,p=f*p+l,p)}const i=function(a){let s=a.data,o=s.length,l=s[0],u=l,c,f=s[1],p=f,v,y=s[2],S=y,w,E;const _=this.enhance();if(_===0)return;for(E=0;E<o;E+=4)c=s[E+0],c<l?l=c:c>u&&(u=c),v=s[E+1],v<f?f=v:v>p&&(p=v),w=s[E+2],w<y?y=w:w>S&&(S=w);u===l&&(u=255,l=0),p===f&&(p=255,f=0),S===y&&(S=255,y=0);let T,N,R,I,F,D,j,B,G;for(_>0?(N=u+_*(255-u),R=l-_*(l-0),F=p+_*(255-p),D=f-_*(f-0),B=S+_*(255-S),G=y-_*(y-0)):(T=(u+l)*.5,N=u+_*(u-T),R=l+_*(l-T),I=(p+f)*.5,F=p+_*(p-I),D=f+_*(f-I),j=(S+y)*.5,B=S+_*(S-j),G=y+_*(y-j)),E=0;E<o;E+=4)s[E+0]=n(s[E+0],l,u,R,N),s[E+1]=n(s[E+1],f,p,D,F),s[E+2]=n(s[E+2],y,S,G,B)};return kg.Enhance=i,t.Factory.addGetterSetter(e.Node,"enhance",0,(0,r.getNumberValidator)(),t.Factory.afterSetFilter),kg}var _g={},W5;function jG(){if(W5)return _g;W5=1,Object.defineProperty(_g,"__esModule",{value:!0}),_g.Grayscale=void 0;const t=function(e){let r=e.data,n=r.length,i,a;for(i=0;i<n;i+=4)a=.34*r[i]+.5*r[i+1]+.16*r[i+2],r[i]=a,r[i+1]=a,r[i+2]=a};return _g.Grayscale=t,_g}var Cg={},q5;function FG(){if(q5)return Cg;q5=1,Object.defineProperty(Cg,"__esModule",{value:!0}),Cg.HSL=void 0;const t=Ar(),e=Ei(),r=Dr();t.Factory.addGetterSetter(e.Node,"hue",0,(0,r.getNumberValidator)(),t.Factory.afterSetFilter),t.Factory.addGetterSetter(e.Node,"saturation",0,(0,r.getNumberValidator)(),t.Factory.afterSetFilter),t.Factory.addGetterSetter(e.Node,"luminance",0,(0,r.getNumberValidator)(),t.Factory.afterSetFilter);const n=function(i){let a=i.data,s=a.length,o=1,l=Math.pow(2,this.saturation()),u=Math.abs(this.hue()+360)%360,c=this.luminance()*127,f;const p=o*l*Math.cos(u*Math.PI/180),v=o*l*Math.sin(u*Math.PI/180),y=.299*o+.701*p+.167*v,S=.587*o-.587*p+.33*v,w=.114*o-.114*p-.497*v,E=.299*o-.299*p-.328*v,_=.587*o+.413*p+.035*v,T=.114*o-.114*p+.293*v,N=.299*o-.3*p+1.25*v,R=.587*o-.586*p-1.05*v,I=.114*o+.886*p-.2*v;let F,D,j,B;for(f=0;f<s;f+=4)F=a[f+0],D=a[f+1],j=a[f+2],B=a[f+3],a[f+0]=y*F+S*D+w*j+c,a[f+1]=E*F+_*D+T*j+c,a[f+2]=N*F+R*D+I*j+c,a[f+3]=B};return Cg.HSL=n,Cg}var Eg={},$5;function BG(){if($5)return Eg;$5=1,Object.defineProperty(Eg,"__esModule",{value:!0}),Eg.HSV=void 0;const t=Ar(),e=Ei(),r=Dr(),n=function(i){const a=i.data,s=a.length,o=Math.pow(2,this.value()),l=Math.pow(2,this.saturation()),u=Math.abs(this.hue()+360)%360,c=o*l*Math.cos(u*Math.PI/180),f=o*l*Math.sin(u*Math.PI/180),p=.299*o+.701*c+.167*f,v=.587*o-.587*c+.33*f,y=.114*o-.114*c-.497*f,S=.299*o-.299*c-.328*f,w=.587*o+.413*c+.035*f,E=.114*o-.114*c+.293*f,_=.299*o-.3*c+1.25*f,T=.587*o-.586*c-1.05*f,N=.114*o+.886*c-.2*f;let R,I,F,D;for(let j=0;j<s;j+=4)R=a[j+0],I=a[j+1],F=a[j+2],D=a[j+3],a[j+0]=p*R+v*I+y*F,a[j+1]=S*R+w*I+E*F,a[j+2]=_*R+T*I+N*F,a[j+3]=D};return Eg.HSV=n,t.Factory.addGetterSetter(e.Node,"hue",0,(0,r.getNumberValidator)(),t.Factory.afterSetFilter),t.Factory.addGetterSetter(e.Node,"saturation",0,(0,r.getNumberValidator)(),t.Factory.afterSetFilter),t.Factory.addGetterSetter(e.Node,"value",0,(0,r.getNumberValidator)(),t.Factory.afterSetFilter),Eg}var Tg={},K5;function zG(){if(K5)return Tg;K5=1,Object.defineProperty(Tg,"__esModule",{value:!0}),Tg.Invert=void 0;const t=function(e){let r=e.data,n=r.length,i;for(i=0;i<n;i+=4)r[i]=255-r[i],r[i+1]=255-r[i+1],r[i+2]=255-r[i+2]};return Tg.Invert=t,Tg}var Ng={},Z5;function UG(){if(Z5)return Ng;Z5=1,Object.defineProperty(Ng,"__esModule",{value:!0}),Ng.Kaleidoscope=void 0;const t=Ar(),e=Ei(),r=pi(),n=Dr(),i=function(o,l,u){let c=o.data,f=l.data,p=o.width,v=o.height,y=u.polarCenterX||p/2,S=u.polarCenterY||v/2,w,E,_,T=0,N=0,R=0,I=0,F,D=Math.sqrt(y*y+S*S);E=p-y,_=v-S,F=Math.sqrt(E*E+_*_),D=F>D?F:D;let j=v,B=p,G,K,O=360/B*Math.PI/180,W,U;for(K=0;K<B;K+=1)for(W=Math.sin(K*O),U=Math.cos(K*O),G=0;G<j;G+=1)E=Math.floor(y+D*G/j*U),_=Math.floor(S+D*G/j*W),w=(_*p+E)*4,T=c[w+0],N=c[w+1],R=c[w+2],I=c[w+3],w=(K+G*p)*4,f[w+0]=T,f[w+1]=N,f[w+2]=R,f[w+3]=I},a=function(o,l,u){let c=o.data,f=l.data,p=o.width,v=o.height,y=u.polarCenterX||p/2,S=u.polarCenterY||v/2,w,E,_,T,N,R=0,I=0,F=0,D=0,j,B=Math.sqrt(y*y+S*S);E=p-y,_=v-S,j=Math.sqrt(E*E+_*_),B=j>B?j:B;let G=v,K=p,O,W,U=0,q,Z;for(E=0;E<p;E+=1)for(_=0;_<v;_+=1)T=E-y,N=_-S,O=Math.sqrt(T*T+N*N)*G/B,W=(Math.atan2(N,T)*180/Math.PI+360+U)%360,W=W*K/360,q=Math.floor(W),Z=Math.floor(O),w=(Z*p+q)*4,R=c[w+0],I=c[w+1],F=c[w+2],D=c[w+3],w=(_*p+E)*4,f[w+0]=R,f[w+1]=I,f[w+2]=F,f[w+3]=D},s=function(o){const l=o.width,u=o.height;let c,f,p,v,y,S,w,E,_,T,N=Math.round(this.kaleidoscopePower());const R=Math.round(this.kaleidoscopeAngle()),I=Math.floor(l*(R%360)/360);if(N<1)return;const F=r.Util.createCanvasElement();F.width=l,F.height=u;const D=F.getContext("2d").getImageData(0,0,l,u);r.Util.releaseCanvas(F),i(o,D,{polarCenterX:l/2,polarCenterY:u/2});let j=l/Math.pow(2,N);for(;j<=8;)j=j*2,N-=1;j=Math.ceil(j);let B=j,G=0,K=B,O=1;for(I+j>l&&(G=B,K=0,O=-1),f=0;f<u;f+=1)for(c=G;c!==K;c+=O)p=Math.round(c+I)%l,_=(l*f+p)*4,y=D.data[_+0],S=D.data[_+1],w=D.data[_+2],E=D.data[_+3],T=(l*f+c)*4,D.data[T+0]=y,D.data[T+1]=S,D.data[T+2]=w,D.data[T+3]=E;for(f=0;f<u;f+=1)for(B=Math.floor(j),v=0;v<N;v+=1){for(c=0;c<B+1;c+=1)_=(l*f+c)*4,y=D.data[_+0],S=D.data[_+1],w=D.data[_+2],E=D.data[_+3],T=(l*f+B*2-c-1)*4,D.data[T+0]=y,D.data[T+1]=S,D.data[T+2]=w,D.data[T+3]=E;B*=2}a(D,o,{})};return Ng.Kaleidoscope=s,t.Factory.addGetterSetter(e.Node,"kaleidoscopePower",2,(0,n.getNumberValidator)(),t.Factory.afterSetFilter),t.Factory.addGetterSetter(e.Node,"kaleidoscopeAngle",0,(0,n.getNumberValidator)(),t.Factory.afterSetFilter),Ng}var Pg={},Y5;function GG(){if(Y5)return Pg;Y5=1,Object.defineProperty(Pg,"__esModule",{value:!0}),Pg.Mask=void 0;const t=Ar(),e=Ei(),r=Dr();function n(p,v,y){let S=(y*p.width+v)*4;const w=[];return w.push(p.data[S++],p.data[S++],p.data[S++],p.data[S++]),w}function i(p,v){return Math.sqrt(Math.pow(p[0]-v[0],2)+Math.pow(p[1]-v[1],2)+Math.pow(p[2]-v[2],2))}function a(p){const v=[0,0,0];for(let y=0;y<p.length;y++)v[0]+=p[y][0],v[1]+=p[y][1],v[2]+=p[y][2];return v[0]/=p.length,v[1]/=p.length,v[2]/=p.length,v}function s(p,v){const y=n(p,0,0),S=n(p,p.width-1,0),w=n(p,0,p.height-1),E=n(p,p.width-1,p.height-1),_=v||10;if(i(y,S)<_&&i(S,E)<_&&i(E,w)<_&&i(w,y)<_){const T=a([S,y,E,w]),N=[];for(let R=0;R<p.width*p.height;R++){const I=i(T,[p.data[R*4],p.data[R*4+1],p.data[R*4+2]]);N[R]=I<_?0:255}return N}}function o(p,v){for(let y=0;y<p.width*p.height;y++)p.data[4*y+3]=v[y]}function l(p,v,y){const S=[1,1,1,1,0,1,1,1,1],w=Math.round(Math.sqrt(S.length)),E=Math.floor(w/2),_=[];for(let T=0;T<y;T++)for(let N=0;N<v;N++){const R=T*v+N;let I=0;for(let F=0;F<w;F++)for(let D=0;D<w;D++){const j=T+F-E,B=N+D-E;if(j>=0&&j<y&&B>=0&&B<v){const G=j*v+B,K=S[F*w+D];I+=p[G]*K}}_[R]=I===2040?255:0}return _}function u(p,v,y){const S=[1,1,1,1,1,1,1,1,1],w=Math.round(Math.sqrt(S.length)),E=Math.floor(w/2),_=[];for(let T=0;T<y;T++)for(let N=0;N<v;N++){const R=T*v+N;let I=0;for(let F=0;F<w;F++)for(let D=0;D<w;D++){const j=T+F-E,B=N+D-E;if(j>=0&&j<y&&B>=0&&B<v){const G=j*v+B,K=S[F*w+D];I+=p[G]*K}}_[R]=I>=1020?255:0}return _}function c(p,v,y){const S=[.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111],w=Math.round(Math.sqrt(S.length)),E=Math.floor(w/2),_=[];for(let T=0;T<y;T++)for(let N=0;N<v;N++){const R=T*v+N;let I=0;for(let F=0;F<w;F++)for(let D=0;D<w;D++){const j=T+F-E,B=N+D-E;if(j>=0&&j<y&&B>=0&&B<v){const G=j*v+B,K=S[F*w+D];I+=p[G]*K}}_[R]=I}return _}const f=function(p){let v=this.threshold(),y=s(p,v);return y&&(y=l(y,p.width,p.height),y=u(y,p.width,p.height),y=c(y,p.width,p.height),o(p,y)),p};return Pg.Mask=f,t.Factory.addGetterSetter(e.Node,"threshold",0,(0,r.getNumberValidator)(),t.Factory.afterSetFilter),Pg}var Mg={},X5;function VG(){if(X5)return Mg;X5=1,Object.defineProperty(Mg,"__esModule",{value:!0}),Mg.Noise=void 0;const t=Ar(),e=Ei(),r=Dr(),n=function(i){const a=this.noise()*255,s=i.data,o=s.length,l=a/2;for(let u=0;u<o;u+=4)s[u+0]+=l-2*l*Math.random(),s[u+1]+=l-2*l*Math.random(),s[u+2]+=l-2*l*Math.random()};return Mg.Noise=n,t.Factory.addGetterSetter(e.Node,"noise",.2,(0,r.getNumberValidator)(),t.Factory.afterSetFilter),Mg}var Ag={},Q5;function HG(){if(Q5)return Ag;Q5=1,Object.defineProperty(Ag,"__esModule",{value:!0}),Ag.Pixelate=void 0;const t=Ar(),e=pi(),r=Ei(),n=Dr(),i=function(a){let s=Math.ceil(this.pixelSize()),o=a.width,l=a.height,u,c,f,p,v,y,S,w=Math.ceil(o/s),E=Math.ceil(l/s),_,T,N,R,I,F,D,j=a.data;if(s<=0){e.Util.error("pixelSize value can not be <= 0");return}for(I=0;I<w;I+=1)for(F=0;F<E;F+=1){for(p=0,v=0,y=0,S=0,_=I*s,T=_+s,N=F*s,R=N+s,D=0,u=_;u<T;u+=1)if(!(u>=o))for(c=N;c<R;c+=1)c>=l||(f=(o*c+u)*4,p+=j[f+0],v+=j[f+1],y+=j[f+2],S+=j[f+3],D+=1);for(p=p/D,v=v/D,y=y/D,S=S/D,u=_;u<T;u+=1)if(!(u>=o))for(c=N;c<R;c+=1)c>=l||(f=(o*c+u)*4,j[f+0]=p,j[f+1]=v,j[f+2]=y,j[f+3]=S)}};return Ag.Pixelate=i,t.Factory.addGetterSetter(r.Node,"pixelSize",8,(0,n.getNumberValidator)(),t.Factory.afterSetFilter),Ag}var Rg={},J5;function WG(){if(J5)return Rg;J5=1,Object.defineProperty(Rg,"__esModule",{value:!0}),Rg.Posterize=void 0;const t=Ar(),e=Ei(),r=Dr(),n=function(i){let a=Math.round(this.levels()*254)+1,s=i.data,o=s.length,l=255/a,u;for(u=0;u<o;u+=1)s[u]=Math.floor(s[u]/l)*l};return Rg.Posterize=n,t.Factory.addGetterSetter(e.Node,"levels",.5,(0,r.getNumberValidator)(),t.Factory.afterSetFilter),Rg}var Lg={},e4;function qG(){if(e4)return Lg;e4=1,Object.defineProperty(Lg,"__esModule",{value:!0}),Lg.RGB=void 0;const t=Ar(),e=Ei(),r=Dr(),n=function(i){let a=i.data,s=a.length,o=this.red(),l=this.green(),u=this.blue(),c,f;for(c=0;c<s;c+=4)f=(.34*a[c]+.5*a[c+1]+.16*a[c+2])/255,a[c]=f*o,a[c+1]=f*l,a[c+2]=f*u,a[c+3]=a[c+3]};return Lg.RGB=n,t.Factory.addGetterSetter(e.Node,"red",0,function(i){return this._filterUpToDate=!1,i>255?255:i<0?0:Math.round(i)}),t.Factory.addGetterSetter(e.Node,"green",0,function(i){return this._filterUpToDate=!1,i>255?255:i<0?0:Math.round(i)}),t.Factory.addGetterSetter(e.Node,"blue",0,r.RGBComponent,t.Factory.afterSetFilter),Lg}var Og={},t4;function $G(){if(t4)return Og;t4=1,Object.defineProperty(Og,"__esModule",{value:!0}),Og.RGBA=void 0;const t=Ar(),e=Ei(),r=Dr(),n=function(i){const a=i.data,s=a.length,o=this.red(),l=this.green(),u=this.blue(),c=this.alpha();for(let f=0;f<s;f+=4){const p=1-c;a[f]=o*c+a[f]*p,a[f+1]=l*c+a[f+1]*p,a[f+2]=u*c+a[f+2]*p}};return Og.RGBA=n,t.Factory.addGetterSetter(e.Node,"red",0,function(i){return this._filterUpToDate=!1,i>255?255:i<0?0:Math.round(i)}),t.Factory.addGetterSetter(e.Node,"green",0,function(i){return this._filterUpToDate=!1,i>255?255:i<0?0:Math.round(i)}),t.Factory.addGetterSetter(e.Node,"blue",0,r.RGBComponent,t.Factory.afterSetFilter),t.Factory.addGetterSetter(e.Node,"alpha",1,function(i){return this._filterUpToDate=!1,i>1?1:i<0?0:i}),Og}var Dg={},r4;function KG(){if(r4)return Dg;r4=1,Object.defineProperty(Dg,"__esModule",{value:!0}),Dg.Sepia=void 0;const t=function(e){let r=e.data,n=r.length,i,a,s,o;for(i=0;i<n;i+=4)a=r[i+0],s=r[i+1],o=r[i+2],r[i+0]=Math.min(255,a*.393+s*.769+o*.189),r[i+1]=Math.min(255,a*.349+s*.686+o*.168),r[i+2]=Math.min(255,a*.272+s*.534+o*.131)};return Dg.Sepia=t,Dg}var Ig={},n4;function ZG(){if(n4)return Ig;n4=1,Object.defineProperty(Ig,"__esModule",{value:!0}),Ig.Solarize=void 0;const t=function(e){const r=e.data,n=e.width,i=e.height,a=n*4;let s=i;do{const o=(s-1)*a;let l=n;do{const u=o+(l-1)*4;let c=r[u],f=r[u+1],p=r[u+2];c>127&&(c=255-c),f>127&&(f=255-f),p>127&&(p=255-p),r[u]=c,r[u+1]=f,r[u+2]=p}while(--l)}while(--s)};return Ig.Solarize=t,Ig}var jg={},i4;function YG(){if(i4)return jg;i4=1,Object.defineProperty(jg,"__esModule",{value:!0}),jg.Threshold=void 0;const t=Ar(),e=Ei(),r=Dr(),n=function(i){const a=this.threshold()*255,s=i.data,o=s.length;for(let l=0;l<o;l+=1)s[l]=s[l]<a?0:255};return jg.Threshold=n,t.Factory.addGetterSetter(e.Node,"threshold",.5,(0,r.getNumberValidator)(),t.Factory.afterSetFilter),jg}var a4;function XG(){if(a4)return Xm;a4=1,Object.defineProperty(Xm,"__esModule",{value:!0}),Xm.Konva=void 0;const t=JS(),e=yG(),r=bG(),n=wG(),i=SG(),a=kG(),s=_G(),o=wR(),l=k_(),u=SR(),c=CG(),f=EG(),p=TG(),v=NG(),y=kR(),S=PG(),w=MG(),E=AG(),_=RG(),T=LG(),N=OG(),R=DG(),I=IG(),F=jG(),D=FG(),j=BG(),B=zG(),G=UG(),K=GG(),O=VG(),W=HG(),U=WG(),q=qG(),Z=$G(),Q=KG(),ne=ZG(),re=YG();return Xm.Konva=t.Konva.Util._assign(t.Konva,{Arc:e.Arc,Arrow:r.Arrow,Circle:n.Circle,Ellipse:i.Ellipse,Image:a.Image,Label:s.Label,Tag:s.Tag,Line:o.Line,Path:l.Path,Rect:u.Rect,RegularPolygon:c.RegularPolygon,Ring:f.Ring,Sprite:p.Sprite,Star:v.Star,Text:y.Text,TextPath:S.TextPath,Transformer:w.Transformer,Wedge:E.Wedge,Filters:{Blur:_.Blur,Brighten:T.Brighten,Contrast:N.Contrast,Emboss:R.Emboss,Enhance:I.Enhance,Grayscale:F.Grayscale,HSL:D.HSL,HSV:j.HSV,Invert:B.Invert,Kaleidoscope:G.Kaleidoscope,Mask:K.Mask,Noise:O.Noise,Pixelate:W.Pixelate,Posterize:U.Posterize,RGB:q.RGB,RGBA:Z.RGBA,Sepia:Q.Sepia,Solarize:ne.Solarize,Threshold:re.Threshold}}),Xm}var QG=Wy.exports,s4;function JG(){if(s4)return Wy.exports;s4=1,Object.defineProperty(QG,"__esModule",{value:!0});const t=XG();return Wy.exports=t.Konva,Wy.exports}JG();var hy={exports:{}},o4;function eV(){return o4||(o4=1,(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.Konva=void 0;var r=JS();Object.defineProperty(e,"Konva",{enumerable:!0,get:function(){return r.Konva}});const n=JS();t.exports=n.Konva})(hy,hy.exports)),hy.exports}var tV=eV();const Pv=Th(tV);var L2={exports:{}};var O2,l4;function rV(){return l4||(l4=1,O2=function(e){var r={},n=sm(),i=Hk(),a=Object.assign;function s(x){for(var b="https://reactjs.org/docs/error-decoder.html?invariant="+x,M=1;M<arguments.length;M++)b+="&args[]="+encodeURIComponent(arguments[M]);return"Minified React error #"+x+"; visit "+b+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,l=Symbol.for("react.element"),u=Symbol.for("react.portal"),c=Symbol.for("react.fragment"),f=Symbol.for("react.strict_mode"),p=Symbol.for("react.profiler"),v=Symbol.for("react.provider"),y=Symbol.for("react.context"),S=Symbol.for("react.forward_ref"),w=Symbol.for("react.suspense"),E=Symbol.for("react.suspense_list"),_=Symbol.for("react.memo"),T=Symbol.for("react.lazy"),N=Symbol.for("react.offscreen"),R=Symbol.iterator;function I(x){return x===null||typeof x!="object"?null:(x=R&&x[R]||x["@@iterator"],typeof x=="function"?x:null)}function F(x){if(x==null)return null;if(typeof x=="function")return x.displayName||x.name||null;if(typeof x=="string")return x;switch(x){case c:return"Fragment";case u:return"Portal";case p:return"Profiler";case f:return"StrictMode";case w:return"Suspense";case E:return"SuspenseList"}if(typeof x=="object")switch(x.$$typeof){case y:return(x.displayName||"Context")+".Consumer";case v:return(x._context.displayName||"Context")+".Provider";case S:var b=x.render;return x=x.displayName,x||(x=b.displayName||b.name||"",x=x!==""?"ForwardRef("+x+")":"ForwardRef"),x;case _:return b=x.displayName||null,b!==null?b:F(x.type)||"Memo";case T:b=x._payload,x=x._init;try{return F(x(b))}catch{}}return null}function D(x){var b=x.type;switch(x.tag){case 24:return"Cache";case 9:return(b.displayName||"Context")+".Consumer";case 10:return(b._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return x=b.render,x=x.displayName||x.name||"",b.displayName||(x!==""?"ForwardRef("+x+")":"ForwardRef");case 7:return"Fragment";case 5:return b;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return F(b);case 8:return b===f?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof b=="function")return b.displayName||b.name||null;if(typeof b=="string")return b}return null}function j(x){var b=x,M=x;if(x.alternate)for(;b.return;)b=b.return;else{x=b;do b=x,(b.flags&4098)!==0&&(M=b.return),x=b.return;while(x)}return b.tag===3?M:null}function B(x){if(j(x)!==x)throw Error(s(188))}function G(x){var b=x.alternate;if(!b){if(b=j(x),b===null)throw Error(s(188));return b!==x?null:x}for(var M=x,z=b;;){var $=M.return;if($===null)break;var te=$.alternate;if(te===null){if(z=$.return,z!==null){M=z;continue}break}if($.child===te.child){for(te=$.child;te;){if(te===M)return B($),x;if(te===z)return B($),b;te=te.sibling}throw Error(s(188))}if(M.return!==z.return)M=$,z=te;else{for(var pe=!1,Ne=$.child;Ne;){if(Ne===M){pe=!0,M=$,z=te;break}if(Ne===z){pe=!0,z=$,M=te;break}Ne=Ne.sibling}if(!pe){for(Ne=te.child;Ne;){if(Ne===M){pe=!0,M=te,z=$;break}if(Ne===z){pe=!0,z=te,M=$;break}Ne=Ne.sibling}if(!pe)throw Error(s(189))}}if(M.alternate!==z)throw Error(s(190))}if(M.tag!==3)throw Error(s(188));return M.stateNode.current===M?x:b}function K(x){return x=G(x),x!==null?O(x):null}function O(x){if(x.tag===5||x.tag===6)return x;for(x=x.child;x!==null;){var b=O(x);if(b!==null)return b;x=x.sibling}return null}function W(x){if(x.tag===5||x.tag===6)return x;for(x=x.child;x!==null;){if(x.tag!==4){var b=W(x);if(b!==null)return b}x=x.sibling}return null}var U=Array.isArray,q=e.getPublicInstance,Z=e.getRootHostContext,Q=e.getChildHostContext,ne=e.prepareForCommit,re=e.resetAfterCommit,Y=e.createInstance,J=e.appendInitialChild,ie=e.finalizeInitialChildren,de=e.prepareUpdate,he=e.shouldSetTextContent,xe=e.createTextInstance,le=e.scheduleTimeout,fe=e.cancelTimeout,ve=e.noTimeout,ge=e.isPrimaryRenderer,se=e.supportsMutation,ye=e.supportsPersistence,Se=e.supportsHydration,Ue=e.getInstanceFromNode,Oe=e.preparePortalMount,mt=e.getCurrentEventPriority,lt=e.detachDeletedInstance,at=e.supportsMicrotasks,wt=e.scheduleMicrotask,$e=e.supportsTestSelectors,Ce=e.findFiberRoot,Ie=e.getBoundingRect,Je=e.getTextContent,Qe=e.isHiddenSubtree,gt=e.matchAccessibilityRole,At=e.setFocusIfFocusable,Rt=e.setupIntersectionObserver,Ut=e.appendChild,Vt=e.appendChildToContainer,pt=e.commitTextUpdate,dt=e.commitMount,Ge=e.commitUpdate,ce=e.insertBefore,me=e.insertInContainerBefore,ke=e.removeChild,Te=e.removeChildFromContainer,Ae=e.resetTextContent,Xe=e.hideInstance,Ve=e.hideTextInstance,yt=e.unhideInstance,vt=e.unhideTextInstance,ft=e.clearContainer,Zt=e.cloneInstance,Ht=e.createContainerChildSet,Et=e.appendChildToContainerChildSet,Wt=e.finalizeContainerChildren,ar=e.replaceContainerChildren,Rr=e.cloneHiddenInstance,kr=e.cloneHiddenTextInstance,Qr=e.canHydrateInstance,Jr=e.canHydrateTextInstance,_r=e.canHydrateSuspenseInstance,fn=e.isSuspenseInstancePending,vr=e.isSuspenseInstanceFallback,St=e.getSuspenseInstanceFallbackErrorDetails,Br=e.registerSuspenseInstanceRetry,Xn=e.getNextHydratableSibling,Yi=e.getFirstHydratableChild,ds=e.getFirstHydratableChildWithinContainer,As=e.getFirstHydratableChildWithinSuspenseInstance,ni=e.hydrateInstance,sn=e.hydrateTextInstance,kn=e.hydrateSuspenseInstance,In=e.getNextHydratableInstanceAfterSuspenseInstance,Rs=e.commitHydratedContainer,gi=e.commitHydratedSuspenseInstance,So=e.clearSuspenseBoundary,qa=e.clearSuspenseBoundaryFromContainer,Lu=e.shouldDeleteUnhydratedTailInstances,ko=e.didNotMatchHydratedContainerTextInstance,on=e.didNotMatchHydratedTextInstance,_o;function fs(x){if(_o===void 0)try{throw Error()}catch(M){var b=M.stack.trim().match(/\n( *(at )?)/);_o=b&&b[1]||""}return`
`+_o+x}var to=!1;function Xi(x,b){if(!x||to)return"";to=!0;var M=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(b)if(b=function(){throw Error()},Object.defineProperty(b.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(b,[])}catch(ct){var z=ct}Reflect.construct(x,[],b)}else{try{b.call()}catch(ct){z=ct}x.call(b.prototype)}else{try{throw Error()}catch(ct){z=ct}x()}}catch(ct){if(ct&&z&&typeof ct.stack=="string"){for(var $=ct.stack.split(`
`),te=z.stack.split(`
`),pe=$.length-1,Ne=te.length-1;1<=pe&&0<=Ne&&$[pe]!==te[Ne];)Ne--;for(;1<=pe&&0<=Ne;pe--,Ne--)if($[pe]!==te[Ne]){if(pe!==1||Ne!==1)do if(pe--,Ne--,0>Ne||$[pe]!==te[Ne]){var Be=`
`+$[pe].replace(" at new "," at ");return x.displayName&&Be.includes("<anonymous>")&&(Be=Be.replace("<anonymous>",x.displayName)),Be}while(1<=pe&&0<=Ne);break}}}finally{to=!1,Error.prepareStackTrace=M}return(x=x?x.displayName||x.name:"")?fs(x):""}var ro=Object.prototype.hasOwnProperty,ze=[],Ke=-1;function tt(x){return{current:x}}function ot(x){0>Ke||(x.current=ze[Ke],ze[Ke]=null,Ke--)}function qe(x,b){Ke++,ze[Ke]=x.current,x.current=b}var Mt={},Nr=tt(Mt),Pr=tt(!1),Fr=Mt;function vi(x,b){var M=x.type.contextTypes;if(!M)return Mt;var z=x.stateNode;if(z&&z.__reactInternalMemoizedUnmaskedChildContext===b)return z.__reactInternalMemoizedMaskedChildContext;var $={},te;for(te in M)$[te]=b[te];return z&&(x=x.stateNode,x.__reactInternalMemoizedUnmaskedChildContext=b,x.__reactInternalMemoizedMaskedChildContext=$),$}function It(x){return x=x.childContextTypes,x!=null}function Ir(){ot(Pr),ot(Nr)}function al(x,b,M){if(Nr.current!==Mt)throw Error(s(168));qe(Nr,b),qe(Pr,M)}function Qt(x,b,M){var z=x.stateNode;if(b=b.childContextTypes,typeof z.getChildContext!="function")return M;z=z.getChildContext();for(var $ in z)if(!($ in b))throw Error(s(108,D(x)||"Unknown",$));return a({},M,z)}function er(x){return x=(x=x.stateNode)&&x.__reactInternalMemoizedMergedChildContext||Mt,Fr=Nr.current,qe(Nr,x),qe(Pr,Pr.current),!0}function Lr(x,b,M){var z=x.stateNode;if(!z)throw Error(s(169));M?(x=Qt(x,b,Fr),z.__reactInternalMemoizedMergedChildContext=x,ot(Pr),ot(Nr),qe(Nr,x)):ot(Pr),qe(Pr,M)}var Jt=Math.clz32?Math.clz32:no,en=Math.log,yn=Math.LN2;function no(x){return x>>>=0,x===0?32:31-(en(x)/yn|0)|0}var xr=64,io=4194304;function Co(x){switch(x&-x){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return x&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return x&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return x}}function Ls(x,b){var M=x.pendingLanes;if(M===0)return 0;var z=0,$=x.suspendedLanes,te=x.pingedLanes,pe=M&268435455;if(pe!==0){var Ne=pe&~$;Ne!==0?z=Co(Ne):(te&=pe,te!==0&&(z=Co(te)))}else pe=M&~$,pe!==0?z=Co(pe):te!==0&&(z=Co(te));if(z===0)return 0;if(b!==0&&b!==z&&(b&$)===0&&($=z&-z,te=b&-b,$>=te||$===16&&(te&4194240)!==0))return b;if((z&4)!==0&&(z|=M&16),b=x.entangledLanes,b!==0)for(x=x.entanglements,b&=z;0<b;)M=31-Jt(b),$=1<<M,z|=x[M],b&=~$;return z}function Cc(x,b){switch(x){case 1:case 2:case 4:return b+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return b+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Ec(x,b){for(var M=x.suspendedLanes,z=x.pingedLanes,$=x.expirationTimes,te=x.pendingLanes;0<te;){var pe=31-Jt(te),Ne=1<<pe,Be=$[pe];Be===-1?((Ne&M)===0||(Ne&z)!==0)&&($[pe]=Cc(Ne,b)):Be<=b&&(x.expiredLanes|=Ne),te&=~Ne}}function sl(x){return x=x.pendingLanes&-1073741825,x!==0?x:x&1073741824?1073741824:0}function Gl(){var x=xr;return xr<<=1,(xr&4194240)===0&&(xr=64),x}function Eo(x){for(var b=[],M=0;31>M;M++)b.push(x);return b}function Fi(x,b,M){x.pendingLanes|=b,b!==536870912&&(x.suspendedLanes=0,x.pingedLanes=0),x=x.eventTimes,b=31-Jt(b),x[b]=M}function ao(x,b){var M=x.pendingLanes&~b;x.pendingLanes=b,x.suspendedLanes=0,x.pingedLanes=0,x.expiredLanes&=b,x.mutableReadLanes&=b,x.entangledLanes&=b,b=x.entanglements;var z=x.eventTimes;for(x=x.expirationTimes;0<M;){var $=31-Jt(M),te=1<<$;b[$]=0,z[$]=-1,x[$]=-1,M&=~te}}function $a(x,b){var M=x.entangledLanes|=b;for(x=x.entanglements;M;){var z=31-Jt(M),$=1<<z;$&b|x[z]&b&&(x[z]|=b),M&=~$}}var br=0;function sr(x){return x&=-x,1<x?4<x?(x&268435455)!==0?16:536870912:4:1}var Qn=i.unstable_scheduleCallback,$r=i.unstable_cancelCallback,vf=i.unstable_shouldYield,ol=i.unstable_requestPaint,jn=i.unstable_now,Vl=i.unstable_ImmediatePriority,Os=i.unstable_UserBlockingPriority,Hl=i.unstable_NormalPriority,Ou=i.unstable_IdlePriority,hn=null,Fn=null;function ll(x){if(Fn&&typeof Fn.onCommitFiberRoot=="function")try{Fn.onCommitFiberRoot(hn,x,void 0,(x.current.flags&128)===128)}catch{}}function Du(x,b){return x===b&&(x!==0||1/x===1/b)||x!==x&&b!==b}var hs=typeof Object.is=="function"?Object.is:Du,Ds=null,To=!1,Wl=!1;function Iu(x){Ds===null?Ds=[x]:Ds.push(x)}function Cr(x){To=!0,Iu(x)}function yi(){if(!Wl&&Ds!==null){Wl=!0;var x=0,b=br;try{var M=Ds;for(br=1;x<M.length;x++){var z=M[x];do z=z(!0);while(z!==null)}Ds=null,To=!1}catch($){throw Ds!==null&&(Ds=Ds.slice(x+1)),Qn(Vl,yi),$}finally{br=b,Wl=!1}}return null}var ii=[],wa=0,ql=null,ul=0,xi=[],Sa=0,Bn=null,Qi=1,ps="";function ka(x,b){ii[wa++]=ul,ii[wa++]=ql,ql=x,ul=b}function Oh(x,b,M){xi[Sa++]=Qi,xi[Sa++]=ps,xi[Sa++]=Bn,Bn=x;var z=Qi;x=ps;var $=32-Jt(z)-1;z&=~(1<<$),M+=1;var te=32-Jt(b)+$;if(30<te){var pe=$-$%5;te=(z&(1<<pe)-1).toString(32),z>>=pe,$-=pe,Qi=1<<32-Jt(b)+$|M<<$|z,ps=te+x}else Qi=1<<te|M<<$|z,ps=x}function Ji(x){x.return!==null&&(ka(x,1),Oh(x,1,0))}function ju(x){for(;x===ql;)ql=ii[--wa],ii[wa]=null,ul=ii[--wa],ii[wa]=null;for(;x===Bn;)Bn=xi[--Sa],xi[Sa]=null,ps=xi[--Sa],xi[Sa]=null,Qi=xi[--Sa],xi[Sa]=null}var ai=null,_n=null,tn=!1,$l=!1,_a=null;function Dh(x,b){var M=ks(5,null,null,0);M.elementType="DELETED",M.stateNode=b,M.return=x,b=x.deletions,b===null?(x.deletions=[M],x.flags|=16):b.push(M)}function Fu(x,b){switch(x.tag){case 5:return b=Qr(b,x.type,x.pendingProps),b!==null?(x.stateNode=b,ai=x,_n=Yi(b),!0):!1;case 6:return b=Jr(b,x.pendingProps),b!==null?(x.stateNode=b,ai=x,_n=null,!0):!1;case 13:if(b=_r(b),b!==null){var M=Bn!==null?{id:Qi,overflow:ps}:null;return x.memoizedState={dehydrated:b,treeContext:M,retryLane:1073741824},M=ks(18,null,null,0),M.stateNode=b,M.return=x,x.child=M,ai=x,_n=null,!0}return!1;default:return!1}}function Tc(x){return(x.mode&1)!==0&&(x.flags&128)===0}function yf(x){if(tn){var b=_n;if(b){var M=b;if(!Fu(x,b)){if(Tc(x))throw Error(s(418));b=Xn(M);var z=ai;b&&Fu(x,b)?Dh(z,M):(x.flags=x.flags&-4097|2,tn=!1,ai=x)}}else{if(Tc(x))throw Error(s(418));x.flags=x.flags&-4097|2,tn=!1,ai=x}}}function Ih(x){for(x=x.return;x!==null&&x.tag!==5&&x.tag!==3&&x.tag!==13;)x=x.return;ai=x}function Kl(x){if(!Se||x!==ai)return!1;if(!tn)return Ih(x),tn=!0,!1;if(x.tag!==3&&(x.tag!==5||Lu(x.type)&&!he(x.type,x.memoizedProps))){var b=_n;if(b){if(Tc(x))throw jh(),Error(s(418));for(;b;)Dh(x,b),b=Xn(b)}}if(Ih(x),x.tag===13){if(!Se)throw Error(s(316));if(x=x.memoizedState,x=x!==null?x.dehydrated:null,!x)throw Error(s(317));_n=In(x)}else _n=ai?Xn(x.stateNode):null;return!0}function jh(){for(var x=_n;x;)x=Xn(x)}function No(){Se&&(_n=ai=null,$l=tn=!1)}function Nc(x){_a===null?_a=[x]:_a.push(x)}var Pc=o.ReactCurrentBatchConfig;function Is(x,b){if(hs(x,b))return!0;if(typeof x!="object"||x===null||typeof b!="object"||b===null)return!1;var M=Object.keys(x),z=Object.keys(b);if(M.length!==z.length)return!1;for(z=0;z<M.length;z++){var $=M[z];if(!ro.call(b,$)||!hs(x[$],b[$]))return!1}return!0}function ym(x){switch(x.tag){case 5:return fs(x.type);case 16:return fs("Lazy");case 13:return fs("Suspense");case 19:return fs("SuspenseList");case 0:case 2:case 15:return x=Xi(x.type,!1),x;case 11:return x=Xi(x.type.render,!1),x;case 1:return x=Xi(x.type,!0),x;default:return""}}function ms(x,b,M){if(x=M.ref,x!==null&&typeof x!="function"&&typeof x!="object"){if(M._owner){if(M=M._owner,M){if(M.tag!==1)throw Error(s(309));var z=M.stateNode}if(!z)throw Error(s(147,x));var $=z,te=""+x;return b!==null&&b.ref!==null&&typeof b.ref=="function"&&b.ref._stringRef===te?b.ref:(b=function(pe){var Ne=$.refs;pe===null?delete Ne[te]:Ne[te]=pe},b._stringRef=te,b)}if(typeof x!="string")throw Error(s(284));if(!M._owner)throw Error(s(290,x))}return x}function Bi(x,b){throw x=Object.prototype.toString.call(b),Error(s(31,x==="[object Object]"?"object with keys {"+Object.keys(b).join(", ")+"}":x))}function xf(x){var b=x._init;return b(x._payload)}function bf(x){function b(je,Pe){if(x){var He=je.deletions;He===null?(je.deletions=[Pe],je.flags|=16):He.push(Pe)}}function M(je,Pe){if(!x)return null;for(;Pe!==null;)b(je,Pe),Pe=Pe.sibling;return null}function z(je,Pe){for(je=new Map;Pe!==null;)Pe.key!==null?je.set(Pe.key,Pe):je.set(Pe.index,Pe),Pe=Pe.sibling;return je}function $(je,Pe){return je=pu(je,Pe),je.index=0,je.sibling=null,je}function te(je,Pe,He){return je.index=He,x?(He=je.alternate,He!==null?(He=He.index,He<Pe?(je.flags|=2,Pe):He):(je.flags|=2,Pe)):(je.flags|=1048576,Pe)}function pe(je){return x&&je.alternate===null&&(je.flags|=2),je}function Ne(je,Pe,He,Tt){return Pe===null||Pe.tag!==6?(Pe=ad(He,je.mode,Tt),Pe.return=je,Pe):(Pe=$(Pe,He),Pe.return=je,Pe)}function Be(je,Pe,He,Tt){var qt=He.type;return qt===c?Lt(je,Pe,He.props.children,Tt,He.key):Pe!==null&&(Pe.elementType===qt||typeof qt=="object"&&qt!==null&&qt.$$typeof===T&&xf(qt)===Pe.type)?(Tt=$(Pe,He.props),Tt.ref=ms(je,Pe,He),Tt.return=je,Tt):(Tt=np(He.type,He.key,He.props,null,je.mode,Tt),Tt.ref=ms(je,Pe,He),Tt.return=je,Tt)}function ct(je,Pe,He,Tt){return Pe===null||Pe.tag!==4||Pe.stateNode.containerInfo!==He.containerInfo||Pe.stateNode.implementation!==He.implementation?(Pe=ip(He,je.mode,Tt),Pe.return=je,Pe):(Pe=$(Pe,He.children||[]),Pe.return=je,Pe)}function Lt(je,Pe,He,Tt,qt){return Pe===null||Pe.tag!==7?(Pe=Gi(He,je.mode,Tt,qt),Pe.return=je,Pe):(Pe=$(Pe,He),Pe.return=je,Pe)}function ur(je,Pe,He){if(typeof Pe=="string"&&Pe!==""||typeof Pe=="number")return Pe=ad(""+Pe,je.mode,He),Pe.return=je,Pe;if(typeof Pe=="object"&&Pe!==null){switch(Pe.$$typeof){case l:return He=np(Pe.type,Pe.key,Pe.props,null,je.mode,He),He.ref=ms(je,null,Pe),He.return=je,He;case u:return Pe=ip(Pe,je.mode,He),Pe.return=je,Pe;case T:var Tt=Pe._init;return ur(je,Tt(Pe._payload),He)}if(U(Pe)||I(Pe))return Pe=Gi(Pe,je.mode,He,null),Pe.return=je,Pe;Bi(je,Pe)}return null}function Ct(je,Pe,He,Tt){var qt=Pe!==null?Pe.key:null;if(typeof He=="string"&&He!==""||typeof He=="number")return qt!==null?null:Ne(je,Pe,""+He,Tt);if(typeof He=="object"&&He!==null){switch(He.$$typeof){case l:return He.key===qt?Be(je,Pe,He,Tt):null;case u:return He.key===qt?ct(je,Pe,He,Tt):null;case T:return qt=He._init,Ct(je,Pe,qt(He._payload),Tt)}if(U(He)||I(He))return qt!==null?null:Lt(je,Pe,He,Tt,null);Bi(je,He)}return null}function gn(je,Pe,He,Tt,qt){if(typeof Tt=="string"&&Tt!==""||typeof Tt=="number")return je=je.get(He)||null,Ne(Pe,je,""+Tt,qt);if(typeof Tt=="object"&&Tt!==null){switch(Tt.$$typeof){case l:return je=je.get(Tt.key===null?He:Tt.key)||null,Be(Pe,je,Tt,qt);case u:return je=je.get(Tt.key===null?He:Tt.key)||null,ct(Pe,je,Tt,qt);case T:var mr=Tt._init;return gn(je,Pe,He,mr(Tt._payload),qt)}if(U(Tt)||I(Tt))return je=je.get(He)||null,Lt(Pe,je,Tt,qt,null);Bi(Pe,Tt)}return null}function Xr(je,Pe,He,Tt){for(var qt=null,mr=null,cr=Pe,jr=Pe=0,_i=null;cr!==null&&jr<He.length;jr++){cr.index>jr?(_i=cr,cr=null):_i=cr.sibling;var Or=Ct(je,cr,He[jr],Tt);if(Or===null){cr===null&&(cr=_i);break}x&&cr&&Or.alternate===null&&b(je,cr),Pe=te(Or,Pe,jr),mr===null?qt=Or:mr.sibling=Or,mr=Or,cr=_i}if(jr===He.length)return M(je,cr),tn&&ka(je,jr),qt;if(cr===null){for(;jr<He.length;jr++)cr=ur(je,He[jr],Tt),cr!==null&&(Pe=te(cr,Pe,jr),mr===null?qt=cr:mr.sibling=cr,mr=cr);return tn&&ka(je,jr),qt}for(cr=z(je,cr);jr<He.length;jr++)_i=gn(cr,je,jr,He[jr],Tt),_i!==null&&(x&&_i.alternate!==null&&cr.delete(_i.key===null?jr:_i.key),Pe=te(_i,Pe,jr),mr===null?qt=_i:mr.sibling=_i,mr=_i);return x&&cr.forEach(function(ua){return b(je,ua)}),tn&&ka(je,jr),qt}function Oa(je,Pe,He,Tt){var qt=I(He);if(typeof qt!="function")throw Error(s(150));if(He=qt.call(He),He==null)throw Error(s(151));for(var mr=qt=null,cr=Pe,jr=Pe=0,_i=null,Or=He.next();cr!==null&&!Or.done;jr++,Or=He.next()){cr.index>jr?(_i=cr,cr=null):_i=cr.sibling;var ua=Ct(je,cr,Or.value,Tt);if(ua===null){cr===null&&(cr=_i);break}x&&cr&&ua.alternate===null&&b(je,cr),Pe=te(ua,Pe,jr),mr===null?qt=ua:mr.sibling=ua,mr=ua,cr=_i}if(Or.done)return M(je,cr),tn&&ka(je,jr),qt;if(cr===null){for(;!Or.done;jr++,Or=He.next())Or=ur(je,Or.value,Tt),Or!==null&&(Pe=te(Or,Pe,jr),mr===null?qt=Or:mr.sibling=Or,mr=Or);return tn&&ka(je,jr),qt}for(cr=z(je,cr);!Or.done;jr++,Or=He.next())Or=gn(cr,je,jr,Or.value,Tt),Or!==null&&(x&&Or.alternate!==null&&cr.delete(Or.key===null?jr:Or.key),Pe=te(Or,Pe,jr),mr===null?qt=Or:mr.sibling=Or,mr=Or);return x&&cr.forEach(function(db){return b(je,db)}),tn&&ka(je,jr),qt}function Uo(je,Pe,He,Tt){if(typeof He=="object"&&He!==null&&He.type===c&&He.key===null&&(He=He.props.children),typeof He=="object"&&He!==null){switch(He.$$typeof){case l:e:{for(var qt=He.key,mr=Pe;mr!==null;){if(mr.key===qt){if(qt=He.type,qt===c){if(mr.tag===7){M(je,mr.sibling),Pe=$(mr,He.props.children),Pe.return=je,je=Pe;break e}}else if(mr.elementType===qt||typeof qt=="object"&&qt!==null&&qt.$$typeof===T&&xf(qt)===mr.type){M(je,mr.sibling),Pe=$(mr,He.props),Pe.ref=ms(je,mr,He),Pe.return=je,je=Pe;break e}M(je,mr);break}else b(je,mr);mr=mr.sibling}He.type===c?(Pe=Gi(He.props.children,je.mode,Tt,He.key),Pe.return=je,je=Pe):(Tt=np(He.type,He.key,He.props,null,je.mode,Tt),Tt.ref=ms(je,Pe,He),Tt.return=je,je=Tt)}return pe(je);case u:e:{for(mr=He.key;Pe!==null;){if(Pe.key===mr)if(Pe.tag===4&&Pe.stateNode.containerInfo===He.containerInfo&&Pe.stateNode.implementation===He.implementation){M(je,Pe.sibling),Pe=$(Pe,He.children||[]),Pe.return=je,je=Pe;break e}else{M(je,Pe);break}else b(je,Pe);Pe=Pe.sibling}Pe=ip(He,je.mode,Tt),Pe.return=je,je=Pe}return pe(je);case T:return mr=He._init,Uo(je,Pe,mr(He._payload),Tt)}if(U(He))return Xr(je,Pe,He,Tt);if(I(He))return Oa(je,Pe,He,Tt);Bi(je,He)}return typeof He=="string"&&He!==""||typeof He=="number"?(He=""+He,Pe!==null&&Pe.tag===6?(M(je,Pe.sibling),Pe=$(Pe,He),Pe.return=je,je=Pe):(M(je,Pe),Pe=ad(He,je.mode,Tt),Pe.return=je,je=Pe),pe(je)):M(je,Pe)}return Uo}var cl=bf(!0),Mc=bf(!1),Zl=tt(null),Ac=null,Yl=null,Rc=null;function wf(){Rc=Yl=Ac=null}function Ka(x,b,M){ge?(qe(Zl,b._currentValue),b._currentValue=M):(qe(Zl,b._currentValue2),b._currentValue2=M)}function js(x){var b=Zl.current;ot(Zl),ge?x._currentValue=b:x._currentValue2=b}function dl(x,b,M){for(;x!==null;){var z=x.alternate;if((x.childLanes&b)!==b?(x.childLanes|=b,z!==null&&(z.childLanes|=b)):z!==null&&(z.childLanes&b)!==b&&(z.childLanes|=b),x===M)break;x=x.return}}function ea(x,b){Ac=x,Rc=Yl=null,x=x.dependencies,x!==null&&x.firstContext!==null&&((x.lanes&b)!==0&&(Vn=!0),x.firstContext=null)}function Ca(x){var b=ge?x._currentValue:x._currentValue2;if(Rc!==x)if(x={context:x,memoizedValue:b,next:null},Yl===null){if(Ac===null)throw Error(s(308));Yl=x,Ac.dependencies={lanes:0,firstContext:x}}else Yl=Yl.next=x;return b}var Ea=null;function Lc(x){Ea===null?Ea=[x]:Ea.push(x)}function fl(x,b,M,z){var $=b.interleaved;return $===null?(M.next=M,Lc(b)):(M.next=$.next,$.next=M),b.interleaved=M,Za(x,z)}function Za(x,b){x.lanes|=b;var M=x.alternate;for(M!==null&&(M.lanes|=b),M=x,x=x.return;x!==null;)x.childLanes|=b,M=x.alternate,M!==null&&(M.childLanes|=b),M=x,x=x.return;return M.tag===3?M.stateNode:null}var Pi=!1;function Sf(x){x.updateQueue={baseState:x.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function so(x,b){x=x.updateQueue,b.updateQueue===x&&(b.updateQueue={baseState:x.baseState,firstBaseUpdate:x.firstBaseUpdate,lastBaseUpdate:x.lastBaseUpdate,shared:x.shared,effects:x.effects})}function Ya(x,b){return{eventTime:x,lane:b,tag:0,payload:null,callback:null,next:null}}function oo(x,b,M){var z=x.updateQueue;if(z===null)return null;if(z=z.shared,(hr&2)!==0){var $=z.pending;return $===null?b.next=b:(b.next=$.next,$.next=b),z.pending=b,Za(x,M)}return $=z.interleaved,$===null?(b.next=b,Lc(z)):(b.next=$.next,$.next=b),z.interleaved=b,Za(x,M)}function hl(x,b,M){if(b=b.updateQueue,b!==null&&(b=b.shared,(M&4194240)!==0)){var z=b.lanes;z&=x.pendingLanes,M|=z,b.lanes=M,$a(x,M)}}function Xl(x,b){var M=x.updateQueue,z=x.alternate;if(z!==null&&(z=z.updateQueue,M===z)){var $=null,te=null;if(M=M.firstBaseUpdate,M!==null){do{var pe={eventTime:M.eventTime,lane:M.lane,tag:M.tag,payload:M.payload,callback:M.callback,next:null};te===null?$=te=pe:te=te.next=pe,M=M.next}while(M!==null);te===null?$=te=b:te=te.next=b}else $=te=b;M={baseState:z.baseState,firstBaseUpdate:$,lastBaseUpdate:te,shared:z.shared,effects:z.effects},x.updateQueue=M;return}x=M.lastBaseUpdate,x===null?M.firstBaseUpdate=b:x.next=b,M.lastBaseUpdate=b}function Mi(x,b,M,z){var $=x.updateQueue;Pi=!1;var te=$.firstBaseUpdate,pe=$.lastBaseUpdate,Ne=$.shared.pending;if(Ne!==null){$.shared.pending=null;var Be=Ne,ct=Be.next;Be.next=null,pe===null?te=ct:pe.next=ct,pe=Be;var Lt=x.alternate;Lt!==null&&(Lt=Lt.updateQueue,Ne=Lt.lastBaseUpdate,Ne!==pe&&(Ne===null?Lt.firstBaseUpdate=ct:Ne.next=ct,Lt.lastBaseUpdate=Be))}if(te!==null){var ur=$.baseState;pe=0,Lt=ct=Be=null,Ne=te;do{var Ct=Ne.lane,gn=Ne.eventTime;if((z&Ct)===Ct){Lt!==null&&(Lt=Lt.next={eventTime:gn,lane:0,tag:Ne.tag,payload:Ne.payload,callback:Ne.callback,next:null});e:{var Xr=x,Oa=Ne;switch(Ct=b,gn=M,Oa.tag){case 1:if(Xr=Oa.payload,typeof Xr=="function"){ur=Xr.call(gn,ur,Ct);break e}ur=Xr;break e;case 3:Xr.flags=Xr.flags&-65537|128;case 0:if(Xr=Oa.payload,Ct=typeof Xr=="function"?Xr.call(gn,ur,Ct):Xr,Ct==null)break e;ur=a({},ur,Ct);break e;case 2:Pi=!0}}Ne.callback!==null&&Ne.lane!==0&&(x.flags|=64,Ct=$.effects,Ct===null?$.effects=[Ne]:Ct.push(Ne))}else gn={eventTime:gn,lane:Ct,tag:Ne.tag,payload:Ne.payload,callback:Ne.callback,next:null},Lt===null?(ct=Lt=gn,Be=ur):Lt=Lt.next=gn,pe|=Ct;if(Ne=Ne.next,Ne===null){if(Ne=$.shared.pending,Ne===null)break;Ct=Ne,Ne=Ct.next,Ct.next=null,$.lastBaseUpdate=Ct,$.shared.pending=null}}while(!0);if(Lt===null&&(Be=ur),$.baseState=Be,$.firstBaseUpdate=ct,$.lastBaseUpdate=Lt,b=$.shared.interleaved,b!==null){$=b;do pe|=$.lane,$=$.next;while($!==b)}else te===null&&($.shared.lanes=0);Cl|=pe,x.lanes=pe,x.memoizedState=ur}}function Fh(x,b,M){if(x=b.effects,b.effects=null,x!==null)for(b=0;b<x.length;b++){var z=x[b],$=z.callback;if($!==null){if(z.callback=null,z=M,typeof $!="function")throw Error(s(191,$));$.call(z)}}}var Ta={},Xa=tt(Ta),ta=tt(Ta),gs=tt(Ta);function Na(x){if(x===Ta)throw Error(s(174));return x}function Ql(x,b){qe(gs,b),qe(ta,x),qe(Xa,Ta),x=Z(b),ot(Xa),qe(Xa,x)}function Fs(){ot(Xa),ot(ta),ot(gs)}function Bu(x){var b=Na(gs.current),M=Na(Xa.current);b=Q(M,x.type,b),M!==b&&(qe(ta,x),qe(Xa,b))}function Jl(x){ta.current===x&&(ot(Xa),ot(ta))}var Hr=tt(0);function pl(x){for(var b=x;b!==null;){if(b.tag===13){var M=b.memoizedState;if(M!==null&&(M=M.dehydrated,M===null||fn(M)||vr(M)))return b}else if(b.tag===19&&b.memoizedProps.revealOrder!==void 0){if((b.flags&128)!==0)return b}else if(b.child!==null){b.child.return=b,b=b.child;continue}if(b===x)break;for(;b.sibling===null;){if(b.return===null||b.return===x)return null;b=b.return}b.sibling.return=b.return,b=b.sibling}return null}var zu=[];function Oc(){for(var x=0;x<zu.length;x++){var b=zu[x];ge?b._workInProgressVersionPrimary=null:b._workInProgressVersionSecondary=null}zu.length=0}var ra=o.ReactCurrentDispatcher,Bs=o.ReactCurrentBatchConfig,Po=0,ln=null,zn=null,Un=null,eu=!1,na=!1,Mo=0,tu=0;function An(){throw Error(s(321))}function ml(x,b){if(b===null)return!1;for(var M=0;M<b.length&&M<x.length;M++)if(!hs(x[M],b[M]))return!1;return!0}function ru(x,b,M,z,$,te){if(Po=te,ln=b,b.memoizedState=null,b.updateQueue=null,b.lanes=0,ra.current=x===null||x.memoizedState===null?kt:Yt,x=M(z,$),na){te=0;do{if(na=!1,Mo=0,25<=te)throw Error(s(301));te+=1,Un=zn=null,b.updateQueue=null,ra.current=fr,x=M(z,$)}while(na)}if(ra.current=Ze,b=zn!==null&&zn.next!==null,Po=0,Un=zn=ln=null,eu=!1,b)throw Error(s(300));return x}function Dc(){var x=Mo!==0;return Mo=0,x}function bi(){var x={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Un===null?ln.memoizedState=Un=x:Un=Un.next=x,Un}function wi(){if(zn===null){var x=ln.alternate;x=x!==null?x.memoizedState:null}else x=zn.next;var b=Un===null?ln.memoizedState:Un.next;if(b!==null)Un=b,zn=x;else{if(x===null)throw Error(s(310));zn=x,x={memoizedState:zn.memoizedState,baseState:zn.baseState,baseQueue:zn.baseQueue,queue:zn.queue,next:null},Un===null?ln.memoizedState=Un=x:Un=Un.next=x}return Un}function Qa(x,b){return typeof b=="function"?b(x):b}function Uu(x){var b=wi(),M=b.queue;if(M===null)throw Error(s(311));M.lastRenderedReducer=x;var z=zn,$=z.baseQueue,te=M.pending;if(te!==null){if($!==null){var pe=$.next;$.next=te.next,te.next=pe}z.baseQueue=$=te,M.pending=null}if($!==null){te=$.next,z=z.baseState;var Ne=pe=null,Be=null,ct=te;do{var Lt=ct.lane;if((Po&Lt)===Lt)Be!==null&&(Be=Be.next={lane:0,action:ct.action,hasEagerState:ct.hasEagerState,eagerState:ct.eagerState,next:null}),z=ct.hasEagerState?ct.eagerState:x(z,ct.action);else{var ur={lane:Lt,action:ct.action,hasEagerState:ct.hasEagerState,eagerState:ct.eagerState,next:null};Be===null?(Ne=Be=ur,pe=z):Be=Be.next=ur,ln.lanes|=Lt,Cl|=Lt}ct=ct.next}while(ct!==null&&ct!==te);Be===null?pe=z:Be.next=Ne,hs(z,b.memoizedState)||(Vn=!0),b.memoizedState=z,b.baseState=pe,b.baseQueue=Be,M.lastRenderedState=z}if(x=M.interleaved,x!==null){$=x;do te=$.lane,ln.lanes|=te,Cl|=te,$=$.next;while($!==x)}else $===null&&(M.lanes=0);return[b.memoizedState,M.dispatch]}function gl(x){var b=wi(),M=b.queue;if(M===null)throw Error(s(311));M.lastRenderedReducer=x;var z=M.dispatch,$=M.pending,te=b.memoizedState;if($!==null){M.pending=null;var pe=$=$.next;do te=x(te,pe.action),pe=pe.next;while(pe!==$);hs(te,b.memoizedState)||(Vn=!0),b.memoizedState=te,b.baseQueue===null&&(b.baseState=te),M.lastRenderedState=te}return[te,z]}function kf(){}function vs(x,b){var M=ln,z=wi(),$=b(),te=!hs(z.memoizedState,$);if(te&&(z.memoizedState=$,Vn=!0),z=z.queue,Gu(vl.bind(null,M,z,x),[x]),z.getSnapshot!==b||te||Un!==null&&Un.memoizedState.tag&1){if(M.flags|=2048,Ro(9,jc.bind(null,M,z,$,b),void 0,null),cn===null)throw Error(s(349));(Po&30)!==0||Ic(M,b,$)}return $}function Ic(x,b,M){x.flags|=16384,x={getSnapshot:b,value:M},b=ln.updateQueue,b===null?(b={lastEffect:null,stores:null},ln.updateQueue=b,b.stores=[x]):(M=b.stores,M===null?b.stores=[x]:M.push(x))}function jc(x,b,M,z){b.value=M,b.getSnapshot=z,_f(b)&&Ja(x)}function vl(x,b,M){return M(function(){_f(b)&&Ja(x)})}function _f(x){var b=x.getSnapshot;x=x.value;try{var M=b();return!hs(x,M)}catch{return!0}}function Ja(x){var b=Za(x,1);b!==null&&oa(b,x,1,-1)}function Ao(x){var b=bi();return typeof x=="function"&&(x=x()),b.memoizedState=b.baseState=x,x={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Qa,lastRenderedState:x},b.queue=x,x=x.dispatch=ue.bind(null,ln,x),[b.memoizedState,x]}function Ro(x,b,M,z){return x={tag:x,create:b,destroy:M,deps:z,next:null},b=ln.updateQueue,b===null?(b={lastEffect:null,stores:null},ln.updateQueue=b,b.lastEffect=x.next=x):(M=b.lastEffect,M===null?b.lastEffect=x.next=x:(z=M.next,M.next=x,x.next=z,b.lastEffect=x)),x}function Cf(){return wi().memoizedState}function Fc(x,b,M,z){var $=bi();ln.flags|=x,$.memoizedState=Ro(1|b,M,void 0,z===void 0?null:z)}function lo(x,b,M,z){var $=wi();z=z===void 0?null:z;var te=void 0;if(zn!==null){var pe=zn.memoizedState;if(te=pe.destroy,z!==null&&ml(z,pe.deps)){$.memoizedState=Ro(b,M,te,z);return}}ln.flags|=x,$.memoizedState=Ro(1|b,M,te,z)}function Ef(x,b){return Fc(8390656,8,x,b)}function Gu(x,b){return lo(2048,8,x,b)}function Bc(x,b){return lo(4,2,x,b)}function Kr(x,b){return lo(4,4,x,b)}function zc(x,b){if(typeof b=="function")return x=x(),b(x),function(){b(null)};if(b!=null)return x=x(),b.current=x,function(){b.current=null}}function nu(x,b,M){return M=M!=null?M.concat([x]):null,lo(4,4,zc.bind(null,b,x),M)}function Lo(){}function Tf(x,b){var M=wi();b=b===void 0?null:b;var z=M.memoizedState;return z!==null&&b!==null&&ml(b,z[1])?z[0]:(M.memoizedState=[x,b],x)}function h(x,b){var M=wi();b=b===void 0?null:b;var z=M.memoizedState;return z!==null&&b!==null&&ml(b,z[1])?z[0]:(x=x(),M.memoizedState=[x,b],x)}function k(x,b,M){return(Po&21)===0?(x.baseState&&(x.baseState=!1,Vn=!0),x.memoizedState=M):(hs(M,b)||(M=Gl(),ln.lanes|=M,Cl|=M,x.baseState=!0),b)}function P(x,b){var M=br;br=M!==0&&4>M?M:4,x(!0);var z=Bs.transition;Bs.transition={};try{x(!1),b()}finally{br=M,Bs.transition=z}}function V(){return wi().memoizedState}function ee(x,b,M){var z=ki(x);if(M={lane:z,action:M,hasEagerState:!1,eagerState:null,next:null},we(x))Me(b,M);else if(M=fl(x,b,M,z),M!==null){var $=xn();oa(M,x,z,$),De(M,b,z)}}function ue(x,b,M){var z=ki(x),$={lane:z,action:M,hasEagerState:!1,eagerState:null,next:null};if(we(x))Me(b,$);else{var te=x.alternate;if(x.lanes===0&&(te===null||te.lanes===0)&&(te=b.lastRenderedReducer,te!==null))try{var pe=b.lastRenderedState,Ne=te(pe,M);if($.hasEagerState=!0,$.eagerState=Ne,hs(Ne,pe)){var Be=b.interleaved;Be===null?($.next=$,Lc(b)):($.next=Be.next,Be.next=$),b.interleaved=$;return}}catch{}M=fl(x,b,$,z),M!==null&&($=xn(),oa(M,x,z,$),De(M,b,z))}}function we(x){var b=x.alternate;return x===ln||b!==null&&b===ln}function Me(x,b){na=eu=!0;var M=x.pending;M===null?b.next=b:(b.next=M.next,M.next=b),x.pending=b}function De(x,b,M){if((M&4194240)!==0){var z=b.lanes;z&=x.pendingLanes,M|=z,b.lanes=M,$a(x,M)}}var Ze={readContext:Ca,useCallback:An,useContext:An,useEffect:An,useImperativeHandle:An,useInsertionEffect:An,useLayoutEffect:An,useMemo:An,useReducer:An,useRef:An,useState:An,useDebugValue:An,useDeferredValue:An,useTransition:An,useMutableSource:An,useSyncExternalStore:An,useId:An,unstable_isNewReconciler:!1},kt={readContext:Ca,useCallback:function(x,b){return bi().memoizedState=[x,b===void 0?null:b],x},useContext:Ca,useEffect:Ef,useImperativeHandle:function(x,b,M){return M=M!=null?M.concat([x]):null,Fc(4194308,4,zc.bind(null,b,x),M)},useLayoutEffect:function(x,b){return Fc(4194308,4,x,b)},useInsertionEffect:function(x,b){return Fc(4,2,x,b)},useMemo:function(x,b){var M=bi();return b=b===void 0?null:b,x=x(),M.memoizedState=[x,b],x},useReducer:function(x,b,M){var z=bi();return b=M!==void 0?M(b):b,z.memoizedState=z.baseState=b,x={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:x,lastRenderedState:b},z.queue=x,x=x.dispatch=ee.bind(null,ln,x),[z.memoizedState,x]},useRef:function(x){var b=bi();return x={current:x},b.memoizedState=x},useState:Ao,useDebugValue:Lo,useDeferredValue:function(x){return bi().memoizedState=x},useTransition:function(){var x=Ao(!1),b=x[0];return x=P.bind(null,x[1]),bi().memoizedState=x,[b,x]},useMutableSource:function(){},useSyncExternalStore:function(x,b,M){var z=ln,$=bi();if(tn){if(M===void 0)throw Error(s(407));M=M()}else{if(M=b(),cn===null)throw Error(s(349));(Po&30)!==0||Ic(z,b,M)}$.memoizedState=M;var te={value:M,getSnapshot:b};return $.queue=te,Ef(vl.bind(null,z,te,x),[x]),z.flags|=2048,Ro(9,jc.bind(null,z,te,M,b),void 0,null),M},useId:function(){var x=bi(),b=cn.identifierPrefix;if(tn){var M=ps,z=Qi;M=(z&~(1<<32-Jt(z)-1)).toString(32)+M,b=":"+b+"R"+M,M=Mo++,0<M&&(b+="H"+M.toString(32)),b+=":"}else M=tu++,b=":"+b+"r"+M.toString(32)+":";return x.memoizedState=b},unstable_isNewReconciler:!1},Yt={readContext:Ca,useCallback:Tf,useContext:Ca,useEffect:Gu,useImperativeHandle:nu,useInsertionEffect:Bc,useLayoutEffect:Kr,useMemo:h,useReducer:Uu,useRef:Cf,useState:function(){return Uu(Qa)},useDebugValue:Lo,useDeferredValue:function(x){var b=wi();return k(b,zn.memoizedState,x)},useTransition:function(){var x=Uu(Qa)[0],b=wi().memoizedState;return[x,b]},useMutableSource:kf,useSyncExternalStore:vs,useId:V,unstable_isNewReconciler:!1},fr={readContext:Ca,useCallback:Tf,useContext:Ca,useEffect:Gu,useImperativeHandle:nu,useInsertionEffect:Bc,useLayoutEffect:Kr,useMemo:h,useReducer:gl,useRef:Cf,useState:function(){return gl(Qa)},useDebugValue:Lo,useDeferredValue:function(x){var b=wi();return zn===null?b.memoizedState=x:k(b,zn.memoizedState,x)},useTransition:function(){var x=gl(Qa)[0],b=wi().memoizedState;return[x,b]},useMutableSource:kf,useSyncExternalStore:vs,useId:V,unstable_isNewReconciler:!1};function Zr(x,b){if(x&&x.defaultProps){b=a({},b),x=x.defaultProps;for(var M in x)b[M]===void 0&&(b[M]=x[M]);return b}return b}function Gn(x,b,M,z){b=x.memoizedState,M=M(z,b),M=M==null?b:a({},b,M),x.memoizedState=M,x.lanes===0&&(x.updateQueue.baseState=M)}var Ai={isMounted:function(x){return(x=x._reactInternals)?j(x)===x:!1},enqueueSetState:function(x,b,M){x=x._reactInternals;var z=xn(),$=ki(x),te=Ya(z,$);te.payload=b,M!=null&&(te.callback=M),b=oo(x,te,$),b!==null&&(oa(b,x,$,z),hl(b,x,$))},enqueueReplaceState:function(x,b,M){x=x._reactInternals;var z=xn(),$=ki(x),te=Ya(z,$);te.tag=1,te.payload=b,M!=null&&(te.callback=M),b=oo(x,te,$),b!==null&&(oa(b,x,$,z),hl(b,x,$))},enqueueForceUpdate:function(x,b){x=x._reactInternals;var M=xn(),z=ki(x),$=Ya(M,z);$.tag=2,b!=null&&($.callback=b),b=oo(x,$,z),b!==null&&(oa(b,x,z,M),hl(b,x,z))}};function zi(x,b,M,z,$,te,pe){return x=x.stateNode,typeof x.shouldComponentUpdate=="function"?x.shouldComponentUpdate(z,te,pe):b.prototype&&b.prototype.isPureReactComponent?!Is(M,z)||!Is($,te):!0}function yl(x,b,M){var z=!1,$=Mt,te=b.contextType;return typeof te=="object"&&te!==null?te=Ca(te):($=It(b)?Fr:Nr.current,z=b.contextTypes,te=(z=z!=null)?vi(x,$):Mt),b=new b(M,te),x.memoizedState=b.state!==null&&b.state!==void 0?b.state:null,b.updater=Ai,x.stateNode=b,b._reactInternals=x,z&&(x=x.stateNode,x.__reactInternalMemoizedUnmaskedChildContext=$,x.__reactInternalMemoizedMaskedChildContext=te),b}function Uc(x,b,M,z){x=b.state,typeof b.componentWillReceiveProps=="function"&&b.componentWillReceiveProps(M,z),typeof b.UNSAFE_componentWillReceiveProps=="function"&&b.UNSAFE_componentWillReceiveProps(M,z),b.state!==x&&Ai.enqueueReplaceState(b,b.state,null)}function zs(x,b,M,z){var $=x.stateNode;$.props=M,$.state=x.memoizedState,$.refs={},Sf(x);var te=b.contextType;typeof te=="object"&&te!==null?$.context=Ca(te):(te=It(b)?Fr:Nr.current,$.context=vi(x,te)),$.state=x.memoizedState,te=b.getDerivedStateFromProps,typeof te=="function"&&(Gn(x,b,te,M),$.state=x.memoizedState),typeof b.getDerivedStateFromProps=="function"||typeof $.getSnapshotBeforeUpdate=="function"||typeof $.UNSAFE_componentWillMount!="function"&&typeof $.componentWillMount!="function"||(b=$.state,typeof $.componentWillMount=="function"&&$.componentWillMount(),typeof $.UNSAFE_componentWillMount=="function"&&$.UNSAFE_componentWillMount(),b!==$.state&&Ai.enqueueReplaceState($,$.state,null),Mi(x,M,$,z),$.state=x.memoizedState),typeof $.componentDidMount=="function"&&(x.flags|=4194308)}function xl(x,b){try{var M="",z=b;do M+=ym(z),z=z.return;while(z);var $=M}catch(te){$=`
Error generating stack: `+te.message+`
`+te.stack}return{value:x,source:b,stack:$,digest:null}}function uo(x,b,M){return{value:x,source:null,stack:M??null,digest:b??null}}function es(x,b){try{console.error(b.value)}catch(M){setTimeout(function(){throw M})}}var iu=typeof WeakMap=="function"?WeakMap:Map;function zr(x,b,M){M=Ya(-1,M),M.tag=3,M.payload={element:null};var z=b.value;return M.callback=function(){Wn||(Wn=!0,oi=z),es(x,b)},M}function bl(x,b,M){M=Ya(-1,M),M.tag=3;var z=x.type.getDerivedStateFromError;if(typeof z=="function"){var $=b.value;M.payload=function(){return z($)},M.callback=function(){es(x,b)}}var te=x.stateNode;return te!==null&&typeof te.componentDidCatch=="function"&&(M.callback=function(){es(x,b),typeof z!="function"&&(fo===null?fo=new Set([this]):fo.add(this));var pe=b.stack;this.componentDidCatch(b.value,{componentStack:pe!==null?pe:""})}),M}function Bh(x,b,M){var z=x.pingCache;if(z===null){z=x.pingCache=new iu;var $=new Set;z.set(b,$)}else $=z.get(b),$===void 0&&($=new Set,z.set(b,$));$.has(M)||($.add(M),x=k0.bind(null,x,b,M),b.then(x,x))}function zh(x){do{var b;if((b=x.tag===13)&&(b=x.memoizedState,b=b!==null?b.dehydrated!==null:!0),b)return x;x=x.return}while(x!==null);return null}function Oo(x,b,M,z,$){return(x.mode&1)===0?(x===b?x.flags|=65536:(x.flags|=128,M.flags|=131072,M.flags&=-52805,M.tag===1&&(M.alternate===null?M.tag=17:(b=Ya(-1,1),b.tag=2,oo(M,b,1))),M.lanes|=1),x):(x.flags|=65536,x.lanes=$,x)}var wl=o.ReactCurrentOwner,Vn=!1;function si(x,b,M,z){b.child=x===null?Mc(b,null,M,z):cl(b,x.child,M,z)}function Uh(x,b,M,z,$){M=M.render;var te=b.ref;return ea(b,$),z=ru(x,b,M,z,te,$),M=Dc(),x!==null&&!Vn?(b.updateQueue=x.updateQueue,b.flags&=-2053,x.lanes&=~$,kl(x,b,$)):(tn&&M&&Ji(b),b.flags|=1,si(x,b,z,$),b.child)}function Vu(x,b,M,z,$){if(x===null){var te=M.type;return typeof te=="function"&&!rd(te)&&te.defaultProps===void 0&&M.compare===null&&M.defaultProps===void 0?(b.tag=15,b.type=te,Sl(x,b,te,z,$)):(x=np(M.type,null,z,b,b.mode,$),x.ref=b.ref,x.return=b,b.child=x)}if(te=x.child,(x.lanes&$)===0){var pe=te.memoizedProps;if(M=M.compare,M=M!==null?M:Is,M(pe,z)&&x.ref===b.ref)return kl(x,b,$)}return b.flags|=1,x=pu(te,z),x.ref=b.ref,x.return=b,b.child=x}function Sl(x,b,M,z,$){if(x!==null){var te=x.memoizedProps;if(Is(te,z)&&x.ref===b.ref)if(Vn=!1,b.pendingProps=z=te,(x.lanes&$)!==0)(x.flags&131072)!==0&&(Vn=!0);else return b.lanes=x.lanes,kl(x,b,$)}return Do(x,b,M,z,$)}function pn(x,b,M){var z=b.pendingProps,$=z.children,te=x!==null?x.memoizedState:null;if(z.mode==="hidden")if((b.mode&1)===0)b.memoizedState={baseLanes:0,cachePool:null,transitions:null},qe(cu,Si),Si|=M;else{if((M&1073741824)===0)return x=te!==null?te.baseLanes|M:M,b.lanes=b.childLanes=1073741824,b.memoizedState={baseLanes:x,cachePool:null,transitions:null},b.updateQueue=null,qe(cu,Si),Si|=x,null;b.memoizedState={baseLanes:0,cachePool:null,transitions:null},z=te!==null?te.baseLanes:M,qe(cu,Si),Si|=z}else te!==null?(z=te.baseLanes|M,b.memoizedState=null):z=M,qe(cu,Si),Si|=z;return si(x,b,$,M),b.child}function un(x,b){var M=b.ref;(x===null&&M!==null||x!==null&&x.ref!==M)&&(b.flags|=512,b.flags|=2097152)}function Do(x,b,M,z,$){var te=It(M)?Fr:Nr.current;return te=vi(b,te),ea(b,$),M=ru(x,b,M,z,te,$),z=Dc(),x!==null&&!Vn?(b.updateQueue=x.updateQueue,b.flags&=-2053,x.lanes&=~$,kl(x,b,$)):(tn&&z&&Ji(b),b.flags|=1,si(x,b,M,$),b.child)}function Ui(x,b,M,z,$){if(It(M)){var te=!0;er(b)}else te=!1;if(ea(b,$),b.stateNode===null)Nf(x,b),yl(b,M,z),zs(b,M,z,$),z=!0;else if(x===null){var pe=b.stateNode,Ne=b.memoizedProps;pe.props=Ne;var Be=pe.context,ct=M.contextType;typeof ct=="object"&&ct!==null?ct=Ca(ct):(ct=It(M)?Fr:Nr.current,ct=vi(b,ct));var Lt=M.getDerivedStateFromProps,ur=typeof Lt=="function"||typeof pe.getSnapshotBeforeUpdate=="function";ur||typeof pe.UNSAFE_componentWillReceiveProps!="function"&&typeof pe.componentWillReceiveProps!="function"||(Ne!==z||Be!==ct)&&Uc(b,pe,z,ct),Pi=!1;var Ct=b.memoizedState;pe.state=Ct,Mi(b,z,pe,$),Be=b.memoizedState,Ne!==z||Ct!==Be||Pr.current||Pi?(typeof Lt=="function"&&(Gn(b,M,Lt,z),Be=b.memoizedState),(Ne=Pi||zi(b,M,Ne,z,Ct,Be,ct))?(ur||typeof pe.UNSAFE_componentWillMount!="function"&&typeof pe.componentWillMount!="function"||(typeof pe.componentWillMount=="function"&&pe.componentWillMount(),typeof pe.UNSAFE_componentWillMount=="function"&&pe.UNSAFE_componentWillMount()),typeof pe.componentDidMount=="function"&&(b.flags|=4194308)):(typeof pe.componentDidMount=="function"&&(b.flags|=4194308),b.memoizedProps=z,b.memoizedState=Be),pe.props=z,pe.state=Be,pe.context=ct,z=Ne):(typeof pe.componentDidMount=="function"&&(b.flags|=4194308),z=!1)}else{pe=b.stateNode,so(x,b),Ne=b.memoizedProps,ct=b.type===b.elementType?Ne:Zr(b.type,Ne),pe.props=ct,ur=b.pendingProps,Ct=pe.context,Be=M.contextType,typeof Be=="object"&&Be!==null?Be=Ca(Be):(Be=It(M)?Fr:Nr.current,Be=vi(b,Be));var gn=M.getDerivedStateFromProps;(Lt=typeof gn=="function"||typeof pe.getSnapshotBeforeUpdate=="function")||typeof pe.UNSAFE_componentWillReceiveProps!="function"&&typeof pe.componentWillReceiveProps!="function"||(Ne!==ur||Ct!==Be)&&Uc(b,pe,z,Be),Pi=!1,Ct=b.memoizedState,pe.state=Ct,Mi(b,z,pe,$);var Xr=b.memoizedState;Ne!==ur||Ct!==Xr||Pr.current||Pi?(typeof gn=="function"&&(Gn(b,M,gn,z),Xr=b.memoizedState),(ct=Pi||zi(b,M,ct,z,Ct,Xr,Be)||!1)?(Lt||typeof pe.UNSAFE_componentWillUpdate!="function"&&typeof pe.componentWillUpdate!="function"||(typeof pe.componentWillUpdate=="function"&&pe.componentWillUpdate(z,Xr,Be),typeof pe.UNSAFE_componentWillUpdate=="function"&&pe.UNSAFE_componentWillUpdate(z,Xr,Be)),typeof pe.componentDidUpdate=="function"&&(b.flags|=4),typeof pe.getSnapshotBeforeUpdate=="function"&&(b.flags|=1024)):(typeof pe.componentDidUpdate!="function"||Ne===x.memoizedProps&&Ct===x.memoizedState||(b.flags|=4),typeof pe.getSnapshotBeforeUpdate!="function"||Ne===x.memoizedProps&&Ct===x.memoizedState||(b.flags|=1024),b.memoizedProps=z,b.memoizedState=Xr),pe.props=z,pe.state=Xr,pe.context=Be,z=ct):(typeof pe.componentDidUpdate!="function"||Ne===x.memoizedProps&&Ct===x.memoizedState||(b.flags|=4),typeof pe.getSnapshotBeforeUpdate!="function"||Ne===x.memoizedProps&&Ct===x.memoizedState||(b.flags|=1024),z=!1)}return ia(x,b,M,z,te,$)}function ia(x,b,M,z,$,te){un(x,b);var pe=(b.flags&128)!==0;if(!z&&!pe)return $&&Lr(b,M,!1),kl(x,b,te);z=b.stateNode,wl.current=b;var Ne=pe&&typeof M.getDerivedStateFromError!="function"?null:z.render();return b.flags|=1,x!==null&&pe?(b.child=cl(b,x.child,null,te),b.child=cl(b,null,Ne,te)):si(x,b,Ne,te),b.memoizedState=z.state,$&&Lr(b,M,!0),b.child}function au(x){var b=x.stateNode;b.pendingContext?al(x,b.pendingContext,b.pendingContext!==b.context):b.context&&al(x,b.context,!1),Ql(x,b.containerInfo)}function Hu(x,b,M,z,$){return No(),Nc($),b.flags|=256,si(x,b,M,z),b.child}var aa={dehydrated:null,treeContext:null,retryLane:0};function Gc(x){return{baseLanes:x,cachePool:null,transitions:null}}function xm(x,b,M){var z=b.pendingProps,$=Hr.current,te=!1,pe=(b.flags&128)!==0,Ne;if((Ne=pe)||(Ne=x!==null&&x.memoizedState===null?!1:($&2)!==0),Ne?(te=!0,b.flags&=-129):(x===null||x.memoizedState!==null)&&($|=1),qe(Hr,$&1),x===null)return yf(b),x=b.memoizedState,x!==null&&(x=x.dehydrated,x!==null)?((b.mode&1)===0?b.lanes=1:vr(x)?b.lanes=8:b.lanes=1073741824,null):(pe=z.children,x=z.fallback,te?(z=b.mode,te=b.child,pe={mode:"hidden",children:pe},(z&1)===0&&te!==null?(te.childLanes=0,te.pendingProps=pe):te=nd(pe,z,0,null),x=Gi(x,z,M,null),te.return=b,x.return=b,te.sibling=x,b.child=te,b.child.memoizedState=Gc(M),b.memoizedState=aa,x):Gh(b,pe));if($=x.memoizedState,$!==null&&(Ne=$.dehydrated,Ne!==null))return v0(x,b,pe,z,Ne,$,M);if(te){te=z.fallback,pe=b.mode,$=x.child,Ne=$.sibling;var Be={mode:"hidden",children:z.children};return(pe&1)===0&&b.child!==$?(z=b.child,z.childLanes=0,z.pendingProps=Be,b.deletions=null):(z=pu($,Be),z.subtreeFlags=$.subtreeFlags&14680064),Ne!==null?te=pu(Ne,te):(te=Gi(te,pe,M,null),te.flags|=2),te.return=b,z.return=b,z.sibling=te,b.child=z,z=te,te=b.child,pe=x.child.memoizedState,pe=pe===null?Gc(M):{baseLanes:pe.baseLanes|M,cachePool:null,transitions:pe.transitions},te.memoizedState=pe,te.childLanes=x.childLanes&~M,b.memoizedState=aa,z}return te=x.child,x=te.sibling,z=pu(te,{mode:"visible",children:z.children}),(b.mode&1)===0&&(z.lanes=M),z.return=b,z.sibling=null,x!==null&&(M=b.deletions,M===null?(b.deletions=[x],b.flags|=16):M.push(x)),b.child=z,b.memoizedState=null,z}function Gh(x,b){return b=nd({mode:"visible",children:b},x.mode,0,null),b.return=x,x.child=b}function Wu(x,b,M,z){return z!==null&&Nc(z),cl(b,x.child,null,M),x=Gh(b,b.pendingProps.children),x.flags|=2,b.memoizedState=null,x}function v0(x,b,M,z,$,te,pe){if(M)return b.flags&256?(b.flags&=-257,z=uo(Error(s(422))),Wu(x,b,pe,z)):b.memoizedState!==null?(b.child=x.child,b.flags|=128,null):(te=z.fallback,$=b.mode,z=nd({mode:"visible",children:z.children},$,0,null),te=Gi(te,$,pe,null),te.flags|=2,z.return=b,te.return=b,z.sibling=te,b.child=z,(b.mode&1)!==0&&cl(b,x.child,null,pe),b.child.memoizedState=Gc(pe),b.memoizedState=aa,te);if((b.mode&1)===0)return Wu(x,b,pe,null);if(vr($))return z=St($).digest,te=Error(s(419)),z=uo(te,z,void 0),Wu(x,b,pe,z);if(M=(pe&x.childLanes)!==0,Vn||M){if(z=cn,z!==null){switch(pe&-pe){case 4:$=2;break;case 16:$=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:$=32;break;case 536870912:$=268435456;break;default:$=0}$=($&(z.suspendedLanes|pe))!==0?0:$,$!==0&&$!==te.retryLane&&(te.retryLane=$,Za(x,$),oa(z,x,$,-1))}return td(),z=uo(Error(s(421))),Wu(x,b,pe,z)}return fn($)?(b.flags|=128,b.child=x.child,b=C0.bind(null,x),Br($,b),null):(x=te.treeContext,Se&&(_n=As($),ai=b,tn=!0,_a=null,$l=!1,x!==null&&(xi[Sa++]=Qi,xi[Sa++]=ps,xi[Sa++]=Bn,Qi=x.id,ps=x.overflow,Bn=b)),b=Gh(b,z.children),b.flags|=4096,b)}function Io(x,b,M){x.lanes|=b;var z=x.alternate;z!==null&&(z.lanes|=b),dl(x.return,b,M)}function Vc(x,b,M,z,$){var te=x.memoizedState;te===null?x.memoizedState={isBackwards:b,rendering:null,renderingStartTime:0,last:z,tail:M,tailMode:$}:(te.isBackwards=b,te.rendering=null,te.renderingStartTime=0,te.last=z,te.tail=M,te.tailMode=$)}function Vh(x,b,M){var z=b.pendingProps,$=z.revealOrder,te=z.tail;if(si(x,b,z.children,M),z=Hr.current,(z&2)!==0)z=z&1|2,b.flags|=128;else{if(x!==null&&(x.flags&128)!==0)e:for(x=b.child;x!==null;){if(x.tag===13)x.memoizedState!==null&&Io(x,M,b);else if(x.tag===19)Io(x,M,b);else if(x.child!==null){x.child.return=x,x=x.child;continue}if(x===b)break e;for(;x.sibling===null;){if(x.return===null||x.return===b)break e;x=x.return}x.sibling.return=x.return,x=x.sibling}z&=1}if(qe(Hr,z),(b.mode&1)===0)b.memoizedState=null;else switch($){case"forwards":for(M=b.child,$=null;M!==null;)x=M.alternate,x!==null&&pl(x)===null&&($=M),M=M.sibling;M=$,M===null?($=b.child,b.child=null):($=M.sibling,M.sibling=null),Vc(b,!1,$,M,te);break;case"backwards":for(M=null,$=b.child,b.child=null;$!==null;){if(x=$.alternate,x!==null&&pl(x)===null){b.child=$;break}x=$.sibling,$.sibling=M,M=$,$=x}Vc(b,!0,M,null,te);break;case"together":Vc(b,!1,null,null,void 0);break;default:b.memoizedState=null}return b.child}function Nf(x,b){(b.mode&1)===0&&x!==null&&(x.alternate=null,b.alternate=null,b.flags|=2)}function kl(x,b,M){if(x!==null&&(b.dependencies=x.dependencies),Cl|=b.lanes,(M&b.childLanes)===0)return null;if(x!==null&&b.child!==x.child)throw Error(s(153));if(b.child!==null){for(x=b.child,M=pu(x,x.pendingProps),b.child=M,M.return=b;x.sibling!==null;)x=x.sibling,M=M.sibling=pu(x,x.pendingProps),M.return=b;M.sibling=null}return b.child}function su(x,b,M){switch(b.tag){case 3:au(b),No();break;case 5:Bu(b);break;case 1:It(b.type)&&er(b);break;case 4:Ql(b,b.stateNode.containerInfo);break;case 10:Ka(b,b.type._context,b.memoizedProps.value);break;case 13:var z=b.memoizedState;if(z!==null)return z.dehydrated!==null?(qe(Hr,Hr.current&1),b.flags|=128,null):(M&b.child.childLanes)!==0?xm(x,b,M):(qe(Hr,Hr.current&1),x=kl(x,b,M),x!==null?x.sibling:null);qe(Hr,Hr.current&1);break;case 19:if(z=(M&b.childLanes)!==0,(x.flags&128)!==0){if(z)return Vh(x,b,M);b.flags|=128}var $=b.memoizedState;if($!==null&&($.rendering=null,$.tail=null,$.lastEffect=null),qe(Hr,Hr.current),z)break;return null;case 22:case 23:return b.lanes=0,pn(x,b,M)}return kl(x,b,M)}function Pa(x){x.flags|=4}function qu(x,b){if(x!==null&&x.child===b.child)return!0;if((b.flags&16)!==0)return!1;for(x=b.child;x!==null;){if((x.flags&12854)!==0||(x.subtreeFlags&12854)!==0)return!1;x=x.sibling}return!0}var ou,lu,Ma,Aa;if(se)ou=function(x,b){for(var M=b.child;M!==null;){if(M.tag===5||M.tag===6)J(x,M.stateNode);else if(M.tag!==4&&M.child!==null){M.child.return=M,M=M.child;continue}if(M===b)break;for(;M.sibling===null;){if(M.return===null||M.return===b)return;M=M.return}M.sibling.return=M.return,M=M.sibling}},lu=function(){},Ma=function(x,b,M,z,$){if(x=x.memoizedProps,x!==z){var te=b.stateNode,pe=Na(Xa.current);M=de(te,M,x,z,$,pe),(b.updateQueue=M)&&Pa(b)}},Aa=function(x,b,M,z){M!==z&&Pa(b)};else if(ye){ou=function(x,b,M,z){for(var $=b.child;$!==null;){if($.tag===5){var te=$.stateNode;M&&z&&(te=Rr(te,$.type,$.memoizedProps,$)),J(x,te)}else if($.tag===6)te=$.stateNode,M&&z&&(te=kr(te,$.memoizedProps,$)),J(x,te);else if($.tag!==4){if($.tag===22&&$.memoizedState!==null)te=$.child,te!==null&&(te.return=$),ou(x,$,!0,!0);else if($.child!==null){$.child.return=$,$=$.child;continue}}if($===b)break;for(;$.sibling===null;){if($.return===null||$.return===b)return;$=$.return}$.sibling.return=$.return,$=$.sibling}};var uu=function(x,b,M,z){for(var $=b.child;$!==null;){if($.tag===5){var te=$.stateNode;M&&z&&(te=Rr(te,$.type,$.memoizedProps,$)),Et(x,te)}else if($.tag===6)te=$.stateNode,M&&z&&(te=kr(te,$.memoizedProps,$)),Et(x,te);else if($.tag!==4){if($.tag===22&&$.memoizedState!==null)te=$.child,te!==null&&(te.return=$),uu(x,$,!0,!0);else if($.child!==null){$.child.return=$,$=$.child;continue}}if($===b)break;for(;$.sibling===null;){if($.return===null||$.return===b)return;$=$.return}$.sibling.return=$.return,$=$.sibling}};lu=function(x,b){var M=b.stateNode;if(!qu(x,b)){x=M.containerInfo;var z=Ht(x);uu(z,b,!1,!1),M.pendingChildren=z,Pa(b),Wt(x,z)}},Ma=function(x,b,M,z,$){var te=x.stateNode,pe=x.memoizedProps;if((x=qu(x,b))&&pe===z)b.stateNode=te;else{var Ne=b.stateNode,Be=Na(Xa.current),ct=null;pe!==z&&(ct=de(Ne,M,pe,z,$,Be)),x&&ct===null?b.stateNode=te:(te=Zt(te,ct,M,pe,z,b,x,Ne),ie(te,M,z,$,Be)&&Pa(b),b.stateNode=te,x?Pa(b):ou(te,b,!1,!1))}},Aa=function(x,b,M,z){M!==z?(x=Na(gs.current),M=Na(Xa.current),b.stateNode=xe(z,x,M,b),Pa(b)):b.stateNode=x.stateNode}}else lu=function(){},Ma=function(){},Aa=function(){};function ys(x,b){if(!tn)switch(x.tailMode){case"hidden":b=x.tail;for(var M=null;b!==null;)b.alternate!==null&&(M=b),b=b.sibling;M===null?x.tail=null:M.sibling=null;break;case"collapsed":M=x.tail;for(var z=null;M!==null;)M.alternate!==null&&(z=M),M=M.sibling;z===null?b||x.tail===null?x.tail=null:x.tail.sibling=null:z.sibling=null}}function Cn(x){var b=x.alternate!==null&&x.alternate.child===x.child,M=0,z=0;if(b)for(var $=x.child;$!==null;)M|=$.lanes|$.childLanes,z|=$.subtreeFlags&14680064,z|=$.flags&14680064,$.return=x,$=$.sibling;else for($=x.child;$!==null;)M|=$.lanes|$.childLanes,z|=$.subtreeFlags,z|=$.flags,$.return=x,$=$.sibling;return x.subtreeFlags|=z,x.childLanes=M,b}function $u(x,b,M){var z=b.pendingProps;switch(ju(b),b.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Cn(b),null;case 1:return It(b.type)&&Ir(),Cn(b),null;case 3:return M=b.stateNode,Fs(),ot(Pr),ot(Nr),Oc(),M.pendingContext&&(M.context=M.pendingContext,M.pendingContext=null),(x===null||x.child===null)&&(Kl(b)?Pa(b):x===null||x.memoizedState.isDehydrated&&(b.flags&256)===0||(b.flags|=1024,_a!==null&&(tp(_a),_a=null))),lu(x,b),Cn(b),null;case 5:Jl(b),M=Na(gs.current);var $=b.type;if(x!==null&&b.stateNode!=null)Ma(x,b,$,z,M),x.ref!==b.ref&&(b.flags|=512,b.flags|=2097152);else{if(!z){if(b.stateNode===null)throw Error(s(166));return Cn(b),null}if(x=Na(Xa.current),Kl(b)){if(!Se)throw Error(s(175));x=ni(b.stateNode,b.type,b.memoizedProps,M,x,b,!$l),b.updateQueue=x,x!==null&&Pa(b)}else{var te=Y($,z,M,x,b);ou(te,b,!1,!1),b.stateNode=te,ie(te,$,z,M,x)&&Pa(b)}b.ref!==null&&(b.flags|=512,b.flags|=2097152)}return Cn(b),null;case 6:if(x&&b.stateNode!=null)Aa(x,b,x.memoizedProps,z);else{if(typeof z!="string"&&b.stateNode===null)throw Error(s(166));if(x=Na(gs.current),M=Na(Xa.current),Kl(b)){if(!Se)throw Error(s(176));if(x=b.stateNode,M=b.memoizedProps,(z=sn(x,M,b,!$l))&&($=ai,$!==null))switch($.tag){case 3:ko($.stateNode.containerInfo,x,M,($.mode&1)!==0);break;case 5:on($.type,$.memoizedProps,$.stateNode,x,M,($.mode&1)!==0)}z&&Pa(b)}else b.stateNode=xe(z,x,M,b)}return Cn(b),null;case 13:if(ot(Hr),z=b.memoizedState,x===null||x.memoizedState!==null&&x.memoizedState.dehydrated!==null){if(tn&&_n!==null&&(b.mode&1)!==0&&(b.flags&128)===0)jh(),No(),b.flags|=98560,$=!1;else if($=Kl(b),z!==null&&z.dehydrated!==null){if(x===null){if(!$)throw Error(s(318));if(!Se)throw Error(s(344));if($=b.memoizedState,$=$!==null?$.dehydrated:null,!$)throw Error(s(317));kn($,b)}else No(),(b.flags&128)===0&&(b.memoizedState=null),b.flags|=4;Cn(b),$=!1}else _a!==null&&(tp(_a),_a=null),$=!0;if(!$)return b.flags&65536?b:null}return(b.flags&128)!==0?(b.lanes=M,b):(M=z!==null,M!==(x!==null&&x.memoizedState!==null)&&M&&(b.child.flags|=8192,(b.mode&1)!==0&&(x===null||(Hr.current&1)!==0?Tn===0&&(Tn=3):td())),b.updateQueue!==null&&(b.flags|=4),Cn(b),null);case 4:return Fs(),lu(x,b),x===null&&Oe(b.stateNode.containerInfo),Cn(b),null;case 10:return js(b.type._context),Cn(b),null;case 17:return It(b.type)&&Ir(),Cn(b),null;case 19:if(ot(Hr),$=b.memoizedState,$===null)return Cn(b),null;if(z=(b.flags&128)!==0,te=$.rendering,te===null)if(z)ys($,!1);else{if(Tn!==0||x!==null&&(x.flags&128)!==0)for(x=b.child;x!==null;){if(te=pl(x),te!==null){for(b.flags|=128,ys($,!1),x=te.updateQueue,x!==null&&(b.updateQueue=x,b.flags|=4),b.subtreeFlags=0,x=M,M=b.child;M!==null;)z=M,$=x,z.flags&=14680066,te=z.alternate,te===null?(z.childLanes=0,z.lanes=$,z.child=null,z.subtreeFlags=0,z.memoizedProps=null,z.memoizedState=null,z.updateQueue=null,z.dependencies=null,z.stateNode=null):(z.childLanes=te.childLanes,z.lanes=te.lanes,z.child=te.child,z.subtreeFlags=0,z.deletions=null,z.memoizedProps=te.memoizedProps,z.memoizedState=te.memoizedState,z.updateQueue=te.updateQueue,z.type=te.type,$=te.dependencies,z.dependencies=$===null?null:{lanes:$.lanes,firstContext:$.firstContext}),M=M.sibling;return qe(Hr,Hr.current&1|2),b.child}x=x.sibling}$.tail!==null&&jn()>Df&&(b.flags|=128,z=!0,ys($,!1),b.lanes=4194304)}else{if(!z)if(x=pl(te),x!==null){if(b.flags|=128,z=!0,x=x.updateQueue,x!==null&&(b.updateQueue=x,b.flags|=4),ys($,!0),$.tail===null&&$.tailMode==="hidden"&&!te.alternate&&!tn)return Cn(b),null}else 2*jn()-$.renderingStartTime>Df&&M!==1073741824&&(b.flags|=128,z=!0,ys($,!1),b.lanes=4194304);$.isBackwards?(te.sibling=b.child,b.child=te):(x=$.last,x!==null?x.sibling=te:b.child=te,$.last=te)}return $.tail!==null?(b=$.tail,$.rendering=b,$.tail=b.sibling,$.renderingStartTime=jn(),b.sibling=null,x=Hr.current,qe(Hr,z?x&1|2:x&1),b):(Cn(b),null);case 22:case 23:return rp(),M=b.memoizedState!==null,x!==null&&x.memoizedState!==null!==M&&(b.flags|=8192),M&&(b.mode&1)!==0?(Si&1073741824)!==0&&(Cn(b),se&&b.subtreeFlags&6&&(b.flags|=8192)):Cn(b),null;case 24:return null;case 25:return null}throw Error(s(156,b.tag))}function y0(x,b){switch(ju(b),b.tag){case 1:return It(b.type)&&Ir(),x=b.flags,x&65536?(b.flags=x&-65537|128,b):null;case 3:return Fs(),ot(Pr),ot(Nr),Oc(),x=b.flags,(x&65536)!==0&&(x&128)===0?(b.flags=x&-65537|128,b):null;case 5:return Jl(b),null;case 13:if(ot(Hr),x=b.memoizedState,x!==null&&x.dehydrated!==null){if(b.alternate===null)throw Error(s(340));No()}return x=b.flags,x&65536?(b.flags=x&-65537|128,b):null;case 19:return ot(Hr),null;case 4:return Fs(),null;case 10:return js(b.type._context),null;case 22:case 23:return rp(),null;case 24:return null;default:return null}}var Hc=!1,Ri=!1,xs=typeof WeakSet=="function"?WeakSet:Set,xt=null;function Yr(x,b){var M=x.ref;if(M!==null)if(typeof M=="function")try{M(null)}catch(z){bn(x,b,z)}else M.current=null}function bs(x,b,M){try{M()}catch(z){bn(x,b,z)}}var bm=!1;function x0(x,b){for(ne(x.containerInfo),xt=b;xt!==null;)if(x=xt,b=x.child,(x.subtreeFlags&1028)!==0&&b!==null)b.return=x,xt=b;else for(;xt!==null;){x=xt;try{var M=x.alternate;if((x.flags&1024)!==0)switch(x.tag){case 0:case 11:case 15:break;case 1:if(M!==null){var z=M.memoizedProps,$=M.memoizedState,te=x.stateNode,pe=te.getSnapshotBeforeUpdate(x.elementType===x.type?z:Zr(x.type,z),$);te.__reactInternalSnapshotBeforeUpdate=pe}break;case 3:se&&ft(x.stateNode.containerInfo);break;case 5:case 6:case 4:case 17:break;default:throw Error(s(163))}}catch(Ne){bn(x,x.return,Ne)}if(b=x.sibling,b!==null){b.return=x.return,xt=b;break}xt=x.return}return M=bm,bm=!1,M}function Ku(x,b,M){var z=b.updateQueue;if(z=z!==null?z.lastEffect:null,z!==null){var $=z=z.next;do{if(($.tag&x)===x){var te=$.destroy;$.destroy=void 0,te!==void 0&&bs(b,M,te)}$=$.next}while($!==z)}}function Wc(x,b){if(b=b.updateQueue,b=b!==null?b.lastEffect:null,b!==null){var M=b=b.next;do{if((M.tag&x)===x){var z=M.create;M.destroy=z()}M=M.next}while(M!==b)}}function Hh(x){var b=x.ref;if(b!==null){var M=x.stateNode;x.tag===5?x=q(M):x=M,typeof b=="function"?b(x):b.current=x}}function Pf(x){var b=x.alternate;b!==null&&(x.alternate=null,Pf(b)),x.child=null,x.deletions=null,x.sibling=null,x.tag===5&&(b=x.stateNode,b!==null&&lt(b)),x.stateNode=null,x.return=null,x.dependencies=null,x.memoizedProps=null,x.memoizedState=null,x.pendingProps=null,x.stateNode=null,x.updateQueue=null}function wm(x){return x.tag===5||x.tag===3||x.tag===4}function Zu(x){e:for(;;){for(;x.sibling===null;){if(x.return===null||wm(x.return))return null;x=x.return}for(x.sibling.return=x.return,x=x.sibling;x.tag!==5&&x.tag!==6&&x.tag!==18;){if(x.flags&2||x.child===null||x.tag===4)continue e;x.child.return=x,x=x.child}if(!(x.flags&2))return x.stateNode}}function Mf(x,b,M){var z=x.tag;if(z===5||z===6)x=x.stateNode,b?me(M,x,b):Vt(M,x);else if(z!==4&&(x=x.child,x!==null))for(Mf(x,b,M),x=x.sibling;x!==null;)Mf(x,b,M),x=x.sibling}function Sm(x,b,M){var z=x.tag;if(z===5||z===6)x=x.stateNode,b?ce(M,x,b):Ut(M,x);else if(z!==4&&(x=x.child,x!==null))for(Sm(x,b,M),x=x.sibling;x!==null;)Sm(x,b,M),x=x.sibling}var Jn=null,ts=!1;function co(x,b,M){for(M=M.child;M!==null;)Wh(x,b,M),M=M.sibling}function Wh(x,b,M){if(Fn&&typeof Fn.onCommitFiberUnmount=="function")try{Fn.onCommitFiberUnmount(hn,M)}catch{}switch(M.tag){case 5:Ri||Yr(M,b);case 6:if(se){var z=Jn,$=ts;Jn=null,co(x,b,M),Jn=z,ts=$,Jn!==null&&(ts?Te(Jn,M.stateNode):ke(Jn,M.stateNode))}else co(x,b,M);break;case 18:se&&Jn!==null&&(ts?qa(Jn,M.stateNode):So(Jn,M.stateNode));break;case 4:se?(z=Jn,$=ts,Jn=M.stateNode.containerInfo,ts=!0,co(x,b,M),Jn=z,ts=$):(ye&&(z=M.stateNode.containerInfo,$=Ht(z),ar(z,$)),co(x,b,M));break;case 0:case 11:case 14:case 15:if(!Ri&&(z=M.updateQueue,z!==null&&(z=z.lastEffect,z!==null))){$=z=z.next;do{var te=$,pe=te.destroy;te=te.tag,pe!==void 0&&((te&2)!==0||(te&4)!==0)&&bs(M,b,pe),$=$.next}while($!==z)}co(x,b,M);break;case 1:if(!Ri&&(Yr(M,b),z=M.stateNode,typeof z.componentWillUnmount=="function"))try{z.props=M.memoizedProps,z.state=M.memoizedState,z.componentWillUnmount()}catch(Ne){bn(M,b,Ne)}co(x,b,M);break;case 21:co(x,b,M);break;case 22:M.mode&1?(Ri=(z=Ri)||M.memoizedState!==null,co(x,b,M),Ri=z):co(x,b,M);break;default:co(x,b,M)}}function Yu(x){var b=x.updateQueue;if(b!==null){x.updateQueue=null;var M=x.stateNode;M===null&&(M=x.stateNode=new xs),b.forEach(function(z){var $=lb.bind(null,x,z);M.has(z)||(M.add(z),z.then($,$))})}}function Us(x,b){var M=b.deletions;if(M!==null)for(var z=0;z<M.length;z++){var $=M[z];try{var te=x,pe=b;if(se){var Ne=pe;e:for(;Ne!==null;){switch(Ne.tag){case 5:Jn=Ne.stateNode,ts=!1;break e;case 3:Jn=Ne.stateNode.containerInfo,ts=!0;break e;case 4:Jn=Ne.stateNode.containerInfo,ts=!0;break e}Ne=Ne.return}if(Jn===null)throw Error(s(160));Wh(te,pe,$),Jn=null,ts=!1}else Wh(te,pe,$);var Be=$.alternate;Be!==null&&(Be.return=null),$.return=null}catch(ct){bn($,b,ct)}}if(b.subtreeFlags&12854)for(b=b.child;b!==null;)Af(b,x),b=b.sibling}function Af(x,b){var M=x.alternate,z=x.flags;switch(x.tag){case 0:case 11:case 14:case 15:if(Us(b,x),ws(x),z&4){try{Ku(3,x,x.return),Wc(3,x)}catch(Ct){bn(x,x.return,Ct)}try{Ku(5,x,x.return)}catch(Ct){bn(x,x.return,Ct)}}break;case 1:Us(b,x),ws(x),z&512&&M!==null&&Yr(M,M.return);break;case 5:if(Us(b,x),ws(x),z&512&&M!==null&&Yr(M,M.return),se){if(x.flags&32){var $=x.stateNode;try{Ae($)}catch(Ct){bn(x,x.return,Ct)}}if(z&4&&($=x.stateNode,$!=null)){var te=x.memoizedProps;if(M=M!==null?M.memoizedProps:te,z=x.type,b=x.updateQueue,x.updateQueue=null,b!==null)try{Ge($,b,z,M,te,x)}catch(Ct){bn(x,x.return,Ct)}}}break;case 6:if(Us(b,x),ws(x),z&4&&se){if(x.stateNode===null)throw Error(s(162));$=x.stateNode,te=x.memoizedProps,M=M!==null?M.memoizedProps:te;try{pt($,M,te)}catch(Ct){bn(x,x.return,Ct)}}break;case 3:if(Us(b,x),ws(x),z&4){if(se&&Se&&M!==null&&M.memoizedState.isDehydrated)try{Rs(b.containerInfo)}catch(Ct){bn(x,x.return,Ct)}if(ye){$=b.containerInfo,te=b.pendingChildren;try{ar($,te)}catch(Ct){bn(x,x.return,Ct)}}}break;case 4:if(Us(b,x),ws(x),z&4&&ye){te=x.stateNode,$=te.containerInfo,te=te.pendingChildren;try{ar($,te)}catch(Ct){bn(x,x.return,Ct)}}break;case 13:Us(b,x),ws(x),$=x.child,$.flags&8192&&(te=$.memoizedState!==null,$.stateNode.isHidden=te,!te||$.alternate!==null&&$.alternate.memoizedState!==null||(Xc=jn())),z&4&&Yu(x);break;case 22:var pe=M!==null&&M.memoizedState!==null;if(x.mode&1?(Ri=(M=Ri)||pe,Us(b,x),Ri=M):Us(b,x),ws(x),z&8192){if(M=x.memoizedState!==null,(x.stateNode.isHidden=M)&&!pe&&(x.mode&1)!==0)for(xt=x,z=x.child;z!==null;){for(b=xt=z;xt!==null;){pe=xt;var Ne=pe.child;switch(pe.tag){case 0:case 11:case 14:case 15:Ku(4,pe,pe.return);break;case 1:Yr(pe,pe.return);var Be=pe.stateNode;if(typeof Be.componentWillUnmount=="function"){var ct=pe,Lt=pe.return;try{var ur=ct;Be.props=ur.memoizedProps,Be.state=ur.memoizedState,Be.componentWillUnmount()}catch(Ct){bn(ct,Lt,Ct)}}break;case 5:Yr(pe,pe.return);break;case 22:if(pe.memoizedState!==null){Kh(b);continue}}Ne!==null?(Ne.return=pe,xt=Ne):Kh(b)}z=z.sibling}if(se){e:if(z=null,se)for(b=x;;){if(b.tag===5){if(z===null){z=b;try{$=b.stateNode,M?Xe($):yt(b.stateNode,b.memoizedProps)}catch(Ct){bn(x,x.return,Ct)}}}else if(b.tag===6){if(z===null)try{te=b.stateNode,M?Ve(te):vt(te,b.memoizedProps)}catch(Ct){bn(x,x.return,Ct)}}else if((b.tag!==22&&b.tag!==23||b.memoizedState===null||b===x)&&b.child!==null){b.child.return=b,b=b.child;continue}if(b===x)break e;for(;b.sibling===null;){if(b.return===null||b.return===x)break e;z===b&&(z=null),b=b.return}z===b&&(z=null),b.sibling.return=b.return,b=b.sibling}}}break;case 19:Us(b,x),ws(x),z&4&&Yu(x);break;case 21:break;default:Us(b,x),ws(x)}}function ws(x){var b=x.flags;if(b&2){try{if(se){e:{for(var M=x.return;M!==null;){if(wm(M)){var z=M;break e}M=M.return}throw Error(s(160))}switch(z.tag){case 5:var $=z.stateNode;z.flags&32&&(Ae($),z.flags&=-33);var te=Zu(x);Sm(x,te,$);break;case 3:case 4:var pe=z.stateNode.containerInfo,Ne=Zu(x);Mf(x,Ne,pe);break;default:throw Error(s(161))}}}catch(Be){bn(x,x.return,Be)}x.flags&=-3}b&4096&&(x.flags&=-4097)}function qc(x,b,M){xt=x,qh(x)}function qh(x,b,M){for(var z=(x.mode&1)!==0;xt!==null;){var $=xt,te=$.child;if($.tag===22&&z){var pe=$.memoizedState!==null||Hc;if(!pe){var Ne=$.alternate,Be=Ne!==null&&Ne.memoizedState!==null||Ri;Ne=Hc;var ct=Ri;if(Hc=pe,(Ri=Be)&&!ct)for(xt=$;xt!==null;)pe=xt,Be=pe.child,pe.tag===22&&pe.memoizedState!==null?Zh($):Be!==null?(Be.return=pe,xt=Be):Zh($);for(;te!==null;)xt=te,qh(te),te=te.sibling;xt=$,Hc=Ne,Ri=ct}$h(x)}else($.subtreeFlags&8772)!==0&&te!==null?(te.return=$,xt=te):$h(x)}}function $h(x){for(;xt!==null;){var b=xt;if((b.flags&8772)!==0){var M=b.alternate;try{if((b.flags&8772)!==0)switch(b.tag){case 0:case 11:case 15:Ri||Wc(5,b);break;case 1:var z=b.stateNode;if(b.flags&4&&!Ri)if(M===null)z.componentDidMount();else{var $=b.elementType===b.type?M.memoizedProps:Zr(b.type,M.memoizedProps);z.componentDidUpdate($,M.memoizedState,z.__reactInternalSnapshotBeforeUpdate)}var te=b.updateQueue;te!==null&&Fh(b,te,z);break;case 3:var pe=b.updateQueue;if(pe!==null){if(M=null,b.child!==null)switch(b.child.tag){case 5:M=q(b.child.stateNode);break;case 1:M=b.child.stateNode}Fh(b,pe,M)}break;case 5:var Ne=b.stateNode;M===null&&b.flags&4&&dt(Ne,b.type,b.memoizedProps,b);break;case 6:break;case 4:break;case 12:break;case 13:if(Se&&b.memoizedState===null){var Be=b.alternate;if(Be!==null){var ct=Be.memoizedState;if(ct!==null){var Lt=ct.dehydrated;Lt!==null&&gi(Lt)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(s(163))}Ri||b.flags&512&&Hh(b)}catch(ur){bn(b,b.return,ur)}}if(b===x){xt=null;break}if(M=b.sibling,M!==null){M.return=b.return,xt=M;break}xt=b.return}}function Kh(x){for(;xt!==null;){var b=xt;if(b===x){xt=null;break}var M=b.sibling;if(M!==null){M.return=b.return,xt=M;break}xt=b.return}}function Zh(x){for(;xt!==null;){var b=xt;try{switch(b.tag){case 0:case 11:case 15:var M=b.return;try{Wc(4,b)}catch(Be){bn(b,M,Be)}break;case 1:var z=b.stateNode;if(typeof z.componentDidMount=="function"){var $=b.return;try{z.componentDidMount()}catch(Be){bn(b,$,Be)}}var te=b.return;try{Hh(b)}catch(Be){bn(b,te,Be)}break;case 5:var pe=b.return;try{Hh(b)}catch(Be){bn(b,pe,Be)}}}catch(Be){bn(b,b.return,Be)}if(b===x){xt=null;break}var Ne=b.sibling;if(Ne!==null){Ne.return=b.return,xt=Ne;break}xt=b.return}}var _l=0,Ra=1,jo=2,$c=3,Rf=4;if(typeof Symbol=="function"&&Symbol.for){var Ss=Symbol.for;_l=Ss("selector.component"),Ra=Ss("selector.has_pseudo_class"),jo=Ss("selector.role"),$c=Ss("selector.test_id"),Rf=Ss("selector.text")}function Fo(x){var b=Ue(x);if(b!=null){if(typeof b.memoizedProps["data-testname"]!="string")throw Error(s(364));return b}if(x=Ce(x),x===null)throw Error(s(362));return x.stateNode.current}function Lf(x,b){switch(b.$$typeof){case _l:if(x.type===b.value)return!0;break;case Ra:e:{b=b.value,x=[x,0];for(var M=0;M<x.length;){var z=x[M++],$=x[M++],te=b[$];if(z.tag!==5||!Qe(z)){for(;te!=null&&Lf(z,te);)$++,te=b[$];if($===b.length){b=!0;break e}else for(z=z.child;z!==null;)x.push(z,$),z=z.sibling}}b=!1}return b;case jo:if(x.tag===5&&gt(x.stateNode,b.value))return!0;break;case Rf:if((x.tag===5||x.tag===6)&&(x=Je(x),x!==null&&0<=x.indexOf(b.value)))return!0;break;case $c:if(x.tag===5&&(x=x.memoizedProps["data-testname"],typeof x=="string"&&x.toLowerCase()===b.value.toLowerCase()))return!0;break;default:throw Error(s(365))}return!1}function Yh(x){switch(x.$$typeof){case _l:return"<"+(F(x.value)||"Unknown")+">";case Ra:return":has("+(Yh(x)||"")+")";case jo:return'[role="'+x.value+'"]';case Rf:return'"'+x.value+'"';case $c:return'[data-testname="'+x.value+'"]';default:throw Error(s(365))}}function Bo(x,b){var M=[];x=[x,0];for(var z=0;z<x.length;){var $=x[z++],te=x[z++],pe=b[te];if($.tag!==5||!Qe($)){for(;pe!=null&&Lf($,pe);)te++,pe=b[te];if(te===b.length)M.push($);else for($=$.child;$!==null;)x.push($,te),$=$.sibling}}return M}function zo(x,b){if(!$e)throw Error(s(363));x=Fo(x),x=Bo(x,b),b=[],x=Array.from(x);for(var M=0;M<x.length;){var z=x[M++];if(z.tag===5)Qe(z)||b.push(z.stateNode);else for(z=z.child;z!==null;)x.push(z),z=z.sibling}return b}var Xh=Math.ceil,Of=o.ReactCurrentDispatcher,Kc=o.ReactCurrentOwner,Hn=o.ReactCurrentBatchConfig,hr=0,cn=null,En=null,ei=0,Si=0,cu=tt(0),Tn=0,Zc=null,Cl=0,mn=0,Yc=0,Xu=null,sa=null,Xc=0,Df=1/0,La=null;function rn(){Df=jn()+500}var Wn=!1,oi=null,fo=null,du=!1,Gs=null,Qh=0,li=0,If=null,Qc=-1,Jc=0;function xn(){return(hr&6)!==0?jn():Qc!==-1?Qc:Qc=jn()}function ki(x){return(x.mode&1)===0?1:(hr&2)!==0&&ei!==0?ei&-ei:Pc.transition!==null?(Jc===0&&(Jc=Gl()),Jc):(x=br,x!==0?x:mt())}function oa(x,b,M,z){if(50<li)throw li=0,If=null,Error(s(185));Fi(x,M,z),((hr&2)===0||x!==cn)&&(x===cn&&((hr&2)===0&&(mn|=M),Tn===4&&El(x,ei)),la(x,z),M===1&&hr===0&&(b.mode&1)===0&&(rn(),To&&yi()))}function la(x,b){var M=x.callbackNode;Ec(x,b);var z=Ls(x,x===cn?ei:0);if(z===0)M!==null&&$r(M),x.callbackNode=null,x.callbackPriority=0;else if(b=z&-z,x.callbackPriority!==b){if(M!=null&&$r(M),b===1)x.tag===0?Cr(km.bind(null,x)):Iu(km.bind(null,x)),at?wt(function(){(hr&6)===0&&yi()}):Qn(Vl,yi),M=null;else{switch(sr(z)){case 1:M=Vl;break;case 4:M=Os;break;case 16:M=Hl;break;case 536870912:M=Ou;break;default:M=Hl}M=Mm(M,Jh.bind(null,x))}x.callbackPriority=b,x.callbackNode=M}}function Jh(x,b){if(Qc=-1,Jc=0,(hr&6)!==0)throw Error(s(327));var M=x.callbackNode;if(Tl()&&x.callbackNode!==M)return null;var z=Ls(x,x===cn?ei:0);if(z===0)return null;if((z&30)!==0||(z&x.expiredLanes)!==0||b)b=Qu(x,z);else{b=z;var $=hr;hr|=2;var te=Cm();(cn!==x||ei!==b)&&(La=null,rn(),fu(x,b));do try{Em();break}catch(Ne){ed(x,Ne)}while(!0);wf(),Of.current=te,hr=$,En!==null?b=0:(cn=null,ei=0,b=Tn)}if(b!==0){if(b===2&&($=sl(x),$!==0&&(z=$,b=ep(x,$))),b===1)throw M=Zc,fu(x,0),El(x,z),la(x,jn()),M;if(b===6)El(x,z);else{if($=x.current.alternate,(z&30)===0&&!b0($)&&(b=Qu(x,z),b===2&&(te=sl(x),te!==0&&(z=te,b=ep(x,te))),b===1))throw M=Zc,fu(x,0),El(x,z),la(x,jn()),M;switch(x.finishedWork=$,x.finishedLanes=z,b){case 0:case 1:throw Error(s(345));case 2:hu(x,sa,La);break;case 3:if(El(x,z),(z&130023424)===z&&(b=Xc+500-jn(),10<b)){if(Ls(x,0)!==0)break;if($=x.suspendedLanes,($&z)!==z){xn(),x.pingedLanes|=x.suspendedLanes&$;break}x.timeoutHandle=le(hu.bind(null,x,sa,La),b);break}hu(x,sa,La);break;case 4:if(El(x,z),(z&4194240)===z)break;for(b=x.eventTimes,$=-1;0<z;){var pe=31-Jt(z);te=1<<pe,pe=b[pe],pe>$&&($=pe),z&=~te}if(z=$,z=jn()-z,z=(120>z?120:480>z?480:1080>z?1080:1920>z?1920:3e3>z?3e3:4320>z?4320:1960*Xh(z/1960))-z,10<z){x.timeoutHandle=le(hu.bind(null,x,sa,La),z);break}hu(x,sa,La);break;case 5:hu(x,sa,La);break;default:throw Error(s(329))}}}return la(x,jn()),x.callbackNode===M?Jh.bind(null,x):null}function ep(x,b){var M=Xu;return x.current.memoizedState.isDehydrated&&(fu(x,b).flags|=256),x=Qu(x,b),x!==2&&(b=sa,sa=M,b!==null&&tp(b)),x}function tp(x){sa===null?sa=x:sa.push.apply(sa,x)}function b0(x){for(var b=x;;){if(b.flags&16384){var M=b.updateQueue;if(M!==null&&(M=M.stores,M!==null))for(var z=0;z<M.length;z++){var $=M[z],te=$.getSnapshot;$=$.value;try{if(!hs(te(),$))return!1}catch{return!1}}}if(M=b.child,b.subtreeFlags&16384&&M!==null)M.return=b,b=M;else{if(b===x)break;for(;b.sibling===null;){if(b.return===null||b.return===x)return!0;b=b.return}b.sibling.return=b.return,b=b.sibling}}return!0}function El(x,b){for(b&=~Yc,b&=~mn,x.suspendedLanes|=b,x.pingedLanes&=~b,x=x.expirationTimes;0<b;){var M=31-Jt(b),z=1<<M;x[M]=-1,b&=~z}}function km(x){if((hr&6)!==0)throw Error(s(327));Tl();var b=Ls(x,0);if((b&1)===0)return la(x,jn()),null;var M=Qu(x,b);if(x.tag!==0&&M===2){var z=sl(x);z!==0&&(b=z,M=ep(x,z))}if(M===1)throw M=Zc,fu(x,0),El(x,b),la(x,jn()),M;if(M===6)throw Error(s(345));return x.finishedWork=x.current.alternate,x.finishedLanes=b,hu(x,sa,La),la(x,jn()),null}function _m(x){Gs!==null&&Gs.tag===0&&(hr&6)===0&&Tl();var b=hr;hr|=1;var M=Hn.transition,z=br;try{if(Hn.transition=null,br=1,x)return x()}finally{br=z,Hn.transition=M,hr=b,(hr&6)===0&&yi()}}function rp(){Si=cu.current,ot(cu)}function fu(x,b){x.finishedWork=null,x.finishedLanes=0;var M=x.timeoutHandle;if(M!==ve&&(x.timeoutHandle=ve,fe(M)),En!==null)for(M=En.return;M!==null;){var z=M;switch(ju(z),z.tag){case 1:z=z.type.childContextTypes,z!=null&&Ir();break;case 3:Fs(),ot(Pr),ot(Nr),Oc();break;case 5:Jl(z);break;case 4:Fs();break;case 13:ot(Hr);break;case 19:ot(Hr);break;case 10:js(z.type._context);break;case 22:case 23:rp()}M=M.return}if(cn=x,En=x=pu(x.current,null),ei=Si=b,Tn=0,Zc=null,Yc=mn=Cl=0,sa=Xu=null,Ea!==null){for(b=0;b<Ea.length;b++)if(M=Ea[b],z=M.interleaved,z!==null){M.interleaved=null;var $=z.next,te=M.pending;if(te!==null){var pe=te.next;te.next=$,z.next=pe}M.pending=z}Ea=null}return x}function ed(x,b){do{var M=En;try{if(wf(),ra.current=Ze,eu){for(var z=ln.memoizedState;z!==null;){var $=z.queue;$!==null&&($.pending=null),z=z.next}eu=!1}if(Po=0,Un=zn=ln=null,na=!1,Mo=0,Kc.current=null,M===null||M.return===null){Tn=1,Zc=b,En=null;break}e:{var te=x,pe=M.return,Ne=M,Be=b;if(b=ei,Ne.flags|=32768,Be!==null&&typeof Be=="object"&&typeof Be.then=="function"){var ct=Be,Lt=Ne,ur=Lt.tag;if((Lt.mode&1)===0&&(ur===0||ur===11||ur===15)){var Ct=Lt.alternate;Ct?(Lt.updateQueue=Ct.updateQueue,Lt.memoizedState=Ct.memoizedState,Lt.lanes=Ct.lanes):(Lt.updateQueue=null,Lt.memoizedState=null)}var gn=zh(pe);if(gn!==null){gn.flags&=-257,Oo(gn,pe,Ne,te,b),gn.mode&1&&Bh(te,ct,b),b=gn,Be=ct;var Xr=b.updateQueue;if(Xr===null){var Oa=new Set;Oa.add(Be),b.updateQueue=Oa}else Xr.add(Be);break e}else{if((b&1)===0){Bh(te,ct,b),td();break e}Be=Error(s(426))}}else if(tn&&Ne.mode&1){var Uo=zh(pe);if(Uo!==null){(Uo.flags&65536)===0&&(Uo.flags|=256),Oo(Uo,pe,Ne,te,b),Nc(xl(Be,Ne));break e}}te=Be=xl(Be,Ne),Tn!==4&&(Tn=2),Xu===null?Xu=[te]:Xu.push(te),te=pe;do{switch(te.tag){case 3:te.flags|=65536,b&=-b,te.lanes|=b;var je=zr(te,Be,b);Xl(te,je);break e;case 1:Ne=Be;var Pe=te.type,He=te.stateNode;if((te.flags&128)===0&&(typeof Pe.getDerivedStateFromError=="function"||He!==null&&typeof He.componentDidCatch=="function"&&(fo===null||!fo.has(He)))){te.flags|=65536,b&=-b,te.lanes|=b;var Tt=bl(te,Ne,b);Xl(te,Tt);break e}}te=te.return}while(te!==null)}Nm(M)}catch(qt){b=qt,En===M&&M!==null&&(En=M=M.return);continue}break}while(!0)}function Cm(){var x=Of.current;return Of.current=Ze,x===null?Ze:x}function td(){(Tn===0||Tn===3||Tn===2)&&(Tn=4),cn===null||(Cl&268435455)===0&&(mn&268435455)===0||El(cn,ei)}function Qu(x,b){var M=hr;hr|=2;var z=Cm();(cn!==x||ei!==b)&&(La=null,fu(x,b));do try{w0();break}catch($){ed(x,$)}while(!0);if(wf(),hr=M,Of.current=z,En!==null)throw Error(s(261));return cn=null,ei=0,Tn}function w0(){for(;En!==null;)Tm(En)}function Em(){for(;En!==null&&!vf();)Tm(En)}function Tm(x){var b=E0(x.alternate,x,Si);x.memoizedProps=x.pendingProps,b===null?Nm(x):En=b,Kc.current=null}function Nm(x){var b=x;do{var M=b.alternate;if(x=b.return,(b.flags&32768)===0){if(M=$u(M,b,Si),M!==null){En=M;return}}else{if(M=y0(M,b),M!==null){M.flags&=32767,En=M;return}if(x!==null)x.flags|=32768,x.subtreeFlags=0,x.deletions=null;else{Tn=6,En=null;return}}if(b=b.sibling,b!==null){En=b;return}En=b=x}while(b!==null);Tn===0&&(Tn=5)}function hu(x,b,M){var z=br,$=Hn.transition;try{Hn.transition=null,br=1,S0(x,b,M,z)}finally{Hn.transition=$,br=z}return null}function S0(x,b,M,z){do Tl();while(Gs!==null);if((hr&6)!==0)throw Error(s(327));M=x.finishedWork;var $=x.finishedLanes;if(M===null)return null;if(x.finishedWork=null,x.finishedLanes=0,M===x.current)throw Error(s(177));x.callbackNode=null,x.callbackPriority=0;var te=M.lanes|M.childLanes;if(ao(x,te),x===cn&&(En=cn=null,ei=0),(M.subtreeFlags&2064)===0&&(M.flags&2064)===0||du||(du=!0,Mm(Hl,function(){return Tl(),null})),te=(M.flags&15990)!==0,(M.subtreeFlags&15990)!==0||te){te=Hn.transition,Hn.transition=null;var pe=br;br=1;var Ne=hr;hr|=4,Kc.current=null,x0(x,M),Af(M,x),re(x.containerInfo),x.current=M,qc(M),ol(),hr=Ne,br=pe,Hn.transition=te}else x.current=M;if(du&&(du=!1,Gs=x,Qh=$),te=x.pendingLanes,te===0&&(fo=null),ll(M.stateNode),la(x,jn()),b!==null)for(z=x.onRecoverableError,M=0;M<b.length;M++)$=b[M],z($.value,{componentStack:$.stack,digest:$.digest});if(Wn)throw Wn=!1,x=oi,oi=null,x;return(Qh&1)!==0&&x.tag!==0&&Tl(),te=x.pendingLanes,(te&1)!==0?x===If?li++:(li=0,If=x):li=0,yi(),null}function Tl(){if(Gs!==null){var x=sr(Qh),b=Hn.transition,M=br;try{if(Hn.transition=null,br=16>x?16:x,Gs===null)var z=!1;else{if(x=Gs,Gs=null,Qh=0,(hr&6)!==0)throw Error(s(331));var $=hr;for(hr|=4,xt=x.current;xt!==null;){var te=xt,pe=te.child;if((xt.flags&16)!==0){var Ne=te.deletions;if(Ne!==null){for(var Be=0;Be<Ne.length;Be++){var ct=Ne[Be];for(xt=ct;xt!==null;){var Lt=xt;switch(Lt.tag){case 0:case 11:case 15:Ku(8,Lt,te)}var ur=Lt.child;if(ur!==null)ur.return=Lt,xt=ur;else for(;xt!==null;){Lt=xt;var Ct=Lt.sibling,gn=Lt.return;if(Pf(Lt),Lt===ct){xt=null;break}if(Ct!==null){Ct.return=gn,xt=Ct;break}xt=gn}}}var Xr=te.alternate;if(Xr!==null){var Oa=Xr.child;if(Oa!==null){Xr.child=null;do{var Uo=Oa.sibling;Oa.sibling=null,Oa=Uo}while(Oa!==null)}}xt=te}}if((te.subtreeFlags&2064)!==0&&pe!==null)pe.return=te,xt=pe;else e:for(;xt!==null;){if(te=xt,(te.flags&2048)!==0)switch(te.tag){case 0:case 11:case 15:Ku(9,te,te.return)}var je=te.sibling;if(je!==null){je.return=te.return,xt=je;break e}xt=te.return}}var Pe=x.current;for(xt=Pe;xt!==null;){pe=xt;var He=pe.child;if((pe.subtreeFlags&2064)!==0&&He!==null)He.return=pe,xt=He;else e:for(pe=Pe;xt!==null;){if(Ne=xt,(Ne.flags&2048)!==0)try{switch(Ne.tag){case 0:case 11:case 15:Wc(9,Ne)}}catch(qt){bn(Ne,Ne.return,qt)}if(Ne===pe){xt=null;break e}var Tt=Ne.sibling;if(Tt!==null){Tt.return=Ne.return,xt=Tt;break e}xt=Ne.return}}if(hr=$,yi(),Fn&&typeof Fn.onPostCommitFiberRoot=="function")try{Fn.onPostCommitFiberRoot(hn,x)}catch{}z=!0}return z}finally{br=M,Hn.transition=b}}return!1}function Pm(x,b,M){b=xl(M,b),b=zr(x,b,1),x=oo(x,b,1),b=xn(),x!==null&&(Fi(x,1,b),la(x,b))}function bn(x,b,M){if(x.tag===3)Pm(x,x,M);else for(;b!==null;){if(b.tag===3){Pm(b,x,M);break}else if(b.tag===1){var z=b.stateNode;if(typeof b.type.getDerivedStateFromError=="function"||typeof z.componentDidCatch=="function"&&(fo===null||!fo.has(z))){x=xl(M,x),x=bl(b,x,1),b=oo(b,x,1),x=xn(),b!==null&&(Fi(b,1,x),la(b,x));break}}b=b.return}}function k0(x,b,M){var z=x.pingCache;z!==null&&z.delete(b),b=xn(),x.pingedLanes|=x.suspendedLanes&M,cn===x&&(ei&M)===M&&(Tn===4||Tn===3&&(ei&130023424)===ei&&500>jn()-Xc?fu(x,0):Yc|=M),la(x,b)}function _0(x,b){b===0&&((x.mode&1)===0?b=1:(b=io,io<<=1,(io&130023424)===0&&(io=4194304)));var M=xn();x=Za(x,b),x!==null&&(Fi(x,b,M),la(x,M))}function C0(x){var b=x.memoizedState,M=0;b!==null&&(M=b.retryLane),_0(x,M)}function lb(x,b){var M=0;switch(x.tag){case 13:var z=x.stateNode,$=x.memoizedState;$!==null&&(M=$.retryLane);break;case 19:z=x.stateNode;break;default:throw Error(s(314))}z!==null&&z.delete(b),_0(x,M)}var E0;E0=function(x,b,M){if(x!==null)if(x.memoizedProps!==b.pendingProps||Pr.current)Vn=!0;else{if((x.lanes&M)===0&&(b.flags&128)===0)return Vn=!1,su(x,b,M);Vn=(x.flags&131072)!==0}else Vn=!1,tn&&(b.flags&1048576)!==0&&Oh(b,ul,b.index);switch(b.lanes=0,b.tag){case 2:var z=b.type;Nf(x,b),x=b.pendingProps;var $=vi(b,Nr.current);ea(b,M),$=ru(null,b,z,x,$,M);var te=Dc();return b.flags|=1,typeof $=="object"&&$!==null&&typeof $.render=="function"&&$.$$typeof===void 0?(b.tag=1,b.memoizedState=null,b.updateQueue=null,It(z)?(te=!0,er(b)):te=!1,b.memoizedState=$.state!==null&&$.state!==void 0?$.state:null,Sf(b),$.updater=Ai,b.stateNode=$,$._reactInternals=b,zs(b,z,x,M),b=ia(null,b,z,!0,te,M)):(b.tag=0,tn&&te&&Ji(b),si(null,b,$,M),b=b.child),b;case 16:z=b.elementType;e:{switch(Nf(x,b),x=b.pendingProps,$=z._init,z=$(z._payload),b.type=z,$=b.tag=ub(z),x=Zr(z,x),$){case 0:b=Do(null,b,z,x,M);break e;case 1:b=Ui(null,b,z,x,M);break e;case 11:b=Uh(null,b,z,x,M);break e;case 14:b=Vu(null,b,z,Zr(z.type,x),M);break e}throw Error(s(306,z,""))}return b;case 0:return z=b.type,$=b.pendingProps,$=b.elementType===z?$:Zr(z,$),Do(x,b,z,$,M);case 1:return z=b.type,$=b.pendingProps,$=b.elementType===z?$:Zr(z,$),Ui(x,b,z,$,M);case 3:e:{if(au(b),x===null)throw Error(s(387));z=b.pendingProps,te=b.memoizedState,$=te.element,so(x,b),Mi(b,z,null,M);var pe=b.memoizedState;if(z=pe.element,Se&&te.isDehydrated)if(te={element:z,isDehydrated:!1,cache:pe.cache,pendingSuspenseBoundaries:pe.pendingSuspenseBoundaries,transitions:pe.transitions},b.updateQueue.baseState=te,b.memoizedState=te,b.flags&256){$=xl(Error(s(423)),b),b=Hu(x,b,z,M,$);break e}else if(z!==$){$=xl(Error(s(424)),b),b=Hu(x,b,z,M,$);break e}else for(Se&&(_n=ds(b.stateNode.containerInfo),ai=b,tn=!0,_a=null,$l=!1),M=Mc(b,null,z,M),b.child=M;M;)M.flags=M.flags&-3|4096,M=M.sibling;else{if(No(),z===$){b=kl(x,b,M);break e}si(x,b,z,M)}b=b.child}return b;case 5:return Bu(b),x===null&&yf(b),z=b.type,$=b.pendingProps,te=x!==null?x.memoizedProps:null,pe=$.children,he(z,$)?pe=null:te!==null&&he(z,te)&&(b.flags|=32),un(x,b),si(x,b,pe,M),b.child;case 6:return x===null&&yf(b),null;case 13:return xm(x,b,M);case 4:return Ql(b,b.stateNode.containerInfo),z=b.pendingProps,x===null?b.child=cl(b,null,z,M):si(x,b,z,M),b.child;case 11:return z=b.type,$=b.pendingProps,$=b.elementType===z?$:Zr(z,$),Uh(x,b,z,$,M);case 7:return si(x,b,b.pendingProps,M),b.child;case 8:return si(x,b,b.pendingProps.children,M),b.child;case 12:return si(x,b,b.pendingProps.children,M),b.child;case 10:e:{if(z=b.type._context,$=b.pendingProps,te=b.memoizedProps,pe=$.value,Ka(b,z,pe),te!==null)if(hs(te.value,pe)){if(te.children===$.children&&!Pr.current){b=kl(x,b,M);break e}}else for(te=b.child,te!==null&&(te.return=b);te!==null;){var Ne=te.dependencies;if(Ne!==null){pe=te.child;for(var Be=Ne.firstContext;Be!==null;){if(Be.context===z){if(te.tag===1){Be=Ya(-1,M&-M),Be.tag=2;var ct=te.updateQueue;if(ct!==null){ct=ct.shared;var Lt=ct.pending;Lt===null?Be.next=Be:(Be.next=Lt.next,Lt.next=Be),ct.pending=Be}}te.lanes|=M,Be=te.alternate,Be!==null&&(Be.lanes|=M),dl(te.return,M,b),Ne.lanes|=M;break}Be=Be.next}}else if(te.tag===10)pe=te.type===b.type?null:te.child;else if(te.tag===18){if(pe=te.return,pe===null)throw Error(s(341));pe.lanes|=M,Ne=pe.alternate,Ne!==null&&(Ne.lanes|=M),dl(pe,M,b),pe=te.sibling}else pe=te.child;if(pe!==null)pe.return=te;else for(pe=te;pe!==null;){if(pe===b){pe=null;break}if(te=pe.sibling,te!==null){te.return=pe.return,pe=te;break}pe=pe.return}te=pe}si(x,b,$.children,M),b=b.child}return b;case 9:return $=b.type,z=b.pendingProps.children,ea(b,M),$=Ca($),z=z($),b.flags|=1,si(x,b,z,M),b.child;case 14:return z=b.type,$=Zr(z,b.pendingProps),$=Zr(z.type,$),Vu(x,b,z,$,M);case 15:return Sl(x,b,b.type,b.pendingProps,M);case 17:return z=b.type,$=b.pendingProps,$=b.elementType===z?$:Zr(z,$),Nf(x,b),b.tag=1,It(z)?(x=!0,er(b)):x=!1,ea(b,M),yl(b,z,$),zs(b,z,$,M),ia(null,b,z,!0,x,M);case 19:return Vh(x,b,M);case 22:return pn(x,b,M)}throw Error(s(156,b.tag))};function Mm(x,b){return Qn(x,b)}function T0(x,b,M,z){this.tag=x,this.key=M,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=b,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=z,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ks(x,b,M,z){return new T0(x,b,M,z)}function rd(x){return x=x.prototype,!(!x||!x.isReactComponent)}function ub(x){if(typeof x=="function")return rd(x)?1:0;if(x!=null){if(x=x.$$typeof,x===S)return 11;if(x===_)return 14}return 2}function pu(x,b){var M=x.alternate;return M===null?(M=ks(x.tag,b,x.key,x.mode),M.elementType=x.elementType,M.type=x.type,M.stateNode=x.stateNode,M.alternate=x,x.alternate=M):(M.pendingProps=b,M.type=x.type,M.flags=0,M.subtreeFlags=0,M.deletions=null),M.flags=x.flags&14680064,M.childLanes=x.childLanes,M.lanes=x.lanes,M.child=x.child,M.memoizedProps=x.memoizedProps,M.memoizedState=x.memoizedState,M.updateQueue=x.updateQueue,b=x.dependencies,M.dependencies=b===null?null:{lanes:b.lanes,firstContext:b.firstContext},M.sibling=x.sibling,M.index=x.index,M.ref=x.ref,M}function np(x,b,M,z,$,te){var pe=2;if(z=x,typeof x=="function")rd(x)&&(pe=1);else if(typeof x=="string")pe=5;else e:switch(x){case c:return Gi(M.children,$,te,b);case f:pe=8,$|=8;break;case p:return x=ks(12,M,b,$|2),x.elementType=p,x.lanes=te,x;case w:return x=ks(13,M,b,$),x.elementType=w,x.lanes=te,x;case E:return x=ks(19,M,b,$),x.elementType=E,x.lanes=te,x;case N:return nd(M,$,te,b);default:if(typeof x=="object"&&x!==null)switch(x.$$typeof){case v:pe=10;break e;case y:pe=9;break e;case S:pe=11;break e;case _:pe=14;break e;case T:pe=16,z=null;break e}throw Error(s(130,x==null?x:typeof x,""))}return b=ks(pe,M,b,$),b.elementType=x,b.type=z,b.lanes=te,b}function Gi(x,b,M,z){return x=ks(7,x,z,b),x.lanes=M,x}function nd(x,b,M,z){return x=ks(22,x,z,b),x.elementType=N,x.lanes=M,x.stateNode={isHidden:!1},x}function ad(x,b,M){return x=ks(6,x,null,b),x.lanes=M,x}function ip(x,b,M){return b=ks(4,x.children!==null?x.children:[],x.key,b),b.lanes=M,b.stateNode={containerInfo:x.containerInfo,pendingChildren:null,implementation:x.implementation},b}function N0(x,b,M,z,$){this.tag=b,this.containerInfo=x,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=ve,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Eo(0),this.expirationTimes=Eo(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Eo(0),this.identifierPrefix=z,this.onRecoverableError=$,Se&&(this.mutableSourceEagerHydrationData=null)}function Am(x,b,M,z,$,te,pe,Ne,Be){return x=new N0(x,b,M,Ne,Be),b===1?(b=1,te===!0&&(b|=8)):b=0,te=ks(3,null,null,b),x.current=te,te.stateNode=x,te.memoizedState={element:z,isDehydrated:M,cache:null,transitions:null,pendingSuspenseBoundaries:null},Sf(te),x}function ap(x){if(!x)return Mt;x=x._reactInternals;e:{if(j(x)!==x||x.tag!==1)throw Error(s(170));var b=x;do{switch(b.tag){case 3:b=b.stateNode.context;break e;case 1:if(It(b.type)){b=b.stateNode.__reactInternalMemoizedMergedChildContext;break e}}b=b.return}while(b!==null);throw Error(s(171))}if(x.tag===1){var M=x.type;if(It(M))return Qt(x,M,b)}return b}function Ju(x){var b=x._reactInternals;if(b===void 0)throw typeof x.render=="function"?Error(s(188)):(x=Object.keys(x).join(","),Error(s(268,x)));return x=K(b),x===null?null:x.stateNode}function sp(x,b){if(x=x.memoizedState,x!==null&&x.dehydrated!==null){var M=x.retryLane;x.retryLane=M!==0&&M<b?M:b}}function sd(x,b){sp(x,b),(x=x.alternate)&&sp(x,b)}function cb(x){return x=K(x),x===null?null:x.stateNode}function P0(){return null}return r.attemptContinuousHydration=function(x){if(x.tag===13){var b=Za(x,134217728);if(b!==null){var M=xn();oa(b,x,134217728,M)}sd(x,134217728)}},r.attemptDiscreteHydration=function(x){if(x.tag===13){var b=Za(x,1);if(b!==null){var M=xn();oa(b,x,1,M)}sd(x,1)}},r.attemptHydrationAtCurrentPriority=function(x){if(x.tag===13){var b=ki(x),M=Za(x,b);if(M!==null){var z=xn();oa(M,x,b,z)}sd(x,b)}},r.attemptSynchronousHydration=function(x){switch(x.tag){case 3:var b=x.stateNode;if(b.current.memoizedState.isDehydrated){var M=Co(b.pendingLanes);M!==0&&($a(b,M|1),la(b,jn()),(hr&6)===0&&(rn(),yi()))}break;case 13:_m(function(){var z=Za(x,1);if(z!==null){var $=xn();oa(z,x,1,$)}}),sd(x,1)}},r.batchedUpdates=function(x,b){var M=hr;hr|=1;try{return x(b)}finally{hr=M,hr===0&&(rn(),To&&yi())}},r.createComponentSelector=function(x){return{$$typeof:_l,value:x}},r.createContainer=function(x,b,M,z,$,te,pe){return Am(x,b,!1,null,M,z,$,te,pe)},r.createHasPseudoClassSelector=function(x){return{$$typeof:Ra,value:x}},r.createHydrationContainer=function(x,b,M,z,$,te,pe,Ne,Be){return x=Am(M,z,!0,x,$,te,pe,Ne,Be),x.context=ap(null),M=x.current,z=xn(),$=ki(M),te=Ya(z,$),te.callback=b??null,oo(M,te,$),x.current.lanes=$,Fi(x,$,z),la(x,z),x},r.createPortal=function(x,b,M){var z=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:u,key:z==null?null:""+z,children:x,containerInfo:b,implementation:M}},r.createRoleSelector=function(x){return{$$typeof:jo,value:x}},r.createTestNameSelector=function(x){return{$$typeof:$c,value:x}},r.createTextSelector=function(x){return{$$typeof:Rf,value:x}},r.deferredUpdates=function(x){var b=br,M=Hn.transition;try{return Hn.transition=null,br=16,x()}finally{br=b,Hn.transition=M}},r.discreteUpdates=function(x,b,M,z,$){var te=br,pe=Hn.transition;try{return Hn.transition=null,br=1,x(b,M,z,$)}finally{br=te,Hn.transition=pe,hr===0&&rn()}},r.findAllNodes=zo,r.findBoundingRects=function(x,b){if(!$e)throw Error(s(363));b=zo(x,b),x=[];for(var M=0;M<b.length;M++)x.push(Ie(b[M]));for(b=x.length-1;0<b;b--){M=x[b];for(var z=M.x,$=z+M.width,te=M.y,pe=te+M.height,Ne=b-1;0<=Ne;Ne--)if(b!==Ne){var Be=x[Ne],ct=Be.x,Lt=ct+Be.width,ur=Be.y,Ct=ur+Be.height;if(z>=ct&&te>=ur&&$<=Lt&&pe<=Ct){x.splice(b,1);break}else if(z!==ct||M.width!==Be.width||Ct<te||ur>pe){if(!(te!==ur||M.height!==Be.height||Lt<z||ct>$)){ct>z&&(Be.width+=ct-z,Be.x=z),Lt<$&&(Be.width=$-ct),x.splice(b,1);break}}else{ur>te&&(Be.height+=ur-te,Be.y=te),Ct<pe&&(Be.height=pe-ur),x.splice(b,1);break}}}return x},r.findHostInstance=Ju,r.findHostInstanceWithNoPortals=function(x){return x=G(x),x=x!==null?W(x):null,x===null?null:x.stateNode},r.findHostInstanceWithWarning=function(x){return Ju(x)},r.flushControlled=function(x){var b=hr;hr|=1;var M=Hn.transition,z=br;try{Hn.transition=null,br=1,x()}finally{br=z,Hn.transition=M,hr=b,hr===0&&(rn(),yi())}},r.flushPassiveEffects=Tl,r.flushSync=_m,r.focusWithin=function(x,b){if(!$e)throw Error(s(363));for(x=Fo(x),b=Bo(x,b),b=Array.from(b),x=0;x<b.length;){var M=b[x++];if(!Qe(M)){if(M.tag===5&&At(M.stateNode))return!0;for(M=M.child;M!==null;)b.push(M),M=M.sibling}}return!1},r.getCurrentUpdatePriority=function(){return br},r.getFindAllNodesFailureDescription=function(x,b){if(!$e)throw Error(s(363));var M=0,z=[];x=[Fo(x),0];for(var $=0;$<x.length;){var te=x[$++],pe=x[$++],Ne=b[pe];if((te.tag!==5||!Qe(te))&&(Lf(te,Ne)&&(z.push(Yh(Ne)),pe++,pe>M&&(M=pe)),pe<b.length))for(te=te.child;te!==null;)x.push(te,pe),te=te.sibling}if(M<b.length){for(x=[];M<b.length;M++)x.push(Yh(b[M]));return`findAllNodes was able to match part of the selector:
  `+(z.join(" > ")+`

No matching component was found for:
  `)+x.join(" > ")}return null},r.getPublicRootInstance=function(x){return x=x.current,x.child?x.child.tag===5?q(x.child.stateNode):x.child.stateNode:null},r.injectIntoDevTools=function(x){if(x={bundleType:x.bundleType,version:x.version,rendererPackageName:x.rendererPackageName,rendererConfig:x.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:o.ReactCurrentDispatcher,findHostInstanceByFiber:cb,findFiberByHostInstance:x.findFiberByHostInstance||P0,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1"},typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u")x=!1;else{var b=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(b.isDisabled||!b.supportsFiber)x=!0;else{try{hn=b.inject(x),Fn=b}catch{}x=!!b.checkDCE}}return x},r.isAlreadyRendering=function(){return!1},r.observeVisibleRects=function(x,b,M,z){if(!$e)throw Error(s(363));x=zo(x,b);var $=Rt(x,M,z).disconnect;return{disconnect:function(){$()}}},r.registerMutableSourceForHydration=function(x,b){var M=b._getVersion;M=M(b._source),x.mutableSourceEagerHydrationData==null?x.mutableSourceEagerHydrationData=[b,M]:x.mutableSourceEagerHydrationData.push(b,M)},r.runWithPriority=function(x,b){var M=br;try{return br=x,b()}finally{br=M}},r.shouldError=function(){return null},r.shouldSuspend=function(){return!1},r.updateContainer=function(x,b,M,z){var $=b.current,te=xn(),pe=ki($);return M=ap(M),b.context===null?b.context=M:b.pendingContext=M,b=Ya(te,pe),b.payload={element:x},z=z===void 0?null:z,z!==null&&(b.callback=z),x=oo($,b,pe),x!==null&&(oa(x,$,pe,te),hl(x,$,pe)),pe},r}),O2}var u4;function nV(){return u4||(u4=1,L2.exports=rV()),L2.exports}var iV=nV();const aV=Th(iV);var D2={exports:{}},bd={};var c4;function sV(){return c4||(c4=1,bd.ConcurrentRoot=1,bd.ContinuousEventPriority=4,bd.DefaultEventPriority=16,bd.DiscreteEventPriority=1,bd.IdleEventPriority=536870912,bd.LegacyRoot=0),bd}var d4;function oV(){return d4||(d4=1,D2.exports=sV()),D2.exports}var _R=oV(),lV=Tr();const f4={children:!0,ref:!0,key:!0,style:!0,forwardedRef:!0,unstable_applyCache:!0,unstable_applyDrawHitFromCache:!0};let h4=!1,p4=!1;const __=".react-konva-event",uV=`ReactKonva: You have a Konva node with draggable = true and position defined but no onDragMove or onDragEnd events are handled.
Position of a node will be changed during drag&drop, so you should update state of the react app as well.
Consider to add onDragMove or onDragEnd events.
For more info see: https://github.com/konvajs/react-konva/issues/256
`,cV=`ReactKonva: You are using "zIndex" attribute for a Konva node.
react-konva may get confused with ordering. Just define correct order of elements in your render function of a component.
For more info see: https://github.com/konvajs/react-konva/issues/194
`,dV={};function U1(t,e,r=dV){if(!h4&&"zIndex"in e&&(console.warn(cV),h4=!0),!p4&&e.draggable){var n=e.x!==void 0||e.y!==void 0,i=e.onDragEnd||e.onDragMove;n&&!i&&(console.warn(uV),p4=!0)}for(var a in r)if(!f4[a]){var s=a.slice(0,2)==="on",o=r[a]!==e[a];if(s&&o){var l=a.substr(2).toLowerCase();l.substr(0,7)==="content"&&(l="content"+l.substr(7,1).toUpperCase()+l.substr(8)),t.off(l,r[a])}var u=!e.hasOwnProperty(a);u&&t.setAttr(a,void 0)}var c=e._useStrictMode,f={},p=!1;const v={};for(var a in e)if(!f4[a]){var s=a.slice(0,2)==="on",y=r[a]!==e[a];if(s&&y){var l=a.substr(2).toLowerCase();l.substr(0,7)==="content"&&(l="content"+l.substr(7,1).toUpperCase()+l.substr(8)),e[a]&&(v[l]=e[a])}!s&&(e[a]!==r[a]||c&&e[a]!==t.getAttr(a))&&(p=!0,f[a]=e[a])}p&&(t.setAttrs(f),df(t));for(var l in v)t.on(l+__,v[l])}function df(t){if(!lV.Konva.autoDrawEnabled){var e=t.getLayer()||t.getStage();e&&e.batchDraw()}}var I2=Hk();const CR={},fV={};Pv.Node.prototype._applyProps=U1;function hV(t,e){if(typeof e=="string"){console.error(`Do not use plain text as child of Konva.Node. You are using text: ${e}`);return}t.add(e),df(t)}function pV(t,e,r){let n=Pv[t];n||(console.error(`Konva has no node with the type ${t}. Group will be used instead. If you use minimal version of react-konva, just import required nodes into Konva: "import "konva/lib/shapes/${t}"  If you want to render DOM elements as part of canvas tree take a look into this demo: https://konvajs.github.io/docs/react/DOM_Portal.html`),n=Pv.Group);const i={},a={};for(var s in e){var o=s.slice(0,2)==="on";o?a[s]=e[s]:i[s]=e[s]}const l=new n(i);return U1(l,a),l}function mV(t,e,r){console.error(`Text components are not supported for now in ReactKonva. Your text is: "${t}"`)}function gV(t,e,r){return!1}function vV(t){return t}function yV(){return null}function xV(){return null}function bV(t,e,r,n){return fV}function wV(){}function SV(t){}function kV(t,e){return!1}function _V(){return CR}function CV(){return CR}const EV=setTimeout,TV=clearTimeout,NV=-1;function PV(t,e){return!1}const MV=!1,AV=!0,RV=!0;function LV(t,e){e.parent===t?e.moveToTop():t.add(e),df(t)}function OV(t,e){e.parent===t?e.moveToTop():t.add(e),df(t)}function ER(t,e,r){e._remove(),t.add(e),e.setZIndex(r.getZIndex()),df(t)}function DV(t,e,r){ER(t,e,r)}function IV(t,e){e.destroy(),e.off(__),df(t)}function jV(t,e){e.destroy(),e.off(__),df(t)}function FV(t,e,r){console.error(`Text components are not yet supported in ReactKonva. You text is: "${r}"`)}function BV(t,e,r){}function zV(t,e,r,n,i){U1(t,i,n)}function UV(t){t.hide(),df(t)}function GV(t){}function VV(t,e){(e.visible==null||e.visible)&&t.show()}function HV(t,e){}function WV(t){}function qV(){}const $V=()=>_R.DefaultEventPriority,KV=Object.freeze(Object.defineProperty({__proto__:null,appendChild:LV,appendChildToContainer:OV,appendInitialChild:hV,cancelTimeout:TV,clearContainer:WV,commitMount:BV,commitTextUpdate:FV,commitUpdate:zV,createInstance:pV,createTextInstance:mV,detachDeletedInstance:qV,finalizeInitialChildren:gV,getChildHostContext:CV,getCurrentEventPriority:$V,getPublicInstance:vV,getRootHostContext:_V,hideInstance:UV,hideTextInstance:GV,idlePriority:I2.unstable_IdlePriority,insertBefore:ER,insertInContainerBefore:DV,isPrimaryRenderer:MV,noTimeout:NV,now:I2.unstable_now,prepareForCommit:yV,preparePortalMount:xV,prepareUpdate:bV,removeChild:IV,removeChildFromContainer:jV,resetAfterCommit:wV,resetTextContent:SV,run:I2.unstable_runWithPriority,scheduleTimeout:EV,shouldDeprioritizeSubtree:kV,shouldSetTextContent:PV,supportsMutation:RV,unhideInstance:VV,unhideTextInstance:HV,warnsIfNotActing:AV},Symbol.toStringTag,{value:"Module"}));var ZV=Object.defineProperty,YV=Object.defineProperties,XV=Object.getOwnPropertyDescriptors,m4=Object.getOwnPropertySymbols,QV=Object.prototype.hasOwnProperty,JV=Object.prototype.propertyIsEnumerable,g4=(t,e,r)=>e in t?ZV(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,v4=(t,e)=>{for(var r in e||(e={}))QV.call(e,r)&&g4(t,r,e[r]);if(m4)for(var r of m4(e))JV.call(e,r)&&g4(t,r,e[r]);return t},eH=(t,e)=>YV(t,XV(e)),y4,x4;typeof window<"u"&&((y4=window.document)!=null&&y4.createElement||((x4=window.navigator)==null?void 0:x4.product)==="ReactNative")?ae.useLayoutEffect:ae.useEffect;function TR(t,e,r){if(!t)return;if(r(t)===!0)return t;let n=t.child;for(;n;){const i=TR(n,e,r);if(i)return i;n=n.sibling}}function NR(t){try{return Object.defineProperties(t,{_currentRenderer:{get(){return null},set(){}},_currentRenderer2:{get(){return null},set(){}}})}catch{return t}}const b4=console.error;console.error=function(){const t=[...arguments].join("");if(t?.startsWith("Warning:")&&t.includes("useContext")){console.error=b4;return}return b4.apply(this,arguments)};const C_=NR(ae.createContext(null));class PR extends ae.Component{render(){return ae.createElement(C_.Provider,{value:this._reactInternals},this.props.children)}}function tH(){const t=ae.useContext(C_);if(t===null)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const e=ae.useId();return ae.useMemo(()=>{for(const n of[t,t?.alternate]){if(!n)continue;const i=TR(n,!1,a=>{let s=a.memoizedState;for(;s;){if(s.memoizedState===e)return!0;s=s.next}});if(i)return i}},[t,e])}function rH(){const t=tH(),[e]=ae.useState(()=>new Map);e.clear();let r=t;for(;r;){if(r.type&&typeof r.type=="object"){const i=r.type._context===void 0&&r.type.Provider===r.type?r.type:r.type._context;i&&i!==C_&&!e.has(i)&&e.set(i,ae.useContext(NR(i)))}r=r.return}return e}function nH(){const t=rH();return ae.useMemo(()=>Array.from(t.keys()).reduce((e,r)=>n=>ae.createElement(e,null,ae.createElement(r.Provider,eH(v4({},n),{value:t.get(r)}))),e=>ae.createElement(PR,v4({},e))),[t])}function iH(t){const e=nr.useRef({});return nr.useLayoutEffect(()=>{e.current=t}),nr.useLayoutEffect(()=>()=>{e.current={}},[]),e.current}const aH=t=>{const e=nr.useRef(),r=nr.useRef(),n=nr.useRef(),i=iH(t),a=nH(),s=o=>{const{forwardedRef:l}=t;l&&(typeof l=="function"?l(o):l.current=o)};return nr.useLayoutEffect(()=>(r.current=new Pv.Stage({width:t.width,height:t.height,container:e.current}),s(r.current),n.current=$g.createContainer(r.current,_R.LegacyRoot,!1,null),$g.updateContainer(nr.createElement(a,{},t.children),n.current),()=>{Pv.isBrowser&&(s(null),$g.updateContainer(null,n.current,null),r.current.destroy())}),[]),nr.useLayoutEffect(()=>{s(r.current),U1(r.current,t,i),$g.updateContainer(nr.createElement(a,{},t.children),n.current,null)}),nr.createElement("div",{ref:e,id:t.id,accessKey:t.accessKey,className:t.className,role:t.role,style:t.style,tabIndex:t.tabIndex,title:t.title})},vx="Layer",yx="Rect",sH="Circle",MR="Line",oH="Image",lH="Text",uH="Path",AR="Transformer",$g=aV(KV);$g.injectIntoDevTools({findHostInstanceByFiber:()=>null,bundleType:0,version:nr.version,rendererPackageName:"react-konva"});const RR=nr.forwardRef((t,e)=>nr.createElement(PR,{},nr.createElement(aH,{...t,forwardedRef:e}))),cH=({isOpen:t,onClose:e,onConfirm:r,title:n,message:i,initialValue:a="",placeholder:s="",confirmText:o="Confirmar",cancelText:l="Cancelar"})=>{const[u,c]=ae.useState(a),f=ae.useRef(null);if(ae.useEffect(()=>{c(a)},[a,t]),ae.useEffect(()=>{t&&f.current&&setTimeout(()=>f.current.focus(),50)},[t]),!t)return null;const p=v=>{v.preventDefault(),r(u),e()};return xo.createPortal(m.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/80 backdrop-blur-md animate-in fade-in duration-300",children:m.jsxs("div",{className:"bg-[#0f0f13] border border-white/10 rounded-2xl p-6 shadow-2xl shadow-black/50 w-full max-w-md space-y-5 animate-in zoom-in-95 slide-in-from-bottom-2 duration-300 relative overflow-hidden ring-1 ring-white/5",onClick:v=>v.stopPropagation(),children:[m.jsx("div",{className:"absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-primary to-transparent opacity-70"}),m.jsx("div",{className:"absolute -top-10 -right-10 size-40 bg-primary/5 rounded-full blur-3xl pointer-events-none"}),m.jsxs("div",{children:[m.jsx("h3",{className:"text-xl font-bold text-white tracking-tight",children:n}),i&&m.jsx("p",{className:"text-sm text-slate-400 leading-relaxed mt-2",children:i})]}),m.jsxs("form",{onSubmit:p,className:"space-y-6",children:[m.jsx("input",{ref:f,type:"text",value:u,onChange:v=>c(v.target.value),placeholder:s,className:"w-full bg-black/30 border border-white/10 rounded-xl px-4 py-3.5 text-white placeholder-slate-600 focus:border-primary/50 focus:ring-1 focus:ring-primary/50 outline-none transition-all font-sans text-sm shadow-inner"}),m.jsxs("div",{className:"flex justify-end gap-3 pt-2",children:[m.jsx("button",{type:"button",onClick:e,className:"px-4 py-2 text-sm text-slate-400 hover:text-white transition-colors",children:l}),m.jsx(Dn,{type:"submit",variant:"primary",disabled:!u.trim(),children:o})]})]})]})}),document.body)},dH=({settings:t,onUpdate:e})=>{const{t:r}=Ps();if(!t)return null;const n=(i,a)=>{e({...t,[i]:a})};return m.jsxs("div",{className:"p-6 space-y-8 animate-in fade-in slide-in-from-right-4",children:[m.jsxs("div",{className:"flex items-center gap-3 text-slate-400 mb-2",children:[m.jsx("span",{className:"material-symbols-outlined",children:"tune"}),m.jsx("h3",{className:"text-xs font-black uppercase tracking-widest",children:r("map.settings")||"Settings"})]}),m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("label",{className:"text-sm font-bold text-white flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-slate-500",children:"grid_4x4"}),r("map.show_grid")||"Show Grid"]}),m.jsx("input",{type:"checkbox",checked:t.showGrid||!1,onChange:i=>n("showGrid",i.target.checked),className:"accent-primary size-5 rounded cursor-pointer"})]}),t.showGrid&&m.jsxs("div",{children:[m.jsxs("label",{className:"text-[10px] uppercase font-bold text-slate-500 mb-2 block",children:[r("map.grid_size")||"Grid Size"," (px)"]}),m.jsx("input",{type:"range",min:"20",max:"200",step:"10",value:t.gridSize||50,onChange:i=>n("gridSize",parseInt(i.target.value)),className:"w-full accent-primary mb-2"}),m.jsxs("div",{className:"flex justify-between text-[10px] font-mono text-slate-500",children:[m.jsx("span",{children:"20px"}),m.jsxs("span",{className:"text-primary font-bold",children:[t.gridSize||50,"px"]}),m.jsx("span",{children:"200px"})]})]})]}),m.jsx("div",{className:"h-px bg-white/5 my-4"}),m.jsxs("div",{className:"space-y-4",children:[m.jsxs("h4",{className:"text-[10px] uppercase font-bold text-slate-500 tracking-widest mb-4 flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"aspect_ratio"}),r("map.dimensions")||"Dimensions"]}),m.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[m.jsxs("div",{children:[m.jsx("label",{className:"text-[10px] uppercase font-bold text-slate-600 mb-1 block",children:"Width"}),m.jsx("input",{type:"number",value:t.width||800,onChange:i=>n("width",parseInt(i.target.value)),className:"w-full bg-black/30 border border-white/10 rounded-lg p-2 text-white font-mono text-xs focus:border-primary outline-none"})]}),m.jsxs("div",{children:[m.jsx("label",{className:"text-[10px] uppercase font-bold text-slate-600 mb-1 block",children:"Height"}),m.jsx("input",{type:"number",value:t.height||600,onChange:i=>n("height",parseInt(i.target.value)),className:"w-full bg-black/30 border border-white/10 rounded-lg p-2 text-white font-mono text-xs focus:border-primary outline-none"})]})]})]}),m.jsx("div",{className:"h-px bg-white/5 my-4"}),m.jsxs("div",{className:"space-y-2",children:[m.jsxs("h4",{className:"text-[10px] uppercase font-bold text-slate-500 tracking-widest mb-2 flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"image"}),r("map.background")||"Background"]}),t.bgImage?m.jsxs("div",{className:"w-full h-32 rounded-xl border border-white/10 overflow-hidden relative group",children:[m.jsx("img",{src:t.bgImage,className:"w-full h-full object-cover opacity-50"}),m.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:m.jsxs("span",{className:"text-xs font-mono text-white/50",children:[t.width,"x",t.height]})})]}):m.jsx("div",{className:"p-4 rounded-xl border border-dashed border-white/10 text-center text-xs text-slate-500",children:"No background image"})]})]})},j2=({stepNumber:t,title:e,isOpen:r,onClick:n,children:i})=>m.jsxs("div",{className:`border border-white/10 rounded-2xl bg-[#13141f] overflow-hidden transition-all duration-300 ${r?"ring-1 ring-primary/50":"opacity-80"}`,children:[m.jsxs("button",{onClick:n,className:"w-full flex items-center justify-between p-6 hover:bg-white/5 transition-colors",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("div",{className:`size-8 rounded-full flex items-center justify-center font-black text-sm ${r?"bg-primary text-white":"bg-white/10 text-slate-400"}`,children:t}),m.jsx("h3",{className:`text-lg font-bold ${r?"text-white":"text-slate-400"}`,children:e})]}),m.jsx("span",{className:`material-symbols-outlined transition-transform duration-300 ${r?"rotate-180 text-primary":"text-slate-500"}`,children:"expand_more"})]}),r&&m.jsx("div",{className:"p-6 pt-0 border-t border-white/5 animate-in fade-in slide-in-from-top-2",children:i})]}),F2=({icon:t,title:e,desc:r,selected:n,onClick:i})=>m.jsxs("div",{onClick:i,className:`p-6 rounded-xl border cursor-pointer transition-all relative group h-full flex flex-col justify-between ${n?"bg-primary/20 border-primary shadow-[0_0_30px_rgba(var(--color-primary),0.3)]":"bg-[#0a0a0c] border-white/10 hover:border-white/30"}`,children:[m.jsxs("div",{className:"mb-4",children:[m.jsx("div",{className:`size-12 rounded-lg flex items-center justify-center mb-4 ${n?"bg-primary text-white":"bg-white/10 text-slate-400 group-hover:text-white group-hover:bg-white/20"}`,children:m.jsx("span",{className:"material-symbols-outlined text-2xl",children:t})}),m.jsx("h4",{className:"font-bold text-white mb-1",children:e}),m.jsx("p",{className:"text-xs text-slate-500 leading-relaxed",children:r})]}),n&&m.jsx("div",{className:"absolute top-4 right-4 size-3 bg-primary rounded-full shadow-glow"})]}),fH=({src:t,x:e,y:r,width:n,height:i,...a})=>{const[s,o]=ae.useState(null);return ae.useEffect(()=>{if(!t)return;const l=new window.Image;l.src=t,l.crossOrigin="Anonymous",l.onload=()=>{o(l)}},[t]),m.jsx(oH,{image:s,x:e,y:r,width:n,height:i,...a})},hH=({selectedId:t})=>{const e=nr.useRef();return nr.useEffect(()=>{if(t){const r=e.current.getStage().findOne("#"+t);r&&(e.current.nodes([r]),e.current.getLayer().batchDraw())}else e.current.nodes([])},[t]),m.jsx(AR,{ref:e})},ek=({mode:t})=>{const{username:e,projectName:r,folderId:n,entityId:i}=qi(),a=Va(),s=Nh(),{setRightOpen:o,setRightPanelTab:l,setAvailableTemplates:u,mapSettings:c,setMapSettings:f}=nl(),[p,v]=ae.useState(t==="create"?"setup":"editor"),[y,S]=ae.useState(null);ae.useEffect(()=>{v(t==="create"?"setup":"editor")},[t]);const[w,E]=ae.useState(s.state?.folderId||null),[_,T]=ae.useState(1),[N,R]=ae.useState({name:"New Map",description:"",parentZone:null,type:"regional",sourceType:"blank",dims:{width:800,height:600},bgImage:null}),[I,F]=ae.useState(!1),[D,j]=ae.useState("brush"),[B,G]=ae.useState([]),[K,O]=ae.useState([]),[W,U]=ae.useState([]),[q,Z]=ae.useState(null),Q=nr.useRef(!1),[ne,re]=ae.useState({isOpen:!1,id:null,text:""}),Y=se=>{(se.target===se.target.getStage()||se.target.name()==="bg-image")&&Z(null)},J=se=>{Y(se);const Se=se.target.getStage().getPointerPosition();D!=="select"&&(Q.current=!0,D==="brush"||D==="eraser"?G([...B,{id:`line-${Date.now()}`,tool:D,points:[Se.x,Se.y],color:D==="eraser"?"#ffffff":"#df4b26",size:D==="eraser"?20:5}]):D==="rect"?O([...K,{id:`rect-${Date.now()}`,x:Se.x,y:Se.y,width:0,height:0,color:"#df4b26"}]):D==="text"&&(U([...W,{id:`text-${Date.now()}`,x:Se.x,y:Se.y,text:"Double click to edit",fontSize:20,color:"#ffffff"}]),Q.current=!1))},ie=se=>{if(!Q.current)return;const Se=se.target.getStage().getPointerPosition();D==="brush"||D==="eraser"?G(Ue=>{const Oe=[...Ue],mt={...Oe[Oe.length-1]};return mt.points=mt.points.concat([Se.x,Se.y]),Oe[Oe.length-1]=mt,Oe}):D==="rect"&&O(Ue=>{const Oe=[...Ue],mt={...Oe[Oe.length-1]};return mt.width=Se.x-mt.x,mt.height=Se.y-mt.y,Oe[Oe.length-1]=mt,Oe})},de=()=>{Q.current=!1};ae.useEffect(()=>{if(o(p==="editor"),p==="editor"){l&&l("CONTEXT");const ye={showGrid:!0,gridSize:50,width:N.dims.width,height:N.dims.height};f(ye)}const se=setInterval(()=>{const ye=document.getElementById("global-right-panel-portal");ye&&(S(ye),clearInterval(se))},100);return()=>{clearInterval(se),l&&l("NOTEBOOKS")}},[p,l]);const he=se=>{f(se),R(ye=>({...ye,dims:{width:se.width,height:se.height},bgImage:se.bgImage||ye.bgImage}))};ae.useEffect(()=>{t==="create"&&!w&&n&&(console.log("Resolving folder ID for slug:",n),et.get(`/world-bible/folders/${n}`).then(se=>E(se.id)).catch(se=>console.error("Could not resolve folder ID",se)))},[t,n,w]);const xe=se=>{const ye=se.target.files[0];if(ye){const Se=new FileReader;Se.onload=Ue=>{const Oe=new Image;Oe.onload=()=>{R(mt=>({...mt,bgImage:Ue.target.result,dims:{width:Oe.width,height:Oe.height},sourceType:"upload"}))},Oe.src=Ue.target.result},Se.readAsDataURL(ye)}},le=nr.useRef(null),fe=async()=>{if(!w){alert("Folder context missing. Please start from the folder view again.");return}F(!0);try{let se=N.bgImage;if(le.current){const Ue=le.current.findOne("Transformer");if(Ue&&Ue.nodes([]),se=le.current.toDataURL({pixelRatio:.5}),Ue&&q){const Oe=le.current.findOne("#"+q);Oe&&Ue.nodes([Oe])}}const ye={nombre:N.name,tipoEspecial:"map",carpetaId:w,descripcion:N.description,attributes:{type:N.type,width:N.dims.width,height:N.dims.height,bgImage:N.bgImage,layers:{lines:B,rectangles:K,texts:W},snapshotUrl:se},iconUrl:se},Se=await et.post("/world-bible/entities",ye);window.dispatchEvent(new CustomEvent("folder-update",{detail:{folderId:w}})),a(`/${e}/${r}/map-editor/edit/${Se.id}`,{replace:!0})}catch(se){console.error(se),alert("Error creating map. Check console.")}finally{F(!1)}},ve=nr.useRef(null);ae.useEffect(()=>{(!t||t==="edit")&&i&&et.get(`/world-bible/entities/${i}`).then(se=>{E(se.carpetaId),ve.current=se.iconUrl,v("editor");let ye=se.attributes||{},Se={};const Ue=ye.layers||ye.bgImage;if(!Ue&&se.descripcion&&se.descripcion.trim().startsWith("{"))try{Se=JSON.parse(se.descripcion)}catch(lt){console.error("Error parsing legacy map data",lt)}const Oe=Ue?ye:Se;let mt=se.descripcion;se.descripcion&&se.descripcion.trim().startsWith("{")&&(mt=Se.description||""),R({name:se.nombre,description:mt||"",parentZone:null,type:Oe.type||"regional",sourceType:Oe.bgImage?"upload":"blank",dims:{width:Oe.width||800,height:Oe.height||600},bgImage:Oe.bgImage}),Oe.layers&&(G(Oe.layers.lines||[]),O(Oe.layers.rectangles||[]),U(Oe.layers.texts||[])),f({name:se.nombre,description:mt||"",type:Oe.type||"regional",showGrid:!0,gridSize:50,width:Oe.width||800,height:Oe.height||600,bgImage:Oe.bgImage})}).catch(se=>console.error("Error loading entity",se))},[t,i]);const ge=async()=>{F(!0);try{let se=N.bgImage;if(le.current){Z(null);const Se=le.current.findOne("Transformer");Se&&Se.nodes([]),se=le.current.toDataURL({pixelRatio:.5})}const ye={id:i,nombre:N.name,tipoEspecial:"map",carpetaId:w,descripcion:N.description,attributes:{type:N.type,width:N.dims.width,height:N.dims.height,bgImage:N.bgImage,layers:{lines:B,rectangles:K,texts:W},snapshotUrl:se},iconUrl:ve.current};await et.put(`/world-bible/entities/${i}`,ye),a(w?`/${e}/${r}/bible/folder/${w}`:`/${e}/${r}/bible`)}catch(se){console.error("Save failed",se),alert("Error saving map")}finally{F(!1)}};return p==="setup"?m.jsxs("div",{className:"flex-1 flex flex-col h-screen bg-[#060608] text-white",children:[m.jsxs("div",{className:"h-16 border-b border-white/5 flex items-center justify-between px-8 bg-[#0a0a0c]",children:[m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsx("div",{className:"p-2 bg-primary/20 rounded-lg text-primary",children:m.jsx("span",{className:"material-symbols-outlined",children:"add_circle"})}),m.jsxs("div",{children:[m.jsx("h1",{className:"text-lg font-bold leading-tight",children:"Create New Map / Zone"}),m.jsx("p",{className:"text-[10px] text-slate-500 uppercase font-bold tracking-wider",children:"Configure details for your new cartography entry"})]})]}),m.jsx("button",{onClick:()=>a(-1),className:"p-2 hover:bg-white/5 rounded-full text-slate-500 hover:text-white transition-colors",children:m.jsx("span",{className:"material-symbols-outlined",children:"close"})})]}),m.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-8",children:m.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[m.jsx(j2,{stepNumber:"1",title:"Identity & Hierarchy",isOpen:_===1,onClick:()=>T(1),children:m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{children:[m.jsx("label",{className:"text-[10px] uppercase font-bold text-slate-500 mb-2 block",children:"Map Name"}),m.jsx("input",{autoFocus:!0,value:N.name,onChange:se=>R({...N,name:se.target.value}),className:"w-full bg-[#0a0a0c] border border-white/10 rounded-xl p-4 text-white focus:border-primary outline-none transition-colors",placeholder:"e.g. The Sapphire Coast"})]}),m.jsxs("div",{children:[m.jsx("label",{className:"text-[10px] uppercase font-bold text-slate-500 mb-2 block",children:"Parent Zone (Optional)"}),m.jsxs("div",{className:"w-full bg-[#0a0a0c] border border-white/10 rounded-xl p-4 text-slate-400 flex items-center justify-between cursor-pointer hover:border-white/20",children:[m.jsx("span",{children:"Current Folder (Default)"}),m.jsx("span",{className:"material-symbols-outlined text-sm",children:"expand_more"})]}),m.jsx("p",{className:"text-[10px] text-slate-600 mt-2",children:"Selecting a parent makes this a sub-zone."})]})]}),m.jsxs("div",{children:[m.jsx("label",{className:"text-[10px] uppercase font-bold text-slate-500 mb-2 block",children:"Description"}),m.jsx("textarea",{value:N.description,onChange:se=>R({...N,description:se.target.value}),className:"w-full h-40 bg-[#0a0a0c] border border-white/10 rounded-xl p-4 text-white resize-none focus:border-primary outline-none transition-colors leading-relaxed",placeholder:"Brief description of geography, climate, or importance..."})]})]})}),m.jsx(j2,{stepNumber:"2",title:"Map Type",isOpen:_===2,onClick:()=>T(2),children:m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[m.jsx(F2,{icon:"public",title:"World Map",desc:"Continents, oceans, global scale.",selected:N.type==="world",onClick:()=>R({...N,type:"world"})}),m.jsx(F2,{icon:"map",title:"Regional Map",desc:"Kingdoms, provinces, biomes.",selected:N.type==="regional",onClick:()=>R({...N,type:"regional"})}),m.jsx(F2,{icon:"location_city",title:"City / Local",desc:"Cities, dungeons, battlemaps.",selected:N.type==="local",onClick:()=>R({...N,type:"local"})})]})}),m.jsx(j2,{stepNumber:"3",title:"Canvas Source",isOpen:_===3,onClick:()=>T(3),children:m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[m.jsxs("div",{onClick:()=>document.getElementById("map-upload-input").click(),className:`relative p-8 rounded-xl border-2 border-dashed flex flex-col items-center justify-center text-center cursor-pointer transition-all group min-h-[200px] ${N.sourceType==="upload"?"border-primary bg-primary/5":"border-white/10 hover:border-white/30 bg-[#0a0a0c]"}`,children:[m.jsx("input",{id:"map-upload-input",type:"file",accept:"image/*",className:"hidden",onChange:xe}),N.bgImage?m.jsx("img",{src:N.bgImage,alt:"Preview",className:"absolute inset-0 w-full h-full object-cover rounded-xl opacity-50 group-hover:opacity-70"}):m.jsxs(m.Fragment,{children:[m.jsx("div",{className:"size-16 bg-white/5 rounded-full flex items-center justify-center mb-4 group-hover:scale-110 transition-transform",children:m.jsx("span",{className:"material-symbols-outlined text-3xl text-slate-400",children:"cloud_upload"})}),m.jsx("h4",{className:"font-bold text-white",children:"Upload Image File"}),m.jsx("p",{className:"text-xs text-slate-500 mt-2",children:"Drag & drop or click to browse"}),m.jsx("p",{className:"text-[10px] text-slate-600 mt-1 uppercase font-bold",children:"JPG, PNG, WEBP  Max 20MB"})]}),N.sourceType==="upload"&&m.jsx("div",{className:"absolute top-4 right-4 size-3 bg-primary rounded-full shadow-glow z-10"})]}),m.jsxs("div",{onClick:()=>R({...N,sourceType:"blank",bgImage:null}),className:`p-8 rounded-xl border flex flex-col items-center justify-center text-center cursor-pointer transition-all min-h-[200px] ${N.sourceType==="blank"?"border-primary bg-primary/5":"border-white/10 hover:border-white/30 bg-[#0a0a0c]"}`,children:[m.jsx("div",{className:"size-16 bg-white/5 rounded-full flex items-center justify-center mb-4",children:m.jsx("span",{className:"material-symbols-outlined text-3xl text-slate-400",children:"check_box_outline_blank"})}),m.jsx("h4",{className:"font-bold text-white",children:"Blank Canvas"}),m.jsx("p",{className:"text-xs text-slate-500 mt-2",children:"Start a new drawing from scratch"}),N.sourceType==="blank"&&m.jsxs("div",{className:"mt-6 flex items-center gap-2 bg-black/50 p-1 rounded-lg border border-white/10",children:[m.jsx("span",{className:"text-[10px] uppercase font-bold text-slate-500 px-2",children:"Size"}),m.jsx("span",{className:"text-xs font-mono text-white",children:"4096 px"}),m.jsx("span",{className:"text-xs text-slate-500",children:"x"}),m.jsx("span",{className:"text-xs font-mono text-white",children:"4096 px"})]})]})]})})]})}),m.jsxs("div",{className:"h-20 border-t border-white/5 bg-[#0a0a0c] flex items-center justify-between px-8 z-20",children:[m.jsx("button",{onClick:()=>a(-1),className:"text-sm font-bold text-slate-500 hover:text-white transition-colors",children:"Cancel"}),m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("span",{className:"text-xs text-slate-600 italic",children:"Changes saved locally"}),m.jsx(Dn,{variant:"primary",size:"lg",icon:"check",onClick:fe,disabled:!N.name||I,className:"bg-primary hover:bg-primary-light text-white shadow-lg shadow-primary/25 px-8",children:I?"Creating...":"Create Map"})]})]})]}):m.jsxs("div",{className:"flex flex-col h-screen w-full bg-[#0f0f13] text-white overflow-hidden",children:[y&&xo.createPortal(m.jsx(dH,{settings:c,onUpdate:he}),y),m.jsxs("header",{className:"h-14 border-b border-white/5 flex items-center justify-between px-4 bg-[#1a1a20] shrink-0",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("button",{onClick:()=>a(-1),className:"p-2 hover:bg-white/5 rounded-full",title:"Back to Collection",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"arrow_back"})}),m.jsxs("div",{className:"flex flex-col",children:[m.jsx("input",{value:N.name,onChange:se=>R({...N,name:se.target.value}),className:"bg-transparent font-bold text-sm outline-none focus:bg-white/5 rounded px-2 -ml-2"}),m.jsxs("span",{className:"text-[10px] text-text-muted px-2",children:[N.dims.width," x ",N.dims.height,"  ",c?.gridSize||50,"px Grid"]})]})]}),m.jsx("div",{className:"flex items-center gap-2",children:m.jsx(Dn,{variant:"primary",size:"sm",icon:"save",onClick:ge,disabled:I,children:I?"Saving...":"Save Changes"})})]}),m.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[m.jsx("div",{className:"w-14 bg-[#1a1a20] border-r border-white/5 flex flex-col items-center py-4 gap-4 z-10",children:[{id:"select",icon:"near_me"},{id:"brush",icon:"brush"},{id:"eraser",icon:"ink_eraser"},{id:"rect",icon:"check_box_outline_blank"},{id:"text",icon:"title"}].map(se=>m.jsx("button",{onClick:()=>j(se.id),className:`p-2 rounded-lg transition-colors ${D===se.id?"bg-primary text-white shadow-lg shadow-primary/30":"hover:bg-white/5 text-slate-400 hover:text-white"}`,children:m.jsx("span",{className:"material-symbols-outlined",children:se.icon})},se.id))}),m.jsx("div",{className:"flex-1 overflow-auto bg-[#0f0f13] relative flex items-center justify-center p-8 custom-scrollbar",children:m.jsx("div",{className:"bg-[#1a1a20] shadow-[0_0_50px_rgba(0,0,0,0.5)] flex-none",children:m.jsxs(RR,{ref:le,width:N.dims.width,height:N.dims.height,onMouseDown:J,onMouseMove:ie,onMouseUp:de,className:"bg-white",children:[m.jsxs(vx,{children:[N.bgImage&&m.jsx(fH,{name:"bg-image",src:N.bgImage,x:0,y:0,width:N.dims.width,height:N.dims.height,onMouseDown:J,onTouchStart:J}),c?.showGrid&&m.jsx(yx,{width:N.dims.width,height:N.dims.height,fillPatternImage:(()=>{const se=document.createElement("canvas");se.width=c.gridSize||50,se.height=c.gridSize||50;const ye=se.getContext("2d");return ye.strokeStyle="rgba(0,0,0,0.2)",ye.lineWidth=1,ye.strokeRect(0,0,se.width,se.height),se})(),listening:!1})]}),m.jsxs(vx,{children:[B.map((se,ye)=>m.jsx(MR,{points:se.points,stroke:se.color,strokeWidth:se.size,tension:.5,lineCap:"round",lineJoin:"round",globalCompositeOperation:se.tool==="eraser"?"destination-out":"source-over"},ye)),K.map((se,ye)=>m.jsx(yx,{id:se.id,x:se.x,y:se.y,width:se.width,height:se.height,stroke:se.color,strokeWidth:2,draggable:D==="select",onClick:()=>D==="select"&&Z(se.id),onTap:()=>D==="select"&&Z(se.id)},se.id)),W.map((se,ye)=>m.jsx(lH,{id:se.id,x:se.x,y:se.y,text:se.text,fontSize:se.fontSize,fill:se.color,draggable:D==="select",onClick:()=>D==="select"&&Z(se.id),onTap:()=>D==="select"&&Z(se.id),onDblClick:Se=>{re({isOpen:!0,id:se.id,text:se.text})}},se.id)),m.jsx(hH,{selectedId:q})]})]})})})]}),m.jsx(cH,{isOpen:ne.isOpen,onClose:()=>re(se=>({...se,isOpen:!1})),title:"Edit Map Text",initialValue:ne.text,onConfirm:se=>{U(ye=>ye.map(Se=>Se.id===ne.id?{...Se,text:se}:Se))},confirmText:"Save Text"})]})};function LR(t,e){const r=ae.useRef(e);ae.useEffect(function(){e!==r.current&&t.attributionControl!=null&&(r.current!=null&&t.attributionControl.removeAttribution(r.current),e!=null&&t.attributionControl.addAttribution(e)),r.current=e},[t,e])}const pH=1;function mH(t){return Object.freeze({__version:pH,map:t})}function OR(t,e){return Object.freeze({...t,...e})}const DR=ae.createContext(null),IR=DR.Provider;function E_(){const t=ae.useContext(DR);if(t==null)throw new Error("No context provided: useLeafletContext() can only be used in a descendant of <MapContainer>");return t}function gH(t){function e(r,n){const{instance:i,context:a}=t(r).current;return ae.useImperativeHandle(n,()=>i),r.children==null?null:nr.createElement(IR,{value:a},r.children)}return ae.forwardRef(e)}function vH(t){function e(r,n){const[i,a]=ae.useState(!1),{instance:s}=t(r,a).current;ae.useImperativeHandle(n,()=>s),ae.useEffect(function(){i&&s.update()},[s,i,r.children]);const o=s._contentNode;return o?xo.createPortal(r.children,o):null}return ae.forwardRef(e)}function jR(t,e){const r=ae.useRef();ae.useEffect(function(){return e!=null&&t.instance.on(e),r.current=e,function(){r.current!=null&&t.instance.off(r.current),r.current=null}},[t,e])}function FR(t,e){const r=t.pane??e.pane;return r?{...t,pane:r}:t}function yH(t,e){return function(n,i){const a=E_(),s=t(FR(n,a),a);return LR(a.map,n.attribution),jR(s.current,n.eventHandlers),e(s.current,a,n,i),s}}var Kg={exports:{}};var xH=Kg.exports,w4;function bH(){return w4||(w4=1,(function(t,e){(function(r,n){n(e)})(xH,(function(r){var n="1.9.4";function i(h){var k,P,V,ee;for(P=1,V=arguments.length;P<V;P++){ee=arguments[P];for(k in ee)h[k]=ee[k]}return h}var a=Object.create||(function(){function h(){}return function(k){return h.prototype=k,new h}})();function s(h,k){var P=Array.prototype.slice;if(h.bind)return h.bind.apply(h,P.call(arguments,1));var V=P.call(arguments,2);return function(){return h.apply(k,V.length?V.concat(P.call(arguments)):arguments)}}var o=0;function l(h){return"_leaflet_id"in h||(h._leaflet_id=++o),h._leaflet_id}function u(h,k,P){var V,ee,ue,we;return we=function(){V=!1,ee&&(ue.apply(P,ee),ee=!1)},ue=function(){V?ee=arguments:(h.apply(P,arguments),setTimeout(we,k),V=!0)},ue}function c(h,k,P){var V=k[1],ee=k[0],ue=V-ee;return h===V&&P?h:((h-ee)%ue+ue)%ue+ee}function f(){return!1}function p(h,k){if(k===!1)return h;var P=Math.pow(10,k===void 0?6:k);return Math.round(h*P)/P}function v(h){return h.trim?h.trim():h.replace(/^\s+|\s+$/g,"")}function y(h){return v(h).split(/\s+/)}function S(h,k){Object.prototype.hasOwnProperty.call(h,"options")||(h.options=h.options?a(h.options):{});for(var P in k)h.options[P]=k[P];return h.options}function w(h,k,P){var V=[];for(var ee in h)V.push(encodeURIComponent(P?ee.toUpperCase():ee)+"="+encodeURIComponent(h[ee]));return(!k||k.indexOf("?")===-1?"?":"&")+V.join("&")}var E=/\{ *([\w_ -]+) *\}/g;function _(h,k){return h.replace(E,function(P,V){var ee=k[V];if(ee===void 0)throw new Error("No value provided for variable "+P);return typeof ee=="function"&&(ee=ee(k)),ee})}var T=Array.isArray||function(h){return Object.prototype.toString.call(h)==="[object Array]"};function N(h,k){for(var P=0;P<h.length;P++)if(h[P]===k)return P;return-1}var R="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function I(h){return window["webkit"+h]||window["moz"+h]||window["ms"+h]}var F=0;function D(h){var k=+new Date,P=Math.max(0,16-(k-F));return F=k+P,window.setTimeout(h,P)}var j=window.requestAnimationFrame||I("RequestAnimationFrame")||D,B=window.cancelAnimationFrame||I("CancelAnimationFrame")||I("CancelRequestAnimationFrame")||function(h){window.clearTimeout(h)};function G(h,k,P){if(P&&j===D)h.call(k);else return j.call(window,s(h,k))}function K(h){h&&B.call(window,h)}var O={__proto__:null,extend:i,create:a,bind:s,get lastId(){return o},stamp:l,throttle:u,wrapNum:c,falseFn:f,formatNum:p,trim:v,splitWords:y,setOptions:S,getParamString:w,template:_,isArray:T,indexOf:N,emptyImageUrl:R,requestFn:j,cancelFn:B,requestAnimFrame:G,cancelAnimFrame:K};function W(){}W.extend=function(h){var k=function(){S(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},P=k.__super__=this.prototype,V=a(P);V.constructor=k,k.prototype=V;for(var ee in this)Object.prototype.hasOwnProperty.call(this,ee)&&ee!=="prototype"&&ee!=="__super__"&&(k[ee]=this[ee]);return h.statics&&i(k,h.statics),h.includes&&(U(h.includes),i.apply(null,[V].concat(h.includes))),i(V,h),delete V.statics,delete V.includes,V.options&&(V.options=P.options?a(P.options):{},i(V.options,h.options)),V._initHooks=[],V.callInitHooks=function(){if(!this._initHooksCalled){P.callInitHooks&&P.callInitHooks.call(this),this._initHooksCalled=!0;for(var ue=0,we=V._initHooks.length;ue<we;ue++)V._initHooks[ue].call(this)}},k},W.include=function(h){var k=this.prototype.options;return i(this.prototype,h),h.options&&(this.prototype.options=k,this.mergeOptions(h.options)),this},W.mergeOptions=function(h){return i(this.prototype.options,h),this},W.addInitHook=function(h){var k=Array.prototype.slice.call(arguments,1),P=typeof h=="function"?h:function(){this[h].apply(this,k)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(P),this};function U(h){if(!(typeof L>"u"||!L||!L.Mixin)){h=T(h)?h:[h];for(var k=0;k<h.length;k++)h[k]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",new Error().stack)}}var q={on:function(h,k,P){if(typeof h=="object")for(var V in h)this._on(V,h[V],k);else{h=y(h);for(var ee=0,ue=h.length;ee<ue;ee++)this._on(h[ee],k,P)}return this},off:function(h,k,P){if(!arguments.length)delete this._events;else if(typeof h=="object")for(var V in h)this._off(V,h[V],k);else{h=y(h);for(var ee=arguments.length===1,ue=0,we=h.length;ue<we;ue++)ee?this._off(h[ue]):this._off(h[ue],k,P)}return this},_on:function(h,k,P,V){if(typeof k!="function"){console.warn("wrong listener type: "+typeof k);return}if(this._listens(h,k,P)===!1){P===this&&(P=void 0);var ee={fn:k,ctx:P};V&&(ee.once=!0),this._events=this._events||{},this._events[h]=this._events[h]||[],this._events[h].push(ee)}},_off:function(h,k,P){var V,ee,ue;if(this._events&&(V=this._events[h],!!V)){if(arguments.length===1){if(this._firingCount)for(ee=0,ue=V.length;ee<ue;ee++)V[ee].fn=f;delete this._events[h];return}if(typeof k!="function"){console.warn("wrong listener type: "+typeof k);return}var we=this._listens(h,k,P);if(we!==!1){var Me=V[we];this._firingCount&&(Me.fn=f,this._events[h]=V=V.slice()),V.splice(we,1)}}},fire:function(h,k,P){if(!this.listens(h,P))return this;var V=i({},k,{type:h,target:this,sourceTarget:k&&k.sourceTarget||this});if(this._events){var ee=this._events[h];if(ee){this._firingCount=this._firingCount+1||1;for(var ue=0,we=ee.length;ue<we;ue++){var Me=ee[ue],De=Me.fn;Me.once&&this.off(h,De,Me.ctx),De.call(Me.ctx||this,V)}this._firingCount--}}return P&&this._propagateEvent(V),this},listens:function(h,k,P,V){typeof h!="string"&&console.warn('"string" type argument expected');var ee=k;typeof k!="function"&&(V=!!k,ee=void 0,P=void 0);var ue=this._events&&this._events[h];if(ue&&ue.length&&this._listens(h,ee,P)!==!1)return!0;if(V){for(var we in this._eventParents)if(this._eventParents[we].listens(h,k,P,V))return!0}return!1},_listens:function(h,k,P){if(!this._events)return!1;var V=this._events[h]||[];if(!k)return!!V.length;P===this&&(P=void 0);for(var ee=0,ue=V.length;ee<ue;ee++)if(V[ee].fn===k&&V[ee].ctx===P)return ee;return!1},once:function(h,k,P){if(typeof h=="object")for(var V in h)this._on(V,h[V],k,!0);else{h=y(h);for(var ee=0,ue=h.length;ee<ue;ee++)this._on(h[ee],k,P,!0)}return this},addEventParent:function(h){return this._eventParents=this._eventParents||{},this._eventParents[l(h)]=h,this},removeEventParent:function(h){return this._eventParents&&delete this._eventParents[l(h)],this},_propagateEvent:function(h){for(var k in this._eventParents)this._eventParents[k].fire(h.type,i({layer:h.target,propagatedFrom:h.target},h),!0)}};q.addEventListener=q.on,q.removeEventListener=q.clearAllEventListeners=q.off,q.addOneTimeEventListener=q.once,q.fireEvent=q.fire,q.hasEventListeners=q.listens;var Z=W.extend(q);function Q(h,k,P){this.x=P?Math.round(h):h,this.y=P?Math.round(k):k}var ne=Math.trunc||function(h){return h>0?Math.floor(h):Math.ceil(h)};Q.prototype={clone:function(){return new Q(this.x,this.y)},add:function(h){return this.clone()._add(re(h))},_add:function(h){return this.x+=h.x,this.y+=h.y,this},subtract:function(h){return this.clone()._subtract(re(h))},_subtract:function(h){return this.x-=h.x,this.y-=h.y,this},divideBy:function(h){return this.clone()._divideBy(h)},_divideBy:function(h){return this.x/=h,this.y/=h,this},multiplyBy:function(h){return this.clone()._multiplyBy(h)},_multiplyBy:function(h){return this.x*=h,this.y*=h,this},scaleBy:function(h){return new Q(this.x*h.x,this.y*h.y)},unscaleBy:function(h){return new Q(this.x/h.x,this.y/h.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=ne(this.x),this.y=ne(this.y),this},distanceTo:function(h){h=re(h);var k=h.x-this.x,P=h.y-this.y;return Math.sqrt(k*k+P*P)},equals:function(h){return h=re(h),h.x===this.x&&h.y===this.y},contains:function(h){return h=re(h),Math.abs(h.x)<=Math.abs(this.x)&&Math.abs(h.y)<=Math.abs(this.y)},toString:function(){return"Point("+p(this.x)+", "+p(this.y)+")"}};function re(h,k,P){return h instanceof Q?h:T(h)?new Q(h[0],h[1]):h==null?h:typeof h=="object"&&"x"in h&&"y"in h?new Q(h.x,h.y):new Q(h,k,P)}function Y(h,k){if(h)for(var P=k?[h,k]:h,V=0,ee=P.length;V<ee;V++)this.extend(P[V])}Y.prototype={extend:function(h){var k,P;if(!h)return this;if(h instanceof Q||typeof h[0]=="number"||"x"in h)k=P=re(h);else if(h=J(h),k=h.min,P=h.max,!k||!P)return this;return!this.min&&!this.max?(this.min=k.clone(),this.max=P.clone()):(this.min.x=Math.min(k.x,this.min.x),this.max.x=Math.max(P.x,this.max.x),this.min.y=Math.min(k.y,this.min.y),this.max.y=Math.max(P.y,this.max.y)),this},getCenter:function(h){return re((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,h)},getBottomLeft:function(){return re(this.min.x,this.max.y)},getTopRight:function(){return re(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(h){var k,P;return typeof h[0]=="number"||h instanceof Q?h=re(h):h=J(h),h instanceof Y?(k=h.min,P=h.max):k=P=h,k.x>=this.min.x&&P.x<=this.max.x&&k.y>=this.min.y&&P.y<=this.max.y},intersects:function(h){h=J(h);var k=this.min,P=this.max,V=h.min,ee=h.max,ue=ee.x>=k.x&&V.x<=P.x,we=ee.y>=k.y&&V.y<=P.y;return ue&&we},overlaps:function(h){h=J(h);var k=this.min,P=this.max,V=h.min,ee=h.max,ue=ee.x>k.x&&V.x<P.x,we=ee.y>k.y&&V.y<P.y;return ue&&we},isValid:function(){return!!(this.min&&this.max)},pad:function(h){var k=this.min,P=this.max,V=Math.abs(k.x-P.x)*h,ee=Math.abs(k.y-P.y)*h;return J(re(k.x-V,k.y-ee),re(P.x+V,P.y+ee))},equals:function(h){return h?(h=J(h),this.min.equals(h.getTopLeft())&&this.max.equals(h.getBottomRight())):!1}};function J(h,k){return!h||h instanceof Y?h:new Y(h,k)}function ie(h,k){if(h)for(var P=k?[h,k]:h,V=0,ee=P.length;V<ee;V++)this.extend(P[V])}ie.prototype={extend:function(h){var k=this._southWest,P=this._northEast,V,ee;if(h instanceof he)V=h,ee=h;else if(h instanceof ie){if(V=h._southWest,ee=h._northEast,!V||!ee)return this}else return h?this.extend(xe(h)||de(h)):this;return!k&&!P?(this._southWest=new he(V.lat,V.lng),this._northEast=new he(ee.lat,ee.lng)):(k.lat=Math.min(V.lat,k.lat),k.lng=Math.min(V.lng,k.lng),P.lat=Math.max(ee.lat,P.lat),P.lng=Math.max(ee.lng,P.lng)),this},pad:function(h){var k=this._southWest,P=this._northEast,V=Math.abs(k.lat-P.lat)*h,ee=Math.abs(k.lng-P.lng)*h;return new ie(new he(k.lat-V,k.lng-ee),new he(P.lat+V,P.lng+ee))},getCenter:function(){return new he((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new he(this.getNorth(),this.getWest())},getSouthEast:function(){return new he(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(h){typeof h[0]=="number"||h instanceof he||"lat"in h?h=xe(h):h=de(h);var k=this._southWest,P=this._northEast,V,ee;return h instanceof ie?(V=h.getSouthWest(),ee=h.getNorthEast()):V=ee=h,V.lat>=k.lat&&ee.lat<=P.lat&&V.lng>=k.lng&&ee.lng<=P.lng},intersects:function(h){h=de(h);var k=this._southWest,P=this._northEast,V=h.getSouthWest(),ee=h.getNorthEast(),ue=ee.lat>=k.lat&&V.lat<=P.lat,we=ee.lng>=k.lng&&V.lng<=P.lng;return ue&&we},overlaps:function(h){h=de(h);var k=this._southWest,P=this._northEast,V=h.getSouthWest(),ee=h.getNorthEast(),ue=ee.lat>k.lat&&V.lat<P.lat,we=ee.lng>k.lng&&V.lng<P.lng;return ue&&we},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(h,k){return h?(h=de(h),this._southWest.equals(h.getSouthWest(),k)&&this._northEast.equals(h.getNorthEast(),k)):!1},isValid:function(){return!!(this._southWest&&this._northEast)}};function de(h,k){return h instanceof ie?h:new ie(h,k)}function he(h,k,P){if(isNaN(h)||isNaN(k))throw new Error("Invalid LatLng object: ("+h+", "+k+")");this.lat=+h,this.lng=+k,P!==void 0&&(this.alt=+P)}he.prototype={equals:function(h,k){if(!h)return!1;h=xe(h);var P=Math.max(Math.abs(this.lat-h.lat),Math.abs(this.lng-h.lng));return P<=(k===void 0?1e-9:k)},toString:function(h){return"LatLng("+p(this.lat,h)+", "+p(this.lng,h)+")"},distanceTo:function(h){return fe.distance(this,xe(h))},wrap:function(){return fe.wrapLatLng(this)},toBounds:function(h){var k=180*h/40075017,P=k/Math.cos(Math.PI/180*this.lat);return de([this.lat-k,this.lng-P],[this.lat+k,this.lng+P])},clone:function(){return new he(this.lat,this.lng,this.alt)}};function xe(h,k,P){return h instanceof he?h:T(h)&&typeof h[0]!="object"?h.length===3?new he(h[0],h[1],h[2]):h.length===2?new he(h[0],h[1]):null:h==null?h:typeof h=="object"&&"lat"in h?new he(h.lat,"lng"in h?h.lng:h.lon,h.alt):k===void 0?null:new he(h,k,P)}var le={latLngToPoint:function(h,k){var P=this.projection.project(h),V=this.scale(k);return this.transformation._transform(P,V)},pointToLatLng:function(h,k){var P=this.scale(k),V=this.transformation.untransform(h,P);return this.projection.unproject(V)},project:function(h){return this.projection.project(h)},unproject:function(h){return this.projection.unproject(h)},scale:function(h){return 256*Math.pow(2,h)},zoom:function(h){return Math.log(h/256)/Math.LN2},getProjectedBounds:function(h){if(this.infinite)return null;var k=this.projection.bounds,P=this.scale(h),V=this.transformation.transform(k.min,P),ee=this.transformation.transform(k.max,P);return new Y(V,ee)},infinite:!1,wrapLatLng:function(h){var k=this.wrapLng?c(h.lng,this.wrapLng,!0):h.lng,P=this.wrapLat?c(h.lat,this.wrapLat,!0):h.lat,V=h.alt;return new he(P,k,V)},wrapLatLngBounds:function(h){var k=h.getCenter(),P=this.wrapLatLng(k),V=k.lat-P.lat,ee=k.lng-P.lng;if(V===0&&ee===0)return h;var ue=h.getSouthWest(),we=h.getNorthEast(),Me=new he(ue.lat-V,ue.lng-ee),De=new he(we.lat-V,we.lng-ee);return new ie(Me,De)}},fe=i({},le,{wrapLng:[-180,180],R:6371e3,distance:function(h,k){var P=Math.PI/180,V=h.lat*P,ee=k.lat*P,ue=Math.sin((k.lat-h.lat)*P/2),we=Math.sin((k.lng-h.lng)*P/2),Me=ue*ue+Math.cos(V)*Math.cos(ee)*we*we,De=2*Math.atan2(Math.sqrt(Me),Math.sqrt(1-Me));return this.R*De}}),ve=6378137,ge={R:ve,MAX_LATITUDE:85.0511287798,project:function(h){var k=Math.PI/180,P=this.MAX_LATITUDE,V=Math.max(Math.min(P,h.lat),-P),ee=Math.sin(V*k);return new Q(this.R*h.lng*k,this.R*Math.log((1+ee)/(1-ee))/2)},unproject:function(h){var k=180/Math.PI;return new he((2*Math.atan(Math.exp(h.y/this.R))-Math.PI/2)*k,h.x*k/this.R)},bounds:(function(){var h=ve*Math.PI;return new Y([-h,-h],[h,h])})()};function se(h,k,P,V){if(T(h)){this._a=h[0],this._b=h[1],this._c=h[2],this._d=h[3];return}this._a=h,this._b=k,this._c=P,this._d=V}se.prototype={transform:function(h,k){return this._transform(h.clone(),k)},_transform:function(h,k){return k=k||1,h.x=k*(this._a*h.x+this._b),h.y=k*(this._c*h.y+this._d),h},untransform:function(h,k){return k=k||1,new Q((h.x/k-this._b)/this._a,(h.y/k-this._d)/this._c)}};function ye(h,k,P,V){return new se(h,k,P,V)}var Se=i({},fe,{code:"EPSG:3857",projection:ge,transformation:(function(){var h=.5/(Math.PI*ge.R);return ye(h,.5,-h,.5)})()}),Ue=i({},Se,{code:"EPSG:900913"});function Oe(h){return document.createElementNS("http://www.w3.org/2000/svg",h)}function mt(h,k){var P="",V,ee,ue,we,Me,De;for(V=0,ue=h.length;V<ue;V++){for(Me=h[V],ee=0,we=Me.length;ee<we;ee++)De=Me[ee],P+=(ee?"L":"M")+De.x+" "+De.y;P+=k?St.svg?"z":"x":""}return P||"M0 0"}var lt=document.documentElement.style,at="ActiveXObject"in window,wt=at&&!document.addEventListener,$e="msLaunchUri"in navigator&&!("documentMode"in document),Ce=vr("webkit"),Ie=vr("android"),Je=vr("android 2")||vr("android 3"),Qe=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),gt=Ie&&vr("Google")&&Qe<537&&!("AudioNode"in window),At=!!window.opera,Rt=!$e&&vr("chrome"),Ut=vr("gecko")&&!Ce&&!At&&!at,Vt=!Rt&&vr("safari"),pt=vr("phantom"),dt="OTransition"in lt,Ge=navigator.platform.indexOf("Win")===0,ce=at&&"transition"in lt,me="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!Je,ke="MozPerspective"in lt,Te=!window.L_DISABLE_3D&&(ce||me||ke)&&!dt&&!pt,Ae=typeof orientation<"u"||vr("mobile"),Xe=Ae&&Ce,Ve=Ae&&me,yt=!window.PointerEvent&&window.MSPointerEvent,vt=!!(window.PointerEvent||yt),ft="ontouchstart"in window||!!window.TouchEvent,Zt=!window.L_NO_TOUCH&&(ft||vt),Ht=Ae&&At,Et=Ae&&Ut,Wt=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,ar=(function(){var h=!1;try{var k=Object.defineProperty({},"passive",{get:function(){h=!0}});window.addEventListener("testPassiveEventSupport",f,k),window.removeEventListener("testPassiveEventSupport",f,k)}catch{}return h})(),Rr=(function(){return!!document.createElement("canvas").getContext})(),kr=!!(document.createElementNS&&Oe("svg").createSVGRect),Qr=!!kr&&(function(){var h=document.createElement("div");return h.innerHTML="<svg/>",(h.firstChild&&h.firstChild.namespaceURI)==="http://www.w3.org/2000/svg"})(),Jr=!kr&&(function(){try{var h=document.createElement("div");h.innerHTML='<v:shape adj="1"/>';var k=h.firstChild;return k.style.behavior="url(#default#VML)",k&&typeof k.adj=="object"}catch{return!1}})(),_r=navigator.platform.indexOf("Mac")===0,fn=navigator.platform.indexOf("Linux")===0;function vr(h){return navigator.userAgent.toLowerCase().indexOf(h)>=0}var St={ie:at,ielt9:wt,edge:$e,webkit:Ce,android:Ie,android23:Je,androidStock:gt,opera:At,chrome:Rt,gecko:Ut,safari:Vt,phantom:pt,opera12:dt,win:Ge,ie3d:ce,webkit3d:me,gecko3d:ke,any3d:Te,mobile:Ae,mobileWebkit:Xe,mobileWebkit3d:Ve,msPointer:yt,pointer:vt,touch:Zt,touchNative:ft,mobileOpera:Ht,mobileGecko:Et,retina:Wt,passiveEvents:ar,canvas:Rr,svg:kr,vml:Jr,inlineSvg:Qr,mac:_r,linux:fn},Br=St.msPointer?"MSPointerDown":"pointerdown",Xn=St.msPointer?"MSPointerMove":"pointermove",Yi=St.msPointer?"MSPointerUp":"pointerup",ds=St.msPointer?"MSPointerCancel":"pointercancel",As={touchstart:Br,touchmove:Xn,touchend:Yi,touchcancel:ds},ni={touchstart:on,touchmove:ko,touchend:ko,touchcancel:ko},sn={},kn=!1;function In(h,k,P){return k==="touchstart"&&Lu(),ni[k]?(P=ni[k].bind(this,P),h.addEventListener(As[k],P,!1),P):(console.warn("wrong event specified:",k),f)}function Rs(h,k,P){if(!As[k]){console.warn("wrong event specified:",k);return}h.removeEventListener(As[k],P,!1)}function gi(h){sn[h.pointerId]=h}function So(h){sn[h.pointerId]&&(sn[h.pointerId]=h)}function qa(h){delete sn[h.pointerId]}function Lu(){kn||(document.addEventListener(Br,gi,!0),document.addEventListener(Xn,So,!0),document.addEventListener(Yi,qa,!0),document.addEventListener(ds,qa,!0),kn=!0)}function ko(h,k){if(k.pointerType!==(k.MSPOINTER_TYPE_MOUSE||"mouse")){k.touches=[];for(var P in sn)k.touches.push(sn[P]);k.changedTouches=[k],h(k)}}function on(h,k){k.MSPOINTER_TYPE_TOUCH&&k.pointerType===k.MSPOINTER_TYPE_TOUCH&&hn(k),ko(h,k)}function _o(h){var k={},P,V;for(V in h)P=h[V],k[V]=P&&P.bind?P.bind(h):P;return h=k,k.type="dblclick",k.detail=2,k.isTrusted=!1,k._simulated=!0,k}var fs=200;function to(h,k){h.addEventListener("dblclick",k);var P=0,V;function ee(ue){if(ue.detail!==1){V=ue.detail;return}if(!(ue.pointerType==="mouse"||ue.sourceCapabilities&&!ue.sourceCapabilities.firesTouchEvents)){var we=ll(ue);if(!(we.some(function(De){return De instanceof HTMLLabelElement&&De.attributes.for})&&!we.some(function(De){return De instanceof HTMLInputElement||De instanceof HTMLSelectElement}))){var Me=Date.now();Me-P<=fs?(V++,V===2&&k(_o(ue))):V=1,P=Me}}}return h.addEventListener("click",ee),{dblclick:k,simDblclick:ee}}function Xi(h,k){h.removeEventListener("dblclick",k.dblclick),h.removeEventListener("click",k.simDblclick)}var ro=Jt(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),ze=Jt(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),Ke=ze==="webkitTransition"||ze==="OTransition"?ze+"End":"transitionend";function tt(h){return typeof h=="string"?document.getElementById(h):h}function ot(h,k){var P=h.style[k]||h.currentStyle&&h.currentStyle[k];if((!P||P==="auto")&&document.defaultView){var V=document.defaultView.getComputedStyle(h,null);P=V?V[k]:null}return P==="auto"?null:P}function qe(h,k,P){var V=document.createElement(h);return V.className=k||"",P&&P.appendChild(V),V}function Mt(h){var k=h.parentNode;k&&k.removeChild(h)}function Nr(h){for(;h.firstChild;)h.removeChild(h.firstChild)}function Pr(h){var k=h.parentNode;k&&k.lastChild!==h&&k.appendChild(h)}function Fr(h){var k=h.parentNode;k&&k.firstChild!==h&&k.insertBefore(h,k.firstChild)}function vi(h,k){if(h.classList!==void 0)return h.classList.contains(k);var P=Qt(h);return P.length>0&&new RegExp("(^|\\s)"+k+"(\\s|$)").test(P)}function It(h,k){if(h.classList!==void 0)for(var P=y(k),V=0,ee=P.length;V<ee;V++)h.classList.add(P[V]);else if(!vi(h,k)){var ue=Qt(h);al(h,(ue?ue+" ":"")+k)}}function Ir(h,k){h.classList!==void 0?h.classList.remove(k):al(h,v((" "+Qt(h)+" ").replace(" "+k+" "," ")))}function al(h,k){h.className.baseVal===void 0?h.className=k:h.className.baseVal=k}function Qt(h){return h.correspondingElement&&(h=h.correspondingElement),h.className.baseVal===void 0?h.className:h.className.baseVal}function er(h,k){"opacity"in h.style?h.style.opacity=k:"filter"in h.style&&Lr(h,k)}function Lr(h,k){var P=!1,V="DXImageTransform.Microsoft.Alpha";try{P=h.filters.item(V)}catch{if(k===1)return}k=Math.round(k*100),P?(P.Enabled=k!==100,P.Opacity=k):h.style.filter+=" progid:"+V+"(opacity="+k+")"}function Jt(h){for(var k=document.documentElement.style,P=0;P<h.length;P++)if(h[P]in k)return h[P];return!1}function en(h,k,P){var V=k||new Q(0,0);h.style[ro]=(St.ie3d?"translate("+V.x+"px,"+V.y+"px)":"translate3d("+V.x+"px,"+V.y+"px,0)")+(P?" scale("+P+")":"")}function yn(h,k){h._leaflet_pos=k,St.any3d?en(h,k):(h.style.left=k.x+"px",h.style.top=k.y+"px")}function no(h){return h._leaflet_pos||new Q(0,0)}var xr,io,Co;if("onselectstart"in document)xr=function(){sr(window,"selectstart",hn)},io=function(){$r(window,"selectstart",hn)};else{var Ls=Jt(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);xr=function(){if(Ls){var h=document.documentElement.style;Co=h[Ls],h[Ls]="none"}},io=function(){Ls&&(document.documentElement.style[Ls]=Co,Co=void 0)}}function Cc(){sr(window,"dragstart",hn)}function Ec(){$r(window,"dragstart",hn)}var sl,Gl;function Eo(h){for(;h.tabIndex===-1;)h=h.parentNode;h.style&&(Fi(),sl=h,Gl=h.style.outlineStyle,h.style.outlineStyle="none",sr(window,"keydown",Fi))}function Fi(){sl&&(sl.style.outlineStyle=Gl,sl=void 0,Gl=void 0,$r(window,"keydown",Fi))}function ao(h){do h=h.parentNode;while((!h.offsetWidth||!h.offsetHeight)&&h!==document.body);return h}function $a(h){var k=h.getBoundingClientRect();return{x:k.width/h.offsetWidth||1,y:k.height/h.offsetHeight||1,boundingClientRect:k}}var br={__proto__:null,TRANSFORM:ro,TRANSITION:ze,TRANSITION_END:Ke,get:tt,getStyle:ot,create:qe,remove:Mt,empty:Nr,toFront:Pr,toBack:Fr,hasClass:vi,addClass:It,removeClass:Ir,setClass:al,getClass:Qt,setOpacity:er,testProp:Jt,setTransform:en,setPosition:yn,getPosition:no,get disableTextSelection(){return xr},get enableTextSelection(){return io},disableImageDrag:Cc,enableImageDrag:Ec,preventOutline:Eo,restoreOutline:Fi,getSizedParentNode:ao,getScale:$a};function sr(h,k,P,V){if(k&&typeof k=="object")for(var ee in k)jn(h,ee,k[ee],P);else{k=y(k);for(var ue=0,we=k.length;ue<we;ue++)jn(h,k[ue],P,V)}return this}var Qn="_leaflet_events";function $r(h,k,P,V){if(arguments.length===1)vf(h),delete h[Qn];else if(k&&typeof k=="object")for(var ee in k)Vl(h,ee,k[ee],P);else if(k=y(k),arguments.length===2)vf(h,function(Me){return N(k,Me)!==-1});else for(var ue=0,we=k.length;ue<we;ue++)Vl(h,k[ue],P,V);return this}function vf(h,k){for(var P in h[Qn]){var V=P.split(/\d/)[0];(!k||k(V))&&Vl(h,V,null,null,P)}}var ol={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function jn(h,k,P,V){var ee=k+l(P)+(V?"_"+l(V):"");if(h[Qn]&&h[Qn][ee])return this;var ue=function(Me){return P.call(V||h,Me||window.event)},we=ue;!St.touchNative&&St.pointer&&k.indexOf("touch")===0?ue=In(h,k,ue):St.touch&&k==="dblclick"?ue=to(h,ue):"addEventListener"in h?k==="touchstart"||k==="touchmove"||k==="wheel"||k==="mousewheel"?h.addEventListener(ol[k]||k,ue,St.passiveEvents?{passive:!1}:!1):k==="mouseenter"||k==="mouseleave"?(ue=function(Me){Me=Me||window.event,To(h,Me)&&we(Me)},h.addEventListener(ol[k],ue,!1)):h.addEventListener(k,we,!1):h.attachEvent("on"+k,ue),h[Qn]=h[Qn]||{},h[Qn][ee]=ue}function Vl(h,k,P,V,ee){ee=ee||k+l(P)+(V?"_"+l(V):"");var ue=h[Qn]&&h[Qn][ee];if(!ue)return this;!St.touchNative&&St.pointer&&k.indexOf("touch")===0?Rs(h,k,ue):St.touch&&k==="dblclick"?Xi(h,ue):"removeEventListener"in h?h.removeEventListener(ol[k]||k,ue,!1):h.detachEvent("on"+k,ue),h[Qn][ee]=null}function Os(h){return h.stopPropagation?h.stopPropagation():h.originalEvent?h.originalEvent._stopped=!0:h.cancelBubble=!0,this}function Hl(h){return jn(h,"wheel",Os),this}function Ou(h){return sr(h,"mousedown touchstart dblclick contextmenu",Os),h._leaflet_disable_click=!0,this}function hn(h){return h.preventDefault?h.preventDefault():h.returnValue=!1,this}function Fn(h){return hn(h),Os(h),this}function ll(h){if(h.composedPath)return h.composedPath();for(var k=[],P=h.target;P;)k.push(P),P=P.parentNode;return k}function Du(h,k){if(!k)return new Q(h.clientX,h.clientY);var P=$a(k),V=P.boundingClientRect;return new Q((h.clientX-V.left)/P.x-k.clientLeft,(h.clientY-V.top)/P.y-k.clientTop)}var hs=St.linux&&St.chrome?window.devicePixelRatio:St.mac?window.devicePixelRatio*3:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function Ds(h){return St.edge?h.wheelDeltaY/2:h.deltaY&&h.deltaMode===0?-h.deltaY/hs:h.deltaY&&h.deltaMode===1?-h.deltaY*20:h.deltaY&&h.deltaMode===2?-h.deltaY*60:h.deltaX||h.deltaZ?0:h.wheelDelta?(h.wheelDeltaY||h.wheelDelta)/2:h.detail&&Math.abs(h.detail)<32765?-h.detail*20:h.detail?h.detail/-32765*60:0}function To(h,k){var P=k.relatedTarget;if(!P)return!0;try{for(;P&&P!==h;)P=P.parentNode}catch{return!1}return P!==h}var Wl={__proto__:null,on:sr,off:$r,stopPropagation:Os,disableScrollPropagation:Hl,disableClickPropagation:Ou,preventDefault:hn,stop:Fn,getPropagationPath:ll,getMousePosition:Du,getWheelDelta:Ds,isExternalTarget:To,addListener:sr,removeListener:$r},Iu=Z.extend({run:function(h,k,P,V){this.stop(),this._el=h,this._inProgress=!0,this._duration=P||.25,this._easeOutPower=1/Math.max(V||.5,.2),this._startPos=no(h),this._offset=k.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=G(this._animate,this),this._step()},_step:function(h){var k=+new Date-this._startTime,P=this._duration*1e3;k<P?this._runFrame(this._easeOut(k/P),h):(this._runFrame(1),this._complete())},_runFrame:function(h,k){var P=this._startPos.add(this._offset.multiplyBy(h));k&&P._round(),yn(this._el,P),this.fire("step")},_complete:function(){K(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(h){return 1-Math.pow(1-h,this._easeOutPower)}}),Cr=Z.extend({options:{crs:Se,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(h,k){k=S(this,k),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(h),this._initLayout(),this._onResize=s(this._onResize,this),this._initEvents(),k.maxBounds&&this.setMaxBounds(k.maxBounds),k.zoom!==void 0&&(this._zoom=this._limitZoom(k.zoom)),k.center&&k.zoom!==void 0&&this.setView(xe(k.center),k.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=ze&&St.any3d&&!St.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),sr(this._proxy,Ke,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(h,k,P){if(k=k===void 0?this._zoom:this._limitZoom(k),h=this._limitCenter(xe(h),k,this.options.maxBounds),P=P||{},this._stop(),this._loaded&&!P.reset&&P!==!0){P.animate!==void 0&&(P.zoom=i({animate:P.animate},P.zoom),P.pan=i({animate:P.animate,duration:P.duration},P.pan));var V=this._zoom!==k?this._tryAnimatedZoom&&this._tryAnimatedZoom(h,k,P.zoom):this._tryAnimatedPan(h,P.pan);if(V)return clearTimeout(this._sizeTimer),this}return this._resetView(h,k,P.pan&&P.pan.noMoveStart),this},setZoom:function(h,k){return this._loaded?this.setView(this.getCenter(),h,{zoom:k}):(this._zoom=h,this)},zoomIn:function(h,k){return h=h||(St.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+h,k)},zoomOut:function(h,k){return h=h||(St.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-h,k)},setZoomAround:function(h,k,P){var V=this.getZoomScale(k),ee=this.getSize().divideBy(2),ue=h instanceof Q?h:this.latLngToContainerPoint(h),we=ue.subtract(ee).multiplyBy(1-1/V),Me=this.containerPointToLatLng(ee.add(we));return this.setView(Me,k,{zoom:P})},_getBoundsCenterZoom:function(h,k){k=k||{},h=h.getBounds?h.getBounds():de(h);var P=re(k.paddingTopLeft||k.padding||[0,0]),V=re(k.paddingBottomRight||k.padding||[0,0]),ee=this.getBoundsZoom(h,!1,P.add(V));if(ee=typeof k.maxZoom=="number"?Math.min(k.maxZoom,ee):ee,ee===1/0)return{center:h.getCenter(),zoom:ee};var ue=V.subtract(P).divideBy(2),we=this.project(h.getSouthWest(),ee),Me=this.project(h.getNorthEast(),ee),De=this.unproject(we.add(Me).divideBy(2).add(ue),ee);return{center:De,zoom:ee}},fitBounds:function(h,k){if(h=de(h),!h.isValid())throw new Error("Bounds are not valid.");var P=this._getBoundsCenterZoom(h,k);return this.setView(P.center,P.zoom,k)},fitWorld:function(h){return this.fitBounds([[-90,-180],[90,180]],h)},panTo:function(h,k){return this.setView(h,this._zoom,{pan:k})},panBy:function(h,k){if(h=re(h).round(),k=k||{},!h.x&&!h.y)return this.fire("moveend");if(k.animate!==!0&&!this.getSize().contains(h))return this._resetView(this.unproject(this.project(this.getCenter()).add(h)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new Iu,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),k.noMoveStart||this.fire("movestart"),k.animate!==!1){It(this._mapPane,"leaflet-pan-anim");var P=this._getMapPanePos().subtract(h).round();this._panAnim.run(this._mapPane,P,k.duration||.25,k.easeLinearity)}else this._rawPanBy(h),this.fire("move").fire("moveend");return this},flyTo:function(h,k,P){if(P=P||{},P.animate===!1||!St.any3d)return this.setView(h,k,P);this._stop();var V=this.project(this.getCenter()),ee=this.project(h),ue=this.getSize(),we=this._zoom;h=xe(h),k=k===void 0?we:k;var Me=Math.max(ue.x,ue.y),De=Me*this.getZoomScale(we,k),Ze=ee.distanceTo(V)||1,kt=1.42,Yt=kt*kt;function fr(zr){var bl=zr?-1:1,Bh=zr?De:Me,zh=De*De-Me*Me+bl*Yt*Yt*Ze*Ze,Oo=2*Bh*Yt*Ze,wl=zh/Oo,Vn=Math.sqrt(wl*wl+1)-wl,si=Vn<1e-9?-18:Math.log(Vn);return si}function Zr(zr){return(Math.exp(zr)-Math.exp(-zr))/2}function Gn(zr){return(Math.exp(zr)+Math.exp(-zr))/2}function Ai(zr){return Zr(zr)/Gn(zr)}var zi=fr(0);function yl(zr){return Me*(Gn(zi)/Gn(zi+kt*zr))}function Uc(zr){return Me*(Gn(zi)*Ai(zi+kt*zr)-Zr(zi))/Yt}function zs(zr){return 1-Math.pow(1-zr,1.5)}var xl=Date.now(),uo=(fr(1)-zi)/kt,es=P.duration?1e3*P.duration:1e3*uo*.8;function iu(){var zr=(Date.now()-xl)/es,bl=zs(zr)*uo;zr<=1?(this._flyToFrame=G(iu,this),this._move(this.unproject(V.add(ee.subtract(V).multiplyBy(Uc(bl)/Ze)),we),this.getScaleZoom(Me/yl(bl),we),{flyTo:!0})):this._move(h,k)._moveEnd(!0)}return this._moveStart(!0,P.noMoveStart),iu.call(this),this},flyToBounds:function(h,k){var P=this._getBoundsCenterZoom(h,k);return this.flyTo(P.center,P.zoom,k)},setMaxBounds:function(h){return h=de(h),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),h.isValid()?(this.options.maxBounds=h,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(h){var k=this.options.minZoom;return this.options.minZoom=h,this._loaded&&k!==h&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(h):this},setMaxZoom:function(h){var k=this.options.maxZoom;return this.options.maxZoom=h,this._loaded&&k!==h&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(h):this},panInsideBounds:function(h,k){this._enforcingBounds=!0;var P=this.getCenter(),V=this._limitCenter(P,this._zoom,de(h));return P.equals(V)||this.panTo(V,k),this._enforcingBounds=!1,this},panInside:function(h,k){k=k||{};var P=re(k.paddingTopLeft||k.padding||[0,0]),V=re(k.paddingBottomRight||k.padding||[0,0]),ee=this.project(this.getCenter()),ue=this.project(h),we=this.getPixelBounds(),Me=J([we.min.add(P),we.max.subtract(V)]),De=Me.getSize();if(!Me.contains(ue)){this._enforcingBounds=!0;var Ze=ue.subtract(Me.getCenter()),kt=Me.extend(ue).getSize().subtract(De);ee.x+=Ze.x<0?-kt.x:kt.x,ee.y+=Ze.y<0?-kt.y:kt.y,this.panTo(this.unproject(ee),k),this._enforcingBounds=!1}return this},invalidateSize:function(h){if(!this._loaded)return this;h=i({animate:!1,pan:!0},h===!0?{animate:!0}:h);var k=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var P=this.getSize(),V=k.divideBy(2).round(),ee=P.divideBy(2).round(),ue=V.subtract(ee);return!ue.x&&!ue.y?this:(h.animate&&h.pan?this.panBy(ue):(h.pan&&this._rawPanBy(ue),this.fire("move"),h.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(s(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:k,newSize:P}))},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(h){if(h=this._locateOptions=i({timeout:1e4,watch:!1},h),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var k=s(this._handleGeolocationResponse,this),P=s(this._handleGeolocationError,this);return h.watch?this._locationWatchId=navigator.geolocation.watchPosition(k,P,h):navigator.geolocation.getCurrentPosition(k,P,h),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(h){if(this._container._leaflet_id){var k=h.code,P=h.message||(k===1?"permission denied":k===2?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:k,message:"Geolocation error: "+P+"."})}},_handleGeolocationResponse:function(h){if(this._container._leaflet_id){var k=h.coords.latitude,P=h.coords.longitude,V=new he(k,P),ee=V.toBounds(h.coords.accuracy*2),ue=this._locateOptions;if(ue.setView){var we=this.getBoundsZoom(ee);this.setView(V,ue.maxZoom?Math.min(we,ue.maxZoom):we)}var Me={latlng:V,bounds:ee,timestamp:h.timestamp};for(var De in h.coords)typeof h.coords[De]=="number"&&(Me[De]=h.coords[De]);this.fire("locationfound",Me)}},addHandler:function(h,k){if(!k)return this;var P=this[h]=new k(this);return this._handlers.push(P),this.options[h]&&P.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch{this._container._leaflet_id=void 0,this._containerId=void 0}this._locationWatchId!==void 0&&this.stopLocate(),this._stop(),Mt(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(K(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload");var h;for(h in this._layers)this._layers[h].remove();for(h in this._panes)Mt(this._panes[h]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(h,k){var P="leaflet-pane"+(h?" leaflet-"+h.replace("Pane","")+"-pane":""),V=qe("div",P,k||this._mapPane);return h&&(this._panes[h]=V),V},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var h=this.getPixelBounds(),k=this.unproject(h.getBottomLeft()),P=this.unproject(h.getTopRight());return new ie(k,P)},getMinZoom:function(){return this.options.minZoom===void 0?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===void 0?this._layersMaxZoom===void 0?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(h,k,P){h=de(h),P=re(P||[0,0]);var V=this.getZoom()||0,ee=this.getMinZoom(),ue=this.getMaxZoom(),we=h.getNorthWest(),Me=h.getSouthEast(),De=this.getSize().subtract(P),Ze=J(this.project(Me,V),this.project(we,V)).getSize(),kt=St.any3d?this.options.zoomSnap:1,Yt=De.x/Ze.x,fr=De.y/Ze.y,Zr=k?Math.max(Yt,fr):Math.min(Yt,fr);return V=this.getScaleZoom(Zr,V),kt&&(V=Math.round(V/(kt/100))*(kt/100),V=k?Math.ceil(V/kt)*kt:Math.floor(V/kt)*kt),Math.max(ee,Math.min(ue,V))},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new Q(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(h,k){var P=this._getTopLeftPoint(h,k);return new Y(P,P.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(h){return this.options.crs.getProjectedBounds(h===void 0?this.getZoom():h)},getPane:function(h){return typeof h=="string"?this._panes[h]:h},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(h,k){var P=this.options.crs;return k=k===void 0?this._zoom:k,P.scale(h)/P.scale(k)},getScaleZoom:function(h,k){var P=this.options.crs;k=k===void 0?this._zoom:k;var V=P.zoom(h*P.scale(k));return isNaN(V)?1/0:V},project:function(h,k){return k=k===void 0?this._zoom:k,this.options.crs.latLngToPoint(xe(h),k)},unproject:function(h,k){return k=k===void 0?this._zoom:k,this.options.crs.pointToLatLng(re(h),k)},layerPointToLatLng:function(h){var k=re(h).add(this.getPixelOrigin());return this.unproject(k)},latLngToLayerPoint:function(h){var k=this.project(xe(h))._round();return k._subtract(this.getPixelOrigin())},wrapLatLng:function(h){return this.options.crs.wrapLatLng(xe(h))},wrapLatLngBounds:function(h){return this.options.crs.wrapLatLngBounds(de(h))},distance:function(h,k){return this.options.crs.distance(xe(h),xe(k))},containerPointToLayerPoint:function(h){return re(h).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(h){return re(h).add(this._getMapPanePos())},containerPointToLatLng:function(h){var k=this.containerPointToLayerPoint(re(h));return this.layerPointToLatLng(k)},latLngToContainerPoint:function(h){return this.layerPointToContainerPoint(this.latLngToLayerPoint(xe(h)))},mouseEventToContainerPoint:function(h){return Du(h,this._container)},mouseEventToLayerPoint:function(h){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(h))},mouseEventToLatLng:function(h){return this.layerPointToLatLng(this.mouseEventToLayerPoint(h))},_initContainer:function(h){var k=this._container=tt(h);if(k){if(k._leaflet_id)throw new Error("Map container is already initialized.")}else throw new Error("Map container not found.");sr(k,"scroll",this._onScroll,this),this._containerId=l(k)},_initLayout:function(){var h=this._container;this._fadeAnimated=this.options.fadeAnimation&&St.any3d,It(h,"leaflet-container"+(St.touch?" leaflet-touch":"")+(St.retina?" leaflet-retina":"")+(St.ielt9?" leaflet-oldie":"")+(St.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var k=ot(h,"position");k!=="absolute"&&k!=="relative"&&k!=="fixed"&&k!=="sticky"&&(h.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var h=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),yn(this._mapPane,new Q(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(It(h.markerPane,"leaflet-zoom-hide"),It(h.shadowPane,"leaflet-zoom-hide"))},_resetView:function(h,k,P){yn(this._mapPane,new Q(0,0));var V=!this._loaded;this._loaded=!0,k=this._limitZoom(k),this.fire("viewprereset");var ee=this._zoom!==k;this._moveStart(ee,P)._move(h,k)._moveEnd(ee),this.fire("viewreset"),V&&this.fire("load")},_moveStart:function(h,k){return h&&this.fire("zoomstart"),k||this.fire("movestart"),this},_move:function(h,k,P,V){k===void 0&&(k=this._zoom);var ee=this._zoom!==k;return this._zoom=k,this._lastCenter=h,this._pixelOrigin=this._getNewPixelOrigin(h),V?P&&P.pinch&&this.fire("zoom",P):((ee||P&&P.pinch)&&this.fire("zoom",P),this.fire("move",P)),this},_moveEnd:function(h){return h&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return K(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(h){yn(this._mapPane,this._getMapPanePos().subtract(h))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(h){this._targets={},this._targets[l(this._container)]=this;var k=h?$r:sr;k(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&k(window,"resize",this._onResize,this),St.any3d&&this.options.transform3DLimit&&(h?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){K(this._resizeRequest),this._resizeRequest=G(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var h=this._getMapPanePos();Math.max(Math.abs(h.x),Math.abs(h.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(h,k){for(var P=[],V,ee=k==="mouseout"||k==="mouseover",ue=h.target||h.srcElement,we=!1;ue;){if(V=this._targets[l(ue)],V&&(k==="click"||k==="preclick")&&this._draggableMoved(V)){we=!0;break}if(V&&V.listens(k,!0)&&(ee&&!To(ue,h)||(P.push(V),ee))||ue===this._container)break;ue=ue.parentNode}return!P.length&&!we&&!ee&&this.listens(k,!0)&&(P=[this]),P},_isClickDisabled:function(h){for(;h&&h!==this._container;){if(h._leaflet_disable_click)return!0;h=h.parentNode}},_handleDOMEvent:function(h){var k=h.target||h.srcElement;if(!(!this._loaded||k._leaflet_disable_events||h.type==="click"&&this._isClickDisabled(k))){var P=h.type;P==="mousedown"&&Eo(k),this._fireDOMEvent(h,P)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(h,k,P){if(h.type==="click"){var V=i({},h);V.type="preclick",this._fireDOMEvent(V,V.type,P)}var ee=this._findEventTargets(h,k);if(P){for(var ue=[],we=0;we<P.length;we++)P[we].listens(k,!0)&&ue.push(P[we]);ee=ue.concat(ee)}if(ee.length){k==="contextmenu"&&hn(h);var Me=ee[0],De={originalEvent:h};if(h.type!=="keypress"&&h.type!=="keydown"&&h.type!=="keyup"){var Ze=Me.getLatLng&&(!Me._radius||Me._radius<=10);De.containerPoint=Ze?this.latLngToContainerPoint(Me.getLatLng()):this.mouseEventToContainerPoint(h),De.layerPoint=this.containerPointToLayerPoint(De.containerPoint),De.latlng=Ze?Me.getLatLng():this.layerPointToLatLng(De.layerPoint)}for(we=0;we<ee.length;we++)if(ee[we].fire(k,De,!0),De.originalEvent._stopped||ee[we].options.bubblingMouseEvents===!1&&N(this._mouseEvents,k)!==-1)return}},_draggableMoved:function(h){return h=h.dragging&&h.dragging.enabled()?h:this,h.dragging&&h.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var h=0,k=this._handlers.length;h<k;h++)this._handlers[h].disable()},whenReady:function(h,k){return this._loaded?h.call(k||this,{target:this}):this.on("load",h,k),this},_getMapPanePos:function(){return no(this._mapPane)||new Q(0,0)},_moved:function(){var h=this._getMapPanePos();return h&&!h.equals([0,0])},_getTopLeftPoint:function(h,k){var P=h&&k!==void 0?this._getNewPixelOrigin(h,k):this.getPixelOrigin();return P.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(h,k){var P=this.getSize()._divideBy(2);return this.project(h,k)._subtract(P)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(h,k,P){var V=this._getNewPixelOrigin(P,k);return this.project(h,k)._subtract(V)},_latLngBoundsToNewLayerBounds:function(h,k,P){var V=this._getNewPixelOrigin(P,k);return J([this.project(h.getSouthWest(),k)._subtract(V),this.project(h.getNorthWest(),k)._subtract(V),this.project(h.getSouthEast(),k)._subtract(V),this.project(h.getNorthEast(),k)._subtract(V)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(h){return this.latLngToLayerPoint(h).subtract(this._getCenterLayerPoint())},_limitCenter:function(h,k,P){if(!P)return h;var V=this.project(h,k),ee=this.getSize().divideBy(2),ue=new Y(V.subtract(ee),V.add(ee)),we=this._getBoundsOffset(ue,P,k);return Math.abs(we.x)<=1&&Math.abs(we.y)<=1?h:this.unproject(V.add(we),k)},_limitOffset:function(h,k){if(!k)return h;var P=this.getPixelBounds(),V=new Y(P.min.add(h),P.max.add(h));return h.add(this._getBoundsOffset(V,k))},_getBoundsOffset:function(h,k,P){var V=J(this.project(k.getNorthEast(),P),this.project(k.getSouthWest(),P)),ee=V.min.subtract(h.min),ue=V.max.subtract(h.max),we=this._rebound(ee.x,-ue.x),Me=this._rebound(ee.y,-ue.y);return new Q(we,Me)},_rebound:function(h,k){return h+k>0?Math.round(h-k)/2:Math.max(0,Math.ceil(h))-Math.max(0,Math.floor(k))},_limitZoom:function(h){var k=this.getMinZoom(),P=this.getMaxZoom(),V=St.any3d?this.options.zoomSnap:1;return V&&(h=Math.round(h/V)*V),Math.max(k,Math.min(P,h))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){Ir(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(h,k){var P=this._getCenterOffset(h)._trunc();return(k&&k.animate)!==!0&&!this.getSize().contains(P)?!1:(this.panBy(P,k),!0)},_createAnimProxy:function(){var h=this._proxy=qe("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(h),this.on("zoomanim",function(k){var P=ro,V=this._proxy.style[P];en(this._proxy,this.project(k.center,k.zoom),this.getZoomScale(k.zoom,1)),V===this._proxy.style[P]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){Mt(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var h=this.getCenter(),k=this.getZoom();en(this._proxy,this.project(h,k),this.getZoomScale(k,1))},_catchTransitionEnd:function(h){this._animatingZoom&&h.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(h,k,P){if(this._animatingZoom)return!0;if(P=P||{},!this._zoomAnimated||P.animate===!1||this._nothingToAnimate()||Math.abs(k-this._zoom)>this.options.zoomAnimationThreshold)return!1;var V=this.getZoomScale(k),ee=this._getCenterOffset(h)._divideBy(1-1/V);return P.animate!==!0&&!this.getSize().contains(ee)?!1:(G(function(){this._moveStart(!0,P.noMoveStart||!1)._animateZoom(h,k,!0)},this),!0)},_animateZoom:function(h,k,P,V){this._mapPane&&(P&&(this._animatingZoom=!0,this._animateToCenter=h,this._animateToZoom=k,It(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:h,zoom:k,noUpdate:V}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(s(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&Ir(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function yi(h,k){return new Cr(h,k)}var ii=W.extend({options:{position:"topright"},initialize:function(h){S(this,h)},getPosition:function(){return this.options.position},setPosition:function(h){var k=this._map;return k&&k.removeControl(this),this.options.position=h,k&&k.addControl(this),this},getContainer:function(){return this._container},addTo:function(h){this.remove(),this._map=h;var k=this._container=this.onAdd(h),P=this.getPosition(),V=h._controlCorners[P];return It(k,"leaflet-control"),P.indexOf("bottom")!==-1?V.insertBefore(k,V.firstChild):V.appendChild(k),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(Mt(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(h){this._map&&h&&h.screenX>0&&h.screenY>0&&this._map.getContainer().focus()}}),wa=function(h){return new ii(h)};Cr.include({addControl:function(h){return h.addTo(this),this},removeControl:function(h){return h.remove(),this},_initControlPos:function(){var h=this._controlCorners={},k="leaflet-",P=this._controlContainer=qe("div",k+"control-container",this._container);function V(ee,ue){var we=k+ee+" "+k+ue;h[ee+ue]=qe("div",we,P)}V("top","left"),V("top","right"),V("bottom","left"),V("bottom","right")},_clearControlPos:function(){for(var h in this._controlCorners)Mt(this._controlCorners[h]);Mt(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var ql=ii.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(h,k,P,V){return P<V?-1:V<P?1:0}},initialize:function(h,k,P){S(this,P),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1;for(var V in h)this._addLayer(h[V],V);for(V in k)this._addLayer(k[V],V,!0)},onAdd:function(h){this._initLayout(),this._update(),this._map=h,h.on("zoomend",this._checkDisabledLayers,this);for(var k=0;k<this._layers.length;k++)this._layers[k].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(h){return ii.prototype.addTo.call(this,h),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var h=0;h<this._layers.length;h++)this._layers[h].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(h,k){return this._addLayer(h,k),this._map?this._update():this},addOverlay:function(h,k){return this._addLayer(h,k,!0),this._map?this._update():this},removeLayer:function(h){h.off("add remove",this._onLayerChange,this);var k=this._getLayer(l(h));return k&&this._layers.splice(this._layers.indexOf(k),1),this._map?this._update():this},expand:function(){It(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var h=this._map.getSize().y-(this._container.offsetTop+50);return h<this._section.clientHeight?(It(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=h+"px"):Ir(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return Ir(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var h="leaflet-control-layers",k=this._container=qe("div",h),P=this.options.collapsed;k.setAttribute("aria-haspopup",!0),Ou(k),Hl(k);var V=this._section=qe("section",h+"-list");P&&(this._map.on("click",this.collapse,this),sr(k,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var ee=this._layersLink=qe("a",h+"-toggle",k);ee.href="#",ee.title="Layers",ee.setAttribute("role","button"),sr(ee,{keydown:function(ue){ue.keyCode===13&&this._expandSafely()},click:function(ue){hn(ue),this._expandSafely()}},this),P||this.expand(),this._baseLayersList=qe("div",h+"-base",V),this._separator=qe("div",h+"-separator",V),this._overlaysList=qe("div",h+"-overlays",V),k.appendChild(V)},_getLayer:function(h){for(var k=0;k<this._layers.length;k++)if(this._layers[k]&&l(this._layers[k].layer)===h)return this._layers[k]},_addLayer:function(h,k,P){this._map&&h.on("add remove",this._onLayerChange,this),this._layers.push({layer:h,name:k,overlay:P}),this.options.sortLayers&&this._layers.sort(s(function(V,ee){return this.options.sortFunction(V.layer,ee.layer,V.name,ee.name)},this)),this.options.autoZIndex&&h.setZIndex&&(this._lastZIndex++,h.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;Nr(this._baseLayersList),Nr(this._overlaysList),this._layerControlInputs=[];var h,k,P,V,ee=0;for(P=0;P<this._layers.length;P++)V=this._layers[P],this._addItem(V),k=k||V.overlay,h=h||!V.overlay,ee+=V.overlay?0:1;return this.options.hideSingleBase&&(h=h&&ee>1,this._baseLayersList.style.display=h?"":"none"),this._separator.style.display=k&&h?"":"none",this},_onLayerChange:function(h){this._handlingClick||this._update();var k=this._getLayer(l(h.target)),P=k.overlay?h.type==="add"?"overlayadd":"overlayremove":h.type==="add"?"baselayerchange":null;P&&this._map.fire(P,k)},_createRadioElement:function(h,k){var P='<input type="radio" class="leaflet-control-layers-selector" name="'+h+'"'+(k?' checked="checked"':"")+"/>",V=document.createElement("div");return V.innerHTML=P,V.firstChild},_addItem:function(h){var k=document.createElement("label"),P=this._map.hasLayer(h.layer),V;h.overlay?(V=document.createElement("input"),V.type="checkbox",V.className="leaflet-control-layers-selector",V.defaultChecked=P):V=this._createRadioElement("leaflet-base-layers_"+l(this),P),this._layerControlInputs.push(V),V.layerId=l(h.layer),sr(V,"click",this._onInputClick,this);var ee=document.createElement("span");ee.innerHTML=" "+h.name;var ue=document.createElement("span");k.appendChild(ue),ue.appendChild(V),ue.appendChild(ee);var we=h.overlay?this._overlaysList:this._baseLayersList;return we.appendChild(k),this._checkDisabledLayers(),k},_onInputClick:function(){if(!this._preventClick){var h=this._layerControlInputs,k,P,V=[],ee=[];this._handlingClick=!0;for(var ue=h.length-1;ue>=0;ue--)k=h[ue],P=this._getLayer(k.layerId).layer,k.checked?V.push(P):k.checked||ee.push(P);for(ue=0;ue<ee.length;ue++)this._map.hasLayer(ee[ue])&&this._map.removeLayer(ee[ue]);for(ue=0;ue<V.length;ue++)this._map.hasLayer(V[ue])||this._map.addLayer(V[ue]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var h=this._layerControlInputs,k,P,V=this._map.getZoom(),ee=h.length-1;ee>=0;ee--)k=h[ee],P=this._getLayer(k.layerId).layer,k.disabled=P.options.minZoom!==void 0&&V<P.options.minZoom||P.options.maxZoom!==void 0&&V>P.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var h=this._section;this._preventClick=!0,sr(h,"click",hn),this.expand();var k=this;setTimeout(function(){$r(h,"click",hn),k._preventClick=!1})}}),ul=function(h,k,P){return new ql(h,k,P)},xi=ii.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(h){var k="leaflet-control-zoom",P=qe("div",k+" leaflet-bar"),V=this.options;return this._zoomInButton=this._createButton(V.zoomInText,V.zoomInTitle,k+"-in",P,this._zoomIn),this._zoomOutButton=this._createButton(V.zoomOutText,V.zoomOutTitle,k+"-out",P,this._zoomOut),this._updateDisabled(),h.on("zoomend zoomlevelschange",this._updateDisabled,this),P},onRemove:function(h){h.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(h){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(h.shiftKey?3:1))},_zoomOut:function(h){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(h.shiftKey?3:1))},_createButton:function(h,k,P,V,ee){var ue=qe("a",P,V);return ue.innerHTML=h,ue.href="#",ue.title=k,ue.setAttribute("role","button"),ue.setAttribute("aria-label",k),Ou(ue),sr(ue,"click",Fn),sr(ue,"click",ee,this),sr(ue,"click",this._refocusOnMap,this),ue},_updateDisabled:function(){var h=this._map,k="leaflet-disabled";Ir(this._zoomInButton,k),Ir(this._zoomOutButton,k),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||h._zoom===h.getMinZoom())&&(It(this._zoomOutButton,k),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||h._zoom===h.getMaxZoom())&&(It(this._zoomInButton,k),this._zoomInButton.setAttribute("aria-disabled","true"))}});Cr.mergeOptions({zoomControl:!0}),Cr.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new xi,this.addControl(this.zoomControl))});var Sa=function(h){return new xi(h)},Bn=ii.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(h){var k="leaflet-control-scale",P=qe("div",k),V=this.options;return this._addScales(V,k+"-line",P),h.on(V.updateWhenIdle?"moveend":"move",this._update,this),h.whenReady(this._update,this),P},onRemove:function(h){h.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(h,k,P){h.metric&&(this._mScale=qe("div",k,P)),h.imperial&&(this._iScale=qe("div",k,P))},_update:function(){var h=this._map,k=h.getSize().y/2,P=h.distance(h.containerPointToLatLng([0,k]),h.containerPointToLatLng([this.options.maxWidth,k]));this._updateScales(P)},_updateScales:function(h){this.options.metric&&h&&this._updateMetric(h),this.options.imperial&&h&&this._updateImperial(h)},_updateMetric:function(h){var k=this._getRoundNum(h),P=k<1e3?k+" m":k/1e3+" km";this._updateScale(this._mScale,P,k/h)},_updateImperial:function(h){var k=h*3.2808399,P,V,ee;k>5280?(P=k/5280,V=this._getRoundNum(P),this._updateScale(this._iScale,V+" mi",V/P)):(ee=this._getRoundNum(k),this._updateScale(this._iScale,ee+" ft",ee/k))},_updateScale:function(h,k,P){h.style.width=Math.round(this.options.maxWidth*P)+"px",h.innerHTML=k},_getRoundNum:function(h){var k=Math.pow(10,(Math.floor(h)+"").length-1),P=h/k;return P=P>=10?10:P>=5?5:P>=3?3:P>=2?2:1,k*P}}),Qi=function(h){return new Bn(h)},ps='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',ka=ii.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(St.inlineSvg?ps+" ":"")+"Leaflet</a>"},initialize:function(h){S(this,h),this._attributions={}},onAdd:function(h){h.attributionControl=this,this._container=qe("div","leaflet-control-attribution"),Ou(this._container);for(var k in h._layers)h._layers[k].getAttribution&&this.addAttribution(h._layers[k].getAttribution());return this._update(),h.on("layeradd",this._addAttribution,this),this._container},onRemove:function(h){h.off("layeradd",this._addAttribution,this)},_addAttribution:function(h){h.layer.getAttribution&&(this.addAttribution(h.layer.getAttribution()),h.layer.once("remove",function(){this.removeAttribution(h.layer.getAttribution())},this))},setPrefix:function(h){return this.options.prefix=h,this._update(),this},addAttribution:function(h){return h?(this._attributions[h]||(this._attributions[h]=0),this._attributions[h]++,this._update(),this):this},removeAttribution:function(h){return h?(this._attributions[h]&&(this._attributions[h]--,this._update()),this):this},_update:function(){if(this._map){var h=[];for(var k in this._attributions)this._attributions[k]&&h.push(k);var P=[];this.options.prefix&&P.push(this.options.prefix),h.length&&P.push(h.join(", ")),this._container.innerHTML=P.join(' <span aria-hidden="true">|</span> ')}}});Cr.mergeOptions({attributionControl:!0}),Cr.addInitHook(function(){this.options.attributionControl&&new ka().addTo(this)});var Oh=function(h){return new ka(h)};ii.Layers=ql,ii.Zoom=xi,ii.Scale=Bn,ii.Attribution=ka,wa.layers=ul,wa.zoom=Sa,wa.scale=Qi,wa.attribution=Oh;var Ji=W.extend({initialize:function(h){this._map=h},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});Ji.addTo=function(h,k){return h.addHandler(k,this),this};var ju={Events:q},ai=St.touch?"touchstart mousedown":"mousedown",_n=Z.extend({options:{clickTolerance:3},initialize:function(h,k,P,V){S(this,V),this._element=h,this._dragStartTarget=k||h,this._preventOutline=P},enable:function(){this._enabled||(sr(this._dragStartTarget,ai,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(_n._dragging===this&&this.finishDrag(!0),$r(this._dragStartTarget,ai,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(h){if(this._enabled&&(this._moved=!1,!vi(this._element,"leaflet-zoom-anim"))){if(h.touches&&h.touches.length!==1){_n._dragging===this&&this.finishDrag();return}if(!(_n._dragging||h.shiftKey||h.which!==1&&h.button!==1&&!h.touches)&&(_n._dragging=this,this._preventOutline&&Eo(this._element),Cc(),xr(),!this._moving)){this.fire("down");var k=h.touches?h.touches[0]:h,P=ao(this._element);this._startPoint=new Q(k.clientX,k.clientY),this._startPos=no(this._element),this._parentScale=$a(P);var V=h.type==="mousedown";sr(document,V?"mousemove":"touchmove",this._onMove,this),sr(document,V?"mouseup":"touchend touchcancel",this._onUp,this)}}},_onMove:function(h){if(this._enabled){if(h.touches&&h.touches.length>1){this._moved=!0;return}var k=h.touches&&h.touches.length===1?h.touches[0]:h,P=new Q(k.clientX,k.clientY)._subtract(this._startPoint);!P.x&&!P.y||Math.abs(P.x)+Math.abs(P.y)<this.options.clickTolerance||(P.x/=this._parentScale.x,P.y/=this._parentScale.y,hn(h),this._moved||(this.fire("dragstart"),this._moved=!0,It(document.body,"leaflet-dragging"),this._lastTarget=h.target||h.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),It(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(P),this._moving=!0,this._lastEvent=h,this._updatePosition())}},_updatePosition:function(){var h={originalEvent:this._lastEvent};this.fire("predrag",h),yn(this._element,this._newPos),this.fire("drag",h)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(h){Ir(document.body,"leaflet-dragging"),this._lastTarget&&(Ir(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),$r(document,"mousemove touchmove",this._onMove,this),$r(document,"mouseup touchend touchcancel",this._onUp,this),Ec(),io();var k=this._moved&&this._moving;this._moving=!1,_n._dragging=!1,k&&this.fire("dragend",{noInertia:h,distance:this._newPos.distanceTo(this._startPos)})}});function tn(h,k,P){var V,ee=[1,4,2,8],ue,we,Me,De,Ze,kt,Yt,fr;for(ue=0,kt=h.length;ue<kt;ue++)h[ue]._code=Is(h[ue],k);for(Me=0;Me<4;Me++){for(Yt=ee[Me],V=[],ue=0,kt=h.length,we=kt-1;ue<kt;we=ue++)De=h[ue],Ze=h[we],De._code&Yt?Ze._code&Yt||(fr=Pc(Ze,De,Yt,k,P),fr._code=Is(fr,k),V.push(fr)):(Ze._code&Yt&&(fr=Pc(Ze,De,Yt,k,P),fr._code=Is(fr,k),V.push(fr)),V.push(De));h=V}return h}function $l(h,k){var P,V,ee,ue,we,Me,De,Ze,kt;if(!h||h.length===0)throw new Error("latlngs not passed");Bi(h)||(console.warn("latlngs are not flat! Only the first ring will be used"),h=h[0]);var Yt=xe([0,0]),fr=de(h),Zr=fr.getNorthWest().distanceTo(fr.getSouthWest())*fr.getNorthEast().distanceTo(fr.getNorthWest());Zr<1700&&(Yt=_a(h));var Gn=h.length,Ai=[];for(P=0;P<Gn;P++){var zi=xe(h[P]);Ai.push(k.project(xe([zi.lat-Yt.lat,zi.lng-Yt.lng])))}for(Me=De=Ze=0,P=0,V=Gn-1;P<Gn;V=P++)ee=Ai[P],ue=Ai[V],we=ee.y*ue.x-ue.y*ee.x,De+=(ee.x+ue.x)*we,Ze+=(ee.y+ue.y)*we,Me+=we*3;Me===0?kt=Ai[0]:kt=[De/Me,Ze/Me];var yl=k.unproject(re(kt));return xe([yl.lat+Yt.lat,yl.lng+Yt.lng])}function _a(h){for(var k=0,P=0,V=0,ee=0;ee<h.length;ee++){var ue=xe(h[ee]);k+=ue.lat,P+=ue.lng,V++}return xe([k/V,P/V])}var Dh={__proto__:null,clipPolygon:tn,polygonCenter:$l,centroid:_a};function Fu(h,k){if(!k||!h.length)return h.slice();var P=k*k;return h=jh(h,P),h=Ih(h,P),h}function Tc(h,k,P){return Math.sqrt(ms(h,k,P,!0))}function yf(h,k,P){return ms(h,k,P)}function Ih(h,k){var P=h.length,V=typeof Uint8Array<"u"?Uint8Array:Array,ee=new V(P);ee[0]=ee[P-1]=1,Kl(h,ee,k,0,P-1);var ue,we=[];for(ue=0;ue<P;ue++)ee[ue]&&we.push(h[ue]);return we}function Kl(h,k,P,V,ee){var ue=0,we,Me,De;for(Me=V+1;Me<=ee-1;Me++)De=ms(h[Me],h[V],h[ee],!0),De>ue&&(we=Me,ue=De);ue>P&&(k[we]=1,Kl(h,k,P,V,we),Kl(h,k,P,we,ee))}function jh(h,k){for(var P=[h[0]],V=1,ee=0,ue=h.length;V<ue;V++)ym(h[V],h[ee])>k&&(P.push(h[V]),ee=V);return ee<ue-1&&P.push(h[ue-1]),P}var No;function Nc(h,k,P,V,ee){var ue=V?No:Is(h,P),we=Is(k,P),Me,De,Ze;for(No=we;;){if(!(ue|we))return[h,k];if(ue&we)return!1;Me=ue||we,De=Pc(h,k,Me,P,ee),Ze=Is(De,P),Me===ue?(h=De,ue=Ze):(k=De,we=Ze)}}function Pc(h,k,P,V,ee){var ue=k.x-h.x,we=k.y-h.y,Me=V.min,De=V.max,Ze,kt;return P&8?(Ze=h.x+ue*(De.y-h.y)/we,kt=De.y):P&4?(Ze=h.x+ue*(Me.y-h.y)/we,kt=Me.y):P&2?(Ze=De.x,kt=h.y+we*(De.x-h.x)/ue):P&1&&(Ze=Me.x,kt=h.y+we*(Me.x-h.x)/ue),new Q(Ze,kt,ee)}function Is(h,k){var P=0;return h.x<k.min.x?P|=1:h.x>k.max.x&&(P|=2),h.y<k.min.y?P|=4:h.y>k.max.y&&(P|=8),P}function ym(h,k){var P=k.x-h.x,V=k.y-h.y;return P*P+V*V}function ms(h,k,P,V){var ee=k.x,ue=k.y,we=P.x-ee,Me=P.y-ue,De=we*we+Me*Me,Ze;return De>0&&(Ze=((h.x-ee)*we+(h.y-ue)*Me)/De,Ze>1?(ee=P.x,ue=P.y):Ze>0&&(ee+=we*Ze,ue+=Me*Ze)),we=h.x-ee,Me=h.y-ue,V?we*we+Me*Me:new Q(ee,ue)}function Bi(h){return!T(h[0])||typeof h[0][0]!="object"&&typeof h[0][0]<"u"}function xf(h){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),Bi(h)}function bf(h,k){var P,V,ee,ue,we,Me,De,Ze;if(!h||h.length===0)throw new Error("latlngs not passed");Bi(h)||(console.warn("latlngs are not flat! Only the first ring will be used"),h=h[0]);var kt=xe([0,0]),Yt=de(h),fr=Yt.getNorthWest().distanceTo(Yt.getSouthWest())*Yt.getNorthEast().distanceTo(Yt.getNorthWest());fr<1700&&(kt=_a(h));var Zr=h.length,Gn=[];for(P=0;P<Zr;P++){var Ai=xe(h[P]);Gn.push(k.project(xe([Ai.lat-kt.lat,Ai.lng-kt.lng])))}for(P=0,V=0;P<Zr-1;P++)V+=Gn[P].distanceTo(Gn[P+1])/2;if(V===0)Ze=Gn[0];else for(P=0,ue=0;P<Zr-1;P++)if(we=Gn[P],Me=Gn[P+1],ee=we.distanceTo(Me),ue+=ee,ue>V){De=(ue-V)/ee,Ze=[Me.x-De*(Me.x-we.x),Me.y-De*(Me.y-we.y)];break}var zi=k.unproject(re(Ze));return xe([zi.lat+kt.lat,zi.lng+kt.lng])}var cl={__proto__:null,simplify:Fu,pointToSegmentDistance:Tc,closestPointOnSegment:yf,clipSegment:Nc,_getEdgeIntersection:Pc,_getBitCode:Is,_sqClosestPointOnSegment:ms,isFlat:Bi,_flat:xf,polylineCenter:bf},Mc={project:function(h){return new Q(h.lng,h.lat)},unproject:function(h){return new he(h.y,h.x)},bounds:new Y([-180,-90],[180,90])},Zl={R:6378137,R_MINOR:6356752314245179e-9,bounds:new Y([-2003750834279e-5,-1549657073972e-5],[2003750834279e-5,1876465623138e-5]),project:function(h){var k=Math.PI/180,P=this.R,V=h.lat*k,ee=this.R_MINOR/P,ue=Math.sqrt(1-ee*ee),we=ue*Math.sin(V),Me=Math.tan(Math.PI/4-V/2)/Math.pow((1-we)/(1+we),ue/2);return V=-P*Math.log(Math.max(Me,1e-10)),new Q(h.lng*k*P,V)},unproject:function(h){for(var k=180/Math.PI,P=this.R,V=this.R_MINOR/P,ee=Math.sqrt(1-V*V),ue=Math.exp(-h.y/P),we=Math.PI/2-2*Math.atan(ue),Me=0,De=.1,Ze;Me<15&&Math.abs(De)>1e-7;Me++)Ze=ee*Math.sin(we),Ze=Math.pow((1-Ze)/(1+Ze),ee/2),De=Math.PI/2-2*Math.atan(ue*Ze)-we,we+=De;return new he(we*k,h.x*k/P)}},Ac={__proto__:null,LonLat:Mc,Mercator:Zl,SphericalMercator:ge},Yl=i({},fe,{code:"EPSG:3395",projection:Zl,transformation:(function(){var h=.5/(Math.PI*Zl.R);return ye(h,.5,-h,.5)})()}),Rc=i({},fe,{code:"EPSG:4326",projection:Mc,transformation:ye(1/180,1,-1/180,.5)}),wf=i({},le,{projection:Mc,transformation:ye(1,0,-1,0),scale:function(h){return Math.pow(2,h)},zoom:function(h){return Math.log(h)/Math.LN2},distance:function(h,k){var P=k.lng-h.lng,V=k.lat-h.lat;return Math.sqrt(P*P+V*V)},infinite:!0});le.Earth=fe,le.EPSG3395=Yl,le.EPSG3857=Se,le.EPSG900913=Ue,le.EPSG4326=Rc,le.Simple=wf;var Ka=Z.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(h){return h.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(h){return h&&h.removeLayer(this),this},getPane:function(h){return this._map.getPane(h?this.options[h]||h:this.options.pane)},addInteractiveTarget:function(h){return this._map._targets[l(h)]=this,this},removeInteractiveTarget:function(h){return delete this._map._targets[l(h)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(h){var k=h.target;if(k.hasLayer(this)){if(this._map=k,this._zoomAnimated=k._zoomAnimated,this.getEvents){var P=this.getEvents();k.on(P,this),this.once("remove",function(){k.off(P,this)},this)}this.onAdd(k),this.fire("add"),k.fire("layeradd",{layer:this})}}});Cr.include({addLayer:function(h){if(!h._layerAdd)throw new Error("The provided object is not a Layer.");var k=l(h);return this._layers[k]?this:(this._layers[k]=h,h._mapToAdd=this,h.beforeAdd&&h.beforeAdd(this),this.whenReady(h._layerAdd,h),this)},removeLayer:function(h){var k=l(h);return this._layers[k]?(this._loaded&&h.onRemove(this),delete this._layers[k],this._loaded&&(this.fire("layerremove",{layer:h}),h.fire("remove")),h._map=h._mapToAdd=null,this):this},hasLayer:function(h){return l(h)in this._layers},eachLayer:function(h,k){for(var P in this._layers)h.call(k,this._layers[P]);return this},_addLayers:function(h){h=h?T(h)?h:[h]:[];for(var k=0,P=h.length;k<P;k++)this.addLayer(h[k])},_addZoomLimit:function(h){(!isNaN(h.options.maxZoom)||!isNaN(h.options.minZoom))&&(this._zoomBoundLayers[l(h)]=h,this._updateZoomLevels())},_removeZoomLimit:function(h){var k=l(h);this._zoomBoundLayers[k]&&(delete this._zoomBoundLayers[k],this._updateZoomLevels())},_updateZoomLevels:function(){var h=1/0,k=-1/0,P=this._getZoomSpan();for(var V in this._zoomBoundLayers){var ee=this._zoomBoundLayers[V].options;h=ee.minZoom===void 0?h:Math.min(h,ee.minZoom),k=ee.maxZoom===void 0?k:Math.max(k,ee.maxZoom)}this._layersMaxZoom=k===-1/0?void 0:k,this._layersMinZoom=h===1/0?void 0:h,P!==this._getZoomSpan()&&this.fire("zoomlevelschange"),this.options.maxZoom===void 0&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),this.options.minZoom===void 0&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var js=Ka.extend({initialize:function(h,k){S(this,k),this._layers={};var P,V;if(h)for(P=0,V=h.length;P<V;P++)this.addLayer(h[P])},addLayer:function(h){var k=this.getLayerId(h);return this._layers[k]=h,this._map&&this._map.addLayer(h),this},removeLayer:function(h){var k=h in this._layers?h:this.getLayerId(h);return this._map&&this._layers[k]&&this._map.removeLayer(this._layers[k]),delete this._layers[k],this},hasLayer:function(h){var k=typeof h=="number"?h:this.getLayerId(h);return k in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(h){var k=Array.prototype.slice.call(arguments,1),P,V;for(P in this._layers)V=this._layers[P],V[h]&&V[h].apply(V,k);return this},onAdd:function(h){this.eachLayer(h.addLayer,h)},onRemove:function(h){this.eachLayer(h.removeLayer,h)},eachLayer:function(h,k){for(var P in this._layers)h.call(k,this._layers[P]);return this},getLayer:function(h){return this._layers[h]},getLayers:function(){var h=[];return this.eachLayer(h.push,h),h},setZIndex:function(h){return this.invoke("setZIndex",h)},getLayerId:function(h){return l(h)}}),dl=function(h,k){return new js(h,k)},ea=js.extend({addLayer:function(h){return this.hasLayer(h)?this:(h.addEventParent(this),js.prototype.addLayer.call(this,h),this.fire("layeradd",{layer:h}))},removeLayer:function(h){return this.hasLayer(h)?(h in this._layers&&(h=this._layers[h]),h.removeEventParent(this),js.prototype.removeLayer.call(this,h),this.fire("layerremove",{layer:h})):this},setStyle:function(h){return this.invoke("setStyle",h)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var h=new ie;for(var k in this._layers){var P=this._layers[k];h.extend(P.getBounds?P.getBounds():P.getLatLng())}return h}}),Ca=function(h,k){return new ea(h,k)},Ea=W.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(h){S(this,h)},createIcon:function(h){return this._createIcon("icon",h)},createShadow:function(h){return this._createIcon("shadow",h)},_createIcon:function(h,k){var P=this._getIconUrl(h);if(!P){if(h==="icon")throw new Error("iconUrl not set in Icon options (see the docs).");return null}var V=this._createImg(P,k&&k.tagName==="IMG"?k:null);return this._setIconStyles(V,h),(this.options.crossOrigin||this.options.crossOrigin==="")&&(V.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),V},_setIconStyles:function(h,k){var P=this.options,V=P[k+"Size"];typeof V=="number"&&(V=[V,V]);var ee=re(V),ue=re(k==="shadow"&&P.shadowAnchor||P.iconAnchor||ee&&ee.divideBy(2,!0));h.className="leaflet-marker-"+k+" "+(P.className||""),ue&&(h.style.marginLeft=-ue.x+"px",h.style.marginTop=-ue.y+"px"),ee&&(h.style.width=ee.x+"px",h.style.height=ee.y+"px")},_createImg:function(h,k){return k=k||document.createElement("img"),k.src=h,k},_getIconUrl:function(h){return St.retina&&this.options[h+"RetinaUrl"]||this.options[h+"Url"]}});function Lc(h){return new Ea(h)}var fl=Ea.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(h){return typeof fl.imagePath!="string"&&(fl.imagePath=this._detectIconPath()),(this.options.imagePath||fl.imagePath)+Ea.prototype._getIconUrl.call(this,h)},_stripUrl:function(h){var k=function(P,V,ee){var ue=V.exec(P);return ue&&ue[ee]};return h=k(h,/^url\((['"])?(.+)\1\)$/,2),h&&k(h,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var h=qe("div","leaflet-default-icon-path",document.body),k=ot(h,"background-image")||ot(h,"backgroundImage");if(document.body.removeChild(h),k=this._stripUrl(k),k)return k;var P=document.querySelector('link[href$="leaflet.css"]');return P?P.href.substring(0,P.href.length-11-1):""}}),Za=Ji.extend({initialize:function(h){this._marker=h},addHooks:function(){var h=this._marker._icon;this._draggable||(this._draggable=new _n(h,h,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),It(h,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&Ir(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(h){var k=this._marker,P=k._map,V=this._marker.options.autoPanSpeed,ee=this._marker.options.autoPanPadding,ue=no(k._icon),we=P.getPixelBounds(),Me=P.getPixelOrigin(),De=J(we.min._subtract(Me).add(ee),we.max._subtract(Me).subtract(ee));if(!De.contains(ue)){var Ze=re((Math.max(De.max.x,ue.x)-De.max.x)/(we.max.x-De.max.x)-(Math.min(De.min.x,ue.x)-De.min.x)/(we.min.x-De.min.x),(Math.max(De.max.y,ue.y)-De.max.y)/(we.max.y-De.max.y)-(Math.min(De.min.y,ue.y)-De.min.y)/(we.min.y-De.min.y)).multiplyBy(V);P.panBy(Ze,{animate:!1}),this._draggable._newPos._add(Ze),this._draggable._startPos._add(Ze),yn(k._icon,this._draggable._newPos),this._onDrag(h),this._panRequest=G(this._adjustPan.bind(this,h))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(h){this._marker.options.autoPan&&(K(this._panRequest),this._panRequest=G(this._adjustPan.bind(this,h)))},_onDrag:function(h){var k=this._marker,P=k._shadow,V=no(k._icon),ee=k._map.layerPointToLatLng(V);P&&yn(P,V),k._latlng=ee,h.latlng=ee,h.oldLatLng=this._oldLatLng,k.fire("move",h).fire("drag",h)},_onDragEnd:function(h){K(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",h)}}),Pi=Ka.extend({options:{icon:new fl,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(h,k){S(this,k),this._latlng=xe(h)},onAdd:function(h){this._zoomAnimated=this._zoomAnimated&&h.options.markerZoomAnimation,this._zoomAnimated&&h.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(h){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&h.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(h){var k=this._latlng;return this._latlng=xe(h),this.update(),this.fire("move",{oldLatLng:k,latlng:this._latlng})},setZIndexOffset:function(h){return this.options.zIndexOffset=h,this.update()},getIcon:function(){return this.options.icon},setIcon:function(h){return this.options.icon=h,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var h=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(h)}return this},_initIcon:function(){var h=this.options,k="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),P=h.icon.createIcon(this._icon),V=!1;P!==this._icon&&(this._icon&&this._removeIcon(),V=!0,h.title&&(P.title=h.title),P.tagName==="IMG"&&(P.alt=h.alt||"")),It(P,k),h.keyboard&&(P.tabIndex="0",P.setAttribute("role","button")),this._icon=P,h.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&sr(P,"focus",this._panOnFocus,this);var ee=h.icon.createShadow(this._shadow),ue=!1;ee!==this._shadow&&(this._removeShadow(),ue=!0),ee&&(It(ee,k),ee.alt=""),this._shadow=ee,h.opacity<1&&this._updateOpacity(),V&&this.getPane().appendChild(this._icon),this._initInteraction(),ee&&ue&&this.getPane(h.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&$r(this._icon,"focus",this._panOnFocus,this),Mt(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&Mt(this._shadow),this._shadow=null},_setPos:function(h){this._icon&&yn(this._icon,h),this._shadow&&yn(this._shadow,h),this._zIndex=h.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(h){this._icon&&(this._icon.style.zIndex=this._zIndex+h)},_animateZoom:function(h){var k=this._map._latLngToNewLayerPoint(this._latlng,h.zoom,h.center).round();this._setPos(k)},_initInteraction:function(){if(this.options.interactive&&(It(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),Za)){var h=this.options.draggable;this.dragging&&(h=this.dragging.enabled(),this.dragging.disable()),this.dragging=new Za(this),h&&this.dragging.enable()}},setOpacity:function(h){return this.options.opacity=h,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var h=this.options.opacity;this._icon&&er(this._icon,h),this._shadow&&er(this._shadow,h)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var h=this._map;if(h){var k=this.options.icon.options,P=k.iconSize?re(k.iconSize):re(0,0),V=k.iconAnchor?re(k.iconAnchor):re(0,0);h.panInside(this._latlng,{paddingTopLeft:V,paddingBottomRight:P.subtract(V)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function Sf(h,k){return new Pi(h,k)}var so=Ka.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(h){this._renderer=h.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(h){return S(this,h),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&h&&Object.prototype.hasOwnProperty.call(h,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),Ya=so.extend({options:{fill:!0,radius:10},initialize:function(h,k){S(this,k),this._latlng=xe(h),this._radius=this.options.radius},setLatLng:function(h){var k=this._latlng;return this._latlng=xe(h),this.redraw(),this.fire("move",{oldLatLng:k,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(h){return this.options.radius=this._radius=h,this.redraw()},getRadius:function(){return this._radius},setStyle:function(h){var k=h&&h.radius||this._radius;return so.prototype.setStyle.call(this,h),this.setRadius(k),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var h=this._radius,k=this._radiusY||h,P=this._clickTolerance(),V=[h+P,k+P];this._pxBounds=new Y(this._point.subtract(V),this._point.add(V))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(h){return h.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function oo(h,k){return new Ya(h,k)}var hl=Ya.extend({initialize:function(h,k,P){if(typeof k=="number"&&(k=i({},P,{radius:k})),S(this,k),this._latlng=xe(h),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(h){return this._mRadius=h,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var h=[this._radius,this._radiusY||this._radius];return new ie(this._map.layerPointToLatLng(this._point.subtract(h)),this._map.layerPointToLatLng(this._point.add(h)))},setStyle:so.prototype.setStyle,_project:function(){var h=this._latlng.lng,k=this._latlng.lat,P=this._map,V=P.options.crs;if(V.distance===fe.distance){var ee=Math.PI/180,ue=this._mRadius/fe.R/ee,we=P.project([k+ue,h]),Me=P.project([k-ue,h]),De=we.add(Me).divideBy(2),Ze=P.unproject(De).lat,kt=Math.acos((Math.cos(ue*ee)-Math.sin(k*ee)*Math.sin(Ze*ee))/(Math.cos(k*ee)*Math.cos(Ze*ee)))/ee;(isNaN(kt)||kt===0)&&(kt=ue/Math.cos(Math.PI/180*k)),this._point=De.subtract(P.getPixelOrigin()),this._radius=isNaN(kt)?0:De.x-P.project([Ze,h-kt]).x,this._radiusY=De.y-we.y}else{var Yt=V.unproject(V.project(this._latlng).subtract([this._mRadius,0]));this._point=P.latLngToLayerPoint(this._latlng),this._radius=this._point.x-P.latLngToLayerPoint(Yt).x}this._updateBounds()}});function Xl(h,k,P){return new hl(h,k,P)}var Mi=so.extend({options:{smoothFactor:1,noClip:!1},initialize:function(h,k){S(this,k),this._setLatLngs(h)},getLatLngs:function(){return this._latlngs},setLatLngs:function(h){return this._setLatLngs(h),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(h){for(var k=1/0,P=null,V=ms,ee,ue,we=0,Me=this._parts.length;we<Me;we++)for(var De=this._parts[we],Ze=1,kt=De.length;Ze<kt;Ze++){ee=De[Ze-1],ue=De[Ze];var Yt=V(h,ee,ue,!0);Yt<k&&(k=Yt,P=V(h,ee,ue))}return P&&(P.distance=Math.sqrt(k)),P},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return bf(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(h,k){return k=k||this._defaultShape(),h=xe(h),k.push(h),this._bounds.extend(h),this.redraw()},_setLatLngs:function(h){this._bounds=new ie,this._latlngs=this._convertLatLngs(h)},_defaultShape:function(){return Bi(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(h){for(var k=[],P=Bi(h),V=0,ee=h.length;V<ee;V++)P?(k[V]=xe(h[V]),this._bounds.extend(k[V])):k[V]=this._convertLatLngs(h[V]);return k},_project:function(){var h=new Y;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,h),this._bounds.isValid()&&h.isValid()&&(this._rawPxBounds=h,this._updateBounds())},_updateBounds:function(){var h=this._clickTolerance(),k=new Q(h,h);this._rawPxBounds&&(this._pxBounds=new Y([this._rawPxBounds.min.subtract(k),this._rawPxBounds.max.add(k)]))},_projectLatlngs:function(h,k,P){var V=h[0]instanceof he,ee=h.length,ue,we;if(V){for(we=[],ue=0;ue<ee;ue++)we[ue]=this._map.latLngToLayerPoint(h[ue]),P.extend(we[ue]);k.push(we)}else for(ue=0;ue<ee;ue++)this._projectLatlngs(h[ue],k,P)},_clipPoints:function(){var h=this._renderer._bounds;if(this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(h))){if(this.options.noClip){this._parts=this._rings;return}var k=this._parts,P,V,ee,ue,we,Me,De;for(P=0,ee=0,ue=this._rings.length;P<ue;P++)for(De=this._rings[P],V=0,we=De.length;V<we-1;V++)Me=Nc(De[V],De[V+1],h,V,!0),Me&&(k[ee]=k[ee]||[],k[ee].push(Me[0]),(Me[1]!==De[V+1]||V===we-2)&&(k[ee].push(Me[1]),ee++))}},_simplifyPoints:function(){for(var h=this._parts,k=this.options.smoothFactor,P=0,V=h.length;P<V;P++)h[P]=Fu(h[P],k)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(h,k){var P,V,ee,ue,we,Me,De=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(h))return!1;for(P=0,ue=this._parts.length;P<ue;P++)for(Me=this._parts[P],V=0,we=Me.length,ee=we-1;V<we;ee=V++)if(!(!k&&V===0)&&Tc(h,Me[ee],Me[V])<=De)return!0;return!1}});function Fh(h,k){return new Mi(h,k)}Mi._flat=xf;var Ta=Mi.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return $l(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(h){var k=Mi.prototype._convertLatLngs.call(this,h),P=k.length;return P>=2&&k[0]instanceof he&&k[0].equals(k[P-1])&&k.pop(),k},_setLatLngs:function(h){Mi.prototype._setLatLngs.call(this,h),Bi(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return Bi(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var h=this._renderer._bounds,k=this.options.weight,P=new Q(k,k);if(h=new Y(h.min.subtract(P),h.max.add(P)),this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(h))){if(this.options.noClip){this._parts=this._rings;return}for(var V=0,ee=this._rings.length,ue;V<ee;V++)ue=tn(this._rings[V],h,!0),ue.length&&this._parts.push(ue)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(h){var k=!1,P,V,ee,ue,we,Me,De,Ze;if(!this._pxBounds||!this._pxBounds.contains(h))return!1;for(ue=0,De=this._parts.length;ue<De;ue++)for(P=this._parts[ue],we=0,Ze=P.length,Me=Ze-1;we<Ze;Me=we++)V=P[we],ee=P[Me],V.y>h.y!=ee.y>h.y&&h.x<(ee.x-V.x)*(h.y-V.y)/(ee.y-V.y)+V.x&&(k=!k);return k||Mi.prototype._containsPoint.call(this,h,!0)}});function Xa(h,k){return new Ta(h,k)}var ta=ea.extend({initialize:function(h,k){S(this,k),this._layers={},h&&this.addData(h)},addData:function(h){var k=T(h)?h:h.features,P,V,ee;if(k){for(P=0,V=k.length;P<V;P++)ee=k[P],(ee.geometries||ee.geometry||ee.features||ee.coordinates)&&this.addData(ee);return this}var ue=this.options;if(ue.filter&&!ue.filter(h))return this;var we=gs(h,ue);return we?(we.feature=pl(h),we.defaultOptions=we.options,this.resetStyle(we),ue.onEachFeature&&ue.onEachFeature(h,we),this.addLayer(we)):this},resetStyle:function(h){return h===void 0?this.eachLayer(this.resetStyle,this):(h.options=i({},h.defaultOptions),this._setLayerStyle(h,this.options.style),this)},setStyle:function(h){return this.eachLayer(function(k){this._setLayerStyle(k,h)},this)},_setLayerStyle:function(h,k){h.setStyle&&(typeof k=="function"&&(k=k(h.feature)),h.setStyle(k))}});function gs(h,k){var P=h.type==="Feature"?h.geometry:h,V=P?P.coordinates:null,ee=[],ue=k&&k.pointToLayer,we=k&&k.coordsToLatLng||Ql,Me,De,Ze,kt;if(!V&&!P)return null;switch(P.type){case"Point":return Me=we(V),Na(ue,h,Me,k);case"MultiPoint":for(Ze=0,kt=V.length;Ze<kt;Ze++)Me=we(V[Ze]),ee.push(Na(ue,h,Me,k));return new ea(ee);case"LineString":case"MultiLineString":return De=Fs(V,P.type==="LineString"?0:1,we),new Mi(De,k);case"Polygon":case"MultiPolygon":return De=Fs(V,P.type==="Polygon"?1:2,we),new Ta(De,k);case"GeometryCollection":for(Ze=0,kt=P.geometries.length;Ze<kt;Ze++){var Yt=gs({geometry:P.geometries[Ze],type:"Feature",properties:h.properties},k);Yt&&ee.push(Yt)}return new ea(ee);case"FeatureCollection":for(Ze=0,kt=P.features.length;Ze<kt;Ze++){var fr=gs(P.features[Ze],k);fr&&ee.push(fr)}return new ea(ee);default:throw new Error("Invalid GeoJSON object.")}}function Na(h,k,P,V){return h?h(k,P):new Pi(P,V&&V.markersInheritOptions&&V)}function Ql(h){return new he(h[1],h[0],h[2])}function Fs(h,k,P){for(var V=[],ee=0,ue=h.length,we;ee<ue;ee++)we=k?Fs(h[ee],k-1,P):(P||Ql)(h[ee]),V.push(we);return V}function Bu(h,k){return h=xe(h),h.alt!==void 0?[p(h.lng,k),p(h.lat,k),p(h.alt,k)]:[p(h.lng,k),p(h.lat,k)]}function Jl(h,k,P,V){for(var ee=[],ue=0,we=h.length;ue<we;ue++)ee.push(k?Jl(h[ue],Bi(h[ue])?0:k-1,P,V):Bu(h[ue],V));return!k&&P&&ee.length>0&&ee.push(ee[0].slice()),ee}function Hr(h,k){return h.feature?i({},h.feature,{geometry:k}):pl(k)}function pl(h){return h.type==="Feature"||h.type==="FeatureCollection"?h:{type:"Feature",properties:{},geometry:h}}var zu={toGeoJSON:function(h){return Hr(this,{type:"Point",coordinates:Bu(this.getLatLng(),h)})}};Pi.include(zu),hl.include(zu),Ya.include(zu),Mi.include({toGeoJSON:function(h){var k=!Bi(this._latlngs),P=Jl(this._latlngs,k?1:0,!1,h);return Hr(this,{type:(k?"Multi":"")+"LineString",coordinates:P})}}),Ta.include({toGeoJSON:function(h){var k=!Bi(this._latlngs),P=k&&!Bi(this._latlngs[0]),V=Jl(this._latlngs,P?2:k?1:0,!0,h);return k||(V=[V]),Hr(this,{type:(P?"Multi":"")+"Polygon",coordinates:V})}}),js.include({toMultiPoint:function(h){var k=[];return this.eachLayer(function(P){k.push(P.toGeoJSON(h).geometry.coordinates)}),Hr(this,{type:"MultiPoint",coordinates:k})},toGeoJSON:function(h){var k=this.feature&&this.feature.geometry&&this.feature.geometry.type;if(k==="MultiPoint")return this.toMultiPoint(h);var P=k==="GeometryCollection",V=[];return this.eachLayer(function(ee){if(ee.toGeoJSON){var ue=ee.toGeoJSON(h);if(P)V.push(ue.geometry);else{var we=pl(ue);we.type==="FeatureCollection"?V.push.apply(V,we.features):V.push(we)}}}),P?Hr(this,{geometries:V,type:"GeometryCollection"}):{type:"FeatureCollection",features:V}}});function Oc(h,k){return new ta(h,k)}var ra=Oc,Bs=Ka.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(h,k,P){this._url=h,this._bounds=de(k),S(this,P)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(It(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){Mt(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(h){return this.options.opacity=h,this._image&&this._updateOpacity(),this},setStyle:function(h){return h.opacity&&this.setOpacity(h.opacity),this},bringToFront:function(){return this._map&&Pr(this._image),this},bringToBack:function(){return this._map&&Fr(this._image),this},setUrl:function(h){return this._url=h,this._image&&(this._image.src=h),this},setBounds:function(h){return this._bounds=de(h),this._map&&this._reset(),this},getEvents:function(){var h={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(h.zoomanim=this._animateZoom),h},setZIndex:function(h){return this.options.zIndex=h,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var h=this._url.tagName==="IMG",k=this._image=h?this._url:qe("img");if(It(k,"leaflet-image-layer"),this._zoomAnimated&&It(k,"leaflet-zoom-animated"),this.options.className&&It(k,this.options.className),k.onselectstart=f,k.onmousemove=f,k.onload=s(this.fire,this,"load"),k.onerror=s(this._overlayOnError,this,"error"),(this.options.crossOrigin||this.options.crossOrigin==="")&&(k.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),h){this._url=k.src;return}k.src=this._url,k.alt=this.options.alt},_animateZoom:function(h){var k=this._map.getZoomScale(h.zoom),P=this._map._latLngBoundsToNewLayerBounds(this._bounds,h.zoom,h.center).min;en(this._image,P,k)},_reset:function(){var h=this._image,k=new Y(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),P=k.getSize();yn(h,k.min),h.style.width=P.x+"px",h.style.height=P.y+"px"},_updateOpacity:function(){er(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var h=this.options.errorOverlayUrl;h&&this._url!==h&&(this._url=h,this._image.src=h)},getCenter:function(){return this._bounds.getCenter()}}),Po=function(h,k,P){return new Bs(h,k,P)},ln=Bs.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var h=this._url.tagName==="VIDEO",k=this._image=h?this._url:qe("video");if(It(k,"leaflet-image-layer"),this._zoomAnimated&&It(k,"leaflet-zoom-animated"),this.options.className&&It(k,this.options.className),k.onselectstart=f,k.onmousemove=f,k.onloadeddata=s(this.fire,this,"load"),h){for(var P=k.getElementsByTagName("source"),V=[],ee=0;ee<P.length;ee++)V.push(P[ee].src);this._url=P.length>0?V:[k.src];return}T(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(k.style,"objectFit")&&(k.style.objectFit="fill"),k.autoplay=!!this.options.autoplay,k.loop=!!this.options.loop,k.muted=!!this.options.muted,k.playsInline=!!this.options.playsInline;for(var ue=0;ue<this._url.length;ue++){var we=qe("source");we.src=this._url[ue],k.appendChild(we)}}});function zn(h,k,P){return new ln(h,k,P)}var Un=Bs.extend({_initImage:function(){var h=this._image=this._url;It(h,"leaflet-image-layer"),this._zoomAnimated&&It(h,"leaflet-zoom-animated"),this.options.className&&It(h,this.options.className),h.onselectstart=f,h.onmousemove=f}});function eu(h,k,P){return new Un(h,k,P)}var na=Ka.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(h,k){h&&(h instanceof he||T(h))?(this._latlng=xe(h),S(this,k)):(S(this,h),this._source=k),this.options.content&&(this._content=this.options.content)},openOn:function(h){return h=arguments.length?h:this._source._map,h.hasLayer(this)||h.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(h){return this._map?this.close():(arguments.length?this._source=h:h=this._source,this._prepareOpen(),this.openOn(h._map)),this},onAdd:function(h){this._zoomAnimated=h._zoomAnimated,this._container||this._initLayout(),h._fadeAnimated&&er(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),h._fadeAnimated&&er(this._container,1),this.bringToFront(),this.options.interactive&&(It(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(h){h._fadeAnimated?(er(this._container,0),this._removeTimeout=setTimeout(s(Mt,void 0,this._container),200)):Mt(this._container),this.options.interactive&&(Ir(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(h){return this._latlng=xe(h),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(h){return this._content=h,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var h={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(h.zoomanim=this._animateZoom),h},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&Pr(this._container),this},bringToBack:function(){return this._map&&Fr(this._container),this},_prepareOpen:function(h){var k=this._source;if(!k._map)return!1;if(k instanceof ea){k=null;var P=this._source._layers;for(var V in P)if(P[V]._map){k=P[V];break}if(!k)return!1;this._source=k}if(!h)if(k.getCenter)h=k.getCenter();else if(k.getLatLng)h=k.getLatLng();else if(k.getBounds)h=k.getBounds().getCenter();else throw new Error("Unable to get source layer LatLng.");return this.setLatLng(h),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var h=this._contentNode,k=typeof this._content=="function"?this._content(this._source||this):this._content;if(typeof k=="string")h.innerHTML=k;else{for(;h.hasChildNodes();)h.removeChild(h.firstChild);h.appendChild(k)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var h=this._map.latLngToLayerPoint(this._latlng),k=re(this.options.offset),P=this._getAnchor();this._zoomAnimated?yn(this._container,h.add(P)):k=k.add(h).add(P);var V=this._containerBottom=-k.y,ee=this._containerLeft=-Math.round(this._containerWidth/2)+k.x;this._container.style.bottom=V+"px",this._container.style.left=ee+"px"}},_getAnchor:function(){return[0,0]}});Cr.include({_initOverlay:function(h,k,P,V){var ee=k;return ee instanceof h||(ee=new h(V).setContent(k)),P&&ee.setLatLng(P),ee}}),Ka.include({_initOverlay:function(h,k,P,V){var ee=P;return ee instanceof h?(S(ee,V),ee._source=this):(ee=k&&!V?k:new h(V,this),ee.setContent(P)),ee}});var Mo=na.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(h){return h=arguments.length?h:this._source._map,!h.hasLayer(this)&&h._popup&&h._popup.options.autoClose&&h.removeLayer(h._popup),h._popup=this,na.prototype.openOn.call(this,h)},onAdd:function(h){na.prototype.onAdd.call(this,h),h.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof so||this._source.on("preclick",Os))},onRemove:function(h){na.prototype.onRemove.call(this,h),h.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof so||this._source.off("preclick",Os))},getEvents:function(){var h=na.prototype.getEvents.call(this);return(this.options.closeOnClick!==void 0?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(h.preclick=this.close),this.options.keepInView&&(h.moveend=this._adjustPan),h},_initLayout:function(){var h="leaflet-popup",k=this._container=qe("div",h+" "+(this.options.className||"")+" leaflet-zoom-animated"),P=this._wrapper=qe("div",h+"-content-wrapper",k);if(this._contentNode=qe("div",h+"-content",P),Ou(k),Hl(this._contentNode),sr(k,"contextmenu",Os),this._tipContainer=qe("div",h+"-tip-container",k),this._tip=qe("div",h+"-tip",this._tipContainer),this.options.closeButton){var V=this._closeButton=qe("a",h+"-close-button",k);V.setAttribute("role","button"),V.setAttribute("aria-label","Close popup"),V.href="#close",V.innerHTML='<span aria-hidden="true">&#215;</span>',sr(V,"click",function(ee){hn(ee),this.close()},this)}},_updateLayout:function(){var h=this._contentNode,k=h.style;k.width="",k.whiteSpace="nowrap";var P=h.offsetWidth;P=Math.min(P,this.options.maxWidth),P=Math.max(P,this.options.minWidth),k.width=P+1+"px",k.whiteSpace="",k.height="";var V=h.offsetHeight,ee=this.options.maxHeight,ue="leaflet-popup-scrolled";ee&&V>ee?(k.height=ee+"px",It(h,ue)):Ir(h,ue),this._containerWidth=this._container.offsetWidth},_animateZoom:function(h){var k=this._map._latLngToNewLayerPoint(this._latlng,h.zoom,h.center),P=this._getAnchor();yn(this._container,k.add(P))},_adjustPan:function(){if(this.options.autoPan){if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning){this._autopanning=!1;return}var h=this._map,k=parseInt(ot(this._container,"marginBottom"),10)||0,P=this._container.offsetHeight+k,V=this._containerWidth,ee=new Q(this._containerLeft,-P-this._containerBottom);ee._add(no(this._container));var ue=h.layerPointToContainerPoint(ee),we=re(this.options.autoPanPadding),Me=re(this.options.autoPanPaddingTopLeft||we),De=re(this.options.autoPanPaddingBottomRight||we),Ze=h.getSize(),kt=0,Yt=0;ue.x+V+De.x>Ze.x&&(kt=ue.x+V-Ze.x+De.x),ue.x-kt-Me.x<0&&(kt=ue.x-Me.x),ue.y+P+De.y>Ze.y&&(Yt=ue.y+P-Ze.y+De.y),ue.y-Yt-Me.y<0&&(Yt=ue.y-Me.y),(kt||Yt)&&(this.options.keepInView&&(this._autopanning=!0),h.fire("autopanstart").panBy([kt,Yt]))}},_getAnchor:function(){return re(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),tu=function(h,k){return new Mo(h,k)};Cr.mergeOptions({closePopupOnClick:!0}),Cr.include({openPopup:function(h,k,P){return this._initOverlay(Mo,h,k,P).openOn(this),this},closePopup:function(h){return h=arguments.length?h:this._popup,h&&h.close(),this}}),Ka.include({bindPopup:function(h,k){return this._popup=this._initOverlay(Mo,this._popup,h,k),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(h){return this._popup&&(this instanceof ea||(this._popup._source=this),this._popup._prepareOpen(h||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return this._popup?this._popup.isOpen():!1},setPopupContent:function(h){return this._popup&&this._popup.setContent(h),this},getPopup:function(){return this._popup},_openPopup:function(h){if(!(!this._popup||!this._map)){Fn(h);var k=h.layer||h.target;if(this._popup._source===k&&!(k instanceof so)){this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(h.latlng);return}this._popup._source=k,this.openPopup(h.latlng)}},_movePopup:function(h){this._popup.setLatLng(h.latlng)},_onKeyPress:function(h){h.originalEvent.keyCode===13&&this._openPopup(h)}});var An=na.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(h){na.prototype.onAdd.call(this,h),this.setOpacity(this.options.opacity),h.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(h){na.prototype.onRemove.call(this,h),h.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var h=na.prototype.getEvents.call(this);return this.options.permanent||(h.preclick=this.close),h},_initLayout:function(){var h="leaflet-tooltip",k=h+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=qe("div",k),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+l(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(h){var k,P,V=this._map,ee=this._container,ue=V.latLngToContainerPoint(V.getCenter()),we=V.layerPointToContainerPoint(h),Me=this.options.direction,De=ee.offsetWidth,Ze=ee.offsetHeight,kt=re(this.options.offset),Yt=this._getAnchor();Me==="top"?(k=De/2,P=Ze):Me==="bottom"?(k=De/2,P=0):Me==="center"?(k=De/2,P=Ze/2):Me==="right"?(k=0,P=Ze/2):Me==="left"?(k=De,P=Ze/2):we.x<ue.x?(Me="right",k=0,P=Ze/2):(Me="left",k=De+(kt.x+Yt.x)*2,P=Ze/2),h=h.subtract(re(k,P,!0)).add(kt).add(Yt),Ir(ee,"leaflet-tooltip-right"),Ir(ee,"leaflet-tooltip-left"),Ir(ee,"leaflet-tooltip-top"),Ir(ee,"leaflet-tooltip-bottom"),It(ee,"leaflet-tooltip-"+Me),yn(ee,h)},_updatePosition:function(){var h=this._map.latLngToLayerPoint(this._latlng);this._setPosition(h)},setOpacity:function(h){this.options.opacity=h,this._container&&er(this._container,h)},_animateZoom:function(h){var k=this._map._latLngToNewLayerPoint(this._latlng,h.zoom,h.center);this._setPosition(k)},_getAnchor:function(){return re(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),ml=function(h,k){return new An(h,k)};Cr.include({openTooltip:function(h,k,P){return this._initOverlay(An,h,k,P).openOn(this),this},closeTooltip:function(h){return h.close(),this}}),Ka.include({bindTooltip:function(h,k){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(An,this._tooltip,h,k),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(h){if(!(!h&&this._tooltipHandlersAdded)){var k=h?"off":"on",P={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?P.add=this._openTooltip:(P.mouseover=this._openTooltip,P.mouseout=this.closeTooltip,P.click=this._openTooltip,this._map?this._addFocusListeners():P.add=this._addFocusListeners),this._tooltip.options.sticky&&(P.mousemove=this._moveTooltip),this[k](P),this._tooltipHandlersAdded=!h}},openTooltip:function(h){return this._tooltip&&(this instanceof ea||(this._tooltip._source=this),this._tooltip._prepareOpen(h)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(h){return this._tooltip&&this._tooltip.setContent(h),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(h){var k=typeof h.getElement=="function"&&h.getElement();k&&(sr(k,"focus",function(){this._tooltip._source=h,this.openTooltip()},this),sr(k,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(h){var k=typeof h.getElement=="function"&&h.getElement();k&&k.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(h){if(!(!this._tooltip||!this._map)){if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var k=this;this._map.once("moveend",function(){k._openOnceFlag=!1,k._openTooltip(h)});return}this._tooltip._source=h.layer||h.target,this.openTooltip(this._tooltip.options.sticky?h.latlng:void 0)}},_moveTooltip:function(h){var k=h.latlng,P,V;this._tooltip.options.sticky&&h.originalEvent&&(P=this._map.mouseEventToContainerPoint(h.originalEvent),V=this._map.containerPointToLayerPoint(P),k=this._map.layerPointToLatLng(V)),this._tooltip.setLatLng(k)}});var ru=Ea.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(h){var k=h&&h.tagName==="DIV"?h:document.createElement("div"),P=this.options;if(P.html instanceof Element?(Nr(k),k.appendChild(P.html)):k.innerHTML=P.html!==!1?P.html:"",P.bgPos){var V=re(P.bgPos);k.style.backgroundPosition=-V.x+"px "+-V.y+"px"}return this._setIconStyles(k,"icon"),k},createShadow:function(){return null}});function Dc(h){return new ru(h)}Ea.Default=fl;var bi=Ka.extend({options:{tileSize:256,opacity:1,updateWhenIdle:St.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(h){S(this,h)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(h){h._addZoomLimit(this)},onRemove:function(h){this._removeAllTiles(),Mt(this._container),h._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(Pr(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(Fr(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(h){return this.options.opacity=h,this._updateOpacity(),this},setZIndex:function(h){return this.options.zIndex=h,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var h=this._clampZoom(this._map.getZoom());h!==this._tileZoom&&(this._tileZoom=h,this._updateLevels()),this._update()}return this},getEvents:function(){var h={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=u(this._onMoveEnd,this.options.updateInterval,this)),h.move=this._onMove),this._zoomAnimated&&(h.zoomanim=this._animateZoom),h},createTile:function(){return document.createElement("div")},getTileSize:function(){var h=this.options.tileSize;return h instanceof Q?h:new Q(h,h)},_updateZIndex:function(){this._container&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(h){for(var k=this.getPane().children,P=-h(-1/0,1/0),V=0,ee=k.length,ue;V<ee;V++)ue=k[V].style.zIndex,k[V]!==this._container&&ue&&(P=h(P,+ue));isFinite(P)&&(this.options.zIndex=P+h(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!St.ielt9){er(this._container,this.options.opacity);var h=+new Date,k=!1,P=!1;for(var V in this._tiles){var ee=this._tiles[V];if(!(!ee.current||!ee.loaded)){var ue=Math.min(1,(h-ee.loaded)/200);er(ee.el,ue),ue<1?k=!0:(ee.active?P=!0:this._onOpaqueTile(ee),ee.active=!0)}}P&&!this._noPrune&&this._pruneTiles(),k&&(K(this._fadeFrame),this._fadeFrame=G(this._updateOpacity,this))}},_onOpaqueTile:f,_initContainer:function(){this._container||(this._container=qe("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var h=this._tileZoom,k=this.options.maxZoom;if(h!==void 0){for(var P in this._levels)P=Number(P),this._levels[P].el.children.length||P===h?(this._levels[P].el.style.zIndex=k-Math.abs(h-P),this._onUpdateLevel(P)):(Mt(this._levels[P].el),this._removeTilesAtZoom(P),this._onRemoveLevel(P),delete this._levels[P]);var V=this._levels[h],ee=this._map;return V||(V=this._levels[h]={},V.el=qe("div","leaflet-tile-container leaflet-zoom-animated",this._container),V.el.style.zIndex=k,V.origin=ee.project(ee.unproject(ee.getPixelOrigin()),h).round(),V.zoom=h,this._setZoomTransform(V,ee.getCenter(),ee.getZoom()),f(V.el.offsetWidth),this._onCreateLevel(V)),this._level=V,V}},_onUpdateLevel:f,_onRemoveLevel:f,_onCreateLevel:f,_pruneTiles:function(){if(this._map){var h,k,P=this._map.getZoom();if(P>this.options.maxZoom||P<this.options.minZoom){this._removeAllTiles();return}for(h in this._tiles)k=this._tiles[h],k.retain=k.current;for(h in this._tiles)if(k=this._tiles[h],k.current&&!k.active){var V=k.coords;this._retainParent(V.x,V.y,V.z,V.z-5)||this._retainChildren(V.x,V.y,V.z,V.z+2)}for(h in this._tiles)this._tiles[h].retain||this._removeTile(h)}},_removeTilesAtZoom:function(h){for(var k in this._tiles)this._tiles[k].coords.z===h&&this._removeTile(k)},_removeAllTiles:function(){for(var h in this._tiles)this._removeTile(h)},_invalidateAll:function(){for(var h in this._levels)Mt(this._levels[h].el),this._onRemoveLevel(Number(h)),delete this._levels[h];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(h,k,P,V){var ee=Math.floor(h/2),ue=Math.floor(k/2),we=P-1,Me=new Q(+ee,+ue);Me.z=+we;var De=this._tileCoordsToKey(Me),Ze=this._tiles[De];return Ze&&Ze.active?(Ze.retain=!0,!0):(Ze&&Ze.loaded&&(Ze.retain=!0),we>V?this._retainParent(ee,ue,we,V):!1)},_retainChildren:function(h,k,P,V){for(var ee=2*h;ee<2*h+2;ee++)for(var ue=2*k;ue<2*k+2;ue++){var we=new Q(ee,ue);we.z=P+1;var Me=this._tileCoordsToKey(we),De=this._tiles[Me];if(De&&De.active){De.retain=!0;continue}else De&&De.loaded&&(De.retain=!0);P+1<V&&this._retainChildren(ee,ue,P+1,V)}},_resetView:function(h){var k=h&&(h.pinch||h.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),k,k)},_animateZoom:function(h){this._setView(h.center,h.zoom,!0,h.noUpdate)},_clampZoom:function(h){var k=this.options;return k.minNativeZoom!==void 0&&h<k.minNativeZoom?k.minNativeZoom:k.maxNativeZoom!==void 0&&k.maxNativeZoom<h?k.maxNativeZoom:h},_setView:function(h,k,P,V){var ee=Math.round(k);this.options.maxZoom!==void 0&&ee>this.options.maxZoom||this.options.minZoom!==void 0&&ee<this.options.minZoom?ee=void 0:ee=this._clampZoom(ee);var ue=this.options.updateWhenZooming&&ee!==this._tileZoom;(!V||ue)&&(this._tileZoom=ee,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),ee!==void 0&&this._update(h),P||this._pruneTiles(),this._noPrune=!!P),this._setZoomTransforms(h,k)},_setZoomTransforms:function(h,k){for(var P in this._levels)this._setZoomTransform(this._levels[P],h,k)},_setZoomTransform:function(h,k,P){var V=this._map.getZoomScale(P,h.zoom),ee=h.origin.multiplyBy(V).subtract(this._map._getNewPixelOrigin(k,P)).round();St.any3d?en(h.el,ee,V):yn(h.el,ee)},_resetGrid:function(){var h=this._map,k=h.options.crs,P=this._tileSize=this.getTileSize(),V=this._tileZoom,ee=this._map.getPixelWorldBounds(this._tileZoom);ee&&(this._globalTileRange=this._pxBoundsToTileRange(ee)),this._wrapX=k.wrapLng&&!this.options.noWrap&&[Math.floor(h.project([0,k.wrapLng[0]],V).x/P.x),Math.ceil(h.project([0,k.wrapLng[1]],V).x/P.y)],this._wrapY=k.wrapLat&&!this.options.noWrap&&[Math.floor(h.project([k.wrapLat[0],0],V).y/P.x),Math.ceil(h.project([k.wrapLat[1],0],V).y/P.y)]},_onMoveEnd:function(){!this._map||this._map._animatingZoom||this._update()},_getTiledPixelBounds:function(h){var k=this._map,P=k._animatingZoom?Math.max(k._animateToZoom,k.getZoom()):k.getZoom(),V=k.getZoomScale(P,this._tileZoom),ee=k.project(h,this._tileZoom).floor(),ue=k.getSize().divideBy(V*2);return new Y(ee.subtract(ue),ee.add(ue))},_update:function(h){var k=this._map;if(k){var P=this._clampZoom(k.getZoom());if(h===void 0&&(h=k.getCenter()),this._tileZoom!==void 0){var V=this._getTiledPixelBounds(h),ee=this._pxBoundsToTileRange(V),ue=ee.getCenter(),we=[],Me=this.options.keepBuffer,De=new Y(ee.getBottomLeft().subtract([Me,-Me]),ee.getTopRight().add([Me,-Me]));if(!(isFinite(ee.min.x)&&isFinite(ee.min.y)&&isFinite(ee.max.x)&&isFinite(ee.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var Ze in this._tiles){var kt=this._tiles[Ze].coords;(kt.z!==this._tileZoom||!De.contains(new Q(kt.x,kt.y)))&&(this._tiles[Ze].current=!1)}if(Math.abs(P-this._tileZoom)>1){this._setView(h,P);return}for(var Yt=ee.min.y;Yt<=ee.max.y;Yt++)for(var fr=ee.min.x;fr<=ee.max.x;fr++){var Zr=new Q(fr,Yt);if(Zr.z=this._tileZoom,!!this._isValidTile(Zr)){var Gn=this._tiles[this._tileCoordsToKey(Zr)];Gn?Gn.current=!0:we.push(Zr)}}if(we.sort(function(zi,yl){return zi.distanceTo(ue)-yl.distanceTo(ue)}),we.length!==0){this._loading||(this._loading=!0,this.fire("loading"));var Ai=document.createDocumentFragment();for(fr=0;fr<we.length;fr++)this._addTile(we[fr],Ai);this._level.el.appendChild(Ai)}}}},_isValidTile:function(h){var k=this._map.options.crs;if(!k.infinite){var P=this._globalTileRange;if(!k.wrapLng&&(h.x<P.min.x||h.x>P.max.x)||!k.wrapLat&&(h.y<P.min.y||h.y>P.max.y))return!1}if(!this.options.bounds)return!0;var V=this._tileCoordsToBounds(h);return de(this.options.bounds).overlaps(V)},_keyToBounds:function(h){return this._tileCoordsToBounds(this._keyToTileCoords(h))},_tileCoordsToNwSe:function(h){var k=this._map,P=this.getTileSize(),V=h.scaleBy(P),ee=V.add(P),ue=k.unproject(V,h.z),we=k.unproject(ee,h.z);return[ue,we]},_tileCoordsToBounds:function(h){var k=this._tileCoordsToNwSe(h),P=new ie(k[0],k[1]);return this.options.noWrap||(P=this._map.wrapLatLngBounds(P)),P},_tileCoordsToKey:function(h){return h.x+":"+h.y+":"+h.z},_keyToTileCoords:function(h){var k=h.split(":"),P=new Q(+k[0],+k[1]);return P.z=+k[2],P},_removeTile:function(h){var k=this._tiles[h];k&&(Mt(k.el),delete this._tiles[h],this.fire("tileunload",{tile:k.el,coords:this._keyToTileCoords(h)}))},_initTile:function(h){It(h,"leaflet-tile");var k=this.getTileSize();h.style.width=k.x+"px",h.style.height=k.y+"px",h.onselectstart=f,h.onmousemove=f,St.ielt9&&this.options.opacity<1&&er(h,this.options.opacity)},_addTile:function(h,k){var P=this._getTilePos(h),V=this._tileCoordsToKey(h),ee=this.createTile(this._wrapCoords(h),s(this._tileReady,this,h));this._initTile(ee),this.createTile.length<2&&G(s(this._tileReady,this,h,null,ee)),yn(ee,P),this._tiles[V]={el:ee,coords:h,current:!0},k.appendChild(ee),this.fire("tileloadstart",{tile:ee,coords:h})},_tileReady:function(h,k,P){k&&this.fire("tileerror",{error:k,tile:P,coords:h});var V=this._tileCoordsToKey(h);P=this._tiles[V],P&&(P.loaded=+new Date,this._map._fadeAnimated?(er(P.el,0),K(this._fadeFrame),this._fadeFrame=G(this._updateOpacity,this)):(P.active=!0,this._pruneTiles()),k||(It(P.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:P.el,coords:h})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),St.ielt9||!this._map._fadeAnimated?G(this._pruneTiles,this):setTimeout(s(this._pruneTiles,this),250)))},_getTilePos:function(h){return h.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(h){var k=new Q(this._wrapX?c(h.x,this._wrapX):h.x,this._wrapY?c(h.y,this._wrapY):h.y);return k.z=h.z,k},_pxBoundsToTileRange:function(h){var k=this.getTileSize();return new Y(h.min.unscaleBy(k).floor(),h.max.unscaleBy(k).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var h in this._tiles)if(!this._tiles[h].loaded)return!1;return!0}});function wi(h){return new bi(h)}var Qa=bi.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(h,k){this._url=h,k=S(this,k),k.detectRetina&&St.retina&&k.maxZoom>0?(k.tileSize=Math.floor(k.tileSize/2),k.zoomReverse?(k.zoomOffset--,k.minZoom=Math.min(k.maxZoom,k.minZoom+1)):(k.zoomOffset++,k.maxZoom=Math.max(k.minZoom,k.maxZoom-1)),k.minZoom=Math.max(0,k.minZoom)):k.zoomReverse?k.minZoom=Math.min(k.maxZoom,k.minZoom):k.maxZoom=Math.max(k.minZoom,k.maxZoom),typeof k.subdomains=="string"&&(k.subdomains=k.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(h,k){return this._url===h&&k===void 0&&(k=!0),this._url=h,k||this.redraw(),this},createTile:function(h,k){var P=document.createElement("img");return sr(P,"load",s(this._tileOnLoad,this,k,P)),sr(P,"error",s(this._tileOnError,this,k,P)),(this.options.crossOrigin||this.options.crossOrigin==="")&&(P.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),typeof this.options.referrerPolicy=="string"&&(P.referrerPolicy=this.options.referrerPolicy),P.alt="",P.src=this.getTileUrl(h),P},getTileUrl:function(h){var k={r:St.retina?"@2x":"",s:this._getSubdomain(h),x:h.x,y:h.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var P=this._globalTileRange.max.y-h.y;this.options.tms&&(k.y=P),k["-y"]=P}return _(this._url,i(k,this.options))},_tileOnLoad:function(h,k){St.ielt9?setTimeout(s(h,this,null,k),0):h(null,k)},_tileOnError:function(h,k,P){var V=this.options.errorTileUrl;V&&k.getAttribute("src")!==V&&(k.src=V),h(P,k)},_onTileRemove:function(h){h.tile.onload=null},_getZoomForUrl:function(){var h=this._tileZoom,k=this.options.maxZoom,P=this.options.zoomReverse,V=this.options.zoomOffset;return P&&(h=k-h),h+V},_getSubdomain:function(h){var k=Math.abs(h.x+h.y)%this.options.subdomains.length;return this.options.subdomains[k]},_abortLoading:function(){var h,k;for(h in this._tiles)if(this._tiles[h].coords.z!==this._tileZoom&&(k=this._tiles[h].el,k.onload=f,k.onerror=f,!k.complete)){k.src=R;var P=this._tiles[h].coords;Mt(k),delete this._tiles[h],this.fire("tileabort",{tile:k,coords:P})}},_removeTile:function(h){var k=this._tiles[h];if(k)return k.el.setAttribute("src",R),bi.prototype._removeTile.call(this,h)},_tileReady:function(h,k,P){if(!(!this._map||P&&P.getAttribute("src")===R))return bi.prototype._tileReady.call(this,h,k,P)}});function Uu(h,k){return new Qa(h,k)}var gl=Qa.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(h,k){this._url=h;var P=i({},this.defaultWmsParams);for(var V in k)V in this.options||(P[V]=k[V]);k=S(this,k);var ee=k.detectRetina&&St.retina?2:1,ue=this.getTileSize();P.width=ue.x*ee,P.height=ue.y*ee,this.wmsParams=P},onAdd:function(h){this._crs=this.options.crs||h.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var k=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[k]=this._crs.code,Qa.prototype.onAdd.call(this,h)},getTileUrl:function(h){var k=this._tileCoordsToNwSe(h),P=this._crs,V=J(P.project(k[0]),P.project(k[1])),ee=V.min,ue=V.max,we=(this._wmsVersion>=1.3&&this._crs===Rc?[ee.y,ee.x,ue.y,ue.x]:[ee.x,ee.y,ue.x,ue.y]).join(","),Me=Qa.prototype.getTileUrl.call(this,h);return Me+w(this.wmsParams,Me,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+we},setParams:function(h,k){return i(this.wmsParams,h),k||this.redraw(),this}});function kf(h,k){return new gl(h,k)}Qa.WMS=gl,Uu.wms=kf;var vs=Ka.extend({options:{padding:.1},initialize:function(h){S(this,h),l(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),It(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var h={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(h.zoomanim=this._onAnimZoom),h},_onAnimZoom:function(h){this._updateTransform(h.center,h.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(h,k){var P=this._map.getZoomScale(k,this._zoom),V=this._map.getSize().multiplyBy(.5+this.options.padding),ee=this._map.project(this._center,k),ue=V.multiplyBy(-P).add(ee).subtract(this._map._getNewPixelOrigin(h,k));St.any3d?en(this._container,ue,P):yn(this._container,ue)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var h in this._layers)this._layers[h]._reset()},_onZoomEnd:function(){for(var h in this._layers)this._layers[h]._project()},_updatePaths:function(){for(var h in this._layers)this._layers[h]._update()},_update:function(){var h=this.options.padding,k=this._map.getSize(),P=this._map.containerPointToLayerPoint(k.multiplyBy(-h)).round();this._bounds=new Y(P,P.add(k.multiplyBy(1+h*2)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),Ic=vs.extend({options:{tolerance:0},getEvents:function(){var h=vs.prototype.getEvents.call(this);return h.viewprereset=this._onViewPreReset,h},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){vs.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var h=this._container=document.createElement("canvas");sr(h,"mousemove",this._onMouseMove,this),sr(h,"click dblclick mousedown mouseup contextmenu",this._onClick,this),sr(h,"mouseout",this._handleMouseOut,this),h._leaflet_disable_events=!0,this._ctx=h.getContext("2d")},_destroyContainer:function(){K(this._redrawRequest),delete this._ctx,Mt(this._container),$r(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){var h;this._redrawBounds=null;for(var k in this._layers)h=this._layers[k],h._update();this._redraw()}},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){vs.prototype._update.call(this);var h=this._bounds,k=this._container,P=h.getSize(),V=St.retina?2:1;yn(k,h.min),k.width=V*P.x,k.height=V*P.y,k.style.width=P.x+"px",k.style.height=P.y+"px",St.retina&&this._ctx.scale(2,2),this._ctx.translate(-h.min.x,-h.min.y),this.fire("update")}},_reset:function(){vs.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(h){this._updateDashArray(h),this._layers[l(h)]=h;var k=h._order={layer:h,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=k),this._drawLast=k,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(h){this._requestRedraw(h)},_removePath:function(h){var k=h._order,P=k.next,V=k.prev;P?P.prev=V:this._drawLast=V,V?V.next=P:this._drawFirst=P,delete h._order,delete this._layers[l(h)],this._requestRedraw(h)},_updatePath:function(h){this._extendRedrawBounds(h),h._project(),h._update(),this._requestRedraw(h)},_updateStyle:function(h){this._updateDashArray(h),this._requestRedraw(h)},_updateDashArray:function(h){if(typeof h.options.dashArray=="string"){var k=h.options.dashArray.split(/[, ]+/),P=[],V,ee;for(ee=0;ee<k.length;ee++){if(V=Number(k[ee]),isNaN(V))return;P.push(V)}h.options._dashArray=P}else h.options._dashArray=h.options.dashArray},_requestRedraw:function(h){this._map&&(this._extendRedrawBounds(h),this._redrawRequest=this._redrawRequest||G(this._redraw,this))},_extendRedrawBounds:function(h){if(h._pxBounds){var k=(h.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new Y,this._redrawBounds.extend(h._pxBounds.min.subtract([k,k])),this._redrawBounds.extend(h._pxBounds.max.add([k,k]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var h=this._redrawBounds;if(h){var k=h.getSize();this._ctx.clearRect(h.min.x,h.min.y,k.x,k.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var h,k=this._redrawBounds;if(this._ctx.save(),k){var P=k.getSize();this._ctx.beginPath(),this._ctx.rect(k.min.x,k.min.y,P.x,P.y),this._ctx.clip()}this._drawing=!0;for(var V=this._drawFirst;V;V=V.next)h=V.layer,(!k||h._pxBounds&&h._pxBounds.intersects(k))&&h._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(h,k){if(this._drawing){var P,V,ee,ue,we=h._parts,Me=we.length,De=this._ctx;if(Me){for(De.beginPath(),P=0;P<Me;P++){for(V=0,ee=we[P].length;V<ee;V++)ue=we[P][V],De[V?"lineTo":"moveTo"](ue.x,ue.y);k&&De.closePath()}this._fillStroke(De,h)}}},_updateCircle:function(h){if(!(!this._drawing||h._empty())){var k=h._point,P=this._ctx,V=Math.max(Math.round(h._radius),1),ee=(Math.max(Math.round(h._radiusY),1)||V)/V;ee!==1&&(P.save(),P.scale(1,ee)),P.beginPath(),P.arc(k.x,k.y/ee,V,0,Math.PI*2,!1),ee!==1&&P.restore(),this._fillStroke(P,h)}},_fillStroke:function(h,k){var P=k.options;P.fill&&(h.globalAlpha=P.fillOpacity,h.fillStyle=P.fillColor||P.color,h.fill(P.fillRule||"evenodd")),P.stroke&&P.weight!==0&&(h.setLineDash&&h.setLineDash(k.options&&k.options._dashArray||[]),h.globalAlpha=P.opacity,h.lineWidth=P.weight,h.strokeStyle=P.color,h.lineCap=P.lineCap,h.lineJoin=P.lineJoin,h.stroke())},_onClick:function(h){for(var k=this._map.mouseEventToLayerPoint(h),P,V,ee=this._drawFirst;ee;ee=ee.next)P=ee.layer,P.options.interactive&&P._containsPoint(k)&&(!(h.type==="click"||h.type==="preclick")||!this._map._draggableMoved(P))&&(V=P);this._fireEvent(V?[V]:!1,h)},_onMouseMove:function(h){if(!(!this._map||this._map.dragging.moving()||this._map._animatingZoom)){var k=this._map.mouseEventToLayerPoint(h);this._handleMouseHover(h,k)}},_handleMouseOut:function(h){var k=this._hoveredLayer;k&&(Ir(this._container,"leaflet-interactive"),this._fireEvent([k],h,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(h,k){if(!this._mouseHoverThrottled){for(var P,V,ee=this._drawFirst;ee;ee=ee.next)P=ee.layer,P.options.interactive&&P._containsPoint(k)&&(V=P);V!==this._hoveredLayer&&(this._handleMouseOut(h),V&&(It(this._container,"leaflet-interactive"),this._fireEvent([V],h,"mouseover"),this._hoveredLayer=V)),this._fireEvent(this._hoveredLayer?[this._hoveredLayer]:!1,h),this._mouseHoverThrottled=!0,setTimeout(s(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(h,k,P){this._map._fireDOMEvent(k,P||k.type,h)},_bringToFront:function(h){var k=h._order;if(k){var P=k.next,V=k.prev;if(P)P.prev=V;else return;V?V.next=P:P&&(this._drawFirst=P),k.prev=this._drawLast,this._drawLast.next=k,k.next=null,this._drawLast=k,this._requestRedraw(h)}},_bringToBack:function(h){var k=h._order;if(k){var P=k.next,V=k.prev;if(V)V.next=P;else return;P?P.prev=V:V&&(this._drawLast=V),k.prev=null,k.next=this._drawFirst,this._drawFirst.prev=k,this._drawFirst=k,this._requestRedraw(h)}}});function jc(h){return St.canvas?new Ic(h):null}var vl=(function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(h){return document.createElement("<lvml:"+h+' class="lvml">')}}catch{}return function(h){return document.createElement("<"+h+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}})(),_f={_initContainer:function(){this._container=qe("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(vs.prototype._update.call(this),this.fire("update"))},_initPath:function(h){var k=h._container=vl("shape");It(k,"leaflet-vml-shape "+(this.options.className||"")),k.coordsize="1 1",h._path=vl("path"),k.appendChild(h._path),this._updateStyle(h),this._layers[l(h)]=h},_addPath:function(h){var k=h._container;this._container.appendChild(k),h.options.interactive&&h.addInteractiveTarget(k)},_removePath:function(h){var k=h._container;Mt(k),h.removeInteractiveTarget(k),delete this._layers[l(h)]},_updateStyle:function(h){var k=h._stroke,P=h._fill,V=h.options,ee=h._container;ee.stroked=!!V.stroke,ee.filled=!!V.fill,V.stroke?(k||(k=h._stroke=vl("stroke")),ee.appendChild(k),k.weight=V.weight+"px",k.color=V.color,k.opacity=V.opacity,V.dashArray?k.dashStyle=T(V.dashArray)?V.dashArray.join(" "):V.dashArray.replace(/( *, *)/g," "):k.dashStyle="",k.endcap=V.lineCap.replace("butt","flat"),k.joinstyle=V.lineJoin):k&&(ee.removeChild(k),h._stroke=null),V.fill?(P||(P=h._fill=vl("fill")),ee.appendChild(P),P.color=V.fillColor||V.color,P.opacity=V.fillOpacity):P&&(ee.removeChild(P),h._fill=null)},_updateCircle:function(h){var k=h._point.round(),P=Math.round(h._radius),V=Math.round(h._radiusY||P);this._setPath(h,h._empty()?"M0 0":"AL "+k.x+","+k.y+" "+P+","+V+" 0,"+65535*360)},_setPath:function(h,k){h._path.v=k},_bringToFront:function(h){Pr(h._container)},_bringToBack:function(h){Fr(h._container)}},Ja=St.vml?vl:Oe,Ao=vs.extend({_initContainer:function(){this._container=Ja("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=Ja("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){Mt(this._container),$r(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){vs.prototype._update.call(this);var h=this._bounds,k=h.getSize(),P=this._container;(!this._svgSize||!this._svgSize.equals(k))&&(this._svgSize=k,P.setAttribute("width",k.x),P.setAttribute("height",k.y)),yn(P,h.min),P.setAttribute("viewBox",[h.min.x,h.min.y,k.x,k.y].join(" ")),this.fire("update")}},_initPath:function(h){var k=h._path=Ja("path");h.options.className&&It(k,h.options.className),h.options.interactive&&It(k,"leaflet-interactive"),this._updateStyle(h),this._layers[l(h)]=h},_addPath:function(h){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(h._path),h.addInteractiveTarget(h._path)},_removePath:function(h){Mt(h._path),h.removeInteractiveTarget(h._path),delete this._layers[l(h)]},_updatePath:function(h){h._project(),h._update()},_updateStyle:function(h){var k=h._path,P=h.options;k&&(P.stroke?(k.setAttribute("stroke",P.color),k.setAttribute("stroke-opacity",P.opacity),k.setAttribute("stroke-width",P.weight),k.setAttribute("stroke-linecap",P.lineCap),k.setAttribute("stroke-linejoin",P.lineJoin),P.dashArray?k.setAttribute("stroke-dasharray",P.dashArray):k.removeAttribute("stroke-dasharray"),P.dashOffset?k.setAttribute("stroke-dashoffset",P.dashOffset):k.removeAttribute("stroke-dashoffset")):k.setAttribute("stroke","none"),P.fill?(k.setAttribute("fill",P.fillColor||P.color),k.setAttribute("fill-opacity",P.fillOpacity),k.setAttribute("fill-rule",P.fillRule||"evenodd")):k.setAttribute("fill","none"))},_updatePoly:function(h,k){this._setPath(h,mt(h._parts,k))},_updateCircle:function(h){var k=h._point,P=Math.max(Math.round(h._radius),1),V=Math.max(Math.round(h._radiusY),1)||P,ee="a"+P+","+V+" 0 1,0 ",ue=h._empty()?"M0 0":"M"+(k.x-P)+","+k.y+ee+P*2+",0 "+ee+-P*2+",0 ";this._setPath(h,ue)},_setPath:function(h,k){h._path.setAttribute("d",k)},_bringToFront:function(h){Pr(h._path)},_bringToBack:function(h){Fr(h._path)}});St.vml&&Ao.include(_f);function Ro(h){return St.svg||St.vml?new Ao(h):null}Cr.include({getRenderer:function(h){var k=h.options.renderer||this._getPaneRenderer(h.options.pane)||this.options.renderer||this._renderer;return k||(k=this._renderer=this._createRenderer()),this.hasLayer(k)||this.addLayer(k),k},_getPaneRenderer:function(h){if(h==="overlayPane"||h===void 0)return!1;var k=this._paneRenderers[h];return k===void 0&&(k=this._createRenderer({pane:h}),this._paneRenderers[h]=k),k},_createRenderer:function(h){return this.options.preferCanvas&&jc(h)||Ro(h)}});var Cf=Ta.extend({initialize:function(h,k){Ta.prototype.initialize.call(this,this._boundsToLatLngs(h),k)},setBounds:function(h){return this.setLatLngs(this._boundsToLatLngs(h))},_boundsToLatLngs:function(h){return h=de(h),[h.getSouthWest(),h.getNorthWest(),h.getNorthEast(),h.getSouthEast()]}});function Fc(h,k){return new Cf(h,k)}Ao.create=Ja,Ao.pointsToPath=mt,ta.geometryToLayer=gs,ta.coordsToLatLng=Ql,ta.coordsToLatLngs=Fs,ta.latLngToCoords=Bu,ta.latLngsToCoords=Jl,ta.getFeature=Hr,ta.asFeature=pl,Cr.mergeOptions({boxZoom:!0});var lo=Ji.extend({initialize:function(h){this._map=h,this._container=h._container,this._pane=h._panes.overlayPane,this._resetStateTimeout=0,h.on("unload",this._destroy,this)},addHooks:function(){sr(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){$r(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){Mt(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){this._resetStateTimeout!==0&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(h){if(!h.shiftKey||h.which!==1&&h.button!==1)return!1;this._clearDeferredResetState(),this._resetState(),xr(),Cc(),this._startPoint=this._map.mouseEventToContainerPoint(h),sr(document,{contextmenu:Fn,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(h){this._moved||(this._moved=!0,this._box=qe("div","leaflet-zoom-box",this._container),It(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(h);var k=new Y(this._point,this._startPoint),P=k.getSize();yn(this._box,k.min),this._box.style.width=P.x+"px",this._box.style.height=P.y+"px"},_finish:function(){this._moved&&(Mt(this._box),Ir(this._container,"leaflet-crosshair")),io(),Ec(),$r(document,{contextmenu:Fn,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(h){if(!(h.which!==1&&h.button!==1)&&(this._finish(),!!this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(s(this._resetState,this),0);var k=new ie(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(k).fire("boxzoomend",{boxZoomBounds:k})}},_onKeyDown:function(h){h.keyCode===27&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});Cr.addInitHook("addHandler","boxZoom",lo),Cr.mergeOptions({doubleClickZoom:!0});var Ef=Ji.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(h){var k=this._map,P=k.getZoom(),V=k.options.zoomDelta,ee=h.originalEvent.shiftKey?P-V:P+V;k.options.doubleClickZoom==="center"?k.setZoom(ee):k.setZoomAround(h.containerPoint,ee)}});Cr.addInitHook("addHandler","doubleClickZoom",Ef),Cr.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var Gu=Ji.extend({addHooks:function(){if(!this._draggable){var h=this._map;this._draggable=new _n(h._mapPane,h._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),h.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),h.on("zoomend",this._onZoomEnd,this),h.whenReady(this._onZoomEnd,this))}It(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){Ir(this._map._container,"leaflet-grab"),Ir(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var h=this._map;if(h._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var k=de(this._map.options.maxBounds);this._offsetLimit=J(this._map.latLngToContainerPoint(k.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(k.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;h.fire("movestart").fire("dragstart"),h.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(h){if(this._map.options.inertia){var k=this._lastTime=+new Date,P=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(P),this._times.push(k),this._prunePositions(k)}this._map.fire("move",h).fire("drag",h)},_prunePositions:function(h){for(;this._positions.length>1&&h-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var h=this._map.getSize().divideBy(2),k=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=k.subtract(h).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(h,k){return h-(h-k)*this._viscosity},_onPreDragLimit:function(){if(!(!this._viscosity||!this._offsetLimit)){var h=this._draggable._newPos.subtract(this._draggable._startPos),k=this._offsetLimit;h.x<k.min.x&&(h.x=this._viscousLimit(h.x,k.min.x)),h.y<k.min.y&&(h.y=this._viscousLimit(h.y,k.min.y)),h.x>k.max.x&&(h.x=this._viscousLimit(h.x,k.max.x)),h.y>k.max.y&&(h.y=this._viscousLimit(h.y,k.max.y)),this._draggable._newPos=this._draggable._startPos.add(h)}},_onPreDragWrap:function(){var h=this._worldWidth,k=Math.round(h/2),P=this._initialWorldOffset,V=this._draggable._newPos.x,ee=(V-k+P)%h+k-P,ue=(V+k+P)%h-k-P,we=Math.abs(ee+P)<Math.abs(ue+P)?ee:ue;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=we},_onDragEnd:function(h){var k=this._map,P=k.options,V=!P.inertia||h.noInertia||this._times.length<2;if(k.fire("dragend",h),V)k.fire("moveend");else{this._prunePositions(+new Date);var ee=this._lastPos.subtract(this._positions[0]),ue=(this._lastTime-this._times[0])/1e3,we=P.easeLinearity,Me=ee.multiplyBy(we/ue),De=Me.distanceTo([0,0]),Ze=Math.min(P.inertiaMaxSpeed,De),kt=Me.multiplyBy(Ze/De),Yt=Ze/(P.inertiaDeceleration*we),fr=kt.multiplyBy(-Yt/2).round();!fr.x&&!fr.y?k.fire("moveend"):(fr=k._limitOffset(fr,k.options.maxBounds),G(function(){k.panBy(fr,{duration:Yt,easeLinearity:we,noMoveStart:!0,animate:!0})}))}}});Cr.addInitHook("addHandler","dragging",Gu),Cr.mergeOptions({keyboard:!0,keyboardPanDelta:80});var Bc=Ji.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(h){this._map=h,this._setPanDelta(h.options.keyboardPanDelta),this._setZoomDelta(h.options.zoomDelta)},addHooks:function(){var h=this._map._container;h.tabIndex<=0&&(h.tabIndex="0"),sr(h,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),$r(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var h=document.body,k=document.documentElement,P=h.scrollTop||k.scrollTop,V=h.scrollLeft||k.scrollLeft;this._map._container.focus(),window.scrollTo(V,P)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(h){var k=this._panKeys={},P=this.keyCodes,V,ee;for(V=0,ee=P.left.length;V<ee;V++)k[P.left[V]]=[-1*h,0];for(V=0,ee=P.right.length;V<ee;V++)k[P.right[V]]=[h,0];for(V=0,ee=P.down.length;V<ee;V++)k[P.down[V]]=[0,h];for(V=0,ee=P.up.length;V<ee;V++)k[P.up[V]]=[0,-1*h]},_setZoomDelta:function(h){var k=this._zoomKeys={},P=this.keyCodes,V,ee;for(V=0,ee=P.zoomIn.length;V<ee;V++)k[P.zoomIn[V]]=h;for(V=0,ee=P.zoomOut.length;V<ee;V++)k[P.zoomOut[V]]=-h},_addHooks:function(){sr(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){$r(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(h){if(!(h.altKey||h.ctrlKey||h.metaKey)){var k=h.keyCode,P=this._map,V;if(k in this._panKeys){if(!P._panAnim||!P._panAnim._inProgress)if(V=this._panKeys[k],h.shiftKey&&(V=re(V).multiplyBy(3)),P.options.maxBounds&&(V=P._limitOffset(re(V),P.options.maxBounds)),P.options.worldCopyJump){var ee=P.wrapLatLng(P.unproject(P.project(P.getCenter()).add(V)));P.panTo(ee)}else P.panBy(V)}else if(k in this._zoomKeys)P.setZoom(P.getZoom()+(h.shiftKey?3:1)*this._zoomKeys[k]);else if(k===27&&P._popup&&P._popup.options.closeOnEscapeKey)P.closePopup();else return;Fn(h)}}});Cr.addInitHook("addHandler","keyboard",Bc),Cr.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var Kr=Ji.extend({addHooks:function(){sr(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){$r(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(h){var k=Ds(h),P=this._map.options.wheelDebounceTime;this._delta+=k,this._lastMousePos=this._map.mouseEventToContainerPoint(h),this._startTime||(this._startTime=+new Date);var V=Math.max(P-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(s(this._performZoom,this),V),Fn(h)},_performZoom:function(){var h=this._map,k=h.getZoom(),P=this._map.options.zoomSnap||0;h._stop();var V=this._delta/(this._map.options.wheelPxPerZoomLevel*4),ee=4*Math.log(2/(1+Math.exp(-Math.abs(V))))/Math.LN2,ue=P?Math.ceil(ee/P)*P:ee,we=h._limitZoom(k+(this._delta>0?ue:-ue))-k;this._delta=0,this._startTime=null,we&&(h.options.scrollWheelZoom==="center"?h.setZoom(k+we):h.setZoomAround(this._lastMousePos,k+we))}});Cr.addInitHook("addHandler","scrollWheelZoom",Kr);var zc=600;Cr.mergeOptions({tapHold:St.touchNative&&St.safari&&St.mobile,tapTolerance:15});var nu=Ji.extend({addHooks:function(){sr(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){$r(this._map._container,"touchstart",this._onDown,this)},_onDown:function(h){if(clearTimeout(this._holdTimeout),h.touches.length===1){var k=h.touches[0];this._startPos=this._newPos=new Q(k.clientX,k.clientY),this._holdTimeout=setTimeout(s(function(){this._cancel(),this._isTapValid()&&(sr(document,"touchend",hn),sr(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",k))},this),zc),sr(document,"touchend touchcancel contextmenu",this._cancel,this),sr(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function h(){$r(document,"touchend",hn),$r(document,"touchend touchcancel",h)},_cancel:function(){clearTimeout(this._holdTimeout),$r(document,"touchend touchcancel contextmenu",this._cancel,this),$r(document,"touchmove",this._onMove,this)},_onMove:function(h){var k=h.touches[0];this._newPos=new Q(k.clientX,k.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(h,k){var P=new MouseEvent(h,{bubbles:!0,cancelable:!0,view:window,screenX:k.screenX,screenY:k.screenY,clientX:k.clientX,clientY:k.clientY});P._simulated=!0,k.target.dispatchEvent(P)}});Cr.addInitHook("addHandler","tapHold",nu),Cr.mergeOptions({touchZoom:St.touch,bounceAtZoomLimits:!0});var Lo=Ji.extend({addHooks:function(){It(this._map._container,"leaflet-touch-zoom"),sr(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){Ir(this._map._container,"leaflet-touch-zoom"),$r(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(h){var k=this._map;if(!(!h.touches||h.touches.length!==2||k._animatingZoom||this._zooming)){var P=k.mouseEventToContainerPoint(h.touches[0]),V=k.mouseEventToContainerPoint(h.touches[1]);this._centerPoint=k.getSize()._divideBy(2),this._startLatLng=k.containerPointToLatLng(this._centerPoint),k.options.touchZoom!=="center"&&(this._pinchStartLatLng=k.containerPointToLatLng(P.add(V)._divideBy(2))),this._startDist=P.distanceTo(V),this._startZoom=k.getZoom(),this._moved=!1,this._zooming=!0,k._stop(),sr(document,"touchmove",this._onTouchMove,this),sr(document,"touchend touchcancel",this._onTouchEnd,this),hn(h)}},_onTouchMove:function(h){if(!(!h.touches||h.touches.length!==2||!this._zooming)){var k=this._map,P=k.mouseEventToContainerPoint(h.touches[0]),V=k.mouseEventToContainerPoint(h.touches[1]),ee=P.distanceTo(V)/this._startDist;if(this._zoom=k.getScaleZoom(ee,this._startZoom),!k.options.bounceAtZoomLimits&&(this._zoom<k.getMinZoom()&&ee<1||this._zoom>k.getMaxZoom()&&ee>1)&&(this._zoom=k._limitZoom(this._zoom)),k.options.touchZoom==="center"){if(this._center=this._startLatLng,ee===1)return}else{var ue=P._add(V)._divideBy(2)._subtract(this._centerPoint);if(ee===1&&ue.x===0&&ue.y===0)return;this._center=k.unproject(k.project(this._pinchStartLatLng,this._zoom).subtract(ue),this._zoom)}this._moved||(k._moveStart(!0,!1),this._moved=!0),K(this._animRequest);var we=s(k._move,k,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=G(we,this,!0),hn(h)}},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=!1;return}this._zooming=!1,K(this._animRequest),$r(document,"touchmove",this._onTouchMove,this),$r(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))}});Cr.addInitHook("addHandler","touchZoom",Lo),Cr.BoxZoom=lo,Cr.DoubleClickZoom=Ef,Cr.Drag=Gu,Cr.Keyboard=Bc,Cr.ScrollWheelZoom=Kr,Cr.TapHold=nu,Cr.TouchZoom=Lo,r.Bounds=Y,r.Browser=St,r.CRS=le,r.Canvas=Ic,r.Circle=hl,r.CircleMarker=Ya,r.Class=W,r.Control=ii,r.DivIcon=ru,r.DivOverlay=na,r.DomEvent=Wl,r.DomUtil=br,r.Draggable=_n,r.Evented=Z,r.FeatureGroup=ea,r.GeoJSON=ta,r.GridLayer=bi,r.Handler=Ji,r.Icon=Ea,r.ImageOverlay=Bs,r.LatLng=he,r.LatLngBounds=ie,r.Layer=Ka,r.LayerGroup=js,r.LineUtil=cl,r.Map=Cr,r.Marker=Pi,r.Mixin=ju,r.Path=so,r.Point=Q,r.PolyUtil=Dh,r.Polygon=Ta,r.Polyline=Mi,r.Popup=Mo,r.PosAnimation=Iu,r.Projection=Ac,r.Rectangle=Cf,r.Renderer=vs,r.SVG=Ao,r.SVGOverlay=Un,r.TileLayer=Qa,r.Tooltip=An,r.Transformation=se,r.Util=O,r.VideoOverlay=ln,r.bind=s,r.bounds=J,r.canvas=jc,r.circle=Xl,r.circleMarker=oo,r.control=wa,r.divIcon=Dc,r.extend=i,r.featureGroup=Ca,r.geoJSON=Oc,r.geoJson=ra,r.gridLayer=wi,r.icon=Lc,r.imageOverlay=Po,r.latLng=xe,r.latLngBounds=de,r.layerGroup=dl,r.map=yi,r.marker=Sf,r.point=re,r.polygon=Xa,r.polyline=Fh,r.popup=tu,r.rectangle=Fc,r.setOptions=S,r.stamp=l,r.svg=Ro,r.svgOverlay=eu,r.tileLayer=Uu,r.tooltip=ml,r.transformation=ye,r.version=n,r.videoOverlay=zn;var Tf=window.L;r.noConflict=function(){return window.L=Tf,this},window.L=r}))})(Kg,Kg.exports)),Kg.exports}var Vd=bH();const G1=Th(Vd);function T_(t,e,r){return Object.freeze({instance:t,context:e,container:r})}function BR(t,e){return e==null?function(n,i){const a=ae.useRef();return a.current||(a.current=t(n,i)),a}:function(n,i){const a=ae.useRef();a.current||(a.current=t(n,i));const s=ae.useRef(n),{instance:o}=a.current;return ae.useEffect(function(){s.current!==n&&(e(o,n,s.current),s.current=n)},[o,n,i]),a}}function wH(t,e){ae.useEffect(function(){return(e.layerContainer??e.map).addLayer(t.instance),function(){e.layerContainer?.removeLayer(t.instance),e.map.removeLayer(t.instance)}},[e,t])}function SH(t){return function(r){const n=E_(),i=t(FR(r,n),n);return LR(n.map,r.attribution),jR(i.current,r.eventHandlers),wH(i.current,n),i}}function zR(t,e){const r=BR(t,e),n=SH(r);return gH(n)}function kH(t,e){const r=BR(t),n=yH(r,e);return vH(n)}function _H(t,e,r){e.bounds instanceof Vd.LatLngBounds&&e.bounds!==r.bounds&&t.setBounds(e.bounds),e.opacity!=null&&e.opacity!==r.opacity&&t.setOpacity(e.opacity),e.zIndex!=null&&e.zIndex!==r.zIndex&&t.setZIndex(e.zIndex)}function CH(){return E_().map}const EH=zR(function({bounds:e,url:r,...n},i){const a=new Vd.ImageOverlay(r,e,n);return T_(a,OR(i,{overlayContainer:a}))},function(e,r,n){if(_H(e,r,n),r.bounds!==n.bounds){const i=r.bounds instanceof Vd.LatLngBounds?r.bounds:new Vd.LatLngBounds(r.bounds);e.setBounds(i)}r.url!==n.url&&e.setUrl(r.url)});function tk(){return tk=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},tk.apply(this,arguments)}function TH({bounds:t,boundsOptions:e,center:r,children:n,className:i,id:a,placeholder:s,style:o,whenReady:l,zoom:u,...c},f){const[p]=ae.useState({className:i,id:a,style:o}),[v,y]=ae.useState(null);ae.useImperativeHandle(f,()=>v?.map??null,[v]);const S=ae.useCallback(E=>{if(E!==null&&v===null){const _=new Vd.Map(E,c);r!=null&&u!=null?_.setView(r,u):t!=null&&_.fitBounds(t,e),l!=null&&_.whenReady(l),y(mH(_))}},[]);ae.useEffect(()=>()=>{v?.map.remove()},[v]);const w=v?nr.createElement(IR,{value:v},n):s??null;return nr.createElement("div",tk({},p,{ref:S}),w)}const NH=ae.forwardRef(TH),PH=zR(function({position:e,...r},n){const i=new Vd.Marker(e,r);return T_(i,OR(n,{overlayContainer:i}))},function(e,r,n){r.position!==n.position&&e.setLatLng(r.position),r.icon!=null&&r.icon!==n.icon&&e.setIcon(r.icon),r.zIndexOffset!=null&&r.zIndexOffset!==n.zIndexOffset&&e.setZIndexOffset(r.zIndexOffset),r.opacity!=null&&r.opacity!==n.opacity&&e.setOpacity(r.opacity),e.dragging!=null&&r.draggable!==n.draggable&&(r.draggable===!0?e.dragging.enable():e.dragging.disable())}),MH=kH(function(e,r){const n=new Vd.Popup(e,r.overlayContainer);return T_(n,r)},function(e,r,{position:n},i){ae.useEffect(function(){const{instance:s}=e;function o(u){u.popup===s&&(s.update(),i(!0))}function l(u){u.popup===s&&i(!1)}return r.map.on({popupopen:o,popupclose:l}),r.overlayContainer==null?(n!=null&&s.setLatLng(n),s.openOn(r.map)):r.overlayContainer.bindPopup(s),function(){r.map.off({popupopen:o,popupclose:l}),r.overlayContainer?.unbindPopup(),r.map.removeLayer(s)}},[e,r,i,n])});delete G1.Icon.Default.prototype._getIconUrl;G1.Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png"});const AH=(t="default")=>{const e=`
        <div class="custom-marker-icon marker-${t}">
            <span class="material-symbols-outlined" style="font-size: 18px; color: white;">
                ${RH(t)}
            </span>
        </div>
    `;return G1.divIcon({html:e,className:"custom-leaflet-marker",iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-32]})},RH=t=>{const e={city:"location_city",dungeon:"castle",landmark:"place",battle:"swords",default:"location_on"};return e[t]||e.default},LH=({bounds:t})=>{const e=CH();return nr.useEffect(()=>{t&&e.fitBounds(t)},[e,t]),null},OH=({mapImage:t,markers:e=[],onMarkerClick:r,imageWidth:n=1920,imageHeight:i=1080})=>{const a=ae.useMemo(()=>[[0,0],[i,n]],[n,i]),s=ae.useMemo(()=>[i/2,n/2],[n,i]),o=e.length>0?e:[];return m.jsxs("div",{className:"w-full h-full relative",children:[m.jsxs(NH,{center:s,zoom:0,minZoom:-2,maxZoom:3,crs:G1.CRS.Simple,style:{height:"100%",width:"100%",background:"#0a0a0c"},zoomControl:!0,attributionControl:!1,children:[t&&m.jsx(EH,{url:t,bounds:a,opacity:1}),m.jsx(LH,{bounds:a}),o.map((l,u)=>{const c=l.position||[i/2,n/2];return m.jsx(PH,{position:c,icon:AH(l.type),eventHandlers:{click:()=>{r&&r(l)}},children:m.jsx(MH,{children:m.jsxs("div",{className:"space-y-2",children:[m.jsx("h3",{className:"text-white font-bold",children:l.label||"Unnamed Location"}),l.description&&m.jsx("p",{className:"text-slate-400 text-sm",children:l.description}),l.entityId&&m.jsxs("a",{href:`#/entity/${l.entityId}`,className:"text-primary hover:underline text-sm inline-flex items-center gap-1",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"open_in_new"}),"View Details"]})]})})},l.id||u)})]}),o.length>0&&m.jsxs("div",{className:"absolute bottom-4 left-4 bg-surface-dark/90 backdrop-blur-xl border border-white/10 rounded-2xl p-4 max-w-xs z-[1000]",children:[m.jsxs("h4",{className:"text-white font-bold text-sm mb-2 flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-primary",children:"map"}),"Locations (",o.length,")"]}),m.jsxs("div",{className:"space-y-1 max-h-40 overflow-y-auto no-scrollbar",children:[o.slice(0,10).map((l,u)=>m.jsxs("div",{className:"text-xs text-slate-400 flex items-center gap-2 hover:text-white cursor-pointer transition-colors",onClick:()=>r&&r(l),children:[m.jsx("span",{className:"w-2 h-2 rounded-full bg-primary"}),l.label||`Location ${u+1}`]},l.id||u)),o.length>10&&m.jsxs("p",{className:"text-xs text-slate-500 italic",children:["+",o.length-10," more..."]})]})]})]})},DH=({map:t})=>{const{t:e}=Ps(),[r,n]=ae.useState(null),{setRightPanelContent:i,setRightOpen:a}=nl(),s=t?.nombre||e("maps.explorer"),o=t?.attributes||{};let l={};if(!o.bgImage&&t?.descripcion&&t?.descripcion.startsWith("{"))try{l=JSON.parse(t.descripcion)}catch{}let u=o.bgImage||l.bgImage||t?.iconUrl||null;u&&(u.toLowerCase().includes("duckdns")||u.toLowerCase().includes("nopreview"))&&(u=null);const c=o.markers||[],f=o.imageWidth||1920,p=o.imageHeight||1080;ae.useEffect(()=>{r?(i(m.jsxs("div",{className:"flex flex-col h-full gap-8 p-6 animate-in slide-in-from-right-4 duration-300",children:[m.jsxs("header",{className:"space-y-6",children:[m.jsxs("div",{className:"relative aspect-[4/3] rounded-3xl overflow-hidden border border-white/10 shadow-xl group",children:[m.jsx("img",{src:"https://images.unsplash.com/photo-1533154683836-84ea7a0bc310?auto=format&fit=crop&w=500&q=80",alt:"Detail",className:"w-full h-full object-cover grayscale-[0.4] group-hover:grayscale-0 transition-all duration-700"}),m.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-background-dark via-transparent to-transparent"}),m.jsx("div",{className:"absolute top-4 right-4 flex gap-2",children:m.jsx("button",{onClick:()=>n(null),className:"size-8 rounded-lg bg-black/40 border border-white/10 backdrop-blur-md text-white flex items-center justify-center hover:bg-black/60 transition-colors",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"close"})})}),m.jsx("div",{className:"absolute bottom-4 left-4 flex gap-2",children:m.jsx("span",{className:"px-3 py-1 rounded bg-primary/20 text-primary border border-primary/20 text-[8px] font-black uppercase tracking-widest backdrop-blur-md",children:e("maps.place")})})]}),m.jsxs("div",{children:[m.jsx("h2",{className:"text-3xl font-black text-white leading-none mb-2",children:r.label||"Ubicacin Desconocida"}),m.jsx("p",{className:"text-slate-500 font-medium text-sm leading-relaxed",children:r.description||"Sin descripcin disponible."})]})]}),m.jsx("div",{className:"space-y-8 flex-1 overflow-y-auto no-scrollbar",children:m.jsxs("section",{className:"space-y-4",children:[m.jsxs("div",{className:"flex justify-between items-center px-1",children:[m.jsx("h3",{className:"text-[10px] font-black uppercase tracking-[0.2em] text-slate-500",children:e("maps.inhabitants")}),m.jsx("button",{className:"text-[10px] font-bold text-primary hover:underline transition-all",children:e("maps.view_all")})]}),m.jsx("div",{className:"space-y-3",children:m.jsx(IH,{name:"Personaje A",role:"Rol A"})})]})})]})),a(!0)):i(m.jsxs("div",{className:"p-6 text-slate-500 text-center flex flex-col items-center justify-center h-full",children:[m.jsx("span",{className:"material-symbols-outlined text-6xl mb-4 opacity-20",children:"map"}),m.jsx("h3",{className:"text-white font-bold mb-2 text-xl",children:s}),m.jsx("p",{className:"text-sm max-w-[200px]",children:"Selecciona un marcador en el mapa para ver sus detalles aqu."})]}))},[r,t]),ae.useEffect(()=>()=>{i(null),a(!1)},[]);const v=y=>{n(y),a(!0)};return m.jsx("div",{className:"flex-1 flex overflow-hidden bg-background-dark font-sans text-slate-300 relative",children:m.jsxs("main",{className:"flex-1 overflow-hidden relative group",children:[m.jsx("div",{className:"absolute inset-4 rounded-[2.5rem] overflow-hidden border border-white/5 shadow-2xl bg-surface-dark",children:u?m.jsx(OH,{mapImage:u,markers:c,onMarkerClick:v,imageWidth:f,imageHeight:p}):m.jsx("div",{className:"w-full h-full flex items-center justify-center text-slate-500",children:m.jsxs("div",{className:"text-center space-y-4",children:[m.jsx("span",{className:"material-symbols-outlined text-6xl opacity-20",children:"map"}),m.jsx("p",{children:e("maps.not_found")}),m.jsx("p",{className:"text-xs text-slate-600",children:e("maps.upload_desc")})]})})}),m.jsx("div",{className:"absolute top-8 left-8 z-[1000]",children:m.jsx(ti,{className:"px-6 py-3 border-white/10",children:m.jsxs("h1",{className:"text-2xl font-black text-white tracking-tight flex items-center gap-3",children:[m.jsx("span",{className:"material-symbols-outlined text-primary",children:"public"}),s]})})}),m.jsx("div",{className:"absolute top-8 right-8 z-[1000] flex gap-3",children:m.jsx("button",{onClick:()=>a(y=>!y),className:"size-12 rounded-xl bg-surface-dark/90 backdrop-blur-xl border border-white/10 flex items-center justify-center text-slate-400 hover:text-white hover:border-primary/50 transition-all shadow-lg",title:"Toggle Panel",children:m.jsx("span",{className:"material-symbols-outlined",children:"side_navigation"})})})]})})},IH=({name:t,role:e})=>m.jsxs("div",{className:"flex items-center gap-4 p-3 rounded-2xl bg-white/[0.02] border border-white/5 hover:border-white/10 transition-all cursor-pointer group",children:[m.jsx(rx,{name:t,size:"sm",className:"border-white/10 group-hover:border-primary/50 transition-all"}),m.jsxs("div",{className:"flex-1 min-w-0",children:[m.jsx("h4",{className:"text-xs font-bold text-white truncate",children:t}),m.jsx("p",{className:"text-[10px] text-slate-500 font-medium truncate",children:e})]}),m.jsx("span",{className:"material-symbols-outlined text-slate-700 text-sm group-hover:text-white transition-colors",children:"chevron_right"})]}),jH=({maps:t,onSelectMap:e,onCreateMap:r,onDeleteMap:n})=>{const{t:i}=Ps(),[a,s]=ae.useState(""),o=t.filter(u=>u.nombre.toLowerCase().includes(a.toLowerCase())),l=u=>{let c=u.attributes?.snapshotUrl||u.attributes?.bgImage||u.iconUrl;return c&&(c.toLowerCase().includes("duckdns")||c.toLowerCase().includes("nopreview"))?null:c};return m.jsx("div",{className:"flex-1 p-8 overflow-y-auto bg-background-dark",children:m.jsxs("div",{className:"max-w-7xl mx-auto space-y-8",children:[m.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-end gap-4 animate-in fade-in slide-in-from-top-4 duration-500",children:[m.jsxs("div",{children:[m.jsxs("h1",{className:"text-3xl font-black text-white uppercase tracking-tight flex items-center gap-3",children:[m.jsx("span",{className:"material-symbols-outlined text-primary text-4xl",children:"travel_explore"}),i("nav.atlas")||"Atlas"]}),m.jsx("p",{className:"text-sm text-slate-400 mt-2 max-w-xl",children:"Explora los territorios cartografiados de tu mundo. Gestiona mapas regionales, calabozos y planos astrales desde este centro de comando."})]}),m.jsxs("div",{className:"flex items-center gap-4 w-full md:w-auto",children:[m.jsxs("div",{className:"relative flex-1 md:w-64",children:[m.jsx("span",{className:"material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-slate-500",children:"search"}),m.jsx("input",{type:"text",placeholder:"Buscar mapas...",value:a,onChange:u=>s(u.target.value),className:"w-full bg-black/30 border border-white/10 rounded-xl pl-10 pr-4 py-3 text-sm text-white focus:border-primary outline-none transition-all"})]}),m.jsx(Dn,{variant:"primary",icon:"add_location_alt",onClick:r,children:i("common.create")||"Nuevo Mapa"})]})]}),o.length===0?m.jsxs("div",{className:"flex flex-col items-center justify-center p-20 border-2 border-dashed border-white/5 rounded-3xl bg-white/[0.01] animate-in zoom-in-95 duration-500",children:[m.jsx("div",{className:"size-20 rounded-full bg-white/5 flex items-center justify-center mb-6",children:m.jsx("span",{className:"material-symbols-outlined text-4xl text-slate-600",children:"map"})}),m.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"No hay mapas visibles"}),m.jsx("p",{className:"text-slate-500 mb-6 text-center max-w-md",children:"No se encontraron mapas con los filtros actuales. Comienza creando tu primer territorio."}),m.jsx(Dn,{variant:"secondary",icon:"add",onClick:r,children:"Crear Primer Mapa"})]}):m.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 animate-in fade-in duration-700",children:o.map((u,c)=>{const f=l(u),p=u.attributes?.layers?.length||0,v=u.attributes?.markers?.length||0;return m.jsxs(ti,{className:"group relative overflow-hidden border-white/5 hover:border-primary/50 transition-all duration-300 hover:-translate-y-1 cursor-pointer",onClick:()=>e(u),children:[m.jsxs("div",{className:"aspect-[16/9] w-full bg-black/50 relative overflow-hidden border-b border-white/5",children:[f?m.jsx("img",{src:f,alt:u.nombre,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-700"}):m.jsxs("div",{className:"w-full h-full flex items-center justify-center bg-surface-light",children:[m.jsx("span",{className:"material-symbols-outlined text-4xl text-white/10 group-hover:text-primary/50 transition-colors",children:"public"}),m.jsx("div",{className:"absolute inset-0 opacity-10 pointer-events-none",style:{backgroundImage:"radial-gradient(#fff 1px, transparent 1px)",backgroundSize:"20px 20px"}})]}),m.jsx("div",{className:"absolute top-2 right-2 flex gap-1 transform translate-y-[-150%] group-hover:translate-y-0 transition-transform duration-300",children:n&&m.jsx("button",{onClick:y=>{y.stopPropagation(),n(u)},className:"p-2 bg-black/60 hover:bg-red-500 text-white rounded-lg backdrop-blur-sm transition-colors",title:"Eliminar Mapa",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})})})]}),m.jsxs("div",{className:"p-5",children:[m.jsxs("div",{className:"flex justify-between items-start mb-2",children:[m.jsx("h3",{className:"font-bold text-white text-lg truncate pr-2 group-hover:text-primary transition-colors",children:u.nombre}),m.jsx("span",{className:"shrink-0 text-[10px] font-black uppercase tracking-widest bg-white/5 text-slate-400 px-2 py-1 rounded",children:u.attributes?.mapType||"Regional"})]}),m.jsxs("div",{className:"flex items-center gap-4 text-xs text-slate-500 font-medium mt-4",children:[m.jsxs("div",{className:"flex items-center gap-1.5",title:"Capas",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"layers"}),p]}),m.jsxs("div",{className:"flex items-center gap-1.5",title:"Marcadores",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"location_on"}),v]}),m.jsxs("div",{className:"flex-1 text-right text-[10px] uppercase tracking-wider opacity-50",children:["ID: ",u.id]})]})]})]},u.id)})})]})})},FH=()=>{const{username:t,projectName:e}=qi(),r=Va(),[n,i]=ae.useState("manager"),[a,s]=ae.useState([]),[o,l]=ae.useState(null),[u,c]=ae.useState(null);nr.useEffect(()=>{f()},[]);const f=async()=>{try{const y=(await et.get("/world-bible/entities")).filter(S=>S.tipoEspecial==="map");s(y)}catch(v){console.error("Error loading maps",v)}},p=async(v,y,S)=>{try{const w=await et.get("/world-bible/folders"),E=w.find(T=>T.nombre.toLowerCase().includes("map"))||w[0];if(!E){console.error("No folders available to create map");return}const _=await et.post("/world-bible/entities",{nombre:y,carpetaId:E.id,tipoEspecial:"map",categoria:"Location",descripcion:"",iconUrl:"",attributes:{mapType:"regional",layers:[]}});c(_.id),i("wizard"),await f(),setTimeout(()=>{i("editor")},100)}catch(w){console.error("Error creating map:",w)}};return m.jsxs("div",{className:"flex-1 flex flex-col h-full bg-background-dark overflow-hidden",children:[n==="manager"&&m.jsx(jH,{maps:a,onSelectMap:v=>{l(v),i("viewer")},onCreateMap:()=>i("wizard"),onDeleteMap:async v=>{confirm(`Eliminar mapa "${v.nombre}"?`)&&(await et.delete(`/world-bible/entities/${v.id}`),f())}}),n==="viewer"&&o&&m.jsxs("div",{className:"flex-1 flex flex-col h-full relative",children:[m.jsx("div",{className:"absolute top-4 left-4 z-[1001]",children:m.jsxs("button",{onClick:()=>i("manager"),className:"bg-black/60 hover:bg-black/80 text-white backdrop-blur-md px-4 py-2 rounded-xl flex items-center gap-2 border border-white/10 transition-all font-bold text-sm",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"arrow_back"}),"Volver al Atlas"]})}),m.jsx(DH,{map:o})]}),n==="wizard"&&m.jsx(pG,{onCancel:()=>i((a.length>0,"manager")),onCreate:p}),n==="editor"&&m.jsx(ek,{mode:u?"create":"edit",entityId:u,onBack:()=>{i("manager"),c(null)},onSave:async()=>{await f(),u?r(`/local/${e}/entity/${u}`):i("manager"),c(null)}})]})};String.prototype.codePointAt||(function(){var t=(function(){try{var r={},n=Object.defineProperty,i=n(r,r,r)&&n}catch{}return i})(),e=function(r){if(this==null)throw TypeError();var n=String(this),i=n.length,a=r?Number(r):0;if(a!=a&&(a=0),!(a<0||a>=i)){var s=n.charCodeAt(a),o;return s>=55296&&s<=56319&&i>a+1&&(o=n.charCodeAt(a+1),o>=56320&&o<=57343)?(s-55296)*1024+o-56320+65536:s}};t?t(String.prototype,"codePointAt",{value:e,configurable:!0,writable:!0}):String.prototype.codePointAt=e})();function UR(){this.table=new Uint16Array(16),this.trans=new Uint16Array(288)}var BH=new UR,zH=new UR,GR=new Uint8Array(30),VR=new Uint16Array(30),UH=new Uint8Array(30),GH=new Uint16Array(30);function HR(t,e,r,n){var i,a;for(i=0;i<r;++i)t[i]=0;for(i=0;i<30-r;++i)t[i+r]=i/r|0;for(a=n,i=0;i<30;++i)e[i]=a,a+=1<<t[i]}function VH(t,e){var r;for(r=0;r<7;++r)t.table[r]=0;for(t.table[7]=24,t.table[8]=152,t.table[9]=112,r=0;r<24;++r)t.trans[r]=256+r;for(r=0;r<144;++r)t.trans[24+r]=r;for(r=0;r<8;++r)t.trans[168+r]=280+r;for(r=0;r<112;++r)t.trans[176+r]=144+r;for(r=0;r<5;++r)e.table[r]=0;for(e.table[5]=32,r=0;r<32;++r)e.trans[r]=r}VH(BH,zH);HR(GR,VR,4,3);HR(UH,GH,2,1);GR[28]=0;VR[28]=258;function Sp(t,e,r,n,i){return Math.pow(1-i,3)*t+3*Math.pow(1-i,2)*i*e+3*(1-i)*Math.pow(i,2)*r+Math.pow(i,3)*n}function ff(){this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN}ff.prototype.isEmpty=function(){return isNaN(this.x1)||isNaN(this.y1)||isNaN(this.x2)||isNaN(this.y2)};ff.prototype.addPoint=function(t,e){typeof t=="number"&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=t,this.x2=t),t<this.x1&&(this.x1=t),t>this.x2&&(this.x2=t)),typeof e=="number"&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=e,this.y2=e),e<this.y1&&(this.y1=e),e>this.y2&&(this.y2=e))};ff.prototype.addX=function(t){this.addPoint(t,null)};ff.prototype.addY=function(t){this.addPoint(null,t)};ff.prototype.addBezier=function(t,e,r,n,i,a,s,o){var l=[t,e],u=[r,n],c=[i,a],f=[s,o];this.addPoint(t,e),this.addPoint(s,o);for(var p=0;p<=1;p++){var v=6*l[p]-12*u[p]+6*c[p],y=-3*l[p]+9*u[p]-9*c[p]+3*f[p],S=3*u[p]-3*l[p];if(y===0){if(v===0)continue;var w=-S/v;0<w&&w<1&&(p===0&&this.addX(Sp(l[p],u[p],c[p],f[p],w)),p===1&&this.addY(Sp(l[p],u[p],c[p],f[p],w)));continue}var E=Math.pow(v,2)-4*S*y;if(!(E<0)){var _=(-v+Math.sqrt(E))/(2*y);0<_&&_<1&&(p===0&&this.addX(Sp(l[p],u[p],c[p],f[p],_)),p===1&&this.addY(Sp(l[p],u[p],c[p],f[p],_)));var T=(-v-Math.sqrt(E))/(2*y);0<T&&T<1&&(p===0&&this.addX(Sp(l[p],u[p],c[p],f[p],T)),p===1&&this.addY(Sp(l[p],u[p],c[p],f[p],T)))}}};ff.prototype.addQuad=function(t,e,r,n,i,a){var s=t+.6666666666666666*(r-t),o=e+2/3*(n-e),l=s+1/3*(i-t),u=o+1/3*(a-e);this.addBezier(t,e,s,o,l,u,i,a)};function Ki(){this.commands=[],this.fill="black",this.stroke=null,this.strokeWidth=1}Ki.prototype.moveTo=function(t,e){this.commands.push({type:"M",x:t,y:e})};Ki.prototype.lineTo=function(t,e){this.commands.push({type:"L",x:t,y:e})};Ki.prototype.curveTo=Ki.prototype.bezierCurveTo=function(t,e,r,n,i,a){this.commands.push({type:"C",x1:t,y1:e,x2:r,y2:n,x:i,y:a})};Ki.prototype.quadTo=Ki.prototype.quadraticCurveTo=function(t,e,r,n){this.commands.push({type:"Q",x1:t,y1:e,x:r,y:n})};Ki.prototype.close=Ki.prototype.closePath=function(){this.commands.push({type:"Z"})};Ki.prototype.extend=function(t){if(t.commands)t=t.commands;else if(t instanceof ff){var e=t;this.moveTo(e.x1,e.y1),this.lineTo(e.x2,e.y1),this.lineTo(e.x2,e.y2),this.lineTo(e.x1,e.y2),this.close();return}Array.prototype.push.apply(this.commands,t)};Ki.prototype.getBoundingBox=function(){for(var t=new ff,e=0,r=0,n=0,i=0,a=0;a<this.commands.length;a++){var s=this.commands[a];switch(s.type){case"M":t.addPoint(s.x,s.y),e=n=s.x,r=i=s.y;break;case"L":t.addPoint(s.x,s.y),n=s.x,i=s.y;break;case"Q":t.addQuad(n,i,s.x1,s.y1,s.x,s.y),n=s.x,i=s.y;break;case"C":t.addBezier(n,i,s.x1,s.y1,s.x2,s.y2,s.x,s.y),n=s.x,i=s.y;break;case"Z":n=e,i=r;break;default:throw new Error("Unexpected path command "+s.type)}}return t.isEmpty()&&t.addPoint(0,0),t};Ki.prototype.draw=function(t){t.beginPath();for(var e=0;e<this.commands.length;e+=1){var r=this.commands[e];r.type==="M"?t.moveTo(r.x,r.y):r.type==="L"?t.lineTo(r.x,r.y):r.type==="C"?t.bezierCurveTo(r.x1,r.y1,r.x2,r.y2,r.x,r.y):r.type==="Q"?t.quadraticCurveTo(r.x1,r.y1,r.x,r.y):r.type==="Z"&&t.closePath()}this.fill&&(t.fillStyle=this.fill,t.fill()),this.stroke&&(t.strokeStyle=this.stroke,t.lineWidth=this.strokeWidth,t.stroke())};Ki.prototype.toPathData=function(t){t=t!==void 0?t:2;function e(s){return Math.round(s)===s?""+Math.round(s):s.toFixed(t)}function r(){for(var s=arguments,o="",l=0;l<arguments.length;l+=1){var u=s[l];u>=0&&l>0&&(o+=" "),o+=e(u)}return o}for(var n="",i=0;i<this.commands.length;i+=1){var a=this.commands[i];a.type==="M"?n+="M"+r(a.x,a.y):a.type==="L"?n+="L"+r(a.x,a.y):a.type==="C"?n+="C"+r(a.x1,a.y1,a.x2,a.y2,a.x,a.y):a.type==="Q"?n+="Q"+r(a.x1,a.y1,a.x,a.y):a.type==="Z"&&(n+="Z")}return n};Ki.prototype.toSVG=function(t){var e='<path d="';return e+=this.toPathData(t),e+='"',this.fill&&this.fill!=="black"&&(this.fill===null?e+=' fill="none"':e+=' fill="'+this.fill+'"'),this.stroke&&(e+=' stroke="'+this.stroke+'" stroke-width="'+this.strokeWidth+'"'),e+="/>",e};Ki.prototype.toDOMElement=function(t){var e=this.toPathData(t),r=document.createElementNS("http://www.w3.org/2000/svg","path");return r.setAttribute("d",e),r};function WR(t){throw new Error(t)}function S4(t,e){t||WR(e)}var pr={fail:WR,argument:S4,assert:S4},k4=32768,_4=2147483648,Kp={},_t={},lr={};function zl(t){return function(){return t}}_t.BYTE=function(t){return pr.argument(t>=0&&t<=255,"Byte value should be between 0 and 255."),[t]};lr.BYTE=zl(1);_t.CHAR=function(t){return[t.charCodeAt(0)]};lr.CHAR=zl(1);_t.CHARARRAY=function(t){typeof t>"u"&&(t="",console.warn("Undefined CHARARRAY encountered and treated as an empty string. This is probably caused by a missing glyph name."));for(var e=[],r=0;r<t.length;r+=1)e[r]=t.charCodeAt(r);return e};lr.CHARARRAY=function(t){return typeof t>"u"?0:t.length};_t.USHORT=function(t){return[t>>8&255,t&255]};lr.USHORT=zl(2);_t.SHORT=function(t){return t>=k4&&(t=-(2*k4-t)),[t>>8&255,t&255]};lr.SHORT=zl(2);_t.UINT24=function(t){return[t>>16&255,t>>8&255,t&255]};lr.UINT24=zl(3);_t.ULONG=function(t){return[t>>24&255,t>>16&255,t>>8&255,t&255]};lr.ULONG=zl(4);_t.LONG=function(t){return t>=_4&&(t=-(2*_4-t)),[t>>24&255,t>>16&255,t>>8&255,t&255]};lr.LONG=zl(4);_t.FIXED=_t.ULONG;lr.FIXED=lr.ULONG;_t.FWORD=_t.SHORT;lr.FWORD=lr.SHORT;_t.UFWORD=_t.USHORT;lr.UFWORD=lr.USHORT;_t.LONGDATETIME=function(t){return[0,0,0,0,t>>24&255,t>>16&255,t>>8&255,t&255]};lr.LONGDATETIME=zl(8);_t.TAG=function(t){return pr.argument(t.length===4,"Tag should be exactly 4 ASCII characters."),[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]};lr.TAG=zl(4);_t.Card8=_t.BYTE;lr.Card8=lr.BYTE;_t.Card16=_t.USHORT;lr.Card16=lr.USHORT;_t.OffSize=_t.BYTE;lr.OffSize=lr.BYTE;_t.SID=_t.USHORT;lr.SID=lr.USHORT;_t.NUMBER=function(t){return t>=-107&&t<=107?[t+139]:t>=108&&t<=1131?(t=t-108,[(t>>8)+247,t&255]):t>=-1131&&t<=-108?(t=-t-108,[(t>>8)+251,t&255]):t>=-32768&&t<=32767?_t.NUMBER16(t):_t.NUMBER32(t)};lr.NUMBER=function(t){return _t.NUMBER(t).length};_t.NUMBER16=function(t){return[28,t>>8&255,t&255]};lr.NUMBER16=zl(3);_t.NUMBER32=function(t){return[29,t>>24&255,t>>16&255,t>>8&255,t&255]};lr.NUMBER32=zl(5);_t.REAL=function(t){var e=t.toString(),r=/\.(\d*?)(?:9{5,20}|0{5,20})\d{0,2}(?:e(.+)|$)/.exec(e);if(r){var n=parseFloat("1e"+((r[2]?+r[2]:0)+r[1].length));e=(Math.round(t*n)/n).toString()}for(var i="",a=0,s=e.length;a<s;a+=1){var o=e[a];o==="e"?i+=e[++a]==="-"?"c":"b":o==="."?i+="a":o==="-"?i+="e":i+=o}i+=i.length&1?"f":"ff";for(var l=[30],u=0,c=i.length;u<c;u+=2)l.push(parseInt(i.substr(u,2),16));return l};lr.REAL=function(t){return _t.REAL(t).length};_t.NAME=_t.CHARARRAY;lr.NAME=lr.CHARARRAY;_t.STRING=_t.CHARARRAY;lr.STRING=lr.CHARARRAY;Kp.UTF8=function(t,e,r){for(var n=[],i=r,a=0;a<i;a++,e+=1)n[a]=t.getUint8(e);return String.fromCharCode.apply(null,n)};Kp.UTF16=function(t,e,r){for(var n=[],i=r/2,a=0;a<i;a++,e+=2)n[a]=t.getUint16(e);return String.fromCharCode.apply(null,n)};_t.UTF16=function(t){for(var e=[],r=0;r<t.length;r+=1){var n=t.charCodeAt(r);e[e.length]=n>>8&255,e[e.length]=n&255}return e};lr.UTF16=function(t){return t.length*2};var rk={"x-mac-croatian":"","x-mac-cyrillic":"","x-mac-gaelic":"","x-mac-greek":"","x-mac-icelandic":"","x-mac-inuit":"","x-mac-ce":"",macintosh:"","x-mac-romanian":"","x-mac-turkish":""};Kp.MACSTRING=function(t,e,r,n){var i=rk[n];if(i!==void 0){for(var a="",s=0;s<r;s++){var o=t.getUint8(e+s);o<=127?a+=String.fromCharCode(o):a+=i[o&127]}return a}};var py=typeof WeakMap=="function"&&new WeakMap,my,HH=function(t){if(!my){my={};for(var e in rk)my[e]=new String(e)}var r=my[t];if(r!==void 0){if(py){var n=py.get(r);if(n!==void 0)return n}var i=rk[t];if(i!==void 0){for(var a={},s=0;s<i.length;s++)a[i.charCodeAt(s)]=s+128;return py&&py.set(r,a),a}}};_t.MACSTRING=function(t,e){var r=HH(e);if(r!==void 0){for(var n=[],i=0;i<t.length;i++){var a=t.charCodeAt(i);if(a>=128&&(a=r[a],a===void 0))return;n[i]=a}return n}};lr.MACSTRING=function(t,e){var r=_t.MACSTRING(t,e);return r!==void 0?r.length:0};function nk(t){return t>=-128&&t<=127}function WH(t,e,r){for(var n=0,i=t.length;e<i&&n<64&&t[e]===0;)++e,++n;return r.push(128|n-1),e}function qH(t,e,r){for(var n=0,i=t.length,a=e;a<i&&n<64;){var s=t[a];if(!nk(s)||s===0&&a+1<i&&t[a+1]===0)break;++a,++n}r.push(n-1);for(var o=e;o<a;++o)r.push(t[o]+256&255);return a}function $H(t,e,r){for(var n=0,i=t.length,a=e;a<i&&n<64;){var s=t[a];if(s===0||nk(s)&&a+1<i&&nk(t[a+1]))break;++a,++n}r.push(64|n-1);for(var o=e;o<a;++o){var l=t[o];r.push(l+65536>>8&255,l+256&255)}return a}_t.VARDELTAS=function(t){for(var e=0,r=[];e<t.length;){var n=t[e];n===0?e=WH(t,e,r):n>=-128&&n<=127?e=qH(t,e,r):e=$H(t,e,r)}return r};_t.INDEX=function(t){for(var e=1,r=[e],n=[],i=0;i<t.length;i+=1){var a=_t.OBJECT(t[i]);Array.prototype.push.apply(n,a),e+=a.length,r.push(e)}if(n.length===0)return[0,0];for(var s=[],o=1+Math.floor(Math.log(e)/Math.log(2))/8|0,l=[void 0,_t.BYTE,_t.USHORT,_t.UINT24,_t.ULONG][o],u=0;u<r.length;u+=1){var c=l(r[u]);Array.prototype.push.apply(s,c)}return Array.prototype.concat(_t.Card16(t.length),_t.OffSize(o),s,n)};lr.INDEX=function(t){return _t.INDEX(t).length};_t.DICT=function(t){for(var e=[],r=Object.keys(t),n=r.length,i=0;i<n;i+=1){var a=parseInt(r[i],0),s=t[a];e=e.concat(_t.OPERAND(s.value,s.type)),e=e.concat(_t.OPERATOR(a))}return e};lr.DICT=function(t){return _t.DICT(t).length};_t.OPERATOR=function(t){return t<1200?[t]:[12,t-1200]};_t.OPERAND=function(t,e){var r=[];if(Array.isArray(e))for(var n=0;n<e.length;n+=1)pr.argument(t.length===e.length,"Not enough arguments given for type"+e),r=r.concat(_t.OPERAND(t[n],e[n]));else if(e==="SID")r=r.concat(_t.NUMBER(t));else if(e==="offset")r=r.concat(_t.NUMBER32(t));else if(e==="number")r=r.concat(_t.NUMBER(t));else if(e==="real")r=r.concat(_t.REAL(t));else throw new Error("Unknown operand type "+e);return r};_t.OP=_t.BYTE;lr.OP=lr.BYTE;var gy=typeof WeakMap=="function"&&new WeakMap;_t.CHARSTRING=function(t){if(gy){var e=gy.get(t);if(e!==void 0)return e}for(var r=[],n=t.length,i=0;i<n;i+=1){var a=t[i];r=r.concat(_t[a.type](a.value))}return gy&&gy.set(t,r),r};lr.CHARSTRING=function(t){return _t.CHARSTRING(t).length};_t.OBJECT=function(t){var e=_t[t.type];return pr.argument(e!==void 0,"No encoding function for type "+t.type),e(t.value)};lr.OBJECT=function(t){var e=lr[t.type];return pr.argument(e!==void 0,"No sizeOf function for type "+t.type),e(t.value)};_t.TABLE=function(t){for(var e=[],r=t.fields.length,n=[],i=[],a=0;a<r;a+=1){var s=t.fields[a],o=_t[s.type];pr.argument(o!==void 0,"No encoding function for field type "+s.type+" ("+s.name+")");var l=t[s.name];l===void 0&&(l=s.value);var u=o(l);s.type==="TABLE"?(i.push(e.length),e=e.concat([0,0]),n.push(u)):e=e.concat(u)}for(var c=0;c<n.length;c+=1){var f=i[c],p=e.length;pr.argument(p<65536,"Table "+t.tableName+" too big."),e[f]=p>>8,e[f+1]=p&255,e=e.concat(n[c])}return e};lr.TABLE=function(t){for(var e=0,r=t.fields.length,n=0;n<r;n+=1){var i=t.fields[n],a=lr[i.type];pr.argument(a!==void 0,"No sizeOf function for field type "+i.type+" ("+i.name+")");var s=t[i.name];s===void 0&&(s=i.value),e+=a(s),i.type==="TABLE"&&(e+=2)}return e};_t.RECORD=_t.TABLE;lr.RECORD=lr.TABLE;_t.LITERAL=function(t){return t};lr.LITERAL=function(t){return t.length};function pa(t,e,r){if(e.length&&(e[0].name!=="coverageFormat"||e[0].value===1))for(var n=0;n<e.length;n+=1){var i=e[n];this[i.name]=i.value}if(this.tableName=t,this.fields=e,r)for(var a=Object.keys(r),s=0;s<a.length;s+=1){var o=a[s],l=r[o];this[o]!==void 0&&(this[o]=l)}}pa.prototype.encode=function(){return _t.TABLE(this)};pa.prototype.sizeOf=function(){return lr.TABLE(this)};function Mv(t,e,r){r===void 0&&(r=e.length);var n=new Array(e.length+1);n[0]={name:t+"Count",type:"USHORT",value:r};for(var i=0;i<e.length;i++)n[i+1]={name:t+i,type:"USHORT",value:e[i]};return n}function ik(t,e,r){var n=e.length,i=new Array(n+1);i[0]={name:t+"Count",type:"USHORT",value:n};for(var a=0;a<n;a++)i[a+1]={name:t+a,type:"TABLE",value:r(e[a],a)};return i}function Av(t,e,r){var n=e.length,i=[];i[0]={name:t+"Count",type:"USHORT",value:n};for(var a=0;a<n;a++)i=i.concat(r(e[a],a));return i}function xx(t){t.format===1?pa.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:1}].concat(Mv("glyph",t.glyphs))):t.format===2?pa.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:2}].concat(Av("rangeRecord",t.ranges,function(e){return[{name:"startGlyphID",type:"USHORT",value:e.start},{name:"endGlyphID",type:"USHORT",value:e.end},{name:"startCoverageIndex",type:"USHORT",value:e.index}]}))):pr.assert(!1,"Coverage format must be 1 or 2.")}xx.prototype=Object.create(pa.prototype);xx.prototype.constructor=xx;function bx(t){pa.call(this,"scriptListTable",Av("scriptRecord",t,function(e,r){var n=e.script,i=n.defaultLangSys;return pr.assert(!!i,"Unable to write GSUB: script "+e.tag+" has no default language system."),[{name:"scriptTag"+r,type:"TAG",value:e.tag},{name:"script"+r,type:"TABLE",value:new pa("scriptTable",[{name:"defaultLangSys",type:"TABLE",value:new pa("defaultLangSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:i.reqFeatureIndex}].concat(Mv("featureIndex",i.featureIndexes)))}].concat(Av("langSys",n.langSysRecords,function(a,s){var o=a.langSys;return[{name:"langSysTag"+s,type:"TAG",value:a.tag},{name:"langSys"+s,type:"TABLE",value:new pa("langSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:o.reqFeatureIndex}].concat(Mv("featureIndex",o.featureIndexes)))}]})))}]}))}bx.prototype=Object.create(pa.prototype);bx.prototype.constructor=bx;function wx(t){pa.call(this,"featureListTable",Av("featureRecord",t,function(e,r){var n=e.feature;return[{name:"featureTag"+r,type:"TAG",value:e.tag},{name:"feature"+r,type:"TABLE",value:new pa("featureTable",[{name:"featureParams",type:"USHORT",value:n.featureParams}].concat(Mv("lookupListIndex",n.lookupListIndexes)))}]}))}wx.prototype=Object.create(pa.prototype);wx.prototype.constructor=wx;function Sx(t,e){pa.call(this,"lookupListTable",ik("lookup",t,function(r){var n=e[r.lookupType];return pr.assert(!!n,"Unable to write GSUB lookup type "+r.lookupType+" tables."),new pa("lookupTable",[{name:"lookupType",type:"USHORT",value:r.lookupType},{name:"lookupFlag",type:"USHORT",value:r.lookupFlag}].concat(ik("subtable",r.subtables,n)))}))}Sx.prototype=Object.create(pa.prototype);Sx.prototype.constructor=Sx;var Bt={Table:pa,Record:pa,Coverage:xx,ScriptList:bx,FeatureList:wx,LookupList:Sx,ushortList:Mv,tableList:ik,recordList:Av};function C4(t,e){return t.getUint8(e)}function kx(t,e){return t.getUint16(e,!1)}function KH(t,e){return t.getInt16(e,!1)}function N_(t,e){return t.getUint32(e,!1)}function qR(t,e){var r=t.getInt16(e,!1),n=t.getUint16(e+2,!1);return r+n/65535}function ZH(t,e){for(var r="",n=e;n<e+4;n+=1)r+=String.fromCharCode(t.getInt8(n));return r}function YH(t,e,r){for(var n=0,i=0;i<r;i+=1)n<<=8,n+=t.getUint8(e+i);return n}function XH(t,e,r){for(var n=[],i=e;i<r;i+=1)n.push(t.getUint8(i));return n}function QH(t){for(var e="",r=0;r<t.length;r+=1)e+=String.fromCharCode(t[r]);return e}var JH={byte:1,uShort:2,short:2,uLong:4,fixed:4,longDateTime:8,tag:4};function We(t,e){this.data=t,this.offset=e,this.relativeOffset=0}We.prototype.parseByte=function(){var t=this.data.getUint8(this.offset+this.relativeOffset);return this.relativeOffset+=1,t};We.prototype.parseChar=function(){var t=this.data.getInt8(this.offset+this.relativeOffset);return this.relativeOffset+=1,t};We.prototype.parseCard8=We.prototype.parseByte;We.prototype.parseUShort=function(){var t=this.data.getUint16(this.offset+this.relativeOffset);return this.relativeOffset+=2,t};We.prototype.parseCard16=We.prototype.parseUShort;We.prototype.parseSID=We.prototype.parseUShort;We.prototype.parseOffset16=We.prototype.parseUShort;We.prototype.parseShort=function(){var t=this.data.getInt16(this.offset+this.relativeOffset);return this.relativeOffset+=2,t};We.prototype.parseF2Dot14=function(){var t=this.data.getInt16(this.offset+this.relativeOffset)/16384;return this.relativeOffset+=2,t};We.prototype.parseULong=function(){var t=N_(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,t};We.prototype.parseOffset32=We.prototype.parseULong;We.prototype.parseFixed=function(){var t=qR(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,t};We.prototype.parseString=function(t){var e=this.data,r=this.offset+this.relativeOffset,n="";this.relativeOffset+=t;for(var i=0;i<t;i++)n+=String.fromCharCode(e.getUint8(r+i));return n};We.prototype.parseTag=function(){return this.parseString(4)};We.prototype.parseLongDateTime=function(){var t=N_(this.data,this.offset+this.relativeOffset+4);return t-=2082844800,this.relativeOffset+=8,t};We.prototype.parseVersion=function(t){var e=kx(this.data,this.offset+this.relativeOffset),r=kx(this.data,this.offset+this.relativeOffset+2);return this.relativeOffset+=4,t===void 0&&(t=4096),e+r/t/10};We.prototype.skip=function(t,e){e===void 0&&(e=1),this.relativeOffset+=JH[t]*e};We.prototype.parseULongList=function(t){t===void 0&&(t=this.parseULong());for(var e=new Array(t),r=this.data,n=this.offset+this.relativeOffset,i=0;i<t;i++)e[i]=r.getUint32(n),n+=4;return this.relativeOffset+=t*4,e};We.prototype.parseOffset16List=We.prototype.parseUShortList=function(t){t===void 0&&(t=this.parseUShort());for(var e=new Array(t),r=this.data,n=this.offset+this.relativeOffset,i=0;i<t;i++)e[i]=r.getUint16(n),n+=2;return this.relativeOffset+=t*2,e};We.prototype.parseShortList=function(t){for(var e=new Array(t),r=this.data,n=this.offset+this.relativeOffset,i=0;i<t;i++)e[i]=r.getInt16(n),n+=2;return this.relativeOffset+=t*2,e};We.prototype.parseByteList=function(t){for(var e=new Array(t),r=this.data,n=this.offset+this.relativeOffset,i=0;i<t;i++)e[i]=r.getUint8(n++);return this.relativeOffset+=t,e};We.prototype.parseList=function(t,e){e||(e=t,t=this.parseUShort());for(var r=new Array(t),n=0;n<t;n++)r[n]=e.call(this);return r};We.prototype.parseList32=function(t,e){e||(e=t,t=this.parseULong());for(var r=new Array(t),n=0;n<t;n++)r[n]=e.call(this);return r};We.prototype.parseRecordList=function(t,e){e||(e=t,t=this.parseUShort());for(var r=new Array(t),n=Object.keys(e),i=0;i<t;i++){for(var a={},s=0;s<n.length;s++){var o=n[s],l=e[o];a[o]=l.call(this)}r[i]=a}return r};We.prototype.parseRecordList32=function(t,e){e||(e=t,t=this.parseULong());for(var r=new Array(t),n=Object.keys(e),i=0;i<t;i++){for(var a={},s=0;s<n.length;s++){var o=n[s],l=e[o];a[o]=l.call(this)}r[i]=a}return r};We.prototype.parseStruct=function(t){if(typeof t=="function")return t.call(this);for(var e=Object.keys(t),r={},n=0;n<e.length;n++){var i=e[n],a=t[i];r[i]=a.call(this)}return r};We.prototype.parseValueRecord=function(t){if(t===void 0&&(t=this.parseUShort()),t!==0){var e={};return t&1&&(e.xPlacement=this.parseShort()),t&2&&(e.yPlacement=this.parseShort()),t&4&&(e.xAdvance=this.parseShort()),t&8&&(e.yAdvance=this.parseShort()),t&16&&(e.xPlaDevice=void 0,this.parseShort()),t&32&&(e.yPlaDevice=void 0,this.parseShort()),t&64&&(e.xAdvDevice=void 0,this.parseShort()),t&128&&(e.yAdvDevice=void 0,this.parseShort()),e}};We.prototype.parseValueRecordList=function(){for(var t=this.parseUShort(),e=this.parseUShort(),r=new Array(e),n=0;n<e;n++)r[n]=this.parseValueRecord(t);return r};We.prototype.parsePointer=function(t){var e=this.parseOffset16();if(e>0)return new We(this.data,this.offset+e).parseStruct(t)};We.prototype.parsePointer32=function(t){var e=this.parseOffset32();if(e>0)return new We(this.data,this.offset+e).parseStruct(t)};We.prototype.parseListOfLists=function(t){for(var e=this.parseOffset16List(),r=e.length,n=this.relativeOffset,i=new Array(r),a=0;a<r;a++){var s=e[a];if(s===0){i[a]=void 0;continue}if(this.relativeOffset=s,t){for(var o=this.parseOffset16List(),l=new Array(o.length),u=0;u<o.length;u++)this.relativeOffset=s+o[u],l[u]=t.call(this);i[a]=l}else i[a]=this.parseUShortList()}return this.relativeOffset=n,i};We.prototype.parseCoverage=function(){var t=this.offset+this.relativeOffset,e=this.parseUShort(),r=this.parseUShort();if(e===1)return{format:1,glyphs:this.parseUShortList(r)};if(e===2){for(var n=new Array(r),i=0;i<r;i++)n[i]={start:this.parseUShort(),end:this.parseUShort(),index:this.parseUShort()};return{format:2,ranges:n}}throw new Error("0x"+t.toString(16)+": Coverage format must be 1 or 2.")};We.prototype.parseClassDef=function(){var t=this.offset+this.relativeOffset,e=this.parseUShort();if(e===1)return{format:1,startGlyph:this.parseUShort(),classes:this.parseUShortList()};if(e===2)return{format:2,ranges:this.parseRecordList({start:We.uShort,end:We.uShort,classId:We.uShort})};throw new Error("0x"+t.toString(16)+": ClassDef format must be 1 or 2.")};We.list=function(t,e){return function(){return this.parseList(t,e)}};We.list32=function(t,e){return function(){return this.parseList32(t,e)}};We.recordList=function(t,e){return function(){return this.parseRecordList(t,e)}};We.recordList32=function(t,e){return function(){return this.parseRecordList32(t,e)}};We.pointer=function(t){return function(){return this.parsePointer(t)}};We.pointer32=function(t){return function(){return this.parsePointer32(t)}};We.tag=We.prototype.parseTag;We.byte=We.prototype.parseByte;We.uShort=We.offset16=We.prototype.parseUShort;We.uShortList=We.prototype.parseUShortList;We.uLong=We.offset32=We.prototype.parseULong;We.uLongList=We.prototype.parseULongList;We.struct=We.prototype.parseStruct;We.coverage=We.prototype.parseCoverage;We.classDef=We.prototype.parseClassDef;var E4={reserved:We.uShort,reqFeatureIndex:We.uShort,featureIndexes:We.uShortList};We.prototype.parseScriptList=function(){return this.parsePointer(We.recordList({tag:We.tag,script:We.pointer({defaultLangSys:We.pointer(E4),langSysRecords:We.recordList({tag:We.tag,langSys:We.pointer(E4)})})}))||[]};We.prototype.parseFeatureList=function(){return this.parsePointer(We.recordList({tag:We.tag,feature:We.pointer({featureParams:We.offset16,lookupListIndexes:We.uShortList})}))||[]};We.prototype.parseLookupList=function(t){return this.parsePointer(We.list(We.pointer(function(){var e=this.parseUShort();pr.argument(1<=e&&e<=9,"GPOS/GSUB lookup type "+e+" unknown.");var r=this.parseUShort(),n=r&16;return{lookupType:e,lookupFlag:r,subtables:this.parseList(We.pointer(t[e])),markFilteringSet:n?this.parseUShort():void 0}})))||[]};We.prototype.parseFeatureVariationsList=function(){return this.parsePointer32(function(){var t=this.parseUShort(),e=this.parseUShort();pr.argument(t===1&&e<1,"GPOS/GSUB feature variations table unknown.");var r=this.parseRecordList32({conditionSetOffset:We.offset32,featureTableSubstitutionOffset:We.offset32});return r})||[]};var gr={getByte:C4,getCard8:C4,getUShort:kx,getCard16:kx,getShort:KH,getULong:N_,getFixed:qR,getTag:ZH,getOffset:YH,getBytes:XH,bytesToString:QH,Parser:We};function eW(t,e){e.parseUShort(),t.length=e.parseULong(),t.language=e.parseULong();var r;t.groupCount=r=e.parseULong(),t.glyphIndexMap={};for(var n=0;n<r;n+=1)for(var i=e.parseULong(),a=e.parseULong(),s=e.parseULong(),o=i;o<=a;o+=1)t.glyphIndexMap[o]=s,s++}function tW(t,e,r,n,i){t.length=e.parseUShort(),t.language=e.parseUShort();var a;t.segCount=a=e.parseUShort()>>1,e.skip("uShort",3),t.glyphIndexMap={};for(var s=new gr.Parser(r,n+i+14),o=new gr.Parser(r,n+i+16+a*2),l=new gr.Parser(r,n+i+16+a*4),u=new gr.Parser(r,n+i+16+a*6),c=n+i+16+a*8,f=0;f<a-1;f+=1)for(var p=void 0,v=s.parseUShort(),y=o.parseUShort(),S=l.parseShort(),w=u.parseUShort(),E=y;E<=v;E+=1)w!==0?(c=u.offset+u.relativeOffset-2,c+=w,c+=(E-y)*2,p=gr.getUShort(r,c),p!==0&&(p=p+S&65535)):p=E+S&65535,t.glyphIndexMap[E]=p}function rW(t,e){var r={};r.version=gr.getUShort(t,e),pr.argument(r.version===0,"cmap table version should be 0."),r.numTables=gr.getUShort(t,e+2);for(var n=-1,i=r.numTables-1;i>=0;i-=1){var a=gr.getUShort(t,e+4+i*8),s=gr.getUShort(t,e+4+i*8+2);if(a===3&&(s===0||s===1||s===10)||a===0&&(s===0||s===1||s===2||s===3||s===4)){n=gr.getULong(t,e+4+i*8+4);break}}if(n===-1)throw new Error("No valid cmap sub-tables found.");var o=new gr.Parser(t,e+n);if(r.format=o.parseUShort(),r.format===12)eW(r,o);else if(r.format===4)tW(r,o,t,e,n);else throw new Error("Only format 4 and 12 cmap tables are supported (found format "+r.format+").");return r}function nW(t,e,r){t.segments.push({end:e,start:e,delta:-(e-r),offset:0,glyphIndex:r})}function iW(t){t.segments.push({end:65535,start:65535,delta:1,offset:0})}function aW(t){var e=!0,r;for(r=t.length-1;r>0;r-=1){var n=t.get(r);if(n.unicode>65535){console.log("Adding CMAP format 12 (needed!)"),e=!1;break}}var i=[{name:"version",type:"USHORT",value:0},{name:"numTables",type:"USHORT",value:e?1:2},{name:"platformID",type:"USHORT",value:3},{name:"encodingID",type:"USHORT",value:1},{name:"offset",type:"ULONG",value:e?12:20}];e||(i=i.concat([{name:"cmap12PlatformID",type:"USHORT",value:3},{name:"cmap12EncodingID",type:"USHORT",value:10},{name:"cmap12Offset",type:"ULONG",value:0}])),i=i.concat([{name:"format",type:"USHORT",value:4},{name:"cmap4Length",type:"USHORT",value:0},{name:"language",type:"USHORT",value:0},{name:"segCountX2",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);var a=new Bt.Table("cmap",i);for(a.segments=[],r=0;r<t.length;r+=1){for(var s=t.get(r),o=0;o<s.unicodes.length;o+=1)nW(a,s.unicodes[o],r);a.segments=a.segments.sort(function(_,T){return _.start-T.start})}iW(a);var l=a.segments.length,u=0,c=[],f=[],p=[],v=[],y=[],S=[];for(r=0;r<l;r+=1){var w=a.segments[r];w.end<=65535&&w.start<=65535?(c=c.concat({name:"end_"+r,type:"USHORT",value:w.end}),f=f.concat({name:"start_"+r,type:"USHORT",value:w.start}),p=p.concat({name:"idDelta_"+r,type:"SHORT",value:w.delta}),v=v.concat({name:"idRangeOffset_"+r,type:"USHORT",value:w.offset}),w.glyphId!==void 0&&(y=y.concat({name:"glyph_"+r,type:"USHORT",value:w.glyphId}))):u+=1,!e&&w.glyphIndex!==void 0&&(S=S.concat({name:"cmap12Start_"+r,type:"ULONG",value:w.start}),S=S.concat({name:"cmap12End_"+r,type:"ULONG",value:w.end}),S=S.concat({name:"cmap12Glyph_"+r,type:"ULONG",value:w.glyphIndex}))}if(a.segCountX2=(l-u)*2,a.searchRange=Math.pow(2,Math.floor(Math.log(l-u)/Math.log(2)))*2,a.entrySelector=Math.log(a.searchRange/2)/Math.log(2),a.rangeShift=a.segCountX2-a.searchRange,a.fields=a.fields.concat(c),a.fields.push({name:"reservedPad",type:"USHORT",value:0}),a.fields=a.fields.concat(f),a.fields=a.fields.concat(p),a.fields=a.fields.concat(v),a.fields=a.fields.concat(y),a.cmap4Length=14+c.length*2+2+f.length*2+p.length*2+v.length*2+y.length*2,!e){var E=16+S.length*4;a.cmap12Offset=20+a.cmap4Length,a.fields=a.fields.concat([{name:"cmap12Format",type:"USHORT",value:12},{name:"cmap12Reserved",type:"USHORT",value:0},{name:"cmap12Length",type:"ULONG",value:E},{name:"cmap12Language",type:"ULONG",value:0},{name:"cmap12nGroups",type:"ULONG",value:S.length/3}]),a.fields=a.fields.concat(S)}return a}var sW={parse:rW,make:aW},qy=[".notdef","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","endash","dagger","daggerdbl","periodcentered","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","questiondown","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","ring","cedilla","hungarumlaut","ogonek","caron","emdash","AE","ordfeminine","Lslash","Oslash","OE","ordmasculine","ae","dotlessi","lslash","oslash","oe","germandbls","onesuperior","logicalnot","mu","trademark","Eth","onehalf","plusminus","Thorn","onequarter","divide","brokenbar","degree","thorn","threequarters","twosuperior","registered","minus","eth","multiply","threesuperior","copyright","Aacute","Acircumflex","Adieresis","Agrave","Aring","Atilde","Ccedilla","Eacute","Ecircumflex","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Ntilde","Oacute","Ocircumflex","Odieresis","Ograve","Otilde","Scaron","Uacute","Ucircumflex","Udieresis","Ugrave","Yacute","Ydieresis","Zcaron","aacute","acircumflex","adieresis","agrave","aring","atilde","ccedilla","eacute","ecircumflex","edieresis","egrave","iacute","icircumflex","idieresis","igrave","ntilde","oacute","ocircumflex","odieresis","ograve","otilde","scaron","uacute","ucircumflex","udieresis","ugrave","yacute","ydieresis","zcaron","exclamsmall","Hungarumlautsmall","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","266 ff","onedotenleader","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","commasuperior","threequartersemdash","periodsuperior","questionsmall","asuperior","bsuperior","centsuperior","dsuperior","esuperior","isuperior","lsuperior","msuperior","nsuperior","osuperior","rsuperior","ssuperior","tsuperior","ff","ffi","ffl","parenleftinferior","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","exclamdownsmall","centoldstyle","Lslashsmall","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","Dotaccentsmall","Macronsmall","figuredash","hypheninferior","Ogoneksmall","Ringsmall","Cedillasmall","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","zerosuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall","001.000","001.001","001.002","001.003","Black","Bold","Book","Light","Medium","Regular","Roman","Semibold"],oW=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","","endash","dagger","daggerdbl","periodcentered","","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","","questiondown","","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","","ring","cedilla","","hungarumlaut","ogonek","caron","emdash","","","","","","","","","","","","","","","","","AE","","ordfeminine","","","","","Lslash","Oslash","OE","ordmasculine","","","","","","ae","","","","dotlessi","","","lslash","oslash","oe","germandbls"],lW=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclamsmall","Hungarumlautsmall","","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","twodotenleader","onedotenleader","comma","hyphen","period","fraction","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","colon","semicolon","commasuperior","threequartersemdash","periodsuperior","questionsmall","","asuperior","bsuperior","centsuperior","dsuperior","esuperior","","","isuperior","","","lsuperior","msuperior","nsuperior","osuperior","","","rsuperior","ssuperior","tsuperior","","ff","fi","fl","ffi","ffl","parenleftinferior","","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdownsmall","centoldstyle","Lslashsmall","","","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","","Dotaccentsmall","","","Macronsmall","","","figuredash","hypheninferior","","","Ogoneksmall","Ringsmall","Cedillasmall","","","","onequarter","onehalf","threequarters","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","","","zerosuperior","onesuperior","twosuperior","threesuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall"],T4=[".notdef",".null","nonmarkingreturn","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quotesingle","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","grave","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","Adieresis","Aring","Ccedilla","Eacute","Ntilde","Odieresis","Udieresis","aacute","agrave","acircumflex","adieresis","atilde","aring","ccedilla","eacute","egrave","ecircumflex","edieresis","iacute","igrave","icircumflex","idieresis","ntilde","oacute","ograve","ocircumflex","odieresis","otilde","uacute","ugrave","ucircumflex","udieresis","dagger","degree","cent","sterling","section","bullet","paragraph","germandbls","registered","copyright","trademark","acute","dieresis","notequal","AE","Oslash","infinity","plusminus","lessequal","greaterequal","yen","mu","partialdiff","summation","product","pi","integral","ordfeminine","ordmasculine","Omega","ae","oslash","questiondown","exclamdown","logicalnot","radical","florin","approxequal","Delta","guillemotleft","guillemotright","ellipsis","nonbreakingspace","Agrave","Atilde","Otilde","OE","oe","endash","emdash","quotedblleft","quotedblright","quoteleft","quoteright","divide","lozenge","ydieresis","Ydieresis","fraction","currency","guilsinglleft","guilsinglright","fi","fl","daggerdbl","periodcentered","quotesinglbase","quotedblbase","perthousand","Acircumflex","Ecircumflex","Aacute","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Oacute","Ocircumflex","apple","Ograve","Uacute","Ucircumflex","Ugrave","dotlessi","circumflex","tilde","macron","breve","dotaccent","ring","cedilla","hungarumlaut","ogonek","caron","Lslash","lslash","Scaron","scaron","Zcaron","zcaron","brokenbar","Eth","eth","Yacute","yacute","Thorn","thorn","minus","multiply","onesuperior","twosuperior","threesuperior","onehalf","onequarter","threequarters","franc","Gbreve","gbreve","Idotaccent","Scedilla","scedilla","Cacute","cacute","Ccaron","ccaron","dcroat"];function $R(t){this.font=t}$R.prototype.charToGlyphIndex=function(t){var e=t.codePointAt(0),r=this.font.glyphs;if(r){for(var n=0;n<r.length;n+=1)for(var i=r.get(n),a=0;a<i.unicodes.length;a+=1)if(i.unicodes[a]===e)return n}return null};function _x(t,e){this.encoding=t,this.charset=e}_x.prototype.charToGlyphIndex=function(t){var e=t.codePointAt(0),r=this.encoding[e];return this.charset.indexOf(r)};function uW(t,e,r,n,i){t.beginPath(),t.moveTo(e,r),t.lineTo(n,i),t.stroke()}var qf={line:uW};function cW(t,e){var r=e||new Ki;return{configurable:!0,get:function(){return typeof r=="function"&&(r=r()),r},set:function(n){r=n}}}function il(t){this.bindConstructorValues(t)}il.prototype.bindConstructorValues=function(t){this.index=t.index||0,this.name=t.name||null,this.unicode=t.unicode||void 0,this.unicodes=t.unicodes||t.unicode!==void 0?[t.unicode]:[],"xMin"in t&&(this.xMin=t.xMin),"yMin"in t&&(this.yMin=t.yMin),"xMax"in t&&(this.xMax=t.xMax),"yMax"in t&&(this.yMax=t.yMax),"advanceWidth"in t&&(this.advanceWidth=t.advanceWidth),Object.defineProperty(this,"path",cW(this,t.path))};il.prototype.addUnicode=function(t){this.unicodes.length===0&&(this.unicode=t),this.unicodes.push(t)};il.prototype.getBoundingBox=function(){return this.path.getBoundingBox()};il.prototype.getPath=function(t,e,r,n,i){t=t!==void 0?t:0,e=e!==void 0?e:0,r=r!==void 0?r:72;var a,s;n||(n={});var o=n.xScale,l=n.yScale;if(n.hinting&&i&&i.hinting&&(s=this.path&&i.hinting.exec(this,r)),s)a=i.hinting.getCommands(s),t=Math.round(t),e=Math.round(e),o=l=1;else{a=this.path.commands;var u=1/(this.path.unitsPerEm||1e3)*r;o===void 0&&(o=u),l===void 0&&(l=u)}for(var c=new Ki,f=0;f<a.length;f+=1){var p=a[f];p.type==="M"?c.moveTo(t+p.x*o,e+-p.y*l):p.type==="L"?c.lineTo(t+p.x*o,e+-p.y*l):p.type==="Q"?c.quadraticCurveTo(t+p.x1*o,e+-p.y1*l,t+p.x*o,e+-p.y*l):p.type==="C"?c.curveTo(t+p.x1*o,e+-p.y1*l,t+p.x2*o,e+-p.y2*l,t+p.x*o,e+-p.y*l):p.type==="Z"&&c.closePath()}return c};il.prototype.getContours=function(){if(this.points===void 0)return[];for(var t=[],e=[],r=0;r<this.points.length;r+=1){var n=this.points[r];e.push(n),n.lastPointOfContour&&(t.push(e),e=[])}return pr.argument(e.length===0,"There are still points left in the current contour."),t};il.prototype.getMetrics=function(){for(var t=this.path.commands,e=[],r=[],n=0;n<t.length;n+=1){var i=t[n];i.type!=="Z"&&(e.push(i.x),r.push(i.y)),(i.type==="Q"||i.type==="C")&&(e.push(i.x1),r.push(i.y1)),i.type==="C"&&(e.push(i.x2),r.push(i.y2))}var a={xMin:Math.min.apply(null,e),yMin:Math.min.apply(null,r),xMax:Math.max.apply(null,e),yMax:Math.max.apply(null,r),leftSideBearing:this.leftSideBearing};return isFinite(a.xMin)||(a.xMin=0),isFinite(a.xMax)||(a.xMax=this.advanceWidth),isFinite(a.yMin)||(a.yMin=0),isFinite(a.yMax)||(a.yMax=0),a.rightSideBearing=this.advanceWidth-a.leftSideBearing-(a.xMax-a.xMin),a};il.prototype.draw=function(t,e,r,n,i){this.getPath(e,r,n,i).draw(t)};il.prototype.drawPoints=function(t,e,r,n){function i(f,p,v,y){t.beginPath();for(var S=0;S<f.length;S+=1)t.moveTo(p+f[S].x*y,v+f[S].y*y),t.arc(p+f[S].x*y,v+f[S].y*y,2,0,Math.PI*2,!1);t.closePath(),t.fill()}e=e!==void 0?e:0,r=r!==void 0?r:0,n=n!==void 0?n:24;for(var a=1/this.path.unitsPerEm*n,s=[],o=[],l=this.path,u=0;u<l.commands.length;u+=1){var c=l.commands[u];c.x!==void 0&&s.push({x:c.x,y:-c.y}),c.x1!==void 0&&o.push({x:c.x1,y:-c.y1}),c.x2!==void 0&&o.push({x:c.x2,y:-c.y2})}t.fillStyle="blue",i(s,e,r,a),t.fillStyle="red",i(o,e,r,a)};il.prototype.drawMetrics=function(t,e,r,n){var i;e=e!==void 0?e:0,r=r!==void 0?r:0,n=n!==void 0?n:24,i=1/this.path.unitsPerEm*n,t.lineWidth=1,t.strokeStyle="black",qf.line(t,e,-1e4,e,1e4),qf.line(t,-1e4,r,1e4,r);var a=this.xMin||0,s=this.yMin||0,o=this.xMax||0,l=this.yMax||0,u=this.advanceWidth||0;t.strokeStyle="blue",qf.line(t,e+a*i,-1e4,e+a*i,1e4),qf.line(t,e+o*i,-1e4,e+o*i,1e4),qf.line(t,-1e4,r+-s*i,1e4,r+-s*i),qf.line(t,-1e4,r+-l*i,1e4,r+-l*i),t.strokeStyle="green",qf.line(t,e+u*i,-1e4,e+u*i,1e4)};function vy(t,e,r){Object.defineProperty(t,e,{get:function(){return t.path,t[r]},set:function(n){t[r]=n},enumerable:!0,configurable:!0})}function P_(t,e){if(this.font=t,this.glyphs={},Array.isArray(e))for(var r=0;r<e.length;r++){var n=e[r];n.path.unitsPerEm=t.unitsPerEm,this.glyphs[r]=n}this.length=e&&e.length||0}P_.prototype.get=function(t){if(this.glyphs[t]===void 0){this.font._push(t),typeof this.glyphs[t]=="function"&&(this.glyphs[t]=this.glyphs[t]());var e=this.glyphs[t],r=this.font._IndexToUnicodeMap[t];if(r)for(var n=0;n<r.unicodes.length;n++)e.addUnicode(r.unicodes[n]);this.font.cffEncoding?this.font.isCIDFont?e.name="gid"+t:e.name=this.font.cffEncoding.charset[t]:this.font.glyphNames.names&&(e.name=this.font.glyphNames.glyphIndexToName(t)),this.glyphs[t].advanceWidth=this.font._hmtxTableData[t].advanceWidth,this.glyphs[t].leftSideBearing=this.font._hmtxTableData[t].leftSideBearing}else typeof this.glyphs[t]=="function"&&(this.glyphs[t]=this.glyphs[t]());return this.glyphs[t]};P_.prototype.push=function(t,e){this.glyphs[t]=e,this.length++};function dW(t,e){return new il({index:e,font:t})}function fW(t,e,r,n,i,a){return function(){var s=new il({index:e,font:t});return s.path=function(){r(s,n,i);var o=a(t.glyphs,s);return o.unitsPerEm=t.unitsPerEm,o},vy(s,"xMin","_xMin"),vy(s,"xMax","_xMax"),vy(s,"yMin","_yMin"),vy(s,"yMax","_yMax"),s}}function hW(t,e,r,n){return function(){var i=new il({index:e,font:t});return i.path=function(){var a=r(t,i,n);return a.unitsPerEm=t.unitsPerEm,a},i}}var Cu={GlyphSet:P_,glyphLoader:dW,ttfGlyphLoader:fW,cffGlyphLoader:hW};function KR(t,e){if(t===e)return!0;if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return!1;for(var r=0;r<t.length;r+=1)if(!KR(t[r],e[r]))return!1;return!0}else return!1}function ak(t){var e;return t.length<1240?e=107:t.length<33900?e=1131:e=32768,e}function _d(t,e,r){var n=[],i=[],a=gr.getCard16(t,e),s,o;if(a!==0){var l=gr.getByte(t,e+2);s=e+(a+1)*l+2;for(var u=e+3,c=0;c<a+1;c+=1)n.push(gr.getOffset(t,u,l)),u+=l;o=s+n[a]}else o=e+2;for(var f=0;f<n.length-1;f+=1){var p=gr.getBytes(t,s+n[f],s+n[f+1]);r&&(p=r(p)),i.push(p)}return{objects:i,startOffset:e,endOffset:o}}function pW(t,e){var r=[],n=gr.getCard16(t,e),i,a;if(n!==0){var s=gr.getByte(t,e+2);i=e+(n+1)*s+2;for(var o=e+3,l=0;l<n+1;l+=1)r.push(gr.getOffset(t,o,s)),o+=s;a=i+r[n]}else a=e+2;return{offsets:r,startOffset:e,endOffset:a}}function mW(t,e,r,n,i){var a=gr.getCard16(r,n),s=0;if(a!==0){var o=gr.getByte(r,n+2);s=n+(a+1)*o+2}var l=gr.getBytes(r,s+e[t],s+e[t+1]);return l}function gW(t){for(var e="",r=15,n=["0","1","2","3","4","5","6","7","8","9",".","E","E-",null,"-"];;){var i=t.parseByte(),a=i>>4,s=i&15;if(a===r||(e+=n[a],s===r))break;e+=n[s]}return parseFloat(e)}function vW(t,e){var r,n,i,a;if(e===28)return r=t.parseByte(),n=t.parseByte(),r<<8|n;if(e===29)return r=t.parseByte(),n=t.parseByte(),i=t.parseByte(),a=t.parseByte(),r<<24|n<<16|i<<8|a;if(e===30)return gW(t);if(e>=32&&e<=246)return e-139;if(e>=247&&e<=250)return r=t.parseByte(),(e-247)*256+r+108;if(e>=251&&e<=254)return r=t.parseByte(),-(e-251)*256-r-108;throw new Error("Invalid b0 "+e)}function yW(t){for(var e={},r=0;r<t.length;r+=1){var n=t[r][0],i=t[r][1],a=void 0;if(i.length===1?a=i[0]:a=i,e.hasOwnProperty(n)&&!isNaN(e[n]))throw new Error("Object "+e+" already has key "+n);e[n]=a}return e}function ZR(t,e,r){e=e!==void 0?e:0;var n=new gr.Parser(t,e),i=[],a=[];for(r=r!==void 0?r:t.length;n.relativeOffset<r;){var s=n.parseByte();s<=21?(s===12&&(s=1200+n.parseByte()),i.push([s,a]),a=[]):a.push(vW(n,s))}return yW(i)}function nv(t,e){return e<=390?e=qy[e]:e=t[e-391],e}function YR(t,e,r){for(var n={},i,a=0;a<e.length;a+=1){var s=e[a];if(Array.isArray(s.type)){var o=[];o.length=s.type.length;for(var l=0;l<s.type.length;l++)i=t[s.op]!==void 0?t[s.op][l]:void 0,i===void 0&&(i=s.value!==void 0&&s.value[l]!==void 0?s.value[l]:null),s.type[l]==="SID"&&(i=nv(r,i)),o[l]=i;n[s.name]=o}else i=t[s.op],i===void 0&&(i=s.value!==void 0?s.value:null),s.type==="SID"&&(i=nv(r,i)),n[s.name]=i}return n}function xW(t,e){var r={};return r.formatMajor=gr.getCard8(t,e),r.formatMinor=gr.getCard8(t,e+1),r.size=gr.getCard8(t,e+2),r.offsetSize=gr.getCard8(t,e+3),r.startOffset=e,r.endOffset=e+4,r}var XR=[{name:"version",op:0,type:"SID"},{name:"notice",op:1,type:"SID"},{name:"copyright",op:1200,type:"SID"},{name:"fullName",op:2,type:"SID"},{name:"familyName",op:3,type:"SID"},{name:"weight",op:4,type:"SID"},{name:"isFixedPitch",op:1201,type:"number",value:0},{name:"italicAngle",op:1202,type:"number",value:0},{name:"underlinePosition",op:1203,type:"number",value:-100},{name:"underlineThickness",op:1204,type:"number",value:50},{name:"paintType",op:1205,type:"number",value:0},{name:"charstringType",op:1206,type:"number",value:2},{name:"fontMatrix",op:1207,type:["real","real","real","real","real","real"],value:[.001,0,0,.001,0,0]},{name:"uniqueId",op:13,type:"number"},{name:"fontBBox",op:5,type:["number","number","number","number"],value:[0,0,0,0]},{name:"strokeWidth",op:1208,type:"number",value:0},{name:"xuid",op:14,type:[],value:null},{name:"charset",op:15,type:"offset",value:0},{name:"encoding",op:16,type:"offset",value:0},{name:"charStrings",op:17,type:"offset",value:0},{name:"private",op:18,type:["number","offset"],value:[0,0]},{name:"ros",op:1230,type:["SID","SID","number"]},{name:"cidFontVersion",op:1231,type:"number",value:0},{name:"cidFontRevision",op:1232,type:"number",value:0},{name:"cidFontType",op:1233,type:"number",value:0},{name:"cidCount",op:1234,type:"number",value:8720},{name:"uidBase",op:1235,type:"number"},{name:"fdArray",op:1236,type:"offset"},{name:"fdSelect",op:1237,type:"offset"},{name:"fontName",op:1238,type:"SID"}],QR=[{name:"subrs",op:19,type:"offset",value:0},{name:"defaultWidthX",op:20,type:"number",value:0},{name:"nominalWidthX",op:21,type:"number",value:0}];function bW(t,e){var r=ZR(t,0,t.byteLength);return YR(r,XR,e)}function JR(t,e,r,n){var i=ZR(t,e,r);return YR(i,QR,n)}function N4(t,e,r,n){for(var i=[],a=0;a<r.length;a+=1){var s=new DataView(new Uint8Array(r[a]).buffer),o=bW(s,n);o._subrs=[],o._subrsBias=0,o._defaultWidthX=0,o._nominalWidthX=0;var l=o.private[0],u=o.private[1];if(l!==0&&u!==0){var c=JR(t,u+e,l,n);if(o._defaultWidthX=c.defaultWidthX,o._nominalWidthX=c.nominalWidthX,c.subrs!==0){var f=u+c.subrs,p=_d(t,f+e);o._subrs=p.objects,o._subrsBias=ak(o._subrs)}o._privateDict=c}i.push(o)}return i}function wW(t,e,r,n){var i,a,s=new gr.Parser(t,e);r-=1;var o=[".notdef"],l=s.parseCard8();if(l===0)for(var u=0;u<r;u+=1)i=s.parseSID(),o.push(nv(n,i));else if(l===1)for(;o.length<=r;){i=s.parseSID(),a=s.parseCard8();for(var c=0;c<=a;c+=1)o.push(nv(n,i)),i+=1}else if(l===2)for(;o.length<=r;){i=s.parseSID(),a=s.parseCard16();for(var f=0;f<=a;f+=1)o.push(nv(n,i)),i+=1}else throw new Error("Unknown charset format "+l);return o}function SW(t,e,r){var n,i={},a=new gr.Parser(t,e),s=a.parseCard8();if(s===0)for(var o=a.parseCard8(),l=0;l<o;l+=1)n=a.parseCard8(),i[n]=l;else if(s===1){var u=a.parseCard8();n=1;for(var c=0;c<u;c+=1)for(var f=a.parseCard8(),p=a.parseCard8(),v=f;v<=f+p;v+=1)i[v]=n,n+=1}else throw new Error("Unknown encoding format "+s);return new _x(i,r)}function P4(t,e,r){var n,i,a,s,o=new Ki,l=[],u=0,c=!1,f=!1,p=0,v=0,y,S,w,E;if(t.isCIDFont){var _=t.tables.cff.topDict._fdSelect[e.index],T=t.tables.cff.topDict._fdArray[_];y=T._subrs,S=T._subrsBias,w=T._defaultWidthX,E=T._nominalWidthX}else y=t.tables.cff.topDict._subrs,S=t.tables.cff.topDict._subrsBias,w=t.tables.cff.topDict._defaultWidthX,E=t.tables.cff.topDict._nominalWidthX;var N=w;function R(D,j){f&&o.closePath(),o.moveTo(D,j),f=!0}function I(){var D;D=l.length%2!==0,D&&!c&&(N=l.shift()+E),u+=l.length>>1,l.length=0,c=!0}function F(D){for(var j,B,G,K,O,W,U,q,Z,Q,ne,re,Y=0;Y<D.length;){var J=D[Y];switch(Y+=1,J){case 1:I();break;case 3:I();break;case 4:l.length>1&&!c&&(N=l.shift()+E,c=!0),v+=l.pop(),R(p,v);break;case 5:for(;l.length>0;)p+=l.shift(),v+=l.shift(),o.lineTo(p,v);break;case 6:for(;l.length>0&&(p+=l.shift(),o.lineTo(p,v),l.length!==0);)v+=l.shift(),o.lineTo(p,v);break;case 7:for(;l.length>0&&(v+=l.shift(),o.lineTo(p,v),l.length!==0);)p+=l.shift(),o.lineTo(p,v);break;case 8:for(;l.length>0;)n=p+l.shift(),i=v+l.shift(),a=n+l.shift(),s=i+l.shift(),p=a+l.shift(),v=s+l.shift(),o.curveTo(n,i,a,s,p,v);break;case 10:O=l.pop()+S,W=y[O],W&&F(W);break;case 11:return;case 12:switch(J=D[Y],Y+=1,J){case 35:n=p+l.shift(),i=v+l.shift(),a=n+l.shift(),s=i+l.shift(),U=a+l.shift(),q=s+l.shift(),Z=U+l.shift(),Q=q+l.shift(),ne=Z+l.shift(),re=Q+l.shift(),p=ne+l.shift(),v=re+l.shift(),l.shift(),o.curveTo(n,i,a,s,U,q),o.curveTo(Z,Q,ne,re,p,v);break;case 34:n=p+l.shift(),i=v,a=n+l.shift(),s=i+l.shift(),U=a+l.shift(),q=s,Z=U+l.shift(),Q=s,ne=Z+l.shift(),re=v,p=ne+l.shift(),o.curveTo(n,i,a,s,U,q),o.curveTo(Z,Q,ne,re,p,v);break;case 36:n=p+l.shift(),i=v+l.shift(),a=n+l.shift(),s=i+l.shift(),U=a+l.shift(),q=s,Z=U+l.shift(),Q=s,ne=Z+l.shift(),re=Q+l.shift(),p=ne+l.shift(),o.curveTo(n,i,a,s,U,q),o.curveTo(Z,Q,ne,re,p,v);break;case 37:n=p+l.shift(),i=v+l.shift(),a=n+l.shift(),s=i+l.shift(),U=a+l.shift(),q=s+l.shift(),Z=U+l.shift(),Q=q+l.shift(),ne=Z+l.shift(),re=Q+l.shift(),Math.abs(ne-p)>Math.abs(re-v)?p=ne+l.shift():v=re+l.shift(),o.curveTo(n,i,a,s,U,q),o.curveTo(Z,Q,ne,re,p,v);break;default:console.log("Glyph "+e.index+": unknown operator 1200"+J),l.length=0}break;case 14:l.length>0&&!c&&(N=l.shift()+E,c=!0),f&&(o.closePath(),f=!1);break;case 18:I();break;case 19:case 20:I(),Y+=u+7>>3;break;case 21:l.length>2&&!c&&(N=l.shift()+E,c=!0),v+=l.pop(),p+=l.pop(),R(p,v);break;case 22:l.length>1&&!c&&(N=l.shift()+E,c=!0),p+=l.pop(),R(p,v);break;case 23:I();break;case 24:for(;l.length>2;)n=p+l.shift(),i=v+l.shift(),a=n+l.shift(),s=i+l.shift(),p=a+l.shift(),v=s+l.shift(),o.curveTo(n,i,a,s,p,v);p+=l.shift(),v+=l.shift(),o.lineTo(p,v);break;case 25:for(;l.length>6;)p+=l.shift(),v+=l.shift(),o.lineTo(p,v);n=p+l.shift(),i=v+l.shift(),a=n+l.shift(),s=i+l.shift(),p=a+l.shift(),v=s+l.shift(),o.curveTo(n,i,a,s,p,v);break;case 26:for(l.length%2&&(p+=l.shift());l.length>0;)n=p,i=v+l.shift(),a=n+l.shift(),s=i+l.shift(),p=a,v=s+l.shift(),o.curveTo(n,i,a,s,p,v);break;case 27:for(l.length%2&&(v+=l.shift());l.length>0;)n=p+l.shift(),i=v,a=n+l.shift(),s=i+l.shift(),p=a+l.shift(),v=s,o.curveTo(n,i,a,s,p,v);break;case 28:j=D[Y],B=D[Y+1],l.push((j<<24|B<<16)>>16),Y+=2;break;case 29:O=l.pop()+t.gsubrsBias,W=t.gsubrs[O],W&&F(W);break;case 30:for(;l.length>0&&(n=p,i=v+l.shift(),a=n+l.shift(),s=i+l.shift(),p=a+l.shift(),v=s+(l.length===1?l.shift():0),o.curveTo(n,i,a,s,p,v),l.length!==0);)n=p+l.shift(),i=v,a=n+l.shift(),s=i+l.shift(),v=s+l.shift(),p=a+(l.length===1?l.shift():0),o.curveTo(n,i,a,s,p,v);break;case 31:for(;l.length>0&&(n=p+l.shift(),i=v,a=n+l.shift(),s=i+l.shift(),v=s+l.shift(),p=a+(l.length===1?l.shift():0),o.curveTo(n,i,a,s,p,v),l.length!==0);)n=p,i=v+l.shift(),a=n+l.shift(),s=i+l.shift(),p=a+l.shift(),v=s+(l.length===1?l.shift():0),o.curveTo(n,i,a,s,p,v);break;default:J<32?console.log("Glyph "+e.index+": unknown operator "+J):J<247?l.push(J-139):J<251?(j=D[Y],Y+=1,l.push((J-247)*256+j+108)):J<255?(j=D[Y],Y+=1,l.push(-(J-251)*256-j-108)):(j=D[Y],B=D[Y+1],G=D[Y+2],K=D[Y+3],Y+=4,l.push((j<<24|B<<16|G<<8|K)/65536))}}}return F(r),e.advanceWidth=N,o}function kW(t,e,r,n){var i=[],a,s=new gr.Parser(t,e),o=s.parseCard8();if(o===0)for(var l=0;l<r;l++){if(a=s.parseCard8(),a>=n)throw new Error("CFF table CID Font FDSelect has bad FD index value "+a+" (FD count "+n+")");i.push(a)}else if(o===3){var u=s.parseCard16(),c=s.parseCard16();if(c!==0)throw new Error("CFF Table CID Font FDSelect format 3 range has bad initial GID "+c);for(var f,p=0;p<u;p++){if(a=s.parseCard8(),f=s.parseCard16(),a>=n)throw new Error("CFF table CID Font FDSelect has bad FD index value "+a+" (FD count "+n+")");if(f>r)throw new Error("CFF Table CID Font FDSelect format 3 range has bad GID "+f);for(;c<f;c++)i.push(a);c=f}if(f!==r)throw new Error("CFF Table CID Font FDSelect format 3 range has bad final GID "+f)}else throw new Error("CFF Table CID Font FDSelect table has unsupported format "+o);return i}function _W(t,e,r,n){r.tables.cff={};var i=xW(t,e),a=_d(t,i.endOffset,gr.bytesToString),s=_d(t,a.endOffset),o=_d(t,s.endOffset,gr.bytesToString),l=_d(t,o.endOffset);r.gsubrs=l.objects,r.gsubrsBias=ak(r.gsubrs);var u=N4(t,e,s.objects,o.objects);if(u.length!==1)throw new Error("CFF table has too many fonts in 'FontSet' - count of fonts NameIndex.length = "+u.length);var c=u[0];if(r.tables.cff.topDict=c,c._privateDict&&(r.defaultWidthX=c._privateDict.defaultWidthX,r.nominalWidthX=c._privateDict.nominalWidthX),c.ros[0]!==void 0&&c.ros[1]!==void 0&&(r.isCIDFont=!0),r.isCIDFont){var f=c.fdArray,p=c.fdSelect;if(f===0||p===0)throw new Error("Font is marked as a CID font, but FDArray and/or FDSelect information is missing");f+=e;var v=_d(t,f),y=N4(t,e,v.objects,o.objects);c._fdArray=y,p+=e,c._fdSelect=kW(t,p,r.numGlyphs,y.length)}var S=e+c.private[1],w=JR(t,S,c.private[0],o.objects);if(r.defaultWidthX=w.defaultWidthX,r.nominalWidthX=w.nominalWidthX,w.subrs!==0){var E=S+w.subrs,_=_d(t,E);r.subrs=_.objects,r.subrsBias=ak(r.subrs)}else r.subrs=[],r.subrsBias=0;var T;n.lowMemory?(T=pW(t,e+c.charStrings),r.nGlyphs=T.offsets.length):(T=_d(t,e+c.charStrings),r.nGlyphs=T.objects.length);var N=wW(t,e+c.charset,r.nGlyphs,o.objects);if(c.encoding===0?r.cffEncoding=new _x(oW,N):c.encoding===1?r.cffEncoding=new _x(lW,N):r.cffEncoding=SW(t,e+c.encoding,N),r.encoding=r.encoding||r.cffEncoding,r.glyphs=new Cu.GlyphSet(r),n.lowMemory)r._push=function(F){var D=mW(F,T.offsets,t,e+c.charStrings);r.glyphs.push(F,Cu.cffGlyphLoader(r,F,P4,D))};else for(var R=0;R<r.nGlyphs;R+=1){var I=T.objects[R];r.glyphs.push(R,Cu.cffGlyphLoader(r,R,P4,I))}}function eL(t,e){var r,n=qy.indexOf(t);return n>=0&&(r=n),n=e.indexOf(t),n>=0?r=n+qy.length:(r=qy.length+e.length,e.push(t)),r}function CW(){return new Bt.Record("Header",[{name:"major",type:"Card8",value:1},{name:"minor",type:"Card8",value:0},{name:"hdrSize",type:"Card8",value:4},{name:"major",type:"Card8",value:1}])}function EW(t){var e=new Bt.Record("Name INDEX",[{name:"names",type:"INDEX",value:[]}]);e.names=[];for(var r=0;r<t.length;r+=1)e.names.push({name:"name_"+r,type:"NAME",value:t[r]});return e}function tL(t,e,r){for(var n={},i=0;i<t.length;i+=1){var a=t[i],s=e[a.name];s!==void 0&&!KR(s,a.value)&&(a.type==="SID"&&(s=eL(s,r)),n[a.op]={name:a.name,type:a.type,value:s})}return n}function M4(t,e){var r=new Bt.Record("Top DICT",[{name:"dict",type:"DICT",value:{}}]);return r.dict=tL(XR,t,e),r}function A4(t){var e=new Bt.Record("Top DICT INDEX",[{name:"topDicts",type:"INDEX",value:[]}]);return e.topDicts=[{name:"topDict_0",type:"TABLE",value:t}],e}function TW(t){var e=new Bt.Record("String INDEX",[{name:"strings",type:"INDEX",value:[]}]);e.strings=[];for(var r=0;r<t.length;r+=1)e.strings.push({name:"string_"+r,type:"STRING",value:t[r]});return e}function NW(){return new Bt.Record("Global Subr INDEX",[{name:"subrs",type:"INDEX",value:[]}])}function PW(t,e){for(var r=new Bt.Record("Charsets",[{name:"format",type:"Card8",value:0}]),n=0;n<t.length;n+=1){var i=t[n],a=eL(i,e);r.fields.push({name:"glyph_"+n,type:"SID",value:a})}return r}function MW(t){var e=[],r=t.path;e.push({name:"width",type:"NUMBER",value:t.advanceWidth});for(var n=0,i=0,a=0;a<r.commands.length;a+=1){var s=void 0,o=void 0,l=r.commands[a];if(l.type==="Q"){var u=.3333333333333333,c=2/3;l={type:"C",x:l.x,y:l.y,x1:Math.round(u*n+c*l.x1),y1:Math.round(u*i+c*l.y1),x2:Math.round(u*l.x+c*l.x1),y2:Math.round(u*l.y+c*l.y1)}}if(l.type==="M")s=Math.round(l.x-n),o=Math.round(l.y-i),e.push({name:"dx",type:"NUMBER",value:s}),e.push({name:"dy",type:"NUMBER",value:o}),e.push({name:"rmoveto",type:"OP",value:21}),n=Math.round(l.x),i=Math.round(l.y);else if(l.type==="L")s=Math.round(l.x-n),o=Math.round(l.y-i),e.push({name:"dx",type:"NUMBER",value:s}),e.push({name:"dy",type:"NUMBER",value:o}),e.push({name:"rlineto",type:"OP",value:5}),n=Math.round(l.x),i=Math.round(l.y);else if(l.type==="C"){var f=Math.round(l.x1-n),p=Math.round(l.y1-i),v=Math.round(l.x2-l.x1),y=Math.round(l.y2-l.y1);s=Math.round(l.x-l.x2),o=Math.round(l.y-l.y2),e.push({name:"dx1",type:"NUMBER",value:f}),e.push({name:"dy1",type:"NUMBER",value:p}),e.push({name:"dx2",type:"NUMBER",value:v}),e.push({name:"dy2",type:"NUMBER",value:y}),e.push({name:"dx",type:"NUMBER",value:s}),e.push({name:"dy",type:"NUMBER",value:o}),e.push({name:"rrcurveto",type:"OP",value:8}),n=Math.round(l.x),i=Math.round(l.y)}}return e.push({name:"endchar",type:"OP",value:14}),e}function AW(t){for(var e=new Bt.Record("CharStrings INDEX",[{name:"charStrings",type:"INDEX",value:[]}]),r=0;r<t.length;r+=1){var n=t.get(r),i=MW(n);e.charStrings.push({name:n.name,type:"CHARSTRING",value:i})}return e}function RW(t,e){var r=new Bt.Record("Private DICT",[{name:"dict",type:"DICT",value:{}}]);return r.dict=tL(QR,t,e),r}function LW(t,e){for(var r=new Bt.Table("CFF ",[{name:"header",type:"RECORD"},{name:"nameIndex",type:"RECORD"},{name:"topDictIndex",type:"RECORD"},{name:"stringIndex",type:"RECORD"},{name:"globalSubrIndex",type:"RECORD"},{name:"charsets",type:"RECORD"},{name:"charStringsIndex",type:"RECORD"},{name:"privateDict",type:"RECORD"}]),n=1/e.unitsPerEm,i={version:e.version,fullName:e.fullName,familyName:e.familyName,weight:e.weightName,fontBBox:e.fontBBox||[0,0,0,0],fontMatrix:[n,0,0,n,0,0],charset:999,encoding:0,charStrings:999,private:[0,999]},a={},s=[],o,l=1;l<t.length;l+=1)o=t.get(l),s.push(o.name);var u=[];r.header=CW(),r.nameIndex=EW([e.postScriptName]);var c=M4(i,u);r.topDictIndex=A4(c),r.globalSubrIndex=NW(),r.charsets=PW(s,u),r.charStringsIndex=AW(t),r.privateDict=RW(a,u),r.stringIndex=TW(u);var f=r.header.sizeOf()+r.nameIndex.sizeOf()+r.topDictIndex.sizeOf()+r.stringIndex.sizeOf()+r.globalSubrIndex.sizeOf();return i.charset=f,i.encoding=0,i.charStrings=i.charset+r.charsets.sizeOf(),i.private[1]=i.charStrings+r.charStringsIndex.sizeOf(),c=M4(i,u),r.topDictIndex=A4(c),r}var OW={parse:_W,make:LW};function DW(t,e){var r={},n=new gr.Parser(t,e);return r.version=n.parseVersion(),r.fontRevision=Math.round(n.parseFixed()*1e3)/1e3,r.checkSumAdjustment=n.parseULong(),r.magicNumber=n.parseULong(),pr.argument(r.magicNumber===1594834165,"Font header has wrong magic number."),r.flags=n.parseUShort(),r.unitsPerEm=n.parseUShort(),r.created=n.parseLongDateTime(),r.modified=n.parseLongDateTime(),r.xMin=n.parseShort(),r.yMin=n.parseShort(),r.xMax=n.parseShort(),r.yMax=n.parseShort(),r.macStyle=n.parseUShort(),r.lowestRecPPEM=n.parseUShort(),r.fontDirectionHint=n.parseShort(),r.indexToLocFormat=n.parseShort(),r.glyphDataFormat=n.parseShort(),r}function IW(t){var e=Math.round(new Date().getTime()/1e3)+2082844800,r=e;return t.createdTimestamp&&(r=t.createdTimestamp+2082844800),new Bt.Table("head",[{name:"version",type:"FIXED",value:65536},{name:"fontRevision",type:"FIXED",value:65536},{name:"checkSumAdjustment",type:"ULONG",value:0},{name:"magicNumber",type:"ULONG",value:1594834165},{name:"flags",type:"USHORT",value:0},{name:"unitsPerEm",type:"USHORT",value:1e3},{name:"created",type:"LONGDATETIME",value:r},{name:"modified",type:"LONGDATETIME",value:e},{name:"xMin",type:"SHORT",value:0},{name:"yMin",type:"SHORT",value:0},{name:"xMax",type:"SHORT",value:0},{name:"yMax",type:"SHORT",value:0},{name:"macStyle",type:"USHORT",value:0},{name:"lowestRecPPEM",type:"USHORT",value:0},{name:"fontDirectionHint",type:"SHORT",value:2},{name:"indexToLocFormat",type:"SHORT",value:0},{name:"glyphDataFormat",type:"SHORT",value:0}],t)}var jW={parse:DW,make:IW};function FW(t,e){var r={},n=new gr.Parser(t,e);return r.version=n.parseVersion(),r.ascender=n.parseShort(),r.descender=n.parseShort(),r.lineGap=n.parseShort(),r.advanceWidthMax=n.parseUShort(),r.minLeftSideBearing=n.parseShort(),r.minRightSideBearing=n.parseShort(),r.xMaxExtent=n.parseShort(),r.caretSlopeRise=n.parseShort(),r.caretSlopeRun=n.parseShort(),r.caretOffset=n.parseShort(),n.relativeOffset+=8,r.metricDataFormat=n.parseShort(),r.numberOfHMetrics=n.parseUShort(),r}function BW(t){return new Bt.Table("hhea",[{name:"version",type:"FIXED",value:65536},{name:"ascender",type:"FWORD",value:0},{name:"descender",type:"FWORD",value:0},{name:"lineGap",type:"FWORD",value:0},{name:"advanceWidthMax",type:"UFWORD",value:0},{name:"minLeftSideBearing",type:"FWORD",value:0},{name:"minRightSideBearing",type:"FWORD",value:0},{name:"xMaxExtent",type:"FWORD",value:0},{name:"caretSlopeRise",type:"SHORT",value:1},{name:"caretSlopeRun",type:"SHORT",value:0},{name:"caretOffset",type:"SHORT",value:0},{name:"reserved1",type:"SHORT",value:0},{name:"reserved2",type:"SHORT",value:0},{name:"reserved3",type:"SHORT",value:0},{name:"reserved4",type:"SHORT",value:0},{name:"metricDataFormat",type:"SHORT",value:0},{name:"numberOfHMetrics",type:"USHORT",value:0}],t)}var zW={parse:FW,make:BW};function UW(t,e,r,n,i){for(var a,s,o=new gr.Parser(t,e),l=0;l<n;l+=1){l<r&&(a=o.parseUShort(),s=o.parseShort());var u=i.get(l);u.advanceWidth=a,u.leftSideBearing=s}}function GW(t,e,r,n,i){t._hmtxTableData={};for(var a,s,o=new gr.Parser(e,r),l=0;l<i;l+=1)l<n&&(a=o.parseUShort(),s=o.parseShort()),t._hmtxTableData[l]={advanceWidth:a,leftSideBearing:s}}function VW(t,e,r,n,i,a,s){s.lowMemory?GW(t,e,r,n,i):UW(e,r,n,i,a)}function HW(t){for(var e=new Bt.Table("hmtx",[]),r=0;r<t.length;r+=1){var n=t.get(r),i=n.advanceWidth||0,a=n.leftSideBearing||0;e.fields.push({name:"advanceWidth_"+r,type:"USHORT",value:i}),e.fields.push({name:"leftSideBearing_"+r,type:"SHORT",value:a})}return e}var WW={parse:VW,make:HW};function qW(t){for(var e=new Bt.Table("ltag",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"numTags",type:"ULONG",value:t.length}]),r="",n=12+t.length*4,i=0;i<t.length;++i){var a=r.indexOf(t[i]);a<0&&(a=r.length,r+=t[i]),e.fields.push({name:"offset "+i,type:"USHORT",value:n+a}),e.fields.push({name:"length "+i,type:"USHORT",value:t[i].length})}return e.fields.push({name:"stringPool",type:"CHARARRAY",value:r}),e}function $W(t,e){var r=new gr.Parser(t,e),n=r.parseULong();pr.argument(n===1,"Unsupported ltag table version."),r.skip("uLong",1);for(var i=r.parseULong(),a=[],s=0;s<i;s++){for(var o="",l=e+r.parseUShort(),u=r.parseUShort(),c=l;c<l+u;++c)o+=String.fromCharCode(t.getInt8(c));a.push(o)}return a}var KW={make:qW,parse:$W};function ZW(t,e){var r={},n=new gr.Parser(t,e);return r.version=n.parseVersion(),r.numGlyphs=n.parseUShort(),r.version===1&&(r.maxPoints=n.parseUShort(),r.maxContours=n.parseUShort(),r.maxCompositePoints=n.parseUShort(),r.maxCompositeContours=n.parseUShort(),r.maxZones=n.parseUShort(),r.maxTwilightPoints=n.parseUShort(),r.maxStorage=n.parseUShort(),r.maxFunctionDefs=n.parseUShort(),r.maxInstructionDefs=n.parseUShort(),r.maxStackElements=n.parseUShort(),r.maxSizeOfInstructions=n.parseUShort(),r.maxComponentElements=n.parseUShort(),r.maxComponentDepth=n.parseUShort()),r}function YW(t){return new Bt.Table("maxp",[{name:"version",type:"FIXED",value:20480},{name:"numGlyphs",type:"USHORT",value:t}])}var XW={parse:ZW,make:YW},rL=["copyright","fontFamily","fontSubfamily","uniqueID","fullName","version","postScriptName","trademark","manufacturer","designer","description","manufacturerURL","designerURL","license","licenseURL","reserved","preferredFamily","preferredSubfamily","compatibleFullName","sampleText","postScriptFindFontName","wwsFamily","wwsSubfamily"],nL={0:"en",1:"fr",2:"de",3:"it",4:"nl",5:"sv",6:"es",7:"da",8:"pt",9:"no",10:"he",11:"ja",12:"ar",13:"fi",14:"el",15:"is",16:"mt",17:"tr",18:"hr",19:"zh-Hant",20:"ur",21:"hi",22:"th",23:"ko",24:"lt",25:"pl",26:"hu",27:"es",28:"lv",29:"se",30:"fo",31:"fa",32:"ru",33:"zh",34:"nl-BE",35:"ga",36:"sq",37:"ro",38:"cz",39:"sk",40:"si",41:"yi",42:"sr",43:"mk",44:"bg",45:"uk",46:"be",47:"uz",48:"kk",49:"az-Cyrl",50:"az-Arab",51:"hy",52:"ka",53:"mo",54:"ky",55:"tg",56:"tk",57:"mn-CN",58:"mn",59:"ps",60:"ks",61:"ku",62:"sd",63:"bo",64:"ne",65:"sa",66:"mr",67:"bn",68:"as",69:"gu",70:"pa",71:"or",72:"ml",73:"kn",74:"ta",75:"te",76:"si",77:"my",78:"km",79:"lo",80:"vi",81:"id",82:"tl",83:"ms",84:"ms-Arab",85:"am",86:"ti",87:"om",88:"so",89:"sw",90:"rw",91:"rn",92:"ny",93:"mg",94:"eo",128:"cy",129:"eu",130:"ca",131:"la",132:"qu",133:"gn",134:"ay",135:"tt",136:"ug",137:"dz",138:"jv",139:"su",140:"gl",141:"af",142:"br",143:"iu",144:"gd",145:"gv",146:"ga",147:"to",148:"el-polyton",149:"kl",150:"az",151:"nn"},QW={0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:5,11:1,12:4,13:0,14:6,15:0,16:0,17:0,18:0,19:2,20:4,21:9,22:21,23:3,24:29,25:29,26:29,27:29,28:29,29:0,30:0,31:4,32:7,33:25,34:0,35:0,36:0,37:0,38:29,39:29,40:0,41:5,42:7,43:7,44:7,45:7,46:7,47:7,48:7,49:7,50:4,51:24,52:23,53:7,54:7,55:7,56:7,57:27,58:7,59:4,60:4,61:4,62:4,63:26,64:9,65:9,66:9,67:13,68:13,69:11,70:10,71:12,72:17,73:16,74:14,75:15,76:18,77:19,78:20,79:22,80:30,81:0,82:0,83:0,84:4,85:28,86:28,87:28,88:0,89:0,90:0,91:0,92:0,93:0,94:0,128:0,129:0,130:0,131:0,132:0,133:0,134:0,135:7,136:4,137:26,138:0,139:0,140:0,141:0,142:0,143:28,144:0,145:0,146:0,147:0,148:6,149:0,150:0,151:0},iL={1078:"af",1052:"sq",1156:"gsw",1118:"am",5121:"ar-DZ",15361:"ar-BH",3073:"ar",2049:"ar-IQ",11265:"ar-JO",13313:"ar-KW",12289:"ar-LB",4097:"ar-LY",6145:"ary",8193:"ar-OM",16385:"ar-QA",1025:"ar-SA",10241:"ar-SY",7169:"aeb",14337:"ar-AE",9217:"ar-YE",1067:"hy",1101:"as",2092:"az-Cyrl",1068:"az",1133:"ba",1069:"eu",1059:"be",2117:"bn",1093:"bn-IN",8218:"bs-Cyrl",5146:"bs",1150:"br",1026:"bg",1027:"ca",3076:"zh-HK",5124:"zh-MO",2052:"zh",4100:"zh-SG",1028:"zh-TW",1155:"co",1050:"hr",4122:"hr-BA",1029:"cs",1030:"da",1164:"prs",1125:"dv",2067:"nl-BE",1043:"nl",3081:"en-AU",10249:"en-BZ",4105:"en-CA",9225:"en-029",16393:"en-IN",6153:"en-IE",8201:"en-JM",17417:"en-MY",5129:"en-NZ",13321:"en-PH",18441:"en-SG",7177:"en-ZA",11273:"en-TT",2057:"en-GB",1033:"en",12297:"en-ZW",1061:"et",1080:"fo",1124:"fil",1035:"fi",2060:"fr-BE",3084:"fr-CA",1036:"fr",5132:"fr-LU",6156:"fr-MC",4108:"fr-CH",1122:"fy",1110:"gl",1079:"ka",3079:"de-AT",1031:"de",5127:"de-LI",4103:"de-LU",2055:"de-CH",1032:"el",1135:"kl",1095:"gu",1128:"ha",1037:"he",1081:"hi",1038:"hu",1039:"is",1136:"ig",1057:"id",1117:"iu",2141:"iu-Latn",2108:"ga",1076:"xh",1077:"zu",1040:"it",2064:"it-CH",1041:"ja",1099:"kn",1087:"kk",1107:"km",1158:"quc",1159:"rw",1089:"sw",1111:"kok",1042:"ko",1088:"ky",1108:"lo",1062:"lv",1063:"lt",2094:"dsb",1134:"lb",1071:"mk",2110:"ms-BN",1086:"ms",1100:"ml",1082:"mt",1153:"mi",1146:"arn",1102:"mr",1148:"moh",1104:"mn",2128:"mn-CN",1121:"ne",1044:"nb",2068:"nn",1154:"oc",1096:"or",1123:"ps",1045:"pl",1046:"pt",2070:"pt-PT",1094:"pa",1131:"qu-BO",2155:"qu-EC",3179:"qu",1048:"ro",1047:"rm",1049:"ru",9275:"smn",4155:"smj-NO",5179:"smj",3131:"se-FI",1083:"se",2107:"se-SE",8251:"sms",6203:"sma-NO",7227:"sms",1103:"sa",7194:"sr-Cyrl-BA",3098:"sr",6170:"sr-Latn-BA",2074:"sr-Latn",1132:"nso",1074:"tn",1115:"si",1051:"sk",1060:"sl",11274:"es-AR",16394:"es-BO",13322:"es-CL",9226:"es-CO",5130:"es-CR",7178:"es-DO",12298:"es-EC",17418:"es-SV",4106:"es-GT",18442:"es-HN",2058:"es-MX",19466:"es-NI",6154:"es-PA",15370:"es-PY",10250:"es-PE",20490:"es-PR",3082:"es",1034:"es",21514:"es-US",14346:"es-UY",8202:"es-VE",2077:"sv-FI",1053:"sv",1114:"syr",1064:"tg",2143:"tzm",1097:"ta",1092:"tt",1098:"te",1054:"th",1105:"bo",1055:"tr",1090:"tk",1152:"ug",1058:"uk",1070:"hsb",1056:"ur",2115:"uz-Cyrl",1091:"uz",1066:"vi",1106:"cy",1160:"wo",1157:"sah",1144:"ii",1130:"yo"};function JW(t,e,r){switch(t){case 0:if(e===65535)return"und";if(r)return r[e];break;case 1:return nL[e];case 3:return iL[e]}}var sk="utf-16",eq={0:"macintosh",1:"x-mac-japanese",2:"x-mac-chinesetrad",3:"x-mac-korean",6:"x-mac-greek",7:"x-mac-cyrillic",9:"x-mac-devanagai",10:"x-mac-gurmukhi",11:"x-mac-gujarati",12:"x-mac-oriya",13:"x-mac-bengali",14:"x-mac-tamil",15:"x-mac-telugu",16:"x-mac-kannada",17:"x-mac-malayalam",18:"x-mac-sinhalese",19:"x-mac-burmese",20:"x-mac-khmer",21:"x-mac-thai",22:"x-mac-lao",23:"x-mac-georgian",24:"x-mac-armenian",25:"x-mac-chinesesimp",26:"x-mac-tibetan",27:"x-mac-mongolian",28:"x-mac-ethiopic",29:"x-mac-ce",30:"x-mac-vietnamese",31:"x-mac-extarabic"},tq={15:"x-mac-icelandic",17:"x-mac-turkish",18:"x-mac-croatian",24:"x-mac-ce",25:"x-mac-ce",26:"x-mac-ce",27:"x-mac-ce",28:"x-mac-ce",30:"x-mac-icelandic",37:"x-mac-romanian",38:"x-mac-ce",39:"x-mac-ce",40:"x-mac-ce",143:"x-mac-inuit",146:"x-mac-gaelic"};function aL(t,e,r){switch(t){case 0:return sk;case 1:return tq[r]||eq[e];case 3:if(e===1||e===10)return sk;break}}function rq(t,e,r){for(var n={},i=new gr.Parser(t,e),a=i.parseUShort(),s=i.parseUShort(),o=i.offset+i.parseUShort(),l=0;l<s;l++){var u=i.parseUShort(),c=i.parseUShort(),f=i.parseUShort(),p=i.parseUShort(),v=rL[p]||p,y=i.parseUShort(),S=i.parseUShort(),w=JW(u,f,r),E=aL(u,c,f);if(E!==void 0&&w!==void 0){var _=void 0;if(E===sk?_=Kp.UTF16(t,o+S,y):_=Kp.MACSTRING(t,o+S,y,E),_){var T=n[v];T===void 0&&(T=n[v]={}),T[w]=_}}}return a===1&&i.parseUShort(),n}function B2(t){var e={};for(var r in t)e[t[r]]=parseInt(r);return e}function R4(t,e,r,n,i,a){return new Bt.Record("NameRecord",[{name:"platformID",type:"USHORT",value:t},{name:"encodingID",type:"USHORT",value:e},{name:"languageID",type:"USHORT",value:r},{name:"nameID",type:"USHORT",value:n},{name:"length",type:"USHORT",value:i},{name:"offset",type:"USHORT",value:a}])}function nq(t,e){var r=t.length,n=e.length-r+1;e:for(var i=0;i<n;i++)for(;i<n;i++){for(var a=0;a<r;a++)if(e[i+a]!==t[a])continue e;return i}return-1}function L4(t,e){var r=nq(t,e);if(r<0){r=e.length;for(var n=0,i=t.length;n<i;++n)e.push(t[n])}return r}function iq(t,e){var r,n=[],i={},a=B2(rL);for(var s in t){var o=a[s];if(o===void 0&&(o=s),r=parseInt(o),isNaN(r))throw new Error('Name table entry "'+s+'" does not exist, see nameTableNames for complete list.');i[r]=t[s],n.push(r)}for(var l=B2(nL),u=B2(iL),c=[],f=[],p=0;p<n.length;p++){r=n[p];var v=i[r];for(var y in v){var S=v[y],w=1,E=l[y],_=QW[E],T=aL(w,_,E),N=_t.MACSTRING(S,T);N===void 0&&(w=0,E=e.indexOf(y),E<0&&(E=e.length,e.push(y)),_=4,N=_t.UTF16(S));var R=L4(N,f);c.push(R4(w,_,E,r,N.length,R));var I=u[y];if(I!==void 0){var F=_t.UTF16(S),D=L4(F,f);c.push(R4(3,1,I,r,F.length,D))}}}c.sort(function(G,K){return G.platformID-K.platformID||G.encodingID-K.encodingID||G.languageID-K.languageID||G.nameID-K.nameID});for(var j=new Bt.Table("name",[{name:"format",type:"USHORT",value:0},{name:"count",type:"USHORT",value:c.length},{name:"stringOffset",type:"USHORT",value:6+c.length*12}]),B=0;B<c.length;B++)j.fields.push({name:"record_"+B,type:"RECORD",value:c[B]});return j.fields.push({name:"strings",type:"LITERAL",value:f}),j}var aq={parse:rq,make:iq},ok=[{begin:0,end:127},{begin:128,end:255},{begin:256,end:383},{begin:384,end:591},{begin:592,end:687},{begin:688,end:767},{begin:768,end:879},{begin:880,end:1023},{begin:11392,end:11519},{begin:1024,end:1279},{begin:1328,end:1423},{begin:1424,end:1535},{begin:42240,end:42559},{begin:1536,end:1791},{begin:1984,end:2047},{begin:2304,end:2431},{begin:2432,end:2559},{begin:2560,end:2687},{begin:2688,end:2815},{begin:2816,end:2943},{begin:2944,end:3071},{begin:3072,end:3199},{begin:3200,end:3327},{begin:3328,end:3455},{begin:3584,end:3711},{begin:3712,end:3839},{begin:4256,end:4351},{begin:6912,end:7039},{begin:4352,end:4607},{begin:7680,end:7935},{begin:7936,end:8191},{begin:8192,end:8303},{begin:8304,end:8351},{begin:8352,end:8399},{begin:8400,end:8447},{begin:8448,end:8527},{begin:8528,end:8591},{begin:8592,end:8703},{begin:8704,end:8959},{begin:8960,end:9215},{begin:9216,end:9279},{begin:9280,end:9311},{begin:9312,end:9471},{begin:9472,end:9599},{begin:9600,end:9631},{begin:9632,end:9727},{begin:9728,end:9983},{begin:9984,end:10175},{begin:12288,end:12351},{begin:12352,end:12447},{begin:12448,end:12543},{begin:12544,end:12591},{begin:12592,end:12687},{begin:43072,end:43135},{begin:12800,end:13055},{begin:13056,end:13311},{begin:44032,end:55215},{begin:55296,end:57343},{begin:67840,end:67871},{begin:19968,end:40959},{begin:57344,end:63743},{begin:12736,end:12783},{begin:64256,end:64335},{begin:64336,end:65023},{begin:65056,end:65071},{begin:65040,end:65055},{begin:65104,end:65135},{begin:65136,end:65279},{begin:65280,end:65519},{begin:65520,end:65535},{begin:3840,end:4095},{begin:1792,end:1871},{begin:1920,end:1983},{begin:3456,end:3583},{begin:4096,end:4255},{begin:4608,end:4991},{begin:5024,end:5119},{begin:5120,end:5759},{begin:5760,end:5791},{begin:5792,end:5887},{begin:6016,end:6143},{begin:6144,end:6319},{begin:10240,end:10495},{begin:40960,end:42127},{begin:5888,end:5919},{begin:66304,end:66351},{begin:66352,end:66383},{begin:66560,end:66639},{begin:118784,end:119039},{begin:119808,end:120831},{begin:1044480,end:1048573},{begin:65024,end:65039},{begin:917504,end:917631},{begin:6400,end:6479},{begin:6480,end:6527},{begin:6528,end:6623},{begin:6656,end:6687},{begin:11264,end:11359},{begin:11568,end:11647},{begin:19904,end:19967},{begin:43008,end:43055},{begin:65536,end:65663},{begin:65856,end:65935},{begin:66432,end:66463},{begin:66464,end:66527},{begin:66640,end:66687},{begin:66688,end:66735},{begin:67584,end:67647},{begin:68096,end:68191},{begin:119552,end:119647},{begin:73728,end:74751},{begin:119648,end:119679},{begin:7040,end:7103},{begin:7168,end:7247},{begin:7248,end:7295},{begin:43136,end:43231},{begin:43264,end:43311},{begin:43312,end:43359},{begin:43520,end:43615},{begin:65936,end:65999},{begin:66e3,end:66047},{begin:66208,end:66271},{begin:127024,end:127135}];function sq(t){for(var e=0;e<ok.length;e+=1){var r=ok[e];if(t>=r.begin&&t<r.end)return e}return-1}function oq(t,e){var r={},n=new gr.Parser(t,e);r.version=n.parseUShort(),r.xAvgCharWidth=n.parseShort(),r.usWeightClass=n.parseUShort(),r.usWidthClass=n.parseUShort(),r.fsType=n.parseUShort(),r.ySubscriptXSize=n.parseShort(),r.ySubscriptYSize=n.parseShort(),r.ySubscriptXOffset=n.parseShort(),r.ySubscriptYOffset=n.parseShort(),r.ySuperscriptXSize=n.parseShort(),r.ySuperscriptYSize=n.parseShort(),r.ySuperscriptXOffset=n.parseShort(),r.ySuperscriptYOffset=n.parseShort(),r.yStrikeoutSize=n.parseShort(),r.yStrikeoutPosition=n.parseShort(),r.sFamilyClass=n.parseShort(),r.panose=[];for(var i=0;i<10;i++)r.panose[i]=n.parseByte();return r.ulUnicodeRange1=n.parseULong(),r.ulUnicodeRange2=n.parseULong(),r.ulUnicodeRange3=n.parseULong(),r.ulUnicodeRange4=n.parseULong(),r.achVendID=String.fromCharCode(n.parseByte(),n.parseByte(),n.parseByte(),n.parseByte()),r.fsSelection=n.parseUShort(),r.usFirstCharIndex=n.parseUShort(),r.usLastCharIndex=n.parseUShort(),r.sTypoAscender=n.parseShort(),r.sTypoDescender=n.parseShort(),r.sTypoLineGap=n.parseShort(),r.usWinAscent=n.parseUShort(),r.usWinDescent=n.parseUShort(),r.version>=1&&(r.ulCodePageRange1=n.parseULong(),r.ulCodePageRange2=n.parseULong()),r.version>=2&&(r.sxHeight=n.parseShort(),r.sCapHeight=n.parseShort(),r.usDefaultChar=n.parseUShort(),r.usBreakChar=n.parseUShort(),r.usMaxContent=n.parseUShort()),r}function lq(t){return new Bt.Table("OS/2",[{name:"version",type:"USHORT",value:3},{name:"xAvgCharWidth",type:"SHORT",value:0},{name:"usWeightClass",type:"USHORT",value:0},{name:"usWidthClass",type:"USHORT",value:0},{name:"fsType",type:"USHORT",value:0},{name:"ySubscriptXSize",type:"SHORT",value:650},{name:"ySubscriptYSize",type:"SHORT",value:699},{name:"ySubscriptXOffset",type:"SHORT",value:0},{name:"ySubscriptYOffset",type:"SHORT",value:140},{name:"ySuperscriptXSize",type:"SHORT",value:650},{name:"ySuperscriptYSize",type:"SHORT",value:699},{name:"ySuperscriptXOffset",type:"SHORT",value:0},{name:"ySuperscriptYOffset",type:"SHORT",value:479},{name:"yStrikeoutSize",type:"SHORT",value:49},{name:"yStrikeoutPosition",type:"SHORT",value:258},{name:"sFamilyClass",type:"SHORT",value:0},{name:"bFamilyType",type:"BYTE",value:0},{name:"bSerifStyle",type:"BYTE",value:0},{name:"bWeight",type:"BYTE",value:0},{name:"bProportion",type:"BYTE",value:0},{name:"bContrast",type:"BYTE",value:0},{name:"bStrokeVariation",type:"BYTE",value:0},{name:"bArmStyle",type:"BYTE",value:0},{name:"bLetterform",type:"BYTE",value:0},{name:"bMidline",type:"BYTE",value:0},{name:"bXHeight",type:"BYTE",value:0},{name:"ulUnicodeRange1",type:"ULONG",value:0},{name:"ulUnicodeRange2",type:"ULONG",value:0},{name:"ulUnicodeRange3",type:"ULONG",value:0},{name:"ulUnicodeRange4",type:"ULONG",value:0},{name:"achVendID",type:"CHARARRAY",value:"XXXX"},{name:"fsSelection",type:"USHORT",value:0},{name:"usFirstCharIndex",type:"USHORT",value:0},{name:"usLastCharIndex",type:"USHORT",value:0},{name:"sTypoAscender",type:"SHORT",value:0},{name:"sTypoDescender",type:"SHORT",value:0},{name:"sTypoLineGap",type:"SHORT",value:0},{name:"usWinAscent",type:"USHORT",value:0},{name:"usWinDescent",type:"USHORT",value:0},{name:"ulCodePageRange1",type:"ULONG",value:0},{name:"ulCodePageRange2",type:"ULONG",value:0},{name:"sxHeight",type:"SHORT",value:0},{name:"sCapHeight",type:"SHORT",value:0},{name:"usDefaultChar",type:"USHORT",value:0},{name:"usBreakChar",type:"USHORT",value:0},{name:"usMaxContext",type:"USHORT",value:0}],t)}var O4={parse:oq,make:lq,unicodeRanges:ok,getUnicodeRange:sq};function uq(t,e){var r={},n=new gr.Parser(t,e);switch(r.version=n.parseVersion(),r.italicAngle=n.parseFixed(),r.underlinePosition=n.parseShort(),r.underlineThickness=n.parseShort(),r.isFixedPitch=n.parseULong(),r.minMemType42=n.parseULong(),r.maxMemType42=n.parseULong(),r.minMemType1=n.parseULong(),r.maxMemType1=n.parseULong(),r.version){case 1:r.names=T4.slice();break;case 2:r.numberOfGlyphs=n.parseUShort(),r.glyphNameIndex=new Array(r.numberOfGlyphs);for(var i=0;i<r.numberOfGlyphs;i++)r.glyphNameIndex[i]=n.parseUShort();r.names=[];for(var a=0;a<r.numberOfGlyphs;a++)if(r.glyphNameIndex[a]>=T4.length){var s=n.parseChar();r.names.push(n.parseString(s))}break;case 2.5:r.numberOfGlyphs=n.parseUShort(),r.offset=new Array(r.numberOfGlyphs);for(var o=0;o<r.numberOfGlyphs;o++)r.offset[o]=n.parseChar();break}return r}function cq(){return new Bt.Table("post",[{name:"version",type:"FIXED",value:196608},{name:"italicAngle",type:"FIXED",value:0},{name:"underlinePosition",type:"FWORD",value:0},{name:"underlineThickness",type:"FWORD",value:0},{name:"isFixedPitch",type:"ULONG",value:0},{name:"minMemType42",type:"ULONG",value:0},{name:"maxMemType42",type:"ULONG",value:0},{name:"minMemType1",type:"ULONG",value:0},{name:"maxMemType1",type:"ULONG",value:0}])}var dq={parse:uq,make:cq},Fl=new Array(9);Fl[1]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{substFormat:1,coverage:this.parsePointer(We.coverage),deltaGlyphId:this.parseUShort()};if(r===2)return{substFormat:2,coverage:this.parsePointer(We.coverage),substitute:this.parseOffset16List()};pr.assert(!1,"0x"+e.toString(16)+": lookup type 1 format must be 1 or 2.")};Fl[2]=function(){var e=this.parseUShort();return pr.argument(e===1,"GSUB Multiple Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(We.coverage),sequences:this.parseListOfLists()}};Fl[3]=function(){var e=this.parseUShort();return pr.argument(e===1,"GSUB Alternate Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(We.coverage),alternateSets:this.parseListOfLists()}};Fl[4]=function(){var e=this.parseUShort();return pr.argument(e===1,"GSUB ligature table identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(We.coverage),ligatureSets:this.parseListOfLists(function(){return{ligGlyph:this.parseUShort(),components:this.parseUShortList(this.parseUShort()-1)}})}};var Up={sequenceIndex:We.uShort,lookupListIndex:We.uShort};Fl[5]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{substFormat:r,coverage:this.parsePointer(We.coverage),ruleSets:this.parseListOfLists(function(){var a=this.parseUShort(),s=this.parseUShort();return{input:this.parseUShortList(a-1),lookupRecords:this.parseRecordList(s,Up)}})};if(r===2)return{substFormat:r,coverage:this.parsePointer(We.coverage),classDef:this.parsePointer(We.classDef),classSets:this.parseListOfLists(function(){var a=this.parseUShort(),s=this.parseUShort();return{classes:this.parseUShortList(a-1),lookupRecords:this.parseRecordList(s,Up)}})};if(r===3){var n=this.parseUShort(),i=this.parseUShort();return{substFormat:r,coverages:this.parseList(n,We.pointer(We.coverage)),lookupRecords:this.parseRecordList(i,Up)}}pr.assert(!1,"0x"+e.toString(16)+": lookup type 5 format must be 1, 2 or 3.")};Fl[6]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{substFormat:1,coverage:this.parsePointer(We.coverage),chainRuleSets:this.parseListOfLists(function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(Up)}})};if(r===2)return{substFormat:2,coverage:this.parsePointer(We.coverage),backtrackClassDef:this.parsePointer(We.classDef),inputClassDef:this.parsePointer(We.classDef),lookaheadClassDef:this.parsePointer(We.classDef),chainClassSet:this.parseListOfLists(function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(Up)}})};if(r===3)return{substFormat:3,backtrackCoverage:this.parseList(We.pointer(We.coverage)),inputCoverage:this.parseList(We.pointer(We.coverage)),lookaheadCoverage:this.parseList(We.pointer(We.coverage)),lookupRecords:this.parseRecordList(Up)};pr.assert(!1,"0x"+e.toString(16)+": lookup type 6 format must be 1, 2 or 3.")};Fl[7]=function(){var e=this.parseUShort();pr.argument(e===1,"GSUB Extension Substitution subtable identifier-format must be 1");var r=this.parseUShort(),n=new We(this.data,this.offset+this.parseULong());return{substFormat:1,lookupType:r,extension:Fl[r].call(n)}};Fl[8]=function(){var e=this.parseUShort();return pr.argument(e===1,"GSUB Reverse Chaining Contextual Single Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(We.coverage),backtrackCoverage:this.parseList(We.pointer(We.coverage)),lookaheadCoverage:this.parseList(We.pointer(We.coverage)),substitutes:this.parseUShortList()}};function fq(t,e){e=e||0;var r=new We(t,e),n=r.parseVersion(1);return pr.argument(n===1||n===1.1,"Unsupported GSUB table version."),n===1?{version:n,scripts:r.parseScriptList(),features:r.parseFeatureList(),lookups:r.parseLookupList(Fl)}:{version:n,scripts:r.parseScriptList(),features:r.parseFeatureList(),lookups:r.parseLookupList(Fl),variations:r.parseFeatureVariationsList()}}var mm=new Array(9);mm[1]=function(e){return e.substFormat===1?new Bt.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new Bt.Coverage(e.coverage)},{name:"deltaGlyphID",type:"USHORT",value:e.deltaGlyphId}]):new Bt.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:2},{name:"coverage",type:"TABLE",value:new Bt.Coverage(e.coverage)}].concat(Bt.ushortList("substitute",e.substitute)))};mm[2]=function(e){return pr.assert(e.substFormat===1,"Lookup type 2 substFormat must be 1."),new Bt.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new Bt.Coverage(e.coverage)}].concat(Bt.tableList("seqSet",e.sequences,function(r){return new Bt.Table("sequenceSetTable",Bt.ushortList("sequence",r))})))};mm[3]=function(e){return pr.assert(e.substFormat===1,"Lookup type 3 substFormat must be 1."),new Bt.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new Bt.Coverage(e.coverage)}].concat(Bt.tableList("altSet",e.alternateSets,function(r){return new Bt.Table("alternateSetTable",Bt.ushortList("alternate",r))})))};mm[4]=function(e){return pr.assert(e.substFormat===1,"Lookup type 4 substFormat must be 1."),new Bt.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new Bt.Coverage(e.coverage)}].concat(Bt.tableList("ligSet",e.ligatureSets,function(r){return new Bt.Table("ligatureSetTable",Bt.tableList("ligature",r,function(n){return new Bt.Table("ligatureTable",[{name:"ligGlyph",type:"USHORT",value:n.ligGlyph}].concat(Bt.ushortList("component",n.components,n.components.length+1)))}))})))};mm[6]=function(e){if(e.substFormat===1){var r=new Bt.Table("chainContextTable",[{name:"substFormat",type:"USHORT",value:e.substFormat},{name:"coverage",type:"TABLE",value:new Bt.Coverage(e.coverage)}].concat(Bt.tableList("chainRuleSet",e.chainRuleSets,function(a){return new Bt.Table("chainRuleSetTable",Bt.tableList("chainRule",a,function(s){var o=Bt.ushortList("backtrackGlyph",s.backtrack,s.backtrack.length).concat(Bt.ushortList("inputGlyph",s.input,s.input.length+1)).concat(Bt.ushortList("lookaheadGlyph",s.lookahead,s.lookahead.length)).concat(Bt.ushortList("substitution",[],s.lookupRecords.length));return s.lookupRecords.forEach(function(l,u){o=o.concat({name:"sequenceIndex"+u,type:"USHORT",value:l.sequenceIndex}).concat({name:"lookupListIndex"+u,type:"USHORT",value:l.lookupListIndex})}),new Bt.Table("chainRuleTable",o)}))})));return r}else if(e.substFormat===2)pr.assert(!1,"lookup type 6 format 2 is not yet supported.");else if(e.substFormat===3){var n=[{name:"substFormat",type:"USHORT",value:e.substFormat}];n.push({name:"backtrackGlyphCount",type:"USHORT",value:e.backtrackCoverage.length}),e.backtrackCoverage.forEach(function(a,s){n.push({name:"backtrackCoverage"+s,type:"TABLE",value:new Bt.Coverage(a)})}),n.push({name:"inputGlyphCount",type:"USHORT",value:e.inputCoverage.length}),e.inputCoverage.forEach(function(a,s){n.push({name:"inputCoverage"+s,type:"TABLE",value:new Bt.Coverage(a)})}),n.push({name:"lookaheadGlyphCount",type:"USHORT",value:e.lookaheadCoverage.length}),e.lookaheadCoverage.forEach(function(a,s){n.push({name:"lookaheadCoverage"+s,type:"TABLE",value:new Bt.Coverage(a)})}),n.push({name:"substitutionCount",type:"USHORT",value:e.lookupRecords.length}),e.lookupRecords.forEach(function(a,s){n=n.concat({name:"sequenceIndex"+s,type:"USHORT",value:a.sequenceIndex}).concat({name:"lookupListIndex"+s,type:"USHORT",value:a.lookupListIndex})});var i=new Bt.Table("chainContextTable",n);return i}pr.assert(!1,"lookup type 6 format must be 1, 2 or 3.")};function hq(t){return new Bt.Table("GSUB",[{name:"version",type:"ULONG",value:65536},{name:"scripts",type:"TABLE",value:new Bt.ScriptList(t.scripts)},{name:"features",type:"TABLE",value:new Bt.FeatureList(t.features)},{name:"lookups",type:"TABLE",value:new Bt.LookupList(t.lookups,mm)}])}var pq={parse:fq,make:hq};function mq(t,e){var r=new gr.Parser(t,e),n=r.parseULong();pr.argument(n===1,"Unsupported META table version."),r.parseULong(),r.parseULong();for(var i=r.parseULong(),a={},s=0;s<i;s++){var o=r.parseTag(),l=r.parseULong(),u=r.parseULong(),c=Kp.UTF8(t,e+l,u);a[o]=c}return a}function gq(t){var e=Object.keys(t).length,r="",n=16+e*12,i=new Bt.Table("meta",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"offset",type:"ULONG",value:n},{name:"numTags",type:"ULONG",value:e}]);for(var a in t){var s=r.length;r+=t[a],i.fields.push({name:"tag "+a,type:"TAG",value:a}),i.fields.push({name:"offset "+a,type:"ULONG",value:n+s}),i.fields.push({name:"length "+a,type:"ULONG",value:t[a].length})}return i.fields.push({name:"stringPool",type:"CHARARRAY",value:r}),i}var vq={parse:mq,make:gq};function D4(t){return Math.log(t)/Math.log(2)|0}function M_(t){for(;t.length%4!==0;)t.push(0);for(var e=0,r=0;r<t.length;r+=4)e+=(t[r]<<24)+(t[r+1]<<16)+(t[r+2]<<8)+t[r+3];return e%=Math.pow(2,32),e}function I4(t,e,r,n){return new Bt.Record("Table Record",[{name:"tag",type:"TAG",value:t!==void 0?t:""},{name:"checkSum",type:"ULONG",value:e!==void 0?e:0},{name:"offset",type:"ULONG",value:r!==void 0?r:0},{name:"length",type:"ULONG",value:n!==void 0?n:0}])}function sL(t){var e=new Bt.Table("sfnt",[{name:"version",type:"TAG",value:"OTTO"},{name:"numTables",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);e.tables=t,e.numTables=t.length;var r=Math.pow(2,D4(e.numTables));e.searchRange=16*r,e.entrySelector=D4(r),e.rangeShift=e.numTables*16-e.searchRange;for(var n=[],i=[],a=e.sizeOf()+I4().sizeOf()*e.numTables;a%4!==0;)a+=1,i.push({name:"padding",type:"BYTE",value:0});for(var s=0;s<t.length;s+=1){var o=t[s];pr.argument(o.tableName.length===4,"Table name"+o.tableName+" is invalid.");var l=o.sizeOf(),u=I4(o.tableName,M_(o.encode()),a,l);for(n.push({name:u.tag+" Table Record",type:"RECORD",value:u}),i.push({name:o.tableName+" table",type:"RECORD",value:o}),a+=l,pr.argument(!isNaN(a),"Something went wrong calculating the offset.");a%4!==0;)a+=1,i.push({name:"padding",type:"BYTE",value:0})}return n.sort(function(c,f){return c.value.tag>f.value.tag?1:-1}),e.fields=e.fields.concat(n),e.fields=e.fields.concat(i),e}function j4(t,e,r){for(var n=0;n<e.length;n+=1){var i=t.charToGlyphIndex(e[n]);if(i>0){var a=t.glyphs.get(i);return a.getMetrics()}}return r}function yq(t){for(var e=0,r=0;r<t.length;r+=1)e+=t[r];return e/t.length}function xq(t){for(var e=[],r=[],n=[],i=[],a=[],s=[],o=[],l,u=0,c=0,f=0,p=0,v=0,y=0;y<t.glyphs.length;y+=1){var S=t.glyphs.get(y),w=S.unicode|0;if(isNaN(S.advanceWidth))throw new Error("Glyph "+S.name+" ("+y+"): advanceWidth is not a number.");(l>w||l===void 0)&&w>0&&(l=w),u<w&&(u=w);var E=O4.getUnicodeRange(w);if(E<32)c|=1<<E;else if(E<64)f|=1<<E-32;else if(E<96)p|=1<<E-64;else if(E<123)v|=1<<E-96;else throw new Error("Unicode ranges bits > 123 are reserved for internal usage");if(S.name!==".notdef"){var _=S.getMetrics();e.push(_.xMin),r.push(_.yMin),n.push(_.xMax),i.push(_.yMax),s.push(_.leftSideBearing),o.push(_.rightSideBearing),a.push(S.advanceWidth)}}var T={xMin:Math.min.apply(null,e),yMin:Math.min.apply(null,r),xMax:Math.max.apply(null,n),yMax:Math.max.apply(null,i),advanceWidthMax:Math.max.apply(null,a),advanceWidthAvg:yq(a),minLeftSideBearing:Math.min.apply(null,s),maxLeftSideBearing:Math.max.apply(null,s),minRightSideBearing:Math.min.apply(null,o)};T.ascender=t.ascender,T.descender=t.descender;var N=jW.make({flags:3,unitsPerEm:t.unitsPerEm,xMin:T.xMin,yMin:T.yMin,xMax:T.xMax,yMax:T.yMax,lowestRecPPEM:3,createdTimestamp:t.createdTimestamp}),R=zW.make({ascender:T.ascender,descender:T.descender,advanceWidthMax:T.advanceWidthMax,minLeftSideBearing:T.minLeftSideBearing,minRightSideBearing:T.minRightSideBearing,xMaxExtent:T.maxLeftSideBearing+(T.xMax-T.xMin),numberOfHMetrics:t.glyphs.length}),I=XW.make(t.glyphs.length),F=O4.make(Object.assign({xAvgCharWidth:Math.round(T.advanceWidthAvg),usFirstCharIndex:l,usLastCharIndex:u,ulUnicodeRange1:c,ulUnicodeRange2:f,ulUnicodeRange3:p,ulUnicodeRange4:v,sTypoAscender:T.ascender,sTypoDescender:T.descender,sTypoLineGap:0,usWinAscent:T.yMax,usWinDescent:Math.abs(T.yMin),ulCodePageRange1:1,sxHeight:j4(t,"xyvw",{yMax:Math.round(T.ascender/2)}).yMax,sCapHeight:j4(t,"HIKLEFJMNTZBDPRAGOQSUVWXY",T).yMax,usDefaultChar:t.hasChar(" ")?32:0,usBreakChar:t.hasChar(" ")?32:0},t.tables.os2)),D=WW.make(t.glyphs),j=sW.make(t.glyphs),B=t.getEnglishName("fontFamily"),G=t.getEnglishName("fontSubfamily"),K=B+" "+G,O=t.getEnglishName("postScriptName");O||(O=B.replace(/\s/g,"")+"-"+G);var W={};for(var U in t.names)W[U]=t.names[U];W.uniqueID||(W.uniqueID={en:t.getEnglishName("manufacturer")+":"+K}),W.postScriptName||(W.postScriptName={en:O}),W.preferredFamily||(W.preferredFamily=t.names.fontFamily),W.preferredSubfamily||(W.preferredSubfamily=t.names.fontSubfamily);var q=[],Z=aq.make(W,q),Q=q.length>0?KW.make(q):void 0,ne=dq.make(),re=OW.make(t.glyphs,{version:t.getEnglishName("version"),fullName:K,familyName:B,weightName:G,postScriptName:O,unitsPerEm:t.unitsPerEm,fontBBox:[0,T.yMin,T.ascender,T.advanceWidthMax]}),Y=t.metas&&Object.keys(t.metas).length>0?vq.make(t.metas):void 0,J=[N,R,I,F,Z,j,ne,re,D];Q&&J.push(Q),t.tables.gsub&&J.push(pq.make(t.tables.gsub)),Y&&J.push(Y);for(var ie=sL(J),de=ie.encode(),he=M_(de),xe=ie.fields,le=!1,fe=0;fe<xe.length;fe+=1)if(xe[fe].name==="head table"){xe[fe].value.checkSumAdjustment=2981146554-he,le=!0;break}if(!le)throw new Error("Could not find head table with checkSum to adjust.");return ie}var bq={make:sL,fontToTable:xq,computeCheckSum:M_};function z2(t,e){for(var r=0,n=t.length-1;r<=n;){var i=r+n>>>1,a=t[i].tag;if(a===e)return i;a<e?r=i+1:n=i-1}return-r-1}function F4(t,e){for(var r=0,n=t.length-1;r<=n;){var i=r+n>>>1,a=t[i];if(a===e)return i;a<e?r=i+1:n=i-1}return-r-1}function B4(t,e){for(var r,n=0,i=t.length-1;n<=i;){var a=n+i>>>1;r=t[a];var s=r.start;if(s===e)return r;s<e?n=a+1:i=a-1}if(n>0)return r=t[n-1],e>r.end?0:r}function a0(t,e){this.font=t,this.tableName=e}a0.prototype={searchTag:z2,binSearch:F4,getTable:function(t){var e=this.font.tables[this.tableName];return!e&&t&&(e=this.font.tables[this.tableName]=this.createDefaultTable()),e},getScriptNames:function(){var t=this.getTable();return t?t.scripts.map(function(e){return e.tag}):[]},getDefaultScriptName:function(){var t=this.getTable();if(t){for(var e=!1,r=0;r<t.scripts.length;r++){var n=t.scripts[r].tag;if(n==="DFLT")return n;n==="latn"&&(e=!0)}if(e)return"latn"}},getScriptTable:function(t,e){var r=this.getTable(e);if(r){t=t||"DFLT";var n=r.scripts,i=z2(r.scripts,t);if(i>=0)return n[i].script;if(e){var a={tag:t,script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}};return n.splice(-1-i,0,a),a.script}}},getLangSysTable:function(t,e,r){var n=this.getScriptTable(t,r);if(n){if(!e||e==="dflt"||e==="DFLT")return n.defaultLangSys;var i=z2(n.langSysRecords,e);if(i>=0)return n.langSysRecords[i].langSys;if(r){var a={tag:e,langSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]}};return n.langSysRecords.splice(-1-i,0,a),a.langSys}}},getFeatureTable:function(t,e,r,n){var i=this.getLangSysTable(t,e,n);if(i){for(var a,s=i.featureIndexes,o=this.font.tables[this.tableName].features,l=0;l<s.length;l++)if(a=o[s[l]],a.tag===r)return a.feature;if(n){var u=o.length;return pr.assert(u===0||r>=o[u-1].tag,"Features must be added in alphabetical order."),a={tag:r,feature:{params:0,lookupListIndexes:[]}},o.push(a),s.push(u),a.feature}}},getLookupTables:function(t,e,r,n,i){var a=this.getFeatureTable(t,e,r,i),s=[];if(a){for(var o,l=a.lookupListIndexes,u=this.font.tables[this.tableName].lookups,c=0;c<l.length;c++)o=u[l[c]],o.lookupType===n&&s.push(o);if(s.length===0&&i){o={lookupType:n,lookupFlag:0,subtables:[],markFilteringSet:void 0};var f=u.length;return u.push(o),l.push(f),[o]}}return s},getGlyphClass:function(t,e){switch(t.format){case 1:return t.startGlyph<=e&&e<t.startGlyph+t.classes.length?t.classes[e-t.startGlyph]:0;case 2:var r=B4(t.ranges,e);return r?r.classId:0}},getCoverageIndex:function(t,e){switch(t.format){case 1:var r=F4(t.glyphs,e);return r>=0?r:-1;case 2:var n=B4(t.ranges,e);return n?n.index+e-n.start:-1}},expandCoverage:function(t){if(t.format===1)return t.glyphs;for(var e=[],r=t.ranges,n=0;n<r.length;n++)for(var i=r[n],a=i.start,s=i.end,o=a;o<=s;o++)e.push(o);return e}};function s0(t){a0.call(this,t,"gpos")}s0.prototype=a0.prototype;s0.prototype.init=function(){var t=this.getDefaultScriptName();this.defaultKerningTables=this.getKerningTables(t)};s0.prototype.getKerningValue=function(t,e,r){for(var n=0;n<t.length;n++)for(var i=t[n].subtables,a=0;a<i.length;a++){var s=i[a],o=this.getCoverageIndex(s.coverage,e);if(!(o<0))switch(s.posFormat){case 1:for(var l=s.pairSets[o],u=0;u<l.length;u++){var c=l[u];if(c.secondGlyph===r)return c.value1&&c.value1.xAdvance||0}break;case 2:var f=this.getGlyphClass(s.classDef1,e),p=this.getGlyphClass(s.classDef2,r),v=s.classRecords[f][p];return v.value1&&v.value1.xAdvance||0}}return 0};s0.prototype.getKerningTables=function(t,e){if(this.font.tables.gpos)return this.getLookupTables(t,e,"kern",2)};function bo(t){a0.call(this,t,"gsub")}function wq(t,e){var r=t.length;if(r!==e.length)return!1;for(var n=0;n<r;n++)if(t[n]!==e[n])return!1;return!0}function A_(t,e,r){for(var n=t.subtables,i=0;i<n.length;i++){var a=n[i];if(a.substFormat===e)return a}if(r)return n.push(r),r}bo.prototype=a0.prototype;bo.prototype.createDefaultTable=function(){return{version:1,scripts:[{tag:"DFLT",script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}}],features:[],lookups:[]}};bo.prototype.getSingle=function(t,e,r){for(var n=[],i=this.getLookupTables(e,r,t,1),a=0;a<i.length;a++)for(var s=i[a].subtables,o=0;o<s.length;o++){var l=s[o],u=this.expandCoverage(l.coverage),c=void 0;if(l.substFormat===1){var f=l.deltaGlyphId;for(c=0;c<u.length;c++){var p=u[c];n.push({sub:p,by:p+f})}}else{var v=l.substitute;for(c=0;c<u.length;c++)n.push({sub:u[c],by:v[c]})}}return n};bo.prototype.getMultiple=function(t,e,r){for(var n=[],i=this.getLookupTables(e,r,t,2),a=0;a<i.length;a++)for(var s=i[a].subtables,o=0;o<s.length;o++){var l=s[o],u=this.expandCoverage(l.coverage),c=void 0;for(c=0;c<u.length;c++){var f=u[c],p=l.sequences[c];n.push({sub:f,by:p})}}return n};bo.prototype.getAlternates=function(t,e,r){for(var n=[],i=this.getLookupTables(e,r,t,3),a=0;a<i.length;a++)for(var s=i[a].subtables,o=0;o<s.length;o++)for(var l=s[o],u=this.expandCoverage(l.coverage),c=l.alternateSets,f=0;f<u.length;f++)n.push({sub:u[f],by:c[f]});return n};bo.prototype.getLigatures=function(t,e,r){for(var n=[],i=this.getLookupTables(e,r,t,4),a=0;a<i.length;a++)for(var s=i[a].subtables,o=0;o<s.length;o++)for(var l=s[o],u=this.expandCoverage(l.coverage),c=l.ligatureSets,f=0;f<u.length;f++)for(var p=u[f],v=c[f],y=0;y<v.length;y++){var S=v[y];n.push({sub:[p].concat(S.components),by:S.ligGlyph})}return n};bo.prototype.addSingle=function(t,e,r,n){var i=this.getLookupTables(r,n,t,1,!0)[0],a=A_(i,2,{substFormat:2,coverage:{format:1,glyphs:[]},substitute:[]});pr.assert(a.coverage.format===1,"Single: unable to modify coverage table format "+a.coverage.format);var s=e.sub,o=this.binSearch(a.coverage.glyphs,s);o<0&&(o=-1-o,a.coverage.glyphs.splice(o,0,s),a.substitute.splice(o,0,0)),a.substitute[o]=e.by};bo.prototype.addMultiple=function(t,e,r,n){pr.assert(e.by instanceof Array&&e.by.length>1,'Multiple: "by" must be an array of two or more ids');var i=this.getLookupTables(r,n,t,2,!0)[0],a=A_(i,1,{substFormat:1,coverage:{format:1,glyphs:[]},sequences:[]});pr.assert(a.coverage.format===1,"Multiple: unable to modify coverage table format "+a.coverage.format);var s=e.sub,o=this.binSearch(a.coverage.glyphs,s);o<0&&(o=-1-o,a.coverage.glyphs.splice(o,0,s),a.sequences.splice(o,0,0)),a.sequences[o]=e.by};bo.prototype.addAlternate=function(t,e,r,n){var i=this.getLookupTables(r,n,t,3,!0)[0],a=A_(i,1,{substFormat:1,coverage:{format:1,glyphs:[]},alternateSets:[]});pr.assert(a.coverage.format===1,"Alternate: unable to modify coverage table format "+a.coverage.format);var s=e.sub,o=this.binSearch(a.coverage.glyphs,s);o<0&&(o=-1-o,a.coverage.glyphs.splice(o,0,s),a.alternateSets.splice(o,0,0)),a.alternateSets[o]=e.by};bo.prototype.addLigature=function(t,e,r,n){var i=this.getLookupTables(r,n,t,4,!0)[0],a=i.subtables[0];a||(a={substFormat:1,coverage:{format:1,glyphs:[]},ligatureSets:[]},i.subtables[0]=a),pr.assert(a.coverage.format===1,"Ligature: unable to modify coverage table format "+a.coverage.format);var s=e.sub[0],o=e.sub.slice(1),l={ligGlyph:e.by,components:o},u=this.binSearch(a.coverage.glyphs,s);if(u>=0){for(var c=a.ligatureSets[u],f=0;f<c.length;f++)if(wq(c[f].components,o))return;c.push(l)}else u=-1-u,a.coverage.glyphs.splice(u,0,s),a.ligatureSets.splice(u,0,[l])};bo.prototype.getFeature=function(t,e,r){if(/ss\d\d/.test(t))return this.getSingle(t,e,r);switch(t){case"aalt":case"salt":return this.getSingle(t,e,r).concat(this.getAlternates(t,e,r));case"dlig":case"liga":case"rlig":return this.getLigatures(t,e,r);case"ccmp":return this.getMultiple(t,e,r).concat(this.getLigatures(t,e,r));case"stch":return this.getMultiple(t,e,r)}};bo.prototype.add=function(t,e,r,n){if(/ss\d\d/.test(t))return this.addSingle(t,e,r,n);switch(t){case"aalt":case"salt":return typeof e.by=="number"?this.addSingle(t,e,r,n):this.addAlternate(t,e,r,n);case"dlig":case"liga":case"rlig":return this.addLigature(t,e,r,n);case"ccmp":return e.by instanceof Array?this.addMultiple(t,e,r,n):this.addLigature(t,e,r,n)}};function Sq(){return typeof window<"u"}function kq(t){for(var e=new Buffer(t.byteLength),r=new Uint8Array(t),n=0;n<e.length;++n)e[n]=r[n];return e}function Fg(t,e){if(!t)throw e}function z4(t,e,r,n,i){var a;return(e&n)>0?(a=t.parseByte(),(e&i)===0&&(a=-a),a=r+a):(e&i)>0?a=r:a=r+t.parseShort(),a}function oL(t,e,r){var n=new gr.Parser(e,r);t.numberOfContours=n.parseShort(),t._xMin=n.parseShort(),t._yMin=n.parseShort(),t._xMax=n.parseShort(),t._yMax=n.parseShort();var i,a;if(t.numberOfContours>0){for(var s=t.endPointIndices=[],o=0;o<t.numberOfContours;o+=1)s.push(n.parseUShort());t.instructionLength=n.parseUShort(),t.instructions=[];for(var l=0;l<t.instructionLength;l+=1)t.instructions.push(n.parseByte());var u=s[s.length-1]+1;i=[];for(var c=0;c<u;c+=1)if(a=n.parseByte(),i.push(a),(a&8)>0)for(var f=n.parseByte(),p=0;p<f;p+=1)i.push(a),c+=1;if(pr.argument(i.length===u,"Bad flags."),s.length>0){var v=[],y;if(u>0){for(var S=0;S<u;S+=1)a=i[S],y={},y.onCurve=!!(a&1),y.lastPointOfContour=s.indexOf(S)>=0,v.push(y);for(var w=0,E=0;E<u;E+=1)a=i[E],y=v[E],y.x=z4(n,a,w,2,16),w=y.x;for(var _=0,T=0;T<u;T+=1)a=i[T],y=v[T],y.y=z4(n,a,_,4,32),_=y.y}t.points=v}else t.points=[]}else if(t.numberOfContours===0)t.points=[];else{t.isComposite=!0,t.points=[],t.components=[];for(var N=!0;N;){i=n.parseUShort();var R={glyphIndex:n.parseUShort(),xScale:1,scale01:0,scale10:0,yScale:1,dx:0,dy:0};(i&1)>0?(i&2)>0?(R.dx=n.parseShort(),R.dy=n.parseShort()):R.matchedPoints=[n.parseUShort(),n.parseUShort()]:(i&2)>0?(R.dx=n.parseChar(),R.dy=n.parseChar()):R.matchedPoints=[n.parseByte(),n.parseByte()],(i&8)>0?R.xScale=R.yScale=n.parseF2Dot14():(i&64)>0?(R.xScale=n.parseF2Dot14(),R.yScale=n.parseF2Dot14()):(i&128)>0&&(R.xScale=n.parseF2Dot14(),R.scale01=n.parseF2Dot14(),R.scale10=n.parseF2Dot14(),R.yScale=n.parseF2Dot14()),t.components.push(R),N=!!(i&32)}if(i&256){t.instructionLength=n.parseUShort(),t.instructions=[];for(var I=0;I<t.instructionLength;I+=1)t.instructions.push(n.parseByte())}}}function U2(t,e){for(var r=[],n=0;n<t.length;n+=1){var i=t[n],a={x:e.xScale*i.x+e.scale01*i.y+e.dx,y:e.scale10*i.x+e.yScale*i.y+e.dy,onCurve:i.onCurve,lastPointOfContour:i.lastPointOfContour};r.push(a)}return r}function _q(t){for(var e=[],r=[],n=0;n<t.length;n+=1){var i=t[n];r.push(i),i.lastPointOfContour&&(e.push(r),r=[])}return pr.argument(r.length===0,"There are still points left in the current contour."),e}function lL(t){var e=new Ki;if(!t)return e;for(var r=_q(t),n=0;n<r.length;++n){var i=r[n],a=null,s=i[i.length-1],o=i[0];if(s.onCurve)e.moveTo(s.x,s.y);else if(o.onCurve)e.moveTo(o.x,o.y);else{var l={x:(s.x+o.x)*.5,y:(s.y+o.y)*.5};e.moveTo(l.x,l.y)}for(var u=0;u<i.length;++u)if(a=s,s=o,o=i[(u+1)%i.length],s.onCurve)e.lineTo(s.x,s.y);else{var c=o;a.onCurve||((s.x+a.x)*.5,(s.y+a.y)*.5),o.onCurve||(c={x:(s.x+o.x)*.5,y:(s.y+o.y)*.5}),e.quadraticCurveTo(s.x,s.y,c.x,c.y)}e.closePath()}return e}function uL(t,e){if(e.isComposite)for(var r=0;r<e.components.length;r+=1){var n=e.components[r],i=t.get(n.glyphIndex);if(i.getPath(),i.points){var a=void 0;if(n.matchedPoints===void 0)a=U2(i.points,n);else{if(n.matchedPoints[0]>e.points.length-1||n.matchedPoints[1]>i.points.length-1)throw Error("Matched points out of range in "+e.name);var s=e.points[n.matchedPoints[0]],o=i.points[n.matchedPoints[1]],l={xScale:n.xScale,scale01:n.scale01,scale10:n.scale10,yScale:n.yScale,dx:0,dy:0};o=U2([o],l)[0],l.dx=s.x-o.x,l.dy=s.y-o.y,a=U2(i.points,l)}e.points=e.points.concat(a)}}return lL(e.points)}function Cq(t,e,r,n){for(var i=new Cu.GlyphSet(n),a=0;a<r.length-1;a+=1){var s=r[a],o=r[a+1];s!==o?i.push(a,Cu.ttfGlyphLoader(n,a,oL,t,e+s,uL)):i.push(a,Cu.glyphLoader(n,a))}return i}function Eq(t,e,r,n){var i=new Cu.GlyphSet(n);return n._push=function(a){var s=r[a],o=r[a+1];s!==o?i.push(a,Cu.ttfGlyphLoader(n,a,oL,t,e+s,uL)):i.push(a,Cu.glyphLoader(n,a))},i}function Tq(t,e,r,n,i){return i.lowMemory?Eq(t,e,r,n):Cq(t,e,r,n)}var Nq={getPath:lL,parse:Tq},cL,bh,dL,lk;function fL(t){this.font=t,this.getCommands=function(e){return Nq.getPath(e).commands},this._fpgmState=this._prepState=void 0,this._errorState=0}function Pq(t){return t}function hL(t){return Math.sign(t)*Math.round(Math.abs(t))}function Mq(t){return Math.sign(t)*Math.round(Math.abs(t*2))/2}function Aq(t){return Math.sign(t)*(Math.round(Math.abs(t)+.5)-.5)}function Rq(t){return Math.sign(t)*Math.ceil(Math.abs(t))}function Lq(t){return Math.sign(t)*Math.floor(Math.abs(t))}var pL=function(t){var e=this.srPeriod,r=this.srPhase,n=this.srThreshold,i=1;return t<0&&(t=-t,i=-1),t+=n-r,t=Math.trunc(t/e)*e,t+=r,t<0?r*i:t*i},_u={x:1,y:0,axis:"x",distance:function(t,e,r,n){return(r?t.xo:t.x)-(n?e.xo:e.x)},interpolate:function(t,e,r,n){var i,a,s,o,l,u,c;if(!n||n===this){if(i=t.xo-e.xo,a=t.xo-r.xo,l=e.x-e.xo,u=r.x-r.xo,s=Math.abs(i),o=Math.abs(a),c=s+o,c===0){t.x=t.xo+(l+u)/2;return}t.x=t.xo+(l*o+u*s)/c;return}if(i=n.distance(t,e,!0,!0),a=n.distance(t,r,!0,!0),l=n.distance(e,e,!1,!0),u=n.distance(r,r,!1,!0),s=Math.abs(i),o=Math.abs(a),c=s+o,c===0){_u.setRelative(t,t,(l+u)/2,n,!0);return}_u.setRelative(t,t,(l*o+u*s)/c,n,!0)},normalSlope:Number.NEGATIVE_INFINITY,setRelative:function(t,e,r,n,i){if(!n||n===this){t.x=(i?e.xo:e.x)+r;return}var a=i?e.xo:e.x,s=i?e.yo:e.y,o=a+r*n.x,l=s+r*n.y;t.x=o+(t.y-l)/n.normalSlope},slope:0,touch:function(t){t.xTouched=!0},touched:function(t){return t.xTouched},untouch:function(t){t.xTouched=!1}},fc={x:0,y:1,axis:"y",distance:function(t,e,r,n){return(r?t.yo:t.y)-(n?e.yo:e.y)},interpolate:function(t,e,r,n){var i,a,s,o,l,u,c;if(!n||n===this){if(i=t.yo-e.yo,a=t.yo-r.yo,l=e.y-e.yo,u=r.y-r.yo,s=Math.abs(i),o=Math.abs(a),c=s+o,c===0){t.y=t.yo+(l+u)/2;return}t.y=t.yo+(l*o+u*s)/c;return}if(i=n.distance(t,e,!0,!0),a=n.distance(t,r,!0,!0),l=n.distance(e,e,!1,!0),u=n.distance(r,r,!1,!0),s=Math.abs(i),o=Math.abs(a),c=s+o,c===0){fc.setRelative(t,t,(l+u)/2,n,!0);return}fc.setRelative(t,t,(l*o+u*s)/c,n,!0)},normalSlope:0,setRelative:function(t,e,r,n,i){if(!n||n===this){t.y=(i?e.yo:e.y)+r;return}var a=i?e.xo:e.x,s=i?e.yo:e.y,o=a+r*n.x,l=s+r*n.y;t.y=l+n.normalSlope*(t.x-o)},slope:Number.POSITIVE_INFINITY,touch:function(t){t.yTouched=!0},touched:function(t){return t.yTouched},untouch:function(t){t.yTouched=!1}};Object.freeze(_u);Object.freeze(fc);function o0(t,e){this.x=t,this.y=e,this.axis=void 0,this.slope=e/t,this.normalSlope=-t/e,Object.freeze(this)}o0.prototype.distance=function(t,e,r,n){return this.x*_u.distance(t,e,r,n)+this.y*fc.distance(t,e,r,n)};o0.prototype.interpolate=function(t,e,r,n){var i,a,s,o,l,u,c;if(s=n.distance(t,e,!0,!0),o=n.distance(t,r,!0,!0),i=n.distance(e,e,!1,!0),a=n.distance(r,r,!1,!0),l=Math.abs(s),u=Math.abs(o),c=l+u,c===0){this.setRelative(t,t,(i+a)/2,n,!0);return}this.setRelative(t,t,(i*u+a*l)/c,n,!0)};o0.prototype.setRelative=function(t,e,r,n,i){n=n||this;var a=i?e.xo:e.x,s=i?e.yo:e.y,o=a+r*n.x,l=s+r*n.y,u=n.normalSlope,c=this.slope,f=t.x,p=t.y;t.x=(c*f-u*o+l-p)/(c-u),t.y=c*(t.x-f)+p};o0.prototype.touch=function(t){t.xTouched=!0,t.yTouched=!0};function l0(t,e){var r=Math.sqrt(t*t+e*e);return t/=r,e/=r,t===1&&e===0?_u:t===0&&e===1?fc:new o0(t,e)}function pc(t,e,r,n){this.x=this.xo=Math.round(t*64)/64,this.y=this.yo=Math.round(e*64)/64,this.lastPointOfContour=r,this.onCurve=n,this.prevPointOnContour=void 0,this.nextPointOnContour=void 0,this.xTouched=!1,this.yTouched=!1,Object.preventExtensions(this)}pc.prototype.nextTouched=function(t){for(var e=this.nextPointOnContour;!t.touched(e)&&e!==this;)e=e.nextPointOnContour;return e};pc.prototype.prevTouched=function(t){for(var e=this.prevPointOnContour;!t.touched(e)&&e!==this;)e=e.prevPointOnContour;return e};var Rv=Object.freeze(new pc(0,0)),Oq={cvCutIn:17/16,deltaBase:9,deltaShift:.125,loop:1,minDis:1,autoFlip:!0};function Id(t,e){switch(this.env=t,this.stack=[],this.prog=e,t){case"glyf":this.zp0=this.zp1=this.zp2=1,this.rp0=this.rp1=this.rp2=0;case"prep":this.fv=this.pv=this.dpv=_u,this.round=hL}}fL.prototype.exec=function(t,e){if(typeof e!="number")throw new Error("Point size is not a number!");if(!(this._errorState>2)){var r=this.font,n=this._prepState;if(!n||n.ppem!==e){var i=this._fpgmState;if(!i){Id.prototype=Oq,i=this._fpgmState=new Id("fpgm",r.tables.fpgm),i.funcs=[],i.font=r,Ye.DEBUG&&(console.log("---EXEC FPGM---"),i.step=-1);try{bh(i)}catch(u){console.log("Hinting error in FPGM:"+u),this._errorState=3;return}}Id.prototype=i,n=this._prepState=new Id("prep",r.tables.prep),n.ppem=e;var a=r.tables.cvt;if(a)for(var s=n.cvt=new Array(a.length),o=e/r.unitsPerEm,l=0;l<a.length;l++)s[l]=a[l]*o;else n.cvt=[];Ye.DEBUG&&(console.log("---EXEC PREP---"),n.step=-1);try{bh(n)}catch(u){this._errorState<2&&console.log("Hinting error in PREP:"+u),this._errorState=2}}if(!(this._errorState>1))try{return dL(t,n)}catch(u){this._errorState<1&&(console.log("Hinting error:"+u),console.log("Note: further hinting errors are silenced")),this._errorState=1;return}}};dL=function(t,e){var r=e.ppem/e.font.unitsPerEm,n=r,i=t.components,a,s,o;if(Id.prototype=e,!i)o=new Id("glyf",t.instructions),Ye.DEBUG&&(console.log("---EXEC GLYPH---"),o.step=-1),lk(t,o,r,n),s=o.gZone;else{var l=e.font;s=[],a=[];for(var u=0;u<i.length;u++){var c=i[u],f=l.glyphs.get(c.glyphIndex);o=new Id("glyf",f.instructions),Ye.DEBUG&&(console.log("---EXEC COMP "+u+"---"),o.step=-1),lk(f,o,r,n);for(var p=Math.round(c.dx*r),v=Math.round(c.dy*n),y=o.gZone,S=o.contours,w=0;w<y.length;w++){var E=y[w];E.xTouched=E.yTouched=!1,E.xo=E.x=E.x+p,E.yo=E.y=E.y+v}var _=s.length;s.push.apply(s,y);for(var T=0;T<S.length;T++)a.push(S[T]+_)}t.instructions&&!o.inhibitGridFit&&(o=new Id("glyf",t.instructions),o.gZone=o.z0=o.z1=o.z2=s,o.contours=a,s.push(new pc(0,0),new pc(Math.round(t.advanceWidth*r),0)),Ye.DEBUG&&(console.log("---EXEC COMPOSITE---"),o.step=-1),bh(o),s.length-=2)}return s};lk=function(t,e,r,n){for(var i=t.points||[],a=i.length,s=e.gZone=e.z0=e.z1=e.z2=[],o=e.contours=[],l,u=0;u<a;u++)l=i[u],s[u]=new pc(l.x*r,l.y*n,l.lastPointOfContour,l.onCurve);for(var c,f,p=0;p<a;p++)l=s[p],c||(c=l,o.push(p)),l.lastPointOfContour?(l.nextPointOnContour=c,c.prevPointOnContour=l,c=void 0):(f=s[p+1],l.nextPointOnContour=f,f.prevPointOnContour=l);if(!e.inhibitGridFit){if(Ye.DEBUG){console.log("PROCESSING GLYPH",e.stack);for(var v=0;v<a;v++)console.log(v,s[v].x,s[v].y)}if(s.push(new pc(0,0),new pc(Math.round(t.advanceWidth*r),0)),bh(e),s.length-=2,Ye.DEBUG){console.log("FINISHED GLYPH",e.stack);for(var y=0;y<a;y++)console.log(y,s[y].x,s[y].y)}}};bh=function(t){var e=t.prog;if(e){var r=e.length,n;for(t.ip=0;t.ip<r;t.ip++){if(Ye.DEBUG&&t.step++,n=cL[e[t.ip]],!n)throw new Error("unknown instruction: 0x"+Number(e[t.ip]).toString(16));n(t)}}};function V1(t){for(var e=t.tZone=new Array(t.gZone.length),r=0;r<e.length;r++)e[r]=new pc(0,0)}function mL(t,e){var r=t.prog,n=t.ip,i=1,a;do if(a=r[++n],a===88)i++;else if(a===89)i--;else if(a===64)n+=r[n+1]+1;else if(a===65)n+=2*r[n+1]+1;else if(a>=176&&a<=183)n+=a-176+1;else if(a>=184&&a<=191)n+=(a-184+1)*2;else if(e&&i===1&&a===27)break;while(i>0);t.ip=n}function U4(t,e){Ye.DEBUG&&console.log(e.step,"SVTCA["+t.axis+"]"),e.fv=e.pv=e.dpv=t}function G4(t,e){Ye.DEBUG&&console.log(e.step,"SPVTCA["+t.axis+"]"),e.pv=e.dpv=t}function V4(t,e){Ye.DEBUG&&console.log(e.step,"SFVTCA["+t.axis+"]"),e.fv=t}function H4(t,e){var r=e.stack,n=r.pop(),i=r.pop(),a=e.z2[n],s=e.z1[i];Ye.DEBUG&&console.log("SPVTL["+t+"]",n,i);var o,l;t?(o=a.y-s.y,l=s.x-a.x):(o=s.x-a.x,l=s.y-a.y),e.pv=e.dpv=l0(o,l)}function W4(t,e){var r=e.stack,n=r.pop(),i=r.pop(),a=e.z2[n],s=e.z1[i];Ye.DEBUG&&console.log("SFVTL["+t+"]",n,i);var o,l;t?(o=a.y-s.y,l=s.x-a.x):(o=s.x-a.x,l=s.y-a.y),e.fv=l0(o,l)}function Dq(t){var e=t.stack,r=e.pop(),n=e.pop();Ye.DEBUG&&console.log(t.step,"SPVFS[]",r,n),t.pv=t.dpv=l0(n,r)}function Iq(t){var e=t.stack,r=e.pop(),n=e.pop();Ye.DEBUG&&console.log(t.step,"SPVFS[]",r,n),t.fv=l0(n,r)}function jq(t){var e=t.stack,r=t.pv;Ye.DEBUG&&console.log(t.step,"GPV[]"),e.push(r.x*16384),e.push(r.y*16384)}function Fq(t){var e=t.stack,r=t.fv;Ye.DEBUG&&console.log(t.step,"GFV[]"),e.push(r.x*16384),e.push(r.y*16384)}function Bq(t){t.fv=t.pv,Ye.DEBUG&&console.log(t.step,"SFVTPV[]")}function zq(t){var e=t.stack,r=e.pop(),n=e.pop(),i=e.pop(),a=e.pop(),s=e.pop(),o=t.z0,l=t.z1,u=o[r],c=o[n],f=l[i],p=l[a],v=t.z2[s];Ye.DEBUG&&console.log("ISECT[], ",r,n,i,a,s);var y=u.x,S=u.y,w=c.x,E=c.y,_=f.x,T=f.y,N=p.x,R=p.y,I=(y-w)*(T-R)-(S-E)*(_-N),F=y*E-S*w,D=_*R-T*N;v.x=(F*(_-N)-D*(y-w))/I,v.y=(F*(T-R)-D*(S-E))/I}function Uq(t){t.rp0=t.stack.pop(),Ye.DEBUG&&console.log(t.step,"SRP0[]",t.rp0)}function Gq(t){t.rp1=t.stack.pop(),Ye.DEBUG&&console.log(t.step,"SRP1[]",t.rp1)}function Vq(t){t.rp2=t.stack.pop(),Ye.DEBUG&&console.log(t.step,"SRP2[]",t.rp2)}function Hq(t){var e=t.stack.pop();switch(Ye.DEBUG&&console.log(t.step,"SZP0[]",e),t.zp0=e,e){case 0:t.tZone||V1(t),t.z0=t.tZone;break;case 1:t.z0=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function Wq(t){var e=t.stack.pop();switch(Ye.DEBUG&&console.log(t.step,"SZP1[]",e),t.zp1=e,e){case 0:t.tZone||V1(t),t.z1=t.tZone;break;case 1:t.z1=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function qq(t){var e=t.stack.pop();switch(Ye.DEBUG&&console.log(t.step,"SZP2[]",e),t.zp2=e,e){case 0:t.tZone||V1(t),t.z2=t.tZone;break;case 1:t.z2=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function $q(t){var e=t.stack.pop();switch(Ye.DEBUG&&console.log(t.step,"SZPS[]",e),t.zp0=t.zp1=t.zp2=e,e){case 0:t.tZone||V1(t),t.z0=t.z1=t.z2=t.tZone;break;case 1:t.z0=t.z1=t.z2=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function Kq(t){t.loop=t.stack.pop(),Ye.DEBUG&&console.log(t.step,"SLOOP[]",t.loop)}function Zq(t){Ye.DEBUG&&console.log(t.step,"RTG[]"),t.round=hL}function Yq(t){Ye.DEBUG&&console.log(t.step,"RTHG[]"),t.round=Aq}function Xq(t){var e=t.stack.pop();Ye.DEBUG&&console.log(t.step,"SMD[]",e),t.minDis=e/64}function Qq(t){Ye.DEBUG&&console.log(t.step,"ELSE[]"),mL(t,!1)}function Jq(t){var e=t.stack.pop();Ye.DEBUG&&console.log(t.step,"JMPR[]",e),t.ip+=e-1}function e$(t){var e=t.stack.pop();Ye.DEBUG&&console.log(t.step,"SCVTCI[]",e),t.cvCutIn=e/64}function t$(t){var e=t.stack;Ye.DEBUG&&console.log(t.step,"DUP[]"),e.push(e[e.length-1])}function G2(t){Ye.DEBUG&&console.log(t.step,"POP[]"),t.stack.pop()}function r$(t){Ye.DEBUG&&console.log(t.step,"CLEAR[]"),t.stack.length=0}function n$(t){var e=t.stack,r=e.pop(),n=e.pop();Ye.DEBUG&&console.log(t.step,"SWAP[]"),e.push(r),e.push(n)}function i$(t){var e=t.stack;Ye.DEBUG&&console.log(t.step,"DEPTH[]"),e.push(e.length)}function a$(t){var e=t.stack,r=e.pop(),n=e.pop();Ye.DEBUG&&console.log(t.step,"LOOPCALL[]",r,n);var i=t.ip,a=t.prog;t.prog=t.funcs[r];for(var s=0;s<n;s++)bh(t),Ye.DEBUG&&console.log(++t.step,s+1<n?"next loopcall":"done loopcall",s);t.ip=i,t.prog=a}function s$(t){var e=t.stack.pop();Ye.DEBUG&&console.log(t.step,"CALL[]",e);var r=t.ip,n=t.prog;t.prog=t.funcs[e],bh(t),t.ip=r,t.prog=n,Ye.DEBUG&&console.log(++t.step,"returning from",e)}function o$(t){var e=t.stack,r=e.pop();Ye.DEBUG&&console.log(t.step,"CINDEX[]",r),e.push(e[e.length-r])}function l$(t){var e=t.stack,r=e.pop();Ye.DEBUG&&console.log(t.step,"MINDEX[]",r),e.push(e.splice(e.length-r,1)[0])}function u$(t){if(t.env!=="fpgm")throw new Error("FDEF not allowed here");var e=t.stack,r=t.prog,n=t.ip,i=e.pop(),a=n;for(Ye.DEBUG&&console.log(t.step,"FDEF[]",i);r[++n]!==45;);t.ip=n,t.funcs[i]=r.slice(a+1,n)}function q4(t,e){var r=e.stack.pop(),n=e.z0[r],i=e.fv,a=e.pv;Ye.DEBUG&&console.log(e.step,"MDAP["+t+"]",r);var s=a.distance(n,Rv);t&&(s=e.round(s)),i.setRelative(n,Rv,s,a),i.touch(n),e.rp0=e.rp1=r}function $4(t,e){var r=e.z2,n=r.length-2,i,a,s;Ye.DEBUG&&console.log(e.step,"IUP["+t.axis+"]");for(var o=0;o<n;o++)i=r[o],!t.touched(i)&&(a=i.prevTouched(t),a!==i&&(s=i.nextTouched(t),a===s&&t.setRelative(i,i,t.distance(a,a,!1,!0),t,!0),t.interpolate(i,a,s,t)))}function K4(t,e){for(var r=e.stack,n=t?e.rp1:e.rp2,i=(t?e.z0:e.z1)[n],a=e.fv,s=e.pv,o=e.loop,l=e.z2;o--;){var u=r.pop(),c=l[u],f=s.distance(i,i,!1,!0);a.setRelative(c,c,f,s),a.touch(c),Ye.DEBUG&&console.log(e.step,(e.loop>1?"loop "+(e.loop-o)+": ":"")+"SHP["+(t?"rp1":"rp2")+"]",u)}e.loop=1}function Z4(t,e){var r=e.stack,n=t?e.rp1:e.rp2,i=(t?e.z0:e.z1)[n],a=e.fv,s=e.pv,o=r.pop(),l=e.z2[e.contours[o]],u=l;Ye.DEBUG&&console.log(e.step,"SHC["+t+"]",o);var c=s.distance(i,i,!1,!0);do u!==i&&a.setRelative(u,u,c,s),u=u.nextPointOnContour;while(u!==l)}function Y4(t,e){var r=e.stack,n=t?e.rp1:e.rp2,i=(t?e.z0:e.z1)[n],a=e.fv,s=e.pv,o=r.pop();Ye.DEBUG&&console.log(e.step,"SHZ["+t+"]",o);var l;switch(o){case 0:l=e.tZone;break;case 1:l=e.gZone;break;default:throw new Error("Invalid zone")}for(var u,c=s.distance(i,i,!1,!0),f=l.length-2,p=0;p<f;p++)u=l[p],a.setRelative(u,u,c,s)}function c$(t){for(var e=t.stack,r=t.loop,n=t.fv,i=e.pop()/64,a=t.z2;r--;){var s=e.pop(),o=a[s];Ye.DEBUG&&console.log(t.step,(t.loop>1?"loop "+(t.loop-r)+": ":"")+"SHPIX[]",s,i),n.setRelative(o,o,i),n.touch(o)}t.loop=1}function d$(t){for(var e=t.stack,r=t.rp1,n=t.rp2,i=t.loop,a=t.z0[r],s=t.z1[n],o=t.fv,l=t.dpv,u=t.z2;i--;){var c=e.pop(),f=u[c];Ye.DEBUG&&console.log(t.step,(t.loop>1?"loop "+(t.loop-i)+": ":"")+"IP[]",c,r,"<->",n),o.interpolate(f,a,s,l),o.touch(f)}t.loop=1}function X4(t,e){var r=e.stack,n=r.pop()/64,i=r.pop(),a=e.z1[i],s=e.z0[e.rp0],o=e.fv,l=e.pv;o.setRelative(a,s,n,l),o.touch(a),Ye.DEBUG&&console.log(e.step,"MSIRP["+t+"]",n,i),e.rp1=e.rp0,e.rp2=i,t&&(e.rp0=i)}function f$(t){for(var e=t.stack,r=t.rp0,n=t.z0[r],i=t.loop,a=t.fv,s=t.pv,o=t.z1;i--;){var l=e.pop(),u=o[l];Ye.DEBUG&&console.log(t.step,(t.loop>1?"loop "+(t.loop-i)+": ":"")+"ALIGNRP[]",l),a.setRelative(u,n,0,s),a.touch(u)}t.loop=1}function h$(t){Ye.DEBUG&&console.log(t.step,"RTDG[]"),t.round=Mq}function Q4(t,e){var r=e.stack,n=r.pop(),i=r.pop(),a=e.z0[i],s=e.fv,o=e.pv,l=e.cvt[n];Ye.DEBUG&&console.log(e.step,"MIAP["+t+"]",n,"(",l,")",i);var u=o.distance(a,Rv);t&&(Math.abs(u-l)<e.cvCutIn&&(u=l),u=e.round(u)),s.setRelative(a,Rv,u,o),e.zp0===0&&(a.xo=a.x,a.yo=a.y),s.touch(a),e.rp0=e.rp1=i}function p$(t){var e=t.prog,r=t.ip,n=t.stack,i=e[++r];Ye.DEBUG&&console.log(t.step,"NPUSHB[]",i);for(var a=0;a<i;a++)n.push(e[++r]);t.ip=r}function m$(t){var e=t.ip,r=t.prog,n=t.stack,i=r[++e];Ye.DEBUG&&console.log(t.step,"NPUSHW[]",i);for(var a=0;a<i;a++){var s=r[++e]<<8|r[++e];s&32768&&(s=-((s^65535)+1)),n.push(s)}t.ip=e}function g$(t){var e=t.stack,r=t.store;r||(r=t.store=[]);var n=e.pop(),i=e.pop();Ye.DEBUG&&console.log(t.step,"WS",n,i),r[i]=n}function v$(t){var e=t.stack,r=t.store,n=e.pop();Ye.DEBUG&&console.log(t.step,"RS",n);var i=r&&r[n]||0;e.push(i)}function y$(t){var e=t.stack,r=e.pop(),n=e.pop();Ye.DEBUG&&console.log(t.step,"WCVTP",r,n),t.cvt[n]=r/64}function x$(t){var e=t.stack,r=e.pop();Ye.DEBUG&&console.log(t.step,"RCVT",r),e.push(t.cvt[r]*64)}function J4(t,e){var r=e.stack,n=r.pop(),i=e.z2[n];Ye.DEBUG&&console.log(e.step,"GC["+t+"]",n),r.push(e.dpv.distance(i,Rv,t,!1)*64)}function e3(t,e){var r=e.stack,n=r.pop(),i=r.pop(),a=e.z1[n],s=e.z0[i],o=e.dpv.distance(s,a,t,t);Ye.DEBUG&&console.log(e.step,"MD["+t+"]",n,i,"->",o),e.stack.push(Math.round(o*64))}function b$(t){Ye.DEBUG&&console.log(t.step,"MPPEM[]"),t.stack.push(t.ppem)}function w$(t){Ye.DEBUG&&console.log(t.step,"FLIPON[]"),t.autoFlip=!0}function S$(t){var e=t.stack,r=e.pop(),n=e.pop();Ye.DEBUG&&console.log(t.step,"LT[]",r,n),e.push(n<r?1:0)}function k$(t){var e=t.stack,r=e.pop(),n=e.pop();Ye.DEBUG&&console.log(t.step,"LTEQ[]",r,n),e.push(n<=r?1:0)}function _$(t){var e=t.stack,r=e.pop(),n=e.pop();Ye.DEBUG&&console.log(t.step,"GT[]",r,n),e.push(n>r?1:0)}function C$(t){var e=t.stack,r=e.pop(),n=e.pop();Ye.DEBUG&&console.log(t.step,"GTEQ[]",r,n),e.push(n>=r?1:0)}function E$(t){var e=t.stack,r=e.pop(),n=e.pop();Ye.DEBUG&&console.log(t.step,"EQ[]",r,n),e.push(r===n?1:0)}function T$(t){var e=t.stack,r=e.pop(),n=e.pop();Ye.DEBUG&&console.log(t.step,"NEQ[]",r,n),e.push(r!==n?1:0)}function N$(t){var e=t.stack,r=e.pop();Ye.DEBUG&&console.log(t.step,"ODD[]",r),e.push(Math.trunc(r)%2?1:0)}function P$(t){var e=t.stack,r=e.pop();Ye.DEBUG&&console.log(t.step,"EVEN[]",r),e.push(Math.trunc(r)%2?0:1)}function M$(t){var e=t.stack.pop();Ye.DEBUG&&console.log(t.step,"IF[]",e),e||(mL(t,!0),Ye.DEBUG&&console.log(t.step,"EIF[]"))}function A$(t){Ye.DEBUG&&console.log(t.step,"EIF[]")}function R$(t){var e=t.stack,r=e.pop(),n=e.pop();Ye.DEBUG&&console.log(t.step,"AND[]",r,n),e.push(r&&n?1:0)}function L$(t){var e=t.stack,r=e.pop(),n=e.pop();Ye.DEBUG&&console.log(t.step,"OR[]",r,n),e.push(r||n?1:0)}function O$(t){var e=t.stack,r=e.pop();Ye.DEBUG&&console.log(t.step,"NOT[]",r),e.push(r?0:1)}function V2(t,e){var r=e.stack,n=r.pop(),i=e.fv,a=e.pv,s=e.ppem,o=e.deltaBase+(t-1)*16,l=e.deltaShift,u=e.z0;Ye.DEBUG&&console.log(e.step,"DELTAP["+t+"]",n,r);for(var c=0;c<n;c++){var f=r.pop(),p=r.pop(),v=o+((p&240)>>4);if(v===s){var y=(p&15)-8;y>=0&&y++,Ye.DEBUG&&console.log(e.step,"DELTAPFIX",f,"by",y*l);var S=u[f];i.setRelative(S,S,y*l,a)}}}function D$(t){var e=t.stack,r=e.pop();Ye.DEBUG&&console.log(t.step,"SDB[]",r),t.deltaBase=r}function I$(t){var e=t.stack,r=e.pop();Ye.DEBUG&&console.log(t.step,"SDS[]",r),t.deltaShift=Math.pow(.5,r)}function j$(t){var e=t.stack,r=e.pop(),n=e.pop();Ye.DEBUG&&console.log(t.step,"ADD[]",r,n),e.push(n+r)}function F$(t){var e=t.stack,r=e.pop(),n=e.pop();Ye.DEBUG&&console.log(t.step,"SUB[]",r,n),e.push(n-r)}function B$(t){var e=t.stack,r=e.pop(),n=e.pop();Ye.DEBUG&&console.log(t.step,"DIV[]",r,n),e.push(n*64/r)}function z$(t){var e=t.stack,r=e.pop(),n=e.pop();Ye.DEBUG&&console.log(t.step,"MUL[]",r,n),e.push(n*r/64)}function U$(t){var e=t.stack,r=e.pop();Ye.DEBUG&&console.log(t.step,"ABS[]",r),e.push(Math.abs(r))}function G$(t){var e=t.stack,r=e.pop();Ye.DEBUG&&console.log(t.step,"NEG[]",r),e.push(-r)}function V$(t){var e=t.stack,r=e.pop();Ye.DEBUG&&console.log(t.step,"FLOOR[]",r),e.push(Math.floor(r/64)*64)}function H$(t){var e=t.stack,r=e.pop();Ye.DEBUG&&console.log(t.step,"CEILING[]",r),e.push(Math.ceil(r/64)*64)}function yy(t,e){var r=e.stack,n=r.pop();Ye.DEBUG&&console.log(e.step,"ROUND[]"),r.push(e.round(n/64)*64)}function W$(t){var e=t.stack,r=e.pop(),n=e.pop();Ye.DEBUG&&console.log(t.step,"WCVTF[]",r,n),t.cvt[n]=r*t.ppem/t.font.unitsPerEm}function H2(t,e){var r=e.stack,n=r.pop(),i=e.ppem,a=e.deltaBase+(t-1)*16,s=e.deltaShift;Ye.DEBUG&&console.log(e.step,"DELTAC["+t+"]",n,r);for(var o=0;o<n;o++){var l=r.pop(),u=r.pop(),c=a+((u&240)>>4);if(c===i){var f=(u&15)-8;f>=0&&f++;var p=f*s;Ye.DEBUG&&console.log(e.step,"DELTACFIX",l,"by",p),e.cvt[l]+=p}}}function q$(t){var e=t.stack.pop();Ye.DEBUG&&console.log(t.step,"SROUND[]",e),t.round=pL;var r;switch(e&192){case 0:r=.5;break;case 64:r=1;break;case 128:r=2;break;default:throw new Error("invalid SROUND value")}switch(t.srPeriod=r,e&48){case 0:t.srPhase=0;break;case 16:t.srPhase=.25*r;break;case 32:t.srPhase=.5*r;break;case 48:t.srPhase=.75*r;break;default:throw new Error("invalid SROUND value")}e&=15,e===0?t.srThreshold=0:t.srThreshold=(e/8-.5)*r}function $$(t){var e=t.stack.pop();Ye.DEBUG&&console.log(t.step,"S45ROUND[]",e),t.round=pL;var r;switch(e&192){case 0:r=Math.sqrt(2)/2;break;case 64:r=Math.sqrt(2);break;case 128:r=2*Math.sqrt(2);break;default:throw new Error("invalid S45ROUND value")}switch(t.srPeriod=r,e&48){case 0:t.srPhase=0;break;case 16:t.srPhase=.25*r;break;case 32:t.srPhase=.5*r;break;case 48:t.srPhase=.75*r;break;default:throw new Error("invalid S45ROUND value")}e&=15,e===0?t.srThreshold=0:t.srThreshold=(e/8-.5)*r}function K$(t){Ye.DEBUG&&console.log(t.step,"ROFF[]"),t.round=Pq}function Z$(t){Ye.DEBUG&&console.log(t.step,"RUTG[]"),t.round=Rq}function Y$(t){Ye.DEBUG&&console.log(t.step,"RDTG[]"),t.round=Lq}function X$(t){var e=t.stack.pop();Ye.DEBUG&&console.log(t.step,"SCANCTRL[]",e)}function t3(t,e){var r=e.stack,n=r.pop(),i=r.pop(),a=e.z2[n],s=e.z1[i];Ye.DEBUG&&console.log(e.step,"SDPVTL["+t+"]",n,i);var o,l;t?(o=a.y-s.y,l=s.x-a.x):(o=s.x-a.x,l=s.y-a.y),e.dpv=l0(o,l)}function Q$(t){var e=t.stack,r=e.pop(),n=0;Ye.DEBUG&&console.log(t.step,"GETINFO[]",r),r&1&&(n=35),r&32&&(n|=4096),e.push(n)}function J$(t){var e=t.stack,r=e.pop(),n=e.pop(),i=e.pop();Ye.DEBUG&&console.log(t.step,"ROLL[]"),e.push(n),e.push(r),e.push(i)}function eK(t){var e=t.stack,r=e.pop(),n=e.pop();Ye.DEBUG&&console.log(t.step,"MAX[]",r,n),e.push(Math.max(n,r))}function tK(t){var e=t.stack,r=e.pop(),n=e.pop();Ye.DEBUG&&console.log(t.step,"MIN[]",r,n),e.push(Math.min(n,r))}function rK(t){var e=t.stack.pop();Ye.DEBUG&&console.log(t.step,"SCANTYPE[]",e)}function nK(t){var e=t.stack.pop(),r=t.stack.pop();switch(Ye.DEBUG&&console.log(t.step,"INSTCTRL[]",e,r),e){case 1:t.inhibitGridFit=!!r;return;case 2:t.ignoreCvt=!!r;return;default:throw new Error("invalid INSTCTRL[] selector")}}function wd(t,e){var r=e.stack,n=e.prog,i=e.ip;Ye.DEBUG&&console.log(e.step,"PUSHB["+t+"]");for(var a=0;a<t;a++)r.push(n[++i]);e.ip=i}function Sd(t,e){var r=e.ip,n=e.prog,i=e.stack;Ye.DEBUG&&console.log(e.ip,"PUSHW["+t+"]");for(var a=0;a<t;a++){var s=n[++r]<<8|n[++r];s&32768&&(s=-((s^65535)+1)),i.push(s)}e.ip=r}function Ft(t,e,r,n,i,a){var s=a.stack,o=t&&s.pop(),l=s.pop(),u=a.rp0,c=a.z0[u],f=a.z1[l],p=a.minDis,v=a.fv,y=a.dpv,S,w,E,_;w=S=y.distance(f,c,!0,!0),E=w>=0?1:-1,w=Math.abs(w),t&&(_=a.cvt[o],n&&Math.abs(w-_)<a.cvCutIn&&(w=_)),r&&w<p&&(w=p),n&&(w=a.round(w)),v.setRelative(f,c,E*w,y),v.touch(f),Ye.DEBUG&&console.log(a.step,(t?"MIRP[":"MDRP[")+(e?"M":"m")+(r?">":"_")+(n?"R":"_")+(i===0?"Gr":i===1?"Bl":i===2?"Wh":"")+"]",t?o+"("+a.cvt[o]+","+_+")":"",l,"(d =",S,"->",E*w,")"),a.rp1=a.rp0,a.rp2=l,e&&(a.rp0=l)}cL=[U4.bind(void 0,fc),U4.bind(void 0,_u),G4.bind(void 0,fc),G4.bind(void 0,_u),V4.bind(void 0,fc),V4.bind(void 0,_u),H4.bind(void 0,0),H4.bind(void 0,1),W4.bind(void 0,0),W4.bind(void 0,1),Dq,Iq,jq,Fq,Bq,zq,Uq,Gq,Vq,Hq,Wq,qq,$q,Kq,Zq,Yq,Xq,Qq,Jq,e$,void 0,void 0,t$,G2,r$,n$,i$,o$,l$,void 0,void 0,void 0,a$,s$,u$,void 0,q4.bind(void 0,0),q4.bind(void 0,1),$4.bind(void 0,fc),$4.bind(void 0,_u),K4.bind(void 0,0),K4.bind(void 0,1),Z4.bind(void 0,0),Z4.bind(void 0,1),Y4.bind(void 0,0),Y4.bind(void 0,1),c$,d$,X4.bind(void 0,0),X4.bind(void 0,1),f$,h$,Q4.bind(void 0,0),Q4.bind(void 0,1),p$,m$,g$,v$,y$,x$,J4.bind(void 0,0),J4.bind(void 0,1),void 0,e3.bind(void 0,0),e3.bind(void 0,1),b$,void 0,w$,void 0,void 0,S$,k$,_$,C$,E$,T$,N$,P$,M$,A$,R$,L$,O$,V2.bind(void 0,1),D$,I$,j$,F$,B$,z$,U$,G$,V$,H$,yy.bind(void 0,0),yy.bind(void 0,1),yy.bind(void 0,2),yy.bind(void 0,3),void 0,void 0,void 0,void 0,W$,V2.bind(void 0,2),V2.bind(void 0,3),H2.bind(void 0,1),H2.bind(void 0,2),H2.bind(void 0,3),q$,$$,void 0,void 0,K$,void 0,Z$,Y$,G2,G2,void 0,void 0,void 0,void 0,void 0,X$,t3.bind(void 0,0),t3.bind(void 0,1),Q$,void 0,J$,eK,tK,rK,nK,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,wd.bind(void 0,1),wd.bind(void 0,2),wd.bind(void 0,3),wd.bind(void 0,4),wd.bind(void 0,5),wd.bind(void 0,6),wd.bind(void 0,7),wd.bind(void 0,8),Sd.bind(void 0,1),Sd.bind(void 0,2),Sd.bind(void 0,3),Sd.bind(void 0,4),Sd.bind(void 0,5),Sd.bind(void 0,6),Sd.bind(void 0,7),Sd.bind(void 0,8),Ft.bind(void 0,0,0,0,0,0),Ft.bind(void 0,0,0,0,0,1),Ft.bind(void 0,0,0,0,0,2),Ft.bind(void 0,0,0,0,0,3),Ft.bind(void 0,0,0,0,1,0),Ft.bind(void 0,0,0,0,1,1),Ft.bind(void 0,0,0,0,1,2),Ft.bind(void 0,0,0,0,1,3),Ft.bind(void 0,0,0,1,0,0),Ft.bind(void 0,0,0,1,0,1),Ft.bind(void 0,0,0,1,0,2),Ft.bind(void 0,0,0,1,0,3),Ft.bind(void 0,0,0,1,1,0),Ft.bind(void 0,0,0,1,1,1),Ft.bind(void 0,0,0,1,1,2),Ft.bind(void 0,0,0,1,1,3),Ft.bind(void 0,0,1,0,0,0),Ft.bind(void 0,0,1,0,0,1),Ft.bind(void 0,0,1,0,0,2),Ft.bind(void 0,0,1,0,0,3),Ft.bind(void 0,0,1,0,1,0),Ft.bind(void 0,0,1,0,1,1),Ft.bind(void 0,0,1,0,1,2),Ft.bind(void 0,0,1,0,1,3),Ft.bind(void 0,0,1,1,0,0),Ft.bind(void 0,0,1,1,0,1),Ft.bind(void 0,0,1,1,0,2),Ft.bind(void 0,0,1,1,0,3),Ft.bind(void 0,0,1,1,1,0),Ft.bind(void 0,0,1,1,1,1),Ft.bind(void 0,0,1,1,1,2),Ft.bind(void 0,0,1,1,1,3),Ft.bind(void 0,1,0,0,0,0),Ft.bind(void 0,1,0,0,0,1),Ft.bind(void 0,1,0,0,0,2),Ft.bind(void 0,1,0,0,0,3),Ft.bind(void 0,1,0,0,1,0),Ft.bind(void 0,1,0,0,1,1),Ft.bind(void 0,1,0,0,1,2),Ft.bind(void 0,1,0,0,1,3),Ft.bind(void 0,1,0,1,0,0),Ft.bind(void 0,1,0,1,0,1),Ft.bind(void 0,1,0,1,0,2),Ft.bind(void 0,1,0,1,0,3),Ft.bind(void 0,1,0,1,1,0),Ft.bind(void 0,1,0,1,1,1),Ft.bind(void 0,1,0,1,1,2),Ft.bind(void 0,1,0,1,1,3),Ft.bind(void 0,1,1,0,0,0),Ft.bind(void 0,1,1,0,0,1),Ft.bind(void 0,1,1,0,0,2),Ft.bind(void 0,1,1,0,0,3),Ft.bind(void 0,1,1,0,1,0),Ft.bind(void 0,1,1,0,1,1),Ft.bind(void 0,1,1,0,1,2),Ft.bind(void 0,1,1,0,1,3),Ft.bind(void 0,1,1,1,0,0),Ft.bind(void 0,1,1,1,0,1),Ft.bind(void 0,1,1,1,0,2),Ft.bind(void 0,1,1,1,0,3),Ft.bind(void 0,1,1,1,1,0),Ft.bind(void 0,1,1,1,1,1),Ft.bind(void 0,1,1,1,1,2),Ft.bind(void 0,1,1,1,1,3)];function gm(t){this.char=t,this.state={},this.activeState=null}function R_(t,e,r){this.contextName=r,this.startIndex=t,this.endOffset=e}function iK(t,e,r){this.contextName=t,this.openRange=null,this.ranges=[],this.checkStart=e,this.checkEnd=r}function Bl(t,e){this.context=t,this.index=e,this.length=t.length,this.current=t[e],this.backtrack=t.slice(0,e),this.lookahead=t.slice(e+1)}function H1(t){this.eventId=t,this.subscribers=[]}function aK(t){var e=this,r=["start","end","next","newToken","contextStart","contextEnd","insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD","updateContextsRanges"];r.forEach(function(i){Object.defineProperty(e.events,i,{value:new H1(i)})}),t&&r.forEach(function(i){var a=t[i];typeof a=="function"&&e.events[i].subscribe(a)});var n=["insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD"];n.forEach(function(i){e.events[i].subscribe(e.updateContextsRanges)})}function mi(t){this.tokens=[],this.registeredContexts={},this.contextCheckers=[],this.events={},this.registeredModifiers=[],aK.call(this,t)}gm.prototype.setState=function(t,e){return this.state[t]=e,this.activeState={key:t,value:this.state[t]},this.activeState};gm.prototype.getState=function(t){return this.state[t]||null};mi.prototype.inboundIndex=function(t){return t>=0&&t<this.tokens.length};mi.prototype.composeRUD=function(t){var e=this,r=!0,n=t.map(function(a){return e[a[0]].apply(e,a.slice(1).concat(r))}),i=function(a){return typeof a=="object"&&a.hasOwnProperty("FAIL")};if(n.every(i))return{FAIL:"composeRUD: one or more operations hasn't completed successfully",report:n.filter(i)};this.dispatch("composeRUD",[n.filter(function(a){return!i(a)})])};mi.prototype.replaceRange=function(t,e,r,n){e=e!==null?e:this.tokens.length;var i=r.every(function(s){return s instanceof gm});if(!isNaN(t)&&this.inboundIndex(t)&&i){var a=this.tokens.splice.apply(this.tokens,[t,e].concat(r));return n||this.dispatch("replaceToken",[t,e,r]),[a,r]}else return{FAIL:"replaceRange: invalid tokens or startIndex."}};mi.prototype.replaceToken=function(t,e,r){if(!isNaN(t)&&this.inboundIndex(t)&&e instanceof gm){var n=this.tokens.splice(t,1,e);return r||this.dispatch("replaceToken",[t,e]),[n[0],e]}else return{FAIL:"replaceToken: invalid token or index."}};mi.prototype.removeRange=function(t,e,r){e=isNaN(e)?this.tokens.length:e;var n=this.tokens.splice(t,e);return r||this.dispatch("removeRange",[n,t,e]),n};mi.prototype.removeToken=function(t,e){if(!isNaN(t)&&this.inboundIndex(t)){var r=this.tokens.splice(t,1);return e||this.dispatch("removeToken",[r,t]),r}else return{FAIL:"removeToken: invalid token index."}};mi.prototype.insertToken=function(t,e,r){var n=t.every(function(i){return i instanceof gm});return n?(this.tokens.splice.apply(this.tokens,[e,0].concat(t)),r||this.dispatch("insertToken",[t,e]),t):{FAIL:"insertToken: invalid token(s)."}};mi.prototype.registerModifier=function(t,e,r){this.events.newToken.subscribe(function(n,i){var a=[n,i],s=e===null||e.apply(this,a)===!0,o=[n,i];if(s){var l=r.apply(this,o);n.setState(t,l)}}),this.registeredModifiers.push(t)};H1.prototype.subscribe=function(t){return typeof t=="function"?this.subscribers.push(t)-1:{FAIL:"invalid '"+this.eventId+"' event handler"}};H1.prototype.unsubscribe=function(t){this.subscribers.splice(t,1)};Bl.prototype.setCurrentIndex=function(t){this.index=t,this.current=this.context[t],this.backtrack=this.context.slice(0,t),this.lookahead=this.context.slice(t+1)};Bl.prototype.get=function(t){switch(!0){case t===0:return this.current;case(t<0&&Math.abs(t)<=this.backtrack.length):return this.backtrack.slice(t)[0];case(t>0&&t<=this.lookahead.length):return this.lookahead[t-1];default:return null}};mi.prototype.rangeToText=function(t){if(t instanceof R_)return this.getRangeTokens(t).map(function(e){return e.char}).join("")};mi.prototype.getText=function(){return this.tokens.map(function(t){return t.char}).join("")};mi.prototype.getContext=function(t){var e=this.registeredContexts[t];return e||null};mi.prototype.on=function(t,e){var r=this.events[t];return r?r.subscribe(e):null};mi.prototype.dispatch=function(t,e){var r=this,n=this.events[t];n instanceof H1&&n.subscribers.forEach(function(i){i.apply(r,e||[])})};mi.prototype.registerContextChecker=function(t,e,r){if(this.getContext(t))return{FAIL:"context name '"+t+"' is already registered."};if(typeof e!="function")return{FAIL:"missing context start check."};if(typeof r!="function")return{FAIL:"missing context end check."};var n=new iK(t,e,r);return this.registeredContexts[t]=n,this.contextCheckers.push(n),n};mi.prototype.getRangeTokens=function(t){var e=t.startIndex+t.endOffset;return[].concat(this.tokens.slice(t.startIndex,e))};mi.prototype.getContextRanges=function(t){var e=this.getContext(t);return e?e.ranges:{FAIL:"context checker '"+t+"' is not registered."}};mi.prototype.resetContextsRanges=function(){var t=this.registeredContexts;for(var e in t)if(t.hasOwnProperty(e)){var r=t[e];r.ranges=[]}};mi.prototype.updateContextsRanges=function(){this.resetContextsRanges();for(var t=this.tokens.map(function(n){return n.char}),e=0;e<t.length;e++){var r=new Bl(t,e);this.runContextCheck(r)}this.dispatch("updateContextsRanges",[this.registeredContexts])};mi.prototype.setEndOffset=function(t,e){var r=this.getContext(e).openRange.startIndex,n=new R_(r,t,e),i=this.getContext(e).ranges;return n.rangeId=e+"."+i.length,i.push(n),this.getContext(e).openRange=null,n};mi.prototype.runContextCheck=function(t){var e=this,r=t.index;this.contextCheckers.forEach(function(n){var i=n.contextName,a=e.getContext(i).openRange;if(!a&&n.checkStart(t)&&(a=new R_(r,null,i),e.getContext(i).openRange=a,e.dispatch("contextStart",[i,r])),a&&n.checkEnd(t)){var s=r-a.startIndex+1,o=e.setEndOffset(s,i);e.dispatch("contextEnd",[i,o])}})};mi.prototype.tokenize=function(t){this.tokens=[],this.resetContextsRanges();var e=Array.from(t);this.dispatch("start");for(var r=0;r<e.length;r++){var n=e[r],i=new Bl(e,r);this.dispatch("next",[i]),this.runContextCheck(i);var a=new gm(n);this.tokens.push(a),this.dispatch("newToken",[a,i])}return this.dispatch("end",[this.tokens]),this.tokens};function Hd(t){return/[\u0600-\u065F\u066A-\u06D2\u06FA-\u06FF]/.test(t)}function gL(t){return/[\u0630\u0690\u0621\u0631\u0661\u0671\u0622\u0632\u0672\u0692\u06C2\u0623\u0673\u0693\u06C3\u0624\u0694\u06C4\u0625\u0675\u0695\u06C5\u06E5\u0676\u0696\u06C6\u0627\u0677\u0697\u06C7\u0648\u0688\u0698\u06C8\u0689\u0699\u06C9\u068A\u06CA\u066B\u068B\u06CB\u068C\u068D\u06CD\u06FD\u068E\u06EE\u06FE\u062F\u068F\u06CF\u06EF]/.test(t)}function tf(t){return/[\u0600-\u0605\u060C-\u060E\u0610-\u061B\u061E\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED]/.test(t)}function $y(t){return/[A-z]/.test(t)}function sK(t){return/\s/.test(t)}function wo(t){this.font=t,this.features={}}function Jf(t){this.id=t.id,this.tag=t.tag,this.substitution=t.substitution}function u0(t,e){if(!t)return-1;switch(e.format){case 1:return e.glyphs.indexOf(t);case 2:for(var r=e.ranges,n=0;n<r.length;n++){var i=r[n];if(t>=i.start&&t<=i.end){var a=t-i.start;return i.index+a}}break;default:return-1}return-1}function oK(t,e){var r=u0(t,e.coverage);return r===-1?null:t+e.deltaGlyphId}function lK(t,e){var r=u0(t,e.coverage);return r===-1?null:e.substitute[r]}function W2(t,e){for(var r=[],n=0;n<t.length;n++){var i=t[n],a=e.current;a=Array.isArray(a)?a[0]:a;var s=u0(a,i);s!==-1&&r.push(s)}return r.length!==t.length?-1:r}function uK(t,e){var r=e.inputCoverage.length+e.lookaheadCoverage.length+e.backtrackCoverage.length;if(t.context.length<r)return[];var n=W2(e.inputCoverage,t);if(n===-1)return[];var i=e.inputCoverage.length-1;if(t.lookahead.length<e.lookaheadCoverage.length)return[];for(var a=t.lookahead.slice(i);a.length&&tf(a[0].char);)a.shift();var s=new Bl(a,0),o=W2(e.lookaheadCoverage,s),l=[].concat(t.backtrack);for(l.reverse();l.length&&tf(l[0].char);)l.shift();if(l.length<e.backtrackCoverage.length)return[];var u=new Bl(l,0),c=W2(e.backtrackCoverage,u),f=n.length===e.inputCoverage.length&&o.length===e.lookaheadCoverage.length&&c.length===e.backtrackCoverage.length,p=[];if(f)for(var v=0;v<e.lookupRecords.length;v++)for(var y=e.lookupRecords[v],S=y.lookupListIndex,w=this.getLookupByIndex(S),E=0;E<w.subtables.length;E++){var _=w.subtables[E],T=this.getLookupMethod(w,_),N=this.getSubstitutionType(w,_);if(N==="12")for(var R=0;R<n.length;R++){var I=t.get(R),F=T(I);F&&p.push(F)}}return p}function cK(t,e){var r=t.current,n=u0(r,e.coverage);if(n===-1)return null;for(var i,a=e.ligatureSets[n],s=0;s<a.length;s++){i=a[s];for(var o=0;o<i.components.length;o++){var l=t.lookahead[o],u=i.components[o];if(l!==u)break;if(o===i.components.length-1)return i}}return null}function dK(t,e){var r=u0(t,e.coverage);return r===-1?null:e.sequences[r]}wo.prototype.getDefaultScriptFeaturesIndexes=function(){for(var t=this.font.tables.gsub.scripts,e=0;e<t.length;e++){var r=t[e];if(r.tag==="DFLT")return r.script.defaultLangSys.featureIndexes}return[]};wo.prototype.getScriptFeaturesIndexes=function(t){var e=this.font.tables;if(!e.gsub)return[];if(!t)return this.getDefaultScriptFeaturesIndexes();for(var r=this.font.tables.gsub.scripts,n=0;n<r.length;n++){var i=r[n];if(i.tag===t&&i.script.defaultLangSys)return i.script.defaultLangSys.featureIndexes;var a=i.langSysRecords;if(a)for(var s=0;s<a.length;s++){var o=a[s];if(o.tag===t){var l=o.langSys;return l.featureIndexes}}}return this.getDefaultScriptFeaturesIndexes()};wo.prototype.mapTagsToFeatures=function(t,e){for(var r={},n=0;n<t.length;n++){var i=t[n].tag,a=t[n].feature;r[i]=a}this.features[e].tags=r};wo.prototype.getScriptFeatures=function(t){var e=this.features[t];if(this.features.hasOwnProperty(t))return e;var r=this.getScriptFeaturesIndexes(t);if(!r)return null;var n=this.font.tables.gsub;return e=r.map(function(i){return n.features[i]}),this.features[t]=e,this.mapTagsToFeatures(e,t),e};wo.prototype.getSubstitutionType=function(t,e){var r=t.lookupType.toString(),n=e.substFormat.toString();return r+n};wo.prototype.getLookupMethod=function(t,e){var r=this,n=this.getSubstitutionType(t,e);switch(n){case"11":return function(i){return oK.apply(r,[i,e])};case"12":return function(i){return lK.apply(r,[i,e])};case"63":return function(i){return uK.apply(r,[i,e])};case"41":return function(i){return cK.apply(r,[i,e])};case"21":return function(i){return dK.apply(r,[i,e])};default:throw new Error("lookupType: "+t.lookupType+" - substFormat: "+e.substFormat+" is not yet supported")}};wo.prototype.lookupFeature=function(t){var e=t.contextParams,r=e.index,n=this.getFeature({tag:t.tag,script:t.script});if(!n)return new Error("font '"+this.font.names.fullName.en+"' doesn't support feature '"+t.tag+"' for script '"+t.script+"'.");for(var i=this.getFeatureLookups(n),a=[].concat(e.context),s=0;s<i.length;s++)for(var o=i[s],l=this.getLookupSubtables(o),u=0;u<l.length;u++){var c=l[u],f=this.getSubstitutionType(o,c),p=this.getLookupMethod(o,c),v=void 0;switch(f){case"11":v=p(e.current),v&&a.splice(r,1,new Jf({id:11,tag:t.tag,substitution:v}));break;case"12":v=p(e.current),v&&a.splice(r,1,new Jf({id:12,tag:t.tag,substitution:v}));break;case"63":v=p(e),Array.isArray(v)&&v.length&&a.splice(r,1,new Jf({id:63,tag:t.tag,substitution:v}));break;case"41":v=p(e),v&&a.splice(r,1,new Jf({id:41,tag:t.tag,substitution:v}));break;case"21":v=p(e.current),v&&a.splice(r,1,new Jf({id:21,tag:t.tag,substitution:v}));break}e=new Bl(a,r),!(Array.isArray(v)&&!v.length)&&(v=null)}return a.length?a:null};wo.prototype.supports=function(t){if(!t.script)return!1;this.getScriptFeatures(t.script);var e=this.features.hasOwnProperty(t.script);if(!t.tag)return e;var r=this.features[t.script].some(function(n){return n.tag===t.tag});return e&&r};wo.prototype.getLookupSubtables=function(t){return t.subtables||null};wo.prototype.getLookupByIndex=function(t){var e=this.font.tables.gsub.lookups;return e[t]||null};wo.prototype.getFeatureLookups=function(t){return t.lookupListIndexes.map(this.getLookupByIndex.bind(this))};wo.prototype.getFeature=function(e){if(!this.font)return{FAIL:"No font was found"};this.features.hasOwnProperty(e.script)||this.getScriptFeatures(e.script);var r=this.features[e.script];return r?r.tags[e.tag]?this.features[e.script].tags[e.tag]:null:{FAIL:"No feature for script "+e.script}};function fK(t){var e=t.current,r=t.get(-1);return r===null&&Hd(e)||!Hd(r)&&Hd(e)}function hK(t){var e=t.get(1);return e===null||!Hd(e)}var pK={startCheck:fK,endCheck:hK};function mK(t){var e=t.current,r=t.get(-1);return(Hd(e)||tf(e))&&!Hd(r)}function gK(t){var e=t.get(1);switch(!0){case e===null:return!0;case(!Hd(e)&&!tf(e)):var r=sK(e);if(!r)return!0;if(r){var n=!1;if(n=t.lookahead.some(function(i){return Hd(i)||tf(i)}),!n)return!0}break;default:return!1}}var vK={startCheck:mK,endCheck:gK};function yK(t,e,r){e[r].setState(t.tag,t.substitution)}function xK(t,e,r){e[r].setState(t.tag,t.substitution)}function bK(t,e,r){t.substitution.forEach(function(n,i){var a=e[r+i];a.setState(t.tag,n)})}function wK(t,e,r){var n=e[r];n.setState(t.tag,t.substitution.ligGlyph);for(var i=t.substitution.components.length,a=0;a<i;a++)n=e[r+a+1],n.setState("deleted",!0)}var r3={11:yK,12:xK,63:bK,41:wK};function L_(t,e,r){t instanceof Jf&&r3[t.id]&&r3[t.id](t,e,r)}function SK(t){for(var e=[].concat(t.backtrack),r=e.length-1;r>=0;r--){var n=e[r],i=gL(n),a=tf(n);if(!i&&!a)return!0;if(i)return!1}return!1}function kK(t){if(gL(t.current))return!1;for(var e=0;e<t.lookahead.length;e++){var r=t.lookahead[e],n=tf(r);if(!n)return!0}return!1}function _K(t){var e=this,r="arab",n=this.featuresTags[r],i=this.tokenizer.getRangeTokens(t);if(i.length!==1){var a=new Bl(i.map(function(o){return o.getState("glyphIndex")}),0),s=new Bl(i.map(function(o){return o.char}),0);i.forEach(function(o,l){if(!tf(o.char)){a.setCurrentIndex(l),s.setCurrentIndex(l);var u=0;SK(s)&&(u|=1),kK(s)&&(u|=2);var c;switch(u){case 1:c="fina";break;case 2:c="init";break;case 3:c="medi";break}if(n.indexOf(c)!==-1){var f=e.query.lookupFeature({tag:c,script:r,contextParams:a});if(f instanceof Error)return console.info(f.message);f.forEach(function(p,v){p instanceof Jf&&(L_(p,i,v),a.context[v]=p.substitution)})}}})}}function n3(t,e){var r=t.map(function(n){return n.activeState.value});return new Bl(r,0)}function CK(t){var e=this,r="arab",n=this.tokenizer.getRangeTokens(t),i=n3(n);i.context.forEach(function(a,s){i.setCurrentIndex(s);var o=e.query.lookupFeature({tag:"rlig",script:r,contextParams:i});o.length&&(o.forEach(function(l){return L_(l,n,s)}),i=n3(n))})}function EK(t){var e=t.current,r=t.get(-1);return r===null&&$y(e)||!$y(r)&&$y(e)}function TK(t){var e=t.get(1);return e===null||!$y(e)}var NK={startCheck:EK,endCheck:TK};function i3(t,e){var r=t.map(function(n){return n.activeState.value});return new Bl(r,0)}function PK(t){var e=this,r="latn",n=this.tokenizer.getRangeTokens(t),i=i3(n);i.context.forEach(function(a,s){i.setCurrentIndex(s);var o=e.query.lookupFeature({tag:"liga",script:r,contextParams:i});o.length&&(o.forEach(function(l){return L_(l,n,s)}),i=i3(n))})}function Ul(t){this.baseDir=t||"ltr",this.tokenizer=new mi,this.featuresTags={}}Ul.prototype.setText=function(t){this.text=t};Ul.prototype.contextChecks={latinWordCheck:NK,arabicWordCheck:pK,arabicSentenceCheck:vK};function q2(t){var e=this.contextChecks[t+"Check"];return this.tokenizer.registerContextChecker(t,e.startCheck,e.endCheck)}function MK(){return q2.call(this,"latinWord"),q2.call(this,"arabicWord"),q2.call(this,"arabicSentence"),this.tokenizer.tokenize(this.text)}function AK(){var t=this,e=this.tokenizer.getContextRanges("arabicSentence");e.forEach(function(r){var n=t.tokenizer.getRangeTokens(r);t.tokenizer.replaceRange(r.startIndex,r.endOffset,n.reverse())})}Ul.prototype.registerFeatures=function(t,e){var r=this,n=e.filter(function(i){return r.query.supports({script:t,tag:i})});this.featuresTags.hasOwnProperty(t)?this.featuresTags[t]=this.featuresTags[t].concat(n):this.featuresTags[t]=n};Ul.prototype.applyFeatures=function(t,e){if(!t)throw new Error("No valid font was provided to apply features");this.query||(this.query=new wo(t));for(var r=0;r<e.length;r++){var n=e[r];this.query.supports({script:n.script})&&this.registerFeatures(n.script,n.tags)}};Ul.prototype.registerModifier=function(t,e,r){this.tokenizer.registerModifier(t,e,r)};function O_(){if(this.tokenizer.registeredModifiers.indexOf("glyphIndex")===-1)throw new Error("glyphIndex modifier is required to apply arabic presentation features.")}function RK(){var t=this,e="arab";if(this.featuresTags.hasOwnProperty(e)){O_.call(this);var r=this.tokenizer.getContextRanges("arabicWord");r.forEach(function(n){_K.call(t,n)})}}function LK(){var t=this,e="arab";if(this.featuresTags.hasOwnProperty(e)){var r=this.featuresTags[e];if(r.indexOf("rlig")!==-1){O_.call(this);var n=this.tokenizer.getContextRanges("arabicWord");n.forEach(function(i){CK.call(t,i)})}}}function OK(){var t=this,e="latn";if(this.featuresTags.hasOwnProperty(e)){var r=this.featuresTags[e];if(r.indexOf("liga")!==-1){O_.call(this);var n=this.tokenizer.getContextRanges("latinWord");n.forEach(function(i){PK.call(t,i)})}}}Ul.prototype.checkContextReady=function(t){return!!this.tokenizer.getContext(t)};Ul.prototype.applyFeaturesToContexts=function(){this.checkContextReady("arabicWord")&&(RK.call(this),LK.call(this)),this.checkContextReady("latinWord")&&OK.call(this),this.checkContextReady("arabicSentence")&&AK.call(this)};Ul.prototype.processText=function(t){(!this.text||this.text!==t)&&(this.setText(t),MK.call(this),this.applyFeaturesToContexts())};Ul.prototype.getBidiText=function(t){return this.processText(t),this.tokenizer.getText()};Ul.prototype.getTextGlyphs=function(t){this.processText(t);for(var e=[],r=0;r<this.tokenizer.tokens.length;r++){var n=this.tokenizer.tokens[r];if(!n.state.deleted){var i=n.activeState.value;e.push(Array.isArray(i)?i[0]:i)}}return e};function Mn(t){t=t||{},t.tables=t.tables||{},t.empty||(Fg(t.familyName,"When creating a new Font object, familyName is required."),Fg(t.styleName,"When creating a new Font object, styleName is required."),Fg(t.unitsPerEm,"When creating a new Font object, unitsPerEm is required."),Fg(t.ascender,"When creating a new Font object, ascender is required."),Fg(t.descender<=0,"When creating a new Font object, negative descender value is required."),this.names={fontFamily:{en:t.familyName||" "},fontSubfamily:{en:t.styleName||" "},fullName:{en:t.fullName||t.familyName+" "+t.styleName},postScriptName:{en:t.postScriptName||(t.familyName+t.styleName).replace(/\s/g,"")},designer:{en:t.designer||" "},designerURL:{en:t.designerURL||" "},manufacturer:{en:t.manufacturer||" "},manufacturerURL:{en:t.manufacturerURL||" "},license:{en:t.license||" "},licenseURL:{en:t.licenseURL||" "},version:{en:t.version||"Version 0.1"},description:{en:t.description||" "},copyright:{en:t.copyright||" "},trademark:{en:t.trademark||" "}},this.unitsPerEm=t.unitsPerEm||1e3,this.ascender=t.ascender,this.descender=t.descender,this.createdTimestamp=t.createdTimestamp,this.tables=Object.assign(t.tables,{os2:Object.assign({usWeightClass:t.weightClass||this.usWeightClasses.MEDIUM,usWidthClass:t.widthClass||this.usWidthClasses.MEDIUM,fsSelection:t.fsSelection||this.fsSelectionValues.REGULAR},t.tables.os2)})),this.supported=!0,this.glyphs=new Cu.GlyphSet(this,t.glyphs||[]),this.encoding=new $R(this),this.position=new s0(this),this.substitution=new bo(this),this.tables=this.tables||{},this._push=null,this._hmtxTableData={},Object.defineProperty(this,"hinting",{get:function(){if(this._hinting)return this._hinting;if(this.outlinesFormat==="truetype")return this._hinting=new fL(this)}})}Mn.prototype.hasChar=function(t){return this.encoding.charToGlyphIndex(t)!==null};Mn.prototype.charToGlyphIndex=function(t){return this.encoding.charToGlyphIndex(t)};Mn.prototype.charToGlyph=function(t){var e=this.charToGlyphIndex(t),r=this.glyphs.get(e);return r||(r=this.glyphs.get(0)),r};Mn.prototype.updateFeatures=function(t){return this.defaultRenderOptions.features.map(function(e){return e.script==="latn"?{script:"latn",tags:e.tags.filter(function(r){return t[r]})}:e})};Mn.prototype.stringToGlyphs=function(t,e){var r=this,n=new Ul,i=function(f){return r.charToGlyphIndex(f.char)};n.registerModifier("glyphIndex",null,i);var a=e?this.updateFeatures(e.features):this.defaultRenderOptions.features;n.applyFeatures(this,a);for(var s=n.getTextGlyphs(t),o=s.length,l=new Array(o),u=this.glyphs.get(0),c=0;c<o;c+=1)l[c]=this.glyphs.get(s[c])||u;return l};Mn.prototype.nameToGlyphIndex=function(t){return this.glyphNames.nameToGlyphIndex(t)};Mn.prototype.nameToGlyph=function(t){var e=this.nameToGlyphIndex(t),r=this.glyphs.get(e);return r||(r=this.glyphs.get(0)),r};Mn.prototype.glyphIndexToName=function(t){return this.glyphNames.glyphIndexToName?this.glyphNames.glyphIndexToName(t):""};Mn.prototype.getKerningValue=function(t,e){t=t.index||t,e=e.index||e;var r=this.position.defaultKerningTables;return r?this.position.getKerningValue(r,t,e):this.kerningPairs[t+","+e]||0};Mn.prototype.defaultRenderOptions={kerning:!0,features:[{script:"arab",tags:["init","medi","fina","rlig"]},{script:"latn",tags:["liga","rlig"]}]};Mn.prototype.forEachGlyph=function(t,e,r,n,i,a){e=e!==void 0?e:0,r=r!==void 0?r:0,n=n!==void 0?n:72,i=Object.assign({},this.defaultRenderOptions,i);var s=1/this.unitsPerEm*n,o=this.stringToGlyphs(t,i),l;if(i.kerning){var u=i.script||this.position.getDefaultScriptName();l=this.position.getKerningTables(u,i.language)}for(var c=0;c<o.length;c+=1){var f=o[c];if(a.call(this,f,e,r,n,i),f.advanceWidth&&(e+=f.advanceWidth*s),i.kerning&&c<o.length-1){var p=l?this.position.getKerningValue(l,f.index,o[c+1].index):this.getKerningValue(f,o[c+1]);e+=p*s}i.letterSpacing?e+=i.letterSpacing*n:i.tracking&&(e+=i.tracking/1e3*n)}return e};Mn.prototype.getPath=function(t,e,r,n,i){var a=new Ki;return this.forEachGlyph(t,e,r,n,i,function(s,o,l,u){var c=s.getPath(o,l,u,i,this);a.extend(c)}),a};Mn.prototype.getPaths=function(t,e,r,n,i){var a=[];return this.forEachGlyph(t,e,r,n,i,function(s,o,l,u){var c=s.getPath(o,l,u,i,this);a.push(c)}),a};Mn.prototype.getAdvanceWidth=function(t,e,r){return this.forEachGlyph(t,0,0,e,r,function(){})};Mn.prototype.draw=function(t,e,r,n,i,a){this.getPath(e,r,n,i,a).draw(t)};Mn.prototype.drawPoints=function(t,e,r,n,i,a){this.forEachGlyph(e,r,n,i,a,function(s,o,l,u){s.drawPoints(t,o,l,u)})};Mn.prototype.drawMetrics=function(t,e,r,n,i,a){this.forEachGlyph(e,r,n,i,a,function(s,o,l,u){s.drawMetrics(t,o,l,u)})};Mn.prototype.getEnglishName=function(t){var e=this.names[t];if(e)return e.en};Mn.prototype.validate=function(){var t=this;function e(n,i){}function r(n){var i=t.getEnglishName(n);i&&i.trim().length>0}r("fontFamily"),r("weightName"),r("manufacturer"),r("copyright"),r("version"),this.unitsPerEm>0};Mn.prototype.toTables=function(){return bq.fontToTable(this)};Mn.prototype.toBuffer=function(){return console.warn("Font.toBuffer is deprecated. Use Font.toArrayBuffer instead."),this.toArrayBuffer()};Mn.prototype.toArrayBuffer=function(){for(var t=this.toTables(),e=t.encode(),r=new ArrayBuffer(e.length),n=new Uint8Array(r),i=0;i<e.length;i++)n[i]=e[i];return r};Mn.prototype.download=function(t){var e=this.getEnglishName("fontFamily"),r=this.getEnglishName("fontSubfamily");t=t||e.replace(/\s/g,"")+"-"+r+".otf";var n=this.toArrayBuffer();if(Sq())if(window.URL=window.URL||window.webkitURL,window.URL){var i=new DataView(n),a=new Blob([i],{type:"font/opentype"}),s=document.createElement("a");s.href=window.URL.createObjectURL(a),s.download=t;var o=document.createEvent("MouseEvents");o.initEvent("click",!0,!1),s.dispatchEvent(o)}else console.warn("Font file could not be downloaded. Try using a different browser.");else{var l=require("fs"),u=kq(n);l.writeFileSync(t,u)}};Mn.prototype.fsSelectionValues={ITALIC:1,UNDERSCORE:2,NEGATIVE:4,OUTLINED:8,STRIKEOUT:16,BOLD:32,REGULAR:64,USER_TYPO_METRICS:128,WWS:256,OBLIQUE:512};Mn.prototype.usWidthClasses={ULTRA_CONDENSED:1,EXTRA_CONDENSED:2,CONDENSED:3,SEMI_CONDENSED:4,MEDIUM:5,SEMI_EXPANDED:6,EXPANDED:7,EXTRA_EXPANDED:8,ULTRA_EXPANDED:9};Mn.prototype.usWeightClasses={THIN:100,EXTRA_LIGHT:200,LIGHT:300,NORMAL:400,MEDIUM:500,SEMI_BOLD:600,BOLD:700,EXTRA_BOLD:800,BLACK:900};var kc=new Array(10);kc[1]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{posFormat:1,coverage:this.parsePointer(We.coverage),value:this.parseValueRecord()};if(r===2)return{posFormat:2,coverage:this.parsePointer(We.coverage),values:this.parseValueRecordList()};pr.assert(!1,"0x"+e.toString(16)+": GPOS lookup type 1 format must be 1 or 2.")};kc[2]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();pr.assert(r===1||r===2,"0x"+e.toString(16)+": GPOS lookup type 2 format must be 1 or 2.");var n=this.parsePointer(We.coverage),i=this.parseUShort(),a=this.parseUShort();if(r===1)return{posFormat:r,coverage:n,valueFormat1:i,valueFormat2:a,pairSets:this.parseList(We.pointer(We.list(function(){return{secondGlyph:this.parseUShort(),value1:this.parseValueRecord(i),value2:this.parseValueRecord(a)}})))};if(r===2){var s=this.parsePointer(We.classDef),o=this.parsePointer(We.classDef),l=this.parseUShort(),u=this.parseUShort();return{posFormat:r,coverage:n,valueFormat1:i,valueFormat2:a,classDef1:s,classDef2:o,class1Count:l,class2Count:u,classRecords:this.parseList(l,We.list(u,function(){return{value1:this.parseValueRecord(i),value2:this.parseValueRecord(a)}}))}}};kc[3]=function(){return{error:"GPOS Lookup 3 not supported"}};kc[4]=function(){return{error:"GPOS Lookup 4 not supported"}};kc[5]=function(){return{error:"GPOS Lookup 5 not supported"}};kc[6]=function(){return{error:"GPOS Lookup 6 not supported"}};kc[7]=function(){return{error:"GPOS Lookup 7 not supported"}};kc[8]=function(){return{error:"GPOS Lookup 8 not supported"}};kc[9]=function(){return{error:"GPOS Lookup 9 not supported"}};new Array(10);const DK=({stageRef:t,layers:e,selectedShapeId:r,onSelectShape:n,onChangeShape:i,tool:a,color:s,strokeWidth:o,lineCap:l,onDrawEnd:u})=>{const c=ae.useRef(!1),[f,p]=nr.useState(null),v=N=>{const R=N.target.getStage(),I=R.getRelativePointerPosition();if(a==="select"){if(N.target===R)n(null),p({x1:I.x,y1:I.y,x2:I.x,y2:I.y});else{const D=N.target;D.name()==="shape"&&n(D.id())}return}c.current=!0,u("START",{tool:a,pos:I,stroke:s,strokeWidth:o,lineCap:l})},y=N=>{const I=N.target.getStage().getRelativePointerPosition();if(a==="select"&&f){p(F=>({...F,x2:I.x,y2:I.y}));return}c.current&&u("MOVE",{pos:I})},S=N=>{if(a==="select"&&f){const R=Math.min(f.x1,f.x2),I=Math.min(f.y1,f.y2),F=Math.abs(f.x1-f.x2),D=Math.abs(f.y1-f.y2);if(F>5&&D>5){const G=N.target.getStage().find(".shape").filter(K=>{const O=K.getClientRect();return O.x>=R&&O.y>=I&&O.x+O.width<=R+F&&O.y+O.height<=I+D});n(G.map(K=>K.id()))}p(null)}c.current=!1,u("END")},w=ae.useRef(null),[E,_]=nr.useState({width:0,height:0});nr.useLayoutEffect(()=>{const N=()=>{w.current&&_({width:w.current.offsetWidth,height:w.current.offsetHeight})};return window.addEventListener("resize",N),N(),()=>window.removeEventListener("resize",N)},[]);const T=Array.isArray(r);return m.jsxs("div",{ref:w,className:"w-full h-full bg-[#050B0D] relative overflow-hidden flex items-center justify-center",children:[m.jsx("div",{className:"absolute inset-0 opacity-10",style:{backgroundImage:"radial-gradient(#00E5FF 1px, transparent 1px)",backgroundSize:"20px 20px"}}),m.jsxs(RR,{width:E.width,height:E.height,ref:t,onMouseDown:v,onMouseMove:y,onMouseUp:S,className:"bg-black/20 shadow-2xl border border-white/5",children:[e.slice().reverse().map(N=>N.visible&&m.jsx(vx,{children:N.shapes.map(R=>{T?r.includes(R.id):R.id;const I={...R,name:"shape",id:R.id,onClick:()=>a==="select"&&!N.locked&&n(R.id),onTap:()=>a==="select"&&!N.locked&&n(R.id),draggable:a==="select"&&!N.locked,onDragEnd:F=>{i(R.id,{x:F.target.x(),y:F.target.y()})},onTransformEnd:F=>{const D=F.target,j={x:D.x(),y:D.y(),scaleX:D.scaleX(),scaleY:D.scaleY(),rotation:D.rotation()};R.type==="rect"&&(j.width=D.width()*D.scaleX(),j.height=D.height()*D.scaleY(),j.scaleX=1,j.scaleY=1),i(R.id,j)}};return m.jsxs(nr.Fragment,{children:[R.type==="line"&&m.jsx(MR,{...I,lineCap:R.lineCap||"round",lineJoin:R.lineJoin||"round",tension:R.tension||0}),R.type==="path"&&m.jsx(uH,{...I,data:R.data,fill:R.fill||"#00E5FF",stroke:R.stroke||"#00E5FF"}),R.type==="rect"&&m.jsx(yx,{...I}),R.type==="circle"&&m.jsx(sH,{...I})]},R.id)})},N.id)),m.jsxs(vx,{children:[f&&m.jsx(yx,{x:Math.min(f.x1,f.x2),y:Math.min(f.y1,f.y2),width:Math.abs(f.x1-f.x2),height:Math.abs(f.y1-f.y2),fill:"rgba(0, 229, 255, 0.1)",stroke:"#00E5FF",strokeWidth:1,dash:[5,5]}),a==="select"&&r&&m.jsx(IK,{selectedShapeIds:T?r:[r]})]})]})]})},IK=({selectedShapeIds:t})=>{const e=ae.useRef();return ae.useEffect(()=>{if(e.current){const r=e.current.getStage(),n=t.map(i=>r.findOne("#"+i)).filter(Boolean);e.current.nodes(n),e.current.getLayer().batchDraw()}},[t]),m.jsx(AR,{ref:e,boundBoxFunc:(r,n)=>n.width<5||n.height<5?r:n,borderStroke:"#00E5FF",anchorStroke:"#00E5FF",anchorFill:"#050B0D",anchorSize:8})},jK=({tool:t,setTool:e,strokeWidth:r,setStrokeWidth:n,color:i,setColor:a,opacity:s,setOpacity:o,lineCap:l,setLineCap:u,strokeStyle:c,setStrokeStyle:f,layers:p,activeLayerId:v,setActiveLayerId:y,onToggleLayerVisibility:S,onToggleLayerLock:w,onAddLayer:E,onDeleteLayer:_,activeShape:T,onSetProperty:N,onUndo:R,onRedo:I,onClear:F})=>m.jsxs("div",{className:"flex flex-col h-full gap-8 p-6 text-slate-300",children:[m.jsxs("section",{className:"bg-white/5 rounded-2xl p-4 grid grid-cols-4 gap-2",children:[[{id:"select",icon:"near_me",label:"Select"},{id:"brush",icon:"gesture",label:"Brush"},{id:"line",icon:"horizontal_rule",label:"Line"},{id:"rect",icon:"rectangle",label:"Box"},{id:"circle",icon:"circle",label:"Circle"},{id:"eraser",icon:"ink_eraser",label:"Erase"}].map(D=>m.jsx("button",{onClick:()=>e(D.id),className:`aspect-square rounded-xl flex flex-col items-center justify-center gap-1 transition-all ${t===D.id?"bg-primary text-white shadow-[0_0_15px_rgba(0,229,255,0.4)]":"text-slate-400 hover:text-white hover:bg-white/10"}`,title:D.label,children:m.jsx("span",{className:"material-symbols-outlined text-xl",children:D.icon})},D.id)),m.jsx("button",{onClick:R,className:"aspect-square rounded-xl flex items-center justify-center text-slate-500 hover:text-white hover:bg-white/10",title:"Undo",children:m.jsx("span",{className:"material-symbols-outlined text-xl",children:"undo"})}),m.jsx("button",{onClick:I,className:"aspect-square rounded-xl flex items-center justify-center text-slate-500 hover:text-white hover:bg-white/10",title:"Redo",children:m.jsx("span",{className:"material-symbols-outlined text-xl",children:"redo"})}),m.jsx("button",{onClick:F,className:"aspect-square rounded-xl flex items-center justify-center text-slate-500 hover:text-red-400 hover:bg-red-400/10",title:"Clear Canvas",children:m.jsx("span",{className:"material-symbols-outlined text-xl",children:"delete_sweep"})})]}),m.jsxs("section",{className:"space-y-6",children:[m.jsx("h3",{className:"text-xs font-black uppercase tracking-[0.2em] text-primary/60 border-b border-white/5 pb-2",children:"Propiedades"}),m.jsxs("div",{className:"space-y-3",children:[m.jsxs("div",{className:"flex justify-between text-[10px] uppercase font-bold text-slate-500",children:[m.jsx("span",{children:"Grosor de Trazo"}),m.jsxs("span",{children:[r,"px"]})]}),m.jsx("input",{type:"range",min:"1",max:"50",value:r,onChange:D=>n(parseInt(D.target.value)),className:"w-full accent-primary h-1 bg-white/10 rounded-full appearance-none cursor-pointer"})]}),m.jsxs("div",{className:"space-y-3",children:[m.jsxs("div",{className:"flex justify-between text-[10px] uppercase font-bold text-slate-500",children:[m.jsx("span",{children:"Opacidad"}),m.jsxs("span",{children:[Math.round(s*100),"%"]})]}),m.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:s,onChange:D=>o(parseFloat(D.target.value)),className:"w-full accent-primary h-1 bg-white/10 rounded-full appearance-none cursor-pointer"})]}),m.jsxs("div",{className:"space-y-3",children:[m.jsx("span",{className:"text-[10px] uppercase font-bold text-slate-500",children:"Color / Relleno"}),m.jsxs("div",{className:"flex items-center gap-3 p-2 bg-white/5 rounded-lg border border-white/5",children:[m.jsx("input",{type:"color",value:i,onChange:D=>a(D.target.value),className:"size-8 rounded cursor-pointer bg-transparent border-none"}),m.jsx("span",{className:"text-xs font-mono text-primary",children:i})]})]}),m.jsxs("div",{className:"space-y-3",children:[m.jsx("span",{className:"text-[10px] uppercase font-bold text-slate-500",children:"Terminacin (Cap)"}),m.jsx("div",{className:"flex bg-white/5 rounded-lg p-1",children:["butt","round","square"].map(D=>m.jsx("button",{onClick:()=>u(D),className:`flex-1 py-1 rounded text-[10px] uppercase transition-all ${l===D?"bg-primary text-white shadow-lg font-black":"hover:text-white text-slate-500"}`,children:D==="round"?"":D==="square"?"":"|"},D))})]}),m.jsxs("div",{className:"space-y-3",children:[m.jsx("span",{className:"text-[10px] uppercase font-bold text-slate-500",children:"Estilo de Trazo"}),m.jsx("div",{className:"flex bg-white/5 rounded-lg p-1",children:[{id:"linear",label:"Lnea",icon:"segment"},{id:"points",label:"Puntos",icon:"more_horiz"},{id:"quadratic",label:"Curva",icon:"conversion_path"}].map(D=>m.jsx("button",{onClick:()=>f(D.id),className:`flex-1 py-1.5 rounded flex items-center justify-center gap-2 text-[9px] uppercase transition-all ${c===D.id?"bg-primary text-white shadow-lg font-black":"hover:text-white text-slate-500"}`,title:D.label,children:m.jsx("span",{className:"material-symbols-outlined text-xs",children:D.icon})},D.id))})]})]}),m.jsxs("section",{className:"flex-1 flex flex-col min-h-0 space-y-4",children:[m.jsxs("div",{className:"flex items-center justify-between border-b border-white/5 pb-2",children:[m.jsx("h3",{className:"text-xs font-black uppercase tracking-[0.2em] text-primary/60",children:"Capas"}),m.jsx("button",{onClick:E,className:"size-6 flex items-center justify-center rounded bg-white/5 hover:bg-primary hover:text-white transition-colors",title:"Nueva Capa",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"add"})})]}),m.jsx("div",{className:"flex-1 overflow-y-auto space-y-2 pr-2 custom-scrollbar",children:p.slice().reverse().map(D=>m.jsxs("div",{onClick:()=>y(D.id),className:`group flex items-center gap-3 p-3 rounded-lg border transition-all cursor-pointer ${v===D.id?"bg-primary/10 border-primary/50":"bg-white/5 border-transparent hover:border-white/10"}`,children:[m.jsx("button",{onClick:j=>{j.stopPropagation(),S(D.id)},className:`text-slate-500 hover:text-white ${!D.visible&&"opacity-30"}`,children:m.jsx("span",{className:"material-symbols-outlined text-base",children:D.visible?"visibility":"visibility_off"})}),m.jsxs("div",{className:"flex-1 flex flex-col",children:[m.jsx("span",{className:`text-xs font-bold leading-none ${v===D.id?"text-white":"text-slate-400"}`,children:D.name}),m.jsxs("span",{className:"text-[9px] font-black uppercase text-slate-600 mt-1",children:[D.shapes.length," Objetos"]})]}),m.jsxs("div",{className:"flex items-center gap-1",children:[m.jsx("button",{onClick:j=>{j.stopPropagation(),w(D.id)},className:`text-slate-500 hover:text-white p-1 rounded hover:bg-white/5 ${D.locked?"text-red-400 opacity-100":"opacity-0 group-hover:opacity-100"}`,children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:D.locked?"lock":"lock_open"})}),m.jsx("button",{onClick:j=>{j.stopPropagation(),_(D.id)},className:"p-1 text-slate-500 hover:text-red-400 opacity-0 group-hover:opacity-100 rounded hover:bg-white/5",title:"Eliminar Capa",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})})]})]},D.id))})]})]}),FK=({stats:t,langName:e,glyphs:r=[],rules:n=[],onEditGlyph:i,onCreateGlyph:a,onCreateRule:s,onViewAllGlyphs:o})=>{const{t:l}=Ps();return m.jsxs("div",{className:"h-full flex flex-col p-4 space-y-6 animate-in fade-in slide-in-from-right-4 overflow-y-auto custom-scrollbar",children:[m.jsxs("div",{className:"flex items-center gap-3 text-slate-400 shrink-0",children:[m.jsx("span",{className:"material-symbols-outlined",children:"translate"}),m.jsx("h3",{className:"text-xs font-black uppercase tracking-widest",children:e||"Language"})]}),m.jsxs("div",{className:"grid grid-cols-3 gap-2 shrink-0",children:[m.jsxs("div",{className:"bg-[#1a1a20] border border-white/5 p-2 rounded-xl text-center",children:[m.jsx("div",{className:"text-xl font-serif text-white font-bold",children:t?.words||0}),m.jsx("div",{className:"text-[8px] text-slate-500 uppercase tracking-widest",children:"Words"})]}),m.jsxs("div",{className:"bg-[#1a1a20] border border-white/5 p-2 rounded-xl text-center",children:[m.jsx("div",{className:"text-xl font-serif text-white font-bold",children:t?.rules||0}),m.jsx("div",{className:"text-[8px] text-slate-500 uppercase tracking-widest",children:"Rules"})]}),m.jsxs("div",{className:"bg-[#1a1a20] border border-white/5 p-2 rounded-xl text-center",children:[m.jsx("div",{className:"text-xl font-serif text-white font-bold",children:t?.glyphs||0}),m.jsx("div",{className:"text-[8px] text-slate-500 uppercase tracking-widest",children:"Glyphs"})]})]}),m.jsx("div",{className:"h-px bg-white/5 my-2 shrink-0"}),m.jsxs("section",{className:"space-y-4 shrink-0",children:[m.jsxs("div",{className:"flex justify-between items-center",children:[m.jsx("h4",{className:"text-[10px] font-black uppercase tracking-widest text-slate-500",children:l("linguistics.writing_system")||"WRITING SYSTEM"}),m.jsx("button",{onClick:a,className:"text-primary hover:text-white transition-colors",title:"Create New Glyph",children:m.jsx("span",{className:"material-symbols-outlined text-lg",children:"add_circle"})})]}),m.jsxs("div",{className:"p-4 bg-[#1a1a20] border border-white/5 rounded-2xl",children:[m.jsxs("div",{className:"grid grid-cols-4 gap-2",children:[r.slice(0,12).map(u=>m.jsx("div",{onClick:()=>i(u),className:"aspect-square rounded-lg bg-black/40 border border-white/5 flex items-center justify-center text-xl font-serif text-primary hover:border-primary/40 hover:bg-primary/5 transition-all cursor-pointer",title:u.lema,children:m.jsx("span",{children:u.lema})},u.id)),r.length===0&&m.jsx("div",{className:"col-span-4 py-8 flex items-center justify-center opacity-20",children:m.jsx("span",{className:"text-[8px] font-black uppercase font-mono",children:"No Glyphs"})})]}),m.jsx("div",{className:"mt-3 text-center",children:m.jsxs("button",{onClick:o,className:"text-[9px] font-bold text-primary hover:underline uppercase tracking-wide",children:["View all (",r.length,")"]})})]})]}),m.jsxs("section",{className:"space-y-4 shrink-0",children:[m.jsxs("div",{className:"flex justify-between items-center",children:[m.jsx("h4",{className:"text-[10px] font-black uppercase tracking-widest text-slate-500",children:l("linguistics.grammar")||"GRAMMAR"}),m.jsx("button",{onClick:s,className:"text-primary hover:text-white transition-colors",children:m.jsx("span",{className:"material-symbols-outlined text-lg",children:"add_circle"})})]}),m.jsx("div",{className:"space-y-2",children:n.length>0?n.map(u=>m.jsxs("div",{className:"p-3 bg-[#1a1a20] border border-white/5 rounded-xl hover:border-primary/30 transition-all cursor-pointer group",children:[m.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[m.jsx("div",{className:`size-1.5 rounded-full ${u.status==="complete"?"bg-emerald-500":"bg-amber-500"}`}),m.jsx("span",{className:"text-[10px] font-bold text-white group-hover:text-primary transition-colors",children:u.titulo})]}),m.jsx("p",{className:"text-[9px] text-slate-500 leading-tight line-clamp-2",children:u.descripcion})]},u.id)):m.jsx("div",{className:"p-4 text-center border border-dashed border-white/10 rounded-xl",children:m.jsx("p",{className:"text-[9px] text-slate-600 italic",children:"No rules defined."})})})]})]})},BK=({onOpenEditor:t})=>{const{t:e}=Ps(),{projectName:r}=qi(),{setRightPanelTab:n,setRightOpen:i}=nl(),[a,s]=ae.useState("..."),[o,l]=ae.useState({words:0,rules:0,glyphs:0}),[u,c]=ae.useState("..."),[f,p]=ae.useState([]),[v,y]=ae.useState([]),[S,w]=ae.useState(null),[E,_]=ae.useState(""),[T,N]=ae.useState(""),[R,I]=ae.useState(!1),[F,D]=ae.useState("lexicon"),[j,B]=ae.useState(""),[G,K]=ae.useState("MANAGEMENT"),[O,W]=ae.useState(!1),[U,q]=ae.useState(null),[Z,Q]=ae.useState(!1),[ne,re]=ae.useState(null),[Y,J]=ae.useState(null),[ie,de]=ae.useState("CHRONOS_ATLAS_V1"),[he,xe]=ae.useState("ARCHITECT_ID"),[le,fe]=ae.useState("TTF"),[ve,ge]=ae.useState(!0),[se,ye]=ae.useState(!0),[Se,Ue]=ae.useState([{msg:"Inicializando Bfer de Glifos...",type:"info"},{msg:"Sincronizacin de Biblia Activa",type:"success"}]),Oe={ALPHABET:{id:"ALPHABET"}},[mt,lt]=ae.useState(Oe.ALPHABET.id),[at,wt]=ae.useState(""),[$e,Ce]=ae.useState([]),[Ie,Je]=ae.useState([]),Qe=(ze,Ke="info")=>{Ue(tt=>[...tt.slice(-4),{msg:ze,type:Ke}])},[gt,At]=ae.useState(!1),[Rt,Ut]=ae.useState(null),[Vt,pt]=ae.useState([{id:"layer1",name:"Trazo Principal",visible:!0,locked:!1,shapes:[]},{id:"layer2",name:"Guas",visible:!0,locked:!1,shapes:[]}]),[dt,Ge]=ae.useState("layer1"),[ce,me]=ae.useState(null),[ke,Te]=ae.useState([]),[Ae,Xe]=ae.useState([]),Ve=ze=>{const Ke=JSON.parse(JSON.stringify(ze));Te(tt=>[...tt.slice(-19),Ke]),Xe([])},yt=()=>{if(ke.length===0)return;const ze=ke[ke.length-1];Te(Ke=>Ke.slice(0,-1)),Xe(Ke=>[Vt,...Ke]),pt(ze)},vt=()=>{if(Ae.length===0)return;const ze=Ae[0];Xe(Ke=>Ke.slice(1)),Te(Ke=>[...Ke,Vt]),pt(ze)},[ft,Zt]=ae.useState("brush"),[Ht,Et]=ae.useState(4),[Wt,ar]=ae.useState("#00E5FF"),[Rr,kr]=ae.useState(1),[Qr,Jr]=ae.useState("round"),[_r,fn]=ae.useState("linear"),vr=nr.useRef(null);ae.useEffect(()=>{gi(),i(!0),n&&n("CONTEXT"),I(!0);const ze=setInterval(()=>{const Ke=document.getElementById("global-right-panel-portal");Ke&&(J(Ke),clearInterval(ze))},100);return()=>{clearInterval(ze),n&&n("NOTEBOOKS")}},[]),ae.useEffect(()=>{!ce||Array.isArray(ce)||pt(ze=>{const Ke=ze.map(tt=>({...tt,shapes:tt.shapes.map(ot=>{if(ot.id===ce&&(ot.type==="line"||ot.type==="brush")){const qe={...ot};return _r==="points"?(qe.dash=[2,10],delete qe.tension):_r==="quadratic"?(qe.tension=.8,delete qe.dash):(delete qe.dash,delete qe.tension),qe}return ot})}));return Ve(Ke),Ke})},[_r]),ae.useEffect(()=>{!ce||Array.isArray(ce)&&ce.length===0||pt(ze=>ze.map(tt=>({...tt,shapes:tt.shapes.map(ot=>(Array.isArray(ce)?ce.includes(ot.id):ot.id===ce)?{...ot,stroke:Wt,strokeWidth:Ht,opacity:Rr,lineCap:Qr}:ot)})))},[Wt,Ht,Rr,Qr]);const St=ze=>{if(Ut(ze.id),At(!0),setRightPanelMode("LINGUISTICS"),ze.rawEditorData)try{const tt=JSON.parse(ze.rawEditorData);if(Array.isArray(tt)&&tt.length>0){pt(tt),Ge(tt[0].id);return}}catch(tt){console.error("Error parsing rawEditorData:",tt)}const Ke=[];ze.svgPathData&&Ke.push({id:crypto.randomUUID(),type:"path",data:ze.svgPathData,x:0,y:0,stroke:"#00E5FF",strokeWidth:2,fill:null,scaleX:1,scaleY:1}),pt([{id:"layer1",name:"Trazo Principal",visible:!0,locked:!1,shapes:Ke},{id:"layer2",name:"Guas",visible:!0,locked:!1,shapes:[]}]),Ge("layer1")},Br=()=>{At(!1),Ut(null),me(null)},Xn=async()=>{if(!Rt||!S)return;const ze=Vt.filter(Qt=>Qt.visible&&!Qt.name.toLowerCase().includes("gua")).flatMap(Qt=>Qt.shapes);if(ze.length===0){Qe("No hay trazos para guardar","warning");return}let Ke="",tt=1/0,ot=1/0,qe=-1/0,Mt=-1/0;const Nr=Qt=>{const er=Qt.x||0,Lr=Qt.y||0;if(Qt.type==="line"&&Qt.points)for(let Jt=0;Jt<Qt.points.length;Jt+=2){const en=Qt.points[Jt]+er,yn=Qt.points[Jt+1]+Lr;tt=Math.min(tt,en),ot=Math.min(ot,yn),Mt=Math.max(Mt,en),qe=Math.max(qe,yn)}else if(Qt.type==="rect")tt=Math.min(tt,er),ot=Math.min(ot,Lr),Mt=Math.max(Mt,er+(Qt.width||0)),qe=Math.max(qe,Lr+(Qt.height||0));else if(Qt.type==="circle"){const Jt=Qt.radius||0;tt=Math.min(tt,er-Jt),ot=Math.min(ot,Lr-Jt),Mt=Math.max(Mt,er+Jt),qe=Math.max(qe,Lr+Jt)}};if(ze.forEach(Nr),tt===1/0)return;const Pr=(tt+Mt)/2,Fr=(ot+qe)/2,vi=vr.current,It=vi.width()/2-Pr,Ir=vi.height()/2-Fr,al=Vt.map(Qt=>({...Qt,shapes:Qt.shapes.map(er=>({...er,x:(er.x||0)+It,y:(er.y||0)+Ir}))}));ze.forEach(Qt=>{const er=(Qt.x||0)+It,Lr=(Qt.y||0)+Ir;if(Qt.type==="line"&&Qt.points&&Qt.points.length>=4){if(Qt.globalCompositeOperation==="destination-out")return;Ke+=`M ${Qt.points[0]+er} ${Qt.points[1]+Lr} `;for(let Jt=2;Jt<Qt.points.length;Jt+=2)Ke+=`L ${Qt.points[Jt]+er} ${Qt.points[Jt+1]+Lr} `}else if(Qt.type==="rect"){const Jt=Qt.width||0,en=Qt.height||0;Ke+=`M ${er} ${Lr} L ${er+Jt} ${Lr} L ${er+Jt} ${Lr+en} L ${er} ${Lr+en} Z `}else if(Qt.type==="circle"){const Jt=Qt.radius||0,en=.5522847498*Jt;Ke+=`M ${er} ${Lr-Jt} 
                             C ${er+en} ${Lr-Jt} ${er+Jt} ${Lr-en} ${er+Jt} ${Lr} 
                             C ${er+Jt} ${Lr+en} ${er+en} ${Lr+Jt} ${er} ${Lr+Jt} 
                             C ${er-en} ${Lr+Jt} ${er-Jt} ${Lr+en} ${er-Jt} ${Lr} 
                             C ${er-Jt} ${Lr-en} ${er-en} ${Lr-Jt} ${er} ${Lr-Jt} Z `}});try{const Qt=f.find(Lr=>Lr.id===Rt)||{lema:"Nuevo Glifo",categoriaGramatical:"GLYPH",definicion:"Glifo dibujado manualmente"};f.some(Lr=>Lr.id===Rt)?await et.put(`/conlang/${S}/palabra/${Rt}`,{...Qt,svgPathData:Ke,rawEditorData:JSON.stringify(al)}):await et.post(`/conlang/${S}/palabra`,{...Qt,id:Rt,svgPathData:Ke,rawEditorData:JSON.stringify(al)}),qa(S),Qe("Glifo guardado y centrado con xito","success")}catch(Qt){throw console.error("Error saving glyph:",Qt),Qe("Error al guardar glifo","error"),Qt}},Yi=ze=>{re(ze),Q(!0)},ds=async()=>{if(!(!ne||!S))try{await et.delete(`/conlang/${S}/palabra/${ne}`),qa(S),Qe("Palabra eliminada","success"),re(null),Q(!1)}catch(ze){console.error("Error deleting word:",ze),Qe("Error al eliminar palabra","error")}},As=ze=>{q(ze),W(!0)},ni=async ze=>{if(S)try{ze.isNew?await et.post(`/conlang/${S}/palabra`,ze):await et.put(`/conlang/${S}/palabra/${U.id}`,ze),qa(S),Qe("Cambios sincronizados","success"),W(!1),q(null)}catch(Ke){console.error("Error saving meaning:",Ke),Qe("Error al sincronizar cambios","error")}},sn=f.filter(ze=>{const Ke=j.toLowerCase(),tt=(ze.lema||"").toLowerCase(),ot=(ze.traduccionEspanol||ze.definicion||"").toLowerCase();return tt.includes(Ke)||ot.includes(Ke)}),kn=(ze,Ke)=>{if(ze==="START"){const tt=Vt.find(qe=>qe.id===dt);if(!tt||tt.locked||!tt.visible){Qe("Capa bloqueada u oculta","warning");return}const ot={id:crypto.randomUUID(),type:ft,stroke:Wt,strokeWidth:Ht,opacity:Rr,lineCap:Qr,lineJoin:"round",x:ft==="brush"||ft==="eraser"||ft==="line"?0:Ke.pos.x,y:ft==="brush"||ft==="eraser"||ft==="line"?0:Ke.pos.y};ft==="brush"||ft==="eraser"?(ot.type="line",ot.points=[Ke.pos.x,Ke.pos.y,Ke.pos.x,Ke.pos.y],ft==="eraser"&&(ot.globalCompositeOperation="destination-out",ot.strokeWidth=Ht*2),_r==="points"&&ft!=="eraser"&&(ot.dash=[2,10]),_r==="quadratic"&&ft!=="eraser"&&(ot.tension=.8)):ft==="line"?(ot.type="line",ot.points=[Ke.pos.x,Ke.pos.y,Ke.pos.x,Ke.pos.y],_r==="points"&&(ot.dash=[2,10]),_r==="quadratic"&&(ot.tension=.8)):ft==="rect"?(ot.width=0,ot.height=0,_r==="points"&&(ot.dash=[5,5])):ft==="circle"&&(ot.radius=0,_r==="points"&&(ot.dash=[5,5])),pt(qe=>{const Mt=qe.map(Nr=>Nr.id===dt?{...Nr,shapes:[...Nr.shapes,ot]}:Nr);return Ve(Mt),Mt}),me(ot.id)}else ze==="MOVE"?pt(tt=>tt.map(ot=>{if(ot.id===dt){const qe=[...ot.shapes],Mt={...qe[qe.length-1]};if(!Mt)return ot;if(ft==="brush"||ft==="eraser")Mt.points=[...Mt.points,Ke.pos.x,Ke.pos.y];else if(ft==="line")Mt.points=[Mt.points[0],Mt.points[1],Ke.pos.x,Ke.pos.y];else if(ft==="rect")Mt.width=Ke.pos.x-Mt.x,Mt.height=Ke.pos.y-Mt.y;else if(ft==="circle"){const Nr=Ke.pos.x-Mt.x,Pr=Ke.pos.y-Mt.y;Mt.radius=Math.sqrt(Nr*Nr+Pr*Pr)}return qe[qe.length-1]=Mt,{...ot,shapes:qe}}return ot})):ze==="END"&&Ve(Vt)},In=()=>{const ze={id:crypto.randomUUID()};Ut(ze.id);const Ke=crypto.randomUUID();pt([{id:Ke,name:"Capa 1",visible:!0,locked:!1,shapes:[]}]),Ge(Ke),At(!0),setRightPanelMode("LINGUISTICS")},Rs=(ze,Ke)=>{pt(tt=>tt.map(ot=>({...ot,shapes:ot.shapes.map(qe=>qe.id===ze?{...qe,...Ke}:qe)})))},gi=async()=>{try{const ze=await et.get("/bd/proyecto-activo");s(ze.nombreProyecto);const Ke=await et.get("/conlang/stats");l(Ke);const tt=await et.get("/conlang/lenguas");tt&&tt.length>0&&(c(tt[0].nombre),w(tt[0].id),So(tt[0].id),qa(tt[0].id))}catch(ze){console.error("Error loading conlang data:",ze),s("Default Project")}},So=async ze=>{try{const Ke=await et.get(`/conlang/${ze}/rules`);y(Ke)}catch(Ke){console.error("Error loading rules:",Ke)}},qa=async ze=>{try{const Ke=await et.get(`/conlang/${ze}/diccionario`);p(Ke),Je(Ke.filter(tt=>["GLYPH","GLYFO","GLIFO"].includes(tt.categoriaGramatical)||tt.svgPathData&&tt.lema.length===1))}catch(Ke){console.error("Error loading lexicon:",Ke)}},Lu=async()=>{if(!S)return;const ze=prompt("Enter rule title:");if(!ze)return;const Ke=prompt("Enter rule description:"),tt=prompt("Enter category (Grammar, Syntax, etc.):");try{await et.post(`/conlang/${S}/rules`,{titulo:ze,descripcion:Ke,categoria:tt,status:"IN_PROGRESS"}),So(S);const ot=await et.get("/conlang/stats");l(ot)}catch(ot){console.error("Error adding rule:",ot)}},ko=ze=>{_(ze);const Ke=ze.split("").map(tt=>{const ot=Ie.find(qe=>qe.lema.toLowerCase()===tt.toLowerCase());return ot?ot.lema:tt}).join(" ");N(Ke)},on=ze=>{wt(ze);const Ke=ze.split("").map(tt=>Ie.find(qe=>qe.lema.toLowerCase()===tt.toLowerCase())||{lema:tt,placeholder:!0});Ce(Ke)},_o=async()=>{if(!(!S||!at))try{await et.post(`/conlang/${S}/palabra`,{lema:at,definicion:`Entrada automtica (${new Date().toLocaleDateString()})`,categoriaGramatical:"COMPUESTA"}),qa(S),Qe(`Palabra "${at}" sincronizada automticamente`,"success")}catch(ze){console.error("Error al guardar automticamente:",ze)}},fs=()=>{const ze=Ie.map(tt=>tt.unicodeCode).filter(tt=>tt&&tt.startsWith("U+")).map(tt=>parseInt(tt.replace("U+",""),16));return`U+${(ze.length>0?Math.max(...ze)+1:57344).toString(16).toUpperCase()}`},to=ae.useRef(null),Xi=()=>{to.current.click()},ro=async ze=>{const Ke=ze.target.files[0];if(!Ke)return;const tt=new FileReader;tt.onload=async ot=>{const Mt=ot.target.result.match(/d="([^"]+)"/);if(Mt&&Mt[1]){const Nr=Mt[1],Pr=fs(),Fr=String.fromCharCode(parseInt(Pr.replace("U+",""),16));try{await et.post(`/conlang/${S}/palabra`,{lema:Fr,categoriaGramatical:"GLYFO",definicion:`Glifo importado (${Ke.name})`,svgPathData:Nr,unicodeCode:Pr}),qa(S),Qe(`Glifo ${Pr} importado con xito`,"success")}catch{Qe("Error al importar glifo","error")}}else alert("SVG invlido para renderizado de glifos.")},tt.readAsText(Ke),ze.target.value=null};return m.jsxs("div",{className:"flex-1 flex flex-col h-full bg-[#050508] text-slate-300 font-sans overflow-hidden",children:[m.jsx("input",{type:"file",ref:to,onChange:ro,accept:".svg",className:"hidden"}),m.jsxs("div",{className:"h-16 border-b border-white/5 flex items-center justify-between px-8 bg-black/40",children:[m.jsx("div",{className:"flex items-center gap-4"}),!gt&&m.jsx("div",{className:"flex bg-white/5 p-1 rounded-xl border border-white/5 backdrop-blur-md",children:[{id:"lexicon",label:e("linguistics.lexicon")},{id:"translator",label:e("linguistics.translator")},{id:"biblia",label:"BIBLIA"}].map(ze=>m.jsx("button",{onClick:()=>D(ze.id),className:`px-6 py-1.5 rounded-lg text-[10px] font-black uppercase tracking-widest transition-all ${F===ze.id?"bg-primary text-white shadow-lg":"text-slate-500 hover:text-slate-300"}`,children:ze.label},ze.id))}),gt&&m.jsxs("div",{className:"flex items-center gap-3 bg-white/5 p-1 rounded-xl border border-white/5",children:[m.jsxs("button",{onClick:Br,className:"flex items-center gap-2 px-4 py-1.5 rounded-lg text-[10px] font-black uppercase tracking-widest text-red-400 hover:bg-red-400/10 transition-all border border-transparent hover:border-red-400/20",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"close"}),"Descartar"]}),m.jsx("div",{className:"w-px h-4 bg-white/10 mx-1"}),m.jsxs("button",{onClick:async()=>{await Xn(),Br()},className:"flex items-center gap-2 px-4 py-1.5 rounded-lg text-[10px] font-black uppercase tracking-widest bg-primary text-white shadow-lg hover:shadow-primary/20 transition-all",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"check"}),"Aplicar y Guardar"]})]})]}),m.jsx("main",{className:"flex-1 overflow-y-auto no-scrollbar p-8 lg:p-12 relative flex flex-col",children:gt?m.jsx("div",{className:"flex-1 flex flex-col h-full relative",children:m.jsx(DK,{stageRef:vr,layers:Vt,selectedShapeId:ce,onSelectShape:me,onChangeShape:Rs,tool:ft,color:Wt,strokeWidth:Ht,onDrawEnd:kn})}):F==="lexicon"?m.jsx("div",{className:"max-w-6xl mx-auto w-full animate-in fade-in slide-in-from-bottom-4 duration-700",children:m.jsxs("section",{className:"space-y-8",children:[m.jsxs("div",{className:"flex justify-between items-center px-4",children:[m.jsxs("div",{className:"flex flex-col",children:[m.jsx("h3",{className:"text-3xl font-black text-white tracking-tight italic",children:e("linguistics.lexicon")}),m.jsxs("p",{className:"text-[10px] text-slate-500 font-bold uppercase tracking-widest",children:[o.words," Palabras Mapeadas"]})]}),m.jsx(Dn,{variant:"primary",size:"md",onClick:In,icon:"draw",children:"Nuevo Glifo"})]}),m.jsxs(ti,{className:"p-0 border-white/5 bg-surface-dark/40 overflow-hidden shadow-2xl rounded-[2.5rem]",children:[m.jsxs("div",{className:"p-6 border-b border-white/5 flex items-center gap-4 bg-black/20",children:[m.jsxs("div",{className:"flex-1 relative",children:[m.jsx("span",{className:"material-symbols-outlined absolute left-4 top-1/2 -translate-y-1/2 text-primary/60 text-lg",children:"search"}),m.jsx("input",{type:"text",placeholder:e("linguistics.search_lexicon"),value:j,onChange:ze=>B(ze.target.value),className:"w-full bg-white/5 border border-white/10 rounded-2xl py-4 pl-12 pr-4 text-xs font-bold text-white focus:ring-1 focus:ring-primary/30 outline-none transition-all placeholder-slate-600"})]}),m.jsx("button",{className:"size-12 rounded-2xl bg-white/5 border border-white/10 flex items-center justify-center text-slate-500 hover:text-white transition-all hover:bg-white/10",children:m.jsx("span",{className:"material-symbols-outlined text-xl",children:"tune"})})]}),m.jsxs("div",{className:"p-8 space-y-2 max-h-[70vh] overflow-y-auto no-scrollbar custom-scrollbar",children:[sn.map(ze=>m.jsx(zK,{word:ze.lema||ze.palabraOriginal,type:ze.categoriaGramatical,gender:ze.genero,def:ze.definicion||ze.traduccionEspanol,onEdit:()=>As(ze),onDelete:()=>Yi(ze.id)},ze.id)),sn.length===0&&m.jsxs("div",{className:"py-20 flex flex-col items-center justify-center text-slate-600 opacity-20",children:[m.jsx("span",{className:"material-symbols-outlined text-8xl mb-4",children:"menu_book"}),m.jsx("p",{className:"text-[10px] uppercase tracking-[0.5em] font-black",children:j?"No se encontraron resultados":"Flujo de Datos Vaco"})]})]})]})]})}):F==="translator"?m.jsx("div",{className:"max-w-6xl mx-auto w-full animate-in fade-in slide-in-from-bottom-4 duration-700",children:m.jsxs("section",{className:"space-y-8",children:[m.jsxs("div",{className:"flex items-center gap-4 px-4",children:[m.jsx("span",{className:"material-symbols-outlined text-primary text-4xl",children:"sync_alt"}),m.jsx("h3",{className:"text-3xl font-black text-white tracking-tight italic",children:e("linguistics.translator")})]}),m.jsx(ti,{className:"p-12 border-primary/20 bg-primary/5 rounded-[3rem] shadow-2xl shadow-primary/5",children:m.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-12 items-center",children:[m.jsxs("div",{className:"space-y-6",children:[m.jsx("label",{className:"text-[10px] font-black uppercase tracking-[0.4em] text-primary opacity-60",children:"Entrada de Origen"}),m.jsx("textarea",{value:E,onChange:ze=>ko(ze.target.value),placeholder:e("linguistics.source_text"),className:"w-full h-48 bg-black/40 border border-white/10 rounded-[2.5rem] p-8 text-lg font-bold text-white focus:border-primary/50 outline-none transition-all placeholder-slate-800 resize-none"})]}),m.jsxs("div",{className:"space-y-6",children:[m.jsx("label",{className:"text-[10px] font-black uppercase tracking-[0.4em] text-primary opacity-60",children:"Salida Visual"}),m.jsx("div",{className:"h-48 rounded-[2.5rem] bg-black/60 border border-white/5 flex items-center justify-center relative overflow-hidden group shadow-inner",children:m.jsx("span",{className:"text-7xl font-serif text-white opacity-40 group-hover:opacity-100 transition-all duration-1000 whitespace-pre drop-shadow-[0_0_20px_rgba(255,255,255,0.4)]",children:T||"   "})})]})]})})]})}):m.jsxs("section",{className:"max-w-7xl mx-auto w-full animate-in fade-in slide-in-from-bottom-8 duration-1000 flex flex-col gap-12",children:[m.jsxs("div",{className:"flex justify-between items-center px-4",children:[m.jsx("div",{className:"flex flex-col"}),m.jsx("div",{className:"px-6 py-2 rounded bg-[#00E5FF]/10 border border-[#00E5FF]/20 text-[10px] font-black text-[#00E5FF] uppercase tracking-[0.3em] animate-pulse",children:"Bfer de Sincronizacin Listo"})]}),m.jsxs("div",{className:"space-y-12",children:[m.jsxs("section",{className:"space-y-6",children:[m.jsxs("div",{className:"flex items-center justify-between px-2",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("div",{className:"size-2 bg-[#00E5FF] rounded-full shadow-[0_0_10px_#00E5FF]"}),m.jsx("h3",{className:"text-xs font-black uppercase tracking-[0.5em] text-[#00E5FF]/60",children:"Glifos Mapeados"})]}),m.jsxs("div",{className:"flex flex-col gap-3 items-end",children:[m.jsxs("span",{className:"text-[10px] font-bold text-[#00E5FF]/40",children:[Ie.length," Smbolos Indexados"]}),m.jsxs("div",{className:"flex items-center gap-4 px-6 py-2.5 rounded-2xl bg-black/40 border border-[#00E5FF]/10 backdrop-blur-md",children:[m.jsx("span",{className:"text-[9px] font-black uppercase tracking-[0.2em] text-[#00E5FF]/60 font-mono",children:"Estado del Bfer"}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("span",{className:"text-[10px] font-bold text-white tracking-widest",children:"SINCRONIZADO"}),m.jsx("div",{className:"size-1.5 bg-[#00E5FF] rounded-full shadow-[0_0_10px_#00E5FF] animate-pulse"})]})]})]})]}),m.jsxs("div",{className:"p-10 rounded-[2.5rem] border border-[#00E5FF]/10 bg-[#00E5FF]/[0.02] grid grid-cols-4 md:grid-cols-6 lg:grid-cols-8 gap-6",children:[Ie.map((ze,Ke)=>m.jsx(UK,{symbol:ze.lema,svgPath:ze.svgPathData,keyLabel:ze.lema.length===1&&ze.lema.match(/[a-z]/i)?ze.lema.toUpperCase():"",active:!1,onClick:()=>St(ze)},ze.id||Ke)),m.jsxs("button",{onClick:In,className:"aspect-square rounded-2xl border-2 border-dashed border-[#00E5FF]/10 flex flex-col items-center justify-center text-[#00E5FF]/20 hover:text-[#00E5FF] hover:border-[#00E5FF]/40 transition-all cursor-pointer group gap-2",title:"Dibujar Nuevo Glifo",children:[m.jsx("span",{className:"material-symbols-outlined text-3xl group-hover:scale-110 transition-transform",children:"draw"}),m.jsx("span",{className:"text-[8px] font-black uppercase tracking-widest opacity-0 group-hover:opacity-100 transition-opacity",children:"Dibujar"})]}),m.jsxs("button",{onClick:Xi,className:"aspect-square rounded-2xl border-2 border-dashed border-[#00E5FF]/10 flex flex-col items-center justify-center text-[#00E5FF]/20 hover:text-[#00E5FF] hover:border-[#00E5FF]/40 transition-all cursor-pointer group gap-2",title:"Importar desde SVG",children:[m.jsx("span",{className:"material-symbols-outlined text-3xl group-hover:scale-110 transition-transform",children:"upload_file"}),m.jsx("span",{className:"text-[8px] font-black uppercase tracking-widest opacity-0 group-hover:opacity-100 transition-opacity",children:"Importar"})]})]})]}),m.jsx("div",{className:"px-10",children:m.jsx("div",{className:"w-full h-[2px] bg-white/5 overflow-hidden rounded-full",children:m.jsx("div",{className:"h-full bg-[#00E5FF] shadow-[0_0_10px_#00E5FF] transition-all duration-1000",style:{width:`${Math.min(100,Ie.length/26*100)}%`}})})}),m.jsxs("section",{className:"space-y-6",children:[m.jsxs("div",{className:"flex items-center gap-4 px-2",children:[m.jsx("div",{className:"size-2 bg-primary rounded-full shadow-[0_0_10px_#7c3aed] opacity-60"}),m.jsx("h3",{className:"text-xs font-black uppercase tracking-[0.5em] text-primary/60",children:"Compositor de Palabras"})]}),m.jsxs(ti,{className:"p-10 border-white/5 bg-black/40 rounded-[2.5rem] space-y-8",children:[m.jsxs("div",{className:"flex gap-8 items-start",children:[m.jsxs("div",{className:"flex-1 space-y-4",children:[m.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-slate-500",children:"Escritura Fontica"}),m.jsx("input",{type:"text",value:at,onChange:ze=>on(ze.target.value),onBlur:()=>{at&&_o()},onKeyDown:ze=>{ze.key==="Enter"&&_o()},placeholder:"Escribe para componer...",className:"w-full bg-white/5 border border-white/10 rounded-2xl py-6 px-8 text-2xl font-bold text-white outline-none focus:border-primary/40 transition-all placeholder:text-slate-800"})]}),m.jsxs("div",{className:"mt-10 px-6 py-4 rounded-xl bg-white/5 border border-white/10 flex items-center gap-3",children:[m.jsx("div",{className:"size-2 bg-emerald-500 rounded-full animate-pulse shadow-[0_0_10px_#10b981]"}),m.jsx("span",{className:"text-[9px] font-black uppercase tracking-widest text-slate-400",children:"Auto-Sincronizacin"})]})]}),m.jsxs("div",{className:"space-y-4",children:[m.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-slate-500",children:"Flujo de Renderizado Visual"}),m.jsx("div",{className:"min-h-32 p-8 rounded-2xl bg-black/60 border border-white/5 flex flex-wrap gap-4 items-center justify-center relative group",children:$e.length>0?$e.map((ze,Ke)=>m.jsxs("div",{className:"flex flex-col items-center gap-1",children:[m.jsx("span",{className:`text-5xl font-serif ${ze.placeholder?"text-slate-800 animate-pulse":"text-[#00E5FF] drop-shadow-[0_0_10px_rgba(0,229,255,0.4)]"}`,children:ze.lema}),m.jsx("span",{className:"text-[8px] font-black text-slate-600 uppercase tracking-widest",children:ze.lema})]},Ke)):m.jsx("span",{className:"text-slate-800 font-black uppercase tracking-[0.5em] text-[10px]",children:"Sin glifos detectados"})})]})]})]}),m.jsxs("section",{className:"space-y-6",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("div",{className:"size-2 bg-[#00E5FF] rounded-full shadow-[0_0_10px_#00E5FF] opacity-40"}),m.jsx("h3",{className:"text-xs font-black uppercase tracking-[0.5em] text-[#00E5FF]/60",children:"Previsualizacin de Transmisin"})]}),m.jsxs("div",{className:"h-64 rounded-[2.5rem] border border-[#00E5FF]/10 bg-black/40 flex flex-col p-12 items-center justify-center relative group shadow-inner",children:[m.jsx("div",{className:"absolute top-6 left-8 text-[8px] opacity-20 uppercase tracking-[0.3em] font-black",children:"Estado del Bfer: Activo"}),m.jsx("textarea",{className:"w-full bg-transparent border-none outline-none text-center text-7xl font-bold tracking-widest text-[#00E5FF]/10 group-hover:text-[#00E5FF]/40 transition-all placeholder:text-[#00E5FF]/5 resize-none italic font-serif",placeholder:"..."}),m.jsxs("div",{className:"absolute bottom-6 right-8 flex gap-6 text-[8px] font-black uppercase tracking-widest text-[#00E5FF]/20",children:[m.jsx("span",{children:"Motor_V4"}),m.jsx("span",{children:"ASCII/UTF-8"})]})]})]})]})]})}),Y&&xo.createPortal(m.jsx("div",{className:"h-full flex flex-col bg-background relative overflow-hidden",children:gt?m.jsx(jK,{tool:ft,setTool:Zt,strokeWidth:Ht,setStrokeWidth:Et,color:Wt,setColor:ar,opacity:Rr,setOpacity:kr,lineCap:Qr,setLineCap:Jr,strokeStyle:_r,setStrokeStyle:fn,layers:Vt,activeLayerId:dt,setActiveLayerId:Ge,onToggleLayerVisibility:ze=>pt(Ke=>Ke.map(tt=>tt.id===ze?{...tt,visible:!tt.visible}:tt)),onToggleLayerLock:ze=>pt(Ke=>Ke.map(tt=>tt.id===ze?{...tt,locked:!tt.locked}:tt)),onAddLayer:()=>{const ze=crypto.randomUUID();pt(Ke=>[{id:ze,name:`Capa ${Ke.length+1}`,visible:!0,locked:!1,shapes:[]},...Ke]),Ge(ze)},onDeleteLayer:ze=>{Vt.length!==1&&pt(Ke=>{const tt=Ke.filter(ot=>ot.id!==ze);return dt===ze&&Ge(tt[0].id),tt})},activeShape:ce&&!Array.isArray(ce)?Vt.flatMap(ze=>ze.shapes).find(ze=>ze.id===ce):null,onUndo:yt,onRedo:vt,onClear:()=>{pt(ze=>ze.map(Ke=>Ke.id===dt?{...Ke,shapes:[]}:Ke)),Qe("Capa limpiada","info")}}):m.jsx(FK,{stats:o,langName:u,glyphs:Ie,rules:v,onEditGlyph:St,onCreateGlyph:In,onCreateRule:Lu,onViewAllGlyphs:()=>D("lexicon")})}),Y),m.jsx(_M,{isOpen:Z,onClose:()=>Q(!1),onConfirm:ds,title:"Eliminar Palabra",message:"Ests seguro de que quieres eliminar esta palabra? Esta accin no se puede deshacer.",confirmText:"Eliminar",cancelText:"Cancelar"}),O&&m.jsx(GK,{word:U,onClose:()=>W(!1),onSave:ni,onEditSymbol:ze=>{W(!1),St(ze)}})]})},zK=({word:t,type:e,gender:r,def:n,onEdit:i,onDelete:a})=>m.jsxs("div",{className:"p-4 rounded-2xl border border-transparent hover:bg-white/5 hover:border-white/5 transition-all group cursor-pointer relative",children:[m.jsxs("div",{className:"flex items-center gap-3 mb-1",children:[m.jsx("h4",{className:"text-xl font-manrope font-black text-white group-hover:text-primary transition-colors",children:t}),m.jsxs("div",{className:"flex gap-2",children:[m.jsx("span",{className:"text-[9px] font-bold text-slate-600 italic",children:e}),r&&m.jsxs("span",{className:"text-[9px] font-bold text-slate-700 uppercase",children:["(",r,")"]})]})]}),m.jsx("p",{className:"text-sm text-slate-400 leading-relaxed font-manrope line-clamp-2 pr-16",children:n}),m.jsxs("div",{className:"absolute right-4 top-1/2 -translate-y-1/2 flex gap-1",children:[m.jsx("button",{onClick:s=>{s.stopPropagation(),i?.()},className:"opacity-0 group-hover:opacity-100 transition-opacity p-2 bg-white/5 hover:bg-white/10 rounded-xl text-primary hover:text-white",title:"Editar Significado",children:m.jsx("span",{className:"material-symbols-outlined text-lg",children:"edit"})}),m.jsx("button",{onClick:s=>{s.stopPropagation(),a?.()},className:"opacity-0 group-hover:opacity-100 transition-opacity p-2 bg-white/5 hover:bg-red-400/20 rounded-xl text-slate-600 hover:text-red-400",title:"Eliminar Palabra",children:m.jsx("span",{className:"material-symbols-outlined text-lg",children:"delete"})})]})]}),UK=({symbol:t,svgPath:e,keyLabel:r,active:n,onClick:i})=>m.jsxs("div",{onClick:i,className:`aspect-square rounded-2xl border transition-all cursor-pointer flex items-center justify-center relative group overflow-hidden ${n?"bg-[#00E5FF]/20 border-[#00E5FF] shadow-[0_0_20px_rgba(0,229,255,0.3)]":"bg-black/40 border-[#00E5FF]/10 hover:border-[#00E5FF]/40"}`,children:[e?m.jsx("svg",{viewBox:"0 0 1200 800",className:"w-[80%] h-[80%] opacity-80 group-hover:opacity-100 transition-opacity",children:m.jsx("path",{d:e,fill:"none",stroke:n?"#00E5FF":"white",strokeWidth:"15",strokeLinecap:"round",strokeLinejoin:"round",className:"group-hover:stroke-[#00E5FF] transition-colors"})}):m.jsx("span",{className:`text-4xl font-serif ${n||t?"text-[#00E5FF]":"opacity-20 group-hover:opacity-60 text-white"}`,children:t||"?"}),r&&m.jsx("span",{className:`absolute top-2 right-3 text-[8px] font-black uppercase ${n?"text-[#00E5FF]/80":"opacity-20"}`,children:r})]}),GK=({word:t,onClose:e,onSave:r,onEditSymbol:n})=>{const[i,a]=ae.useState({lema:t?.lema||"",definicion:t?.definicion||t?.traduccionEspanol||"",categoriaGramatical:t?.categoriaGramatical||"Noun",notas:t?.notas||"",isNew:t?.isNew});return m.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-6 bg-black/60 backdrop-blur-sm animate-in fade-in duration-300",children:m.jsxs("div",{className:"w-full max-w-lg bg-[#0A0A0F] border border-white/10 rounded-[2.5rem] overflow-hidden shadow-2xl animate-in zoom-in-95 duration-500",children:[m.jsxs("div",{className:"p-8 border-b border-white/5 bg-white/[0.02] flex justify-between items-center",children:[m.jsxs("div",{className:"flex flex-col",children:[m.jsx("h2",{className:"text-xl font-black text-white italic tracking-tight",children:"Editar Significado"}),m.jsx("p",{className:"text-[10px] text-slate-500 font-bold uppercase tracking-widest",children:"Atributos del Lema"})]}),m.jsx("button",{onClick:e,className:"size-10 rounded-xl bg-white/5 flex items-center justify-center text-slate-500 hover:text-white transition-all",children:m.jsx("span",{className:"material-symbols-outlined",children:"close"})})]}),m.jsxs("div",{className:"p-8 space-y-6",children:[m.jsxs("div",{className:"space-y-2",children:[m.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-slate-600 ml-4",children:"Palabra / Lema"}),m.jsx("input",{type:"text",value:i.lema,onChange:s=>a(o=>({...o,lema:s.target.value})),className:"w-full bg-white/5 border border-white/10 rounded-2xl py-4 px-6 text-white text-sm font-bold focus:border-primary/40 outline-none transition-all"})]}),m.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[m.jsxs("div",{className:"space-y-2",children:[m.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-slate-600 ml-4",children:"Categora"}),m.jsxs("select",{value:i.categoriaGramatical,onChange:s=>a(o=>({...o,categoriaGramatical:s.target.value})),className:"w-full bg-[#1a1a20] border border-white/10 rounded-2xl py-4 px-6 text-white text-xs font-bold focus:border-primary/40 outline-none transition-all appearance-none",children:[m.jsx("option",{value:"Noun",className:"bg-[#1a1a20] text-white",children:"Sustantivo"}),m.jsx("option",{value:"Verb",className:"bg-[#1a1a20] text-white",children:"Verbo"}),m.jsx("option",{value:"Adj",className:"bg-[#1a1a20] text-white",children:"Adjetivo"}),m.jsx("option",{value:"Adv",className:"bg-[#1a1a20] text-white",children:"Adverbio"}),m.jsx("option",{value:"Conj",className:"bg-[#1a1a20] text-white",children:"Conjuncin"}),m.jsx("option",{value:"GLYPH",className:"bg-[#1a1a20] text-white",children:"Glifo / Smbolo"}),m.jsx("option",{value:"GLYFO",className:"bg-[#1a1a20] text-white",children:"Glifo / Smbolo (Alt)"}),m.jsx("option",{value:"GLIFO",className:"bg-[#1a1a20] text-white",children:"Glifo / Smbolo (ES)"})]})]}),m.jsx("div",{className:"flex items-end pb-1",children:m.jsxs("button",{onClick:()=>n(t),className:"w-full h-[52px] rounded-2xl border border-primary/20 bg-primary/5 hover:bg-primary/20 text-primary text-[10px] font-black uppercase tracking-widest transition-all flex items-center justify-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"draw"}),"Editar Smbolo"]})})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-slate-600 ml-4",children:"Definicin / Significado"}),m.jsx("textarea",{value:i.definicion,onChange:s=>a(o=>({...o,definicion:s.target.value})),className:"w-full bg-white/5 border border-white/10 rounded-2xl py-4 px-6 text-white text-sm font-bold focus:border-primary/40 outline-none transition-all h-24 resize-none"})]})]}),m.jsxs("div",{className:"p-8 bg-white/[0.02] border-t border-white/5 flex gap-4",children:[m.jsx("button",{onClick:e,className:"flex-1 py-4 rounded-2xl text-[10px] font-black uppercase tracking-widest text-slate-500 hover:text-white transition-all",children:"Cancelar"}),m.jsx("button",{onClick:()=>r(i),className:"flex-1 py-4 rounded-2xl bg-primary text-white text-[10px] font-black uppercase tracking-widest shadow-lg shadow-primary/20 transition-all hover:scale-105",children:"Guardar Cambios"})]})]})})},VK=()=>{const[t,e]=ae.useState("hub"),[r,n]=ae.useState(null),i=a=>{n(a),console.log("Opening editor for",a)};return m.jsx("div",{className:"flex-1 flex flex-col h-full bg-[#050508] overflow-hidden",children:t==="hub"&&m.jsx(BK,{onOpenEditor:i})})};var $2={exports:{}},K2={};var a3;function HK(){if(a3)return K2;a3=1;var t=sm();function e(f,p){return f===p&&(f!==0||1/f===1/p)||f!==f&&p!==p}var r=typeof Object.is=="function"?Object.is:e,n=t.useState,i=t.useEffect,a=t.useLayoutEffect,s=t.useDebugValue;function o(f,p){var v=p(),y=n({inst:{value:v,getSnapshot:p}}),S=y[0].inst,w=y[1];return a(function(){S.value=v,S.getSnapshot=p,l(S)&&w({inst:S})},[f,v,p]),i(function(){return l(S)&&w({inst:S}),f(function(){l(S)&&w({inst:S})})},[f]),s(v),v}function l(f){var p=f.getSnapshot;f=f.value;try{var v=p();return!r(f,v)}catch{return!0}}function u(f,p){return p()}var c=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?u:o;return K2.useSyncExternalStore=t.useSyncExternalStore!==void 0?t.useSyncExternalStore:c,K2}var s3;function vL(){return s3||(s3=1,$2.exports=HK()),$2.exports}var yL=vL();function ja(t){this.content=t}ja.prototype={constructor:ja,find:function(t){for(var e=0;e<this.content.length;e+=2)if(this.content[e]===t)return e;return-1},get:function(t){var e=this.find(t);return e==-1?void 0:this.content[e+1]},update:function(t,e,r){var n=r&&r!=t?this.remove(r):this,i=n.find(t),a=n.content.slice();return i==-1?a.push(r||t,e):(a[i+1]=e,r&&(a[i]=r)),new ja(a)},remove:function(t){var e=this.find(t);if(e==-1)return this;var r=this.content.slice();return r.splice(e,2),new ja(r)},addToStart:function(t,e){return new ja([t,e].concat(this.remove(t).content))},addToEnd:function(t,e){var r=this.remove(t).content.slice();return r.push(t,e),new ja(r)},addBefore:function(t,e,r){var n=this.remove(e),i=n.content.slice(),a=n.find(t);return i.splice(a==-1?i.length:a,0,e,r),new ja(i)},forEach:function(t){for(var e=0;e<this.content.length;e+=2)t(this.content[e],this.content[e+1])},prepend:function(t){return t=ja.from(t),t.size?new ja(t.content.concat(this.subtract(t).content)):this},append:function(t){return t=ja.from(t),t.size?new ja(this.subtract(t).content.concat(t.content)):this},subtract:function(t){var e=this;t=ja.from(t);for(var r=0;r<t.content.length;r+=2)e=e.remove(t.content[r]);return e},toObject:function(){var t={};return this.forEach(function(e,r){t[e]=r}),t},get size(){return this.content.length>>1}};ja.from=function(t){if(t instanceof ja)return t;var e=[];if(t)for(var r in t)e.push(r,t[r]);return new ja(e)};function xL(t,e,r){for(let n=0;;n++){if(n==t.childCount||n==e.childCount)return t.childCount==e.childCount?null:r;let i=t.child(n),a=e.child(n);if(i==a){r+=i.nodeSize;continue}if(!i.sameMarkup(a))return r;if(i.isText&&i.text!=a.text){for(let s=0;i.text[s]==a.text[s];s++)r++;return r}if(i.content.size||a.content.size){let s=xL(i.content,a.content,r+1);if(s!=null)return s}r+=i.nodeSize}}function bL(t,e,r,n){for(let i=t.childCount,a=e.childCount;;){if(i==0||a==0)return i==a?null:{a:r,b:n};let s=t.child(--i),o=e.child(--a),l=s.nodeSize;if(s==o){r-=l,n-=l;continue}if(!s.sameMarkup(o))return{a:r,b:n};if(s.isText&&s.text!=o.text){let u=0,c=Math.min(s.text.length,o.text.length);for(;u<c&&s.text[s.text.length-u-1]==o.text[o.text.length-u-1];)u++,r--,n--;return{a:r,b:n}}if(s.content.size||o.content.size){let u=bL(s.content,o.content,r-1,n-1);if(u)return u}r-=l,n-=l}}class it{constructor(e,r){if(this.content=e,this.size=r||0,r==null)for(let n=0;n<e.length;n++)this.size+=e[n].nodeSize}nodesBetween(e,r,n,i=0,a){for(let s=0,o=0;o<r;s++){let l=this.content[s],u=o+l.nodeSize;if(u>e&&n(l,i+o,a||null,s)!==!1&&l.content.size){let c=o+1;l.nodesBetween(Math.max(0,e-c),Math.min(l.content.size,r-c),n,i+c)}o=u}}descendants(e){this.nodesBetween(0,this.size,e)}textBetween(e,r,n,i){let a="",s=!0;return this.nodesBetween(e,r,(o,l)=>{let u=o.isText?o.text.slice(Math.max(e,l)-l,r-l):o.isLeaf?i?typeof i=="function"?i(o):i:o.type.spec.leafText?o.type.spec.leafText(o):"":"";o.isBlock&&(o.isLeaf&&u||o.isTextblock)&&n&&(s?s=!1:a+=n),a+=u},0),a}append(e){if(!e.size)return this;if(!this.size)return e;let r=this.lastChild,n=e.firstChild,i=this.content.slice(),a=0;for(r.isText&&r.sameMarkup(n)&&(i[i.length-1]=r.withText(r.text+n.text),a=1);a<e.content.length;a++)i.push(e.content[a]);return new it(i,this.size+e.size)}cut(e,r=this.size){if(e==0&&r==this.size)return this;let n=[],i=0;if(r>e)for(let a=0,s=0;s<r;a++){let o=this.content[a],l=s+o.nodeSize;l>e&&((s<e||l>r)&&(o.isText?o=o.cut(Math.max(0,e-s),Math.min(o.text.length,r-s)):o=o.cut(Math.max(0,e-s-1),Math.min(o.content.size,r-s-1))),n.push(o),i+=o.nodeSize),s=l}return new it(n,i)}cutByIndex(e,r){return e==r?it.empty:e==0&&r==this.content.length?this:new it(this.content.slice(e,r))}replaceChild(e,r){let n=this.content[e];if(n==r)return this;let i=this.content.slice(),a=this.size+r.nodeSize-n.nodeSize;return i[e]=r,new it(i,a)}addToStart(e){return new it([e].concat(this.content),this.size+e.nodeSize)}addToEnd(e){return new it(this.content.concat(e),this.size+e.nodeSize)}eq(e){if(this.content.length!=e.content.length)return!1;for(let r=0;r<this.content.length;r++)if(!this.content[r].eq(e.content[r]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(e){let r=this.content[e];if(!r)throw new RangeError("Index "+e+" out of range for "+this);return r}maybeChild(e){return this.content[e]||null}forEach(e){for(let r=0,n=0;r<this.content.length;r++){let i=this.content[r];e(i,n,r),n+=i.nodeSize}}findDiffStart(e,r=0){return xL(this,e,r)}findDiffEnd(e,r=this.size,n=e.size){return bL(this,e,r,n)}findIndex(e){if(e==0)return xy(0,e);if(e==this.size)return xy(this.content.length,e);if(e>this.size||e<0)throw new RangeError(`Position ${e} outside of fragment (${this})`);for(let r=0,n=0;;r++){let i=this.child(r),a=n+i.nodeSize;if(a>=e)return a==e?xy(r+1,a):xy(r,n);n=a}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(e=>e.toJSON()):null}static fromJSON(e,r){if(!r)return it.empty;if(!Array.isArray(r))throw new RangeError("Invalid input for Fragment.fromJSON");return new it(r.map(e.nodeFromJSON))}static fromArray(e){if(!e.length)return it.empty;let r,n=0;for(let i=0;i<e.length;i++){let a=e[i];n+=a.nodeSize,i&&a.isText&&e[i-1].sameMarkup(a)?(r||(r=e.slice(0,i)),r[r.length-1]=a.withText(r[r.length-1].text+a.text)):r&&r.push(a)}return new it(r||e,n)}static from(e){if(!e)return it.empty;if(e instanceof it)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new it([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}it.empty=new it([],0);const Z2={index:0,offset:0};function xy(t,e){return Z2.index=t,Z2.offset=e,Z2}function Cx(t,e){if(t===e)return!0;if(!(t&&typeof t=="object")||!(e&&typeof e=="object"))return!1;let r=Array.isArray(t);if(Array.isArray(e)!=r)return!1;if(r){if(t.length!=e.length)return!1;for(let n=0;n<t.length;n++)if(!Cx(t[n],e[n]))return!1}else{for(let n in t)if(!(n in e)||!Cx(t[n],e[n]))return!1;for(let n in e)if(!(n in t))return!1}return!0}let wn=class uk{constructor(e,r){this.type=e,this.attrs=r}addToSet(e){let r,n=!1;for(let i=0;i<e.length;i++){let a=e[i];if(this.eq(a))return e;if(this.type.excludes(a.type))r||(r=e.slice(0,i));else{if(a.type.excludes(this.type))return e;!n&&a.type.rank>this.type.rank&&(r||(r=e.slice(0,i)),r.push(this),n=!0),r&&r.push(a)}}return r||(r=e.slice()),n||r.push(this),r}removeFromSet(e){for(let r=0;r<e.length;r++)if(this.eq(e[r]))return e.slice(0,r).concat(e.slice(r+1));return e}isInSet(e){for(let r=0;r<e.length;r++)if(this.eq(e[r]))return!0;return!1}eq(e){return this==e||this.type==e.type&&Cx(this.attrs,e.attrs)}toJSON(){let e={type:this.type.name};for(let r in this.attrs){e.attrs=this.attrs;break}return e}static fromJSON(e,r){if(!r)throw new RangeError("Invalid input for Mark.fromJSON");let n=e.marks[r.type];if(!n)throw new RangeError(`There is no mark type ${r.type} in this schema`);let i=n.create(r.attrs);return n.checkAttrs(i.attrs),i}static sameSet(e,r){if(e==r)return!0;if(e.length!=r.length)return!1;for(let n=0;n<e.length;n++)if(!e[n].eq(r[n]))return!1;return!0}static setFrom(e){if(!e||Array.isArray(e)&&e.length==0)return uk.none;if(e instanceof uk)return[e];let r=e.slice();return r.sort((n,i)=>n.type.rank-i.type.rank),r}};wn.none=[];class Ex extends Error{}class Pt{constructor(e,r,n){this.content=e,this.openStart=r,this.openEnd=n}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(e,r){let n=SL(this.content,e+this.openStart,r);return n&&new Pt(n,this.openStart,this.openEnd)}removeBetween(e,r){return new Pt(wL(this.content,e+this.openStart,r+this.openStart),this.openStart,this.openEnd)}eq(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e}static fromJSON(e,r){if(!r)return Pt.empty;let n=r.openStart||0,i=r.openEnd||0;if(typeof n!="number"||typeof i!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new Pt(it.fromJSON(e,r.content),n,i)}static maxOpen(e,r=!0){let n=0,i=0;for(let a=e.firstChild;a&&!a.isLeaf&&(r||!a.type.spec.isolating);a=a.firstChild)n++;for(let a=e.lastChild;a&&!a.isLeaf&&(r||!a.type.spec.isolating);a=a.lastChild)i++;return new Pt(e,n,i)}}Pt.empty=new Pt(it.empty,0,0);function wL(t,e,r){let{index:n,offset:i}=t.findIndex(e),a=t.maybeChild(n),{index:s,offset:o}=t.findIndex(r);if(i==e||a.isText){if(o!=r&&!t.child(s).isText)throw new RangeError("Removing non-flat range");return t.cut(0,e).append(t.cut(r))}if(n!=s)throw new RangeError("Removing non-flat range");return t.replaceChild(n,a.copy(wL(a.content,e-i-1,r-i-1)))}function SL(t,e,r,n){let{index:i,offset:a}=t.findIndex(e),s=t.maybeChild(i);if(a==e||s.isText)return n&&!n.canReplace(i,i,r)?null:t.cut(0,e).append(r).append(t.cut(e));let o=SL(s.content,e-a-1,r,s);return o&&t.replaceChild(i,s.copy(o))}function WK(t,e,r){if(r.openStart>t.depth)throw new Ex("Inserted content deeper than insertion position");if(t.depth-r.openStart!=e.depth-r.openEnd)throw new Ex("Inconsistent open depths");return kL(t,e,r,0)}function kL(t,e,r,n){let i=t.index(n),a=t.node(n);if(i==e.index(n)&&n<t.depth-r.openStart){let s=kL(t,e,r,n+1);return a.copy(a.content.replaceChild(i,s))}else if(r.content.size)if(!r.openStart&&!r.openEnd&&t.depth==n&&e.depth==n){let s=t.parent,o=s.content;return lh(s,o.cut(0,t.parentOffset).append(r.content).append(o.cut(e.parentOffset)))}else{let{start:s,end:o}=qK(r,t);return lh(a,CL(t,s,o,e,n))}else return lh(a,Tx(t,e,n))}function _L(t,e){if(!e.type.compatibleContent(t.type))throw new Ex("Cannot join "+e.type.name+" onto "+t.type.name)}function ck(t,e,r){let n=t.node(r);return _L(n,e.node(r)),n}function oh(t,e){let r=e.length-1;r>=0&&t.isText&&t.sameMarkup(e[r])?e[r]=t.withText(e[r].text+t.text):e.push(t)}function iv(t,e,r,n){let i=(e||t).node(r),a=0,s=e?e.index(r):i.childCount;t&&(a=t.index(r),t.depth>r?a++:t.textOffset&&(oh(t.nodeAfter,n),a++));for(let o=a;o<s;o++)oh(i.child(o),n);e&&e.depth==r&&e.textOffset&&oh(e.nodeBefore,n)}function lh(t,e){return t.type.checkContent(e),t.copy(e)}function CL(t,e,r,n,i){let a=t.depth>i&&ck(t,e,i+1),s=n.depth>i&&ck(r,n,i+1),o=[];return iv(null,t,i,o),a&&s&&e.index(i)==r.index(i)?(_L(a,s),oh(lh(a,CL(t,e,r,n,i+1)),o)):(a&&oh(lh(a,Tx(t,e,i+1)),o),iv(e,r,i,o),s&&oh(lh(s,Tx(r,n,i+1)),o)),iv(n,null,i,o),new it(o)}function Tx(t,e,r){let n=[];if(iv(null,t,r,n),t.depth>r){let i=ck(t,e,r+1);oh(lh(i,Tx(t,e,r+1)),n)}return iv(e,null,r,n),new it(n)}function qK(t,e){let r=e.depth-t.openStart,i=e.node(r).copy(t.content);for(let a=r-1;a>=0;a--)i=e.node(a).copy(it.from(i));return{start:i.resolveNoCache(t.openStart+r),end:i.resolveNoCache(i.content.size-t.openEnd-r)}}class Lv{constructor(e,r,n){this.pos=e,this.path=r,this.parentOffset=n,this.depth=r.length/3-1}resolveDepth(e){return e==null?this.depth:e<0?this.depth+e:e}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(e){return this.path[this.resolveDepth(e)*3]}index(e){return this.path[this.resolveDepth(e)*3+1]}indexAfter(e){return e=this.resolveDepth(e),this.index(e)+(e==this.depth&&!this.textOffset?0:1)}start(e){return e=this.resolveDepth(e),e==0?0:this.path[e*3-1]+1}end(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size}before(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]}after(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]+this.path[e*3].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let e=this.parent,r=this.index(this.depth);if(r==e.childCount)return null;let n=this.pos-this.path[this.path.length-1],i=e.child(r);return n?e.child(r).cut(n):i}get nodeBefore(){let e=this.index(this.depth),r=this.pos-this.path[this.path.length-1];return r?this.parent.child(e).cut(0,r):e==0?null:this.parent.child(e-1)}posAtIndex(e,r){r=this.resolveDepth(r);let n=this.path[r*3],i=r==0?0:this.path[r*3-1]+1;for(let a=0;a<e;a++)i+=n.child(a).nodeSize;return i}marks(){let e=this.parent,r=this.index();if(e.content.size==0)return wn.none;if(this.textOffset)return e.child(r).marks;let n=e.maybeChild(r-1),i=e.maybeChild(r);if(!n){let o=n;n=i,i=o}let a=n.marks;for(var s=0;s<a.length;s++)a[s].type.spec.inclusive===!1&&(!i||!a[s].isInSet(i.marks))&&(a=a[s--].removeFromSet(a));return a}marksAcross(e){let r=this.parent.maybeChild(this.index());if(!r||!r.isInline)return null;let n=r.marks,i=e.parent.maybeChild(e.index());for(var a=0;a<n.length;a++)n[a].type.spec.inclusive===!1&&(!i||!n[a].isInSet(i.marks))&&(n=n[a--].removeFromSet(n));return n}sharedDepth(e){for(let r=this.depth;r>0;r--)if(this.start(r)<=e&&this.end(r)>=e)return r;return 0}blockRange(e=this,r){if(e.pos<this.pos)return e.blockRange(this);for(let n=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);n>=0;n--)if(e.pos<=this.end(n)&&(!r||r(this.node(n))))return new Nx(this,e,n);return null}sameParent(e){return this.pos-this.parentOffset==e.pos-e.parentOffset}max(e){return e.pos>this.pos?e:this}min(e){return e.pos<this.pos?e:this}toString(){let e="";for(let r=1;r<=this.depth;r++)e+=(e?"/":"")+this.node(r).type.name+"_"+this.index(r-1);return e+":"+this.parentOffset}static resolve(e,r){if(!(r>=0&&r<=e.content.size))throw new RangeError("Position "+r+" out of range");let n=[],i=0,a=r;for(let s=e;;){let{index:o,offset:l}=s.content.findIndex(a),u=a-l;if(n.push(s,o,i+l),!u||(s=s.child(o),s.isText))break;a=u-1,i+=l+1}return new Lv(r,n,a)}static resolveCached(e,r){let n=o3.get(e);if(n)for(let a=0;a<n.elts.length;a++){let s=n.elts[a];if(s.pos==r)return s}else o3.set(e,n=new $K);let i=n.elts[n.i]=Lv.resolve(e,r);return n.i=(n.i+1)%KK,i}}class $K{constructor(){this.elts=[],this.i=0}}const KK=12,o3=new WeakMap;class Nx{constructor(e,r,n){this.$from=e,this.$to=r,this.depth=n}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}const ZK=Object.create(null);class Xo{constructor(e,r,n,i=wn.none){this.type=e,this.attrs=r,this.marks=i,this.content=n||it.empty}get children(){return this.content.content}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(e){return this.content.child(e)}maybeChild(e){return this.content.maybeChild(e)}forEach(e){this.content.forEach(e)}nodesBetween(e,r,n,i=0){this.content.nodesBetween(e,r,n,i,this)}descendants(e){this.nodesBetween(0,this.content.size,e)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(e,r,n,i){return this.content.textBetween(e,r,n,i)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)}sameMarkup(e){return this.hasMarkup(e.type,e.attrs,e.marks)}hasMarkup(e,r,n){return this.type==e&&Cx(this.attrs,r||e.defaultAttrs||ZK)&&wn.sameSet(this.marks,n||wn.none)}copy(e=null){return e==this.content?this:new Xo(this.type,this.attrs,e,this.marks)}mark(e){return e==this.marks?this:new Xo(this.type,this.attrs,this.content,e)}cut(e,r=this.content.size){return e==0&&r==this.content.size?this:this.copy(this.content.cut(e,r))}slice(e,r=this.content.size,n=!1){if(e==r)return Pt.empty;let i=this.resolve(e),a=this.resolve(r),s=n?0:i.sharedDepth(r),o=i.start(s),u=i.node(s).content.cut(i.pos-o,a.pos-o);return new Pt(u,i.depth-s,a.depth-s)}replace(e,r,n){return WK(this.resolve(e),this.resolve(r),n)}nodeAt(e){for(let r=this;;){let{index:n,offset:i}=r.content.findIndex(e);if(r=r.maybeChild(n),!r)return null;if(i==e||r.isText)return r;e-=i+1}}childAfter(e){let{index:r,offset:n}=this.content.findIndex(e);return{node:this.content.maybeChild(r),index:r,offset:n}}childBefore(e){if(e==0)return{node:null,index:0,offset:0};let{index:r,offset:n}=this.content.findIndex(e);if(n<e)return{node:this.content.child(r),index:r,offset:n};let i=this.content.child(r-1);return{node:i,index:r-1,offset:n-i.nodeSize}}resolve(e){return Lv.resolveCached(this,e)}resolveNoCache(e){return Lv.resolve(this,e)}rangeHasMark(e,r,n){let i=!1;return r>e&&this.nodesBetween(e,r,a=>(n.isInSet(a.marks)&&(i=!0),!i)),i}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),EL(this.marks,e)}contentMatchAt(e){let r=this.type.contentMatch.matchFragment(this.content,0,e);if(!r)throw new Error("Called contentMatchAt on a node with invalid content");return r}canReplace(e,r,n=it.empty,i=0,a=n.childCount){let s=this.contentMatchAt(e).matchFragment(n,i,a),o=s&&s.matchFragment(this.content,r);if(!o||!o.validEnd)return!1;for(let l=i;l<a;l++)if(!this.type.allowsMarks(n.child(l).marks))return!1;return!0}canReplaceWith(e,r,n,i){if(i&&!this.type.allowsMarks(i))return!1;let a=this.contentMatchAt(e).matchType(n),s=a&&a.matchFragment(this.content,r);return s?s.validEnd:!1}canAppend(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let e=wn.none;for(let r=0;r<this.marks.length;r++){let n=this.marks[r];n.type.checkAttrs(n.attrs),e=n.addToSet(e)}if(!wn.sameSet(e,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(r=>r.type.name)}`);this.content.forEach(r=>r.check())}toJSON(){let e={type:this.type.name};for(let r in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map(r=>r.toJSON())),e}static fromJSON(e,r){if(!r)throw new RangeError("Invalid input for Node.fromJSON");let n;if(r.marks){if(!Array.isArray(r.marks))throw new RangeError("Invalid mark data for Node.fromJSON");n=r.marks.map(e.markFromJSON)}if(r.type=="text"){if(typeof r.text!="string")throw new RangeError("Invalid text node in JSON");return e.text(r.text,n)}let i=it.fromJSON(e,r.content),a=e.nodeType(r.type).create(r.attrs,i,n);return a.type.checkAttrs(a.attrs),a}}Xo.prototype.text=void 0;class Px extends Xo{constructor(e,r,n,i){if(super(e,r,null,i),!n)throw new RangeError("Empty text nodes are not allowed");this.text=n}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):EL(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(e,r){return this.text.slice(e,r)}get nodeSize(){return this.text.length}mark(e){return e==this.marks?this:new Px(this.type,this.attrs,this.text,e)}withText(e){return e==this.text?this:new Px(this.type,this.attrs,e,this.marks)}cut(e=0,r=this.text.length){return e==0&&r==this.text.length?this:this.withText(this.text.slice(e,r))}eq(e){return this.sameMarkup(e)&&this.text==e.text}toJSON(){let e=super.toJSON();return e.text=this.text,e}}function EL(t,e){for(let r=t.length-1;r>=0;r--)e=t[r].type.name+"("+e+")";return e}class wh{constructor(e){this.validEnd=e,this.next=[],this.wrapCache=[]}static parse(e,r){let n=new YK(e,r);if(n.next==null)return wh.empty;let i=TL(n);n.next&&n.err("Unexpected trailing text");let a=nZ(rZ(i));return iZ(a,n),a}matchType(e){for(let r=0;r<this.next.length;r++)if(this.next[r].type==e)return this.next[r].next;return null}matchFragment(e,r=0,n=e.childCount){let i=this;for(let a=r;i&&a<n;a++)i=i.matchType(e.child(a).type);return i}get inlineContent(){return this.next.length!=0&&this.next[0].type.isInline}get defaultType(){for(let e=0;e<this.next.length;e++){let{type:r}=this.next[e];if(!(r.isText||r.hasRequiredAttrs()))return r}return null}compatible(e){for(let r=0;r<this.next.length;r++)for(let n=0;n<e.next.length;n++)if(this.next[r].type==e.next[n].type)return!0;return!1}fillBefore(e,r=!1,n=0){let i=[this];function a(s,o){let l=s.matchFragment(e,n);if(l&&(!r||l.validEnd))return it.from(o.map(u=>u.createAndFill()));for(let u=0;u<s.next.length;u++){let{type:c,next:f}=s.next[u];if(!(c.isText||c.hasRequiredAttrs())&&i.indexOf(f)==-1){i.push(f);let p=a(f,o.concat(c));if(p)return p}}return null}return a(this,[])}findWrapping(e){for(let n=0;n<this.wrapCache.length;n+=2)if(this.wrapCache[n]==e)return this.wrapCache[n+1];let r=this.computeWrapping(e);return this.wrapCache.push(e,r),r}computeWrapping(e){let r=Object.create(null),n=[{match:this,type:null,via:null}];for(;n.length;){let i=n.shift(),a=i.match;if(a.matchType(e)){let s=[];for(let o=i;o.type;o=o.via)s.push(o.type);return s.reverse()}for(let s=0;s<a.next.length;s++){let{type:o,next:l}=a.next[s];!o.isLeaf&&!o.hasRequiredAttrs()&&!(o.name in r)&&(!i.type||l.validEnd)&&(n.push({match:o.contentMatch,type:o,via:i}),r[o.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(e){if(e>=this.next.length)throw new RangeError(`There's no ${e}th edge in this content match`);return this.next[e]}toString(){let e=[];function r(n){e.push(n);for(let i=0;i<n.next.length;i++)e.indexOf(n.next[i].next)==-1&&r(n.next[i].next)}return r(this),e.map((n,i)=>{let a=i+(n.validEnd?"*":" ")+" ";for(let s=0;s<n.next.length;s++)a+=(s?", ":"")+n.next[s].type.name+"->"+e.indexOf(n.next[s].next);return a}).join(`
`)}}wh.empty=new wh(!0);class YK{constructor(e,r){this.string=e,this.nodeTypes=r,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(e){return this.next==e&&(this.pos++||!0)}err(e){throw new SyntaxError(e+" (in content expression '"+this.string+"')")}}function TL(t){let e=[];do e.push(XK(t));while(t.eat("|"));return e.length==1?e[0]:{type:"choice",exprs:e}}function XK(t){let e=[];do e.push(QK(t));while(t.next&&t.next!=")"&&t.next!="|");return e.length==1?e[0]:{type:"seq",exprs:e}}function QK(t){let e=tZ(t);for(;;)if(t.eat("+"))e={type:"plus",expr:e};else if(t.eat("*"))e={type:"star",expr:e};else if(t.eat("?"))e={type:"opt",expr:e};else if(t.eat("{"))e=JK(t,e);else break;return e}function l3(t){/\D/.test(t.next)&&t.err("Expected number, got '"+t.next+"'");let e=Number(t.next);return t.pos++,e}function JK(t,e){let r=l3(t),n=r;return t.eat(",")&&(t.next!="}"?n=l3(t):n=-1),t.eat("}")||t.err("Unclosed braced range"),{type:"range",min:r,max:n,expr:e}}function eZ(t,e){let r=t.nodeTypes,n=r[e];if(n)return[n];let i=[];for(let a in r){let s=r[a];s.isInGroup(e)&&i.push(s)}return i.length==0&&t.err("No node type or group '"+e+"' found"),i}function tZ(t){if(t.eat("(")){let e=TL(t);return t.eat(")")||t.err("Missing closing paren"),e}else if(/\W/.test(t.next))t.err("Unexpected token '"+t.next+"'");else{let e=eZ(t,t.next).map(r=>(t.inline==null?t.inline=r.isInline:t.inline!=r.isInline&&t.err("Mixing inline and block content"),{type:"name",value:r}));return t.pos++,e.length==1?e[0]:{type:"choice",exprs:e}}}function rZ(t){let e=[[]];return i(a(t,0),r()),e;function r(){return e.push([])-1}function n(s,o,l){let u={term:l,to:o};return e[s].push(u),u}function i(s,o){s.forEach(l=>l.to=o)}function a(s,o){if(s.type=="choice")return s.exprs.reduce((l,u)=>l.concat(a(u,o)),[]);if(s.type=="seq")for(let l=0;;l++){let u=a(s.exprs[l],o);if(l==s.exprs.length-1)return u;i(u,o=r())}else if(s.type=="star"){let l=r();return n(o,l),i(a(s.expr,l),l),[n(l)]}else if(s.type=="plus"){let l=r();return i(a(s.expr,o),l),i(a(s.expr,l),l),[n(l)]}else{if(s.type=="opt")return[n(o)].concat(a(s.expr,o));if(s.type=="range"){let l=o;for(let u=0;u<s.min;u++){let c=r();i(a(s.expr,l),c),l=c}if(s.max==-1)i(a(s.expr,l),l);else for(let u=s.min;u<s.max;u++){let c=r();n(l,c),i(a(s.expr,l),c),l=c}return[n(l)]}else{if(s.type=="name")return[n(o,void 0,s.value)];throw new Error("Unknown expr type")}}}}function NL(t,e){return e-t}function u3(t,e){let r=[];return n(e),r.sort(NL);function n(i){let a=t[i];if(a.length==1&&!a[0].term)return n(a[0].to);r.push(i);for(let s=0;s<a.length;s++){let{term:o,to:l}=a[s];!o&&r.indexOf(l)==-1&&n(l)}}}function nZ(t){let e=Object.create(null);return r(u3(t,0));function r(n){let i=[];n.forEach(s=>{t[s].forEach(({term:o,to:l})=>{if(!o)return;let u;for(let c=0;c<i.length;c++)i[c][0]==o&&(u=i[c][1]);u3(t,l).forEach(c=>{u||i.push([o,u=[]]),u.indexOf(c)==-1&&u.push(c)})})});let a=e[n.join(",")]=new wh(n.indexOf(t.length-1)>-1);for(let s=0;s<i.length;s++){let o=i[s][1].sort(NL);a.next.push({type:i[s][0],next:e[o.join(",")]||r(o)})}return a}}function iZ(t,e){for(let r=0,n=[t];r<n.length;r++){let i=n[r],a=!i.validEnd,s=[];for(let o=0;o<i.next.length;o++){let{type:l,next:u}=i.next[o];s.push(l.name),a&&!(l.isText||l.hasRequiredAttrs())&&(a=!1),n.indexOf(u)==-1&&n.push(u)}a&&e.err("Only non-generatable nodes ("+s.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function PL(t){let e=Object.create(null);for(let r in t){let n=t[r];if(!n.hasDefault)return null;e[r]=n.default}return e}function ML(t,e){let r=Object.create(null);for(let n in t){let i=e&&e[n];if(i===void 0){let a=t[n];if(a.hasDefault)i=a.default;else throw new RangeError("No value supplied for attribute "+n)}r[n]=i}return r}function AL(t,e,r,n){for(let i in e)if(!(i in t))throw new RangeError(`Unsupported attribute ${i} for ${r} of type ${i}`);for(let i in t){let a=t[i];a.validate&&a.validate(e[i])}}function RL(t,e){let r=Object.create(null);if(e)for(let n in e)r[n]=new sZ(t,n,e[n]);return r}let c3=class LL{constructor(e,r,n){this.name=e,this.schema=r,this.spec=n,this.markSet=null,this.groups=n.group?n.group.split(" "):[],this.attrs=RL(e,n.attrs),this.defaultAttrs=PL(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(n.inline||e=="text"),this.isText=e=="text"}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==wh.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}isInGroup(e){return this.groups.indexOf(e)>-1}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1}compatibleContent(e){return this==e||this.contentMatch.compatible(e.contentMatch)}computeAttrs(e){return!e&&this.defaultAttrs?this.defaultAttrs:ML(this.attrs,e)}create(e=null,r,n){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new Xo(this,this.computeAttrs(e),it.from(r),wn.setFrom(n))}createChecked(e=null,r,n){return r=it.from(r),this.checkContent(r),new Xo(this,this.computeAttrs(e),r,wn.setFrom(n))}createAndFill(e=null,r,n){if(e=this.computeAttrs(e),r=it.from(r),r.size){let s=this.contentMatch.fillBefore(r);if(!s)return null;r=s.append(r)}let i=this.contentMatch.matchFragment(r),a=i&&i.fillBefore(it.empty,!0);return a?new Xo(this,e,r.append(a),wn.setFrom(n)):null}validContent(e){let r=this.contentMatch.matchFragment(e);if(!r||!r.validEnd)return!1;for(let n=0;n<e.childCount;n++)if(!this.allowsMarks(e.child(n).marks))return!1;return!0}checkContent(e){if(!this.validContent(e))throw new RangeError(`Invalid content for node ${this.name}: ${e.toString().slice(0,50)}`)}checkAttrs(e){AL(this.attrs,e,"node",this.name)}allowsMarkType(e){return this.markSet==null||this.markSet.indexOf(e)>-1}allowsMarks(e){if(this.markSet==null)return!0;for(let r=0;r<e.length;r++)if(!this.allowsMarkType(e[r].type))return!1;return!0}allowedMarks(e){if(this.markSet==null)return e;let r;for(let n=0;n<e.length;n++)this.allowsMarkType(e[n].type)?r&&r.push(e[n]):r||(r=e.slice(0,n));return r?r.length?r:wn.none:e}static compile(e,r){let n=Object.create(null);e.forEach((a,s)=>n[a]=new LL(a,r,s));let i=r.spec.topNode||"doc";if(!n[i])throw new RangeError("Schema is missing its top node type ('"+i+"')");if(!n.text)throw new RangeError("Every schema needs a 'text' type");for(let a in n.text.attrs)throw new RangeError("The text node type should not have attributes");return n}};function aZ(t,e,r){let n=r.split("|");return i=>{let a=i===null?"null":typeof i;if(n.indexOf(a)<0)throw new RangeError(`Expected value of type ${n} for attribute ${e} on type ${t}, got ${a}`)}}class sZ{constructor(e,r,n){this.hasDefault=Object.prototype.hasOwnProperty.call(n,"default"),this.default=n.default,this.validate=typeof n.validate=="string"?aZ(e,r,n.validate):n.validate}get isRequired(){return!this.hasDefault}}class W1{constructor(e,r,n,i){this.name=e,this.rank=r,this.schema=n,this.spec=i,this.attrs=RL(e,i.attrs),this.excluded=null;let a=PL(this.attrs);this.instance=a?new wn(this,a):null}create(e=null){return!e&&this.instance?this.instance:new wn(this,ML(this.attrs,e))}static compile(e,r){let n=Object.create(null),i=0;return e.forEach((a,s)=>n[a]=new W1(a,i++,r,s)),n}removeFromSet(e){for(var r=0;r<e.length;r++)e[r].type==this&&(e=e.slice(0,r).concat(e.slice(r+1)),r--);return e}isInSet(e){for(let r=0;r<e.length;r++)if(e[r].type==this)return e[r]}checkAttrs(e){AL(this.attrs,e,"mark",this.name)}excludes(e){return this.excluded.indexOf(e)>-1}}class OL{constructor(e){this.linebreakReplacement=null,this.cached=Object.create(null);let r=this.spec={};for(let i in e)r[i]=e[i];r.nodes=ja.from(e.nodes),r.marks=ja.from(e.marks||{}),this.nodes=c3.compile(this.spec.nodes,this),this.marks=W1.compile(this.spec.marks,this);let n=Object.create(null);for(let i in this.nodes){if(i in this.marks)throw new RangeError(i+" can not be both a node and a mark");let a=this.nodes[i],s=a.spec.content||"",o=a.spec.marks;if(a.contentMatch=n[s]||(n[s]=wh.parse(s,this.nodes)),a.inlineContent=a.contentMatch.inlineContent,a.spec.linebreakReplacement){if(this.linebreakReplacement)throw new RangeError("Multiple linebreak nodes defined");if(!a.isInline||!a.isLeaf)throw new RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=a}a.markSet=o=="_"?null:o?d3(this,o.split(" ")):o==""||!a.inlineContent?[]:null}for(let i in this.marks){let a=this.marks[i],s=a.spec.excludes;a.excluded=s==null?[a]:s==""?[]:d3(this,s.split(" "))}this.nodeFromJSON=i=>Xo.fromJSON(this,i),this.markFromJSON=i=>wn.fromJSON(this,i),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(e,r=null,n,i){if(typeof e=="string")e=this.nodeType(e);else if(e instanceof c3){if(e.schema!=this)throw new RangeError("Node type from different schema used ("+e.name+")")}else throw new RangeError("Invalid node type: "+e);return e.createChecked(r,n,i)}text(e,r){let n=this.nodes.text;return new Px(n,n.defaultAttrs,e,wn.setFrom(r))}mark(e,r){return typeof e=="string"&&(e=this.marks[e]),e.create(r)}nodeType(e){let r=this.nodes[e];if(!r)throw new RangeError("Unknown node type: "+e);return r}}function d3(t,e){let r=[];for(let n=0;n<e.length;n++){let i=e[n],a=t.marks[i],s=a;if(a)r.push(a);else for(let o in t.marks){let l=t.marks[o];(i=="_"||l.spec.group&&l.spec.group.split(" ").indexOf(i)>-1)&&r.push(s=l)}if(!s)throw new SyntaxError("Unknown mark type: '"+e[n]+"'")}return r}function oZ(t){return t.tag!=null}function lZ(t){return t.style!=null}class Wd{constructor(e,r){this.schema=e,this.rules=r,this.tags=[],this.styles=[];let n=this.matchedStyles=[];r.forEach(i=>{if(oZ(i))this.tags.push(i);else if(lZ(i)){let a=/[^=]*/.exec(i.style)[0];n.indexOf(a)<0&&n.push(a),this.styles.push(i)}}),this.normalizeLists=!this.tags.some(i=>{if(!/^(ul|ol)\b/.test(i.tag)||!i.node)return!1;let a=e.nodes[i.node];return a.contentMatch.matchType(a)})}parse(e,r={}){let n=new h3(this,r,!1);return n.addAll(e,wn.none,r.from,r.to),n.finish()}parseSlice(e,r={}){let n=new h3(this,r,!0);return n.addAll(e,wn.none,r.from,r.to),Pt.maxOpen(n.finish())}matchTag(e,r,n){for(let i=n?this.tags.indexOf(n)+1:0;i<this.tags.length;i++){let a=this.tags[i];if(dZ(e,a.tag)&&(a.namespace===void 0||e.namespaceURI==a.namespace)&&(!a.context||r.matchesContext(a.context))){if(a.getAttrs){let s=a.getAttrs(e);if(s===!1)continue;a.attrs=s||void 0}return a}}}matchStyle(e,r,n,i){for(let a=i?this.styles.indexOf(i)+1:0;a<this.styles.length;a++){let s=this.styles[a],o=s.style;if(!(o.indexOf(e)!=0||s.context&&!n.matchesContext(s.context)||o.length>e.length&&(o.charCodeAt(e.length)!=61||o.slice(e.length+1)!=r))){if(s.getAttrs){let l=s.getAttrs(r);if(l===!1)continue;s.attrs=l||void 0}return s}}}static schemaRules(e){let r=[];function n(i){let a=i.priority==null?50:i.priority,s=0;for(;s<r.length;s++){let o=r[s];if((o.priority==null?50:o.priority)<a)break}r.splice(s,0,i)}for(let i in e.marks){let a=e.marks[i].spec.parseDOM;a&&a.forEach(s=>{n(s=p3(s)),s.mark||s.ignore||s.clearMark||(s.mark=i)})}for(let i in e.nodes){let a=e.nodes[i].spec.parseDOM;a&&a.forEach(s=>{n(s=p3(s)),s.node||s.ignore||s.mark||(s.node=i)})}return r}static fromSchema(e){return e.cached.domParser||(e.cached.domParser=new Wd(e,Wd.schemaRules(e)))}}const DL={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},uZ={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},IL={ol:!0,ul:!0},Ov=1,dk=2,av=4;function f3(t,e,r){return e!=null?(e?Ov:0)|(e==="full"?dk:0):t&&t.whitespace=="pre"?Ov|dk:r&~av}class by{constructor(e,r,n,i,a,s){this.type=e,this.attrs=r,this.marks=n,this.solid=i,this.options=s,this.content=[],this.activeMarks=wn.none,this.match=a||(s&av?null:e.contentMatch)}findWrapping(e){if(!this.match){if(!this.type)return[];let r=this.type.contentMatch.fillBefore(it.from(e));if(r)this.match=this.type.contentMatch.matchFragment(r);else{let n=this.type.contentMatch,i;return(i=n.findWrapping(e.type))?(this.match=n,i):null}}return this.match.findWrapping(e.type)}finish(e){if(!(this.options&Ov)){let n=this.content[this.content.length-1],i;if(n&&n.isText&&(i=/[ \t\r\n\u000c]+$/.exec(n.text))){let a=n;n.text.length==i[0].length?this.content.pop():this.content[this.content.length-1]=a.withText(a.text.slice(0,a.text.length-i[0].length))}}let r=it.from(this.content);return!e&&this.match&&(r=r.append(this.match.fillBefore(it.empty,!0))),this.type?this.type.create(this.attrs,r,this.marks):r}inlineContext(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!DL.hasOwnProperty(e.parentNode.nodeName.toLowerCase())}}class h3{constructor(e,r,n){this.parser=e,this.options=r,this.isOpen=n,this.open=0,this.localPreserveWS=!1;let i=r.topNode,a,s=f3(null,r.preserveWhitespace,0)|(n?av:0);i?a=new by(i.type,i.attrs,wn.none,!0,r.topMatch||i.type.contentMatch,s):n?a=new by(null,null,wn.none,!0,null,s):a=new by(e.schema.topNodeType,null,wn.none,!0,null,s),this.nodes=[a],this.find=r.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(e,r){e.nodeType==3?this.addTextNode(e,r):e.nodeType==1&&this.addElement(e,r)}addTextNode(e,r){let n=e.nodeValue,i=this.top,a=i.options&dk?"full":this.localPreserveWS||(i.options&Ov)>0,{schema:s}=this.parser;if(a==="full"||i.inlineContext(e)||/[^ \t\r\n\u000c]/.test(n)){if(a)if(a==="full")n=n.replace(/\r\n?/g,`
`);else if(s.linebreakReplacement&&/[\r\n]/.test(n)&&this.top.findWrapping(s.linebreakReplacement.create())){let o=n.split(/\r?\n|\r/);for(let l=0;l<o.length;l++)l&&this.insertNode(s.linebreakReplacement.create(),r,!0),o[l]&&this.insertNode(s.text(o[l]),r,!/\S/.test(o[l]));n=""}else n=n.replace(/\r?\n|\r/g," ");else if(n=n.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(n)&&this.open==this.nodes.length-1){let o=i.content[i.content.length-1],l=e.previousSibling;(!o||l&&l.nodeName=="BR"||o.isText&&/[ \t\r\n\u000c]$/.test(o.text))&&(n=n.slice(1))}n&&this.insertNode(s.text(n),r,!/\S/.test(n)),this.findInText(e)}else this.findInside(e)}addElement(e,r,n){let i=this.localPreserveWS,a=this.top;(e.tagName=="PRE"||/pre/.test(e.style&&e.style.whiteSpace))&&(this.localPreserveWS=!0);let s=e.nodeName.toLowerCase(),o;IL.hasOwnProperty(s)&&this.parser.normalizeLists&&cZ(e);let l=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(o=this.parser.matchTag(e,this,n));e:if(l?l.ignore:uZ.hasOwnProperty(s))this.findInside(e),this.ignoreFallback(e,r);else if(!l||l.skip||l.closeParent){l&&l.closeParent?this.open=Math.max(0,this.open-1):l&&l.skip.nodeType&&(e=l.skip);let u,c=this.needsBlock;if(DL.hasOwnProperty(s))a.content.length&&a.content[0].isInline&&this.open&&(this.open--,a=this.top),u=!0,a.type||(this.needsBlock=!0);else if(!e.firstChild){this.leafFallback(e,r);break e}let f=l&&l.skip?r:this.readStyles(e,r);f&&this.addAll(e,f),u&&this.sync(a),this.needsBlock=c}else{let u=this.readStyles(e,r);u&&this.addElementByRule(e,l,u,l.consuming===!1?o:void 0)}this.localPreserveWS=i}leafFallback(e,r){e.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode(`
`),r)}ignoreFallback(e,r){e.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"),r,!0)}readStyles(e,r){let n=e.style;if(n&&n.length)for(let i=0;i<this.parser.matchedStyles.length;i++){let a=this.parser.matchedStyles[i],s=n.getPropertyValue(a);if(s)for(let o=void 0;;){let l=this.parser.matchStyle(a,s,this,o);if(!l)break;if(l.ignore)return null;if(l.clearMark?r=r.filter(u=>!l.clearMark(u)):r=r.concat(this.parser.schema.marks[l.mark].create(l.attrs)),l.consuming===!1)o=l;else break}}return r}addElementByRule(e,r,n,i){let a,s;if(r.node)if(s=this.parser.schema.nodes[r.node],s.isLeaf)this.insertNode(s.create(r.attrs),n,e.nodeName=="BR")||this.leafFallback(e,n);else{let l=this.enter(s,r.attrs||null,n,r.preserveWhitespace);l&&(a=!0,n=l)}else{let l=this.parser.schema.marks[r.mark];n=n.concat(l.create(r.attrs))}let o=this.top;if(s&&s.isLeaf)this.findInside(e);else if(i)this.addElement(e,n,i);else if(r.getContent)this.findInside(e),r.getContent(e,this.parser.schema).forEach(l=>this.insertNode(l,n,!1));else{let l=e;typeof r.contentElement=="string"?l=e.querySelector(r.contentElement):typeof r.contentElement=="function"?l=r.contentElement(e):r.contentElement&&(l=r.contentElement),this.findAround(e,l,!0),this.addAll(l,n),this.findAround(e,l,!1)}a&&this.sync(o)&&this.open--}addAll(e,r,n,i){let a=n||0;for(let s=n?e.childNodes[n]:e.firstChild,o=i==null?null:e.childNodes[i];s!=o;s=s.nextSibling,++a)this.findAtPoint(e,a),this.addDOM(s,r);this.findAtPoint(e,a)}findPlace(e,r,n){let i,a;for(let s=this.open,o=0;s>=0;s--){let l=this.nodes[s],u=l.findWrapping(e);if(u&&(!i||i.length>u.length+o)&&(i=u,a=l,!u.length))break;if(l.solid){if(n)break;o+=2}}if(!i)return null;this.sync(a);for(let s=0;s<i.length;s++)r=this.enterInner(i[s],null,r,!1);return r}insertNode(e,r,n){if(e.isInline&&this.needsBlock&&!this.top.type){let a=this.textblockFromContext();a&&(r=this.enterInner(a,null,r))}let i=this.findPlace(e,r,n);if(i){this.closeExtra();let a=this.top;a.match&&(a.match=a.match.matchType(e.type));let s=wn.none;for(let o of i.concat(e.marks))(a.type?a.type.allowsMarkType(o.type):m3(o.type,e.type))&&(s=o.addToSet(s));return a.content.push(e.mark(s)),!0}return!1}enter(e,r,n,i){let a=this.findPlace(e.create(r),n,!1);return a&&(a=this.enterInner(e,r,n,!0,i)),a}enterInner(e,r,n,i=!1,a){this.closeExtra();let s=this.top;s.match=s.match&&s.match.matchType(e);let o=f3(e,a,s.options);s.options&av&&s.content.length==0&&(o|=av);let l=wn.none;return n=n.filter(u=>(s.type?s.type.allowsMarkType(u.type):m3(u.type,e))?(l=u.addToSet(l),!1):!0),this.nodes.push(new by(e,r,l,i,null,o)),this.open++,n}closeExtra(e=!1){let r=this.nodes.length-1;if(r>this.open){for(;r>this.open;r--)this.nodes[r-1].content.push(this.nodes[r].finish(e));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(!!(this.isOpen||this.options.topOpen))}sync(e){for(let r=this.open;r>=0;r--){if(this.nodes[r]==e)return this.open=r,!0;this.localPreserveWS&&(this.nodes[r].options|=Ov)}return!1}get currentPos(){this.closeExtra();let e=0;for(let r=this.open;r>=0;r--){let n=this.nodes[r].content;for(let i=n.length-1;i>=0;i--)e+=n[i].nodeSize;r&&e++}return e}findAtPoint(e,r){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].node==e&&this.find[n].offset==r&&(this.find[n].pos=this.currentPos)}findInside(e){if(this.find)for(let r=0;r<this.find.length;r++)this.find[r].pos==null&&e.nodeType==1&&e.contains(this.find[r].node)&&(this.find[r].pos=this.currentPos)}findAround(e,r,n){if(e!=r&&this.find)for(let i=0;i<this.find.length;i++)this.find[i].pos==null&&e.nodeType==1&&e.contains(this.find[i].node)&&r.compareDocumentPosition(this.find[i].node)&(n?2:4)&&(this.find[i].pos=this.currentPos)}findInText(e){if(this.find)for(let r=0;r<this.find.length;r++)this.find[r].node==e&&(this.find[r].pos=this.currentPos-(e.nodeValue.length-this.find[r].offset))}matchesContext(e){if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);let r=e.split("/"),n=this.options.context,i=!this.isOpen&&(!n||n.parent.type==this.nodes[0].type),a=-(n?n.depth+1:0)+(i?0:1),s=(o,l)=>{for(;o>=0;o--){let u=r[o];if(u==""){if(o==r.length-1||o==0)continue;for(;l>=a;l--)if(s(o-1,l))return!0;return!1}else{let c=l>0||l==0&&i?this.nodes[l].type:n&&l>=a?n.node(l-a).type:null;if(!c||c.name!=u&&!c.isInGroup(u))return!1;l--}}return!0};return s(r.length-1,this.open)}textblockFromContext(){let e=this.options.context;if(e)for(let r=e.depth;r>=0;r--){let n=e.node(r).contentMatchAt(e.indexAfter(r)).defaultType;if(n&&n.isTextblock&&n.defaultAttrs)return n}for(let r in this.parser.schema.nodes){let n=this.parser.schema.nodes[r];if(n.isTextblock&&n.defaultAttrs)return n}}}function cZ(t){for(let e=t.firstChild,r=null;e;e=e.nextSibling){let n=e.nodeType==1?e.nodeName.toLowerCase():null;n&&IL.hasOwnProperty(n)&&r?(r.appendChild(e),e=r):n=="li"?r=e:n&&(r=null)}}function dZ(t,e){return(t.matches||t.msMatchesSelector||t.webkitMatchesSelector||t.mozMatchesSelector).call(t,e)}function p3(t){let e={};for(let r in t)e[r]=t[r];return e}function m3(t,e){let r=e.schema.nodes;for(let n in r){let i=r[n];if(!i.allowsMarkType(t))continue;let a=[],s=o=>{a.push(o);for(let l=0;l<o.edgeCount;l++){let{type:u,next:c}=o.edge(l);if(u==e||a.indexOf(c)<0&&s(c))return!0}};if(s(i.contentMatch))return!0}}class Ah{constructor(e,r){this.nodes=e,this.marks=r}serializeFragment(e,r={},n){n||(n=Y2(r).createDocumentFragment());let i=n,a=[];return e.forEach(s=>{if(a.length||s.marks.length){let o=0,l=0;for(;o<a.length&&l<s.marks.length;){let u=s.marks[l];if(!this.marks[u.type.name]){l++;continue}if(!u.eq(a[o][0])||u.type.spec.spanning===!1)break;o++,l++}for(;o<a.length;)i=a.pop()[1];for(;l<s.marks.length;){let u=s.marks[l++],c=this.serializeMark(u,s.isInline,r);c&&(a.push([u,i]),i.appendChild(c.dom),i=c.contentDOM||c.dom)}}i.appendChild(this.serializeNodeInner(s,r))}),n}serializeNodeInner(e,r){let{dom:n,contentDOM:i}=Ky(Y2(r),this.nodes[e.type.name](e),null,e.attrs);if(i){if(e.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(e.content,r,i)}return n}serializeNode(e,r={}){let n=this.serializeNodeInner(e,r);for(let i=e.marks.length-1;i>=0;i--){let a=this.serializeMark(e.marks[i],e.isInline,r);a&&((a.contentDOM||a.dom).appendChild(n),n=a.dom)}return n}serializeMark(e,r,n={}){let i=this.marks[e.type.name];return i&&Ky(Y2(n),i(e,r),null,e.attrs)}static renderSpec(e,r,n=null,i){return Ky(e,r,n,i)}static fromSchema(e){return e.cached.domSerializer||(e.cached.domSerializer=new Ah(this.nodesFromSchema(e),this.marksFromSchema(e)))}static nodesFromSchema(e){let r=g3(e.nodes);return r.text||(r.text=n=>n.text),r}static marksFromSchema(e){return g3(e.marks)}}function g3(t){let e={};for(let r in t){let n=t[r].spec.toDOM;n&&(e[r]=n)}return e}function Y2(t){return t.document||window.document}const v3=new WeakMap;function fZ(t){let e=v3.get(t);return e===void 0&&v3.set(t,e=hZ(t)),e}function hZ(t){let e=null;function r(n){if(n&&typeof n=="object")if(Array.isArray(n))if(typeof n[0]=="string")e||(e=[]),e.push(n);else for(let i=0;i<n.length;i++)r(n[i]);else for(let i in n)r(n[i])}return r(t),e}function Ky(t,e,r,n){if(typeof e=="string")return{dom:t.createTextNode(e)};if(e.nodeType!=null)return{dom:e};if(e.dom&&e.dom.nodeType!=null)return e;let i=e[0],a;if(typeof i!="string")throw new RangeError("Invalid array passed to renderSpec");if(n&&(a=fZ(n))&&a.indexOf(e)>-1)throw new RangeError("Using an array from an attribute object as a DOM spec. This may be an attempted cross site scripting attack.");let s=i.indexOf(" ");s>0&&(r=i.slice(0,s),i=i.slice(s+1));let o,l=r?t.createElementNS(r,i):t.createElement(i),u=e[1],c=1;if(u&&typeof u=="object"&&u.nodeType==null&&!Array.isArray(u)){c=2;for(let f in u)if(u[f]!=null){let p=f.indexOf(" ");p>0?l.setAttributeNS(f.slice(0,p),f.slice(p+1),u[f]):f=="style"&&l.style?l.style.cssText=u[f]:l.setAttribute(f,u[f])}}for(let f=c;f<e.length;f++){let p=e[f];if(p===0){if(f<e.length-1||f>c)throw new RangeError("Content hole must be the only child of its parent node");return{dom:l,contentDOM:l}}else{let{dom:v,contentDOM:y}=Ky(t,p,r,n);if(l.appendChild(v),y){if(o)throw new RangeError("Multiple content holes");o=y}}}return{dom:l,contentDOM:o}}const jL=65535,FL=Math.pow(2,16);function pZ(t,e){return t+e*FL}function y3(t){return t&jL}function mZ(t){return(t-(t&jL))/FL}const BL=1,zL=2,Zy=4,UL=8;class fk{constructor(e,r,n){this.pos=e,this.delInfo=r,this.recover=n}get deleted(){return(this.delInfo&UL)>0}get deletedBefore(){return(this.delInfo&(BL|Zy))>0}get deletedAfter(){return(this.delInfo&(zL|Zy))>0}get deletedAcross(){return(this.delInfo&Zy)>0}}class mo{constructor(e,r=!1){if(this.ranges=e,this.inverted=r,!e.length&&mo.empty)return mo.empty}recover(e){let r=0,n=y3(e);if(!this.inverted)for(let i=0;i<n;i++)r+=this.ranges[i*3+2]-this.ranges[i*3+1];return this.ranges[n*3]+r+mZ(e)}mapResult(e,r=1){return this._map(e,r,!1)}map(e,r=1){return this._map(e,r,!0)}_map(e,r,n){let i=0,a=this.inverted?2:1,s=this.inverted?1:2;for(let o=0;o<this.ranges.length;o+=3){let l=this.ranges[o]-(this.inverted?i:0);if(l>e)break;let u=this.ranges[o+a],c=this.ranges[o+s],f=l+u;if(e<=f){let p=u?e==l?-1:e==f?1:r:r,v=l+i+(p<0?0:c);if(n)return v;let y=e==(r<0?l:f)?null:pZ(o/3,e-l),S=e==l?zL:e==f?BL:Zy;return(r<0?e!=l:e!=f)&&(S|=UL),new fk(v,S,y)}i+=c-u}return n?e+i:new fk(e+i,0,null)}touches(e,r){let n=0,i=y3(r),a=this.inverted?2:1,s=this.inverted?1:2;for(let o=0;o<this.ranges.length;o+=3){let l=this.ranges[o]-(this.inverted?n:0);if(l>e)break;let u=this.ranges[o+a],c=l+u;if(e<=c&&o==i*3)return!0;n+=this.ranges[o+s]-u}return!1}forEach(e){let r=this.inverted?2:1,n=this.inverted?1:2;for(let i=0,a=0;i<this.ranges.length;i+=3){let s=this.ranges[i],o=s-(this.inverted?a:0),l=s+(this.inverted?0:a),u=this.ranges[i+r],c=this.ranges[i+n];e(o,o+u,l,l+c),a+=c-u}}invert(){return new mo(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(e){return e==0?mo.empty:new mo(e<0?[0,-e,0]:[0,0,e])}}mo.empty=new mo([]);class Dv{constructor(e,r,n=0,i=e?e.length:0){this.mirror=r,this.from=n,this.to=i,this._maps=e||[],this.ownData=!(e||r)}get maps(){return this._maps}slice(e=0,r=this.maps.length){return new Dv(this._maps,this.mirror,e,r)}appendMap(e,r){this.ownData||(this._maps=this._maps.slice(),this.mirror=this.mirror&&this.mirror.slice(),this.ownData=!0),this.to=this._maps.push(e),r!=null&&this.setMirror(this._maps.length-1,r)}appendMapping(e){for(let r=0,n=this._maps.length;r<e._maps.length;r++){let i=e.getMirror(r);this.appendMap(e._maps[r],i!=null&&i<r?n+i:void 0)}}getMirror(e){if(this.mirror){for(let r=0;r<this.mirror.length;r++)if(this.mirror[r]==e)return this.mirror[r+(r%2?-1:1)]}}setMirror(e,r){this.mirror||(this.mirror=[]),this.mirror.push(e,r)}appendMappingInverted(e){for(let r=e.maps.length-1,n=this._maps.length+e._maps.length;r>=0;r--){let i=e.getMirror(r);this.appendMap(e._maps[r].invert(),i!=null&&i>r?n-i-1:void 0)}}invert(){let e=new Dv;return e.appendMappingInverted(this),e}map(e,r=1){if(this.mirror)return this._map(e,r,!0);for(let n=this.from;n<this.to;n++)e=this._maps[n].map(e,r);return e}mapResult(e,r=1){return this._map(e,r,!1)}_map(e,r,n){let i=0;for(let a=this.from;a<this.to;a++){let s=this._maps[a],o=s.mapResult(e,r);if(o.recover!=null){let l=this.getMirror(a);if(l!=null&&l>a&&l<this.to){a=l,e=this._maps[l].recover(o.recover);continue}}i|=o.delInfo,e=o.pos}return n?e:new fk(e,i,null)}}const X2=Object.create(null);class cs{getMap(){return mo.empty}merge(e){return null}static fromJSON(e,r){if(!r||!r.stepType)throw new RangeError("Invalid input for Step.fromJSON");let n=X2[r.stepType];if(!n)throw new RangeError(`No step type ${r.stepType} defined`);return n.fromJSON(e,r)}static jsonID(e,r){if(e in X2)throw new RangeError("Duplicate use of step JSON ID "+e);return X2[e]=r,r.prototype.jsonID=e,r}}class Ii{constructor(e,r){this.doc=e,this.failed=r}static ok(e){return new Ii(e,null)}static fail(e){return new Ii(null,e)}static fromReplace(e,r,n,i){try{return Ii.ok(e.replace(r,n,i))}catch(a){if(a instanceof Ex)return Ii.fail(a.message);throw a}}}function D_(t,e,r){let n=[];for(let i=0;i<t.childCount;i++){let a=t.child(i);a.content.size&&(a=a.copy(D_(a.content,e,a))),a.isInline&&(a=e(a,r,i)),n.push(a)}return it.fromArray(n)}class jd extends cs{constructor(e,r,n){super(),this.from=e,this.to=r,this.mark=n}apply(e){let r=e.slice(this.from,this.to),n=e.resolve(this.from),i=n.node(n.sharedDepth(this.to)),a=new Pt(D_(r.content,(s,o)=>!s.isAtom||!o.type.allowsMarkType(this.mark.type)?s:s.mark(this.mark.addToSet(s.marks)),i),r.openStart,r.openEnd);return Ii.fromReplace(e,this.from,this.to,a)}invert(){return new Ol(this.from,this.to,this.mark)}map(e){let r=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return r.deleted&&n.deleted||r.pos>=n.pos?null:new jd(r.pos,n.pos,this.mark)}merge(e){return e instanceof jd&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new jd(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,r){if(typeof r.from!="number"||typeof r.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new jd(r.from,r.to,e.markFromJSON(r.mark))}}cs.jsonID("addMark",jd);class Ol extends cs{constructor(e,r,n){super(),this.from=e,this.to=r,this.mark=n}apply(e){let r=e.slice(this.from,this.to),n=new Pt(D_(r.content,i=>i.mark(this.mark.removeFromSet(i.marks)),e),r.openStart,r.openEnd);return Ii.fromReplace(e,this.from,this.to,n)}invert(){return new jd(this.from,this.to,this.mark)}map(e){let r=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return r.deleted&&n.deleted||r.pos>=n.pos?null:new Ol(r.pos,n.pos,this.mark)}merge(e){return e instanceof Ol&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new Ol(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,r){if(typeof r.from!="number"||typeof r.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new Ol(r.from,r.to,e.markFromJSON(r.mark))}}cs.jsonID("removeMark",Ol);class Fd extends cs{constructor(e,r){super(),this.pos=e,this.mark=r}apply(e){let r=e.nodeAt(this.pos);if(!r)return Ii.fail("No node at mark step's position");let n=r.type.create(r.attrs,null,this.mark.addToSet(r.marks));return Ii.fromReplace(e,this.pos,this.pos+1,new Pt(it.from(n),0,r.isLeaf?0:1))}invert(e){let r=e.nodeAt(this.pos);if(r){let n=this.mark.addToSet(r.marks);if(n.length==r.marks.length){for(let i=0;i<r.marks.length;i++)if(!r.marks[i].isInSet(n))return new Fd(this.pos,r.marks[i]);return new Fd(this.pos,this.mark)}}return new Sh(this.pos,this.mark)}map(e){let r=e.mapResult(this.pos,1);return r.deletedAfter?null:new Fd(r.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,r){if(typeof r.pos!="number")throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new Fd(r.pos,e.markFromJSON(r.mark))}}cs.jsonID("addNodeMark",Fd);class Sh extends cs{constructor(e,r){super(),this.pos=e,this.mark=r}apply(e){let r=e.nodeAt(this.pos);if(!r)return Ii.fail("No node at mark step's position");let n=r.type.create(r.attrs,null,this.mark.removeFromSet(r.marks));return Ii.fromReplace(e,this.pos,this.pos+1,new Pt(it.from(n),0,r.isLeaf?0:1))}invert(e){let r=e.nodeAt(this.pos);return!r||!this.mark.isInSet(r.marks)?this:new Fd(this.pos,this.mark)}map(e){let r=e.mapResult(this.pos,1);return r.deletedAfter?null:new Sh(r.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,r){if(typeof r.pos!="number")throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new Sh(r.pos,e.markFromJSON(r.mark))}}cs.jsonID("removeNodeMark",Sh);class ha extends cs{constructor(e,r,n,i=!1){super(),this.from=e,this.to=r,this.slice=n,this.structure=i}apply(e){return this.structure&&hk(e,this.from,this.to)?Ii.fail("Structure replace would overwrite content"):Ii.fromReplace(e,this.from,this.to,this.slice)}getMap(){return new mo([this.from,this.to-this.from,this.slice.size])}invert(e){return new ha(this.from,this.from+this.slice.size,e.slice(this.from,this.to))}map(e){let r=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return r.deletedAcross&&n.deletedAcross?null:new ha(r.pos,Math.max(r.pos,n.pos),this.slice,this.structure)}merge(e){if(!(e instanceof ha)||e.structure||this.structure)return null;if(this.from+this.slice.size==e.from&&!this.slice.openEnd&&!e.slice.openStart){let r=this.slice.size+e.slice.size==0?Pt.empty:new Pt(this.slice.content.append(e.slice.content),this.slice.openStart,e.slice.openEnd);return new ha(this.from,this.to+(e.to-e.from),r,this.structure)}else if(e.to==this.from&&!this.slice.openStart&&!e.slice.openEnd){let r=this.slice.size+e.slice.size==0?Pt.empty:new Pt(e.slice.content.append(this.slice.content),e.slice.openStart,this.slice.openEnd);return new ha(e.from,this.to,r,this.structure)}else return null}toJSON(){let e={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,r){if(typeof r.from!="number"||typeof r.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new ha(r.from,r.to,Pt.fromJSON(e,r.slice),!!r.structure)}}cs.jsonID("replace",ha);class va extends cs{constructor(e,r,n,i,a,s,o=!1){super(),this.from=e,this.to=r,this.gapFrom=n,this.gapTo=i,this.slice=a,this.insert=s,this.structure=o}apply(e){if(this.structure&&(hk(e,this.from,this.gapFrom)||hk(e,this.gapTo,this.to)))return Ii.fail("Structure gap-replace would overwrite content");let r=e.slice(this.gapFrom,this.gapTo);if(r.openStart||r.openEnd)return Ii.fail("Gap is not a flat range");let n=this.slice.insertAt(this.insert,r.content);return n?Ii.fromReplace(e,this.from,this.to,n):Ii.fail("Content does not fit in gap")}getMap(){return new mo([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(e){let r=this.gapTo-this.gapFrom;return new va(this.from,this.from+this.slice.size+r,this.from+this.insert,this.from+this.insert+r,e.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(e){let r=e.mapResult(this.from,1),n=e.mapResult(this.to,-1),i=this.from==this.gapFrom?r.pos:e.map(this.gapFrom,-1),a=this.to==this.gapTo?n.pos:e.map(this.gapTo,1);return r.deletedAcross&&n.deletedAcross||i<r.pos||a>n.pos?null:new va(r.pos,n.pos,i,a,this.slice,this.insert,this.structure)}toJSON(){let e={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,r){if(typeof r.from!="number"||typeof r.to!="number"||typeof r.gapFrom!="number"||typeof r.gapTo!="number"||typeof r.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new va(r.from,r.to,r.gapFrom,r.gapTo,Pt.fromJSON(e,r.slice),r.insert,!!r.structure)}}cs.jsonID("replaceAround",va);function hk(t,e,r){let n=t.resolve(e),i=r-e,a=n.depth;for(;i>0&&a>0&&n.indexAfter(a)==n.node(a).childCount;)a--,i--;if(i>0){let s=n.node(a).maybeChild(n.indexAfter(a));for(;i>0;){if(!s||s.isLeaf)return!0;s=s.firstChild,i--}}return!1}function gZ(t,e,r,n){let i=[],a=[],s,o;t.doc.nodesBetween(e,r,(l,u,c)=>{if(!l.isInline)return;let f=l.marks;if(!n.isInSet(f)&&c.type.allowsMarkType(n.type)){let p=Math.max(u,e),v=Math.min(u+l.nodeSize,r),y=n.addToSet(f);for(let S=0;S<f.length;S++)f[S].isInSet(y)||(s&&s.to==p&&s.mark.eq(f[S])?s.to=v:i.push(s=new Ol(p,v,f[S])));o&&o.to==p?o.to=v:a.push(o=new jd(p,v,n))}}),i.forEach(l=>t.step(l)),a.forEach(l=>t.step(l))}function vZ(t,e,r,n){let i=[],a=0;t.doc.nodesBetween(e,r,(s,o)=>{if(!s.isInline)return;a++;let l=null;if(n instanceof W1){let u=s.marks,c;for(;c=n.isInSet(u);)(l||(l=[])).push(c),u=c.removeFromSet(u)}else n?n.isInSet(s.marks)&&(l=[n]):l=s.marks;if(l&&l.length){let u=Math.min(o+s.nodeSize,r);for(let c=0;c<l.length;c++){let f=l[c],p;for(let v=0;v<i.length;v++){let y=i[v];y.step==a-1&&f.eq(i[v].style)&&(p=y)}p?(p.to=u,p.step=a):i.push({style:f,from:Math.max(o,e),to:u,step:a})}}}),i.forEach(s=>t.step(new Ol(s.from,s.to,s.style)))}function I_(t,e,r,n=r.contentMatch,i=!0){let a=t.doc.nodeAt(e),s=[],o=e+1;for(let l=0;l<a.childCount;l++){let u=a.child(l),c=o+u.nodeSize,f=n.matchType(u.type);if(!f)s.push(new ha(o,c,Pt.empty));else{n=f;for(let p=0;p<u.marks.length;p++)r.allowsMarkType(u.marks[p].type)||t.step(new Ol(o,c,u.marks[p]));if(i&&u.isText&&r.whitespace!="pre"){let p,v=/\r?\n|\r/g,y;for(;p=v.exec(u.text);)y||(y=new Pt(it.from(r.schema.text(" ",r.allowedMarks(u.marks))),0,0)),s.push(new ha(o+p.index,o+p.index+p[0].length,y))}}o=c}if(!n.validEnd){let l=n.fillBefore(it.empty,!0);t.replace(o,o,new Pt(l,0,0))}for(let l=s.length-1;l>=0;l--)t.step(s[l])}function yZ(t,e,r){return(e==0||t.canReplace(e,t.childCount))&&(r==t.childCount||t.canReplace(0,r))}function vm(t){let r=t.parent.content.cutByIndex(t.startIndex,t.endIndex);for(let n=t.depth,i=0,a=0;;--n){let s=t.$from.node(n),o=t.$from.index(n)+i,l=t.$to.indexAfter(n)-a;if(n<t.depth&&s.canReplace(o,l,r))return n;if(n==0||s.type.spec.isolating||!yZ(s,o,l))break;o&&(i=1),l<s.childCount&&(a=1)}return null}function xZ(t,e,r){let{$from:n,$to:i,depth:a}=e,s=n.before(a+1),o=i.after(a+1),l=s,u=o,c=it.empty,f=0;for(let y=a,S=!1;y>r;y--)S||n.index(y)>0?(S=!0,c=it.from(n.node(y).copy(c)),f++):l--;let p=it.empty,v=0;for(let y=a,S=!1;y>r;y--)S||i.after(y+1)<i.end(y)?(S=!0,p=it.from(i.node(y).copy(p)),v++):u++;t.step(new va(l,u,s,o,new Pt(c.append(p),f,v),c.size-f,!0))}function j_(t,e,r=null,n=t){let i=bZ(t,e),a=i&&wZ(n,e);return a?i.map(x3).concat({type:e,attrs:r}).concat(a.map(x3)):null}function x3(t){return{type:t,attrs:null}}function bZ(t,e){let{parent:r,startIndex:n,endIndex:i}=t,a=r.contentMatchAt(n).findWrapping(e);if(!a)return null;let s=a.length?a[0]:e;return r.canReplaceWith(n,i,s)?a:null}function wZ(t,e){let{parent:r,startIndex:n,endIndex:i}=t,a=r.child(n),s=e.contentMatch.findWrapping(a.type);if(!s)return null;let l=(s.length?s[s.length-1]:e).contentMatch;for(let u=n;l&&u<i;u++)l=l.matchType(r.child(u).type);return!l||!l.validEnd?null:s}function SZ(t,e,r){let n=it.empty;for(let s=r.length-1;s>=0;s--){if(n.size){let o=r[s].type.contentMatch.matchFragment(n);if(!o||!o.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}n=it.from(r[s].type.create(r[s].attrs,n))}let i=e.start,a=e.end;t.step(new va(i,a,i,a,new Pt(n,0,0),r.length,!0))}function kZ(t,e,r,n,i){if(!n.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let a=t.steps.length;t.doc.nodesBetween(e,r,(s,o)=>{let l=typeof i=="function"?i(s):i;if(s.isTextblock&&!s.hasMarkup(n,l)&&_Z(t.doc,t.mapping.slice(a).map(o),n)){let u=null;if(n.schema.linebreakReplacement){let v=n.whitespace=="pre",y=!!n.contentMatch.matchType(n.schema.linebreakReplacement);v&&!y?u=!1:!v&&y&&(u=!0)}u===!1&&VL(t,s,o,a),I_(t,t.mapping.slice(a).map(o,1),n,void 0,u===null);let c=t.mapping.slice(a),f=c.map(o,1),p=c.map(o+s.nodeSize,1);return t.step(new va(f,p,f+1,p-1,new Pt(it.from(n.create(l,null,s.marks)),0,0),1,!0)),u===!0&&GL(t,s,o,a),!1}})}function GL(t,e,r,n){e.forEach((i,a)=>{if(i.isText){let s,o=/\r?\n|\r/g;for(;s=o.exec(i.text);){let l=t.mapping.slice(n).map(r+1+a+s.index);t.replaceWith(l,l+1,e.type.schema.linebreakReplacement.create())}}})}function VL(t,e,r,n){e.forEach((i,a)=>{if(i.type==i.type.schema.linebreakReplacement){let s=t.mapping.slice(n).map(r+1+a);t.replaceWith(s,s+1,e.type.schema.text(`
`))}})}function _Z(t,e,r){let n=t.resolve(e),i=n.index();return n.parent.canReplaceWith(i,i+1,r)}function CZ(t,e,r,n,i){let a=t.doc.nodeAt(e);if(!a)throw new RangeError("No node at given position");r||(r=a.type);let s=r.create(n,null,i||a.marks);if(a.isLeaf)return t.replaceWith(e,e+a.nodeSize,s);if(!r.validContent(a.content))throw new RangeError("Invalid content for node type "+r.name);t.step(new va(e,e+a.nodeSize,e+1,e+a.nodeSize-1,new Pt(it.from(s),0,0),1,!0))}function mc(t,e,r=1,n){let i=t.resolve(e),a=i.depth-r,s=n&&n[n.length-1]||i.parent;if(a<0||i.parent.type.spec.isolating||!i.parent.canReplace(i.index(),i.parent.childCount)||!s.type.validContent(i.parent.content.cutByIndex(i.index(),i.parent.childCount)))return!1;for(let u=i.depth-1,c=r-2;u>a;u--,c--){let f=i.node(u),p=i.index(u);if(f.type.spec.isolating)return!1;let v=f.content.cutByIndex(p,f.childCount),y=n&&n[c+1];y&&(v=v.replaceChild(0,y.type.create(y.attrs)));let S=n&&n[c]||f;if(!f.canReplace(p+1,f.childCount)||!S.type.validContent(v))return!1}let o=i.indexAfter(a),l=n&&n[0];return i.node(a).canReplaceWith(o,o,l?l.type:i.node(a+1).type)}function EZ(t,e,r=1,n){let i=t.doc.resolve(e),a=it.empty,s=it.empty;for(let o=i.depth,l=i.depth-r,u=r-1;o>l;o--,u--){a=it.from(i.node(o).copy(a));let c=n&&n[u];s=it.from(c?c.type.create(c.attrs,s):i.node(o).copy(s))}t.step(new ha(e,e,new Pt(a.append(s),r,r),!0))}function hf(t,e){let r=t.resolve(e),n=r.index();return HL(r.nodeBefore,r.nodeAfter)&&r.parent.canReplace(n,n+1)}function TZ(t,e){e.content.size||t.type.compatibleContent(e.type);let r=t.contentMatchAt(t.childCount),{linebreakReplacement:n}=t.type.schema;for(let i=0;i<e.childCount;i++){let a=e.child(i),s=a.type==n?t.type.schema.nodes.text:a.type;if(r=r.matchType(s),!r||!t.type.allowsMarks(a.marks))return!1}return r.validEnd}function HL(t,e){return!!(t&&e&&!t.isLeaf&&TZ(t,e))}function q1(t,e,r=-1){let n=t.resolve(e);for(let i=n.depth;;i--){let a,s,o=n.index(i);if(i==n.depth?(a=n.nodeBefore,s=n.nodeAfter):r>0?(a=n.node(i+1),o++,s=n.node(i).maybeChild(o)):(a=n.node(i).maybeChild(o-1),s=n.node(i+1)),a&&!a.isTextblock&&HL(a,s)&&n.node(i).canReplace(o,o+1))return e;if(i==0)break;e=r<0?n.before(i):n.after(i)}}function NZ(t,e,r){let n=null,{linebreakReplacement:i}=t.doc.type.schema,a=t.doc.resolve(e-r),s=a.node().type;if(i&&s.inlineContent){let c=s.whitespace=="pre",f=!!s.contentMatch.matchType(i);c&&!f?n=!1:!c&&f&&(n=!0)}let o=t.steps.length;if(n===!1){let c=t.doc.resolve(e+r);VL(t,c.node(),c.before(),o)}s.inlineContent&&I_(t,e+r-1,s,a.node().contentMatchAt(a.index()),n==null);let l=t.mapping.slice(o),u=l.map(e-r);if(t.step(new ha(u,l.map(e+r,-1),Pt.empty,!0)),n===!0){let c=t.doc.resolve(u);GL(t,c.node(),c.before(),t.steps.length)}return t}function PZ(t,e,r){let n=t.resolve(e);if(n.parent.canReplaceWith(n.index(),n.index(),r))return e;if(n.parentOffset==0)for(let i=n.depth-1;i>=0;i--){let a=n.index(i);if(n.node(i).canReplaceWith(a,a,r))return n.before(i+1);if(a>0)return null}if(n.parentOffset==n.parent.content.size)for(let i=n.depth-1;i>=0;i--){let a=n.indexAfter(i);if(n.node(i).canReplaceWith(a,a,r))return n.after(i+1);if(a<n.node(i).childCount)return null}return null}function WL(t,e,r){let n=t.resolve(e);if(!r.content.size)return e;let i=r.content;for(let a=0;a<r.openStart;a++)i=i.firstChild.content;for(let a=1;a<=(r.openStart==0&&r.size?2:1);a++)for(let s=n.depth;s>=0;s--){let o=s==n.depth?0:n.pos<=(n.start(s+1)+n.end(s+1))/2?-1:1,l=n.index(s)+(o>0?1:0),u=n.node(s),c=!1;if(a==1)c=u.canReplace(l,l,i);else{let f=u.contentMatchAt(l).findWrapping(i.firstChild.type);c=f&&u.canReplaceWith(l,l,f[0])}if(c)return o==0?n.pos:o<0?n.before(s+1):n.after(s+1)}return null}function $1(t,e,r=e,n=Pt.empty){if(e==r&&!n.size)return null;let i=t.resolve(e),a=t.resolve(r);return qL(i,a,n)?new ha(e,r,n):new MZ(i,a,n).fit()}function qL(t,e,r){return!r.openStart&&!r.openEnd&&t.start()==e.start()&&t.parent.canReplace(t.index(),e.index(),r.content)}class MZ{constructor(e,r,n){this.$from=e,this.$to=r,this.unplaced=n,this.frontier=[],this.placed=it.empty;for(let i=0;i<=e.depth;i++){let a=e.node(i);this.frontier.push({type:a.type,match:a.contentMatchAt(e.indexAfter(i))})}for(let i=e.depth;i>0;i--)this.placed=it.from(e.node(i).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let u=this.findFittable();u?this.placeNodes(u):this.openMore()||this.dropNode()}let e=this.mustMoveInline(),r=this.placed.size-this.depth-this.$from.depth,n=this.$from,i=this.close(e<0?this.$to:n.doc.resolve(e));if(!i)return null;let a=this.placed,s=n.depth,o=i.depth;for(;s&&o&&a.childCount==1;)a=a.firstChild.content,s--,o--;let l=new Pt(a,s,o);return e>-1?new va(n.pos,e,this.$to.pos,this.$to.end(),l,r):l.size||n.pos!=this.$to.pos?new ha(n.pos,i.pos,l):null}findFittable(){let e=this.unplaced.openStart;for(let r=this.unplaced.content,n=0,i=this.unplaced.openEnd;n<e;n++){let a=r.firstChild;if(r.childCount>1&&(i=0),a.type.spec.isolating&&i<=n){e=n;break}r=a.content}for(let r=1;r<=2;r++)for(let n=r==1?e:this.unplaced.openStart;n>=0;n--){let i,a=null;n?(a=Q2(this.unplaced.content,n-1).firstChild,i=a.content):i=this.unplaced.content;let s=i.firstChild;for(let o=this.depth;o>=0;o--){let{type:l,match:u}=this.frontier[o],c,f=null;if(r==1&&(s?u.matchType(s.type)||(f=u.fillBefore(it.from(s),!1)):a&&l.compatibleContent(a.type)))return{sliceDepth:n,frontierDepth:o,parent:a,inject:f};if(r==2&&s&&(c=u.findWrapping(s.type)))return{sliceDepth:n,frontierDepth:o,parent:a,wrap:c};if(a&&u.matchType(a.type))break}}}openMore(){let{content:e,openStart:r,openEnd:n}=this.unplaced,i=Q2(e,r);return!i.childCount||i.firstChild.isLeaf?!1:(this.unplaced=new Pt(e,r+1,Math.max(n,i.size+r>=e.size-n?r+1:0)),!0)}dropNode(){let{content:e,openStart:r,openEnd:n}=this.unplaced,i=Q2(e,r);if(i.childCount<=1&&r>0){let a=e.size-r<=r+i.size;this.unplaced=new Pt(Zg(e,r-1,1),r-1,a?r-1:n)}else this.unplaced=new Pt(Zg(e,r,1),r,n)}placeNodes({sliceDepth:e,frontierDepth:r,parent:n,inject:i,wrap:a}){for(;this.depth>r;)this.closeFrontierNode();if(a)for(let S=0;S<a.length;S++)this.openFrontierNode(a[S]);let s=this.unplaced,o=n?n.content:s.content,l=s.openStart-e,u=0,c=[],{match:f,type:p}=this.frontier[r];if(i){for(let S=0;S<i.childCount;S++)c.push(i.child(S));f=f.matchFragment(i)}let v=o.size+e-(s.content.size-s.openEnd);for(;u<o.childCount;){let S=o.child(u),w=f.matchType(S.type);if(!w)break;u++,(u>1||l==0||S.content.size)&&(f=w,c.push($L(S.mark(p.allowedMarks(S.marks)),u==1?l:0,u==o.childCount?v:-1)))}let y=u==o.childCount;y||(v=-1),this.placed=Yg(this.placed,r,it.from(c)),this.frontier[r].match=f,y&&v<0&&n&&n.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let S=0,w=o;S<v;S++){let E=w.lastChild;this.frontier.push({type:E.type,match:E.contentMatchAt(E.childCount)}),w=E.content}this.unplaced=y?e==0?Pt.empty:new Pt(Zg(s.content,e-1,1),e-1,v<0?s.openEnd:e-1):new Pt(Zg(s.content,e,u),s.openStart,s.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let e=this.frontier[this.depth],r;if(!e.type.isTextblock||!J2(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(r=this.findCloseLevel(this.$to))&&r.depth==this.depth)return-1;let{depth:n}=this.$to,i=this.$to.after(n);for(;n>1&&i==this.$to.end(--n);)++i;return i}findCloseLevel(e){e:for(let r=Math.min(this.depth,e.depth);r>=0;r--){let{match:n,type:i}=this.frontier[r],a=r<e.depth&&e.end(r+1)==e.pos+(e.depth-(r+1)),s=J2(e,r,i,n,a);if(s){for(let o=r-1;o>=0;o--){let{match:l,type:u}=this.frontier[o],c=J2(e,o,u,l,!0);if(!c||c.childCount)continue e}return{depth:r,fit:s,move:a?e.doc.resolve(e.after(r+1)):e}}}}close(e){let r=this.findCloseLevel(e);if(!r)return null;for(;this.depth>r.depth;)this.closeFrontierNode();r.fit.childCount&&(this.placed=Yg(this.placed,r.depth,r.fit)),e=r.move;for(let n=r.depth+1;n<=e.depth;n++){let i=e.node(n),a=i.type.contentMatch.fillBefore(i.content,!0,e.index(n));this.openFrontierNode(i.type,i.attrs,a)}return e}openFrontierNode(e,r=null,n){let i=this.frontier[this.depth];i.match=i.match.matchType(e),this.placed=Yg(this.placed,this.depth,it.from(e.create(r,n))),this.frontier.push({type:e,match:e.contentMatch})}closeFrontierNode(){let r=this.frontier.pop().match.fillBefore(it.empty,!0);r.childCount&&(this.placed=Yg(this.placed,this.frontier.length,r))}}function Zg(t,e,r){return e==0?t.cutByIndex(r,t.childCount):t.replaceChild(0,t.firstChild.copy(Zg(t.firstChild.content,e-1,r)))}function Yg(t,e,r){return e==0?t.append(r):t.replaceChild(t.childCount-1,t.lastChild.copy(Yg(t.lastChild.content,e-1,r)))}function Q2(t,e){for(let r=0;r<e;r++)t=t.firstChild.content;return t}function $L(t,e,r){if(e<=0)return t;let n=t.content;return e>1&&(n=n.replaceChild(0,$L(n.firstChild,e-1,n.childCount==1?r-1:0))),e>0&&(n=t.type.contentMatch.fillBefore(n).append(n),r<=0&&(n=n.append(t.type.contentMatch.matchFragment(n).fillBefore(it.empty,!0)))),t.copy(n)}function J2(t,e,r,n,i){let a=t.node(e),s=i?t.indexAfter(e):t.index(e);if(s==a.childCount&&!r.compatibleContent(a.type))return null;let o=n.fillBefore(a.content,!0,s);return o&&!AZ(r,a.content,s)?o:null}function AZ(t,e,r){for(let n=r;n<e.childCount;n++)if(!t.allowsMarks(e.child(n).marks))return!0;return!1}function RZ(t){return t.spec.defining||t.spec.definingForContent}function LZ(t,e,r,n){if(!n.size)return t.deleteRange(e,r);let i=t.doc.resolve(e),a=t.doc.resolve(r);if(qL(i,a,n))return t.step(new ha(e,r,n));let s=ZL(i,a);s[s.length-1]==0&&s.pop();let o=-(i.depth+1);s.unshift(o);for(let p=i.depth,v=i.pos-1;p>0;p--,v--){let y=i.node(p).type.spec;if(y.defining||y.definingAsContext||y.isolating)break;s.indexOf(p)>-1?o=p:i.before(p)==v&&s.splice(1,0,-p)}let l=s.indexOf(o),u=[],c=n.openStart;for(let p=n.content,v=0;;v++){let y=p.firstChild;if(u.push(y),v==n.openStart)break;p=y.content}for(let p=c-1;p>=0;p--){let v=u[p],y=RZ(v.type);if(y&&!v.sameMarkup(i.node(Math.abs(o)-1)))c=p;else if(y||!v.type.isTextblock)break}for(let p=n.openStart;p>=0;p--){let v=(p+c+1)%(n.openStart+1),y=u[v];if(y)for(let S=0;S<s.length;S++){let w=s[(S+l)%s.length],E=!0;w<0&&(E=!1,w=-w);let _=i.node(w-1),T=i.index(w-1);if(_.canReplaceWith(T,T,y.type,y.marks))return t.replace(i.before(w),E?a.after(w):r,new Pt(KL(n.content,0,n.openStart,v),v,n.openEnd))}}let f=t.steps.length;for(let p=s.length-1;p>=0&&(t.replace(e,r,n),!(t.steps.length>f));p--){let v=s[p];v<0||(e=i.before(v),r=a.after(v))}}function KL(t,e,r,n,i){if(e<r){let a=t.firstChild;t=t.replaceChild(0,a.copy(KL(a.content,e+1,r,n,a)))}if(e>n){let a=i.contentMatchAt(0),s=a.fillBefore(t).append(t);t=s.append(a.matchFragment(s).fillBefore(it.empty,!0))}return t}function OZ(t,e,r,n){if(!n.isInline&&e==r&&t.doc.resolve(e).parent.content.size){let i=PZ(t.doc,e,n.type);i!=null&&(e=r=i)}t.replaceRange(e,r,new Pt(it.from(n),0,0))}function DZ(t,e,r){let n=t.doc.resolve(e),i=t.doc.resolve(r),a=ZL(n,i);for(let s=0;s<a.length;s++){let o=a[s],l=s==a.length-1;if(l&&o==0||n.node(o).type.contentMatch.validEnd)return t.delete(n.start(o),i.end(o));if(o>0&&(l||n.node(o-1).canReplace(n.index(o-1),i.indexAfter(o-1))))return t.delete(n.before(o),i.after(o))}for(let s=1;s<=n.depth&&s<=i.depth;s++)if(e-n.start(s)==n.depth-s&&r>n.end(s)&&i.end(s)-r!=i.depth-s&&n.start(s-1)==i.start(s-1)&&n.node(s-1).canReplace(n.index(s-1),i.index(s-1)))return t.delete(n.before(s),r);t.delete(e,r)}function ZL(t,e){let r=[],n=Math.min(t.depth,e.depth);for(let i=n;i>=0;i--){let a=t.start(i);if(a<t.pos-(t.depth-i)||e.end(i)>e.pos+(e.depth-i)||t.node(i).type.spec.isolating||e.node(i).type.spec.isolating)break;(a==e.start(i)||i==t.depth&&i==e.depth&&t.parent.inlineContent&&e.parent.inlineContent&&i&&e.start(i-1)==a-1)&&r.push(i)}return r}class Gp extends cs{constructor(e,r,n){super(),this.pos=e,this.attr=r,this.value=n}apply(e){let r=e.nodeAt(this.pos);if(!r)return Ii.fail("No node at attribute step's position");let n=Object.create(null);for(let a in r.attrs)n[a]=r.attrs[a];n[this.attr]=this.value;let i=r.type.create(n,null,r.marks);return Ii.fromReplace(e,this.pos,this.pos+1,new Pt(it.from(i),0,r.isLeaf?0:1))}getMap(){return mo.empty}invert(e){return new Gp(this.pos,this.attr,e.nodeAt(this.pos).attrs[this.attr])}map(e){let r=e.mapResult(this.pos,1);return r.deletedAfter?null:new Gp(r.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(e,r){if(typeof r.pos!="number"||typeof r.attr!="string")throw new RangeError("Invalid input for AttrStep.fromJSON");return new Gp(r.pos,r.attr,r.value)}}cs.jsonID("attr",Gp);class Iv extends cs{constructor(e,r){super(),this.attr=e,this.value=r}apply(e){let r=Object.create(null);for(let i in e.attrs)r[i]=e.attrs[i];r[this.attr]=this.value;let n=e.type.create(r,e.content,e.marks);return Ii.ok(n)}getMap(){return mo.empty}invert(e){return new Iv(this.attr,e.attrs[this.attr])}map(e){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(e,r){if(typeof r.attr!="string")throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new Iv(r.attr,r.value)}}cs.jsonID("docAttr",Iv);let Zp=class extends Error{};Zp=function t(e){let r=Error.call(this,e);return r.__proto__=t.prototype,r};Zp.prototype=Object.create(Error.prototype);Zp.prototype.constructor=Zp;Zp.prototype.name="TransformError";class YL{constructor(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new Dv}get before(){return this.docs.length?this.docs[0]:this.doc}step(e){let r=this.maybeStep(e);if(r.failed)throw new Zp(r.failed);return this}maybeStep(e){let r=e.apply(this.doc);return r.failed||this.addStep(e,r.doc),r}get docChanged(){return this.steps.length>0}changedRange(){let e=1e9,r=-1e9;for(let n=0;n<this.mapping.maps.length;n++){let i=this.mapping.maps[n];n&&(e=i.map(e,1),r=i.map(r,-1)),i.forEach((a,s,o,l)=>{e=Math.min(e,o),r=Math.max(r,l)})}return e==1e9?null:{from:e,to:r}}addStep(e,r){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=r}replace(e,r=e,n=Pt.empty){let i=$1(this.doc,e,r,n);return i&&this.step(i),this}replaceWith(e,r,n){return this.replace(e,r,new Pt(it.from(n),0,0))}delete(e,r){return this.replace(e,r,Pt.empty)}insert(e,r){return this.replaceWith(e,e,r)}replaceRange(e,r,n){return LZ(this,e,r,n),this}replaceRangeWith(e,r,n){return OZ(this,e,r,n),this}deleteRange(e,r){return DZ(this,e,r),this}lift(e,r){return xZ(this,e,r),this}join(e,r=1){return NZ(this,e,r),this}wrap(e,r){return SZ(this,e,r),this}setBlockType(e,r=e,n,i=null){return kZ(this,e,r,n,i),this}setNodeMarkup(e,r,n=null,i){return CZ(this,e,r,n,i),this}setNodeAttribute(e,r,n){return this.step(new Gp(e,r,n)),this}setDocAttribute(e,r){return this.step(new Iv(e,r)),this}addNodeMark(e,r){return this.step(new Fd(e,r)),this}removeNodeMark(e,r){let n=this.doc.nodeAt(e);if(!n)throw new RangeError("No node at position "+e);if(r instanceof wn)r.isInSet(n.marks)&&this.step(new Sh(e,r));else{let i=n.marks,a,s=[];for(;a=r.isInSet(i);)s.push(new Sh(e,a)),i=a.removeFromSet(i);for(let o=s.length-1;o>=0;o--)this.step(s[o])}return this}split(e,r=1,n){return EZ(this,e,r,n),this}addMark(e,r,n){return gZ(this,e,r,n),this}removeMark(e,r,n){return vZ(this,e,r,n),this}clearIncompatible(e,r,n){return I_(this,e,r,n),this}}const eS=Object.create(null);class Sr{constructor(e,r,n){this.$anchor=e,this.$head=r,this.ranges=n||[new IZ(e.min(r),e.max(r))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let r=0;r<e.length;r++)if(e[r].$from.pos!=e[r].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,r=Pt.empty){let n=r.content.lastChild,i=null;for(let o=0;o<r.openEnd;o++)i=n,n=n.lastChild;let a=e.steps.length,s=this.ranges;for(let o=0;o<s.length;o++){let{$from:l,$to:u}=s[o],c=e.mapping.slice(a);e.replaceRange(c.map(l.pos),c.map(u.pos),o?Pt.empty:r),o==0&&S3(e,a,(n?n.isInline:i&&i.isTextblock)?-1:1)}}replaceWith(e,r){let n=e.steps.length,i=this.ranges;for(let a=0;a<i.length;a++){let{$from:s,$to:o}=i[a],l=e.mapping.slice(n),u=l.map(s.pos),c=l.map(o.pos);a?e.deleteRange(u,c):(e.replaceRangeWith(u,c,r),S3(e,n,r.isInline?-1:1))}}static findFrom(e,r,n=!1){let i=e.parent.inlineContent?new dr(e):Tp(e.node(0),e.parent,e.pos,e.index(),r,n);if(i)return i;for(let a=e.depth-1;a>=0;a--){let s=r<0?Tp(e.node(0),e.node(a),e.before(a+1),e.index(a),r,n):Tp(e.node(0),e.node(a),e.after(a+1),e.index(a)+1,r,n);if(s)return s}return null}static near(e,r=1){return this.findFrom(e,r)||this.findFrom(e,-r)||new vo(e.node(0))}static atStart(e){return Tp(e,e,0,0,1)||new vo(e)}static atEnd(e){return Tp(e,e,e.content.size,e.childCount,-1)||new vo(e)}static fromJSON(e,r){if(!r||!r.type)throw new RangeError("Invalid input for Selection.fromJSON");let n=eS[r.type];if(!n)throw new RangeError(`No selection type ${r.type} defined`);return n.fromJSON(e,r)}static jsonID(e,r){if(e in eS)throw new RangeError("Duplicate use of selection JSON ID "+e);return eS[e]=r,r.prototype.jsonID=e,r}getBookmark(){return dr.between(this.$anchor,this.$head).getBookmark()}}Sr.prototype.visible=!0;class IZ{constructor(e,r){this.$from=e,this.$to=r}}let b3=!1;function w3(t){!b3&&!t.parent.inlineContent&&(b3=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+t.parent.type.name+")"))}class dr extends Sr{constructor(e,r=e){w3(e),w3(r),super(e,r)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(e,r){let n=e.resolve(r.map(this.head));if(!n.parent.inlineContent)return Sr.near(n);let i=e.resolve(r.map(this.anchor));return new dr(i.parent.inlineContent?i:n,n)}replace(e,r=Pt.empty){if(super.replace(e,r),r==Pt.empty){let n=this.$from.marksAcross(this.$to);n&&e.ensureMarks(n)}}eq(e){return e instanceof dr&&e.anchor==this.anchor&&e.head==this.head}getBookmark(){return new K1(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(e,r){if(typeof r.anchor!="number"||typeof r.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new dr(e.resolve(r.anchor),e.resolve(r.head))}static create(e,r,n=r){let i=e.resolve(r);return new this(i,n==r?i:e.resolve(n))}static between(e,r,n){let i=e.pos-r.pos;if((!n||i)&&(n=i>=0?1:-1),!r.parent.inlineContent){let a=Sr.findFrom(r,n,!0)||Sr.findFrom(r,-n,!0);if(a)r=a.$head;else return Sr.near(r,n)}return e.parent.inlineContent||(i==0?e=r:(e=(Sr.findFrom(e,-n,!0)||Sr.findFrom(e,n,!0)).$anchor,e.pos<r.pos!=i<0&&(e=r))),new dr(e,r)}}Sr.jsonID("text",dr);class K1{constructor(e,r){this.anchor=e,this.head=r}map(e){return new K1(e.map(this.anchor),e.map(this.head))}resolve(e){return dr.between(e.resolve(this.anchor),e.resolve(this.head))}}class Xt extends Sr{constructor(e){let r=e.nodeAfter,n=e.node(0).resolve(e.pos+r.nodeSize);super(e,n),this.node=r}map(e,r){let{deleted:n,pos:i}=r.mapResult(this.anchor),a=e.resolve(i);return n?Sr.near(a):new Xt(a)}content(){return new Pt(it.from(this.node),0,0)}eq(e){return e instanceof Xt&&e.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new F_(this.anchor)}static fromJSON(e,r){if(typeof r.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new Xt(e.resolve(r.anchor))}static create(e,r){return new Xt(e.resolve(r))}static isSelectable(e){return!e.isText&&e.type.spec.selectable!==!1}}Xt.prototype.visible=!1;Sr.jsonID("node",Xt);class F_{constructor(e){this.anchor=e}map(e){let{deleted:r,pos:n}=e.mapResult(this.anchor);return r?new K1(n,n):new F_(n)}resolve(e){let r=e.resolve(this.anchor),n=r.nodeAfter;return n&&Xt.isSelectable(n)?new Xt(r):Sr.near(r)}}class vo extends Sr{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,r=Pt.empty){if(r==Pt.empty){e.delete(0,e.doc.content.size);let n=Sr.atStart(e.doc);n.eq(e.selection)||e.setSelection(n)}else super.replace(e,r)}toJSON(){return{type:"all"}}static fromJSON(e){return new vo(e)}map(e){return new vo(e)}eq(e){return e instanceof vo}getBookmark(){return jZ}}Sr.jsonID("all",vo);const jZ={map(){return this},resolve(t){return new vo(t)}};function Tp(t,e,r,n,i,a=!1){if(e.inlineContent)return dr.create(t,r);for(let s=n-(i>0?0:1);i>0?s<e.childCount:s>=0;s+=i){let o=e.child(s);if(o.isAtom){if(!a&&Xt.isSelectable(o))return Xt.create(t,r-(i<0?o.nodeSize:0))}else{let l=Tp(t,o,r+i,i<0?o.childCount:0,i,a);if(l)return l}r+=o.nodeSize*i}return null}function S3(t,e,r){let n=t.steps.length-1;if(n<e)return;let i=t.steps[n];if(!(i instanceof ha||i instanceof va))return;let a=t.mapping.maps[n],s;a.forEach((o,l,u,c)=>{s==null&&(s=c)}),t.setSelection(Sr.near(t.doc.resolve(s),r))}const k3=1,wy=2,_3=4;class FZ extends YL{constructor(e){super(e.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=e.selection,this.storedMarks=e.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(e){if(e.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=e,this.curSelectionFor=this.steps.length,this.updated=(this.updated|k3)&~wy,this.storedMarks=null,this}get selectionSet(){return(this.updated&k3)>0}setStoredMarks(e){return this.storedMarks=e,this.updated|=wy,this}ensureMarks(e){return wn.sameSet(this.storedMarks||this.selection.$from.marks(),e)||this.setStoredMarks(e),this}addStoredMark(e){return this.ensureMarks(e.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(e){return this.ensureMarks(e.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(this.updated&wy)>0}addStep(e,r){super.addStep(e,r),this.updated=this.updated&~wy,this.storedMarks=null}setTime(e){return this.time=e,this}replaceSelection(e){return this.selection.replace(this,e),this}replaceSelectionWith(e,r=!0){let n=this.selection;return r&&(e=e.mark(this.storedMarks||(n.empty?n.$from.marks():n.$from.marksAcross(n.$to)||wn.none))),n.replaceWith(this,e),this}deleteSelection(){return this.selection.replace(this),this}insertText(e,r,n){let i=this.doc.type.schema;if(r==null)return e?this.replaceSelectionWith(i.text(e),!0):this.deleteSelection();{if(n==null&&(n=r),!e)return this.deleteRange(r,n);let a=this.storedMarks;if(!a){let s=this.doc.resolve(r);a=n==r?s.marks():s.marksAcross(this.doc.resolve(n))}return this.replaceRangeWith(r,n,i.text(e,a)),!this.selection.empty&&this.selection.to==r+e.length&&this.setSelection(Sr.near(this.selection.$to)),this}}setMeta(e,r){return this.meta[typeof e=="string"?e:e.key]=r,this}getMeta(e){return this.meta[typeof e=="string"?e:e.key]}get isGeneric(){for(let e in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=_3,this}get scrolledIntoView(){return(this.updated&_3)>0}}function C3(t,e){return!e||!t?t:t.bind(e)}class Xg{constructor(e,r,n){this.name=e,this.init=C3(r.init,n),this.apply=C3(r.apply,n)}}const BZ=[new Xg("doc",{init(t){return t.doc||t.schema.topNodeType.createAndFill()},apply(t){return t.doc}}),new Xg("selection",{init(t,e){return t.selection||Sr.atStart(e.doc)},apply(t){return t.selection}}),new Xg("storedMarks",{init(t){return t.storedMarks||null},apply(t,e,r,n){return n.selection.$cursor?t.storedMarks:null}}),new Xg("scrollToSelection",{init(){return 0},apply(t,e){return t.scrolledIntoView?e+1:e}})];class tS{constructor(e,r){this.schema=e,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=BZ.slice(),r&&r.forEach(n=>{if(this.pluginsByKey[n.key])throw new RangeError("Adding different instances of a keyed plugin ("+n.key+")");this.plugins.push(n),this.pluginsByKey[n.key]=n,n.spec.state&&this.fields.push(new Xg(n.key,n.spec.state,n))})}}class Dp{constructor(e){this.config=e}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(e){return this.applyTransaction(e).state}filterTransaction(e,r=-1){for(let n=0;n<this.config.plugins.length;n++)if(n!=r){let i=this.config.plugins[n];if(i.spec.filterTransaction&&!i.spec.filterTransaction.call(i,e,this))return!1}return!0}applyTransaction(e){if(!this.filterTransaction(e))return{state:this,transactions:[]};let r=[e],n=this.applyInner(e),i=null;for(;;){let a=!1;for(let s=0;s<this.config.plugins.length;s++){let o=this.config.plugins[s];if(o.spec.appendTransaction){let l=i?i[s].n:0,u=i?i[s].state:this,c=l<r.length&&o.spec.appendTransaction.call(o,l?r.slice(l):r,u,n);if(c&&n.filterTransaction(c,s)){if(c.setMeta("appendedTransaction",e),!i){i=[];for(let f=0;f<this.config.plugins.length;f++)i.push(f<s?{state:n,n:r.length}:{state:this,n:0})}r.push(c),n=n.applyInner(c),a=!0}i&&(i[s]={state:n,n:r.length})}}if(!a)return{state:n,transactions:r}}}applyInner(e){if(!e.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");let r=new Dp(this.config),n=this.config.fields;for(let i=0;i<n.length;i++){let a=n[i];r[a.name]=a.apply(e,this[a.name],this,r)}return r}get tr(){return new FZ(this)}static create(e){let r=new tS(e.doc?e.doc.type.schema:e.schema,e.plugins),n=new Dp(r);for(let i=0;i<r.fields.length;i++)n[r.fields[i].name]=r.fields[i].init(e,n);return n}reconfigure(e){let r=new tS(this.schema,e.plugins),n=r.fields,i=new Dp(r);for(let a=0;a<n.length;a++){let s=n[a].name;i[s]=this.hasOwnProperty(s)?this[s]:n[a].init(e,i)}return i}toJSON(e){let r={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(r.storedMarks=this.storedMarks.map(n=>n.toJSON())),e&&typeof e=="object")for(let n in e){if(n=="doc"||n=="selection")throw new RangeError("The JSON fields `doc` and `selection` are reserved");let i=e[n],a=i.spec.state;a&&a.toJSON&&(r[n]=a.toJSON.call(i,this[i.key]))}return r}static fromJSON(e,r,n){if(!r)throw new RangeError("Invalid input for EditorState.fromJSON");if(!e.schema)throw new RangeError("Required config field 'schema' missing");let i=new tS(e.schema,e.plugins),a=new Dp(i);return i.fields.forEach(s=>{if(s.name=="doc")a.doc=Xo.fromJSON(e.schema,r.doc);else if(s.name=="selection")a.selection=Sr.fromJSON(a.doc,r.selection);else if(s.name=="storedMarks")r.storedMarks&&(a.storedMarks=r.storedMarks.map(e.schema.markFromJSON));else{if(n)for(let o in n){let l=n[o],u=l.spec.state;if(l.key==s.name&&u&&u.fromJSON&&Object.prototype.hasOwnProperty.call(r,o)){a[s.name]=u.fromJSON.call(l,e,r[o],a);return}}a[s.name]=s.init(e,a)}}),a}}function XL(t,e,r){for(let n in t){let i=t[n];i instanceof Function?i=i.bind(e):n=="handleDOMEvents"&&(i=XL(i,e,{})),r[n]=i}return r}class Yn{constructor(e){this.spec=e,this.props={},e.props&&XL(e.props,this,this.props),this.key=e.key?e.key.key:QL("plugin")}getState(e){return e[this.key]}}const rS=Object.create(null);function QL(t){return t in rS?t+"$"+ ++rS[t]:(rS[t]=0,t+"$")}class Ti{constructor(e="key"){this.key=QL(e)}get(e){return e.config.pluginsByKey[this.key]}getState(e){return e[this.key]}}const B_=(t,e)=>t.selection.empty?!1:(e&&e(t.tr.deleteSelection().scrollIntoView()),!0);function JL(t,e){let{$cursor:r}=t.selection;return!r||(e?!e.endOfTextblock("backward",t):r.parentOffset>0)?null:r}const eO=(t,e,r)=>{let n=JL(t,r);if(!n)return!1;let i=z_(n);if(!i){let s=n.blockRange(),o=s&&vm(s);return o==null?!1:(e&&e(t.tr.lift(s,o).scrollIntoView()),!0)}let a=i.nodeBefore;if(uO(t,i,e,-1))return!0;if(n.parent.content.size==0&&(Yp(a,"end")||Xt.isSelectable(a)))for(let s=n.depth;;s--){let o=$1(t.doc,n.before(s),n.after(s),Pt.empty);if(o&&o.slice.size<o.to-o.from){if(e){let l=t.tr.step(o);l.setSelection(Yp(a,"end")?Sr.findFrom(l.doc.resolve(l.mapping.map(i.pos,-1)),-1):Xt.create(l.doc,i.pos-a.nodeSize)),e(l.scrollIntoView())}return!0}if(s==1||n.node(s-1).childCount>1)break}return a.isAtom&&i.depth==n.depth-1?(e&&e(t.tr.delete(i.pos-a.nodeSize,i.pos).scrollIntoView()),!0):!1},zZ=(t,e,r)=>{let n=JL(t,r);if(!n)return!1;let i=z_(n);return i?tO(t,i,e):!1},UZ=(t,e,r)=>{let n=nO(t,r);if(!n)return!1;let i=U_(n);return i?tO(t,i,e):!1};function tO(t,e,r){let n=e.nodeBefore,i=n,a=e.pos-1;for(;!i.isTextblock;a--){if(i.type.spec.isolating)return!1;let c=i.lastChild;if(!c)return!1;i=c}let s=e.nodeAfter,o=s,l=e.pos+1;for(;!o.isTextblock;l++){if(o.type.spec.isolating)return!1;let c=o.firstChild;if(!c)return!1;o=c}let u=$1(t.doc,a,l,Pt.empty);if(!u||u.from!=a||u instanceof ha&&u.slice.size>=l-a)return!1;if(r){let c=t.tr.step(u);c.setSelection(dr.create(c.doc,a)),r(c.scrollIntoView())}return!0}function Yp(t,e,r=!1){for(let n=t;n;n=e=="start"?n.firstChild:n.lastChild){if(n.isTextblock)return!0;if(r&&n.childCount!=1)return!1}return!1}const rO=(t,e,r)=>{let{$head:n,empty:i}=t.selection,a=n;if(!i)return!1;if(n.parent.isTextblock){if(r?!r.endOfTextblock("backward",t):n.parentOffset>0)return!1;a=z_(n)}let s=a&&a.nodeBefore;return!s||!Xt.isSelectable(s)?!1:(e&&e(t.tr.setSelection(Xt.create(t.doc,a.pos-s.nodeSize)).scrollIntoView()),!0)};function z_(t){if(!t.parent.type.spec.isolating)for(let e=t.depth-1;e>=0;e--){if(t.index(e)>0)return t.doc.resolve(t.before(e+1));if(t.node(e).type.spec.isolating)break}return null}function nO(t,e){let{$cursor:r}=t.selection;return!r||(e?!e.endOfTextblock("forward",t):r.parentOffset<r.parent.content.size)?null:r}const iO=(t,e,r)=>{let n=nO(t,r);if(!n)return!1;let i=U_(n);if(!i)return!1;let a=i.nodeAfter;if(uO(t,i,e,1))return!0;if(n.parent.content.size==0&&(Yp(a,"start")||Xt.isSelectable(a))){let s=$1(t.doc,n.before(),n.after(),Pt.empty);if(s&&s.slice.size<s.to-s.from){if(e){let o=t.tr.step(s);o.setSelection(Yp(a,"start")?Sr.findFrom(o.doc.resolve(o.mapping.map(i.pos)),1):Xt.create(o.doc,o.mapping.map(i.pos))),e(o.scrollIntoView())}return!0}}return a.isAtom&&i.depth==n.depth-1?(e&&e(t.tr.delete(i.pos,i.pos+a.nodeSize).scrollIntoView()),!0):!1},aO=(t,e,r)=>{let{$head:n,empty:i}=t.selection,a=n;if(!i)return!1;if(n.parent.isTextblock){if(r?!r.endOfTextblock("forward",t):n.parentOffset<n.parent.content.size)return!1;a=U_(n)}let s=a&&a.nodeAfter;return!s||!Xt.isSelectable(s)?!1:(e&&e(t.tr.setSelection(Xt.create(t.doc,a.pos)).scrollIntoView()),!0)};function U_(t){if(!t.parent.type.spec.isolating)for(let e=t.depth-1;e>=0;e--){let r=t.node(e);if(t.index(e)+1<r.childCount)return t.doc.resolve(t.after(e+1));if(r.type.spec.isolating)break}return null}const GZ=(t,e)=>{let r=t.selection,n=r instanceof Xt,i;if(n){if(r.node.isTextblock||!hf(t.doc,r.from))return!1;i=r.from}else if(i=q1(t.doc,r.from,-1),i==null)return!1;if(e){let a=t.tr.join(i);n&&a.setSelection(Xt.create(a.doc,i-t.doc.resolve(i).nodeBefore.nodeSize)),e(a.scrollIntoView())}return!0},VZ=(t,e)=>{let r=t.selection,n;if(r instanceof Xt){if(r.node.isTextblock||!hf(t.doc,r.to))return!1;n=r.to}else if(n=q1(t.doc,r.to,1),n==null)return!1;return e&&e(t.tr.join(n).scrollIntoView()),!0},HZ=(t,e)=>{let{$from:r,$to:n}=t.selection,i=r.blockRange(n),a=i&&vm(i);return a==null?!1:(e&&e(t.tr.lift(i,a).scrollIntoView()),!0)},sO=(t,e)=>{let{$head:r,$anchor:n}=t.selection;return!r.parent.type.spec.code||!r.sameParent(n)?!1:(e&&e(t.tr.insertText(`
`).scrollIntoView()),!0)};function G_(t){for(let e=0;e<t.edgeCount;e++){let{type:r}=t.edge(e);if(r.isTextblock&&!r.hasRequiredAttrs())return r}return null}const WZ=(t,e)=>{let{$head:r,$anchor:n}=t.selection;if(!r.parent.type.spec.code||!r.sameParent(n))return!1;let i=r.node(-1),a=r.indexAfter(-1),s=G_(i.contentMatchAt(a));if(!s||!i.canReplaceWith(a,a,s))return!1;if(e){let o=r.after(),l=t.tr.replaceWith(o,o,s.createAndFill());l.setSelection(Sr.near(l.doc.resolve(o),1)),e(l.scrollIntoView())}return!0},oO=(t,e)=>{let r=t.selection,{$from:n,$to:i}=r;if(r instanceof vo||n.parent.inlineContent||i.parent.inlineContent)return!1;let a=G_(i.parent.contentMatchAt(i.indexAfter()));if(!a||!a.isTextblock)return!1;if(e){let s=(!n.parentOffset&&i.index()<i.parent.childCount?n:i).pos,o=t.tr.insert(s,a.createAndFill());o.setSelection(dr.create(o.doc,s+1)),e(o.scrollIntoView())}return!0},lO=(t,e)=>{let{$cursor:r}=t.selection;if(!r||r.parent.content.size)return!1;if(r.depth>1&&r.after()!=r.end(-1)){let a=r.before();if(mc(t.doc,a))return e&&e(t.tr.split(a).scrollIntoView()),!0}let n=r.blockRange(),i=n&&vm(n);return i==null?!1:(e&&e(t.tr.lift(n,i).scrollIntoView()),!0)};function qZ(t){return(e,r)=>{let{$from:n,$to:i}=e.selection;if(e.selection instanceof Xt&&e.selection.node.isBlock)return!n.parentOffset||!mc(e.doc,n.pos)?!1:(r&&r(e.tr.split(n.pos).scrollIntoView()),!0);if(!n.depth)return!1;let a=[],s,o,l=!1,u=!1;for(let v=n.depth;;v--)if(n.node(v).isBlock){l=n.end(v)==n.pos+(n.depth-v),u=n.start(v)==n.pos-(n.depth-v),o=G_(n.node(v-1).contentMatchAt(n.indexAfter(v-1))),a.unshift(l&&o?{type:o}:null),s=v;break}else{if(v==1)return!1;a.unshift(null)}let c=e.tr;(e.selection instanceof dr||e.selection instanceof vo)&&c.deleteSelection();let f=c.mapping.map(n.pos),p=mc(c.doc,f,a.length,a);if(p||(a[0]=o?{type:o}:null,p=mc(c.doc,f,a.length,a)),!p)return!1;if(c.split(f,a.length,a),!l&&u&&n.node(s).type!=o){let v=c.mapping.map(n.before(s)),y=c.doc.resolve(v);o&&n.node(s-1).canReplaceWith(y.index(),y.index()+1,o)&&c.setNodeMarkup(c.mapping.map(n.before(s)),o)}return r&&r(c.scrollIntoView()),!0}}const $Z=qZ(),KZ=(t,e)=>{let{$from:r,to:n}=t.selection,i,a=r.sharedDepth(n);return a==0?!1:(i=r.before(a),e&&e(t.tr.setSelection(Xt.create(t.doc,i))),!0)};function ZZ(t,e,r){let n=e.nodeBefore,i=e.nodeAfter,a=e.index();return!n||!i||!n.type.compatibleContent(i.type)?!1:!n.content.size&&e.parent.canReplace(a-1,a)?(r&&r(t.tr.delete(e.pos-n.nodeSize,e.pos).scrollIntoView()),!0):!e.parent.canReplace(a,a+1)||!(i.isTextblock||hf(t.doc,e.pos))?!1:(r&&r(t.tr.join(e.pos).scrollIntoView()),!0)}function uO(t,e,r,n){let i=e.nodeBefore,a=e.nodeAfter,s,o,l=i.type.spec.isolating||a.type.spec.isolating;if(!l&&ZZ(t,e,r))return!0;let u=!l&&e.parent.canReplace(e.index(),e.index()+1);if(u&&(s=(o=i.contentMatchAt(i.childCount)).findWrapping(a.type))&&o.matchType(s[0]||a.type).validEnd){if(r){let v=e.pos+a.nodeSize,y=it.empty;for(let E=s.length-1;E>=0;E--)y=it.from(s[E].create(null,y));y=it.from(i.copy(y));let S=t.tr.step(new va(e.pos-1,v,e.pos,v,new Pt(y,1,0),s.length,!0)),w=S.doc.resolve(v+2*s.length);w.nodeAfter&&w.nodeAfter.type==i.type&&hf(S.doc,w.pos)&&S.join(w.pos),r(S.scrollIntoView())}return!0}let c=a.type.spec.isolating||n>0&&l?null:Sr.findFrom(e,1),f=c&&c.$from.blockRange(c.$to),p=f&&vm(f);if(p!=null&&p>=e.depth)return r&&r(t.tr.lift(f,p).scrollIntoView()),!0;if(u&&Yp(a,"start",!0)&&Yp(i,"end")){let v=i,y=[];for(;y.push(v),!v.isTextblock;)v=v.lastChild;let S=a,w=1;for(;!S.isTextblock;S=S.firstChild)w++;if(v.canReplace(v.childCount,v.childCount,S.content)){if(r){let E=it.empty;for(let T=y.length-1;T>=0;T--)E=it.from(y[T].copy(E));let _=t.tr.step(new va(e.pos-y.length,e.pos+a.nodeSize,e.pos+w,e.pos+a.nodeSize-w,new Pt(E,y.length,0),0,!0));r(_.scrollIntoView())}return!0}}return!1}function cO(t){return function(e,r){let n=e.selection,i=t<0?n.$from:n.$to,a=i.depth;for(;i.node(a).isInline;){if(!a)return!1;a--}return i.node(a).isTextblock?(r&&r(e.tr.setSelection(dr.create(e.doc,t<0?i.start(a):i.end(a)))),!0):!1}}const YZ=cO(-1),XZ=cO(1);function QZ(t,e=null){return function(r,n){let{$from:i,$to:a}=r.selection,s=i.blockRange(a),o=s&&j_(s,t,e);return o?(n&&n(r.tr.wrap(s,o).scrollIntoView()),!0):!1}}function E3(t,e=null){return function(r,n){let i=!1;for(let a=0;a<r.selection.ranges.length&&!i;a++){let{$from:{pos:s},$to:{pos:o}}=r.selection.ranges[a];r.doc.nodesBetween(s,o,(l,u)=>{if(i)return!1;if(!(!l.isTextblock||l.hasMarkup(t,e)))if(l.type==t)i=!0;else{let c=r.doc.resolve(u),f=c.index();i=c.parent.canReplaceWith(f,f+1,t)}})}if(!i)return!1;if(n){let a=r.tr;for(let s=0;s<r.selection.ranges.length;s++){let{$from:{pos:o},$to:{pos:l}}=r.selection.ranges[s];a.setBlockType(o,l,t,e)}n(a.scrollIntoView())}return!0}}function V_(...t){return function(e,r,n){for(let i=0;i<t.length;i++)if(t[i](e,r,n))return!0;return!1}}V_(B_,eO,rO);V_(B_,iO,aO);V_(sO,oO,lO,$Z);typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):typeof os<"u"&&os.platform&&os.platform()=="darwin";function JZ(t,e=null){return function(r,n){let{$from:i,$to:a}=r.selection,s=i.blockRange(a);if(!s)return!1;let o=n?r.tr:null;return eY(o,s,t,e)?(n&&n(o.scrollIntoView()),!0):!1}}function eY(t,e,r,n=null){let i=!1,a=e,s=e.$from.doc;if(e.depth>=2&&e.$from.node(e.depth-1).type.compatibleContent(r)&&e.startIndex==0){if(e.$from.index(e.depth-1)==0)return!1;let l=s.resolve(e.start-2);a=new Nx(l,l,e.depth),e.endIndex<e.parent.childCount&&(e=new Nx(e.$from,s.resolve(e.$to.end(e.depth)),e.depth)),i=!0}let o=j_(a,r,n,e);return o?(t&&tY(t,e,o,i,r),!0):!1}function tY(t,e,r,n,i){let a=it.empty;for(let c=r.length-1;c>=0;c--)a=it.from(r[c].type.create(r[c].attrs,a));t.step(new va(e.start-(n?2:0),e.end,e.start,e.end,new Pt(a,0,0),r.length,!0));let s=0;for(let c=0;c<r.length;c++)r[c].type==i&&(s=c+1);let o=r.length-s,l=e.start+r.length-(n?2:0),u=e.parent;for(let c=e.startIndex,f=e.endIndex,p=!0;c<f;c++,p=!1)!p&&mc(t.doc,l,o)&&(t.split(l,o),l+=2*o),l+=u.child(c).nodeSize;return t}function rY(t){return function(e,r){let{$from:n,$to:i}=e.selection,a=n.blockRange(i,s=>s.childCount>0&&s.firstChild.type==t);return a?r?n.node(a.depth-1).type==t?nY(e,r,t,a):iY(e,r,a):!0:!1}}function nY(t,e,r,n){let i=t.tr,a=n.end,s=n.$to.end(n.depth);a<s&&(i.step(new va(a-1,s,a,s,new Pt(it.from(r.create(null,n.parent.copy())),1,0),1,!0)),n=new Nx(i.doc.resolve(n.$from.pos),i.doc.resolve(s),n.depth));const o=vm(n);if(o==null)return!1;i.lift(n,o);let l=i.doc.resolve(i.mapping.map(a,-1)-1);return hf(i.doc,l.pos)&&l.nodeBefore.type==l.nodeAfter.type&&i.join(l.pos),e(i.scrollIntoView()),!0}function iY(t,e,r){let n=t.tr,i=r.parent;for(let v=r.end,y=r.endIndex-1,S=r.startIndex;y>S;y--)v-=i.child(y).nodeSize,n.delete(v-1,v+1);let a=n.doc.resolve(r.start),s=a.nodeAfter;if(n.mapping.map(r.end)!=r.start+a.nodeAfter.nodeSize)return!1;let o=r.startIndex==0,l=r.endIndex==i.childCount,u=a.node(-1),c=a.index(-1);if(!u.canReplace(c+(o?0:1),c+1,s.content.append(l?it.empty:it.from(i))))return!1;let f=a.pos,p=f+s.nodeSize;return n.step(new va(f-(o?1:0),p+(l?1:0),f+1,p-1,new Pt((o?it.empty:it.from(i.copy(it.empty))).append(l?it.empty:it.from(i.copy(it.empty))),o?0:1,l?0:1),o?0:1)),e(n.scrollIntoView()),!0}function aY(t){return function(e,r){let{$from:n,$to:i}=e.selection,a=n.blockRange(i,u=>u.childCount>0&&u.firstChild.type==t);if(!a)return!1;let s=a.startIndex;if(s==0)return!1;let o=a.parent,l=o.child(s-1);if(l.type!=t)return!1;if(r){let u=l.lastChild&&l.lastChild.type==o.type,c=it.from(u?t.create():null),f=new Pt(it.from(t.create(null,it.from(o.type.create(null,c)))),u?3:1,0),p=a.start,v=a.end;r(e.tr.step(new va(p-(u?3:1),v,p,v,f,1,!0)).scrollIntoView())}return!0}}const Fa=function(t){for(var e=0;;e++)if(t=t.previousSibling,!t)return e},Xp=function(t){let e=t.assignedSlot||t.parentNode;return e&&e.nodeType==11?e.host:e};let pk=null;const uc=function(t,e,r){let n=pk||(pk=document.createRange());return n.setEnd(t,r??t.nodeValue.length),n.setStart(t,e||0),n},sY=function(){pk=null},kh=function(t,e,r,n){return r&&(T3(t,e,r,n,-1)||T3(t,e,r,n,1))},oY=/^(img|br|input|textarea|hr)$/i;function T3(t,e,r,n,i){for(var a;;){if(t==r&&e==n)return!0;if(e==(i<0?0:Zo(t))){let s=t.parentNode;if(!s||s.nodeType!=1||c0(t)||oY.test(t.nodeName)||t.contentEditable=="false")return!1;e=Fa(t)+(i<0?0:1),t=s}else if(t.nodeType==1){let s=t.childNodes[e+(i<0?-1:0)];if(s.nodeType==1&&s.contentEditable=="false")if(!((a=s.pmViewDesc)===null||a===void 0)&&a.ignoreForSelection)e+=i;else return!1;else t=s,e=i<0?Zo(t):0}else return!1}}function Zo(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}function lY(t,e){for(;;){if(t.nodeType==3&&e)return t;if(t.nodeType==1&&e>0){if(t.contentEditable=="false")return null;t=t.childNodes[e-1],e=Zo(t)}else if(t.parentNode&&!c0(t))e=Fa(t),t=t.parentNode;else return null}}function uY(t,e){for(;;){if(t.nodeType==3&&e<t.nodeValue.length)return t;if(t.nodeType==1&&e<t.childNodes.length){if(t.contentEditable=="false")return null;t=t.childNodes[e],e=0}else if(t.parentNode&&!c0(t))e=Fa(t)+1,t=t.parentNode;else return null}}function cY(t,e,r){for(let n=e==0,i=e==Zo(t);n||i;){if(t==r)return!0;let a=Fa(t);if(t=t.parentNode,!t)return!1;n=n&&a==0,i=i&&a==Zo(t)}}function c0(t){let e;for(let r=t;r&&!(e=r.pmViewDesc);r=r.parentNode);return e&&e.node&&e.node.isBlock&&(e.dom==t||e.contentDOM==t)}const Z1=function(t){return t.focusNode&&kh(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset)};function eh(t,e){let r=document.createEvent("Event");return r.initEvent("keydown",!0,!0),r.keyCode=t,r.key=r.code=e,r}function dY(t){let e=t.activeElement;for(;e&&e.shadowRoot;)e=e.shadowRoot.activeElement;return e}function fY(t,e,r){if(t.caretPositionFromPoint)try{let n=t.caretPositionFromPoint(e,r);if(n)return{node:n.offsetNode,offset:Math.min(Zo(n.offsetNode),n.offset)}}catch{}if(t.caretRangeFromPoint){let n=t.caretRangeFromPoint(e,r);if(n)return{node:n.startContainer,offset:Math.min(Zo(n.startContainer),n.startOffset)}}}const Nu=typeof navigator<"u"?navigator:null,N3=typeof document<"u"?document:null,pf=Nu&&Nu.userAgent||"",mk=/Edge\/(\d+)/.exec(pf),dO=/MSIE \d/.exec(pf),gk=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(pf),Xs=!!(dO||gk||mk),qd=dO?document.documentMode:gk?+gk[1]:mk?+mk[1]:0,Qo=!Xs&&/gecko\/(\d+)/i.test(pf);Qo&&+(/Firefox\/(\d+)/.exec(pf)||[0,0])[1];const vk=!Xs&&/Chrome\/(\d+)/.exec(pf),ma=!!vk,fO=vk?+vk[1]:0,Ga=!Xs&&!!Nu&&/Apple Computer/.test(Nu.vendor),Qp=Ga&&(/Mobile\/\w+/.test(pf)||!!Nu&&Nu.maxTouchPoints>2),$o=Qp||(Nu?/Mac/.test(Nu.platform):!1),hO=Nu?/Win/.test(Nu.platform):!1,hc=/Android \d/.test(pf),d0=!!N3&&"webkitFontSmoothing"in N3.documentElement.style,hY=d0?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function pY(t){let e=t.defaultView&&t.defaultView.visualViewport;return e?{left:0,right:e.width,top:0,bottom:e.height}:{left:0,right:t.documentElement.clientWidth,top:0,bottom:t.documentElement.clientHeight}}function ac(t,e){return typeof t=="number"?t:t[e]}function mY(t){let e=t.getBoundingClientRect(),r=e.width/t.offsetWidth||1,n=e.height/t.offsetHeight||1;return{left:e.left,right:e.left+t.clientWidth*r,top:e.top,bottom:e.top+t.clientHeight*n}}function P3(t,e,r){let n=t.someProp("scrollThreshold")||0,i=t.someProp("scrollMargin")||5,a=t.dom.ownerDocument;for(let s=r||t.dom;s;){if(s.nodeType!=1){s=Xp(s);continue}let o=s,l=o==a.body,u=l?pY(a):mY(o),c=0,f=0;if(e.top<u.top+ac(n,"top")?f=-(u.top-e.top+ac(i,"top")):e.bottom>u.bottom-ac(n,"bottom")&&(f=e.bottom-e.top>u.bottom-u.top?e.top+ac(i,"top")-u.top:e.bottom-u.bottom+ac(i,"bottom")),e.left<u.left+ac(n,"left")?c=-(u.left-e.left+ac(i,"left")):e.right>u.right-ac(n,"right")&&(c=e.right-u.right+ac(i,"right")),c||f)if(l)a.defaultView.scrollBy(c,f);else{let v=o.scrollLeft,y=o.scrollTop;f&&(o.scrollTop+=f),c&&(o.scrollLeft+=c);let S=o.scrollLeft-v,w=o.scrollTop-y;e={left:e.left-S,top:e.top-w,right:e.right-S,bottom:e.bottom-w}}let p=l?"fixed":getComputedStyle(s).position;if(/^(fixed|sticky)$/.test(p))break;s=p=="absolute"?s.offsetParent:Xp(s)}}function gY(t){let e=t.dom.getBoundingClientRect(),r=Math.max(0,e.top),n,i;for(let a=(e.left+e.right)/2,s=r+1;s<Math.min(innerHeight,e.bottom);s+=5){let o=t.root.elementFromPoint(a,s);if(!o||o==t.dom||!t.dom.contains(o))continue;let l=o.getBoundingClientRect();if(l.top>=r-20){n=o,i=l.top;break}}return{refDOM:n,refTop:i,stack:pO(t.dom)}}function pO(t){let e=[],r=t.ownerDocument;for(let n=t;n&&(e.push({dom:n,top:n.scrollTop,left:n.scrollLeft}),t!=r);n=Xp(n));return e}function vY({refDOM:t,refTop:e,stack:r}){let n=t?t.getBoundingClientRect().top:0;mO(r,n==0?0:n-e)}function mO(t,e){for(let r=0;r<t.length;r++){let{dom:n,top:i,left:a}=t[r];n.scrollTop!=i+e&&(n.scrollTop=i+e),n.scrollLeft!=a&&(n.scrollLeft=a)}}let kp=null;function yY(t){if(t.setActive)return t.setActive();if(kp)return t.focus(kp);let e=pO(t);t.focus(kp==null?{get preventScroll(){return kp={preventScroll:!0},!0}}:void 0),kp||(kp=!1,mO(e,0))}function gO(t,e){let r,n=2e8,i,a=0,s=e.top,o=e.top,l,u;for(let c=t.firstChild,f=0;c;c=c.nextSibling,f++){let p;if(c.nodeType==1)p=c.getClientRects();else if(c.nodeType==3)p=uc(c).getClientRects();else continue;for(let v=0;v<p.length;v++){let y=p[v];if(y.top<=s&&y.bottom>=o){s=Math.max(y.bottom,s),o=Math.min(y.top,o);let S=y.left>e.left?y.left-e.left:y.right<e.left?e.left-y.right:0;if(S<n){r=c,n=S,i=S&&r.nodeType==3?{left:y.right<e.left?y.right:y.left,top:e.top}:e,c.nodeType==1&&S&&(a=f+(e.left>=(y.left+y.right)/2?1:0));continue}}else y.top>e.top&&!l&&y.left<=e.left&&y.right>=e.left&&(l=c,u={left:Math.max(y.left,Math.min(y.right,e.left)),top:y.top});!r&&(e.left>=y.right&&e.top>=y.top||e.left>=y.left&&e.top>=y.bottom)&&(a=f+1)}}return!r&&l&&(r=l,i=u,n=0),r&&r.nodeType==3?xY(r,i):!r||n&&r.nodeType==1?{node:t,offset:a}:gO(r,i)}function xY(t,e){let r=t.nodeValue.length,n=document.createRange(),i;for(let a=0;a<r;a++){n.setEnd(t,a+1),n.setStart(t,a);let s=Cd(n,1);if(s.top!=s.bottom&&H_(e,s)){i={node:t,offset:a+(e.left>=(s.left+s.right)/2?1:0)};break}}return n.detach(),i||{node:t,offset:0}}function H_(t,e){return t.left>=e.left-1&&t.left<=e.right+1&&t.top>=e.top-1&&t.top<=e.bottom+1}function bY(t,e){let r=t.parentNode;return r&&/^li$/i.test(r.nodeName)&&e.left<t.getBoundingClientRect().left?r:t}function wY(t,e,r){let{node:n,offset:i}=gO(e,r),a=-1;if(n.nodeType==1&&!n.firstChild){let s=n.getBoundingClientRect();a=s.left!=s.right&&r.left>(s.left+s.right)/2?1:-1}return t.docView.posFromDOM(n,i,a)}function SY(t,e,r,n){let i=-1;for(let a=e,s=!1;a!=t.dom;){let o=t.docView.nearestDesc(a,!0),l;if(!o)return null;if(o.dom.nodeType==1&&(o.node.isBlock&&o.parent||!o.contentDOM)&&((l=o.dom.getBoundingClientRect()).width||l.height)&&(o.node.isBlock&&o.parent&&!/^T(R|BODY|HEAD|FOOT)$/.test(o.dom.nodeName)&&(!s&&l.left>n.left||l.top>n.top?i=o.posBefore:(!s&&l.right<n.left||l.bottom<n.top)&&(i=o.posAfter),s=!0),!o.contentDOM&&i<0&&!o.node.isText))return(o.node.isBlock?n.top<(l.top+l.bottom)/2:n.left<(l.left+l.right)/2)?o.posBefore:o.posAfter;a=o.dom.parentNode}return i>-1?i:t.docView.posFromDOM(e,r,-1)}function vO(t,e,r){let n=t.childNodes.length;if(n&&r.top<r.bottom)for(let i=Math.max(0,Math.min(n-1,Math.floor(n*(e.top-r.top)/(r.bottom-r.top))-2)),a=i;;){let s=t.childNodes[a];if(s.nodeType==1){let o=s.getClientRects();for(let l=0;l<o.length;l++){let u=o[l];if(H_(e,u))return vO(s,e,u)}}if((a=(a+1)%n)==i)break}return t}function kY(t,e){let r=t.dom.ownerDocument,n,i=0,a=fY(r,e.left,e.top);a&&({node:n,offset:i}=a);let s=(t.root.elementFromPoint?t.root:r).elementFromPoint(e.left,e.top),o;if(!s||!t.dom.contains(s.nodeType!=1?s.parentNode:s)){let u=t.dom.getBoundingClientRect();if(!H_(e,u)||(s=vO(t.dom,e,u),!s))return null}if(Ga)for(let u=s;n&&u;u=Xp(u))u.draggable&&(n=void 0);if(s=bY(s,e),n){if(Qo&&n.nodeType==1&&(i=Math.min(i,n.childNodes.length),i<n.childNodes.length)){let c=n.childNodes[i],f;c.nodeName=="IMG"&&(f=c.getBoundingClientRect()).right<=e.left&&f.bottom>e.top&&i++}let u;d0&&i&&n.nodeType==1&&(u=n.childNodes[i-1]).nodeType==1&&u.contentEditable=="false"&&u.getBoundingClientRect().top>=e.top&&i--,n==t.dom&&i==n.childNodes.length-1&&n.lastChild.nodeType==1&&e.top>n.lastChild.getBoundingClientRect().bottom?o=t.state.doc.content.size:(i==0||n.nodeType!=1||n.childNodes[i-1].nodeName!="BR")&&(o=SY(t,n,i,e))}o==null&&(o=wY(t,s,e));let l=t.docView.nearestDesc(s,!0);return{pos:o,inside:l?l.posAtStart-l.border:-1}}function M3(t){return t.top<t.bottom||t.left<t.right}function Cd(t,e){let r=t.getClientRects();if(r.length){let n=r[e<0?0:r.length-1];if(M3(n))return n}return Array.prototype.find.call(r,M3)||t.getBoundingClientRect()}const _Y=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function yO(t,e,r){let{node:n,offset:i,atom:a}=t.docView.domFromPos(e,r<0?-1:1),s=d0||Qo;if(n.nodeType==3)if(s&&(_Y.test(n.nodeValue)||(r<0?!i:i==n.nodeValue.length))){let l=Cd(uc(n,i,i),r);if(Qo&&i&&/\s/.test(n.nodeValue[i-1])&&i<n.nodeValue.length){let u=Cd(uc(n,i-1,i-1),-1);if(u.top==l.top){let c=Cd(uc(n,i,i+1),-1);if(c.top!=l.top)return Bg(c,c.left<u.left)}}return l}else{let l=i,u=i,c=r<0?1:-1;return r<0&&!i?(u++,c=-1):r>=0&&i==n.nodeValue.length?(l--,c=1):r<0?l--:u++,Bg(Cd(uc(n,l,u),c),c<0)}if(!t.state.doc.resolve(e-(a||0)).parent.inlineContent){if(a==null&&i&&(r<0||i==Zo(n))){let l=n.childNodes[i-1];if(l.nodeType==1)return nS(l.getBoundingClientRect(),!1)}if(a==null&&i<Zo(n)){let l=n.childNodes[i];if(l.nodeType==1)return nS(l.getBoundingClientRect(),!0)}return nS(n.getBoundingClientRect(),r>=0)}if(a==null&&i&&(r<0||i==Zo(n))){let l=n.childNodes[i-1],u=l.nodeType==3?uc(l,Zo(l)-(s?0:1)):l.nodeType==1&&(l.nodeName!="BR"||!l.nextSibling)?l:null;if(u)return Bg(Cd(u,1),!1)}if(a==null&&i<Zo(n)){let l=n.childNodes[i];for(;l.pmViewDesc&&l.pmViewDesc.ignoreForCoords;)l=l.nextSibling;let u=l?l.nodeType==3?uc(l,0,s?0:1):l.nodeType==1?l:null:null;if(u)return Bg(Cd(u,-1),!0)}return Bg(Cd(n.nodeType==3?uc(n):n,-r),r>=0)}function Bg(t,e){if(t.width==0)return t;let r=e?t.left:t.right;return{top:t.top,bottom:t.bottom,left:r,right:r}}function nS(t,e){if(t.height==0)return t;let r=e?t.top:t.bottom;return{top:r,bottom:r,left:t.left,right:t.right}}function xO(t,e,r){let n=t.state,i=t.root.activeElement;n!=e&&t.updateState(e),i!=t.dom&&t.focus();try{return r()}finally{n!=e&&t.updateState(n),i!=t.dom&&i&&i.focus()}}function CY(t,e,r){let n=e.selection,i=r=="up"?n.$from:n.$to;return xO(t,e,()=>{let{node:a}=t.docView.domFromPos(i.pos,r=="up"?-1:1);for(;;){let o=t.docView.nearestDesc(a,!0);if(!o)break;if(o.node.isBlock){a=o.contentDOM||o.dom;break}a=o.dom.parentNode}let s=yO(t,i.pos,1);for(let o=a.firstChild;o;o=o.nextSibling){let l;if(o.nodeType==1)l=o.getClientRects();else if(o.nodeType==3)l=uc(o,0,o.nodeValue.length).getClientRects();else continue;for(let u=0;u<l.length;u++){let c=l[u];if(c.bottom>c.top+1&&(r=="up"?s.top-c.top>(c.bottom-s.top)*2:c.bottom-s.bottom>(s.bottom-c.top)*2))return!1}}return!0})}const EY=/[\u0590-\u08ac]/;function TY(t,e,r){let{$head:n}=e.selection;if(!n.parent.isTextblock)return!1;let i=n.parentOffset,a=!i,s=i==n.parent.content.size,o=t.domSelection();return o?!EY.test(n.parent.textContent)||!o.modify?r=="left"||r=="backward"?a:s:xO(t,e,()=>{let{focusNode:l,focusOffset:u,anchorNode:c,anchorOffset:f}=t.domSelectionRange(),p=o.caretBidiLevel;o.modify("move",r,"character");let v=n.depth?t.docView.domAfterPos(n.before()):t.dom,{focusNode:y,focusOffset:S}=t.domSelectionRange(),w=y&&!v.contains(y.nodeType==1?y:y.parentNode)||l==y&&u==S;try{o.collapse(c,f),l&&(l!=c||u!=f)&&o.extend&&o.extend(l,u)}catch{}return p!=null&&(o.caretBidiLevel=p),w}):n.pos==n.start()||n.pos==n.end()}let A3=null,R3=null,L3=!1;function NY(t,e,r){return A3==e&&R3==r?L3:(A3=e,R3=r,L3=r=="up"||r=="down"?CY(t,e,r):TY(t,e,r))}const Jo=0,O3=1,rh=2,Pu=3;class f0{constructor(e,r,n,i){this.parent=e,this.children=r,this.dom=n,this.contentDOM=i,this.dirty=Jo,n.pmViewDesc=this}matchesWidget(e){return!1}matchesMark(e){return!1}matchesNode(e,r,n){return!1}matchesHack(e){return!1}parseRule(){return null}stopEvent(e){return!1}get size(){let e=0;for(let r=0;r<this.children.length;r++)e+=this.children[r].size;return e}get border(){return 0}destroy(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(let e=0;e<this.children.length;e++)this.children[e].destroy()}posBeforeChild(e){for(let r=0,n=this.posAtStart;;r++){let i=this.children[r];if(i==e)return n;n+=i.size}}get posBefore(){return this.parent.posBeforeChild(this)}get posAtStart(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}get posAfter(){return this.posBefore+this.size}get posAtEnd(){return this.posAtStart+this.size-2*this.border}localPosFromDOM(e,r,n){if(this.contentDOM&&this.contentDOM.contains(e.nodeType==1?e:e.parentNode))if(n<0){let a,s;if(e==this.contentDOM)a=e.childNodes[r-1];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;a=e.previousSibling}for(;a&&!((s=a.pmViewDesc)&&s.parent==this);)a=a.previousSibling;return a?this.posBeforeChild(s)+s.size:this.posAtStart}else{let a,s;if(e==this.contentDOM)a=e.childNodes[r];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;a=e.nextSibling}for(;a&&!((s=a.pmViewDesc)&&s.parent==this);)a=a.nextSibling;return a?this.posBeforeChild(s):this.posAtEnd}let i;if(e==this.dom&&this.contentDOM)i=r>Fa(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))i=e.compareDocumentPosition(this.contentDOM)&2;else if(this.dom.firstChild){if(r==0)for(let a=e;;a=a.parentNode){if(a==this.dom){i=!1;break}if(a.previousSibling)break}if(i==null&&r==e.childNodes.length)for(let a=e;;a=a.parentNode){if(a==this.dom){i=!0;break}if(a.nextSibling)break}}return i??n>0?this.posAtEnd:this.posAtStart}nearestDesc(e,r=!1){for(let n=!0,i=e;i;i=i.parentNode){let a=this.getDesc(i),s;if(a&&(!r||a.node))if(n&&(s=a.nodeDOM)&&!(s.nodeType==1?s.contains(e.nodeType==1?e:e.parentNode):s==e))n=!1;else return a}}getDesc(e){let r=e.pmViewDesc;for(let n=r;n;n=n.parent)if(n==this)return r}posFromDOM(e,r,n){for(let i=e;i;i=i.parentNode){let a=this.getDesc(i);if(a)return a.localPosFromDOM(e,r,n)}return-1}descAt(e){for(let r=0,n=0;r<this.children.length;r++){let i=this.children[r],a=n+i.size;if(n==e&&a!=n){for(;!i.border&&i.children.length;)for(let s=0;s<i.children.length;s++){let o=i.children[s];if(o.size){i=o;break}}return i}if(e<a)return i.descAt(e-n-i.border);n=a}}domFromPos(e,r){if(!this.contentDOM)return{node:this.dom,offset:0,atom:e+1};let n=0,i=0;for(let a=0;n<this.children.length;n++){let s=this.children[n],o=a+s.size;if(o>e||s instanceof wO){i=e-a;break}a=o}if(i)return this.children[n].domFromPos(i-this.children[n].border,r);for(let a;n&&!(a=this.children[n-1]).size&&a instanceof bO&&a.side>=0;n--);if(r<=0){let a,s=!0;for(;a=n?this.children[n-1]:null,!(!a||a.dom.parentNode==this.contentDOM);n--,s=!1);return a&&r&&s&&!a.border&&!a.domAtom?a.domFromPos(a.size,r):{node:this.contentDOM,offset:a?Fa(a.dom)+1:0}}else{let a,s=!0;for(;a=n<this.children.length?this.children[n]:null,!(!a||a.dom.parentNode==this.contentDOM);n++,s=!1);return a&&s&&!a.border&&!a.domAtom?a.domFromPos(0,r):{node:this.contentDOM,offset:a?Fa(a.dom):this.contentDOM.childNodes.length}}}parseRange(e,r,n=0){if(this.children.length==0)return{node:this.contentDOM,from:e,to:r,fromOffset:0,toOffset:this.contentDOM.childNodes.length};let i=-1,a=-1;for(let s=n,o=0;;o++){let l=this.children[o],u=s+l.size;if(i==-1&&e<=u){let c=s+l.border;if(e>=c&&r<=u-l.border&&l.node&&l.contentDOM&&this.contentDOM.contains(l.contentDOM))return l.parseRange(e,r,c);e=s;for(let f=o;f>0;f--){let p=this.children[f-1];if(p.size&&p.dom.parentNode==this.contentDOM&&!p.emptyChildAt(1)){i=Fa(p.dom)+1;break}e-=p.size}i==-1&&(i=0)}if(i>-1&&(u>r||o==this.children.length-1)){r=u;for(let c=o+1;c<this.children.length;c++){let f=this.children[c];if(f.size&&f.dom.parentNode==this.contentDOM&&!f.emptyChildAt(-1)){a=Fa(f.dom);break}r+=f.size}a==-1&&(a=this.contentDOM.childNodes.length);break}s=u}return{node:this.contentDOM,from:e,to:r,fromOffset:i,toOffset:a}}emptyChildAt(e){if(this.border||!this.contentDOM||!this.children.length)return!1;let r=this.children[e<0?0:this.children.length-1];return r.size==0||r.emptyChildAt(e)}domAfterPos(e){let{node:r,offset:n}=this.domFromPos(e,0);if(r.nodeType!=1||n==r.childNodes.length)throw new RangeError("No node after pos "+e);return r.childNodes[n]}setSelection(e,r,n,i=!1){let a=Math.min(e,r),s=Math.max(e,r);for(let v=0,y=0;v<this.children.length;v++){let S=this.children[v],w=y+S.size;if(a>y&&s<w)return S.setSelection(e-y-S.border,r-y-S.border,n,i);y=w}let o=this.domFromPos(e,e?-1:1),l=r==e?o:this.domFromPos(r,r?-1:1),u=n.root.getSelection(),c=n.domSelectionRange(),f=!1;if((Qo||Ga)&&e==r){let{node:v,offset:y}=o;if(v.nodeType==3){if(f=!!(y&&v.nodeValue[y-1]==`
`),f&&y==v.nodeValue.length)for(let S=v,w;S;S=S.parentNode){if(w=S.nextSibling){w.nodeName=="BR"&&(o=l={node:w.parentNode,offset:Fa(w)+1});break}let E=S.pmViewDesc;if(E&&E.node&&E.node.isBlock)break}}else{let S=v.childNodes[y-1];f=S&&(S.nodeName=="BR"||S.contentEditable=="false")}}if(Qo&&c.focusNode&&c.focusNode!=l.node&&c.focusNode.nodeType==1){let v=c.focusNode.childNodes[c.focusOffset];v&&v.contentEditable=="false"&&(i=!0)}if(!(i||f&&Ga)&&kh(o.node,o.offset,c.anchorNode,c.anchorOffset)&&kh(l.node,l.offset,c.focusNode,c.focusOffset))return;let p=!1;if((u.extend||e==r)&&!(f&&Qo)){u.collapse(o.node,o.offset);try{e!=r&&u.extend(l.node,l.offset),p=!0}catch{}}if(!p){if(e>r){let y=o;o=l,l=y}let v=document.createRange();v.setEnd(l.node,l.offset),v.setStart(o.node,o.offset),u.removeAllRanges(),u.addRange(v)}}ignoreMutation(e){return!this.contentDOM&&e.type!="selection"}get contentLost(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}markDirty(e,r){for(let n=0,i=0;i<this.children.length;i++){let a=this.children[i],s=n+a.size;if(n==s?e<=s&&r>=n:e<s&&r>n){let o=n+a.border,l=s-a.border;if(e>=o&&r<=l){this.dirty=e==n||r==s?rh:O3,e==o&&r==l&&(a.contentLost||a.dom.parentNode!=this.contentDOM)?a.dirty=Pu:a.markDirty(e-o,r-o);return}else a.dirty=a.dom==a.contentDOM&&a.dom.parentNode==this.contentDOM&&!a.children.length?rh:Pu}n=s}this.dirty=rh}markParentsDirty(){let e=1;for(let r=this.parent;r;r=r.parent,e++){let n=e==1?rh:O3;r.dirty<n&&(r.dirty=n)}}get domAtom(){return!1}get ignoreForCoords(){return!1}get ignoreForSelection(){return!1}isText(e){return!1}}class bO extends f0{constructor(e,r,n,i){let a,s=r.type.toDOM;if(typeof s=="function"&&(s=s(n,()=>{if(!a)return i;if(a.parent)return a.parent.posBeforeChild(a)})),!r.type.spec.raw){if(s.nodeType!=1){let o=document.createElement("span");o.appendChild(s),s=o}s.contentEditable="false",s.classList.add("ProseMirror-widget")}super(e,[],s,null),this.widget=r,this.widget=r,a=this}matchesWidget(e){return this.dirty==Jo&&e.type.eq(this.widget.type)}parseRule(){return{ignore:!0}}stopEvent(e){let r=this.widget.spec.stopEvent;return r?r(e):!1}ignoreMutation(e){return e.type!="selection"||this.widget.spec.ignoreSelection}destroy(){this.widget.type.destroy(this.dom),super.destroy()}get domAtom(){return!0}get ignoreForSelection(){return!!this.widget.type.spec.relaxedSide}get side(){return this.widget.type.side}}class PY extends f0{constructor(e,r,n,i){super(e,[],r,null),this.textDOM=n,this.text=i}get size(){return this.text.length}localPosFromDOM(e,r){return e!=this.textDOM?this.posAtStart+(r?this.size:0):this.posAtStart+r}domFromPos(e){return{node:this.textDOM,offset:e}}ignoreMutation(e){return e.type==="characterData"&&e.target.nodeValue==e.oldValue}}class _h extends f0{constructor(e,r,n,i,a){super(e,[],n,i),this.mark=r,this.spec=a}static create(e,r,n,i){let a=i.nodeViews[r.type.name],s=a&&a(r,i,n);return(!s||!s.dom)&&(s=Ah.renderSpec(document,r.type.spec.toDOM(r,n),null,r.attrs)),new _h(e,r,s.dom,s.contentDOM||s.dom,s)}parseRule(){return this.dirty&Pu||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}}matchesMark(e){return this.dirty!=Pu&&this.mark.eq(e)}markDirty(e,r){if(super.markDirty(e,r),this.dirty!=Jo){let n=this.parent;for(;!n.node;)n=n.parent;n.dirty<this.dirty&&(n.dirty=this.dirty),this.dirty=Jo}}slice(e,r,n){let i=_h.create(this.parent,this.mark,!0,n),a=this.children,s=this.size;r<s&&(a=xk(a,r,s,n)),e>0&&(a=xk(a,0,e,n));for(let o=0;o<a.length;o++)a[o].parent=i;return i.children=a,i}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}}class $d extends f0{constructor(e,r,n,i,a,s,o,l,u){super(e,[],a,s),this.node=r,this.outerDeco=n,this.innerDeco=i,this.nodeDOM=o}static create(e,r,n,i,a,s){let o=a.nodeViews[r.type.name],l,u=o&&o(r,a,()=>{if(!l)return s;if(l.parent)return l.parent.posBeforeChild(l)},n,i),c=u&&u.dom,f=u&&u.contentDOM;if(r.isText){if(!c)c=document.createTextNode(r.text);else if(c.nodeType!=3)throw new RangeError("Text must be rendered as a DOM text node")}else c||({dom:c,contentDOM:f}=Ah.renderSpec(document,r.type.spec.toDOM(r),null,r.attrs));!f&&!r.isText&&c.nodeName!="BR"&&(c.hasAttribute("contenteditable")||(c.contentEditable="false"),r.type.spec.draggable&&(c.draggable=!0));let p=c;return c=_O(c,n,r),u?l=new MY(e,r,n,i,c,f||null,p,u,a,s+1):r.isText?new Y1(e,r,n,i,c,p,a):new $d(e,r,n,i,c,f||null,p,a,s+1)}parseRule(){if(this.node.type.spec.reparseInView)return null;let e={node:this.node.type.name,attrs:this.node.attrs};if(this.node.type.whitespace=="pre"&&(e.preserveWhitespace="full"),!this.contentDOM)e.getContent=()=>this.node.content;else if(!this.contentLost)e.contentElement=this.contentDOM;else{for(let r=this.children.length-1;r>=0;r--){let n=this.children[r];if(this.dom.contains(n.dom.parentNode)){e.contentElement=n.dom.parentNode;break}}e.contentElement||(e.getContent=()=>it.empty)}return e}matchesNode(e,r,n){return this.dirty==Jo&&e.eq(this.node)&&Mx(r,this.outerDeco)&&n.eq(this.innerDeco)}get size(){return this.node.nodeSize}get border(){return this.node.isLeaf?0:1}updateChildren(e,r){let n=this.node.inlineContent,i=r,a=e.composing?this.localCompositionInfo(e,r):null,s=a&&a.pos>-1?a:null,o=a&&a.pos<0,l=new RY(this,s&&s.node,e);DY(this.node,this.innerDeco,(u,c,f)=>{u.spec.marks?l.syncToMarks(u.spec.marks,n,e,c):u.type.side>=0&&!f&&l.syncToMarks(c==this.node.childCount?wn.none:this.node.child(c).marks,n,e,c),l.placeWidget(u,e,i)},(u,c,f,p)=>{l.syncToMarks(u.marks,n,e,p);let v;l.findNodeMatch(u,c,f,p)||o&&e.state.selection.from>i&&e.state.selection.to<i+u.nodeSize&&(v=l.findIndexWithChild(a.node))>-1&&l.updateNodeAt(u,c,f,v,e)||l.updateNextNode(u,c,f,e,p,i)||l.addNode(u,c,f,e,i),i+=u.nodeSize}),l.syncToMarks([],n,e,0),this.node.isTextblock&&l.addTextblockHacks(),l.destroyRest(),(l.changed||this.dirty==rh)&&(s&&this.protectLocalComposition(e,s),SO(this.contentDOM,this.children,e),Qp&&IY(this.dom))}localCompositionInfo(e,r){let{from:n,to:i}=e.state.selection;if(!(e.state.selection instanceof dr)||n<r||i>r+this.node.content.size)return null;let a=e.input.compositionNode;if(!a||!this.dom.contains(a.parentNode))return null;if(this.node.inlineContent){let s=a.nodeValue,o=jY(this.node.content,s,n-r,i-r);return o<0?null:{node:a,pos:o,text:s}}else return{node:a,pos:-1,text:""}}protectLocalComposition(e,{node:r,pos:n,text:i}){if(this.getDesc(r))return;let a=r;for(;a.parentNode!=this.contentDOM;a=a.parentNode){for(;a.previousSibling;)a.parentNode.removeChild(a.previousSibling);for(;a.nextSibling;)a.parentNode.removeChild(a.nextSibling);a.pmViewDesc&&(a.pmViewDesc=void 0)}let s=new PY(this,a,r,i);e.input.compositionNodes.push(s),this.children=xk(this.children,n,n+i.length,e,s)}update(e,r,n,i){return this.dirty==Pu||!e.sameMarkup(this.node)?!1:(this.updateInner(e,r,n,i),!0)}updateInner(e,r,n,i){this.updateOuterDeco(r),this.node=e,this.innerDeco=n,this.contentDOM&&this.updateChildren(i,this.posAtStart),this.dirty=Jo}updateOuterDeco(e){if(Mx(e,this.outerDeco))return;let r=this.nodeDOM.nodeType!=1,n=this.dom;this.dom=kO(this.dom,this.nodeDOM,yk(this.outerDeco,this.node,r),yk(e,this.node,r)),this.dom!=n&&(n.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=e}selectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.add("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&(this.nodeDOM.draggable=!0))}deselectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.remove("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&this.nodeDOM.removeAttribute("draggable"))}get domAtom(){return this.node.isAtom}}function D3(t,e,r,n,i){_O(n,e,t);let a=new $d(void 0,t,e,r,n,n,n,i,0);return a.contentDOM&&a.updateChildren(i,0),a}class Y1 extends $d{constructor(e,r,n,i,a,s,o){super(e,r,n,i,a,null,s,o,0)}parseRule(){let e=this.nodeDOM.parentNode;for(;e&&e!=this.dom&&!e.pmIsDeco;)e=e.parentNode;return{skip:e||!0}}update(e,r,n,i){return this.dirty==Pu||this.dirty!=Jo&&!this.inParent()||!e.sameMarkup(this.node)?!1:(this.updateOuterDeco(r),(this.dirty!=Jo||e.text!=this.node.text)&&e.text!=this.nodeDOM.nodeValue&&(this.nodeDOM.nodeValue=e.text,i.trackWrites==this.nodeDOM&&(i.trackWrites=null)),this.node=e,this.dirty=Jo,!0)}inParent(){let e=this.parent.contentDOM;for(let r=this.nodeDOM;r;r=r.parentNode)if(r==e)return!0;return!1}domFromPos(e){return{node:this.nodeDOM,offset:e}}localPosFromDOM(e,r,n){return e==this.nodeDOM?this.posAtStart+Math.min(r,this.node.text.length):super.localPosFromDOM(e,r,n)}ignoreMutation(e){return e.type!="characterData"&&e.type!="selection"}slice(e,r,n){let i=this.node.cut(e,r),a=document.createTextNode(i.text);return new Y1(this.parent,i,this.outerDeco,this.innerDeco,a,a,n)}markDirty(e,r){super.markDirty(e,r),this.dom!=this.nodeDOM&&(e==0||r==this.nodeDOM.nodeValue.length)&&(this.dirty=Pu)}get domAtom(){return!1}isText(e){return this.node.text==e}}class wO extends f0{parseRule(){return{ignore:!0}}matchesHack(e){return this.dirty==Jo&&this.dom.nodeName==e}get domAtom(){return!0}get ignoreForCoords(){return this.dom.nodeName=="IMG"}}class MY extends $d{constructor(e,r,n,i,a,s,o,l,u,c){super(e,r,n,i,a,s,o,u,c),this.spec=l}update(e,r,n,i){if(this.dirty==Pu)return!1;if(this.spec.update&&(this.node.type==e.type||this.spec.multiType)){let a=this.spec.update(e,r,n);return a&&this.updateInner(e,r,n,i),a}else return!this.contentDOM&&!e.isLeaf?!1:super.update(e,r,n,i)}selectNode(){this.spec.selectNode?this.spec.selectNode():super.selectNode()}deselectNode(){this.spec.deselectNode?this.spec.deselectNode():super.deselectNode()}setSelection(e,r,n,i){this.spec.setSelection?this.spec.setSelection(e,r,n.root):super.setSelection(e,r,n,i)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}stopEvent(e){return this.spec.stopEvent?this.spec.stopEvent(e):!1}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}}function SO(t,e,r){let n=t.firstChild,i=!1;for(let a=0;a<e.length;a++){let s=e[a],o=s.dom;if(o.parentNode==t){for(;o!=n;)n=I3(n),i=!0;n=n.nextSibling}else i=!0,t.insertBefore(o,n);if(s instanceof _h){let l=n?n.previousSibling:t.lastChild;SO(s.contentDOM,s.children,r),n=l?l.nextSibling:t.firstChild}}for(;n;)n=I3(n),i=!0;i&&r.trackWrites==t&&(r.trackWrites=null)}const sv=function(t){t&&(this.nodeName=t)};sv.prototype=Object.create(null);const nh=[new sv];function yk(t,e,r){if(t.length==0)return nh;let n=r?nh[0]:new sv,i=[n];for(let a=0;a<t.length;a++){let s=t[a].type.attrs;if(s){s.nodeName&&i.push(n=new sv(s.nodeName));for(let o in s){let l=s[o];l!=null&&(r&&i.length==1&&i.push(n=new sv(e.isInline?"span":"div")),o=="class"?n.class=(n.class?n.class+" ":"")+l:o=="style"?n.style=(n.style?n.style+";":"")+l:o!="nodeName"&&(n[o]=l))}}}return i}function kO(t,e,r,n){if(r==nh&&n==nh)return e;let i=e;for(let a=0;a<n.length;a++){let s=n[a],o=r[a];if(a){let l;o&&o.nodeName==s.nodeName&&i!=t&&(l=i.parentNode)&&l.nodeName.toLowerCase()==s.nodeName||(l=document.createElement(s.nodeName),l.pmIsDeco=!0,l.appendChild(i),o=nh[0]),i=l}AY(i,o||nh[0],s)}return i}function AY(t,e,r){for(let n in e)n!="class"&&n!="style"&&n!="nodeName"&&!(n in r)&&t.removeAttribute(n);for(let n in r)n!="class"&&n!="style"&&n!="nodeName"&&r[n]!=e[n]&&t.setAttribute(n,r[n]);if(e.class!=r.class){let n=e.class?e.class.split(" ").filter(Boolean):[],i=r.class?r.class.split(" ").filter(Boolean):[];for(let a=0;a<n.length;a++)i.indexOf(n[a])==-1&&t.classList.remove(n[a]);for(let a=0;a<i.length;a++)n.indexOf(i[a])==-1&&t.classList.add(i[a]);t.classList.length==0&&t.removeAttribute("class")}if(e.style!=r.style){if(e.style){let n=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g,i;for(;i=n.exec(e.style);)t.style.removeProperty(i[1])}r.style&&(t.style.cssText+=r.style)}}function _O(t,e,r){return kO(t,t,nh,yk(e,r,t.nodeType!=1))}function Mx(t,e){if(t.length!=e.length)return!1;for(let r=0;r<t.length;r++)if(!t[r].type.eq(e[r].type))return!1;return!0}function I3(t){let e=t.nextSibling;return t.parentNode.removeChild(t),e}class RY{constructor(e,r,n){this.lock=r,this.view=n,this.index=0,this.stack=[],this.changed=!1,this.top=e,this.preMatch=LY(e.node.content,e)}destroyBetween(e,r){if(e!=r){for(let n=e;n<r;n++)this.top.children[n].destroy();this.top.children.splice(e,r-e),this.changed=!0}}destroyRest(){this.destroyBetween(this.index,this.top.children.length)}syncToMarks(e,r,n,i){let a=0,s=this.stack.length>>1,o=Math.min(s,e.length);for(;a<o&&(a==s-1?this.top:this.stack[a+1<<1]).matchesMark(e[a])&&e[a].type.spec.spanning!==!1;)a++;for(;a<s;)this.destroyRest(),this.top.dirty=Jo,this.index=this.stack.pop(),this.top=this.stack.pop(),s--;for(;s<e.length;){this.stack.push(this.top,this.index+1);let l=-1,u=this.top.children.length;i<this.preMatch.index&&(u=Math.min(this.index+3,u));for(let c=this.index;c<u;c++){let f=this.top.children[c];if(f.matchesMark(e[s])&&!this.isLocked(f.dom)){l=c;break}}if(l>-1)l>this.index&&(this.changed=!0,this.destroyBetween(this.index,l)),this.top=this.top.children[this.index];else{let c=_h.create(this.top,e[s],r,n);this.top.children.splice(this.index,0,c),this.top=c,this.changed=!0}this.index=0,s++}}findNodeMatch(e,r,n,i){let a=-1,s;if(i>=this.preMatch.index&&(s=this.preMatch.matches[i-this.preMatch.index]).parent==this.top&&s.matchesNode(e,r,n))a=this.top.children.indexOf(s,this.index);else for(let o=this.index,l=Math.min(this.top.children.length,o+5);o<l;o++){let u=this.top.children[o];if(u.matchesNode(e,r,n)&&!this.preMatch.matched.has(u)){a=o;break}}return a<0?!1:(this.destroyBetween(this.index,a),this.index++,!0)}updateNodeAt(e,r,n,i,a){let s=this.top.children[i];return s.dirty==Pu&&s.dom==s.contentDOM&&(s.dirty=rh),s.update(e,r,n,a)?(this.destroyBetween(this.index,i),this.index++,!0):!1}findIndexWithChild(e){for(;;){let r=e.parentNode;if(!r)return-1;if(r==this.top.contentDOM){let n=e.pmViewDesc;if(n){for(let i=this.index;i<this.top.children.length;i++)if(this.top.children[i]==n)return i}return-1}e=r}}updateNextNode(e,r,n,i,a,s){for(let o=this.index;o<this.top.children.length;o++){let l=this.top.children[o];if(l instanceof $d){let u=this.preMatch.matched.get(l);if(u!=null&&u!=a)return!1;let c=l.dom,f,p=this.isLocked(c)&&!(e.isText&&l.node&&l.node.isText&&l.nodeDOM.nodeValue==e.text&&l.dirty!=Pu&&Mx(r,l.outerDeco));if(!p&&l.update(e,r,n,i))return this.destroyBetween(this.index,o),l.dom!=c&&(this.changed=!0),this.index++,!0;if(!p&&(f=this.recreateWrapper(l,e,r,n,i,s)))return this.destroyBetween(this.index,o),this.top.children[this.index]=f,f.contentDOM&&(f.dirty=rh,f.updateChildren(i,s+1),f.dirty=Jo),this.changed=!0,this.index++,!0;break}}return!1}recreateWrapper(e,r,n,i,a,s){if(e.dirty||r.isAtom||!e.children.length||!e.node.content.eq(r.content)||!Mx(n,e.outerDeco)||!i.eq(e.innerDeco))return null;let o=$d.create(this.top,r,n,i,a,s);if(o.contentDOM){o.children=e.children,e.children=[];for(let l of o.children)l.parent=o}return e.destroy(),o}addNode(e,r,n,i,a){let s=$d.create(this.top,e,r,n,i,a);s.contentDOM&&s.updateChildren(i,a+1),this.top.children.splice(this.index++,0,s),this.changed=!0}placeWidget(e,r,n){let i=this.index<this.top.children.length?this.top.children[this.index]:null;if(i&&i.matchesWidget(e)&&(e==i.widget||!i.widget.type.toDOM.parentNode))this.index++;else{let a=new bO(this.top,e,r,n);this.top.children.splice(this.index++,0,a),this.changed=!0}}addTextblockHacks(){let e=this.top.children[this.index-1],r=this.top;for(;e instanceof _h;)r=e,e=r.children[r.children.length-1];(!e||!(e instanceof Y1)||/\n$/.test(e.node.text)||this.view.requiresGeckoHackNode&&/\s$/.test(e.node.text))&&((Ga||ma)&&e&&e.dom.contentEditable=="false"&&this.addHackNode("IMG",r),this.addHackNode("BR",this.top))}addHackNode(e,r){if(r==this.top&&this.index<r.children.length&&r.children[this.index].matchesHack(e))this.index++;else{let n=document.createElement(e);e=="IMG"&&(n.className="ProseMirror-separator",n.alt=""),e=="BR"&&(n.className="ProseMirror-trailingBreak");let i=new wO(this.top,[],n,null);r!=this.top?r.children.push(i):r.children.splice(this.index++,0,i),this.changed=!0}}isLocked(e){return this.lock&&(e==this.lock||e.nodeType==1&&e.contains(this.lock.parentNode))}}function LY(t,e){let r=e,n=r.children.length,i=t.childCount,a=new Map,s=[];e:for(;i>0;){let o;for(;;)if(n){let u=r.children[n-1];if(u instanceof _h)r=u,n=u.children.length;else{o=u,n--;break}}else{if(r==e)break e;n=r.parent.children.indexOf(r),r=r.parent}let l=o.node;if(l){if(l!=t.child(i-1))break;--i,a.set(o,i),s.push(o)}}return{index:i,matched:a,matches:s.reverse()}}function OY(t,e){return t.type.side-e.type.side}function DY(t,e,r,n){let i=e.locals(t),a=0;if(i.length==0){for(let u=0;u<t.childCount;u++){let c=t.child(u);n(c,i,e.forChild(a,c),u),a+=c.nodeSize}return}let s=0,o=[],l=null;for(let u=0;;){let c,f;for(;s<i.length&&i[s].to==a;){let w=i[s++];w.widget&&(c?(f||(f=[c])).push(w):c=w)}if(c)if(f){f.sort(OY);for(let w=0;w<f.length;w++)r(f[w],u,!!l)}else r(c,u,!!l);let p,v;if(l)v=-1,p=l,l=null;else if(u<t.childCount)v=u,p=t.child(u++);else break;for(let w=0;w<o.length;w++)o[w].to<=a&&o.splice(w--,1);for(;s<i.length&&i[s].from<=a&&i[s].to>a;)o.push(i[s++]);let y=a+p.nodeSize;if(p.isText){let w=y;s<i.length&&i[s].from<w&&(w=i[s].from);for(let E=0;E<o.length;E++)o[E].to<w&&(w=o[E].to);w<y&&(l=p.cut(w-a),p=p.cut(0,w-a),y=w,v=-1)}else for(;s<i.length&&i[s].to<y;)s++;let S=p.isInline&&!p.isLeaf?o.filter(w=>!w.inline):o.slice();n(p,S,e.forChild(a,p),v),a=y}}function IY(t){if(t.nodeName=="UL"||t.nodeName=="OL"){let e=t.style.cssText;t.style.cssText=e+"; list-style: square !important",window.getComputedStyle(t).listStyle,t.style.cssText=e}}function jY(t,e,r,n){for(let i=0,a=0;i<t.childCount&&a<=n;){let s=t.child(i++),o=a;if(a+=s.nodeSize,!s.isText)continue;let l=s.text;for(;i<t.childCount;){let u=t.child(i++);if(a+=u.nodeSize,!u.isText)break;l+=u.text}if(a>=r){if(a>=n&&l.slice(n-e.length-o,n-o)==e)return n-e.length;let u=o<n?l.lastIndexOf(e,n-o-1):-1;if(u>=0&&u+e.length+o>=r)return o+u;if(r==n&&l.length>=n+e.length-o&&l.slice(n-o,n-o+e.length)==e)return n}}return-1}function xk(t,e,r,n,i){let a=[];for(let s=0,o=0;s<t.length;s++){let l=t[s],u=o,c=o+=l.size;u>=r||c<=e?a.push(l):(u<e&&a.push(l.slice(0,e-u,n)),i&&(a.push(i),i=void 0),c>r&&a.push(l.slice(r-u,l.size,n)))}return a}function W_(t,e=null){let r=t.domSelectionRange(),n=t.state.doc;if(!r.focusNode)return null;let i=t.docView.nearestDesc(r.focusNode),a=i&&i.size==0,s=t.docView.posFromDOM(r.focusNode,r.focusOffset,1);if(s<0)return null;let o=n.resolve(s),l,u;if(Z1(r)){for(l=s;i&&!i.node;)i=i.parent;let f=i.node;if(i&&f.isAtom&&Xt.isSelectable(f)&&i.parent&&!(f.isInline&&cY(r.focusNode,r.focusOffset,i.dom))){let p=i.posBefore;u=new Xt(s==p?o:n.resolve(p))}}else{if(r instanceof t.dom.ownerDocument.defaultView.Selection&&r.rangeCount>1){let f=s,p=s;for(let v=0;v<r.rangeCount;v++){let y=r.getRangeAt(v);f=Math.min(f,t.docView.posFromDOM(y.startContainer,y.startOffset,1)),p=Math.max(p,t.docView.posFromDOM(y.endContainer,y.endOffset,-1))}if(f<0)return null;[l,s]=p==t.state.selection.anchor?[p,f]:[f,p],o=n.resolve(s)}else l=t.docView.posFromDOM(r.anchorNode,r.anchorOffset,1);if(l<0)return null}let c=n.resolve(l);if(!u){let f=e=="pointer"||t.state.selection.head<o.pos&&!a?1:-1;u=q_(t,c,o,f)}return u}function CO(t){return t.editable?t.hasFocus():TO(t)&&document.activeElement&&document.activeElement.contains(t.dom)}function gc(t,e=!1){let r=t.state.selection;if(EO(t,r),!!CO(t)){if(!e&&t.input.mouseDown&&t.input.mouseDown.allowDefault&&ma){let n=t.domSelectionRange(),i=t.domObserver.currentSelection;if(n.anchorNode&&i.anchorNode&&kh(n.anchorNode,n.anchorOffset,i.anchorNode,i.anchorOffset)){t.input.mouseDown.delayedSelectionSync=!0,t.domObserver.setCurSelection();return}}if(t.domObserver.disconnectSelection(),t.cursorWrapper)BY(t);else{let{anchor:n,head:i}=r,a,s;j3&&!(r instanceof dr)&&(r.$from.parent.inlineContent||(a=F3(t,r.from)),!r.empty&&!r.$from.parent.inlineContent&&(s=F3(t,r.to))),t.docView.setSelection(n,i,t,e),j3&&(a&&B3(a),s&&B3(s)),r.visible?t.dom.classList.remove("ProseMirror-hideselection"):(t.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&FY(t))}t.domObserver.setCurSelection(),t.domObserver.connectSelection()}}const j3=Ga||ma&&fO<63;function F3(t,e){let{node:r,offset:n}=t.docView.domFromPos(e,0),i=n<r.childNodes.length?r.childNodes[n]:null,a=n?r.childNodes[n-1]:null;if(Ga&&i&&i.contentEditable=="false")return iS(i);if((!i||i.contentEditable=="false")&&(!a||a.contentEditable=="false")){if(i)return iS(i);if(a)return iS(a)}}function iS(t){return t.contentEditable="true",Ga&&t.draggable&&(t.draggable=!1,t.wasDraggable=!0),t}function B3(t){t.contentEditable="false",t.wasDraggable&&(t.draggable=!0,t.wasDraggable=null)}function FY(t){let e=t.dom.ownerDocument;e.removeEventListener("selectionchange",t.input.hideSelectionGuard);let r=t.domSelectionRange(),n=r.anchorNode,i=r.anchorOffset;e.addEventListener("selectionchange",t.input.hideSelectionGuard=()=>{(r.anchorNode!=n||r.anchorOffset!=i)&&(e.removeEventListener("selectionchange",t.input.hideSelectionGuard),setTimeout(()=>{(!CO(t)||t.state.selection.visible)&&t.dom.classList.remove("ProseMirror-hideselection")},20))})}function BY(t){let e=t.domSelection();if(!e)return;let r=t.cursorWrapper.dom,n=r.nodeName=="IMG";n?e.collapse(r.parentNode,Fa(r)+1):e.collapse(r,0),!n&&!t.state.selection.visible&&Xs&&qd<=11&&(r.disabled=!0,r.disabled=!1)}function EO(t,e){if(e instanceof Xt){let r=t.docView.descAt(e.from);r!=t.lastSelectedViewDesc&&(z3(t),r&&r.selectNode(),t.lastSelectedViewDesc=r)}else z3(t)}function z3(t){t.lastSelectedViewDesc&&(t.lastSelectedViewDesc.parent&&t.lastSelectedViewDesc.deselectNode(),t.lastSelectedViewDesc=void 0)}function q_(t,e,r,n){return t.someProp("createSelectionBetween",i=>i(t,e,r))||dr.between(e,r,n)}function U3(t){return t.editable&&!t.hasFocus()?!1:TO(t)}function TO(t){let e=t.domSelectionRange();if(!e.anchorNode)return!1;try{return t.dom.contains(e.anchorNode.nodeType==3?e.anchorNode.parentNode:e.anchorNode)&&(t.editable||t.dom.contains(e.focusNode.nodeType==3?e.focusNode.parentNode:e.focusNode))}catch{return!1}}function zY(t){let e=t.docView.domFromPos(t.state.selection.anchor,0),r=t.domSelectionRange();return kh(e.node,e.offset,r.anchorNode,r.anchorOffset)}function bk(t,e){let{$anchor:r,$head:n}=t.selection,i=e>0?r.max(n):r.min(n),a=i.parent.inlineContent?i.depth?t.doc.resolve(e>0?i.after():i.before()):null:i;return a&&Sr.findFrom(a,e)}function Td(t,e){return t.dispatch(t.state.tr.setSelection(e).scrollIntoView()),!0}function G3(t,e,r){let n=t.state.selection;if(n instanceof dr)if(r.indexOf("s")>-1){let{$head:i}=n,a=i.textOffset?null:e<0?i.nodeBefore:i.nodeAfter;if(!a||a.isText||!a.isLeaf)return!1;let s=t.state.doc.resolve(i.pos+a.nodeSize*(e<0?-1:1));return Td(t,new dr(n.$anchor,s))}else if(n.empty){if(t.endOfTextblock(e>0?"forward":"backward")){let i=bk(t.state,e);return i&&i instanceof Xt?Td(t,i):!1}else if(!($o&&r.indexOf("m")>-1)){let i=n.$head,a=i.textOffset?null:e<0?i.nodeBefore:i.nodeAfter,s;if(!a||a.isText)return!1;let o=e<0?i.pos-a.nodeSize:i.pos;return a.isAtom||(s=t.docView.descAt(o))&&!s.contentDOM?Xt.isSelectable(a)?Td(t,new Xt(e<0?t.state.doc.resolve(i.pos-a.nodeSize):i)):d0?Td(t,new dr(t.state.doc.resolve(e<0?o:o+a.nodeSize))):!1:!1}}else return!1;else{if(n instanceof Xt&&n.node.isInline)return Td(t,new dr(e>0?n.$to:n.$from));{let i=bk(t.state,e);return i?Td(t,i):!1}}}function Ax(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}function ov(t,e){let r=t.pmViewDesc;return r&&r.size==0&&(e<0||t.nextSibling||t.nodeName!="BR")}function _p(t,e){return e<0?UY(t):GY(t)}function UY(t){let e=t.domSelectionRange(),r=e.focusNode,n=e.focusOffset;if(!r)return;let i,a,s=!1;for(Qo&&r.nodeType==1&&n<Ax(r)&&ov(r.childNodes[n],-1)&&(s=!0);;)if(n>0){if(r.nodeType!=1)break;{let o=r.childNodes[n-1];if(ov(o,-1))i=r,a=--n;else if(o.nodeType==3)r=o,n=r.nodeValue.length;else break}}else{if(NO(r))break;{let o=r.previousSibling;for(;o&&ov(o,-1);)i=r.parentNode,a=Fa(o),o=o.previousSibling;if(o)r=o,n=Ax(r);else{if(r=r.parentNode,r==t.dom)break;n=0}}}s?wk(t,r,n):i&&wk(t,i,a)}function GY(t){let e=t.domSelectionRange(),r=e.focusNode,n=e.focusOffset;if(!r)return;let i=Ax(r),a,s;for(;;)if(n<i){if(r.nodeType!=1)break;let o=r.childNodes[n];if(ov(o,1))a=r,s=++n;else break}else{if(NO(r))break;{let o=r.nextSibling;for(;o&&ov(o,1);)a=o.parentNode,s=Fa(o)+1,o=o.nextSibling;if(o)r=o,n=0,i=Ax(r);else{if(r=r.parentNode,r==t.dom)break;n=i=0}}}a&&wk(t,a,s)}function NO(t){let e=t.pmViewDesc;return e&&e.node&&e.node.isBlock}function VY(t,e){for(;t&&e==t.childNodes.length&&!c0(t);)e=Fa(t)+1,t=t.parentNode;for(;t&&e<t.childNodes.length;){let r=t.childNodes[e];if(r.nodeType==3)return r;if(r.nodeType==1&&r.contentEditable=="false")break;t=r,e=0}}function HY(t,e){for(;t&&!e&&!c0(t);)e=Fa(t),t=t.parentNode;for(;t&&e;){let r=t.childNodes[e-1];if(r.nodeType==3)return r;if(r.nodeType==1&&r.contentEditable=="false")break;t=r,e=t.childNodes.length}}function wk(t,e,r){if(e.nodeType!=3){let a,s;(s=VY(e,r))?(e=s,r=0):(a=HY(e,r))&&(e=a,r=a.nodeValue.length)}let n=t.domSelection();if(!n)return;if(Z1(n)){let a=document.createRange();a.setEnd(e,r),a.setStart(e,r),n.removeAllRanges(),n.addRange(a)}else n.extend&&n.extend(e,r);t.domObserver.setCurSelection();let{state:i}=t;setTimeout(()=>{t.state==i&&gc(t)},50)}function V3(t,e){let r=t.state.doc.resolve(e);if(!(ma||hO)&&r.parent.inlineContent){let i=t.coordsAtPos(e);if(e>r.start()){let a=t.coordsAtPos(e-1),s=(a.top+a.bottom)/2;if(s>i.top&&s<i.bottom&&Math.abs(a.left-i.left)>1)return a.left<i.left?"ltr":"rtl"}if(e<r.end()){let a=t.coordsAtPos(e+1),s=(a.top+a.bottom)/2;if(s>i.top&&s<i.bottom&&Math.abs(a.left-i.left)>1)return a.left>i.left?"ltr":"rtl"}}return getComputedStyle(t.dom).direction=="rtl"?"rtl":"ltr"}function H3(t,e,r){let n=t.state.selection;if(n instanceof dr&&!n.empty||r.indexOf("s")>-1||$o&&r.indexOf("m")>-1)return!1;let{$from:i,$to:a}=n;if(!i.parent.inlineContent||t.endOfTextblock(e<0?"up":"down")){let s=bk(t.state,e);if(s&&s instanceof Xt)return Td(t,s)}if(!i.parent.inlineContent){let s=e<0?i:a,o=n instanceof vo?Sr.near(s,e):Sr.findFrom(s,e);return o?Td(t,o):!1}return!1}function W3(t,e){if(!(t.state.selection instanceof dr))return!0;let{$head:r,$anchor:n,empty:i}=t.state.selection;if(!r.sameParent(n))return!0;if(!i)return!1;if(t.endOfTextblock(e>0?"forward":"backward"))return!0;let a=!r.textOffset&&(e<0?r.nodeBefore:r.nodeAfter);if(a&&!a.isText){let s=t.state.tr;return e<0?s.delete(r.pos-a.nodeSize,r.pos):s.delete(r.pos,r.pos+a.nodeSize),t.dispatch(s),!0}return!1}function q3(t,e,r){t.domObserver.stop(),e.contentEditable=r,t.domObserver.start()}function WY(t){if(!Ga||t.state.selection.$head.parentOffset>0)return!1;let{focusNode:e,focusOffset:r}=t.domSelectionRange();if(e&&e.nodeType==1&&r==0&&e.firstChild&&e.firstChild.contentEditable=="false"){let n=e.firstChild;q3(t,n,"true"),setTimeout(()=>q3(t,n,"false"),20)}return!1}function qY(t){let e="";return t.ctrlKey&&(e+="c"),t.metaKey&&(e+="m"),t.altKey&&(e+="a"),t.shiftKey&&(e+="s"),e}function $Y(t,e){let r=e.keyCode,n=qY(e);if(r==8||$o&&r==72&&n=="c")return W3(t,-1)||_p(t,-1);if(r==46&&!e.shiftKey||$o&&r==68&&n=="c")return W3(t,1)||_p(t,1);if(r==13||r==27)return!0;if(r==37||$o&&r==66&&n=="c"){let i=r==37?V3(t,t.state.selection.from)=="ltr"?-1:1:-1;return G3(t,i,n)||_p(t,i)}else if(r==39||$o&&r==70&&n=="c"){let i=r==39?V3(t,t.state.selection.from)=="ltr"?1:-1:1;return G3(t,i,n)||_p(t,i)}else{if(r==38||$o&&r==80&&n=="c")return H3(t,-1,n)||_p(t,-1);if(r==40||$o&&r==78&&n=="c")return WY(t)||H3(t,1,n)||_p(t,1);if(n==($o?"m":"c")&&(r==66||r==73||r==89||r==90))return!0}return!1}function $_(t,e){t.someProp("transformCopied",v=>{e=v(e,t)});let r=[],{content:n,openStart:i,openEnd:a}=e;for(;i>1&&a>1&&n.childCount==1&&n.firstChild.childCount==1;){i--,a--;let v=n.firstChild;r.push(v.type.name,v.attrs!=v.type.defaultAttrs?v.attrs:null),n=v.content}let s=t.someProp("clipboardSerializer")||Ah.fromSchema(t.state.schema),o=OO(),l=o.createElement("div");l.appendChild(s.serializeFragment(n,{document:o}));let u=l.firstChild,c,f=0;for(;u&&u.nodeType==1&&(c=LO[u.nodeName.toLowerCase()]);){for(let v=c.length-1;v>=0;v--){let y=o.createElement(c[v]);for(;l.firstChild;)y.appendChild(l.firstChild);l.appendChild(y),f++}u=l.firstChild}u&&u.nodeType==1&&u.setAttribute("data-pm-slice",`${i} ${a}${f?` -${f}`:""} ${JSON.stringify(r)}`);let p=t.someProp("clipboardTextSerializer",v=>v(e,t))||e.content.textBetween(0,e.content.size,`

`);return{dom:l,text:p,slice:e}}function PO(t,e,r,n,i){let a=i.parent.type.spec.code,s,o;if(!r&&!e)return null;let l=!!e&&(n||a||!r);if(l){if(t.someProp("transformPastedText",p=>{e=p(e,a||n,t)}),a)return o=new Pt(it.from(t.state.schema.text(e.replace(/\r\n?/g,`
`))),0,0),t.someProp("transformPasted",p=>{o=p(o,t,!0)}),o;let f=t.someProp("clipboardTextParser",p=>p(e,i,n,t));if(f)o=f;else{let p=i.marks(),{schema:v}=t.state,y=Ah.fromSchema(v);s=document.createElement("div"),e.split(/(?:\r\n?|\n)+/).forEach(S=>{let w=s.appendChild(document.createElement("p"));S&&w.appendChild(y.serializeNode(v.text(S,p)))})}}else t.someProp("transformPastedHTML",f=>{r=f(r,t)}),s=XY(r),d0&&QY(s);let u=s&&s.querySelector("[data-pm-slice]"),c=u&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(u.getAttribute("data-pm-slice")||"");if(c&&c[3])for(let f=+c[3];f>0;f--){let p=s.firstChild;for(;p&&p.nodeType!=1;)p=p.nextSibling;if(!p)break;s=p}if(o||(o=(t.someProp("clipboardParser")||t.someProp("domParser")||Wd.fromSchema(t.state.schema)).parseSlice(s,{preserveWhitespace:!!(l||c),context:i,ruleFromNode(p){return p.nodeName=="BR"&&!p.nextSibling&&p.parentNode&&!KY.test(p.parentNode.nodeName)?{ignore:!0}:null}})),c)o=JY($3(o,+c[1],+c[2]),c[4]);else if(o=Pt.maxOpen(ZY(o.content,i),!0),o.openStart||o.openEnd){let f=0,p=0;for(let v=o.content.firstChild;f<o.openStart&&!v.type.spec.isolating;f++,v=v.firstChild);for(let v=o.content.lastChild;p<o.openEnd&&!v.type.spec.isolating;p++,v=v.lastChild);o=$3(o,f,p)}return t.someProp("transformPasted",f=>{o=f(o,t,l)}),o}const KY=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function ZY(t,e){if(t.childCount<2)return t;for(let r=e.depth;r>=0;r--){let i=e.node(r).contentMatchAt(e.index(r)),a,s=[];if(t.forEach(o=>{if(!s)return;let l=i.findWrapping(o.type),u;if(!l)return s=null;if(u=s.length&&a.length&&AO(l,a,o,s[s.length-1],0))s[s.length-1]=u;else{s.length&&(s[s.length-1]=RO(s[s.length-1],a.length));let c=MO(o,l);s.push(c),i=i.matchType(c.type),a=l}}),s)return it.from(s)}return t}function MO(t,e,r=0){for(let n=e.length-1;n>=r;n--)t=e[n].create(null,it.from(t));return t}function AO(t,e,r,n,i){if(i<t.length&&i<e.length&&t[i]==e[i]){let a=AO(t,e,r,n.lastChild,i+1);if(a)return n.copy(n.content.replaceChild(n.childCount-1,a));if(n.contentMatchAt(n.childCount).matchType(i==t.length-1?r.type:t[i+1]))return n.copy(n.content.append(it.from(MO(r,t,i+1))))}}function RO(t,e){if(e==0)return t;let r=t.content.replaceChild(t.childCount-1,RO(t.lastChild,e-1)),n=t.contentMatchAt(t.childCount).fillBefore(it.empty,!0);return t.copy(r.append(n))}function Sk(t,e,r,n,i,a){let s=e<0?t.firstChild:t.lastChild,o=s.content;return t.childCount>1&&(a=0),i<n-1&&(o=Sk(o,e,r,n,i+1,a)),i>=r&&(o=e<0?s.contentMatchAt(0).fillBefore(o,a<=i).append(o):o.append(s.contentMatchAt(s.childCount).fillBefore(it.empty,!0))),t.replaceChild(e<0?0:t.childCount-1,s.copy(o))}function $3(t,e,r){return e<t.openStart&&(t=new Pt(Sk(t.content,-1,e,t.openStart,0,t.openEnd),e,t.openEnd)),r<t.openEnd&&(t=new Pt(Sk(t.content,1,r,t.openEnd,0,0),t.openStart,r)),t}const LO={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};let K3=null;function OO(){return K3||(K3=document.implementation.createHTMLDocument("title"))}let aS=null;function YY(t){let e=window.trustedTypes;return e?(aS||(aS=e.defaultPolicy||e.createPolicy("ProseMirrorClipboard",{createHTML:r=>r})),aS.createHTML(t)):t}function XY(t){let e=/^(\s*<meta [^>]*>)*/.exec(t);e&&(t=t.slice(e[0].length));let r=OO().createElement("div"),n=/<([a-z][^>\s]+)/i.exec(t),i;if((i=n&&LO[n[1].toLowerCase()])&&(t=i.map(a=>"<"+a+">").join("")+t+i.map(a=>"</"+a+">").reverse().join("")),r.innerHTML=YY(t),i)for(let a=0;a<i.length;a++)r=r.querySelector(i[a])||r;return r}function QY(t){let e=t.querySelectorAll(ma?"span:not([class]):not([style])":"span.Apple-converted-space");for(let r=0;r<e.length;r++){let n=e[r];n.childNodes.length==1&&n.textContent==""&&n.parentNode&&n.parentNode.replaceChild(t.ownerDocument.createTextNode(" "),n)}}function JY(t,e){if(!t.size)return t;let r=t.content.firstChild.type.schema,n;try{n=JSON.parse(e)}catch{return t}let{content:i,openStart:a,openEnd:s}=t;for(let o=n.length-2;o>=0;o-=2){let l=r.nodes[n[o]];if(!l||l.hasRequiredAttrs())break;i=it.from(l.create(n[o+1],i)),a++,s++}return new Pt(i,a,s)}const Ts={},Ns={},eX={touchstart:!0,touchmove:!0};class tX{constructor(){this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:"",button:0},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastFocus=0,this.lastTouch=0,this.lastChromeDelete=0,this.composing=!1,this.compositionNode=null,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.compositionID=1,this.badSafariComposition=!1,this.compositionPendingChanges=0,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null}}function rX(t){for(let e in Ts){let r=Ts[e];t.dom.addEventListener(e,t.input.eventHandlers[e]=n=>{iX(t,n)&&!K_(t,n)&&(t.editable||!(n.type in Ns))&&r(t,n)},eX[e]?{passive:!0}:void 0)}Ga&&t.dom.addEventListener("input",()=>null),kk(t)}function Bd(t,e){t.input.lastSelectionOrigin=e,t.input.lastSelectionTime=Date.now()}function nX(t){t.domObserver.stop();for(let e in t.input.eventHandlers)t.dom.removeEventListener(e,t.input.eventHandlers[e]);clearTimeout(t.input.composingTimeout),clearTimeout(t.input.lastIOSEnterFallbackTimeout)}function kk(t){t.someProp("handleDOMEvents",e=>{for(let r in e)t.input.eventHandlers[r]||t.dom.addEventListener(r,t.input.eventHandlers[r]=n=>K_(t,n))})}function K_(t,e){return t.someProp("handleDOMEvents",r=>{let n=r[e.type];return n?n(t,e)||e.defaultPrevented:!1})}function iX(t,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let r=e.target;r!=t.dom;r=r.parentNode)if(!r||r.nodeType==11||r.pmViewDesc&&r.pmViewDesc.stopEvent(e))return!1;return!0}function aX(t,e){!K_(t,e)&&Ts[e.type]&&(t.editable||!(e.type in Ns))&&Ts[e.type](t,e)}Ns.keydown=(t,e)=>{let r=e;if(t.input.shiftKey=r.keyCode==16||r.shiftKey,!IO(t,r)&&(t.input.lastKeyCode=r.keyCode,t.input.lastKeyCodeTime=Date.now(),!(hc&&ma&&r.keyCode==13)))if(r.keyCode!=229&&t.domObserver.forceFlush(),Qp&&r.keyCode==13&&!r.ctrlKey&&!r.altKey&&!r.metaKey){let n=Date.now();t.input.lastIOSEnter=n,t.input.lastIOSEnterFallbackTimeout=setTimeout(()=>{t.input.lastIOSEnter==n&&(t.someProp("handleKeyDown",i=>i(t,eh(13,"Enter"))),t.input.lastIOSEnter=0)},200)}else t.someProp("handleKeyDown",n=>n(t,r))||$Y(t,r)?r.preventDefault():Bd(t,"key")};Ns.keyup=(t,e)=>{e.keyCode==16&&(t.input.shiftKey=!1)};Ns.keypress=(t,e)=>{let r=e;if(IO(t,r)||!r.charCode||r.ctrlKey&&!r.altKey||$o&&r.metaKey)return;if(t.someProp("handleKeyPress",i=>i(t,r))){r.preventDefault();return}let n=t.state.selection;if(!(n instanceof dr)||!n.$from.sameParent(n.$to)){let i=String.fromCharCode(r.charCode),a=()=>t.state.tr.insertText(i).scrollIntoView();!/[\r\n]/.test(i)&&!t.someProp("handleTextInput",s=>s(t,n.$from.pos,n.$to.pos,i,a))&&t.dispatch(a()),r.preventDefault()}};function X1(t){return{left:t.clientX,top:t.clientY}}function sX(t,e){let r=e.x-t.clientX,n=e.y-t.clientY;return r*r+n*n<100}function Z_(t,e,r,n,i){if(n==-1)return!1;let a=t.state.doc.resolve(n);for(let s=a.depth+1;s>0;s--)if(t.someProp(e,o=>s>a.depth?o(t,r,a.nodeAfter,a.before(s),i,!0):o(t,r,a.node(s),a.before(s),i,!1)))return!0;return!1}function Vp(t,e,r){if(t.focused||t.focus(),t.state.selection.eq(e))return;let n=t.state.tr.setSelection(e);n.setMeta("pointer",!0),t.dispatch(n)}function oX(t,e){if(e==-1)return!1;let r=t.state.doc.resolve(e),n=r.nodeAfter;return n&&n.isAtom&&Xt.isSelectable(n)?(Vp(t,new Xt(r)),!0):!1}function lX(t,e){if(e==-1)return!1;let r=t.state.selection,n,i;r instanceof Xt&&(n=r.node);let a=t.state.doc.resolve(e);for(let s=a.depth+1;s>0;s--){let o=s>a.depth?a.nodeAfter:a.node(s);if(Xt.isSelectable(o)){n&&r.$from.depth>0&&s>=r.$from.depth&&a.before(r.$from.depth+1)==r.$from.pos?i=a.before(r.$from.depth):i=a.before(s);break}}return i!=null?(Vp(t,Xt.create(t.state.doc,i)),!0):!1}function uX(t,e,r,n,i){return Z_(t,"handleClickOn",e,r,n)||t.someProp("handleClick",a=>a(t,e,n))||(i?lX(t,r):oX(t,r))}function cX(t,e,r,n){return Z_(t,"handleDoubleClickOn",e,r,n)||t.someProp("handleDoubleClick",i=>i(t,e,n))}function dX(t,e,r,n){return Z_(t,"handleTripleClickOn",e,r,n)||t.someProp("handleTripleClick",i=>i(t,e,n))||fX(t,r,n)}function fX(t,e,r){if(r.button!=0)return!1;let n=t.state.doc;if(e==-1)return n.inlineContent?(Vp(t,dr.create(n,0,n.content.size)),!0):!1;let i=n.resolve(e);for(let a=i.depth+1;a>0;a--){let s=a>i.depth?i.nodeAfter:i.node(a),o=i.before(a);if(s.inlineContent)Vp(t,dr.create(n,o+1,o+1+s.content.size));else if(Xt.isSelectable(s))Vp(t,Xt.create(n,o));else continue;return!0}}function Y_(t){return Rx(t)}const DO=$o?"metaKey":"ctrlKey";Ts.mousedown=(t,e)=>{let r=e;t.input.shiftKey=r.shiftKey;let n=Y_(t),i=Date.now(),a="singleClick";i-t.input.lastClick.time<500&&sX(r,t.input.lastClick)&&!r[DO]&&t.input.lastClick.button==r.button&&(t.input.lastClick.type=="singleClick"?a="doubleClick":t.input.lastClick.type=="doubleClick"&&(a="tripleClick")),t.input.lastClick={time:i,x:r.clientX,y:r.clientY,type:a,button:r.button};let s=t.posAtCoords(X1(r));s&&(a=="singleClick"?(t.input.mouseDown&&t.input.mouseDown.done(),t.input.mouseDown=new hX(t,s,r,!!n)):(a=="doubleClick"?cX:dX)(t,s.pos,s.inside,r)?r.preventDefault():Bd(t,"pointer"))};class hX{constructor(e,r,n,i){this.view=e,this.pos=r,this.event=n,this.flushed=i,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=e.state.doc,this.selectNode=!!n[DO],this.allowDefault=n.shiftKey;let a,s;if(r.inside>-1)a=e.state.doc.nodeAt(r.inside),s=r.inside;else{let c=e.state.doc.resolve(r.pos);a=c.parent,s=c.depth?c.before():0}const o=i?null:n.target,l=o?e.docView.nearestDesc(o,!0):null;this.target=l&&l.nodeDOM.nodeType==1?l.nodeDOM:null;let{selection:u}=e.state;(n.button==0&&a.type.spec.draggable&&a.type.spec.selectable!==!1||u instanceof Xt&&u.from<=s&&u.to>s)&&(this.mightDrag={node:a,pos:s,addAttr:!!(this.target&&!this.target.draggable),setUneditable:!!(this.target&&Qo&&!this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),e.root.addEventListener("mouseup",this.up=this.up.bind(this)),e.root.addEventListener("mousemove",this.move=this.move.bind(this)),Bd(e,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(()=>gc(this.view)),this.view.input.mouseDown=null}up(e){if(this.done(),!this.view.dom.contains(e.target))return;let r=this.pos;this.view.state.doc!=this.startDoc&&(r=this.view.posAtCoords(X1(e))),this.updateAllowDefault(e),this.allowDefault||!r?Bd(this.view,"pointer"):uX(this.view,r.pos,r.inside,e,this.selectNode)?e.preventDefault():e.button==0&&(this.flushed||Ga&&this.mightDrag&&!this.mightDrag.node.isAtom||ma&&!this.view.state.selection.visible&&Math.min(Math.abs(r.pos-this.view.state.selection.from),Math.abs(r.pos-this.view.state.selection.to))<=2)?(Vp(this.view,Sr.near(this.view.state.doc.resolve(r.pos))),e.preventDefault()):Bd(this.view,"pointer")}move(e){this.updateAllowDefault(e),Bd(this.view,"pointer"),e.buttons==0&&this.done()}updateAllowDefault(e){!this.allowDefault&&(Math.abs(this.event.x-e.clientX)>4||Math.abs(this.event.y-e.clientY)>4)&&(this.allowDefault=!0)}}Ts.touchstart=t=>{t.input.lastTouch=Date.now(),Y_(t),Bd(t,"pointer")};Ts.touchmove=t=>{t.input.lastTouch=Date.now(),Bd(t,"pointer")};Ts.contextmenu=t=>Y_(t);function IO(t,e){return t.composing?!0:Ga&&Math.abs(e.timeStamp-t.input.compositionEndedAt)<500?(t.input.compositionEndedAt=-2e8,!0):!1}const pX=hc?5e3:-1;Ns.compositionstart=Ns.compositionupdate=t=>{if(!t.composing){t.domObserver.flush();let{state:e}=t,r=e.selection.$to;if(e.selection instanceof dr&&(e.storedMarks||!r.textOffset&&r.parentOffset&&r.nodeBefore.marks.some(n=>n.type.spec.inclusive===!1)||ma&&hO&&mX(t)))t.markCursor=t.state.storedMarks||r.marks(),Rx(t,!0),t.markCursor=null;else if(Rx(t,!e.selection.empty),Qo&&e.selection.empty&&r.parentOffset&&!r.textOffset&&r.nodeBefore.marks.length){let n=t.domSelectionRange();for(let i=n.focusNode,a=n.focusOffset;i&&i.nodeType==1&&a!=0;){let s=a<0?i.lastChild:i.childNodes[a-1];if(!s)break;if(s.nodeType==3){let o=t.domSelection();o&&o.collapse(s,s.nodeValue.length);break}else i=s,a=-1}}t.input.composing=!0}jO(t,pX)};function mX(t){let{focusNode:e,focusOffset:r}=t.domSelectionRange();if(!e||e.nodeType!=1||r>=e.childNodes.length)return!1;let n=e.childNodes[r];return n.nodeType==1&&n.contentEditable=="false"}Ns.compositionend=(t,e)=>{t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=e.timeStamp,t.input.compositionPendingChanges=t.domObserver.pendingRecords().length?t.input.compositionID:0,t.input.compositionNode=null,t.input.badSafariComposition?t.domObserver.forceFlush():t.input.compositionPendingChanges&&Promise.resolve().then(()=>t.domObserver.flush()),t.input.compositionID++,jO(t,20))};function jO(t,e){clearTimeout(t.input.composingTimeout),e>-1&&(t.input.composingTimeout=setTimeout(()=>Rx(t),e))}function FO(t){for(t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=vX());t.input.compositionNodes.length>0;)t.input.compositionNodes.pop().markParentsDirty()}function gX(t){let e=t.domSelectionRange();if(!e.focusNode)return null;let r=lY(e.focusNode,e.focusOffset),n=uY(e.focusNode,e.focusOffset);if(r&&n&&r!=n){let i=n.pmViewDesc,a=t.domObserver.lastChangedTextNode;if(r==a||n==a)return a;if(!i||!i.isText(n.nodeValue))return n;if(t.input.compositionNode==n){let s=r.pmViewDesc;if(!(!s||!s.isText(r.nodeValue)))return n}}return r||n}function vX(){let t=document.createEvent("Event");return t.initEvent("event",!0,!0),t.timeStamp}function Rx(t,e=!1){if(!(hc&&t.domObserver.flushingSoon>=0)){if(t.domObserver.forceFlush(),FO(t),e||t.docView&&t.docView.dirty){let r=W_(t),n=t.state.selection;return r&&!r.eq(n)?t.dispatch(t.state.tr.setSelection(r)):(t.markCursor||e)&&!n.$from.node(n.$from.sharedDepth(n.to)).inlineContent?t.dispatch(t.state.tr.deleteSelection()):t.updateState(t.state),!0}return!1}}function yX(t,e){if(!t.dom.parentNode)return;let r=t.dom.parentNode.appendChild(document.createElement("div"));r.appendChild(e),r.style.cssText="position: fixed; left: -10000px; top: 10px";let n=getSelection(),i=document.createRange();i.selectNodeContents(e),t.dom.blur(),n.removeAllRanges(),n.addRange(i),setTimeout(()=>{r.parentNode&&r.parentNode.removeChild(r),t.focus()},50)}const jv=Xs&&qd<15||Qp&&hY<604;Ts.copy=Ns.cut=(t,e)=>{let r=e,n=t.state.selection,i=r.type=="cut";if(n.empty)return;let a=jv?null:r.clipboardData,s=n.content(),{dom:o,text:l}=$_(t,s);a?(r.preventDefault(),a.clearData(),a.setData("text/html",o.innerHTML),a.setData("text/plain",l)):yX(t,o),i&&t.dispatch(t.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))};function xX(t){return t.openStart==0&&t.openEnd==0&&t.content.childCount==1?t.content.firstChild:null}function bX(t,e){if(!t.dom.parentNode)return;let r=t.input.shiftKey||t.state.selection.$from.parent.type.spec.code,n=t.dom.parentNode.appendChild(document.createElement(r?"textarea":"div"));r||(n.contentEditable="true"),n.style.cssText="position: fixed; left: -10000px; top: 10px",n.focus();let i=t.input.shiftKey&&t.input.lastKeyCode!=45;setTimeout(()=>{t.focus(),n.parentNode&&n.parentNode.removeChild(n),r?Fv(t,n.value,null,i,e):Fv(t,n.textContent,n.innerHTML,i,e)},50)}function Fv(t,e,r,n,i){let a=PO(t,e,r,n,t.state.selection.$from);if(t.someProp("handlePaste",l=>l(t,i,a||Pt.empty)))return!0;if(!a)return!1;let s=xX(a),o=s?t.state.tr.replaceSelectionWith(s,n):t.state.tr.replaceSelection(a);return t.dispatch(o.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}function BO(t){let e=t.getData("text/plain")||t.getData("Text");if(e)return e;let r=t.getData("text/uri-list");return r?r.replace(/\r?\n/g," "):""}Ns.paste=(t,e)=>{let r=e;if(t.composing&&!hc)return;let n=jv?null:r.clipboardData,i=t.input.shiftKey&&t.input.lastKeyCode!=45;n&&Fv(t,BO(n),n.getData("text/html"),i,r)?r.preventDefault():bX(t,r)};class zO{constructor(e,r,n){this.slice=e,this.move=r,this.node=n}}const wX=$o?"altKey":"ctrlKey";function UO(t,e){let r=t.someProp("dragCopies",n=>!n(e));return r??!e[wX]}Ts.dragstart=(t,e)=>{let r=e,n=t.input.mouseDown;if(n&&n.done(),!r.dataTransfer)return;let i=t.state.selection,a=i.empty?null:t.posAtCoords(X1(r)),s;if(!(a&&a.pos>=i.from&&a.pos<=(i instanceof Xt?i.to-1:i.to))){if(n&&n.mightDrag)s=Xt.create(t.state.doc,n.mightDrag.pos);else if(r.target&&r.target.nodeType==1){let f=t.docView.nearestDesc(r.target,!0);f&&f.node.type.spec.draggable&&f!=t.docView&&(s=Xt.create(t.state.doc,f.posBefore))}}let o=(s||t.state.selection).content(),{dom:l,text:u,slice:c}=$_(t,o);(!r.dataTransfer.files.length||!ma||fO>120)&&r.dataTransfer.clearData(),r.dataTransfer.setData(jv?"Text":"text/html",l.innerHTML),r.dataTransfer.effectAllowed="copyMove",jv||r.dataTransfer.setData("text/plain",u),t.dragging=new zO(c,UO(t,r),s)};Ts.dragend=t=>{let e=t.dragging;window.setTimeout(()=>{t.dragging==e&&(t.dragging=null)},50)};Ns.dragover=Ns.dragenter=(t,e)=>e.preventDefault();Ns.drop=(t,e)=>{try{SX(t,e,t.dragging)}finally{t.dragging=null}};function SX(t,e,r){if(!e.dataTransfer)return;let n=t.posAtCoords(X1(e));if(!n)return;let i=t.state.doc.resolve(n.pos),a=r&&r.slice;a?t.someProp("transformPasted",v=>{a=v(a,t,!1)}):a=PO(t,BO(e.dataTransfer),jv?null:e.dataTransfer.getData("text/html"),!1,i);let s=!!(r&&UO(t,e));if(t.someProp("handleDrop",v=>v(t,e,a||Pt.empty,s))){e.preventDefault();return}if(!a)return;e.preventDefault();let o=a?WL(t.state.doc,i.pos,a):i.pos;o==null&&(o=i.pos);let l=t.state.tr;if(s){let{node:v}=r;v?v.replace(l):l.deleteSelection()}let u=l.mapping.map(o),c=a.openStart==0&&a.openEnd==0&&a.content.childCount==1,f=l.doc;if(c?l.replaceRangeWith(u,u,a.content.firstChild):l.replaceRange(u,u,a),l.doc.eq(f))return;let p=l.doc.resolve(u);if(c&&Xt.isSelectable(a.content.firstChild)&&p.nodeAfter&&p.nodeAfter.sameMarkup(a.content.firstChild))l.setSelection(new Xt(p));else{let v=l.mapping.map(o);l.mapping.maps[l.mapping.maps.length-1].forEach((y,S,w,E)=>v=E),l.setSelection(q_(t,p,l.doc.resolve(v)))}t.focus(),t.dispatch(l.setMeta("uiEvent","drop"))}Ts.focus=t=>{t.input.lastFocus=Date.now(),t.focused||(t.domObserver.stop(),t.dom.classList.add("ProseMirror-focused"),t.domObserver.start(),t.focused=!0,setTimeout(()=>{t.docView&&t.hasFocus()&&!t.domObserver.currentSelection.eq(t.domSelectionRange())&&gc(t)},20))};Ts.blur=(t,e)=>{let r=e;t.focused&&(t.domObserver.stop(),t.dom.classList.remove("ProseMirror-focused"),t.domObserver.start(),r.relatedTarget&&t.dom.contains(r.relatedTarget)&&t.domObserver.currentSelection.clear(),t.focused=!1)};Ts.beforeinput=(t,e)=>{if(ma&&hc&&e.inputType=="deleteContentBackward"){t.domObserver.flushSoon();let{domChangeCount:n}=t.input;setTimeout(()=>{if(t.input.domChangeCount!=n||(t.dom.blur(),t.focus(),t.someProp("handleKeyDown",a=>a(t,eh(8,"Backspace")))))return;let{$cursor:i}=t.state.selection;i&&i.pos>0&&t.dispatch(t.state.tr.delete(i.pos-1,i.pos).scrollIntoView())},50)}};for(let t in Ns)Ts[t]=Ns[t];function Bv(t,e){if(t==e)return!0;for(let r in t)if(t[r]!==e[r])return!1;for(let r in e)if(!(r in t))return!1;return!0}class Lx{constructor(e,r){this.toDOM=e,this.spec=r||uh,this.side=this.spec.side||0}map(e,r,n,i){let{pos:a,deleted:s}=e.mapResult(r.from+i,this.side<0?-1:1);return s?null:new as(a-n,a-n,this)}valid(){return!0}eq(e){return this==e||e instanceof Lx&&(this.spec.key&&this.spec.key==e.spec.key||this.toDOM==e.toDOM&&Bv(this.spec,e.spec))}destroy(e){this.spec.destroy&&this.spec.destroy(e)}}class Kd{constructor(e,r){this.attrs=e,this.spec=r||uh}map(e,r,n,i){let a=e.map(r.from+i,this.spec.inclusiveStart?-1:1)-n,s=e.map(r.to+i,this.spec.inclusiveEnd?1:-1)-n;return a>=s?null:new as(a,s,this)}valid(e,r){return r.from<r.to}eq(e){return this==e||e instanceof Kd&&Bv(this.attrs,e.attrs)&&Bv(this.spec,e.spec)}static is(e){return e.type instanceof Kd}destroy(){}}class X_{constructor(e,r){this.attrs=e,this.spec=r||uh}map(e,r,n,i){let a=e.mapResult(r.from+i,1);if(a.deleted)return null;let s=e.mapResult(r.to+i,-1);return s.deleted||s.pos<=a.pos?null:new as(a.pos-n,s.pos-n,this)}valid(e,r){let{index:n,offset:i}=e.content.findIndex(r.from),a;return i==r.from&&!(a=e.child(n)).isText&&i+a.nodeSize==r.to}eq(e){return this==e||e instanceof X_&&Bv(this.attrs,e.attrs)&&Bv(this.spec,e.spec)}destroy(){}}class as{constructor(e,r,n){this.from=e,this.to=r,this.type=n}copy(e,r){return new as(e,r,this.type)}eq(e,r=0){return this.type.eq(e.type)&&this.from+r==e.from&&this.to+r==e.to}map(e,r,n){return this.type.map(e,this,r,n)}static widget(e,r,n){return new as(e,e,new Lx(r,n))}static inline(e,r,n,i){return new as(e,r,new Kd(n,i))}static node(e,r,n,i){return new as(e,r,new X_(n,i))}get spec(){return this.type.spec}get inline(){return this.type instanceof Kd}get widget(){return this.type instanceof Lx}}const Np=[],uh={};class $n{constructor(e,r){this.local=e.length?e:Np,this.children=r.length?r:Np}static create(e,r){return r.length?Ox(r,e,0,uh):is}find(e,r,n){let i=[];return this.findInner(e??0,r??1e9,i,0,n),i}findInner(e,r,n,i,a){for(let s=0;s<this.local.length;s++){let o=this.local[s];o.from<=r&&o.to>=e&&(!a||a(o.spec))&&n.push(o.copy(o.from+i,o.to+i))}for(let s=0;s<this.children.length;s+=3)if(this.children[s]<r&&this.children[s+1]>e){let o=this.children[s]+1;this.children[s+2].findInner(e-o,r-o,n,i+o,a)}}map(e,r,n){return this==is||e.maps.length==0?this:this.mapInner(e,r,0,0,n||uh)}mapInner(e,r,n,i,a){let s;for(let o=0;o<this.local.length;o++){let l=this.local[o].map(e,n,i);l&&l.type.valid(r,l)?(s||(s=[])).push(l):a.onRemove&&a.onRemove(this.local[o].spec)}return this.children.length?kX(this.children,s||[],e,r,n,i,a):s?new $n(s.sort(ch),Np):is}add(e,r){return r.length?this==is?$n.create(e,r):this.addInner(e,r,0):this}addInner(e,r,n){let i,a=0;e.forEach((o,l)=>{let u=l+n,c;if(c=VO(r,o,u)){for(i||(i=this.children.slice());a<i.length&&i[a]<l;)a+=3;i[a]==l?i[a+2]=i[a+2].addInner(o,c,u+1):i.splice(a,0,l,l+o.nodeSize,Ox(c,o,u+1,uh)),a+=3}});let s=GO(a?HO(r):r,-n);for(let o=0;o<s.length;o++)s[o].type.valid(e,s[o])||s.splice(o--,1);return new $n(s.length?this.local.concat(s).sort(ch):this.local,i||this.children)}remove(e){return e.length==0||this==is?this:this.removeInner(e,0)}removeInner(e,r){let n=this.children,i=this.local;for(let a=0;a<n.length;a+=3){let s,o=n[a]+r,l=n[a+1]+r;for(let c=0,f;c<e.length;c++)(f=e[c])&&f.from>o&&f.to<l&&(e[c]=null,(s||(s=[])).push(f));if(!s)continue;n==this.children&&(n=this.children.slice());let u=n[a+2].removeInner(s,o+1);u!=is?n[a+2]=u:(n.splice(a,3),a-=3)}if(i.length){for(let a=0,s;a<e.length;a++)if(s=e[a])for(let o=0;o<i.length;o++)i[o].eq(s,r)&&(i==this.local&&(i=this.local.slice()),i.splice(o--,1))}return n==this.children&&i==this.local?this:i.length||n.length?new $n(i,n):is}forChild(e,r){if(this==is)return this;if(r.isLeaf)return $n.empty;let n,i;for(let o=0;o<this.children.length;o+=3)if(this.children[o]>=e){this.children[o]==e&&(n=this.children[o+2]);break}let a=e+1,s=a+r.content.size;for(let o=0;o<this.local.length;o++){let l=this.local[o];if(l.from<s&&l.to>a&&l.type instanceof Kd){let u=Math.max(a,l.from)-a,c=Math.min(s,l.to)-a;u<c&&(i||(i=[])).push(l.copy(u,c))}}if(i){let o=new $n(i.sort(ch),Np);return n?new Md([o,n]):o}return n||is}eq(e){if(this==e)return!0;if(!(e instanceof $n)||this.local.length!=e.local.length||this.children.length!=e.children.length)return!1;for(let r=0;r<this.local.length;r++)if(!this.local[r].eq(e.local[r]))return!1;for(let r=0;r<this.children.length;r+=3)if(this.children[r]!=e.children[r]||this.children[r+1]!=e.children[r+1]||!this.children[r+2].eq(e.children[r+2]))return!1;return!0}locals(e){return Q_(this.localsInner(e))}localsInner(e){if(this==is)return Np;if(e.inlineContent||!this.local.some(Kd.is))return this.local;let r=[];for(let n=0;n<this.local.length;n++)this.local[n].type instanceof Kd||r.push(this.local[n]);return r}forEachSet(e){e(this)}}$n.empty=new $n([],[]);$n.removeOverlap=Q_;const is=$n.empty;class Md{constructor(e){this.members=e}map(e,r){const n=this.members.map(i=>i.map(e,r,uh));return Md.from(n)}forChild(e,r){if(r.isLeaf)return $n.empty;let n=[];for(let i=0;i<this.members.length;i++){let a=this.members[i].forChild(e,r);a!=is&&(a instanceof Md?n=n.concat(a.members):n.push(a))}return Md.from(n)}eq(e){if(!(e instanceof Md)||e.members.length!=this.members.length)return!1;for(let r=0;r<this.members.length;r++)if(!this.members[r].eq(e.members[r]))return!1;return!0}locals(e){let r,n=!0;for(let i=0;i<this.members.length;i++){let a=this.members[i].localsInner(e);if(a.length)if(!r)r=a;else{n&&(r=r.slice(),n=!1);for(let s=0;s<a.length;s++)r.push(a[s])}}return r?Q_(n?r:r.sort(ch)):Np}static from(e){switch(e.length){case 0:return is;case 1:return e[0];default:return new Md(e.every(r=>r instanceof $n)?e:e.reduce((r,n)=>r.concat(n instanceof $n?n:n.members),[]))}}forEachSet(e){for(let r=0;r<this.members.length;r++)this.members[r].forEachSet(e)}}function kX(t,e,r,n,i,a,s){let o=t.slice();for(let u=0,c=a;u<r.maps.length;u++){let f=0;r.maps[u].forEach((p,v,y,S)=>{let w=S-y-(v-p);for(let E=0;E<o.length;E+=3){let _=o[E+1];if(_<0||p>_+c-f)continue;let T=o[E]+c-f;v>=T?o[E+1]=p<=T?-2:-1:p>=c&&w&&(o[E]+=w,o[E+1]+=w)}f+=w}),c=r.maps[u].map(c,-1)}let l=!1;for(let u=0;u<o.length;u+=3)if(o[u+1]<0){if(o[u+1]==-2){l=!0,o[u+1]=-1;continue}let c=r.map(t[u]+a),f=c-i;if(f<0||f>=n.content.size){l=!0;continue}let p=r.map(t[u+1]+a,-1),v=p-i,{index:y,offset:S}=n.content.findIndex(f),w=n.maybeChild(y);if(w&&S==f&&S+w.nodeSize==v){let E=o[u+2].mapInner(r,w,c+1,t[u]+a+1,s);E!=is?(o[u]=f,o[u+1]=v,o[u+2]=E):(o[u+1]=-2,l=!0)}else l=!0}if(l){let u=_X(o,t,e,r,i,a,s),c=Ox(u,n,0,s);e=c.local;for(let f=0;f<o.length;f+=3)o[f+1]<0&&(o.splice(f,3),f-=3);for(let f=0,p=0;f<c.children.length;f+=3){let v=c.children[f];for(;p<o.length&&o[p]<v;)p+=3;o.splice(p,0,c.children[f],c.children[f+1],c.children[f+2])}}return new $n(e.sort(ch),o)}function GO(t,e){if(!e||!t.length)return t;let r=[];for(let n=0;n<t.length;n++){let i=t[n];r.push(new as(i.from+e,i.to+e,i.type))}return r}function _X(t,e,r,n,i,a,s){function o(l,u){for(let c=0;c<l.local.length;c++){let f=l.local[c].map(n,i,u);f?r.push(f):s.onRemove&&s.onRemove(l.local[c].spec)}for(let c=0;c<l.children.length;c+=3)o(l.children[c+2],l.children[c]+u+1)}for(let l=0;l<t.length;l+=3)t[l+1]==-1&&o(t[l+2],e[l]+a+1);return r}function VO(t,e,r){if(e.isLeaf)return null;let n=r+e.nodeSize,i=null;for(let a=0,s;a<t.length;a++)(s=t[a])&&s.from>r&&s.to<n&&((i||(i=[])).push(s),t[a]=null);return i}function HO(t){let e=[];for(let r=0;r<t.length;r++)t[r]!=null&&e.push(t[r]);return e}function Ox(t,e,r,n){let i=[],a=!1;e.forEach((o,l)=>{let u=VO(t,o,l+r);if(u){a=!0;let c=Ox(u,o,r+l+1,n);c!=is&&i.push(l,l+o.nodeSize,c)}});let s=GO(a?HO(t):t,-r).sort(ch);for(let o=0;o<s.length;o++)s[o].type.valid(e,s[o])||(n.onRemove&&n.onRemove(s[o].spec),s.splice(o--,1));return s.length||i.length?new $n(s,i):is}function ch(t,e){return t.from-e.from||t.to-e.to}function Q_(t){let e=t;for(let r=0;r<e.length-1;r++){let n=e[r];if(n.from!=n.to)for(let i=r+1;i<e.length;i++){let a=e[i];if(a.from==n.from){a.to!=n.to&&(e==t&&(e=t.slice()),e[i]=a.copy(a.from,n.to),Z3(e,i+1,a.copy(n.to,a.to)));continue}else{a.from<n.to&&(e==t&&(e=t.slice()),e[r]=n.copy(n.from,a.from),Z3(e,i,n.copy(a.from,n.to)));break}}}return e}function Z3(t,e,r){for(;e<t.length&&ch(r,t[e])>0;)e++;t.splice(e,0,r)}function sS(t){let e=[];return t.someProp("decorations",r=>{let n=r(t.state);n&&n!=is&&e.push(n)}),t.cursorWrapper&&e.push($n.create(t.state.doc,[t.cursorWrapper.deco])),Md.from(e)}const CX={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},EX=Xs&&qd<=11;class TX{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}set(e){this.anchorNode=e.anchorNode,this.anchorOffset=e.anchorOffset,this.focusNode=e.focusNode,this.focusOffset=e.focusOffset}clear(){this.anchorNode=this.focusNode=null}eq(e){return e.anchorNode==this.anchorNode&&e.anchorOffset==this.anchorOffset&&e.focusNode==this.focusNode&&e.focusOffset==this.focusOffset}}class NX{constructor(e,r){this.view=e,this.handleDOMChange=r,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new TX,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.lastChangedTextNode=null,this.observer=window.MutationObserver&&new window.MutationObserver(n=>{for(let i=0;i<n.length;i++)this.queue.push(n[i]);Xs&&qd<=11&&n.some(i=>i.type=="childList"&&i.removedNodes.length||i.type=="characterData"&&i.oldValue.length>i.target.nodeValue.length)?this.flushSoon():Ga&&e.composing&&n.some(i=>i.type=="childList"&&i.target.nodeName=="TR")?(e.input.badSafariComposition=!0,this.flushSoon()):this.flush()}),EX&&(this.onCharData=n=>{this.queue.push({target:n.target,type:"characterData",oldValue:n.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}flushSoon(){this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(()=>{this.flushingSoon=-1,this.flush()},20))}forceFlush(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}start(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,CX)),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()}stop(){if(this.observer){let e=this.observer.takeRecords();if(e.length){for(let r=0;r<e.length;r++)this.queue.push(e[r]);window.setTimeout(()=>this.flush(),20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()}connectSelection(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}disconnectSelection(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)}suppressSelectionUpdates(){this.suppressingSelectionUpdates=!0,setTimeout(()=>this.suppressingSelectionUpdates=!1,50)}onSelectionChange(){if(U3(this.view)){if(this.suppressingSelectionUpdates)return gc(this.view);if(Xs&&qd<=11&&!this.view.state.selection.empty){let e=this.view.domSelectionRange();if(e.focusNode&&kh(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset))return this.flushSoon()}this.flush()}}setCurSelection(){this.currentSelection.set(this.view.domSelectionRange())}ignoreSelectionChange(e){if(!e.focusNode)return!0;let r=new Set,n;for(let a=e.focusNode;a;a=Xp(a))r.add(a);for(let a=e.anchorNode;a;a=Xp(a))if(r.has(a)){n=a;break}let i=n&&this.view.docView.nearestDesc(n);if(i&&i.ignoreMutation({type:"selection",target:n.nodeType==3?n.parentNode:n}))return this.setCurSelection(),!0}pendingRecords(){if(this.observer)for(let e of this.observer.takeRecords())this.queue.push(e);return this.queue}flush(){let{view:e}=this;if(!e.docView||this.flushingSoon>-1)return;let r=this.pendingRecords();r.length&&(this.queue=[]);let n=e.domSelectionRange(),i=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(n)&&U3(e)&&!this.ignoreSelectionChange(n),a=-1,s=-1,o=!1,l=[];if(e.editable)for(let c=0;c<r.length;c++){let f=this.registerMutation(r[c],l);f&&(a=a<0?f.from:Math.min(f.from,a),s=s<0?f.to:Math.max(f.to,s),f.typeOver&&(o=!0))}if(Qo&&l.length){let c=l.filter(f=>f.nodeName=="BR");if(c.length==2){let[f,p]=c;f.parentNode&&f.parentNode.parentNode==p.parentNode?p.remove():f.remove()}else{let{focusNode:f}=this.currentSelection;for(let p of c){let v=p.parentNode;v&&v.nodeName=="LI"&&(!f||AX(e,f)!=v)&&p.remove()}}}else if((ma||Ga)&&l.some(c=>c.nodeName=="BR")&&(e.input.lastKeyCode==8||e.input.lastKeyCode==46)){for(let c of l)if(c.nodeName=="BR"&&c.parentNode){let f=c.nextSibling;f&&f.nodeType==1&&f.contentEditable=="false"&&c.parentNode.removeChild(c)}}let u=null;a<0&&i&&e.input.lastFocus>Date.now()-200&&Math.max(e.input.lastTouch,e.input.lastClick.time)<Date.now()-300&&Z1(n)&&(u=W_(e))&&u.eq(Sr.near(e.state.doc.resolve(0),1))?(e.input.lastFocus=0,gc(e),this.currentSelection.set(n),e.scrollToSelection()):(a>-1||i)&&(a>-1&&(e.docView.markDirty(a,s),PX(e)),e.input.badSafariComposition&&(e.input.badSafariComposition=!1,RX(e,l)),this.handleDOMChange(a,s,o,l),e.docView&&e.docView.dirty?e.updateState(e.state):this.currentSelection.eq(n)||gc(e),this.currentSelection.set(n))}registerMutation(e,r){if(r.indexOf(e.target)>-1)return null;let n=this.view.docView.nearestDesc(e.target);if(e.type=="attributes"&&(n==this.view.docView||e.attributeName=="contenteditable"||e.attributeName=="style"&&!e.oldValue&&!e.target.getAttribute("style"))||!n||n.ignoreMutation(e))return null;if(e.type=="childList"){for(let c=0;c<e.addedNodes.length;c++){let f=e.addedNodes[c];r.push(f),f.nodeType==3&&(this.lastChangedTextNode=f)}if(n.contentDOM&&n.contentDOM!=n.dom&&!n.contentDOM.contains(e.target))return{from:n.posBefore,to:n.posAfter};let i=e.previousSibling,a=e.nextSibling;if(Xs&&qd<=11&&e.addedNodes.length)for(let c=0;c<e.addedNodes.length;c++){let{previousSibling:f,nextSibling:p}=e.addedNodes[c];(!f||Array.prototype.indexOf.call(e.addedNodes,f)<0)&&(i=f),(!p||Array.prototype.indexOf.call(e.addedNodes,p)<0)&&(a=p)}let s=i&&i.parentNode==e.target?Fa(i)+1:0,o=n.localPosFromDOM(e.target,s,-1),l=a&&a.parentNode==e.target?Fa(a):e.target.childNodes.length,u=n.localPosFromDOM(e.target,l,1);return{from:o,to:u}}else return e.type=="attributes"?{from:n.posAtStart-n.border,to:n.posAtEnd+n.border}:(this.lastChangedTextNode=e.target,{from:n.posAtStart,to:n.posAtEnd,typeOver:e.target.nodeValue==e.oldValue})}}let Y3=new WeakMap,X3=!1;function PX(t){if(!Y3.has(t)&&(Y3.set(t,null),["normal","nowrap","pre-line"].indexOf(getComputedStyle(t.dom).whiteSpace)!==-1)){if(t.requiresGeckoHackNode=Qo,X3)return;console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."),X3=!0}}function Q3(t,e){let r=e.startContainer,n=e.startOffset,i=e.endContainer,a=e.endOffset,s=t.domAtPos(t.state.selection.anchor);return kh(s.node,s.offset,i,a)&&([r,n,i,a]=[i,a,r,n]),{anchorNode:r,anchorOffset:n,focusNode:i,focusOffset:a}}function MX(t,e){if(e.getComposedRanges){let i=e.getComposedRanges(t.root)[0];if(i)return Q3(t,i)}let r;function n(i){i.preventDefault(),i.stopImmediatePropagation(),r=i.getTargetRanges()[0]}return t.dom.addEventListener("beforeinput",n,!0),document.execCommand("indent"),t.dom.removeEventListener("beforeinput",n,!0),r?Q3(t,r):null}function AX(t,e){for(let r=e.parentNode;r&&r!=t.dom;r=r.parentNode){let n=t.docView.nearestDesc(r,!0);if(n&&n.node.isBlock)return r}return null}function RX(t,e){var r;let{focusNode:n,focusOffset:i}=t.domSelectionRange();for(let a of e)if(((r=a.parentNode)===null||r===void 0?void 0:r.nodeName)=="TR"){let s=a.nextSibling;for(;s&&s.nodeName!="TD"&&s.nodeName!="TH";)s=s.nextSibling;if(s){let o=s;for(;;){let l=o.firstChild;if(!l||l.nodeType!=1||l.contentEditable=="false"||/^(BR|IMG)$/.test(l.nodeName))break;o=l}o.insertBefore(a,o.firstChild),n==a&&t.domSelection().collapse(a,i)}else a.parentNode.removeChild(a)}}function LX(t,e,r){let{node:n,fromOffset:i,toOffset:a,from:s,to:o}=t.docView.parseRange(e,r),l=t.domSelectionRange(),u,c=l.anchorNode;if(c&&t.dom.contains(c.nodeType==1?c:c.parentNode)&&(u=[{node:c,offset:l.anchorOffset}],Z1(l)||u.push({node:l.focusNode,offset:l.focusOffset})),ma&&t.input.lastKeyCode===8)for(let w=a;w>i;w--){let E=n.childNodes[w-1],_=E.pmViewDesc;if(E.nodeName=="BR"&&!_){a=w;break}if(!_||_.size)break}let f=t.state.doc,p=t.someProp("domParser")||Wd.fromSchema(t.state.schema),v=f.resolve(s),y=null,S=p.parse(n,{topNode:v.parent,topMatch:v.parent.contentMatchAt(v.index()),topOpen:!0,from:i,to:a,preserveWhitespace:v.parent.type.whitespace=="pre"?"full":!0,findPositions:u,ruleFromNode:OX,context:v});if(u&&u[0].pos!=null){let w=u[0].pos,E=u[1]&&u[1].pos;E==null&&(E=w),y={anchor:w+s,head:E+s}}return{doc:S,sel:y,from:s,to:o}}function OX(t){let e=t.pmViewDesc;if(e)return e.parseRule();if(t.nodeName=="BR"&&t.parentNode){if(Ga&&/^(ul|ol)$/i.test(t.parentNode.nodeName)){let r=document.createElement("div");return r.appendChild(document.createElement("li")),{skip:r}}else if(t.parentNode.lastChild==t||Ga&&/^(tr|table)$/i.test(t.parentNode.nodeName))return{ignore:!0}}else if(t.nodeName=="IMG"&&t.getAttribute("mark-placeholder"))return{ignore:!0};return null}const DX=/^(a|abbr|acronym|b|bd[io]|big|br|button|cite|code|data(list)?|del|dfn|em|i|img|ins|kbd|label|map|mark|meter|output|q|ruby|s|samp|small|span|strong|su[bp]|time|u|tt|var)$/i;function IX(t,e,r,n,i){let a=t.input.compositionPendingChanges||(t.composing?t.input.compositionID:0);if(t.input.compositionPendingChanges=0,e<0){let F=t.input.lastSelectionTime>Date.now()-50?t.input.lastSelectionOrigin:null,D=W_(t,F);if(D&&!t.state.selection.eq(D)){if(ma&&hc&&t.input.lastKeyCode===13&&Date.now()-100<t.input.lastKeyCodeTime&&t.someProp("handleKeyDown",B=>B(t,eh(13,"Enter"))))return;let j=t.state.tr.setSelection(D);F=="pointer"?j.setMeta("pointer",!0):F=="key"&&j.scrollIntoView(),a&&j.setMeta("composition",a),t.dispatch(j)}return}let s=t.state.doc.resolve(e),o=s.sharedDepth(r);e=s.before(o+1),r=t.state.doc.resolve(r).after(o+1);let l=t.state.selection,u=LX(t,e,r),c=t.state.doc,f=c.slice(u.from,u.to),p,v;t.input.lastKeyCode===8&&Date.now()-100<t.input.lastKeyCodeTime?(p=t.state.selection.to,v="end"):(p=t.state.selection.from,v="start"),t.input.lastKeyCode=null;let y=BX(f.content,u.doc.content,u.from,p,v);if(y&&t.input.domChangeCount++,(Qp&&t.input.lastIOSEnter>Date.now()-225||hc)&&i.some(F=>F.nodeType==1&&!DX.test(F.nodeName))&&(!y||y.endA>=y.endB)&&t.someProp("handleKeyDown",F=>F(t,eh(13,"Enter")))){t.input.lastIOSEnter=0;return}if(!y)if(n&&l instanceof dr&&!l.empty&&l.$head.sameParent(l.$anchor)&&!t.composing&&!(u.sel&&u.sel.anchor!=u.sel.head))y={start:l.from,endA:l.to,endB:l.to};else{if(u.sel){let F=J3(t,t.state.doc,u.sel);if(F&&!F.eq(t.state.selection)){let D=t.state.tr.setSelection(F);a&&D.setMeta("composition",a),t.dispatch(D)}}return}t.state.selection.from<t.state.selection.to&&y.start==y.endB&&t.state.selection instanceof dr&&(y.start>t.state.selection.from&&y.start<=t.state.selection.from+2&&t.state.selection.from>=u.from?y.start=t.state.selection.from:y.endA<t.state.selection.to&&y.endA>=t.state.selection.to-2&&t.state.selection.to<=u.to&&(y.endB+=t.state.selection.to-y.endA,y.endA=t.state.selection.to)),Xs&&qd<=11&&y.endB==y.start+1&&y.endA==y.start&&y.start>u.from&&u.doc.textBetween(y.start-u.from-1,y.start-u.from+1)==" "&&(y.start--,y.endA--,y.endB--);let S=u.doc.resolveNoCache(y.start-u.from),w=u.doc.resolveNoCache(y.endB-u.from),E=c.resolve(y.start),_=S.sameParent(w)&&S.parent.inlineContent&&E.end()>=y.endA;if((Qp&&t.input.lastIOSEnter>Date.now()-225&&(!_||i.some(F=>F.nodeName=="DIV"||F.nodeName=="P"))||!_&&S.pos<u.doc.content.size&&(!S.sameParent(w)||!S.parent.inlineContent)&&S.pos<w.pos&&!/\S/.test(u.doc.textBetween(S.pos,w.pos,"","")))&&t.someProp("handleKeyDown",F=>F(t,eh(13,"Enter")))){t.input.lastIOSEnter=0;return}if(t.state.selection.anchor>y.start&&FX(c,y.start,y.endA,S,w)&&t.someProp("handleKeyDown",F=>F(t,eh(8,"Backspace")))){hc&&ma&&t.domObserver.suppressSelectionUpdates();return}ma&&y.endB==y.start&&(t.input.lastChromeDelete=Date.now()),hc&&!_&&S.start()!=w.start()&&w.parentOffset==0&&S.depth==w.depth&&u.sel&&u.sel.anchor==u.sel.head&&u.sel.head==y.endA&&(y.endB-=2,w=u.doc.resolveNoCache(y.endB-u.from),setTimeout(()=>{t.someProp("handleKeyDown",function(F){return F(t,eh(13,"Enter"))})},20));let T=y.start,N=y.endA,R=F=>{let D=F||t.state.tr.replace(T,N,u.doc.slice(y.start-u.from,y.endB-u.from));if(u.sel){let j=J3(t,D.doc,u.sel);j&&!(ma&&t.composing&&j.empty&&(y.start!=y.endB||t.input.lastChromeDelete<Date.now()-100)&&(j.head==T||j.head==D.mapping.map(N)-1)||Xs&&j.empty&&j.head==T)&&D.setSelection(j)}return a&&D.setMeta("composition",a),D.scrollIntoView()},I;if(_)if(S.pos==w.pos){Xs&&qd<=11&&S.parentOffset==0&&(t.domObserver.suppressSelectionUpdates(),setTimeout(()=>gc(t),20));let F=R(t.state.tr.delete(T,N)),D=c.resolve(y.start).marksAcross(c.resolve(y.endA));D&&F.ensureMarks(D),t.dispatch(F)}else if(y.endA==y.endB&&(I=jX(S.parent.content.cut(S.parentOffset,w.parentOffset),E.parent.content.cut(E.parentOffset,y.endA-E.start())))){let F=R(t.state.tr);I.type=="add"?F.addMark(T,N,I.mark):F.removeMark(T,N,I.mark),t.dispatch(F)}else if(S.parent.child(S.index()).isText&&S.index()==w.index()-(w.textOffset?0:1)){let F=S.parent.textBetween(S.parentOffset,w.parentOffset),D=()=>R(t.state.tr.insertText(F,T,N));t.someProp("handleTextInput",j=>j(t,T,N,F,D))||t.dispatch(D())}else t.dispatch(R());else t.dispatch(R())}function J3(t,e,r){return Math.max(r.anchor,r.head)>e.content.size?null:q_(t,e.resolve(r.anchor),e.resolve(r.head))}function jX(t,e){let r=t.firstChild.marks,n=e.firstChild.marks,i=r,a=n,s,o,l;for(let c=0;c<n.length;c++)i=n[c].removeFromSet(i);for(let c=0;c<r.length;c++)a=r[c].removeFromSet(a);if(i.length==1&&a.length==0)o=i[0],s="add",l=c=>c.mark(o.addToSet(c.marks));else if(i.length==0&&a.length==1)o=a[0],s="remove",l=c=>c.mark(o.removeFromSet(c.marks));else return null;let u=[];for(let c=0;c<e.childCount;c++)u.push(l(e.child(c)));if(it.from(u).eq(t))return{mark:o,type:s}}function FX(t,e,r,n,i){if(r-e<=i.pos-n.pos||oS(n,!0,!1)<i.pos)return!1;let a=t.resolve(e);if(!n.parent.isTextblock){let o=a.nodeAfter;return o!=null&&r==e+o.nodeSize}if(a.parentOffset<a.parent.content.size||!a.parent.isTextblock)return!1;let s=t.resolve(oS(a,!0,!0));return!s.parent.isTextblock||s.pos>r||oS(s,!0,!1)<r?!1:n.parent.content.cut(n.parentOffset).eq(s.parent.content)}function oS(t,e,r){let n=t.depth,i=e?t.end():t.pos;for(;n>0&&(e||t.indexAfter(n)==t.node(n).childCount);)n--,i++,e=!1;if(r){let a=t.node(n).maybeChild(t.indexAfter(n));for(;a&&!a.isLeaf;)a=a.firstChild,i++}return i}function BX(t,e,r,n,i){let a=t.findDiffStart(e,r);if(a==null)return null;let{a:s,b:o}=t.findDiffEnd(e,r+t.size,r+e.size);if(i=="end"){let l=Math.max(0,a-Math.min(s,o));n-=s+l-a}if(s<a&&t.size<e.size){let l=n<=a&&n>=s?a-n:0;a-=l,a&&a<e.size&&eP(e.textBetween(a-1,a+1))&&(a+=l?1:-1),o=a+(o-s),s=a}else if(o<a){let l=n<=a&&n>=o?a-n:0;a-=l,a&&a<t.size&&eP(t.textBetween(a-1,a+1))&&(a+=l?1:-1),s=a+(s-o),o=a}return{start:a,endA:s,endB:o}}function eP(t){if(t.length!=2)return!1;let e=t.charCodeAt(0),r=t.charCodeAt(1);return e>=56320&&e<=57343&&r>=55296&&r<=56319}class WO{constructor(e,r){this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new tX,this.prevDirectPlugins=[],this.pluginViews=[],this.requiresGeckoHackNode=!1,this.dragging=null,this._props=r,this.state=r.state,this.directPlugins=r.plugins||[],this.directPlugins.forEach(aP),this.dispatch=this.dispatch.bind(this),this.dom=e&&e.mount||document.createElement("div"),e&&(e.appendChild?e.appendChild(this.dom):typeof e=="function"?e(this.dom):e.mount&&(this.mounted=!0)),this.editable=nP(this),rP(this),this.nodeViews=iP(this),this.docView=D3(this.state.doc,tP(this),sS(this),this.dom,this),this.domObserver=new NX(this,(n,i,a,s)=>IX(this,n,i,a,s)),this.domObserver.start(),rX(this),this.updatePluginViews()}get composing(){return this.input.composing}get props(){if(this._props.state!=this.state){let e=this._props;this._props={};for(let r in e)this._props[r]=e[r];this._props.state=this.state}return this._props}update(e){e.handleDOMEvents!=this._props.handleDOMEvents&&kk(this);let r=this._props;this._props=e,e.plugins&&(e.plugins.forEach(aP),this.directPlugins=e.plugins),this.updateStateInner(e.state,r)}setProps(e){let r={};for(let n in this._props)r[n]=this._props[n];r.state=this.state;for(let n in e)r[n]=e[n];this.update(r)}updateState(e){this.updateStateInner(e,this._props)}updateStateInner(e,r){var n;let i=this.state,a=!1,s=!1;e.storedMarks&&this.composing&&(FO(this),s=!0),this.state=e;let o=i.plugins!=e.plugins||this._props.plugins!=r.plugins;if(o||this._props.plugins!=r.plugins||this._props.nodeViews!=r.nodeViews){let v=iP(this);UX(v,this.nodeViews)&&(this.nodeViews=v,a=!0)}(o||r.handleDOMEvents!=this._props.handleDOMEvents)&&kk(this),this.editable=nP(this),rP(this);let l=sS(this),u=tP(this),c=i.plugins!=e.plugins&&!i.doc.eq(e.doc)?"reset":e.scrollToSelection>i.scrollToSelection?"to selection":"preserve",f=a||!this.docView.matchesNode(e.doc,u,l);(f||!e.selection.eq(i.selection))&&(s=!0);let p=c=="preserve"&&s&&this.dom.style.overflowAnchor==null&&gY(this);if(s){this.domObserver.stop();let v=f&&(Xs||ma)&&!this.composing&&!i.selection.empty&&!e.selection.empty&&zX(i.selection,e.selection);if(f){let y=ma?this.trackWrites=this.domSelectionRange().focusNode:null;this.composing&&(this.input.compositionNode=gX(this)),(a||!this.docView.update(e.doc,u,l,this))&&(this.docView.updateOuterDeco(u),this.docView.destroy(),this.docView=D3(e.doc,u,l,this.dom,this)),y&&(!this.trackWrites||!this.dom.contains(this.trackWrites))&&(v=!0)}v||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelectionRange())&&zY(this))?gc(this,v):(EO(this,e.selection),this.domObserver.setCurSelection()),this.domObserver.start()}this.updatePluginViews(i),!((n=this.dragging)===null||n===void 0)&&n.node&&!i.doc.eq(e.doc)&&this.updateDraggedNode(this.dragging,i),c=="reset"?this.dom.scrollTop=0:c=="to selection"?this.scrollToSelection():p&&vY(p)}scrollToSelection(){let e=this.domSelectionRange().focusNode;if(!(!e||!this.dom.contains(e.nodeType==1?e:e.parentNode))){if(!this.someProp("handleScrollToSelection",r=>r(this)))if(this.state.selection instanceof Xt){let r=this.docView.domAfterPos(this.state.selection.from);r.nodeType==1&&P3(this,r.getBoundingClientRect(),e)}else P3(this,this.coordsAtPos(this.state.selection.head,1),e)}}destroyPluginViews(){let e;for(;e=this.pluginViews.pop();)e.destroy&&e.destroy()}updatePluginViews(e){if(!e||e.plugins!=this.state.plugins||this.directPlugins!=this.prevDirectPlugins){this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(let r=0;r<this.directPlugins.length;r++){let n=this.directPlugins[r];n.spec.view&&this.pluginViews.push(n.spec.view(this))}for(let r=0;r<this.state.plugins.length;r++){let n=this.state.plugins[r];n.spec.view&&this.pluginViews.push(n.spec.view(this))}}else for(let r=0;r<this.pluginViews.length;r++){let n=this.pluginViews[r];n.update&&n.update(this,e)}}updateDraggedNode(e,r){let n=e.node,i=-1;if(this.state.doc.nodeAt(n.from)==n.node)i=n.from;else{let a=n.from+(this.state.doc.content.size-r.doc.content.size);(a>0&&this.state.doc.nodeAt(a))==n.node&&(i=a)}this.dragging=new zO(e.slice,e.move,i<0?void 0:Xt.create(this.state.doc,i))}someProp(e,r){let n=this._props&&this._props[e],i;if(n!=null&&(i=r?r(n):n))return i;for(let s=0;s<this.directPlugins.length;s++){let o=this.directPlugins[s].props[e];if(o!=null&&(i=r?r(o):o))return i}let a=this.state.plugins;if(a)for(let s=0;s<a.length;s++){let o=a[s].props[e];if(o!=null&&(i=r?r(o):o))return i}}hasFocus(){if(Xs){let e=this.root.activeElement;if(e==this.dom)return!0;if(!e||!this.dom.contains(e))return!1;for(;e&&this.dom!=e&&this.dom.contains(e);){if(e.contentEditable=="false")return!1;e=e.parentElement}return!0}return this.root.activeElement==this.dom}focus(){this.domObserver.stop(),this.editable&&yY(this.dom),gc(this),this.domObserver.start()}get root(){let e=this._root;if(e==null){for(let r=this.dom.parentNode;r;r=r.parentNode)if(r.nodeType==9||r.nodeType==11&&r.host)return r.getSelection||(Object.getPrototypeOf(r).getSelection=()=>r.ownerDocument.getSelection()),this._root=r}return e||document}updateRoot(){this._root=null}posAtCoords(e){return kY(this,e)}coordsAtPos(e,r=1){return yO(this,e,r)}domAtPos(e,r=0){return this.docView.domFromPos(e,r)}nodeDOM(e){let r=this.docView.descAt(e);return r?r.nodeDOM:null}posAtDOM(e,r,n=-1){let i=this.docView.posFromDOM(e,r,n);if(i==null)throw new RangeError("DOM position not inside the editor");return i}endOfTextblock(e,r){return NY(this,r||this.state,e)}pasteHTML(e,r){return Fv(this,"",e,!1,r||new ClipboardEvent("paste"))}pasteText(e,r){return Fv(this,e,null,!0,r||new ClipboardEvent("paste"))}serializeForClipboard(e){return $_(this,e)}destroy(){this.docView&&(nX(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],sS(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null,sY())}get isDestroyed(){return this.docView==null}dispatchEvent(e){return aX(this,e)}domSelectionRange(){let e=this.domSelection();return e?Ga&&this.root.nodeType===11&&dY(this.dom.ownerDocument)==this.dom&&MX(this,e)||e:{focusNode:null,focusOffset:0,anchorNode:null,anchorOffset:0}}domSelection(){return this.root.getSelection()}}WO.prototype.dispatch=function(t){let e=this._props.dispatchTransaction;e?e.call(this,t):this.updateState(this.state.apply(t))};function tP(t){let e=Object.create(null);return e.class="ProseMirror",e.contenteditable=String(t.editable),t.someProp("attributes",r=>{if(typeof r=="function"&&(r=r(t.state)),r)for(let n in r)n=="class"?e.class+=" "+r[n]:n=="style"?e.style=(e.style?e.style+";":"")+r[n]:!e[n]&&n!="contenteditable"&&n!="nodeName"&&(e[n]=String(r[n]))}),e.translate||(e.translate="no"),[as.node(0,t.state.doc.content.size,e)]}function rP(t){if(t.markCursor){let e=document.createElement("img");e.className="ProseMirror-separator",e.setAttribute("mark-placeholder","true"),e.setAttribute("alt",""),t.cursorWrapper={dom:e,deco:as.widget(t.state.selection.from,e,{raw:!0,marks:t.markCursor})}}else t.cursorWrapper=null}function nP(t){return!t.someProp("editable",e=>e(t.state)===!1)}function zX(t,e){let r=Math.min(t.$anchor.sharedDepth(t.head),e.$anchor.sharedDepth(e.head));return t.$anchor.start(r)!=e.$anchor.start(r)}function iP(t){let e=Object.create(null);function r(n){for(let i in n)Object.prototype.hasOwnProperty.call(e,i)||(e[i]=n[i])}return t.someProp("nodeViews",r),t.someProp("markViews",r),e}function UX(t,e){let r=0,n=0;for(let i in t){if(t[i]!=e[i])return!0;r++}for(let i in e)n++;return r!=n}function aP(t){if(t.spec.state||t.spec.filterTransaction||t.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}var rf={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},Dx={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},GX=typeof navigator<"u"&&/Mac/.test(navigator.platform),VX=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);for(var Ba=0;Ba<10;Ba++)rf[48+Ba]=rf[96+Ba]=String(Ba);for(var Ba=1;Ba<=24;Ba++)rf[Ba+111]="F"+Ba;for(var Ba=65;Ba<=90;Ba++)rf[Ba]=String.fromCharCode(Ba+32),Dx[Ba]=String.fromCharCode(Ba);for(var lS in rf)Dx.hasOwnProperty(lS)||(Dx[lS]=rf[lS]);function HX(t){var e=GX&&t.metaKey&&t.shiftKey&&!t.ctrlKey&&!t.altKey||VX&&t.shiftKey&&t.key&&t.key.length==1||t.key=="Unidentified",r=!e&&t.key||(t.shiftKey?Dx:rf)[t.keyCode]||t.key||"Unidentified";return r=="Esc"&&(r="Escape"),r=="Del"&&(r="Delete"),r=="Left"&&(r="ArrowLeft"),r=="Up"&&(r="ArrowUp"),r=="Right"&&(r="ArrowRight"),r=="Down"&&(r="ArrowDown"),r}const WX=typeof navigator<"u"&&/Mac|iP(hone|[oa]d)/.test(navigator.platform),qX=typeof navigator<"u"&&/Win/.test(navigator.platform);function $X(t){let e=t.split(/-(?!$)/),r=e[e.length-1];r=="Space"&&(r=" ");let n,i,a,s;for(let o=0;o<e.length-1;o++){let l=e[o];if(/^(cmd|meta|m)$/i.test(l))s=!0;else if(/^a(lt)?$/i.test(l))n=!0;else if(/^(c|ctrl|control)$/i.test(l))i=!0;else if(/^s(hift)?$/i.test(l))a=!0;else if(/^mod$/i.test(l))WX?s=!0:i=!0;else throw new Error("Unrecognized modifier name: "+l)}return n&&(r="Alt-"+r),i&&(r="Ctrl-"+r),s&&(r="Meta-"+r),a&&(r="Shift-"+r),r}function KX(t){let e=Object.create(null);for(let r in t)e[$X(r)]=t[r];return e}function uS(t,e,r=!0){return e.altKey&&(t="Alt-"+t),e.ctrlKey&&(t="Ctrl-"+t),e.metaKey&&(t="Meta-"+t),r&&e.shiftKey&&(t="Shift-"+t),t}function ZX(t){return new Yn({props:{handleKeyDown:qO(t)}})}function qO(t){let e=KX(t);return function(r,n){let i=HX(n),a,s=e[uS(i,n)];if(s&&s(r.state,r.dispatch,r))return!0;if(i.length==1&&i!=" "){if(n.shiftKey){let o=e[uS(i,n,!1)];if(o&&o(r.state,r.dispatch,r))return!0}if((n.altKey||n.metaKey||n.ctrlKey)&&!(qX&&n.ctrlKey&&n.altKey)&&(a=rf[n.keyCode])&&a!=i){let o=e[uS(a,n)];if(o&&o(r.state,r.dispatch,r))return!0}}return!1}}var YX=Object.defineProperty,J_=(t,e)=>{for(var r in e)YX(t,r,{get:e[r],enumerable:!0})};function Q1(t){const{state:e,transaction:r}=t;let{selection:n}=r,{doc:i}=r,{storedMarks:a}=r;return{...e,apply:e.apply.bind(e),applyTransaction:e.applyTransaction.bind(e),plugins:e.plugins,schema:e.schema,reconfigure:e.reconfigure.bind(e),toJSON:e.toJSON.bind(e),get storedMarks(){return a},get selection(){return n},get doc(){return i},get tr(){return n=r.selection,i=r.doc,a=r.storedMarks,r}}}var J1=class{constructor(t){this.editor=t.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=t.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:t,editor:e,state:r}=this,{view:n}=e,{tr:i}=r,a=this.buildProps(i);return Object.fromEntries(Object.entries(t).map(([s,o])=>[s,(...u)=>{const c=o(...u)(a);return!i.getMeta("preventDispatch")&&!this.hasCustomState&&n.dispatch(i),c}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(t,e=!0){const{rawCommands:r,editor:n,state:i}=this,{view:a}=n,s=[],o=!!t,l=t||i.tr,u=()=>(!o&&e&&!l.getMeta("preventDispatch")&&!this.hasCustomState&&a.dispatch(l),s.every(f=>f===!0)),c={...Object.fromEntries(Object.entries(r).map(([f,p])=>[f,(...y)=>{const S=this.buildProps(l,e),w=p(...y)(S);return s.push(w),c}])),run:u};return c}createCan(t){const{rawCommands:e,state:r}=this,n=!1,i=t||r.tr,a=this.buildProps(i,n);return{...Object.fromEntries(Object.entries(e).map(([o,l])=>[o,(...u)=>l(...u)({...a,dispatch:void 0})])),chain:()=>this.createChain(i,n)}}buildProps(t,e=!0){const{rawCommands:r,editor:n,state:i}=this,{view:a}=n,s={tr:t,editor:n,view:a,state:Q1({state:i,transaction:t}),dispatch:e?()=>{}:void 0,chain:()=>this.createChain(t,e),can:()=>this.createCan(t),get commands(){return Object.fromEntries(Object.entries(r).map(([o,l])=>[o,(...u)=>l(...u)(s)]))}};return s}},$O={};J_($O,{blur:()=>XX,clearContent:()=>QX,clearNodes:()=>JX,command:()=>eQ,createParagraphNear:()=>tQ,cut:()=>rQ,deleteCurrentNode:()=>nQ,deleteNode:()=>iQ,deleteRange:()=>aQ,deleteSelection:()=>sQ,enter:()=>oQ,exitCode:()=>lQ,extendMarkRange:()=>uQ,first:()=>cQ,focus:()=>fQ,forEach:()=>hQ,insertContent:()=>pQ,insertContentAt:()=>vQ,joinBackward:()=>bQ,joinDown:()=>xQ,joinForward:()=>wQ,joinItemBackward:()=>SQ,joinItemForward:()=>kQ,joinTextblockBackward:()=>_Q,joinTextblockForward:()=>CQ,joinUp:()=>yQ,keyboardShortcut:()=>TQ,lift:()=>NQ,liftEmptyBlock:()=>PQ,liftListItem:()=>MQ,newlineInCode:()=>AQ,resetAttributes:()=>RQ,scrollIntoView:()=>LQ,selectAll:()=>OQ,selectNodeBackward:()=>DQ,selectNodeForward:()=>IQ,selectParentNode:()=>jQ,selectTextblockEnd:()=>FQ,selectTextblockStart:()=>BQ,setContent:()=>zQ,setMark:()=>sJ,setMeta:()=>oJ,setNode:()=>lJ,setNodeSelection:()=>uJ,setTextDirection:()=>cJ,setTextSelection:()=>dJ,sinkListItem:()=>fJ,splitBlock:()=>hJ,splitListItem:()=>pJ,toggleList:()=>mJ,toggleMark:()=>gJ,toggleNode:()=>vJ,toggleWrap:()=>yJ,undoInputRule:()=>xJ,unsetAllMarks:()=>bJ,unsetMark:()=>wJ,unsetTextDirection:()=>SJ,updateAttributes:()=>kJ,wrapIn:()=>_J,wrapInList:()=>CJ});var XX=()=>({editor:t,view:e})=>(requestAnimationFrame(()=>{var r;t.isDestroyed||(e.dom.blur(),(r=window?.getSelection())==null||r.removeAllRanges())}),!0),QX=(t=!0)=>({commands:e})=>e.setContent("",{emitUpdate:t}),JX=()=>({state:t,tr:e,dispatch:r})=>{const{selection:n}=e,{ranges:i}=n;return r&&i.forEach(({$from:a,$to:s})=>{t.doc.nodesBetween(a.pos,s.pos,(o,l)=>{if(o.type.isText)return;const{doc:u,mapping:c}=e,f=u.resolve(c.map(l)),p=u.resolve(c.map(l+o.nodeSize)),v=f.blockRange(p);if(!v)return;const y=vm(v);if(o.type.isTextblock){const{defaultType:S}=f.parent.contentMatchAt(f.index());e.setNodeMarkup(v.start,S)}(y||y===0)&&e.lift(v,y)})}),!0},eQ=t=>e=>t(e),tQ=()=>({state:t,dispatch:e})=>oO(t,e),rQ=(t,e)=>({editor:r,tr:n})=>{const{state:i}=r,a=i.doc.slice(t.from,t.to);n.deleteRange(t.from,t.to);const s=n.mapping.map(e);return n.insert(s,a.content),n.setSelection(new dr(n.doc.resolve(Math.max(s-1,0)))),!0},nQ=()=>({tr:t,dispatch:e})=>{const{selection:r}=t,n=r.$anchor.node();if(n.content.size>0)return!1;const i=t.selection.$anchor;for(let a=i.depth;a>0;a-=1)if(i.node(a).type===n.type){if(e){const o=i.before(a),l=i.after(a);t.delete(o,l).scrollIntoView()}return!0}return!1};function ji(t,e){if(typeof t=="string"){if(!e.nodes[t])throw Error(`There is no node type named '${t}'. Maybe you forgot to add the extension?`);return e.nodes[t]}return t}var iQ=t=>({tr:e,state:r,dispatch:n})=>{const i=ji(t,r.schema),a=e.selection.$anchor;for(let s=a.depth;s>0;s-=1)if(a.node(s).type===i){if(n){const l=a.before(s),u=a.after(s);e.delete(l,u).scrollIntoView()}return!0}return!1},aQ=t=>({tr:e,dispatch:r})=>{const{from:n,to:i}=t;return r&&e.delete(n,i),!0},sQ=()=>({state:t,dispatch:e})=>B_(t,e),oQ=()=>({commands:t})=>t.keyboardShortcut("Enter"),lQ=()=>({state:t,dispatch:e})=>WZ(t,e);function eC(t){return Object.prototype.toString.call(t)==="[object RegExp]"}function Ix(t,e,r={strict:!0}){const n=Object.keys(e);return n.length?n.every(i=>r.strict?e[i]===t[i]:eC(e[i])?e[i].test(t[i]):e[i]===t[i]):!0}function KO(t,e,r={}){return t.find(n=>n.type===e&&Ix(Object.fromEntries(Object.keys(r).map(i=>[i,n.attrs[i]])),r))}function sP(t,e,r={}){return!!KO(t,e,r)}function tC(t,e,r){var n;if(!t||!e)return;let i=t.parent.childAfter(t.parentOffset);if((!i.node||!i.node.marks.some(c=>c.type===e))&&(i=t.parent.childBefore(t.parentOffset)),!i.node||!i.node.marks.some(c=>c.type===e)||(r=r||((n=i.node.marks[0])==null?void 0:n.attrs),!KO([...i.node.marks],e,r)))return;let s=i.index,o=t.start()+i.offset,l=s+1,u=o+i.node.nodeSize;for(;s>0&&sP([...t.parent.child(s-1).marks],e,r);)s-=1,o-=t.parent.child(s).nodeSize;for(;l<t.parent.childCount&&sP([...t.parent.child(l).marks],e,r);)u+=t.parent.child(l).nodeSize,l+=1;return{from:o,to:u}}function _c(t,e){if(typeof t=="string"){if(!e.marks[t])throw Error(`There is no mark type named '${t}'. Maybe you forgot to add the extension?`);return e.marks[t]}return t}var uQ=(t,e={})=>({tr:r,state:n,dispatch:i})=>{const a=_c(t,n.schema),{doc:s,selection:o}=r,{$from:l,from:u,to:c}=o;if(i){const f=tC(l,a,e);if(f&&f.from<=u&&f.to>=c){const p=dr.create(s,f.from,f.to);r.setSelection(p)}}return!0},cQ=t=>e=>{const r=typeof t=="function"?t(e):t;for(let n=0;n<r.length;n+=1)if(r[n](e))return!0;return!1};function ZO(t){return t instanceof dr}function ih(t=0,e=0,r=0){return Math.min(Math.max(t,e),r)}function YO(t,e=null){if(!e)return null;const r=Sr.atStart(t),n=Sr.atEnd(t);if(e==="start"||e===!0)return r;if(e==="end")return n;const i=r.from,a=n.to;return e==="all"?dr.create(t,ih(0,i,a),ih(t.content.size,i,a)):dr.create(t,ih(e,i,a),ih(e,i,a))}function oP(){return navigator.platform==="Android"||/android/i.test(navigator.userAgent)}function jx(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}function dQ(){return typeof navigator<"u"?/^((?!chrome|android).)*safari/i.test(navigator.userAgent):!1}var fQ=(t=null,e={})=>({editor:r,view:n,tr:i,dispatch:a})=>{e={scrollIntoView:!0,...e};const s=()=>{(jx()||oP())&&n.dom.focus(),dQ()&&!jx()&&!oP()&&n.dom.focus({preventScroll:!0}),requestAnimationFrame(()=>{r.isDestroyed||(n.focus(),e?.scrollIntoView&&r.commands.scrollIntoView())})};if(n.hasFocus()&&t===null||t===!1)return!0;if(a&&t===null&&!ZO(r.state.selection))return s(),!0;const o=YO(i.doc,t)||r.state.selection,l=r.state.selection.eq(o);return a&&(l||i.setSelection(o),l&&i.storedMarks&&i.setStoredMarks(i.storedMarks),s()),!0},hQ=(t,e)=>r=>t.every((n,i)=>e(n,{...r,index:i})),pQ=(t,e)=>({tr:r,commands:n})=>n.insertContentAt({from:r.selection.from,to:r.selection.to},t,e),XO=t=>{const e=t.childNodes;for(let r=e.length-1;r>=0;r-=1){const n=e[r];n.nodeType===3&&n.nodeValue&&/^(\n\s\s|\n)$/.test(n.nodeValue)?t.removeChild(n):n.nodeType===1&&XO(n)}return t};function Sy(t){if(typeof window>"u")throw new Error("[tiptap error]: there is no window object available, so this function cannot be used");const e=`<body>${t}</body>`,r=new window.DOMParser().parseFromString(e,"text/html").body;return XO(r)}function zv(t,e,r){if(t instanceof Xo||t instanceof it)return t;r={slice:!0,parseOptions:{},...r};const n=typeof t=="object"&&t!==null,i=typeof t=="string";if(n)try{if(Array.isArray(t)&&t.length>0)return it.fromArray(t.map(o=>e.nodeFromJSON(o)));const s=e.nodeFromJSON(t);return r.errorOnInvalidContent&&s.check(),s}catch(a){if(r.errorOnInvalidContent)throw new Error("[tiptap error]: Invalid JSON content",{cause:a});return console.warn("[tiptap warn]: Invalid content.","Passed value:",t,"Error:",a),zv("",e,r)}if(i){if(r.errorOnInvalidContent){let s=!1,o="";const l=new OL({topNode:e.spec.topNode,marks:e.spec.marks,nodes:e.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:u=>(s=!0,o=typeof u=="string"?u:u.outerHTML,null)}]}})});if(r.slice?Wd.fromSchema(l).parseSlice(Sy(t),r.parseOptions):Wd.fromSchema(l).parse(Sy(t),r.parseOptions),r.errorOnInvalidContent&&s)throw new Error("[tiptap error]: Invalid HTML content",{cause:new Error(`Invalid element found: ${o}`)})}const a=Wd.fromSchema(e);return r.slice?a.parseSlice(Sy(t),r.parseOptions).content:a.parse(Sy(t),r.parseOptions)}return zv("",e,r)}function mQ(t,e,r){const n=t.steps.length-1;if(n<e)return;const i=t.steps[n];if(!(i instanceof ha||i instanceof va))return;const a=t.mapping.maps[n];let s=0;a.forEach((o,l,u,c)=>{s===0&&(s=c)}),t.setSelection(Sr.near(t.doc.resolve(s),r))}var gQ=t=>!("type"in t),vQ=(t,e,r)=>({tr:n,dispatch:i,editor:a})=>{var s;if(i){r={parseOptions:a.options.parseOptions,updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...r};let o;const l=w=>{a.emit("contentError",{editor:a,error:w,disableCollaboration:()=>{"collaboration"in a.storage&&typeof a.storage.collaboration=="object"&&a.storage.collaboration&&(a.storage.collaboration.isDisabled=!0)}})},u={preserveWhitespace:"full",...r.parseOptions};if(!r.errorOnInvalidContent&&!a.options.enableContentCheck&&a.options.emitContentError)try{zv(e,a.schema,{parseOptions:u,errorOnInvalidContent:!0})}catch(w){l(w)}try{o=zv(e,a.schema,{parseOptions:u,errorOnInvalidContent:(s=r.errorOnInvalidContent)!=null?s:a.options.enableContentCheck})}catch(w){return l(w),!1}let{from:c,to:f}=typeof t=="number"?{from:t,to:t}:{from:t.from,to:t.to},p=!0,v=!0;if((gQ(o)?o:[o]).forEach(w=>{w.check(),p=p?w.isText&&w.marks.length===0:!1,v=v?w.isBlock:!1}),c===f&&v){const{parent:w}=n.doc.resolve(c);w.isTextblock&&!w.type.spec.code&&!w.childCount&&(c-=1,f+=1)}let S;if(p){if(Array.isArray(e))S=e.map(w=>w.text||"").join("");else if(e instanceof it){let w="";e.forEach(E=>{E.text&&(w+=E.text)}),S=w}else typeof e=="object"&&e&&e.text?S=e.text:S=e;n.insertText(S,c,f)}else{S=o;const w=n.doc.resolve(c),E=w.node(),_=w.parentOffset===0,T=E.isText||E.isTextblock,N=E.content.size>0;_&&T&&N&&(c=Math.max(0,c-1)),n.replaceWith(c,f,S)}r.updateSelection&&mQ(n,n.steps.length-1,-1),r.applyInputRules&&n.setMeta("applyInputRules",{from:c,text:S}),r.applyPasteRules&&n.setMeta("applyPasteRules",{from:c,text:S})}return!0},yQ=()=>({state:t,dispatch:e})=>GZ(t,e),xQ=()=>({state:t,dispatch:e})=>VZ(t,e),bQ=()=>({state:t,dispatch:e})=>eO(t,e),wQ=()=>({state:t,dispatch:e})=>iO(t,e),SQ=()=>({state:t,dispatch:e,tr:r})=>{try{const n=q1(t.doc,t.selection.$from.pos,-1);return n==null?!1:(r.join(n,2),e&&e(r),!0)}catch{return!1}},kQ=()=>({state:t,dispatch:e,tr:r})=>{try{const n=q1(t.doc,t.selection.$from.pos,1);return n==null?!1:(r.join(n,2),e&&e(r),!0)}catch{return!1}},_Q=()=>({state:t,dispatch:e})=>zZ(t,e),CQ=()=>({state:t,dispatch:e})=>UZ(t,e);function QO(){return typeof navigator<"u"?/Mac/.test(navigator.platform):!1}function EQ(t){const e=t.split(/-(?!$)/);let r=e[e.length-1];r==="Space"&&(r=" ");let n,i,a,s;for(let o=0;o<e.length-1;o+=1){const l=e[o];if(/^(cmd|meta|m)$/i.test(l))s=!0;else if(/^a(lt)?$/i.test(l))n=!0;else if(/^(c|ctrl|control)$/i.test(l))i=!0;else if(/^s(hift)?$/i.test(l))a=!0;else if(/^mod$/i.test(l))jx()||QO()?s=!0:i=!0;else throw new Error(`Unrecognized modifier name: ${l}`)}return n&&(r=`Alt-${r}`),i&&(r=`Ctrl-${r}`),s&&(r=`Meta-${r}`),a&&(r=`Shift-${r}`),r}var TQ=t=>({editor:e,view:r,tr:n,dispatch:i})=>{const a=EQ(t).split(/-(?!$)/),s=a.find(u=>!["Alt","Ctrl","Meta","Shift"].includes(u)),o=new KeyboardEvent("keydown",{key:s==="Space"?" ":s,altKey:a.includes("Alt"),ctrlKey:a.includes("Ctrl"),metaKey:a.includes("Meta"),shiftKey:a.includes("Shift"),bubbles:!0,cancelable:!0}),l=e.captureTransaction(()=>{r.someProp("handleKeyDown",u=>u(r,o))});return l?.steps.forEach(u=>{const c=u.map(n.mapping);c&&i&&n.maybeStep(c)}),!0};function nf(t,e,r={}){const{from:n,to:i,empty:a}=t.selection,s=e?ji(e,t.schema):null,o=[];t.doc.nodesBetween(n,i,(f,p)=>{if(f.isText)return;const v=Math.max(n,p),y=Math.min(i,p+f.nodeSize);o.push({node:f,from:v,to:y})});const l=i-n,u=o.filter(f=>s?s.name===f.node.type.name:!0).filter(f=>Ix(f.node.attrs,r,{strict:!1}));return a?!!u.length:u.reduce((f,p)=>f+p.to-p.from,0)>=l}var NQ=(t,e={})=>({state:r,dispatch:n})=>{const i=ji(t,r.schema);return nf(r,i,e)?HZ(r,n):!1},PQ=()=>({state:t,dispatch:e})=>lO(t,e),MQ=t=>({state:e,dispatch:r})=>{const n=ji(t,e.schema);return rY(n)(e,r)},AQ=()=>({state:t,dispatch:e})=>sO(t,e);function eb(t,e){return e.nodes[t]?"node":e.marks[t]?"mark":null}function lP(t,e){const r=typeof e=="string"?[e]:e;return Object.keys(t).reduce((n,i)=>(r.includes(i)||(n[i]=t[i]),n),{})}var RQ=(t,e)=>({tr:r,state:n,dispatch:i})=>{let a=null,s=null;const o=eb(typeof t=="string"?t:t.name,n.schema);if(!o)return!1;o==="node"&&(a=ji(t,n.schema)),o==="mark"&&(s=_c(t,n.schema));let l=!1;return r.selection.ranges.forEach(u=>{n.doc.nodesBetween(u.$from.pos,u.$to.pos,(c,f)=>{a&&a===c.type&&(l=!0,i&&r.setNodeMarkup(f,void 0,lP(c.attrs,e))),s&&c.marks.length&&c.marks.forEach(p=>{s===p.type&&(l=!0,i&&r.addMark(f,f+c.nodeSize,s.create(lP(p.attrs,e))))})})}),l},LQ=()=>({tr:t,dispatch:e})=>(e&&t.scrollIntoView(),!0),OQ=()=>({tr:t,dispatch:e})=>{if(e){const r=new vo(t.doc);t.setSelection(r)}return!0},DQ=()=>({state:t,dispatch:e})=>rO(t,e),IQ=()=>({state:t,dispatch:e})=>aO(t,e),jQ=()=>({state:t,dispatch:e})=>KZ(t,e),FQ=()=>({state:t,dispatch:e})=>XZ(t,e),BQ=()=>({state:t,dispatch:e})=>YZ(t,e);function _k(t,e,r={},n={}){return zv(t,e,{slice:!1,parseOptions:r,errorOnInvalidContent:n.errorOnInvalidContent})}var zQ=(t,{errorOnInvalidContent:e,emitUpdate:r=!0,parseOptions:n={}}={})=>({editor:i,tr:a,dispatch:s,commands:o})=>{const{doc:l}=a;if(n.preserveWhitespace!=="full"){const u=_k(t,i.schema,n,{errorOnInvalidContent:e??i.options.enableContentCheck});return s&&a.replaceWith(0,l.content.size,u).setMeta("preventUpdate",!r),!0}return s&&a.setMeta("preventUpdate",!r),o.insertContentAt({from:0,to:l.content.size},t,{parseOptions:n,errorOnInvalidContent:e??i.options.enableContentCheck})};function JO(t,e){const r=_c(e,t.schema),{from:n,to:i,empty:a}=t.selection,s=[];a?(t.storedMarks&&s.push(...t.storedMarks),s.push(...t.selection.$head.marks())):t.doc.nodesBetween(n,i,l=>{s.push(...l.marks)});const o=s.find(l=>l.type.name===r.name);return o?{...o.attrs}:{}}function e6(t,e){const r=new YL(t);return e.forEach(n=>{n.steps.forEach(i=>{r.step(i)})}),r}function UQ(t){for(let e=0;e<t.edgeCount;e+=1){const{type:r}=t.edge(e);if(r.isTextblock&&!r.hasRequiredAttrs())return r}return null}function GQ(t,e,r){const n=[];return t.nodesBetween(e.from,e.to,(i,a)=>{r(i)&&n.push({node:i,pos:a})}),n}function VQ(t,e){for(let r=t.depth;r>0;r-=1){const n=t.node(r);if(e(n))return{pos:r>0?t.before(r):0,start:t.start(r),depth:r,node:n}}}function tb(t){return e=>VQ(e.$from,t)}function $t(t,e,r){return t.config[e]===void 0&&t.parent?$t(t.parent,e,r):typeof t.config[e]=="function"?t.config[e].bind({...r,parent:t.parent?$t(t.parent,e,r):null}):t.config[e]}function rC(t){return t.map(e=>{const r={name:e.name,options:e.options,storage:e.storage},n=$t(e,"addExtensions",r);return n?[e,...rC(n())]:e}).flat(10)}function nC(t,e){const r=Ah.fromSchema(e).serializeFragment(t),i=document.implementation.createHTMLDocument().createElement("div");return i.appendChild(r),i.innerHTML}function t6(t){return typeof t=="function"}function dn(t,e=void 0,...r){return t6(t)?e?t.bind(e)(...r):t(...r):t}function HQ(t={}){return Object.keys(t).length===0&&t.constructor===Object}function Jp(t){const e=t.filter(i=>i.type==="extension"),r=t.filter(i=>i.type==="node"),n=t.filter(i=>i.type==="mark");return{baseExtensions:e,nodeExtensions:r,markExtensions:n}}function r6(t){const e=[],{nodeExtensions:r,markExtensions:n}=Jp(t),i=[...r,...n],a={default:null,validate:void 0,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0,isRequired:!1};return t.forEach(s=>{const o={name:s.name,options:s.options,storage:s.storage,extensions:i},l=$t(s,"addGlobalAttributes",o);if(!l)return;l().forEach(c=>{c.types.forEach(f=>{Object.entries(c.attributes).forEach(([p,v])=>{e.push({type:f,name:p,attribute:{...a,...v}})})})})}),i.forEach(s=>{const o={name:s.name,options:s.options,storage:s.storage},l=$t(s,"addAttributes",o);if(!l)return;const u=l();Object.entries(u).forEach(([c,f])=>{const p={...a,...f};typeof p?.default=="function"&&(p.default=p.default()),p?.isRequired&&p?.default===void 0&&delete p.default,e.push({type:s.name,name:c,attribute:p})})}),e}function Zn(...t){return t.filter(e=>!!e).reduce((e,r)=>{const n={...e};return Object.entries(r).forEach(([i,a])=>{if(!n[i]){n[i]=a;return}if(i==="class"){const o=a?String(a).split(" "):[],l=n[i]?n[i].split(" "):[],u=o.filter(c=>!l.includes(c));n[i]=[...l,...u].join(" ")}else if(i==="style"){const o=a?a.split(";").map(c=>c.trim()).filter(Boolean):[],l=n[i]?n[i].split(";").map(c=>c.trim()).filter(Boolean):[],u=new Map;l.forEach(c=>{const[f,p]=c.split(":").map(v=>v.trim());u.set(f,p)}),o.forEach(c=>{const[f,p]=c.split(":").map(v=>v.trim());u.set(f,p)}),n[i]=Array.from(u.entries()).map(([c,f])=>`${c}: ${f}`).join("; ")}else n[i]=a}),n},{})}function Uv(t,e){return e.filter(r=>r.type===t.type.name).filter(r=>r.attribute.rendered).map(r=>r.attribute.renderHTML?r.attribute.renderHTML(t.attrs)||{}:{[r.name]:t.attrs[r.name]}).reduce((r,n)=>Zn(r,n),{})}function WQ(t){return typeof t!="string"?t:t.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(t):t==="true"?!0:t==="false"?!1:t}function uP(t,e){return"style"in t?t:{...t,getAttrs:r=>{const n=t.getAttrs?t.getAttrs(r):t.attrs;if(n===!1)return!1;const i=e.reduce((a,s)=>{const o=s.attribute.parseHTML?s.attribute.parseHTML(r):WQ(r.getAttribute(s.name));return o==null?a:{...a,[s.name]:o}},{});return{...n,...i}}}}function cP(t){return Object.fromEntries(Object.entries(t).filter(([e,r])=>e==="attrs"&&HQ(r)?!1:r!=null))}function dP(t){var e,r;const n={};return!((e=t?.attribute)!=null&&e.isRequired)&&"default"in(t?.attribute||{})&&(n.default=t.attribute.default),((r=t?.attribute)==null?void 0:r.validate)!==void 0&&(n.validate=t.attribute.validate),[t.name,n]}function qQ(t,e){var r;const n=r6(t),{nodeExtensions:i,markExtensions:a}=Jp(t),s=(r=i.find(u=>$t(u,"topNode")))==null?void 0:r.name,o=Object.fromEntries(i.map(u=>{const c=n.filter(E=>E.type===u.name),f={name:u.name,options:u.options,storage:u.storage,editor:e},p=t.reduce((E,_)=>{const T=$t(_,"extendNodeSchema",f);return{...E,...T?T(u):{}}},{}),v=cP({...p,content:dn($t(u,"content",f)),marks:dn($t(u,"marks",f)),group:dn($t(u,"group",f)),inline:dn($t(u,"inline",f)),atom:dn($t(u,"atom",f)),selectable:dn($t(u,"selectable",f)),draggable:dn($t(u,"draggable",f)),code:dn($t(u,"code",f)),whitespace:dn($t(u,"whitespace",f)),linebreakReplacement:dn($t(u,"linebreakReplacement",f)),defining:dn($t(u,"defining",f)),isolating:dn($t(u,"isolating",f)),attrs:Object.fromEntries(c.map(dP))}),y=dn($t(u,"parseHTML",f));y&&(v.parseDOM=y.map(E=>uP(E,c)));const S=$t(u,"renderHTML",f);S&&(v.toDOM=E=>S({node:E,HTMLAttributes:Uv(E,c)}));const w=$t(u,"renderText",f);return w&&(v.toText=w),[u.name,v]})),l=Object.fromEntries(a.map(u=>{const c=n.filter(w=>w.type===u.name),f={name:u.name,options:u.options,storage:u.storage,editor:e},p=t.reduce((w,E)=>{const _=$t(E,"extendMarkSchema",f);return{...w,..._?_(u):{}}},{}),v=cP({...p,inclusive:dn($t(u,"inclusive",f)),excludes:dn($t(u,"excludes",f)),group:dn($t(u,"group",f)),spanning:dn($t(u,"spanning",f)),code:dn($t(u,"code",f)),attrs:Object.fromEntries(c.map(dP))}),y=dn($t(u,"parseHTML",f));y&&(v.parseDOM=y.map(w=>uP(w,c)));const S=$t(u,"renderHTML",f);return S&&(v.toDOM=w=>S({mark:w,HTMLAttributes:Uv(w,c)})),[u.name,v]}));return new OL({topNode:s,nodes:o,marks:l})}function $Q(t){const e=t.filter((r,n)=>t.indexOf(r)!==n);return Array.from(new Set(e))}function Fx(t){return t.sort((r,n)=>{const i=$t(r,"priority")||100,a=$t(n,"priority")||100;return i>a?-1:i<a?1:0})}function n6(t){const e=Fx(rC(t)),r=$Q(e.map(n=>n.name));return r.length&&console.warn(`[tiptap warn]: Duplicate extension names found: [${r.map(n=>`'${n}'`).join(", ")}]. This can lead to issues.`),e}function i6(t,e,r){const{from:n,to:i}=e,{blockSeparator:a=`

`,textSerializers:s={}}=r||{};let o="";return t.nodesBetween(n,i,(l,u,c,f)=>{var p;l.isBlock&&u>n&&(o+=a);const v=s?.[l.type.name];if(v)return c&&(o+=v({node:l,pos:u,parent:c,index:f,range:e})),!1;l.isText&&(o+=(p=l?.text)==null?void 0:p.slice(Math.max(n,u)-u,i-u))}),o}function KQ(t,e){const r={from:0,to:t.content.size};return i6(t,r,e)}function a6(t){return Object.fromEntries(Object.entries(t.nodes).filter(([,e])=>e.spec.toText).map(([e,r])=>[e,r.spec.toText]))}function ZQ(t,e){const r=ji(e,t.schema),{from:n,to:i}=t.selection,a=[];t.doc.nodesBetween(n,i,o=>{a.push(o)});const s=a.reverse().find(o=>o.type.name===r.name);return s?{...s.attrs}:{}}function s6(t,e){const r=eb(typeof e=="string"?e:e.name,t.schema);return r==="node"?ZQ(t,e):r==="mark"?JO(t,e):{}}function YQ(t,e=JSON.stringify){const r={};return t.filter(n=>{const i=e(n);return Object.prototype.hasOwnProperty.call(r,i)?!1:r[i]=!0})}function XQ(t){const e=YQ(t);return e.length===1?e:e.filter((r,n)=>!e.filter((a,s)=>s!==n).some(a=>r.oldRange.from>=a.oldRange.from&&r.oldRange.to<=a.oldRange.to&&r.newRange.from>=a.newRange.from&&r.newRange.to<=a.newRange.to))}function o6(t){const{mapping:e,steps:r}=t,n=[];return e.maps.forEach((i,a)=>{const s=[];if(i.ranges.length)i.forEach((o,l)=>{s.push({from:o,to:l})});else{const{from:o,to:l}=r[a];if(o===void 0||l===void 0)return;s.push({from:o,to:l})}s.forEach(({from:o,to:l})=>{const u=e.slice(a).map(o,-1),c=e.slice(a).map(l),f=e.invert().map(u,-1),p=e.invert().map(c);n.push({oldRange:{from:f,to:p},newRange:{from:u,to:c}})})}),XQ(n)}function iC(t,e,r){const n=[];return t===e?r.resolve(t).marks().forEach(i=>{const a=r.resolve(t),s=tC(a,i.type);s&&n.push({mark:i,...s})}):r.nodesBetween(t,e,(i,a)=>{!i||i?.nodeSize===void 0||n.push(...i.marks.map(s=>({from:a,to:a+i.nodeSize,mark:s})))}),n}var QQ=(t,e,r,n=20)=>{const i=t.doc.resolve(r);let a=n,s=null;for(;a>0&&s===null;){const o=i.node(a);o?.type.name===e?s=o:a-=1}return[s,a]};function ky(t,e){return e.nodes[t]||e.marks[t]||null}function Yy(t,e,r){return Object.fromEntries(Object.entries(r).filter(([n])=>{const i=t.find(a=>a.type===e&&a.name===n);return i?i.attribute.keepOnSplit:!1}))}var JQ=(t,e=500)=>{let r="";const n=t.parentOffset;return t.parent.nodesBetween(Math.max(0,n-e),n,(i,a,s,o)=>{var l,u;const c=((u=(l=i.type.spec).toText)==null?void 0:u.call(l,{node:i,pos:a,parent:s,index:o}))||i.textContent||"%leaf%";r+=i.isAtom&&!i.isText?c:c.slice(0,Math.max(0,n-a))}),r};function Ck(t,e,r={}){const{empty:n,ranges:i}=t.selection,a=e?_c(e,t.schema):null;if(n)return!!(t.storedMarks||t.selection.$from.marks()).filter(f=>a?a.name===f.type.name:!0).find(f=>Ix(f.attrs,r,{strict:!1}));let s=0;const o=[];if(i.forEach(({$from:f,$to:p})=>{const v=f.pos,y=p.pos;t.doc.nodesBetween(v,y,(S,w)=>{if(!S.isText&&!S.marks.length)return;const E=Math.max(v,w),_=Math.min(y,w+S.nodeSize),T=_-E;s+=T,o.push(...S.marks.map(N=>({mark:N,from:E,to:_})))})}),s===0)return!1;const l=o.filter(f=>a?a.name===f.mark.type.name:!0).filter(f=>Ix(f.mark.attrs,r,{strict:!1})).reduce((f,p)=>f+p.to-p.from,0),u=o.filter(f=>a?f.mark.type!==a&&f.mark.type.excludes(a):!0).reduce((f,p)=>f+p.to-p.from,0);return(l>0?l+u:l)>=s}function eJ(t,e,r={}){if(!e)return nf(t,null,r)||Ck(t,null,r);const n=eb(e,t.schema);return n==="node"?nf(t,e,r):n==="mark"?Ck(t,e,r):!1}var tJ=(t,e)=>{const{$from:r,$to:n,$anchor:i}=t.selection;if(e){const a=tb(o=>o.type.name===e)(t.selection);if(!a)return!1;const s=t.doc.resolve(a.pos+1);return i.pos+1===s.end()}return!(n.parentOffset<n.parent.nodeSize-2||r.pos!==n.pos)},rJ=t=>{const{$from:e,$to:r}=t.selection;return!(e.parentOffset>0||e.pos!==r.pos)};function fP(t,e){return Array.isArray(e)?e.some(r=>(typeof r=="string"?r:r.name)===t.name):e}function hP(t,e){const{nodeExtensions:r}=Jp(e),n=r.find(s=>s.name===t);if(!n)return!1;const i={name:n.name,options:n.options,storage:n.storage},a=dn($t(n,"group",i));return typeof a!="string"?!1:a.split(" ").includes("list")}function rb(t,{checkChildren:e=!0,ignoreWhitespace:r=!1}={}){var n;if(r){if(t.type.name==="hardBreak")return!0;if(t.isText)return/^\s*$/m.test((n=t.text)!=null?n:"")}if(t.isText)return!t.text;if(t.isAtom||t.isLeaf)return!1;if(t.content.childCount===0)return!0;if(e){let i=!0;return t.content.forEach(a=>{i!==!1&&(rb(a,{ignoreWhitespace:r,checkChildren:e})||(i=!1))}),i}return!1}function l6(t){return t instanceof Xt}var u6=class c6{constructor(e){this.position=e}static fromJSON(e){return new c6(e.position)}toJSON(){return{position:this.position}}};function nJ(t,e){const r=e.mapping.mapResult(t.position);return{position:new u6(r.pos),mapResult:r}}function iJ(t){return new u6(t)}function aJ(t,e,r){var n;const{selection:i}=e;let a=null;if(ZO(i)&&(a=i.$cursor),a){const o=(n=t.storedMarks)!=null?n:a.marks();return a.parent.type.allowsMarkType(r)&&(!!r.isInSet(o)||!o.some(u=>u.type.excludes(r)))}const{ranges:s}=i;return s.some(({$from:o,$to:l})=>{let u=o.depth===0?t.doc.inlineContent&&t.doc.type.allowsMarkType(r):!1;return t.doc.nodesBetween(o.pos,l.pos,(c,f,p)=>{if(u)return!1;if(c.isInline){const v=!p||p.type.allowsMarkType(r),y=!!r.isInSet(c.marks)||!c.marks.some(S=>S.type.excludes(r));u=v&&y}return!u}),u})}var sJ=(t,e={})=>({tr:r,state:n,dispatch:i})=>{const{selection:a}=r,{empty:s,ranges:o}=a,l=_c(t,n.schema);if(i)if(s){const u=JO(n,l);r.addStoredMark(l.create({...u,...e}))}else o.forEach(u=>{const c=u.$from.pos,f=u.$to.pos;n.doc.nodesBetween(c,f,(p,v)=>{const y=Math.max(v,c),S=Math.min(v+p.nodeSize,f);p.marks.find(E=>E.type===l)?p.marks.forEach(E=>{l===E.type&&r.addMark(y,S,l.create({...E.attrs,...e}))}):r.addMark(y,S,l.create(e))})});return aJ(n,r,l)},oJ=(t,e)=>({tr:r})=>(r.setMeta(t,e),!0),lJ=(t,e={})=>({state:r,dispatch:n,chain:i})=>{const a=ji(t,r.schema);let s;return r.selection.$anchor.sameParent(r.selection.$head)&&(s=r.selection.$anchor.parent.attrs),a.isTextblock?i().command(({commands:o})=>E3(a,{...s,...e})(r)?!0:o.clearNodes()).command(({state:o})=>E3(a,{...s,...e})(o,n)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},uJ=t=>({tr:e,dispatch:r})=>{if(r){const{doc:n}=e,i=ih(t,0,n.content.size),a=Xt.create(n,i);e.setSelection(a)}return!0},cJ=(t,e)=>({tr:r,state:n,dispatch:i})=>{const{selection:a}=n;let s,o;return typeof e=="number"?(s=e,o=e):e&&"from"in e&&"to"in e?(s=e.from,o=e.to):(s=a.from,o=a.to),i&&r.doc.nodesBetween(s,o,(l,u)=>{l.isText||r.setNodeMarkup(u,void 0,{...l.attrs,dir:t})}),!0},dJ=t=>({tr:e,dispatch:r})=>{if(r){const{doc:n}=e,{from:i,to:a}=typeof t=="number"?{from:t,to:t}:t,s=dr.atStart(n).from,o=dr.atEnd(n).to,l=ih(i,s,o),u=ih(a,s,o),c=dr.create(n,l,u);e.setSelection(c)}return!0},fJ=t=>({state:e,dispatch:r})=>{const n=ji(t,e.schema);return aY(n)(e,r)};function pP(t,e){const r=t.storedMarks||t.selection.$to.parentOffset&&t.selection.$from.marks();if(r){const n=r.filter(i=>e?.includes(i.type.name));t.tr.ensureMarks(n)}}var hJ=({keepMarks:t=!0}={})=>({tr:e,state:r,dispatch:n,editor:i})=>{const{selection:a,doc:s}=e,{$from:o,$to:l}=a,u=i.extensionManager.attributes,c=Yy(u,o.node().type.name,o.node().attrs);if(a instanceof Xt&&a.node.isBlock)return!o.parentOffset||!mc(s,o.pos)?!1:(n&&(t&&pP(r,i.extensionManager.splittableMarks),e.split(o.pos).scrollIntoView()),!0);if(!o.parent.isBlock)return!1;const f=l.parentOffset===l.parent.content.size,p=o.depth===0?void 0:UQ(o.node(-1).contentMatchAt(o.indexAfter(-1)));let v=f&&p?[{type:p,attrs:c}]:void 0,y=mc(e.doc,e.mapping.map(o.pos),1,v);if(!v&&!y&&mc(e.doc,e.mapping.map(o.pos),1,p?[{type:p}]:void 0)&&(y=!0,v=p?[{type:p,attrs:c}]:void 0),n){if(y&&(a instanceof dr&&e.deleteSelection(),e.split(e.mapping.map(o.pos),1,v),p&&!f&&!o.parentOffset&&o.parent.type!==p)){const S=e.mapping.map(o.before()),w=e.doc.resolve(S);o.node(-1).canReplaceWith(w.index(),w.index()+1,p)&&e.setNodeMarkup(e.mapping.map(o.before()),p)}t&&pP(r,i.extensionManager.splittableMarks),e.scrollIntoView()}return y},pJ=(t,e={})=>({tr:r,state:n,dispatch:i,editor:a})=>{var s;const o=ji(t,n.schema),{$from:l,$to:u}=n.selection,c=n.selection.node;if(c&&c.isBlock||l.depth<2||!l.sameParent(u))return!1;const f=l.node(-1);if(f.type!==o)return!1;const p=a.extensionManager.attributes;if(l.parent.content.size===0&&l.node(-1).childCount===l.indexAfter(-1)){if(l.depth===2||l.node(-3).type!==o||l.index(-2)!==l.node(-2).childCount-1)return!1;if(i){let E=it.empty;const _=l.index(-1)?1:l.index(-2)?2:3;for(let D=l.depth-_;D>=l.depth-3;D-=1)E=it.from(l.node(D).copy(E));const T=l.indexAfter(-1)<l.node(-2).childCount?1:l.indexAfter(-2)<l.node(-3).childCount?2:3,N={...Yy(p,l.node().type.name,l.node().attrs),...e},R=((s=o.contentMatch.defaultType)==null?void 0:s.createAndFill(N))||void 0;E=E.append(it.from(o.createAndFill(null,R)||void 0));const I=l.before(l.depth-(_-1));r.replace(I,l.after(-T),new Pt(E,4-_,0));let F=-1;r.doc.nodesBetween(I,r.doc.content.size,(D,j)=>{if(F>-1)return!1;D.isTextblock&&D.content.size===0&&(F=j+1)}),F>-1&&r.setSelection(dr.near(r.doc.resolve(F))),r.scrollIntoView()}return!0}const v=u.pos===l.end()?f.contentMatchAt(0).defaultType:null,y={...Yy(p,f.type.name,f.attrs),...e},S={...Yy(p,l.node().type.name,l.node().attrs),...e};r.delete(l.pos,u.pos);const w=v?[{type:o,attrs:y},{type:v,attrs:S}]:[{type:o,attrs:y}];if(!mc(r.doc,l.pos,2))return!1;if(i){const{selection:E,storedMarks:_}=n,{splittableMarks:T}=a.extensionManager,N=_||E.$to.parentOffset&&E.$from.marks();if(r.split(l.pos,2,w).scrollIntoView(),!N||!i)return!0;const R=N.filter(I=>T.includes(I.type.name));r.ensureMarks(R)}return!0},cS=(t,e)=>{const r=tb(s=>s.type===e)(t.selection);if(!r)return!0;const n=t.doc.resolve(Math.max(0,r.pos-1)).before(r.depth);if(n===void 0)return!0;const i=t.doc.nodeAt(n);return r.node.type===i?.type&&hf(t.doc,r.pos)&&t.join(r.pos),!0},dS=(t,e)=>{const r=tb(s=>s.type===e)(t.selection);if(!r)return!0;const n=t.doc.resolve(r.start).after(r.depth);if(n===void 0)return!0;const i=t.doc.nodeAt(n);return r.node.type===i?.type&&hf(t.doc,n)&&t.join(n),!0},mJ=(t,e,r,n={})=>({editor:i,tr:a,state:s,dispatch:o,chain:l,commands:u,can:c})=>{const{extensions:f,splittableMarks:p}=i.extensionManager,v=ji(t,s.schema),y=ji(e,s.schema),{selection:S,storedMarks:w}=s,{$from:E,$to:_}=S,T=E.blockRange(_),N=w||S.$to.parentOffset&&S.$from.marks();if(!T)return!1;const R=tb(I=>hP(I.type.name,f))(S);if(T.depth>=1&&R&&T.depth-R.depth<=1){if(R.node.type===v)return u.liftListItem(y);if(hP(R.node.type.name,f)&&v.validContent(R.node.content)&&o)return l().command(()=>(a.setNodeMarkup(R.pos,v),!0)).command(()=>cS(a,v)).command(()=>dS(a,v)).run()}return!r||!N||!o?l().command(()=>c().wrapInList(v,n)?!0:u.clearNodes()).wrapInList(v,n).command(()=>cS(a,v)).command(()=>dS(a,v)).run():l().command(()=>{const I=c().wrapInList(v,n),F=N.filter(D=>p.includes(D.type.name));return a.ensureMarks(F),I?!0:u.clearNodes()}).wrapInList(v,n).command(()=>cS(a,v)).command(()=>dS(a,v)).run()},gJ=(t,e={},r={})=>({state:n,commands:i})=>{const{extendEmptyMarkRange:a=!1}=r,s=_c(t,n.schema);return Ck(n,s,e)?i.unsetMark(s,{extendEmptyMarkRange:a}):i.setMark(s,e)},vJ=(t,e,r={})=>({state:n,commands:i})=>{const a=ji(t,n.schema),s=ji(e,n.schema),o=nf(n,a,r);let l;return n.selection.$anchor.sameParent(n.selection.$head)&&(l=n.selection.$anchor.parent.attrs),o?i.setNode(s,l):i.setNode(a,{...l,...r})},yJ=(t,e={})=>({state:r,commands:n})=>{const i=ji(t,r.schema);return nf(r,i,e)?n.lift(i):n.wrapIn(i,e)},xJ=()=>({state:t,dispatch:e})=>{const r=t.plugins;for(let n=0;n<r.length;n+=1){const i=r[n];let a;if(i.spec.isInputRules&&(a=i.getState(t))){if(e){const s=t.tr,o=a.transform;for(let l=o.steps.length-1;l>=0;l-=1)s.step(o.steps[l].invert(o.docs[l]));if(a.text){const l=s.doc.resolve(a.from).marks();s.replaceWith(a.from,a.to,t.schema.text(a.text,l))}else s.delete(a.from,a.to)}return!0}}return!1},bJ=()=>({tr:t,dispatch:e})=>{const{selection:r}=t,{empty:n,ranges:i}=r;return n||e&&i.forEach(a=>{t.removeMark(a.$from.pos,a.$to.pos)}),!0},wJ=(t,e={})=>({tr:r,state:n,dispatch:i})=>{var a;const{extendEmptyMarkRange:s=!1}=e,{selection:o}=r,l=_c(t,n.schema),{$from:u,empty:c,ranges:f}=o;if(!i)return!0;if(c&&s){let{from:p,to:v}=o;const y=(a=u.marks().find(w=>w.type===l))==null?void 0:a.attrs,S=tC(u,l,y);S&&(p=S.from,v=S.to),r.removeMark(p,v,l)}else f.forEach(p=>{r.removeMark(p.$from.pos,p.$to.pos,l)});return r.removeStoredMark(l),!0},SJ=t=>({tr:e,state:r,dispatch:n})=>{const{selection:i}=r;let a,s;return typeof t=="number"?(a=t,s=t):t&&"from"in t&&"to"in t?(a=t.from,s=t.to):(a=i.from,s=i.to),n&&e.doc.nodesBetween(a,s,(o,l)=>{if(o.isText)return;const u={...o.attrs};delete u.dir,e.setNodeMarkup(l,void 0,u)}),!0},kJ=(t,e={})=>({tr:r,state:n,dispatch:i})=>{let a=null,s=null;const o=eb(typeof t=="string"?t:t.name,n.schema);if(!o)return!1;o==="node"&&(a=ji(t,n.schema)),o==="mark"&&(s=_c(t,n.schema));let l=!1;return r.selection.ranges.forEach(u=>{const c=u.$from.pos,f=u.$to.pos;let p,v,y,S;r.selection.empty?n.doc.nodesBetween(c,f,(w,E)=>{a&&a===w.type&&(l=!0,y=Math.max(E,c),S=Math.min(E+w.nodeSize,f),p=E,v=w)}):n.doc.nodesBetween(c,f,(w,E)=>{E<c&&a&&a===w.type&&(l=!0,y=Math.max(E,c),S=Math.min(E+w.nodeSize,f),p=E,v=w),E>=c&&E<=f&&(a&&a===w.type&&(l=!0,i&&r.setNodeMarkup(E,void 0,{...w.attrs,...e})),s&&w.marks.length&&w.marks.forEach(_=>{if(s===_.type&&(l=!0,i)){const T=Math.max(E,c),N=Math.min(E+w.nodeSize,f);r.addMark(T,N,s.create({..._.attrs,...e}))}}))}),v&&(p!==void 0&&i&&r.setNodeMarkup(p,void 0,{...v.attrs,...e}),s&&v.marks.length&&v.marks.forEach(w=>{s===w.type&&i&&r.addMark(y,S,s.create({...w.attrs,...e}))}))}),l},_J=(t,e={})=>({state:r,dispatch:n})=>{const i=ji(t,r.schema);return QZ(i,e)(r,n)},CJ=(t,e={})=>({state:r,dispatch:n})=>{const i=ji(t,r.schema);return JZ(i,e)(r,n)},EJ=class{constructor(){this.callbacks={}}on(t,e){return this.callbacks[t]||(this.callbacks[t]=[]),this.callbacks[t].push(e),this}emit(t,...e){const r=this.callbacks[t];return r&&r.forEach(n=>n.apply(this,e)),this}off(t,e){const r=this.callbacks[t];return r&&(e?this.callbacks[t]=r.filter(n=>n!==e):delete this.callbacks[t]),this}once(t,e){const r=(...n)=>{this.off(t,r),e.apply(this,n)};return this.on(t,r)}removeAllListeners(){this.callbacks={}}},nb=class{constructor(t){var e;this.find=t.find,this.handler=t.handler,this.undoable=(e=t.undoable)!=null?e:!0}},TJ=(t,e)=>{if(eC(e))return e.exec(t);const r=e(t);if(!r)return null;const n=[r.text];return n.index=r.index,n.input=t,n.data=r.data,r.replaceWith&&(r.text.includes(r.replaceWith)||console.warn('[tiptap warn]: "inputRuleMatch.replaceWith" must be part of "inputRuleMatch.text".'),n.push(r.replaceWith)),n};function _y(t){var e;const{editor:r,from:n,to:i,text:a,rules:s,plugin:o}=t,{view:l}=r;if(l.composing)return!1;const u=l.state.doc.resolve(n);if(u.parent.type.spec.code||(e=u.nodeBefore||u.nodeAfter)!=null&&e.marks.find(p=>p.type.spec.code))return!1;let c=!1;const f=JQ(u)+a;return s.forEach(p=>{if(c)return;const v=TJ(f,p.find);if(!v)return;const y=l.state.tr,S=Q1({state:l.state,transaction:y}),w={from:n-(v[0].length-a.length),to:i},{commands:E,chain:_,can:T}=new J1({editor:r,state:S});p.handler({state:S,range:w,match:v,commands:E,chain:_,can:T})===null||!y.steps.length||(p.undoable&&y.setMeta(o,{transform:y,from:n,to:i,text:a}),l.dispatch(y),c=!0)}),c}function NJ(t){const{editor:e,rules:r}=t,n=new Yn({state:{init(){return null},apply(i,a,s){const o=i.getMeta(n);if(o)return o;const l=i.getMeta("applyInputRules");return l&&setTimeout(()=>{let{text:c}=l;typeof c=="string"?c=c:c=nC(it.from(c),s.schema);const{from:f}=l,p=f+c.length;_y({editor:e,from:f,to:p,text:c,rules:r,plugin:n})}),i.selectionSet||i.docChanged?null:a}},props:{handleTextInput(i,a,s,o){return _y({editor:e,from:a,to:s,text:o,rules:r,plugin:n})},handleDOMEvents:{compositionend:i=>(setTimeout(()=>{const{$cursor:a}=i.state.selection;a&&_y({editor:e,from:a.pos,to:a.pos,text:"",rules:r,plugin:n})}),!1)},handleKeyDown(i,a){if(a.key!=="Enter")return!1;const{$cursor:s}=i.state.selection;return s?_y({editor:e,from:s.pos,to:s.pos,text:`
`,rules:r,plugin:n}):!1}},isInputRules:!0});return n}function PJ(t){return Object.prototype.toString.call(t).slice(8,-1)}function Cy(t){return PJ(t)!=="Object"?!1:t.constructor===Object&&Object.getPrototypeOf(t)===Object.prototype}function d6(t,e){const r={...t};return Cy(t)&&Cy(e)&&Object.keys(e).forEach(n=>{Cy(e[n])&&Cy(t[n])?r[n]=d6(t[n],e[n]):r[n]=e[n]}),r}var aC=class{constructor(t={}){this.type="extendable",this.parent=null,this.child=null,this.name="",this.config={name:this.name},this.config={...this.config,...t},this.name=this.config.name}get options(){return{...dn($t(this,"addOptions",{name:this.name}))||{}}}get storage(){return{...dn($t(this,"addStorage",{name:this.name,options:this.options}))||{}}}configure(t={}){const e=this.extend({...this.config,addOptions:()=>d6(this.options,t)});return e.name=this.name,e.parent=this.parent,e}extend(t={}){const e=new this.constructor({...this.config,...t});return e.parent=this,this.child=e,e.name="name"in t?t.name:e.parent.name,e}},Rh=class f6 extends aC{constructor(){super(...arguments),this.type="mark"}static create(e={}){const r=typeof e=="function"?e():e;return new f6(r)}static handleExit({editor:e,mark:r}){const{tr:n}=e.state,i=e.state.selection.$from;if(i.pos===i.end()){const s=i.marks();if(!!!s.find(u=>u?.type.name===r.name))return!1;const l=s.find(u=>u?.type.name===r.name);return l&&n.removeStoredMark(l),n.insertText(" ",i.pos),e.view.dispatch(n),!0}return!1}configure(e){return super.configure(e)}extend(e){const r=typeof e=="function"?e():e;return super.extend(r)}};function MJ(t){return typeof t=="number"}var AJ=class{constructor(t){this.find=t.find,this.handler=t.handler}},RJ=(t,e,r)=>{if(eC(e))return[...t.matchAll(e)];const n=e(t,r);return n?n.map(i=>{const a=[i.text];return a.index=i.index,a.input=t,a.data=i.data,i.replaceWith&&(i.text.includes(i.replaceWith)||console.warn('[tiptap warn]: "pasteRuleMatch.replaceWith" must be part of "pasteRuleMatch.text".'),a.push(i.replaceWith)),a}):[]};function LJ(t){const{editor:e,state:r,from:n,to:i,rule:a,pasteEvent:s,dropEvent:o}=t,{commands:l,chain:u,can:c}=new J1({editor:e,state:r}),f=[];return r.doc.nodesBetween(n,i,(v,y)=>{var S,w,E,_,T;if((w=(S=v.type)==null?void 0:S.spec)!=null&&w.code||!(v.isText||v.isTextblock||v.isInline))return;const N=(T=(_=(E=v.content)==null?void 0:E.size)!=null?_:v.nodeSize)!=null?T:0,R=Math.max(n,y),I=Math.min(i,y+N);if(R>=I)return;const F=v.isText?v.text||"":v.textBetween(R-y,I-y,void 0,"");RJ(F,a.find,s).forEach(j=>{if(j.index===void 0)return;const B=R+j.index+1,G=B+j[0].length,K={from:r.tr.mapping.map(B),to:r.tr.mapping.map(G)},O=a.handler({state:r,range:K,match:j,commands:l,chain:u,can:c,pasteEvent:s,dropEvent:o});f.push(O)})}),f.every(v=>v!==null)}var Ey=null,OJ=t=>{var e;const r=new ClipboardEvent("paste",{clipboardData:new DataTransfer});return(e=r.clipboardData)==null||e.setData("text/html",t),r};function DJ(t){const{editor:e,rules:r}=t;let n=null,i=!1,a=!1,s=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,o;try{o=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{o=null}const l=({state:c,from:f,to:p,rule:v,pasteEvt:y})=>{const S=c.tr,w=Q1({state:c,transaction:S});if(!(!LJ({editor:e,state:w,from:Math.max(f-1,0),to:p.b-1,rule:v,pasteEvent:y,dropEvent:o})||!S.steps.length)){try{o=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{o=null}return s=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,S}};return r.map(c=>new Yn({view(f){const p=y=>{var S;n=(S=f.dom.parentElement)!=null&&S.contains(y.target)?f.dom.parentElement:null,n&&(Ey=e)},v=()=>{Ey&&(Ey=null)};return window.addEventListener("dragstart",p),window.addEventListener("dragend",v),{destroy(){window.removeEventListener("dragstart",p),window.removeEventListener("dragend",v)}}},props:{handleDOMEvents:{drop:(f,p)=>{if(a=n===f.dom.parentElement,o=p,!a){const v=Ey;v?.isEditable&&setTimeout(()=>{const y=v.state.selection;y&&v.commands.deleteRange({from:y.from,to:y.to})},10)}return!1},paste:(f,p)=>{var v;const y=(v=p.clipboardData)==null?void 0:v.getData("text/html");return s=p,i=!!y?.includes("data-pm-slice"),!1}}},appendTransaction:(f,p,v)=>{const y=f[0],S=y.getMeta("uiEvent")==="paste"&&!i,w=y.getMeta("uiEvent")==="drop"&&!a,E=y.getMeta("applyPasteRules"),_=!!E;if(!S&&!w&&!_)return;if(_){let{text:R}=E;typeof R=="string"?R=R:R=nC(it.from(R),v.schema);const{from:I}=E,F=I+R.length,D=OJ(R);return l({rule:c,state:v,from:I,to:{b:F},pasteEvt:D})}const T=p.doc.content.findDiffStart(v.doc.content),N=p.doc.content.findDiffEnd(v.doc.content);if(!(!MJ(T)||!N||T===N.b))return l({rule:c,state:v,from:T,to:N,pasteEvt:s})}}))}var ib=class{constructor(t,e){this.splittableMarks=[],this.editor=e,this.baseExtensions=t,this.extensions=n6(t),this.schema=qQ(this.extensions,e),this.setupExtensions()}get commands(){return this.extensions.reduce((t,e)=>{const r={name:e.name,options:e.options,storage:this.editor.extensionStorage[e.name],editor:this.editor,type:ky(e.name,this.schema)},n=$t(e,"addCommands",r);return n?{...t,...n()}:t},{})}get plugins(){const{editor:t}=this;return Fx([...this.extensions].reverse()).flatMap(n=>{const i={name:n.name,options:n.options,storage:this.editor.extensionStorage[n.name],editor:t,type:ky(n.name,this.schema)},a=[],s=$t(n,"addKeyboardShortcuts",i);let o={};if(n.type==="mark"&&$t(n,"exitable",i)&&(o.ArrowRight=()=>Rh.handleExit({editor:t,mark:n})),s){const p=Object.fromEntries(Object.entries(s()).map(([v,y])=>[v,()=>y({editor:t})]));o={...o,...p}}const l=ZX(o);a.push(l);const u=$t(n,"addInputRules",i);if(fP(n,t.options.enableInputRules)&&u){const p=u();if(p&&p.length){const v=NJ({editor:t,rules:p}),y=Array.isArray(v)?v:[v];a.push(...y)}}const c=$t(n,"addPasteRules",i);if(fP(n,t.options.enablePasteRules)&&c){const p=c();if(p&&p.length){const v=DJ({editor:t,rules:p});a.push(...v)}}const f=$t(n,"addProseMirrorPlugins",i);if(f){const p=f();a.push(...p)}return a})}get attributes(){return r6(this.extensions)}get nodeViews(){const{editor:t}=this,{nodeExtensions:e}=Jp(this.extensions);return Object.fromEntries(e.filter(r=>!!$t(r,"addNodeView")).map(r=>{const n=this.attributes.filter(l=>l.type===r.name),i={name:r.name,options:r.options,storage:this.editor.extensionStorage[r.name],editor:t,type:ji(r.name,this.schema)},a=$t(r,"addNodeView",i);if(!a)return[];const s=a();if(!s)return[];const o=(l,u,c,f,p)=>{const v=Uv(l,n);return s({node:l,view:u,getPos:c,decorations:f,innerDecorations:p,editor:t,extension:r,HTMLAttributes:v})};return[r.name,o]}))}dispatchTransaction(t){const{editor:e}=this;return Fx([...this.extensions].reverse()).reduceRight((n,i)=>{const a={name:i.name,options:i.options,storage:this.editor.extensionStorage[i.name],editor:e,type:ky(i.name,this.schema)},s=$t(i,"dispatchTransaction",a);return s?o=>{s.call(a,{transaction:o,next:n})}:n},t)}get markViews(){const{editor:t}=this,{markExtensions:e}=Jp(this.extensions);return Object.fromEntries(e.filter(r=>!!$t(r,"addMarkView")).map(r=>{const n=this.attributes.filter(o=>o.type===r.name),i={name:r.name,options:r.options,storage:this.editor.extensionStorage[r.name],editor:t,type:_c(r.name,this.schema)},a=$t(r,"addMarkView",i);if(!a)return[];const s=(o,l,u)=>{const c=Uv(o,n);return a()({mark:o,view:l,inline:u,editor:t,extension:r,HTMLAttributes:c,updateAttributes:f=>{ZJ(o,t,f)}})};return[r.name,s]}))}setupExtensions(){const t=this.extensions;this.editor.extensionStorage=Object.fromEntries(t.map(e=>[e.name,e.storage])),t.forEach(e=>{var r;const n={name:e.name,options:e.options,storage:this.editor.extensionStorage[e.name],editor:this.editor,type:ky(e.name,this.schema)};e.type==="mark"&&((r=dn($t(e,"keepOnSplit",n)))==null||r)&&this.splittableMarks.push(e.name);const i=$t(e,"onBeforeCreate",n),a=$t(e,"onCreate",n),s=$t(e,"onUpdate",n),o=$t(e,"onSelectionUpdate",n),l=$t(e,"onTransaction",n),u=$t(e,"onFocus",n),c=$t(e,"onBlur",n),f=$t(e,"onDestroy",n);i&&this.editor.on("beforeCreate",i),a&&this.editor.on("create",a),s&&this.editor.on("update",s),o&&this.editor.on("selectionUpdate",o),l&&this.editor.on("transaction",l),u&&this.editor.on("focus",u),c&&this.editor.on("blur",c),f&&this.editor.on("destroy",f)})}};ib.resolve=n6;ib.sort=Fx;ib.flatten=rC;var IJ={};J_(IJ,{ClipboardTextSerializer:()=>p6,Commands:()=>m6,Delete:()=>g6,Drop:()=>v6,Editable:()=>y6,FocusEvents:()=>b6,Keymap:()=>w6,Paste:()=>S6,Tabindex:()=>k6,TextDirection:()=>_6,focusEventsPluginKey:()=>x6});var Ni=class h6 extends aC{constructor(){super(...arguments),this.type="extension"}static create(e={}){const r=typeof e=="function"?e():e;return new h6(r)}configure(e){return super.configure(e)}extend(e){const r=typeof e=="function"?e():e;return super.extend(r)}},p6=Ni.create({name:"clipboardTextSerializer",addOptions(){return{blockSeparator:void 0}},addProseMirrorPlugins(){return[new Yn({key:new Ti("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:t}=this,{state:e,schema:r}=t,{doc:n,selection:i}=e,{ranges:a}=i,s=Math.min(...a.map(c=>c.$from.pos)),o=Math.max(...a.map(c=>c.$to.pos)),l=a6(r);return i6(n,{from:s,to:o},{...this.options.blockSeparator!==void 0?{blockSeparator:this.options.blockSeparator}:{},textSerializers:l})}}})]}}),m6=Ni.create({name:"commands",addCommands(){return{...$O}}}),g6=Ni.create({name:"delete",onUpdate({transaction:t,appendedTransactions:e}){var r,n,i;const a=()=>{var s,o,l,u;if((u=(l=(o=(s=this.editor.options.coreExtensionOptions)==null?void 0:s.delete)==null?void 0:o.filterTransaction)==null?void 0:l.call(o,t))!=null?u:t.getMeta("y-sync$"))return;const c=e6(t.before,[t,...e]);o6(c).forEach(v=>{c.mapping.mapResult(v.oldRange.from).deletedAfter&&c.mapping.mapResult(v.oldRange.to).deletedBefore&&c.before.nodesBetween(v.oldRange.from,v.oldRange.to,(y,S)=>{const w=S+y.nodeSize-2,E=v.oldRange.from<=S&&w<=v.oldRange.to;this.editor.emit("delete",{type:"node",node:y,from:S,to:w,newFrom:c.mapping.map(S),newTo:c.mapping.map(w),deletedRange:v.oldRange,newRange:v.newRange,partial:!E,editor:this.editor,transaction:t,combinedTransform:c})})});const p=c.mapping;c.steps.forEach((v,y)=>{var S,w;if(v instanceof Ol){const E=p.slice(y).map(v.from,-1),_=p.slice(y).map(v.to),T=p.invert().map(E,-1),N=p.invert().map(_),R=(S=c.doc.nodeAt(E-1))==null?void 0:S.marks.some(F=>F.eq(v.mark)),I=(w=c.doc.nodeAt(_))==null?void 0:w.marks.some(F=>F.eq(v.mark));this.editor.emit("delete",{type:"mark",mark:v.mark,from:v.from,to:v.to,deletedRange:{from:T,to:N},newRange:{from:E,to:_},partial:!!(I||R),editor:this.editor,transaction:t,combinedTransform:c})}})};(i=(n=(r=this.editor.options.coreExtensionOptions)==null?void 0:r.delete)==null?void 0:n.async)==null||i?setTimeout(a,0):a()}}),v6=Ni.create({name:"drop",addProseMirrorPlugins(){return[new Yn({key:new Ti("tiptapDrop"),props:{handleDrop:(t,e,r,n)=>{this.editor.emit("drop",{editor:this.editor,event:e,slice:r,moved:n})}}})]}}),y6=Ni.create({name:"editable",addProseMirrorPlugins(){return[new Yn({key:new Ti("editable"),props:{editable:()=>this.editor.options.editable}})]}}),x6=new Ti("focusEvents"),b6=Ni.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:t}=this;return[new Yn({key:x6,props:{handleDOMEvents:{focus:(e,r)=>{t.isFocused=!0;const n=t.state.tr.setMeta("focus",{event:r}).setMeta("addToHistory",!1);return e.dispatch(n),!1},blur:(e,r)=>{t.isFocused=!1;const n=t.state.tr.setMeta("blur",{event:r}).setMeta("addToHistory",!1);return e.dispatch(n),!1}}}})]}}),w6=Ni.create({name:"keymap",addKeyboardShortcuts(){const t=()=>this.editor.commands.first(({commands:s})=>[()=>s.undoInputRule(),()=>s.command(({tr:o})=>{const{selection:l,doc:u}=o,{empty:c,$anchor:f}=l,{pos:p,parent:v}=f,y=f.parent.isTextblock&&p>0?o.doc.resolve(p-1):f,S=y.parent.type.spec.isolating,w=f.pos-f.parentOffset,E=S&&y.parent.childCount===1?w===f.pos:Sr.atStart(u).from===p;return!c||!v.type.isTextblock||v.textContent.length||!E||E&&f.parent.type.name==="paragraph"?!1:s.clearNodes()}),()=>s.deleteSelection(),()=>s.joinBackward(),()=>s.selectNodeBackward()]),e=()=>this.editor.commands.first(({commands:s})=>[()=>s.deleteSelection(),()=>s.deleteCurrentNode(),()=>s.joinForward(),()=>s.selectNodeForward()]),n={Enter:()=>this.editor.commands.first(({commands:s})=>[()=>s.newlineInCode(),()=>s.createParagraphNear(),()=>s.liftEmptyBlock(),()=>s.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:t,"Mod-Backspace":t,"Shift-Backspace":t,Delete:e,"Mod-Delete":e,"Mod-a":()=>this.editor.commands.selectAll()},i={...n},a={...n,"Ctrl-h":t,"Alt-Backspace":t,"Ctrl-d":e,"Ctrl-Alt-Backspace":e,"Alt-Delete":e,"Alt-d":e,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return jx()||QO()?a:i},addProseMirrorPlugins(){return[new Yn({key:new Ti("clearDocument"),appendTransaction:(t,e,r)=>{if(t.some(S=>S.getMeta("composition")))return;const n=t.some(S=>S.docChanged)&&!e.doc.eq(r.doc),i=t.some(S=>S.getMeta("preventClearDocument"));if(!n||i)return;const{empty:a,from:s,to:o}=e.selection,l=Sr.atStart(e.doc).from,u=Sr.atEnd(e.doc).to;if(a||!(s===l&&o===u)||!rb(r.doc))return;const p=r.tr,v=Q1({state:r,transaction:p}),{commands:y}=new J1({editor:this.editor,state:v});if(y.clearNodes(),!!p.steps.length)return p}})]}}),S6=Ni.create({name:"paste",addProseMirrorPlugins(){return[new Yn({key:new Ti("tiptapPaste"),props:{handlePaste:(t,e,r)=>{this.editor.emit("paste",{editor:this.editor,event:e,slice:r})}}})]}}),k6=Ni.create({name:"tabindex",addProseMirrorPlugins(){return[new Yn({key:new Ti("tabindex"),props:{attributes:()=>this.editor.isEditable?{tabindex:"0"}:{}}})]}}),_6=Ni.create({name:"textDirection",addOptions(){return{direction:void 0}},addGlobalAttributes(){if(!this.options.direction)return[];const{nodeExtensions:t}=Jp(this.extensions);return[{types:t.filter(e=>e.name!=="text").map(e=>e.name),attributes:{dir:{default:this.options.direction,parseHTML:e=>{const r=e.getAttribute("dir");return r&&(r==="ltr"||r==="rtl"||r==="auto")?r:this.options.direction},renderHTML:e=>e.dir?{dir:e.dir}:{}}}}]},addProseMirrorPlugins(){return[new Yn({key:new Ti("textDirection"),props:{attributes:()=>{const t=this.options.direction;return t?{dir:t}:{}}}})]}}),jJ=class Pp{constructor(e,r,n=!1,i=null){this.currentNode=null,this.actualDepth=null,this.isBlock=n,this.resolvedPos=e,this.editor=r,this.currentNode=i}get name(){return this.node.type.name}get node(){return this.currentNode||this.resolvedPos.node()}get element(){return this.editor.view.domAtPos(this.pos).node}get depth(){var e;return(e=this.actualDepth)!=null?e:this.resolvedPos.depth}get pos(){return this.resolvedPos.pos}get content(){return this.node.content}set content(e){let r=this.from,n=this.to;if(this.isBlock){if(this.content.size===0){console.error(`You cant set content on a block node. Tried to set content on ${this.name} at ${this.pos}`);return}r=this.from+1,n=this.to-1}this.editor.commands.insertContentAt({from:r,to:n},e)}get attributes(){return this.node.attrs}get textContent(){return this.node.textContent}get size(){return this.node.nodeSize}get from(){return this.isBlock?this.pos:this.resolvedPos.start(this.resolvedPos.depth)}get range(){return{from:this.from,to:this.to}}get to(){return this.isBlock?this.pos+this.size:this.resolvedPos.end(this.resolvedPos.depth)+(this.node.isText?0:1)}get parent(){if(this.depth===0)return null;const e=this.resolvedPos.start(this.resolvedPos.depth-1),r=this.resolvedPos.doc.resolve(e);return new Pp(r,this.editor)}get before(){let e=this.resolvedPos.doc.resolve(this.from-(this.isBlock?1:2));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.from-3)),new Pp(e,this.editor)}get after(){let e=this.resolvedPos.doc.resolve(this.to+(this.isBlock?2:1));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.to+3)),new Pp(e,this.editor)}get children(){const e=[];return this.node.content.forEach((r,n)=>{const i=r.isBlock&&!r.isTextblock,a=r.isAtom&&!r.isText,s=this.pos+n+(a?0:1);if(s<0||s>this.resolvedPos.doc.nodeSize-2)return;const o=this.resolvedPos.doc.resolve(s);if(!i&&o.depth<=this.depth)return;const l=new Pp(o,this.editor,i,i?r:null);i&&(l.actualDepth=this.depth+1),e.push(new Pp(o,this.editor,i,i?r:null))}),e}get firstChild(){return this.children[0]||null}get lastChild(){const e=this.children;return e[e.length-1]||null}closest(e,r={}){let n=null,i=this.parent;for(;i&&!n;){if(i.node.type.name===e)if(Object.keys(r).length>0){const a=i.node.attrs,s=Object.keys(r);for(let o=0;o<s.length;o+=1){const l=s[o];if(a[l]!==r[l])break}}else n=i;i=i.parent}return n}querySelector(e,r={}){return this.querySelectorAll(e,r,!0)[0]||null}querySelectorAll(e,r={},n=!1){let i=[];if(!this.children||this.children.length===0)return i;const a=Object.keys(r);return this.children.forEach(s=>{n&&i.length>0||(s.node.type.name===e&&a.every(l=>r[l]===s.node.attrs[l])&&i.push(s),!(n&&i.length>0)&&(i=i.concat(s.querySelectorAll(e,r,n))))}),i}setAttribute(e){const{tr:r}=this.editor.state;r.setNodeMarkup(this.from,void 0,{...this.node.attrs,...e}),this.editor.view.dispatch(r)}},FJ=`.ProseMirror {
  position: relative;
}

.ProseMirror {
  word-wrap: break-word;
  white-space: pre-wrap;
  white-space: break-spaces;
  -webkit-font-variant-ligatures: none;
  font-variant-ligatures: none;
  font-feature-settings: "liga" 0; /* the above doesn't seem to work in Edge */
}

.ProseMirror [contenteditable="false"] {
  white-space: normal;
}

.ProseMirror [contenteditable="false"] [contenteditable="true"] {
  white-space: pre-wrap;
}

.ProseMirror pre {
  white-space: pre-wrap;
}

img.ProseMirror-separator {
  display: inline !important;
  border: none !important;
  margin: 0 !important;
  width: 0 !important;
  height: 0 !important;
}

.ProseMirror-gapcursor {
  display: none;
  pointer-events: none;
  position: absolute;
  margin: 0;
}

.ProseMirror-gapcursor:after {
  content: "";
  display: block;
  position: absolute;
  top: -2px;
  width: 20px;
  border-top: 1px solid black;
  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;
}

@keyframes ProseMirror-cursor-blink {
  to {
    visibility: hidden;
  }
}

.ProseMirror-hideselection *::selection {
  background: transparent;
}

.ProseMirror-hideselection *::-moz-selection {
  background: transparent;
}

.ProseMirror-hideselection * {
  caret-color: transparent;
}

.ProseMirror-focused .ProseMirror-gapcursor {
  display: block;
}`;function BJ(t,e,r){const n=document.querySelector("style[data-tiptap-style]");if(n!==null)return n;const i=document.createElement("style");return e&&i.setAttribute("nonce",e),i.setAttribute("data-tiptap-style",""),i.innerHTML=t,document.getElementsByTagName("head")[0].appendChild(i),i}var zJ=class extends EJ{constructor(t={}){super(),this.css=null,this.className="tiptap",this.editorView=null,this.isFocused=!1,this.isInitialized=!1,this.extensionStorage={},this.instanceId=Math.random().toString(36).slice(2,9),this.options={element:typeof document<"u"?document.createElement("div"):null,content:"",injectCSS:!0,injectNonce:void 0,extensions:[],autofocus:!1,editable:!0,textDirection:void 0,editorProps:{},parseOptions:{},coreExtensionOptions:{},enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!0,enableContentCheck:!1,emitContentError:!1,onBeforeCreate:()=>null,onCreate:()=>null,onMount:()=>null,onUnmount:()=>null,onUpdate:()=>null,onSelectionUpdate:()=>null,onTransaction:()=>null,onFocus:()=>null,onBlur:()=>null,onDestroy:()=>null,onContentError:({error:n})=>{throw n},onPaste:()=>null,onDrop:()=>null,onDelete:()=>null,enableExtensionDispatchTransaction:!0},this.isCapturingTransaction=!1,this.capturedTransaction=null,this.utils={getUpdatedPosition:nJ,createMappablePosition:iJ},this.setOptions(t),this.createExtensionManager(),this.createCommandManager(),this.createSchema(),this.on("beforeCreate",this.options.onBeforeCreate),this.emit("beforeCreate",{editor:this}),this.on("mount",this.options.onMount),this.on("unmount",this.options.onUnmount),this.on("contentError",this.options.onContentError),this.on("create",this.options.onCreate),this.on("update",this.options.onUpdate),this.on("selectionUpdate",this.options.onSelectionUpdate),this.on("transaction",this.options.onTransaction),this.on("focus",this.options.onFocus),this.on("blur",this.options.onBlur),this.on("destroy",this.options.onDestroy),this.on("drop",({event:n,slice:i,moved:a})=>this.options.onDrop(n,i,a)),this.on("paste",({event:n,slice:i})=>this.options.onPaste(n,i)),this.on("delete",this.options.onDelete);const e=this.createDoc(),r=YO(e,this.options.autofocus);this.editorState=Dp.create({doc:e,schema:this.schema,selection:r||void 0}),this.options.element&&this.mount(this.options.element)}mount(t){if(typeof document>"u")throw new Error("[tiptap error]: The editor cannot be mounted because there is no 'document' defined in this environment.");this.createView(t),this.emit("mount",{editor:this}),this.css&&!document.head.contains(this.css)&&document.head.appendChild(this.css),window.setTimeout(()=>{this.isDestroyed||(this.options.autofocus!==!1&&this.options.autofocus!==null&&this.commands.focus(this.options.autofocus),this.emit("create",{editor:this}),this.isInitialized=!0)},0)}unmount(){if(this.editorView){const t=this.editorView.dom;t?.editor&&delete t.editor,this.editorView.destroy()}if(this.editorView=null,this.isInitialized=!1,this.css&&!document.querySelectorAll(`.${this.className}`).length)try{typeof this.css.remove=="function"?this.css.remove():this.css.parentNode&&this.css.parentNode.removeChild(this.css)}catch(t){console.warn("Failed to remove CSS element:",t)}this.css=null,this.emit("unmount",{editor:this})}get storage(){return this.extensionStorage}get commands(){return this.commandManager.commands}chain(){return this.commandManager.chain()}can(){return this.commandManager.can()}injectCSS(){this.options.injectCSS&&typeof document<"u"&&(this.css=BJ(FJ,this.options.injectNonce))}setOptions(t={}){this.options={...this.options,...t},!(!this.editorView||!this.state||this.isDestroyed)&&(this.options.editorProps&&this.view.setProps(this.options.editorProps),this.view.updateState(this.state))}setEditable(t,e=!0){this.setOptions({editable:t}),e&&this.emit("update",{editor:this,transaction:this.state.tr,appendedTransactions:[]})}get isEditable(){return this.options.editable&&this.view&&this.view.editable}get view(){return this.editorView?this.editorView:new Proxy({state:this.editorState,updateState:t=>{this.editorState=t},dispatch:t=>{this.dispatchTransaction(t)},composing:!1,dragging:null,editable:!0,isDestroyed:!1},{get:(t,e)=>{if(this.editorView)return this.editorView[e];if(e==="state")return this.editorState;if(e in t)return Reflect.get(t,e);throw new Error(`[tiptap error]: The editor view is not available. Cannot access view['${e}']. The editor may not be mounted yet.`)}})}get state(){return this.editorView&&(this.editorState=this.view.state),this.editorState}registerPlugin(t,e){const r=t6(e)?e(t,[...this.state.plugins]):[...this.state.plugins,t],n=this.state.reconfigure({plugins:r});return this.view.updateState(n),n}unregisterPlugin(t){if(this.isDestroyed)return;const e=this.state.plugins;let r=e;if([].concat(t).forEach(i=>{const a=typeof i=="string"?`${i}$`:i.key;r=r.filter(s=>!s.key.startsWith(a))}),e.length===r.length)return;const n=this.state.reconfigure({plugins:r});return this.view.updateState(n),n}createExtensionManager(){var t,e;const n=[...this.options.enableCoreExtensions?[y6,p6.configure({blockSeparator:(e=(t=this.options.coreExtensionOptions)==null?void 0:t.clipboardTextSerializer)==null?void 0:e.blockSeparator}),m6,b6,w6,k6,v6,S6,g6,_6.configure({direction:this.options.textDirection})].filter(i=>typeof this.options.enableCoreExtensions=="object"?this.options.enableCoreExtensions[i.name]!==!1:!0):[],...this.options.extensions].filter(i=>["extension","node","mark"].includes(i?.type));this.extensionManager=new ib(n,this)}createCommandManager(){this.commandManager=new J1({editor:this})}createSchema(){this.schema=this.extensionManager.schema}createDoc(){let t;try{t=_k(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:this.options.enableContentCheck})}catch(e){if(!(e instanceof Error)||!["[tiptap error]: Invalid JSON content","[tiptap error]: Invalid HTML content"].includes(e.message))throw e;this.emit("contentError",{editor:this,error:e,disableCollaboration:()=>{"collaboration"in this.storage&&typeof this.storage.collaboration=="object"&&this.storage.collaboration&&(this.storage.collaboration.isDisabled=!0),this.options.extensions=this.options.extensions.filter(r=>r.name!=="collaboration"),this.createExtensionManager()}}),t=_k(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:!1})}return t}createView(t){const{editorProps:e,enableExtensionDispatchTransaction:r}=this.options,n=e.dispatchTransaction||this.dispatchTransaction.bind(this),i=r?this.extensionManager.dispatchTransaction(n):n;this.editorView=new WO(t,{...e,attributes:{role:"textbox",...e?.attributes},dispatchTransaction:i,state:this.editorState,markViews:this.extensionManager.markViews,nodeViews:this.extensionManager.nodeViews});const a=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(a),this.prependClass(),this.injectCSS();const s=this.view.dom;s.editor=this}createNodeViews(){this.view.isDestroyed||this.view.setProps({markViews:this.extensionManager.markViews,nodeViews:this.extensionManager.nodeViews})}prependClass(){this.view.dom.className=`${this.className} ${this.view.dom.className}`}captureTransaction(t){this.isCapturingTransaction=!0,t(),this.isCapturingTransaction=!1;const e=this.capturedTransaction;return this.capturedTransaction=null,e}dispatchTransaction(t){if(this.view.isDestroyed)return;if(this.isCapturingTransaction){if(!this.capturedTransaction){this.capturedTransaction=t;return}t.steps.forEach(u=>{var c;return(c=this.capturedTransaction)==null?void 0:c.step(u)});return}const{state:e,transactions:r}=this.state.applyTransaction(t),n=!this.state.selection.eq(e.selection),i=r.includes(t),a=this.state;if(this.emit("beforeTransaction",{editor:this,transaction:t,nextState:e}),!i)return;this.view.updateState(e),this.emit("transaction",{editor:this,transaction:t,appendedTransactions:r.slice(1)}),n&&this.emit("selectionUpdate",{editor:this,transaction:t});const s=r.findLast(u=>u.getMeta("focus")||u.getMeta("blur")),o=s?.getMeta("focus"),l=s?.getMeta("blur");o&&this.emit("focus",{editor:this,event:o.event,transaction:s}),l&&this.emit("blur",{editor:this,event:l.event,transaction:s}),!(t.getMeta("preventUpdate")||!r.some(u=>u.docChanged)||a.doc.eq(e.doc))&&this.emit("update",{editor:this,transaction:t,appendedTransactions:r.slice(1)})}getAttributes(t){return s6(this.state,t)}isActive(t,e){const r=typeof t=="string"?t:null,n=typeof t=="string"?e:t;return eJ(this.state,r,n)}getJSON(){return this.state.doc.toJSON()}getHTML(){return nC(this.state.doc.content,this.schema)}getText(t){const{blockSeparator:e=`

`,textSerializers:r={}}=t||{};return KQ(this.state.doc,{blockSeparator:e,textSerializers:{...a6(this.schema),...r}})}get isEmpty(){return rb(this.state.doc)}destroy(){this.emit("destroy"),this.unmount(),this.removeAllListeners()}get isDestroyed(){var t,e;return(e=(t=this.editorView)==null?void 0:t.isDestroyed)!=null?e:!0}$node(t,e){var r;return((r=this.$doc)==null?void 0:r.querySelector(t,e))||null}$nodes(t,e){var r;return((r=this.$doc)==null?void 0:r.querySelectorAll(t,e))||null}$pos(t){const e=this.state.doc.resolve(t);return new jJ(e,this)}get $doc(){return this.$pos(0)}};function em(t){return new nb({find:t.find,handler:({state:e,range:r,match:n})=>{const i=dn(t.getAttributes,void 0,n);if(i===!1||i===null)return null;const{tr:a}=e,s=n[n.length-1],o=n[0];if(s){const l=o.search(/\S/),u=r.from+o.indexOf(s),c=u+s.length;if(iC(r.from,r.to,e.doc).filter(v=>v.mark.type.excluded.find(S=>S===t.type&&S!==v.mark.type)).filter(v=>v.to>u).length)return null;c<r.to&&a.delete(c,r.to),u>r.from&&a.delete(r.from+l,u);const p=r.from+l+s.length;a.addMark(r.from+l,p,t.type.create(i||{})),a.removeStoredMark(t.type)}},undoable:t.undoable})}function UJ(t){return new nb({find:t.find,handler:({state:e,range:r,match:n})=>{const i=dn(t.getAttributes,void 0,n)||{},{tr:a}=e,s=r.from;let o=r.to;const l=t.type.create(i);if(n[1]){const u=n[0].lastIndexOf(n[1]);let c=s+u;c>o?c=o:o=c+n[1].length;const f=n[0][n[0].length-1];a.insertText(f,s+n[0].length-1),a.replaceWith(c,o,l)}else if(n[0]){const u=t.type.isInline?s:s-1;a.insert(u,t.type.create(i)).delete(a.mapping.map(s),a.mapping.map(o))}a.scrollIntoView()},undoable:t.undoable})}function Ek(t){return new nb({find:t.find,handler:({state:e,range:r,match:n})=>{const i=e.doc.resolve(r.from),a=dn(t.getAttributes,void 0,n)||{};if(!i.node(-1).canReplaceWith(i.index(-1),i.indexAfter(-1),t.type))return null;e.tr.delete(r.from,r.to).setBlockType(r.from,r.from,t.type,a)},undoable:t.undoable})}function tm(t){return new nb({find:t.find,handler:({state:e,range:r,match:n,chain:i})=>{const a=dn(t.getAttributes,void 0,n)||{},s=e.tr.delete(r.from,r.to),l=s.doc.resolve(r.from).blockRange(),u=l&&j_(l,t.type,a);if(!u)return null;if(s.wrap(l,u),t.keepMarks&&t.editor){const{selection:f,storedMarks:p}=e,{splittableMarks:v}=t.editor.extensionManager,y=p||f.$to.parentOffset&&f.$from.marks();if(y){const S=y.filter(w=>v.includes(w.type.name));s.ensureMarks(S)}}if(t.keepAttributes){const f=t.type.name==="bulletList"||t.type.name==="orderedList"?"listItem":"taskList";i().updateAttributes(f,a).run()}const c=s.doc.resolve(r.from-1).nodeBefore;c&&c.type===t.type&&hf(s.doc,r.from-1)&&(!t.joinPredicate||t.joinPredicate(n,c))&&s.join(r.from-1)},undoable:t.undoable})}function GJ(t,e){const{selection:r}=t,{$from:n}=r;if(r instanceof Xt){const a=n.index();return n.parent.canReplaceWith(a,a+1,e)}let i=n.depth;for(;i>=0;){const a=n.index(i);if(n.node(i).contentMatchAt(a).matchType(e))return!0;i-=1}return!1}function VJ(t){return t.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&")}var HJ={};J_(HJ,{createAtomBlockMarkdownSpec:()=>WJ,createBlockMarkdownSpec:()=>qJ,createInlineMarkdownSpec:()=>C6,parseAttributes:()=>sC,parseIndentedBlocks:()=>Tk,renderNestedMarkdownContent:()=>lC,serializeAttributes:()=>oC});function sC(t){if(!t?.trim())return{};const e={},r=[],n=t.replace(/["']([^"']*)["']/g,u=>(r.push(u),`__QUOTED_${r.length-1}__`)),i=n.match(/(?:^|\s)\.([a-zA-Z][\w-]*)/g);if(i){const u=i.map(c=>c.trim().slice(1));e.class=u.join(" ")}const a=n.match(/(?:^|\s)#([a-zA-Z][\w-]*)/);a&&(e.id=a[1]);const s=/([a-zA-Z][\w-]*)\s*=\s*(__QUOTED_\d+__)/g;Array.from(n.matchAll(s)).forEach(([,u,c])=>{var f;const p=parseInt(((f=c.match(/__QUOTED_(\d+)__/))==null?void 0:f[1])||"0",10),v=r[p];v&&(e[u]=v.slice(1,-1))});const l=n.replace(/(?:^|\s)\.([a-zA-Z][\w-]*)/g,"").replace(/(?:^|\s)#([a-zA-Z][\w-]*)/g,"").replace(/([a-zA-Z][\w-]*)\s*=\s*__QUOTED_\d+__/g,"").trim();return l&&l.split(/\s+/).filter(Boolean).forEach(c=>{c.match(/^[a-zA-Z][\w-]*$/)&&(e[c]=!0)}),e}function oC(t){if(!t||Object.keys(t).length===0)return"";const e=[];return t.class&&String(t.class).split(/\s+/).filter(Boolean).forEach(n=>e.push(`.${n}`)),t.id&&e.push(`#${t.id}`),Object.entries(t).forEach(([r,n])=>{r==="class"||r==="id"||(n===!0?e.push(r):n!==!1&&n!=null&&e.push(`${r}="${String(n)}"`))}),e.join(" ")}function WJ(t){const{nodeName:e,name:r,parseAttributes:n=sC,serializeAttributes:i=oC,defaultAttributes:a={},requiredAttributes:s=[],allowedAttributes:o}=t,l=r||e,u=c=>{if(!o)return c;const f={};return o.forEach(p=>{p in c&&(f[p]=c[p])}),f};return{parseMarkdown:(c,f)=>{const p={...a,...c.attributes};return f.createNode(e,p,[])},markdownTokenizer:{name:e,level:"block",start(c){var f;const p=new RegExp(`^:::${l}(?:\\s|$)`,"m"),v=(f=c.match(p))==null?void 0:f.index;return v!==void 0?v:-1},tokenize(c,f,p){const v=new RegExp(`^:::${l}(?:\\s+\\{([^}]*)\\})?\\s*:::(?:\\n|$)`),y=c.match(v);if(!y)return;const S=y[1]||"",w=n(S);if(!s.find(_=>!(_ in w)))return{type:e,raw:y[0],attributes:w}}},renderMarkdown:c=>{const f=u(c.attrs||{}),p=i(f),v=p?` {${p}}`:"";return`:::${l}${v} :::`}}}function qJ(t){const{nodeName:e,name:r,getContent:n,parseAttributes:i=sC,serializeAttributes:a=oC,defaultAttributes:s={},content:o="block",allowedAttributes:l}=t,u=r||e,c=f=>{if(!l)return f;const p={};return l.forEach(v=>{v in f&&(p[v]=f[v])}),p};return{parseMarkdown:(f,p)=>{let v;if(n){const S=n(f);v=typeof S=="string"?[{type:"text",text:S}]:S}else o==="block"?v=p.parseChildren(f.tokens||[]):v=p.parseInline(f.tokens||[]);const y={...s,...f.attributes};return p.createNode(e,y,v)},markdownTokenizer:{name:e,level:"block",start(f){var p;const v=new RegExp(`^:::${u}`,"m"),y=(p=f.match(v))==null?void 0:p.index;return y!==void 0?y:-1},tokenize(f,p,v){var y;const S=new RegExp(`^:::${u}(?:\\s+\\{([^}]*)\\})?\\s*\\n`),w=f.match(S);if(!w)return;const[E,_=""]=w,T=i(_);let N=1;const R=E.length;let I="";const F=/^:::([\w-]*)(\s.*)?/gm,D=f.slice(R);for(F.lastIndex=0;;){const j=F.exec(D);if(j===null)break;const B=j.index,G=j[1];if(!((y=j[2])!=null&&y.endsWith(":::"))){if(G)N+=1;else if(N-=1,N===0){const K=D.slice(0,B);I=K.trim();const O=f.slice(0,R+B+j[0].length);let W=[];if(I)if(o==="block")for(W=v.blockTokens(K),W.forEach(U=>{U.text&&(!U.tokens||U.tokens.length===0)&&(U.tokens=v.inlineTokens(U.text))});W.length>0;){const U=W[W.length-1];if(U.type==="paragraph"&&(!U.text||U.text.trim()===""))W.pop();else break}else W=v.inlineTokens(I);return{type:e,raw:O,attributes:T,content:I,tokens:W}}}}}},renderMarkdown:(f,p)=>{const v=c(f.attrs||{}),y=a(v),S=y?` {${y}}`:"",w=p.renderChildren(f.content||[],`

`);return`:::${u}${S}

${w}

:::`}}}function $J(t){if(!t.trim())return{};const e={},r=/(\w+)=(?:"([^"]*)"|'([^']*)')/g;let n=r.exec(t);for(;n!==null;){const[,i,a,s]=n;e[i]=a||s,n=r.exec(t)}return e}function KJ(t){return Object.entries(t).filter(([,e])=>e!=null).map(([e,r])=>`${e}="${r}"`).join(" ")}function C6(t){const{nodeName:e,name:r,getContent:n,parseAttributes:i=$J,serializeAttributes:a=KJ,defaultAttributes:s={},selfClosing:o=!1,allowedAttributes:l}=t,u=r||e,c=p=>{if(!l)return p;const v={};return l.forEach(y=>{const S=typeof y=="string"?y:y.name,w=typeof y=="string"?void 0:y.skipIfDefault;if(S in p){const E=p[S];if(w!==void 0&&E===w)return;v[S]=E}}),v},f=u.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return{parseMarkdown:(p,v)=>{const y={...s,...p.attributes};if(o)return v.createNode(e,y);const S=n?n(p):p.content||"";return S?v.createNode(e,y,[v.createTextNode(S)]):v.createNode(e,y,[])},markdownTokenizer:{name:e,level:"inline",start(p){const v=o?new RegExp(`\\[${f}\\s*[^\\]]*\\]`):new RegExp(`\\[${f}\\s*[^\\]]*\\][\\s\\S]*?\\[\\/${f}\\]`),y=p.match(v),S=y?.index;return S!==void 0?S:-1},tokenize(p,v,y){const S=o?new RegExp(`^\\[${f}\\s*([^\\]]*)\\]`):new RegExp(`^\\[${f}\\s*([^\\]]*)\\]([\\s\\S]*?)\\[\\/${f}\\]`),w=p.match(S);if(!w)return;let E="",_="";if(o){const[,N]=w;_=N}else{const[,N,R]=w;_=N,E=R||""}const T=i(_.trim());return{type:e,raw:w[0],content:E.trim(),attributes:T}}},renderMarkdown:p=>{let v="";n?v=n(p):p.content&&p.content.length>0&&(v=p.content.filter(E=>E.type==="text").map(E=>E.text).join(""));const y=c(p.attrs||{}),S=a(y),w=S?` ${S}`:"";return o?`[${u}${w}]`:`[${u}${w}]${v}[/${u}]`}}}function Tk(t,e,r){var n,i,a,s;const o=t.split(`
`),l=[];let u="",c=0;const f=e.baseIndentSize||2;for(;c<o.length;){const p=o[c],v=p.match(e.itemPattern);if(!v){if(l.length>0)break;if(p.trim()===""){c+=1,u=`${u}${p}
`;continue}else return}const y=e.extractItemData(v),{indentLevel:S,mainContent:w}=y;u=`${u}${p}
`;const E=[w];for(c+=1;c<o.length;){const R=o[c];if(R.trim()===""){const F=o.slice(c+1).findIndex(B=>B.trim()!=="");if(F===-1)break;if((((i=(n=o[c+1+F].match(/^(\s*)/))==null?void 0:n[1])==null?void 0:i.length)||0)>S){E.push(R),u=`${u}${R}
`,c+=1;continue}else break}if((((s=(a=R.match(/^(\s*)/))==null?void 0:a[1])==null?void 0:s.length)||0)>S)E.push(R),u=`${u}${R}
`,c+=1;else break}let _;const T=E.slice(1);if(T.length>0){const R=T.map(I=>I.slice(S+f)).join(`
`);R.trim()&&(e.customNestedParser?_=e.customNestedParser(R):_=r.blockTokens(R))}const N=e.createToken(y,_);l.push(N)}if(l.length!==0)return{items:l,raw:u}}function lC(t,e,r,n){if(!t||!Array.isArray(t.content))return"";const i=typeof r=="function"?r(n):r,[a,...s]=t.content,o=e.renderChildren([a]),l=[`${i}${o}`];return s&&s.length>0&&s.forEach(u=>{const c=e.renderChildren([u]);if(c){const f=c.split(`
`).map(p=>p?e.indent(p):"").join(`
`);l.push(f)}}),l.join(`
`)}function ZJ(t,e,r={}){const{state:n}=e,{doc:i,tr:a}=n,s=t;i.descendants((o,l)=>{const u=a.mapping.map(l),c=a.mapping.map(l)+o.nodeSize;let f=null;if(o.marks.forEach(v=>{if(v!==s)return!1;f=v}),!f)return;let p=!1;if(Object.keys(r).forEach(v=>{r[v]!==f.attrs[v]&&(p=!0)}),p){const v=t.type.create({...t.attrs,...r});a.removeMark(u,c,t.type),a.addMark(u,c,v)}}),a.docChanged&&e.view.dispatch(a)}var eo=class E6 extends aC{constructor(){super(...arguments),this.type="node"}static create(e={}){const r=typeof e=="function"?e():e;return new E6(r)}configure(e){return super.configure(e)}extend(e){const r=typeof e=="function"?e():e;return super.extend(r)}};function Ch(t){return new AJ({find:t.find,handler:({state:e,range:r,match:n,pasteEvent:i})=>{const a=dn(t.getAttributes,void 0,n,i);if(a===!1||a===null)return null;const{tr:s}=e,o=n[n.length-1],l=n[0];let u=r.to;if(o){const c=l.search(/\S/),f=r.from+l.indexOf(o),p=f+o.length;if(iC(r.from,r.to,e.doc).filter(y=>y.mark.type.excluded.find(w=>w===t.type&&w!==y.mark.type)).filter(y=>y.to>f).length)return null;p<r.to&&s.delete(p,r.to),f>r.from&&s.delete(r.from+c,f),u=r.from+c+o.length,s.addMark(r.from+c,u,t.type.create(a||{})),s.removeStoredMark(t.type)}}})}const{getOwnPropertyNames:YJ,getOwnPropertySymbols:XJ}=Object,{hasOwnProperty:QJ}=Object.prototype;function fS(t,e){return function(n,i,a){return t(n,i,a)&&e(n,i,a)}}function Ty(t){return function(r,n,i){if(!r||!n||typeof r!="object"||typeof n!="object")return t(r,n,i);const{cache:a}=i,s=a.get(r),o=a.get(n);if(s&&o)return s===n&&o===r;a.set(r,n),a.set(n,r);const l=t(r,n,i);return a.delete(r),a.delete(n),l}}function JJ(t){return t?.[Symbol.toStringTag]}function mP(t){return YJ(t).concat(XJ(t))}const eee=Object.hasOwn||((t,e)=>QJ.call(t,e));function Lh(t,e){return t===e||!t&&!e&&t!==t&&e!==e}const tee="__v",ree="__o",nee="_owner",{getOwnPropertyDescriptor:gP,keys:vP}=Object;function iee(t,e){return t.byteLength===e.byteLength&&Bx(new Uint8Array(t),new Uint8Array(e))}function aee(t,e,r){let n=t.length;if(e.length!==n)return!1;for(;n-- >0;)if(!r.equals(t[n],e[n],n,n,t,e,r))return!1;return!0}function see(t,e){return t.byteLength===e.byteLength&&Bx(new Uint8Array(t.buffer,t.byteOffset,t.byteLength),new Uint8Array(e.buffer,e.byteOffset,e.byteLength))}function oee(t,e){return Lh(t.getTime(),e.getTime())}function lee(t,e){return t.name===e.name&&t.message===e.message&&t.cause===e.cause&&t.stack===e.stack}function uee(t,e){return t===e}function yP(t,e,r){const n=t.size;if(n!==e.size)return!1;if(!n)return!0;const i=new Array(n),a=t.entries();let s,o,l=0;for(;(s=a.next())&&!s.done;){const u=e.entries();let c=!1,f=0;for(;(o=u.next())&&!o.done;){if(i[f]){f++;continue}const p=s.value,v=o.value;if(r.equals(p[0],v[0],l,f,t,e,r)&&r.equals(p[1],v[1],p[0],v[0],t,e,r)){c=i[f]=!0;break}f++}if(!c)return!1;l++}return!0}const cee=Lh;function dee(t,e,r){const n=vP(t);let i=n.length;if(vP(e).length!==i)return!1;for(;i-- >0;)if(!T6(t,e,r,n[i]))return!1;return!0}function zg(t,e,r){const n=mP(t);let i=n.length;if(mP(e).length!==i)return!1;let a,s,o;for(;i-- >0;)if(a=n[i],!T6(t,e,r,a)||(s=gP(t,a),o=gP(e,a),(s||o)&&(!s||!o||s.configurable!==o.configurable||s.enumerable!==o.enumerable||s.writable!==o.writable)))return!1;return!0}function fee(t,e){return Lh(t.valueOf(),e.valueOf())}function hee(t,e){return t.source===e.source&&t.flags===e.flags}function xP(t,e,r){const n=t.size;if(n!==e.size)return!1;if(!n)return!0;const i=new Array(n),a=t.values();let s,o;for(;(s=a.next())&&!s.done;){const l=e.values();let u=!1,c=0;for(;(o=l.next())&&!o.done;){if(!i[c]&&r.equals(s.value,o.value,s.value,o.value,t,e,r)){u=i[c]=!0;break}c++}if(!u)return!1}return!0}function Bx(t,e){let r=t.byteLength;if(e.byteLength!==r||t.byteOffset!==e.byteOffset)return!1;for(;r-- >0;)if(t[r]!==e[r])return!1;return!0}function pee(t,e){return t.hostname===e.hostname&&t.pathname===e.pathname&&t.protocol===e.protocol&&t.port===e.port&&t.hash===e.hash&&t.username===e.username&&t.password===e.password}function T6(t,e,r,n){return(n===nee||n===ree||n===tee)&&(t.$$typeof||e.$$typeof)?!0:eee(e,n)&&r.equals(t[n],e[n],n,n,t,e,r)}const mee="[object ArrayBuffer]",gee="[object Arguments]",vee="[object Boolean]",yee="[object DataView]",xee="[object Date]",bee="[object Error]",wee="[object Map]",See="[object Number]",kee="[object Object]",_ee="[object RegExp]",Cee="[object Set]",Eee="[object String]",Tee={"[object Int8Array]":!0,"[object Uint8Array]":!0,"[object Uint8ClampedArray]":!0,"[object Int16Array]":!0,"[object Uint16Array]":!0,"[object Int32Array]":!0,"[object Uint32Array]":!0,"[object Float16Array]":!0,"[object Float32Array]":!0,"[object Float64Array]":!0,"[object BigInt64Array]":!0,"[object BigUint64Array]":!0},Nee="[object URL]",Pee=Object.prototype.toString;function Mee({areArrayBuffersEqual:t,areArraysEqual:e,areDataViewsEqual:r,areDatesEqual:n,areErrorsEqual:i,areFunctionsEqual:a,areMapsEqual:s,areNumbersEqual:o,areObjectsEqual:l,arePrimitiveWrappersEqual:u,areRegExpsEqual:c,areSetsEqual:f,areTypedArraysEqual:p,areUrlsEqual:v,unknownTagComparators:y}){return function(w,E,_){if(w===E)return!0;if(w==null||E==null)return!1;const T=typeof w;if(T!==typeof E)return!1;if(T!=="object")return T==="number"?o(w,E,_):T==="function"?a(w,E,_):!1;const N=w.constructor;if(N!==E.constructor)return!1;if(N===Object)return l(w,E,_);if(Array.isArray(w))return e(w,E,_);if(N===Date)return n(w,E,_);if(N===RegExp)return c(w,E,_);if(N===Map)return s(w,E,_);if(N===Set)return f(w,E,_);const R=Pee.call(w);if(R===xee)return n(w,E,_);if(R===_ee)return c(w,E,_);if(R===wee)return s(w,E,_);if(R===Cee)return f(w,E,_);if(R===kee)return typeof w.then!="function"&&typeof E.then!="function"&&l(w,E,_);if(R===Nee)return v(w,E,_);if(R===bee)return i(w,E,_);if(R===gee)return l(w,E,_);if(Tee[R])return p(w,E,_);if(R===mee)return t(w,E,_);if(R===yee)return r(w,E,_);if(R===vee||R===See||R===Eee)return u(w,E,_);if(y){let I=y[R];if(!I){const F=JJ(w);F&&(I=y[F])}if(I)return I(w,E,_)}return!1}}function Aee({circular:t,createCustomConfig:e,strict:r}){let n={areArrayBuffersEqual:iee,areArraysEqual:r?zg:aee,areDataViewsEqual:see,areDatesEqual:oee,areErrorsEqual:lee,areFunctionsEqual:uee,areMapsEqual:r?fS(yP,zg):yP,areNumbersEqual:cee,areObjectsEqual:r?zg:dee,arePrimitiveWrappersEqual:fee,areRegExpsEqual:hee,areSetsEqual:r?fS(xP,zg):xP,areTypedArraysEqual:r?fS(Bx,zg):Bx,areUrlsEqual:pee,unknownTagComparators:void 0};if(e&&(n=Object.assign({},n,e(n))),t){const i=Ty(n.areArraysEqual),a=Ty(n.areMapsEqual),s=Ty(n.areObjectsEqual),o=Ty(n.areSetsEqual);n=Object.assign({},n,{areArraysEqual:i,areMapsEqual:a,areObjectsEqual:s,areSetsEqual:o})}return n}function Ree(t){return function(e,r,n,i,a,s,o){return t(e,r,o)}}function Lee({circular:t,comparator:e,createState:r,equals:n,strict:i}){if(r)return function(o,l){const{cache:u=t?new WeakMap:void 0,meta:c}=r();return e(o,l,{cache:u,equals:n,meta:c,strict:i})};if(t)return function(o,l){return e(o,l,{cache:new WeakMap,equals:n,meta:void 0,strict:i})};const a={cache:void 0,equals:n,meta:void 0,strict:i};return function(o,l){return e(o,l,a)}}const Oee=mf();mf({strict:!0});mf({circular:!0});mf({circular:!0,strict:!0});mf({createInternalComparator:()=>Lh});mf({strict:!0,createInternalComparator:()=>Lh});mf({circular:!0,createInternalComparator:()=>Lh});mf({circular:!0,createInternalComparator:()=>Lh,strict:!0});function mf(t={}){const{circular:e=!1,createInternalComparator:r,createState:n,strict:i=!1}=t,a=Aee(t),s=Mee(a),o=r?r(s):Ree(s);return Lee({circular:e,comparator:s,createState:n,equals:o,strict:i})}var hS={exports:{}},pS={};var bP;function Dee(){if(bP)return pS;bP=1;var t=sm(),e=vL();function r(u,c){return u===c&&(u!==0||1/u===1/c)||u!==u&&c!==c}var n=typeof Object.is=="function"?Object.is:r,i=e.useSyncExternalStore,a=t.useRef,s=t.useEffect,o=t.useMemo,l=t.useDebugValue;return pS.useSyncExternalStoreWithSelector=function(u,c,f,p,v){var y=a(null);if(y.current===null){var S={hasValue:!1,value:null};y.current=S}else S=y.current;y=o(function(){function E(I){if(!_){if(_=!0,T=I,I=p(I),v!==void 0&&S.hasValue){var F=S.value;if(v(F,I))return N=F}return N=I}if(F=N,n(T,I))return F;var D=p(I);return v!==void 0&&v(F,D)?(T=I,F):(T=I,N=D)}var _=!1,T,N,R=f===void 0?null:f;return[function(){return E(c())},R===null?void 0:function(){return E(R())}]},[c,f,p,v]);var w=i(u,y[0],y[1]);return s(function(){S.hasValue=!0,S.value=w},[w]),l(w),w},pS}var wP;function Iee(){return wP||(wP=1,hS.exports=Dee()),hS.exports}var jee=Iee(),Fee=(...t)=>e=>{t.forEach(r=>{typeof r=="function"?r(e):r&&(r.current=e)})},Bee=({contentComponent:t})=>{const e=yL.useSyncExternalStore(t.subscribe,t.getSnapshot,t.getServerSnapshot);return m.jsx(m.Fragment,{children:Object.values(e)})};function zee(){const t=new Set;let e={};return{subscribe(r){return t.add(r),()=>{t.delete(r)}},getSnapshot(){return e},getServerSnapshot(){return e},setRenderer(r,n){e={...e,[r]:QD.createPortal(n.reactElement,n.element,r)},t.forEach(i=>i())},removeRenderer(r){const n={...e};delete n[r],e=n,t.forEach(i=>i())}}}var Uee=class extends nr.Component{constructor(t){var e;super(t),this.editorContentRef=nr.createRef(),this.initialized=!1,this.state={hasContentComponentInitialized:!!((e=t.editor)!=null&&e.contentComponent)}}componentDidMount(){this.init()}componentDidUpdate(){this.init()}init(){var t;const e=this.props.editor;if(e&&!e.isDestroyed&&((t=e.view.dom)!=null&&t.parentNode)){if(e.contentComponent)return;const r=this.editorContentRef.current;r.append(...e.view.dom.parentNode.childNodes),e.setOptions({element:r}),e.contentComponent=zee(),this.state.hasContentComponentInitialized||(this.unsubscribeToContentComponent=e.contentComponent.subscribe(()=>{this.setState(n=>n.hasContentComponentInitialized?n:{hasContentComponentInitialized:!0}),this.unsubscribeToContentComponent&&this.unsubscribeToContentComponent()})),e.createNodeViews(),this.initialized=!0}}componentWillUnmount(){var t;const e=this.props.editor;if(e){this.initialized=!1,e.isDestroyed||e.view.setProps({nodeViews:{}}),this.unsubscribeToContentComponent&&this.unsubscribeToContentComponent(),e.contentComponent=null;try{if(!((t=e.view.dom)!=null&&t.parentNode))return;const r=document.createElement("div");r.append(...e.view.dom.parentNode.childNodes),e.setOptions({element:r})}catch{}}}render(){const{editor:t,innerRef:e,...r}=this.props;return m.jsxs(m.Fragment,{children:[m.jsx("div",{ref:Fee(e,this.editorContentRef),...r}),t?.contentComponent&&m.jsx(Bee,{contentComponent:t.contentComponent})]})}},Gee=ae.forwardRef((t,e)=>{const r=nr.useMemo(()=>Math.floor(Math.random()*4294967295).toString(),[t.editor]);return nr.createElement(Uee,{key:r,innerRef:e,...t})}),Vee=nr.memo(Gee),Hee=typeof window<"u"?ae.useLayoutEffect:ae.useEffect,Wee=class{constructor(t){this.transactionNumber=0,this.lastTransactionNumber=0,this.subscribers=new Set,this.editor=t,this.lastSnapshot={editor:t,transactionNumber:0},this.getSnapshot=this.getSnapshot.bind(this),this.getServerSnapshot=this.getServerSnapshot.bind(this),this.watch=this.watch.bind(this),this.subscribe=this.subscribe.bind(this)}getSnapshot(){return this.transactionNumber===this.lastTransactionNumber?this.lastSnapshot:(this.lastTransactionNumber=this.transactionNumber,this.lastSnapshot={editor:this.editor,transactionNumber:this.transactionNumber},this.lastSnapshot)}getServerSnapshot(){return{editor:null,transactionNumber:0}}subscribe(t){return this.subscribers.add(t),()=>{this.subscribers.delete(t)}}watch(t){if(this.editor=t,this.editor){const e=()=>{this.transactionNumber+=1,this.subscribers.forEach(n=>n())},r=this.editor;return r.on("transaction",e),()=>{r.off("transaction",e)}}}};function qee(t){var e;const[r]=ae.useState(()=>new Wee(t.editor)),n=jee.useSyncExternalStoreWithSelector(r.subscribe,r.getSnapshot,r.getServerSnapshot,t.selector,(e=t.equalityFn)!=null?e:Oee);return Hee(()=>r.watch(t.editor),[t.editor,r]),ae.useDebugValue(n),n}var $ee=!1,Nk=typeof window>"u",Kee=Nk||!!(typeof window<"u"&&window.next),Zee=class N6{constructor(e){this.editor=null,this.subscriptions=new Set,this.isComponentMounted=!1,this.previousDeps=null,this.instanceId="",this.options=e,this.subscriptions=new Set,this.setEditor(this.getInitialEditor()),this.scheduleDestroy(),this.getEditor=this.getEditor.bind(this),this.getServerSnapshot=this.getServerSnapshot.bind(this),this.subscribe=this.subscribe.bind(this),this.refreshEditorInstance=this.refreshEditorInstance.bind(this),this.scheduleDestroy=this.scheduleDestroy.bind(this),this.onRender=this.onRender.bind(this),this.createEditor=this.createEditor.bind(this)}setEditor(e){this.editor=e,this.instanceId=Math.random().toString(36).slice(2,9),this.subscriptions.forEach(r=>r())}getInitialEditor(){return this.options.current.immediatelyRender===void 0?Nk||Kee?null:this.createEditor():(this.options.current.immediatelyRender,this.options.current.immediatelyRender?this.createEditor():null)}createEditor(){const e={...this.options.current,onBeforeCreate:(...n)=>{var i,a;return(a=(i=this.options.current).onBeforeCreate)==null?void 0:a.call(i,...n)},onBlur:(...n)=>{var i,a;return(a=(i=this.options.current).onBlur)==null?void 0:a.call(i,...n)},onCreate:(...n)=>{var i,a;return(a=(i=this.options.current).onCreate)==null?void 0:a.call(i,...n)},onDestroy:(...n)=>{var i,a;return(a=(i=this.options.current).onDestroy)==null?void 0:a.call(i,...n)},onFocus:(...n)=>{var i,a;return(a=(i=this.options.current).onFocus)==null?void 0:a.call(i,...n)},onSelectionUpdate:(...n)=>{var i,a;return(a=(i=this.options.current).onSelectionUpdate)==null?void 0:a.call(i,...n)},onTransaction:(...n)=>{var i,a;return(a=(i=this.options.current).onTransaction)==null?void 0:a.call(i,...n)},onUpdate:(...n)=>{var i,a;return(a=(i=this.options.current).onUpdate)==null?void 0:a.call(i,...n)},onContentError:(...n)=>{var i,a;return(a=(i=this.options.current).onContentError)==null?void 0:a.call(i,...n)},onDrop:(...n)=>{var i,a;return(a=(i=this.options.current).onDrop)==null?void 0:a.call(i,...n)},onPaste:(...n)=>{var i,a;return(a=(i=this.options.current).onPaste)==null?void 0:a.call(i,...n)},onDelete:(...n)=>{var i,a;return(a=(i=this.options.current).onDelete)==null?void 0:a.call(i,...n)}};return new zJ(e)}getEditor(){return this.editor}getServerSnapshot(){return null}subscribe(e){return this.subscriptions.add(e),()=>{this.subscriptions.delete(e)}}static compareOptions(e,r){return Object.keys(e).every(n=>["onCreate","onBeforeCreate","onDestroy","onUpdate","onTransaction","onFocus","onBlur","onSelectionUpdate","onContentError","onDrop","onPaste"].includes(n)?!0:n==="extensions"&&e.extensions&&r.extensions?e.extensions.length!==r.extensions.length?!1:e.extensions.every((i,a)=>{var s;return i===((s=r.extensions)==null?void 0:s[a])}):e[n]===r[n])}onRender(e){return()=>(this.isComponentMounted=!0,clearTimeout(this.scheduledDestructionTimeout),this.editor&&!this.editor.isDestroyed&&e.length===0?N6.compareOptions(this.options.current,this.editor.options)||this.editor.setOptions({...this.options.current,editable:this.editor.isEditable}):this.refreshEditorInstance(e),()=>{this.isComponentMounted=!1,this.scheduleDestroy()})}refreshEditorInstance(e){if(this.editor&&!this.editor.isDestroyed){if(this.previousDeps===null){this.previousDeps=e;return}if(this.previousDeps.length===e.length&&this.previousDeps.every((n,i)=>n===e[i]))return}this.editor&&!this.editor.isDestroyed&&this.editor.destroy(),this.setEditor(this.createEditor()),this.previousDeps=e}scheduleDestroy(){const e=this.instanceId,r=this.editor;this.scheduledDestructionTimeout=setTimeout(()=>{if(this.isComponentMounted&&this.instanceId===e){r&&r.setOptions(this.options.current);return}r&&!r.isDestroyed&&(r.destroy(),this.instanceId===e&&this.setEditor(null))},1)}};function Yee(t={},e=[]){const r=ae.useRef(t);r.current=t;const[n]=ae.useState(()=>new Zee(r)),i=yL.useSyncExternalStore(n.subscribe,n.getEditor,n.getServerSnapshot);return ae.useDebugValue(i),ae.useEffect(n.onRender(e)),qee({editor:i,selector:({transactionNumber:a})=>t.shouldRerenderOnTransaction===!1||t.shouldRerenderOnTransaction===void 0?null:t.immediatelyRender&&a===0?0:a+1}),i}var Xee=ae.createContext({editor:null});Xee.Consumer;var Qee=ae.createContext({onDragStart:()=>{},nodeViewContentChildren:void 0,nodeViewContentRef:()=>{}}),Jee=()=>ae.useContext(Qee);nr.forwardRef((t,e)=>{const{onDragStart:r}=Jee(),n=t.as||"div";return m.jsx(n,{...t,ref:e,"data-node-view-wrapper":"",onDragStart:r,style:{whiteSpace:"normal",...t.style}})});function SP(t){return!!(typeof t=="function"&&t.prototype&&t.prototype.isReactComponent)}function kP(t){return!!(typeof t=="object"&&t.$$typeof&&(t.$$typeof.toString()==="Symbol(react.forward_ref)"||t.$$typeof.description==="react.forward_ref"))}function ete(t){return!!(typeof t=="object"&&t.$$typeof&&(t.$$typeof.toString()==="Symbol(react.memo)"||t.$$typeof.description==="react.memo"))}function tte(t){if(SP(t)||kP(t))return!0;if(ete(t)){const e=t.type;if(e)return SP(e)||kP(e)}return!1}function rte(){try{if(ae.version)return parseInt(ae.version.split(".")[0],10)>=19}catch{}return!1}var nte=class{constructor(t,{editor:e,props:r={},as:n="div",className:i=""}){this.ref=null,this.destroyed=!1,this.id=Math.floor(Math.random()*4294967295).toString(),this.component=t,this.editor=e,this.props=r,this.element=document.createElement(n),this.element.classList.add("react-renderer"),i&&this.element.classList.add(...i.split(" ")),this.editor.isInitialized?xo.flushSync(()=>{this.render()}):queueMicrotask(()=>{this.destroyed||this.render()})}render(){var t;if(this.destroyed)return;const e=this.component,r=this.props,n=this.editor,i=rte(),a=tte(e),s={...r};s.ref&&!(i||a)&&delete s.ref,!s.ref&&(i||a)&&(s.ref=o=>{this.ref=o}),this.reactElement=m.jsx(e,{...s}),(t=n?.contentComponent)==null||t.setRenderer(this.id,this)}updateProps(t={}){this.destroyed||(this.props={...this.props,...t},this.render())}destroy(){var t;this.destroyed=!0;const e=this.editor;(t=e?.contentComponent)==null||t.removeRenderer(this.id);try{this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element)}catch{}}updateAttributes(t){Object.keys(t).forEach(e=>{this.element.setAttribute(e,t[e])})}};nr.createContext({markViewContentRef:()=>{}});var zx=(t,e)=>{if(t==="slot")return 0;if(t instanceof Function)return t(e);const{children:r,...n}=e??{};if(t==="svg")throw new Error("SVG elements are not supported in the JSX syntax, use the array syntax instead");return[t,n,r]},ite=/^\s*>\s$/,ate=eo.create({name:"blockquote",addOptions(){return{HTMLAttributes:{}}},content:"block+",group:"block",defining:!0,parseHTML(){return[{tag:"blockquote"}]},renderHTML({HTMLAttributes:t}){return zx("blockquote",{...Zn(this.options.HTMLAttributes,t),children:zx("slot",{})})},parseMarkdown:(t,e)=>e.createNode("blockquote",void 0,e.parseChildren(t.tokens||[])),renderMarkdown:(t,e)=>{if(!t.content)return"";const r=">",n=[];return t.content.forEach(i=>{const o=e.renderChildren([i]).split(`
`).map(l=>l.trim()===""?r:`${r} ${l}`);n.push(o.join(`
`))}),n.join(`
${r}
`)},addCommands(){return{setBlockquote:()=>({commands:t})=>t.wrapIn(this.name),toggleBlockquote:()=>({commands:t})=>t.toggleWrap(this.name),unsetBlockquote:()=>({commands:t})=>t.lift(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[tm({find:ite,type:this.type})]}}),ste=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))$/,ote=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))/g,lte=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))$/,ute=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))/g,cte=Rh.create({name:"bold",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"strong"},{tag:"b",getAttrs:t=>t.style.fontWeight!=="normal"&&null},{style:"font-weight=400",clearMark:t=>t.type.name===this.name},{style:"font-weight",getAttrs:t=>/^(bold(er)?|[5-9]\d{2,})$/.test(t)&&null}]},renderHTML({HTMLAttributes:t}){return zx("strong",{...Zn(this.options.HTMLAttributes,t),children:zx("slot",{})})},markdownTokenName:"strong",parseMarkdown:(t,e)=>e.applyMark("bold",e.parseInline(t.tokens||[])),renderMarkdown:(t,e)=>`**${e.renderChildren(t)}**`,addCommands(){return{setBold:()=>({commands:t})=>t.setMark(this.name),toggleBold:()=>({commands:t})=>t.toggleMark(this.name),unsetBold:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold(),"Mod-B":()=>this.editor.commands.toggleBold()}},addInputRules(){return[em({find:ste,type:this.type}),em({find:lte,type:this.type})]},addPasteRules(){return[Ch({find:ote,type:this.type}),Ch({find:ute,type:this.type})]}}),dte=/(^|[^`])`([^`]+)`(?!`)$/,fte=/(^|[^`])`([^`]+)`(?!`)/g,hte=Rh.create({name:"code",addOptions(){return{HTMLAttributes:{}}},excludes:"_",code:!0,exitable:!0,parseHTML(){return[{tag:"code"}]},renderHTML({HTMLAttributes:t}){return["code",Zn(this.options.HTMLAttributes,t),0]},markdownTokenName:"codespan",parseMarkdown:(t,e)=>e.applyMark("code",[{type:"text",text:t.text||""}]),renderMarkdown:(t,e)=>t.content?`\`${e.renderChildren(t.content)}\``:"",addCommands(){return{setCode:()=>({commands:t})=>t.setMark(this.name),toggleCode:()=>({commands:t})=>t.toggleMark(this.name),unsetCode:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[em({find:dte,type:this.type})]},addPasteRules(){return[Ch({find:fte,type:this.type})]}}),mS=4,pte=/^```([a-z]+)?[\s\n]$/,mte=/^~~~([a-z]+)?[\s\n]$/,gte=eo.create({name:"codeBlock",addOptions(){return{languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,defaultLanguage:null,enableTabIndentation:!1,tabSize:mS,HTMLAttributes:{}}},content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes(){return{language:{default:this.options.defaultLanguage,parseHTML:t=>{var e;const{languageClassPrefix:r}=this.options;if(!r)return null;const a=[...((e=t.firstElementChild)==null?void 0:e.classList)||[]].filter(s=>s.startsWith(r)).map(s=>s.replace(r,""))[0];return a||null},rendered:!1}}},parseHTML(){return[{tag:"pre",preserveWhitespace:"full"}]},renderHTML({node:t,HTMLAttributes:e}){return["pre",Zn(this.options.HTMLAttributes,e),["code",{class:t.attrs.language?this.options.languageClassPrefix+t.attrs.language:null},0]]},markdownTokenName:"code",parseMarkdown:(t,e)=>{var r;return((r=t.raw)==null?void 0:r.startsWith("```"))===!1&&t.codeBlockStyle!=="indented"?[]:e.createNode("codeBlock",{language:t.lang||null},t.text?[e.createTextNode(t.text)]:[])},renderMarkdown:(t,e)=>{var r;let n="";const i=((r=t.attrs)==null?void 0:r.language)||"";return t.content?n=[`\`\`\`${i}`,e.renderChildren(t.content),"```"].join(`
`):n=`\`\`\`${i}

\`\`\``,n},addCommands(){return{setCodeBlock:t=>({commands:e})=>e.setNode(this.name,t),toggleCodeBlock:t=>({commands:e})=>e.toggleNode(this.name,"paragraph",t)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{const{empty:t,$anchor:e}=this.editor.state.selection,r=e.pos===1;return!t||e.parent.type.name!==this.name?!1:r||!e.parent.textContent.length?this.editor.commands.clearNodes():!1},Tab:({editor:t})=>{var e;if(!this.options.enableTabIndentation)return!1;const r=(e=this.options.tabSize)!=null?e:mS,{state:n}=t,{selection:i}=n,{$from:a,empty:s}=i;if(a.parent.type!==this.type)return!1;const o=" ".repeat(r);return s?t.commands.insertContent(o):t.commands.command(({tr:l})=>{const{from:u,to:c}=i,v=n.doc.textBetween(u,c,`
`,`
`).split(`
`).map(y=>o+y).join(`
`);return l.replaceWith(u,c,n.schema.text(v)),!0})},"Shift-Tab":({editor:t})=>{var e;if(!this.options.enableTabIndentation)return!1;const r=(e=this.options.tabSize)!=null?e:mS,{state:n}=t,{selection:i}=n,{$from:a,empty:s}=i;return a.parent.type!==this.type?!1:s?t.commands.command(({tr:o})=>{var l;const{pos:u}=a,c=a.start(),f=a.end(),v=n.doc.textBetween(c,f,`
`,`
`).split(`
`);let y=0,S=0;const w=u-c;for(let I=0;I<v.length;I+=1){if(S+v[I].length>=w){y=I;break}S+=v[I].length+1}const _=((l=v[y].match(/^ */))==null?void 0:l[0])||"",T=Math.min(_.length,r);if(T===0)return!0;let N=c;for(let I=0;I<y;I+=1)N+=v[I].length+1;return o.delete(N,N+T),u-N<=T&&o.setSelection(dr.create(o.doc,N)),!0}):t.commands.command(({tr:o})=>{const{from:l,to:u}=i,p=n.doc.textBetween(l,u,`
`,`
`).split(`
`).map(v=>{var y;const S=((y=v.match(/^ */))==null?void 0:y[0])||"",w=Math.min(S.length,r);return v.slice(w)}).join(`
`);return o.replaceWith(l,u,n.schema.text(p)),!0})},Enter:({editor:t})=>{if(!this.options.exitOnTripleEnter)return!1;const{state:e}=t,{selection:r}=e,{$from:n,empty:i}=r;if(!i||n.parent.type!==this.type)return!1;const a=n.parentOffset===n.parent.nodeSize-2,s=n.parent.textContent.endsWith(`

`);return!a||!s?!1:t.chain().command(({tr:o})=>(o.delete(n.pos-2,n.pos),!0)).exitCode().run()},ArrowDown:({editor:t})=>{if(!this.options.exitOnArrowDown)return!1;const{state:e}=t,{selection:r,doc:n}=e,{$from:i,empty:a}=r;if(!a||i.parent.type!==this.type||!(i.parentOffset===i.parent.nodeSize-2))return!1;const o=i.after();return o===void 0?!1:n.nodeAt(o)?t.commands.command(({tr:u})=>(u.setSelection(Sr.near(n.resolve(o))),!0)):t.commands.exitCode()}}},addInputRules(){return[Ek({find:pte,type:this.type,getAttributes:t=>({language:t[1]})}),Ek({find:mte,type:this.type,getAttributes:t=>({language:t[1]})})]},addProseMirrorPlugins(){return[new Yn({key:new Ti("codeBlockVSCodeHandler"),props:{handlePaste:(t,e)=>{if(!e.clipboardData||this.editor.isActive(this.type.name))return!1;const r=e.clipboardData.getData("text/plain"),n=e.clipboardData.getData("vscode-editor-data"),i=n?JSON.parse(n):void 0,a=i?.mode;if(!r||!a)return!1;const{tr:s,schema:o}=t.state,l=o.text(r.replace(/\r\n?/g,`
`));return s.replaceSelectionWith(this.type.create({language:a},l)),s.selection.$from.parent.type!==this.type&&s.setSelection(dr.near(s.doc.resolve(Math.max(0,s.selection.from-2)))),s.setMeta("paste",!0),t.dispatch(s),!0}}})]}}),vte=eo.create({name:"doc",topNode:!0,content:"block+",renderMarkdown:(t,e)=>t.content?e.renderChildren(t.content,`

`):""}),yte=eo.create({name:"hardBreak",markdownTokenName:"br",addOptions(){return{keepMarks:!0,HTMLAttributes:{}}},inline:!0,group:"inline",selectable:!1,linebreakReplacement:!0,parseHTML(){return[{tag:"br"}]},renderHTML({HTMLAttributes:t}){return["br",Zn(this.options.HTMLAttributes,t)]},renderText(){return`
`},renderMarkdown:()=>`  
`,parseMarkdown:()=>({type:"hardBreak"}),addCommands(){return{setHardBreak:()=>({commands:t,chain:e,state:r,editor:n})=>t.first([()=>t.exitCode(),()=>t.command(()=>{const{selection:i,storedMarks:a}=r;if(i.$from.parent.type.spec.isolating)return!1;const{keepMarks:s}=this.options,{splittableMarks:o}=n.extensionManager,l=a||i.$to.parentOffset&&i.$from.marks();return e().insertContent({type:this.name}).command(({tr:u,dispatch:c})=>{if(c&&l&&s){const f=l.filter(p=>o.includes(p.type.name));u.ensureMarks(f)}return!0}).run()})])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}}),xte=eo.create({name:"heading",addOptions(){return{levels:[1,2,3,4,5,6],HTMLAttributes:{}}},content:"inline*",group:"block",defining:!0,addAttributes(){return{level:{default:1,rendered:!1}}},parseHTML(){return this.options.levels.map(t=>({tag:`h${t}`,attrs:{level:t}}))},renderHTML({node:t,HTMLAttributes:e}){return[`h${this.options.levels.includes(t.attrs.level)?t.attrs.level:this.options.levels[0]}`,Zn(this.options.HTMLAttributes,e),0]},parseMarkdown:(t,e)=>e.createNode("heading",{level:t.depth||1},e.parseInline(t.tokens||[])),renderMarkdown:(t,e)=>{var r;const n=(r=t.attrs)!=null&&r.level?parseInt(t.attrs.level,10):1,i="#".repeat(n);return t.content?`${i} ${e.renderChildren(t.content)}`:""},addCommands(){return{setHeading:t=>({commands:e})=>this.options.levels.includes(t.level)?e.setNode(this.name,t):!1,toggleHeading:t=>({commands:e})=>this.options.levels.includes(t.level)?e.toggleNode(this.name,"paragraph",t):!1}},addKeyboardShortcuts(){return this.options.levels.reduce((t,e)=>({...t,[`Mod-Alt-${e}`]:()=>this.editor.commands.toggleHeading({level:e})}),{})},addInputRules(){return this.options.levels.map(t=>Ek({find:new RegExp(`^(#{${Math.min(...this.options.levels)},${t}})\\s$`),type:this.type,getAttributes:{level:t}}))}}),bte=eo.create({name:"horizontalRule",addOptions(){return{HTMLAttributes:{},nextNodeType:"paragraph"}},group:"block",parseHTML(){return[{tag:"hr"}]},renderHTML({HTMLAttributes:t}){return["hr",Zn(this.options.HTMLAttributes,t)]},markdownTokenName:"hr",parseMarkdown:(t,e)=>e.createNode("horizontalRule"),renderMarkdown:()=>"---",addCommands(){return{setHorizontalRule:()=>({chain:t,state:e})=>{if(!GJ(e,e.schema.nodes[this.name]))return!1;const{selection:r}=e,{$to:n}=r,i=t();return l6(r)?i.insertContentAt(n.pos,{type:this.name}):i.insertContent({type:this.name}),i.command(({state:a,tr:s,dispatch:o})=>{if(o){const{$to:l}=s.selection,u=l.end();if(l.nodeAfter)l.nodeAfter.isTextblock?s.setSelection(dr.create(s.doc,l.pos+1)):l.nodeAfter.isBlock?s.setSelection(Xt.create(s.doc,l.pos)):s.setSelection(dr.create(s.doc,l.pos));else{const c=a.schema.nodes[this.options.nextNodeType]||l.parent.type.contentMatch.defaultType,f=c?.create();f&&(s.insert(u,f),s.setSelection(dr.create(s.doc,u+1)))}s.scrollIntoView()}return!0}).run()}}},addInputRules(){return[UJ({find:/^(?:---|-|___\s|\*\*\*\s)$/,type:this.type})]}}),wte=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))$/,Ste=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))/g,kte=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))$/,_te=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))/g,Cte=Rh.create({name:"italic",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"em"},{tag:"i",getAttrs:t=>t.style.fontStyle!=="normal"&&null},{style:"font-style=normal",clearMark:t=>t.type.name===this.name},{style:"font-style=italic"}]},renderHTML({HTMLAttributes:t}){return["em",Zn(this.options.HTMLAttributes,t),0]},addCommands(){return{setItalic:()=>({commands:t})=>t.setMark(this.name),toggleItalic:()=>({commands:t})=>t.toggleMark(this.name),unsetItalic:()=>({commands:t})=>t.unsetMark(this.name)}},markdownTokenName:"em",parseMarkdown:(t,e)=>e.applyMark("italic",e.parseInline(t.tokens||[])),renderMarkdown:(t,e)=>`*${e.renderChildren(t)}*`,addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic(),"Mod-I":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[em({find:wte,type:this.type}),em({find:kte,type:this.type})]},addPasteRules(){return[Ch({find:Ste,type:this.type}),Ch({find:_te,type:this.type})]}});const Ete="aaa1rp3bb0ott3vie4c1le2ogado5udhabi7c0ademy5centure6ountant0s9o1tor4d0s1ult4e0g1ro2tna4f0l1rica5g0akhan5ency5i0g1rbus3force5tel5kdn3l0ibaba4pay4lfinanz6state5y2sace3tom5m0azon4ericanexpress7family11x2fam3ica3sterdam8nalytics7droid5quan4z2o0l2partments8p0le4q0uarelle8r0ab1mco4chi3my2pa2t0e3s0da2ia2sociates9t0hleta5torney7u0ction5di0ble3o3spost5thor3o0s4w0s2x0a2z0ure5ba0by2idu3namex4d1k2r0celona5laycard4s5efoot5gains6seball5ketball8uhaus5yern5b0c1t1va3cg1n2d1e0ats2uty4er2rlin4st0buy5t2f1g1h0arti5i0ble3d1ke2ng0o3o1z2j1lack0friday9ockbuster8g1omberg7ue3m0s1w2n0pparibas9o0ats3ehringer8fa2m1nd2o0k0ing5sch2tik2on4t1utique6x2r0adesco6idgestone9oadway5ker3ther5ussels7s1t1uild0ers6siness6y1zz3v1w1y1z0h3ca0b1fe2l0l1vinklein9m0era3p2non3petown5ital0one8r0avan4ds2e0er0s4s2sa1e1h1ino4t0ering5holic7ba1n1re3c1d1enter4o1rn3f0a1d2g1h0anel2nel4rity4se2t2eap3intai5ristmas6ome4urch5i0priani6rcle4sco3tadel4i0c2y3k1l0aims4eaning6ick2nic1que6othing5ud3ub0med6m1n1o0ach3des3ffee4llege4ogne5m0mbank4unity6pany2re3uter5sec4ndos3struction8ulting7tact3ractors9oking4l1p2rsica5untry4pon0s4rses6pa2r0edit0card4union9icket5own3s1uise0s6u0isinella9v1w1x1y0mru3ou3z2dad1nce3ta1e1ing3sun4y2clk3ds2e0al0er2s3gree4livery5l1oitte5ta3mocrat6ntal2ist5si0gn4v2hl2iamonds6et2gital5rect0ory7scount3ver5h2y2j1k1m1np2o0cs1tor4g1mains5t1wnload7rive4tv2ubai3nlop4pont4rban5vag2r2z2earth3t2c0o2deka3u0cation8e1g1mail3erck5nergy4gineer0ing9terprises10pson4quipment8r0icsson6ni3s0q1tate5t1u0rovision8s2vents5xchange6pert3osed4ress5traspace10fage2il1rwinds6th3mily4n0s2rm0ers5shion4t3edex3edback6rrari3ero6i0delity5o2lm2nal1nce1ial7re0stone6mdale6sh0ing5t0ness6j1k1lickr3ghts4r2orist4wers5y2m1o0o0d1tball6rd1ex2sale4um3undation8x2r0ee1senius7l1ogans4ntier7tr2ujitsu5n0d2rniture7tbol5yi3ga0l0lery3o1up4me0s3p1rden4y2b0iz3d0n2e0a1nt0ing5orge5f1g0ee3h1i0ft0s3ves2ing5l0ass3e1obal2o4m0ail3bh2o1x2n1odaddy5ld0point6f2o0dyear5g0le4p1t1v2p1q1r0ainger5phics5tis4een3ipe3ocery4up4s1t1u0cci3ge2ide2tars5ru3w1y2hair2mburg5ngout5us3bo2dfc0bank7ealth0care8lp1sinki6re1mes5iphop4samitsu7tachi5v2k0t2m1n1ockey4ldings5iday5medepot5goods5s0ense7nda3rse3spital5t0ing5t0els3mail5use3w2r1sbc3t1u0ghes5yatt3undai7ibm2cbc2e1u2d1e0ee3fm2kano4l1m0amat4db2mo0bilien9n0c1dustries8finiti5o2g1k1stitute6urance4e4t0ernational10uit4vestments10o1piranga7q1r0ish4s0maili5t0anbul7t0au2v3jaguar4va3cb2e0ep2tzt3welry6io2ll2m0p2nj2o0bs1urg4t1y2p0morgan6rs3uegos4niper7kaufen5ddi3e0rryhotels6properties14fh2g1h1i0a1ds2m1ndle4tchen5wi3m1n1oeln3matsu5sher5p0mg2n2r0d1ed3uokgroup8w1y0oto4z2la0caixa5mborghini8er3nd0rover6xess5salle5t0ino3robe5w0yer5b1c1ds2ease3clerc5frak4gal2o2xus4gbt3i0dl2fe0insurance9style7ghting6ke2lly3mited4o2ncoln4k2ve1ing5k1lc1p2oan0s3cker3us3l1ndon4tte1o3ve3pl0financial11r1s1t0d0a3u0ndbeck6xe1ury5v1y2ma0drid4if1son4keup4n0agement7go3p1rket0ing3s4riott5shalls7ttel5ba2c0kinsey7d1e0d0ia3et2lbourne7me1orial6n0u2rckmsd7g1h1iami3crosoft7l1ni1t2t0subishi9k1l0b1s2m0a2n1o0bi0le4da2e1i1m1nash3ey2ster5rmon3tgage6scow4to0rcycles9v0ie4p1q1r1s0d2t0n1r2u0seum3ic4v1w1x1y1z2na0b1goya4me2vy3ba2c1e0c1t0bank4flix4work5ustar5w0s2xt0direct7us4f0l2g0o2hk2i0co2ke1on3nja3ssan1y5l1o0kia3rton4w0ruz3tv4p1r0a1w2tt2u1yc2z2obi1server7ffice5kinawa6layan0group9lo3m0ega4ne1g1l0ine5oo2pen3racle3nge4g0anic5igins6saka4tsuka4t2vh3pa0ge2nasonic7ris2s1tners4s1y3y2ccw3e0t2f0izer5g1h0armacy6d1ilips5one2to0graphy6s4ysio5ics1tet2ures6d1n0g1k2oneer5zza4k1l0ace2y0station9umbing5s3m1n0c2ohl2ker3litie5rn2st3r0axi3ess3ime3o0d0uctions8f1gressive8mo2perties3y5tection8u0dential9s1t1ub2w0c2y2qa1pon3uebec3st5racing4dio4e0ad1lestate6tor2y4cipes5d0stone5umbrella9hab3ise0n3t2liance6n0t0als5pair3ort3ublican8st0aurant8view0s5xroth6ich0ardli6oh3l1o1p2o0cks3deo3gers4om3s0vp3u0gby3hr2n2w0e2yukyu6sa0arland6fe0ty4kura4le1on3msclub4ung5ndvik0coromant12ofi4p1rl2s1ve2xo3b0i1s2c0b1haeffler7midt4olarships8ol3ule3warz5ience5ot3d1e0arch3t2cure1ity6ek2lect4ner3rvices6ven3w1x0y3fr2g1h0angrila6rp3ell3ia1ksha5oes2p0ping5uji3w3i0lk2na1gles5te3j1k0i0n2y0pe4l0ing4m0art3ile4n0cf3o0ccer3ial4ftbank4ware6hu2lar2utions7ng1y2y2pa0ce3ort2t3r0l2s1t0ada2ples4r1tebank4farm7c0group6ockholm6rage3e3ream4udio2y3yle4u0cks3pplies3y2ort5rf1gery5zuki5v1watch4iss4x1y0dney4stems6z2tab1ipei4lk2obao4rget4tamotors6r2too4x0i3c0i2d0k2eam2ch0nology8l1masek5nnis4va3f1g1h0d1eater2re6iaa2ckets5enda4ps2res2ol4j0maxx4x2k0maxx5l1m0all4n1o0day3kyo3ols3p1ray3shiba5tal3urs3wn2yota3s3r0ade1ing4ining5vel0ers0insurance16ust3v2t1ube2i1nes3shu4v0s2w1z2ua1bank3s2g1k1nicom3versity8o2ol2ps2s1y1z2va0cations7na1guard7c1e0gas3ntures6risign5mgensberater2ung14sicherung10t2g1i0ajes4deo3g1king4llas4n1p1rgin4sa1ion4va1o3laanderen9n1odka3lvo3te1ing3o2yage5u2wales2mart4ter4ng0gou5tch0es6eather0channel12bcam3er2site5d0ding5ibo2r3f1hoswho6ien2ki2lliamhill9n0dows4e1ners6me2olterskluwer11odside6rk0s2ld3w2s1tc1f3xbox3erox4ihuan4n2xx2yz3yachts4hoo3maxun5ndex5e1odobashi7ga2kohama6u0tube6t1un3za0ppos4ra3ero3ip2m1one3uerich6w2",Tte="121342632165322333335355455655552435435422463632574574330355524444661154543332344423364211133222221212112052232222232212222223222241112222224322321222",Pk="numeric",Mk="ascii",Ak="alpha",lv="asciinumeric",Qg="alphanumeric",Rk="domain",P6="emoji",Nte="scheme",Pte="slashscheme",gS="whitespace";function Mte(t,e){return t in e||(e[t]=[]),e[t]}function ah(t,e,r){e[Pk]&&(e[lv]=!0,e[Qg]=!0),e[Mk]&&(e[lv]=!0,e[Ak]=!0),e[lv]&&(e[Qg]=!0),e[Ak]&&(e[Qg]=!0),e[Qg]&&(e[Rk]=!0),e[P6]&&(e[Rk]=!0);for(const n in e){const i=Mte(n,r);i.indexOf(t)<0&&i.push(t)}}function Ate(t,e){const r={};for(const n in e)e[n].indexOf(t)>=0&&(r[n]=!0);return r}function Zs(t=null){this.j={},this.jr=[],this.jd=null,this.t=t}Zs.groups={};Zs.prototype={accepts(){return!!this.t},go(t){const e=this,r=e.j[t];if(r)return r;for(let n=0;n<e.jr.length;n++){const i=e.jr[n][0],a=e.jr[n][1];if(a&&i.test(t))return a}return e.jd},has(t,e=!1){return e?t in this.j:!!this.go(t)},ta(t,e,r,n){for(let i=0;i<t.length;i++)this.tt(t[i],e,r,n)},tr(t,e,r,n){n=n||Zs.groups;let i;return e&&e.j?i=e:(i=new Zs(e),r&&n&&ah(e,r,n)),this.jr.push([t,i]),i},ts(t,e,r,n){let i=this;const a=t.length;if(!a)return i;for(let s=0;s<a-1;s++)i=i.tt(t[s]);return i.tt(t[a-1],e,r,n)},tt(t,e,r,n){n=n||Zs.groups;const i=this;if(e&&e.j)return i.j[t]=e,e;const a=e;let s,o=i.go(t);if(o?(s=new Zs,Object.assign(s.j,o.j),s.jr.push.apply(s.jr,o.jr),s.jd=o.jd,s.t=o.t):s=new Zs,a){if(n)if(s.t&&typeof s.t=="string"){const l=Object.assign(Ate(s.t,n),r);ah(a,l,n)}else r&&ah(a,r,n);s.t=a}return i.j[t]=s,s}};const wr=(t,e,r,n,i)=>t.ta(e,r,n,i),ci=(t,e,r,n,i)=>t.tr(e,r,n,i),_P=(t,e,r,n,i)=>t.ts(e,r,n,i),ut=(t,e,r,n,i)=>t.tt(e,r,n,i),lc="WORD",Lk="UWORD",M6="ASCIINUMERICAL",A6="ALPHANUMERICAL",Gv="LOCALHOST",Ok="TLD",Dk="UTLD",Xy="SCHEME",Mp="SLASH_SCHEME",uC="NUM",Ik="WS",cC="NL",uv="OPENBRACE",cv="CLOSEBRACE",Ux="OPENBRACKET",Gx="CLOSEBRACKET",Vx="OPENPAREN",Hx="CLOSEPAREN",Wx="OPENANGLEBRACKET",qx="CLOSEANGLEBRACKET",$x="FULLWIDTHLEFTPAREN",Kx="FULLWIDTHRIGHTPAREN",Zx="LEFTCORNERBRACKET",Yx="RIGHTCORNERBRACKET",Xx="LEFTWHITECORNERBRACKET",Qx="RIGHTWHITECORNERBRACKET",Jx="FULLWIDTHLESSTHAN",e1="FULLWIDTHGREATERTHAN",t1="AMPERSAND",r1="APOSTROPHE",n1="ASTERISK",Nd="AT",i1="BACKSLASH",a1="BACKTICK",s1="CARET",Ad="COLON",dC="COMMA",o1="DOLLAR",xu="DOT",l1="EQUALS",fC="EXCLAMATION",qo="HYPHEN",dv="PERCENT",u1="PIPE",c1="PLUS",d1="POUND",fv="QUERY",hC="QUOTE",R6="FULLWIDTHMIDDLEDOT",pC="SEMI",bu="SLASH",hv="TILDE",f1="UNDERSCORE",L6="EMOJI",h1="SYM";var O6=Object.freeze({__proto__:null,ALPHANUMERICAL:A6,AMPERSAND:t1,APOSTROPHE:r1,ASCIINUMERICAL:M6,ASTERISK:n1,AT:Nd,BACKSLASH:i1,BACKTICK:a1,CARET:s1,CLOSEANGLEBRACKET:qx,CLOSEBRACE:cv,CLOSEBRACKET:Gx,CLOSEPAREN:Hx,COLON:Ad,COMMA:dC,DOLLAR:o1,DOT:xu,EMOJI:L6,EQUALS:l1,EXCLAMATION:fC,FULLWIDTHGREATERTHAN:e1,FULLWIDTHLEFTPAREN:$x,FULLWIDTHLESSTHAN:Jx,FULLWIDTHMIDDLEDOT:R6,FULLWIDTHRIGHTPAREN:Kx,HYPHEN:qo,LEFTCORNERBRACKET:Zx,LEFTWHITECORNERBRACKET:Xx,LOCALHOST:Gv,NL:cC,NUM:uC,OPENANGLEBRACKET:Wx,OPENBRACE:uv,OPENBRACKET:Ux,OPENPAREN:Vx,PERCENT:dv,PIPE:u1,PLUS:c1,POUND:d1,QUERY:fv,QUOTE:hC,RIGHTCORNERBRACKET:Yx,RIGHTWHITECORNERBRACKET:Qx,SCHEME:Xy,SEMI:pC,SLASH:bu,SLASH_SCHEME:Mp,SYM:h1,TILDE:hv,TLD:Ok,UNDERSCORE:f1,UTLD:Dk,UWORD:Lk,WORD:lc,WS:Ik});const sc=/[a-z]/,Ug=new RegExp("\\p{L}","u"),vS=new RegExp("\\p{Emoji}","u"),oc=/\d/,yS=/\s/,CP="\r",xS=`
`,Rte="",Lte="",bS="";let Ny=null,Py=null;function Ote(t=[]){const e={};Zs.groups=e;const r=new Zs;Ny==null&&(Ny=EP(Ete)),Py==null&&(Py=EP(Tte)),ut(r,"'",r1),ut(r,"{",uv),ut(r,"}",cv),ut(r,"[",Ux),ut(r,"]",Gx),ut(r,"(",Vx),ut(r,")",Hx),ut(r,"<",Wx),ut(r,">",qx),ut(r,"",$x),ut(r,"",Kx),ut(r,"",Zx),ut(r,"",Yx),ut(r,"",Xx),ut(r,"",Qx),ut(r,"",Jx),ut(r,"",e1),ut(r,"&",t1),ut(r,"*",n1),ut(r,"@",Nd),ut(r,"`",a1),ut(r,"^",s1),ut(r,":",Ad),ut(r,",",dC),ut(r,"$",o1),ut(r,".",xu),ut(r,"=",l1),ut(r,"!",fC),ut(r,"-",qo),ut(r,"%",dv),ut(r,"|",u1),ut(r,"+",c1),ut(r,"#",d1),ut(r,"?",fv),ut(r,'"',hC),ut(r,"/",bu),ut(r,";",pC),ut(r,"~",hv),ut(r,"_",f1),ut(r,"\\",i1),ut(r,"",R6);const n=ci(r,oc,uC,{[Pk]:!0});ci(n,oc,n);const i=ci(n,sc,M6,{[lv]:!0}),a=ci(n,Ug,A6,{[Qg]:!0}),s=ci(r,sc,lc,{[Mk]:!0});ci(s,oc,i),ci(s,sc,s),ci(i,oc,i),ci(i,sc,i);const o=ci(r,Ug,Lk,{[Ak]:!0});ci(o,sc),ci(o,oc,a),ci(o,Ug,o),ci(a,oc,a),ci(a,sc),ci(a,Ug,a);const l=ut(r,xS,cC,{[gS]:!0}),u=ut(r,CP,Ik,{[gS]:!0}),c=ci(r,yS,Ik,{[gS]:!0});ut(r,bS,c),ut(u,xS,l),ut(u,bS,c),ci(u,yS,c),ut(c,CP),ut(c,xS),ci(c,yS,c),ut(c,bS,c);const f=ci(r,vS,L6,{[P6]:!0});ut(f,"#"),ci(f,vS,f),ut(f,Rte,f);const p=ut(f,Lte);ut(p,"#"),ci(p,vS,f);const v=[[sc,s],[oc,i]],y=[[sc,null],[Ug,o],[oc,a]];for(let S=0;S<Ny.length;S++)kd(r,Ny[S],Ok,lc,v);for(let S=0;S<Py.length;S++)kd(r,Py[S],Dk,Lk,y);ah(Ok,{tld:!0,ascii:!0},e),ah(Dk,{utld:!0,alpha:!0},e),kd(r,"file",Xy,lc,v),kd(r,"mailto",Xy,lc,v),kd(r,"http",Mp,lc,v),kd(r,"https",Mp,lc,v),kd(r,"ftp",Mp,lc,v),kd(r,"ftps",Mp,lc,v),ah(Xy,{scheme:!0,ascii:!0},e),ah(Mp,{slashscheme:!0,ascii:!0},e),t=t.sort((S,w)=>S[0]>w[0]?1:-1);for(let S=0;S<t.length;S++){const w=t[S][0],_=t[S][1]?{[Nte]:!0}:{[Pte]:!0};w.indexOf("-")>=0?_[Rk]=!0:sc.test(w)?oc.test(w)?_[lv]=!0:_[Mk]=!0:_[Pk]=!0,_P(r,w,w,_)}return _P(r,"localhost",Gv,{ascii:!0}),r.jd=new Zs(h1),{start:r,tokens:Object.assign({groups:e},O6)}}function D6(t,e){const r=Dte(e.replace(/[A-Z]/g,o=>o.toLowerCase())),n=r.length,i=[];let a=0,s=0;for(;s<n;){let o=t,l=null,u=0,c=null,f=-1,p=-1;for(;s<n&&(l=o.go(r[s]));)o=l,o.accepts()?(f=0,p=0,c=o):f>=0&&(f+=r[s].length,p++),u+=r[s].length,a+=r[s].length,s++;a-=f,s-=p,u-=f,i.push({t:c.t,v:e.slice(a-u,a),s:a-u,e:a})}return i}function Dte(t){const e=[],r=t.length;let n=0;for(;n<r;){let i=t.charCodeAt(n),a,s=i<55296||i>56319||n+1===r||(a=t.charCodeAt(n+1))<56320||a>57343?t[n]:t.slice(n,n+2);e.push(s),n+=s.length}return e}function kd(t,e,r,n,i){let a;const s=e.length;for(let o=0;o<s-1;o++){const l=e[o];t.j[l]?a=t.j[l]:(a=new Zs(n),a.jr=i.slice(),t.j[l]=a),t=a}return a=new Zs(r),a.jr=i.slice(),t.j[e[s-1]]=a,a}function EP(t){const e=[],r=[];let n=0,i="0123456789";for(;n<t.length;){let a=0;for(;i.indexOf(t[n+a])>=0;)a++;if(a>0){e.push(r.join(""));for(let s=parseInt(t.substring(n,n+a),10);s>0;s--)r.pop();n+=a}else r.push(t[n]),n++}return e}const Vv={defaultProtocol:"http",events:null,format:TP,formatHref:TP,nl2br:!1,tagName:"a",target:null,rel:null,validate:!0,truncate:1/0,className:null,attributes:null,ignoreTags:[],render:null};function mC(t,e=null){let r=Object.assign({},Vv);t&&(r=Object.assign(r,t instanceof mC?t.o:t));const n=r.ignoreTags,i=[];for(let a=0;a<n.length;a++)i.push(n[a].toUpperCase());this.o=r,e&&(this.defaultRender=e),this.ignoreTags=i}mC.prototype={o:Vv,ignoreTags:[],defaultRender(t){return t},check(t){return this.get("validate",t.toString(),t)},get(t,e,r){const n=e!=null;let i=this.o[t];return i&&(typeof i=="object"?(i=r.t in i?i[r.t]:Vv[t],typeof i=="function"&&n&&(i=i(e,r))):typeof i=="function"&&n&&(i=i(e,r.t,r)),i)},getObj(t,e,r){let n=this.o[t];return typeof n=="function"&&e!=null&&(n=n(e,r.t,r)),n},render(t){const e=t.render(this);return(this.get("render",null,t)||this.defaultRender)(e,t.t,t)}};function TP(t){return t}function I6(t,e){this.t="token",this.v=t,this.tk=e}I6.prototype={isLink:!1,toString(){return this.v},toHref(t){return this.toString()},toFormattedString(t){const e=this.toString(),r=t.get("truncate",e,this),n=t.get("format",e,this);return r&&n.length>r?n.substring(0,r)+"":n},toFormattedHref(t){return t.get("formatHref",this.toHref(t.get("defaultProtocol")),this)},startIndex(){return this.tk[0].s},endIndex(){return this.tk[this.tk.length-1].e},toObject(t=Vv.defaultProtocol){return{type:this.t,value:this.toString(),isLink:this.isLink,href:this.toHref(t),start:this.startIndex(),end:this.endIndex()}},toFormattedObject(t){return{type:this.t,value:this.toFormattedString(t),isLink:this.isLink,href:this.toFormattedHref(t),start:this.startIndex(),end:this.endIndex()}},validate(t){return t.get("validate",this.toString(),this)},render(t){const e=this,r=this.toHref(t.get("defaultProtocol")),n=t.get("formatHref",r,this),i=t.get("tagName",r,e),a=this.toFormattedString(t),s={},o=t.get("className",r,e),l=t.get("target",r,e),u=t.get("rel",r,e),c=t.getObj("attributes",r,e),f=t.getObj("events",r,e);return s.href=n,o&&(s.class=o),l&&(s.target=l),u&&(s.rel=u),c&&Object.assign(s,c),{tagName:i,attributes:s,content:a,eventListeners:f}}};function ab(t,e){class r extends I6{constructor(i,a){super(i,a),this.t=t}}for(const n in e)r.prototype[n]=e[n];return r.t=t,r}const NP=ab("email",{isLink:!0,toHref(){return"mailto:"+this.toString()}}),PP=ab("text"),Ite=ab("nl"),My=ab("url",{isLink:!0,toHref(t=Vv.defaultProtocol){return this.hasProtocol()?this.v:`${t}://${this.v}`},hasProtocol(){const t=this.tk;return t.length>=2&&t[0].t!==Gv&&t[1].t===Ad}}),Ho=t=>new Zs(t);function jte({groups:t}){const e=t.domain.concat([t1,n1,Nd,i1,a1,s1,o1,l1,qo,uC,dv,u1,c1,d1,bu,h1,hv,f1]),r=[r1,Ad,dC,xu,fC,dv,fv,hC,pC,Wx,qx,uv,cv,Gx,Ux,Vx,Hx,$x,Kx,Zx,Yx,Xx,Qx,Jx,e1],n=[t1,r1,n1,i1,a1,s1,o1,l1,qo,uv,cv,dv,u1,c1,d1,fv,bu,h1,hv,f1],i=Ho(),a=ut(i,hv);wr(a,n,a),wr(a,t.domain,a);const s=Ho(),o=Ho(),l=Ho();wr(i,t.domain,s),wr(i,t.scheme,o),wr(i,t.slashscheme,l),wr(s,n,a),wr(s,t.domain,s);const u=ut(s,Nd);ut(a,Nd,u),ut(o,Nd,u),ut(l,Nd,u);const c=ut(a,xu);wr(c,n,a),wr(c,t.domain,a);const f=Ho();wr(u,t.domain,f),wr(f,t.domain,f);const p=ut(f,xu);wr(p,t.domain,f);const v=Ho(NP);wr(p,t.tld,v),wr(p,t.utld,v),ut(u,Gv,v);const y=ut(f,qo);ut(y,qo,y),wr(y,t.domain,f),wr(v,t.domain,f),ut(v,xu,p),ut(v,qo,y);const S=ut(v,Ad);wr(S,t.numeric,NP);const w=ut(s,qo),E=ut(s,xu);ut(w,qo,w),wr(w,t.domain,s),wr(E,n,a),wr(E,t.domain,s);const _=Ho(My);wr(E,t.tld,_),wr(E,t.utld,_),wr(_,t.domain,s),wr(_,n,a),ut(_,xu,E),ut(_,qo,w),ut(_,Nd,u);const T=ut(_,Ad),N=Ho(My);wr(T,t.numeric,N);const R=Ho(My),I=Ho();wr(R,e,R),wr(R,r,I),wr(I,e,R),wr(I,r,I),ut(_,bu,R),ut(N,bu,R);const F=ut(o,Ad),D=ut(l,Ad),j=ut(D,bu),B=ut(j,bu);wr(o,t.domain,s),ut(o,xu,E),ut(o,qo,w),wr(l,t.domain,s),ut(l,xu,E),ut(l,qo,w),wr(F,t.domain,R),ut(F,bu,R),ut(F,fv,R),wr(B,t.domain,R),wr(B,e,R),ut(B,bu,R);const G=[[uv,cv],[Ux,Gx],[Vx,Hx],[Wx,qx],[$x,Kx],[Zx,Yx],[Xx,Qx],[Jx,e1]];for(let K=0;K<G.length;K++){const[O,W]=G[K],U=ut(R,O);ut(I,O,U),ut(U,W,R);const q=Ho(My);wr(U,e,q);const Z=Ho();wr(U,r),wr(q,e,q),wr(q,r,Z),wr(Z,e,q),wr(Z,r,Z),ut(q,W,R),ut(Z,W,R)}return ut(i,Gv,_),ut(i,cC,Ite),{start:i,tokens:O6}}function Fte(t,e,r){let n=r.length,i=0,a=[],s=[];for(;i<n;){let o=t,l=null,u=null,c=0,f=null,p=-1;for(;i<n&&!(l=o.go(r[i].t));)s.push(r[i++]);for(;i<n&&(u=l||o.go(r[i].t));)l=null,o=u,o.accepts()?(p=0,f=o):p>=0&&p++,i++,c++;if(p<0)i-=c,i<n&&(s.push(r[i]),i++);else{s.length>0&&(a.push(wS(PP,e,s)),s=[]),i-=p,c-=p;const v=f.t,y=r.slice(i-c,i);a.push(wS(v,e,y))}}return s.length>0&&a.push(wS(PP,e,s)),a}function wS(t,e,r){const n=r[0].s,i=r[r.length-1].e,a=e.slice(n,i);return new t(a,r)}const Bte=typeof console<"u"&&console&&console.warn||(()=>{}),zte="until manual call of linkify.init(). Register all schemes and plugins before invoking linkify the first time.",Ln={scanner:null,parser:null,tokenQueue:[],pluginQueue:[],customSchemes:[],initialized:!1};function Ute(){return Zs.groups={},Ln.scanner=null,Ln.parser=null,Ln.tokenQueue=[],Ln.pluginQueue=[],Ln.customSchemes=[],Ln.initialized=!1,Ln}function MP(t,e=!1){if(Ln.initialized&&Bte(`linkifyjs: already initialized - will not register custom scheme "${t}" ${zte}`),!/^[0-9a-z]+(-[0-9a-z]+)*$/.test(t))throw new Error(`linkifyjs: incorrect scheme format.
1. Must only contain digits, lowercase ASCII letters or "-"
2. Cannot start or end with "-"
3. "-" cannot repeat`);Ln.customSchemes.push([t,e])}function Gte(){Ln.scanner=Ote(Ln.customSchemes);for(let t=0;t<Ln.tokenQueue.length;t++)Ln.tokenQueue[t][1]({scanner:Ln.scanner});Ln.parser=jte(Ln.scanner.tokens);for(let t=0;t<Ln.pluginQueue.length;t++)Ln.pluginQueue[t][1]({scanner:Ln.scanner,parser:Ln.parser});return Ln.initialized=!0,Ln}function gC(t){return Ln.initialized||Gte(),Fte(Ln.parser.start,t,D6(Ln.scanner.start,t))}gC.scan=D6;function j6(t,e=null,r=null){if(e&&typeof e=="object"){if(r)throw Error(`linkifyjs: Invalid link type ${e}; must be a string`);r=e,e=null}const n=new mC(r),i=gC(t),a=[];for(let s=0;s<i.length;s++){const o=i[s];o.isLink&&(!e||o.t===e)&&n.check(o)&&a.push(o.toFormattedObject(n))}return a}var vC="[\0- -\u2029]",Vte=new RegExp(vC),Hte=new RegExp(`${vC}$`),Wte=new RegExp(vC,"g");function qte(t){return t.length===1?t[0].isLink:t.length===3&&t[1].isLink?["()","[]"].includes(t[0].value+t[2].value):!1}function $te(t){return new Yn({key:new Ti("autolink"),appendTransaction:(e,r,n)=>{const i=e.some(u=>u.docChanged)&&!r.doc.eq(n.doc),a=e.some(u=>u.getMeta("preventAutolink"));if(!i||a)return;const{tr:s}=n,o=e6(r.doc,[...e]);if(o6(o).forEach(({newRange:u})=>{const c=GQ(n.doc,u,v=>v.isTextblock);let f,p;if(c.length>1)f=c[0],p=n.doc.textBetween(f.pos,f.pos+f.node.nodeSize,void 0," ");else if(c.length){const v=n.doc.textBetween(u.from,u.to," "," ");if(!Hte.test(v))return;f=c[0],p=n.doc.textBetween(f.pos,u.to,void 0," ")}if(f&&p){const v=p.split(Vte).filter(Boolean);if(v.length<=0)return!1;const y=v[v.length-1],S=f.pos+p.lastIndexOf(y);if(!y)return!1;const w=gC(y).map(E=>E.toObject(t.defaultProtocol));if(!qte(w))return!1;w.filter(E=>E.isLink).map(E=>({...E,from:S+E.start+1,to:S+E.end+1})).filter(E=>n.schema.marks.code?!n.doc.rangeHasMark(E.from,E.to,n.schema.marks.code):!0).filter(E=>t.validate(E.value)).filter(E=>t.shouldAutoLink(E.value)).forEach(E=>{iC(E.from,E.to,n.doc).some(_=>_.mark.type===t.type)||s.addMark(E.from,E.to,t.type.create({href:E.href}))})}}),!!s.steps.length)return s}})}function Kte(t){return new Yn({key:new Ti("handleClickLink"),props:{handleClick:(e,r,n)=>{var i,a;if(n.button!==0||!e.editable)return!1;let s=null;if(n.target instanceof HTMLAnchorElement)s=n.target;else{const l=n.target;if(!l)return!1;const u=t.editor.view.dom;s=l.closest("a"),s&&!u.contains(s)&&(s=null)}if(!s)return!1;let o=!1;if(t.enableClickSelection&&(o=t.editor.commands.extendMarkRange(t.type.name)),t.openOnClick){const l=s6(e.state,t.type.name),u=(i=s.href)!=null?i:l.href,c=(a=s.target)!=null?a:l.target;u&&(window.open(u,c),o=!0)}return o}}})}function Zte(t){return new Yn({key:new Ti("handlePasteLink"),props:{handlePaste:(e,r,n)=>{const{shouldAutoLink:i}=t,{state:a}=e,{selection:s}=a,{empty:o}=s;if(o)return!1;let l="";n.content.forEach(c=>{l+=c.textContent});const u=j6(l,{defaultProtocol:t.defaultProtocol}).find(c=>c.isLink&&c.value===l);return!l||!u||i!==void 0&&!i(u.value)?!1:t.editor.commands.setMark(t.type,{href:u.href})}}})}function $f(t,e){const r=["http","https","ftp","ftps","mailto","tel","callto","sms","cid","xmpp"];return e&&e.forEach(n=>{const i=typeof n=="string"?n:n.scheme;i&&r.push(i)}),!t||t.replace(Wte,"").match(new RegExp(`^(?:(?:${r.join("|")}):|[^a-z]|[a-z0-9+.-]+(?:[^a-z+.-:]|$))`,"i"))}var Yte=Rh.create({name:"link",priority:1e3,keepOnSplit:!1,exitable:!0,onCreate(){this.options.validate&&!this.options.shouldAutoLink&&(this.options.shouldAutoLink=this.options.validate,console.warn("The `validate` option is deprecated. Rename to the `shouldAutoLink` option instead.")),this.options.protocols.forEach(t=>{if(typeof t=="string"){MP(t);return}MP(t.scheme,t.optionalSlashes)})},onDestroy(){Ute()},inclusive(){return this.options.autolink},addOptions(){return{openOnClick:!0,enableClickSelection:!1,linkOnPaste:!0,autolink:!0,protocols:[],defaultProtocol:"http",HTMLAttributes:{target:"_blank",rel:"noopener noreferrer nofollow",class:null},isAllowedUri:(t,e)=>!!$f(t,e.protocols),validate:t=>!!t,shouldAutoLink:t=>{const e=/^[a-z][a-z0-9+.-]*:\/\//i.test(t),r=/^[a-z][a-z0-9+.-]*:/i.test(t);if(e||r&&!t.includes("@"))return!0;const i=(t.includes("@")?t.split("@").pop():t).split(/[/?#:]/)[0];return!(/^\d{1,3}(\.\d{1,3}){3}$/.test(i)||!/\./.test(i))}}},addAttributes(){return{href:{default:null,parseHTML(t){return t.getAttribute("href")}},target:{default:this.options.HTMLAttributes.target},rel:{default:this.options.HTMLAttributes.rel},class:{default:this.options.HTMLAttributes.class}}},parseHTML(){return[{tag:"a[href]",getAttrs:t=>{const e=t.getAttribute("href");return!e||!this.options.isAllowedUri(e,{defaultValidate:r=>!!$f(r,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?!1:null}}]},renderHTML({HTMLAttributes:t}){return this.options.isAllowedUri(t.href,{defaultValidate:e=>!!$f(e,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?["a",Zn(this.options.HTMLAttributes,t),0]:["a",Zn(this.options.HTMLAttributes,{...t,href:""}),0]},markdownTokenName:"link",parseMarkdown:(t,e)=>e.applyMark("link",e.parseInline(t.tokens||[]),{href:t.href,title:t.title||null}),renderMarkdown:(t,e)=>{var r;const n=((r=t.attrs)==null?void 0:r.href)||"";return`[${e.renderChildren(t)}](${n})`},addCommands(){return{setLink:t=>({chain:e})=>{const{href:r}=t;return this.options.isAllowedUri(r,{defaultValidate:n=>!!$f(n,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?e().setMark(this.name,t).setMeta("preventAutolink",!0).run():!1},toggleLink:t=>({chain:e})=>{const{href:r}=t||{};return r&&!this.options.isAllowedUri(r,{defaultValidate:n=>!!$f(n,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?!1:e().toggleMark(this.name,t,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()},unsetLink:()=>({chain:t})=>t().unsetMark(this.name,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()}},addPasteRules(){return[Ch({find:t=>{const e=[];if(t){const{protocols:r,defaultProtocol:n}=this.options,i=j6(t).filter(a=>a.isLink&&this.options.isAllowedUri(a.value,{defaultValidate:s=>!!$f(s,r),protocols:r,defaultProtocol:n}));i.length&&i.forEach(a=>{this.options.shouldAutoLink(a.value)&&e.push({text:a.value,data:{href:a.href},index:a.start})})}return e},type:this.type,getAttributes:t=>{var e;return{href:(e=t.data)==null?void 0:e.href}}})]},addProseMirrorPlugins(){const t=[],{protocols:e,defaultProtocol:r}=this.options;return this.options.autolink&&t.push($te({type:this.type,defaultProtocol:this.options.defaultProtocol,validate:n=>this.options.isAllowedUri(n,{defaultValidate:i=>!!$f(i,e),protocols:e,defaultProtocol:r}),shouldAutoLink:this.options.shouldAutoLink})),t.push(Kte({type:this.type,editor:this.editor,openOnClick:this.options.openOnClick==="whenNotEditable"?!0:this.options.openOnClick,enableClickSelection:this.options.enableClickSelection})),this.options.linkOnPaste&&t.push(Zte({editor:this.editor,defaultProtocol:this.options.defaultProtocol,type:this.type,shouldAutoLink:this.options.shouldAutoLink})),t}}),Xte=Object.defineProperty,Qte=(t,e)=>{for(var r in e)Xte(t,r,{get:e[r],enumerable:!0})},Jte="listItem",AP="textStyle",RP=/^\s*([-+*])\s$/,F6=eo.create({name:"bulletList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:"ul"}]},renderHTML({HTMLAttributes:t}){return["ul",Zn(this.options.HTMLAttributes,t),0]},markdownTokenName:"list",parseMarkdown:(t,e)=>t.type!=="list"||t.ordered?[]:{type:"bulletList",content:t.items?e.parseChildren(t.items):[]},renderMarkdown:(t,e)=>t.content?e.renderChildren(t.content,`
`):"",markdownOptions:{indentsContent:!0},addCommands(){return{toggleBulletList:()=>({commands:t,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(Jte,this.editor.getAttributes(AP)).run():t.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){let t=tm({find:RP,type:this.type});return(this.options.keepMarks||this.options.keepAttributes)&&(t=tm({find:RP,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:()=>this.editor.getAttributes(AP),editor:this.editor})),[t]}}),B6=eo.create({name:"listItem",addOptions(){return{HTMLAttributes:{},bulletListTypeName:"bulletList",orderedListTypeName:"orderedList"}},content:"paragraph block*",defining:!0,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:t}){return["li",Zn(this.options.HTMLAttributes,t),0]},markdownTokenName:"list_item",parseMarkdown:(t,e)=>{if(t.type!=="list_item")return[];let r=[];if(t.tokens&&t.tokens.length>0)if(t.tokens.some(i=>i.type==="paragraph"))r=e.parseChildren(t.tokens);else{const i=t.tokens[0];if(i&&i.type==="text"&&i.tokens&&i.tokens.length>0){if(r=[{type:"paragraph",content:e.parseInline(i.tokens)}],t.tokens.length>1){const s=t.tokens.slice(1),o=e.parseChildren(s);r.push(...o)}}else r=e.parseChildren(t.tokens)}return r.length===0&&(r=[{type:"paragraph",content:[]}]),{type:"listItem",content:r}},renderMarkdown:(t,e,r)=>lC(t,e,n=>n.parentType==="bulletList"?"- ":n.parentType==="orderedList"?`${n.index+1}. `:"- ",r),addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),ere={};Qte(ere,{findListItemPos:()=>h0,getNextListDepth:()=>yC,handleBackspace:()=>jk,handleDelete:()=>Fk,hasListBefore:()=>z6,hasListItemAfter:()=>tre,hasListItemBefore:()=>U6,listItemHasSubList:()=>G6,nextListIsDeeper:()=>V6,nextListIsHigher:()=>H6});var h0=(t,e)=>{const{$from:r}=e.selection,n=ji(t,e.schema);let i=null,a=r.depth,s=r.pos,o=null;for(;a>0&&o===null;)i=r.node(a),i.type===n?o=a:(a-=1,s-=1);return o===null?null:{$pos:e.doc.resolve(s),depth:o}},yC=(t,e)=>{const r=h0(t,e);if(!r)return!1;const[,n]=QQ(e,t,r.$pos.pos+4);return n},z6=(t,e,r)=>{const{$anchor:n}=t.selection,i=Math.max(0,n.pos-2),a=t.doc.resolve(i).node();return!(!a||!r.includes(a.type.name))},U6=(t,e)=>{var r;const{$anchor:n}=e.selection,i=e.doc.resolve(n.pos-2);return!(i.index()===0||((r=i.nodeBefore)==null?void 0:r.type.name)!==t)},G6=(t,e,r)=>{if(!r)return!1;const n=ji(t,e.schema);let i=!1;return r.descendants(a=>{a.type===n&&(i=!0)}),i},jk=(t,e,r)=>{if(t.commands.undoInputRule())return!0;if(t.state.selection.from!==t.state.selection.to)return!1;if(!nf(t.state,e)&&z6(t.state,e,r)){const{$anchor:o}=t.state.selection,l=t.state.doc.resolve(o.before()-1),u=[];l.node().descendants((p,v)=>{p.type.name===e&&u.push({node:p,pos:v})});const c=u.at(-1);if(!c)return!1;const f=t.state.doc.resolve(l.start()+c.pos+1);return t.chain().cut({from:o.start()-1,to:o.end()+1},f.end()).joinForward().run()}if(!nf(t.state,e)||!rJ(t.state))return!1;const n=h0(e,t.state);if(!n)return!1;const a=t.state.doc.resolve(n.$pos.pos-2).node(n.depth),s=G6(e,t.state,a);return U6(e,t.state)&&!s?t.commands.joinItemBackward():t.chain().liftListItem(e).run()},V6=(t,e)=>{const r=yC(t,e),n=h0(t,e);return!n||!r?!1:r>n.depth},H6=(t,e)=>{const r=yC(t,e),n=h0(t,e);return!n||!r?!1:r<n.depth},Fk=(t,e)=>{if(!nf(t.state,e)||!tJ(t.state,e))return!1;const{selection:r}=t.state,{$from:n,$to:i}=r;return!r.empty&&n.sameParent(i)?!1:V6(e,t.state)?t.chain().focus(t.state.selection.from+4).lift(e).joinBackward().run():H6(e,t.state)?t.chain().joinForward().joinBackward().run():t.commands.joinItemForward()},tre=(t,e)=>{var r;const{$anchor:n}=e.selection,i=e.doc.resolve(n.pos-n.parentOffset-2);return!(i.index()===i.parent.childCount-1||((r=i.nodeAfter)==null?void 0:r.type.name)!==t)},W6=Ni.create({name:"listKeymap",addOptions(){return{listTypes:[{itemName:"listItem",wrapperNames:["bulletList","orderedList"]},{itemName:"taskItem",wrapperNames:["taskList"]}]}},addKeyboardShortcuts(){return{Delete:({editor:t})=>{let e=!1;return this.options.listTypes.forEach(({itemName:r})=>{t.state.schema.nodes[r]!==void 0&&Fk(t,r)&&(e=!0)}),e},"Mod-Delete":({editor:t})=>{let e=!1;return this.options.listTypes.forEach(({itemName:r})=>{t.state.schema.nodes[r]!==void 0&&Fk(t,r)&&(e=!0)}),e},Backspace:({editor:t})=>{let e=!1;return this.options.listTypes.forEach(({itemName:r,wrapperNames:n})=>{t.state.schema.nodes[r]!==void 0&&jk(t,r,n)&&(e=!0)}),e},"Mod-Backspace":({editor:t})=>{let e=!1;return this.options.listTypes.forEach(({itemName:r,wrapperNames:n})=>{t.state.schema.nodes[r]!==void 0&&jk(t,r,n)&&(e=!0)}),e}}}}),LP=/^(\s*)(\d+)\.\s+(.*)$/,rre=/^\s/;function nre(t){const e=[];let r=0,n=0;for(;r<t.length;){const i=t[r],a=i.match(LP);if(!a)break;const[,s,o,l]=a,u=s.length;let c=l,f=r+1;const p=[i];for(;f<t.length;){const v=t[f];if(v.match(LP))break;if(v.trim()==="")p.push(v),c+=`
`,f+=1;else if(v.match(rre))p.push(v),c+=`
${v.slice(u+2)}`,f+=1;else break}e.push({indent:u,number:parseInt(o,10),content:c.trim(),raw:p.join(`
`)}),n=f,r=f}return[e,n]}function q6(t,e,r){var n;const i=[];let a=0;for(;a<t.length;){const s=t[a];if(s.indent===e){const o=s.content.split(`
`),l=((n=o[0])==null?void 0:n.trim())||"",u=[];l&&u.push({type:"paragraph",raw:l,tokens:r.inlineTokens(l)});const c=o.slice(1).join(`
`).trim();if(c){const v=r.blockTokens(c);u.push(...v)}let f=a+1;const p=[];for(;f<t.length&&t[f].indent>e;)p.push(t[f]),f+=1;if(p.length>0){const v=Math.min(...p.map(S=>S.indent)),y=q6(p,v,r);u.push({type:"list",ordered:!0,start:p[0].number,items:y,raw:p.map(S=>S.raw).join(`
`)})}i.push({type:"list_item",raw:s.raw,tokens:u}),a=f}else a+=1}return i}function ire(t,e){return t.map(r=>{if(r.type!=="list_item")return e.parseChildren([r])[0];const n=[];return r.tokens&&r.tokens.length>0&&r.tokens.forEach(i=>{if(i.type==="paragraph"||i.type==="list"||i.type==="blockquote"||i.type==="code")n.push(...e.parseChildren([i]));else if(i.type==="text"&&i.tokens){const a=e.parseChildren([i]);n.push({type:"paragraph",content:a})}else{const a=e.parseChildren([i]);a.length>0&&n.push(...a)}}),{type:"listItem",content:n}})}var are="listItem",OP="textStyle",DP=/^(\d+)\.\s$/,$6=eo.create({name:"orderedList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},addAttributes(){return{start:{default:1,parseHTML:t=>t.hasAttribute("start")?parseInt(t.getAttribute("start")||"",10):1},type:{default:null,parseHTML:t=>t.getAttribute("type")}}},parseHTML(){return[{tag:"ol"}]},renderHTML({HTMLAttributes:t}){const{start:e,...r}=t;return e===1?["ol",Zn(this.options.HTMLAttributes,r),0]:["ol",Zn(this.options.HTMLAttributes,t),0]},markdownTokenName:"list",parseMarkdown:(t,e)=>{if(t.type!=="list"||!t.ordered)return[];const r=t.start||1,n=t.items?ire(t.items,e):[];return r!==1?{type:"orderedList",attrs:{start:r},content:n}:{type:"orderedList",content:n}},renderMarkdown:(t,e)=>t.content?e.renderChildren(t.content,`
`):"",markdownTokenizer:{name:"orderedList",level:"block",start:t=>{const e=t.match(/^(\s*)(\d+)\.\s+/),r=e?.index;return r!==void 0?r:-1},tokenize:(t,e,r)=>{var n;const i=t.split(`
`),[a,s]=nre(i);if(a.length===0)return;const o=q6(a,0,r);return o.length===0?void 0:{type:"list",ordered:!0,start:((n=a[0])==null?void 0:n.number)||1,items:o,raw:i.slice(0,s).join(`
`)}}},markdownOptions:{indentsContent:!0},addCommands(){return{toggleOrderedList:()=>({commands:t,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(are,this.editor.getAttributes(OP)).run():t.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){let t=tm({find:DP,type:this.type,getAttributes:e=>({start:+e[1]}),joinPredicate:(e,r)=>r.childCount+r.attrs.start===+e[1]});return(this.options.keepMarks||this.options.keepAttributes)&&(t=tm({find:DP,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:e=>({start:+e[1],...this.editor.getAttributes(OP)}),joinPredicate:(e,r)=>r.childCount+r.attrs.start===+e[1],editor:this.editor})),[t]}}),sre=/^\s*(\[([( |x])?\])\s$/,ore=eo.create({name:"taskItem",addOptions(){return{nested:!1,HTMLAttributes:{},taskListTypeName:"taskList",a11y:void 0}},content(){return this.options.nested?"paragraph block*":"paragraph+"},defining:!0,addAttributes(){return{checked:{default:!1,keepOnSplit:!1,parseHTML:t=>{const e=t.getAttribute("data-checked");return e===""||e==="true"},renderHTML:t=>({"data-checked":t.checked})}}},parseHTML(){return[{tag:`li[data-type="${this.name}"]`,priority:51}]},renderHTML({node:t,HTMLAttributes:e}){return["li",Zn(this.options.HTMLAttributes,e,{"data-type":this.name}),["label",["input",{type:"checkbox",checked:t.attrs.checked?"checked":null}],["span"]],["div",0]]},parseMarkdown:(t,e)=>{const r=[];if(t.tokens&&t.tokens.length>0?r.push(e.createNode("paragraph",{},e.parseInline(t.tokens))):t.text?r.push(e.createNode("paragraph",{},[e.createNode("text",{text:t.text})])):r.push(e.createNode("paragraph",{},[])),t.nestedTokens&&t.nestedTokens.length>0){const n=e.parseChildren(t.nestedTokens);r.push(...n)}return e.createNode("taskItem",{checked:t.checked||!1},r)},renderMarkdown:(t,e)=>{var r;const i=`- [${(r=t.attrs)!=null&&r.checked?"x":" "}] `;return lC(t,e,i)},addKeyboardShortcuts(){const t={Enter:()=>this.editor.commands.splitListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)};return this.options.nested?{...t,Tab:()=>this.editor.commands.sinkListItem(this.name)}:t},addNodeView(){return({node:t,HTMLAttributes:e,getPos:r,editor:n})=>{const i=document.createElement("li"),a=document.createElement("label"),s=document.createElement("span"),o=document.createElement("input"),l=document.createElement("div"),u=f=>{var p,v;o.ariaLabel=((v=(p=this.options.a11y)==null?void 0:p.checkboxLabel)==null?void 0:v.call(p,f,o.checked))||`Task item checkbox for ${f.textContent||"empty task item"}`};u(t),a.contentEditable="false",o.type="checkbox",o.addEventListener("mousedown",f=>f.preventDefault()),o.addEventListener("change",f=>{if(!n.isEditable&&!this.options.onReadOnlyChecked){o.checked=!o.checked;return}const{checked:p}=f.target;n.isEditable&&typeof r=="function"&&n.chain().focus(void 0,{scrollIntoView:!1}).command(({tr:v})=>{const y=r();if(typeof y!="number")return!1;const S=v.doc.nodeAt(y);return v.setNodeMarkup(y,void 0,{...S?.attrs,checked:p}),!0}).run(),!n.isEditable&&this.options.onReadOnlyChecked&&(this.options.onReadOnlyChecked(t,p)||(o.checked=!o.checked))}),Object.entries(this.options.HTMLAttributes).forEach(([f,p])=>{i.setAttribute(f,p)}),i.dataset.checked=t.attrs.checked,o.checked=t.attrs.checked,a.append(o,s),i.append(a,l),Object.entries(e).forEach(([f,p])=>{i.setAttribute(f,p)});let c=new Set(Object.keys(e));return{dom:i,contentDOM:l,update:f=>{if(f.type!==this.type)return!1;i.dataset.checked=f.attrs.checked,o.checked=f.attrs.checked,u(f);const p=n.extensionManager.attributes,v=Uv(f,p),y=new Set(Object.keys(v)),S=this.options.HTMLAttributes;return c.forEach(w=>{y.has(w)||(w in S?i.setAttribute(w,S[w]):i.removeAttribute(w))}),Object.entries(v).forEach(([w,E])=>{E==null?w in S?i.setAttribute(w,S[w]):i.removeAttribute(w):i.setAttribute(w,E)}),c=y,!0}}}},addInputRules(){return[tm({find:sre,type:this.type,getAttributes:t=>({checked:t[t.length-1]==="x"})})]}}),lre=eo.create({name:"taskList",addOptions(){return{itemTypeName:"taskItem",HTMLAttributes:{}}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:`ul[data-type="${this.name}"]`,priority:51}]},renderHTML({HTMLAttributes:t}){return["ul",Zn(this.options.HTMLAttributes,t,{"data-type":this.name}),0]},parseMarkdown:(t,e)=>e.createNode("taskList",{},e.parseChildren(t.items||[])),renderMarkdown:(t,e)=>t.content?e.renderChildren(t.content,`
`):"",markdownTokenizer:{name:"taskList",level:"block",start(t){var e;const r=(e=t.match(/^\s*[-+*]\s+\[([ xX])\]\s+/))==null?void 0:e.index;return r!==void 0?r:-1},tokenize(t,e,r){const n=a=>{const s=Tk(a,{itemPattern:/^(\s*)([-+*])\s+\[([ xX])\]\s+(.*)$/,extractItemData:o=>({indentLevel:o[1].length,mainContent:o[4],checked:o[3].toLowerCase()==="x"}),createToken:(o,l)=>({type:"taskItem",raw:"",mainContent:o.mainContent,indentLevel:o.indentLevel,checked:o.checked,text:o.mainContent,tokens:r.inlineTokens(o.mainContent),nestedTokens:l}),customNestedParser:n},r);return s?[{type:"taskList",raw:s.raw,items:s.items}]:r.blockTokens(a)},i=Tk(t,{itemPattern:/^(\s*)([-+*])\s+\[([ xX])\]\s+(.*)$/,extractItemData:a=>({indentLevel:a[1].length,mainContent:a[4],checked:a[3].toLowerCase()==="x"}),createToken:(a,s)=>({type:"taskItem",raw:"",mainContent:a.mainContent,indentLevel:a.indentLevel,checked:a.checked,text:a.mainContent,tokens:r.inlineTokens(a.mainContent),nestedTokens:s}),customNestedParser:n},r);if(i)return{type:"taskList",raw:i.raw,items:i.items}}},markdownOptions:{indentsContent:!0},addCommands(){return{toggleTaskList:()=>({commands:t})=>t.toggleList(this.name,this.options.itemTypeName)}},addKeyboardShortcuts(){return{"Mod-Shift-9":()=>this.editor.commands.toggleTaskList()}}});Ni.create({name:"listKit",addExtensions(){const t=[];return this.options.bulletList!==!1&&t.push(F6.configure(this.options.bulletList)),this.options.listItem!==!1&&t.push(B6.configure(this.options.listItem)),this.options.listKeymap!==!1&&t.push(W6.configure(this.options.listKeymap)),this.options.orderedList!==!1&&t.push($6.configure(this.options.orderedList)),this.options.taskItem!==!1&&t.push(ore.configure(this.options.taskItem)),this.options.taskList!==!1&&t.push(lre.configure(this.options.taskList)),t}});var ure=eo.create({name:"paragraph",priority:1e3,addOptions(){return{HTMLAttributes:{}}},group:"block",content:"inline*",parseHTML(){return[{tag:"p"}]},renderHTML({HTMLAttributes:t}){return["p",Zn(this.options.HTMLAttributes,t),0]},parseMarkdown:(t,e)=>{const r=t.tokens||[];return r.length===1&&r[0].type==="image"?e.parseChildren([r[0]]):e.createNode("paragraph",void 0,e.parseInline(r))},renderMarkdown:(t,e)=>!t||!Array.isArray(t.content)?"":e.renderChildren(t.content),addCommands(){return{setParagraph:()=>({commands:t})=>t.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),cre=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))$/,dre=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))/g,fre=Rh.create({name:"strike",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:t=>t.includes("line-through")?{}:!1}]},renderHTML({HTMLAttributes:t}){return["s",Zn(this.options.HTMLAttributes,t),0]},markdownTokenName:"del",parseMarkdown:(t,e)=>e.applyMark("strike",e.parseInline(t.tokens||[])),renderMarkdown:(t,e)=>`~~${e.renderChildren(t)}~~`,addCommands(){return{setStrike:()=>({commands:t})=>t.setMark(this.name),toggleStrike:()=>({commands:t})=>t.toggleMark(this.name),unsetStrike:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-s":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[em({find:cre,type:this.type})]},addPasteRules(){return[Ch({find:dre,type:this.type})]}}),hre=eo.create({name:"text",group:"inline",parseMarkdown:t=>({type:"text",text:t.text||""}),renderMarkdown:t=>t.text||""}),pre=Rh.create({name:"underline",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"u"},{style:"text-decoration",consuming:!1,getAttrs:t=>t.includes("underline")?{}:!1}]},renderHTML({HTMLAttributes:t}){return["u",Zn(this.options.HTMLAttributes,t),0]},parseMarkdown(t,e){return e.applyMark(this.name||"underline",e.parseInline(t.tokens||[]))},renderMarkdown(t,e){return`++${e.renderChildren(t)}++`},markdownTokenizer:{name:"underline",level:"inline",start(t){return t.indexOf("++")},tokenize(t,e,r){const i=/^(\+\+)([\s\S]+?)(\+\+)/.exec(t);if(!i)return;const a=i[2].trim();return{type:"underline",raw:i[0],text:a,tokens:r.inlineTokens(a)}}},addCommands(){return{setUnderline:()=>({commands:t})=>t.setMark(this.name),toggleUnderline:()=>({commands:t})=>t.toggleMark(this.name),unsetUnderline:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-u":()=>this.editor.commands.toggleUnderline(),"Mod-U":()=>this.editor.commands.toggleUnderline()}}});function mre(t={}){return new Yn({view(e){return new gre(e,t)}})}class gre{constructor(e,r){var n;this.editorView=e,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=(n=r.width)!==null&&n!==void 0?n:1,this.color=r.color===!1?void 0:r.color||"black",this.class=r.class,this.handlers=["dragover","dragend","drop","dragleave"].map(i=>{let a=s=>{this[i](s)};return e.dom.addEventListener(i,a),{name:i,handler:a}})}destroy(){this.handlers.forEach(({name:e,handler:r})=>this.editorView.dom.removeEventListener(e,r))}update(e,r){this.cursorPos!=null&&r.doc!=e.state.doc&&(this.cursorPos>e.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(e){e!=this.cursorPos&&(this.cursorPos=e,e==null?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let e=this.editorView.state.doc.resolve(this.cursorPos),r=!e.parent.inlineContent,n,i=this.editorView.dom,a=i.getBoundingClientRect(),s=a.width/i.offsetWidth,o=a.height/i.offsetHeight;if(r){let f=e.nodeBefore,p=e.nodeAfter;if(f||p){let v=this.editorView.nodeDOM(this.cursorPos-(f?f.nodeSize:0));if(v){let y=v.getBoundingClientRect(),S=f?y.bottom:y.top;f&&p&&(S=(S+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2);let w=this.width/2*o;n={left:y.left,right:y.right,top:S-w,bottom:S+w}}}}if(!n){let f=this.editorView.coordsAtPos(this.cursorPos),p=this.width/2*s;n={left:f.left-p,right:f.left+p,top:f.top,bottom:f.bottom}}let l=this.editorView.dom.offsetParent;this.element||(this.element=l.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",r),this.element.classList.toggle("prosemirror-dropcursor-inline",!r);let u,c;if(!l||l==document.body&&getComputedStyle(l).position=="static")u=-pageXOffset,c=-pageYOffset;else{let f=l.getBoundingClientRect(),p=f.width/l.offsetWidth,v=f.height/l.offsetHeight;u=f.left-l.scrollLeft*p,c=f.top-l.scrollTop*v}this.element.style.left=(n.left-u)/s+"px",this.element.style.top=(n.top-c)/o+"px",this.element.style.width=(n.right-n.left)/s+"px",this.element.style.height=(n.bottom-n.top)/o+"px"}scheduleRemoval(e){clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.setCursor(null),e)}dragover(e){if(!this.editorView.editable)return;let r=this.editorView.posAtCoords({left:e.clientX,top:e.clientY}),n=r&&r.inside>=0&&this.editorView.state.doc.nodeAt(r.inside),i=n&&n.type.spec.disableDropCursor,a=typeof i=="function"?i(this.editorView,r,e):i;if(r&&!a){let s=r.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let o=WL(this.editorView.state.doc,s,this.editorView.dragging.slice);o!=null&&(s=o)}this.setCursor(s),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(e){this.editorView.dom.contains(e.relatedTarget)||this.setCursor(null)}}class di extends Sr{constructor(e){super(e,e)}map(e,r){let n=e.resolve(r.map(this.head));return di.valid(n)?new di(n):Sr.near(n)}content(){return Pt.empty}eq(e){return e instanceof di&&e.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(e,r){if(typeof r.pos!="number")throw new RangeError("Invalid input for GapCursor.fromJSON");return new di(e.resolve(r.pos))}getBookmark(){return new xC(this.anchor)}static valid(e){let r=e.parent;if(r.isTextblock||!vre(e)||!yre(e))return!1;let n=r.type.spec.allowGapCursor;if(n!=null)return n;let i=r.contentMatchAt(e.index()).defaultType;return i&&i.isTextblock}static findGapCursorFrom(e,r,n=!1){e:for(;;){if(!n&&di.valid(e))return e;let i=e.pos,a=null;for(let s=e.depth;;s--){let o=e.node(s);if(r>0?e.indexAfter(s)<o.childCount:e.index(s)>0){a=o.child(r>0?e.indexAfter(s):e.index(s)-1);break}else if(s==0)return null;i+=r;let l=e.doc.resolve(i);if(di.valid(l))return l}for(;;){let s=r>0?a.firstChild:a.lastChild;if(!s){if(a.isAtom&&!a.isText&&!Xt.isSelectable(a)){e=e.doc.resolve(i+a.nodeSize*r),n=!1;continue e}break}a=s,i+=r;let o=e.doc.resolve(i);if(di.valid(o))return o}return null}}}di.prototype.visible=!1;di.findFrom=di.findGapCursorFrom;Sr.jsonID("gapcursor",di);class xC{constructor(e){this.pos=e}map(e){return new xC(e.map(this.pos))}resolve(e){let r=e.resolve(this.pos);return di.valid(r)?new di(r):Sr.near(r)}}function K6(t){return t.isAtom||t.spec.isolating||t.spec.createGapCursor}function vre(t){for(let e=t.depth;e>=0;e--){let r=t.index(e),n=t.node(e);if(r==0){if(n.type.spec.isolating)return!0;continue}for(let i=n.child(r-1);;i=i.lastChild){if(i.childCount==0&&!i.inlineContent||K6(i.type))return!0;if(i.inlineContent)return!1}}return!0}function yre(t){for(let e=t.depth;e>=0;e--){let r=t.indexAfter(e),n=t.node(e);if(r==n.childCount){if(n.type.spec.isolating)return!0;continue}for(let i=n.child(r);;i=i.firstChild){if(i.childCount==0&&!i.inlineContent||K6(i.type))return!0;if(i.inlineContent)return!1}}return!0}function xre(){return new Yn({props:{decorations:kre,createSelectionBetween(t,e,r){return e.pos==r.pos&&di.valid(r)?new di(r):null},handleClick:wre,handleKeyDown:bre,handleDOMEvents:{beforeinput:Sre}}})}const bre=qO({ArrowLeft:Ay("horiz",-1),ArrowRight:Ay("horiz",1),ArrowUp:Ay("vert",-1),ArrowDown:Ay("vert",1)});function Ay(t,e){const r=t=="vert"?e>0?"down":"up":e>0?"right":"left";return function(n,i,a){let s=n.selection,o=e>0?s.$to:s.$from,l=s.empty;if(s instanceof dr){if(!a.endOfTextblock(r)||o.depth==0)return!1;l=!1,o=n.doc.resolve(e>0?o.after():o.before())}let u=di.findGapCursorFrom(o,e,l);return u?(i&&i(n.tr.setSelection(new di(u))),!0):!1}}function wre(t,e,r){if(!t||!t.editable)return!1;let n=t.state.doc.resolve(e);if(!di.valid(n))return!1;let i=t.posAtCoords({left:r.clientX,top:r.clientY});return i&&i.inside>-1&&Xt.isSelectable(t.state.doc.nodeAt(i.inside))?!1:(t.dispatch(t.state.tr.setSelection(new di(n))),!0)}function Sre(t,e){if(e.inputType!="insertCompositionText"||!(t.state.selection instanceof di))return!1;let{$from:r}=t.state.selection,n=r.parent.contentMatchAt(r.index()).findWrapping(t.state.schema.nodes.text);if(!n)return!1;let i=it.empty;for(let s=n.length-1;s>=0;s--)i=it.from(n[s].createAndFill(null,i));let a=t.state.tr.replace(r.pos,r.pos,new Pt(i,0,0));return a.setSelection(dr.near(a.doc.resolve(r.pos+1))),t.dispatch(a),!1}function kre(t){if(!(t.selection instanceof di))return null;let e=document.createElement("div");return e.className="ProseMirror-gapcursor",$n.create(t.doc,[as.widget(t.selection.head,e,{key:"gapcursor"})])}var p1=200,ya=function(){};ya.prototype.append=function(e){return e.length?(e=ya.from(e),!this.length&&e||e.length<p1&&this.leafAppend(e)||this.length<p1&&e.leafPrepend(this)||this.appendInner(e)):this};ya.prototype.prepend=function(e){return e.length?ya.from(e).append(this):this};ya.prototype.appendInner=function(e){return new _re(this,e)};ya.prototype.slice=function(e,r){return e===void 0&&(e=0),r===void 0&&(r=this.length),e>=r?ya.empty:this.sliceInner(Math.max(0,e),Math.min(this.length,r))};ya.prototype.get=function(e){if(!(e<0||e>=this.length))return this.getInner(e)};ya.prototype.forEach=function(e,r,n){r===void 0&&(r=0),n===void 0&&(n=this.length),r<=n?this.forEachInner(e,r,n,0):this.forEachInvertedInner(e,r,n,0)};ya.prototype.map=function(e,r,n){r===void 0&&(r=0),n===void 0&&(n=this.length);var i=[];return this.forEach(function(a,s){return i.push(e(a,s))},r,n),i};ya.from=function(e){return e instanceof ya?e:e&&e.length?new Z6(e):ya.empty};var Z6=(function(t){function e(n){t.call(this),this.values=n}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={length:{configurable:!0},depth:{configurable:!0}};return e.prototype.flatten=function(){return this.values},e.prototype.sliceInner=function(i,a){return i==0&&a==this.length?this:new e(this.values.slice(i,a))},e.prototype.getInner=function(i){return this.values[i]},e.prototype.forEachInner=function(i,a,s,o){for(var l=a;l<s;l++)if(i(this.values[l],o+l)===!1)return!1},e.prototype.forEachInvertedInner=function(i,a,s,o){for(var l=a-1;l>=s;l--)if(i(this.values[l],o+l)===!1)return!1},e.prototype.leafAppend=function(i){if(this.length+i.length<=p1)return new e(this.values.concat(i.flatten()))},e.prototype.leafPrepend=function(i){if(this.length+i.length<=p1)return new e(i.flatten().concat(this.values))},r.length.get=function(){return this.values.length},r.depth.get=function(){return 0},Object.defineProperties(e.prototype,r),e})(ya);ya.empty=new Z6([]);var _re=(function(t){function e(r,n){t.call(this),this.left=r,this.right=n,this.length=r.length+n.length,this.depth=Math.max(r.depth,n.depth)+1}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},e.prototype.getInner=function(n){return n<this.left.length?this.left.get(n):this.right.get(n-this.left.length)},e.prototype.forEachInner=function(n,i,a,s){var o=this.left.length;if(i<o&&this.left.forEachInner(n,i,Math.min(a,o),s)===!1||a>o&&this.right.forEachInner(n,Math.max(i-o,0),Math.min(this.length,a)-o,s+o)===!1)return!1},e.prototype.forEachInvertedInner=function(n,i,a,s){var o=this.left.length;if(i>o&&this.right.forEachInvertedInner(n,i-o,Math.max(a,o)-o,s+o)===!1||a<o&&this.left.forEachInvertedInner(n,Math.min(i,o),a,s)===!1)return!1},e.prototype.sliceInner=function(n,i){if(n==0&&i==this.length)return this;var a=this.left.length;return i<=a?this.left.slice(n,i):n>=a?this.right.slice(n-a,i-a):this.left.slice(n,a).append(this.right.slice(0,i-a))},e.prototype.leafAppend=function(n){var i=this.right.leafAppend(n);if(i)return new e(this.left,i)},e.prototype.leafPrepend=function(n){var i=this.left.leafPrepend(n);if(i)return new e(i,this.right)},e.prototype.appendInner=function(n){return this.left.depth>=Math.max(this.right.depth,n.depth)+1?new e(this.left,new e(this.right,n)):new e(this,n)},e})(ya);const Cre=500;class Ll{constructor(e,r){this.items=e,this.eventCount=r}popEvent(e,r){if(this.eventCount==0)return null;let n=this.items.length;for(;;n--)if(this.items.get(n-1).selection){--n;break}let i,a;r&&(i=this.remapping(n,this.items.length),a=i.maps.length);let s=e.tr,o,l,u=[],c=[];return this.items.forEach((f,p)=>{if(!f.step){i||(i=this.remapping(n,p+1),a=i.maps.length),a--,c.push(f);return}if(i){c.push(new wu(f.map));let v=f.step.map(i.slice(a)),y;v&&s.maybeStep(v).doc&&(y=s.mapping.maps[s.mapping.maps.length-1],u.push(new wu(y,void 0,void 0,u.length+c.length))),a--,y&&i.appendMap(y,a)}else s.maybeStep(f.step);if(f.selection)return o=i?f.selection.map(i.slice(a)):f.selection,l=new Ll(this.items.slice(0,n).append(c.reverse().concat(u)),this.eventCount-1),!1},this.items.length,0),{remaining:l,transform:s,selection:o}}addTransform(e,r,n,i){let a=[],s=this.eventCount,o=this.items,l=!i&&o.length?o.get(o.length-1):null;for(let c=0;c<e.steps.length;c++){let f=e.steps[c].invert(e.docs[c]),p=new wu(e.mapping.maps[c],f,r),v;(v=l&&l.merge(p))&&(p=v,c?a.pop():o=o.slice(0,o.length-1)),a.push(p),r&&(s++,r=void 0),i||(l=p)}let u=s-n.depth;return u>Tre&&(o=Ere(o,u),s-=u),new Ll(o.append(a),s)}remapping(e,r){let n=new Dv;return this.items.forEach((i,a)=>{let s=i.mirrorOffset!=null&&a-i.mirrorOffset>=e?n.maps.length-i.mirrorOffset:void 0;n.appendMap(i.map,s)},e,r),n}addMaps(e){return this.eventCount==0?this:new Ll(this.items.append(e.map(r=>new wu(r))),this.eventCount)}rebased(e,r){if(!this.eventCount)return this;let n=[],i=Math.max(0,this.items.length-r),a=e.mapping,s=e.steps.length,o=this.eventCount;this.items.forEach(p=>{p.selection&&o--},i);let l=r;this.items.forEach(p=>{let v=a.getMirror(--l);if(v==null)return;s=Math.min(s,v);let y=a.maps[v];if(p.step){let S=e.steps[v].invert(e.docs[v]),w=p.selection&&p.selection.map(a.slice(l+1,v));w&&o++,n.push(new wu(y,S,w))}else n.push(new wu(y))},i);let u=[];for(let p=r;p<s;p++)u.push(new wu(a.maps[p]));let c=this.items.slice(0,i).append(u).append(n),f=new Ll(c,o);return f.emptyItemCount()>Cre&&(f=f.compress(this.items.length-n.length)),f}emptyItemCount(){let e=0;return this.items.forEach(r=>{r.step||e++}),e}compress(e=this.items.length){let r=this.remapping(0,e),n=r.maps.length,i=[],a=0;return this.items.forEach((s,o)=>{if(o>=e)i.push(s),s.selection&&a++;else if(s.step){let l=s.step.map(r.slice(n)),u=l&&l.getMap();if(n--,u&&r.appendMap(u,n),l){let c=s.selection&&s.selection.map(r.slice(n));c&&a++;let f=new wu(u.invert(),l,c),p,v=i.length-1;(p=i.length&&i[v].merge(f))?i[v]=p:i.push(f)}}else s.map&&n--},this.items.length,0),new Ll(ya.from(i.reverse()),a)}}Ll.empty=new Ll(ya.empty,0);function Ere(t,e){let r;return t.forEach((n,i)=>{if(n.selection&&e--==0)return r=i,!1}),t.slice(r)}class wu{constructor(e,r,n,i){this.map=e,this.step=r,this.selection=n,this.mirrorOffset=i}merge(e){if(this.step&&e.step&&!e.selection){let r=e.step.merge(this.step);if(r)return new wu(r.getMap().invert(),r,this.selection)}}}class Pd{constructor(e,r,n,i,a){this.done=e,this.undone=r,this.prevRanges=n,this.prevTime=i,this.prevComposition=a}}const Tre=20;function Nre(t,e,r,n){let i=r.getMeta(dh),a;if(i)return i.historyState;r.getMeta(Are)&&(t=new Pd(t.done,t.undone,null,0,-1));let s=r.getMeta("appendedTransaction");if(r.steps.length==0)return t;if(s&&s.getMeta(dh))return s.getMeta(dh).redo?new Pd(t.done.addTransform(r,void 0,n,Qy(e)),t.undone,IP(r.mapping.maps),t.prevTime,t.prevComposition):new Pd(t.done,t.undone.addTransform(r,void 0,n,Qy(e)),null,t.prevTime,t.prevComposition);if(r.getMeta("addToHistory")!==!1&&!(s&&s.getMeta("addToHistory")===!1)){let o=r.getMeta("composition"),l=t.prevTime==0||!s&&t.prevComposition!=o&&(t.prevTime<(r.time||0)-n.newGroupDelay||!Pre(r,t.prevRanges)),u=s?SS(t.prevRanges,r.mapping):IP(r.mapping.maps);return new Pd(t.done.addTransform(r,l?e.selection.getBookmark():void 0,n,Qy(e)),Ll.empty,u,r.time,o??t.prevComposition)}else return(a=r.getMeta("rebased"))?new Pd(t.done.rebased(r,a),t.undone.rebased(r,a),SS(t.prevRanges,r.mapping),t.prevTime,t.prevComposition):new Pd(t.done.addMaps(r.mapping.maps),t.undone.addMaps(r.mapping.maps),SS(t.prevRanges,r.mapping),t.prevTime,t.prevComposition)}function Pre(t,e){if(!e)return!1;if(!t.docChanged)return!0;let r=!1;return t.mapping.maps[0].forEach((n,i)=>{for(let a=0;a<e.length;a+=2)n<=e[a+1]&&i>=e[a]&&(r=!0)}),r}function IP(t){let e=[];for(let r=t.length-1;r>=0&&e.length==0;r--)t[r].forEach((n,i,a,s)=>e.push(a,s));return e}function SS(t,e){if(!t)return null;let r=[];for(let n=0;n<t.length;n+=2){let i=e.map(t[n],1),a=e.map(t[n+1],-1);i<=a&&r.push(i,a)}return r}function Mre(t,e,r){let n=Qy(e),i=dh.get(e).spec.config,a=(r?t.undone:t.done).popEvent(e,n);if(!a)return null;let s=a.selection.resolve(a.transform.doc),o=(r?t.done:t.undone).addTransform(a.transform,e.selection.getBookmark(),i,n),l=new Pd(r?o:a.remaining,r?a.remaining:o,null,0,-1);return a.transform.setSelection(s).setMeta(dh,{redo:r,historyState:l})}let kS=!1,jP=null;function Qy(t){let e=t.plugins;if(jP!=e){kS=!1,jP=e;for(let r=0;r<e.length;r++)if(e[r].spec.historyPreserveItems){kS=!0;break}}return kS}const dh=new Ti("history"),Are=new Ti("closeHistory");function Rre(t={}){return t={depth:t.depth||100,newGroupDelay:t.newGroupDelay||500},new Yn({key:dh,state:{init(){return new Pd(Ll.empty,Ll.empty,null,0,-1)},apply(e,r,n){return Nre(r,n,e,t)}},config:t,props:{handleDOMEvents:{beforeinput(e,r){let n=r.inputType,i=n=="historyUndo"?X6:n=="historyRedo"?Q6:null;return!i||!e.editable?!1:(r.preventDefault(),i(e.state,e.dispatch))}}}})}function Y6(t,e){return(r,n)=>{let i=dh.getState(r);if(!i||(t?i.undone:i.done).eventCount==0)return!1;if(n){let a=Mre(i,r,t);a&&n(e?a.scrollIntoView():a)}return!0}}const X6=Y6(!1,!0),Q6=Y6(!0,!0);Ni.create({name:"characterCount",addOptions(){return{limit:null,mode:"textSize",textCounter:t=>t.length,wordCounter:t=>t.split(" ").filter(e=>e!=="").length}},addStorage(){return{characters:()=>0,words:()=>0}},onBeforeCreate(){this.storage.characters=t=>{const e=t?.node||this.editor.state.doc;if((t?.mode||this.options.mode)==="textSize"){const n=e.textBetween(0,e.content.size,void 0," ");return this.options.textCounter(n)}return e.nodeSize},this.storage.words=t=>{const e=t?.node||this.editor.state.doc,r=e.textBetween(0,e.content.size," "," ");return this.options.wordCounter(r)}},addProseMirrorPlugins(){let t=!1;return[new Yn({key:new Ti("characterCount"),appendTransaction:(e,r,n)=>{if(t)return;const i=this.options.limit;if(i==null||i===0){t=!0;return}const a=this.storage.characters({node:n.doc});if(a>i){const s=a-i,o=0,l=s;console.warn(`[CharacterCount] Initial content exceeded limit of ${i} characters. Content was automatically trimmed.`);const u=n.tr.deleteRange(o,l);return t=!0,u}t=!0},filterTransaction:(e,r)=>{const n=this.options.limit;if(!e.docChanged||n===0||n===null||n===void 0)return!0;const i=this.storage.characters({node:r.doc}),a=this.storage.characters({node:e.doc});if(a<=n||i>n&&a>n&&a<=i)return!0;if(i>n&&a>n&&a>i||!e.getMeta("paste"))return!1;const o=e.selection.$head.pos,l=a-n,u=o-l,c=o;return e.deleteRange(u,c),!(this.storage.characters({node:e.doc})>n)}})]}});var Lre=Ni.create({name:"dropCursor",addOptions(){return{color:"currentColor",width:1,class:void 0}},addProseMirrorPlugins(){return[mre(this.options)]}});Ni.create({name:"focus",addOptions(){return{className:"has-focus",mode:"all"}},addProseMirrorPlugins(){return[new Yn({key:new Ti("focus"),props:{decorations:({doc:t,selection:e})=>{const{isEditable:r,isFocused:n}=this.editor,{anchor:i}=e,a=[];if(!r||!n)return $n.create(t,[]);let s=0;this.options.mode==="deepest"&&t.descendants((l,u)=>{if(l.isText)return;if(!(i>=u&&i<=u+l.nodeSize-1))return!1;s+=1});let o=0;return t.descendants((l,u)=>{if(l.isText||!(i>=u&&i<=u+l.nodeSize-1))return!1;if(o+=1,this.options.mode==="deepest"&&s-o>0||this.options.mode==="shallowest"&&o>1)return this.options.mode==="deepest";a.push(as.node(u,u+l.nodeSize,{class:this.options.className}))}),$n.create(t,a)}}})]}});var Ore=Ni.create({name:"gapCursor",addProseMirrorPlugins(){return[xre()]},extendNodeSchema(t){var e;const r={name:t.name,options:t.options,storage:t.storage};return{allowGapCursor:(e=dn($t(t,"allowGapCursor",r)))!=null?e:null}}}),Dre=Ni.create({name:"placeholder",addOptions(){return{emptyEditorClass:"is-editor-empty",emptyNodeClass:"is-empty",placeholder:"Write something ",showOnlyWhenEditable:!0,showOnlyCurrent:!0,includeChildren:!1}},addProseMirrorPlugins(){return[new Yn({key:new Ti("placeholder"),props:{decorations:({doc:t,selection:e})=>{const r=this.editor.isEditable||!this.options.showOnlyWhenEditable,{anchor:n}=e,i=[];if(!r)return null;const a=this.editor.isEmpty;return t.descendants((s,o)=>{const l=n>=o&&n<=o+s.nodeSize,u=!s.isLeaf&&rb(s);if((l||!this.options.showOnlyCurrent)&&u){const c=[this.options.emptyNodeClass];a&&c.push(this.options.emptyEditorClass);const f=as.node(o,o+s.nodeSize,{class:c.join(" "),"data-placeholder":typeof this.options.placeholder=="function"?this.options.placeholder({editor:this.editor,node:s,pos:o,hasAnchor:l}):this.options.placeholder});i.push(f)}return this.options.includeChildren}),$n.create(t,i)}}})]}});Ni.create({name:"selection",addOptions(){return{className:"selection"}},addProseMirrorPlugins(){const{editor:t,options:e}=this;return[new Yn({key:new Ti("selection"),props:{decorations(r){return r.selection.empty||t.isFocused||!t.isEditable||l6(r.selection)||t.view.dragging?null:$n.create(r.doc,[as.inline(r.selection.from,r.selection.to,{class:e.className})])}}})]}});function FP({types:t,node:e}){return e&&Array.isArray(t)&&t.includes(e.type)||e?.type===t}var Ire=Ni.create({name:"trailingNode",addOptions(){return{node:void 0,notAfter:[]}},addProseMirrorPlugins(){var t;const e=new Ti(this.name),r=this.options.node||((t=this.editor.schema.topNodeType.contentMatch.defaultType)==null?void 0:t.name)||"paragraph",n=Object.entries(this.editor.schema.nodes).map(([,i])=>i).filter(i=>(this.options.notAfter||[]).concat(r).includes(i.name));return[new Yn({key:e,appendTransaction:(i,a,s)=>{const{doc:o,tr:l,schema:u}=s,c=e.getState(s),f=o.content.size,p=u.nodes[r];if(c)return l.insert(f,p.create())},state:{init:(i,a)=>{const s=a.tr.doc.lastChild;return!FP({node:s,types:n})},apply:(i,a)=>{if(!i.docChanged||i.getMeta("__uniqueIDTransaction"))return a;const s=i.doc.lastChild;return!FP({node:s,types:n})}}})]}}),jre=Ni.create({name:"undoRedo",addOptions(){return{depth:100,newGroupDelay:500}},addCommands(){return{undo:()=>({state:t,dispatch:e})=>X6(t,e),redo:()=>({state:t,dispatch:e})=>Q6(t,e)}},addProseMirrorPlugins(){return[Rre(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-y":()=>this.editor.commands.redo(),"Mod-":()=>this.editor.commands.undo(),"Shift-Mod-":()=>this.editor.commands.redo()}}}),Fre=Ni.create({name:"starterKit",addExtensions(){var t,e,r,n;const i=[];return this.options.bold!==!1&&i.push(cte.configure(this.options.bold)),this.options.blockquote!==!1&&i.push(ate.configure(this.options.blockquote)),this.options.bulletList!==!1&&i.push(F6.configure(this.options.bulletList)),this.options.code!==!1&&i.push(hte.configure(this.options.code)),this.options.codeBlock!==!1&&i.push(gte.configure(this.options.codeBlock)),this.options.document!==!1&&i.push(vte.configure(this.options.document)),this.options.dropcursor!==!1&&i.push(Lre.configure(this.options.dropcursor)),this.options.gapcursor!==!1&&i.push(Ore.configure(this.options.gapcursor)),this.options.hardBreak!==!1&&i.push(yte.configure(this.options.hardBreak)),this.options.heading!==!1&&i.push(xte.configure(this.options.heading)),this.options.undoRedo!==!1&&i.push(jre.configure(this.options.undoRedo)),this.options.horizontalRule!==!1&&i.push(bte.configure(this.options.horizontalRule)),this.options.italic!==!1&&i.push(Cte.configure(this.options.italic)),this.options.listItem!==!1&&i.push(B6.configure(this.options.listItem)),this.options.listKeymap!==!1&&i.push(W6.configure((t=this.options)==null?void 0:t.listKeymap)),this.options.link!==!1&&i.push(Yte.configure((e=this.options)==null?void 0:e.link)),this.options.orderedList!==!1&&i.push($6.configure(this.options.orderedList)),this.options.paragraph!==!1&&i.push(ure.configure(this.options.paragraph)),this.options.strike!==!1&&i.push(fre.configure(this.options.strike)),this.options.text!==!1&&i.push(hre.configure(this.options.text)),this.options.underline!==!1&&i.push(pre.configure((r=this.options)==null?void 0:r.underline)),this.options.trailingNode!==!1&&i.push(Ire.configure((n=this.options)==null?void 0:n.trailingNode)),i}}),Bre=Fre,zre=Dre;function Ure(t){var e;const{char:r,allowSpaces:n,allowToIncludeChar:i,allowedPrefixes:a,startOfLine:s,$position:o}=t,l=n&&!i,u=VJ(r),c=new RegExp(`\\s${u}$`),f=s?"^":"",p=i?"":u,v=l?new RegExp(`${f}${u}.*?(?=\\s${p}|$)`,"gm"):new RegExp(`${f}(?:^)?${u}[^\\s${p}]*`,"gm"),y=((e=o.nodeBefore)==null?void 0:e.isText)&&o.nodeBefore.text;if(!y)return null;const S=o.pos-y.length,w=Array.from(y.matchAll(v)).pop();if(!w||w.input===void 0||w.index===void 0)return null;const E=w.input.slice(Math.max(0,w.index-1),w.index),_=new RegExp(`^[${a?.join("")}\0]?$`).test(E);if(a!==null&&!_)return null;const T=S+w.index;let N=T+w[0].length;return l&&c.test(y.slice(N-1,N+1))&&(w[0]+=" ",N+=1),T<o.pos&&N>=o.pos?{range:{from:T,to:N},query:w[0].slice(r.length),text:w[0]}:null}var Gre=new Ti("suggestion");function Vre({pluginKey:t=Gre,editor:e,char:r="@",allowSpaces:n=!1,allowToIncludeChar:i=!1,allowedPrefixes:a=[" "],startOfLine:s=!1,decorationTag:o="span",decorationClass:l="suggestion",decorationContent:u="",decorationEmptyClass:c="is-empty",command:f=()=>null,items:p=()=>[],render:v=()=>({}),allow:y=()=>!0,findSuggestionMatch:S=Ure,shouldShow:w}){let E;const _=v?.(),T=()=>{const F=e.state.selection.$anchor.pos,D=e.view.coordsAtPos(F),{top:j,right:B,bottom:G,left:K}=D;try{return new DOMRect(K,j,B-K,G-j)}catch{return null}},N=(F,D)=>D?()=>{const j=t.getState(e.state),B=j?.decorationId,G=F.dom.querySelector(`[data-decoration-id="${B}"]`);return G?.getBoundingClientRect()||null}:T;function R(F,D){var j;try{const G=t.getState(F.state),K=G?.decorationId?F.dom.querySelector(`[data-decoration-id="${G.decorationId}"]`):null,O={editor:e,range:G?.range||{from:0,to:0},query:G?.query||null,text:G?.text||null,items:[],command:W=>f({editor:e,range:G?.range||{from:0,to:0},props:W}),decorationNode:K,clientRect:N(F,K)};(j=_?.onExit)==null||j.call(_,O)}catch{}const B=F.state.tr.setMeta(D,{exit:!0});F.dispatch(B)}const I=new Yn({key:t,view(){return{update:async(F,D)=>{var j,B,G,K,O,W,U;const q=(j=this.key)==null?void 0:j.getState(D),Z=(B=this.key)==null?void 0:B.getState(F.state),Q=q.active&&Z.active&&q.range.from!==Z.range.from,ne=!q.active&&Z.active,re=q.active&&!Z.active,Y=!ne&&!re&&q.query!==Z.query,J=ne||Q&&Y,ie=Y||Q,de=re||Q&&Y;if(!J&&!ie&&!de)return;const he=de&&!J?q:Z,xe=F.dom.querySelector(`[data-decoration-id="${he.decorationId}"]`);E={editor:e,range:he.range,query:he.query,text:he.text,items:[],command:le=>f({editor:e,range:he.range,props:le}),decorationNode:xe,clientRect:N(F,xe)},J&&((G=_?.onBeforeStart)==null||G.call(_,E)),ie&&((K=_?.onBeforeUpdate)==null||K.call(_,E)),(ie||J)&&(E.items=await p({editor:e,query:he.query})),de&&((O=_?.onExit)==null||O.call(_,E)),ie&&((W=_?.onUpdate)==null||W.call(_,E)),J&&((U=_?.onStart)==null||U.call(_,E))},destroy:()=>{var F;E&&((F=_?.onExit)==null||F.call(_,E))}}},state:{init(){return{active:!1,range:{from:0,to:0},query:null,text:null,composing:!1}},apply(F,D,j,B){const{isEditable:G}=e,{composing:K}=e.view,{selection:O}=F,{empty:W,from:U}=O,q={...D},Z=F.getMeta(t);if(Z&&Z.exit)return q.active=!1,q.decorationId=null,q.range={from:0,to:0},q.query=null,q.text=null,q;if(q.composing=K,G&&(W||e.view.composing)){(U<D.range.from||U>D.range.to)&&!K&&!D.composing&&(q.active=!1);const Q=S({char:r,allowSpaces:n,allowToIncludeChar:i,allowedPrefixes:a,startOfLine:s,$position:O.$from}),ne=`id_${Math.floor(Math.random()*4294967295)}`;Q&&y({editor:e,state:B,range:Q.range,isActive:D.active})&&(!w||w({editor:e,range:Q.range,query:Q.query,text:Q.text,transaction:F}))?(q.active=!0,q.decorationId=D.decorationId?D.decorationId:ne,q.range=Q.range,q.query=Q.query,q.text=Q.text):q.active=!1}else q.active=!1;return q.active||(q.decorationId=null,q.range={from:0,to:0},q.query=null,q.text=null),q}},props:{handleKeyDown(F,D){var j,B,G,K;const{active:O,range:W}=I.getState(F.state);if(!O)return!1;if(D.key==="Escape"||D.key==="Esc"){const q=I.getState(F.state),Z=(j=E?.decorationNode)!=null?j:null,Q=Z??(q?.decorationId?F.dom.querySelector(`[data-decoration-id="${q.decorationId}"]`):null);if(((B=_?.onKeyDown)==null?void 0:B.call(_,{view:F,event:D,range:q.range}))||!1)return!0;const re={editor:e,range:q.range,query:q.query,text:q.text,items:[],command:Y=>f({editor:e,range:q.range,props:Y}),decorationNode:Q,clientRect:Q?()=>Q.getBoundingClientRect()||null:null};return(G=_?.onExit)==null||G.call(_,re),R(F,t),!0}return((K=_?.onKeyDown)==null?void 0:K.call(_,{view:F,event:D,range:W}))||!1},decorations(F){const{active:D,range:j,decorationId:B,query:G}=I.getState(F);if(!D)return null;const K=!G?.length,O=[l];return K&&O.push(c),$n.create(F.doc,[as.inline(j.from,j.to,{nodeName:o,class:O.join(" "),"data-decoration-id":B,"data-decoration-content":u})])}}});return I}function Hre({editor:t,overrideSuggestionOptions:e,extensionName:r,char:n="@"}){const i=new Ti;return{editor:t,char:n,pluginKey:i,command:({editor:a,range:s,props:o})=>{var l,u,c;const f=a.view.state.selection.$to.nodeAfter;(l=f?.text)!=null&&l.startsWith(" ")&&(s.to+=1),a.chain().focus().insertContentAt(s,[{type:r,attrs:{...o,mentionSuggestionChar:n}},{type:"text",text:" "}]).run(),(c=(u=a.view.dom.ownerDocument.defaultView)==null?void 0:u.getSelection())==null||c.collapseToEnd()},allow:({state:a,range:s})=>{const o=a.doc.resolve(s.from),l=a.schema.nodes[r];return!!o.parent.type.contentMatch.matchType(l)},...e}}function J6(t){return(t.options.suggestions.length?t.options.suggestions:[t.options.suggestion]).map(e=>Hre({editor:t.editor,overrideSuggestionOptions:e,extensionName:t.name,char:e.char}))}function BP(t,e){const r=J6(t),n=r.find(i=>i.char===e);return n||(r.length?r[0]:null)}var Wre=eo.create({name:"mention",priority:101,addOptions(){return{HTMLAttributes:{},renderText({node:t,suggestion:e}){var r,n;return`${(r=e?.char)!=null?r:"@"}${(n=t.attrs.label)!=null?n:t.attrs.id}`},deleteTriggerWithBackspace:!1,renderHTML({options:t,node:e,suggestion:r}){var n,i;return["span",Zn(this.HTMLAttributes,t.HTMLAttributes),`${(n=r?.char)!=null?n:"@"}${(i=e.attrs.label)!=null?i:e.attrs.id}`]},suggestions:[],suggestion:{}}},group:"inline",inline:!0,selectable:!1,atom:!0,addAttributes(){return{id:{default:null,parseHTML:t=>t.getAttribute("data-id"),renderHTML:t=>t.id?{"data-id":t.id}:{}},label:{default:null,parseHTML:t=>t.getAttribute("data-label"),renderHTML:t=>t.label?{"data-label":t.label}:{}},mentionSuggestionChar:{default:"@",parseHTML:t=>t.getAttribute("data-mention-suggestion-char"),renderHTML:t=>({"data-mention-suggestion-char":t.mentionSuggestionChar})}}},parseHTML(){return[{tag:`span[data-type="${this.name}"]`}]},renderHTML({node:t,HTMLAttributes:e}){const r=BP(this,t.attrs.mentionSuggestionChar);if(this.options.renderLabel!==void 0)return console.warn("renderLabel is deprecated use renderText and renderHTML instead"),["span",Zn({"data-type":this.name},this.options.HTMLAttributes,e),this.options.renderLabel({options:this.options,node:t,suggestion:r})];const n={...this.options};n.HTMLAttributes=Zn({"data-type":this.name},this.options.HTMLAttributes,e);const i=this.options.renderHTML({options:n,node:t,suggestion:r});return typeof i=="string"?["span",Zn({"data-type":this.name},this.options.HTMLAttributes,e),i]:i},...C6({nodeName:"mention",name:"@",selfClosing:!0,allowedAttributes:["id","label",{name:"mentionSuggestionChar",skipIfDefault:"@"}],parseAttributes:t=>{const e={},r=/(\w+)=(?:"([^"]*)"|'([^']*)')/g;let n=r.exec(t);for(;n!==null;){const[,i,a,s]=n,o=a??s;e[i==="char"?"mentionSuggestionChar":i]=o,n=r.exec(t)}return e},serializeAttributes:t=>Object.entries(t).filter(([,e])=>e!=null).map(([e,r])=>`${e==="mentionSuggestionChar"?"char":e}="${r}"`).join(" ")}),renderText({node:t}){const e={options:this.options,node:t,suggestion:BP(this,t.attrs.mentionSuggestionChar)};return this.options.renderLabel!==void 0?(console.warn("renderLabel is deprecated use renderText and renderHTML instead"),this.options.renderLabel(e)):this.options.renderText(e)},addKeyboardShortcuts(){return{Backspace:()=>this.editor.commands.command(({tr:t,state:e})=>{let r=!1;const{selection:n}=e,{empty:i,anchor:a}=n;if(!i)return!1;let s=new Xo,o=0;return e.doc.nodesBetween(a-1,a,(l,u)=>{if(l.type.name===this.name)return r=!0,s=l,o=u,!1}),r&&t.insertText(this.options.deleteTriggerWithBackspace?"":s.attrs.mentionSuggestionChar,o,o+s.nodeSize),r})}},addProseMirrorPlugins(){return J6(this).map(Vre)}}),qre=Wre,Qs="top",tl="bottom",rl="right",Js="left",bC="auto",p0=[Qs,tl,rl,Js],rm="start",Hv="end",$re="clippingParents",eD="viewport",Gg="popper",Kre="reference",zP=p0.reduce(function(t,e){return t.concat([e+"-"+rm,e+"-"+Hv])},[]),tD=[].concat(p0,[bC]).reduce(function(t,e){return t.concat([e,e+"-"+rm,e+"-"+Hv])},[]),Zre="beforeRead",Yre="read",Xre="afterRead",Qre="beforeMain",Jre="main",ene="afterMain",tne="beforeWrite",rne="write",nne="afterWrite",ine=[Zre,Yre,Xre,Qre,Jre,ene,tne,rne,nne];function Mu(t){return t?(t.nodeName||"").toLowerCase():null}function yo(t){if(t==null)return window;if(t.toString()!=="[object Window]"){var e=t.ownerDocument;return e&&e.defaultView||window}return t}function Eh(t){var e=yo(t).Element;return t instanceof e||t instanceof Element}function el(t){var e=yo(t).HTMLElement;return t instanceof e||t instanceof HTMLElement}function wC(t){if(typeof ShadowRoot>"u")return!1;var e=yo(t).ShadowRoot;return t instanceof e||t instanceof ShadowRoot}function ane(t){var e=t.state;Object.keys(e.elements).forEach(function(r){var n=e.styles[r]||{},i=e.attributes[r]||{},a=e.elements[r];!el(a)||!Mu(a)||(Object.assign(a.style,n),Object.keys(i).forEach(function(s){var o=i[s];o===!1?a.removeAttribute(s):a.setAttribute(s,o===!0?"":o)}))})}function sne(t){var e=t.state,r={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,r.popper),e.styles=r,e.elements.arrow&&Object.assign(e.elements.arrow.style,r.arrow),function(){Object.keys(e.elements).forEach(function(n){var i=e.elements[n],a=e.attributes[n]||{},s=Object.keys(e.styles.hasOwnProperty(n)?e.styles[n]:r[n]),o=s.reduce(function(l,u){return l[u]="",l},{});!el(i)||!Mu(i)||(Object.assign(i.style,o),Object.keys(a).forEach(function(l){i.removeAttribute(l)}))})}}const rD={name:"applyStyles",enabled:!0,phase:"write",fn:ane,effect:sne,requires:["computeStyles"]};function Eu(t){return t.split("-")[0]}var fh=Math.max,m1=Math.min,nm=Math.round;function Bk(){var t=navigator.userAgentData;return t!=null&&t.brands&&Array.isArray(t.brands)?t.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function nD(){return!/^((?!chrome|android).)*safari/i.test(Bk())}function im(t,e,r){e===void 0&&(e=!1),r===void 0&&(r=!1);var n=t.getBoundingClientRect(),i=1,a=1;e&&el(t)&&(i=t.offsetWidth>0&&nm(n.width)/t.offsetWidth||1,a=t.offsetHeight>0&&nm(n.height)/t.offsetHeight||1);var s=Eh(t)?yo(t):window,o=s.visualViewport,l=!nD()&&r,u=(n.left+(l&&o?o.offsetLeft:0))/i,c=(n.top+(l&&o?o.offsetTop:0))/a,f=n.width/i,p=n.height/a;return{width:f,height:p,top:c,right:u+f,bottom:c+p,left:u,x:u,y:c}}function SC(t){var e=im(t),r=t.offsetWidth,n=t.offsetHeight;return Math.abs(e.width-r)<=1&&(r=e.width),Math.abs(e.height-n)<=1&&(n=e.height),{x:t.offsetLeft,y:t.offsetTop,width:r,height:n}}function iD(t,e){var r=e.getRootNode&&e.getRootNode();if(t.contains(e))return!0;if(r&&wC(r)){var n=e;do{if(n&&t.isSameNode(n))return!0;n=n.parentNode||n.host}while(n)}return!1}function xc(t){return yo(t).getComputedStyle(t)}function one(t){return["table","td","th"].indexOf(Mu(t))>=0}function gf(t){return((Eh(t)?t.ownerDocument:t.document)||window.document).documentElement}function sb(t){return Mu(t)==="html"?t:t.assignedSlot||t.parentNode||(wC(t)?t.host:null)||gf(t)}function UP(t){return!el(t)||xc(t).position==="fixed"?null:t.offsetParent}function lne(t){var e=/firefox/i.test(Bk()),r=/Trident/i.test(Bk());if(r&&el(t)){var n=xc(t);if(n.position==="fixed")return null}var i=sb(t);for(wC(i)&&(i=i.host);el(i)&&["html","body"].indexOf(Mu(i))<0;){var a=xc(i);if(a.transform!=="none"||a.perspective!=="none"||a.contain==="paint"||["transform","perspective"].indexOf(a.willChange)!==-1||e&&a.willChange==="filter"||e&&a.filter&&a.filter!=="none")return i;i=i.parentNode}return null}function m0(t){for(var e=yo(t),r=UP(t);r&&one(r)&&xc(r).position==="static";)r=UP(r);return r&&(Mu(r)==="html"||Mu(r)==="body"&&xc(r).position==="static")?e:r||lne(t)||e}function kC(t){return["top","bottom"].indexOf(t)>=0?"x":"y"}function pv(t,e,r){return fh(t,m1(e,r))}function une(t,e,r){var n=pv(t,e,r);return n>r?r:n}function aD(){return{top:0,right:0,bottom:0,left:0}}function sD(t){return Object.assign({},aD(),t)}function oD(t,e){return e.reduce(function(r,n){return r[n]=t,r},{})}var cne=function(e,r){return e=typeof e=="function"?e(Object.assign({},r.rects,{placement:r.placement})):e,sD(typeof e!="number"?e:oD(e,p0))};function dne(t){var e,r=t.state,n=t.name,i=t.options,a=r.elements.arrow,s=r.modifiersData.popperOffsets,o=Eu(r.placement),l=kC(o),u=[Js,rl].indexOf(o)>=0,c=u?"height":"width";if(!(!a||!s)){var f=cne(i.padding,r),p=SC(a),v=l==="y"?Qs:Js,y=l==="y"?tl:rl,S=r.rects.reference[c]+r.rects.reference[l]-s[l]-r.rects.popper[c],w=s[l]-r.rects.reference[l],E=m0(a),_=E?l==="y"?E.clientHeight||0:E.clientWidth||0:0,T=S/2-w/2,N=f[v],R=_-p[c]-f[y],I=_/2-p[c]/2+T,F=pv(N,I,R),D=l;r.modifiersData[n]=(e={},e[D]=F,e.centerOffset=F-I,e)}}function fne(t){var e=t.state,r=t.options,n=r.element,i=n===void 0?"[data-popper-arrow]":n;i!=null&&(typeof i=="string"&&(i=e.elements.popper.querySelector(i),!i)||iD(e.elements.popper,i)&&(e.elements.arrow=i))}const hne={name:"arrow",enabled:!0,phase:"main",fn:dne,effect:fne,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function am(t){return t.split("-")[1]}var pne={top:"auto",right:"auto",bottom:"auto",left:"auto"};function mne(t,e){var r=t.x,n=t.y,i=e.devicePixelRatio||1;return{x:nm(r*i)/i||0,y:nm(n*i)/i||0}}function GP(t){var e,r=t.popper,n=t.popperRect,i=t.placement,a=t.variation,s=t.offsets,o=t.position,l=t.gpuAcceleration,u=t.adaptive,c=t.roundOffsets,f=t.isFixed,p=s.x,v=p===void 0?0:p,y=s.y,S=y===void 0?0:y,w=typeof c=="function"?c({x:v,y:S}):{x:v,y:S};v=w.x,S=w.y;var E=s.hasOwnProperty("x"),_=s.hasOwnProperty("y"),T=Js,N=Qs,R=window;if(u){var I=m0(r),F="clientHeight",D="clientWidth";if(I===yo(r)&&(I=gf(r),xc(I).position!=="static"&&o==="absolute"&&(F="scrollHeight",D="scrollWidth")),I=I,i===Qs||(i===Js||i===rl)&&a===Hv){N=tl;var j=f&&I===R&&R.visualViewport?R.visualViewport.height:I[F];S-=j-n.height,S*=l?1:-1}if(i===Js||(i===Qs||i===tl)&&a===Hv){T=rl;var B=f&&I===R&&R.visualViewport?R.visualViewport.width:I[D];v-=B-n.width,v*=l?1:-1}}var G=Object.assign({position:o},u&&pne),K=c===!0?mne({x:v,y:S},yo(r)):{x:v,y:S};if(v=K.x,S=K.y,l){var O;return Object.assign({},G,(O={},O[N]=_?"0":"",O[T]=E?"0":"",O.transform=(R.devicePixelRatio||1)<=1?"translate("+v+"px, "+S+"px)":"translate3d("+v+"px, "+S+"px, 0)",O))}return Object.assign({},G,(e={},e[N]=_?S+"px":"",e[T]=E?v+"px":"",e.transform="",e))}function gne(t){var e=t.state,r=t.options,n=r.gpuAcceleration,i=n===void 0?!0:n,a=r.adaptive,s=a===void 0?!0:a,o=r.roundOffsets,l=o===void 0?!0:o,u={placement:Eu(e.placement),variation:am(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:i,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,GP(Object.assign({},u,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:s,roundOffsets:l})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,GP(Object.assign({},u,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:l})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}const vne={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:gne,data:{}};var Ry={passive:!0};function yne(t){var e=t.state,r=t.instance,n=t.options,i=n.scroll,a=i===void 0?!0:i,s=n.resize,o=s===void 0?!0:s,l=yo(e.elements.popper),u=[].concat(e.scrollParents.reference,e.scrollParents.popper);return a&&u.forEach(function(c){c.addEventListener("scroll",r.update,Ry)}),o&&l.addEventListener("resize",r.update,Ry),function(){a&&u.forEach(function(c){c.removeEventListener("scroll",r.update,Ry)}),o&&l.removeEventListener("resize",r.update,Ry)}}const xne={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:yne,data:{}};var bne={left:"right",right:"left",bottom:"top",top:"bottom"};function Jy(t){return t.replace(/left|right|bottom|top/g,function(e){return bne[e]})}var wne={start:"end",end:"start"};function VP(t){return t.replace(/start|end/g,function(e){return wne[e]})}function _C(t){var e=yo(t),r=e.pageXOffset,n=e.pageYOffset;return{scrollLeft:r,scrollTop:n}}function CC(t){return im(gf(t)).left+_C(t).scrollLeft}function Sne(t,e){var r=yo(t),n=gf(t),i=r.visualViewport,a=n.clientWidth,s=n.clientHeight,o=0,l=0;if(i){a=i.width,s=i.height;var u=nD();(u||!u&&e==="fixed")&&(o=i.offsetLeft,l=i.offsetTop)}return{width:a,height:s,x:o+CC(t),y:l}}function kne(t){var e,r=gf(t),n=_C(t),i=(e=t.ownerDocument)==null?void 0:e.body,a=fh(r.scrollWidth,r.clientWidth,i?i.scrollWidth:0,i?i.clientWidth:0),s=fh(r.scrollHeight,r.clientHeight,i?i.scrollHeight:0,i?i.clientHeight:0),o=-n.scrollLeft+CC(t),l=-n.scrollTop;return xc(i||r).direction==="rtl"&&(o+=fh(r.clientWidth,i?i.clientWidth:0)-a),{width:a,height:s,x:o,y:l}}function EC(t){var e=xc(t),r=e.overflow,n=e.overflowX,i=e.overflowY;return/auto|scroll|overlay|hidden/.test(r+i+n)}function lD(t){return["html","body","#document"].indexOf(Mu(t))>=0?t.ownerDocument.body:el(t)&&EC(t)?t:lD(sb(t))}function mv(t,e){var r;e===void 0&&(e=[]);var n=lD(t),i=n===((r=t.ownerDocument)==null?void 0:r.body),a=yo(n),s=i?[a].concat(a.visualViewport||[],EC(n)?n:[]):n,o=e.concat(s);return i?o:o.concat(mv(sb(s)))}function zk(t){return Object.assign({},t,{left:t.x,top:t.y,right:t.x+t.width,bottom:t.y+t.height})}function _ne(t,e){var r=im(t,!1,e==="fixed");return r.top=r.top+t.clientTop,r.left=r.left+t.clientLeft,r.bottom=r.top+t.clientHeight,r.right=r.left+t.clientWidth,r.width=t.clientWidth,r.height=t.clientHeight,r.x=r.left,r.y=r.top,r}function HP(t,e,r){return e===eD?zk(Sne(t,r)):Eh(e)?_ne(e,r):zk(kne(gf(t)))}function Cne(t){var e=mv(sb(t)),r=["absolute","fixed"].indexOf(xc(t).position)>=0,n=r&&el(t)?m0(t):t;return Eh(n)?e.filter(function(i){return Eh(i)&&iD(i,n)&&Mu(i)!=="body"}):[]}function Ene(t,e,r,n){var i=e==="clippingParents"?Cne(t):[].concat(e),a=[].concat(i,[r]),s=a[0],o=a.reduce(function(l,u){var c=HP(t,u,n);return l.top=fh(c.top,l.top),l.right=m1(c.right,l.right),l.bottom=m1(c.bottom,l.bottom),l.left=fh(c.left,l.left),l},HP(t,s,n));return o.width=o.right-o.left,o.height=o.bottom-o.top,o.x=o.left,o.y=o.top,o}function uD(t){var e=t.reference,r=t.element,n=t.placement,i=n?Eu(n):null,a=n?am(n):null,s=e.x+e.width/2-r.width/2,o=e.y+e.height/2-r.height/2,l;switch(i){case Qs:l={x:s,y:e.y-r.height};break;case tl:l={x:s,y:e.y+e.height};break;case rl:l={x:e.x+e.width,y:o};break;case Js:l={x:e.x-r.width,y:o};break;default:l={x:e.x,y:e.y}}var u=i?kC(i):null;if(u!=null){var c=u==="y"?"height":"width";switch(a){case rm:l[u]=l[u]-(e[c]/2-r[c]/2);break;case Hv:l[u]=l[u]+(e[c]/2-r[c]/2);break}}return l}function Wv(t,e){e===void 0&&(e={});var r=e,n=r.placement,i=n===void 0?t.placement:n,a=r.strategy,s=a===void 0?t.strategy:a,o=r.boundary,l=o===void 0?$re:o,u=r.rootBoundary,c=u===void 0?eD:u,f=r.elementContext,p=f===void 0?Gg:f,v=r.altBoundary,y=v===void 0?!1:v,S=r.padding,w=S===void 0?0:S,E=sD(typeof w!="number"?w:oD(w,p0)),_=p===Gg?Kre:Gg,T=t.rects.popper,N=t.elements[y?_:p],R=Ene(Eh(N)?N:N.contextElement||gf(t.elements.popper),l,c,s),I=im(t.elements.reference),F=uD({reference:I,element:T,placement:i}),D=zk(Object.assign({},T,F)),j=p===Gg?D:I,B={top:R.top-j.top+E.top,bottom:j.bottom-R.bottom+E.bottom,left:R.left-j.left+E.left,right:j.right-R.right+E.right},G=t.modifiersData.offset;if(p===Gg&&G){var K=G[i];Object.keys(B).forEach(function(O){var W=[rl,tl].indexOf(O)>=0?1:-1,U=[Qs,tl].indexOf(O)>=0?"y":"x";B[O]+=K[U]*W})}return B}function Tne(t,e){e===void 0&&(e={});var r=e,n=r.placement,i=r.boundary,a=r.rootBoundary,s=r.padding,o=r.flipVariations,l=r.allowedAutoPlacements,u=l===void 0?tD:l,c=am(n),f=c?o?zP:zP.filter(function(y){return am(y)===c}):p0,p=f.filter(function(y){return u.indexOf(y)>=0});p.length===0&&(p=f);var v=p.reduce(function(y,S){return y[S]=Wv(t,{placement:S,boundary:i,rootBoundary:a,padding:s})[Eu(S)],y},{});return Object.keys(v).sort(function(y,S){return v[y]-v[S]})}function Nne(t){if(Eu(t)===bC)return[];var e=Jy(t);return[VP(t),e,VP(e)]}function Pne(t){var e=t.state,r=t.options,n=t.name;if(!e.modifiersData[n]._skip){for(var i=r.mainAxis,a=i===void 0?!0:i,s=r.altAxis,o=s===void 0?!0:s,l=r.fallbackPlacements,u=r.padding,c=r.boundary,f=r.rootBoundary,p=r.altBoundary,v=r.flipVariations,y=v===void 0?!0:v,S=r.allowedAutoPlacements,w=e.options.placement,E=Eu(w),_=E===w,T=l||(_||!y?[Jy(w)]:Nne(w)),N=[w].concat(T).reduce(function(de,he){return de.concat(Eu(he)===bC?Tne(e,{placement:he,boundary:c,rootBoundary:f,padding:u,flipVariations:y,allowedAutoPlacements:S}):he)},[]),R=e.rects.reference,I=e.rects.popper,F=new Map,D=!0,j=N[0],B=0;B<N.length;B++){var G=N[B],K=Eu(G),O=am(G)===rm,W=[Qs,tl].indexOf(K)>=0,U=W?"width":"height",q=Wv(e,{placement:G,boundary:c,rootBoundary:f,altBoundary:p,padding:u}),Z=W?O?rl:Js:O?tl:Qs;R[U]>I[U]&&(Z=Jy(Z));var Q=Jy(Z),ne=[];if(a&&ne.push(q[K]<=0),o&&ne.push(q[Z]<=0,q[Q]<=0),ne.every(function(de){return de})){j=G,D=!1;break}F.set(G,ne)}if(D)for(var re=y?3:1,Y=function(he){var xe=N.find(function(le){var fe=F.get(le);if(fe)return fe.slice(0,he).every(function(ve){return ve})});if(xe)return j=xe,"break"},J=re;J>0;J--){var ie=Y(J);if(ie==="break")break}e.placement!==j&&(e.modifiersData[n]._skip=!0,e.placement=j,e.reset=!0)}}const Mne={name:"flip",enabled:!0,phase:"main",fn:Pne,requiresIfExists:["offset"],data:{_skip:!1}};function WP(t,e,r){return r===void 0&&(r={x:0,y:0}),{top:t.top-e.height-r.y,right:t.right-e.width+r.x,bottom:t.bottom-e.height+r.y,left:t.left-e.width-r.x}}function qP(t){return[Qs,rl,tl,Js].some(function(e){return t[e]>=0})}function Ane(t){var e=t.state,r=t.name,n=e.rects.reference,i=e.rects.popper,a=e.modifiersData.preventOverflow,s=Wv(e,{elementContext:"reference"}),o=Wv(e,{altBoundary:!0}),l=WP(s,n),u=WP(o,i,a),c=qP(l),f=qP(u);e.modifiersData[r]={referenceClippingOffsets:l,popperEscapeOffsets:u,isReferenceHidden:c,hasPopperEscaped:f},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":c,"data-popper-escaped":f})}const Rne={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:Ane};function Lne(t,e,r){var n=Eu(t),i=[Js,Qs].indexOf(n)>=0?-1:1,a=typeof r=="function"?r(Object.assign({},e,{placement:t})):r,s=a[0],o=a[1];return s=s||0,o=(o||0)*i,[Js,rl].indexOf(n)>=0?{x:o,y:s}:{x:s,y:o}}function One(t){var e=t.state,r=t.options,n=t.name,i=r.offset,a=i===void 0?[0,0]:i,s=tD.reduce(function(c,f){return c[f]=Lne(f,e.rects,a),c},{}),o=s[e.placement],l=o.x,u=o.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=l,e.modifiersData.popperOffsets.y+=u),e.modifiersData[n]=s}const Dne={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:One};function Ine(t){var e=t.state,r=t.name;e.modifiersData[r]=uD({reference:e.rects.reference,element:e.rects.popper,placement:e.placement})}const jne={name:"popperOffsets",enabled:!0,phase:"read",fn:Ine,data:{}};function Fne(t){return t==="x"?"y":"x"}function Bne(t){var e=t.state,r=t.options,n=t.name,i=r.mainAxis,a=i===void 0?!0:i,s=r.altAxis,o=s===void 0?!1:s,l=r.boundary,u=r.rootBoundary,c=r.altBoundary,f=r.padding,p=r.tether,v=p===void 0?!0:p,y=r.tetherOffset,S=y===void 0?0:y,w=Wv(e,{boundary:l,rootBoundary:u,padding:f,altBoundary:c}),E=Eu(e.placement),_=am(e.placement),T=!_,N=kC(E),R=Fne(N),I=e.modifiersData.popperOffsets,F=e.rects.reference,D=e.rects.popper,j=typeof S=="function"?S(Object.assign({},e.rects,{placement:e.placement})):S,B=typeof j=="number"?{mainAxis:j,altAxis:j}:Object.assign({mainAxis:0,altAxis:0},j),G=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,K={x:0,y:0};if(I){if(a){var O,W=N==="y"?Qs:Js,U=N==="y"?tl:rl,q=N==="y"?"height":"width",Z=I[N],Q=Z+w[W],ne=Z-w[U],re=v?-D[q]/2:0,Y=_===rm?F[q]:D[q],J=_===rm?-D[q]:-F[q],ie=e.elements.arrow,de=v&&ie?SC(ie):{width:0,height:0},he=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:aD(),xe=he[W],le=he[U],fe=pv(0,F[q],de[q]),ve=T?F[q]/2-re-fe-xe-B.mainAxis:Y-fe-xe-B.mainAxis,ge=T?-F[q]/2+re+fe+le+B.mainAxis:J+fe+le+B.mainAxis,se=e.elements.arrow&&m0(e.elements.arrow),ye=se?N==="y"?se.clientTop||0:se.clientLeft||0:0,Se=(O=G?.[N])!=null?O:0,Ue=Z+ve-Se-ye,Oe=Z+ge-Se,mt=pv(v?m1(Q,Ue):Q,Z,v?fh(ne,Oe):ne);I[N]=mt,K[N]=mt-Z}if(o){var lt,at=N==="x"?Qs:Js,wt=N==="x"?tl:rl,$e=I[R],Ce=R==="y"?"height":"width",Ie=$e+w[at],Je=$e-w[wt],Qe=[Qs,Js].indexOf(E)!==-1,gt=(lt=G?.[R])!=null?lt:0,At=Qe?Ie:$e-F[Ce]-D[Ce]-gt+B.altAxis,Rt=Qe?$e+F[Ce]+D[Ce]-gt-B.altAxis:Je,Ut=v&&Qe?une(At,$e,Rt):pv(v?At:Ie,$e,v?Rt:Je);I[R]=Ut,K[R]=Ut-$e}e.modifiersData[n]=K}}const zne={name:"preventOverflow",enabled:!0,phase:"main",fn:Bne,requiresIfExists:["offset"]};function Une(t){return{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}}function Gne(t){return t===yo(t)||!el(t)?_C(t):Une(t)}function Vne(t){var e=t.getBoundingClientRect(),r=nm(e.width)/t.offsetWidth||1,n=nm(e.height)/t.offsetHeight||1;return r!==1||n!==1}function Hne(t,e,r){r===void 0&&(r=!1);var n=el(e),i=el(e)&&Vne(e),a=gf(e),s=im(t,i,r),o={scrollLeft:0,scrollTop:0},l={x:0,y:0};return(n||!n&&!r)&&((Mu(e)!=="body"||EC(a))&&(o=Gne(e)),el(e)?(l=im(e,!0),l.x+=e.clientLeft,l.y+=e.clientTop):a&&(l.x=CC(a))),{x:s.left+o.scrollLeft-l.x,y:s.top+o.scrollTop-l.y,width:s.width,height:s.height}}function Wne(t){var e=new Map,r=new Set,n=[];t.forEach(function(a){e.set(a.name,a)});function i(a){r.add(a.name);var s=[].concat(a.requires||[],a.requiresIfExists||[]);s.forEach(function(o){if(!r.has(o)){var l=e.get(o);l&&i(l)}}),n.push(a)}return t.forEach(function(a){r.has(a.name)||i(a)}),n}function qne(t){var e=Wne(t);return ine.reduce(function(r,n){return r.concat(e.filter(function(i){return i.phase===n}))},[])}function $ne(t){var e;return function(){return e||(e=new Promise(function(r){Promise.resolve().then(function(){e=void 0,r(t())})})),e}}function Kne(t){var e=t.reduce(function(r,n){var i=r[n.name];return r[n.name]=i?Object.assign({},i,n,{options:Object.assign({},i.options,n.options),data:Object.assign({},i.data,n.data)}):n,r},{});return Object.keys(e).map(function(r){return e[r]})}var $P={placement:"bottom",modifiers:[],strategy:"absolute"};function KP(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return!e.some(function(n){return!(n&&typeof n.getBoundingClientRect=="function")})}function Zne(t){t===void 0&&(t={});var e=t,r=e.defaultModifiers,n=r===void 0?[]:r,i=e.defaultOptions,a=i===void 0?$P:i;return function(o,l,u){u===void 0&&(u=a);var c={placement:"bottom",orderedModifiers:[],options:Object.assign({},$P,a),modifiersData:{},elements:{reference:o,popper:l},attributes:{},styles:{}},f=[],p=!1,v={state:c,setOptions:function(E){var _=typeof E=="function"?E(c.options):E;S(),c.options=Object.assign({},a,c.options,_),c.scrollParents={reference:Eh(o)?mv(o):o.contextElement?mv(o.contextElement):[],popper:mv(l)};var T=qne(Kne([].concat(n,c.options.modifiers)));return c.orderedModifiers=T.filter(function(N){return N.enabled}),y(),v.update()},forceUpdate:function(){if(!p){var E=c.elements,_=E.reference,T=E.popper;if(KP(_,T)){c.rects={reference:Hne(_,m0(T),c.options.strategy==="fixed"),popper:SC(T)},c.reset=!1,c.placement=c.options.placement,c.orderedModifiers.forEach(function(B){return c.modifiersData[B.name]=Object.assign({},B.data)});for(var N=0;N<c.orderedModifiers.length;N++){if(c.reset===!0){c.reset=!1,N=-1;continue}var R=c.orderedModifiers[N],I=R.fn,F=R.options,D=F===void 0?{}:F,j=R.name;typeof I=="function"&&(c=I({state:c,options:D,name:j,instance:v})||c)}}}},update:$ne(function(){return new Promise(function(w){v.forceUpdate(),w(c)})}),destroy:function(){S(),p=!0}};if(!KP(o,l))return v;v.setOptions(u).then(function(w){!p&&u.onFirstUpdate&&u.onFirstUpdate(w)});function y(){c.orderedModifiers.forEach(function(w){var E=w.name,_=w.options,T=_===void 0?{}:_,N=w.effect;if(typeof N=="function"){var R=N({state:c,name:E,instance:v,options:T}),I=function(){};f.push(R||I)}})}function S(){f.forEach(function(w){return w()}),f=[]}return v}}var Yne=[xne,jne,vne,rD,Dne,Mne,zne,hne,Rne],Xne=Zne({defaultModifiers:Yne}),Qne="tippy-box",cD="tippy-content",Jne="tippy-backdrop",dD="tippy-arrow",fD="tippy-svg-arrow",Yf={passive:!0,capture:!0},hD=function(){return document.body};function _S(t,e,r){if(Array.isArray(t)){var n=t[e];return n??(Array.isArray(r)?r[e]:r)}return t}function TC(t,e){var r={}.toString.call(t);return r.indexOf("[object")===0&&r.indexOf(e+"]")>-1}function pD(t,e){return typeof t=="function"?t.apply(void 0,e):t}function ZP(t,e){if(e===0)return t;var r;return function(n){clearTimeout(r),r=setTimeout(function(){t(n)},e)}}function eie(t){return t.split(/\s+/).filter(Boolean)}function Ap(t){return[].concat(t)}function YP(t,e){t.indexOf(e)===-1&&t.push(e)}function tie(t){return t.filter(function(e,r){return t.indexOf(e)===r})}function rie(t){return t.split("-")[0]}function g1(t){return[].slice.call(t)}function XP(t){return Object.keys(t).reduce(function(e,r){return t[r]!==void 0&&(e[r]=t[r]),e},{})}function gv(){return document.createElement("div")}function ob(t){return["Element","Fragment"].some(function(e){return TC(t,e)})}function nie(t){return TC(t,"NodeList")}function iie(t){return TC(t,"MouseEvent")}function aie(t){return!!(t&&t._tippy&&t._tippy.reference===t)}function sie(t){return ob(t)?[t]:nie(t)?g1(t):Array.isArray(t)?t:g1(document.querySelectorAll(t))}function CS(t,e){t.forEach(function(r){r&&(r.style.transitionDuration=e+"ms")})}function QP(t,e){t.forEach(function(r){r&&r.setAttribute("data-state",e)})}function oie(t){var e,r=Ap(t),n=r[0];return n!=null&&(e=n.ownerDocument)!=null&&e.body?n.ownerDocument:document}function lie(t,e){var r=e.clientX,n=e.clientY;return t.every(function(i){var a=i.popperRect,s=i.popperState,o=i.props,l=o.interactiveBorder,u=rie(s.placement),c=s.modifiersData.offset;if(!c)return!0;var f=u==="bottom"?c.top.y:0,p=u==="top"?c.bottom.y:0,v=u==="right"?c.left.x:0,y=u==="left"?c.right.x:0,S=a.top-n+f>l,w=n-a.bottom-p>l,E=a.left-r+v>l,_=r-a.right-y>l;return S||w||E||_})}function ES(t,e,r){var n=e+"EventListener";["transitionend","webkitTransitionEnd"].forEach(function(i){t[n](i,r)})}function JP(t,e){for(var r=e;r;){var n;if(t.contains(r))return!0;r=r.getRootNode==null||(n=r.getRootNode())==null?void 0:n.host}return!1}var Su={isTouch:!1},eM=0;function uie(){Su.isTouch||(Su.isTouch=!0,window.performance&&document.addEventListener("mousemove",mD))}function mD(){var t=performance.now();t-eM<20&&(Su.isTouch=!1,document.removeEventListener("mousemove",mD)),eM=t}function cie(){var t=document.activeElement;if(aie(t)){var e=t._tippy;t.blur&&!e.state.isVisible&&t.blur()}}function die(){document.addEventListener("touchstart",uie,Yf),window.addEventListener("blur",cie)}var fie=typeof window<"u"&&typeof document<"u",hie=fie?!!window.msCrypto:!1,pie={animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},mie={allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999},Dl=Object.assign({appendTo:hD,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},pie,mie),gie=Object.keys(Dl),vie=function(e){var r=Object.keys(e);r.forEach(function(n){Dl[n]=e[n]})};function gD(t){var e=t.plugins||[],r=e.reduce(function(n,i){var a=i.name,s=i.defaultValue;if(a){var o;n[a]=t[a]!==void 0?t[a]:(o=Dl[a])!=null?o:s}return n},{});return Object.assign({},t,r)}function yie(t,e){var r=e?Object.keys(gD(Object.assign({},Dl,{plugins:e}))):gie,n=r.reduce(function(i,a){var s=(t.getAttribute("data-tippy-"+a)||"").trim();if(!s)return i;if(a==="content")i[a]=s;else try{i[a]=JSON.parse(s)}catch{i[a]=s}return i},{});return n}function tM(t,e){var r=Object.assign({},e,{content:pD(e.content,[t])},e.ignoreAttributes?{}:yie(t,e.plugins));return r.aria=Object.assign({},Dl.aria,r.aria),r.aria={expanded:r.aria.expanded==="auto"?e.interactive:r.aria.expanded,content:r.aria.content==="auto"?e.interactive?null:"describedby":r.aria.content},r}var xie=function(){return"innerHTML"};function Uk(t,e){t[xie()]=e}function rM(t){var e=gv();return t===!0?e.className=dD:(e.className=fD,ob(t)?e.appendChild(t):Uk(e,t)),e}function nM(t,e){ob(e.content)?(Uk(t,""),t.appendChild(e.content)):typeof e.content!="function"&&(e.allowHTML?Uk(t,e.content):t.textContent=e.content)}function Gk(t){var e=t.firstElementChild,r=g1(e.children);return{box:e,content:r.find(function(n){return n.classList.contains(cD)}),arrow:r.find(function(n){return n.classList.contains(dD)||n.classList.contains(fD)}),backdrop:r.find(function(n){return n.classList.contains(Jne)})}}function vD(t){var e=gv(),r=gv();r.className=Qne,r.setAttribute("data-state","hidden"),r.setAttribute("tabindex","-1");var n=gv();n.className=cD,n.setAttribute("data-state","hidden"),nM(n,t.props),e.appendChild(r),r.appendChild(n),i(t.props,t.props);function i(a,s){var o=Gk(e),l=o.box,u=o.content,c=o.arrow;s.theme?l.setAttribute("data-theme",s.theme):l.removeAttribute("data-theme"),typeof s.animation=="string"?l.setAttribute("data-animation",s.animation):l.removeAttribute("data-animation"),s.inertia?l.setAttribute("data-inertia",""):l.removeAttribute("data-inertia"),l.style.maxWidth=typeof s.maxWidth=="number"?s.maxWidth+"px":s.maxWidth,s.role?l.setAttribute("role",s.role):l.removeAttribute("role"),(a.content!==s.content||a.allowHTML!==s.allowHTML)&&nM(u,t.props),s.arrow?c?a.arrow!==s.arrow&&(l.removeChild(c),l.appendChild(rM(s.arrow))):l.appendChild(rM(s.arrow)):c&&l.removeChild(c)}return{popper:e,onUpdate:i}}vD.$$tippy=!0;var bie=1,Ly=[],TS=[];function wie(t,e){var r=tM(t,Object.assign({},Dl,gD(XP(e)))),n,i,a,s=!1,o=!1,l=!1,u=!1,c,f,p,v=[],y=ZP(Ue,r.interactiveDebounce),S,w=bie++,E=null,_=tie(r.plugins),T={isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},N={id:w,reference:t,popper:gv(),popperInstance:E,props:r,state:T,plugins:_,clearDelayTimeouts:At,setProps:Rt,setContent:Ut,show:Vt,hide:pt,hideWithInteractivity:dt,enable:Qe,disable:gt,unmount:Ge,destroy:ce};if(!r.render)return N;var R=r.render(N),I=R.popper,F=R.onUpdate;I.setAttribute("data-tippy-root",""),I.id="tippy-"+N.id,N.popper=I,t._tippy=N,I._tippy=N;var D=_.map(function(me){return me.fn(N)}),j=t.hasAttribute("aria-expanded");return se(),re(),Z(),Q("onCreate",[N]),r.showOnCreate&&Ie(),I.addEventListener("mouseenter",function(){N.props.interactive&&N.state.isVisible&&N.clearDelayTimeouts()}),I.addEventListener("mouseleave",function(){N.props.interactive&&N.props.trigger.indexOf("mouseenter")>=0&&W().addEventListener("mousemove",y)}),N;function B(){var me=N.props.touch;return Array.isArray(me)?me:[me,0]}function G(){return B()[0]==="hold"}function K(){var me;return!!((me=N.props.render)!=null&&me.$$tippy)}function O(){return S||t}function W(){var me=O().parentNode;return me?oie(me):document}function U(){return Gk(I)}function q(me){return N.state.isMounted&&!N.state.isVisible||Su.isTouch||c&&c.type==="focus"?0:_S(N.props.delay,me?0:1,Dl.delay)}function Z(me){me===void 0&&(me=!1),I.style.pointerEvents=N.props.interactive&&!me?"":"none",I.style.zIndex=""+N.props.zIndex}function Q(me,ke,Te){if(Te===void 0&&(Te=!0),D.forEach(function(Xe){Xe[me]&&Xe[me].apply(Xe,ke)}),Te){var Ae;(Ae=N.props)[me].apply(Ae,ke)}}function ne(){var me=N.props.aria;if(me.content){var ke="aria-"+me.content,Te=I.id,Ae=Ap(N.props.triggerTarget||t);Ae.forEach(function(Xe){var Ve=Xe.getAttribute(ke);if(N.state.isVisible)Xe.setAttribute(ke,Ve?Ve+" "+Te:Te);else{var yt=Ve&&Ve.replace(Te,"").trim();yt?Xe.setAttribute(ke,yt):Xe.removeAttribute(ke)}})}}function re(){if(!(j||!N.props.aria.expanded)){var me=Ap(N.props.triggerTarget||t);me.forEach(function(ke){N.props.interactive?ke.setAttribute("aria-expanded",N.state.isVisible&&ke===O()?"true":"false"):ke.removeAttribute("aria-expanded")})}}function Y(){W().removeEventListener("mousemove",y),Ly=Ly.filter(function(me){return me!==y})}function J(me){if(!(Su.isTouch&&(l||me.type==="mousedown"))){var ke=me.composedPath&&me.composedPath()[0]||me.target;if(!(N.props.interactive&&JP(I,ke))){if(Ap(N.props.triggerTarget||t).some(function(Te){return JP(Te,ke)})){if(Su.isTouch||N.state.isVisible&&N.props.trigger.indexOf("click")>=0)return}else Q("onClickOutside",[N,me]);N.props.hideOnClick===!0&&(N.clearDelayTimeouts(),N.hide(),o=!0,setTimeout(function(){o=!1}),N.state.isMounted||xe())}}}function ie(){l=!0}function de(){l=!1}function he(){var me=W();me.addEventListener("mousedown",J,!0),me.addEventListener("touchend",J,Yf),me.addEventListener("touchstart",de,Yf),me.addEventListener("touchmove",ie,Yf)}function xe(){var me=W();me.removeEventListener("mousedown",J,!0),me.removeEventListener("touchend",J,Yf),me.removeEventListener("touchstart",de,Yf),me.removeEventListener("touchmove",ie,Yf)}function le(me,ke){ve(me,function(){!N.state.isVisible&&I.parentNode&&I.parentNode.contains(I)&&ke()})}function fe(me,ke){ve(me,ke)}function ve(me,ke){var Te=U().box;function Ae(Xe){Xe.target===Te&&(ES(Te,"remove",Ae),ke())}if(me===0)return ke();ES(Te,"remove",f),ES(Te,"add",Ae),f=Ae}function ge(me,ke,Te){Te===void 0&&(Te=!1);var Ae=Ap(N.props.triggerTarget||t);Ae.forEach(function(Xe){Xe.addEventListener(me,ke,Te),v.push({node:Xe,eventType:me,handler:ke,options:Te})})}function se(){G()&&(ge("touchstart",Se,{passive:!0}),ge("touchend",Oe,{passive:!0})),eie(N.props.trigger).forEach(function(me){if(me!=="manual")switch(ge(me,Se),me){case"mouseenter":ge("mouseleave",Oe);break;case"focus":ge(hie?"focusout":"blur",mt);break;case"focusin":ge("focusout",mt);break}})}function ye(){v.forEach(function(me){var ke=me.node,Te=me.eventType,Ae=me.handler,Xe=me.options;ke.removeEventListener(Te,Ae,Xe)}),v=[]}function Se(me){var ke,Te=!1;if(!(!N.state.isEnabled||lt(me)||o)){var Ae=((ke=c)==null?void 0:ke.type)==="focus";c=me,S=me.currentTarget,re(),!N.state.isVisible&&iie(me)&&Ly.forEach(function(Xe){return Xe(me)}),me.type==="click"&&(N.props.trigger.indexOf("mouseenter")<0||s)&&N.props.hideOnClick!==!1&&N.state.isVisible?Te=!0:Ie(me),me.type==="click"&&(s=!Te),Te&&!Ae&&Je(me)}}function Ue(me){var ke=me.target,Te=O().contains(ke)||I.contains(ke);if(!(me.type==="mousemove"&&Te)){var Ae=Ce().concat(I).map(function(Xe){var Ve,yt=Xe._tippy,vt=(Ve=yt.popperInstance)==null?void 0:Ve.state;return vt?{popperRect:Xe.getBoundingClientRect(),popperState:vt,props:r}:null}).filter(Boolean);lie(Ae,me)&&(Y(),Je(me))}}function Oe(me){var ke=lt(me)||N.props.trigger.indexOf("click")>=0&&s;if(!ke){if(N.props.interactive){N.hideWithInteractivity(me);return}Je(me)}}function mt(me){N.props.trigger.indexOf("focusin")<0&&me.target!==O()||N.props.interactive&&me.relatedTarget&&I.contains(me.relatedTarget)||Je(me)}function lt(me){return Su.isTouch?G()!==me.type.indexOf("touch")>=0:!1}function at(){wt();var me=N.props,ke=me.popperOptions,Te=me.placement,Ae=me.offset,Xe=me.getReferenceClientRect,Ve=me.moveTransition,yt=K()?Gk(I).arrow:null,vt=Xe?{getBoundingClientRect:Xe,contextElement:Xe.contextElement||O()}:t,ft={name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(Et){var Wt=Et.state;if(K()){var ar=U(),Rr=ar.box;["placement","reference-hidden","escaped"].forEach(function(kr){kr==="placement"?Rr.setAttribute("data-placement",Wt.placement):Wt.attributes.popper["data-popper-"+kr]?Rr.setAttribute("data-"+kr,""):Rr.removeAttribute("data-"+kr)}),Wt.attributes.popper={}}}},Zt=[{name:"offset",options:{offset:Ae}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!Ve}},ft];K()&&yt&&Zt.push({name:"arrow",options:{element:yt,padding:3}}),Zt.push.apply(Zt,ke?.modifiers||[]),N.popperInstance=Xne(vt,I,Object.assign({},ke,{placement:Te,onFirstUpdate:p,modifiers:Zt}))}function wt(){N.popperInstance&&(N.popperInstance.destroy(),N.popperInstance=null)}function $e(){var me=N.props.appendTo,ke,Te=O();N.props.interactive&&me===hD||me==="parent"?ke=Te.parentNode:ke=pD(me,[Te]),ke.contains(I)||ke.appendChild(I),N.state.isMounted=!0,at()}function Ce(){return g1(I.querySelectorAll("[data-tippy-root]"))}function Ie(me){N.clearDelayTimeouts(),me&&Q("onTrigger",[N,me]),he();var ke=q(!0),Te=B(),Ae=Te[0],Xe=Te[1];Su.isTouch&&Ae==="hold"&&Xe&&(ke=Xe),ke?n=setTimeout(function(){N.show()},ke):N.show()}function Je(me){if(N.clearDelayTimeouts(),Q("onUntrigger",[N,me]),!N.state.isVisible){xe();return}if(!(N.props.trigger.indexOf("mouseenter")>=0&&N.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(me.type)>=0&&s)){var ke=q(!1);ke?i=setTimeout(function(){N.state.isVisible&&N.hide()},ke):a=requestAnimationFrame(function(){N.hide()})}}function Qe(){N.state.isEnabled=!0}function gt(){N.hide(),N.state.isEnabled=!1}function At(){clearTimeout(n),clearTimeout(i),cancelAnimationFrame(a)}function Rt(me){if(!N.state.isDestroyed){Q("onBeforeUpdate",[N,me]),ye();var ke=N.props,Te=tM(t,Object.assign({},ke,XP(me),{ignoreAttributes:!0}));N.props=Te,se(),ke.interactiveDebounce!==Te.interactiveDebounce&&(Y(),y=ZP(Ue,Te.interactiveDebounce)),ke.triggerTarget&&!Te.triggerTarget?Ap(ke.triggerTarget).forEach(function(Ae){Ae.removeAttribute("aria-expanded")}):Te.triggerTarget&&t.removeAttribute("aria-expanded"),re(),Z(),F&&F(ke,Te),N.popperInstance&&(at(),Ce().forEach(function(Ae){requestAnimationFrame(Ae._tippy.popperInstance.forceUpdate)})),Q("onAfterUpdate",[N,me])}}function Ut(me){N.setProps({content:me})}function Vt(){var me=N.state.isVisible,ke=N.state.isDestroyed,Te=!N.state.isEnabled,Ae=Su.isTouch&&!N.props.touch,Xe=_S(N.props.duration,0,Dl.duration);if(!(me||ke||Te||Ae)&&!O().hasAttribute("disabled")&&(Q("onShow",[N],!1),N.props.onShow(N)!==!1)){if(N.state.isVisible=!0,K()&&(I.style.visibility="visible"),Z(),he(),N.state.isMounted||(I.style.transition="none"),K()){var Ve=U(),yt=Ve.box,vt=Ve.content;CS([yt,vt],0)}p=function(){var Zt;if(!(!N.state.isVisible||u)){if(u=!0,I.offsetHeight,I.style.transition=N.props.moveTransition,K()&&N.props.animation){var Ht=U(),Et=Ht.box,Wt=Ht.content;CS([Et,Wt],Xe),QP([Et,Wt],"visible")}ne(),re(),YP(TS,N),(Zt=N.popperInstance)==null||Zt.forceUpdate(),Q("onMount",[N]),N.props.animation&&K()&&fe(Xe,function(){N.state.isShown=!0,Q("onShown",[N])})}},$e()}}function pt(){var me=!N.state.isVisible,ke=N.state.isDestroyed,Te=!N.state.isEnabled,Ae=_S(N.props.duration,1,Dl.duration);if(!(me||ke||Te)&&(Q("onHide",[N],!1),N.props.onHide(N)!==!1)){if(N.state.isVisible=!1,N.state.isShown=!1,u=!1,s=!1,K()&&(I.style.visibility="hidden"),Y(),xe(),Z(!0),K()){var Xe=U(),Ve=Xe.box,yt=Xe.content;N.props.animation&&(CS([Ve,yt],Ae),QP([Ve,yt],"hidden"))}ne(),re(),N.props.animation?K()&&le(Ae,N.unmount):N.unmount()}}function dt(me){W().addEventListener("mousemove",y),YP(Ly,y),y(me)}function Ge(){N.state.isVisible&&N.hide(),N.state.isMounted&&(wt(),Ce().forEach(function(me){me._tippy.unmount()}),I.parentNode&&I.parentNode.removeChild(I),TS=TS.filter(function(me){return me!==N}),N.state.isMounted=!1,Q("onHidden",[N]))}function ce(){N.state.isDestroyed||(N.clearDelayTimeouts(),N.unmount(),ye(),delete t._tippy,N.state.isDestroyed=!0,Q("onDestroy",[N]))}}function g0(t,e){e===void 0&&(e={});var r=Dl.plugins.concat(e.plugins||[]);die();var n=Object.assign({},e,{plugins:r}),i=sie(t),a=i.reduce(function(s,o){var l=o&&wie(o,n);return l&&s.push(l),s},[]);return ob(t)?a[0]:a}g0.defaultProps=Dl;g0.setDefaultProps=vie;g0.currentInput=Su;Object.assign({},rD,{effect:function(e){var r=e.state,n={popper:{position:r.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(r.elements.popper.style,n.popper),r.styles=n,r.elements.arrow&&Object.assign(r.elements.arrow.style,n.arrow)}});g0.setDefaultProps({render:vD});const Sie=ae.forwardRef((t,e)=>{const[r,n]=ae.useState(0),i=l=>{const u=t.items[l];u&&t.command({id:u.id,label:u.label})},a=()=>{n((r+t.items.length-1)%t.items.length)},s=()=>{n((r+1)%t.items.length)},o=()=>{i(r)};return ae.useEffect(()=>n(0),[t.items]),ae.useImperativeHandle(e,()=>({onKeyDown:({event:l})=>l.key==="ArrowUp"?(a(),!0):l.key==="ArrowDown"?(s(),!0):l.key==="Enter"?(o(),!0):!1})),m.jsx("div",{className:"items bg-white border border-slate-200 rounded-xl shadow-2xl overflow-hidden min-w-[200px] p-2 animate-in zoom-in-95 duration-200",children:t.items.length?t.items.map((l,u)=>m.jsxs("button",{className:`flex w-full items-center text-xs px-4 py-2.5 rounded-lg outline-none text-left transition-all ${u===r?"bg-primary text-white shadow-lg":"text-slate-700 hover:bg-slate-50"}`,onClick:()=>i(u),children:[m.jsx("span",{className:"material-symbols-outlined text-[14px] mr-2 opacity-50",children:"auto_stories"}),m.jsx("span",{className:"font-serif font-bold",children:l.label})]},u)):m.jsx("div",{className:"item text-sm px-2 py-1.5 text-muted-foreground",children:"No result"})})}),kie={items:async({query:t})=>{try{return(await et.get("/world-bible/entities")).filter(r=>r.nombre.toLowerCase().startsWith(t.toLowerCase())).slice(0,5).map(r=>({id:r.id,label:r.nombre}))}catch(e){return console.error(e),[]}},render:()=>{let t,e;return{onStart:r=>{t=new nte(Sie,{props:r,editor:r.editor}),r.clientRect&&(e=g0("body",{getReferenceClientRect:r.clientRect,appendTo:()=>document.body,content:t.element,showOnCreate:!0,interactive:!0,trigger:"manual",placement:"bottom-start"}))},onUpdate(r){t.updateProps(r),r.clientRect&&e[0].setProps({getReferenceClientRect:r.clientRect})},onKeyDown(r){return r.event.key==="Escape"?(e[0].hide(),!0):t.ref?.onKeyDown(r)},onExit(){e[0].destroy(),t.destroy()}}}},_ie=({content:t,onUpdate:e,editable:r=!0,paperMode:n=!1})=>{const[i,a]=nr.useState({font:"Cormorant Garamond",fontSize:18});nr.useEffect(()=>{const o=localStorage.getItem("app_settings");o&&a(JSON.parse(o))},[]);const s=Yee({extensions:[Bre,zre.configure({placeholder:"Escribe tu historia aqu... Usa @ para mencionar entidades."}),qre.configure({HTMLAttributes:{class:"mention"},suggestion:kie})],content:t,editable:r,onUpdate:({editor:o})=>{e(o.getHTML())},editorProps:{attributes:{class:`prose ${n?"prose-slate":"prose-invert"} max-w-none focus:outline-none min-h-[300px] p-8 ${n?"text-slate-900":"text-foreground/90"} leading-relaxed text-lg transition-all`,style:`font-family: "${i.font}", serif; font-size: ${i.fontSize}px;`}}});return ae.useEffect(()=>{s&&t!==s.getHTML()&&s.commands.setContent(t)},[t,s]),s?m.jsx("div",{className:`zen-editor-container w-full h-full overflow-y-auto no-scrollbar ${n?"bg-transparent border-none shadow-none":"bg-card/20 rounded-lg border border-border/50"}`,children:m.jsx(Vee,{editor:s,className:"h-full"})}):null},Cie=()=>{const{notebookId:t}=qi(),e=Va(),{setRightPanelTab:r,setRightOpen:n}=nl(),{t:i}=Ps(),[a,s]=ae.useState(null),[o,l]=ae.useState([]),[u,c]=ae.useState(0),[f,p]=ae.useState(!1),[v,y]=ae.useState(!0),S=ae.useRef(null),w=ae.useRef(o),E=ae.useRef(u),_=ae.useRef(!0);ae.useEffect(()=>{w.current=o},[o]),ae.useEffect(()=>{E.current=u},[u]);const[T,N]=ae.useState(null),[R,I]=ae.useState("index");ae.useEffect(()=>{r&&r("CONTEXT"),n(!0),t&&F(t)},[t,r]),ae.useEffect(()=>{const U=setInterval(()=>{const q=document.getElementById("global-right-panel-portal");q&&(N(q),clearInterval(U))},100);return()=>{clearInterval(U),r&&r("NOTEBOOKS")}},[r]),ae.useEffect(()=>{_.current=!0;const U=q=>{S.current&&(q.preventDefault(),q.returnValue="")};return window.addEventListener("beforeunload",U),()=>{if(_.current=!1,window.removeEventListener("beforeunload",U),S.current){clearTimeout(S.current);const q=w.current[E.current];q&&(console.log("Saving on unmount (keepalive):",q.id),et.request(`/escritura/hoja/${q.id}`,{method:"PUT",body:JSON.stringify({contenido:q.contenido}),keepalive:!0}).catch(Z=>console.error("Error preventing data loss:",Z)))}}},[]);const F=async U=>{try{y(!0);const q=await et.get(`/escritura/cuaderno/${U}`);s(q);const Z=await et.get(`/escritura/cuaderno/${U}/hojas`);if(Z&&Z.length>0)l(Z),c(0);else{const Q=await et.post(`/escritura/cuaderno/${U}/hoja`,{});l([Q]),c(0)}}catch(q){console.error("Error loading notebook/pages:",q),e(-1)}finally{y(!1)}},D=U=>{if(!o[u])return;const q=[...o];q[u].contenido=U,l(q),S.current&&clearTimeout(S.current),S.current=setTimeout(()=>{j(q[u])},800)},j=async U=>{_.current&&p(!0);try{await et.put(`/escritura/hoja/${U.id}`,{contenido:U.contenido})}catch(q){console.error("Error saving page:",q)}finally{_.current&&p(!1)}},B=async()=>{if(a)try{const U=await et.post(`/escritura/cuaderno/${a.id}/hoja`,{});l([...o,U]),c(o.length)}catch(U){console.error("Error creating page:",U)}},G=U=>{c(U)},K=async(U,q,Z)=>{if(U.stopPropagation(),o.length<=1){alert(i("writing.one_page_error"));return}if(window.confirm(i("writing.delete_page_confirm")))try{await et.delete(`/escritura/hoja/${q}`);const Q=o.filter(ne=>ne.id!==q);l(Q),u===Z?c(Math.max(0,Z-1)):u>Z&&c(u-1)}catch(Q){console.error("Error deleting page:",Q)}},O=()=>m.jsxs("div",{className:"flex flex-col h-full bg-surface-dark/95",children:[m.jsxs("div",{className:"p-4 border-b border-white/5 flex items-center justify-between bg-black/40",children:[m.jsxs("button",{onClick:()=>e(`/${qi().username}/${qi().projectName}/writing`),className:"flex items-center gap-2 text-slate-400 hover:text-white transition-colors",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"arrow_back"}),m.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest",children:i("nav.writing")})]}),m.jsx("div",{className:`w-2 h-2 rounded-full ${f?"bg-amber-500 animate-pulse":"bg-emerald-500/50"}`,title:i(f?"common.saving":"common.saved")})]}),m.jsxs("div",{className:"flex p-2 gap-2 border-b border-white/5 bg-black/20",children:[m.jsx("button",{onClick:()=>I("index"),className:`flex-1 py-2 rounded-xl text-[10px] font-black uppercase tracking-widest transition-all ${R==="index"?"bg-primary text-white shadow-lg":"text-slate-500 hover:text-white"}`,children:i("writing.index")}),m.jsx("button",{onClick:()=>I("format"),className:`flex-1 py-2 rounded-xl text-[10px] font-black uppercase tracking-widest transition-all ${R==="format"?"bg-primary text-white shadow-lg":"text-slate-500 hover:text-white"}`,children:i("writing.format")})]}),m.jsx("div",{className:"flex-1 overflow-hidden",children:R==="index"?m.jsxs("div",{className:"flex flex-col h-full",children:[m.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-2 custom-scrollbar",children:o.map((U,q)=>m.jsxs("div",{className:"group relative",children:[m.jsxs("button",{onClick:()=>G(q),className:`w-full text-left p-4 rounded-2xl border transition-all ${q===u?"bg-primary/10 border-primary/30 text-primary":"bg-white/5 border-transparent hover:bg-white/10 text-slate-400"}`,children:[m.jsxs("div",{className:"flex justify-between items-center mb-1",children:[m.jsxs("span",{className:"font-serif font-bold text-sm truncate",children:[i("writing.page")," ",q+1]}),q===u&&m.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-primary shrink-0 ml-2"})]}),m.jsx("p",{className:"text-[10px] line-clamp-2 opacity-50 font-mono break-words leading-relaxed",children:U.contenido?.replace(/<[^>]+>/g,"").substring(0,40)||i("writing.empty")})]}),m.jsx("button",{onClick:Z=>K(Z,U.id,q),className:"absolute top-2 right-2 p-1.5 rounded-lg text-slate-600 hover:text-red-400 hover:bg-red-400/10 transition-all opacity-0 group-hover:opacity-100",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})})]},U.id))}),m.jsx("div",{className:"p-4 bg-black/20 border-t border-white/5",children:m.jsxs("button",{onClick:B,className:"w-full py-3 bg-primary text-white rounded-2xl text-[10px] font-black uppercase tracking-widest flex items-center justify-center gap-2 transition-all hover:scale-[1.02] shadow-xl shadow-primary/20",children:[m.jsx("span",{className:"material-symbols-outlined text-base",children:"add"}),m.jsx("span",{children:i("writing.new_page")})]})})]}):m.jsx("div",{className:"p-6 space-y-8 animate-in fade-in slide-in-from-right-4",children:m.jsxs("div",{className:"space-y-4",children:[m.jsxs("h3",{className:"text-[10px] font-black uppercase tracking-widest text-slate-500 flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"format_size"})," ",i("writing.typography")]}),m.jsx("div",{className:"grid grid-cols-1 gap-2",children:m.jsx("p",{className:"text-[9px] text-slate-600 uppercase font-bold italic",children:i("writing.typography_desc")})})]})})})]}),W=o[u];return v?m.jsx("div",{className:"flex-1 flex items-center justify-center bg-background-dark",children:m.jsx("div",{className:"animate-pulse text-slate-500 font-serif text-2xl italic tracking-widest",children:i("writing.opening_chronicle")})}):m.jsxs("div",{className:"flex-1 flex w-full h-full bg-background-dark relative overflow-hidden font-sans",children:[T&&xo.createPortal(O(),T),m.jsx("div",{className:"flex-1 flex flex-col relative z-10 overflow-hidden",children:m.jsx("main",{className:"flex-1 overflow-y-auto custom-scrollbar flex justify-center bg-transparent relative no-scrollbar",children:W&&m.jsx("div",{className:"w-full min-h-full flex flex-col animate-in slide-in-from-bottom-8 duration-700",children:m.jsxs("div",{className:"flex-1 bg-white overflow-hidden flex flex-col transition-all duration-500 group",children:[m.jsx("div",{className:"h-24 flex items-end px-16 pb-4 border-b border-slate-50",children:m.jsx("input",{type:"text",className:"w-full bg-transparent text-4xl font-serif font-black text-slate-800 placeholder:text-slate-100 border-none outline-none",defaultValue:`${i("writing.chapter")} ${u+1}`,placeholder:i("writing.title_placeholder")})}),m.jsx("div",{className:"flex-1 px-16 py-12 text-slate-900",children:m.jsx(_ie,{content:W.contenido,onUpdate:D,paperMode:!0})}),m.jsxs("footer",{className:"h-16 border-t border-slate-100 flex items-center justify-between px-16 text-[10px] font-mono text-slate-400 select-none",children:[m.jsxs("span",{children:[i("writing.page").toUpperCase()," ",u+1," ",i("writing.of")," ",o.length]}),m.jsx("span",{className:"opacity-0 group-hover:opacity-100 transition-opacity uppercase font-black tracking-widest",children:a?.titulo||i("common.no_results")})]})]})})})})]})},Eie=()=>{const{username:t,projectName:e}=qi(),r=Va(),{t:n}=Ps(),{setRightPanelTab:i,setRightOpen:a}=nl(),[s,o]=ae.useState([]),[l,u]=ae.useState(!0),[c,f]=ae.useState(!1),[p,v]=ae.useState("");ae.useEffect(()=>{i&&i("NOTEBOOKS"),y()},[i]);const y=async()=>{try{u(!0);const E=await et.get("/escritura/cuadernos");o(E||[])}catch(E){console.error("Error loading notebooks:",E)}finally{u(!1)}},S=async E=>{E.preventDefault();try{const _=await et.post("/escritura/cuaderno",{titulo:p||n("writing.new_notebook")});o([...s,_]),f(!1),v(""),r(`/${t}/${e}/writing/${_.id}`)}catch(_){console.error("Error creating notebook:",_)}},w=async(E,_)=>{if(E.stopPropagation(),!!window.confirm(n("writing.delete_confirm")))try{await et.delete(`/escritura/cuaderno/${_}`),o(s.filter(T=>T.id!==_))}catch(T){console.error("Error deleting notebook:",T)}};return l?m.jsx("div",{className:"flex-1 flex items-center justify-center bg-background-dark",children:m.jsx("div",{className:"animate-spin text-primary material-symbols-outlined text-4xl",children:"sync"})}):m.jsxs("div",{className:"flex-1 flex flex-col bg-background-dark overflow-y-auto no-scrollbar p-12",children:[m.jsxs("header",{className:"mb-12 flex justify-between items-end",children:[m.jsxs("div",{children:[m.jsx("h1",{className:"text-4xl font-serif font-bold text-white mb-2",children:n("writing.library")}),m.jsx("p",{className:"text-slate-500 uppercase text-[10px] font-black tracking-[0.2em]",children:n("writing.library_desc")})]}),m.jsx("button",{onClick:()=>f(!0),className:"group relative px-6 py-3 bg-primary/10 hover:bg-primary/20 border border-primary/30 rounded-2xl transition-all overflow-hidden",children:m.jsxs("div",{className:"flex items-center gap-2 text-primary",children:[m.jsx("span",{className:"material-symbols-outlined text-sm transition-transform group-hover:rotate-90",children:"add"}),m.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest",children:n("writing.new_notebook")})]})})]}),m.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:s.map(E=>m.jsxs("div",{onClick:()=>r(`/${t}/${e}/writing/${E.id}`),className:"group relative h-64 bg-surface-dark border border-white/5 rounded-3xl p-6 cursor-pointer hover:border-primary/50 hover:bg-white/[0.02] transition-all hover:-translate-y-2 flex flex-col justify-between overflow-hidden shadow-2xl",children:[m.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-1.5 bg-primary/40 group-hover:bg-primary transition-colors"}),m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{className:"flex justify-between items-start",children:[m.jsx("div",{className:"size-10 rounded-xl bg-primary/10 flex items-center justify-center text-primary group-hover:scale-110 transition-transform",children:m.jsx("span",{className:"material-symbols-outlined",children:"folder_open"})}),m.jsx("button",{onClick:_=>w(_,E.id),className:"p-1.5 rounded-lg text-slate-600 hover:text-red-400 hover:bg-red-400/10 transition-all opacity-0 group-hover:opacity-100",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})})]}),m.jsxs("div",{children:[m.jsx("h3",{className:"text-xl font-serif font-bold text-slate-100 group-hover:text-primary transition-colors line-clamp-2",children:E.titulo||n("common.no_results")}),m.jsxs("p",{className:"text-[10px] text-slate-500 font-mono mt-1",children:["ID: #",E.id]})]})]}),m.jsxs("div",{className:"flex items-center gap-2 pt-4 border-t border-white/5 opacity-50 group-hover:opacity-100 transition-opacity",children:[m.jsx("span",{className:"material-symbols-outlined text-sm text-primary",children:"auto_stories"}),m.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest text-slate-400",children:n("writing.open_archivador")})]})]},E.id))}),c&&m.jsx("div",{className:"fixed inset-0 z-[100] bg-black/80 backdrop-blur-sm flex items-center justify-center p-4",children:m.jsxs("div",{className:"bg-surface-dark border border-white/10 rounded-[2rem] p-10 w-full max-w-lg shadow-2xl animate-in zoom-in-95 duration-300",children:[m.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[m.jsx("div",{className:"size-12 rounded-2xl bg-primary flex items-center justify-center text-white shadow-xl shadow-primary/30",children:m.jsx("span",{className:"material-symbols-outlined",children:"create_new_folder"})}),m.jsxs("div",{children:[m.jsx("h2",{className:"text-2xl font-serif font-bold text-white",children:"New Archivador"}),m.jsx("p",{className:"text-[10px] text-slate-500 uppercase font-black tracking-widest",children:"Library Expansion"})]})]}),m.jsxs("form",{onSubmit:S,className:"space-y-6",children:[m.jsxs("div",{className:"space-y-2",children:[m.jsx("label",{className:"text-[10px] uppercase font-black text-slate-500 tracking-[0.2em] ml-2",children:"Book Title"}),m.jsx("input",{autoFocus:!0,className:"w-full bg-white/5 border border-white/10 rounded-2xl px-6 py-4 text-white focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all placeholder:text-slate-700",placeholder:"The Chronicles of Void...",value:p,onChange:E=>v(E.target.value),required:!0})]}),m.jsxs("div",{className:"flex gap-4 pt-4",children:[m.jsx("button",{type:"button",onClick:()=>f(!1),className:"flex-1 py-4 text-slate-400 hover:text-white font-black uppercase text-[10px] tracking-widest transition-colors",children:"Cancel"}),m.jsx("button",{type:"submit",className:"flex-[2] py-4 bg-primary hover:bg-primary-dark text-white rounded-2xl font-black uppercase text-[10px] tracking-widest shadow-xl shadow-primary/20 hover:scale-[1.02] active:scale-95 transition-all",children:"Create and Open"})]})]})]})})]})};function Tie(){const{id:t}=qi();Va();const[e,r]=ae.useState([]),[n,i]=ae.useState(!0),[a,s]=ae.useState(null);ae.useEffect(()=>{o()},[t]);const o=async()=>{try{i(!0);const c=await et.get("/api/papelera/items");r(c),s(null)}catch(c){console.error("Error loading trash:",c),s("Failed to load trash items.")}finally{i(!1)}},l=async(c,f)=>{try{await et.post(`/api/papelera/restaurar/${c}/${f}`),o()}catch(p){console.error("Restoration failed",p)}},u=async(c,f)=>{if(window.confirm("Are you sure you want to PERMANENTLY delete this item? This cannot be undone."))try{await et.delete(`/api/papelera/eliminar/${c}/${f}`),o()}catch(p){console.error("Deletion failed",p)}};return n?m.jsx("div",{className:"text-white p-8",children:"Loading Trash Bin..."}):m.jsxs("div",{className:"flex flex-col h-full bg-[#09090b] text-white p-8 overflow-y-auto",children:[m.jsx("h1",{className:"text-3xl font-light mb-2 text-white/90",children:"Trash Bin"}),m.jsx("p",{className:"text-white/50 mb-8 font-light text-sm",children:"Items are automatically deleted after 30 days."}),a&&m.jsx("div",{className:"bg-red-500/10 border border-red-500/20 text-red-400 p-4 rounded mb-6",children:a}),e.length===0?m.jsxs("div",{className:"flex flex-col items-center justify-center py-20 opacity-50 border border-dashed border-white/10 rounded-xl",children:[m.jsx("span",{className:"material-symbols-outlined text-4xl mb-2",children:"delete_outline"}),m.jsx("p",{children:"Trash is empty"})]}):m.jsx("div",{className:"bg-zinc-900/50 rounded-xl border border-white/5 overflow-hidden",children:m.jsxs("table",{className:"w-full text-left border-collapse",children:[m.jsx("thead",{children:m.jsxs("tr",{className:"border-b border-white/5 text-xs text-white/40 uppercase tracking-wider",children:[m.jsx("th",{className:"p-4 font-normal",children:"Name"}),m.jsx("th",{className:"p-4 font-normal",children:"Type"}),m.jsx("th",{className:"p-4 font-normal",children:"Deleted Date"}),m.jsx("th",{className:"p-4 font-normal text-right",children:"Actions"})]})}),m.jsx("tbody",{className:"divide-y divide-white/5",children:e.map(c=>m.jsxs("tr",{className:"hover:bg-white/5 transition-colors",children:[m.jsx("td",{className:"p-4 text-white/80 font-medium",children:c.nombre||"Untitled"}),m.jsx("td",{className:"p-4 text-white/50 text-sm",children:c.tipo}),m.jsx("td",{className:"p-4 text-white/50 text-sm font-mono",children:c.deleted_date?new Date(c.deleted_date).toLocaleDateString():"-"}),m.jsxs("td",{className:"p-4 text-right space-x-2",children:[m.jsx("button",{onClick:()=>l(c.tipo,c.id),className:"px-3 py-1.5 text-xs bg-emerald-500/10 text-emerald-400 hover:bg-emerald-500/20 rounded-md transition-colors border border-emerald-500/20",children:"RESTORE"}),m.jsx("button",{onClick:()=>u(c.tipo,c.id),className:"px-3 py-1.5 text-xs bg-red-500/10 text-red-400 hover:bg-red-500/20 rounded-md transition-colors border border-red-500/20",children:"DELETE"})]})]},`${c.tipo}-${c.id}`))})]})})]})}const Nie=({attribute:t,value:e,onChange:r,onRemove:n,linkableEntities:i=[]})=>{const a=t.plantilla||t,s=()=>{switch(a.tipo){case"text":return m.jsx("textarea",{className:"w-full bg-transparent text-white text-sm font-medium focus:outline-none resize-none no-scrollbar h-auto min-h-[100px]",value:e||"",onChange:p=>r(p.target.value),placeholder:"..."});case"short_text":return m.jsx("input",{type:"text",className:"w-full bg-transparent text-white text-sm font-medium focus:outline-none",value:e||"",onChange:p=>r(p.target.value),placeholder:"..."});case"number":return m.jsx("input",{type:"number",className:"w-full bg-transparent text-white text-sm font-medium focus:outline-none",value:e||"",onChange:p=>r(p.target.value)});case"boolean":return m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsx("button",{onClick:()=>r(e==="true"?"false":"true"),className:`size-6 rounded-lg border flex items-center justify-center transition-all ${e==="true"?"bg-primary border-primary text-white":"border-glass-border text-transparent hover:border-primary/50"}`,children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"check"})}),m.jsx("span",{className:"text-xs text-text-muted",children:e==="true"?"Enabled":"Disabled"})]});case"select":let o=[];try{o=(typeof a.metadata=="string"?JSON.parse(a.metadata||"{}"):a.metadata||{}).options||[]}catch{}return m.jsxs("div",{className:"relative",children:[m.jsxs("select",{className:"w-full bg-black/30 border border-white/5 rounded-xl px-4 py-2.5 text-sm text-white focus:outline-none focus:border-primary/50 appearance-none cursor-pointer",value:e||"",onChange:p=>r(p.target.value),children:[m.jsx("option",{value:"",className:"bg-[#1a1a20] text-white",children:"Select an option..."}),o.map((p,v)=>m.jsx("option",{value:p,className:"bg-surface-dark text-white p-2",children:p},v))]}),m.jsx("div",{className:"absolute right-4 top-1/2 -translate-y-1/2 pointer-events-none text-white/50",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"unfold_more"})})]});case"multi_select":let l=[];try{l=(typeof a.metadata=="string"?JSON.parse(a.metadata||"{}"):a.metadata||{}).options||[]}catch{}let u=[];try{u=e?JSON.parse(e):[],Array.isArray(u)||(u=[])}catch(p){console.error("Error parsing select values",p)}const c=p=>{const v=u.includes(p)?u.filter(y=>y!==p):[...u,p];r(JSON.stringify(v))};return m.jsxs("div",{className:"bg-black/20 border border-white/5 rounded-xl p-2 space-y-1 max-h-40 overflow-y-auto custom-scrollbar",children:[l.map((p,v)=>m.jsxs("label",{onClick:y=>{y.preventDefault(),c(p)},className:"flex items-center gap-3 p-2 hover:bg-white/5 rounded-lg cursor-pointer group transition-colors",children:[m.jsx("div",{className:`size-4 rounded border flex items-center justify-center transition-all ${u.includes(p)?"bg-primary border-primary":"border-white/10 group-hover:border-white/30"}`,children:u.includes(p)&&m.jsx("span",{className:"material-symbols-outlined text-[10px] text-white",children:"check"})}),m.jsx("span",{className:`text-xs font-medium ${u.includes(p)?"text-white":"text-slate-400 group-hover:text-slate-200"}`,children:p})]},v)),l.length===0&&m.jsx("div",{className:"text-xs text-slate-500 p-2 italic",children:"No options defined."})]});case"date":return m.jsx("input",{type:"date",className:"w-full bg-transparent text-white text-sm font-medium focus:outline-none [color-scheme:dark]",value:e||"",onChange:p=>r(p.target.value)});case"entity_link":return m.jsxs("div",{className:"relative",children:[m.jsxs("select",{className:"w-full bg-black/30 border border-white/5 rounded-xl px-4 py-2.5 text-sm text-white focus:outline-none focus:border-primary/50 appearance-none cursor-pointer",value:e||"",onChange:p=>r(p.target.value),children:[m.jsx("option",{value:"",className:"bg-[#1a1a20] text-white",children:"Select an Entity Link..."}),i.map(p=>m.jsx("option",{value:p.id,className:"bg-surface-dark text-white p-2",children:p.nombre},p.id))]}),m.jsx("div",{className:"absolute right-4 top-1/2 -translate-y-1/2 pointer-events-none text-white/50",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"link"})})]});case"image":return m.jsxs("div",{className:"space-y-2",children:[m.jsx("div",{className:"flex gap-2",children:m.jsx("input",{type:"text",className:"flex-1 bg-black/30 border border-white/5 rounded-xl px-4 py-2 text-xs text-text-muted focus:text-white focus:outline-none",placeholder:"Image URL...",value:e||"",onChange:p=>r(p.target.value)})}),e&&m.jsx("div",{className:"w-full aspect-video rounded-xl bg-black/40 border border-white/5 overflow-hidden relative group",children:m.jsx("img",{src:e,alt:"Preview",className:"w-full h-full object-cover opacity-80 group-hover:opacity-100 transition-opacity"})}),!e&&m.jsx("div",{className:"w-full h-20 rounded-xl bg-white/5 border border-dashed border-white/10 flex items-center justify-center text-text-muted/30",children:m.jsx("span",{className:"material-symbols-outlined",children:"image"})})]});case"table":const f=e||"[]";return m.jsxs("div",{className:"space-y-2",children:[m.jsx("textarea",{className:"w-full h-32 bg-black/30 border border-white/5 rounded-xl p-3 text-xs font-mono text-white/70 focus:outline-none focus:border-primary/50",value:f,onChange:p=>r(p.target.value),placeholder:'[{"Item": "Sword", "Qty": 1}, ...]'}),m.jsxs("div",{className:"text-[10px] text-text-muted flex justify-between",children:[m.jsx("span",{children:"JSON Format supported"}),m.jsx("span",{className:"material-symbols-outlined text-xs",children:"data_array"})]})]});default:return m.jsxs("div",{className:"text-sm font-medium text-white/70 italic p-2 rounded-lg bg-white/5 border border-white/5",children:[m.jsx("span",{className:"text-[10px] uppercase font-bold text-slate-500 mr-2",children:a.tipo}),e]})}};return m.jsxs("div",{className:"p-4 border border-white/5 rounded-2xl bg-surface-dark/50 backdrop-blur-sm relative overflow-hidden h-full flex flex-col group hover:border-primary/20 transition-all",children:[m.jsxs("label",{className:"text-[10px] font-black uppercase tracking-widest text-text-muted mb-3 flex items-center justify-between gap-2",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-xs opacity-50",children:"label"}),a.nombre]}),n&&m.jsx("button",{onClick:o=>{o.preventDefault(),n()},className:"text-white/20 hover:text-red-400 transition-colors",title:"Remove Attribute",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"close"})})]}),m.jsx("div",{className:"flex-1 nodrag",children:s()}),m.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-primary/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none"})]})},Pie=[{value:"Individual",label:"Personaje"},{value:"Group",label:"Grupo/Faccin"},{value:"Location",label:"Lugar"},{value:"Item",label:"Objeto"},{value:"Event",label:"Evento"},{value:"Timeline",label:"Lnea de Tiempo"},{value:"Map",label:"Mapa"},{value:"Structure",label:"Construccin"},{value:"Creature",label:"Criatura"},{value:"Plant",label:"Flora"}],Mie=({entityId:t,entityType:e})=>{console.log(">>> RELATIONSHIP MANAGER V2 LOADED");const[r,n]=ae.useState([]),[i,a]=ae.useState(!1),[s,o]=ae.useState(!1),[l,u]=ae.useState("Individual"),[c,f]=ae.useState([]),[p,v]=ae.useState(""),[y,S]=ae.useState(""),[w,E]=ae.useState(""),[_,T]=ae.useState(!1);ae.useEffect(()=>{t&&N()},[t,e]),ae.useEffect(()=>{s&&l&&R(l)},[s,l]);const N=async()=>{a(!0);try{const B=(await et.get("/bd/relacion")).filter(K=>K.nodoOrigenId===parseInt(t)&&(K.tipoOrigen===e||K.tipoOrigen==="GenericEntity")||K.nodoDestinoId===parseInt(t)&&(K.tipoDestino===e||K.tipoDestino==="GenericEntity")),G=await Promise.all(B.map(async K=>{const O=K.nodoOrigenId===parseInt(t),W=O?K.nodoDestinoId:K.nodoOrigenId,U=await et.get(`/world-bible/entities/${W}`);if(!U)throw new Error(`Entity ${W} not found`);return{...K,otherName:U.nombre,otherType:U.categoria||"Entity",isOutgoing:O}}));n(G)}catch(j){console.error("Failed to load relationships",j)}finally{a(!1)}},R=async j=>{T(!0);try{const G=(await et.get("/world-bible/entities")).filter(K=>(K.categoria||"Generic").toLowerCase()===j.toLowerCase()||K.tipoEspecial&&K.tipoEspecial.toLowerCase()===j.toLowerCase());f(G||[])}catch(B){console.error("Failed to fetch targets",B),f([])}finally{T(!1)}},I=async()=>{if(!(!p||!y))try{const j={nodoOrigenId:parseInt(t),tipoOrigen:e,nodoDestinoId:parseInt(p),tipoDestino:"GenericEntity",tipoRelacion:y,descripcion:w,metadata:JSON.stringify({originalCategory:l}),tipoEntidad:"relacion"};await et.put("/bd/insertar",j),o(!1),D(),N()}catch(j){console.error("Failed to save relationship",j),alert("Error saving relationship")}},F=async j=>{if(confirm("Are you sure?"))try{await et.delete(`/bd/relacion/${j}`),N()}catch(B){console.error("Failed to delete",B)}},D=()=>{u("Individual"),v(""),S(""),E("")};return m.jsxs("div",{className:"p-6 space-y-6",children:[m.jsxs("header",{className:"flex justify-between items-center",children:[m.jsx("h3",{className:"text-lg font-bold text-white uppercase tracking-widest",children:"Relationships"}),m.jsx(Dn,{variant:"secondary",icon:"add_link",onClick:()=>o(!s),children:s?"Cancel":"Connect"})]}),s&&m.jsxs("div",{className:"p-4 rounded-2xl bg-white/5 border border-white/10 space-y-4 animate-in fade-in slide-in-from-top-4",children:[m.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[m.jsxs("div",{className:"space-y-1",children:[m.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-slate-500",children:"Target Type"}),m.jsx("select",{className:"w-full bg-black/40 border border-white/10 rounded-xl p-2 text-sm text-white outline-none focus:border-primary",value:l,onChange:j=>u(j.target.value),children:Pie.map(j=>m.jsx("option",{value:j.value,className:"bg-[#1a1a20] text-white",children:j.label},j.value))})]}),m.jsxs("div",{className:"space-y-1",children:[m.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-slate-500",children:"Target Entity"}),m.jsxs("select",{className:"w-full bg-black/40 border border-white/10 rounded-xl p-2 text-sm text-white outline-none focus:border-primary",value:p,onChange:j=>v(j.target.value),disabled:_,children:[m.jsx("option",{value:"",className:"bg-[#1a1a20] text-white",children:"Select Target..."}),c.map(j=>m.jsx("option",{value:j.id,className:"bg-[#1a1a20] text-white",children:j.nombre},j.id))]})]})]}),m.jsxs("div",{className:"space-y-1",children:[m.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-slate-500",children:"Relationship Type"}),m.jsx("input",{type:"text",placeholder:"e.g. Father of, Located in, Enemy of...",className:"w-full bg-black/40 border border-white/10 rounded-xl p-2 text-sm text-white outline-none focus:border-primary",value:y,onChange:j=>S(j.target.value)})]}),m.jsxs("div",{className:"space-y-1",children:[m.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-slate-500",children:"Description (The Why)"}),m.jsx("textarea",{placeholder:"Explain the nature of this connection...",className:"w-full bg-black/40 border border-white/10 rounded-xl p-2 text-sm text-white outline-none focus:border-primary h-20 resize-none",value:w,onChange:j=>E(j.target.value)})]}),m.jsx("div",{className:"flex justify-end pt-2",children:m.jsx(Dn,{variant:"primary",icon:"save",onClick:I,disabled:!p||!y,children:"Save Connection"})})]}),m.jsx("div",{className:"space-y-3",children:i?m.jsx("div",{className:"text-center text-slate-500 py-8",children:"Scanning connections..."}):r.length===0?m.jsx("div",{className:"text-center text-slate-500 py-8 italic border border-dashed border-white/10 rounded-2xl",children:"No connections established"}):r.map((j,B)=>m.jsxs("div",{className:"group relative p-4 rounded-2xl bg-surface-dark border border-white/5 hover:border-primary/50 transition-all flex items-start gap-4",children:[m.jsx("div",{className:"mt-1",children:m.jsx("span",{className:"material-symbols-outlined text-slate-500",children:j.isOutgoing?"arrow_outward":"arrow_inward"})}),m.jsxs("div",{className:"flex-1",children:[m.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[m.jsx("span",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider",children:j.isOutgoing?"To:":"From:"}),m.jsx("span",{className:"text-sm font-bold text-white",children:j.otherName}),m.jsx("span",{className:"text-[9px] px-1.5 py-0.5 rounded bg-white/10 text-slate-400 font-bold uppercase tracking-wider",children:j.otherType})]}),m.jsx("div",{className:"text-primary text-xs font-black uppercase tracking-widest mb-2",children:j.tipoRelacion}),j.descripcion&&m.jsxs("p",{className:"text-xs text-slate-400 leading-relaxed bg-black/20 p-2 rounded-lg border border-white/5",children:['"',j.descripcion,'"']})]}),m.jsx("button",{onClick:()=>F(j.id),className:"opacity-0 group-hover:opacity-100 p-2 text-slate-600 hover:text-red-400 transition-all",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})})]},j.id||B))})]})},Aie=({templates:t,onAddTemplate:e})=>{const{t:r}=Ps(),[n,i]=ae.useState(""),a=(t||[]).filter(o=>o.label?.toLowerCase().includes(n.toLowerCase())||o.code?.toLowerCase().includes(n.toLowerCase())),s=(o,l)=>{o.dataTransfer.setData("application/reactflow/type","attribute"),o.dataTransfer.setData("templateId",l.id.toString()),o.dataTransfer.setData("templateData",JSON.stringify(l)),o.dataTransfer.effectAllowed="copy"};return m.jsxs("div",{className:"h-full flex flex-col p-4 space-y-4 animate-in fade-in slide-in-from-right-4",children:[m.jsxs("div",{className:"flex items-center gap-3 text-slate-400",children:[m.jsx("span",{className:"material-symbols-outlined",children:"dataset"}),m.jsx("h3",{className:"text-xs font-black uppercase tracking-widest",children:r("builder.attributes")||"Attributes"})]}),m.jsx("div",{className:"p-3 bg-indigo-500/10 border border-indigo-500/20 rounded-xl",children:m.jsxs("p",{className:"text-[10px] text-indigo-300 leading-relaxed flex gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm shrink-0",children:"drag_indicator"}),`Drag attributes from this list onto the entity's "Attributes" tab to add them.`]})}),m.jsxs("div",{className:"relative",children:[m.jsx("span",{className:"material-symbols-outlined absolute left-3 top-2.5 text-slate-500 text-sm",children:"search"}),m.jsx("input",{className:"w-full bg-black/30 border border-white/10 rounded-xl py-2 pl-9 pr-4 text-xs text-white focus:border-primary/50 outline-none",placeholder:"Search templates...",value:n,onChange:o=>i(o.target.value)})]}),m.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar space-y-2 pr-1",children:a.length===0?m.jsx("div",{className:"text-center py-8 text-slate-600 text-xs italic",children:"No templates found."}):a.map(o=>m.jsxs("div",{draggable:!0,onDragStart:l=>s(l,o),className:"bg-[#1a1a20] hover:bg-white/5 border border-white/5 hover:border-white/20 rounded-lg p-3 cursor-grab active:cursor-grabbing transition-all group",children:[m.jsxs("div",{className:"flex items-center justify-between mb-1",children:[m.jsx("span",{className:"text-xs font-bold text-slate-200 group-hover:text-white",children:o.label}),m.jsx("span",{className:"material-symbols-outlined text-slate-600 text-xs",children:"drag_pan"})]}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("div",{className:`text-[8px] font-black px-1.5 py-0.5 rounded uppercase tracking-wider ${o.tipoDato==="text"?"bg-blue-500/20 text-blue-300":o.tipoDato==="number"?"bg-emerald-500/20 text-emerald-300":o.tipoDato==="boolean"?"bg-purple-500/20 text-purple-300":"bg-slate-500/20 text-slate-300"}`,children:o.tipoDato}),o.esObligatorio&&m.jsx("span",{className:"text-[8px] font-black text-rose-400 uppercase",children:"*Req"})]})]},o.id))}),m.jsx("div",{className:"pt-2 border-t border-white/5 text-center",children:m.jsx("p",{className:"text-[10px] text-slate-600",children:"Manage templates in Bible Settings"})})]})},Vg=({mode:t})=>{const{username:e,projectName:r,entitySlug:n,folderSlug:i,type:a}=qi(),s=Va(),o=t==="creation",{setRightOpen:l,setRightPanelTab:u,setAvailableTemplates:c,setAddAttributeHandler:f}=nl(),[p,v]=ae.useState({nombre:"",tipo:"entidadindividual",descripcion:"",color:"#6366f1",apariencia:"",notas:"",iconUrl:null,tipoEspecial:a||null,carpeta:null,categoria:"Individual"}),[y,S]=ae.useState([]),[w,E]=ae.useState(!0),[_,T]=ae.useState(!1),[N,R]=ae.useState([]),[I,F]=ae.useState([]),[D,j]=ae.useState("identity"),[B,G]=ae.useState(!1),[K,O]=ae.useState(null);ae.useEffect(()=>{l(!0),u&&u("CONTEXT");const J=setInterval(()=>{const ie=document.getElementById("global-right-panel-portal");ie&&(O(ie),clearInterval(J))},100);return()=>{clearInterval(J),u&&u("NOTEBOOKS")}},[]),ae.useEffect(()=>{o?U():q()},[n,i,o]);const W=J=>{c(J),F(J),f(ie=>{const de=J.find(he=>he.id===ie);de&&S(he=>[...he,{id:`temp-${de.id}-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,attribute:de,value:de.valorDefecto||"",isTemp:!0}])})},U=async()=>{E(!0);try{const J=await et.get(`/world-bible/folders/${i}`),ie=await et.get(`/world-bible/folders/${i}/templates`);W(ie),v(he=>({...he,nombre:`Nuevo ${a==="map"?"Mapa":a==="timeline"?"Cronograma":"Ente"}`,carpeta:J,tipoEspecial:a||"entidadindividual",tipo:a||"entidadindividual"}));const de=ie.filter(he=>he.esObligatorio).map(he=>({id:`temp-${he.id}-${Math.random().toString(36).substr(2,9)}`,attribute:he,value:he.valorDefecto||"",isTemp:!0}));S(de)}catch(J){console.error("Error creating draft:",J)}finally{E(!1)}},q=async()=>{E(!0);try{const J=await et.get(`/world-bible/entities/${n}`);if(v({...J,apariencia:J.apariencia||"",notas:J.notas||"",iconUrl:J.iconUrl||null,tags:J.tags||"",tipo:J.tipoEspecial||Rie(J.tipo).id,color:J.color||"#6366f1",categoria:J.categoria||"Individual",attributes:J.attributes||{}}),J.carpeta?.id){const de=await et.get(`/world-bible/folders/${J.carpeta.id}/templates`);W(de)}const ie=(J.valores||[]).filter(de=>de.plantilla).map(de=>({id:de.id.toString(),attribute:de.plantilla,value:de.valor,isTemp:!1}));S(ie)}catch(J){console.error("Error loading entity:",J)}finally{E(!1)}},Z=(J,ie)=>{v(de=>({...de,[J]:ie}))},Q=J=>{const ie=J.target.files[0];if(ie){const de=new FileReader;de.onloadend=()=>{Z("iconUrl",de.result)},de.readAsDataURL(ie)}},ne=(J,ie)=>{S(de=>de.map(he=>he.id===J?{...he,value:ie}:he))},re=J=>{J.toString().startsWith("temp-")||R(ie=>[...ie,J]),S(ie=>ie.filter(de=>de.id!==J))},Y=async(J=!0)=>{T(!0);try{const ie={nombre:p.nombre,descripcion:p.descripcion,tags:p.tags,apariencia:p.apariencia,notas:p.notas,iconUrl:p.iconUrl,tipoEspecial:p.tipoEspecial||"entidadindividual",color:p.color,categoria:p.categoria,attributes:p.attributes};let de=p.id;if(o){if(!p.carpeta&&!i){alert("Error: Missing context (no folder). Redirecting."),s(`/${e}/${r}/bible`);return}if(ie.carpetaId=p.carpeta?.id,!ie.carpetaId&&i)try{const ge=await et.get(`/world-bible/folders/${i}`);ie.carpetaId=ge.id}catch(ge){console.error("Could not resolve folder",ge)}const fe=await et.post("/world-bible/entities",ie);de=fe.id;const ve=[...y];for(let ge=0;ge<ve.length;ge++){const se=ve[ge];if(se.isTemp)try{const ye=await et.post(`/world-bible/entities/${fe.id}/attributes`,{plantillaId:se.attribute.id});await et.patch(`/world-bible/entities/${fe.id}/values`,[{valorId:ye.id,nuevoValor:se.value}]),ve[ge]={...se,id:ye.id.toString(),isTemp:!1}}catch(ye){console.error("Attr save failed",ye)}}if(S(ve),T(!1),J){const ge=fe.carpeta?fe.carpeta.slug||fe.carpeta.id:i;s(`/${e}/${r}/bible/folder/${ge}`)}else{const ge=fe.carpeta?fe.carpeta.slug||fe.carpeta.id:i;s(`/${e}/${r}/bible/folder/${ge}/entity/${fe.slug||fe.id}`,{replace:!0})}return}await et.put(`/world-bible/entities/${de}`,{nombre:ie.nombre,color:ie.color,iconUrl:ie.iconUrl}),await et.patch(`/world-bible/entities/${de}/details`,{descripcion:ie.descripcion,tags:ie.tags,apariencia:ie.apariencia,notas:ie.notas,iconUrl:ie.iconUrl,attributes:ie.attributes}),N.length>0&&(await Promise.all(N.map(fe=>et.delete(`/world-bible/values/${fe}`))),R([]));const he=y.filter(fe=>!fe.isTemp).map(fe=>({valorId:parseInt(fe.id),nuevoValor:fe.value}));he.length>0&&await et.patch(`/world-bible/entities/${de}/values`,he);let xe=!1;const le=[...y];for(let fe=0;fe<le.length;fe++){const ve=le[fe];if(ve.isTemp)try{const ge=await et.post(`/world-bible/entities/${de}/attributes`,{plantillaId:ve.attribute.id});await et.patch(`/world-bible/entities/${de}/values`,[{valorId:ge.id,nuevoValor:ve.value}]),le[fe]={...ve,id:ge.id.toString(),isTemp:!1},xe=!0}catch(ge){console.error("Error saving field:",ve,ge)}}if(xe&&S(le),T(!1),J){const ve=i||(p.carpeta?p.carpeta.slug||p.carpeta.id:"root")||"root";s(`/${e}/${r}/bible/folder/${ve}`)}}catch(ie){console.error("Save error",ie),T(!1)}};return w?m.jsx("div",{className:"p-20 text-center animate-pulse",children:"Loading Builder..."}):m.jsx("div",{className:"flex h-full w-full bg-background-dark overflow-hidden",children:m.jsxs("div",{className:"flex-1 flex flex-col min-w-0 overflow-y-auto custom-scrollbar relative",children:[m.jsxs("div",{className:"border-b border-white/5 p-4 flex justify-between items-center bg-background-dark/80 backdrop-blur sticky top-0 z-30",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx(rx,{url:p.iconUrl,name:p.nombre,className:"size-10 rounded-lg border border-white/10"}),m.jsxs("div",{children:[m.jsx("h1",{className:"text-lg font-bold text-white leading-tight",children:p.nombre||"Sin Nombre"}),m.jsx("span",{className:"text-[10px] uppercase font-black tracking-widest text-slate-500",children:o?"Creando Nueva Entidad":"Editando Entidad"})]})]}),m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsx("button",{onClick:()=>s(`/${e}/${r}/bible/folder/${i}`),className:"px-4 py-2 rounded-xl text-slate-400 hover:text-white hover:bg-white/5 text-xs font-bold uppercase tracking-widest transition-all",children:"Cancelar"}),m.jsxs("div",{className:"flex bg-white/5 rounded-xl p-1 gap-1 border border-white/10",children:[m.jsxs("button",{onClick:()=>Y(!0),disabled:_,className:"h-9 px-4 rounded-lg bg-primary hover:bg-primary-light text-white text-[10px] font-black uppercase tracking-widest transition-all flex items-center gap-2 disabled:opacity-50",children:[_?m.jsx("span",{className:"material-symbols-outlined animate-spin text-sm",children:"refresh"}):m.jsx("span",{className:"material-symbols-outlined text-sm",children:"save"}),"Guardar"]}),m.jsx("div",{className:"w-px bg-white/10 my-1"}),m.jsx("button",{onClick:()=>Y(!1),disabled:_,className:"h-9 px-3 rounded-lg bg-transparent hover:bg-white/10 text-white transition-all flex items-center justify-center disabled:opacity-50",title:"Guardar y Seguir Editando",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"edit_document"})})]})]})]}),K&&xo.createPortal(m.jsx(Aie,{templates:I,onAddTemplate:J=>{S(ie=>[...ie,{id:`temp-${J.id}-${Date.now()}`,attribute:J,value:J.valorDefecto||"",isTemp:!0}])}}),K),m.jsx("div",{className:"flex border-b border-white/5 px-8 gap-6 bg-background-dark/80 backdrop-blur sticky top-[73px] z-20",children:["identity","narrative","attributes"].map(J=>m.jsx("button",{onClick:()=>j(J),className:`py-4 text-[10px] font-black uppercase tracking-widest border-b-2 transition-colors ${D===J?"border-primary text-primary":"border-transparent text-slate-500 hover:text-white"}`,children:J},J))}),m.jsxs("div",{className:"p-8 pb-32 max-w-5xl mx-auto w-full",children:[D==="identity"&&m.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[m.jsxs(ti,{className:`p-6 space-y-6 ${p.tipoEspecial==="map"?"lg:col-span-2":""}`,children:[m.jsxs("h3",{className:"text-xs font-black uppercase tracking-widest text-primary flex items-center gap-2 mb-6",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"badge"})," Identity"]}),m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{children:[m.jsx("label",{className:"text-[10px] uppercase font-bold text-slate-500 mb-1 block",children:"Full Name"}),m.jsx("input",{value:p.nombre,onChange:J=>Z("nombre",J.target.value),className:"w-full bg-black/30 border border-white/10 rounded-xl p-3 text-sm text-white focus:border-primary/50 outline-none transition-colors",placeholder:"E.g. King Alaric"})]}),m.jsxs("div",{children:[m.jsx("label",{className:"text-[10px] uppercase font-bold text-slate-500 mb-1 block",children:"Entity Type / Category"}),m.jsxs("select",{value:p.categoria||"Individual",onChange:J=>Z("categoria",J.target.value),className:"w-full bg-black/30 border border-white/10 rounded-xl p-3 text-sm text-white focus:border-primary/50 outline-none transition-colors appearance-none",children:[m.jsx("option",{className:"bg-[#1a1a20] text-white",value:"Individual",children:"Individual (Character/Person)"}),m.jsx("option",{className:"bg-[#1a1a20] text-white",value:"Group",children:"Group / Faction"}),m.jsx("option",{className:"bg-[#1a1a20] text-white",value:"Location",children:"Location"}),m.jsx("option",{className:"bg-[#1a1a20] text-white",value:"Event",children:"Event"}),m.jsx("option",{className:"bg-[#1a1a20] text-white",value:"Object",children:"Object / Item"}),m.jsx("option",{className:"bg-[#1a1a20] text-white",value:"Concept",children:"Concept / Magic"})]})]}),m.jsxs("div",{children:[m.jsx("label",{className:"text-[10px] uppercase font-bold text-slate-500 mb-1 block",children:"Tags (comma separated)"}),m.jsx("input",{value:p.tags,onChange:J=>Z("tags",J.target.value),className:"w-full bg-black/30 border border-white/10 rounded-xl p-3 text-sm text-slate-300 focus:border-primary/50 outline-none transition-colors",placeholder:"Warrior, Leader, Human..."})]}),m.jsxs("div",{children:[m.jsx("label",{className:"text-[10px] uppercase font-bold text-slate-500 mb-1 block",children:"Icon / Portrait"}),m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx(rx,{url:p.iconUrl,name:p.nombre,size:"lg",className:"rounded-xl"}),m.jsxs("label",{className:"cursor-pointer px-4 py-2 bg-white/5 hover:bg-white/10 rounded-lg border border-white/10 text-xs font-bold text-slate-300 transition-colors",children:["Upload Image",m.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:Q})]}),p.iconUrl&&m.jsx("button",{onClick:()=>Z("iconUrl",""),className:"p-2 hover:text-red-400 transition-colors",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})})]})]})]})]}),p.tipoEspecial!=="map"&&m.jsxs(ti,{className:"p-6 space-y-6",children:[m.jsxs("div",{className:"flex justify-between items-center mb-6",children:[m.jsxs("h3",{className:"text-xs font-black uppercase tracking-widest text-primary flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"palette"})," Appearance"]}),m.jsx("div",{className:"flex gap-2",children:m.jsxs("label",{className:"cursor-pointer text-[10px] font-bold uppercase tracking-wider text-slate-500 hover:text-white transition-colors flex items-center gap-1",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"add_photo_alternate"}),"Insert Image",m.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:J=>{const ie=J.target.files[0];if(ie){const de=new FileReader;de.onloadend=()=>{const he=`

![${ie.name}](${de.result})
`;Z("apariencia",(p.apariencia||"")+he)},de.readAsDataURL(ie)}}})]})})]}),m.jsx("textarea",{value:p.apariencia,onChange:J=>Z("apariencia",J.target.value),className:"w-full h-80 bg-black/30 border border-white/10 rounded-xl p-4 text-sm text-slate-300 leading-relaxed focus:border-primary/50 outline-none transition-colors custom-scrollbar font-mono",placeholder:"Describe their physical appearance, clothing, distinct marks... (Markdown Supported)"})]}),p.tipoEspecial==="map"&&m.jsxs(ti,{className:"p-6 lg:col-span-2 space-y-6",children:[m.jsxs("h3",{className:"text-xs font-black uppercase tracking-widest text-primary flex items-center gap-2 mb-6",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"map"})," Cartography"]}),m.jsx("div",{onClick:()=>{G(!0)},className:"w-full aspect-[21/9] bg-black/30 border border-white/10 rounded-xl overflow-hidden cursor-pointer group relative",children:(()=>{let J=p.attributes?.snapshotUrl||p.attributes?.bgImage||p.iconUrl;if(!J)try{const ie=JSON.parse(p.descripcion||"{}");ie.snapshotUrl&&(J=ie.snapshotUrl)}catch{}return J?m.jsxs(m.Fragment,{children:[m.jsx("img",{src:J,alt:"Map Preview",className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"}),m.jsx("div",{className:"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center",children:m.jsx("span",{className:"material-symbols-outlined text-white text-3xl",children:"zoom_in"})})]}):m.jsx("div",{className:"w-full h-full flex items-center justify-center text-slate-500 text-xs italic",children:"No map preview available"})})()}),m.jsx("div",{className:"flex justify-end",children:m.jsx(Dn,{variant:"secondary",size:"sm",icon:"edit",onClick:()=>window.open(`/${e}/${r}/map-editor/edit/${p.id}`,"_self"),children:"Open Editor"})})]}),p.tipoEspecial!=="map"&&m.jsxs(ti,{className:"p-6 lg:col-span-2",children:[m.jsxs("h3",{className:"text-xs font-black uppercase tracking-widest text-primary flex items-center gap-2 mb-6",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"sticky_note_2"})," Quick Notes"]}),m.jsx("textarea",{className:"w-full h-40 bg-black/30 border border-white/10 rounded-xl p-4 text-sm text-slate-300 leading-relaxed resize-none focus:border-primary/50 outline-none transition-colors custom-scrollbar font-mono placeholder:text-slate-600",placeholder:"Quick notes about this entity...",value:p.notas||"",onChange:J=>Z("notas",J.target.value)})]})]}),D==="narrative"&&m.jsxs("div",{className:"animate-in fade-in duration-500 space-y-8",children:[m.jsxs(ti,{className:"min-h-[40vh] flex flex-col p-8",children:[m.jsxs("div",{className:"flex items-center justify-between mb-6",children:[m.jsxs("h3",{className:"text-xs font-black uppercase tracking-widest text-primary flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"history_edu"})," Biography"]}),m.jsx("span",{className:"text-[10px] text-slate-500 bg-white/5 px-2 py-1 rounded",children:"Markdown Supported"})]}),m.jsx("textarea",{className:"flex-1 w-full bg-transparent border-none outline-none text-slate-300 leading-relaxed resize-none focus:ring-0 placeholder:text-slate-600 custom-scrollbar text-base min-h-[300px]",placeholder:"Write the origin story...",value:p.descripcion||"",onChange:J=>Z("descripcion",J.target.value)})]}),m.jsxs(ti,{className:"min-h-[40vh]",children:[m.jsxs("h3",{className:"text-xs font-black uppercase tracking-widest text-primary p-6 pb-0 flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"hub"})," Relationships"]}),o?m.jsxs("div",{className:"p-12 text-center text-slate-500",children:[m.jsx("span",{className:"material-symbols-outlined text-4xl mb-4",children:"save_as"}),m.jsx("p",{className:"text-sm font-bold",children:"Please save the entity first to manage relationships."})]}):m.jsx(Mie,{entityId:p.id,entityType:p.tipo||"entidadindividual"})]})]}),D==="attributes"&&m.jsxs("div",{className:`animate-in fade-in duration-500 space-y-6 min-h-[50vh] transition-colors rounded-2xl p-4 ${window.isDraggingOver?"bg-primary/10 border-2 border-dashed border-primary":""}`,onDragOver:J=>{J.preventDefault(),J.dataTransfer.dropEffect="copy",J.currentTarget.classList.add("bg-primary/10","border-primary","border-dashed","border-2")},onDragLeave:J=>{J.preventDefault(),J.currentTarget.classList.remove("bg-primary/10","border-primary","border-dashed","border-2")},onDrop:J=>{if(J.preventDefault(),J.currentTarget.classList.remove("bg-primary/10","border-primary","border-dashed","border-2"),J.dataTransfer.getData("application/reactflow/type")!=="attribute")return;let de=null;try{const he=J.dataTransfer.getData("templateData");if(he)de=JSON.parse(he);else{const xe=parseInt(J.dataTransfer.getData("templateId"));de=I.find(le=>le.id===xe)}}catch(he){console.error("Drop error",he)}de&&S(he=>[...he,{id:`temp-${de.id}-${Date.now()}`,attribute:de,value:de.valorDefecto||"",isTemp:!0}])},children:[m.jsxs("h3",{className:"text-xs font-black uppercase tracking-widest text-primary border-b border-white/5 pb-4 flex items-center justify-between",children:[m.jsx("span",{children:"Atributos especiales"}),m.jsx("span",{className:"text-[10px] text-slate-500 font-normal normal-case opacity-50 hidden md:block",children:"Arraste atributos desde el panel derecho"})]}),m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 p-4 border-2 border-dashed border-white/5 rounded-2xl hover:border-primary/20 transition-colors bg-white/[0.01]",children:[y.length===0&&m.jsxs("div",{className:"col-span-full py-12 text-center text-slate-500 text-sm pointer-events-none",children:[m.jsx("span",{className:"material-symbols-outlined text-4xl mb-2 opacity-50",children:"drag_indicator"}),m.jsx("p",{children:"Arrastra plantillas aqu para aadir atributos"})]}),y.filter(J=>J.attribute).map(J=>m.jsx(Nie,{attribute:J.attribute,value:J.value,onChange:ie=>ne(J.id,ie),onRemove:()=>re(J.id)},J.id))]})]})]}),B&&p.iconUrl&&m.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/90 backdrop-blur-sm animate-in fade-in duration-300",onClick:()=>G(!1),children:m.jsxs("div",{className:"relative max-w-[90vw] max-h-[90vh] p-2",children:[m.jsx("button",{onClick:()=>G(!1),className:"absolute -top-12 right-0 p-2 text-white hover:text-primary transition-colors",children:m.jsx("span",{className:"material-symbols-outlined text-3xl",children:"close"})}),m.jsx("img",{src:p.iconUrl,alt:p.nombre,className:"max-w-full max-h-[85vh] object-contain rounded-lg shadow-2xl border border-white/10",onClick:J=>J.stopPropagation()})]})})]})})},Rie=t=>({id:t,label:t}),Lie=t=>{switch(t?.toLowerCase()){case"text":return"notes";case"short_text":return"short_text";case"number":return"pin";case"date":return"calendar_today";case"select":return"list";case"boolean":return"check_box";case"map":return"map";case"timeline":return"timeline";case"character":case"entidadindividual":return"person";case"location":case"zona":case"construccion":return"location_on";case"culture":case"entidadcolectiva":return"groups";case"universe":case"galaxy":case"system":case"planet":return"public";case"entity_link":return"link";default:return"description"}},Jg=({item:t,type:e,linkTo:r,onContextMenu:n,onDelete:i})=>{const a=e==="folder";return m.jsxs(hh,{to:r,onContextMenu:n,className:"group relative flex flex-col p-4 rounded-3xl bg-surface-dark border border-glass-border hover:border-primary/50 hover:bg-white/5 transition-all duration-300 backdrop-blur-sm overflow-hidden",children:[t.iconUrl&&m.jsxs(m.Fragment,{children:[m.jsx("div",{className:"absolute inset-0 z-0",children:m.jsx("img",{src:t.iconUrl,alt:"",className:"w-full h-full object-cover opacity-60 group-hover:scale-105 transition-transform duration-700"})}),m.jsx("div",{className:"absolute inset-0 z-0 bg-gradient-to-t from-[#0a0a0c] via-[#0a0a0c]/80 to-transparent"})]}),m.jsxs("div",{className:"relative z-10 flex items-start justify-between mb-4",children:[m.jsx("div",{className:`
                    size-12 rounded-2xl flex items-center justify-center text-xl transition-transform group-hover:scale-110 
                    ${a?"bg-primary/20 text-primary":"bg-white/5 text-text-muted group-hover:text-white backdrop-blur-md border border-white/5"}
                `,children:m.jsx("span",{className:"material-symbols-outlined",children:a?"folder":Lie(t.tipoEspecial)})}),a&&m.jsx("div",{className:"px-2 py-1 rounded-lg bg-surface-light/50 border border-glass-border text-[10px] font-black text-white shadow-sm backdrop-blur-md",children:t.itemCount||0})]}),m.jsxs("div",{className:"relative z-10 mt-auto",children:[m.jsx("h3",{className:"text-sm font-bold text-white truncate group-hover:text-primary transition-colors drop-shadow-md",children:t.nombre}),m.jsx("p",{className:"text-[10px] font-bold uppercase tracking-widest text-text-muted mt-1 opacity-70 group-hover:opacity-100 transition-opacity",children:a?"Folder":t.tipoEspecial||"Entity"})]}),m.jsxs("div",{className:"absolute top-4 right-4 z-20 flex items-center gap-2 opacity-0 group-hover:opacity-100 transition-opacity duration-300",children:[i&&m.jsx("button",{onClick:s=>{s.preventDefault(),s.stopPropagation(),i(t)},className:"p-1.5 rounded-lg bg-red-500/10 hover:bg-red-500 text-red-500 hover:text-white transition-all border border-red-500/20 shadow-lg shadow-red-500/5 group/del backdrop-blur-md",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})}),m.jsx("span",{className:"material-symbols-outlined text-primary text-sm transform group-hover:translate-x-1 transition-transform drop-shadow-md",children:"arrow_forward"})]})]})},Oie=({path:t,currentFolder:e})=>{const{username:r,projectName:n}=qi(),i=`/${r}/${n}/bible`;return!t&&!e?null:m.jsxs("nav",{className:"flex items-center gap-2 text-[10px] uppercase font-bold tracking-wider text-slate-500 mb-4 overflow-x-auto no-scrollbar whitespace-nowrap",children:[m.jsxs(hh,{to:i,className:"hover:text-primary transition-colors flex items-center gap-1",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"home"}),"Bible"]}),t&&t.map((a,s)=>m.jsxs(nr.Fragment,{children:[m.jsx("span",{className:"text-slate-700",children:"/"}),m.jsx(hh,{to:`${i}/folder/${a.slug||a.id}`,className:"hover:text-primary transition-colors",children:a.nombre})]},a.id)),e&&m.jsxs(m.Fragment,{children:[m.jsx("span",{className:"text-slate-700",children:"/"}),m.jsx("span",{className:"text-white bg-white/5 px-2 py-0.5 rounded",children:e.nombre})]})]})},Die=({entities:t=[],onAddEvent:e})=>{const r=[...t].sort((n,i)=>n.id-i.id);return m.jsx("div",{className:"w-full max-w-3xl mx-auto p-4 animate-slide-up",children:m.jsxs("div",{className:"relative border-l-2 border-white/10 ml-6 space-y-12 py-8",children:[r.length===0&&m.jsx("div",{className:"pl-12 opacity-50",children:m.jsx("p",{className:"text-white text-sm",children:"No events recorded in this timeline yet."})}),r.map((n,i)=>m.jsxs("div",{className:"relative pl-12 group",children:[m.jsx("div",{className:"absolute left-[-9px] top-0 size-4 rounded-full bg-background-dark border-2 border-primary group-hover:scale-125 group-hover:bg-primary transition-all shadow-[0_0_10px_rgba(99,102,241,0.3)]"}),m.jsxs(ti,{className:"p-6 border-white/5 hover:border-primary/30 transition-all hover:-translate-y-1 cursor-pointer",children:[m.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:n.nombre}),m.jsx("p",{className:"text-sm text-text-muted leading-relaxed line-clamp-3",children:n.descripcion||"No description provided."})]})]},n.id)),m.jsxs("div",{onClick:e,className:"relative pl-12 group cursor-pointer opacity-50 hover:opacity-100 transition-opacity",children:[m.jsx("div",{className:"absolute left-[-9px] top-2 size-4 rounded-full bg-background-dark border-2 border-dashed border-white/30"}),m.jsxs("div",{className:"p-4 border-2 border-dashed border-white/10 rounded-2xl flex items-center justify-center text-text-muted hover:border-primary/50 hover:text-white transition-all",children:[m.jsx("span",{className:"material-symbols-outlined mr-2",children:"add_circle"}),m.jsx("span",{className:"text-xs font-black uppercase tracking-widest",children:"Add Historical Event"})]})]})]})})},sh={UNIVERSE:{id:"UNIVERSE",label:"Universo / Multiverso",description:"Contenedor supremo de realidades.",icon:"public",color:"text-purple-400",bgColor:"bg-purple-900/20"},GALAXY:{id:"GALAXY",label:"Galaxia",description:"Agrupacin masiva de sistemas estelares.",icon:"auto_awesome",color:"text-indigo-400",bgColor:"bg-indigo-900/20"},SYSTEM:{id:"SYSTEM",label:"Sistema Solar",description:"Estrella central y sus cuerpos orbitales.",icon:"wb_sunny",color:"text-yellow-400",bgColor:"bg-yellow-900/20"},PLANET:{id:"PLANET",label:"Planeta / Mundo",description:"Cuerpo celeste o plano de existencia principal.",icon:"public",color:"text-emerald-400",bgColor:"bg-emerald-900/20"},GEOGRAPHY:{id:"GEOGRAPHY",label:"Geografa",icon:"map",color:"text-green-300"},ENTITIES:{id:"ENTITIES",label:"Entidades",icon:"groups",color:"text-blue-300"},MAGIC:{id:"MAGIC",label:"Magia",icon:"auto_fix_high",color:"text-pink-300"},TIMELINE:{id:"TIMELINE",label:"Cronologa",icon:"history",color:"text-orange-300"},FACTIONS:{id:"FACTIONS",label:"Facciones",icon:"security",color:"text-red-300"},ITEMS:{id:"ITEMS",label:"Objetos",icon:"inventory_2",color:"text-gray-300"},FOLDER:{id:"FOLDER",label:"Carpeta",icon:"folder",color:"text-gray-400"}},Vk=t=>sh[t]||sh.FOLDER,Iie=()=>{const{username:t,projectName:e,folderSlug:r}=qi(),n=Va(),{handleCreateEntity:i,handleDeleteEntity:a,handleDeleteFolder:s,handleCreateSimpleFolder:o,folderSearchTerm:l,folderFilterType:u}=nl(),[c,f]=ae.useState([]),[p,v]=ae.useState([]),[y,S]=ae.useState(null),[w,E]=ae.useState([]),[_,T]=ae.useState(!0),[N,R]=ae.useState(!1),I=c.filter(G=>{const K=G.nombre.toLowerCase().includes(l||""),O=u==="ALL"||u==="MAP"&&G.tipoEspecial==="map"||u==="TIMELINE"&&G.tipoEspecial==="timeline"||u==="ENTITY"&&(!G.tipoEspecial||G.tipoEspecial==="entidadindividual");return K&&O}),F=p.filter(G=>G.nombre.toLowerCase().includes(l||"")&&u==="ALL");ae.useEffect(()=>{const G=K=>{const{folderId:O,removeId:W,type:U,item:q,expand:Z}=K.detail||{};O===(y?.id||r)&&(W?U==="folder"?v(Q=>Q.filter(ne=>ne.id!==W)):f(Q=>Q.filter(ne=>ne.id!==W)):q&&q.slug&&q.slug!==r?n(`/${t}/${e}/bible/folder/${q.slug}`,{replace:!0}):D())};return window.addEventListener("folder-update",G),()=>window.removeEventListener("folder-update",G)},[r,y?.id]),ae.useEffect(()=>{D()},[r]);const D=async()=>{T(!0);try{const[G,K,O]=await Promise.all([et.get(`/world-bible/folders/${r}/entities`),et.get(`/world-bible/folders/${r}/subfolders`),et.get(`/world-bible/folders/${r}`)]);f(G),v(K||[]),O.folder?(S(O.folder),E(O.path||[])):(S(O||{name:"Folder"}),E([]))}catch(G){console.error("Error loading folder content:",G),S(null),E([])}finally{T(!1)}};if(_)return m.jsx("div",{className:"p-20 text-center animate-pulse text-text-muted",children:"Loading sector..."});if(!y)return m.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-20 text-text-muted",children:[m.jsx("span",{className:"material-symbols-outlined text-6xl mb-4 opacity-20",children:"folder_off"}),m.jsx("h2",{className:"text-xl font-bold opacity-50",children:"Folder Not Found"}),m.jsx("p",{className:"text-sm opacity-30 mt-2",children:"The sector you are looking for does not exist or has been moved."}),m.jsx(hh,{to:`/${t}/${e}/bible`,className:"mt-6 px-6 py-2 bg-white/5 hover:bg-white/10 rounded-full text-xs font-bold transition-colors",children:"Return to Root"})]});const j=y&&y.tipo&&(["UNIVERSE","GALAXY","SYSTEM","PLANET"].includes(y.tipo)||y.tipo==="MAGIC"),B=y?Vk(y.tipo):sh.FOLDER;return j?m.jsxs("div",{className:"flex-1 overflow-y-auto bg-[#0a0a0c] text-white w-full h-full relative",children:[m.jsxs("div",{className:`w-full min-h-[300px] ${B.bgColor} relative flex items-end p-10 border-b border-white/5`,children:[m.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-[#0a0a0c] to-transparent opacity-80 pointer-events-none"}),m.jsx("div",{className:"absolute top-6 left-10 z-20",children:m.jsx(Oie,{path:w,currentFolder:y})}),m.jsxs("div",{className:"relative z-10 flex gap-8 items-end w-full max-w-7xl mx-auto",children:[m.jsx("div",{className:`w-32 h-32 rounded-3xl ${B.bgColor} border border-white/10 flex items-center justify-center shadow-2xl`,children:m.jsx("span",{className:`material-symbols-outlined text-6xl ${B.color}`,children:B.icon})}),m.jsxs("div",{className:"flex-1 mb-2",children:[m.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[m.jsx("div",{className:`px-3 py-1 rounded-full text-[10px] font-black uppercase tracking-widest border border-white/10 ${B.bgColor} ${B.color}`,children:B.label}),m.jsxs("span",{className:"text-white/30 text-xs font-mono tracking-widest uppercase",children:["ID: ",y.id]})]}),m.jsx("h1",{className:"text-6xl font-black tracking-tighter text-white mb-2",children:y.nombre}),m.jsx("p",{className:"text-lg text-white/50 max-w-2xl font-light leading-relaxed",children:y.descripcion||"Sin descripcin definida para este sector cosmolgico."})]}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsxs("button",{onClick:()=>n(`/${t}/${e}/bible/folder/${r}/entity/new/entidadindividual`),className:"px-4 py-2 bg-primary/20 hover:bg-primary/30 text-primary rounded-xl text-[10px] font-black uppercase tracking-widest flex items-center gap-2 transition-all",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"person_add"})," Nueva Entidad"]}),m.jsxs("button",{onClick:()=>n(`/${t}/${e}/map-editor/create/${r}`,{state:{folderId:y?.id}}),className:"px-4 py-2 bg-white/5 hover:bg-white/10 text-white rounded-xl text-[10px] font-black uppercase tracking-widest flex items-center gap-2 transition-all border border-glass-border",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"map"})," Mapa"]})]})]})]}),m.jsxs("div",{className:"max-w-7xl mx-auto p-10 grid grid-cols-1 lg:grid-cols-3 gap-8",children:[m.jsxs("div",{className:"space-y-6",children:[m.jsxs("div",{className:"bg-[#13141f] border border-white/5 rounded-2xl p-6",children:[m.jsx("h3",{className:"text-xs font-bold text-white/40 uppercase tracking-widest mb-4",children:"Estadsticas"}),m.jsx("div",{className:"grid grid-cols-2 gap-4",children:m.jsxs("div",{children:[m.jsx("div",{className:"text-2xl font-black text-white",children:c.length+p.length}),m.jsx("div",{className:"text-[10px] text-white/40 uppercase",children:"Elementos"})]})})]}),m.jsxs("div",{className:"bg-[#13141f] border border-white/5 rounded-2xl p-6 h-64 flex flex-col",children:[m.jsx("h3",{className:"text-xs font-bold text-white/40 uppercase tracking-widest mb-4",children:"Notas Rpidas"}),m.jsx("textarea",{className:"flex-1 bg-transparent resize-none outline-none text-sm text-white/70 placeholder-white/20",placeholder:"Escribir notas de la zona..."})]})]}),m.jsxs("div",{className:"lg:col-span-2",children:[m.jsx("h3",{className:"text-xs font-bold text-white/40 uppercase tracking-widest mb-4",children:"Contenido Interno"}),c.length===0&&p.length===0&&m.jsxs("div",{className:"p-12 border border-dashed border-white/10 rounded-2xl text-center",children:[m.jsx("span",{className:"material-symbols-outlined text-4xl text-white/20 mb-2",children:"folder_open"}),m.jsx("p",{className:"text-white/30 text-sm",children:"Este sector est vaco."})]}),m.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[F.map(G=>m.jsx(Jg,{item:G,type:"folder",linkTo:`/${t}/${e}/bible/folder/${G.slug||G.id}`,onDelete:()=>s(G.id,y?.id||r)},G.id)),I.map(G=>m.jsx(Jg,{item:G,type:"entity",linkTo:`/${t}/${e}/bible/folder/${y.slug||r}/entity/${G.slug||G.id}`,onDelete:()=>a(G.id,y?.id||r)},G.id))]})]})]})]}):m.jsxs("div",{className:"flex-1 p-8 max-w-[1600px] mx-auto w-full h-full overflow-y-auto",children:[m.jsxs("header",{className:"mb-8 flex items-end justify-between",children:[m.jsxs("div",{children:[m.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[m.jsxs(hh,{to:`/${t}/${e}/bible`,className:"text-xs font-bold text-text-muted hover:text-primary transition-colors flex items-center gap-1",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"arrow_back"})," Root"]}),y&&m.jsx("span",{className:`px-2 py-0.5 rounded text-[10px] bg-white/5 border border-white/10 ${B.color}`,children:B.label})]}),m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsx("span",{className:`material-symbols-outlined text-3xl ${B.color}`,children:B.icon}),m.jsx("h1",{className:"text-4xl font-black text-white tracking-tighter",children:y?.nombre||"Unnamed Folder"})]}),m.jsx("p",{className:"text-white/50 text-sm mt-2 max-w-xl",children:y?.descripcion})]}),m.jsxs("div",{className:"flex items-center gap-3 relative",children:[m.jsxs("button",{onClick:()=>R(!N),className:"h-10 px-6 rounded-xl bg-primary hover:bg-primary-light transition flex items-center gap-2 text-xs font-bold text-white shadow-lg shadow-primary/20",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"add"}),m.jsx("span",{children:"Aadir Elemento"})]}),N&&m.jsxs("div",{className:"absolute top-full right-0 mt-2 w-56 bg-surface-dark border border-glass-border rounded-2xl shadow-2xl py-2 z-50 animate-in fade-in slide-in-from-top-2",children:[m.jsxs("button",{onClick:()=>{n(`/${t}/${e}/bible/folder/${r}/entity/new/entidadindividual`),R(!1)},className:"w-full px-4 py-2.5 hover:bg-white/5 text-left text-xs font-bold flex items-center gap-3 text-white/70 hover:text-white",children:[m.jsx("span",{className:"material-symbols-outlined text-sm text-primary",children:"person"})," Personaje"]}),m.jsxs("button",{onClick:()=>{n(`/${t}/${e}/bible/folder/${r}/entity/new/entidadcolectiva`),R(!1)},className:"w-full px-4 py-2.5 hover:bg-white/5 text-left text-xs font-bold flex items-center gap-3 text-white/70 hover:text-white",children:[m.jsx("span",{className:"material-symbols-outlined text-sm text-blue-400",children:"groups"})," Cultura / Grupo"]}),m.jsxs("button",{onClick:()=>{n(`/${t}/${e}/bible/folder/${r}/entity/new/zona`),R(!1)},className:"w-full px-4 py-2.5 hover:bg-white/5 text-left text-xs font-bold flex items-center gap-3 text-white/70 hover:text-white",children:[m.jsx("span",{className:"material-symbols-outlined text-sm text-green-400",children:"location_on"})," Lugar / Geografa"]}),m.jsxs("button",{onClick:()=>{n(`/${t}/${e}/bible/folder/${r}/entity/new/interaccion`),R(!1)},className:"w-full px-4 py-2.5 hover:bg-white/5 text-left text-xs font-bold flex items-center gap-3 text-white/70 hover:text-white",children:[m.jsx("span",{className:"material-symbols-outlined text-sm text-amber-400",children:"history_edu"})," Lore / Interaccin"]}),m.jsxs("button",{onClick:()=>{n(`/${t}/${e}/bible/folder/${r}/entity/new/efectos`),R(!1)},className:"w-full px-4 py-2.5 hover:bg-white/5 text-left text-xs font-bold flex items-center gap-3 text-white/70 hover:text-white",children:[m.jsx("span",{className:"material-symbols-outlined text-sm text-purple-400",children:"magic_button"})," Objeto / Efecto"]}),m.jsx("div",{className:"h-px bg-white/5 my-1"}),m.jsxs("button",{onClick:()=>{n(`/${t}/${e}/map-editor/create/${r}`,{state:{folderId:y?.id}}),R(!1)},className:"w-full px-4 py-2.5 hover:bg-white/5 text-left text-xs font-bold flex items-center gap-3 text-white/70 hover:text-white",children:[m.jsx("span",{className:"material-symbols-outlined text-sm text-red-400",children:"map"})," Nuevo Mapa"]}),m.jsxs("button",{onClick:()=>{o(y,"TIMELINE"),R(!1)},className:"w-full px-4 py-2.5 hover:bg-white/5 text-left text-xs font-bold flex items-center gap-3 text-white/70 hover:text-white",children:[m.jsx("span",{className:"material-symbols-outlined text-sm text-cyan-400",children:"timeline"})," Timeline"]})]})]})]}),y?.tipo==="TIMELINE"?m.jsx(Die,{entities:I,folderId:r,onAddEvent:()=>n(`/${t}/${e}/bible/folder/${r}/entity/new/evento`)}):m.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4",children:[F.map(G=>m.jsx(Jg,{item:G,type:"folder",linkTo:`/${t}/${e}/bible/folder/${G.slug||G.id}`,onDelete:()=>s(G.id,y?.id||r)},G.id)),I.map(G=>{const K=G.tipoEspecial==="map"||G.tipoEspecial==="timeline"?G.tipoEspecial:"entity";return m.jsx(Jg,{item:G,type:"entity",linkTo:`/${t}/${e}/bible/folder/${y?.slug||r}/${K}/${G.slug||G.id}`,onDelete:()=>a(G.id,y?.id||r)},G.id)})]}),c.length===0&&p.length===0&&m.jsx("div",{className:"p-20 text-center border-2 border-dashed border-glass-border rounded-[3rem] opacity-30 mt-8",children:m.jsx("p",{className:"text-text-muted font-bold uppercase tracking-widest",children:"Empty Folder"})})]})},jie=t=>{switch(t?.toLowerCase()){case"text":return"notes";case"short_text":return"short_text";case"number":return"pin";case"date":return"calendar_today";case"select":return"list";case"boolean":return"check_box";case"map":return"map";case"timeline":return"timeline";case"character":case"entidadindividual":return"person";case"location":case"zona":case"construccion":return"location_on";case"culture":case"entidadcolectiva":return"groups";case"universe":case"galaxy":case"system":case"planet":return"public";case"entity_link":return"link";default:return"description"}},Fie=(t,e,r,n)=>{const i=r.slug||r.id;return`/${t}/${e}/bible/folder/${n||"root"}/entity/${i}`},yD=({folder:t,onCreateSubfolder:e,onRename:r,onDeleteFolder:n,onDeleteEntity:i,onCreateTemplate:a,onMoveEntity:s,onCreateEntity:o,onConfirmCreate:l,className:u})=>{const{username:c,projectName:f}=qi(),p=Va(),[v,y]=ae.useState(!1),[S,w]=ae.useState({folders:[],entities:[]}),[E,_]=ae.useState(!1),[T,N]=ae.useState(null),[R,I]=ae.useState(t.nombre),[F,D]=ae.useState(!1),[j,B]=ae.useState(null);ae.useEffect(()=>{I(t.nombre)},[t.nombre]),ae.useEffect(()=>{const Y=J=>{const{folderId:ie,optimisticType:de,confirmedType:he,removeId:xe,item:le,oldId:fe,expand:ve,type:ge}=J.detail||{};if(ie===t.id){if(ve&&(y(!0),E||G()),E)if(de){const se=de==="folder"?"folders":"entities";w(ye=>({...ye,[se]:[...ye[se].filter(Se=>Se.id!==le.id),le]}))}else if(he){const se=he==="folder"?"folders":"entities";w(ye=>({...ye,[se]:ye[se].map(Se=>Se.id===fe?le:Se)}))}else if(xe){const se=ge==="folder"?"folders":"entities";w(ye=>({...ye,[se]:ye[se].filter(Se=>Se.id!==xe)}))}else!de&&!he&&!xe&&G()}else J.detail?.targetFolderId===t.id&&J.detail?.type==="move-in"?E&&G():J.detail?.sourceFolderId===t.id&&J.detail?.type==="move-out"&&E&&w(se=>({...se,entities:se.entities.filter(ye=>ye.id!==ye.detail.entityId)}))};return window.addEventListener("folder-update",Y),()=>window.removeEventListener("folder-update",Y)},[t.id,E]);const G=async()=>{try{console.log("Loading content for folder:",t.id,"Slug:",t.slug);const[Y,J]=await Promise.all([et.get(`/world-bible/folders/${t.id}/subfolders`),et.get(`/world-bible/folders/${t.id}/entities`)]);w({folders:Y,entities:J}),_(!0)}catch(Y){console.error("Error reloading folder content:",Y),Y.message&&Y.message.includes("404")&&console.error(`404 for folder ${t.id} (${t.nombre})`)}},K=Y=>{Y.stopPropagation(),y(!v),!E&&!v&&G()},O=()=>p(`/${c}/${f}/bible/folder/${t.slug||t.id}`),W=(Y,J,ie,de)=>{Y.preventDefault(),Y.stopPropagation(),N({x:Y.clientX,y:Y.clientY,type:J,id:ie,name:de})},U=()=>N(null);ae.useEffect(()=>{if(T)return window.addEventListener("click",U),()=>window.removeEventListener("click",U)},[T]);const q=Y=>{if(Y.key==="Enter"){Y.preventDefault();const J=Y.target.value.trim();J?l(t.id,J,"folder",t.parentId,t.tipoEspecial):t.isNew&&i(t.id,t.parentId)}};if(t.isNew)return m.jsx("div",{className:"px-3 py-1 animate-in fade-in zoom-in-95 duration-200",children:m.jsx("input",{autoFocus:!0,type:"text",className:"w-full bg-surface-light border border-primary/50 rounded px-2 py-1 text-xs text-white outline-none",placeholder:"Folder Name...",onKeyDown:q,onBlur:Y=>{const J=Y.target.value.trim();J?l(t.id,J,"folder",t.parentId):i(t.id,t.parentId)}})});const Z=({item:Y,type:J})=>m.jsx("div",{className:"px-3 py-1 animate-in fade-in zoom-in-95 duration-200",children:m.jsx("input",{autoFocus:!0,type:"text",defaultValue:Y.nombre||"",className:"w-full bg-surface-light border border-primary/50 rounded px-2 py-1 text-xs text-white outline-none",placeholder:"Name...",onKeyDown:ie=>{if(ie.key==="Enter"){ie.preventDefault();const de=ie.target.value.trim();de?l(Y.id,de,J,t.id,Y.tipoEspecial):Y.isNew&&i(Y.id,t.id),B(null)}else ie.key==="Escape"&&(B(null),Y.isNew&&i(Y.id,t.id))},onBlur:ie=>{const de=ie.target.value.trim();de?l(Y.id,de,J,t.id,Y.tipoEspecial):Y.isNew&&i(Y.id,t.id),B(null)}})}),Q=Y=>{Y.preventDefault(),Y.stopPropagation(),Y.currentTarget.classList.add("bg-primary/20")},ne=Y=>{Y.preventDefault(),Y.stopPropagation(),Y.currentTarget.classList.remove("bg-primary/20")},re=Y=>{Y.preventDefault(),Y.stopPropagation(),Y.currentTarget.classList.remove("bg-primary/20");const J=Y.dataTransfer.getData("entityId"),ie=Y.dataTransfer.getData("sourceFolderId");J&&ie&&ie!==String(t.id)&&s(J,t.id,ie)};return m.jsxs("div",{className:`space-y-1 select-none ${u||""}`,children:[m.jsxs("div",{className:"flex items-center gap-3 px-3 py-2 rounded-xl text-xs font-bold text-text-muted hover:text-white hover:bg-white/5 cursor-pointer transition-all group relative",onClick:O,onContextMenu:Y=>W(Y,"folder",t.id,t.nombre),onDragOver:Q,onDragLeave:ne,onDrop:re,children:[m.jsx("span",{onClick:K,className:`material-symbols-outlined text-lg transition-transform hover:text-primary ${v?"rotate-90 text-primary":"opacity-50"}`,children:"chevron_right"}),m.jsx("span",{className:`material-symbols-outlined text-lg ${Vk(t.tipo).color}`,children:Vk(t.tipo).icon}),F?m.jsx("input",{autoFocus:!0,className:"bg-surface-light border border-primary/50 rounded px-2 py-0.5 text-xs text-white outline-none flex-1 min-w-0",defaultValue:R,onKeyDown:async Y=>{if(Y.key==="Enter"){Y.preventDefault(),Y.stopPropagation();const J=Y.target.value.trim();if(J&&J!==R)try{await r(t.id,J),I(J)}catch(ie){console.error("Rename failed",ie)}D(!1)}else Y.key==="Escape"&&(Y.preventDefault(),Y.stopPropagation(),D(!1))},onBlur:()=>D(!1),onClick:Y=>Y.stopPropagation()}):m.jsx("span",{className:"truncate flex-1",children:R})]}),T&&m.jsxs("div",{className:"fixed bg-surface-dark border border-glass-border shadow-2xl rounded-xl py-2 z-50 w-48 text-xs font-medium flex flex-col",style:{top:T.y,left:T.x},onClick:Y=>Y.stopPropagation(),children:[m.jsx("div",{className:"px-4 py-2 border-b border-white/5 font-bold text-text-muted truncate",children:T.name}),T.type==="folder"?m.jsxs(m.Fragment,{children:[m.jsxs("button",{className:"px-4 py-2 hover:bg-white/5 text-left flex items-center gap-2",onClick:()=>{o(t.id,"entidadindividual"),U()},children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"person"})," Add Character"]}),m.jsxs("button",{className:"px-4 py-2 hover:bg-white/5 text-left flex items-center gap-2",onClick:()=>{p(`/${c}/${f}/map-editor/create/${t.id}`),U()},children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"map"})," Add Map"]}),m.jsx("div",{className:"h-px bg-white/5 my-1"}),m.jsxs("button",{className:"px-4 py-2 hover:bg-white/5 text-left flex items-center gap-2",onClick:()=>{D(!0),U()},children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"edit"})," Rename Folder"]}),m.jsxs("button",{className:"px-4 py-2 hover:bg-red-500/10 text-red-400 text-left flex items-center gap-2",onClick:()=>{n(t.id,t.parentId),U()},children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})," Delete Folder"]})]}):m.jsxs(m.Fragment,{children:[m.jsxs("button",{className:"px-4 py-2 hover:bg-white/5 text-left flex items-center gap-2 cursor-pointer",onClick:()=>{B(T.id),U()},children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"edit"})," Rename"]}),m.jsxs("button",{className:"px-4 py-2 hover:bg-white/5 text-left flex items-center gap-2 cursor-pointer",onClick:async()=>{try{await et.entityService.toggleFavorite(T.id),window.dispatchEvent(new CustomEvent("favorites-update")),window.dispatchEvent(new CustomEvent("folder-update",{detail:{folderId:t.id}}))}catch(Y){console.error(Y)}U()},children:[m.jsx("span",{className:"material-symbols-outlined text-sm text-yellow-500",children:"star"})," Toggle Favorite"]}),m.jsxs("button",{className:"px-4 py-2 hover:bg-red-500/10 text-red-400 text-left flex items-center gap-2",onClick:()=>{i(T.id,t.id),U()},children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})," Delete Entity"]})]})]}),v&&m.jsxs("div",{className:"ml-6 pl-4 border-l border-glass-border space-y-1 animate-slide-in",children:[S.folders.map(Y=>m.jsx(yD,{folder:Y,onCreateSubfolder:e,onRename:r,onDeleteFolder:n,onDeleteEntity:i,onCreateTemplate:a,onMoveEntity:s,onCreateEntity:o,onConfirmCreate:l},Y.id)),S.entities.map(Y=>Y.isNew||Y.id===j?m.jsx(Z,{item:Y,type:"entity"},Y.id):m.jsxs(hh,{to:Fie(c,f,Y,t.slug||t.id),onContextMenu:J=>W(J,"entity",Y.id,Y.nombre),className:`flex items-center gap-3 px-3 py-2 rounded-xl text-[11px] font-medium text-text-muted hover:text-white hover:bg-primary/10 transition-all group cursor-grab active:cursor-grabbing ${Y.pending?"opacity-50 pointer-events-none":""}`,draggable:!Y.pending,onDragStart:J=>{J.dataTransfer.setData("entityId",Y.id),J.dataTransfer.setData("sourceFolderId",t.id)},children:[m.jsx("span",{className:"material-symbols-outlined text-sm opacity-70 group-hover:text-primary transition-colors",children:jie(Y.tipoEspecial)}),m.jsx("span",{className:"truncate flex-1",children:Y.nombre}),Y.favorite&&m.jsx("span",{className:"material-symbols-outlined text-[10px] text-yellow-500",title:"Favorito",children:"star"})]},Y.id)),E&&S.folders.length===0&&S.entities.length===0&&m.jsx("div",{className:"px-3 py-2 text-[10px] text-text-muted/30 uppercase font-black italic tracking-tighter",children:"Empty Sector"})]})]})},Bie=({isOpen:t,onClose:e,onCreate:r,parentFolder:n})=>{const[i,a]=ae.useState({nombre:"",descripcion:"",tipo:"FOLDER",canvasType:"BLANK"});if(!t)return null;const s=()=>{r(i),e(),a({nombre:"",descripcion:"",tipo:"FOLDER",canvasType:"BLANK"})},o=[sh.UNIVERSE,sh.GALAXY,sh.SYSTEM,sh.PLANET];return m.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm",children:m.jsxs("div",{className:"bg-[#1a1b26] w-full max-w-4xl rounded-2xl shadow-2xl border border-white/10 overflow-hidden flex flex-col max-h-[90vh]",children:[m.jsxs("div",{className:"p-6 border-b border-white/5 flex justify-between items-center bg-[#1f202e]",children:[m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsx("div",{className:"w-8 h-8 rounded-full bg-indigo-500/20 flex items-center justify-center text-indigo-400",children:m.jsx("span",{className:"material-icons text-sm",children:"add"})}),m.jsx("h2",{className:"text-xl font-semibold text-white",children:n?"Crear Nuevo Espacio":"Crear Nuevo Mapa"})]}),m.jsx("button",{onClick:e,className:"text-gray-400 hover:text-white transition",children:m.jsx("span",{className:"material-icons",children:"close"})})]}),m.jsx("div",{className:"p-8 overflow-y-auto flex-1",children:m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[m.jsxs("div",{className:"space-y-6",children:[m.jsx("h3",{className:"text-sm font-black uppercase tracking-widest text-indigo-400",children:"Identidad"}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-[10px] font-black text-white/30 uppercase mb-2",children:"Nombre del Espacio"}),m.jsx("input",{autoFocus:!0,type:"text",value:i.nombre,onChange:l=>a({...i,nombre:l.target.value}),className:"w-full bg-black/40 border border-white/5 rounded-2xl px-5 py-4 text-white focus:outline-none focus:border-indigo-500/50 transition-all shadow-inner",placeholder:"ej. Sistema Solar"})]}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-[10px] font-black text-white/30 uppercase mb-2",children:"Descripcin"}),m.jsx("textarea",{value:i.descripcion,onChange:l=>a({...i,descripcion:l.target.value}),className:"w-full h-32 bg-black/40 border border-white/5 rounded-2xl px-5 py-4 text-white focus:outline-none focus:border-indigo-500/50 resize-none transition-all",placeholder:"Detalles sobre este nivel jerrquico..."})]})]}),m.jsxs("div",{className:"space-y-6",children:[m.jsx("h3",{className:"text-sm font-black uppercase tracking-widest text-indigo-400",children:"Configuracin"}),m.jsxs("div",{className:"space-y-3",children:[m.jsx("label",{className:"block text-[10px] font-black text-white/30 uppercase mb-1",children:"Tipo de Jerarqua"}),m.jsx("div",{className:"grid grid-cols-2 gap-2",children:o.concat([{id:"FOLDER",label:"Carpeta",icon:"folder",color:"text-white/50"}]).map(l=>m.jsxs("div",{onClick:()=>a({...i,tipo:l.id}),className:`flex items-center gap-3 p-3 rounded-xl border cursor-pointer transition-all ${i.tipo===l.id?"bg-indigo-500/10 border-indigo-500/50":"bg-white/5 border-white/5 hover:bg-white/10"}`,children:[m.jsx("span",{className:`material-icons text-lg ${l.color||""}`,children:l.icon}),m.jsx("span",{className:"text-xs font-bold text-white/80",children:l.label})]},l.id||"FOLDER"))})]}),m.jsx("div",{className:"p-4 rounded-2xl bg-indigo-500/5 border border-indigo-500/10",children:m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("div",{className:"w-10 h-10 rounded-full bg-indigo-500/20 flex items-center justify-center text-indigo-400",children:m.jsx("span",{className:"material-icons",children:"info"})}),m.jsxs("div",{children:[m.jsx("p",{className:"text-[10px] uppercase font-black text-indigo-300",children:"Ubicacin Actual"}),m.jsx("p",{className:"text-xs text-indigo-100/50",children:n?n.nombre:"Raz del Mundo"})]})]})})]})]})}),m.jsxs("div",{className:"p-6 border-t border-white/5 flex justify-end gap-3 bg-[#1f202e]",children:[m.jsx("button",{onClick:e,className:"px-6 py-3 rounded-xl text-xs font-black uppercase tracking-widest text-text-muted hover:text-white transition",children:"Cancelar"}),m.jsx("button",{onClick:s,disabled:!i.nombre,className:"px-8 py-3 rounded-xl bg-indigo-600 hover:bg-indigo-500 text-white text-xs font-black uppercase tracking-widest shadow-lg shadow-indigo-500/20 transition-all disabled:opacity-30 disabled:pointer-events-none",children:"Confirmar y Crear"})]})]})})},zie=()=>{const{username:t,projectName:e}=qi(),r=Va(),{handleCreateEntity:n,...i}=nl()||{},{t:a}=Ps(),[s,o]=ae.useState([]),[l,u]=ae.useState([]),[c,f]=ae.useState(!1),[p,v]=ae.useState(!1),[y,S]=ae.useState(null),[w,E]=ae.useState(!1),[_,T]=ae.useState(null),N=`/${t}/${e}/bible`;ae.useEffect(()=>{R(),I();const q=()=>I();return window.addEventListener("favorites-update",q),()=>window.removeEventListener("favorites-update",q)},[e]);const R=async()=>{try{const q=await et.get("/world-bible/folders");o(q)}catch(q){console.error("Error loading folders:",q)}},I=async()=>{try{const q=await et.get("/world-bible/favorites");u(q)}catch(q){console.error("Error loading favorites:",q)}},F=(q=null)=>{S(q),v(!0),f(!1)},D=async(q=null,Z="FOLDER")=>{try{const Q=q?typeof q=="object"?q.id:q:null,ne=await et.post("/world-bible/folders",{nombre:a(Z==="TIMELINE"?"bible.new_timeline":"bible.new_folder"),padreId:Q,tipo:Z});if(Q===null){const re=await et.get("/world-bible/folders");o(re),window.dispatchEvent(new CustomEvent("folder-update",{detail:{folderId:null}}))}else window.dispatchEvent(new CustomEvent("folder-update",{detail:{folderId:Q,optimisticType:"folder",item:ne,expand:!0}}))}catch(Q){console.error("Error creating simple folder:",Q)}},j=async q=>{try{const Z=y?y.id:null,Q=await et.post("/world-bible/folders",{nombre:q.nombre,descripcion:q.descripcion,padreId:Z,tipo:q.tipo});if(Z===null){const ne=await et.get("/world-bible/folders");o(ne),window.dispatchEvent(new CustomEvent("folder-update",{detail:{folderId:null}}))}else Q.id||console.error("CRITICAL: Created folder has no ID!",Q),window.dispatchEvent(new CustomEvent("folder-update",{detail:{folderId:Z,optimisticType:"folder",item:Q,expand:!0}}))}catch(Z){console.error(Z),alert("Error creating folder/zone.")}},B=async(q,Z="entidadindividual")=>{const Q=typeof q=="object"?q.slug||q.id:q;r(`${N}/folder/${Q}/entity/new/${Z}`)},G=async(q,Z)=>{try{await et.put(`/world-bible/folders/${q}`,{nombre:Z}),o(Q=>Q.map(ne=>ne.id===q?{...ne,nombre:Z}:ne))}catch(Q){throw Q}},K=(q,Z=null)=>{T({id:q,parentId:Z,type:"folder"}),E(!0)},O=async()=>{if(!_)return;const{id:q,parentId:Z,type:Q,folderId:ne}=_;try{Q==="folder"?(await et.delete(`/world-bible/folders/${q}`),Z===null&&o(re=>re.filter(Y=>Y.id!==q)),window.dispatchEvent(new CustomEvent("folder-update",{detail:{folderId:Z,removeId:q,type:"folder"}}))):Q==="entity"&&(await et.delete(`/world-bible/entities/${q}`),window.dispatchEvent(new CustomEvent("folder-update",{detail:{folderId:ne,removeId:q,type:"entity"}})))}catch(re){console.error("Deletion failed:",re),alert("Error trying to delete item.")}finally{T(null)}},W=(q,Z)=>{T({id:q,folderId:Z,type:"entity"}),E(!0)},U=async(q,Z,Q,ne,re)=>{try{if(Q==="folder")typeof q=="number"&&!q.toString().startsWith("temp")&&(await et.put(`/world-bible/folders/${q}`,{nombre:Z}),window.dispatchEvent(new CustomEvent("folder-update",{detail:{folderId:ne,confirmedType:"folder",oldId:q,item:{id:q,nombre:Z,parentId:ne,tipo:re,uiKey:Date.now()}}})),ne||o(Y=>Y.map(J=>J.id===q?{...J,nombre:Z}:J)));else if(Q==="entity")if(typeof q=="string"&&q.startsWith("new-")){const Y=await et.post("/world-bible/entities",{nombre:Z,carpetaId:ne,tipoEspecial:re||"entidadindividual"});window.dispatchEvent(new CustomEvent("folder-update",{detail:{folderId:ne,confirmedType:"entity",oldId:q,item:Y}}))}else await et.put(`/world-bible/entities/${q}`,{nombre:Z}),window.dispatchEvent(new CustomEvent("folder-update",{detail:{folderId:ne,confirmedType:"entity",oldId:q,item:{id:q,nombre:Z,carpeta:{id:ne},tipoEspecial:re,slug:q}}})),window.dispatchEvent(new CustomEvent("folder-update",{detail:{folderId:ne}}))}catch(Y){console.error("Creation/Rename failed",Y),Q==="folder"&&K(q,ne)}};return m.jsxs("div",{className:"flex h-full w-full bg-background-dark max-w-[1920px] mx-auto",children:[m.jsxs("aside",{className:"w-80 flex-none flex flex-col border-r border-glass-border bg-surface-dark/50 z-10",children:[m.jsx("div",{className:"p-4 border-b border-glass-border",children:m.jsxs("div",{className:"relative group mb-3",children:[m.jsx("span",{className:"material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-text-muted text-sm group-focus-within:text-primary transition-colors",children:"search"}),m.jsx("input",{type:"text",placeholder:a("bible.search_entity"),className:"w-full bg-surface-light/50 border border-glass-border rounded-xl py-2 pl-9 pr-3 text-xs focus:border-primary/50 outline-none transition-all text-white placeholder:text-text-muted/50"})]})}),m.jsxs("div",{className:"px-2 pt-2",children:[m.jsx("div",{className:"flex items-center justify-between px-2 mb-1",children:m.jsx("h2",{className:"text-[10px] font-black uppercase tracking-widest text-text-muted",children:a("bible.favorites")})}),l.length>0?m.jsx("div",{className:"space-y-0.5",children:l.map(q=>m.jsxs("div",{onClick:()=>r(`${N}/folder/${q.carpeta.slug||q.carpeta.id}/entity/${q.slug||q.id}`),className:"flex items-center gap-3 px-3 py-1.5 rounded-lg text-[11px] font-medium text-text-muted hover:text-white hover:bg-white/5 cursor-pointer transition-all group",children:[m.jsx("span",{className:"material-symbols-outlined text-sm text-yellow-500/70 group-hover:text-yellow-400",children:"star"}),m.jsx("span",{className:"truncate",children:q.nombre})]},q.id))}):m.jsx("div",{className:"px-4 py-2 text-[10px] text-text-muted/30 italic",children:a("bible.no_favorites")}),m.jsx("div",{className:"h-px bg-glass-border my-2 opacity-50"})]}),m.jsx("div",{className:"p-4 border-b border-glass-border pt-0",children:m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsx("h2",{className:"text-[10px] font-black uppercase tracking-widest text-text-muted",children:a("bible.explorer")}),m.jsx("div",{className:"relative",children:m.jsx("button",{className:"transition-colors hover:text-white text-primary",onClick:()=>D(null),title:a("bible.new_folder"),children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"create_new_folder"})})})]})}),m.jsx("div",{className:"flex-1 overflow-y-auto no-scrollbar p-2 space-y-0.5",children:s.length===0?m.jsxs("div",{className:"p-8 text-center opacity-30",children:[m.jsx("span",{className:"material-symbols-outlined text-3xl mb-2",children:"folder_off"}),m.jsx("p",{className:"text-[10px] uppercase font-bold",children:a("bible.empty_archive")})]}):s.map(q=>m.jsx(yD,{folder:q,onCreateSubfolder:()=>{},onRename:G,onDeleteFolder:K,onDeleteEntity:K,onCreateTemplate:()=>{},onMoveEntity:(Z,Q,ne)=>console.log("move",Z,Q,ne),onCreateEntity:B,onConfirmCreate:U},q.uiKey||q.id))})]}),m.jsx("main",{className:"flex-1 overflow-hidden relative bg-gradient-to-br from-background-dark to-surface-dark/20",children:m.jsx(qk,{context:{...i,folders:s,handleCreateEntity:B,handleOpenCreateModal:F,handleDeleteFolder:K,handleDeleteEntity:W,handleCreateSimpleFolder:D}})}),m.jsx(Bie,{isOpen:p,onClose:()=>v(!1),onCreate:j,parentFolder:y}),m.jsx(b1,{isOpen:w,onClose:()=>E(!1),onConfirm:O,title:_?.type==="folder"?a("bible.delete_folder"):a("bible.delete_entity"),message:_?.type==="folder"?a("bible.delete_folder_msg"):a("bible.delete_entity_msg"),confirmText:a("common.confirm_delete")})]})},Uie=()=>{const{username:t,projectName:e}=qi();Va();const{handleOpenCreateModal:r,handleDeleteFolder:n,handleCreateSimpleFolder:i,handleRenameFolder:a,folders:s=[]}=nl(),{t:o}=Ps(),[l,u]=ae.useState(null),[c,f]=ae.useState(null),[p,v]=ae.useState(""),y=(E,_)=>{E.preventDefault(),E.stopPropagation(),u({x:E.clientX,y:E.clientY,folder:_})},S=()=>u(null);ae.useEffect(()=>{if(l){const E=()=>S();return window.addEventListener("click",E),()=>window.removeEventListener("click",E)}},[l]);const w=async(E,_)=>{_.trim()&&a&&await a(E,_.trim()),f(null),v("")};return s===void 0?m.jsx("div",{className:"p-20 text-center animate-pulse text-text-muted",children:o("common.loading")}):m.jsxs("div",{className:"flex-1 p-8 max-w-[1600px] mx-auto w-full h-full overflow-y-auto",children:[m.jsxs("header",{className:"mb-8 flex items-end justify-between",children:[m.jsxs("div",{children:[m.jsxs("div",{className:"flex items-center gap-3 text-xs font-black uppercase tracking-widest text-primary italic mb-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"auto_stories"}),o("nav.bible")]}),m.jsx("h1",{className:"text-4xl font-black text-white tracking-tighter",children:o("bible.root_index")}),m.jsx("p",{className:"text-text-muted mt-2 max-w-lg text-sm",children:o("bible.central_archive")})]}),m.jsx("div",{className:"flex items-center gap-2",children:m.jsxs("button",{onClick:()=>i(null,"FOLDER"),className:"px-6 py-2 bg-primary hover:bg-primary-light text-white rounded-xl text-xs font-bold flex items-center gap-2 transition-all shadow-lg shadow-primary/20",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"create_new_folder"})," ",o("bible.new_folder")]})})]}),m.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4",children:s.map(E=>c===E.id?m.jsx("div",{className:"p-4 rounded-3xl bg-surface-dark border border-primary/50",children:m.jsx("input",{autoFocus:!0,type:"text",value:p,onChange:_=>v(_.target.value),onKeyDown:_=>{_.key==="Enter"&&w(E.id,p),_.key==="Escape"&&(f(null),v(""))},onBlur:()=>w(E.id,p),className:"w-full bg-black/30 border border-white/10 rounded-xl p-3 text-sm text-white focus:border-primary/50 outline-none",placeholder:o("common.rename")})},E.id):m.jsx(Jg,{item:E,type:"folder",linkTo:`/${t}/${e}/bible/folder/${E.slug||E.id}`,onDelete:()=>n(E.id),onContextMenu:_=>y(_,E)},E.id))}),s.length===0&&m.jsxs("div",{className:"p-20 text-center border-2 border-dashed border-glass-border rounded-[3rem] opacity-30 mt-8",children:[m.jsx("span",{className:"material-symbols-outlined text-6xl mb-4 text-text-muted",children:"library_books"}),m.jsx("h3",{className:"text-xl font-bold text-white uppercase tracking-widest",children:o("bible.empty_archive")}),m.jsx("p",{className:"text-text-muted mt-2",children:o("bible.empty_archive_desc")})]}),l&&m.jsxs("div",{className:"fixed bg-surface-dark border border-glass-border shadow-2xl rounded-xl py-2 z-50 w-52 text-xs font-medium flex flex-col animate-in fade-in zoom-in-95 duration-150",style:{top:l.y,left:l.x},onClick:E=>E.stopPropagation(),children:[m.jsxs("div",{className:"px-4 py-2 border-b border-white/5 font-bold text-text-muted truncate flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm text-primary",children:"folder"}),l.folder.nombre]}),m.jsxs("button",{className:"px-4 py-2.5 hover:bg-white/5 text-left flex items-center gap-3 text-white/80 hover:text-white transition-colors",onClick:()=>{f(l.folder.id),v(l.folder.nombre),S()},children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"edit"})," ",o("common.rename")]}),m.jsxs("button",{className:"px-4 py-2.5 hover:bg-red-500/10 text-red-400 text-left flex items-center gap-3 transition-colors",onClick:()=>{n(l.folder.id),S()},children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})," ",o("bible.delete_folder")]})]})]})};function Gie(){const[t,e]=ae.useState("deep_space"),[r,n]=ae.useState(null);return ae.useEffect(()=>{const i=localStorage.getItem("app_settings");if(i){const o=JSON.parse(i);o.theme&&e(o.theme)}const a=localStorage.getItem("user");a&&a!=="undefined"&&n(JSON.parse(a));const s=()=>{const o=localStorage.getItem("app_settings");if(o){const u=JSON.parse(o);u.theme&&e(u.theme)}const l=localStorage.getItem("user");l&&l!=="undefined"&&n(JSON.parse(l))};return window.addEventListener("storage_update",s),()=>window.removeEventListener("storage_update",s)},[]),ae.useEffect(()=>{document.body.classList.forEach(i=>{i.startsWith("theme-")&&document.body.classList.remove(i)}),document.body.classList.add(`theme-${t}`)},[t]),m.jsx(uj,{children:m.jsx("div",{className:`app-container theme-${t} h-screen w-screen overflow-hidden`,children:m.jsx(X8,{children:m.jsxs(V8,{children:[m.jsx(qn,{path:"/",element:m.jsx(UI,{})}),m.jsxs(qn,{element:m.jsx(DI,{}),children:[m.jsx(qn,{path:"/settings",element:m.jsx(dj,{})}),m.jsxs(qn,{path:"/:username/:projectName",element:m.jsx(mj,{}),children:[m.jsx(qn,{index:!0,element:m.jsx(cj,{})}),m.jsx(qn,{path:"writing",element:m.jsx(Eie,{})}),m.jsx(qn,{path:"writing/:notebookId",element:m.jsx(Cie,{})}),m.jsx(qn,{path:"entities/:type/:entityId",element:m.jsx(fG,{})}),m.jsx(qn,{path:"map-editor/create/:folderId",element:m.jsx(ek,{mode:"create"})}),m.jsx(qn,{path:"map-editor/edit/:entityId",element:m.jsx(ek,{mode:"edit"})}),m.jsxs(qn,{path:"bible",element:m.jsx(zie,{}),children:[m.jsx(qn,{index:!0,element:m.jsx(Uie,{})}),m.jsx(qn,{path:"folder/:folderSlug/entity/new/:type",element:m.jsx(Vg,{mode:"creation"})}),m.jsx(qn,{path:"folder/:folderSlug",element:m.jsx(Iie,{})}),m.jsx(qn,{path:"entity/:entitySlug",element:m.jsx(Vg,{})}),m.jsx(qn,{path:"folder/:folderSlug/entity/:entitySlug",element:m.jsx(Vg,{})}),m.jsx(qn,{path:"folder/:folderSlug/map/:entitySlug",element:m.jsx(Vg,{})}),m.jsx(qn,{path:"folder/:folderSlug/timeline/:entitySlug",element:m.jsx(Vg,{})})]}),m.jsx(qn,{path:"map",element:m.jsx(FH,{})}),m.jsx(qn,{path:"timeline",element:m.jsx(hG,{})}),m.jsx(qn,{path:"languages",element:m.jsx(VK,{})}),m.jsx(qn,{path:"trash",element:m.jsx(Tie,{})}),m.jsx(qn,{path:"graph",element:m.jsx(oG,{})})]})]})]})})})})}const NC=(t,e,r,n="")=>{fetch("/api/logs/error",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({source:t,message:e,stack:r,componentStack:n})}).catch(i=>console.error("Failed to send error log:",i))};window.onerror=(t,e,r,n,i)=>{NC("Global Window Error",t,i?i.stack:`${e}:${r}:${n}`)};window.onunhandledrejection=t=>{NC("Unhandled Promise Rejection",t.reason?t.reason.message:"Unknown reason",t.reason?t.reason.stack:"")};class Vie extends nr.Component{constructor(e){super(e),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(e){return{hasError:!0}}componentDidCatch(e,r){this.setState({error:e,errorInfo:r}),console.error("Uncaught Error:",e,r),NC("React ErrorBoundary",e.message,e.stack,r.componentStack)}render(){return this.state.hasError?m.jsxs("div",{style:{padding:20,background:"#222",color:"red",height:"100vh"},children:[m.jsx("h1",{children:"Something went wrong."}),m.jsxs("details",{style:{whiteSpace:"pre-wrap"},children:[this.state.error&&this.state.error.toString(),m.jsx("br",{}),this.state.errorInfo&&this.state.errorInfo.componentStack]})]}):this.props.children}}const iM=document.getElementById("root");iM?XD.createRoot(iM).render(m.jsx(nr.StrictMode,{children:m.jsx(Vie,{children:m.jsx(Gie,{})})})):console.error("React root element not found (looked for #root)")});export default Hie();
