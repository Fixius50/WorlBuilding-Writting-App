var C8=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var Uae=C8(Ye=>{function E8(t,e){for(var r=0;r<e.length;r++){const n=e[r];if(typeof n!="string"&&!Array.isArray(n)){for(const i in n)if(i!=="default"&&!(i in t)){const a=Object.getOwnPropertyDescriptor(n,i);a&&Object.defineProperty(t,i,a.get?a:{enumerable:!0,get:()=>n[i]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function r(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(i){if(i.ep)return;i.ep=!0;const a=r(i);fetch(i.href,a)}})();var yE=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Mh(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var jb={exports:{}},Um={},Fb={exports:{}},_r={};var xE;function T8(){if(xE)return _r;xE=1;var t=Symbol.for("react.element"),e=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),a=Symbol.for("react.provider"),s=Symbol.for("react.context"),o=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),c=Symbol.for("react.lazy"),f=Symbol.iterator;function p(H){return H===null||typeof H!="object"?null:(H=f&&H[f]||H["@@iterator"],typeof H=="function"?H:null)}var v={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},y=Object.assign,S={};function w(H,te,ie){this.props=H,this.context=te,this.refs=S,this.updater=ie||v}w.prototype.isReactComponent={},w.prototype.setState=function(H,te){if(typeof H!="object"&&typeof H!="function"&&H!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,H,te,"setState")},w.prototype.forceUpdate=function(H){this.updater.enqueueForceUpdate(this,H,"forceUpdate")};function T(){}T.prototype=w.prototype;function _(H,te,ie){this.props=H,this.context=te,this.refs=S,this.updater=ie||v}var C=_.prototype=new T;C.constructor=_,y(C,w.prototype),C.isPureReactComponent=!0;var N=Array.isArray,A=Object.prototype.hasOwnProperty,O={current:null},j={key:!0,ref:!0,__self:!0,__source:!0};function D(H,te,ie){var de,ge={},ye=null,ae=null;if(te!=null)for(de in te.ref!==void 0&&(ae=te.ref),te.key!==void 0&&(ye=""+te.key),te)A.call(te,de)&&!j.hasOwnProperty(de)&&(ge[de]=te[de]);var pe=arguments.length-2;if(pe===1)ge.children=ie;else if(1<pe){for(var le=Array(pe),me=0;me<pe;me++)le[me]=arguments[me+2];ge.children=le}if(H&&H.defaultProps)for(de in pe=H.defaultProps,pe)ge[de]===void 0&&(ge[de]=pe[de]);return{$$typeof:t,type:H,key:ye,ref:ae,props:ge,_owner:O.current}}function F(H,te){return{$$typeof:t,type:H.type,key:te,ref:H.ref,props:H.props,_owner:H._owner}}function B(H){return typeof H=="object"&&H!==null&&H.$$typeof===t}function $(H){var te={"=":"=0",":":"=2"};return"$"+H.replace(/[=:]/g,function(ie){return te[ie]})}var Z=/\/+/g;function I(H,te){return typeof H=="object"&&H!==null&&H.key!=null?$(""+H.key):te.toString(36)}function q(H,te,ie,de,ge){var ye=typeof H;(ye==="undefined"||ye==="boolean")&&(H=null);var ae=!1;if(H===null)ae=!0;else switch(ye){case"string":case"number":ae=!0;break;case"object":switch(H.$$typeof){case t:case e:ae=!0}}if(ae)return ae=H,ge=ge(ae),H=de===""?"."+I(ae,0):de,N(ge)?(ie="",H!=null&&(ie=H.replace(Z,"$&/")+"/"),q(ge,te,ie,"",function(me){return me})):ge!=null&&(B(ge)&&(ge=F(ge,ie+(!ge.key||ae&&ae.key===ge.key?"":(""+ge.key).replace(Z,"$&/")+"/")+H)),te.push(ge)),1;if(ae=0,de=de===""?".":de+":",N(H))for(var pe=0;pe<H.length;pe++){ye=H[pe];var le=de+I(ye,pe);ae+=q(ye,te,ie,le,ge)}else if(le=p(H),typeof le=="function")for(H=le.call(H),pe=0;!(ye=H.next()).done;)ye=ye.value,le=de+I(ye,pe++),ae+=q(ye,te,ie,le,ge);else if(ye==="object")throw te=String(H),Error("Objects are not valid as a React child (found: "+(te==="[object Object]"?"object with keys {"+Object.keys(H).join(", ")+"}":te)+"). If you meant to render a collection of children, use an array instead.");return ae}function U(H,te,ie){if(H==null)return H;var de=[],ge=0;return q(H,de,"","",function(ye){return te.call(ie,ye,ge++)}),de}function W(H){if(H._status===-1){var te=H._result;te=te(),te.then(function(ie){(H._status===0||H._status===-1)&&(H._status=1,H._result=ie)},function(ie){(H._status===0||H._status===-1)&&(H._status=2,H._result=ie)}),H._status===-1&&(H._status=0,H._result=te)}if(H._status===1)return H._result.default;throw H._result}var Y={current:null},Q={transition:null},ne={ReactCurrentDispatcher:Y,ReactCurrentBatchConfig:Q,ReactCurrentOwner:O};function re(){throw Error("act(...) is not supported in production builds of React.")}return _r.Children={map:U,forEach:function(H,te,ie){U(H,function(){te.apply(this,arguments)},ie)},count:function(H){var te=0;return U(H,function(){te++}),te},toArray:function(H){return U(H,function(te){return te})||[]},only:function(H){if(!B(H))throw Error("React.Children.only expected to receive a single React element child.");return H}},_r.Component=w,_r.Fragment=r,_r.Profiler=i,_r.PureComponent=_,_r.StrictMode=n,_r.Suspense=l,_r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ne,_r.act=re,_r.cloneElement=function(H,te,ie){if(H==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+H+".");var de=y({},H.props),ge=H.key,ye=H.ref,ae=H._owner;if(te!=null){if(te.ref!==void 0&&(ye=te.ref,ae=O.current),te.key!==void 0&&(ge=""+te.key),H.type&&H.type.defaultProps)var pe=H.type.defaultProps;for(le in te)A.call(te,le)&&!j.hasOwnProperty(le)&&(de[le]=te[le]===void 0&&pe!==void 0?pe[le]:te[le])}var le=arguments.length-2;if(le===1)de.children=ie;else if(1<le){pe=Array(le);for(var me=0;me<le;me++)pe[me]=arguments[me+2];de.children=pe}return{$$typeof:t,type:H.type,key:ge,ref:ye,props:de,_owner:ae}},_r.createContext=function(H){return H={$$typeof:s,_currentValue:H,_currentValue2:H,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},H.Provider={$$typeof:a,_context:H},H.Consumer=H},_r.createElement=D,_r.createFactory=function(H){var te=D.bind(null,H);return te.type=H,te},_r.createRef=function(){return{current:null}},_r.forwardRef=function(H){return{$$typeof:o,render:H}},_r.isValidElement=B,_r.lazy=function(H){return{$$typeof:c,_payload:{_status:-1,_result:H},_init:W}},_r.memo=function(H,te){return{$$typeof:u,type:H,compare:te===void 0?null:te}},_r.startTransition=function(H){var te=Q.transition;Q.transition={};try{H()}finally{Q.transition=te}},_r.unstable_act=re,_r.useCallback=function(H,te){return Y.current.useCallback(H,te)},_r.useContext=function(H){return Y.current.useContext(H)},_r.useDebugValue=function(){},_r.useDeferredValue=function(H){return Y.current.useDeferredValue(H)},_r.useEffect=function(H,te){return Y.current.useEffect(H,te)},_r.useId=function(){return Y.current.useId()},_r.useImperativeHandle=function(H,te,ie){return Y.current.useImperativeHandle(H,te,ie)},_r.useInsertionEffect=function(H,te){return Y.current.useInsertionEffect(H,te)},_r.useLayoutEffect=function(H,te){return Y.current.useLayoutEffect(H,te)},_r.useMemo=function(H,te){return Y.current.useMemo(H,te)},_r.useReducer=function(H,te,ie){return Y.current.useReducer(H,te,ie)},_r.useRef=function(H){return Y.current.useRef(H)},_r.useState=function(H){return Y.current.useState(H)},_r.useSyncExternalStore=function(H,te,ie){return Y.current.useSyncExternalStore(H,te,ie)},_r.useTransition=function(){return Y.current.useTransition()},_r.version="18.3.1",_r}var bE;function um(){return bE||(bE=1,Fb.exports=T8()),Fb.exports}var wE;function N8(){if(wE)return Um;wE=1;var t=um(),e=Symbol.for("react.element"),r=Symbol.for("react.fragment"),n=Object.prototype.hasOwnProperty,i=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,a={key:!0,ref:!0,__self:!0,__source:!0};function s(o,l,u){var c,f={},p=null,v=null;u!==void 0&&(p=""+u),l.key!==void 0&&(p=""+l.key),l.ref!==void 0&&(v=l.ref);for(c in l)n.call(l,c)&&!a.hasOwnProperty(c)&&(f[c]=l[c]);if(o&&o.defaultProps)for(c in l=o.defaultProps,l)f[c]===void 0&&(f[c]=l[c]);return{$$typeof:e,type:o,key:p,ref:v,props:f,_owner:i.current}}return Um.Fragment=r,Um.jsx=s,Um.jsxs=s,Um}var SE;function P8(){return SE||(SE=1,jb.exports=N8()),jb.exports}var m=P8(),se=um();const sr=Mh(se),M8=E8({__proto__:null,default:sr},[se]);var J0={},Bb={exports:{}},zs={},zb={exports:{}},Ub={};var kE;function A8(){return kE||(kE=1,(function(t){function e(Q,ne){var re=Q.length;Q.push(ne);e:for(;0<re;){var H=re-1>>>1,te=Q[H];if(0<i(te,ne))Q[H]=ne,Q[re]=te,re=H;else break e}}function r(Q){return Q.length===0?null:Q[0]}function n(Q){if(Q.length===0)return null;var ne=Q[0],re=Q.pop();if(re!==ne){Q[0]=re;e:for(var H=0,te=Q.length,ie=te>>>1;H<ie;){var de=2*(H+1)-1,ge=Q[de],ye=de+1,ae=Q[ye];if(0>i(ge,re))ye<te&&0>i(ae,ge)?(Q[H]=ae,Q[ye]=re,H=ye):(Q[H]=ge,Q[de]=re,H=de);else if(ye<te&&0>i(ae,re))Q[H]=ae,Q[ye]=re,H=ye;else break e}}return ne}function i(Q,ne){var re=Q.sortIndex-ne.sortIndex;return re!==0?re:Q.id-ne.id}if(typeof performance=="object"&&typeof performance.now=="function"){var a=performance;t.unstable_now=function(){return a.now()}}else{var s=Date,o=s.now();t.unstable_now=function(){return s.now()-o}}var l=[],u=[],c=1,f=null,p=3,v=!1,y=!1,S=!1,w=typeof setTimeout=="function"?setTimeout:null,T=typeof clearTimeout=="function"?clearTimeout:null,_=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function C(Q){for(var ne=r(u);ne!==null;){if(ne.callback===null)n(u);else if(ne.startTime<=Q)n(u),ne.sortIndex=ne.expirationTime,e(l,ne);else break;ne=r(u)}}function N(Q){if(S=!1,C(Q),!y)if(r(l)!==null)y=!0,W(A);else{var ne=r(u);ne!==null&&Y(N,ne.startTime-Q)}}function A(Q,ne){y=!1,S&&(S=!1,T(D),D=-1),v=!0;var re=p;try{for(C(ne),f=r(l);f!==null&&(!(f.expirationTime>ne)||Q&&!$());){var H=f.callback;if(typeof H=="function"){f.callback=null,p=f.priorityLevel;var te=H(f.expirationTime<=ne);ne=t.unstable_now(),typeof te=="function"?f.callback=te:f===r(l)&&n(l),C(ne)}else n(l);f=r(l)}if(f!==null)var ie=!0;else{var de=r(u);de!==null&&Y(N,de.startTime-ne),ie=!1}return ie}finally{f=null,p=re,v=!1}}var O=!1,j=null,D=-1,F=5,B=-1;function $(){return!(t.unstable_now()-B<F)}function Z(){if(j!==null){var Q=t.unstable_now();B=Q;var ne=!0;try{ne=j(!0,Q)}finally{ne?I():(O=!1,j=null)}}else O=!1}var I;if(typeof _=="function")I=function(){_(Z)};else if(typeof MessageChannel<"u"){var q=new MessageChannel,U=q.port2;q.port1.onmessage=Z,I=function(){U.postMessage(null)}}else I=function(){w(Z,0)};function W(Q){j=Q,O||(O=!0,I())}function Y(Q,ne){D=w(function(){Q(t.unstable_now())},ne)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(Q){Q.callback=null},t.unstable_continueExecution=function(){y||v||(y=!0,W(A))},t.unstable_forceFrameRate=function(Q){0>Q||125<Q?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):F=0<Q?Math.floor(1e3/Q):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_getFirstCallbackNode=function(){return r(l)},t.unstable_next=function(Q){switch(p){case 1:case 2:case 3:var ne=3;break;default:ne=p}var re=p;p=ne;try{return Q()}finally{p=re}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(Q,ne){switch(Q){case 1:case 2:case 3:case 4:case 5:break;default:Q=3}var re=p;p=Q;try{return ne()}finally{p=re}},t.unstable_scheduleCallback=function(Q,ne,re){var H=t.unstable_now();switch(typeof re=="object"&&re!==null?(re=re.delay,re=typeof re=="number"&&0<re?H+re:H):re=H,Q){case 1:var te=-1;break;case 2:te=250;break;case 5:te=1073741823;break;case 4:te=1e4;break;default:te=5e3}return te=re+te,Q={id:c++,callback:ne,priorityLevel:Q,startTime:re,expirationTime:te,sortIndex:-1},re>H?(Q.sortIndex=re,e(u,Q),r(l)===null&&Q===r(u)&&(S?(T(D),D=-1):S=!0,Y(N,re-H))):(Q.sortIndex=te,e(l,Q),y||v||(y=!0,W(A))),Q},t.unstable_shouldYield=$,t.unstable_wrapCallback=function(Q){var ne=p;return function(){var re=p;p=ne;try{return Q.apply(this,arguments)}finally{p=re}}}})(Ub)),Ub}var _E;function e_(){return _E||(_E=1,zb.exports=A8()),zb.exports}var CE;function L8(){if(CE)return zs;CE=1;var t=um(),e=e_();function r(d){for(var g="https://reactjs.org/docs/error-decoder.html?invariant="+d,E=1;E<arguments.length;E++)g+="&args[]="+encodeURIComponent(arguments[E]);return"Minified React error #"+d+"; visit "+g+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var n=new Set,i={};function a(d,g){s(d,g),s(d+"Capture",g)}function s(d,g){for(i[d]=g,d=0;d<g.length;d++)n.add(g[d])}var o=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),l=Object.prototype.hasOwnProperty,u=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,c={},f={};function p(d){return l.call(f,d)?!0:l.call(c,d)?!1:u.test(d)?f[d]=!0:(c[d]=!0,!1)}function v(d,g,E,R){if(E!==null&&E.type===0)return!1;switch(typeof g){case"function":case"symbol":return!0;case"boolean":return R?!1:E!==null?!E.acceptsBooleans:(d=d.toLowerCase().slice(0,5),d!=="data-"&&d!=="aria-");default:return!1}}function y(d,g,E,R){if(g===null||typeof g>"u"||v(d,g,E,R))return!0;if(R)return!1;if(E!==null)switch(E.type){case 3:return!g;case 4:return g===!1;case 5:return isNaN(g);case 6:return isNaN(g)||1>g}return!1}function S(d,g,E,R,V,X,oe){this.acceptsBooleans=g===2||g===3||g===4,this.attributeName=R,this.attributeNamespace=V,this.mustUseProperty=E,this.propertyName=d,this.type=g,this.sanitizeURL=X,this.removeEmptyString=oe}var w={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(d){w[d]=new S(d,0,!1,d,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(d){var g=d[0];w[g]=new S(g,1,!1,d[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(d){w[d]=new S(d,2,!1,d.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(d){w[d]=new S(d,2,!1,d,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(d){w[d]=new S(d,3,!1,d.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(d){w[d]=new S(d,3,!0,d,null,!1,!1)}),["capture","download"].forEach(function(d){w[d]=new S(d,4,!1,d,null,!1,!1)}),["cols","rows","size","span"].forEach(function(d){w[d]=new S(d,6,!1,d,null,!1,!1)}),["rowSpan","start"].forEach(function(d){w[d]=new S(d,5,!1,d.toLowerCase(),null,!1,!1)});var T=/[\-:]([a-z])/g;function _(d){return d[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(d){var g=d.replace(T,_);w[g]=new S(g,1,!1,d,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(d){var g=d.replace(T,_);w[g]=new S(g,1,!1,d,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(d){var g=d.replace(T,_);w[g]=new S(g,1,!1,d,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(d){w[d]=new S(d,1,!1,d.toLowerCase(),null,!1,!1)}),w.xlinkHref=new S("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(d){w[d]=new S(d,1,!1,d.toLowerCase(),null,!0,!0)});function C(d,g,E,R){var V=w.hasOwnProperty(g)?w[g]:null;(V!==null?V.type!==0:R||!(2<g.length)||g[0]!=="o"&&g[0]!=="O"||g[1]!=="n"&&g[1]!=="N")&&(y(g,E,V,R)&&(E=null),R||V===null?p(g)&&(E===null?d.removeAttribute(g):d.setAttribute(g,""+E)):V.mustUseProperty?d[V.propertyName]=E===null?V.type===3?!1:"":E:(g=V.attributeName,R=V.attributeNamespace,E===null?d.removeAttribute(g):(V=V.type,E=V===3||V===4&&E===!0?"":""+E,R?d.setAttributeNS(R,g,E):d.setAttribute(g,E))))}var N=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,A=Symbol.for("react.element"),O=Symbol.for("react.portal"),j=Symbol.for("react.fragment"),D=Symbol.for("react.strict_mode"),F=Symbol.for("react.profiler"),B=Symbol.for("react.provider"),$=Symbol.for("react.context"),Z=Symbol.for("react.forward_ref"),I=Symbol.for("react.suspense"),q=Symbol.for("react.suspense_list"),U=Symbol.for("react.memo"),W=Symbol.for("react.lazy"),Y=Symbol.for("react.offscreen"),Q=Symbol.iterator;function ne(d){return d===null||typeof d!="object"?null:(d=Q&&d[Q]||d["@@iterator"],typeof d=="function"?d:null)}var re=Object.assign,H;function te(d){if(H===void 0)try{throw Error()}catch(E){var g=E.stack.trim().match(/\n( *(at )?)/);H=g&&g[1]||""}return`
`+H+d}var ie=!1;function de(d,g){if(!d||ie)return"";ie=!0;var E=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(g)if(g=function(){throw Error()},Object.defineProperty(g.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(g,[])}catch(Be){var R=Be}Reflect.construct(d,[],g)}else{try{g.call()}catch(Be){R=Be}d.call(g.prototype)}else{try{throw Error()}catch(Be){R=Be}d()}}catch(Be){if(Be&&R&&typeof Be.stack=="string"){for(var V=Be.stack.split(`
`),X=R.stack.split(`
`),oe=V.length-1,be=X.length-1;1<=oe&&0<=be&&V[oe]!==X[be];)be--;for(;1<=oe&&0<=be;oe--,be--)if(V[oe]!==X[be]){if(oe!==1||be!==1)do if(oe--,be--,0>be||V[oe]!==X[be]){var ke=`
`+V[oe].replace(" at new "," at ");return d.displayName&&ke.includes("<anonymous>")&&(ke=ke.replace("<anonymous>",d.displayName)),ke}while(1<=oe&&0<=be);break}}}finally{ie=!1,Error.prepareStackTrace=E}return(d=d?d.displayName||d.name:"")?te(d):""}function ge(d){switch(d.tag){case 5:return te(d.type);case 16:return te("Lazy");case 13:return te("Suspense");case 19:return te("SuspenseList");case 0:case 2:case 15:return d=de(d.type,!1),d;case 11:return d=de(d.type.render,!1),d;case 1:return d=de(d.type,!0),d;default:return""}}function ye(d){if(d==null)return null;if(typeof d=="function")return d.displayName||d.name||null;if(typeof d=="string")return d;switch(d){case j:return"Fragment";case O:return"Portal";case F:return"Profiler";case D:return"StrictMode";case I:return"Suspense";case q:return"SuspenseList"}if(typeof d=="object")switch(d.$$typeof){case $:return(d.displayName||"Context")+".Consumer";case B:return(d._context.displayName||"Context")+".Provider";case Z:var g=d.render;return d=d.displayName,d||(d=g.displayName||g.name||"",d=d!==""?"ForwardRef("+d+")":"ForwardRef"),d;case U:return g=d.displayName||null,g!==null?g:ye(d.type)||"Memo";case W:g=d._payload,d=d._init;try{return ye(d(g))}catch{}}return null}function ae(d){var g=d.type;switch(d.tag){case 24:return"Cache";case 9:return(g.displayName||"Context")+".Consumer";case 10:return(g._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return d=g.render,d=d.displayName||d.name||"",g.displayName||(d!==""?"ForwardRef("+d+")":"ForwardRef");case 7:return"Fragment";case 5:return g;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return ye(g);case 8:return g===D?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof g=="function")return g.displayName||g.name||null;if(typeof g=="string")return g}return null}function pe(d){switch(typeof d){case"boolean":case"number":case"string":case"undefined":return d;case"object":return d;default:return""}}function le(d){var g=d.type;return(d=d.nodeName)&&d.toLowerCase()==="input"&&(g==="checkbox"||g==="radio")}function me(d){var g=le(d)?"checked":"value",E=Object.getOwnPropertyDescriptor(d.constructor.prototype,g),R=""+d[g];if(!d.hasOwnProperty(g)&&typeof E<"u"&&typeof E.get=="function"&&typeof E.set=="function"){var V=E.get,X=E.set;return Object.defineProperty(d,g,{configurable:!0,get:function(){return V.call(this)},set:function(oe){R=""+oe,X.call(this,oe)}}),Object.defineProperty(d,g,{enumerable:E.enumerable}),{getValue:function(){return R},setValue:function(oe){R=""+oe},stopTracking:function(){d._valueTracker=null,delete d[g]}}}}function he(d){d._valueTracker||(d._valueTracker=me(d))}function xe(d){if(!d)return!1;var g=d._valueTracker;if(!g)return!0;var E=g.getValue(),R="";return d&&(R=le(d)?d.checked?"true":"false":d.value),d=R,d!==E?(g.setValue(d),!0):!1}function we(d){if(d=d||(typeof document<"u"?document:void 0),typeof d>"u")return null;try{return d.activeElement||d.body}catch{return d.body}}function Ge(d,g){var E=g.checked;return re({},g,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:E??d._wrapperState.initialChecked})}function qe(d,g){var E=g.defaultValue==null?"":g.defaultValue,R=g.checked!=null?g.checked:g.defaultChecked;E=pe(g.value!=null?g.value:E),d._wrapperState={initialChecked:R,initialValue:E,controlled:g.type==="checkbox"||g.type==="radio"?g.checked!=null:g.value!=null}}function wt(d,g){g=g.checked,g!=null&&C(d,"checked",g,!1)}function et(d,g){wt(d,g);var E=pe(g.value),R=g.type;if(E!=null)R==="number"?(E===0&&d.value===""||d.value!=E)&&(d.value=""+E):d.value!==""+E&&(d.value=""+E);else if(R==="submit"||R==="reset"){d.removeAttribute("value");return}g.hasOwnProperty("value")?je(d,g.type,E):g.hasOwnProperty("defaultValue")&&je(d,g.type,pe(g.defaultValue)),g.checked==null&&g.defaultChecked!=null&&(d.defaultChecked=!!g.defaultChecked)}function at(d,g,E){if(g.hasOwnProperty("value")||g.hasOwnProperty("defaultValue")){var R=g.type;if(!(R!=="submit"&&R!=="reset"||g.value!==void 0&&g.value!==null))return;g=""+d._wrapperState.initialValue,E||g===d.value||(d.value=g),d.defaultValue=g}E=d.name,E!==""&&(d.name=""),d.defaultChecked=!!d._wrapperState.initialChecked,E!==""&&(d.name=E)}function je(d,g,E){(g!=="number"||we(d.ownerDocument)!==d)&&(E==null?d.defaultValue=""+d._wrapperState.initialValue:d.defaultValue!==""+E&&(d.defaultValue=""+E))}var Re=Array.isArray;function nt(d,g,E,R){if(d=d.options,g){g={};for(var V=0;V<E.length;V++)g["$"+E[V]]=!0;for(E=0;E<d.length;E++)V=g.hasOwnProperty("$"+d[E].value),d[E].selected!==V&&(d[E].selected=V),V&&R&&(d[E].defaultSelected=!0)}else{for(E=""+pe(E),g=null,V=0;V<d.length;V++){if(d[V].value===E){d[V].selected=!0,R&&(d[V].defaultSelected=!0);return}g!==null||d[V].disabled||(g=d[V])}g!==null&&(g.selected=!0)}}function Ce(d,g){if(g.dangerouslySetInnerHTML!=null)throw Error(r(91));return re({},g,{value:void 0,defaultValue:void 0,children:""+d._wrapperState.initialValue})}function Fe(d,g){var E=g.value;if(E==null){if(E=g.children,g=g.defaultValue,E!=null){if(g!=null)throw Error(r(92));if(Re(E)){if(1<E.length)throw Error(r(93));E=E[0]}g=E}g==null&&(g=""),E=g}d._wrapperState={initialValue:pe(E)}}function Ke(d,g){var E=pe(g.value),R=pe(g.defaultValue);E!=null&&(E=""+E,E!==d.value&&(d.value=E),g.defaultValue==null&&d.defaultValue!==E&&(d.defaultValue=E)),R!=null&&(d.defaultValue=""+R)}function pt(d){var g=d.textContent;g===d._wrapperState.initialValue&&g!==""&&g!==null&&(d.value=g)}function vt(d){switch(d){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function At(d,g){return d==null||d==="http://www.w3.org/1999/xhtml"?vt(g):d==="http://www.w3.org/2000/svg"&&g==="foreignObject"?"http://www.w3.org/1999/xhtml":d}var Ut,nr=(function(d){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(g,E,R,V){MSApp.execUnsafeLocalFunction(function(){return d(g,E,R,V)})}:d})(function(d,g){if(d.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in d)d.innerHTML=g;else{for(Ut=Ut||document.createElement("div"),Ut.innerHTML="<svg>"+g.valueOf().toString()+"</svg>",g=Ut.firstChild;d.firstChild;)d.removeChild(d.firstChild);for(;g.firstChild;)d.appendChild(g.firstChild)}});function Ct(d,g){if(g){var E=d.firstChild;if(E&&E===d.lastChild&&E.nodeType===3){E.nodeValue=g;return}}d.textContent=g}var ct={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},We=["Webkit","ms","Moz","O"];Object.keys(ct).forEach(function(d){We.forEach(function(g){g=g+d.charAt(0).toUpperCase()+d.substring(1),ct[g]=ct[d]})});function ce(d,g,E){return g==null||typeof g=="boolean"||g===""?"":E||typeof g!="number"||g===0||ct.hasOwnProperty(d)&&ct[d]?(""+g).trim():g+"px"}function ve(d,g){d=d.style;for(var E in g)if(g.hasOwnProperty(E)){var R=E.indexOf("--")===0,V=ce(E,g[E],R);E==="float"&&(E="cssFloat"),R?d.setProperty(E,V):d[E]=V}}var _e=re({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Te(d,g){if(g){if(_e[d]&&(g.children!=null||g.dangerouslySetInnerHTML!=null))throw Error(r(137,d));if(g.dangerouslySetInnerHTML!=null){if(g.children!=null)throw Error(r(60));if(typeof g.dangerouslySetInnerHTML!="object"||!("__html"in g.dangerouslySetInnerHTML))throw Error(r(61))}if(g.style!=null&&typeof g.style!="object")throw Error(r(62))}}function Le(d,g){if(d.indexOf("-")===-1)return typeof g.is=="string";switch(d){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Xe=null;function He(d){return d=d.target||d.srcElement||window,d.correspondingUseElement&&(d=d.correspondingUseElement),d.nodeType===3?d.parentNode:d}var dt=null,ft=null,Pt=null;function qt(d){if(d=dl(d)){if(typeof dt!="function")throw Error(r(280));var g=d.stateNode;g&&(g=Xn(g),dt(d.stateNode,d.type,g))}}function $t(d){ft?Pt?Pt.push(d):Pt=[d]:ft=d}function kt(){if(ft){var d=ft,g=Pt;if(Pt=ft=null,qt(d),g)for(d=0;d<g.length;d++)qt(g[d])}}function Zt(d,g){return d(g)}function er(){}var Ar=!1;function xr(d,g,E){if(Ar)return d(g,E);Ar=!0;try{return Zt(d,g,E)}finally{Ar=!1,(ft!==null||Pt!==null)&&(er(),kt())}}function $e(d,g){var E=d.stateNode;if(E===null)return null;var R=Xn(E);if(R===null)return null;E=R[g];e:switch(g){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(R=!R.disabled)||(d=d.type,R=!(d==="button"||d==="input"||d==="select"||d==="textarea")),d=!R;break e;default:d=!1}if(d)return null;if(E&&typeof E!="function")throw Error(r(231,g,typeof E));return E}var yt=!1;if(o)try{var Et={};Object.defineProperty(Et,"passive",{get:function(){yt=!0}}),window.addEventListener("test",Et,Et),window.removeEventListener("test",Et,Et)}catch{yt=!1}function rr(d,g,E,R,V,X,oe,be,ke){var Be=Array.prototype.slice.call(arguments,3);try{g.apply(E,Be)}catch(tt){this.onError(tt)}}var zt=!1,lt=null,Pr=!1,zr=null,wi={onError:function(d){zt=!0,lt=d}};function Va(d,g,E,R,V,X,oe,be,ke){zt=!1,lt=null,rr.apply(wi,arguments)}function mo(d,g,E,R,V,X,oe,be,ke){if(Va.apply(this,arguments),zt){if(zt){var Be=lt;zt=!1,lt=null}else throw Error(r(198));Pr||(Pr=!0,zr=Be)}}function Si(d){var g=d,E=d;if(d.alternate)for(;g.return;)g=g.return;else{d=g;do g=d,(g.flags&4098)!==0&&(E=g.return),d=g.return;while(d)}return g.tag===3?E:null}function gn(d){if(d.tag===13){var g=d.memoizedState;if(g===null&&(d=d.alternate,d!==null&&(g=d.memoizedState)),g!==null)return g.dehydrated}return null}function Pn(d){if(Si(d)!==d)throw Error(r(188))}function ki(d){var g=d.alternate;if(!g){if(g=Si(d),g===null)throw Error(r(188));return g!==d?null:d}for(var E=d,R=g;;){var V=E.return;if(V===null)break;var X=V.alternate;if(X===null){if(R=V.return,R!==null){E=R;continue}break}if(V.child===X.child){for(X=V.child;X;){if(X===E)return Pn(V),d;if(X===R)return Pn(V),g;X=X.sibling}throw Error(r(188))}if(E.return!==R.return)E=V,R=X;else{for(var oe=!1,be=V.child;be;){if(be===E){oe=!0,E=V,R=X;break}if(be===R){oe=!0,R=V,E=X;break}be=be.sibling}if(!oe){for(be=X.child;be;){if(be===E){oe=!0,E=X,R=V;break}if(be===R){oe=!0,R=X,E=V;break}be=be.sibling}if(!oe)throw Error(r(189))}}if(E.alternate!==R)throw Error(r(190))}if(E.tag!==3)throw Error(r(188));return E.stateNode.current===E?d:g}function go(d){return d=ki(d),d!==null?Oi(d):null}function Oi(d){if(d.tag===5||d.tag===6)return d;for(d=d.child;d!==null;){var g=Oi(d);if(g!==null)return g;d=d.sibling}return null}var Au=e.unstable_scheduleCallback,Lu=e.unstable_cancelCallback,yf=e.unstable_shouldYield,Dl=e.unstable_requestPaint,cn=e.unstable_now,Ru=e.unstable_getCurrentPriorityLevel,Ys=e.unstable_ImmediatePriority,Il=e.unstable_UserBlockingPriority,Ha=e.unstable_NormalPriority,Zo=e.unstable_LowPriority,ma=e.unstable_IdlePriority,ga=null,_n=null;function Mr(d){if(_n&&typeof _n.onCommitFiberRoot=="function")try{_n.onCommitFiberRoot(ga,d,void 0,(d.current.flags&128)===128)}catch{}}var ht=Math.clz32?Math.clz32:Qr,kr=Math.log,vn=Math.LN2;function Qr(d){return d>>>=0,d===0?32:31-(kr(d)/vn|0)|0}var Ur=64,va=4194304;function Ft(d){switch(d&-d){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return d&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return d&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return d}}function Lr(d,g){var E=d.pendingLanes;if(E===0)return 0;var R=0,V=d.suspendedLanes,X=d.pingedLanes,oe=E&268435455;if(oe!==0){var be=oe&~V;be!==0?R=Ft(be):(X&=oe,X!==0&&(R=Ft(X)))}else oe=E&~V,oe!==0?R=Ft(oe):X!==0&&(R=Ft(X));if(R===0)return 0;if(g!==0&&g!==R&&(g&V)===0&&(V=R&-R,X=g&-g,V>=X||V===16&&(X&4194240)!==0))return g;if((R&4)!==0&&(R|=E&16),g=d.entangledLanes,g!==0)for(d=d.entanglements,g&=R;0<g;)E=31-ht(g),V=1<<E,R|=d[E],g&=~V;return R}function Ec(d,g){switch(d){case 1:case 2:case 4:return g+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return g+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Ou(d,g){for(var E=d.suspendedLanes,R=d.pingedLanes,V=d.expirationTimes,X=d.pendingLanes;0<X;){var oe=31-ht(X),be=1<<oe,ke=V[oe];ke===-1?((be&E)===0||(be&R)!==0)&&(V[oe]=Ec(be,g)):ke<=g&&(d.expiredLanes|=be),X&=~be}}function li(d){return d=d.pendingLanes&-1073741825,d!==0?d:d&1073741824?1073741824:0}function xf(){var d=Ur;return Ur<<=1,(Ur&4194240)===0&&(Ur=64),d}function _i(d){for(var g=[],E=0;31>E;E++)g.push(d);return g}function cs(d,g,E){d.pendingLanes|=g,g!==536870912&&(d.suspendedLanes=0,d.pingedLanes=0),d=d.eventTimes,g=31-ht(g),d[g]=E}function Mn(d,g){var E=d.pendingLanes&~g;d.pendingLanes=g,d.suspendedLanes=0,d.pingedLanes=0,d.expiredLanes&=g,d.mutableReadLanes&=g,d.entangledLanes&=g,g=d.entanglements;var R=d.eventTimes;for(d=d.expirationTimes;0<E;){var V=31-ht(E),X=1<<V;g[V]=0,R[V]=-1,d[V]=-1,E&=~X}}function Xs(d,g){var E=d.entangledLanes|=g;for(d=d.entanglements;E;){var R=31-ht(E),V=1<<R;V&g|d[R]&g&&(d[R]|=g),E&=~V}}var mr=0;function Qs(d){return d&=-d,1<d?4<d?(d&268435455)!==0?16:536870912:4:1}var vo,Ns,Tc,Nc,Yo,jl=!1,yo=[],Di=null,Js=null,Wa=null,gr=new Map,tr=new Map,Wn=[],Gr="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function bf(d,g){switch(d){case"focusin":case"focusout":Di=null;break;case"dragenter":case"dragleave":Js=null;break;case"mouseover":case"mouseout":Wa=null;break;case"pointerover":case"pointerout":gr.delete(g.pointerId);break;case"gotpointercapture":case"lostpointercapture":tr.delete(g.pointerId)}}function Xo(d,g,E,R,V,X){return d===null||d.nativeEvent!==X?(d={blockedOn:g,domEventName:E,eventSystemFlags:R,nativeEvent:X,targetContainers:[V]},g!==null&&(g=dl(g),g!==null&&Ns(g)),d):(d.eventSystemFlags|=R,g=d.targetContainers,V!==null&&g.indexOf(V)===-1&&g.push(V),d)}function An(d,g,E,R,V){switch(g){case"focusin":return Di=Xo(Di,d,g,E,R,V),!0;case"dragenter":return Js=Xo(Js,d,g,E,R,V),!0;case"mouseover":return Wa=Xo(Wa,d,g,E,R,V),!0;case"pointerover":var X=V.pointerId;return gr.set(X,Xo(gr.get(X)||null,d,g,E,R,V)),!0;case"gotpointercapture":return X=V.pointerId,tr.set(X,Xo(tr.get(X)||null,d,g,E,R,V)),!0}return!1}function Fl(d){var g=Eo(d.target);if(g!==null){var E=Si(g);if(E!==null){if(g=E.tag,g===13){if(g=gn(E),g!==null){d.blockedOn=g,Yo(d.priority,function(){Tc(E)});return}}else if(g===3&&E.stateNode.current.memoizedState.isDehydrated){d.blockedOn=E.tag===3?E.stateNode.containerInfo:null;return}}}d.blockedOn=null}function Ps(d){if(d.blockedOn!==null)return!1;for(var g=d.targetContainers;0<g.length;){var E=ju(d.domEventName,d.eventSystemFlags,g[0],d.nativeEvent);if(E===null){E=d.nativeEvent;var R=new E.constructor(E.type,E);Xe=R,E.target.dispatchEvent(R),Xe=null}else return g=dl(E),g!==null&&Ns(g),d.blockedOn=E,!1;g.shift()}return!0}function Bl(d,g,E){Ps(d)&&E.delete(g)}function Du(){jl=!1,Di!==null&&Ps(Di)&&(Di=null),Js!==null&&Ps(Js)&&(Js=null),Wa!==null&&Ps(Wa)&&(Wa=null),gr.forEach(Bl),tr.forEach(Bl)}function nn(d,g){d.blockedOn===g&&(d.blockedOn=null,jl||(jl=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,Du)))}function Ln(d){function g(V){return nn(V,d)}if(0<yo.length){nn(yo[0],d);for(var E=1;E<yo.length;E++){var R=yo[E];R.blockedOn===d&&(R.blockedOn=null)}}for(Di!==null&&nn(Di,d),Js!==null&&nn(Js,d),Wa!==null&&nn(Wa,d),gr.forEach(g),tr.forEach(g),E=0;E<Wn.length;E++)R=Wn[E],R.blockedOn===d&&(R.blockedOn=null);for(;0<Wn.length&&(E=Wn[0],E.blockedOn===null);)Fl(E),E.blockedOn===null&&Wn.shift()}var Qo=N.ReactCurrentBatchConfig,Iu=!0;function ds(d,g,E,R){var V=mr,X=Qo.transition;Qo.transition=null;try{mr=1,xo(d,g,E,R)}finally{mr=V,Qo.transition=X}}function Ms(d,g,E,R){var V=mr,X=Qo.transition;Qo.transition=null;try{mr=4,xo(d,g,E,R)}finally{mr=V,Qo.transition=X}}function xo(d,g,E,R){if(Iu){var V=ju(d,g,E,R);if(V===null)h(d,g,R,zl,E),bf(d,R);else if(An(V,d,g,E,R))R.stopPropagation();else if(bf(d,R),g&4&&-1<Gr.indexOf(d)){for(;V!==null;){var X=dl(V);if(X!==null&&vo(X),X=ju(d,g,E,R),X===null&&h(d,g,R,zl,E),X===V)break;V=X}V!==null&&R.stopPropagation()}else h(d,g,R,null,E)}}var zl=null;function ju(d,g,E,R){if(zl=null,d=He(R),d=Eo(d),d!==null)if(g=Si(d),g===null)d=null;else if(E=g.tag,E===13){if(d=gn(g),d!==null)return d;d=null}else if(E===3){if(g.stateNode.current.memoizedState.isDehydrated)return g.tag===3?g.stateNode.containerInfo:null;d=null}else g!==d&&(d=null);return zl=d,null}function br(d){switch(d){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Ru()){case Ys:return 1;case Il:return 4;case Ha:case Zo:return 16;case ma:return 536870912;default:return 16}default:return 16}}var ui=null,Zn=null,ya=null;function Ul(){if(ya)return ya;var d,g=Zn,E=g.length,R,V="value"in ui?ui.value:ui.textContent,X=V.length;for(d=0;d<E&&g[d]===V[d];d++);var oe=E-d;for(R=1;R<=oe&&g[E-R]===V[X-R];R++);return ya=V.slice(d,1<R?1-R:void 0)}function Jo(d){var g=d.keyCode;return"charCode"in d?(d=d.charCode,d===0&&g===13&&(d=13)):d=g,d===10&&(d=13),32<=d||d===13?d:0}function ci(){return!0}function xa(){return!1}function Rn(d){function g(E,R,V,X,oe){this._reactName=E,this._targetInst=V,this.type=R,this.nativeEvent=X,this.target=oe,this.currentTarget=null;for(var be in d)d.hasOwnProperty(be)&&(E=d[be],this[be]=E?E(X):X[be]);return this.isDefaultPrevented=(X.defaultPrevented!=null?X.defaultPrevented:X.returnValue===!1)?ci:xa,this.isPropagationStopped=xa,this}return re(g.prototype,{preventDefault:function(){this.defaultPrevented=!0;var E=this.nativeEvent;E&&(E.preventDefault?E.preventDefault():typeof E.returnValue!="unknown"&&(E.returnValue=!1),this.isDefaultPrevented=ci)},stopPropagation:function(){var E=this.nativeEvent;E&&(E.stopPropagation?E.stopPropagation():typeof E.cancelBubble!="unknown"&&(E.cancelBubble=!0),this.isPropagationStopped=ci)},persist:function(){},isPersistent:ci}),g}var qi={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(d){return d.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},fs=Rn(qi),ba=re({},qi,{view:0,detail:0}),jh=Rn(ba),$i,Fu,Yn,yn=re({},ba,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:hs,button:0,buttons:0,relatedTarget:function(d){return d.relatedTarget===void 0?d.fromElement===d.srcElement?d.toElement:d.fromElement:d.relatedTarget},movementX:function(d){return"movementX"in d?d.movementX:(d!==Yn&&(Yn&&d.type==="mousemove"?($i=d.screenX-Yn.screenX,Fu=d.screenY-Yn.screenY):Fu=$i=0,Yn=d),$i)},movementY:function(d){return"movementY"in d?d.movementY:Fu}}),$r=Rn(yn),Gl=re({},yn,{dataTransfer:0}),wa=Rn(Gl),Fh=re({},ba,{relatedTarget:0}),Bu=Rn(Fh),Pc=re({},qi,{animationName:0,elapsedTime:0,pseudoElement:0}),wf=Rn(Pc),Bh=re({},qi,{clipboardData:function(d){return"clipboardData"in d?d.clipboardData:window.clipboardData}}),Vl=Rn(Bh),zh=re({},qi,{data:0}),bo=Rn(zh),Mc={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Ac={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},As={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function wm(d){var g=this.nativeEvent;return g.getModifierState?g.getModifierState(d):(d=As[d])?!!g[d]:!1}function hs(){return wm}var Ii=re({},ba,{key:function(d){if(d.key){var g=Mc[d.key]||d.key;if(g!=="Unidentified")return g}return d.type==="keypress"?(d=Jo(d),d===13?"Enter":String.fromCharCode(d)):d.type==="keydown"||d.type==="keyup"?Ac[d.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:hs,charCode:function(d){return d.type==="keypress"?Jo(d):0},keyCode:function(d){return d.type==="keydown"||d.type==="keyup"?d.keyCode:0},which:function(d){return d.type==="keypress"?Jo(d):d.type==="keydown"||d.type==="keyup"?d.keyCode:0}}),Sf=Rn(Ii),kf=re({},yn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),el=Rn(kf),Lc=re({},ba,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:hs}),Hl=Rn(Lc),Rc=re({},qi,{propertyName:0,elapsedTime:0,pseudoElement:0}),Wl=Rn(Rc),Oc=re({},yn,{deltaX:function(d){return"deltaX"in d?d.deltaX:"wheelDeltaX"in d?-d.wheelDeltaX:0},deltaY:function(d){return"deltaY"in d?d.deltaY:"wheelDeltaY"in d?-d.wheelDeltaY:"wheelDelta"in d?-d.wheelDelta:0},deltaZ:0,deltaMode:0}),_f=Rn(Oc),qa=[9,13,27,32],Ls=o&&"CompositionEvent"in window,tl=null;o&&"documentMode"in document&&(tl=document.documentMode);var Ki=o&&"TextEvent"in window&&!tl,Sa=o&&(!Ls||tl&&8<tl&&11>=tl),ka=" ",Dc=!1;function rl(d,g){switch(d){case"keyup":return qa.indexOf(g.keyCode)!==-1;case"keydown":return g.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function $a(d){return d=d.detail,typeof d=="object"&&"data"in d?d.data:null}var Ci=!1;function Cf(d,g){switch(d){case"compositionend":return $a(g);case"keypress":return g.which!==32?null:(Dc=!0,ka);case"textInput":return d=g.data,d===ka&&Dc?null:d;default:return null}}function eo(d,g){if(Ci)return d==="compositionend"||!Ls&&rl(d,g)?(d=Ul(),ya=Zn=ui=null,Ci=!1,d):null;switch(d){case"paste":return null;case"keypress":if(!(g.ctrlKey||g.altKey||g.metaKey)||g.ctrlKey&&g.altKey){if(g.char&&1<g.char.length)return g.char;if(g.which)return String.fromCharCode(g.which)}return null;case"compositionend":return Sa&&g.locale!=="ko"?null:g.data;default:return null}}var Ka={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function to(d){var g=d&&d.nodeName&&d.nodeName.toLowerCase();return g==="input"?!!Ka[d.type]:g==="textarea"}function nl(d,g,E,R){$t(R),g=P(g,"onChange"),0<g.length&&(E=new fs("onChange","change",null,E,R),d.push({event:E,listeners:g}))}var ql=null,Ei=null;function Uh(d){Uc(d,0)}function _a(d){var g=jn(d);if(xe(g))return d}function Za(d,g){if(d==="change")return g}var Zi=!1;if(o){var ps;if(o){var Ca="oninput"in document;if(!Ca){var $l=document.createElement("div");$l.setAttribute("oninput","return;"),Ca=typeof $l.oninput=="function"}ps=Ca}else ps=!1;Zi=ps&&(!document.documentMode||9<document.documentMode)}function Rs(){ql&&(ql.detachEvent("onpropertychange",zu),Ei=ql=null)}function zu(d){if(d.propertyName==="value"&&_a(Ei)){var g=[];nl(g,Ei,d,He(d)),xr(Uh,g)}}function Kl(d,g,E){d==="focusin"?(Rs(),ql=g,Ei=E,ql.attachEvent("onpropertychange",zu)):d==="focusout"&&Rs()}function jr(d){if(d==="selectionchange"||d==="keyup"||d==="keydown")return _a(Ei)}function il(d,g){if(d==="click")return _a(g)}function Uu(d,g){if(d==="input"||d==="change")return _a(g)}function Ic(d,g){return d===g&&(d!==0||1/d===1/g)||d!==d&&g!==g}var Yi=typeof Object.is=="function"?Object.is:Ic;function Os(d,g){if(Yi(d,g))return!0;if(typeof d!="object"||d===null||typeof g!="object"||g===null)return!1;var E=Object.keys(d),R=Object.keys(g);if(E.length!==R.length)return!1;for(R=0;R<E.length;R++){var V=E[R];if(!l.call(g,V)||!Yi(d[V],g[V]))return!1}return!0}function wo(d){for(;d&&d.firstChild;)d=d.firstChild;return d}function Jr(d,g){var E=wo(d);d=0;for(var R;E;){if(E.nodeType===3){if(R=d+E.textContent.length,d<=g&&R>=g)return{node:E,offset:g-d};d=R}e:{for(;E;){if(E.nextSibling){E=E.nextSibling;break e}E=E.parentNode}E=void 0}E=wo(E)}}function On(d,g){return d&&g?d===g?!0:d&&d.nodeType===3?!1:g&&g.nodeType===3?On(d,g.parentNode):"contains"in d?d.contains(g):d.compareDocumentPosition?!!(d.compareDocumentPosition(g)&16):!1:!1}function Dn(){for(var d=window,g=we();g instanceof d.HTMLIFrameElement;){try{var E=typeof g.contentWindow.location.href=="string"}catch{E=!1}if(E)d=g.contentWindow;else break;g=we(d.document)}return g}function Zl(d){var g=d&&d.nodeName&&d.nodeName.toLowerCase();return g&&(g==="input"&&(d.type==="text"||d.type==="search"||d.type==="tel"||d.type==="url"||d.type==="password")||g==="textarea"||d.contentEditable==="true")}function Xi(d){var g=Dn(),E=d.focusedElem,R=d.selectionRange;if(g!==E&&E&&E.ownerDocument&&On(E.ownerDocument.documentElement,E)){if(R!==null&&Zl(E)){if(g=R.start,d=R.end,d===void 0&&(d=g),"selectionStart"in E)E.selectionStart=g,E.selectionEnd=Math.min(d,E.value.length);else if(d=(g=E.ownerDocument||document)&&g.defaultView||window,d.getSelection){d=d.getSelection();var V=E.textContent.length,X=Math.min(R.start,V);R=R.end===void 0?X:Math.min(R.end,V),!d.extend&&X>R&&(V=R,R=X,X=V),V=Jr(E,X);var oe=Jr(E,R);V&&oe&&(d.rangeCount!==1||d.anchorNode!==V.node||d.anchorOffset!==V.offset||d.focusNode!==oe.node||d.focusOffset!==oe.offset)&&(g=g.createRange(),g.setStart(V.node,V.offset),d.removeAllRanges(),X>R?(d.addRange(g),d.extend(oe.node,oe.offset)):(g.setEnd(oe.node,oe.offset),d.addRange(g)))}}for(g=[],d=E;d=d.parentNode;)d.nodeType===1&&g.push({element:d,left:d.scrollLeft,top:d.scrollTop});for(typeof E.focus=="function"&&E.focus(),E=0;E<g.length;E++)d=g[E],d.element.scrollLeft=d.left,d.element.scrollTop=d.top}}var So=o&&"documentMode"in document&&11>=document.documentMode,Yl=null,Cn=null,al=null,Xl=!1;function jc(d,g,E){var R=E.window===E?E.document:E.nodeType===9?E:E.ownerDocument;Xl||Yl==null||Yl!==we(R)||(R=Yl,"selectionStart"in R&&Zl(R)?R={start:R.selectionStart,end:R.selectionEnd}:(R=(R.ownerDocument&&R.ownerDocument.defaultView||window).getSelection(),R={anchorNode:R.anchorNode,anchorOffset:R.anchorOffset,focusNode:R.focusNode,focusOffset:R.focusOffset}),al&&Os(al,R)||(al=R,R=P(Cn,"onSelect"),0<R.length&&(g=new fs("onSelect","select",null,g,E),d.push({event:g,listeners:R}),g.target=Yl)))}function di(d,g){var E={};return E[d.toLowerCase()]=g.toLowerCase(),E["Webkit"+d]="webkit"+g,E["Moz"+d]="moz"+g,E}var fi={animationend:di("Animation","AnimationEnd"),animationiteration:di("Animation","AnimationIteration"),animationstart:di("Animation","AnimationStart"),transitionend:di("Transition","TransitionEnd")},Ya={},Gu={};o&&(Gu=document.createElement("div").style,"AnimationEvent"in window||(delete fi.animationend.animation,delete fi.animationiteration.animation,delete fi.animationstart.animation),"TransitionEvent"in window||delete fi.transitionend.transition);function sl(d){if(Ya[d])return Ya[d];if(!fi[d])return d;var g=fi[d],E;for(E in g)if(g.hasOwnProperty(E)&&E in Gu)return Ya[d]=g[E];return d}var Ef=sl("animationend"),ms=sl("animationiteration"),Fc=sl("animationstart"),Bc=sl("transitionend"),ol=new Map,Tf="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Xa(d,g){ol.set(d,g),a(g,[d])}for(var ko=0;ko<Tf.length;ko++){var _o=Tf[ko],Nf=_o.toLowerCase(),zc=_o[0].toUpperCase()+_o.slice(1);Xa(Nf,"on"+zc)}Xa(Ef,"onAnimationEnd"),Xa(ms,"onAnimationIteration"),Xa(Fc,"onAnimationStart"),Xa("dblclick","onDoubleClick"),Xa("focusin","onFocus"),Xa("focusout","onBlur"),Xa(Bc,"onTransitionEnd"),s("onMouseEnter",["mouseout","mouseover"]),s("onMouseLeave",["mouseout","mouseover"]),s("onPointerEnter",["pointerout","pointerover"]),s("onPointerLeave",["pointerout","pointerover"]),a("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),a("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),a("onBeforeInput",["compositionend","keypress","textInput","paste"]),a("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),a("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),a("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ro="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Pf=new Set("cancel close invalid load scroll toggle".split(" ").concat(ro));function Vu(d,g,E){var R=d.type||"unknown-event";d.currentTarget=E,mo(R,g,void 0,d),d.currentTarget=null}function Uc(d,g){g=(g&4)!==0;for(var E=0;E<d.length;E++){var R=d[E],V=R.event;R=R.listeners;e:{var X=void 0;if(g)for(var oe=R.length-1;0<=oe;oe--){var be=R[oe],ke=be.instance,Be=be.currentTarget;if(be=be.listener,ke!==X&&V.isPropagationStopped())break e;Vu(V,be,Be),X=ke}else for(oe=0;oe<R.length;oe++){if(be=R[oe],ke=be.instance,Be=be.currentTarget,be=be.listener,ke!==X&&V.isPropagationStopped())break e;Vu(V,be,Be),X=ke}}}if(Pr)throw d=zr,Pr=!1,zr=null,d}function Vr(d,g){var E=g[cl];E===void 0&&(E=g[cl]=new Set);var R=d+"__bubble";E.has(R)||(Mf(g,d,2,!1),E.add(R))}function Gc(d,g,E){var R=0;g&&(R|=4),Mf(E,d,R,g)}var Ql="_reactListening"+Math.random().toString(36).slice(2);function Co(d){if(!d[Ql]){d[Ql]=!0,n.forEach(function(E){E!=="selectionchange"&&(Pf.has(E)||Gc(E,!1,d),Gc(E,!0,d))});var g=d.nodeType===9?d:d.ownerDocument;g===null||g[Ql]||(g[Ql]=!0,Gc("selectionchange",!1,g))}}function Mf(d,g,E,R){switch(br(g)){case 1:var V=ds;break;case 4:V=Ms;break;default:V=xo}E=V.bind(null,g,E,d),V=void 0,!yt||g!=="touchstart"&&g!=="touchmove"&&g!=="wheel"||(V=!0),R?V!==void 0?d.addEventListener(g,E,{capture:!0,passive:V}):d.addEventListener(g,E,!0):V!==void 0?d.addEventListener(g,E,{passive:V}):d.addEventListener(g,E,!1)}function h(d,g,E,R,V){var X=R;if((g&1)===0&&(g&2)===0&&R!==null)e:for(;;){if(R===null)return;var oe=R.tag;if(oe===3||oe===4){var be=R.stateNode.containerInfo;if(be===V||be.nodeType===8&&be.parentNode===V)break;if(oe===4)for(oe=R.return;oe!==null;){var ke=oe.tag;if((ke===3||ke===4)&&(ke=oe.stateNode.containerInfo,ke===V||ke.nodeType===8&&ke.parentNode===V))return;oe=oe.return}for(;be!==null;){if(oe=Eo(be),oe===null)return;if(ke=oe.tag,ke===5||ke===6){R=X=oe;continue e}be=be.parentNode}}R=R.return}xr(function(){var Be=X,tt=He(E),it=[];e:{var Je=ol.get(d);if(Je!==void 0){var Tt=fs,It=d;switch(d){case"keypress":if(Jo(E)===0)break e;case"keydown":case"keyup":Tt=Sf;break;case"focusin":It="focus",Tt=Bu;break;case"focusout":It="blur",Tt=Bu;break;case"beforeblur":case"afterblur":Tt=Bu;break;case"click":if(E.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Tt=$r;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Tt=wa;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Tt=Hl;break;case Ef:case ms:case Fc:Tt=wf;break;case Bc:Tt=Wl;break;case"scroll":Tt=jh;break;case"wheel":Tt=_f;break;case"copy":case"cut":case"paste":Tt=Vl;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Tt=el}var Bt=(g&4)!==0,gi=!Bt&&d==="scroll",Ae=Bt?Je!==null?Je+"Capture":null:Je;Bt=[];for(var Ee=Be,Oe;Ee!==null;){Oe=Ee;var ut=Oe.stateNode;if(Oe.tag===5&&ut!==null&&(Oe=ut,Ae!==null&&(ut=$e(Ee,Ae),ut!=null&&Bt.push(k(Ee,ut,Oe)))),gi)break;Ee=Ee.return}0<Bt.length&&(Je=new Tt(Je,It,null,E,tt),it.push({event:Je,listeners:Bt}))}}if((g&7)===0){e:{if(Je=d==="mouseover"||d==="pointerover",Tt=d==="mouseout"||d==="pointerout",Je&&E!==Xe&&(It=E.relatedTarget||E.fromElement)&&(Eo(It)||It[Rr]))break e;if((Tt||Je)&&(Je=tt.window===tt?tt:(Je=tt.ownerDocument)?Je.defaultView||Je.parentWindow:window,Tt?(It=E.relatedTarget||E.toElement,Tt=Be,It=It?Eo(It):null,It!==null&&(gi=Si(It),It!==gi||It.tag!==5&&It.tag!==6)&&(It=null)):(Tt=null,It=Be),Tt!==It)){if(Bt=$r,ut="onMouseLeave",Ae="onMouseEnter",Ee="mouse",(d==="pointerout"||d==="pointerover")&&(Bt=el,ut="onPointerLeave",Ae="onPointerEnter",Ee="pointer"),gi=Tt==null?Je:jn(Tt),Oe=It==null?Je:jn(It),Je=new Bt(ut,Ee+"leave",Tt,E,tt),Je.target=gi,Je.relatedTarget=Oe,ut=null,Eo(tt)===Be&&(Bt=new Bt(Ae,Ee+"enter",It,E,tt),Bt.target=Oe,Bt.relatedTarget=gi,ut=Bt),gi=ut,Tt&&It)t:{for(Bt=Tt,Ae=It,Ee=0,Oe=Bt;Oe;Oe=G(Oe))Ee++;for(Oe=0,ut=Ae;ut;ut=G(ut))Oe++;for(;0<Ee-Oe;)Bt=G(Bt),Ee--;for(;0<Oe-Ee;)Ae=G(Ae),Oe--;for(;Ee--;){if(Bt===Ae||Ae!==null&&Bt===Ae.alternate)break t;Bt=G(Bt),Ae=G(Ae)}Bt=null}else Bt=null;Tt!==null&&J(it,Je,Tt,Bt,!1),It!==null&&gi!==null&&J(it,gi,It,Bt,!0)}}e:{if(Je=Be?jn(Be):window,Tt=Je.nodeName&&Je.nodeName.toLowerCase(),Tt==="select"||Tt==="input"&&Je.type==="file")var Gt=Za;else if(to(Je))if(Zi)Gt=Uu;else{Gt=jr;var Xt=Kl}else(Tt=Je.nodeName)&&Tt.toLowerCase()==="input"&&(Je.type==="checkbox"||Je.type==="radio")&&(Gt=il);if(Gt&&(Gt=Gt(d,Be))){nl(it,Gt,E,tt);break e}Xt&&Xt(d,Je,Be),d==="focusout"&&(Xt=Je._wrapperState)&&Xt.controlled&&Je.type==="number"&&je(Je,"number",Je.value)}switch(Xt=Be?jn(Be):window,d){case"focusin":(to(Xt)||Xt.contentEditable==="true")&&(Yl=Xt,Cn=Be,al=null);break;case"focusout":al=Cn=Yl=null;break;case"mousedown":Xl=!0;break;case"contextmenu":case"mouseup":case"dragend":Xl=!1,jc(it,E,tt);break;case"selectionchange":if(So)break;case"keydown":case"keyup":jc(it,E,tt)}var Qt;if(Ls)e:{switch(d){case"compositionstart":var ar="onCompositionStart";break e;case"compositionend":ar="onCompositionEnd";break e;case"compositionupdate":ar="onCompositionUpdate";break e}ar=void 0}else Ci?rl(d,E)&&(ar="onCompositionEnd"):d==="keydown"&&E.keyCode===229&&(ar="onCompositionStart");ar&&(Sa&&E.locale!=="ko"&&(Ci||ar!=="onCompositionStart"?ar==="onCompositionEnd"&&Ci&&(Qt=Ul()):(ui=tt,Zn="value"in ui?ui.value:ui.textContent,Ci=!0)),Xt=P(Be,ar),0<Xt.length&&(ar=new bo(ar,d,null,E,tt),it.push({event:ar,listeners:Xt}),Qt?ar.data=Qt:(Qt=$a(E),Qt!==null&&(ar.data=Qt)))),(Qt=Ki?Cf(d,E):eo(d,E))&&(Be=P(Be,"onBeforeInput"),0<Be.length&&(tt=new bo("onBeforeInput","beforeinput",null,E,tt),it.push({event:tt,listeners:Be}),tt.data=Qt))}Uc(it,g)})}function k(d,g,E){return{instance:d,listener:g,currentTarget:E}}function P(d,g){for(var E=g+"Capture",R=[];d!==null;){var V=d,X=V.stateNode;V.tag===5&&X!==null&&(V=X,X=$e(d,E),X!=null&&R.unshift(k(d,X,V)),X=$e(d,g),X!=null&&R.push(k(d,X,V))),d=d.return}return R}function G(d){if(d===null)return null;do d=d.return;while(d&&d.tag!==5);return d||null}function J(d,g,E,R,V){for(var X=g._reactName,oe=[];E!==null&&E!==R;){var be=E,ke=be.alternate,Be=be.stateNode;if(ke!==null&&ke===R)break;be.tag===5&&Be!==null&&(be=Be,V?(ke=$e(E,X),ke!=null&&oe.unshift(k(E,ke,be))):V||(ke=$e(E,X),ke!=null&&oe.push(k(E,ke,be)))),E=E.return}oe.length!==0&&d.push({event:g,listeners:oe})}var ue=/\r\n?/g,Se=/\u0000|\uFFFD/g;function Me(d){return(typeof d=="string"?d:""+d).replace(ue,`
`).replace(Se,"")}function De(d,g,E){if(g=Me(g),Me(d)!==g&&E)throw Error(r(425))}function Ze(){}var xt=null,Kt=null;function dr(d,g){return d==="textarea"||d==="noscript"||typeof g.children=="string"||typeof g.children=="number"||typeof g.dangerouslySetInnerHTML=="object"&&g.dangerouslySetInnerHTML!==null&&g.dangerouslySetInnerHTML.__html!=null}var Hr=typeof setTimeout=="function"?setTimeout:void 0,In=typeof clearTimeout=="function"?clearTimeout:void 0,Ti=typeof Promise=="function"?Promise:void 0,ji=typeof queueMicrotask=="function"?queueMicrotask:typeof Ti<"u"?function(d){return Ti.resolve(null).then(d).catch(ll)}:Hr;function ll(d){setTimeout(function(){throw d})}function Vc(d,g){var E=g,R=0;do{var V=E.nextSibling;if(d.removeChild(E),V&&V.nodeType===8)if(E=V.data,E==="/$"){if(R===0){d.removeChild(V),Ln(g);return}R--}else E!=="$"&&E!=="$?"&&E!=="$!"||R++;E=V}while(E);Ln(g)}function Ds(d){for(;d!=null;d=d.nextSibling){var g=d.nodeType;if(g===1||g===3)break;if(g===8){if(g=d.data,g==="$"||g==="$!"||g==="$?")break;if(g==="/$")return null}}return d}function ul(d){d=d.previousSibling;for(var g=0;d;){if(d.nodeType===8){var E=d.data;if(E==="$"||E==="$!"||E==="$?"){if(g===0)return d;g--}else E==="/$"&&g++}d=d.previousSibling}return null}var no=Math.random().toString(36).slice(2),Qa="__reactFiber$"+no,Jl="__reactProps$"+no,Rr="__reactContainer$"+no,cl="__reactEvents$"+no,Gh="__reactListeners$"+no,Vh="__reactHandles$"+no;function Eo(d){var g=d[Qa];if(g)return g;for(var E=d.parentNode;E;){if(g=E[Rr]||E[Qa]){if(E=g.alternate,g.child!==null||E!==null&&E.child!==null)for(d=ul(d);d!==null;){if(E=d[Qa])return E;d=ul(d)}return g}d=E,E=d.parentNode}return null}function dl(d){return d=d[Qa]||d[Rr],!d||d.tag!==5&&d.tag!==6&&d.tag!==13&&d.tag!==3?null:d}function jn(d){if(d.tag===5||d.tag===6)return d.stateNode;throw Error(r(33))}function Xn(d){return d[Jl]||null}var Hh=[],Hu=-1;function fl(d){return{current:d}}function an(d){0>Hu||(d.current=Hh[Hu],Hh[Hu]=null,Hu--)}function en(d,g){Hu++,Hh[Hu]=d.current,d.current=g}var To={},Fi=fl(To),Qi=fl(!1),eu=To;function Wu(d,g){var E=d.type.contextTypes;if(!E)return To;var R=d.stateNode;if(R&&R.__reactInternalMemoizedUnmaskedChildContext===g)return R.__reactInternalMemoizedMaskedChildContext;var V={},X;for(X in E)V[X]=g[X];return R&&(d=d.stateNode,d.__reactInternalMemoizedUnmaskedChildContext=g,d.__reactInternalMemoizedMaskedChildContext=V),V}function Ji(d){return d=d.childContextTypes,d!=null}function Hc(){an(Qi),an(Fi)}function Sm(d,g,E){if(Fi.current!==To)throw Error(r(168));en(Fi,g),en(Qi,E)}function Wh(d,g,E){var R=d.stateNode;if(g=g.childContextTypes,typeof R.getChildContext!="function")return E;R=R.getChildContext();for(var V in R)if(!(V in g))throw Error(r(108,ae(d)||"Unknown",V));return re({},E,R)}function qu(d){return d=(d=d.stateNode)&&d.__reactInternalMemoizedMergedChildContext||To,eu=Fi.current,en(Fi,d),en(Qi,Qi.current),!0}function S0(d,g,E){var R=d.stateNode;if(!R)throw Error(r(169));E?(d=Wh(d,g,eu),R.__reactInternalMemoizedMergedChildContext=d,an(Qi),an(Fi),en(Fi,d)):an(Qi),en(Qi,E)}var No=null,Wc=!1,qh=!1;function Af(d){No===null?No=[d]:No.push(d)}function hl(d){Wc=!0,Af(d)}function tu(){if(!qh&&No!==null){qh=!0;var d=0,g=mr;try{var E=No;for(mr=1;d<E.length;d++){var R=E[d];do R=R(!0);while(R!==null)}No=null,Wc=!1}catch(V){throw No!==null&&(No=No.slice(d+1)),Au(Ys,tu),V}finally{mr=g,qh=!1}}return null}var Ea=[],$u=0,ru=null,nu=0,Ta=[],Na=0,iu=null,gs=1,xn="";function Ku(d,g){Ea[$u++]=nu,Ea[$u++]=ru,ru=d,nu=g}function k0(d,g,E){Ta[Na++]=gs,Ta[Na++]=xn,Ta[Na++]=iu,iu=d;var R=gs;d=xn;var V=32-ht(R)-1;R&=~(1<<V),E+=1;var X=32-ht(g)+V;if(30<X){var oe=V-V%5;X=(R&(1<<oe)-1).toString(32),R>>=oe,V-=oe,gs=1<<32-ht(g)+V|E<<V|R,xn=X+d}else gs=1<<X|E<<V|R,xn=d}function qc(d){d.return!==null&&(Ku(d,1),k0(d,1,0))}function Ni(d){for(;d===ru;)ru=Ea[--$u],Ea[$u]=null,nu=Ea[--$u],Ea[$u]=null;for(;d===iu;)iu=Ta[--Na],Ta[Na]=null,xn=Ta[--Na],Ta[Na]=null,gs=Ta[--Na],Ta[Na]=null}var vs=null,mt=null,Wr=!1,ys=null;function km(d,g){var E=Do(5,null,null,0);E.elementType="DELETED",E.stateNode=g,E.return=d,g=d.deletions,g===null?(d.deletions=[E],d.flags|=16):g.push(E)}function _0(d,g){switch(d.tag){case 5:var E=d.type;return g=g.nodeType!==1||E.toLowerCase()!==g.nodeName.toLowerCase()?null:g,g!==null?(d.stateNode=g,vs=d,mt=Ds(g.firstChild),!0):!1;case 6:return g=d.pendingProps===""||g.nodeType!==3?null:g,g!==null?(d.stateNode=g,vs=d,mt=null,!0):!1;case 13:return g=g.nodeType!==8?null:g,g!==null?(E=iu!==null?{id:gs,overflow:xn}:null,d.memoizedState={dehydrated:g,treeContext:E,retryLane:1073741824},E=Do(18,null,null,0),E.stateNode=g,E.return=d,d.child=E,vs=d,mt=null,!0):!1;default:return!1}}function Zu(d){return(d.mode&1)!==0&&(d.flags&128)===0}function $c(d){if(Wr){var g=mt;if(g){var E=g;if(!_0(d,g)){if(Zu(d))throw Error(r(418));g=Ds(E.nextSibling);var R=vs;g&&_0(d,g)?km(R,E):(d.flags=d.flags&-4097|2,Wr=!1,vs=d)}}else{if(Zu(d))throw Error(r(418));d.flags=d.flags&-4097|2,Wr=!1,vs=d}}}function $h(d){for(d=d.return;d!==null&&d.tag!==5&&d.tag!==3&&d.tag!==13;)d=d.return;vs=d}function Lf(d){if(d!==vs)return!1;if(!Wr)return $h(d),Wr=!0,!1;var g;if((g=d.tag!==3)&&!(g=d.tag!==5)&&(g=d.type,g=g!=="head"&&g!=="body"&&!dr(d.type,d.memoizedProps)),g&&(g=mt)){if(Zu(d))throw _m(),Error(r(418));for(;g;)km(d,g),g=Ds(g.nextSibling)}if($h(d),d.tag===13){if(d=d.memoizedState,d=d!==null?d.dehydrated:null,!d)throw Error(r(317));e:{for(d=d.nextSibling,g=0;d;){if(d.nodeType===8){var E=d.data;if(E==="/$"){if(g===0){mt=Ds(d.nextSibling);break e}g--}else E!=="$"&&E!=="$!"&&E!=="$?"||g++}d=d.nextSibling}mt=null}}else mt=vs?Ds(d.stateNode.nextSibling):null;return!0}function _m(){for(var d=mt;d;)d=Ds(d.nextSibling)}function Yu(){mt=vs=null,Wr=!1}function Rf(d){ys===null?ys=[d]:ys.push(d)}var Cm=N.ReactCurrentBatchConfig;function qn(d,g,E){if(d=E.ref,d!==null&&typeof d!="function"&&typeof d!="object"){if(E._owner){if(E=E._owner,E){if(E.tag!==1)throw Error(r(309));var R=E.stateNode}if(!R)throw Error(r(147,d));var V=R,X=""+d;return g!==null&&g.ref!==null&&typeof g.ref=="function"&&g.ref._stringRef===X?g.ref:(g=function(oe){var be=V.refs;oe===null?delete be[X]:be[X]=oe},g._stringRef=X,g)}if(typeof d!="string")throw Error(r(284));if(!E._owner)throw Error(r(290,d))}return d}function Ja(d,g){throw d=Object.prototype.toString.call(g),Error(r(31,d==="[object Object]"?"object with keys {"+Object.keys(g).join(", ")+"}":d))}function io(d){var g=d._init;return g(d._payload)}function Kh(d){function g(Ae,Ee){if(d){var Oe=Ae.deletions;Oe===null?(Ae.deletions=[Ee],Ae.flags|=16):Oe.push(Ee)}}function E(Ae,Ee){if(!d)return null;for(;Ee!==null;)g(Ae,Ee),Ee=Ee.sibling;return null}function R(Ae,Ee){for(Ae=new Map;Ee!==null;)Ee.key!==null?Ae.set(Ee.key,Ee):Ae.set(Ee.index,Ee),Ee=Ee.sibling;return Ae}function V(Ae,Ee){return Ae=pd(Ae,Ee),Ae.index=0,Ae.sibling=null,Ae}function X(Ae,Ee,Oe){return Ae.index=Oe,d?(Oe=Ae.alternate,Oe!==null?(Oe=Oe.index,Oe<Ee?(Ae.flags|=2,Ee):Oe):(Ae.flags|=2,Ee)):(Ae.flags|=1048576,Ee)}function oe(Ae){return d&&Ae.alternate===null&&(Ae.flags|=2),Ae}function be(Ae,Ee,Oe,ut){return Ee===null||Ee.tag!==6?(Ee=Ab(Oe,Ae.mode,ut),Ee.return=Ae,Ee):(Ee=V(Ee,Oe),Ee.return=Ae,Ee)}function ke(Ae,Ee,Oe,ut){var Gt=Oe.type;return Gt===j?tt(Ae,Ee,Oe.props.children,ut,Oe.key):Ee!==null&&(Ee.elementType===Gt||typeof Gt=="object"&&Gt!==null&&Gt.$$typeof===W&&io(Gt)===Ee.type)?(ut=V(Ee,Oe.props),ut.ref=qn(Ae,Ee,Oe),ut.return=Ae,ut):(ut=W0(Oe.type,Oe.key,Oe.props,null,Ae.mode,ut),ut.ref=qn(Ae,Ee,Oe),ut.return=Ae,ut)}function Be(Ae,Ee,Oe,ut){return Ee===null||Ee.tag!==4||Ee.stateNode.containerInfo!==Oe.containerInfo||Ee.stateNode.implementation!==Oe.implementation?(Ee=Lb(Oe,Ae.mode,ut),Ee.return=Ae,Ee):(Ee=V(Ee,Oe.children||[]),Ee.return=Ae,Ee)}function tt(Ae,Ee,Oe,ut,Gt){return Ee===null||Ee.tag!==7?(Ee=Hf(Oe,Ae.mode,ut,Gt),Ee.return=Ae,Ee):(Ee=V(Ee,Oe),Ee.return=Ae,Ee)}function it(Ae,Ee,Oe){if(typeof Ee=="string"&&Ee!==""||typeof Ee=="number")return Ee=Ab(""+Ee,Ae.mode,Oe),Ee.return=Ae,Ee;if(typeof Ee=="object"&&Ee!==null){switch(Ee.$$typeof){case A:return Oe=W0(Ee.type,Ee.key,Ee.props,null,Ae.mode,Oe),Oe.ref=qn(Ae,null,Ee),Oe.return=Ae,Oe;case O:return Ee=Lb(Ee,Ae.mode,Oe),Ee.return=Ae,Ee;case W:var ut=Ee._init;return it(Ae,ut(Ee._payload),Oe)}if(Re(Ee)||ne(Ee))return Ee=Hf(Ee,Ae.mode,Oe,null),Ee.return=Ae,Ee;Ja(Ae,Ee)}return null}function Je(Ae,Ee,Oe,ut){var Gt=Ee!==null?Ee.key:null;if(typeof Oe=="string"&&Oe!==""||typeof Oe=="number")return Gt!==null?null:be(Ae,Ee,""+Oe,ut);if(typeof Oe=="object"&&Oe!==null){switch(Oe.$$typeof){case A:return Oe.key===Gt?ke(Ae,Ee,Oe,ut):null;case O:return Oe.key===Gt?Be(Ae,Ee,Oe,ut):null;case W:return Gt=Oe._init,Je(Ae,Ee,Gt(Oe._payload),ut)}if(Re(Oe)||ne(Oe))return Gt!==null?null:tt(Ae,Ee,Oe,ut,null);Ja(Ae,Oe)}return null}function Tt(Ae,Ee,Oe,ut,Gt){if(typeof ut=="string"&&ut!==""||typeof ut=="number")return Ae=Ae.get(Oe)||null,be(Ee,Ae,""+ut,Gt);if(typeof ut=="object"&&ut!==null){switch(ut.$$typeof){case A:return Ae=Ae.get(ut.key===null?Oe:ut.key)||null,ke(Ee,Ae,ut,Gt);case O:return Ae=Ae.get(ut.key===null?Oe:ut.key)||null,Be(Ee,Ae,ut,Gt);case W:var Xt=ut._init;return Tt(Ae,Ee,Oe,Xt(ut._payload),Gt)}if(Re(ut)||ne(ut))return Ae=Ae.get(Oe)||null,tt(Ee,Ae,ut,Gt,null);Ja(Ee,ut)}return null}function It(Ae,Ee,Oe,ut){for(var Gt=null,Xt=null,Qt=Ee,ar=Ee=0,aa=null;Qt!==null&&ar<Oe.length;ar++){Qt.index>ar?(aa=Qt,Qt=null):aa=Qt.sibling;var Fr=Je(Ae,Qt,Oe[ar],ut);if(Fr===null){Qt===null&&(Qt=aa);break}d&&Qt&&Fr.alternate===null&&g(Ae,Qt),Ee=X(Fr,Ee,ar),Xt===null?Gt=Fr:Xt.sibling=Fr,Xt=Fr,Qt=aa}if(ar===Oe.length)return E(Ae,Qt),Wr&&Ku(Ae,ar),Gt;if(Qt===null){for(;ar<Oe.length;ar++)Qt=it(Ae,Oe[ar],ut),Qt!==null&&(Ee=X(Qt,Ee,ar),Xt===null?Gt=Qt:Xt.sibling=Qt,Xt=Qt);return Wr&&Ku(Ae,ar),Gt}for(Qt=R(Ae,Qt);ar<Oe.length;ar++)aa=Tt(Qt,Ae,ar,Oe[ar],ut),aa!==null&&(d&&aa.alternate!==null&&Qt.delete(aa.key===null?ar:aa.key),Ee=X(aa,Ee,ar),Xt===null?Gt=aa:Xt.sibling=aa,Xt=aa);return d&&Qt.forEach(function(md){return g(Ae,md)}),Wr&&Ku(Ae,ar),Gt}function Bt(Ae,Ee,Oe,ut){var Gt=ne(Oe);if(typeof Gt!="function")throw Error(r(150));if(Oe=Gt.call(Oe),Oe==null)throw Error(r(151));for(var Xt=Gt=null,Qt=Ee,ar=Ee=0,aa=null,Fr=Oe.next();Qt!==null&&!Fr.done;ar++,Fr=Oe.next()){Qt.index>ar?(aa=Qt,Qt=null):aa=Qt.sibling;var md=Je(Ae,Qt,Fr.value,ut);if(md===null){Qt===null&&(Qt=aa);break}d&&Qt&&md.alternate===null&&g(Ae,Qt),Ee=X(md,Ee,ar),Xt===null?Gt=md:Xt.sibling=md,Xt=md,Qt=aa}if(Fr.done)return E(Ae,Qt),Wr&&Ku(Ae,ar),Gt;if(Qt===null){for(;!Fr.done;ar++,Fr=Oe.next())Fr=it(Ae,Fr.value,ut),Fr!==null&&(Ee=X(Fr,Ee,ar),Xt===null?Gt=Fr:Xt.sibling=Fr,Xt=Fr);return Wr&&Ku(Ae,ar),Gt}for(Qt=R(Ae,Qt);!Fr.done;ar++,Fr=Oe.next())Fr=Tt(Qt,Ae,ar,Fr.value,ut),Fr!==null&&(d&&Fr.alternate!==null&&Qt.delete(Fr.key===null?ar:Fr.key),Ee=X(Fr,Ee,ar),Xt===null?Gt=Fr:Xt.sibling=Fr,Xt=Fr);return d&&Qt.forEach(function(_8){return g(Ae,_8)}),Wr&&Ku(Ae,ar),Gt}function gi(Ae,Ee,Oe,ut){if(typeof Oe=="object"&&Oe!==null&&Oe.type===j&&Oe.key===null&&(Oe=Oe.props.children),typeof Oe=="object"&&Oe!==null){switch(Oe.$$typeof){case A:e:{for(var Gt=Oe.key,Xt=Ee;Xt!==null;){if(Xt.key===Gt){if(Gt=Oe.type,Gt===j){if(Xt.tag===7){E(Ae,Xt.sibling),Ee=V(Xt,Oe.props.children),Ee.return=Ae,Ae=Ee;break e}}else if(Xt.elementType===Gt||typeof Gt=="object"&&Gt!==null&&Gt.$$typeof===W&&io(Gt)===Xt.type){E(Ae,Xt.sibling),Ee=V(Xt,Oe.props),Ee.ref=qn(Ae,Xt,Oe),Ee.return=Ae,Ae=Ee;break e}E(Ae,Xt);break}else g(Ae,Xt);Xt=Xt.sibling}Oe.type===j?(Ee=Hf(Oe.props.children,Ae.mode,ut,Oe.key),Ee.return=Ae,Ae=Ee):(ut=W0(Oe.type,Oe.key,Oe.props,null,Ae.mode,ut),ut.ref=qn(Ae,Ee,Oe),ut.return=Ae,Ae=ut)}return oe(Ae);case O:e:{for(Xt=Oe.key;Ee!==null;){if(Ee.key===Xt)if(Ee.tag===4&&Ee.stateNode.containerInfo===Oe.containerInfo&&Ee.stateNode.implementation===Oe.implementation){E(Ae,Ee.sibling),Ee=V(Ee,Oe.children||[]),Ee.return=Ae,Ae=Ee;break e}else{E(Ae,Ee);break}else g(Ae,Ee);Ee=Ee.sibling}Ee=Lb(Oe,Ae.mode,ut),Ee.return=Ae,Ae=Ee}return oe(Ae);case W:return Xt=Oe._init,gi(Ae,Ee,Xt(Oe._payload),ut)}if(Re(Oe))return It(Ae,Ee,Oe,ut);if(ne(Oe))return Bt(Ae,Ee,Oe,ut);Ja(Ae,Oe)}return typeof Oe=="string"&&Oe!==""||typeof Oe=="number"?(Oe=""+Oe,Ee!==null&&Ee.tag===6?(E(Ae,Ee.sibling),Ee=V(Ee,Oe),Ee.return=Ae,Ae=Ee):(E(Ae,Ee),Ee=Ab(Oe,Ae.mode,ut),Ee.return=Ae,Ae=Ee),oe(Ae)):E(Ae,Ee)}return gi}var Xu=Kh(!0),Is=Kh(!1),Of=fl(null),xs=null,Kc=null,Zh=null;function Yh(){Zh=Kc=xs=null}function Xh(d){var g=Of.current;an(Of),d._currentValue=g}function Qh(d,g,E){for(;d!==null;){var R=d.alternate;if((d.childLanes&g)!==g?(d.childLanes|=g,R!==null&&(R.childLanes|=g)):R!==null&&(R.childLanes&g)!==g&&(R.childLanes|=g),d===E)break;d=d.return}}function pl(d,g){xs=d,Zh=Kc=null,d=d.dependencies,d!==null&&d.firstContext!==null&&((d.lanes&g)!==0&&(ee=!0),d.firstContext=null)}function Pa(d){var g=d._currentValue;if(Zh!==d)if(d={context:d,memoizedValue:g,next:null},Kc===null){if(xs===null)throw Error(r(308));Kc=d,xs.dependencies={lanes:0,firstContext:d}}else Kc=Kc.next=d;return g}var Po=null;function Zc(d){Po===null?Po=[d]:Po.push(d)}function Df(d,g,E,R){var V=g.interleaved;return V===null?(E.next=E,Zc(g)):(E.next=V.next,V.next=E),g.interleaved=E,bs(d,R)}function bs(d,g){d.lanes|=g;var E=d.alternate;for(E!==null&&(E.lanes|=g),E=d,d=d.return;d!==null;)d.childLanes|=g,E=d.alternate,E!==null&&(E.childLanes|=g),E=d,d=d.return;return E.tag===3?E.stateNode:null}var Mo=!1;function If(d){d.updateQueue={baseState:d.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Jh(d,g){d=d.updateQueue,g.updateQueue===d&&(g.updateQueue={baseState:d.baseState,firstBaseUpdate:d.firstBaseUpdate,lastBaseUpdate:d.lastBaseUpdate,shared:d.shared,effects:d.effects})}function Ao(d,g){return{eventTime:d,lane:g,tag:0,payload:null,callback:null,next:null}}function Lo(d,g,E){var R=d.updateQueue;if(R===null)return null;if(R=R.shared,(Or&2)!==0){var V=R.pending;return V===null?g.next=g:(g.next=V.next,V.next=g),R.pending=g,bs(d,E)}return V=R.interleaved,V===null?(g.next=g,Zc(R)):(g.next=V.next,V.next=g),R.interleaved=g,bs(d,E)}function ep(d,g,E){if(g=g.updateQueue,g!==null&&(g=g.shared,(E&4194240)!==0)){var R=g.lanes;R&=d.pendingLanes,E|=R,g.lanes=E,Xs(d,E)}}function jf(d,g){var E=d.updateQueue,R=d.alternate;if(R!==null&&(R=R.updateQueue,E===R)){var V=null,X=null;if(E=E.firstBaseUpdate,E!==null){do{var oe={eventTime:E.eventTime,lane:E.lane,tag:E.tag,payload:E.payload,callback:E.callback,next:null};X===null?V=X=oe:X=X.next=oe,E=E.next}while(E!==null);X===null?V=X=g:X=X.next=g}else V=X=g;E={baseState:R.baseState,firstBaseUpdate:V,lastBaseUpdate:X,shared:R.shared,effects:R.effects},d.updateQueue=E;return}d=E.lastBaseUpdate,d===null?E.firstBaseUpdate=g:d.next=g,E.lastBaseUpdate=g}function Yc(d,g,E,R){var V=d.updateQueue;Mo=!1;var X=V.firstBaseUpdate,oe=V.lastBaseUpdate,be=V.shared.pending;if(be!==null){V.shared.pending=null;var ke=be,Be=ke.next;ke.next=null,oe===null?X=Be:oe.next=Be,oe=ke;var tt=d.alternate;tt!==null&&(tt=tt.updateQueue,be=tt.lastBaseUpdate,be!==oe&&(be===null?tt.firstBaseUpdate=Be:be.next=Be,tt.lastBaseUpdate=ke))}if(X!==null){var it=V.baseState;oe=0,tt=Be=ke=null,be=X;do{var Je=be.lane,Tt=be.eventTime;if((R&Je)===Je){tt!==null&&(tt=tt.next={eventTime:Tt,lane:0,tag:be.tag,payload:be.payload,callback:be.callback,next:null});e:{var It=d,Bt=be;switch(Je=g,Tt=E,Bt.tag){case 1:if(It=Bt.payload,typeof It=="function"){it=It.call(Tt,it,Je);break e}it=It;break e;case 3:It.flags=It.flags&-65537|128;case 0:if(It=Bt.payload,Je=typeof It=="function"?It.call(Tt,it,Je):It,Je==null)break e;it=re({},it,Je);break e;case 2:Mo=!0}}be.callback!==null&&be.lane!==0&&(d.flags|=64,Je=V.effects,Je===null?V.effects=[be]:Je.push(be))}else Tt={eventTime:Tt,lane:Je,tag:be.tag,payload:be.payload,callback:be.callback,next:null},tt===null?(Be=tt=Tt,ke=it):tt=tt.next=Tt,oe|=Je;if(be=be.next,be===null){if(be=V.shared.pending,be===null)break;Je=be,be=Je.next,Je.next=null,V.lastBaseUpdate=Je,V.shared.pending=null}}while(!0);if(tt===null&&(ke=it),V.baseState=ke,V.firstBaseUpdate=Be,V.lastBaseUpdate=tt,g=V.shared.interleaved,g!==null){V=g;do oe|=V.lane,V=V.next;while(V!==g)}else X===null&&(V.shared.lanes=0);zf|=oe,d.lanes=oe,d.memoizedState=it}}function Fn(d,g,E){if(d=g.effects,g.effects=null,d!==null)for(g=0;g<d.length;g++){var R=d[g],V=R.callback;if(V!==null){if(R.callback=null,R=E,typeof V!="function")throw Error(r(191,V));V.call(R)}}}var fr={},tn=fl(fr),bn=fl(fr),$n=fl(fr);function hi(d){if(d===fr)throw Error(r(174));return d}function au(d,g){switch(en($n,g),en(bn,d),en(tn,fr),d=g.nodeType,d){case 9:case 11:g=(g=g.documentElement)?g.namespaceURI:At(null,"");break;default:d=d===8?g.parentNode:g,g=d.namespaceURI||null,d=d.tagName,g=At(g,d)}an(tn),en(tn,g)}function wn(){an(tn),an(bn),an($n)}function Xc(d){hi($n.current);var g=hi(tn.current),E=At(g,d.type);g!==E&&(en(bn,d),en(tn,E))}function ml(d){bn.current===d&&(an(tn),an(bn))}var sn=fl(0);function Qc(d){for(var g=d;g!==null;){if(g.tag===13){var E=g.memoizedState;if(E!==null&&(E=E.dehydrated,E===null||E.data==="$?"||E.data==="$!"))return g}else if(g.tag===19&&g.memoizedProps.revealOrder!==void 0){if((g.flags&128)!==0)return g}else if(g.child!==null){g.child.return=g,g=g.child;continue}if(g===d)break;for(;g.sibling===null;){if(g.return===null||g.return===d)return null;g=g.return}g.sibling.return=g.return,g=g.sibling}return null}var Qu=[];function ea(){for(var d=0;d<Qu.length;d++)Qu[d]._workInProgressVersionPrimary=null;Qu.length=0}var Jc=N.ReactCurrentDispatcher,Ff=N.ReactCurrentBatchConfig,Ma=0,Kr=null,Bn=null,Qn=null,ao=!1,su=!1,js=0,tp=0;function Jn(){throw Error(r(321))}function Bf(d,g){if(g===null)return!1;for(var E=0;E<g.length&&E<d.length;E++)if(!Yi(d[E],g[E]))return!1;return!0}function ed(d,g,E,R,V,X){if(Ma=X,Kr=g,g.memoizedState=null,g.updateQueue=null,g.lanes=0,Jc.current=d===null||d.memoizedState===null?fb:uu,d=E(R,V),su){X=0;do{if(su=!1,js=0,25<=X)throw Error(r(301));X+=1,Qn=Bn=null,g.updateQueue=null,Jc.current=sp,d=E(R,V)}while(su)}if(Jc.current=ad,g=Bn!==null&&Bn.next!==null,Ma=0,Qn=Bn=Kr=null,ao=!1,g)throw Error(r(300));return d}function td(){var d=js!==0;return js=0,d}function dn(){var d={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Qn===null?Kr.memoizedState=Qn=d:Qn=Qn.next=d,Qn}function pi(){if(Bn===null){var d=Kr.alternate;d=d!==null?d.memoizedState:null}else d=Bn.next;var g=Qn===null?Kr.memoizedState:Qn.next;if(g!==null)Qn=g,Bn=d;else{if(d===null)throw Error(r(310));Bn=d,d={memoizedState:Bn.memoizedState,baseState:Bn.baseState,baseQueue:Bn.baseQueue,queue:Bn.queue,next:null},Qn===null?Kr.memoizedState=Qn=d:Qn=Qn.next=d}return Qn}function ta(d,g){return typeof g=="function"?g(d):g}function ra(d){var g=pi(),E=g.queue;if(E===null)throw Error(r(311));E.lastRenderedReducer=d;var R=Bn,V=R.baseQueue,X=E.pending;if(X!==null){if(V!==null){var oe=V.next;V.next=X.next,X.next=oe}R.baseQueue=V=X,E.pending=null}if(V!==null){X=V.next,R=R.baseState;var be=oe=null,ke=null,Be=X;do{var tt=Be.lane;if((Ma&tt)===tt)ke!==null&&(ke=ke.next={lane:0,action:Be.action,hasEagerState:Be.hasEagerState,eagerState:Be.eagerState,next:null}),R=Be.hasEagerState?Be.eagerState:d(R,Be.action);else{var it={lane:tt,action:Be.action,hasEagerState:Be.hasEagerState,eagerState:Be.eagerState,next:null};ke===null?(be=ke=it,oe=R):ke=ke.next=it,Kr.lanes|=tt,zf|=tt}Be=Be.next}while(Be!==null&&Be!==X);ke===null?oe=R:ke.next=be,Yi(R,g.memoizedState)||(ee=!0),g.memoizedState=R,g.baseState=oe,g.baseQueue=ke,E.lastRenderedState=R}if(d=E.interleaved,d!==null){V=d;do X=V.lane,Kr.lanes|=X,zf|=X,V=V.next;while(V!==d)}else V===null&&(E.lanes=0);return[g.memoizedState,E.dispatch]}function rp(d){var g=pi(),E=g.queue;if(E===null)throw Error(r(311));E.lastRenderedReducer=d;var R=E.dispatch,V=E.pending,X=g.memoizedState;if(V!==null){E.pending=null;var oe=V=V.next;do X=d(X,oe.action),oe=oe.next;while(oe!==V);Yi(X,g.memoizedState)||(ee=!0),g.memoizedState=X,g.baseQueue===null&&(g.baseState=X),E.lastRenderedState=X}return[X,R]}function np(){}function ip(d,g){var E=Kr,R=pi(),V=g(),X=!Yi(R.memoizedState,V);if(X&&(R.memoizedState=V,ee=!0),R=R.queue,Pm(Em.bind(null,E,R,d),[d]),R.getSnapshot!==g||X||Qn!==null&&Qn.memoizedState.tag&1){if(E.flags|=2048,rd(9,gl.bind(null,E,R,V,g),void 0,null),ia===null)throw Error(r(349));(Ma&30)!==0||C0(E,g,V)}return V}function C0(d,g,E){d.flags|=16384,d={getSnapshot:g,value:E},g=Kr.updateQueue,g===null?(g={lastEffect:null,stores:null},Kr.updateQueue=g,g.stores=[d]):(E=g.stores,E===null?g.stores=[d]:E.push(d))}function gl(d,g,E,R){g.value=E,g.getSnapshot=R,Tm(g)&&ap(d)}function Em(d,g,E){return E(function(){Tm(g)&&ap(d)})}function Tm(d){var g=d.getSnapshot;d=d.value;try{var E=g();return!Yi(d,E)}catch{return!0}}function ap(d){var g=bs(d,1);g!==null&&bl(g,d,1,-1)}function ou(d){var g=dn();return typeof d=="function"&&(d=d()),g.memoizedState=g.baseState=d,d={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ta,lastRenderedState:d},g.queue=d,d=d.dispatch=A0.bind(null,Kr,d),[g.memoizedState,d]}function rd(d,g,E,R){return d={tag:d,create:g,destroy:E,deps:R,next:null},g=Kr.updateQueue,g===null?(g={lastEffect:null,stores:null},Kr.updateQueue=g,g.lastEffect=d.next=d):(E=g.lastEffect,E===null?g.lastEffect=d.next=d:(R=E.next,E.next=d,d.next=R,g.lastEffect=d)),d}function Nm(){return pi().memoizedState}function nd(d,g,E,R){var V=dn();Kr.flags|=d,V.memoizedState=rd(1|g,E,void 0,R===void 0?null:R)}function Ju(d,g,E,R){var V=pi();R=R===void 0?null:R;var X=void 0;if(Bn!==null){var oe=Bn.memoizedState;if(X=oe.destroy,R!==null&&Bf(R,oe.deps)){V.memoizedState=rd(g,E,X,R);return}}Kr.flags|=d,V.memoizedState=rd(1|g,E,X,R)}function E0(d,g){return nd(8390656,8,d,g)}function Pm(d,g){return Ju(2048,8,d,g)}function Mm(d,g){return Ju(4,2,d,g)}function Am(d,g){return Ju(4,4,d,g)}function lu(d,g){if(typeof g=="function")return d=d(),g(d),function(){g(null)};if(g!=null)return d=d(),g.current=d,function(){g.current=null}}function T0(d,g,E){return E=E!=null?E.concat([d]):null,Ju(4,4,lu.bind(null,g,d),E)}function vl(){}function Lm(d,g){var E=pi();g=g===void 0?null:g;var R=E.memoizedState;return R!==null&&g!==null&&Bf(g,R[1])?R[0]:(E.memoizedState=[d,g],d)}function fn(d,g){var E=pi();g=g===void 0?null:g;var R=E.memoizedState;return R!==null&&g!==null&&Bf(g,R[1])?R[0]:(d=d(),E.memoizedState=[d,g],d)}function N0(d,g,E){return(Ma&21)===0?(d.baseState&&(d.baseState=!1,ee=!0),d.memoizedState=E):(Yi(E,g)||(E=xf(),Kr.lanes|=E,zf|=E,d.baseState=!0),g)}function P0(d,g){var E=mr;mr=E!==0&&4>E?E:4,d(!0);var R=Ff.transition;Ff.transition={};try{d(!1),g()}finally{mr=E,Ff.transition=R}}function M0(){return pi().memoizedState}function db(d,g,E){var R=fd(d);if(E={lane:R,action:E,hasEagerState:!1,eagerState:null,next:null},Rm(d))L0(g,E);else if(E=Df(d,g,E,R),E!==null){var V=Ss();bl(E,d,R,V),ws(E,g,R)}}function A0(d,g,E){var R=fd(d),V={lane:R,action:E,hasEagerState:!1,eagerState:null,next:null};if(Rm(d))L0(g,V);else{var X=d.alternate;if(d.lanes===0&&(X===null||X.lanes===0)&&(X=g.lastRenderedReducer,X!==null))try{var oe=g.lastRenderedState,be=X(oe,E);if(V.hasEagerState=!0,V.eagerState=be,Yi(be,oe)){var ke=g.interleaved;ke===null?(V.next=V,Zc(g)):(V.next=ke.next,ke.next=V),g.interleaved=V;return}}catch{}E=Df(d,g,V,R),E!==null&&(V=Ss(),bl(E,d,R,V),ws(E,g,R))}}function Rm(d){var g=d.alternate;return d===Kr||g!==null&&g===Kr}function L0(d,g){su=ao=!0;var E=d.pending;E===null?g.next=g:(g.next=E.next,E.next=g),d.pending=g}function ws(d,g,E){if((E&4194240)!==0){var R=g.lanes;R&=d.pendingLanes,E|=R,g.lanes=E,Xs(d,E)}}var ad={readContext:Pa,useCallback:Jn,useContext:Jn,useEffect:Jn,useImperativeHandle:Jn,useInsertionEffect:Jn,useLayoutEffect:Jn,useMemo:Jn,useReducer:Jn,useRef:Jn,useState:Jn,useDebugValue:Jn,useDeferredValue:Jn,useTransition:Jn,useMutableSource:Jn,useSyncExternalStore:Jn,useId:Jn,unstable_isNewReconciler:!1},fb={readContext:Pa,useCallback:function(d,g){return dn().memoizedState=[d,g===void 0?null:g],d},useContext:Pa,useEffect:E0,useImperativeHandle:function(d,g,E){return E=E!=null?E.concat([d]):null,nd(4194308,4,lu.bind(null,g,d),E)},useLayoutEffect:function(d,g){return nd(4194308,4,d,g)},useInsertionEffect:function(d,g){return nd(4,2,d,g)},useMemo:function(d,g){var E=dn();return g=g===void 0?null:g,d=d(),E.memoizedState=[d,g],d},useReducer:function(d,g,E){var R=dn();return g=E!==void 0?E(g):g,R.memoizedState=R.baseState=g,d={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:d,lastRenderedState:g},R.queue=d,d=d.dispatch=db.bind(null,Kr,d),[R.memoizedState,d]},useRef:function(d){var g=dn();return d={current:d},g.memoizedState=d},useState:ou,useDebugValue:vl,useDeferredValue:function(d){return dn().memoizedState=d},useTransition:function(){var d=ou(!1),g=d[0];return d=P0.bind(null,d[1]),dn().memoizedState=d,[g,d]},useMutableSource:function(){},useSyncExternalStore:function(d,g,E){var R=Kr,V=dn();if(Wr){if(E===void 0)throw Error(r(407));E=E()}else{if(E=g(),ia===null)throw Error(r(349));(Ma&30)!==0||C0(R,g,E)}V.memoizedState=E;var X={value:E,getSnapshot:g};return V.queue=X,E0(Em.bind(null,R,X,d),[d]),R.flags|=2048,rd(9,gl.bind(null,R,X,E,g),void 0,null),E},useId:function(){var d=dn(),g=ia.identifierPrefix;if(Wr){var E=xn,R=gs;E=(R&~(1<<32-ht(R)-1)).toString(32)+E,g=":"+g+"R"+E,E=js++,0<E&&(g+="H"+E.toString(32)),g+=":"}else E=tp++,g=":"+g+"r"+E.toString(32)+":";return d.memoizedState=g},unstable_isNewReconciler:!1},uu={readContext:Pa,useCallback:Lm,useContext:Pa,useEffect:Pm,useImperativeHandle:T0,useInsertionEffect:Mm,useLayoutEffect:Am,useMemo:fn,useReducer:ra,useRef:Nm,useState:function(){return ra(ta)},useDebugValue:vl,useDeferredValue:function(d){var g=pi();return N0(g,Bn.memoizedState,d)},useTransition:function(){var d=ra(ta)[0],g=pi().memoizedState;return[d,g]},useMutableSource:np,useSyncExternalStore:ip,useId:M0,unstable_isNewReconciler:!1},sp={readContext:Pa,useCallback:Lm,useContext:Pa,useEffect:Pm,useImperativeHandle:T0,useInsertionEffect:Mm,useLayoutEffect:Am,useMemo:fn,useReducer:rp,useRef:Nm,useState:function(){return rp(ta)},useDebugValue:vl,useDeferredValue:function(d){var g=pi();return Bn===null?g.memoizedState=d:N0(g,Bn.memoizedState,d)},useTransition:function(){var d=rp(ta)[0],g=pi().memoizedState;return[d,g]},useMutableSource:np,useSyncExternalStore:ip,useId:M0,unstable_isNewReconciler:!1};function Bi(d,g){if(d&&d.defaultProps){g=re({},g),d=d.defaultProps;for(var E in d)g[E]===void 0&&(g[E]=d[E]);return g}return g}function sd(d,g,E,R){g=d.memoizedState,E=E(R,g),E=E==null?g:re({},g,E),d.memoizedState=E,d.lanes===0&&(d.updateQueue.baseState=E)}var od={isMounted:function(d){return(d=d._reactInternals)?Si(d)===d:!1},enqueueSetState:function(d,g,E){d=d._reactInternals;var R=Ss(),V=fd(d),X=Ao(R,V);X.payload=g,E!=null&&(X.callback=E),g=Lo(d,X,V),g!==null&&(bl(g,d,V,R),ep(g,d,V))},enqueueReplaceState:function(d,g,E){d=d._reactInternals;var R=Ss(),V=fd(d),X=Ao(R,V);X.tag=1,X.payload=g,E!=null&&(X.callback=E),g=Lo(d,X,V),g!==null&&(bl(g,d,V,R),ep(g,d,V))},enqueueForceUpdate:function(d,g){d=d._reactInternals;var E=Ss(),R=fd(d),V=Ao(E,R);V.tag=2,g!=null&&(V.callback=g),g=Lo(d,V,R),g!==null&&(bl(g,d,R,E),ep(g,d,R))}};function op(d,g,E,R,V,X,oe){return d=d.stateNode,typeof d.shouldComponentUpdate=="function"?d.shouldComponentUpdate(R,X,oe):g.prototype&&g.prototype.isPureReactComponent?!Os(E,R)||!Os(V,X):!0}function R0(d,g,E){var R=!1,V=To,X=g.contextType;return typeof X=="object"&&X!==null?X=Pa(X):(V=Ji(g)?eu:Fi.current,R=g.contextTypes,X=(R=R!=null)?Wu(d,V):To),g=new g(E,X),d.memoizedState=g.state!==null&&g.state!==void 0?g.state:null,g.updater=od,d.stateNode=g,g._reactInternals=d,R&&(d=d.stateNode,d.__reactInternalMemoizedUnmaskedChildContext=V,d.__reactInternalMemoizedMaskedChildContext=X),g}function Om(d,g,E,R){d=g.state,typeof g.componentWillReceiveProps=="function"&&g.componentWillReceiveProps(E,R),typeof g.UNSAFE_componentWillReceiveProps=="function"&&g.UNSAFE_componentWillReceiveProps(E,R),g.state!==d&&od.enqueueReplaceState(g,g.state,null)}function lp(d,g,E,R){var V=d.stateNode;V.props=E,V.state=d.memoizedState,V.refs={},If(d);var X=g.contextType;typeof X=="object"&&X!==null?V.context=Pa(X):(X=Ji(g)?eu:Fi.current,V.context=Wu(d,X)),V.state=d.memoizedState,X=g.getDerivedStateFromProps,typeof X=="function"&&(sd(d,g,X,E),V.state=d.memoizedState),typeof g.getDerivedStateFromProps=="function"||typeof V.getSnapshotBeforeUpdate=="function"||typeof V.UNSAFE_componentWillMount!="function"&&typeof V.componentWillMount!="function"||(g=V.state,typeof V.componentWillMount=="function"&&V.componentWillMount(),typeof V.UNSAFE_componentWillMount=="function"&&V.UNSAFE_componentWillMount(),g!==V.state&&od.enqueueReplaceState(V,V.state,null),Yc(d,E,V,R),V.state=d.memoizedState),typeof V.componentDidMount=="function"&&(d.flags|=4194308)}function ec(d,g){try{var E="",R=g;do E+=ge(R),R=R.return;while(R);var V=E}catch(X){V=`
Error generating stack: `+X.message+`
`+X.stack}return{value:d,source:g,stack:V,digest:null}}function up(d,g,E){return{value:d,source:null,stack:E??null,digest:g??null}}function ld(d,g){try{console.error(g.value)}catch(E){setTimeout(function(){throw E})}}var hb=typeof WeakMap=="function"?WeakMap:Map;function O0(d,g,E){E=Ao(-1,E),E.tag=3,E.payload={element:null};var R=g.value;return E.callback=function(){B0||(B0=!0,kb=R),ld(d,g)},E}function x(d,g,E){E=Ao(-1,E),E.tag=3;var R=d.type.getDerivedStateFromError;if(typeof R=="function"){var V=g.value;E.payload=function(){return R(V)},E.callback=function(){ld(d,g)}}var X=d.stateNode;return X!==null&&typeof X.componentDidCatch=="function"&&(E.callback=function(){ld(d,g),typeof R!="function"&&(cd===null?cd=new Set([this]):cd.add(this));var oe=g.stack;this.componentDidCatch(g.value,{componentStack:oe!==null?oe:""})}),E}function b(d,g,E){var R=d.pingCache;if(R===null){R=d.pingCache=new hb;var V=new Set;R.set(g,V)}else V=R.get(g),V===void 0&&(V=new Set,R.set(g,V));V.has(E)||(V.add(E),d=h8.bind(null,d,g,E),g.then(d,d))}function M(d){do{var g;if((g=d.tag===13)&&(g=d.memoizedState,g=g!==null?g.dehydrated!==null:!0),g)return d;d=d.return}while(d!==null);return null}function z(d,g,E,R,V){return(d.mode&1)===0?(d===g?d.flags|=65536:(d.flags|=128,E.flags|=131072,E.flags&=-52805,E.tag===1&&(E.alternate===null?E.tag=17:(g=Ao(-1,1),g.tag=2,Lo(E,g,1))),E.lanes|=1),d):(d.flags|=65536,d.lanes=V,d)}var K=N.ReactCurrentOwner,ee=!1;function fe(d,g,E,R){g.child=d===null?Is(g,null,E,R):Xu(g,d.child,E,R)}function Ne(d,g,E,R,V){E=E.render;var X=g.ref;return pl(g,V),R=ed(d,g,E,R,X,V),E=td(),d!==null&&!ee?(g.updateQueue=d.updateQueue,g.flags&=-2053,d.lanes&=~V,na(d,g,V)):(Wr&&E&&qc(g),g.flags|=1,fe(d,g,R,V),g.child)}function Ue(d,g,E,R,V){if(d===null){var X=E.type;return typeof X=="function"&&!Mb(X)&&X.defaultProps===void 0&&E.compare===null&&E.defaultProps===void 0?(g.tag=15,g.type=X,ot(d,g,X,R,V)):(d=W0(E.type,null,R,g,g.mode,V),d.ref=g.ref,d.return=g,g.child=d)}if(X=d.child,(d.lanes&V)===0){var oe=X.memoizedProps;if(E=E.compare,E=E!==null?E:Os,E(oe,R)&&d.ref===g.ref)return na(d,g,V)}return g.flags|=1,d=pd(X,R),d.ref=g.ref,d.return=g,g.child=d}function ot(d,g,E,R,V){if(d!==null){var X=d.memoizedProps;if(Os(X,R)&&d.ref===g.ref)if(ee=!1,g.pendingProps=R=X,(d.lanes&V)!==0)(d.flags&131072)!==0&&(ee=!0);else return g.lanes=d.lanes,na(d,g,V)}return St(d,g,E,R,V)}function Lt(d,g,E){var R=g.pendingProps,V=R.children,X=d!==null?d.memoizedState:null;if(R.mode==="hidden")if((g.mode&1)===0)g.memoizedState={baseLanes:0,cachePool:null,transitions:null},en(dp,so),so|=E;else{if((E&1073741824)===0)return d=X!==null?X.baseLanes|E:E,g.lanes=g.childLanes=1073741824,g.memoizedState={baseLanes:d,cachePool:null,transitions:null},g.updateQueue=null,en(dp,so),so|=d,null;g.memoizedState={baseLanes:0,cachePool:null,transitions:null},R=X!==null?X.baseLanes:E,en(dp,so),so|=R}else X!==null?(R=X.baseLanes|E,g.memoizedState=null):R=E,en(dp,so),so|=R;return fe(d,g,V,E),g.child}function lr(d,g){var E=g.ref;(d===null&&E!==null||d!==null&&d.ref!==E)&&(g.flags|=512,g.flags|=2097152)}function St(d,g,E,R,V){var X=Ji(E)?eu:Fi.current;return X=Wu(g,X),pl(g,V),E=ed(d,g,E,R,X,V),R=td(),d!==null&&!ee?(g.updateQueue=d.updateQueue,g.flags&=-2053,d.lanes&=~V,na(d,g,V)):(Wr&&R&&qc(g),g.flags|=1,fe(d,g,E,V),g.child)}function on(d,g,E,R,V){if(Ji(E)){var X=!0;qu(g)}else X=!1;if(pl(g,V),g.stateNode===null)Er(d,g),R0(g,E,R),lp(g,E,R,V),R=!0;else if(d===null){var oe=g.stateNode,be=g.memoizedProps;oe.props=be;var ke=oe.context,Be=E.contextType;typeof Be=="object"&&Be!==null?Be=Pa(Be):(Be=Ji(E)?eu:Fi.current,Be=Wu(g,Be));var tt=E.getDerivedStateFromProps,it=typeof tt=="function"||typeof oe.getSnapshotBeforeUpdate=="function";it||typeof oe.UNSAFE_componentWillReceiveProps!="function"&&typeof oe.componentWillReceiveProps!="function"||(be!==R||ke!==Be)&&Om(g,oe,R,Be),Mo=!1;var Je=g.memoizedState;oe.state=Je,Yc(g,R,oe,V),ke=g.memoizedState,be!==R||Je!==ke||Qi.current||Mo?(typeof tt=="function"&&(sd(g,E,tt,R),ke=g.memoizedState),(be=Mo||op(g,E,be,R,Je,ke,Be))?(it||typeof oe.UNSAFE_componentWillMount!="function"&&typeof oe.componentWillMount!="function"||(typeof oe.componentWillMount=="function"&&oe.componentWillMount(),typeof oe.UNSAFE_componentWillMount=="function"&&oe.UNSAFE_componentWillMount()),typeof oe.componentDidMount=="function"&&(g.flags|=4194308)):(typeof oe.componentDidMount=="function"&&(g.flags|=4194308),g.memoizedProps=R,g.memoizedState=ke),oe.props=R,oe.state=ke,oe.context=Be,R=be):(typeof oe.componentDidMount=="function"&&(g.flags|=4194308),R=!1)}else{oe=g.stateNode,Jh(d,g),be=g.memoizedProps,Be=g.type===g.elementType?be:Bi(g.type,be),oe.props=Be,it=g.pendingProps,Je=oe.context,ke=E.contextType,typeof ke=="object"&&ke!==null?ke=Pa(ke):(ke=Ji(E)?eu:Fi.current,ke=Wu(g,ke));var Tt=E.getDerivedStateFromProps;(tt=typeof Tt=="function"||typeof oe.getSnapshotBeforeUpdate=="function")||typeof oe.UNSAFE_componentWillReceiveProps!="function"&&typeof oe.componentWillReceiveProps!="function"||(be!==it||Je!==ke)&&Om(g,oe,R,ke),Mo=!1,Je=g.memoizedState,oe.state=Je,Yc(g,R,oe,V);var It=g.memoizedState;be!==it||Je!==It||Qi.current||Mo?(typeof Tt=="function"&&(sd(g,E,Tt,R),It=g.memoizedState),(Be=Mo||op(g,E,Be,R,Je,It,ke)||!1)?(tt||typeof oe.UNSAFE_componentWillUpdate!="function"&&typeof oe.componentWillUpdate!="function"||(typeof oe.componentWillUpdate=="function"&&oe.componentWillUpdate(R,It,ke),typeof oe.UNSAFE_componentWillUpdate=="function"&&oe.UNSAFE_componentWillUpdate(R,It,ke)),typeof oe.componentDidUpdate=="function"&&(g.flags|=4),typeof oe.getSnapshotBeforeUpdate=="function"&&(g.flags|=1024)):(typeof oe.componentDidUpdate!="function"||be===d.memoizedProps&&Je===d.memoizedState||(g.flags|=4),typeof oe.getSnapshotBeforeUpdate!="function"||be===d.memoizedProps&&Je===d.memoizedState||(g.flags|=1024),g.memoizedProps=R,g.memoizedState=It),oe.props=R,oe.state=It,oe.context=ke,R=Be):(typeof oe.componentDidUpdate!="function"||be===d.memoizedProps&&Je===d.memoizedState||(g.flags|=4),typeof oe.getSnapshotBeforeUpdate!="function"||be===d.memoizedProps&&Je===d.memoizedState||(g.flags|=1024),R=!1)}return qr(d,g,E,R,X,V)}function qr(d,g,E,R,V,X){lr(d,g);var oe=(g.flags&128)!==0;if(!R&&!oe)return V&&S0(g,E,!1),na(d,g,X);R=g.stateNode,K.current=g;var be=oe&&typeof E.getDerivedStateFromError!="function"?null:R.render();return g.flags|=1,d!==null&&oe?(g.child=Xu(g,d.child,null,X),g.child=Xu(g,null,be,X)):fe(d,g,be,X),g.memoizedState=R.state,V&&S0(g,E,!0),g.child}function Aa(d){var g=d.stateNode;g.pendingContext?Sm(d,g.pendingContext,g.pendingContext!==g.context):g.context&&Sm(d,g.context,!1),au(d,g.containerInfo)}function Ro(d,g,E,R,V){return Yu(),Rf(V),g.flags|=256,fe(d,g,E,R),g.child}var Ie={dehydrated:null,treeContext:null,retryLane:0};function Pe(d){return{baseLanes:d,cachePool:null,transitions:null}}function Ve(d,g,E){var R=g.pendingProps,V=sn.current,X=!1,oe=(g.flags&128)!==0,be;if((be=oe)||(be=d!==null&&d.memoizedState===null?!1:(V&2)!==0),be?(X=!0,g.flags&=-129):(d===null||d.memoizedState!==null)&&(V|=1),en(sn,V&1),d===null)return $c(g),d=g.memoizedState,d!==null&&(d=d.dehydrated,d!==null)?((g.mode&1)===0?g.lanes=1:d.data==="$!"?g.lanes=8:g.lanes=1073741824,null):(oe=R.children,d=R.fallback,X?(R=g.mode,X=g.child,oe={mode:"hidden",children:oe},(R&1)===0&&X!==null?(X.childLanes=0,X.pendingProps=oe):X=q0(oe,R,0,null),d=Hf(d,R,E,null),X.return=g,d.return=g,X.sibling=d,g.child=X,g.child.memoizedState=Pe(E),g.memoizedState=Ie,d):_t(g,oe));if(V=d.memoizedState,V!==null&&(be=V.dehydrated,be!==null))return hr(d,g,oe,R,be,V,E);if(X){X=R.fallback,oe=g.mode,V=d.child,be=V.sibling;var ke={mode:"hidden",children:R.children};return(oe&1)===0&&g.child!==V?(R=g.child,R.childLanes=0,R.pendingProps=ke,g.deletions=null):(R=pd(V,ke),R.subtreeFlags=V.subtreeFlags&14680064),be!==null?X=pd(be,X):(X=Hf(X,oe,E,null),X.flags|=2),X.return=g,R.return=g,R.sibling=X,g.child=R,R=X,X=g.child,oe=d.child.memoizedState,oe=oe===null?Pe(E):{baseLanes:oe.baseLanes|E,cachePool:null,transitions:oe.transitions},X.memoizedState=oe,X.childLanes=d.childLanes&~E,g.memoizedState=Ie,R}return X=d.child,d=X.sibling,R=pd(X,{mode:"visible",children:R.children}),(g.mode&1)===0&&(R.lanes=E),R.return=g,R.sibling=null,d!==null&&(E=g.deletions,E===null?(g.deletions=[d],g.flags|=16):E.push(d)),g.child=R,g.memoizedState=null,R}function _t(d,g){return g=q0({mode:"visible",children:g},d.mode,0,null),g.return=d,d.child=g}function Vt(d,g,E,R){return R!==null&&Rf(R),Xu(g,d.child,null,E),d=_t(g,g.pendingProps.children),d.flags|=2,g.memoizedState=null,d}function hr(d,g,E,R,V,X,oe){if(E)return g.flags&256?(g.flags&=-257,R=up(Error(r(422))),Vt(d,g,oe,R)):g.memoizedState!==null?(g.child=d.child,g.flags|=128,null):(X=R.fallback,V=g.mode,R=q0({mode:"visible",children:R.children},V,0,null),X=Hf(X,V,oe,null),X.flags|=2,R.return=g,X.return=g,R.sibling=X,g.child=R,(g.mode&1)!==0&&Xu(g,d.child,null,oe),g.child.memoizedState=Pe(oe),g.memoizedState=Ie,X);if((g.mode&1)===0)return Vt(d,g,oe,null);if(V.data==="$!"){if(R=V.nextSibling&&V.nextSibling.dataset,R)var be=R.dgst;return R=be,X=Error(r(419)),R=up(X,R,void 0),Vt(d,g,oe,R)}if(be=(oe&d.childLanes)!==0,ee||be){if(R=ia,R!==null){switch(oe&-oe){case 4:V=2;break;case 16:V=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:V=32;break;case 536870912:V=268435456;break;default:V=0}V=(V&(R.suspendedLanes|oe))!==0?0:V,V!==0&&V!==X.retryLane&&(X.retryLane=V,bs(d,V),bl(R,d,V,-1))}return Pb(),R=up(Error(r(421))),Vt(d,g,oe,R)}return V.data==="$?"?(g.flags|=128,g.child=d.child,g=p8.bind(null,d),V._reactRetry=g,null):(d=X.treeContext,mt=Ds(V.nextSibling),vs=g,Wr=!0,ys=null,d!==null&&(Ta[Na++]=gs,Ta[Na++]=xn,Ta[Na++]=iu,gs=d.id,xn=d.overflow,iu=g),g=_t(g,R.children),g.flags|=4096,g)}function ur(d,g,E){d.lanes|=g;var R=d.alternate;R!==null&&(R.lanes|=g),Qh(d.return,g,E)}function Nr(d,g,E,R,V){var X=d.memoizedState;X===null?d.memoizedState={isBackwards:g,rendering:null,renderingStartTime:0,last:R,tail:E,tailMode:V}:(X.isBackwards=g,X.rendering=null,X.renderingStartTime=0,X.last=R,X.tail=E,X.tailMode=V)}function mi(d,g,E){var R=g.pendingProps,V=R.revealOrder,X=R.tail;if(fe(d,g,R.children,E),R=sn.current,(R&2)!==0)R=R&1|2,g.flags|=128;else{if(d!==null&&(d.flags&128)!==0)e:for(d=g.child;d!==null;){if(d.tag===13)d.memoizedState!==null&&ur(d,E,g);else if(d.tag===19)ur(d,E,g);else if(d.child!==null){d.child.return=d,d=d.child;continue}if(d===g)break e;for(;d.sibling===null;){if(d.return===null||d.return===g)break e;d=d.return}d.sibling.return=d.return,d=d.sibling}R&=1}if(en(sn,R),(g.mode&1)===0)g.memoizedState=null;else switch(V){case"forwards":for(E=g.child,V=null;E!==null;)d=E.alternate,d!==null&&Qc(d)===null&&(V=E),E=E.sibling;E=V,E===null?(V=g.child,g.child=null):(V=E.sibling,E.sibling=null),Nr(g,!1,V,E,X);break;case"backwards":for(E=null,V=g.child,g.child=null;V!==null;){if(d=V.alternate,d!==null&&Qc(d)===null){g.child=V;break}d=V.sibling,V.sibling=E,E=V,V=d}Nr(g,!0,E,null,X);break;case"together":Nr(g,!1,null,null,void 0);break;default:g.memoizedState=null}return g.child}function Er(d,g){(g.mode&1)===0&&d!==null&&(d.alternate=null,g.alternate=null,g.flags|=2)}function na(d,g,E){if(d!==null&&(g.dependencies=d.dependencies),zf|=g.lanes,(E&g.childLanes)===0)return null;if(d!==null&&g.child!==d.child)throw Error(r(153));if(g.child!==null){for(d=g.child,E=pd(d,d.pendingProps),g.child=E,E.return=g;d.sibling!==null;)d=d.sibling,E=E.sibling=pd(d,d.pendingProps),E.return=g;E.sibling=null}return g.child}function pb(d,g,E){switch(g.tag){case 3:Aa(g),Yu();break;case 5:Xc(g);break;case 1:Ji(g.type)&&qu(g);break;case 4:au(g,g.stateNode.containerInfo);break;case 10:var R=g.type._context,V=g.memoizedProps.value;en(Of,R._currentValue),R._currentValue=V;break;case 13:if(R=g.memoizedState,R!==null)return R.dehydrated!==null?(en(sn,sn.current&1),g.flags|=128,null):(E&g.child.childLanes)!==0?Ve(d,g,E):(en(sn,sn.current&1),d=na(d,g,E),d!==null?d.sibling:null);en(sn,sn.current&1);break;case 19:if(R=(E&g.childLanes)!==0,(d.flags&128)!==0){if(R)return mi(d,g,E);g.flags|=128}if(V=g.memoizedState,V!==null&&(V.rendering=null,V.tail=null,V.lastEffect=null),en(sn,sn.current),R)break;return null;case 22:case 23:return g.lanes=0,Lt(d,g,E)}return na(d,g,E)}var VC,mb,HC,WC;VC=function(d,g){for(var E=g.child;E!==null;){if(E.tag===5||E.tag===6)d.appendChild(E.stateNode);else if(E.tag!==4&&E.child!==null){E.child.return=E,E=E.child;continue}if(E===g)break;for(;E.sibling===null;){if(E.return===null||E.return===g)return;E=E.return}E.sibling.return=E.return,E=E.sibling}},mb=function(){},HC=function(d,g,E,R){var V=d.memoizedProps;if(V!==R){d=g.stateNode,hi(tn.current);var X=null;switch(E){case"input":V=Ge(d,V),R=Ge(d,R),X=[];break;case"select":V=re({},V,{value:void 0}),R=re({},R,{value:void 0}),X=[];break;case"textarea":V=Ce(d,V),R=Ce(d,R),X=[];break;default:typeof V.onClick!="function"&&typeof R.onClick=="function"&&(d.onclick=Ze)}Te(E,R);var oe;E=null;for(Be in V)if(!R.hasOwnProperty(Be)&&V.hasOwnProperty(Be)&&V[Be]!=null)if(Be==="style"){var be=V[Be];for(oe in be)be.hasOwnProperty(oe)&&(E||(E={}),E[oe]="")}else Be!=="dangerouslySetInnerHTML"&&Be!=="children"&&Be!=="suppressContentEditableWarning"&&Be!=="suppressHydrationWarning"&&Be!=="autoFocus"&&(i.hasOwnProperty(Be)?X||(X=[]):(X=X||[]).push(Be,null));for(Be in R){var ke=R[Be];if(be=V?.[Be],R.hasOwnProperty(Be)&&ke!==be&&(ke!=null||be!=null))if(Be==="style")if(be){for(oe in be)!be.hasOwnProperty(oe)||ke&&ke.hasOwnProperty(oe)||(E||(E={}),E[oe]="");for(oe in ke)ke.hasOwnProperty(oe)&&be[oe]!==ke[oe]&&(E||(E={}),E[oe]=ke[oe])}else E||(X||(X=[]),X.push(Be,E)),E=ke;else Be==="dangerouslySetInnerHTML"?(ke=ke?ke.__html:void 0,be=be?be.__html:void 0,ke!=null&&be!==ke&&(X=X||[]).push(Be,ke)):Be==="children"?typeof ke!="string"&&typeof ke!="number"||(X=X||[]).push(Be,""+ke):Be!=="suppressContentEditableWarning"&&Be!=="suppressHydrationWarning"&&(i.hasOwnProperty(Be)?(ke!=null&&Be==="onScroll"&&Vr("scroll",d),X||be===ke||(X=[])):(X=X||[]).push(Be,ke))}E&&(X=X||[]).push("style",E);var Be=X;(g.updateQueue=Be)&&(g.flags|=4)}},WC=function(d,g,E,R){E!==R&&(g.flags|=4)};function Dm(d,g){if(!Wr)switch(d.tailMode){case"hidden":g=d.tail;for(var E=null;g!==null;)g.alternate!==null&&(E=g),g=g.sibling;E===null?d.tail=null:E.sibling=null;break;case"collapsed":E=d.tail;for(var R=null;E!==null;)E.alternate!==null&&(R=E),E=E.sibling;R===null?g||d.tail===null?d.tail=null:d.tail.sibling=null:R.sibling=null}}function es(d){var g=d.alternate!==null&&d.alternate.child===d.child,E=0,R=0;if(g)for(var V=d.child;V!==null;)E|=V.lanes|V.childLanes,R|=V.subtreeFlags&14680064,R|=V.flags&14680064,V.return=d,V=V.sibling;else for(V=d.child;V!==null;)E|=V.lanes|V.childLanes,R|=V.subtreeFlags,R|=V.flags,V.return=d,V=V.sibling;return d.subtreeFlags|=R,d.childLanes=E,g}function n8(d,g,E){var R=g.pendingProps;switch(Ni(g),g.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return es(g),null;case 1:return Ji(g.type)&&Hc(),es(g),null;case 3:return R=g.stateNode,wn(),an(Qi),an(Fi),ea(),R.pendingContext&&(R.context=R.pendingContext,R.pendingContext=null),(d===null||d.child===null)&&(Lf(g)?g.flags|=4:d===null||d.memoizedState.isDehydrated&&(g.flags&256)===0||(g.flags|=1024,ys!==null&&(Eb(ys),ys=null))),mb(d,g),es(g),null;case 5:ml(g);var V=hi($n.current);if(E=g.type,d!==null&&g.stateNode!=null)HC(d,g,E,R,V),d.ref!==g.ref&&(g.flags|=512,g.flags|=2097152);else{if(!R){if(g.stateNode===null)throw Error(r(166));return es(g),null}if(d=hi(tn.current),Lf(g)){R=g.stateNode,E=g.type;var X=g.memoizedProps;switch(R[Qa]=g,R[Jl]=X,d=(g.mode&1)!==0,E){case"dialog":Vr("cancel",R),Vr("close",R);break;case"iframe":case"object":case"embed":Vr("load",R);break;case"video":case"audio":for(V=0;V<ro.length;V++)Vr(ro[V],R);break;case"source":Vr("error",R);break;case"img":case"image":case"link":Vr("error",R),Vr("load",R);break;case"details":Vr("toggle",R);break;case"input":qe(R,X),Vr("invalid",R);break;case"select":R._wrapperState={wasMultiple:!!X.multiple},Vr("invalid",R);break;case"textarea":Fe(R,X),Vr("invalid",R)}Te(E,X),V=null;for(var oe in X)if(X.hasOwnProperty(oe)){var be=X[oe];oe==="children"?typeof be=="string"?R.textContent!==be&&(X.suppressHydrationWarning!==!0&&De(R.textContent,be,d),V=["children",be]):typeof be=="number"&&R.textContent!==""+be&&(X.suppressHydrationWarning!==!0&&De(R.textContent,be,d),V=["children",""+be]):i.hasOwnProperty(oe)&&be!=null&&oe==="onScroll"&&Vr("scroll",R)}switch(E){case"input":he(R),at(R,X,!0);break;case"textarea":he(R),pt(R);break;case"select":case"option":break;default:typeof X.onClick=="function"&&(R.onclick=Ze)}R=V,g.updateQueue=R,R!==null&&(g.flags|=4)}else{oe=V.nodeType===9?V:V.ownerDocument,d==="http://www.w3.org/1999/xhtml"&&(d=vt(E)),d==="http://www.w3.org/1999/xhtml"?E==="script"?(d=oe.createElement("div"),d.innerHTML="<script><\/script>",d=d.removeChild(d.firstChild)):typeof R.is=="string"?d=oe.createElement(E,{is:R.is}):(d=oe.createElement(E),E==="select"&&(oe=d,R.multiple?oe.multiple=!0:R.size&&(oe.size=R.size))):d=oe.createElementNS(d,E),d[Qa]=g,d[Jl]=R,VC(d,g,!1,!1),g.stateNode=d;e:{switch(oe=Le(E,R),E){case"dialog":Vr("cancel",d),Vr("close",d),V=R;break;case"iframe":case"object":case"embed":Vr("load",d),V=R;break;case"video":case"audio":for(V=0;V<ro.length;V++)Vr(ro[V],d);V=R;break;case"source":Vr("error",d),V=R;break;case"img":case"image":case"link":Vr("error",d),Vr("load",d),V=R;break;case"details":Vr("toggle",d),V=R;break;case"input":qe(d,R),V=Ge(d,R),Vr("invalid",d);break;case"option":V=R;break;case"select":d._wrapperState={wasMultiple:!!R.multiple},V=re({},R,{value:void 0}),Vr("invalid",d);break;case"textarea":Fe(d,R),V=Ce(d,R),Vr("invalid",d);break;default:V=R}Te(E,V),be=V;for(X in be)if(be.hasOwnProperty(X)){var ke=be[X];X==="style"?ve(d,ke):X==="dangerouslySetInnerHTML"?(ke=ke?ke.__html:void 0,ke!=null&&nr(d,ke)):X==="children"?typeof ke=="string"?(E!=="textarea"||ke!=="")&&Ct(d,ke):typeof ke=="number"&&Ct(d,""+ke):X!=="suppressContentEditableWarning"&&X!=="suppressHydrationWarning"&&X!=="autoFocus"&&(i.hasOwnProperty(X)?ke!=null&&X==="onScroll"&&Vr("scroll",d):ke!=null&&C(d,X,ke,oe))}switch(E){case"input":he(d),at(d,R,!1);break;case"textarea":he(d),pt(d);break;case"option":R.value!=null&&d.setAttribute("value",""+pe(R.value));break;case"select":d.multiple=!!R.multiple,X=R.value,X!=null?nt(d,!!R.multiple,X,!1):R.defaultValue!=null&&nt(d,!!R.multiple,R.defaultValue,!0);break;default:typeof V.onClick=="function"&&(d.onclick=Ze)}switch(E){case"button":case"input":case"select":case"textarea":R=!!R.autoFocus;break e;case"img":R=!0;break e;default:R=!1}}R&&(g.flags|=4)}g.ref!==null&&(g.flags|=512,g.flags|=2097152)}return es(g),null;case 6:if(d&&g.stateNode!=null)WC(d,g,d.memoizedProps,R);else{if(typeof R!="string"&&g.stateNode===null)throw Error(r(166));if(E=hi($n.current),hi(tn.current),Lf(g)){if(R=g.stateNode,E=g.memoizedProps,R[Qa]=g,(X=R.nodeValue!==E)&&(d=vs,d!==null))switch(d.tag){case 3:De(R.nodeValue,E,(d.mode&1)!==0);break;case 5:d.memoizedProps.suppressHydrationWarning!==!0&&De(R.nodeValue,E,(d.mode&1)!==0)}X&&(g.flags|=4)}else R=(E.nodeType===9?E:E.ownerDocument).createTextNode(R),R[Qa]=g,g.stateNode=R}return es(g),null;case 13:if(an(sn),R=g.memoizedState,d===null||d.memoizedState!==null&&d.memoizedState.dehydrated!==null){if(Wr&&mt!==null&&(g.mode&1)!==0&&(g.flags&128)===0)_m(),Yu(),g.flags|=98560,X=!1;else if(X=Lf(g),R!==null&&R.dehydrated!==null){if(d===null){if(!X)throw Error(r(318));if(X=g.memoizedState,X=X!==null?X.dehydrated:null,!X)throw Error(r(317));X[Qa]=g}else Yu(),(g.flags&128)===0&&(g.memoizedState=null),g.flags|=4;es(g),X=!1}else ys!==null&&(Eb(ys),ys=null),X=!0;if(!X)return g.flags&65536?g:null}return(g.flags&128)!==0?(g.lanes=E,g):(R=R!==null,R!==(d!==null&&d.memoizedState!==null)&&R&&(g.child.flags|=8192,(g.mode&1)!==0&&(d===null||(sn.current&1)!==0?zi===0&&(zi=3):Pb())),g.updateQueue!==null&&(g.flags|=4),es(g),null);case 4:return wn(),mb(d,g),d===null&&Co(g.stateNode.containerInfo),es(g),null;case 10:return Xh(g.type._context),es(g),null;case 17:return Ji(g.type)&&Hc(),es(g),null;case 19:if(an(sn),X=g.memoizedState,X===null)return es(g),null;if(R=(g.flags&128)!==0,oe=X.rendering,oe===null)if(R)Dm(X,!1);else{if(zi!==0||d!==null&&(d.flags&128)!==0)for(d=g.child;d!==null;){if(oe=Qc(d),oe!==null){for(g.flags|=128,Dm(X,!1),R=oe.updateQueue,R!==null&&(g.updateQueue=R,g.flags|=4),g.subtreeFlags=0,R=E,E=g.child;E!==null;)X=E,d=R,X.flags&=14680066,oe=X.alternate,oe===null?(X.childLanes=0,X.lanes=d,X.child=null,X.subtreeFlags=0,X.memoizedProps=null,X.memoizedState=null,X.updateQueue=null,X.dependencies=null,X.stateNode=null):(X.childLanes=oe.childLanes,X.lanes=oe.lanes,X.child=oe.child,X.subtreeFlags=0,X.deletions=null,X.memoizedProps=oe.memoizedProps,X.memoizedState=oe.memoizedState,X.updateQueue=oe.updateQueue,X.type=oe.type,d=oe.dependencies,X.dependencies=d===null?null:{lanes:d.lanes,firstContext:d.firstContext}),E=E.sibling;return en(sn,sn.current&1|2),g.child}d=d.sibling}X.tail!==null&&cn()>fp&&(g.flags|=128,R=!0,Dm(X,!1),g.lanes=4194304)}else{if(!R)if(d=Qc(oe),d!==null){if(g.flags|=128,R=!0,E=d.updateQueue,E!==null&&(g.updateQueue=E,g.flags|=4),Dm(X,!0),X.tail===null&&X.tailMode==="hidden"&&!oe.alternate&&!Wr)return es(g),null}else 2*cn()-X.renderingStartTime>fp&&E!==1073741824&&(g.flags|=128,R=!0,Dm(X,!1),g.lanes=4194304);X.isBackwards?(oe.sibling=g.child,g.child=oe):(E=X.last,E!==null?E.sibling=oe:g.child=oe,X.last=oe)}return X.tail!==null?(g=X.tail,X.rendering=g,X.tail=g.sibling,X.renderingStartTime=cn(),g.sibling=null,E=sn.current,en(sn,R?E&1|2:E&1),g):(es(g),null);case 22:case 23:return Nb(),R=g.memoizedState!==null,d!==null&&d.memoizedState!==null!==R&&(g.flags|=8192),R&&(g.mode&1)!==0?(so&1073741824)!==0&&(es(g),g.subtreeFlags&6&&(g.flags|=8192)):es(g),null;case 24:return null;case 25:return null}throw Error(r(156,g.tag))}function i8(d,g){switch(Ni(g),g.tag){case 1:return Ji(g.type)&&Hc(),d=g.flags,d&65536?(g.flags=d&-65537|128,g):null;case 3:return wn(),an(Qi),an(Fi),ea(),d=g.flags,(d&65536)!==0&&(d&128)===0?(g.flags=d&-65537|128,g):null;case 5:return ml(g),null;case 13:if(an(sn),d=g.memoizedState,d!==null&&d.dehydrated!==null){if(g.alternate===null)throw Error(r(340));Yu()}return d=g.flags,d&65536?(g.flags=d&-65537|128,g):null;case 19:return an(sn),null;case 4:return wn(),null;case 10:return Xh(g.type._context),null;case 22:case 23:return Nb(),null;case 24:return null;default:return null}}var D0=!1,ts=!1,a8=typeof WeakSet=="function"?WeakSet:Set,Rt=null;function cp(d,g){var E=d.ref;if(E!==null)if(typeof E=="function")try{E(null)}catch(R){ei(d,g,R)}else E.current=null}function gb(d,g,E){try{E()}catch(R){ei(d,g,R)}}var qC=!1;function s8(d,g){if(xt=Iu,d=Dn(),Zl(d)){if("selectionStart"in d)var E={start:d.selectionStart,end:d.selectionEnd};else e:{E=(E=d.ownerDocument)&&E.defaultView||window;var R=E.getSelection&&E.getSelection();if(R&&R.rangeCount!==0){E=R.anchorNode;var V=R.anchorOffset,X=R.focusNode;R=R.focusOffset;try{E.nodeType,X.nodeType}catch{E=null;break e}var oe=0,be=-1,ke=-1,Be=0,tt=0,it=d,Je=null;t:for(;;){for(var Tt;it!==E||V!==0&&it.nodeType!==3||(be=oe+V),it!==X||R!==0&&it.nodeType!==3||(ke=oe+R),it.nodeType===3&&(oe+=it.nodeValue.length),(Tt=it.firstChild)!==null;)Je=it,it=Tt;for(;;){if(it===d)break t;if(Je===E&&++Be===V&&(be=oe),Je===X&&++tt===R&&(ke=oe),(Tt=it.nextSibling)!==null)break;it=Je,Je=it.parentNode}it=Tt}E=be===-1||ke===-1?null:{start:be,end:ke}}else E=null}E=E||{start:0,end:0}}else E=null;for(Kt={focusedElem:d,selectionRange:E},Iu=!1,Rt=g;Rt!==null;)if(g=Rt,d=g.child,(g.subtreeFlags&1028)!==0&&d!==null)d.return=g,Rt=d;else for(;Rt!==null;){g=Rt;try{var It=g.alternate;if((g.flags&1024)!==0)switch(g.tag){case 0:case 11:case 15:break;case 1:if(It!==null){var Bt=It.memoizedProps,gi=It.memoizedState,Ae=g.stateNode,Ee=Ae.getSnapshotBeforeUpdate(g.elementType===g.type?Bt:Bi(g.type,Bt),gi);Ae.__reactInternalSnapshotBeforeUpdate=Ee}break;case 3:var Oe=g.stateNode.containerInfo;Oe.nodeType===1?Oe.textContent="":Oe.nodeType===9&&Oe.documentElement&&Oe.removeChild(Oe.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(r(163))}}catch(ut){ei(g,g.return,ut)}if(d=g.sibling,d!==null){d.return=g.return,Rt=d;break}Rt=g.return}return It=qC,qC=!1,It}function Im(d,g,E){var R=g.updateQueue;if(R=R!==null?R.lastEffect:null,R!==null){var V=R=R.next;do{if((V.tag&d)===d){var X=V.destroy;V.destroy=void 0,X!==void 0&&gb(g,E,X)}V=V.next}while(V!==R)}}function I0(d,g){if(g=g.updateQueue,g=g!==null?g.lastEffect:null,g!==null){var E=g=g.next;do{if((E.tag&d)===d){var R=E.create;E.destroy=R()}E=E.next}while(E!==g)}}function vb(d){var g=d.ref;if(g!==null){var E=d.stateNode;d.tag,d=E,typeof g=="function"?g(d):g.current=d}}function $C(d){var g=d.alternate;g!==null&&(d.alternate=null,$C(g)),d.child=null,d.deletions=null,d.sibling=null,d.tag===5&&(g=d.stateNode,g!==null&&(delete g[Qa],delete g[Jl],delete g[cl],delete g[Gh],delete g[Vh])),d.stateNode=null,d.return=null,d.dependencies=null,d.memoizedProps=null,d.memoizedState=null,d.pendingProps=null,d.stateNode=null,d.updateQueue=null}function KC(d){return d.tag===5||d.tag===3||d.tag===4}function ZC(d){e:for(;;){for(;d.sibling===null;){if(d.return===null||KC(d.return))return null;d=d.return}for(d.sibling.return=d.return,d=d.sibling;d.tag!==5&&d.tag!==6&&d.tag!==18;){if(d.flags&2||d.child===null||d.tag===4)continue e;d.child.return=d,d=d.child}if(!(d.flags&2))return d.stateNode}}function yb(d,g,E){var R=d.tag;if(R===5||R===6)d=d.stateNode,g?E.nodeType===8?E.parentNode.insertBefore(d,g):E.insertBefore(d,g):(E.nodeType===8?(g=E.parentNode,g.insertBefore(d,E)):(g=E,g.appendChild(d)),E=E._reactRootContainer,E!=null||g.onclick!==null||(g.onclick=Ze));else if(R!==4&&(d=d.child,d!==null))for(yb(d,g,E),d=d.sibling;d!==null;)yb(d,g,E),d=d.sibling}function xb(d,g,E){var R=d.tag;if(R===5||R===6)d=d.stateNode,g?E.insertBefore(d,g):E.appendChild(d);else if(R!==4&&(d=d.child,d!==null))for(xb(d,g,E),d=d.sibling;d!==null;)xb(d,g,E),d=d.sibling}var La=null,yl=!1;function ud(d,g,E){for(E=E.child;E!==null;)YC(d,g,E),E=E.sibling}function YC(d,g,E){if(_n&&typeof _n.onCommitFiberUnmount=="function")try{_n.onCommitFiberUnmount(ga,E)}catch{}switch(E.tag){case 5:ts||cp(E,g);case 6:var R=La,V=yl;La=null,ud(d,g,E),La=R,yl=V,La!==null&&(yl?(d=La,E=E.stateNode,d.nodeType===8?d.parentNode.removeChild(E):d.removeChild(E)):La.removeChild(E.stateNode));break;case 18:La!==null&&(yl?(d=La,E=E.stateNode,d.nodeType===8?Vc(d.parentNode,E):d.nodeType===1&&Vc(d,E),Ln(d)):Vc(La,E.stateNode));break;case 4:R=La,V=yl,La=E.stateNode.containerInfo,yl=!0,ud(d,g,E),La=R,yl=V;break;case 0:case 11:case 14:case 15:if(!ts&&(R=E.updateQueue,R!==null&&(R=R.lastEffect,R!==null))){V=R=R.next;do{var X=V,oe=X.destroy;X=X.tag,oe!==void 0&&((X&2)!==0||(X&4)!==0)&&gb(E,g,oe),V=V.next}while(V!==R)}ud(d,g,E);break;case 1:if(!ts&&(cp(E,g),R=E.stateNode,typeof R.componentWillUnmount=="function"))try{R.props=E.memoizedProps,R.state=E.memoizedState,R.componentWillUnmount()}catch(be){ei(E,g,be)}ud(d,g,E);break;case 21:ud(d,g,E);break;case 22:E.mode&1?(ts=(R=ts)||E.memoizedState!==null,ud(d,g,E),ts=R):ud(d,g,E);break;default:ud(d,g,E)}}function XC(d){var g=d.updateQueue;if(g!==null){d.updateQueue=null;var E=d.stateNode;E===null&&(E=d.stateNode=new a8),g.forEach(function(R){var V=m8.bind(null,d,R);E.has(R)||(E.add(R),R.then(V,V))})}}function xl(d,g){var E=g.deletions;if(E!==null)for(var R=0;R<E.length;R++){var V=E[R];try{var X=d,oe=g,be=oe;e:for(;be!==null;){switch(be.tag){case 5:La=be.stateNode,yl=!1;break e;case 3:La=be.stateNode.containerInfo,yl=!0;break e;case 4:La=be.stateNode.containerInfo,yl=!0;break e}be=be.return}if(La===null)throw Error(r(160));YC(X,oe,V),La=null,yl=!1;var ke=V.alternate;ke!==null&&(ke.return=null),V.return=null}catch(Be){ei(V,g,Be)}}if(g.subtreeFlags&12854)for(g=g.child;g!==null;)QC(g,d),g=g.sibling}function QC(d,g){var E=d.alternate,R=d.flags;switch(d.tag){case 0:case 11:case 14:case 15:if(xl(g,d),cu(d),R&4){try{Im(3,d,d.return),I0(3,d)}catch(Bt){ei(d,d.return,Bt)}try{Im(5,d,d.return)}catch(Bt){ei(d,d.return,Bt)}}break;case 1:xl(g,d),cu(d),R&512&&E!==null&&cp(E,E.return);break;case 5:if(xl(g,d),cu(d),R&512&&E!==null&&cp(E,E.return),d.flags&32){var V=d.stateNode;try{Ct(V,"")}catch(Bt){ei(d,d.return,Bt)}}if(R&4&&(V=d.stateNode,V!=null)){var X=d.memoizedProps,oe=E!==null?E.memoizedProps:X,be=d.type,ke=d.updateQueue;if(d.updateQueue=null,ke!==null)try{be==="input"&&X.type==="radio"&&X.name!=null&&wt(V,X),Le(be,oe);var Be=Le(be,X);for(oe=0;oe<ke.length;oe+=2){var tt=ke[oe],it=ke[oe+1];tt==="style"?ve(V,it):tt==="dangerouslySetInnerHTML"?nr(V,it):tt==="children"?Ct(V,it):C(V,tt,it,Be)}switch(be){case"input":et(V,X);break;case"textarea":Ke(V,X);break;case"select":var Je=V._wrapperState.wasMultiple;V._wrapperState.wasMultiple=!!X.multiple;var Tt=X.value;Tt!=null?nt(V,!!X.multiple,Tt,!1):Je!==!!X.multiple&&(X.defaultValue!=null?nt(V,!!X.multiple,X.defaultValue,!0):nt(V,!!X.multiple,X.multiple?[]:"",!1))}V[Jl]=X}catch(Bt){ei(d,d.return,Bt)}}break;case 6:if(xl(g,d),cu(d),R&4){if(d.stateNode===null)throw Error(r(162));V=d.stateNode,X=d.memoizedProps;try{V.nodeValue=X}catch(Bt){ei(d,d.return,Bt)}}break;case 3:if(xl(g,d),cu(d),R&4&&E!==null&&E.memoizedState.isDehydrated)try{Ln(g.containerInfo)}catch(Bt){ei(d,d.return,Bt)}break;case 4:xl(g,d),cu(d);break;case 13:xl(g,d),cu(d),V=d.child,V.flags&8192&&(X=V.memoizedState!==null,V.stateNode.isHidden=X,!X||V.alternate!==null&&V.alternate.memoizedState!==null||(Sb=cn())),R&4&&XC(d);break;case 22:if(tt=E!==null&&E.memoizedState!==null,d.mode&1?(ts=(Be=ts)||tt,xl(g,d),ts=Be):xl(g,d),cu(d),R&8192){if(Be=d.memoizedState!==null,(d.stateNode.isHidden=Be)&&!tt&&(d.mode&1)!==0)for(Rt=d,tt=d.child;tt!==null;){for(it=Rt=tt;Rt!==null;){switch(Je=Rt,Tt=Je.child,Je.tag){case 0:case 11:case 14:case 15:Im(4,Je,Je.return);break;case 1:cp(Je,Je.return);var It=Je.stateNode;if(typeof It.componentWillUnmount=="function"){R=Je,E=Je.return;try{g=R,It.props=g.memoizedProps,It.state=g.memoizedState,It.componentWillUnmount()}catch(Bt){ei(R,E,Bt)}}break;case 5:cp(Je,Je.return);break;case 22:if(Je.memoizedState!==null){tE(it);continue}}Tt!==null?(Tt.return=Je,Rt=Tt):tE(it)}tt=tt.sibling}e:for(tt=null,it=d;;){if(it.tag===5){if(tt===null){tt=it;try{V=it.stateNode,Be?(X=V.style,typeof X.setProperty=="function"?X.setProperty("display","none","important"):X.display="none"):(be=it.stateNode,ke=it.memoizedProps.style,oe=ke!=null&&ke.hasOwnProperty("display")?ke.display:null,be.style.display=ce("display",oe))}catch(Bt){ei(d,d.return,Bt)}}}else if(it.tag===6){if(tt===null)try{it.stateNode.nodeValue=Be?"":it.memoizedProps}catch(Bt){ei(d,d.return,Bt)}}else if((it.tag!==22&&it.tag!==23||it.memoizedState===null||it===d)&&it.child!==null){it.child.return=it,it=it.child;continue}if(it===d)break e;for(;it.sibling===null;){if(it.return===null||it.return===d)break e;tt===it&&(tt=null),it=it.return}tt===it&&(tt=null),it.sibling.return=it.return,it=it.sibling}}break;case 19:xl(g,d),cu(d),R&4&&XC(d);break;case 21:break;default:xl(g,d),cu(d)}}function cu(d){var g=d.flags;if(g&2){try{e:{for(var E=d.return;E!==null;){if(KC(E)){var R=E;break e}E=E.return}throw Error(r(160))}switch(R.tag){case 5:var V=R.stateNode;R.flags&32&&(Ct(V,""),R.flags&=-33);var X=ZC(d);xb(d,X,V);break;case 3:case 4:var oe=R.stateNode.containerInfo,be=ZC(d);yb(d,be,oe);break;default:throw Error(r(161))}}catch(ke){ei(d,d.return,ke)}d.flags&=-3}g&4096&&(d.flags&=-4097)}function o8(d,g,E){Rt=d,JC(d)}function JC(d,g,E){for(var R=(d.mode&1)!==0;Rt!==null;){var V=Rt,X=V.child;if(V.tag===22&&R){var oe=V.memoizedState!==null||D0;if(!oe){var be=V.alternate,ke=be!==null&&be.memoizedState!==null||ts;be=D0;var Be=ts;if(D0=oe,(ts=ke)&&!Be)for(Rt=V;Rt!==null;)oe=Rt,ke=oe.child,oe.tag===22&&oe.memoizedState!==null?rE(V):ke!==null?(ke.return=oe,Rt=ke):rE(V);for(;X!==null;)Rt=X,JC(X),X=X.sibling;Rt=V,D0=be,ts=Be}eE(d)}else(V.subtreeFlags&8772)!==0&&X!==null?(X.return=V,Rt=X):eE(d)}}function eE(d){for(;Rt!==null;){var g=Rt;if((g.flags&8772)!==0){var E=g.alternate;try{if((g.flags&8772)!==0)switch(g.tag){case 0:case 11:case 15:ts||I0(5,g);break;case 1:var R=g.stateNode;if(g.flags&4&&!ts)if(E===null)R.componentDidMount();else{var V=g.elementType===g.type?E.memoizedProps:Bi(g.type,E.memoizedProps);R.componentDidUpdate(V,E.memoizedState,R.__reactInternalSnapshotBeforeUpdate)}var X=g.updateQueue;X!==null&&Fn(g,X,R);break;case 3:var oe=g.updateQueue;if(oe!==null){if(E=null,g.child!==null)switch(g.child.tag){case 5:E=g.child.stateNode;break;case 1:E=g.child.stateNode}Fn(g,oe,E)}break;case 5:var be=g.stateNode;if(E===null&&g.flags&4){E=be;var ke=g.memoizedProps;switch(g.type){case"button":case"input":case"select":case"textarea":ke.autoFocus&&E.focus();break;case"img":ke.src&&(E.src=ke.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(g.memoizedState===null){var Be=g.alternate;if(Be!==null){var tt=Be.memoizedState;if(tt!==null){var it=tt.dehydrated;it!==null&&Ln(it)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(r(163))}ts||g.flags&512&&vb(g)}catch(Je){ei(g,g.return,Je)}}if(g===d){Rt=null;break}if(E=g.sibling,E!==null){E.return=g.return,Rt=E;break}Rt=g.return}}function tE(d){for(;Rt!==null;){var g=Rt;if(g===d){Rt=null;break}var E=g.sibling;if(E!==null){E.return=g.return,Rt=E;break}Rt=g.return}}function rE(d){for(;Rt!==null;){var g=Rt;try{switch(g.tag){case 0:case 11:case 15:var E=g.return;try{I0(4,g)}catch(ke){ei(g,E,ke)}break;case 1:var R=g.stateNode;if(typeof R.componentDidMount=="function"){var V=g.return;try{R.componentDidMount()}catch(ke){ei(g,V,ke)}}var X=g.return;try{vb(g)}catch(ke){ei(g,X,ke)}break;case 5:var oe=g.return;try{vb(g)}catch(ke){ei(g,oe,ke)}}}catch(ke){ei(g,g.return,ke)}if(g===d){Rt=null;break}var be=g.sibling;if(be!==null){be.return=g.return,Rt=be;break}Rt=g.return}}var l8=Math.ceil,j0=N.ReactCurrentDispatcher,bb=N.ReactCurrentOwner,Oo=N.ReactCurrentBatchConfig,Or=0,ia=null,Pi=null,Ra=0,so=0,dp=fl(0),zi=0,jm=null,zf=0,F0=0,wb=0,Fm=null,Fs=null,Sb=0,fp=1/0,tc=null,B0=!1,kb=null,cd=null,z0=!1,dd=null,U0=0,Bm=0,_b=null,G0=-1,V0=0;function Ss(){return(Or&6)!==0?cn():G0!==-1?G0:G0=cn()}function fd(d){return(d.mode&1)===0?1:(Or&2)!==0&&Ra!==0?Ra&-Ra:Cm.transition!==null?(V0===0&&(V0=xf()),V0):(d=mr,d!==0||(d=window.event,d=d===void 0?16:br(d.type)),d)}function bl(d,g,E,R){if(50<Bm)throw Bm=0,_b=null,Error(r(185));cs(d,E,R),((Or&2)===0||d!==ia)&&(d===ia&&((Or&2)===0&&(F0|=E),zi===4&&hd(d,Ra)),Bs(d,R),E===1&&Or===0&&(g.mode&1)===0&&(fp=cn()+500,Wc&&tu()))}function Bs(d,g){var E=d.callbackNode;Ou(d,g);var R=Lr(d,d===ia?Ra:0);if(R===0)E!==null&&Lu(E),d.callbackNode=null,d.callbackPriority=0;else if(g=R&-R,d.callbackPriority!==g){if(E!=null&&Lu(E),g===1)d.tag===0?hl(iE.bind(null,d)):Af(iE.bind(null,d)),ji(function(){(Or&6)===0&&tu()}),E=null;else{switch(Qs(R)){case 1:E=Ys;break;case 4:E=Il;break;case 16:E=Ha;break;case 536870912:E=ma;break;default:E=Ha}E=fE(E,nE.bind(null,d))}d.callbackPriority=g,d.callbackNode=E}}function nE(d,g){if(G0=-1,V0=0,(Or&6)!==0)throw Error(r(327));var E=d.callbackNode;if(hp()&&d.callbackNode!==E)return null;var R=Lr(d,d===ia?Ra:0);if(R===0)return null;if((R&30)!==0||(R&d.expiredLanes)!==0||g)g=H0(d,R);else{g=R;var V=Or;Or|=2;var X=sE();(ia!==d||Ra!==g)&&(tc=null,fp=cn()+500,Gf(d,g));do try{d8();break}catch(be){aE(d,be)}while(!0);Yh(),j0.current=X,Or=V,Pi!==null?g=0:(ia=null,Ra=0,g=zi)}if(g!==0){if(g===2&&(V=li(d),V!==0&&(R=V,g=Cb(d,V))),g===1)throw E=jm,Gf(d,0),hd(d,R),Bs(d,cn()),E;if(g===6)hd(d,R);else{if(V=d.current.alternate,(R&30)===0&&!u8(V)&&(g=H0(d,R),g===2&&(X=li(d),X!==0&&(R=X,g=Cb(d,X))),g===1))throw E=jm,Gf(d,0),hd(d,R),Bs(d,cn()),E;switch(d.finishedWork=V,d.finishedLanes=R,g){case 0:case 1:throw Error(r(345));case 2:Vf(d,Fs,tc);break;case 3:if(hd(d,R),(R&130023424)===R&&(g=Sb+500-cn(),10<g)){if(Lr(d,0)!==0)break;if(V=d.suspendedLanes,(V&R)!==R){Ss(),d.pingedLanes|=d.suspendedLanes&V;break}d.timeoutHandle=Hr(Vf.bind(null,d,Fs,tc),g);break}Vf(d,Fs,tc);break;case 4:if(hd(d,R),(R&4194240)===R)break;for(g=d.eventTimes,V=-1;0<R;){var oe=31-ht(R);X=1<<oe,oe=g[oe],oe>V&&(V=oe),R&=~X}if(R=V,R=cn()-R,R=(120>R?120:480>R?480:1080>R?1080:1920>R?1920:3e3>R?3e3:4320>R?4320:1960*l8(R/1960))-R,10<R){d.timeoutHandle=Hr(Vf.bind(null,d,Fs,tc),R);break}Vf(d,Fs,tc);break;case 5:Vf(d,Fs,tc);break;default:throw Error(r(329))}}}return Bs(d,cn()),d.callbackNode===E?nE.bind(null,d):null}function Cb(d,g){var E=Fm;return d.current.memoizedState.isDehydrated&&(Gf(d,g).flags|=256),d=H0(d,g),d!==2&&(g=Fs,Fs=E,g!==null&&Eb(g)),d}function Eb(d){Fs===null?Fs=d:Fs.push.apply(Fs,d)}function u8(d){for(var g=d;;){if(g.flags&16384){var E=g.updateQueue;if(E!==null&&(E=E.stores,E!==null))for(var R=0;R<E.length;R++){var V=E[R],X=V.getSnapshot;V=V.value;try{if(!Yi(X(),V))return!1}catch{return!1}}}if(E=g.child,g.subtreeFlags&16384&&E!==null)E.return=g,g=E;else{if(g===d)break;for(;g.sibling===null;){if(g.return===null||g.return===d)return!0;g=g.return}g.sibling.return=g.return,g=g.sibling}}return!0}function hd(d,g){for(g&=~wb,g&=~F0,d.suspendedLanes|=g,d.pingedLanes&=~g,d=d.expirationTimes;0<g;){var E=31-ht(g),R=1<<E;d[E]=-1,g&=~R}}function iE(d){if((Or&6)!==0)throw Error(r(327));hp();var g=Lr(d,0);if((g&1)===0)return Bs(d,cn()),null;var E=H0(d,g);if(d.tag!==0&&E===2){var R=li(d);R!==0&&(g=R,E=Cb(d,R))}if(E===1)throw E=jm,Gf(d,0),hd(d,g),Bs(d,cn()),E;if(E===6)throw Error(r(345));return d.finishedWork=d.current.alternate,d.finishedLanes=g,Vf(d,Fs,tc),Bs(d,cn()),null}function Tb(d,g){var E=Or;Or|=1;try{return d(g)}finally{Or=E,Or===0&&(fp=cn()+500,Wc&&tu())}}function Uf(d){dd!==null&&dd.tag===0&&(Or&6)===0&&hp();var g=Or;Or|=1;var E=Oo.transition,R=mr;try{if(Oo.transition=null,mr=1,d)return d()}finally{mr=R,Oo.transition=E,Or=g,(Or&6)===0&&tu()}}function Nb(){so=dp.current,an(dp)}function Gf(d,g){d.finishedWork=null,d.finishedLanes=0;var E=d.timeoutHandle;if(E!==-1&&(d.timeoutHandle=-1,In(E)),Pi!==null)for(E=Pi.return;E!==null;){var R=E;switch(Ni(R),R.tag){case 1:R=R.type.childContextTypes,R!=null&&Hc();break;case 3:wn(),an(Qi),an(Fi),ea();break;case 5:ml(R);break;case 4:wn();break;case 13:an(sn);break;case 19:an(sn);break;case 10:Xh(R.type._context);break;case 22:case 23:Nb()}E=E.return}if(ia=d,Pi=d=pd(d.current,null),Ra=so=g,zi=0,jm=null,wb=F0=zf=0,Fs=Fm=null,Po!==null){for(g=0;g<Po.length;g++)if(E=Po[g],R=E.interleaved,R!==null){E.interleaved=null;var V=R.next,X=E.pending;if(X!==null){var oe=X.next;X.next=V,R.next=oe}E.pending=R}Po=null}return d}function aE(d,g){do{var E=Pi;try{if(Yh(),Jc.current=ad,ao){for(var R=Kr.memoizedState;R!==null;){var V=R.queue;V!==null&&(V.pending=null),R=R.next}ao=!1}if(Ma=0,Qn=Bn=Kr=null,su=!1,js=0,bb.current=null,E===null||E.return===null){zi=1,jm=g,Pi=null;break}e:{var X=d,oe=E.return,be=E,ke=g;if(g=Ra,be.flags|=32768,ke!==null&&typeof ke=="object"&&typeof ke.then=="function"){var Be=ke,tt=be,it=tt.tag;if((tt.mode&1)===0&&(it===0||it===11||it===15)){var Je=tt.alternate;Je?(tt.updateQueue=Je.updateQueue,tt.memoizedState=Je.memoizedState,tt.lanes=Je.lanes):(tt.updateQueue=null,tt.memoizedState=null)}var Tt=M(oe);if(Tt!==null){Tt.flags&=-257,z(Tt,oe,be,X,g),Tt.mode&1&&b(X,Be,g),g=Tt,ke=Be;var It=g.updateQueue;if(It===null){var Bt=new Set;Bt.add(ke),g.updateQueue=Bt}else It.add(ke);break e}else{if((g&1)===0){b(X,Be,g),Pb();break e}ke=Error(r(426))}}else if(Wr&&be.mode&1){var gi=M(oe);if(gi!==null){(gi.flags&65536)===0&&(gi.flags|=256),z(gi,oe,be,X,g),Rf(ec(ke,be));break e}}X=ke=ec(ke,be),zi!==4&&(zi=2),Fm===null?Fm=[X]:Fm.push(X),X=oe;do{switch(X.tag){case 3:X.flags|=65536,g&=-g,X.lanes|=g;var Ae=O0(X,ke,g);jf(X,Ae);break e;case 1:be=ke;var Ee=X.type,Oe=X.stateNode;if((X.flags&128)===0&&(typeof Ee.getDerivedStateFromError=="function"||Oe!==null&&typeof Oe.componentDidCatch=="function"&&(cd===null||!cd.has(Oe)))){X.flags|=65536,g&=-g,X.lanes|=g;var ut=x(X,be,g);jf(X,ut);break e}}X=X.return}while(X!==null)}lE(E)}catch(Gt){g=Gt,Pi===E&&E!==null&&(Pi=E=E.return);continue}break}while(!0)}function sE(){var d=j0.current;return j0.current=ad,d===null?ad:d}function Pb(){(zi===0||zi===3||zi===2)&&(zi=4),ia===null||(zf&268435455)===0&&(F0&268435455)===0||hd(ia,Ra)}function H0(d,g){var E=Or;Or|=2;var R=sE();(ia!==d||Ra!==g)&&(tc=null,Gf(d,g));do try{c8();break}catch(V){aE(d,V)}while(!0);if(Yh(),Or=E,j0.current=R,Pi!==null)throw Error(r(261));return ia=null,Ra=0,zi}function c8(){for(;Pi!==null;)oE(Pi)}function d8(){for(;Pi!==null&&!yf();)oE(Pi)}function oE(d){var g=dE(d.alternate,d,so);d.memoizedProps=d.pendingProps,g===null?lE(d):Pi=g,bb.current=null}function lE(d){var g=d;do{var E=g.alternate;if(d=g.return,(g.flags&32768)===0){if(E=n8(E,g,so),E!==null){Pi=E;return}}else{if(E=i8(E,g),E!==null){E.flags&=32767,Pi=E;return}if(d!==null)d.flags|=32768,d.subtreeFlags=0,d.deletions=null;else{zi=6,Pi=null;return}}if(g=g.sibling,g!==null){Pi=g;return}Pi=g=d}while(g!==null);zi===0&&(zi=5)}function Vf(d,g,E){var R=mr,V=Oo.transition;try{Oo.transition=null,mr=1,f8(d,g,E,R)}finally{Oo.transition=V,mr=R}return null}function f8(d,g,E,R){do hp();while(dd!==null);if((Or&6)!==0)throw Error(r(327));E=d.finishedWork;var V=d.finishedLanes;if(E===null)return null;if(d.finishedWork=null,d.finishedLanes=0,E===d.current)throw Error(r(177));d.callbackNode=null,d.callbackPriority=0;var X=E.lanes|E.childLanes;if(Mn(d,X),d===ia&&(Pi=ia=null,Ra=0),(E.subtreeFlags&2064)===0&&(E.flags&2064)===0||z0||(z0=!0,fE(Ha,function(){return hp(),null})),X=(E.flags&15990)!==0,(E.subtreeFlags&15990)!==0||X){X=Oo.transition,Oo.transition=null;var oe=mr;mr=1;var be=Or;Or|=4,bb.current=null,s8(d,E),QC(E,d),Xi(Kt),Iu=!!xt,Kt=xt=null,d.current=E,o8(E),Dl(),Or=be,mr=oe,Oo.transition=X}else d.current=E;if(z0&&(z0=!1,dd=d,U0=V),X=d.pendingLanes,X===0&&(cd=null),Mr(E.stateNode),Bs(d,cn()),g!==null)for(R=d.onRecoverableError,E=0;E<g.length;E++)V=g[E],R(V.value,{componentStack:V.stack,digest:V.digest});if(B0)throw B0=!1,d=kb,kb=null,d;return(U0&1)!==0&&d.tag!==0&&hp(),X=d.pendingLanes,(X&1)!==0?d===_b?Bm++:(Bm=0,_b=d):Bm=0,tu(),null}function hp(){if(dd!==null){var d=Qs(U0),g=Oo.transition,E=mr;try{if(Oo.transition=null,mr=16>d?16:d,dd===null)var R=!1;else{if(d=dd,dd=null,U0=0,(Or&6)!==0)throw Error(r(331));var V=Or;for(Or|=4,Rt=d.current;Rt!==null;){var X=Rt,oe=X.child;if((Rt.flags&16)!==0){var be=X.deletions;if(be!==null){for(var ke=0;ke<be.length;ke++){var Be=be[ke];for(Rt=Be;Rt!==null;){var tt=Rt;switch(tt.tag){case 0:case 11:case 15:Im(8,tt,X)}var it=tt.child;if(it!==null)it.return=tt,Rt=it;else for(;Rt!==null;){tt=Rt;var Je=tt.sibling,Tt=tt.return;if($C(tt),tt===Be){Rt=null;break}if(Je!==null){Je.return=Tt,Rt=Je;break}Rt=Tt}}}var It=X.alternate;if(It!==null){var Bt=It.child;if(Bt!==null){It.child=null;do{var gi=Bt.sibling;Bt.sibling=null,Bt=gi}while(Bt!==null)}}Rt=X}}if((X.subtreeFlags&2064)!==0&&oe!==null)oe.return=X,Rt=oe;else e:for(;Rt!==null;){if(X=Rt,(X.flags&2048)!==0)switch(X.tag){case 0:case 11:case 15:Im(9,X,X.return)}var Ae=X.sibling;if(Ae!==null){Ae.return=X.return,Rt=Ae;break e}Rt=X.return}}var Ee=d.current;for(Rt=Ee;Rt!==null;){oe=Rt;var Oe=oe.child;if((oe.subtreeFlags&2064)!==0&&Oe!==null)Oe.return=oe,Rt=Oe;else e:for(oe=Ee;Rt!==null;){if(be=Rt,(be.flags&2048)!==0)try{switch(be.tag){case 0:case 11:case 15:I0(9,be)}}catch(Gt){ei(be,be.return,Gt)}if(be===oe){Rt=null;break e}var ut=be.sibling;if(ut!==null){ut.return=be.return,Rt=ut;break e}Rt=be.return}}if(Or=V,tu(),_n&&typeof _n.onPostCommitFiberRoot=="function")try{_n.onPostCommitFiberRoot(ga,d)}catch{}R=!0}return R}finally{mr=E,Oo.transition=g}}return!1}function uE(d,g,E){g=ec(E,g),g=O0(d,g,1),d=Lo(d,g,1),g=Ss(),d!==null&&(cs(d,1,g),Bs(d,g))}function ei(d,g,E){if(d.tag===3)uE(d,d,E);else for(;g!==null;){if(g.tag===3){uE(g,d,E);break}else if(g.tag===1){var R=g.stateNode;if(typeof g.type.getDerivedStateFromError=="function"||typeof R.componentDidCatch=="function"&&(cd===null||!cd.has(R))){d=ec(E,d),d=x(g,d,1),g=Lo(g,d,1),d=Ss(),g!==null&&(cs(g,1,d),Bs(g,d));break}}g=g.return}}function h8(d,g,E){var R=d.pingCache;R!==null&&R.delete(g),g=Ss(),d.pingedLanes|=d.suspendedLanes&E,ia===d&&(Ra&E)===E&&(zi===4||zi===3&&(Ra&130023424)===Ra&&500>cn()-Sb?Gf(d,0):wb|=E),Bs(d,g)}function cE(d,g){g===0&&((d.mode&1)===0?g=1:(g=va,va<<=1,(va&130023424)===0&&(va=4194304)));var E=Ss();d=bs(d,g),d!==null&&(cs(d,g,E),Bs(d,E))}function p8(d){var g=d.memoizedState,E=0;g!==null&&(E=g.retryLane),cE(d,E)}function m8(d,g){var E=0;switch(d.tag){case 13:var R=d.stateNode,V=d.memoizedState;V!==null&&(E=V.retryLane);break;case 19:R=d.stateNode;break;default:throw Error(r(314))}R!==null&&R.delete(g),cE(d,E)}var dE;dE=function(d,g,E){if(d!==null)if(d.memoizedProps!==g.pendingProps||Qi.current)ee=!0;else{if((d.lanes&E)===0&&(g.flags&128)===0)return ee=!1,pb(d,g,E);ee=(d.flags&131072)!==0}else ee=!1,Wr&&(g.flags&1048576)!==0&&k0(g,nu,g.index);switch(g.lanes=0,g.tag){case 2:var R=g.type;Er(d,g),d=g.pendingProps;var V=Wu(g,Fi.current);pl(g,E),V=ed(null,g,R,d,V,E);var X=td();return g.flags|=1,typeof V=="object"&&V!==null&&typeof V.render=="function"&&V.$$typeof===void 0?(g.tag=1,g.memoizedState=null,g.updateQueue=null,Ji(R)?(X=!0,qu(g)):X=!1,g.memoizedState=V.state!==null&&V.state!==void 0?V.state:null,If(g),V.updater=od,g.stateNode=V,V._reactInternals=g,lp(g,R,d,E),g=qr(null,g,R,!0,X,E)):(g.tag=0,Wr&&X&&qc(g),fe(null,g,V,E),g=g.child),g;case 16:R=g.elementType;e:{switch(Er(d,g),d=g.pendingProps,V=R._init,R=V(R._payload),g.type=R,V=g.tag=v8(R),d=Bi(R,d),V){case 0:g=St(null,g,R,d,E);break e;case 1:g=on(null,g,R,d,E);break e;case 11:g=Ne(null,g,R,d,E);break e;case 14:g=Ue(null,g,R,Bi(R.type,d),E);break e}throw Error(r(306,R,""))}return g;case 0:return R=g.type,V=g.pendingProps,V=g.elementType===R?V:Bi(R,V),St(d,g,R,V,E);case 1:return R=g.type,V=g.pendingProps,V=g.elementType===R?V:Bi(R,V),on(d,g,R,V,E);case 3:e:{if(Aa(g),d===null)throw Error(r(387));R=g.pendingProps,X=g.memoizedState,V=X.element,Jh(d,g),Yc(g,R,null,E);var oe=g.memoizedState;if(R=oe.element,X.isDehydrated)if(X={element:R,isDehydrated:!1,cache:oe.cache,pendingSuspenseBoundaries:oe.pendingSuspenseBoundaries,transitions:oe.transitions},g.updateQueue.baseState=X,g.memoizedState=X,g.flags&256){V=ec(Error(r(423)),g),g=Ro(d,g,R,E,V);break e}else if(R!==V){V=ec(Error(r(424)),g),g=Ro(d,g,R,E,V);break e}else for(mt=Ds(g.stateNode.containerInfo.firstChild),vs=g,Wr=!0,ys=null,E=Is(g,null,R,E),g.child=E;E;)E.flags=E.flags&-3|4096,E=E.sibling;else{if(Yu(),R===V){g=na(d,g,E);break e}fe(d,g,R,E)}g=g.child}return g;case 5:return Xc(g),d===null&&$c(g),R=g.type,V=g.pendingProps,X=d!==null?d.memoizedProps:null,oe=V.children,dr(R,V)?oe=null:X!==null&&dr(R,X)&&(g.flags|=32),lr(d,g),fe(d,g,oe,E),g.child;case 6:return d===null&&$c(g),null;case 13:return Ve(d,g,E);case 4:return au(g,g.stateNode.containerInfo),R=g.pendingProps,d===null?g.child=Xu(g,null,R,E):fe(d,g,R,E),g.child;case 11:return R=g.type,V=g.pendingProps,V=g.elementType===R?V:Bi(R,V),Ne(d,g,R,V,E);case 7:return fe(d,g,g.pendingProps,E),g.child;case 8:return fe(d,g,g.pendingProps.children,E),g.child;case 12:return fe(d,g,g.pendingProps.children,E),g.child;case 10:e:{if(R=g.type._context,V=g.pendingProps,X=g.memoizedProps,oe=V.value,en(Of,R._currentValue),R._currentValue=oe,X!==null)if(Yi(X.value,oe)){if(X.children===V.children&&!Qi.current){g=na(d,g,E);break e}}else for(X=g.child,X!==null&&(X.return=g);X!==null;){var be=X.dependencies;if(be!==null){oe=X.child;for(var ke=be.firstContext;ke!==null;){if(ke.context===R){if(X.tag===1){ke=Ao(-1,E&-E),ke.tag=2;var Be=X.updateQueue;if(Be!==null){Be=Be.shared;var tt=Be.pending;tt===null?ke.next=ke:(ke.next=tt.next,tt.next=ke),Be.pending=ke}}X.lanes|=E,ke=X.alternate,ke!==null&&(ke.lanes|=E),Qh(X.return,E,g),be.lanes|=E;break}ke=ke.next}}else if(X.tag===10)oe=X.type===g.type?null:X.child;else if(X.tag===18){if(oe=X.return,oe===null)throw Error(r(341));oe.lanes|=E,be=oe.alternate,be!==null&&(be.lanes|=E),Qh(oe,E,g),oe=X.sibling}else oe=X.child;if(oe!==null)oe.return=X;else for(oe=X;oe!==null;){if(oe===g){oe=null;break}if(X=oe.sibling,X!==null){X.return=oe.return,oe=X;break}oe=oe.return}X=oe}fe(d,g,V.children,E),g=g.child}return g;case 9:return V=g.type,R=g.pendingProps.children,pl(g,E),V=Pa(V),R=R(V),g.flags|=1,fe(d,g,R,E),g.child;case 14:return R=g.type,V=Bi(R,g.pendingProps),V=Bi(R.type,V),Ue(d,g,R,V,E);case 15:return ot(d,g,g.type,g.pendingProps,E);case 17:return R=g.type,V=g.pendingProps,V=g.elementType===R?V:Bi(R,V),Er(d,g),g.tag=1,Ji(R)?(d=!0,qu(g)):d=!1,pl(g,E),R0(g,R,V),lp(g,R,V,E),qr(null,g,R,!0,d,E);case 19:return mi(d,g,E);case 22:return Lt(d,g,E)}throw Error(r(156,g.tag))};function fE(d,g){return Au(d,g)}function g8(d,g,E,R){this.tag=d,this.key=E,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=g,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=R,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Do(d,g,E,R){return new g8(d,g,E,R)}function Mb(d){return d=d.prototype,!(!d||!d.isReactComponent)}function v8(d){if(typeof d=="function")return Mb(d)?1:0;if(d!=null){if(d=d.$$typeof,d===Z)return 11;if(d===U)return 14}return 2}function pd(d,g){var E=d.alternate;return E===null?(E=Do(d.tag,g,d.key,d.mode),E.elementType=d.elementType,E.type=d.type,E.stateNode=d.stateNode,E.alternate=d,d.alternate=E):(E.pendingProps=g,E.type=d.type,E.flags=0,E.subtreeFlags=0,E.deletions=null),E.flags=d.flags&14680064,E.childLanes=d.childLanes,E.lanes=d.lanes,E.child=d.child,E.memoizedProps=d.memoizedProps,E.memoizedState=d.memoizedState,E.updateQueue=d.updateQueue,g=d.dependencies,E.dependencies=g===null?null:{lanes:g.lanes,firstContext:g.firstContext},E.sibling=d.sibling,E.index=d.index,E.ref=d.ref,E}function W0(d,g,E,R,V,X){var oe=2;if(R=d,typeof d=="function")Mb(d)&&(oe=1);else if(typeof d=="string")oe=5;else e:switch(d){case j:return Hf(E.children,V,X,g);case D:oe=8,V|=8;break;case F:return d=Do(12,E,g,V|2),d.elementType=F,d.lanes=X,d;case I:return d=Do(13,E,g,V),d.elementType=I,d.lanes=X,d;case q:return d=Do(19,E,g,V),d.elementType=q,d.lanes=X,d;case Y:return q0(E,V,X,g);default:if(typeof d=="object"&&d!==null)switch(d.$$typeof){case B:oe=10;break e;case $:oe=9;break e;case Z:oe=11;break e;case U:oe=14;break e;case W:oe=16,R=null;break e}throw Error(r(130,d==null?d:typeof d,""))}return g=Do(oe,E,g,V),g.elementType=d,g.type=R,g.lanes=X,g}function Hf(d,g,E,R){return d=Do(7,d,R,g),d.lanes=E,d}function q0(d,g,E,R){return d=Do(22,d,R,g),d.elementType=Y,d.lanes=E,d.stateNode={isHidden:!1},d}function Ab(d,g,E){return d=Do(6,d,null,g),d.lanes=E,d}function Lb(d,g,E){return g=Do(4,d.children!==null?d.children:[],d.key,g),g.lanes=E,g.stateNode={containerInfo:d.containerInfo,pendingChildren:null,implementation:d.implementation},g}function y8(d,g,E,R,V){this.tag=g,this.containerInfo=d,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=_i(0),this.expirationTimes=_i(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=_i(0),this.identifierPrefix=R,this.onRecoverableError=V,this.mutableSourceEagerHydrationData=null}function Rb(d,g,E,R,V,X,oe,be,ke){return d=new y8(d,g,E,be,ke),g===1?(g=1,X===!0&&(g|=8)):g=0,X=Do(3,null,null,g),d.current=X,X.stateNode=d,X.memoizedState={element:R,isDehydrated:E,cache:null,transitions:null,pendingSuspenseBoundaries:null},If(X),d}function x8(d,g,E){var R=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:O,key:R==null?null:""+R,children:d,containerInfo:g,implementation:E}}function hE(d){if(!d)return To;d=d._reactInternals;e:{if(Si(d)!==d||d.tag!==1)throw Error(r(170));var g=d;do{switch(g.tag){case 3:g=g.stateNode.context;break e;case 1:if(Ji(g.type)){g=g.stateNode.__reactInternalMemoizedMergedChildContext;break e}}g=g.return}while(g!==null);throw Error(r(171))}if(d.tag===1){var E=d.type;if(Ji(E))return Wh(d,E,g)}return g}function pE(d,g,E,R,V,X,oe,be,ke){return d=Rb(E,R,!0,d,V,X,oe,be,ke),d.context=hE(null),E=d.current,R=Ss(),V=fd(E),X=Ao(R,V),X.callback=g??null,Lo(E,X,V),d.current.lanes=V,cs(d,V,R),Bs(d,R),d}function $0(d,g,E,R){var V=g.current,X=Ss(),oe=fd(V);return E=hE(E),g.context===null?g.context=E:g.pendingContext=E,g=Ao(X,oe),g.payload={element:d},R=R===void 0?null:R,R!==null&&(g.callback=R),d=Lo(V,g,oe),d!==null&&(bl(d,V,oe,X),ep(d,V,oe)),oe}function K0(d){return d=d.current,d.child?(d.child.tag===5,d.child.stateNode):null}function mE(d,g){if(d=d.memoizedState,d!==null&&d.dehydrated!==null){var E=d.retryLane;d.retryLane=E!==0&&E<g?E:g}}function Ob(d,g){mE(d,g),(d=d.alternate)&&mE(d,g)}function b8(){return null}var gE=typeof reportError=="function"?reportError:function(d){console.error(d)};function Db(d){this._internalRoot=d}Z0.prototype.render=Db.prototype.render=function(d){var g=this._internalRoot;if(g===null)throw Error(r(409));$0(d,g,null,null)},Z0.prototype.unmount=Db.prototype.unmount=function(){var d=this._internalRoot;if(d!==null){this._internalRoot=null;var g=d.containerInfo;Uf(function(){$0(null,d,null,null)}),g[Rr]=null}};function Z0(d){this._internalRoot=d}Z0.prototype.unstable_scheduleHydration=function(d){if(d){var g=Nc();d={blockedOn:null,target:d,priority:g};for(var E=0;E<Wn.length&&g!==0&&g<Wn[E].priority;E++);Wn.splice(E,0,d),E===0&&Fl(d)}};function Ib(d){return!(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11)}function Y0(d){return!(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11&&(d.nodeType!==8||d.nodeValue!==" react-mount-point-unstable "))}function vE(){}function w8(d,g,E,R,V){if(V){if(typeof R=="function"){var X=R;R=function(){var Be=K0(oe);X.call(Be)}}var oe=pE(g,R,d,0,null,!1,!1,"",vE);return d._reactRootContainer=oe,d[Rr]=oe.current,Co(d.nodeType===8?d.parentNode:d),Uf(),oe}for(;V=d.lastChild;)d.removeChild(V);if(typeof R=="function"){var be=R;R=function(){var Be=K0(ke);be.call(Be)}}var ke=Rb(d,0,!1,null,null,!1,!1,"",vE);return d._reactRootContainer=ke,d[Rr]=ke.current,Co(d.nodeType===8?d.parentNode:d),Uf(function(){$0(g,ke,E,R)}),ke}function X0(d,g,E,R,V){var X=E._reactRootContainer;if(X){var oe=X;if(typeof V=="function"){var be=V;V=function(){var ke=K0(oe);be.call(ke)}}$0(g,oe,d,V)}else oe=w8(E,g,d,V,R);return K0(oe)}vo=function(d){switch(d.tag){case 3:var g=d.stateNode;if(g.current.memoizedState.isDehydrated){var E=Ft(g.pendingLanes);E!==0&&(Xs(g,E|1),Bs(g,cn()),(Or&6)===0&&(fp=cn()+500,tu()))}break;case 13:Uf(function(){var R=bs(d,1);if(R!==null){var V=Ss();bl(R,d,1,V)}}),Ob(d,1)}},Ns=function(d){if(d.tag===13){var g=bs(d,134217728);if(g!==null){var E=Ss();bl(g,d,134217728,E)}Ob(d,134217728)}},Tc=function(d){if(d.tag===13){var g=fd(d),E=bs(d,g);if(E!==null){var R=Ss();bl(E,d,g,R)}Ob(d,g)}},Nc=function(){return mr},Yo=function(d,g){var E=mr;try{return mr=d,g()}finally{mr=E}},dt=function(d,g,E){switch(g){case"input":if(et(d,E),g=E.name,E.type==="radio"&&g!=null){for(E=d;E.parentNode;)E=E.parentNode;for(E=E.querySelectorAll("input[name="+JSON.stringify(""+g)+'][type="radio"]'),g=0;g<E.length;g++){var R=E[g];if(R!==d&&R.form===d.form){var V=Xn(R);if(!V)throw Error(r(90));xe(R),et(R,V)}}}break;case"textarea":Ke(d,E);break;case"select":g=E.value,g!=null&&nt(d,!!E.multiple,g,!1)}},Zt=Tb,er=Uf;var S8={usingClientEntryPoint:!1,Events:[dl,jn,Xn,$t,kt,Tb]},zm={findFiberByHostInstance:Eo,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},k8={bundleType:zm.bundleType,version:zm.version,rendererPackageName:zm.rendererPackageName,rendererConfig:zm.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:N.ReactCurrentDispatcher,findHostInstanceByFiber:function(d){return d=go(d),d===null?null:d.stateNode},findFiberByHostInstance:zm.findFiberByHostInstance||b8,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Q0=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Q0.isDisabled&&Q0.supportsFiber)try{ga=Q0.inject(k8),_n=Q0}catch{}}return zs.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=S8,zs.createPortal=function(d,g){var E=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Ib(g))throw Error(r(200));return x8(d,g,null,E)},zs.createRoot=function(d,g){if(!Ib(d))throw Error(r(299));var E=!1,R="",V=gE;return g!=null&&(g.unstable_strictMode===!0&&(E=!0),g.identifierPrefix!==void 0&&(R=g.identifierPrefix),g.onRecoverableError!==void 0&&(V=g.onRecoverableError)),g=Rb(d,1,!1,null,null,E,!1,R,V),d[Rr]=g.current,Co(d.nodeType===8?d.parentNode:d),new Db(g)},zs.findDOMNode=function(d){if(d==null)return null;if(d.nodeType===1)return d;var g=d._reactInternals;if(g===void 0)throw typeof d.render=="function"?Error(r(188)):(d=Object.keys(d).join(","),Error(r(268,d)));return d=go(g),d=d===null?null:d.stateNode,d},zs.flushSync=function(d){return Uf(d)},zs.hydrate=function(d,g,E){if(!Y0(g))throw Error(r(200));return X0(null,d,g,!0,E)},zs.hydrateRoot=function(d,g,E){if(!Ib(d))throw Error(r(405));var R=E!=null&&E.hydratedSources||null,V=!1,X="",oe=gE;if(E!=null&&(E.unstable_strictMode===!0&&(V=!0),E.identifierPrefix!==void 0&&(X=E.identifierPrefix),E.onRecoverableError!==void 0&&(oe=E.onRecoverableError)),g=pE(g,null,d,1,E??null,V,!1,X,oe),d[Rr]=g.current,Co(d),R)for(d=0;d<R.length;d++)E=R[d],V=E._getVersion,V=V(E._source),g.mutableSourceEagerHydrationData==null?g.mutableSourceEagerHydrationData=[E,V]:g.mutableSourceEagerHydrationData.push(E,V);return new Z0(g)},zs.render=function(d,g,E){if(!Y0(g))throw Error(r(200));return X0(null,d,g,!1,E)},zs.unmountComponentAtNode=function(d){if(!Y0(d))throw Error(r(40));return d._reactRootContainer?(Uf(function(){X0(null,null,d,!1,function(){d._reactRootContainer=null,d[Rr]=null})}),!0):!1},zs.unstable_batchedUpdates=Tb,zs.unstable_renderSubtreeIntoContainer=function(d,g,E,R){if(!Y0(E))throw Error(r(200));if(d==null||d._reactInternals===void 0)throw Error(r(38));return X0(d,g,E,!1,R)},zs.version="18.3.1-next-f1338f8080-20240426",zs}var EE;function EM(){if(EE)return Bb.exports;EE=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),Bb.exports=L8(),Bb.exports}var TE;function R8(){if(TE)return J0;TE=1;var t=EM();return J0.createRoot=t.createRoot,J0.hydrateRoot=t.hydrateRoot,J0}var O8=R8();const D8=Mh(O8);var Al=EM();const I8=Mh(Al);function bv(){return bv=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},bv.apply(this,arguments)}var Od;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(Od||(Od={}));const NE="popstate";function j8(t){t===void 0&&(t={});function e(n,i){let{pathname:a,search:s,hash:o}=n.location;return RS("",{pathname:a,search:s,hash:o},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function r(n,i){return typeof i=="string"?i:ax(i)}return B8(e,r,null,t)}function ni(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function t_(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function F8(){return Math.random().toString(36).substr(2,8)}function PE(t,e){return{usr:t.state,key:t.key,idx:e}}function RS(t,e,r,n){return r===void 0&&(r=null),bv({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof e=="string"?cm(e):e,{state:r,key:e&&e.key||n||F8()})}function ax(t){let{pathname:e="/",search:r="",hash:n=""}=t;return r&&r!=="?"&&(e+=r.charAt(0)==="?"?r:"?"+r),n&&n!=="#"&&(e+=n.charAt(0)==="#"?n:"#"+n),e}function cm(t){let e={};if(t){let r=t.indexOf("#");r>=0&&(e.hash=t.substr(r),t=t.substr(0,r));let n=t.indexOf("?");n>=0&&(e.search=t.substr(n),t=t.substr(0,n)),t&&(e.pathname=t)}return e}function B8(t,e,r,n){n===void 0&&(n={});let{window:i=document.defaultView,v5Compat:a=!1}=n,s=i.history,o=Od.Pop,l=null,u=c();u==null&&(u=0,s.replaceState(bv({},s.state,{idx:u}),""));function c(){return(s.state||{idx:null}).idx}function f(){o=Od.Pop;let w=c(),T=w==null?null:w-u;u=w,l&&l({action:o,location:S.location,delta:T})}function p(w,T){o=Od.Push;let _=RS(S.location,w,T);u=c()+1;let C=PE(_,u),N=S.createHref(_);try{s.pushState(C,"",N)}catch(A){if(A instanceof DOMException&&A.name==="DataCloneError")throw A;i.location.assign(N)}a&&l&&l({action:o,location:S.location,delta:1})}function v(w,T){o=Od.Replace;let _=RS(S.location,w,T);u=c();let C=PE(_,u),N=S.createHref(_);s.replaceState(C,"",N),a&&l&&l({action:o,location:S.location,delta:0})}function y(w){let T=i.location.origin!=="null"?i.location.origin:i.location.href,_=typeof w=="string"?w:ax(w);return _=_.replace(/ $/,"%20"),ni(T,"No window.location.(origin|href) available to create URL for href: "+_),new URL(_,T)}let S={get action(){return o},get location(){return t(i,s)},listen(w){if(l)throw new Error("A history only accepts one active listener");return i.addEventListener(NE,f),l=w,()=>{i.removeEventListener(NE,f),l=null}},createHref(w){return e(i,w)},createURL:y,encodeLocation(w){let T=y(w);return{pathname:T.pathname,search:T.search,hash:T.hash}},push:p,replace:v,go(w){return s.go(w)}};return S}var ME;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(ME||(ME={}));function z8(t,e,r){return r===void 0&&(r="/"),U8(t,e,r)}function U8(t,e,r,n){let i=typeof e=="string"?cm(e):e,a=$p(i.pathname||"/",r);if(a==null)return null;let s=TM(t);G8(s);let o=null;for(let l=0;o==null&&l<s.length;++l){let u=J8(a);o=X8(s[l],u)}return o}function TM(t,e,r,n){e===void 0&&(e=[]),r===void 0&&(r=[]),n===void 0&&(n="");let i=(a,s,o)=>{let l={relativePath:o===void 0?a.path||"":o,caseSensitive:a.caseSensitive===!0,childrenIndex:s,route:a};l.relativePath.startsWith("/")&&(ni(l.relativePath.startsWith(n),'Absolute route path "'+l.relativePath+'" nested under path '+('"'+n+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),l.relativePath=l.relativePath.slice(n.length));let u=Gd([n,l.relativePath]),c=r.concat(l);a.children&&a.children.length>0&&(ni(a.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+u+'".')),TM(a.children,e,c,u)),!(a.path==null&&!a.index)&&e.push({path:u,score:Z8(u,a.index),routesMeta:c})};return t.forEach((a,s)=>{var o;if(a.path===""||!((o=a.path)!=null&&o.includes("?")))i(a,s);else for(let l of NM(a.path))i(a,s,l)}),e}function NM(t){let e=t.split("/");if(e.length===0)return[];let[r,...n]=e,i=r.endsWith("?"),a=r.replace(/\?$/,"");if(n.length===0)return i?[a,""]:[a];let s=NM(n.join("/")),o=[];return o.push(...s.map(l=>l===""?a:[a,l].join("/"))),i&&o.push(...s),o.map(l=>t.startsWith("/")&&l===""?"/":l)}function G8(t){t.sort((e,r)=>e.score!==r.score?r.score-e.score:Y8(e.routesMeta.map(n=>n.childrenIndex),r.routesMeta.map(n=>n.childrenIndex)))}const V8=/^:[\w-]+$/,H8=3,W8=2,q8=1,$8=10,K8=-2,AE=t=>t==="*";function Z8(t,e){let r=t.split("/"),n=r.length;return r.some(AE)&&(n+=K8),e&&(n+=W8),r.filter(i=>!AE(i)).reduce((i,a)=>i+(V8.test(a)?H8:a===""?q8:$8),n)}function Y8(t,e){return t.length===e.length&&t.slice(0,-1).every((n,i)=>n===e[i])?t[t.length-1]-e[e.length-1]:0}function X8(t,e,r){let{routesMeta:n}=t,i={},a="/",s=[];for(let o=0;o<n.length;++o){let l=n[o],u=o===n.length-1,c=a==="/"?e:e.slice(a.length)||"/",f=OS({path:l.relativePath,caseSensitive:l.caseSensitive,end:u},c),p=l.route;if(!f)return null;Object.assign(i,f.params),s.push({params:i,pathname:Gd([a,f.pathname]),pathnameBase:iI(Gd([a,f.pathnameBase])),route:p}),f.pathnameBase!=="/"&&(a=Gd([a,f.pathnameBase]))}return s}function OS(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[r,n]=Q8(t.path,t.caseSensitive,t.end),i=e.match(r);if(!i)return null;let a=i[0],s=a.replace(/(.)\/+$/,"$1"),o=i.slice(1);return{params:n.reduce((u,c,f)=>{let{paramName:p,isOptional:v}=c;if(p==="*"){let S=o[f]||"";s=a.slice(0,a.length-S.length).replace(/(.)\/+$/,"$1")}const y=o[f];return v&&!y?u[p]=void 0:u[p]=(y||"").replace(/%2F/g,"/"),u},{}),pathname:a,pathnameBase:s,pattern:t}}function Q8(t,e,r){e===void 0&&(e=!1),r===void 0&&(r=!0),t_(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let n=[],i="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(s,o,l)=>(n.push({paramName:o,isOptional:l!=null}),l?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(n.push({paramName:"*"}),i+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):r?i+="\\/*$":t!==""&&t!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,e?void 0:"i"),n]}function J8(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return t_(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),t}}function $p(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let r=e.endsWith("/")?e.length-1:e.length,n=t.charAt(r);return n&&n!=="/"?null:t.slice(r)||"/"}const eI=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,tI=t=>eI.test(t);function rI(t,e){e===void 0&&(e="/");let{pathname:r,search:n="",hash:i=""}=typeof t=="string"?cm(t):t,a;if(r)if(tI(r))a=r;else{if(r.includes("//")){let s=r;r=r.replace(/\/\/+/g,"/"),t_(!1,"Pathnames cannot have embedded double slashes - normalizing "+(s+" -> "+r))}r.startsWith("/")?a=LE(r.substring(1),"/"):a=LE(r,e)}else a=e;return{pathname:a,search:aI(n),hash:sI(i)}}function LE(t,e){let r=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(i=>{i===".."?r.length>1&&r.pop():i!=="."&&r.push(i)}),r.length>1?r.join("/"):"/"}function Gb(t,e,r,n){return"Cannot include a '"+t+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(n)+"].  Please separate it out to the ")+("`to."+r+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function nI(t){return t.filter((e,r)=>r===0||e.route.path&&e.route.path.length>0)}function PM(t,e){let r=nI(t);return e?r.map((n,i)=>i===r.length-1?n.pathname:n.pathnameBase):r.map(n=>n.pathnameBase)}function MM(t,e,r,n){n===void 0&&(n=!1);let i;typeof t=="string"?i=cm(t):(i=bv({},t),ni(!i.pathname||!i.pathname.includes("?"),Gb("?","pathname","search",i)),ni(!i.pathname||!i.pathname.includes("#"),Gb("#","pathname","hash",i)),ni(!i.search||!i.search.includes("#"),Gb("#","search","hash",i)));let a=t===""||i.pathname==="",s=a?"/":i.pathname,o;if(s==null)o=r;else{let f=e.length-1;if(!n&&s.startsWith("..")){let p=s.split("/");for(;p[0]==="..";)p.shift(),f-=1;i.pathname=p.join("/")}o=f>=0?e[f]:"/"}let l=rI(i,o),u=s&&s!=="/"&&s.endsWith("/"),c=(a||s===".")&&r.endsWith("/");return!l.pathname.endsWith("/")&&(u||c)&&(l.pathname+="/"),l}const Gd=t=>t.join("/").replace(/\/\/+/g,"/"),iI=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),aI=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,sI=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function oI(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}const AM=["post","put","patch","delete"];new Set(AM);const lI=["get",...AM];new Set(lI);function wv(){return wv=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},wv.apply(this,arguments)}const b1=se.createContext(null),LM=se.createContext(null),of=se.createContext(null),w1=se.createContext(null),wc=se.createContext({outlet:null,matches:[],isDataRoute:!1}),RM=se.createContext(null);function uI(t,e){let{relative:r}=e===void 0?{}:e;Yv()||ni(!1);let{basename:n,navigator:i}=se.useContext(of),{hash:a,pathname:s,search:o}=S1(t,{relative:r}),l=s;return n!=="/"&&(l=s==="/"?n:Gd([n,s])),i.createHref({pathname:l,search:o,hash:a})}function Yv(){return se.useContext(w1)!=null}function Ah(){return Yv()||ni(!1),se.useContext(w1).location}function OM(t){se.useContext(of).static||se.useLayoutEffect(t)}function za(){let{isDataRoute:t}=se.useContext(wc);return t?kI():cI()}function cI(){Yv()||ni(!1);let t=se.useContext(b1),{basename:e,future:r,navigator:n}=se.useContext(of),{matches:i}=se.useContext(wc),{pathname:a}=Ah(),s=JSON.stringify(PM(i,r.v7_relativeSplatPath)),o=se.useRef(!1);return OM(()=>{o.current=!0}),se.useCallback(function(u,c){if(c===void 0&&(c={}),!o.current)return;if(typeof u=="number"){n.go(u);return}let f=MM(u,JSON.parse(s),a,c.relative==="path");t==null&&e!=="/"&&(f.pathname=f.pathname==="/"?e:Gd([e,f.pathname])),(c.replace?n.replace:n.push)(f,c.state,c)},[e,n,s,a,t])}const DM=se.createContext(null);function Ll(){return se.useContext(DM)}function dI(t){let e=se.useContext(wc).outlet;return e&&se.createElement(DM.Provider,{value:t},e)}function Vi(){let{matches:t}=se.useContext(wc),e=t[t.length-1];return e?e.params:{}}function S1(t,e){let{relative:r}=e===void 0?{}:e,{future:n}=se.useContext(of),{matches:i}=se.useContext(wc),{pathname:a}=Ah(),s=JSON.stringify(PM(i,n.v7_relativeSplatPath));return se.useMemo(()=>MM(t,JSON.parse(s),a,r==="path"),[t,s,a,r])}function fI(t,e){return hI(t,e)}function hI(t,e,r,n){Yv()||ni(!1);let{navigator:i}=se.useContext(of),{matches:a}=se.useContext(wc),s=a[a.length-1],o=s?s.params:{};s&&s.pathname;let l=s?s.pathnameBase:"/";s&&s.route;let u=Ah(),c;if(e){var f;let w=typeof e=="string"?cm(e):e;l==="/"||(f=w.pathname)!=null&&f.startsWith(l)||ni(!1),c=w}else c=u;let p=c.pathname||"/",v=p;if(l!=="/"){let w=l.replace(/^\//,"").split("/");v="/"+p.replace(/^\//,"").split("/").slice(w.length).join("/")}let y=z8(t,{pathname:v}),S=yI(y&&y.map(w=>Object.assign({},w,{params:Object.assign({},o,w.params),pathname:Gd([l,i.encodeLocation?i.encodeLocation(w.pathname).pathname:w.pathname]),pathnameBase:w.pathnameBase==="/"?l:Gd([l,i.encodeLocation?i.encodeLocation(w.pathnameBase).pathname:w.pathnameBase])})),a,r,n);return e&&S?se.createElement(w1.Provider,{value:{location:wv({pathname:"/",search:"",hash:"",state:null,key:"default"},c),navigationType:Od.Pop}},S):S}function pI(){let t=SI(),e=oI(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),r=t instanceof Error?t.stack:null,i={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return se.createElement(se.Fragment,null,se.createElement("h2",null,"Unexpected Application Error!"),se.createElement("h3",{style:{fontStyle:"italic"}},e),r?se.createElement("pre",{style:i},r):null,null)}const mI=se.createElement(pI,null);class gI extends se.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,r){return r.location!==e.location||r.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:r.error,location:r.location,revalidation:e.revalidation||r.revalidation}}componentDidCatch(e,r){console.error("React Router caught the following error during render",e,r)}render(){return this.state.error!==void 0?se.createElement(wc.Provider,{value:this.props.routeContext},se.createElement(RM.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function vI(t){let{routeContext:e,match:r,children:n}=t,i=se.useContext(b1);return i&&i.static&&i.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=r.route.id),se.createElement(wc.Provider,{value:e},n)}function yI(t,e,r,n){var i;if(e===void 0&&(e=[]),r===void 0&&(r=null),n===void 0&&(n=null),t==null){var a;if(!r)return null;if(r.errors)t=r.matches;else if((a=n)!=null&&a.v7_partialHydration&&e.length===0&&!r.initialized&&r.matches.length>0)t=r.matches;else return null}let s=t,o=(i=r)==null?void 0:i.errors;if(o!=null){let c=s.findIndex(f=>f.route.id&&o?.[f.route.id]!==void 0);c>=0||ni(!1),s=s.slice(0,Math.min(s.length,c+1))}let l=!1,u=-1;if(r&&n&&n.v7_partialHydration)for(let c=0;c<s.length;c++){let f=s[c];if((f.route.HydrateFallback||f.route.hydrateFallbackElement)&&(u=c),f.route.id){let{loaderData:p,errors:v}=r,y=f.route.loader&&p[f.route.id]===void 0&&(!v||v[f.route.id]===void 0);if(f.route.lazy||y){l=!0,u>=0?s=s.slice(0,u+1):s=[s[0]];break}}}return s.reduceRight((c,f,p)=>{let v,y=!1,S=null,w=null;r&&(v=o&&f.route.id?o[f.route.id]:void 0,S=f.route.errorElement||mI,l&&(u<0&&p===0?(_I("route-fallback"),y=!0,w=null):u===p&&(y=!0,w=f.route.hydrateFallbackElement||null)));let T=e.concat(s.slice(0,p+1)),_=()=>{let C;return v?C=S:y?C=w:f.route.Component?C=se.createElement(f.route.Component,null):f.route.element?C=f.route.element:C=c,se.createElement(vI,{match:f,routeContext:{outlet:c,matches:T,isDataRoute:r!=null},children:C})};return r&&(f.route.ErrorBoundary||f.route.errorElement||p===0)?se.createElement(gI,{location:r.location,revalidation:r.revalidation,component:S,error:v,children:_(),routeContext:{outlet:null,matches:T,isDataRoute:!0}}):_()},null)}var IM=(function(t){return t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t})(IM||{}),jM=(function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t})(jM||{});function xI(t){let e=se.useContext(b1);return e||ni(!1),e}function bI(t){let e=se.useContext(LM);return e||ni(!1),e}function wI(t){let e=se.useContext(wc);return e||ni(!1),e}function FM(t){let e=wI(),r=e.matches[e.matches.length-1];return r.route.id||ni(!1),r.route.id}function SI(){var t;let e=se.useContext(RM),r=bI(),n=FM();return e!==void 0?e:(t=r.errors)==null?void 0:t[n]}function kI(){let{router:t}=xI(IM.UseNavigateStable),e=FM(jM.UseNavigateStable),r=se.useRef(!1);return OM(()=>{r.current=!0}),se.useCallback(function(i,a){a===void 0&&(a={}),r.current&&(typeof i=="number"?t.navigate(i):t.navigate(i,wv({fromRouteId:e},a)))},[t,e])}const RE={};function _I(t,e,r){RE[t]||(RE[t]=!0)}function CI(t,e){t?.v7_startTransition,t?.v7_relativeSplatPath}function r_(t){return dI(t.context)}function zn(t){ni(!1)}function EI(t){let{basename:e="/",children:r=null,location:n,navigationType:i=Od.Pop,navigator:a,static:s=!1,future:o}=t;Yv()&&ni(!1);let l=e.replace(/^\/*/,"/"),u=se.useMemo(()=>({basename:l,navigator:a,static:s,future:wv({v7_relativeSplatPath:!1},o)}),[l,o,a,s]);typeof n=="string"&&(n=cm(n));let{pathname:c="/",search:f="",hash:p="",state:v=null,key:y="default"}=n,S=se.useMemo(()=>{let w=$p(c,l);return w==null?null:{location:{pathname:w,search:f,hash:p,state:v,key:y},navigationType:i}},[l,c,f,p,v,y,i]);return S==null?null:se.createElement(of.Provider,{value:u},se.createElement(w1.Provider,{children:r,value:S}))}function TI(t){let{children:e,location:r}=t;return fI(DS(e),r)}new Promise(()=>{});function DS(t,e){e===void 0&&(e=[]);let r=[];return se.Children.forEach(t,(n,i)=>{if(!se.isValidElement(n))return;let a=[...e,i];if(n.type===se.Fragment){r.push.apply(r,DS(n.props.children,a));return}n.type!==zn&&ni(!1),!n.props.index||!n.props.children||ni(!1);let s={id:n.props.id||a.join("-"),caseSensitive:n.props.caseSensitive,element:n.props.element,Component:n.props.Component,index:n.props.index,path:n.props.path,loader:n.props.loader,action:n.props.action,errorElement:n.props.errorElement,ErrorBoundary:n.props.ErrorBoundary,hasErrorBoundary:n.props.ErrorBoundary!=null||n.props.errorElement!=null,shouldRevalidate:n.props.shouldRevalidate,handle:n.props.handle,lazy:n.props.lazy};n.props.children&&(s.children=DS(n.props.children,a)),r.push(s)}),r}function sx(){return sx=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},sx.apply(this,arguments)}function BM(t,e){if(t==null)return{};var r={},n=Object.keys(t),i,a;for(a=0;a<n.length;a++)i=n[a],!(e.indexOf(i)>=0)&&(r[i]=t[i]);return r}function NI(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function PI(t,e){return t.button===0&&(!e||e==="_self")&&!NI(t)}const MI=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],AI=["aria-current","caseSensitive","className","end","style","to","viewTransition","children"],LI="6";try{window.__reactRouterVersion=LI}catch{}const RI=se.createContext({isTransitioning:!1}),OI="startTransition",OE=M8[OI];function DI(t){let{basename:e,children:r,future:n,window:i}=t,a=se.useRef();a.current==null&&(a.current=j8({window:i,v5Compat:!0}));let s=a.current,[o,l]=se.useState({action:s.action,location:s.location}),{v7_startTransition:u}=n||{},c=se.useCallback(f=>{u&&OE?OE(()=>l(f)):l(f)},[l,u]);return se.useLayoutEffect(()=>s.listen(c),[s,c]),se.useEffect(()=>CI(n),[n]),se.createElement(EI,{basename:e,children:r,location:o.location,navigationType:o.action,navigator:s,future:n})}const II=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",jI=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,gh=se.forwardRef(function(e,r){let{onClick:n,relative:i,reloadDocument:a,replace:s,state:o,target:l,to:u,preventScrollReset:c,viewTransition:f}=e,p=BM(e,MI),{basename:v}=se.useContext(of),y,S=!1;if(typeof u=="string"&&jI.test(u)&&(y=u,II))try{let C=new URL(window.location.href),N=u.startsWith("//")?new URL(C.protocol+u):new URL(u),A=$p(N.pathname,v);N.origin===C.origin&&A!=null?u=A+N.search+N.hash:S=!0}catch{}let w=uI(u,{relative:i}),T=zI(u,{replace:s,state:o,target:l,preventScrollReset:c,relative:i,viewTransition:f});function _(C){n&&n(C),C.defaultPrevented||T(C)}return se.createElement("a",sx({},p,{href:y||w,onClick:S||a?n:_,ref:r,target:l}))}),FI=se.forwardRef(function(e,r){let{"aria-current":n="page",caseSensitive:i=!1,className:a="",end:s=!1,style:o,to:l,viewTransition:u,children:c}=e,f=BM(e,AI),p=S1(l,{relative:f.relative}),v=Ah(),y=se.useContext(LM),{navigator:S,basename:w}=se.useContext(of),T=y!=null&&UI(p)&&u===!0,_=S.encodeLocation?S.encodeLocation(p).pathname:p.pathname,C=v.pathname,N=y&&y.navigation&&y.navigation.location?y.navigation.location.pathname:null;i||(C=C.toLowerCase(),N=N?N.toLowerCase():null,_=_.toLowerCase()),N&&w&&(N=$p(N,w)||N);const A=_!=="/"&&_.endsWith("/")?_.length-1:_.length;let O=C===_||!s&&C.startsWith(_)&&C.charAt(A)==="/",j=N!=null&&(N===_||!s&&N.startsWith(_)&&N.charAt(_.length)==="/"),D={isActive:O,isPending:j,isTransitioning:T},F=O?n:void 0,B;typeof a=="function"?B=a(D):B=[a,O?"active":null,j?"pending":null,T?"transitioning":null].filter(Boolean).join(" ");let $=typeof o=="function"?o(D):o;return se.createElement(gh,sx({},f,{"aria-current":F,className:B,ref:r,style:$,to:l,viewTransition:u}),typeof c=="function"?c(D):c)});var IS;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher",t.useViewTransitionState="useViewTransitionState"})(IS||(IS={}));var DE;(function(t){t.UseFetcher="useFetcher",t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(DE||(DE={}));function BI(t){let e=se.useContext(b1);return e||ni(!1),e}function zI(t,e){let{target:r,replace:n,state:i,preventScrollReset:a,relative:s,viewTransition:o}=e===void 0?{}:e,l=za(),u=Ah(),c=S1(t,{relative:s});return se.useCallback(f=>{if(PI(f,r)){f.preventDefault();let p=n!==void 0?n:ax(u)===ax(c);l(t,{replace:p,state:i,preventScrollReset:a,relative:s,viewTransition:o})}},[u,l,c,n,i,r,t,a,s,o])}function UI(t,e){e===void 0&&(e={});let r=se.useContext(RI);r==null&&ni(!1);let{basename:n}=BI(IS.useViewTransitionState),i=S1(t,{relative:e.relative});if(!r.isTransitioning)return!1;let a=$p(r.currentLocation.pathname,n)||r.currentLocation.pathname,s=$p(r.nextLocation.pathname,n)||r.nextLocation.pathname;return OS(i.pathname,s)!=null||OS(i.pathname,a)!=null}const n_="-",GI=t=>{const e=HI(t),{conflictingClassGroups:r,conflictingClassGroupModifiers:n}=t;return{getClassGroupId:s=>{const o=s.split(n_);return o[0]===""&&o.length!==1&&o.shift(),zM(o,e)||VI(s)},getConflictingClassGroupIds:(s,o)=>{const l=r[s]||[];return o&&n[s]?[...l,...n[s]]:l}}},zM=(t,e)=>{if(t.length===0)return e.classGroupId;const r=t[0],n=e.nextPart.get(r),i=n?zM(t.slice(1),n):void 0;if(i)return i;if(e.validators.length===0)return;const a=t.join(n_);return e.validators.find(({validator:s})=>s(a))?.classGroupId},IE=/^\[(.+)\]$/,VI=t=>{if(IE.test(t)){const e=IE.exec(t)[1],r=e?.substring(0,e.indexOf(":"));if(r)return"arbitrary.."+r}},HI=t=>{const{theme:e,prefix:r}=t,n={nextPart:new Map,validators:[]};return qI(Object.entries(t.classGroups),r).forEach(([a,s])=>{jS(s,n,a,e)}),n},jS=(t,e,r,n)=>{t.forEach(i=>{if(typeof i=="string"){const a=i===""?e:jE(e,i);a.classGroupId=r;return}if(typeof i=="function"){if(WI(i)){jS(i(n),e,r,n);return}e.validators.push({validator:i,classGroupId:r});return}Object.entries(i).forEach(([a,s])=>{jS(s,jE(e,a),r,n)})})},jE=(t,e)=>{let r=t;return e.split(n_).forEach(n=>{r.nextPart.has(n)||r.nextPart.set(n,{nextPart:new Map,validators:[]}),r=r.nextPart.get(n)}),r},WI=t=>t.isThemeGetter,qI=(t,e)=>e?t.map(([r,n])=>{const i=n.map(a=>typeof a=="string"?e+a:typeof a=="object"?Object.fromEntries(Object.entries(a).map(([s,o])=>[e+s,o])):a);return[r,i]}):t,$I=t=>{if(t<1)return{get:()=>{},set:()=>{}};let e=0,r=new Map,n=new Map;const i=(a,s)=>{r.set(a,s),e++,e>t&&(e=0,n=r,r=new Map)};return{get(a){let s=r.get(a);if(s!==void 0)return s;if((s=n.get(a))!==void 0)return i(a,s),s},set(a,s){r.has(a)?r.set(a,s):i(a,s)}}},UM="!",KI=t=>{const{separator:e,experimentalParseClassName:r}=t,n=e.length===1,i=e[0],a=e.length,s=o=>{const l=[];let u=0,c=0,f;for(let w=0;w<o.length;w++){let T=o[w];if(u===0){if(T===i&&(n||o.slice(w,w+a)===e)){l.push(o.slice(c,w)),c=w+a;continue}if(T==="/"){f=w;continue}}T==="["?u++:T==="]"&&u--}const p=l.length===0?o:o.substring(c),v=p.startsWith(UM),y=v?p.substring(1):p,S=f&&f>c?f-c:void 0;return{modifiers:l,hasImportantModifier:v,baseClassName:y,maybePostfixModifierPosition:S}};return r?o=>r({className:o,parseClassName:s}):s},ZI=t=>{if(t.length<=1)return t;const e=[];let r=[];return t.forEach(n=>{n[0]==="["?(e.push(...r.sort(),n),r=[]):r.push(n)}),e.push(...r.sort()),e},YI=t=>({cache:$I(t.cacheSize),parseClassName:KI(t),...GI(t)}),XI=/\s+/,QI=(t,e)=>{const{parseClassName:r,getClassGroupId:n,getConflictingClassGroupIds:i}=e,a=[],s=t.trim().split(XI);let o="";for(let l=s.length-1;l>=0;l-=1){const u=s[l],{modifiers:c,hasImportantModifier:f,baseClassName:p,maybePostfixModifierPosition:v}=r(u);let y=!!v,S=n(y?p.substring(0,v):p);if(!S){if(!y){o=u+(o.length>0?" "+o:o);continue}if(S=n(p),!S){o=u+(o.length>0?" "+o:o);continue}y=!1}const w=ZI(c).join(":"),T=f?w+UM:w,_=T+S;if(a.includes(_))continue;a.push(_);const C=i(S,y);for(let N=0;N<C.length;++N){const A=C[N];a.push(T+A)}o=u+(o.length>0?" "+o:o)}return o};function JI(){let t=0,e,r,n="";for(;t<arguments.length;)(e=arguments[t++])&&(r=GM(e))&&(n&&(n+=" "),n+=r);return n}const GM=t=>{if(typeof t=="string")return t;let e,r="";for(let n=0;n<t.length;n++)t[n]&&(e=GM(t[n]))&&(r&&(r+=" "),r+=e);return r};function ej(t,...e){let r,n,i,a=s;function s(l){const u=e.reduce((c,f)=>f(c),t());return r=YI(u),n=r.cache.get,i=r.cache.set,a=o,o(l)}function o(l){const u=n(l);if(u)return u;const c=QI(l,r);return i(l,c),c}return function(){return a(JI.apply(null,arguments))}}const En=t=>{const e=r=>r[t]||[];return e.isThemeGetter=!0,e},VM=/^\[(?:([a-z-]+):)?(.+)\]$/i,tj=/^\d+\/\d+$/,rj=new Set(["px","full","screen"]),nj=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,ij=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,aj=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,sj=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,oj=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,rc=t=>Bp(t)||rj.has(t)||tj.test(t),gd=t=>dm(t,"length",mj),Bp=t=>!!t&&!Number.isNaN(Number(t)),Vb=t=>dm(t,"number",Bp),Gm=t=>!!t&&Number.isInteger(Number(t)),lj=t=>t.endsWith("%")&&Bp(t.slice(0,-1)),pr=t=>VM.test(t),vd=t=>nj.test(t),uj=new Set(["length","size","percentage"]),cj=t=>dm(t,uj,HM),dj=t=>dm(t,"position",HM),fj=new Set(["image","url"]),hj=t=>dm(t,fj,vj),pj=t=>dm(t,"",gj),Vm=()=>!0,dm=(t,e,r)=>{const n=VM.exec(t);return n?n[1]?typeof e=="string"?n[1]===e:e.has(n[1]):r(n[2]):!1},mj=t=>ij.test(t)&&!aj.test(t),HM=()=>!1,gj=t=>sj.test(t),vj=t=>oj.test(t),yj=()=>{const t=En("colors"),e=En("spacing"),r=En("blur"),n=En("brightness"),i=En("borderColor"),a=En("borderRadius"),s=En("borderSpacing"),o=En("borderWidth"),l=En("contrast"),u=En("grayscale"),c=En("hueRotate"),f=En("invert"),p=En("gap"),v=En("gradientColorStops"),y=En("gradientColorStopPositions"),S=En("inset"),w=En("margin"),T=En("opacity"),_=En("padding"),C=En("saturate"),N=En("scale"),A=En("sepia"),O=En("skew"),j=En("space"),D=En("translate"),F=()=>["auto","contain","none"],B=()=>["auto","hidden","clip","visible","scroll"],$=()=>["auto",pr,e],Z=()=>[pr,e],I=()=>["",rc,gd],q=()=>["auto",Bp,pr],U=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],W=()=>["solid","dashed","dotted","double","none"],Y=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],Q=()=>["start","end","center","between","around","evenly","stretch"],ne=()=>["","0",pr],re=()=>["auto","avoid","all","avoid-page","page","left","right","column"],H=()=>[Bp,pr];return{cacheSize:500,separator:":",theme:{colors:[Vm],spacing:[rc,gd],blur:["none","",vd,pr],brightness:H(),borderColor:[t],borderRadius:["none","","full",vd,pr],borderSpacing:Z(),borderWidth:I(),contrast:H(),grayscale:ne(),hueRotate:H(),invert:ne(),gap:Z(),gradientColorStops:[t],gradientColorStopPositions:[lj,gd],inset:$(),margin:$(),opacity:H(),padding:Z(),saturate:H(),scale:H(),sepia:ne(),skew:H(),space:Z(),translate:Z()},classGroups:{aspect:[{aspect:["auto","square","video",pr]}],container:["container"],columns:[{columns:[vd]}],"break-after":[{"break-after":re()}],"break-before":[{"break-before":re()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...U(),pr]}],overflow:[{overflow:B()}],"overflow-x":[{"overflow-x":B()}],"overflow-y":[{"overflow-y":B()}],overscroll:[{overscroll:F()}],"overscroll-x":[{"overscroll-x":F()}],"overscroll-y":[{"overscroll-y":F()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[S]}],"inset-x":[{"inset-x":[S]}],"inset-y":[{"inset-y":[S]}],start:[{start:[S]}],end:[{end:[S]}],top:[{top:[S]}],right:[{right:[S]}],bottom:[{bottom:[S]}],left:[{left:[S]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",Gm,pr]}],basis:[{basis:$()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",pr]}],grow:[{grow:ne()}],shrink:[{shrink:ne()}],order:[{order:["first","last","none",Gm,pr]}],"grid-cols":[{"grid-cols":[Vm]}],"col-start-end":[{col:["auto",{span:["full",Gm,pr]},pr]}],"col-start":[{"col-start":q()}],"col-end":[{"col-end":q()}],"grid-rows":[{"grid-rows":[Vm]}],"row-start-end":[{row:["auto",{span:[Gm,pr]},pr]}],"row-start":[{"row-start":q()}],"row-end":[{"row-end":q()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",pr]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",pr]}],gap:[{gap:[p]}],"gap-x":[{"gap-x":[p]}],"gap-y":[{"gap-y":[p]}],"justify-content":[{justify:["normal",...Q()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...Q(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...Q(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[_]}],px:[{px:[_]}],py:[{py:[_]}],ps:[{ps:[_]}],pe:[{pe:[_]}],pt:[{pt:[_]}],pr:[{pr:[_]}],pb:[{pb:[_]}],pl:[{pl:[_]}],m:[{m:[w]}],mx:[{mx:[w]}],my:[{my:[w]}],ms:[{ms:[w]}],me:[{me:[w]}],mt:[{mt:[w]}],mr:[{mr:[w]}],mb:[{mb:[w]}],ml:[{ml:[w]}],"space-x":[{"space-x":[j]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[j]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",pr,e]}],"min-w":[{"min-w":[pr,e,"min","max","fit"]}],"max-w":[{"max-w":[pr,e,"none","full","min","max","fit","prose",{screen:[vd]},vd]}],h:[{h:[pr,e,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[pr,e,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[pr,e,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[pr,e,"auto","min","max","fit"]}],"font-size":[{text:["base",vd,gd]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",Vb]}],"font-family":[{font:[Vm]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",pr]}],"line-clamp":[{"line-clamp":["none",Bp,Vb]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",rc,pr]}],"list-image":[{"list-image":["none",pr]}],"list-style-type":[{list:["none","disc","decimal",pr]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[t]}],"placeholder-opacity":[{"placeholder-opacity":[T]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[t]}],"text-opacity":[{"text-opacity":[T]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...W(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",rc,gd]}],"underline-offset":[{"underline-offset":["auto",rc,pr]}],"text-decoration-color":[{decoration:[t]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:Z()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",pr]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",pr]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[T]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...U(),dj]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",cj]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},hj]}],"bg-color":[{bg:[t]}],"gradient-from-pos":[{from:[y]}],"gradient-via-pos":[{via:[y]}],"gradient-to-pos":[{to:[y]}],"gradient-from":[{from:[v]}],"gradient-via":[{via:[v]}],"gradient-to":[{to:[v]}],rounded:[{rounded:[a]}],"rounded-s":[{"rounded-s":[a]}],"rounded-e":[{"rounded-e":[a]}],"rounded-t":[{"rounded-t":[a]}],"rounded-r":[{"rounded-r":[a]}],"rounded-b":[{"rounded-b":[a]}],"rounded-l":[{"rounded-l":[a]}],"rounded-ss":[{"rounded-ss":[a]}],"rounded-se":[{"rounded-se":[a]}],"rounded-ee":[{"rounded-ee":[a]}],"rounded-es":[{"rounded-es":[a]}],"rounded-tl":[{"rounded-tl":[a]}],"rounded-tr":[{"rounded-tr":[a]}],"rounded-br":[{"rounded-br":[a]}],"rounded-bl":[{"rounded-bl":[a]}],"border-w":[{border:[o]}],"border-w-x":[{"border-x":[o]}],"border-w-y":[{"border-y":[o]}],"border-w-s":[{"border-s":[o]}],"border-w-e":[{"border-e":[o]}],"border-w-t":[{"border-t":[o]}],"border-w-r":[{"border-r":[o]}],"border-w-b":[{"border-b":[o]}],"border-w-l":[{"border-l":[o]}],"border-opacity":[{"border-opacity":[T]}],"border-style":[{border:[...W(),"hidden"]}],"divide-x":[{"divide-x":[o]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[o]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[T]}],"divide-style":[{divide:W()}],"border-color":[{border:[i]}],"border-color-x":[{"border-x":[i]}],"border-color-y":[{"border-y":[i]}],"border-color-s":[{"border-s":[i]}],"border-color-e":[{"border-e":[i]}],"border-color-t":[{"border-t":[i]}],"border-color-r":[{"border-r":[i]}],"border-color-b":[{"border-b":[i]}],"border-color-l":[{"border-l":[i]}],"divide-color":[{divide:[i]}],"outline-style":[{outline:["",...W()]}],"outline-offset":[{"outline-offset":[rc,pr]}],"outline-w":[{outline:[rc,gd]}],"outline-color":[{outline:[t]}],"ring-w":[{ring:I()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[t]}],"ring-opacity":[{"ring-opacity":[T]}],"ring-offset-w":[{"ring-offset":[rc,gd]}],"ring-offset-color":[{"ring-offset":[t]}],shadow:[{shadow:["","inner","none",vd,pj]}],"shadow-color":[{shadow:[Vm]}],opacity:[{opacity:[T]}],"mix-blend":[{"mix-blend":[...Y(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":Y()}],filter:[{filter:["","none"]}],blur:[{blur:[r]}],brightness:[{brightness:[n]}],contrast:[{contrast:[l]}],"drop-shadow":[{"drop-shadow":["","none",vd,pr]}],grayscale:[{grayscale:[u]}],"hue-rotate":[{"hue-rotate":[c]}],invert:[{invert:[f]}],saturate:[{saturate:[C]}],sepia:[{sepia:[A]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[r]}],"backdrop-brightness":[{"backdrop-brightness":[n]}],"backdrop-contrast":[{"backdrop-contrast":[l]}],"backdrop-grayscale":[{"backdrop-grayscale":[u]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[c]}],"backdrop-invert":[{"backdrop-invert":[f]}],"backdrop-opacity":[{"backdrop-opacity":[T]}],"backdrop-saturate":[{"backdrop-saturate":[C]}],"backdrop-sepia":[{"backdrop-sepia":[A]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[s]}],"border-spacing-x":[{"border-spacing-x":[s]}],"border-spacing-y":[{"border-spacing-y":[s]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",pr]}],duration:[{duration:H()}],ease:[{ease:["linear","in","out","in-out",pr]}],delay:[{delay:H()}],animate:[{animate:["none","spin","ping","pulse","bounce",pr]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[N]}],"scale-x":[{"scale-x":[N]}],"scale-y":[{"scale-y":[N]}],rotate:[{rotate:[Gm,pr]}],"translate-x":[{"translate-x":[D]}],"translate-y":[{"translate-y":[D]}],"skew-x":[{"skew-x":[O]}],"skew-y":[{"skew-y":[O]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",pr]}],accent:[{accent:["auto",t]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",pr]}],"caret-color":[{caret:[t]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":Z()}],"scroll-mx":[{"scroll-mx":Z()}],"scroll-my":[{"scroll-my":Z()}],"scroll-ms":[{"scroll-ms":Z()}],"scroll-me":[{"scroll-me":Z()}],"scroll-mt":[{"scroll-mt":Z()}],"scroll-mr":[{"scroll-mr":Z()}],"scroll-mb":[{"scroll-mb":Z()}],"scroll-ml":[{"scroll-ml":Z()}],"scroll-p":[{"scroll-p":Z()}],"scroll-px":[{"scroll-px":Z()}],"scroll-py":[{"scroll-py":Z()}],"scroll-ps":[{"scroll-ps":Z()}],"scroll-pe":[{"scroll-pe":Z()}],"scroll-pt":[{"scroll-pt":Z()}],"scroll-pr":[{"scroll-pr":Z()}],"scroll-pb":[{"scroll-pb":Z()}],"scroll-pl":[{"scroll-pl":Z()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",pr]}],fill:[{fill:[t,"none"]}],"stroke-w":[{stroke:[rc,gd,Vb]}],stroke:[{stroke:[t,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},i_=ej(yj),un=({children:t,className:e,...r})=>m.jsx("div",{className:i_("bg-glass backdrop-blur-xl border border-glass-border rounded-xl",e),...r,children:t}),ox=({url:t,name:e,alt:r="User",size:n="md",className:i})=>{const a={sm:"size-8 text-xs",md:"size-10 text-sm",lg:"size-16 text-lg",xl:"size-32 text-2xl"},s=e?e.charAt(0).toUpperCase():r?r.charAt(0).toUpperCase():"?";return m.jsx("div",{className:i_("rounded-full bg-surface-light border border-white/10 flex items-center justify-center overflow-hidden shrink-0 text-slate-400 font-bold select-none",a[n],i),children:t?m.jsx("img",{src:t,alt:e||r,className:"w-full h-full object-cover"}):m.jsx("span",{children:s})})},xj=()=>m.jsx("div",{className:"flex h-screen w-full overflow-hidden bg-background-dark relative",children:m.jsx("main",{className:"flex-1 min-w-0 relative overflow-hidden flex flex-col",children:m.jsx(r_,{})})}),bj="/api",Qe={async request(t,e={}){const r=`${bj}${t}`,i={...e.body instanceof FormData?{}:{"Content-Type":"application/json"},...e.headers},a=await fetch(r,{...e,headers:i,credentials:"include"});if(!a.ok){const s=await a.json().catch(()=>({}));throw new Error(s.error||`HTTP error! status: ${a.status}`)}return a.status===204||a.headers.get("content-length")==="0"?null:a.json()},get(t,e={}){return this.request(t,{method:"GET",headers:e})},post(t,e,r={}){return this.request(t,{method:"POST",body:e instanceof FormData?e:JSON.stringify(e),headers:r})},put(t,e,r={}){return this.request(t,{method:"PUT",body:e instanceof FormData?e:JSON.stringify(e),headers:r})},patch(t,e,r={}){return this.request(t,{method:"PATCH",body:e instanceof FormData?e:JSON.stringify(e),headers:r})},delete(t,e={}){return this.request(t,{method:"DELETE",headers:e})}},Hm={list:()=>Qe.get("/workspaces"),create:(t,e,r,n)=>Qe.post("/workspaces",{name:t,title:e,genre:r,imageUrl:n}),delete:t=>Qe.delete("/workspaces/"+t),update:(t,e)=>Qe.put("/workspaces/"+t,e),select:t=>Qe.post("/workspaces/select",{projectName:t})},wj=["FANTASA","SCI-FI","HORROR","LORE","MISTERIO","HISTRICO","CYBERPUNK","STEAMPUNK"],Sj=({isOpen:t,onClose:e,onCreate:r})=>{if(!t)return null;const[n,i]=se.useState(!1),[a,s]=se.useState({name:"",title:"",genre:"FANTASA",imageUrl:"https://images.unsplash.com/photo-1518709268805-4e9042af9f23?auto=format&fit=crop&q=80&w=800"}),o=u=>{const{name:c,value:f}=u.target;s(p=>({...p,[c]:f}))},l=u=>{u.preventDefault();let c=a.name;if(!c&&a.title&&(c=a.title.toLowerCase().replace(/[^a-z0-9]/g,"-")),!c){alert("Project ID/Name is required");return}r({...a,name:c}),e(),s({name:"",title:"",genre:"FANTASA",imageUrl:"https://images.unsplash.com/photo-1518709268805-4e9042af9f23?auto=format&fit=crop&q=80&w=800"})};return Al.createPortal(m.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[m.jsx("div",{className:"absolute inset-0 bg-black/80 backdrop-blur-sm animate-in fade-in duration-200",onClick:e}),m.jsxs("div",{className:"relative w-full max-w-2xl bg-[#0a0a0c] border border-white/10 rounded-3xl shadow-2xl overflow-hidden flex animate-in zoom-in-95 duration-200",children:[m.jsxs("div",{className:"w-1/3 bg-black relative hidden sm:block",children:[m.jsx("img",{src:a.imageUrl,onError:()=>i(!0),className:`absolute inset-0 w-full h-full object-cover opacity-60 transition-opacity duration-500 ${n?"hidden":""}`,alt:"Preview"}),m.jsxs("div",{className:"absolute inset-x-0 bottom-0 p-6 bg-gradient-to-t from-black to-transparent",children:[m.jsx("h4",{className:"text-white font-black text-xl leading-none",children:a.title||"Untitled"}),m.jsx("span",{className:"text-[10px] font-bold text-primary uppercase tracking-widest mt-2 block",children:a.genre})]})]}),m.jsxs("div",{className:"flex-1 p-8",children:[m.jsx("h2",{className:"text-2xl font-black text-white mb-6",children:"Nuevo Cuaderno"}),m.jsxs("form",{onSubmit:l,className:"space-y-5",children:[m.jsxs("div",{className:"space-y-1.5",children:[m.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-text-muted",children:"Ttulo del Proyecto"}),m.jsx("input",{type:"text",name:"title",value:a.title,onChange:o,placeholder:"e.g. Las Crnicas de Etheria",className:"w-full bg-[#13141f] border border-white/10 rounded-xl px-4 py-3 text-white text-sm focus:border-primary/50 focus:ring-1 focus:ring-primary/50 outline-none transition-all",autoFocus:!0})]}),m.jsxs("div",{className:"space-y-1.5",children:[m.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-text-muted",children:"ID de Archivo (Slug)"}),m.jsx("input",{type:"text",name:"name",value:a.name,onChange:o,placeholder:"e.g. etheria-v1",className:"w-full bg-[#13141f] border border-white/10 rounded-xl px-4 py-3 text-white font-mono text-xs focus:border-primary/50 focus:ring-1 focus:ring-primary/50 outline-none transition-all placeholder:text-white/10"}),m.jsx("p",{className:"text-[10px] text-white/20",children:"Se usar como nombre del archivo .db"})]}),m.jsxs("div",{className:"space-y-1.5",children:[m.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-text-muted",children:"Gnero"}),m.jsx("div",{className:"grid grid-cols-2 gap-2",children:wj.slice(0,4).map(u=>m.jsx("button",{type:"button",onClick:()=>s(c=>({...c,genre:u})),className:`px-3 py-2 rounded-lg text-[10px] font-bold border transition-all ${a.genre===u?"bg-primary text-white border-primary":"bg-[#13141f] border-white/10 text-text-muted hover:border-white/20"}`,children:u},u))})]}),m.jsxs("div",{className:"space-y-1.5",children:[m.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-text-muted",children:"Imagen de Portada (URL)"}),m.jsx("input",{type:"text",name:"imageUrl",value:a.imageUrl,onChange:u=>{s(c=>({...c,imageUrl:u.target.value})),i(!1)},className:"w-full bg-[#13141f] border border-white/10 rounded-xl px-4 py-3 text-white text-xs focus:border-primary/50 focus:ring-1 focus:ring-primary/50 outline-none transition-all truncate"})]}),m.jsxs("div",{className:"pt-4 flex gap-3",children:[m.jsx("button",{type:"button",onClick:e,className:"flex-1 px-4 py-3 bg-[#13141f] hover:bg-white/5 border border-white/10 rounded-xl text-xs font-bold text-text-muted transition-all",children:"Cancelar"}),m.jsxs("button",{type:"submit",className:"flex-1 px-4 py-3 bg-primary hover:bg-primary-light text-white rounded-xl text-xs font-bold transition-all shadow-lg shadow-primary/20 flex items-center justify-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"rocket_launch"}),"Crear Universo"]})]})]})]})]})]}),document.body)},kj=["FANTASA","SCI-FI","HORROR","LORE","MISTERIO","HISTRICO","CYBERPUNK","STEAMPUNK"],_j=({isOpen:t,onClose:e,onUpdate:r,project:n})=>{if(!t||!n)return null;const[i,a]=se.useState(!1),[s,o]=se.useState({name:n,title:n,genre:"FANTASA",imageUrl:"https://images.unsplash.com/photo-1518709268805-4e9042af9f23?auto=format&fit=crop&q=80&w=800"});se.useEffect(()=>{n&&o(u=>({...u,name:n,title:n}))},[n]);const l=u=>{u.preventDefault(),r(s.name,{title:s.title,genre:s.genre,imageUrl:s.imageUrl}),e()};return Al.createPortal(m.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[m.jsx("div",{className:"absolute inset-0 bg-black/80 backdrop-blur-sm animate-in fade-in duration-200",onClick:e}),m.jsxs("div",{className:"relative w-full max-w-2xl bg-[#0a0a0c] border border-white/10 rounded-3xl shadow-2xl overflow-hidden flex animate-in zoom-in-95 duration-200",children:[m.jsxs("div",{className:"w-1/3 bg-black relative hidden sm:block",children:[m.jsx("img",{src:s.imageUrl,onError:()=>a(!0),className:`absolute inset-0 w-full h-full object-cover opacity-60 transition-opacity duration-500 ${i?"hidden":""}`,alt:"Preview"}),m.jsxs("div",{className:"absolute inset-x-0 bottom-0 p-6 bg-gradient-to-t from-black to-transparent",children:[m.jsx("h4",{className:"text-white font-black text-xl leading-none",children:s.title||"Untitled"}),m.jsx("span",{className:"text-[10px] font-bold text-primary uppercase tracking-widest mt-2 block",children:s.genre})]})]}),m.jsxs("div",{className:"flex-1 p-8",children:[m.jsx("h2",{className:"text-2xl font-black text-white mb-6",children:"Editar Cuaderno"}),m.jsxs("form",{onSubmit:l,className:"space-y-5",children:[m.jsxs("div",{className:"space-y-1.5",children:[m.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-text-muted",children:"Ttulo del Proyecto"}),m.jsx("input",{type:"text",name:"title",value:s.title,onChange:u=>o(c=>({...c,title:u.target.value})),className:"w-full bg-[#13141f] border border-white/10 rounded-xl px-4 py-3 text-white text-sm focus:border-primary/50 focus:ring-1 focus:ring-primary/50 outline-none transition-all",autoFocus:!0})]}),m.jsxs("div",{className:"space-y-1.5 opacity-50",children:[m.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-text-muted",children:"ID de Archivo (Inmutable)"}),m.jsx("input",{type:"text",value:s.name,readOnly:!0,className:"w-full bg-[#0a0a0c] border border-white/5 rounded-xl px-4 py-3 text-white/50 font-mono text-xs outline-none cursor-not-allowed"})]}),m.jsxs("div",{className:"space-y-1.5",children:[m.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-text-muted",children:"Gnero"}),m.jsx("div",{className:"grid grid-cols-2 gap-2",children:kj.slice(0,4).map(u=>m.jsx("button",{type:"button",onClick:()=>o(c=>({...c,genre:u})),className:`px-3 py-2 rounded-lg text-[10px] font-bold border transition-all ${s.genre===u?"bg-primary text-white border-primary":"bg-[#13141f] border-white/10 text-text-muted hover:border-white/20"}`,children:u},u))})]}),m.jsxs("div",{className:"space-y-1.5",children:[m.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-text-muted",children:"Imagen de Portada (URL)"}),m.jsx("input",{type:"text",value:s.imageUrl,onChange:u=>{o(c=>({...c,imageUrl:u.target.value})),a(!1)},className:"w-full bg-[#13141f] border border-white/10 rounded-xl px-4 py-3 text-white text-xs focus:border-primary/50 focus:ring-1 focus:ring-primary/50 outline-none transition-all truncate"})]}),m.jsxs("div",{className:"pt-4 flex gap-3",children:[m.jsx("button",{type:"button",onClick:e,className:"flex-1 px-4 py-3 bg-[#13141f] hover:bg-white/5 border border-white/10 rounded-xl text-xs font-bold text-text-muted transition-all",children:"Cancelar"}),m.jsxs("button",{type:"submit",className:"flex-1 px-4 py-3 bg-primary hover:bg-primary-light text-white rounded-xl text-xs font-bold transition-all shadow-lg shadow-primary/20 flex items-center justify-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"save"}),"Guardar Cambios"]})]})]})]})]})]}),document.body)},mn=se.forwardRef(({children:t,variant:e="primary",size:r="md",className:n,icon:i,isLoading:a,...s},o)=>{const l="inline-flex items-center justify-center rounded-lg font-medium transition-all focus:outline-none disabled:opacity-50 disabled:cursor-not-allowed active:scale-95",u={primary:"bg-primary text-white shadow-lg shadow-primary/25 hover:bg-primary-light hover:shadow-primary/40 border border-transparent",secondary:"bg-surface-light text-slate-200 border border-white/10 hover:bg-white/5 hover:text-white hover:border-white/20",ghost:"bg-transparent text-slate-400 hover:text-white hover:bg-white/5",danger:"bg-red-500/10 text-red-500 border border-red-500/20 hover:bg-red-500/20 hover:border-red-500/50 hover:shadow-lg hover:shadow-red-500/10",outline:"bg-transparent border border-primary/50 text-primary hover:bg-primary/10"},c={xs:"px-2.5 py-1 text-xs gap-1.5",sm:"px-3 py-1.5 text-xs gap-1.5",md:"px-4 py-2 text-sm gap-2",lg:"px-6 py-3 text-base gap-3",icon:"size-9 p-0"};return m.jsxs("button",{ref:o,className:i_(l,u[e],c[r],n),disabled:a,...s,children:[a?m.jsx("span",{className:"material-symbols-outlined animate-spin text-[18px]",children:"progress_activity"}):i?m.jsx("span",{className:"material-symbols-outlined text-[18px]",children:i}):null,t]})});mn.displayName="Button";const Cj=({isOpen:t,onClose:e,onConfirm:r,title:n,message:i,confirmText:a="Confirm",cancelText:s="Cancel",isDestructive:o=!0})=>t?m.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[m.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm animate-in fade-in duration-300",onClick:e}),m.jsx("div",{className:"relative z-10 w-full max-w-md animate-in zoom-in-95 duration-300",children:m.jsxs(un,{className:"p-6 border-red-500/20 shadow-2xl shadow-black/50",children:[m.jsxs("div",{className:"flex items-start gap-4 mb-6",children:[m.jsx("div",{className:`
                            size-12 rounded-xl flex items-center justify-center shrink-0
                            ${o?"bg-red-500/10 text-red-500":"bg-primary/10 text-primary"}
                        `,children:m.jsx("span",{className:"material-symbols-outlined text-2xl",children:o?"warning":"help"})}),m.jsxs("div",{children:[m.jsx("h3",{className:"text-lg font-black text-white mb-2 leading-tight",children:n}),m.jsx("p",{className:"text-sm text-slate-400 leading-relaxed",children:i})]})]}),m.jsxs("div",{className:"flex items-center justify-end gap-3",children:[m.jsx(mn,{variant:"ghost",onClick:e,children:s}),m.jsx(mn,{variant:o?"danger":"primary",onClick:()=>{r(),e()},icon:o?"delete":"check",children:a})]})]})})]}):null,Ej=()=>{const t=za(),[e,r]=se.useState([]),[n,i]=se.useState(!0),[a,s]=se.useState(null),[o,l]=se.useState(""),[u,c]=se.useState(!1),[f,p]=se.useState(null),[v,y]=se.useState(null);se.useEffect(()=>{S()},[]);const S=async()=>{try{i(!0);const O=await Hm.list();r(O)}catch(O){console.error("Failed to load workspaces",O),s("Error al cargar cuadernos. Est el servidor encendido?")}finally{i(!1)}},w=async O=>{try{i(!0);const j=await Hm.select(O);j.success&&j.redirect&&(localStorage.setItem("user",JSON.stringify({username:"local",success:!0})),t(j.redirect))}catch(j){s(j.message||"Fallo al entrar al cuaderno"),i(!1)}},T=async O=>{try{i(!0),(await Hm.create(O.name,O.title,O.genre,O.imageUrl)).success&&await w(O.name)}catch{s("Error al crear cuaderno"),i(!1)}},_=async()=>{if(f)try{i(!0),await Hm.delete(f),await S(),p(null)}catch{s("Error al borrar el cuaderno"),i(!1)}},C=async(O,j)=>{try{i(!0),await Hm.update(O,j),await S(),y(null)}catch{s("Error al actualizar cuaderno"),i(!1)}},N=()=>{window.location.href="/api/backup/download"},A=e.filter(O=>(O.title||O.filename||"").toLowerCase().includes(o.toLowerCase()));return m.jsxs("div",{className:"h-screen w-full bg-[#0a0b14] text-white flex flex-col items-center font-sans selection:bg-indigo-500/30 overflow-hidden",children:[m.jsxs("div",{className:"w-full max-w-6xl flex-1 flex flex-col overflow-y-auto custom-scrollbar p-8",children:[m.jsxs("header",{className:"w-full mt-24 mb-12 flex flex-col lg:flex-row lg:items-end justify-between gap-8 flex-shrink-0",children:[m.jsx("div",{className:"space-y-4",children:m.jsx("div",{className:"flex items-center gap-4",children:m.jsxs("h1",{className:"text-6xl font-black tracking-tighter leading-none",children:[m.jsx("span",{className:"block text-indigo-400",children:"Mis"}),m.jsx("span",{className:"block text-white",children:"Cuadernos"})]})})}),m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsxs("button",{onClick:()=>t("/settings"),className:"flex items-center gap-2 px-5 py-3 bg-white/5 hover:bg-white/10 border border-white/10 rounded-2xl transition-all text-xs font-bold text-slate-400 hover:text-white group",title:"Configuracin Global",children:[m.jsx("span",{className:"material-symbols-outlined text-lg group-hover:rotate-90 transition-transform duration-500",children:"settings"}),m.jsx("span",{className:"hidden sm:inline",children:"Ajustes"})]}),m.jsxs("button",{onClick:N,className:"flex items-center gap-2 px-5 py-3 bg-white/5 hover:bg-white/10 border border-white/10 rounded-2xl transition-all text-xs font-bold text-slate-400 hover:text-white group",title:"Descargar copia de seguridad de todos los universos",children:[m.jsx("span",{className:"material-symbols-outlined text-lg group-hover:scale-110 transition-transform",children:"cloud_download"}),m.jsx("span",{className:"hidden sm:inline",children:"Backup Global"})]}),m.jsxs("div",{className:"relative group min-w-[300px]",children:[m.jsx("span",{className:"material-symbols-outlined absolute left-4 top-1/2 -translate-y-1/2 text-white/20 text-xl group-focus-within:text-indigo-400 transition-colors pointer-events-none",children:"search"}),m.jsx("input",{type:"text",placeholder:"Buscar...",value:o,onChange:O=>l(O.target.value),className:"w-full bg-[#13141f] border border-white/5 rounded-2xl py-3 pl-12 pr-4 text-sm text-white focus:outline-none focus:border-indigo-500/50 transition-all placeholder:text-white/10"})]})]})]}),m.jsx("section",{className:"w-full max-w-6xl",children:n?m.jsxs("div",{className:"flex flex-col items-center gap-6 py-20 opacity-20",children:[m.jsx("div",{className:"w-12 h-12 border-4 border-indigo-500 border-t-transparent rounded-full animate-spin"}),m.jsx("p",{className:"text-[10px] font-black uppercase tracking-[0.3em]",children:"Accediendo al Sector Local..."})]}):m.jsxs("div",{className:"flex flex-wrap gap-6 justify-start pb-20",children:[m.jsxs("div",{onClick:()=>c(!0),className:"group relative h-[380px] rounded-[2.5rem] border-2 border-dashed border-white/5 flex flex-col items-center justify-center gap-6 hover:bg-white/5 hover:border-indigo-500/30 transition-all cursor-pointer overflow-hidden animate-in fade-in duration-700 w-full md:w-[calc(50%-0.75rem)] lg:w-[calc(33.333%-1rem)]",children:[m.jsx("div",{className:"w-20 h-20 rounded-full bg-[#13141f] border border-white/5 flex items-center justify-center text-4xl text-white/20 group-hover:scale-110 group-hover:text-indigo-400 transition-all",children:m.jsx("span",{className:"material-symbols-outlined text-4xl",children:"add"})}),m.jsxs("div",{className:"text-center",children:[m.jsx("h3",{className:"text-xl font-black tracking-tight text-white/50 group-hover:text-white transition-colors",children:"Nuevo Cuaderno"}),m.jsx("p",{className:"text-[10px] font-bold text-white/20 uppercase tracking-widest mt-2 group-hover:text-white/40",children:"Inicia un nuevo universo"})]})]}),A.map(O=>{const j=O.imageUrl||"https://images.unsplash.com/photo-1451187580459-43490279c0fa?auto=format&fit=crop&q=80&w=800";return m.jsxs("div",{onClick:()=>w(O.filename),className:"group relative h-[380px] rounded-[2.5rem] bg-[#13141f] border border-white/5 overflow-hidden transition-all hover:-translate-y-2 hover:shadow-2xl hover:shadow-indigo-500/10 cursor-pointer animate-in fade-in slide-in-from-bottom-4 w-full md:w-[calc(50%-0.75rem)] lg:w-[calc(33.333%-1rem)]",children:[m.jsxs("div",{className:"absolute inset-x-0 top-0 h-2/3",children:[m.jsx("img",{src:j,className:"w-full h-full object-cover opacity-40 group-hover:opacity-60 transition-opacity",alt:""}),m.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-[#13141f] via-transparent to-transparent"})]}),m.jsxs("div",{className:"absolute top-6 right-6 flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity duration-300 z-20",children:[m.jsx("button",{onClick:D=>{D.stopPropagation(),y(O.filename)},className:"w-10 h-10 rounded-full bg-black/50 backdrop-blur-md border border-white/10 flex items-center justify-center text-white/70 hover:text-white hover:bg-indigo-500 hover:border-indigo-400 transition-all",title:"Editar",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"edit"})}),m.jsx("button",{onClick:D=>{D.stopPropagation(),p(O.filename)},className:"w-10 h-10 rounded-full bg-black/50 backdrop-blur-md border border-white/10 flex items-center justify-center text-white/70 hover:text-white hover:bg-red-500 hover:border-red-400 transition-all",title:"Eliminar",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})})]}),m.jsx("div",{className:"absolute inset-0 flex flex-col justify-end p-8",children:m.jsxs("div",{className:"mt-auto space-y-3",children:[m.jsx("span",{className:"inline-block px-3 py-1 bg-red-500/20 border border-red-500/30 text-[9px] font-black text-red-100 rounded-lg tracking-widest uppercase",children:O.tag}),m.jsx("h3",{className:"text-3xl font-black text-white tracking-tighter leading-tight group-hover:text-indigo-400 transition-colors",children:O.title}),O.title!==O.filename&&m.jsx("p",{className:"text-[10px] text-white/30 font-mono mb-1",children:O.filename}),m.jsx("p",{className:"text-xs text-white/40 line-clamp-2 leading-relaxed",children:"Una tierra dividida por la magia y la tecnologa antigua..."}),m.jsxs("div",{className:"flex items-center justify-between pt-6 border-t border-white/5 mt-4",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-emerald-500 shadow-[0_0_8px_rgba(16,185,129,0.5)]"}),m.jsxs("span",{className:"text-[9px] font-black uppercase tracking-widest text-white/20",children:["ltima edicin: ",m.jsx("span",{className:"text-white/40",children:O.lastModified})]})]}),m.jsx("div",{className:"w-8 h-8 rounded-full bg-white/5 border border-white/10 flex items-center justify-center text-[10px] font-black text-indigo-300",children:O.initials})]})]})})]},O.filename)})]})})]}),a&&m.jsx("div",{className:"fixed bottom-8 left-1/2 -translate-x-1/2 px-6 py-3 bg-red-500/20 border border-red-500/30 text-red-200 rounded-2xl text-xs font-bold shadow-2xl animate-bounce",children:a}),m.jsx(Sj,{isOpen:u,onClose:()=>c(!1),onCreate:T}),m.jsx(_j,{isOpen:!!v,onClose:()=>y(null),project:v,onUpdate:C}),m.jsx(Cj,{isOpen:!!f,onClose:()=>p(null),onConfirm:_,title:"Eliminar Proyecto?",message:`Ests a punto de borrar "${f}" y todo su contenido permanentemente. Esta accin no se puede deshacer.`,confirmText:"Eliminar Universo",isDestructive:!0})]})},Tj={save:"Guardar",saved:"Guardado",saving:"Guardando...",cancel:"Cancelar",delete:"Borrar",edit:"Editar",create:"Crear",back:"Volver",loading:"Cargando...",search:"Buscar...",no_results:"Sin resultados",confirm_delete:"Eliminar",are_you_sure:"Ests seguro de que quieres eliminar este elemento? Esta accin no se puede deshacer.",architect:"Arquitecto",confirm_delete_btn:"S, borrar",view_all:"Ver todos",rename:"Renombrar",error_delete:"Error al eliminar el elemento"},Nj={dashboard:"Panel de Control",bible:"Biblia del Mundo",atlas:"Atlas",writing:"Escritura",settings:"Ajustes",logout:"Salir al Hub",chronology:"Cronologa",graph:"Grafo",languages:"Lingstica"},Pj={title:"Ajustes",general:"General",appearance:"Apariencia",language:"Idioma",theme:"Tema",font:"Tipografa",font_size:"Tamao del Texto",unauthorized:"No autorizado",sync:"Sincronizacin",backup:"Respaldo",edit_template:"Editar Plantilla",available_templates:"Plantillas Disponibles",no_templates:"Sin Plantillas",is_global:"Es Global?",name:"Nombre",type:"Tipo"},Mj={title:"Escritura",library:"Biblioteca del Arquitecto",library_desc:"Gestiona tus Archivadores y Crnicas",new_notebook:"Nuevo Archivador",new_page:"Nueva Hoja",index:"ndice",notes:"Notas",format:"Formato",empty:"Pgina vaca...",active_notebook:"Archivador Activo",open_archivador:"Abrir Archivador",book_title:"Ttulo del Libro",placeholder_title:"Las Crnicas del Vaco...",create_and_open:"Crear y Abrir",expansion:"Expansin de la Biblioteca",delete_confirm:"Seguro que quieres borrar este archivador? Se perdern todas sus hojas."},Aj={grid_system:"Sistema de Rejilla",size:"Tamao",canvas_data:"Datos del Lienzo",width:"Ancho (px)",height:"Alto (px)",background_image:"Imagen de Fondo",upload_image:"Subir Nueva Imagen",remove_image:"Eliminar Imagen",explorer:"Explorador de Mundo",not_found:"Imagen del Mapa no Encontrada",upload_desc:"Sube una imagen del mapa en el editor para comenzar",fullscreen:"Pantalla Completa",share:"Compartir",inhabitants:"Habitantes Clave",related_events:"Eventos Relacionados",open_bible:"Abrir en la Biblia",place:"Lugar",capital:"Capital",new_map:"Nuevo Mapa"},Lj={explore:"Explorar",explorer:"Explorador",templates:"Plantillas",drag_attributes:"Arrastrar Atributos",search_entity:"Buscar entidad...",filter_type:"Filtrar por Tipo",all:"Todos",entities:"Entidades",maps:"Mapas",timelines:"Lneas de Tiempo",new_folder:"Nueva Carpeta",new_timeline:"Nueva Lnea de Tiempo",delete_folder:"Borrar Carpeta",delete_folder_msg:"Seguro que quieres borrar esta carpeta y todo su contenido?",delete_entity:"Borrar Entidad",delete_entity_msg:"Seguro que quieres borrar esta entidad de la Biblia?",no_favorites:"Sin favoritos an",favorites:"Favoritos",root_index:"ndice Raz",central_archive:"Archivo central de todas las entidades, cronologas y registros geogrficos del mundo.",empty_archive:"Archivo Vaco",empty_archive_desc:"Comienza creando tu primera carpeta o lnea de tiempo para organizar el conocimiento."},Rj={title:"Lnea de Tiempo",add_event:"Aadir Evento",add_line:"Nueva Lnea de Tiempo",edit_event:"Editar Evento",edit_line:"Editar Lnea de Tiempo",delete_event:"Eliminar Evento",delete_line:"Eliminar Lnea de Tiempo",events_tab:"Eventos",annexes_tab:"Anexos",linked_timelines:"Lneas de Tiempo Vinculadas",available_timelines:"Lneas de Tiempo Disponibles",multiverse:"Multiverso",new_universe:"Nuevo Universo",universe_settings:"Ajustes del Universo",delete_universe_confirm:"Eliminar este universo y TODAS sus lneas de tiempo? Esta accin no se puede deshacer.",select_timeline:"Seleccionar Lnea",no_events:"Sin eventos an. Usa el panel derecho para aadir uno.",event_name:"Nombre del Evento",date_label:"Etiqueta de Fecha",order:"Orden (Sorteo)",description:"Descripcin",save_changes:"Guardar Cambios",create_event:"Crear Evento",delete_event_btn:"Eliminar Evento",annexed_desc:"Vincula otras lneas de tiempo localizadas a esta para verificar la consistencia cronolgica.",no_linked:"Sin lneas vinculadas.",available_to_link:"Disponibles para Vincular",no_available:"No hay otras lneas disponibles.",universe_name:"Nombre del Universo",universe_desc:"Contexto para este universo...",add_timeline_here:"Aadir Lnea de Tiempo aqu",no_timelines:"No hay lneas aqu"},Oj={title:"Lingstica",lexicon:"Lxico",grammar:"Reglas de Gramtica",writing_system:"Sistema de Escritura",phonology:"Fonologa",translator:"Traductor",new_word:"Aadir Nueva Palabra",new_rule:"Definir Nueva Regla",open_editor:"Abrir Editor",auto_saved:"Auto-guardado",desc:"Una lengua perteneciente a {{projectName}}. Gestiona su lxico, reglas gramaticales y sistemas de escritura aqu.",stats:{words:"Palabras",rules:"Reglas",glyphs:"Glifos"},search_lexicon:"Buscar palabra o significado...",manage:"Gestionar",moon_script:"Escritura Lunar",inventory:"Inventario de Vocales",vectors:"Smbolos Vectoriales",upload_svg:"Subir SVG",live_stream:"Flujo Logogrfico en Vivo",rendered_output:"Salida Renderizada",source_text:"Texto de origen aqu..."},Dj={dashboard_desc:"Panel de Control del Proyecto",welcome:"Bienvenido,",welcome_desc:"Tu mundo est esperando ser esculpido. Utiliza el Codex para documentar entidades, el Atlas para trazar geografas o las Crnicas para escribir su historia.",codex_title:"Codex",codex_desc:"Biblia del Mundo y Base de Datos de Entidades",atlas_title:"Atlas",atlas_desc:"Cartografa y Geografa Interactiva",chronicles_title:"Crnicas",chronicles_desc:"Escritura Narrativa y Gestin de Cuadernos",graph_title:"Grafo",graph_desc:"Visualizacin de Conexiones y Relaciones",timeline_title:"Cronologa",timeline_desc:"Lneas de Tiempo y Eventos Histricos",linguistics_title:"Lingstica",linguistics_desc:"Creacin de Lenguas y Glifos",explore_tool:"Explorar Herramienta"},Ij={common:Tj,nav:Nj,settings:Pj,writing:Mj,atlas:Aj,bible:Lj,timeline:Rj,linguistics:Oj,project:Dj},jj={save:"Save",saved:"Saved",saving:"Saving...",cancel:"Cancel",delete:"Delete",edit:"Edit",create:"Create",back:"Back",loading:"Loading...",search:"Search...",no_results:"No results",confirm_delete:"Delete",are_you_sure:"Are you sure you want to delete this item? This action cannot be undone.",architect:"Architect",confirm_delete_btn:"Yes, delete",view_all:"View All",rename:"Rename",error_delete:"Error deleting item"},Fj={dashboard:"Dashboard",bible:"World Bible",atlas:"Atlas",writing:"Writing",settings:"Settings",logout:"Exit to Hub",chronology:"Chronology",graph:"Graph",languages:"Linguistics"},Bj={title:"Settings",general:"General",appearance:"Appearance",language:"Language",theme:"Theme",font:"Typography",font_size:"Font Size",unauthorized:"Unauthorized",sync:"Synchronization",backup:"Backup",edit_template:"Edit Template",available_templates:"Available Templates",no_templates:"No Templates",is_global:"Is Global?",name:"Name",type:"Type"},zj={title:"Writing",library:"Architect's Library",library_desc:"Manage your Archives and Chronicles",new_notebook:"New Archivador",new_page:"New Page",index:"Index",notes:"Notes",format:"Format",empty:"Empty page...",active_notebook:"Active Archivador",open_archivador:"Open Archivador",book_title:"Book Title",placeholder_title:"The Chronicles of the Void...",create_and_open:"Create and Open",expansion:"Library Expansion",delete_confirm:"Are you sure you want to delete this archivador? All its pages will be lost."},Uj={grid_system:"Grid System",size:"Size",canvas_data:"Canvas Data",width:"Width (px)",height:"Height (px)",background_image:"Background Image",upload_image:"Upload New Image",remove_image:"Remove Image",explorer:"World Explorer",not_found:"Map Image Not Found",upload_desc:"Upload a map image in the editor to get started",fullscreen:"Fullscreen",share:"Share",inhabitants:"Key Inhabitants",related_events:"Related Events",open_bible:"Open in Bible",place:"Place",capital:"Capital",new_map:"New Map"},Gj={explore:"Explore",explorer:"Explorer",templates:"Templates",drag_attributes:"Drag Attributes",search_entity:"Search entity...",filter_type:"Filter by Type",all:"All",entities:"Entities",maps:"Maps",timelines:"Timelines",new_folder:"New Folder",new_timeline:"New Timeline",delete_folder:"Delete Folder",delete_folder_msg:"Are you sure you want to delete this folder and all its contents?",delete_entity:"Delete Entity",delete_entity_msg:"Are you sure you want to delete this entity from the Bible?",no_favorites:"No favorites yet",favorites:"Favorites",root_index:"Root Index",central_archive:"Central archive of all entities, timelines, and world geographical records.",empty_archive:"Empty Archive",empty_archive_desc:"Start by creating your first folder or timeline to organize knowledge."},Vj={title:"Timeline",add_event:"Add Event",add_line:"New Timeline",edit_event:"Edit Event",edit_line:"Edit Timeline",delete_event:"Delete Event",delete_line:"Delete Timeline",events_tab:"Events",annexes_tab:"Annexes",linked_timelines:"Linked Timelines",available_timelines:"Available Timelines",multiverse:"Multiverse",new_universe:"New Universe",universe_settings:"Universe Settings",delete_universe_confirm:"Delete this universe and ALL its timelines? This cannot be undone.",select_timeline:"Select Timeline",no_events:"No events yet. Use the right panel to add one.",event_name:"Event Name",date_label:"Date Label",order:"Order (Sort)",description:"Description",save_changes:"Save Changes",create_event:"Create Event",delete_event_btn:"Delete Event",annexed_desc:"Link other localized timelines to this one to verify chronological consistency.",no_linked:"No linked timelines.",available_to_link:"Available to Link",no_available:"No other timelines available.",universe_name:"Universe Name",universe_desc:"Context for this universe...",add_timeline_here:"Add Timeline here",no_timelines:"No timelines here"},Hj={title:"Linguistics",lexicon:"Lexicon",grammar:"Grammar Rules",writing_system:"Writing System",phonology:"Phonology",translator:"Translator",new_word:"Add New Word",new_rule:"Define New Rule",open_editor:"Open Editor",auto_saved:"Auto-Saved",desc:"A conlang belonging to {{projectName}}. Manage its lexicon, grammar rules, and writing systems here.",stats:{words:"Words",rules:"Rules",glyphs:"Glyphs"},search_lexicon:"Search word or meaning...",manage:"Manage",moon_script:"Moon Script",inventory:"Vowel Inventory",vectors:"Vector Symbols",upload_svg:"Upload SVG",live_stream:"Live Logographic Stream",rendered_output:"Rendered Output",source_text:"Source text here..."},Wj={dashboard_desc:"Project Dashboard",welcome:"Welcome,",welcome_desc:"Your world is waiting to be shaped. Use the Codex to document entities, the Atlas to map out geographies, or the Chronicles to write its history.",codex_title:"Codex",codex_desc:"World Bible and Entity Database",atlas_title:"Atlas",atlas_desc:"Interactive Cartography and Geography",chronicles_title:"Chronicles",chronicles_desc:"Narrative Writing and Notebook Management",graph_title:"Graph",graph_desc:"Visualization of Connections and Relations",timeline_title:"Chronology",timeline_desc:"Timelines and Historical Events",linguistics_title:"Linguistics",linguistics_desc:"Conlang Creation and Glyphs",explore_tool:"Explore Tool"},qj={common:jj,nav:Fj,settings:Bj,writing:zj,atlas:Uj,bible:Gj,timeline:Vj,linguistics:Hj,project:Wj},WM=se.createContext(),$j={es:Ij,en:qj},Kj=({children:t})=>{const[e,r]=se.useState(()=>{const a=localStorage.getItem("app_settings");if(a)try{return JSON.parse(a).language||"es"}catch{return"es"}return"es"}),n=a=>{const s=a.split(".");let o=$j[e];for(const l of s)if(o&&o[l])o=o[l];else return a;return o},i=a=>{r(a);const s=localStorage.getItem("app_settings");let o={};if(s)try{o=JSON.parse(s)}catch{}localStorage.setItem("app_settings",JSON.stringify({...o,language:a}))};return m.jsx(WM.Provider,{value:{language:e,t:n,changeLanguage:i},children:t})},Sc=()=>{const t=se.useContext(WM);if(!t)throw new Error("useLanguage must be used within a LanguageProvider");return t},pp=({icon:t,title:e,desc:r,color:n,onClick:i,t:a})=>m.jsxs("div",{onClick:i,className:"group relative p-8 rounded-[32px] bg-surface-dark border border-white/5 hover:border-white/10 transition-all cursor-pointer flex flex-col h-full gap-6 hover:shadow-2xl hover:shadow-black/40",children:[m.jsx("div",{className:`size-14 rounded-2xl ${n} flex items-center justify-center text-white shadow-lg group-hover:scale-110 transition-all duration-500`,children:m.jsx("span",{className:"material-symbols-outlined text-3xl",children:t})}),m.jsxs("div",{className:"space-y-4",children:[m.jsx("h3",{className:"text-2xl font-bold text-white tracking-tight",children:e}),m.jsx("p",{className:"text-slate-500 text-sm leading-relaxed",children:r})]}),m.jsxs("div",{className:"mt-auto pt-6 border-t border-white/5 flex items-center justify-between text-[10px] font-black uppercase tracking-widest text-slate-500 group-hover:text-white transition-colors",children:[m.jsx("span",{children:a("project.explore_tool")}),m.jsx("span",{className:"material-symbols-outlined text-sm group-hover:translate-x-1 transition-transform",children:"arrow_forward"})]})]}),Zj=()=>{const{projectName:t}=Ll(),e=za(),{username:r}=Vi(),{t:n}=Sc(),i=`/${r}/${t}`,[a,s]=sr.useState(null);return sr.useEffect(()=>{const o=localStorage.getItem("user");o&&o!=="undefined"&&s(JSON.parse(o))},[]),m.jsxs("div",{className:"flex-1 flex flex-col h-screen overflow-hidden bg-background-dark",children:[m.jsxs("div",{className:"h-20 border-b border-white/5 flex items-center justify-between px-12 bg-surface-dark/20 backdrop-blur-xl shrink-0",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("div",{className:"size-10 rounded-xl bg-primary/20 flex items-center justify-center text-primary shadow-lg shadow-primary/10",children:m.jsx("span",{className:"material-symbols-outlined",children:"auto_stories"})}),m.jsxs("div",{children:[m.jsx("h1",{className:"text-xl font-black text-white tracking-tight uppercase",children:t}),m.jsx("p",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:n("project.dashboard_desc")})]})]}),m.jsx("div",{className:"flex items-center gap-4",children:m.jsx("div",{className:"flex -space-x-2",children:m.jsx("div",{className:"size-8 rounded-full border-2 border-surface-dark bg-indigo-500 overflow-hidden flex items-center justify-center text-[10px] font-black text-white shadow-lg",children:a?.avatarUrl?m.jsx("img",{src:a.avatarUrl,alt:"Me",className:"w-full h-full object-cover"}):m.jsx("span",{children:(a?.displayName||r)?.substring(0,2).toUpperCase()})})})})]}),m.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar",children:m.jsxs("div",{className:"max-w-7xl mx-auto p-12 space-y-16 animate-in fade-in slide-in-from-bottom-8 duration-700",children:[m.jsxs("div",{className:"space-y-4 max-w-2xl",children:[m.jsxs("h2",{className:"text-4xl font-black text-white tracking-tighter leading-tight",children:[n("project.welcome")," ",m.jsx("span",{className:"text-indigo-400",children:a?.displayName||n("common.architect")}),"."]}),m.jsx("p",{className:"text-slate-400 text-lg font-serif italic leading-relaxed opacity-80",children:n("project.welcome_desc")})]}),m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:[m.jsx(pp,{icon:"menu_book",title:n("project.codex_title"),desc:n("project.codex_desc"),color:"bg-indigo-600 shadow-indigo-500/20",onClick:()=>e(`${i}/bible`),t:n}),m.jsx(pp,{icon:"map",title:n("project.atlas_title"),desc:n("project.atlas_desc"),color:"bg-emerald-600 shadow-emerald-500/20",onClick:()=>e(`${i}/map`),t:n}),m.jsx(pp,{icon:"edit_note",title:n("project.chronicles_title"),desc:n("project.chronicles_desc"),color:"bg-amber-600 shadow-amber-500/20",onClick:()=>e(`${i}/writing`),t:n}),m.jsx(pp,{icon:"hub",title:n("project.graph_title"),desc:n("project.graph_desc"),color:"bg-purple-600 shadow-purple-500/20",onClick:()=>e(`${i}/graph`),t:n}),m.jsx(pp,{icon:"calendar_month",title:n("project.timeline_title"),desc:n("project.timeline_desc"),color:"bg-rose-600 shadow-rose-500/20",onClick:()=>e(`${i}/timeline`),t:n}),m.jsx(pp,{icon:"translate",title:n("project.linguistics_title"),desc:n("project.linguistics_desc"),color:"bg-blue-600 shadow-blue-500/20",onClick:()=>e(`${i}/linguistics`),t:n})]})]})})]})},Yj=()=>{const t=za(),[e,r]=se.useState(null),[n,i]=se.useState([]),[a,s]=se.useState([]),[o,l]=se.useState("general"),[u,c]=se.useState([]),[f,p]=se.useState({theme:"deep_space",font:"Outfit",fontSize:16});se.useEffect(()=>{try{const D=localStorage.getItem("user");D&&D!=="undefined"&&r(JSON.parse(D));const F=localStorage.getItem("app_settings");F&&p(JSON.parse(F));const B=localStorage.getItem("sync_projects");B&&s(JSON.parse(B)),v()}catch(D){console.error("Failed to parse user settings",D)}},[]);const v=async()=>{try{const D=await Qe.get("/workspaces");D&&i(D)}catch(D){console.error("Error loading projects for sync",D)}},y=(D,F="success")=>{const B=Date.now();c($=>[...$,{id:B,message:D,type:F}]),setTimeout(()=>{c($=>$.filter(Z=>Z.id!==B))},3e3)},S=(D,F)=>{const B={...f,[D]:F};p(B),localStorage.setItem("app_settings",JSON.stringify(B)),window.dispatchEvent(new Event("storage_update")),y(`Ajuste actualizado: ${D}`)},w=D=>{const F=a.includes(D),B=F?a.filter($=>$!==D):[...a,D];s(B),localStorage.setItem("sync_projects",JSON.stringify(B)),y(F?"Universo desmarcado de sincronizacin":"Universo incluido en sincronizacin")},T=()=>{y("Iniciando descarga de backup...","info");const D=document.createElement("a"),F="/api/backup/download",B=a.length>0?`?projects=${a.join(",")}`:"";D.href=F+B,D.setAttribute("download",`worldbuilding_backup_${Date.now()}.zip`),document.body.appendChild(D),D.click(),document.body.removeChild(D)},_=sr.useRef(null),C=async D=>{const F=D.target.files[0];if(!F)return;if(!F.name.endsWith(".db")){y("Solo se permiten archivos .db","error");return}const B=new FormData;B.append("file",F),y("Importando universo...","info");try{const $=await Qe.post("/import/database",B);y($.message||"Universo importado con xito"),v()}catch($){console.error("Import error",$);const Z=$.response?.data?.error||"Error al importar el archivo";y(Z,"error")}_.current&&(_.current.value="")},N=D=>{const F=D.target.files[0];if(!F)return;if(F.size>1024*1024){y("Imagen demasiado grande (mx 1MB)","error");return}const B=new FileReader;B.onload=$=>{const Z=$.target.result,I={...e||{},avatarUrl:Z};r(I);try{localStorage.setItem("user",JSON.stringify(I)),y("Foto de perfil actualizada","success")}catch(q){y("Error al guardar imagen (memoria llena)","error"),console.error("Storage error",q)}},B.readAsDataURL(F)},A=(D,F)=>{const B={...e||{},[D]:F};r(B),localStorage.setItem("user",JSON.stringify(B)),window.dispatchEvent(new Event("storage_update"))},O=[{id:"general",label:"General / Sincro",icon:"person"},{id:"appearance",label:"Apariencia y Editor",icon:"palette"}],j=[{id:"deep_space",label:"Deep Space",color:"#0f172a"},{id:"nebula",label:"Nebula",color:"#312e81"},{id:"high_contrast",label:"High Contrast",color:"#000000"}];return m.jsxs("div",{className:"flex flex-col w-full h-full bg-[#050508] text-white font-sans overflow-hidden relative",children:[m.jsxs("div",{className:"absolute inset-0 pointer-events-none overflow-hidden opacity-50",children:[m.jsx("div",{className:"absolute -top-[10%] -left-[10%] size-[40%] bg-indigo-500/10 blur-[120px] rounded-full animate-pulse"}),m.jsx("div",{className:"absolute -bottom-[10%] -right-[10%] size-[40%] bg-purple-500/5 blur-[120px] rounded-full animate-pulse",style:{animationDelay:"1s"}})]}),m.jsx("div",{className:"fixed top-24 right-8 z-[100] flex flex-col gap-3",children:u.map(D=>m.jsxs("div",{className:"flex items-center gap-3 px-6 py-4 bg-surface-dark border border-white/10 rounded-2xl shadow-2xl animate-slide-in-right",children:[m.jsx("span",{className:`material-symbols-outlined ${D.type==="success"?"text-green-400":"text-indigo-400"}`,children:D.type==="success"?"check_circle":"info"}),m.jsx("span",{className:"text-sm font-bold",children:D.message})]},D.id))}),m.jsxs("header",{className:"h-20 flex-none flex items-center justify-between px-12 border-b border-white/5 bg-[#0a0a0e] z-30",children:[m.jsxs("div",{className:"flex items-center gap-8",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("div",{className:"size-10 rounded-xl bg-indigo-500 flex items-center justify-center text-white shadow-lg shadow-indigo-500/20",children:m.jsx("span",{className:"material-symbols-outlined text-2xl",children:"settings"})}),m.jsx("h1",{className:"text-xl font-bold tracking-tight hidden sm:block",children:"Ajustes"})]}),m.jsx("nav",{className:"flex items-center gap-2 p-1 bg-white/5 rounded-2xl",children:O.map(D=>m.jsxs("button",{onClick:()=>l(D.id),className:`flex items-center gap-2 px-5 py-2.5 rounded-xl text-xs font-bold transition-all ${o===D.id?"bg-indigo-500 text-white shadow-lg shadow-indigo-500/20":"text-slate-400 hover:text-white hover:bg-white/5"}`,children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:D.icon}),D.label]},D.id))})]}),m.jsxs("button",{onClick:()=>t(-1),className:"flex items-center gap-2 px-6 py-2.5 bg-white/5 hover:bg-white/10 border border-white/10 rounded-2xl transition-all text-xs font-bold text-slate-400 hover:text-white",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"arrow_back"}),m.jsx("span",{children:"Volver"})]})]}),m.jsx("main",{className:"flex-1 overflow-y-auto p-12 custom-scrollbar",children:m.jsxs("div",{className:"max-w-3xl mx-auto pb-24 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[o==="general"&&m.jsxs("div",{className:"space-y-6",children:[m.jsxs("section",{className:"bg-[#0f0f13] border border-white/5 rounded-3xl p-8",children:[m.jsxs("h3",{className:"text-lg font-bold mb-6 flex items-center gap-2 text-indigo-400",children:[m.jsx("span",{className:"material-symbols-outlined",children:"person"}),"Perfil de Arquitecto"]}),m.jsxs("div",{className:"flex items-center gap-6 p-6 bg-white/5 rounded-3xl border border-white/5 group relative overflow-hidden",children:[m.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-indigo-500/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none"}),m.jsxs("div",{className:"relative",children:[m.jsx("div",{className:"size-20 rounded-full bg-indigo-500 flex items-center justify-center text-white text-3xl font-black shadow-2xl border-4 border-white/10 overflow-hidden",children:e?.avatarUrl?m.jsx("img",{src:e.avatarUrl,alt:"Profile",className:"w-full h-full object-cover"}):e?.displayName?.substring(0,2).toUpperCase()||e?.username?.substring(0,2).toUpperCase()||"AR"}),m.jsxs("label",{className:"absolute -bottom-1 -right-1 size-8 bg-indigo-500 rounded-full flex items-center justify-center text-white cursor-pointer hover:scale-110 transition-all border-4 border-[#0f0f13] shadow-lg",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"photo_camera"}),m.jsx("input",{type:"file",accept:"image/*",onChange:N,className:"hidden"})]})]}),m.jsxs("div",{className:"flex-1 space-y-2",children:[m.jsx("input",{type:"text",value:e?.displayName??"",onChange:D=>A("displayName",D.target.value),placeholder:e?.username||"Tu nombre de arquitecto...",className:"bg-transparent border-none text-2xl font-black text-white outline-none focus:ring-0 w-full p-0 placeholder-white/20"}),m.jsx("p",{className:"text-[10px] font-black uppercase tracking-widest text-indigo-400",children:"Architect Rank  Local Session"})]})]})]}),m.jsxs("section",{className:"bg-[#0f0f13] border border-white/5 rounded-3xl p-8 space-y-6",children:[m.jsxs("div",{className:"flex justify-between items-center",children:[m.jsxs("h3",{className:"text-lg font-bold flex items-center gap-2 text-indigo-400",children:[m.jsx("span",{className:"material-symbols-outlined",children:"sync_lock"}),"Sincronizacin y Respaldo"]}),m.jsxs("div",{className:"flex gap-3",children:[m.jsx("input",{type:"file",ref:_,onChange:C,accept:".db",className:"hidden"}),m.jsxs("button",{onClick:()=>_.current?.click(),className:"flex items-center gap-2 px-6 py-3 border border-white/5 bg-white/5 hover:bg-white/10 text-white rounded-2xl text-xs font-black uppercase tracking-widest transition-all",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"upload_file"}),"Importar Universo"]}),m.jsxs("button",{onClick:T,className:"flex items-center gap-2 px-6 py-3 bg-indigo-500 hover:bg-indigo-600 text-white rounded-2xl text-xs font-black uppercase tracking-widest transition-all shadow-lg shadow-indigo-500/30",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"cloud_download"}),"Descargar Backup ZIP"]})]})]}),m.jsxs("div",{className:"space-y-4",children:[m.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-slate-500 block",children:"Universos para sincronizacin"}),m.jsx("div",{className:"grid grid-cols-2 gap-3",children:n.length>0?n.map(D=>m.jsxs("button",{onClick:()=>w(D.filename),className:`flex items-center gap-3 p-4 rounded-2xl border transition-all text-left ${a.includes(D.filename)?"border-indigo-500 bg-indigo-500/10 text-white":"border-white/5 bg-black/20 text-slate-400 hover:border-white/10"}`,children:[m.jsx("span",{className:"material-symbols-outlined text-lg",children:a.includes(D.filename)?"check_circle":"circle"}),m.jsx("div",{className:"truncate",children:m.jsx("p",{className:"text-xs font-bold truncate",children:D.title})})]},D.filename)):m.jsx("div",{className:"col-span-2 p-8 border border-dashed border-white/5 rounded-2xl text-center text-slate-600 text-xs italic text-glass-muted",children:"No hay universos detectados..."})})]})]})]}),o==="appearance"&&m.jsxs("div",{className:"space-y-6",children:[m.jsxs("section",{className:"bg-[#0f0f13] border border-white/5 rounded-3xl p-8",children:[m.jsxs("h3",{className:"text-lg font-bold mb-6 flex items-center gap-2 text-indigo-400",children:[m.jsx("span",{className:"material-symbols-outlined",children:"palette"}),"Esttica del Sistema"]}),m.jsx("div",{className:"grid grid-cols-3 gap-6",children:j.map(D=>m.jsxs("button",{onClick:()=>S("theme",D.id),className:`relative flex flex-col gap-3 group text-left transition-all p-3 rounded-2xl border ${f.theme===D.id?"border-indigo-500 bg-indigo-500/5 ring-1 ring-indigo-500/50":"border-white/5 bg-black/20 hover:border-white/20"}`,children:[m.jsx("div",{className:"h-24 rounded-xl flex items-center justify-center overflow-hidden",style:{backgroundColor:D.color},children:m.jsx("div",{className:"size-10 rounded-full bg-white/10 backdrop-blur-xl border border-white/10"})}),m.jsx("span",{className:"text-xs font-bold text-center",children:D.label})]},D.id))})]}),m.jsxs("section",{className:"bg-[#0f0f13] border border-white/5 rounded-3xl p-8",children:[m.jsxs("h3",{className:"text-lg font-bold mb-6 flex items-center gap-2 text-indigo-400",children:[m.jsx("span",{className:"material-symbols-outlined",children:"text_fields"}),"Tipografa y Lectura"]}),m.jsxs("div",{className:"grid grid-cols-2 gap-12",children:[m.jsxs("div",{className:"space-y-4",children:[m.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-slate-500",children:"Fuente del Codex"}),m.jsxs("div",{className:"relative",children:[m.jsxs("select",{value:f.font,onChange:D=>S("font",D.target.value),className:"w-full bg-black/40 border border-white/10 rounded-xl px-5 py-3.5 text-sm text-white appearance-none outline-none focus:border-indigo-500 transition-all",style:{fontFamily:f.font},children:[m.jsx("option",{value:"Lexend",children:"Lexend (UI Moderna)"}),m.jsx("option",{value:"Outfit",children:"Outfit (Sleek)"}),m.jsx("option",{value:"Cormorant Garamond",children:"Cormorant (Legendaria)"}),m.jsx("option",{value:"Playfair Display",children:"Playfair (Elegante)"}),m.jsx("option",{value:"JetBrains Mono",children:"JetBrains Mono (Codex)"})]}),m.jsx("span",{className:"material-symbols-outlined absolute right-4 top-1/2 -translate-y-1/2 pointer-events-none text-slate-500",children:"expand_more"})]})]}),m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{className:"flex justify-between items-center",children:[m.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-slate-500",children:"Tamao del Texto"}),m.jsxs("span",{className:"text-xs font-bold text-indigo-400",children:[f.fontSize,"px"]})]}),m.jsx("div",{className:"flex items-center gap-4 py-3",children:m.jsx("input",{type:"range",min:"12",max:"24",value:f.fontSize,onChange:D=>S("fontSize",parseInt(D.target.value)),className:"flex-1 accent-indigo-500 h-1 bg-white/10 rounded-full appearance-none cursor-pointer"})})]})]}),m.jsxs("div",{className:"mt-12 space-y-4 border-t border-white/5 pt-8",children:[m.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-slate-500",children:"Preferencia de Idioma / Language"}),m.jsxs("div",{className:"flex gap-4",children:[m.jsxs("button",{onClick:()=>S("language","es"),className:`flex-1 py-4 rounded-2xl border transition-all flex items-center justify-center gap-3 font-bold text-xs ${f.language==="es"||!f.language?"border-primary bg-primary/10 text-white shadow-lg":"border-white/5 bg-black/20 text-slate-400"}`,children:[m.jsx("span",{className:"text-xl",children:""}),"Castellano"]}),m.jsxs("button",{onClick:()=>S("language","en"),className:`flex-1 py-4 rounded-2xl border transition-all flex items-center justify-center gap-3 font-bold text-xs ${f.language==="en"?"border-primary bg-primary/10 text-white shadow-lg":"border-white/5 bg-black/20 text-slate-400"}`,children:[m.jsx("span",{className:"text-xl",children:""}),"English"]})]})]}),m.jsx("div",{className:"mt-8 p-6 bg-black/40 rounded-2xl border border-white/5 text-center shadow-inner",children:m.jsx("p",{style:{fontFamily:f.font,fontSize:`${f.fontSize}px`},className:"text-slate-200 transition-all duration-300",children:'"El universo es un libro escrito en el lenguaje de las historias."'})})]})]})]})})]})},Xv=({isOpen:t,onClose:e,onConfirm:r,title:n,message:i,confirmText:a="Confirmar",cancelText:s="Cancelar",type:o="danger"})=>t?Al.createPortal(m.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[m.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",onClick:e}),m.jsxs("div",{className:"relative w-full max-w-md bg-[#0a0a0c] border border-white/10 rounded-3xl shadow-2xl p-6 animate-in zoom-in-95 duration-200 overflow-hidden",children:[m.jsx("div",{className:"absolute top-0 left-0 right-0 h-32 bg-gradient-to-b from-white/5 to-transparent pointer-events-none"}),m.jsxs("div",{className:"relative z-10 text-center",children:[m.jsx("div",{className:`mx-auto mb-4 size-16 rounded-2xl flex items-center justify-center ${o==="danger"?"bg-red-500/10 text-red-500":"bg-yellow-500/10 text-yellow-500"}`,children:m.jsx("span",{className:"material-symbols-outlined text-3xl",children:o==="danger"?"delete_forever":"warning"})}),m.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:n}),m.jsx("p",{className:"text-text-muted text-sm mb-8 leading-relaxed",children:i}),m.jsxs("div",{className:"flex gap-3",children:[m.jsx("button",{onClick:e,className:"flex-1 px-4 py-3 rounded-xl bg-surface-light hover:bg-white/10 text-text-muted hover:text-white text-xs font-bold transition-all border border-white/5",children:s}),m.jsx("button",{onClick:()=>{r(),e()},className:`flex-1 px-4 py-3 rounded-xl text-white text-xs font-bold transition-all shadow-lg flex items-center justify-center gap-2
                                ${o==="danger"?"bg-red-500 hover:bg-red-600 shadow-red-500/20":"bg-primary hover:bg-primary-light shadow-primary/20"}`,children:m.jsx("span",{children:a})})]})]})]})]}),document.body):null,FE=({compact:t=!1})=>{const[e,r]=se.useState(null),[n,i]=se.useState([]),[a,s]=se.useState(!1),[o,l]=se.useState(null);se.useEffect(()=>{u()},[]);const u=async()=>{try{const v=await Qe.get("/world-bible/folders");v.length>0&&r(v[0].id),c()}catch(v){console.error("Init error:",v)}},c=async()=>{s(!0);try{const v=await Qe.get("/world-bible/templates/global");i(v)}catch(v){console.error("Error loading templates:",v)}finally{s(!1)}},f=async v=>{if(e)try{await Qe.post(`/world-bible/folders/${e}/templates`,{nombre:v.label,tipo:v.type,required:v.required,metadata:v.metadata?JSON.stringify(v.metadata):null,global:!0}),c()}catch(y){console.error("Error creating template:",y)}},p=async()=>{if(o)try{await Qe.delete(`/world-bible/templates/${o}`),i(v=>v.filter(y=>y.id!==o))}catch(v){console.error("Error deleting template:",v)}finally{l(null)}};return m.jsxs("div",{className:"space-y-8 animate-in fade-in slide-in-from-right-4 duration-500",children:[m.jsxs(un,{className:`${t?"p-4 bg-transparent border-none shadow-none":"p-8 space-y-8"}`,children:[m.jsx("header",{className:`flex ${t?"flex-col gap-4":"justify-between items-center"}`,children:m.jsxs("div",{children:[m.jsx("h3",{className:`${t?"text-sm":"text-xl"} font-bold text-white`,children:"Atributos Globales"}),m.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Define atributos disponibles para todas las entidades."})]})}),m.jsxs("div",{className:"space-y-4",children:[a?m.jsx("div",{className:"text-center p-4 text-slate-500",children:"Cargando plantillas..."}):n.map((v,y)=>m.jsxs("div",{className:"flex items-center gap-4 p-4 rounded-2xl bg-white/[0.02] border border-white/5 hover:border-primary/50 hover:bg-white/5 transition-all cursor-grab active:cursor-grabbing group select-none",draggable:!0,onDragStart:S=>{S.dataTransfer.setData("application/reactflow/type","attribute"),S.dataTransfer.setData("templateId",v.id),S.dataTransfer.setData("templateData",JSON.stringify(v)),S.dataTransfer.effectAllowed="copy"},children:[m.jsxs("span",{className:"text-[10px] font-black text-slate-700 w-6 group-hover:text-primary transition-colors",children:["0",y+1]}),m.jsxs("div",{className:"flex-1 pointer-events-none",children:[m.jsx("div",{className:"text-sm font-bold text-white",children:v.nombre}),m.jsxs("div",{className:"text-[10px] text-slate-500 uppercase tracking-widest",children:[v.tipo," ",v.esObligatorio&&" Required"]}),v.metadata&&m.jsx("div",{className:"text-[10px] text-slate-600 font-mono mt-1 truncate",children:v.metadata})]}),m.jsx("button",{onClick:()=>l(v.id),className:"p-1.5 text-slate-500 hover:text-red-500 hover:bg-red-500/10 rounded-lg transition-colors",title:"Eliminar Plantilla Global",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})})]},v.id)),m.jsx(Xj,{onAdd:f})]})]}),m.jsx(Xv,{isOpen:!!o,onClose:()=>l(null),onConfirm:p,title:"Eliminar Plantilla",message:"Ests seguro de que quieres eliminar esta plantilla? Esta accin es irreversible.",confirmText:"Eliminar",type:"danger"})]})},Xj=({onAdd:t})=>{const[e,r]=se.useState(""),[n,i]=se.useState("text"),[a,s]=se.useState(!1),[o,l]=se.useState([""]),u=()=>l([...o,""]),c=v=>l(o.filter((y,S)=>S!==v)),f=(v,y)=>{const S=[...o];S[v]=y,l(S)},p=()=>{if(!e)return;let v=null;["select","multi_select"].includes(n)&&(v={options:o.filter(y=>y.trim())}),t({label:e,type:n,required:a,metadata:v}),r(""),l([""])};return m.jsxs("div",{className:"p-4 rounded-2xl border-2 border-dashed border-white/10 bg-white/[0.01] space-y-4",children:[m.jsx("h4",{className:"text-xs font-black uppercase tracking-widest text-primary",children:"Add New Attribute"}),m.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[m.jsx("input",{placeholder:"Field Name",value:e,onChange:v=>r(v.target.value),className:"bg-black/20 border border-white/5 rounded-xl px-4 py-2 text-xs text-white outline-none focus:border-primary/30 min-w-0"}),m.jsxs("select",{value:n,onChange:v=>i(v.target.value),className:"bg-black/20 border border-white/5 rounded-xl px-4 py-2 text-xs text-white outline-none",children:[m.jsx("option",{value:"text",children:"Text (Long)"}),m.jsx("option",{value:"short_text",children:"Text (Short)"}),m.jsx("option",{value:"number",children:"Number"}),m.jsx("option",{value:"date",children:"Date"}),m.jsx("option",{value:"select",children:"Single Selection (Dropdown)"}),m.jsx("option",{value:"multi_select",children:"Multiple Selection"}),m.jsx("option",{value:"boolean",children:"Switch (True/False)"})]})]}),["select","multi_select"].includes(n)&&m.jsxs("div",{className:"space-y-2",children:[m.jsx("label",{className:"text-[10px] font-bold text-slate-500 uppercase",children:"Options"}),m.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto pr-2 custom-scrollbar",children:o.map((v,y)=>m.jsxs("div",{className:"flex gap-2",children:[m.jsx("input",{placeholder:`Option ${y+1}`,value:v,onChange:S=>f(y,S.target.value),className:"flex-1 bg-black/20 border border-white/5 rounded-lg px-3 py-1.5 text-xs text-white outline-none focus:border-primary/30"}),m.jsx("button",{onClick:()=>c(y),className:"p-1.5 hover:bg-red-500/20 text-slate-500 hover:text-red-400 rounded-lg transition-colors",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"close"})})]},y))}),m.jsx("button",{onClick:u,className:"w-full py-1.5 text-[10px] font-bold uppercase tracking-widest text-primary hover:bg-primary/5 rounded-lg border border-dashed border-primary/20 transition-all",children:"+ Add Custom Option"})]}),m.jsxs("div",{className:"flex justify-between items-center",children:[m.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[m.jsx("input",{type:"checkbox",checked:a,onChange:v=>s(v.target.checked),className:"size-4 rounded border-white/10 bg-white/5 accent-primary"}),m.jsx("span",{className:"text-[10px] font-bold text-slate-500",children:"Required Field"})]}),m.jsx("button",{onClick:p,className:"px-4 py-2 bg-primary/20 text-primary rounded-lg text-xs font-bold hover:bg-primary/30 transition-all",children:"+ Add Field"})]})]})},FS=({projectName:t,storageKey:e})=>{const[r,n]=se.useState([]),[i,a]=se.useState(!1),[s,o]=se.useState(null),l=()=>e||`notes_v2_${t}`;se.useEffect(()=>{const _=l();if(!_)return;const C=localStorage.getItem(_);if(C)n(JSON.parse(C));else if(!e){const N=localStorage.getItem(`notes_${t}`);if(N){const A={id:Date.now(),title:"Nota General",content:N};n([A]),localStorage.setItem(_,JSON.stringify([A]))}}},[t,e]);const u=_=>{n(_);const C=l();C&&localStorage.setItem(C,JSON.stringify(_))},c=()=>{const _={id:Date.now(),title:"Nueva Nota",content:""};u([...r,_]),o(_.id)},[f,p]=se.useState(null),v=_=>{p(_)},y=()=>{f&&(u(r.filter(_=>_.id!==f)),p(null))},S=(_,C,N)=>{u(r.map(A=>A.id===_?{...A,[C]:N}:A))},w=()=>a(!i),T=()=>m.jsxs("div",{className:`flex flex-col h-full bg-surface-dark/40 ${i?"":"max-h-[25vh]"}`,children:[m.jsxs("div",{className:"flex items-center justify-between p-3 border-b border-glass-border bg-white/5",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm text-primary",children:"edit_note"}),m.jsxs("h3",{className:"text-[10px] font-black uppercase tracking-widest text-white",children:["Notas (",r.length,")"]})]}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("button",{onClick:c,className:"p-1 hover:text-primary text-text-muted transition-colors",title:"Aadir Nota",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"add"})}),m.jsx("button",{onClick:w,className:"p-1 hover:text-white text-text-muted transition-colors",title:"Pantalla Completa",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:i?"fullscreen_exit":"fullscreen"})})]})]}),m.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-2 space-y-2",children:r.length===0?m.jsx("div",{className:"py-8 text-center opacity-30 italic text-[10px] uppercase font-bold",children:"Sin notas"}):r.map(_=>m.jsxs("div",{className:"group bg-white/5 border border-glass-border rounded-xl overflow-hidden hover:border-primary/30 transition-all",children:[m.jsxs("div",{className:"flex items-center justify-between px-3 py-2 bg-white/5",children:[m.jsx("input",{className:"bg-transparent border-none text-[11px] font-bold text-white outline-none w-full",value:_.title,onChange:C=>S(_.id,"title",C.target.value),placeholder:"Ttulo..."}),m.jsx("button",{onClick:()=>v(_.id),className:"opacity-0 group-hover:opacity-100 p-1 text-text-muted hover:text-red-400 transition-all",children:m.jsx("span",{className:"material-symbols-outlined text-xs",children:"delete"})})]}),m.jsx("textarea",{className:"w-full bg-transparent p-3 text-xs text-white/70 outline-none resize-none min-h-[80px] custom-scrollbar",value:_.content,onChange:C=>S(_.id,"content",C.target.value),placeholder:"Escribe el contenido aqu..."})]},_.id))}),m.jsx(Xv,{isOpen:!!f,onClose:()=>p(null),onConfirm:y,title:"Eliminar Nota",message:"Ests seguro de que quieres eliminar esta nota? No se podr recuperar.",confirmText:"Eliminar",type:"danger"})]});return i?m.jsx("div",{className:"fixed inset-0 z-[100] bg-background-dark/95 backdrop-blur-md p-8 flex flex-col items-center",children:m.jsx("div",{className:"w-full max-w-4xl h-full flex flex-col border border-glass-border rounded-3xl overflow-hidden shadow-2xl bg-surface-dark",children:m.jsx(T,{})})}):m.jsx("div",{className:"h-full border border-glass-border rounded-2xl overflow-hidden",children:m.jsx(T,{})})},yd=({to:t,icon:e,label:r,collapsed:n,end:i})=>m.jsxs(FI,{to:t,end:i,className:({isActive:a})=>`
            flex items-center gap-3 px-3 py-2.5 rounded-xl transition-all group
            ${a?"bg-primary text-white shadow-lg shadow-primary/20":"text-text-muted hover:text-white hover:bg-white/5"}
            ${n?"justify-center":""}
        `,title:n?r:"",children:[m.jsx("span",{className:"material-symbols-outlined text-xl",children:e}),!n&&m.jsx("span",{className:"text-sm font-bold tracking-wide",children:r})]}),BE=t=>{switch(t?.toLowerCase()){case"text":return"notes";case"short_text":return"short_text";case"number":return"pin";case"date":return"calendar_today";case"select":return"list";case"boolean":return"check_box";case"map":return"map";case"timeline":return"timeline";case"character":case"entidadindividual":return"person";case"location":case"zona":case"construccion":return"location_on";case"culture":case"entidadcolectiva":return"groups";case"universe":case"galaxy":case"system":case"planet":return"public";case"entity_link":return"link";default:return"description"}},Qj=()=>{console.log("ArchitectLayout Mounting");const{username:t,projectName:e,folderSlug:r}=Vi(),n=za(),{t:i}=Sc(),a=Ah(),[s,o]=se.useState(!0),[l,u]=se.useState(!1),[c,f]=se.useState("Loading..."),[p,v]=se.useState(null),[y,S]=se.useState("NOTES"),[w,T]=se.useState(""),[_,C]=se.useState([]),[N,A]=se.useState(null),[O,j]=se.useState(null),[D,F]=se.useState({name:"",description:"",type:"regional",showGrid:!0,gridSize:50,width:800,height:600,bgImage:null}),[B,$]=se.useState(null),[Z,I]=se.useState("identity"),[q,U]=se.useState("notes"),[W,Y]=se.useState(""),[Q,ne]=se.useState("ALL"),re=a.pathname.includes("/bible"),H=a.pathname.includes("/writing"),[te,ie]=se.useState("index");a.pathname.includes("/languages");const[de,ge]=se.useState(null),[ye,ae]=se.useState([]),[pe,le]=se.useState("identity"),[me,he]=se.useState(null),xe=(je,Re)=>{je.stopPropagation(),he(Re)},we=async()=>{if(me){try{await Qe.delete(`/world-bible/templates/${me}`),C(je=>je.filter(Re=>Re.id!==me))}catch(je){console.error("Delete failed",je)}he(null)}},Ge=async je=>{je.preventDefault();try{await Qe.put(`/world-bible/templates/${de.id}`,de),C(Re=>Re.map(nt=>nt.id===de.id?de:nt)),ge(null)}catch(Re){console.error("Update failed",Re)}},qe=`/${t}/${e}`;se.useEffect(()=>{e&&wt(e);const je=()=>{e&&wt(e)};return window.addEventListener("focus",je),()=>window.removeEventListener("focus",je)},[e]);const wt=async je=>{try{const Re=await Qe.get(`/proyectos/${je}`);Re&&(f(Re.nombreProyecto),v(Re.id))}catch(Re){console.error("Error loading project:",Re),f("Error"),n("/")}},[et,at]=se.useState(null);return se.useEffect(()=>{const je=localStorage.getItem("user");je&&je!=="undefined"&&at(JSON.parse(je))},[]),m.jsxs("div",{className:"flex h-screen w-full overflow-hidden bg-background-dark text-text-main font-sans selection:bg-primary/30",children:[m.jsxs("aside",{className:`
                    flex-none bg-surface-dark border-r border-glass-border transition-all duration-500 relative flex flex-col z-30
                    ${s?"w-80":"w-20"}
                `,children:[m.jsxs("div",{className:"h-16 flex items-center justify-center border-b border-glass-border relative",children:[s?m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("div",{className:"size-8 rounded-lg bg-surface-light flex items-center justify-center text-primary shadow-inner",children:m.jsx("span",{className:"material-symbols-outlined",children:a.pathname.includes("/writing")?"edit_note":a.pathname.includes("/graph")?"hub":a.pathname.includes("/bible")?"auto_stories":a.pathname.includes("/map")?"map":a.pathname.includes("/timeline")?"timeline":a.pathname.includes("/languages")?"translate":"auto_stories"})}),m.jsx("h2",{className:"text-sm font-black uppercase tracking-widest text-white truncate max-w-[150px]",children:c})]}):m.jsx("button",{onClick:()=>o(!0),className:"size-10 rounded-xl hover:bg-white/5 flex items-center justify-center text-text-muted hover:text-white transition-all",children:m.jsx("span",{className:"material-symbols-outlined",children:"menu"})}),s&&m.jsx("button",{onClick:()=>o(!1),className:"absolute right-4 text-text-muted hover:text-white transition-colors",children:m.jsx("span",{className:"material-symbols-outlined text-lg",children:"dock_to_left"})})]}),m.jsx("div",{className:"flex-1 overflow-y-auto no-scrollbar flex flex-col",children:m.jsxs("div",{className:"p-3 space-y-1",children:[m.jsx(yd,{to:qe,icon:"home",label:i("nav.dashboard"),collapsed:!s,end:!0}),m.jsx(yd,{to:`${qe}/bible`,icon:"menu_book",label:i("nav.bible"),collapsed:!s}),m.jsx(yd,{to:`${qe}/map`,icon:"map",label:i("nav.atlas"),collapsed:!s}),m.jsx(yd,{to:`${qe}/timeline`,icon:"calendar_month",label:i("nav.chronology"),collapsed:!s}),m.jsx(yd,{to:`${qe}/languages`,icon:"translate",label:i("nav.languages"),collapsed:!s}),m.jsx(yd,{to:`${qe}/graph`,icon:"hub",label:i("nav.graph"),collapsed:!s}),m.jsx("div",{className:"h-px bg-glass-border my-2 mx-2 opacity-50"}),m.jsx(yd,{to:`${qe}/writing`,icon:"edit_note",label:i("nav.writing"),collapsed:!s}),m.jsx("div",{className:"h-px bg-glass-border my-2 mx-2 opacity-10"}),m.jsx(yd,{to:"/",icon:"logout",label:i("nav.logout"),collapsed:!s})]})}),m.jsx("footer",{className:"p-4 border-t border-glass-border",children:m.jsxs("div",{className:`flex items-center gap-3 ${!s&&"justify-center"}`,children:[m.jsx("div",{className:"size-10 rounded-full border border-glass-border p-1 bg-surface-light relative overflow-hidden",children:et?.avatarUrl?m.jsx("img",{src:et.avatarUrl,alt:"Me",className:"w-full h-full rounded-full object-cover"}):m.jsx("div",{className:"w-full h-full rounded-full bg-gradient-to-br from-primary to-purple-500 flex items-center justify-center text-white font-black text-xs",children:(et?.displayName||t)?.substring(0,2).toUpperCase()||"US"})}),s&&m.jsxs("div",{className:"overflow-hidden",children:[m.jsx("h4",{className:"text-xs font-bold text-white truncate",children:et?.displayName||t||"User"}),m.jsx("p",{className:"text-[10px] text-text-muted uppercase font-black tracking-tighter",children:i("common.architect")})]})]})})]}),m.jsxs("main",{className:"flex-1 flex flex-col min-w-0 bg-background-dark relative",children:[m.jsx("div",{className:"h-16 w-full absolute top-0 left-0 bg-gradient-to-b from-background-dark to-transparent pointer-events-none"}),m.jsx("div",{className:"flex-1 flex overflow-hidden relative",children:m.jsx(r_,{context:{setRightPanelMode:S,setRightOpen:u,setRightPanelTitle:T,projectName:c,projectId:p,availableTemplates:_,setAvailableTemplates:C,setAddAttributeHandler:A,setCreateTemplateHandler:j,mapSettings:D,setMapSettings:F,setOnMapSettingsChange:$,entityTabs:ye,setEntityTabs:ae,activeEntityTab:pe,setActiveEntityTab:le,folderSearchTerm:W,setFolderSearchTerm:Y,folderFilterType:Q,setFolderFilterType:ne}})})]}),m.jsxs("aside",{className:`
                    flex-none bg-surface-dark border-l border-glass-border transition-all duration-500 relative flex flex-col z-30 shrink-0
                    ${l?"w-80":"w-20"}
                `,children:[m.jsx("header",{className:"h-16 flex items-center px-6 border-b border-glass-border justify-between shrink-0",children:l?m.jsxs(m.Fragment,{children:[y==="CUSTOM"&&!H?m.jsx("h2",{className:"text-xs font-black uppercase tracking-widest text-primary",children:w||"Panel"}):y==="LINGUISTICS"?m.jsx("div",{className:"flex bg-white/5 rounded-lg p-1 gap-1 w-full mr-4",children:m.jsxs("button",{className:"flex-1 py-1 rounded-md text-[10px] uppercase font-bold bg-primary text-white shadow transition-all",children:[m.jsx("span",{className:"material-symbols-outlined text-sm align-middle mr-1",children:"draw"}),"Herramientas"]})}):H?m.jsxs("div",{className:"flex bg-white/5 rounded-lg p-1 gap-1 w-full mr-4",children:[m.jsx("button",{onClick:()=>ie("index"),className:`flex-1 py-1 rounded-md text-[10px] uppercase font-bold transition-all ${te==="index"?"bg-primary text-white shadow":"text-slate-500 hover:text-white"}`,children:i("writing.index")}),m.jsx("button",{onClick:()=>ie("notes"),className:`flex-1 py-1 rounded-md text-[10px] uppercase font-bold transition-all ${te==="notes"?"bg-primary text-white shadow":"text-slate-500 hover:text-white"}`,children:i("writing.notes")})]}):re&&y==="NOTES"?m.jsxs("div",{className:"flex bg-white/5 rounded-lg p-1 gap-1",children:[m.jsx("button",{onClick:()=>U("notes"),className:`px-3 py-1 rounded-md text-[10px] uppercase font-bold transition-all ${q==="notes"?"bg-primary text-white shadow":"text-slate-500 hover:text-white"}`,children:i("writing.notes")}),m.jsx("button",{onClick:()=>U("templates"),className:`px-3 py-1 rounded-md text-[10px] uppercase font-bold transition-all ${q==="templates"?"bg-primary text-white shadow":"text-slate-500 hover:text-white"}`,children:i("bible.templates")}),m.jsx("button",{onClick:()=>U("filters"),className:`px-3 py-1 rounded-md text-[10px] uppercase font-bold transition-all ${q==="filters"?"bg-primary text-white shadow":"text-slate-500 hover:text-white"}`,children:i("bible.explore")})]}):m.jsx("h2",{className:"text-xs font-black uppercase tracking-widest text-white",children:w||i(y==="NOTES"?"settings.notes_global":"common.architect")}),m.jsx("button",{onClick:()=>u(!1),className:"text-text-muted hover:text-white transition-colors shrink-0",children:m.jsx("span",{className:"material-symbols-outlined text-lg",children:"dock_to_right"})})]}):m.jsx("button",{onClick:()=>u(!0),className:"w-full h-full flex items-center justify-center text-text-muted hover:text-white transition-colors",children:m.jsx("span",{className:"material-symbols-outlined",children:y==="NOTES"||H?"edit_note":y==="MAP"?"map":y==="LINGUISTICS"?"draw":y==="CUSTOM"?"build":"handyman"})})}),m.jsxs("div",{className:"flex-1 overflow-y-auto no-scrollbar p-0 relative",children:[m.jsx("div",{id:"architect-right-panel-portal",className:`
                            ${(H||y==="CUSTOM"||y==="LINGUISTICS")&&l?"flex flex-col h-full relative":"hidden"}
                        `}),l?H?m.jsx(m.Fragment,{children:m.jsx("div",{className:`h-full p-4 overflow-hidden ${te==="notes"?"block":"hidden"}`,children:m.jsx(FS,{projectName:e})})}):y==="CUSTOM"?m.jsx(m.Fragment,{}):y==="NOTES"?q==="templates"&&re?m.jsx("div",{className:"h-full overflow-y-auto no-scrollbar",children:m.jsx(FE,{compact:!0})}):q==="filters"&&re?m.jsxs("div",{className:"h-full p-6 space-y-6 animate-in fade-in slide-in-from-right-4",children:[m.jsxs("div",{className:"space-y-4",children:[m.jsx("h3",{className:"text-xs font-black uppercase tracking-widest text-text-muted",children:"Bsqueda"}),m.jsxs("div",{className:"bg-black/20 border border-white/10 rounded-xl p-3 flex items-center gap-2 focus-within:border-primary transition-colors",children:[m.jsx("span",{className:"material-symbols-outlined text-slate-500",children:"search"}),m.jsx("input",{value:W,onChange:je=>Y(je.target.value),placeholder:i("bible.search_entity"),className:"bg-transparent border-none outline-none text-sm text-white w-full placeholder-slate-600"}),W&&m.jsx("button",{onClick:()=>Y(""),className:"text-slate-500 hover:text-white",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"close"})})]})]}),m.jsx("div",{className:"h-px bg-glass-border"}),m.jsxs("div",{className:"space-y-4",children:[m.jsx("h3",{className:"text-xs font-black uppercase tracking-widest text-text-muted",children:"Filtrar por Tipo"}),m.jsx("div",{className:"grid grid-cols-2 gap-2",children:[{id:"ALL",label:i("bible.all"),icon:"grid_view"},{id:"ENTITY",label:i("bible.entities"),icon:"person"},{id:"MAP",label:i("bible.maps"),icon:"map"},{id:"TIMELINE",label:i("bible.timelines"),icon:"timeline"}].map(je=>m.jsxs("button",{onClick:()=>ne(je.id),className:`
                                                        p-3 rounded-xl border flex flex-col items-center gap-2 transition-all
                                                        ${Q===je.id?"bg-primary text-white border-primary shadow-lg shadow-primary/20":"bg-white/5 border-transparent text-slate-500 hover:bg-white/10 hover:text-white"}
                                                    `,children:[m.jsx("span",{className:"material-symbols-outlined",children:je.icon}),m.jsx("span",{className:"text-[10px] font-bold uppercase",children:je.label})]},je.id))})]})]}):m.jsx("div",{className:"h-full p-4 overflow-hidden",children:m.jsx(FS,{projectName:e})}):y==="MAP"?m.jsxs("div",{className:"p-6 space-y-8 animate-in fade-in slide-in-from-right-4",children:[m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsx("h3",{className:"text-xs font-black uppercase tracking-widest text-text-muted",children:"Grid System"}),m.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[m.jsx("input",{type:"checkbox",checked:D.showGrid,onChange:je=>{const Re={...D,showGrid:je.target.checked};F(Re),B&&B(Re)},className:"sr-only peer"}),m.jsx("div",{className:"w-9 h-5 bg-white/10 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-primary"})]})]}),m.jsxs("div",{className:`space-y-2 transition-opacity ${D.showGrid?"opacity-100":"opacity-30 pointer-events-none"}`,children:[m.jsxs("div",{className:"flex justify-between text-xs font-bold text-white",children:[m.jsx("span",{children:"Size"}),m.jsxs("span",{className:"font-mono text-primary",children:[D.gridSize,"px"]})]}),m.jsx("input",{type:"range",min:"10",max:"200",step:"10",value:D.gridSize,onChange:je=>{const Re={...D,gridSize:parseInt(je.target.value)};F(Re),B&&B(Re)},className:"w-full h-1 bg-white/10 rounded-lg appearance-none cursor-pointer accent-primary"})]})]}),m.jsx("div",{className:"h-px bg-glass-border"}),m.jsxs("div",{className:"space-y-4",children:[m.jsx("h3",{className:"text-xs font-black uppercase tracking-widest text-text-muted",children:i("atlas.canvas_data")}),m.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[m.jsxs("div",{className:"space-y-1",children:[m.jsx("label",{className:"text-[10px] uppercase font-bold text-slate-500",children:i("atlas.width")}),m.jsx("input",{type:"number",value:D.width,onChange:je=>{const Re={...D,width:parseInt(je.target.value)};F(Re),B&&B(Re)},className:"w-full bg-black/20 border border-white/10 rounded-lg p-2 text-white text-right font-mono text-sm focus:border-primary outline-none"})]}),m.jsxs("div",{className:"space-y-1",children:[m.jsx("label",{className:"text-[10px] uppercase font-bold text-slate-500",children:i("atlas.height")}),m.jsx("input",{type:"number",value:D.height,onChange:je=>{const Re={...D,height:parseInt(je.target.value)};F(Re),B&&B(Re)},className:"w-full bg-black/20 border border-white/10 rounded-lg p-2 text-white text-right font-mono text-sm focus:border-primary outline-none"})]})]})]}),m.jsx("div",{className:"h-px bg-glass-border"}),m.jsxs("div",{className:"space-y-4",children:[m.jsx("h3",{className:"text-xs font-black uppercase tracking-widest text-text-muted",children:i("atlas.background_image")}),m.jsxs("div",{className:"space-y-2",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsxs("label",{className:"cursor-pointer bg-white/5 hover:bg-white/10 text-white rounded-lg px-3 py-2 text-xs font-bold transition-colors border border-glass-border flex items-center gap-2 flex-1",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"upload"}),m.jsx("span",{children:i("atlas.upload_image")}),m.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:je=>{const Re=je.target.files[0];if(Re){const nt=new FileReader;nt.onload=Ce=>{const Fe=new Image;Fe.onload=()=>{const Ke={...D,bgImage:Ce.target.result,width:Fe.width,height:Fe.height};F(Ke),B&&B(Ke)},Fe.src=Ce.target.result},nt.readAsDataURL(Re)}}})]}),D.bgImage&&m.jsx("button",{onClick:()=>{const je={...D,bgImage:null};F(je),B&&B(je)},className:"p-2 bg-red-500/10 text-red-400 hover:bg-red-500/20 rounded-lg border border-red-500/20",title:"Remove Image",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})})]}),D.bgImage&&m.jsxs("div",{className:"rounded-lg overflow-hidden border border-glass-border bg-black/20 h-32 relative group",children:[m.jsx("img",{src:D.bgImage,alt:"Background",className:"w-full h-full object-cover opacity-70"}),m.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:m.jsxs("span",{className:"text-[10px] font-mono bg-black/50 px-2 py-1 rounded text-white backdrop-blur-sm",children:[D.width," x ",D.height]})})]})]})]})]}):y==="ENTITY"?m.jsxs("div",{className:"flex flex-col h-full animate-in fade-in slide-in-from-right-4",children:[m.jsx("div",{className:"p-4 border-b border-glass-border",children:m.jsx("div",{className:"bg-black/40 p-1 rounded-xl flex",children:ye.map(je=>{const Re=nt=>{switch(nt.toLowerCase()){case"identity":return"badge";case"narrative":return"auto_stories";case"attributes":return"tune";case"notes":return"edit_note";default:return"circle"}};return m.jsxs("button",{onClick:()=>le(je),className:`
                                                        flex-1 py-2 rounded-lg transition-all group relative flex items-center justify-center
                                                        ${pe===je?"bg-primary text-white shadow-lg":"text-text-muted hover:text-white hover:bg-white/5"}
                                                    `,title:je,children:[m.jsx("span",{className:"material-symbols-outlined text-lg",children:Re(je)}),m.jsx("span",{className:"absolute -bottom-8 left-1/2 -translate-x-1/2 bg-black/90 text-white text-[10px] uppercase font-bold px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none whitespace-nowrap z-50",children:je})]},je)})})}),pe==="attributes"&&m.jsxs("div",{className:"flex-1 overflow-hidden flex flex-col bg-black/20",children:[m.jsxs("div",{className:"px-6 py-4 text-[10px] font-black uppercase text-slate-500 tracking-widest flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"drag_indicator"})," ",i("bible.drag_attributes")]}),m.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar px-2",children:m.jsx(FE,{compact:!0,initialFolderSlug:r})})]})]}):y==="TOOLBOX"?m.jsx("div",{className:"p-4 space-y-6",children:m.jsxs("div",{className:"space-y-3",children:[m.jsxs("h3",{className:"text-[10px] font-black uppercase tracking-widest text-text-muted px-2 flex justify-between items-center",children:[m.jsx("span",{children:i("settings.available_templates")}),m.jsx("button",{className:"text-primary hover:text-white transition-colors",title:"Crear Nueva Plantilla",onClick:()=>O&&O(),children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"add"})})]}),_.length===0?m.jsx("div",{className:"p-6 text-center border border-dashed border-glass-border rounded-2xl opacity-30",children:m.jsx("p",{className:"text-[10px] uppercase font-bold",children:i("settings.no_templates")})}):_.map(je=>m.jsxs("button",{className:"w-full flex items-center gap-3 p-3 rounded-2xl bg-white/5 border border-glass-border hover:border-primary/50 hover:bg-primary/5 transition-all text-left group relative",draggable:!0,onDragStart:Re=>{Re.dataTransfer.setData("application/reactflow/type","attribute"),Re.dataTransfer.setData("templateId",je.id),Re.dataTransfer.effectAllowed="move"},onClick:()=>N&&N(je.id),children:[je.global&&m.jsx("span",{className:"absolute top-2 right-2 flex size-2 bg-blue-500 rounded-full shadow-lg shadow-blue-500/50",title:"Global"}),m.jsx("div",{className:"size-8 rounded-lg bg-surface-light flex items-center justify-center text-primary group-hover:scale-110 transition-transform",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:BE(je.tipo)})}),m.jsxs("div",{className:"overflow-hidden",children:[m.jsx("p",{className:"text-xs font-bold text-white truncate",children:je.nombre}),m.jsx("p",{className:"text-[10px] text-text-muted uppercase font-black tracking-tighter",children:je.tipo})]}),m.jsxs("div",{className:"absolute right-2 top-1/2 -translate-y-1/2 flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[m.jsx("div",{onClick:Re=>{Re.stopPropagation(),ge(je)},className:"p-1 hover:text-white text-text-muted hover:bg-white/10 rounded cursor-pointer",title:"Edit",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"edit"})}),m.jsx("div",{onClick:Re=>xe(Re,je.id),className:"p-1 hover:text-red-400 text-text-muted hover:bg-white/10 rounded cursor-pointer",title:"Delete",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})})]})]},je.id))]})}):m.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-text-muted opacity-50",children:[m.jsx("span",{className:"material-symbols-outlined text-4xl mb-2",children:"dashboard"}),m.jsx("p",{className:"text-xs uppercase font-bold tracking-widest",children:"Select an item"})]}):m.jsx("div",{className:"flex flex-col items-center gap-4 py-4 w-full",children:y==="NOTES"||H?m.jsx("button",{onClick:()=>u(!0),className:"size-10 rounded-xl bg-white/5 flex items-center justify-center text-text-muted hover:text-white",title:"Notas Globales",children:m.jsx("span",{className:"material-symbols-outlined text-lg",children:"edit_note"})}):y==="MAP"?m.jsx("button",{onClick:()=>u(!0),className:"size-10 rounded-xl bg-white/5 flex items-center justify-center text-text-muted hover:text-white",title:"Ajustes de Mapa",children:m.jsx("span",{className:"material-symbols-outlined text-lg",children:"tune"})}):y==="ENTITY"?m.jsx("button",{onClick:()=>u(!0),className:"size-10 rounded-xl bg-white/5 flex items-center justify-center text-text-muted hover:text-white",title:"Atributos",children:m.jsx("span",{className:"material-symbols-outlined text-lg",children:"fact_check"})}):y==="CUSTOM"?m.jsx("button",{onClick:()=>u(!0),className:"size-10 rounded-xl bg-primary/10 border border-primary/20 flex items-center justify-center text-primary hover:bg-primary/20 transition-all",title:w||"Panel",children:m.jsx("span",{className:"material-symbols-outlined text-lg",children:"extension"})}):_.slice(0,5).map(je=>m.jsxs("button",{className:"size-10 rounded-xl bg-white/5 flex items-center justify-center text-text-muted hover:text-white hover:bg-primary/20 transition-all relative",draggable:!0,onDragStart:Re=>{Re.dataTransfer.setData("application/reactflow/type","attribute"),Re.dataTransfer.setData("templateId",je.id)},title:je.nombre,children:[je.global&&m.jsx("span",{className:"absolute top-0 right-0 size-2 bg-blue-500 rounded-full border border-surface-dark"}),m.jsx("span",{className:"material-symbols-outlined text-lg",children:BE(je.tipo)})]},je.id))})]})]}),de&&m.jsx("div",{className:"fixed inset-0 z-[100] bg-black/60 backdrop-blur-sm flex items-center justify-center p-4",children:m.jsxs("div",{className:"bg-surface-dark border border-glass-border rounded-2xl p-6 w-full max-w-md shadow-2xl animate-scale-in",children:[m.jsx("h3",{className:"text-xl font-black text-white mb-4",children:i("settings.edit_template")}),m.jsxs("form",{onSubmit:Ge,className:"space-y-4",children:[m.jsxs("div",{children:[m.jsx("label",{className:"text-xs uppercase font-bold text-text-muted block mb-1",children:i("settings.name")}),m.jsx("input",{autoFocus:!0,className:"w-full bg-black/30 border border-white/10 rounded-xl p-3 text-white focus:border-primary outline-none",value:de.nombre,onChange:je=>ge({...de,nombre:je.target.value}),required:!0})]}),m.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[m.jsxs("div",{children:[m.jsx("label",{className:"text-xs uppercase font-bold text-text-muted block mb-1",children:i("settings.type")}),m.jsxs("select",{className:"w-full bg-black/30 border border-white/10 rounded-xl p-3 text-white focus:border-primary outline-none",value:de.tipo,onChange:je=>ge({...de,tipo:je.target.value}),children:[m.jsx("option",{value:"text",children:"Texto Largo"}),m.jsx("option",{value:"short_text",children:"Texto Corto"}),m.jsx("option",{value:"number",children:"Nmero"}),m.jsx("option",{value:"boolean",children:"Si/No"}),m.jsx("option",{value:"date",children:"Fecha"}),m.jsx("option",{value:"entity_link",children:"Vnculo Entidad"}),m.jsx("option",{value:"image",children:"Imagen URL"})]})]}),m.jsx("div",{className:"flex items-center",children:m.jsxs("label",{className:"flex items-center gap-2 cursor-pointer p-3 bg-white/5 rounded-xl w-full hover:bg-white/10 transition-colors",children:[m.jsx("input",{type:"checkbox",checked:de.global,onChange:je=>ge({...de,global:je.target.checked}),className:"accent-primary size-4"}),m.jsx("span",{className:"text-sm font-bold text-white",children:i("settings.is_global")})]})})]}),m.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[m.jsx("button",{type:"button",onClick:()=>ge(null),className:"px-4 py-2 text-text-muted hover:text-white font-bold transition-colors",children:i("common.cancel")}),m.jsx("button",{type:"submit",className:"px-6 py-2 bg-primary text-white rounded-xl font-bold shadow-lg shadow-primary/20 hover:scale-105 transition-transform",children:i("common.save")})]})]})]})}),m.jsx(Xv,{isOpen:!!me,onClose:()=>he(null),onConfirm:we,title:i("settings.delete_template"),message:i("common.are_you_sure"),confirmText:i("common.confirm_delete"),type:"danger"})]})};var Hb={exports:{}},Wb,zE;function Jj(){if(zE)return Wb;zE=1;var t="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return Wb=t,Wb}var qb,UE;function eF(){if(UE)return qb;UE=1;var t=Jj();function e(){}function r(){}return r.resetWarningCache=e,qb=function(){function n(s,o,l,u,c,f){if(f!==t){var p=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw p.name="Invariant Violation",p}}n.isRequired=n;function i(){return n}var a={array:n,bigint:n,bool:n,func:n,number:n,object:n,string:n,symbol:n,any:n,arrayOf:i,element:n,elementType:n,instanceOf:i,node:n,objectOf:i,oneOf:i,oneOfType:i,shape:i,exact:i,checkPropTypes:r,resetWarningCache:e};return a.PropTypes=a,a},qb}var GE;function tF(){return GE||(GE=1,Hb.exports=eF()()),Hb.exports}var rF=tF();const nF=Mh(rF);function BS(t,e){(e==null||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function iF(t){if(Array.isArray(t))return t}function aF(t){if(Array.isArray(t))return BS(t)}function lf(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function sF(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,$M(n.key),n)}}function uf(t,e,r){return e&&sF(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function Ws(t,e){var r=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=a_(t))||e){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a,s=!0,o=!1;return{s:function(){r=r.call(t)},n:function(){var l=r.next();return s=l.done,l},e:function(l){o=!0,a=l},f:function(){try{s||r.return==null||r.return()}finally{if(o)throw a}}}}function qM(t,e,r){return(e=$M(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function oF(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function lF(t,e){var r=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(r!=null){var n,i,a,s,o=[],l=!0,u=!1;try{if(a=(r=r.call(t)).next,e===0){if(Object(r)!==r)return;l=!1}else for(;!(l=(n=a.call(r)).done)&&(o.push(n.value),o.length!==e);l=!0);}catch(c){u=!0,i=c}finally{try{if(!l&&r.return!=null&&(s=r.return(),Object(s)!==s))return}finally{if(u)throw i}}return o}}function uF(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function cF(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ai(t,e){return iF(t)||lF(t,e)||a_(t,e)||uF()}function lx(t){return aF(t)||oF(t)||a_(t)||cF()}function dF(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}function $M(t){var e=dF(t,"string");return typeof e=="symbol"?e:e+""}function Hi(t){"@babel/helpers - typeof";return Hi=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Hi(t)}function a_(t,e){if(t){if(typeof t=="string")return BS(t,e);var r={}.toString.call(t).slice(8,-1);return r==="Object"&&t.constructor&&(r=t.constructor.name),r==="Map"||r==="Set"?Array.from(t):r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?BS(t,e):void 0}}var Ui=typeof window>"u"?null:window,VE=Ui?Ui.navigator:null;Ui&&Ui.document;var fF=Hi(""),KM=Hi({}),hF=Hi(function(){}),pF=typeof HTMLElement>"u"?"undefined":Hi(HTMLElement),Qv=function(e){return e&&e.instanceString&&Kn(e.instanceString)?e.instanceString():null},Wt=function(e){return e!=null&&Hi(e)==fF},Kn=function(e){return e!=null&&Hi(e)===hF},pn=function(e){return!uo(e)&&(Array.isArray?Array.isArray(e):e!=null&&e instanceof Array)},Ir=function(e){return e!=null&&Hi(e)===KM&&!pn(e)&&e.constructor===Object},mF=function(e){return e!=null&&Hi(e)===KM},gt=function(e){return e!=null&&Hi(e)===Hi(1)&&!isNaN(e)},gF=function(e){return gt(e)&&Math.floor(e)===e},ux=function(e){if(pF!=="undefined")return e!=null&&e instanceof HTMLElement},uo=function(e){return Jv(e)||ZM(e)},Jv=function(e){return Qv(e)==="collection"&&e._private.single},ZM=function(e){return Qv(e)==="collection"&&!e._private.single},s_=function(e){return Qv(e)==="core"},YM=function(e){return Qv(e)==="stylesheet"},vF=function(e){return Qv(e)==="event"},Xd=function(e){return e==null?!0:!!(e===""||e.match(/^\s+$/))},yF=function(e){return typeof HTMLElement>"u"?!1:e instanceof HTMLElement},xF=function(e){return Ir(e)&&gt(e.x1)&&gt(e.x2)&&gt(e.y1)&&gt(e.y2)},bF=function(e){return mF(e)&&Kn(e.then)},wF=function(){return VE&&VE.userAgent.match(/msie|trident|edge/i)},Kp=function(e,r){r||(r=function(){if(arguments.length===1)return arguments[0];if(arguments.length===0)return"undefined";for(var a=[],s=0;s<arguments.length;s++)a.push(arguments[s]);return a.join("$")});var n=function(){var a=this,s=arguments,o,l=r.apply(a,s),u=n.cache;return(o=u[l])||(o=u[l]=e.apply(a,s)),o};return n.cache={},n},o_=Kp(function(t){return t.replace(/([A-Z])/g,function(e){return"-"+e.toLowerCase()})}),k1=Kp(function(t){return t.replace(/(-\w)/g,function(e){return e[1].toUpperCase()})}),XM=Kp(function(t,e){return t+e[0].toUpperCase()+e.substring(1)},function(t,e){return t+"$"+e}),HE=function(e){return Xd(e)?e:e.charAt(0).toUpperCase()+e.substring(1)},Dd=function(e,r){return e.slice(-1*r.length)===r},Gi="(?:[-+]?(?:(?:\\d+|\\d*\\.\\d+)(?:[Ee][+-]?\\d+)?))",SF="rgb[a]?\\(("+Gi+"[%]?)\\s*,\\s*("+Gi+"[%]?)\\s*,\\s*("+Gi+"[%]?)(?:\\s*,\\s*("+Gi+"))?\\)",kF="rgb[a]?\\((?:"+Gi+"[%]?)\\s*,\\s*(?:"+Gi+"[%]?)\\s*,\\s*(?:"+Gi+"[%]?)(?:\\s*,\\s*(?:"+Gi+"))?\\)",_F="hsl[a]?\\(("+Gi+")\\s*,\\s*("+Gi+"[%])\\s*,\\s*("+Gi+"[%])(?:\\s*,\\s*("+Gi+"))?\\)",CF="hsl[a]?\\((?:"+Gi+")\\s*,\\s*(?:"+Gi+"[%])\\s*,\\s*(?:"+Gi+"[%])(?:\\s*,\\s*(?:"+Gi+"))?\\)",EF="\\#[0-9a-fA-F]{3}",TF="\\#[0-9a-fA-F]{6}",QM=function(e,r){return e<r?-1:e>r?1:0},NF=function(e,r){return-1*QM(e,r)},Jt=Object.assign!=null?Object.assign.bind(Object):function(t){for(var e=arguments,r=1;r<e.length;r++){var n=e[r];if(n!=null)for(var i=Object.keys(n),a=0;a<i.length;a++){var s=i[a];t[s]=n[s]}}return t},PF=function(e){if(!(!(e.length===4||e.length===7)||e[0]!=="#")){var r=e.length===4,n,i,a,s=16;return r?(n=parseInt(e[1]+e[1],s),i=parseInt(e[2]+e[2],s),a=parseInt(e[3]+e[3],s)):(n=parseInt(e[1]+e[2],s),i=parseInt(e[3]+e[4],s),a=parseInt(e[5]+e[6],s)),[n,i,a]}},MF=function(e){var r,n,i,a,s,o,l,u;function c(y,S,w){return w<0&&(w+=1),w>1&&(w-=1),w<1/6?y+(S-y)*6*w:w<1/2?S:w<2/3?y+(S-y)*(2/3-w)*6:y}var f=new RegExp("^"+_F+"$").exec(e);if(f){if(n=parseInt(f[1]),n<0?n=(360- -1*n%360)%360:n>360&&(n=n%360),n/=360,i=parseFloat(f[2]),i<0||i>100||(i=i/100,a=parseFloat(f[3]),a<0||a>100)||(a=a/100,s=f[4],s!==void 0&&(s=parseFloat(s),s<0||s>1)))return;if(i===0)o=l=u=Math.round(a*255);else{var p=a<.5?a*(1+i):a+i-a*i,v=2*a-p;o=Math.round(255*c(v,p,n+1/3)),l=Math.round(255*c(v,p,n)),u=Math.round(255*c(v,p,n-1/3))}r=[o,l,u,s]}return r},AF=function(e){var r,n=new RegExp("^"+SF+"$").exec(e);if(n){r=[];for(var i=[],a=1;a<=3;a++){var s=n[a];if(s[s.length-1]==="%"&&(i[a]=!0),s=parseFloat(s),i[a]&&(s=s/100*255),s<0||s>255)return;r.push(Math.floor(s))}var o=i[1]||i[2]||i[3],l=i[1]&&i[2]&&i[3];if(o&&!l)return;var u=n[4];if(u!==void 0){if(u=parseFloat(u),u<0||u>1)return;r.push(u)}}return r},LF=function(e){return RF[e.toLowerCase()]},JM=function(e){return(pn(e)?e:null)||LF(e)||PF(e)||AF(e)||MF(e)},RF={transparent:[0,0,0,0],aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],grey:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},eA=function(e){for(var r=e.map,n=e.keys,i=n.length,a=0;a<i;a++){var s=n[a];if(Ir(s))throw Error("Tried to set map with object key");a<n.length-1?(r[s]==null&&(r[s]={}),r=r[s]):r[s]=e.value}},tA=function(e){for(var r=e.map,n=e.keys,i=n.length,a=0;a<i;a++){var s=n[a];if(Ir(s))throw Error("Tried to get map with object key");if(r=r[s],r==null)return r}return r},ey=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function e0(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var $b,WE;function t0(){if(WE)return $b;WE=1;function t(e){var r=typeof e;return e!=null&&(r=="object"||r=="function")}return $b=t,$b}var Kb,qE;function OF(){if(qE)return Kb;qE=1;var t=typeof ey=="object"&&ey&&ey.Object===Object&&ey;return Kb=t,Kb}var Zb,$E;function _1(){if($E)return Zb;$E=1;var t=OF(),e=typeof self=="object"&&self&&self.Object===Object&&self,r=t||e||Function("return this")();return Zb=r,Zb}var Yb,KE;function DF(){if(KE)return Yb;KE=1;var t=_1(),e=function(){return t.Date.now()};return Yb=e,Yb}var Xb,ZE;function IF(){if(ZE)return Xb;ZE=1;var t=/\s/;function e(r){for(var n=r.length;n--&&t.test(r.charAt(n)););return n}return Xb=e,Xb}var Qb,YE;function jF(){if(YE)return Qb;YE=1;var t=IF(),e=/^\s+/;function r(n){return n&&n.slice(0,t(n)+1).replace(e,"")}return Qb=r,Qb}var Jb,XE;function l_(){if(XE)return Jb;XE=1;var t=_1(),e=t.Symbol;return Jb=e,Jb}var ew,QE;function FF(){if(QE)return ew;QE=1;var t=l_(),e=Object.prototype,r=e.hasOwnProperty,n=e.toString,i=t?t.toStringTag:void 0;function a(s){var o=r.call(s,i),l=s[i];try{s[i]=void 0;var u=!0}catch{}var c=n.call(s);return u&&(o?s[i]=l:delete s[i]),c}return ew=a,ew}var tw,JE;function BF(){if(JE)return tw;JE=1;var t=Object.prototype,e=t.toString;function r(n){return e.call(n)}return tw=r,tw}var rw,eT;function rA(){if(eT)return rw;eT=1;var t=l_(),e=FF(),r=BF(),n="[object Null]",i="[object Undefined]",a=t?t.toStringTag:void 0;function s(o){return o==null?o===void 0?i:n:a&&a in Object(o)?e(o):r(o)}return rw=s,rw}var nw,tT;function zF(){if(tT)return nw;tT=1;function t(e){return e!=null&&typeof e=="object"}return nw=t,nw}var iw,rT;function r0(){if(rT)return iw;rT=1;var t=rA(),e=zF(),r="[object Symbol]";function n(i){return typeof i=="symbol"||e(i)&&t(i)==r}return iw=n,iw}var aw,nT;function UF(){if(nT)return aw;nT=1;var t=jF(),e=t0(),r=r0(),n=NaN,i=/^[-+]0x[0-9a-f]+$/i,a=/^0b[01]+$/i,s=/^0o[0-7]+$/i,o=parseInt;function l(u){if(typeof u=="number")return u;if(r(u))return n;if(e(u)){var c=typeof u.valueOf=="function"?u.valueOf():u;u=e(c)?c+"":c}if(typeof u!="string")return u===0?u:+u;u=t(u);var f=a.test(u);return f||s.test(u)?o(u.slice(2),f?2:8):i.test(u)?n:+u}return aw=l,aw}var sw,iT;function GF(){if(iT)return sw;iT=1;var t=t0(),e=DF(),r=UF(),n="Expected a function",i=Math.max,a=Math.min;function s(o,l,u){var c,f,p,v,y,S,w=0,T=!1,_=!1,C=!0;if(typeof o!="function")throw new TypeError(n);l=r(l)||0,t(u)&&(T=!!u.leading,_="maxWait"in u,p=_?i(r(u.maxWait)||0,l):p,C="trailing"in u?!!u.trailing:C);function N(I){var q=c,U=f;return c=f=void 0,w=I,v=o.apply(U,q),v}function A(I){return w=I,y=setTimeout(D,l),T?N(I):v}function O(I){var q=I-S,U=I-w,W=l-q;return _?a(W,p-U):W}function j(I){var q=I-S,U=I-w;return S===void 0||q>=l||q<0||_&&U>=p}function D(){var I=e();if(j(I))return F(I);y=setTimeout(D,O(I))}function F(I){return y=void 0,C&&c?N(I):(c=f=void 0,v)}function B(){y!==void 0&&clearTimeout(y),w=0,c=S=f=y=void 0}function $(){return y===void 0?v:F(e())}function Z(){var I=e(),q=j(I);if(c=arguments,f=this,S=I,q){if(y===void 0)return A(S);if(_)return clearTimeout(y),y=setTimeout(D,l),N(S)}return y===void 0&&(y=setTimeout(D,l)),v}return Z.cancel=B,Z.flush=$,Z}return sw=s,sw}var VF=GF(),n0=e0(VF),ow=Ui?Ui.performance:null,nA=ow&&ow.now?function(){return ow.now()}:function(){return Date.now()},HF=(function(){if(Ui){if(Ui.requestAnimationFrame)return function(t){Ui.requestAnimationFrame(t)};if(Ui.mozRequestAnimationFrame)return function(t){Ui.mozRequestAnimationFrame(t)};if(Ui.webkitRequestAnimationFrame)return function(t){Ui.webkitRequestAnimationFrame(t)};if(Ui.msRequestAnimationFrame)return function(t){Ui.msRequestAnimationFrame(t)}}return function(t){t&&setTimeout(function(){t(nA())},1e3/60)}})(),cx=function(e){return HF(e)},yc=nA,Jf=9261,iA=65599,Np=5381,aA=function(e){for(var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Jf,n=r,i;i=e.next(),!i.done;)n=n*iA+i.value|0;return n},Sv=function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Jf;return r*iA+e|0},kv=function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Np;return(r<<5)+r+e|0},WF=function(e,r){return e*2097152+r},xd=function(e){return e[0]*2097152+e[1]},ty=function(e,r){return[Sv(e[0],r[0]),kv(e[1],r[1])]},aT=function(e,r){var n={value:0,done:!1},i=0,a=e.length,s={next:function(){return i<a?n.value=e[i++]:n.done=!0,n}};return aA(s,r)},vh=function(e,r){var n={value:0,done:!1},i=0,a=e.length,s={next:function(){return i<a?n.value=e.charCodeAt(i++):n.done=!0,n}};return aA(s,r)},sA=function(){return qF(arguments)},qF=function(e){for(var r,n=0;n<e.length;n++){var i=e[n];n===0?r=vh(i):r=vh(i,r)}return r};function $F(t,e,r,n,i){var a=i*Math.PI/180,s=Math.cos(a)*(t-r)-Math.sin(a)*(e-n)+r,o=Math.sin(a)*(t-r)+Math.cos(a)*(e-n)+n;return{x:s,y:o}}var KF=function(e,r,n,i,a,s){return{x:(e-n)*a+n,y:(r-i)*s+i}};function ZF(t,e,r){if(r===0)return t;var n=(e.x1+e.x2)/2,i=(e.y1+e.y2)/2,a=e.w/e.h,s=1/a,o=$F(t.x,t.y,n,i,r),l=KF(o.x,o.y,n,i,a,s);return{x:l.x,y:l.y}}var sT=!0,YF=console.warn!=null,XF=console.trace!=null,u_=Number.MAX_SAFE_INTEGER||9007199254740991,oA=function(){return!0},dx=function(){return!1},oT=function(){return 0},c_=function(){},Gn=function(e){throw new Error(e)},lA=function(e){if(e!==void 0)sT=!!e;else return sT},Yr=function(e){lA()&&(YF?console.warn(e):(console.log(e),XF&&console.trace()))},QF=function(e){return Jt({},e)},bu=function(e){return e==null?e:pn(e)?e.slice():Ir(e)?QF(e):e},JF=function(e){return e.slice()},uA=function(e,r){for(r=e="";e++<36;r+=e*51&52?(e^15?8^Math.random()*(e^20?16:4):4).toString(16):"-");return r},e9={},cA=function(){return e9},Ua=function(e){var r=Object.keys(e);return function(n){for(var i={},a=0;a<r.length;a++){var s=r[a],o=n?.[s];i[s]=o===void 0?e[s]:o}return i}},Qd=function(e,r,n){for(var i=e.length-1;i>=0;i--)e[i]===r&&e.splice(i,1)},d_=function(e){e.splice(0,e.length)},t9=function(e,r){for(var n=0;n<r.length;n++){var i=r[n];e.push(i)}},Gs=function(e,r,n){return n&&(r=XM(n,r)),e[r]},dc=function(e,r,n,i){n&&(r=XM(n,r)),e[r]=i},r9=(function(){function t(){lf(this,t),this._obj={}}return uf(t,[{key:"set",value:function(r,n){return this._obj[r]=n,this}},{key:"delete",value:function(r){return this._obj[r]=void 0,this}},{key:"clear",value:function(){this._obj={}}},{key:"has",value:function(r){return this._obj[r]!==void 0}},{key:"get",value:function(r){return this._obj[r]}}])})(),fc=typeof Map<"u"?Map:r9,n9="undefined",i9=(function(){function t(e){if(lf(this,t),this._obj=Object.create(null),this.size=0,e!=null){var r;e.instanceString!=null&&e.instanceString()===this.instanceString()?r=e.toArray():r=e;for(var n=0;n<r.length;n++)this.add(r[n])}}return uf(t,[{key:"instanceString",value:function(){return"set"}},{key:"add",value:function(r){var n=this._obj;n[r]!==1&&(n[r]=1,this.size++)}},{key:"delete",value:function(r){var n=this._obj;n[r]===1&&(n[r]=0,this.size--)}},{key:"clear",value:function(){this._obj=Object.create(null)}},{key:"has",value:function(r){return this._obj[r]===1}},{key:"toArray",value:function(){var r=this;return Object.keys(this._obj).filter(function(n){return r.has(n)})}},{key:"forEach",value:function(r,n){return this.toArray().forEach(r,n)}}])})(),fm=(typeof Set>"u"?"undefined":Hi(Set))!==n9?Set:i9,C1=function(e,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(e===void 0||r===void 0||!s_(e)){Gn("An element must have a core reference and parameters set");return}var i=r.group;if(i==null&&(r.data&&r.data.source!=null&&r.data.target!=null?i="edges":i="nodes"),i!=="nodes"&&i!=="edges"){Gn("An element must be of type `nodes` or `edges`; you specified `"+i+"`");return}this.length=1,this[0]=this;var a=this._private={cy:e,single:!0,data:r.data||{},position:r.position||{x:0,y:0},autoWidth:void 0,autoHeight:void 0,autoPadding:void 0,compoundBoundsClean:!1,listeners:[],group:i,style:{},rstyle:{},styleCxts:[],styleKeys:{},removed:!0,selected:!!r.selected,selectable:r.selectable===void 0?!0:!!r.selectable,locked:!!r.locked,grabbed:!1,grabbable:r.grabbable===void 0?!0:!!r.grabbable,pannable:r.pannable===void 0?i==="edges":!!r.pannable,active:!1,classes:new fm,animation:{current:[],queue:[]},rscratch:{},scratch:r.scratch||{},edges:[],children:[],parent:r.parent&&r.parent.isNode()?r.parent:null,traversalCache:{},backgrounding:!1,bbCache:null,bbCacheShift:{x:0,y:0},bodyBounds:null,overlayBounds:null,labelBounds:{all:null,source:null,target:null,main:null},arrowBounds:{source:null,target:null,"mid-source":null,"mid-target":null}};if(a.position.x==null&&(a.position.x=0),a.position.y==null&&(a.position.y=0),r.renderedPosition){var s=r.renderedPosition,o=e.pan(),l=e.zoom();a.position={x:(s.x-o.x)/l,y:(s.y-o.y)/l}}var u=[];pn(r.classes)?u=r.classes:Wt(r.classes)&&(u=r.classes.split(/\s+/));for(var c=0,f=u.length;c<f;c++){var p=u[c];!p||p===""||a.classes.add(p)}this.createEmitter(),(n===void 0||n)&&this.restore();var v=r.style||r.css;v&&(Yr("Setting a `style` bypass at element creation should be done only when absolutely necessary.  Try to use the stylesheet instead."),this.style(v))},lT=function(e){return e={bfs:e.bfs||!e.dfs,dfs:e.dfs||!e.bfs},function(n,i,a){var s;Ir(n)&&!uo(n)&&(s=n,n=s.roots||s.root,i=s.visit,a=s.directed),a=arguments.length===2&&!Kn(i)?i:a,i=Kn(i)?i:function(){};for(var o=this._private.cy,l=n=Wt(n)?this.filter(n):n,u=[],c=[],f={},p={},v={},y=0,S,w=this.byGroup(),T=w.nodes,_=w.edges,C=0;C<l.length;C++){var N=l[C],A=N.id();N.isNode()&&(u.unshift(N),e.bfs&&(v[A]=!0,c.push(N)),p[A]=0)}for(var O=function(){var I=e.bfs?u.shift():u.pop(),q=I.id();if(e.dfs){if(v[q])return 0;v[q]=!0,c.push(I)}var U=p[q],W=f[q],Y=W!=null?W.source():null,Q=W!=null?W.target():null,ne=W==null?void 0:I.same(Y)?Q[0]:Y[0],re;if(re=i(I,W,ne,y++,U),re===!0)return S=I,1;if(re===!1)return 1;for(var H=I.connectedEdges().filter(function(ye){return(!a||ye.source().same(I))&&_.has(ye)}),te=0;te<H.length;te++){var ie=H[te],de=ie.connectedNodes().filter(function(ye){return!ye.same(I)&&T.has(ye)}),ge=de.id();de.length!==0&&!v[ge]&&(de=de[0],u.push(de),e.bfs&&(v[ge]=!0,c.push(de)),f[ge]=ie,p[ge]=p[q]+1)}},j;u.length!==0&&(j=O(),!(j!==0&&j===1)););for(var D=o.collection(),F=0;F<c.length;F++){var B=c[F],$=f[B.id()];$!=null&&D.push($),D.push(B)}return{path:o.collection(D),found:o.collection(S)}}},_v={breadthFirstSearch:lT({bfs:!0}),depthFirstSearch:lT({dfs:!0})};_v.bfs=_v.breadthFirstSearch;_v.dfs=_v.depthFirstSearch;var By={exports:{}},a9=By.exports,uT;function s9(){return uT||(uT=1,(function(t,e){(function(){var r,n,i,a,s,o,l,u,c,f,p,v,y,S,w;i=Math.floor,f=Math.min,n=function(T,_){return T<_?-1:T>_?1:0},c=function(T,_,C,N,A){var O;if(C==null&&(C=0),A==null&&(A=n),C<0)throw new Error("lo must be non-negative");for(N==null&&(N=T.length);C<N;)O=i((C+N)/2),A(_,T[O])<0?N=O:C=O+1;return[].splice.apply(T,[C,C-C].concat(_)),_},o=function(T,_,C){return C==null&&(C=n),T.push(_),S(T,0,T.length-1,C)},s=function(T,_){var C,N;return _==null&&(_=n),C=T.pop(),T.length?(N=T[0],T[0]=C,w(T,0,_)):N=C,N},u=function(T,_,C){var N;return C==null&&(C=n),N=T[0],T[0]=_,w(T,0,C),N},l=function(T,_,C){var N;return C==null&&(C=n),T.length&&C(T[0],_)<0&&(N=[T[0],_],_=N[0],T[0]=N[1],w(T,0,C)),_},a=function(T,_){var C,N,A,O,j,D;for(_==null&&(_=n),O=(function(){D=[];for(var F=0,B=i(T.length/2);0<=B?F<B:F>B;0<=B?F++:F--)D.push(F);return D}).apply(this).reverse(),j=[],N=0,A=O.length;N<A;N++)C=O[N],j.push(w(T,C,_));return j},y=function(T,_,C){var N;if(C==null&&(C=n),N=T.indexOf(_),N!==-1)return S(T,0,N,C),w(T,N,C)},p=function(T,_,C){var N,A,O,j,D;if(C==null&&(C=n),A=T.slice(0,_),!A.length)return A;for(a(A,C),D=T.slice(_),O=0,j=D.length;O<j;O++)N=D[O],l(A,N,C);return A.sort(C).reverse()},v=function(T,_,C){var N,A,O,j,D,F,B,$,Z;if(C==null&&(C=n),_*10<=T.length){if(O=T.slice(0,_).sort(C),!O.length)return O;for(A=O[O.length-1],B=T.slice(_),j=0,F=B.length;j<F;j++)N=B[j],C(N,A)<0&&(c(O,N,0,null,C),O.pop(),A=O[O.length-1]);return O}for(a(T,C),Z=[],D=0,$=f(_,T.length);0<=$?D<$:D>$;0<=$?++D:--D)Z.push(s(T,C));return Z},S=function(T,_,C,N){var A,O,j;for(N==null&&(N=n),A=T[C];C>_;){if(j=C-1>>1,O=T[j],N(A,O)<0){T[C]=O,C=j;continue}break}return T[C]=A},w=function(T,_,C){var N,A,O,j,D;for(C==null&&(C=n),A=T.length,D=_,O=T[_],N=2*_+1;N<A;)j=N+1,j<A&&!(C(T[N],T[j])<0)&&(N=j),T[_]=T[N],_=N,N=2*_+1;return T[_]=O,S(T,D,_,C)},r=(function(){T.push=o,T.pop=s,T.replace=u,T.pushpop=l,T.heapify=a,T.updateItem=y,T.nlargest=p,T.nsmallest=v;function T(_){this.cmp=_??n,this.nodes=[]}return T.prototype.push=function(_){return o(this.nodes,_,this.cmp)},T.prototype.pop=function(){return s(this.nodes,this.cmp)},T.prototype.peek=function(){return this.nodes[0]},T.prototype.contains=function(_){return this.nodes.indexOf(_)!==-1},T.prototype.replace=function(_){return u(this.nodes,_,this.cmp)},T.prototype.pushpop=function(_){return l(this.nodes,_,this.cmp)},T.prototype.heapify=function(){return a(this.nodes,this.cmp)},T.prototype.updateItem=function(_){return y(this.nodes,_,this.cmp)},T.prototype.clear=function(){return this.nodes=[]},T.prototype.empty=function(){return this.nodes.length===0},T.prototype.size=function(){return this.nodes.length},T.prototype.clone=function(){var _;return _=new T,_.nodes=this.nodes.slice(0),_},T.prototype.toArray=function(){return this.nodes.slice(0)},T.prototype.insert=T.prototype.push,T.prototype.top=T.prototype.peek,T.prototype.front=T.prototype.peek,T.prototype.has=T.prototype.contains,T.prototype.copy=T.prototype.clone,T})(),(function(T,_){return t.exports=_()})(this,function(){return r})}).call(a9)})(By)),By.exports}var lw,cT;function o9(){return cT||(cT=1,lw=s9()),lw}var l9=o9(),i0=e0(l9),u9=Ua({root:null,weight:function(e){return 1},directed:!1}),c9={dijkstra:function(e){if(!Ir(e)){var r=arguments;e={root:r[0],weight:r[1],directed:r[2]}}var n=u9(e),i=n.root,a=n.weight,s=n.directed,o=this,l=a,u=Wt(i)?this.filter(i)[0]:i[0],c={},f={},p={},v=this.byGroup(),y=v.nodes,S=v.edges;S.unmergeBy(function(U){return U.isLoop()});for(var w=function(W){return c[W.id()]},T=function(W,Y){c[W.id()]=Y,_.updateItem(W)},_=new i0(function(U,W){return w(U)-w(W)}),C=0;C<y.length;C++){var N=y[C];c[N.id()]=N.same(u)?0:1/0,_.push(N)}for(var A=function(W,Y){for(var Q=(s?W.edgesTo(Y):W.edgesWith(Y)).intersect(S),ne=1/0,re,H=0;H<Q.length;H++){var te=Q[H],ie=l(te);(ie<ne||!re)&&(ne=ie,re=te)}return{edge:re,dist:ne}};_.size()>0;){var O=_.pop(),j=w(O),D=O.id();if(p[D]=j,j!==1/0)for(var F=O.neighborhood().intersect(y),B=0;B<F.length;B++){var $=F[B],Z=$.id(),I=A(O,$),q=j+I.dist;q<w($)&&(T($,q),f[Z]={node:O,edge:I.edge})}}return{distanceTo:function(W){var Y=Wt(W)?y.filter(W)[0]:W[0];return p[Y.id()]},pathTo:function(W){var Y=Wt(W)?y.filter(W)[0]:W[0],Q=[],ne=Y,re=ne.id();if(Y.length>0)for(Q.unshift(Y);f[re];){var H=f[re];Q.unshift(H.edge),Q.unshift(H.node),ne=H.node,re=ne.id()}return o.spawn(Q)}}}},d9={kruskal:function(e){e=e||function(C){return 1};for(var r=this.byGroup(),n=r.nodes,i=r.edges,a=n.length,s=new Array(a),o=n,l=function(N){for(var A=0;A<s.length;A++){var O=s[A];if(O.has(N))return A}},u=0;u<a;u++)s[u]=this.spawn(n[u]);for(var c=i.sort(function(C,N){return e(C)-e(N)}),f=0;f<c.length;f++){var p=c[f],v=p.source()[0],y=p.target()[0],S=l(v),w=l(y),T=s[S],_=s[w];S!==w&&(o.merge(p),T.merge(_),s.splice(w,1))}return o}},f9=Ua({root:null,goal:null,weight:function(e){return 1},heuristic:function(e){return 0},directed:!1}),h9={aStar:function(e){var r=this.cy(),n=f9(e),i=n.root,a=n.goal,s=n.heuristic,o=n.directed,l=n.weight;i=r.collection(i)[0],a=r.collection(a)[0];var u=i.id(),c=a.id(),f={},p={},v={},y=new i0(function(re,H){return p[re.id()]-p[H.id()]}),S=new fm,w={},T={},_=function(H,te){y.push(H),S.add(te)},C,N,A=function(){C=y.pop(),N=C.id(),S.delete(N)},O=function(H){return S.has(H)};_(i,u),f[u]=0,p[u]=s(i);for(var j=0;y.size()>0;){if(A(),j++,N===c){for(var D=[],F=a,B=c,$=T[B];D.unshift(F),$!=null&&D.unshift($),F=w[B],F!=null;)B=F.id(),$=T[B];return{found:!0,distance:f[N],path:this.spawn(D),steps:j}}v[N]=!0;for(var Z=C._private.edges,I=0;I<Z.length;I++){var q=Z[I];if(this.hasElementWithId(q.id())&&!(o&&q.data("source")!==N)){var U=q.source(),W=q.target(),Y=U.id()!==N?U:W,Q=Y.id();if(this.hasElementWithId(Q)&&!v[Q]){var ne=f[N]+l(q);if(!O(Q)){f[Q]=ne,p[Q]=ne+s(Y),_(Y,Q),w[Q]=C,T[Q]=q;continue}ne<f[Q]&&(f[Q]=ne,p[Q]=ne+s(Y),w[Q]=C,T[Q]=q)}}}}return{found:!1,distance:void 0,path:void 0,steps:j}}},p9=Ua({weight:function(e){return 1},directed:!1}),m9={floydWarshall:function(e){for(var r=this.cy(),n=p9(e),i=n.weight,a=n.directed,s=i,o=this.byGroup(),l=o.nodes,u=o.edges,c=l.length,f=c*c,p=function(ie){return l.indexOf(ie)},v=function(ie){return l[ie]},y=new Array(f),S=0;S<f;S++){var w=S%c,T=(S-w)/c;T===w?y[S]=0:y[S]=1/0}for(var _=new Array(f),C=new Array(f),N=0;N<u.length;N++){var A=u[N],O=A.source()[0],j=A.target()[0];if(O!==j){var D=p(O),F=p(j),B=D*c+F,$=s(A);if(y[B]>$&&(y[B]=$,_[B]=F,C[B]=A),!a){var Z=F*c+D;!a&&y[Z]>$&&(y[Z]=$,_[Z]=D,C[Z]=A)}}}for(var I=0;I<c;I++)for(var q=0;q<c;q++)for(var U=q*c+I,W=0;W<c;W++){var Y=q*c+W,Q=I*c+W;y[U]+y[Q]<y[Y]&&(y[Y]=y[U]+y[Q],_[Y]=_[U])}var ne=function(ie){return(Wt(ie)?r.filter(ie):ie)[0]},re=function(ie){return p(ne(ie))},H={distance:function(ie,de){var ge=re(ie),ye=re(de);return y[ge*c+ye]},path:function(ie,de){var ge=re(ie),ye=re(de),ae=v(ge);if(ge===ye)return ae.collection();if(_[ge*c+ye]==null)return r.collection();var pe=r.collection(),le=ge,me;for(pe.merge(ae);ge!==ye;)le=ge,ge=_[ge*c+ye],me=C[le*c+ge],pe.merge(me),pe.merge(v(ge));return pe}};return H}},g9=Ua({weight:function(e){return 1},directed:!1,root:null}),v9={bellmanFord:function(e){var r=this,n=g9(e),i=n.weight,a=n.directed,s=n.root,o=i,l=this,u=this.cy(),c=this.byGroup(),f=c.edges,p=c.nodes,v=p.length,y=new fc,S=!1,w=[];s=u.collection(s)[0],f.unmergeBy(function(et){return et.isLoop()});for(var T=f.length,_=function(at){var je=y.get(at.id());return je||(je={},y.set(at.id(),je)),je},C=function(at){return(Wt(at)?u.$(at):at)[0]},N=function(at){return _(C(at)).dist},A=function(at){for(var je=arguments.length>1&&arguments[1]!==void 0?arguments[1]:s,Re=C(at),nt=[],Ce=Re;;){if(Ce==null)return r.spawn();var Fe=_(Ce),Ke=Fe.edge,pt=Fe.pred;if(nt.unshift(Ce[0]),Ce.same(je)&&nt.length>0)break;Ke!=null&&nt.unshift(Ke),Ce=pt}return l.spawn(nt)},O=0;O<v;O++){var j=p[O],D=_(j);j.same(s)?D.dist=0:D.dist=1/0,D.pred=null,D.edge=null}for(var F=!1,B=function(at,je,Re,nt,Ce,Fe){var Ke=nt.dist+Fe;Ke<Ce.dist&&!Re.same(nt.edge)&&(Ce.dist=Ke,Ce.pred=at,Ce.edge=Re,F=!0)},$=1;$<v;$++){F=!1;for(var Z=0;Z<T;Z++){var I=f[Z],q=I.source(),U=I.target(),W=o(I),Y=_(q),Q=_(U);B(q,U,I,Y,Q,W),a||B(U,q,I,Q,Y,W)}if(!F)break}if(F)for(var ne=[],re=0;re<T;re++){var H=f[re],te=H.source(),ie=H.target(),de=o(H),ge=_(te).dist,ye=_(ie).dist;if(ge+de<ye||!a&&ye+de<ge)if(S||(Yr("Graph contains a negative weight cycle for Bellman-Ford"),S=!0),e.findNegativeWeightCycles!==!1){var ae=[];ge+de<ye&&ae.push(te),!a&&ye+de<ge&&ae.push(ie);for(var pe=ae.length,le=0;le<pe;le++){var me=ae[le],he=[me];he.push(_(me).edge);for(var xe=_(me).pred;he.indexOf(xe)===-1;)he.push(xe),he.push(_(xe).edge),xe=_(xe).pred;he=he.slice(he.indexOf(xe));for(var we=he[0].id(),Ge=0,qe=2;qe<he.length;qe+=2)he[qe].id()<we&&(we=he[qe].id(),Ge=qe);he=he.slice(Ge).concat(he.slice(0,Ge)),he.push(he[0]);var wt=he.map(function(et){return et.id()}).join(",");ne.indexOf(wt)===-1&&(w.push(l.spawn(he)),ne.push(wt))}}else break}return{distanceTo:N,pathTo:A,hasNegativeWeightCycle:S,negativeWeightCycles:w}}},y9=Math.sqrt(2),x9=function(e,r,n){n.length===0&&Gn("Karger-Stein must be run on a connected (sub)graph");for(var i=n[e],a=i[1],s=i[2],o=r[a],l=r[s],u=n,c=u.length-1;c>=0;c--){var f=u[c],p=f[1],v=f[2];(r[p]===o&&r[v]===l||r[p]===l&&r[v]===o)&&u.splice(c,1)}for(var y=0;y<u.length;y++){var S=u[y];S[1]===l?(u[y]=S.slice(),u[y][1]=o):S[2]===l&&(u[y]=S.slice(),u[y][2]=o)}for(var w=0;w<r.length;w++)r[w]===l&&(r[w]=o);return u},uw=function(e,r,n,i){for(;n>i;){var a=Math.floor(Math.random()*r.length);r=x9(a,e,r),n--}return r},b9={kargerStein:function(){var e=this,r=this.byGroup(),n=r.nodes,i=r.edges;i.unmergeBy(function(Q){return Q.isLoop()});var a=n.length,s=i.length,o=Math.ceil(Math.pow(Math.log(a)/Math.LN2,2)),l=Math.floor(a/y9);if(a<2){Gn("At least 2 nodes are required for Karger-Stein algorithm");return}for(var u=[],c=0;c<s;c++){var f=i[c];u.push([c,n.indexOf(f.source()),n.indexOf(f.target())])}for(var p=1/0,v=[],y=new Array(a),S=new Array(a),w=new Array(a),T=function(ne,re){for(var H=0;H<a;H++)re[H]=ne[H]},_=0;_<=o;_++){for(var C=0;C<a;C++)S[C]=C;var N=uw(S,u.slice(),a,l),A=N.slice();T(S,w);var O=uw(S,N,l,2),j=uw(w,A,l,2);O.length<=j.length&&O.length<p?(p=O.length,v=O,T(S,y)):j.length<=O.length&&j.length<p&&(p=j.length,v=j,T(w,y))}for(var D=this.spawn(v.map(function(Q){return i[Q[0]]})),F=this.spawn(),B=this.spawn(),$=y[0],Z=0;Z<y.length;Z++){var I=y[Z],q=n[Z];I===$?F.merge(q):B.merge(q)}var U=function(ne){var re=e.spawn();return ne.forEach(function(H){re.merge(H),H.connectedEdges().forEach(function(te){e.contains(te)&&!D.contains(te)&&re.merge(te)})}),re},W=[U(F),U(B)],Y={cut:D,components:W,partition1:F,partition2:B};return Y}},cw,w9=function(e){return{x:e.x,y:e.y}},E1=function(e,r,n){return{x:e.x*r+n.x,y:e.y*r+n.y}},dA=function(e,r,n){return{x:(e.x-n.x)/r,y:(e.y-n.y)/r}},Dp=function(e){return{x:e[0],y:e[1]}},S9=function(e){for(var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:e.length,i=1/0,a=r;a<n;a++){var s=e[a];isFinite(s)&&(i=Math.min(s,i))}return i},k9=function(e){for(var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:e.length,i=-1/0,a=r;a<n;a++){var s=e[a];isFinite(s)&&(i=Math.max(s,i))}return i},_9=function(e){for(var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:e.length,i=0,a=0,s=r;s<n;s++){var o=e[s];isFinite(o)&&(i+=o,a++)}return i/a},C9=function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:e.length,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0,a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!0;i?e=e.slice(r,n):(n<e.length&&e.splice(n,e.length-n),r>0&&e.splice(0,r));for(var o=0,l=e.length-1;l>=0;l--){var u=e[l];s?isFinite(u)||(e[l]=-1/0,o++):e.splice(l,1)}a&&e.sort(function(p,v){return p-v});var c=e.length,f=Math.floor(c/2);return c%2!==0?e[f+1+o]:(e[f-1+o]+e[f+o])/2},E9=function(e){return Math.PI*e/180},ry=function(e,r){return Math.atan2(r,e)-Math.PI/2},f_=Math.log2||function(t){return Math.log(t)/Math.log(2)},h_=function(e){return e>0?1:e<0?-1:0},yh=function(e,r){return Math.sqrt(Yf(e,r))},Yf=function(e,r){var n=r.x-e.x,i=r.y-e.y;return n*n+i*i},T9=function(e){for(var r=e.length,n=0,i=0;i<r;i++)n+=e[i];for(var a=0;a<r;a++)e[a]=e[a]/n;return e},sa=function(e,r,n,i){return(1-i)*(1-i)*e+2*(1-i)*i*r+i*i*n},zp=function(e,r,n,i){return{x:sa(e.x,r.x,n.x,i),y:sa(e.y,r.y,n.y,i)}},N9=function(e,r,n,i){var a={x:r.x-e.x,y:r.y-e.y},s=yh(e,r),o={x:a.x/s,y:a.y/s};return n=n??0,i=i??n*s,{x:e.x+o.x*i,y:e.y+o.y*i}},Cv=function(e,r,n){return Math.max(e,Math.min(n,r))},_s=function(e){if(e==null)return{x1:1/0,y1:1/0,x2:-1/0,y2:-1/0,w:0,h:0};if(e.x1!=null&&e.y1!=null){if(e.x2!=null&&e.y2!=null&&e.x2>=e.x1&&e.y2>=e.y1)return{x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,w:e.x2-e.x1,h:e.y2-e.y1};if(e.w!=null&&e.h!=null&&e.w>=0&&e.h>=0)return{x1:e.x1,y1:e.y1,x2:e.x1+e.w,y2:e.y1+e.h,w:e.w,h:e.h}}},P9=function(e){return{x1:e.x1,x2:e.x2,w:e.w,y1:e.y1,y2:e.y2,h:e.h}},M9=function(e){e.x1=1/0,e.y1=1/0,e.x2=-1/0,e.y2=-1/0,e.w=0,e.h=0},A9=function(e,r){e.x1=Math.min(e.x1,r.x1),e.x2=Math.max(e.x2,r.x2),e.w=e.x2-e.x1,e.y1=Math.min(e.y1,r.y1),e.y2=Math.max(e.y2,r.y2),e.h=e.y2-e.y1},fA=function(e,r,n){e.x1=Math.min(e.x1,r),e.x2=Math.max(e.x2,r),e.w=e.x2-e.x1,e.y1=Math.min(e.y1,n),e.y2=Math.max(e.y2,n),e.h=e.y2-e.y1},zy=function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return e.x1-=r,e.x2+=r,e.y1-=r,e.y2+=r,e.w=e.x2-e.x1,e.h=e.y2-e.y1,e},Uy=function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0],n,i,a,s;if(r.length===1)n=i=a=s=r[0];else if(r.length===2)n=a=r[0],s=i=r[1];else if(r.length===4){var o=Ai(r,4);n=o[0],i=o[1],a=o[2],s=o[3]}return e.x1-=s,e.x2+=i,e.y1-=n,e.y2+=a,e.w=e.x2-e.x1,e.h=e.y2-e.y1,e},dT=function(e,r){e.x1=r.x1,e.y1=r.y1,e.x2=r.x2,e.y2=r.y2,e.w=e.x2-e.x1,e.h=e.y2-e.y1},p_=function(e,r){return!(e.x1>r.x2||r.x1>e.x2||e.x2<r.x1||r.x2<e.x1||e.y2<r.y1||r.y2<e.y1||e.y1>r.y2||r.y1>e.y2)},Id=function(e,r,n){return e.x1<=r&&r<=e.x2&&e.y1<=n&&n<=e.y2},fT=function(e,r){return Id(e,r.x,r.y)},hA=function(e,r){return Id(e,r.x1,r.y1)&&Id(e,r.x2,r.y2)},L9=(cw=Math.hypot)!==null&&cw!==void 0?cw:function(t,e){return Math.sqrt(t*t+e*e)};function R9(t,e){if(t.length<3)throw new Error("Need at least 3 vertices");var r=function(D,F){return{x:D.x+F.x,y:D.y+F.y}},n=function(D,F){return{x:D.x-F.x,y:D.y-F.y}},i=function(D,F){return{x:D.x*F,y:D.y*F}},a=function(D,F){return D.x*F.y-D.y*F.x},s=function(D){var F=L9(D.x,D.y);return F===0?{x:0,y:0}:{x:D.x/F,y:D.y/F}},o=function(D){for(var F=0,B=0;B<D.length;B++){var $=D[B],Z=D[(B+1)%D.length];F+=$.x*Z.y-Z.x*$.y}return F/2},l=function(D,F,B,$){var Z=n(F,D),I=n($,B),q=a(Z,I);if(Math.abs(q)<1e-9)return r(D,i(Z,.5));var U=a(n(B,D),I)/q;return r(D,i(Z,U))},u=t.map(function(j){return{x:j.x,y:j.y}});o(u)<0&&u.reverse();for(var c=u.length,f=[],p=0;p<c;p++){var v=u[p],y=u[(p+1)%c],S=n(y,v),w=s({x:S.y,y:-S.x});f.push(w)}for(var T=f.map(function(j,D){var F=r(u[D],i(j,e)),B=r(u[(D+1)%c],i(j,e));return{p1:F,p2:B}}),_=[],C=0;C<c;C++){var N=T[(C-1+c)%c],A=T[C],O=l(N.p1,N.p2,A.p1,A.p2);_.push(O)}return _}function O9(t,e,r,n,i,a){var s=V9(t,e,r,n,i),o=R9(s,a),l=_s();return o.forEach(function(u){return fA(l,u.x,u.y)}),l}var pA=function(e,r,n,i,a,s,o){var l=arguments.length>7&&arguments[7]!==void 0?arguments[7]:"auto",u=l==="auto"?Jd(a,s):l,c=a/2,f=s/2;u=Math.min(u,c,f);var p=u!==c,v=u!==f,y;if(p){var S=n-c+u-o,w=i-f-o,T=n+c-u+o,_=w;if(y=jd(e,r,n,i,S,w,T,_,!1),y.length>0)return y}if(v){var C=n+c+o,N=i-f+u-o,A=C,O=i+f-u+o;if(y=jd(e,r,n,i,C,N,A,O,!1),y.length>0)return y}if(p){var j=n-c+u-o,D=i+f+o,F=n+c-u+o,B=D;if(y=jd(e,r,n,i,j,D,F,B,!1),y.length>0)return y}if(v){var $=n-c-o,Z=i-f+u-o,I=$,q=i+f-u+o;if(y=jd(e,r,n,i,$,Z,I,q,!1),y.length>0)return y}var U;{var W=n-c+u,Y=i-f+u;if(U=Kg(e,r,n,i,W,Y,u+o),U.length>0&&U[0]<=W&&U[1]<=Y)return[U[0],U[1]]}{var Q=n+c-u,ne=i-f+u;if(U=Kg(e,r,n,i,Q,ne,u+o),U.length>0&&U[0]>=Q&&U[1]<=ne)return[U[0],U[1]]}{var re=n+c-u,H=i+f-u;if(U=Kg(e,r,n,i,re,H,u+o),U.length>0&&U[0]>=re&&U[1]>=H)return[U[0],U[1]]}{var te=n-c+u,ie=i+f-u;if(U=Kg(e,r,n,i,te,ie,u+o),U.length>0&&U[0]<=te&&U[1]>=ie)return[U[0],U[1]]}return[]},D9=function(e,r,n,i,a,s,o){var l=o,u=Math.min(n,a),c=Math.max(n,a),f=Math.min(i,s),p=Math.max(i,s);return u-l<=e&&e<=c+l&&f-l<=r&&r<=p+l},I9=function(e,r,n,i,a,s,o,l,u){var c={x1:Math.min(n,o,a)-u,x2:Math.max(n,o,a)+u,y1:Math.min(i,l,s)-u,y2:Math.max(i,l,s)+u};return!(e<c.x1||e>c.x2||r<c.y1||r>c.y2)},j9=function(e,r,n,i){n-=i;var a=r*r-4*e*n;if(a<0)return[];var s=Math.sqrt(a),o=2*e,l=(-r+s)/o,u=(-r-s)/o;return[l,u]},F9=function(e,r,n,i,a){var s=1e-5;e===0&&(e=s),r/=e,n/=e,i/=e;var o,l,u,c,f,p,v,y;if(l=(3*n-r*r)/9,u=-(27*i)+r*(9*n-2*(r*r)),u/=54,o=l*l*l+u*u,a[1]=0,v=r/3,o>0){f=u+Math.sqrt(o),f=f<0?-Math.pow(-f,1/3):Math.pow(f,1/3),p=u-Math.sqrt(o),p=p<0?-Math.pow(-p,1/3):Math.pow(p,1/3),a[0]=-v+f+p,v+=(f+p)/2,a[4]=a[2]=-v,v=Math.sqrt(3)*(-p+f)/2,a[3]=v,a[5]=-v;return}if(a[5]=a[3]=0,o===0){y=u<0?-Math.pow(-u,1/3):Math.pow(u,1/3),a[0]=-v+2*y,a[4]=a[2]=-(y+v);return}l=-l,c=l*l*l,c=Math.acos(u/Math.sqrt(c)),y=2*Math.sqrt(l),a[0]=-v+y*Math.cos(c/3),a[2]=-v+y*Math.cos((c+2*Math.PI)/3),a[4]=-v+y*Math.cos((c+4*Math.PI)/3)},B9=function(e,r,n,i,a,s,o,l){var u=1*n*n-4*n*a+2*n*o+4*a*a-4*a*o+o*o+i*i-4*i*s+2*i*l+4*s*s-4*s*l+l*l,c=9*n*a-3*n*n-3*n*o-6*a*a+3*a*o+9*i*s-3*i*i-3*i*l-6*s*s+3*s*l,f=3*n*n-6*n*a+n*o-n*e+2*a*a+2*a*e-o*e+3*i*i-6*i*s+i*l-i*r+2*s*s+2*s*r-l*r,p=1*n*a-n*n+n*e-a*e+i*s-i*i+i*r-s*r,v=[];F9(u,c,f,p,v);for(var y=1e-7,S=[],w=0;w<6;w+=2)Math.abs(v[w+1])<y&&v[w]>=0&&v[w]<=1&&S.push(v[w]);S.push(1),S.push(0);for(var T=-1,_,C,N,A=0;A<S.length;A++)_=Math.pow(1-S[A],2)*n+2*(1-S[A])*S[A]*a+S[A]*S[A]*o,C=Math.pow(1-S[A],2)*i+2*(1-S[A])*S[A]*s+S[A]*S[A]*l,N=Math.pow(_-e,2)+Math.pow(C-r,2),T>=0?N<T&&(T=N):T=N;return T},z9=function(e,r,n,i,a,s){var o=[e-n,r-i],l=[a-n,s-i],u=l[0]*l[0]+l[1]*l[1],c=o[0]*o[0]+o[1]*o[1],f=o[0]*l[0]+o[1]*l[1],p=f*f/u;return f<0?c:p>u?(e-a)*(e-a)+(r-s)*(r-s):c-p},Vs=function(e,r,n){for(var i,a,s,o,l,u=0,c=0;c<n.length/2;c++)if(i=n[c*2],a=n[c*2+1],c+1<n.length/2?(s=n[(c+1)*2],o=n[(c+1)*2+1]):(s=n[(c+1-n.length/2)*2],o=n[(c+1-n.length/2)*2+1]),!(i==e&&s==e))if(i>=e&&e>=s||i<=e&&e<=s)l=(e-i)/(s-i)*(o-a)+a,l>r&&u++;else continue;return u%2!==0},xc=function(e,r,n,i,a,s,o,l,u){var c=new Array(n.length),f;l[0]!=null?(f=Math.atan(l[1]/l[0]),l[0]<0?f=f+Math.PI/2:f=-f-Math.PI/2):f=l;for(var p=Math.cos(-f),v=Math.sin(-f),y=0;y<c.length/2;y++)c[y*2]=s/2*(n[y*2]*p-n[y*2+1]*v),c[y*2+1]=o/2*(n[y*2+1]*p+n[y*2]*v),c[y*2]+=i,c[y*2+1]+=a;var S;if(u>0){var w=hx(c,-u);S=fx(w)}else S=c;return Vs(e,r,S)},U9=function(e,r,n,i,a,s,o,l){for(var u=new Array(n.length*2),c=0;c<l.length;c++){var f=l[c];u[c*4+0]=f.startX,u[c*4+1]=f.startY,u[c*4+2]=f.stopX,u[c*4+3]=f.stopY;var p=Math.pow(f.cx-e,2)+Math.pow(f.cy-r,2);if(p<=Math.pow(f.radius,2))return!0}return Vs(e,r,u)},fx=function(e){for(var r=new Array(e.length/2),n,i,a,s,o,l,u,c,f=0;f<e.length/4;f++){n=e[f*4],i=e[f*4+1],a=e[f*4+2],s=e[f*4+3],f<e.length/4-1?(o=e[(f+1)*4],l=e[(f+1)*4+1],u=e[(f+1)*4+2],c=e[(f+1)*4+3]):(o=e[0],l=e[1],u=e[2],c=e[3]);var p=jd(n,i,a,s,o,l,u,c,!0);r[f*2]=p[0],r[f*2+1]=p[1]}return r},hx=function(e,r){for(var n=new Array(e.length*2),i,a,s,o,l=0;l<e.length/2;l++){i=e[l*2],a=e[l*2+1],l<e.length/2-1?(s=e[(l+1)*2],o=e[(l+1)*2+1]):(s=e[0],o=e[1]);var u=o-a,c=-(s-i),f=Math.sqrt(u*u+c*c),p=u/f,v=c/f;n[l*4]=i+p*r,n[l*4+1]=a+v*r,n[l*4+2]=s+p*r,n[l*4+3]=o+v*r}return n},G9=function(e,r,n,i,a,s){var o=n-e,l=i-r;o/=a,l/=s;var u=Math.sqrt(o*o+l*l),c=u-1;if(c<0)return[];var f=c/u;return[(n-e)*f+e,(i-r)*f+r]},ih=function(e,r,n,i,a,s,o){return e-=a,r-=s,e/=n/2+o,r/=i/2+o,e*e+r*r<=1},Kg=function(e,r,n,i,a,s,o){var l=[n-e,i-r],u=[e-a,r-s],c=l[0]*l[0]+l[1]*l[1],f=2*(u[0]*l[0]+u[1]*l[1]),p=u[0]*u[0]+u[1]*u[1]-o*o,v=f*f-4*c*p;if(v<0)return[];var y=(-f+Math.sqrt(v))/(2*c),S=(-f-Math.sqrt(v))/(2*c),w=Math.min(y,S),T=Math.max(y,S),_=[];if(w>=0&&w<=1&&_.push(w),T>=0&&T<=1&&_.push(T),_.length===0)return[];var C=_[0]*l[0]+e,N=_[0]*l[1]+r;if(_.length>1){if(_[0]==_[1])return[C,N];var A=_[1]*l[0]+e,O=_[1]*l[1]+r;return[C,N,A,O]}else return[C,N]},dw=function(e,r,n){return r<=e&&e<=n||n<=e&&e<=r?e:e<=r&&r<=n||n<=r&&r<=e?r:n},jd=function(e,r,n,i,a,s,o,l,u){var c=e-a,f=n-e,p=o-a,v=r-s,y=i-r,S=l-s,w=p*v-S*c,T=f*v-y*c,_=S*f-p*y;if(_!==0){var C=w/_,N=T/_,A=.001,O=0-A,j=1+A;return O<=C&&C<=j&&O<=N&&N<=j?[e+C*f,r+C*y]:u?[e+C*f,r+C*y]:[]}else return w===0||T===0?dw(e,n,o)===o?[o,l]:dw(e,n,a)===a?[a,s]:dw(a,o,n)===n?[n,i]:[]:[]},V9=function(e,r,n,i,a){var s=[],o=i/2,l=a/2,u=r,c=n;s.push({x:u+o*e[0],y:c+l*e[1]});for(var f=1;f<e.length/2;f++)s.push({x:u+o*e[f*2],y:c+l*e[f*2+1]});return s},Ev=function(e,r,n,i,a,s,o,l){var u=[],c,f=new Array(n.length),p=!0;s==null&&(p=!1);var v;if(p){for(var y=0;y<f.length/2;y++)f[y*2]=n[y*2]*s+i,f[y*2+1]=n[y*2+1]*o+a;if(l>0){var S=hx(f,-l);v=fx(S)}else v=f}else v=n;for(var w,T,_,C,N=0;N<v.length/2;N++)w=v[N*2],T=v[N*2+1],N<v.length/2-1?(_=v[(N+1)*2],C=v[(N+1)*2+1]):(_=v[0],C=v[1]),c=jd(e,r,i,a,w,T,_,C),c.length!==0&&u.push(c[0],c[1]);return u},H9=function(e,r,n,i,a,s,o,l,u){var c=[],f,p=new Array(n.length*2);u.forEach(function(_,C){C===0?(p[p.length-2]=_.startX,p[p.length-1]=_.startY):(p[C*4-2]=_.startX,p[C*4-1]=_.startY),p[C*4]=_.stopX,p[C*4+1]=_.stopY,f=Kg(e,r,i,a,_.cx,_.cy,_.radius),f.length!==0&&c.push(f[0],f[1])});for(var v=0;v<p.length/4;v++)f=jd(e,r,i,a,p[v*4],p[v*4+1],p[v*4+2],p[v*4+3],!1),f.length!==0&&c.push(f[0],f[1]);if(c.length>2){for(var y=[c[0],c[1]],S=Math.pow(y[0]-e,2)+Math.pow(y[1]-r,2),w=1;w<c.length/2;w++){var T=Math.pow(c[w*2]-e,2)+Math.pow(c[w*2+1]-r,2);T<=S&&(y[0]=c[w*2],y[1]=c[w*2+1],S=T)}return y}return c},ny=function(e,r,n){var i=[e[0]-r[0],e[1]-r[1]],a=Math.sqrt(i[0]*i[0]+i[1]*i[1]),s=(a-n)/a;return s<0&&(s=1e-5),[r[0]+s*i[0],r[1]+s*i[1]]},ks=function(e,r){var n=zS(e,r);return n=mA(n),n},mA=function(e){for(var r,n,i=e.length/2,a=1/0,s=1/0,o=-1/0,l=-1/0,u=0;u<i;u++)r=e[2*u],n=e[2*u+1],a=Math.min(a,r),o=Math.max(o,r),s=Math.min(s,n),l=Math.max(l,n);for(var c=2/(o-a),f=2/(l-s),p=0;p<i;p++)r=e[2*p]=e[2*p]*c,n=e[2*p+1]=e[2*p+1]*f,a=Math.min(a,r),o=Math.max(o,r),s=Math.min(s,n),l=Math.max(l,n);if(s<-1)for(var v=0;v<i;v++)n=e[2*v+1]=e[2*v+1]+(-1-s);return e},zS=function(e,r){var n=1/e*2*Math.PI,i=e%2===0?Math.PI/2+n/2:Math.PI/2;i+=r;for(var a=new Array(e*2),s,o=0;o<e;o++)s=o*n+i,a[2*o]=Math.cos(s),a[2*o+1]=Math.sin(-s);return a},Jd=function(e,r){return Math.min(e/4,r/4,8)},gA=function(e,r){return Math.min(e/10,r/10,8)},m_=function(){return 8},W9=function(e,r,n){return[e-2*r+n,2*(r-e),e]},US=function(e,r){return{heightOffset:Math.min(15,.05*r),widthOffset:Math.min(100,.25*e),ctrlPtOffsetPct:.05}};function fw(t,e){function r(f){for(var p=[],v=0;v<f.length;v++){var y=f[v],S=f[(v+1)%f.length],w={x:S.x-y.x,y:S.y-y.y},T={x:-w.y,y:w.x},_=Math.sqrt(T.x*T.x+T.y*T.y);p.push({x:T.x/_,y:T.y/_})}return p}function n(f,p){var v=1/0,y=-1/0,S=Ws(f),w;try{for(S.s();!(w=S.n()).done;){var T=w.value,_=T.x*p.x+T.y*p.y;v=Math.min(v,_),y=Math.max(y,_)}}catch(C){S.e(C)}finally{S.f()}return{min:v,max:y}}function i(f,p){return!(f.max<p.min||p.max<f.min)}var a=[].concat(lx(r(t)),lx(r(e))),s=Ws(a),o;try{for(s.s();!(o=s.n()).done;){var l=o.value,u=n(t,l),c=n(e,l);if(!i(u,c))return!1}}catch(f){s.e(f)}finally{s.f()}return!0}var q9=Ua({dampingFactor:.8,precision:1e-6,iterations:200,weight:function(e){return 1}}),$9={pageRank:function(e){for(var r=q9(e),n=r.dampingFactor,i=r.precision,a=r.iterations,s=r.weight,o=this._private.cy,l=this.byGroup(),u=l.nodes,c=l.edges,f=u.length,p=f*f,v=c.length,y=new Array(p),S=new Array(f),w=(1-n)/f,T=0;T<f;T++){for(var _=0;_<f;_++){var C=T*f+_;y[C]=0}S[T]=0}for(var N=0;N<v;N++){var A=c[N],O=A.data("source"),j=A.data("target");if(O!==j){var D=u.indexOfId(O),F=u.indexOfId(j),B=s(A),$=F*f+D;y[$]+=B,S[D]+=B}}for(var Z=1/f+w,I=0;I<f;I++)if(S[I]===0)for(var q=0;q<f;q++){var U=q*f+I;y[U]=Z}else for(var W=0;W<f;W++){var Y=W*f+I;y[Y]=y[Y]/S[I]+w}for(var Q=new Array(f),ne=new Array(f),re,H=0;H<f;H++)Q[H]=1;for(var te=0;te<a;te++){for(var ie=0;ie<f;ie++)ne[ie]=0;for(var de=0;de<f;de++)for(var ge=0;ge<f;ge++){var ye=de*f+ge;ne[de]+=y[ye]*Q[ge]}T9(ne),re=Q,Q=ne,ne=re;for(var ae=0,pe=0;pe<f;pe++){var le=re[pe]-Q[pe];ae+=le*le}if(ae<i)break}var me={rank:function(xe){return xe=o.collection(xe)[0],Q[u.indexOf(xe)]}};return me}},hT=Ua({root:null,weight:function(e){return 1},directed:!1,alpha:0}),Up={degreeCentralityNormalized:function(e){e=hT(e);var r=this.cy(),n=this.nodes(),i=n.length;if(e.directed){for(var c={},f={},p=0,v=0,y=0;y<i;y++){var S=n[y],w=S.id();e.root=S;var T=this.degreeCentrality(e);p<T.indegree&&(p=T.indegree),v<T.outdegree&&(v=T.outdegree),c[w]=T.indegree,f[w]=T.outdegree}return{indegree:function(C){return p==0?0:(Wt(C)&&(C=r.filter(C)),c[C.id()]/p)},outdegree:function(C){return v===0?0:(Wt(C)&&(C=r.filter(C)),f[C.id()]/v)}}}else{for(var a={},s=0,o=0;o<i;o++){var l=n[o];e.root=l;var u=this.degreeCentrality(e);s<u.degree&&(s=u.degree),a[l.id()]=u.degree}return{degree:function(C){return s===0?0:(Wt(C)&&(C=r.filter(C)),a[C.id()]/s)}}}},degreeCentrality:function(e){e=hT(e);var r=this.cy(),n=this,i=e,a=i.root,s=i.weight,o=i.directed,l=i.alpha;if(a=r.collection(a)[0],o){for(var v=a.connectedEdges(),y=v.filter(function(O){return O.target().same(a)&&n.has(O)}),S=v.filter(function(O){return O.source().same(a)&&n.has(O)}),w=y.length,T=S.length,_=0,C=0,N=0;N<y.length;N++)_+=s(y[N]);for(var A=0;A<S.length;A++)C+=s(S[A]);return{indegree:Math.pow(w,1-l)*Math.pow(_,l),outdegree:Math.pow(T,1-l)*Math.pow(C,l)}}else{for(var u=a.connectedEdges().intersection(n),c=u.length,f=0,p=0;p<u.length;p++)f+=s(u[p]);return{degree:Math.pow(c,1-l)*Math.pow(f,l)}}}};Up.dc=Up.degreeCentrality;Up.dcn=Up.degreeCentralityNormalised=Up.degreeCentralityNormalized;var pT=Ua({harmonic:!0,weight:function(){return 1},directed:!1,root:null}),Gp={closenessCentralityNormalized:function(e){for(var r=pT(e),n=r.harmonic,i=r.weight,a=r.directed,s=this.cy(),o={},l=0,u=this.nodes(),c=this.floydWarshall({weight:i,directed:a}),f=0;f<u.length;f++){for(var p=0,v=u[f],y=0;y<u.length;y++)if(f!==y){var S=c.distance(v,u[y]);n?p+=1/S:p+=S}n||(p=1/p),l<p&&(l=p),o[v.id()]=p}return{closeness:function(T){return l==0?0:(Wt(T)?T=s.filter(T)[0].id():T=T.id(),o[T]/l)}}},closenessCentrality:function(e){var r=pT(e),n=r.root,i=r.weight,a=r.directed,s=r.harmonic;n=this.filter(n)[0];for(var o=this.dijkstra({root:n,weight:i,directed:a}),l=0,u=this.nodes(),c=0;c<u.length;c++){var f=u[c];if(!f.same(n)){var p=o.distanceTo(f);s?l+=1/p:l+=p}}return s?l:1/l}};Gp.cc=Gp.closenessCentrality;Gp.ccn=Gp.closenessCentralityNormalised=Gp.closenessCentralityNormalized;var K9=Ua({weight:null,directed:!1}),GS={betweennessCentrality:function(e){for(var r=K9(e),n=r.directed,i=r.weight,a=i!=null,s=this.cy(),o=this.nodes(),l={},u={},c=0,f={set:function(C,N){u[C]=N,N>c&&(c=N)},get:function(C){return u[C]}},p=0;p<o.length;p++){var v=o[p],y=v.id();n?l[y]=v.outgoers().nodes():l[y]=v.openNeighborhood().nodes(),f.set(y,0)}for(var S=function(){for(var C=o[w].id(),N=[],A={},O={},j={},D=new i0(function(de,ge){return j[de]-j[ge]}),F=0;F<o.length;F++){var B=o[F].id();A[B]=[],O[B]=0,j[B]=1/0}for(O[C]=1,j[C]=0,D.push(C);!D.empty();){var $=D.pop();if(N.push($),a)for(var Z=0;Z<l[$].length;Z++){var I=l[$][Z],q=s.getElementById($),U=void 0;q.edgesTo(I).length>0?U=q.edgesTo(I)[0]:U=I.edgesTo(q)[0];var W=i(U);I=I.id(),j[I]>j[$]+W&&(j[I]=j[$]+W,D.nodes.indexOf(I)<0?D.push(I):D.updateItem(I),O[I]=0,A[I]=[]),j[I]==j[$]+W&&(O[I]=O[I]+O[$],A[I].push($))}else for(var Y=0;Y<l[$].length;Y++){var Q=l[$][Y].id();j[Q]==1/0&&(D.push(Q),j[Q]=j[$]+1),j[Q]==j[$]+1&&(O[Q]=O[Q]+O[$],A[Q].push($))}}for(var ne={},re=0;re<o.length;re++)ne[o[re].id()]=0;for(;N.length>0;){for(var H=N.pop(),te=0;te<A[H].length;te++){var ie=A[H][te];ne[ie]=ne[ie]+O[ie]/O[H]*(1+ne[H])}H!=o[w].id()&&f.set(H,f.get(H)+ne[H])}},w=0;w<o.length;w++)S();var T={betweenness:function(C){var N=s.collection(C).id();return f.get(N)},betweennessNormalized:function(C){if(c==0)return 0;var N=s.collection(C).id();return f.get(N)/c}};return T.betweennessNormalised=T.betweennessNormalized,T}};GS.bc=GS.betweennessCentrality;var Z9=Ua({expandFactor:2,inflateFactor:2,multFactor:1,maxIterations:20,attributes:[function(t){return 1}]}),Y9=function(e){return Z9(e)},X9=function(e,r){for(var n=0,i=0;i<r.length;i++)n+=r[i](e);return n},Q9=function(e,r,n){for(var i=0;i<r;i++)e[i*r+i]=n},vA=function(e,r){for(var n,i=0;i<r;i++){n=0;for(var a=0;a<r;a++)n+=e[a*r+i];for(var s=0;s<r;s++)e[s*r+i]=e[s*r+i]/n}},J9=function(e,r,n){for(var i=new Array(n*n),a=0;a<n;a++){for(var s=0;s<n;s++)i[a*n+s]=0;for(var o=0;o<n;o++)for(var l=0;l<n;l++)i[a*n+l]+=e[a*n+o]*r[o*n+l]}return i},eB=function(e,r,n){for(var i=e.slice(0),a=1;a<n;a++)e=J9(e,i,r);return e},tB=function(e,r,n){for(var i=new Array(r*r),a=0;a<r*r;a++)i[a]=Math.pow(e[a],n);return vA(i,r),i},rB=function(e,r,n,i){for(var a=0;a<n;a++){var s=Math.round(e[a]*Math.pow(10,i))/Math.pow(10,i),o=Math.round(r[a]*Math.pow(10,i))/Math.pow(10,i);if(s!==o)return!1}return!0},nB=function(e,r,n,i){for(var a=[],s=0;s<r;s++){for(var o=[],l=0;l<r;l++)Math.round(e[s*r+l]*1e3)/1e3>0&&o.push(n[l]);o.length!==0&&a.push(i.collection(o))}return a},iB=function(e,r){for(var n=0;n<e.length;n++)if(!r[n]||e[n].id()!==r[n].id())return!1;return!0},aB=function(e){for(var r=0;r<e.length;r++)for(var n=0;n<e.length;n++)r!=n&&iB(e[r],e[n])&&e.splice(n,1);return e},mT=function(e){for(var r=this.nodes(),n=this.edges(),i=this.cy(),a=Y9(e),s={},o=0;o<r.length;o++)s[r[o].id()]=o;for(var l=r.length,u=l*l,c=new Array(u),f,p=0;p<u;p++)c[p]=0;for(var v=0;v<n.length;v++){var y=n[v],S=s[y.source().id()],w=s[y.target().id()],T=X9(y,a.attributes);c[S*l+w]+=T,c[w*l+S]+=T}Q9(c,l,a.multFactor),vA(c,l);for(var _=!0,C=0;_&&C<a.maxIterations;)_=!1,f=eB(c,l,a.expandFactor),c=tB(f,l,a.inflateFactor),rB(c,f,u,4)||(_=!0),C++;var N=nB(c,l,r,i);return N=aB(N),N},sB={markovClustering:mT,mcl:mT},oB=function(e){return e},yA=function(e,r){return Math.abs(r-e)},gT=function(e,r,n){return e+yA(r,n)},vT=function(e,r,n){return e+Math.pow(n-r,2)},lB=function(e){return Math.sqrt(e)},uB=function(e,r,n){return Math.max(e,yA(r,n))},Wm=function(e,r,n,i,a){for(var s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:oB,o=i,l,u,c=0;c<e;c++)l=r(c),u=n(c),o=a(o,l,u);return s(o)},Zp={euclidean:function(e,r,n){return e>=2?Wm(e,r,n,0,vT,lB):Wm(e,r,n,0,gT)},squaredEuclidean:function(e,r,n){return Wm(e,r,n,0,vT)},manhattan:function(e,r,n){return Wm(e,r,n,0,gT)},max:function(e,r,n){return Wm(e,r,n,-1/0,uB)}};Zp["squared-euclidean"]=Zp.squaredEuclidean;Zp.squaredeuclidean=Zp.squaredEuclidean;function T1(t,e,r,n,i,a){var s;return Kn(t)?s=t:s=Zp[t]||Zp.euclidean,e===0&&Kn(t)?s(i,a):s(e,r,n,i,a)}var cB=Ua({k:2,m:2,sensitivityThreshold:1e-4,distance:"euclidean",maxIterations:10,attributes:[],testMode:!1,testCentroids:null}),g_=function(e){return cB(e)},px=function(e,r,n,i,a){var s=a!=="kMedoids",o=s?function(f){return n[f]}:function(f){return i[f](n)},l=function(p){return i[p](r)},u=n,c=r;return T1(e,i.length,o,l,u,c)},hw=function(e,r,n){for(var i=n.length,a=new Array(i),s=new Array(i),o=new Array(r),l=null,u=0;u<i;u++)a[u]=e.min(n[u]).value,s[u]=e.max(n[u]).value;for(var c=0;c<r;c++){l=[];for(var f=0;f<i;f++)l[f]=Math.random()*(s[f]-a[f])+a[f];o[c]=l}return o},xA=function(e,r,n,i,a){for(var s=1/0,o=0,l=0;l<r.length;l++){var u=px(n,e,r[l],i,a);u<s&&(s=u,o=l)}return o},bA=function(e,r,n){for(var i=[],a=null,s=0;s<r.length;s++)a=r[s],n[a.id()]===e&&i.push(a);return i},dB=function(e,r,n){return Math.abs(r-e)<=n},fB=function(e,r,n){for(var i=0;i<e.length;i++)for(var a=0;a<e[i].length;a++){var s=Math.abs(e[i][a]-r[i][a]);if(s>n)return!1}return!0},hB=function(e,r,n){for(var i=0;i<n;i++)if(e===r[i])return!0;return!1},yT=function(e,r){var n=new Array(r);if(e.length<50)for(var i=0;i<r;i++){for(var a=e[Math.floor(Math.random()*e.length)];hB(a,n,i);)a=e[Math.floor(Math.random()*e.length)];n[i]=a}else for(var s=0;s<r;s++)n[s]=e[Math.floor(Math.random()*e.length)];return n},xT=function(e,r,n){for(var i=0,a=0;a<r.length;a++)i+=px("manhattan",r[a],e,n,"kMedoids");return i},pB=function(e){var r=this.cy(),n=this.nodes(),i=null,a=g_(e),s=new Array(a.k),o={},l;a.testMode?typeof a.testCentroids=="number"?(a.testCentroids,l=hw(n,a.k,a.attributes)):Hi(a.testCentroids)==="object"?l=a.testCentroids:l=hw(n,a.k,a.attributes):l=hw(n,a.k,a.attributes);for(var u=!0,c=0;u&&c<a.maxIterations;){for(var f=0;f<n.length;f++)i=n[f],o[i.id()]=xA(i,l,a.distance,a.attributes,"kMeans");u=!1;for(var p=0;p<a.k;p++){var v=bA(p,n,o);if(v.length!==0){for(var y=a.attributes.length,S=l[p],w=new Array(y),T=new Array(y),_=0;_<y;_++){T[_]=0;for(var C=0;C<v.length;C++)i=v[C],T[_]+=a.attributes[_](i);w[_]=T[_]/v.length,dB(w[_],S[_],a.sensitivityThreshold)||(u=!0)}l[p]=w,s[p]=r.collection(v)}}c++}return s},mB=function(e){var r=this.cy(),n=this.nodes(),i=null,a=g_(e),s=new Array(a.k),o,l={},u,c=new Array(a.k);a.testMode?typeof a.testCentroids=="number"||(Hi(a.testCentroids)==="object"?o=a.testCentroids:o=yT(n,a.k)):o=yT(n,a.k);for(var f=!0,p=0;f&&p<a.maxIterations;){for(var v=0;v<n.length;v++)i=n[v],l[i.id()]=xA(i,o,a.distance,a.attributes,"kMedoids");f=!1;for(var y=0;y<o.length;y++){var S=bA(y,n,l);if(S.length!==0){c[y]=xT(o[y],S,a.attributes);for(var w=0;w<S.length;w++)u=xT(S[w],S,a.attributes),u<c[y]&&(c[y]=u,o[y]=S[w],f=!0);s[y]=r.collection(S)}}p++}return s},gB=function(e,r,n,i,a){for(var s,o,l=0;l<r.length;l++)for(var u=0;u<e.length;u++)i[l][u]=Math.pow(n[l][u],a.m);for(var c=0;c<e.length;c++)for(var f=0;f<a.attributes.length;f++){s=0,o=0;for(var p=0;p<r.length;p++)s+=i[p][c]*a.attributes[f](r[p]),o+=i[p][c];e[c][f]=s/o}},vB=function(e,r,n,i,a){for(var s=0;s<e.length;s++)r[s]=e[s].slice();for(var o,l,u,c=2/(a.m-1),f=0;f<n.length;f++)for(var p=0;p<i.length;p++){o=0;for(var v=0;v<n.length;v++)l=px(a.distance,i[p],n[f],a.attributes,"cmeans"),u=px(a.distance,i[p],n[v],a.attributes,"cmeans"),o+=Math.pow(l/u,c);e[p][f]=1/o}},yB=function(e,r,n,i){for(var a=new Array(n.k),s=0;s<a.length;s++)a[s]=[];for(var o,l,u=0;u<r.length;u++){o=-1/0,l=-1;for(var c=0;c<r[0].length;c++)r[u][c]>o&&(o=r[u][c],l=c);a[l].push(e[u])}for(var f=0;f<a.length;f++)a[f]=i.collection(a[f]);return a},bT=function(e){var r=this.cy(),n=this.nodes(),i=g_(e),a,s,o,l,u;l=new Array(n.length);for(var c=0;c<n.length;c++)l[c]=new Array(i.k);o=new Array(n.length);for(var f=0;f<n.length;f++)o[f]=new Array(i.k);for(var p=0;p<n.length;p++){for(var v=0,y=0;y<i.k;y++)o[p][y]=Math.random(),v+=o[p][y];for(var S=0;S<i.k;S++)o[p][S]=o[p][S]/v}s=new Array(i.k);for(var w=0;w<i.k;w++)s[w]=new Array(i.attributes.length);u=new Array(n.length);for(var T=0;T<n.length;T++)u[T]=new Array(i.k);for(var _=!0,C=0;_&&C<i.maxIterations;)_=!1,gB(s,n,o,u,i),vB(o,l,s,n,i),fB(o,l,i.sensitivityThreshold)||(_=!0),C++;return a=yB(n,o,i,r),{clusters:a,degreeOfMembership:o}},xB={kMeans:pB,kMedoids:mB,fuzzyCMeans:bT,fcm:bT},bB=Ua({distance:"euclidean",linkage:"min",mode:"threshold",threshold:1/0,addDendrogram:!1,dendrogramDepth:0,attributes:[]}),wB={single:"min",complete:"max"},SB=function(e){var r=bB(e),n=wB[r.linkage];return n!=null&&(r.linkage=n),r},wT=function(e,r,n,i,a){for(var s=0,o=1/0,l,u=a.attributes,c=function(F,B){return T1(a.distance,u.length,function($){return u[$](F)},function($){return u[$](B)},F,B)},f=0;f<e.length;f++){var p=e[f].key,v=n[p][i[p]];v<o&&(s=p,o=v)}if(a.mode==="threshold"&&o>=a.threshold||a.mode==="dendrogram"&&e.length===1)return!1;var y=r[s],S=r[i[s]],w;a.mode==="dendrogram"?w={left:y,right:S,key:y.key}:w={value:y.value.concat(S.value),key:y.key},e[y.index]=w,e.splice(S.index,1),r[y.key]=w;for(var T=0;T<e.length;T++){var _=e[T];y.key===_.key?l=1/0:a.linkage==="min"?(l=n[y.key][_.key],n[y.key][_.key]>n[S.key][_.key]&&(l=n[S.key][_.key])):a.linkage==="max"?(l=n[y.key][_.key],n[y.key][_.key]<n[S.key][_.key]&&(l=n[S.key][_.key])):a.linkage==="mean"?l=(n[y.key][_.key]*y.size+n[S.key][_.key]*S.size)/(y.size+S.size):a.mode==="dendrogram"?l=c(_.value,y.value):l=c(_.value[0],y.value[0]),n[y.key][_.key]=n[_.key][y.key]=l}for(var C=0;C<e.length;C++){var N=e[C].key;if(i[N]===y.key||i[N]===S.key){for(var A=N,O=0;O<e.length;O++){var j=e[O].key;n[N][j]<n[N][A]&&(A=j)}i[N]=A}e[C].index=C}return y.key=S.key=y.index=S.index=null,!0},Ip=function(e,r,n){e&&(e.value?r.push(e.value):(e.left&&Ip(e.left,r),e.right&&Ip(e.right,r)))},VS=function(e,r){if(!e)return"";if(e.left&&e.right){var n=VS(e.left,r),i=VS(e.right,r),a=r.add({group:"nodes",data:{id:n+","+i}});return r.add({group:"edges",data:{source:n,target:a.id()}}),r.add({group:"edges",data:{source:i,target:a.id()}}),a.id()}else if(e.value)return e.value.id()},HS=function(e,r,n){if(!e)return[];var i=[],a=[],s=[];return r===0?(e.left&&Ip(e.left,i),e.right&&Ip(e.right,a),s=i.concat(a),[n.collection(s)]):r===1?e.value?[n.collection(e.value)]:(e.left&&Ip(e.left,i),e.right&&Ip(e.right,a),[n.collection(i),n.collection(a)]):e.value?[n.collection(e.value)]:(e.left&&(i=HS(e.left,r-1,n)),e.right&&(a=HS(e.right,r-1,n)),i.concat(a))},ST=function(e){for(var r=this.cy(),n=this.nodes(),i=SB(e),a=i.attributes,s=function(C,N){return T1(i.distance,a.length,function(A){return a[A](C)},function(A){return a[A](N)},C,N)},o=[],l=[],u=[],c=[],f=0;f<n.length;f++){var p={value:i.mode==="dendrogram"?n[f]:[n[f]],key:f,index:f};o[f]=p,c[f]=p,l[f]=[],u[f]=0}for(var v=0;v<o.length;v++)for(var y=0;y<=v;y++){var S=void 0;i.mode==="dendrogram"?S=v===y?1/0:s(o[v].value,o[y].value):S=v===y?1/0:s(o[v].value[0],o[y].value[0]),l[v][y]=S,l[y][v]=S,S<l[v][u[v]]&&(u[v]=y)}for(var w=wT(o,c,l,u,i);w;)w=wT(o,c,l,u,i);var T;return i.mode==="dendrogram"?(T=HS(o[0],i.dendrogramDepth,r),i.addDendrogram&&VS(o[0],r)):(T=new Array(o.length),o.forEach(function(_,C){_.key=_.index=null,T[C]=r.collection(_.value)})),T},kB={hierarchicalClustering:ST,hca:ST},_B=Ua({distance:"euclidean",preference:"median",damping:.8,maxIterations:1e3,minIterations:100,attributes:[]}),CB=function(e){var r=e.damping,n=e.preference;.5<=r&&r<1||Gn("Damping must range on [0.5, 1).  Got: ".concat(r));var i=["median","mean","min","max"];return i.some(function(a){return a===n})||gt(n)||Gn("Preference must be one of [".concat(i.map(function(a){return"'".concat(a,"'")}).join(", "),"] or a number.  Got: ").concat(n)),_B(e)},EB=function(e,r,n,i){var a=function(o,l){return i[l](o)};return-T1(e,i.length,function(s){return a(r,s)},function(s){return a(n,s)},r,n)},TB=function(e,r){var n=null;return r==="median"?n=C9(e):r==="mean"?n=_9(e):r==="min"?n=S9(e):r==="max"?n=k9(e):n=r,n},NB=function(e,r,n){for(var i=[],a=0;a<e;a++)r[a*e+a]+n[a*e+a]>0&&i.push(a);return i},kT=function(e,r,n){for(var i=[],a=0;a<e;a++){for(var s=-1,o=-1/0,l=0;l<n.length;l++){var u=n[l];r[a*e+u]>o&&(s=u,o=r[a*e+u])}s>0&&i.push(s)}for(var c=0;c<n.length;c++)i[n[c]]=n[c];return i},PB=function(e,r,n){for(var i=kT(e,r,n),a=0;a<n.length;a++){for(var s=[],o=0;o<i.length;o++)i[o]===n[a]&&s.push(o);for(var l=-1,u=-1/0,c=0;c<s.length;c++){for(var f=0,p=0;p<s.length;p++)f+=r[s[p]*e+s[c]];f>u&&(l=c,u=f)}n[a]=s[l]}return i=kT(e,r,n),i},_T=function(e){for(var r=this.cy(),n=this.nodes(),i=CB(e),a={},s=0;s<n.length;s++)a[n[s].id()]=s;var o,l,u,c,f,p;o=n.length,l=o*o,u=new Array(l);for(var v=0;v<l;v++)u[v]=-1/0;for(var y=0;y<o;y++)for(var S=0;S<o;S++)y!==S&&(u[y*o+S]=EB(i.distance,n[y],n[S],i.attributes));c=TB(u,i.preference);for(var w=0;w<o;w++)u[w*o+w]=c;f=new Array(l);for(var T=0;T<l;T++)f[T]=0;p=new Array(l);for(var _=0;_<l;_++)p[_]=0;for(var C=new Array(o),N=new Array(o),A=new Array(o),O=0;O<o;O++)C[O]=0,N[O]=0,A[O]=0;for(var j=new Array(o*i.minIterations),D=0;D<j.length;D++)j[D]=0;var F;for(F=0;F<i.maxIterations;F++){for(var B=0;B<o;B++){for(var $=-1/0,Z=-1/0,I=-1,q=0,U=0;U<o;U++)C[U]=f[B*o+U],q=p[B*o+U]+u[B*o+U],q>=$?(Z=$,$=q,I=U):q>Z&&(Z=q);for(var W=0;W<o;W++)f[B*o+W]=(1-i.damping)*(u[B*o+W]-$)+i.damping*C[W];f[B*o+I]=(1-i.damping)*(u[B*o+I]-Z)+i.damping*C[I]}for(var Y=0;Y<o;Y++){for(var Q=0,ne=0;ne<o;ne++)C[ne]=p[ne*o+Y],N[ne]=Math.max(0,f[ne*o+Y]),Q+=N[ne];Q-=N[Y],N[Y]=f[Y*o+Y],Q+=N[Y];for(var re=0;re<o;re++)p[re*o+Y]=(1-i.damping)*Math.min(0,Q-N[re])+i.damping*C[re];p[Y*o+Y]=(1-i.damping)*(Q-N[Y])+i.damping*C[Y]}for(var H=0,te=0;te<o;te++){var ie=p[te*o+te]+f[te*o+te]>0?1:0;j[F%i.minIterations*o+te]=ie,H+=ie}if(H>0&&(F>=i.minIterations-1||F==i.maxIterations-1)){for(var de=0,ge=0;ge<o;ge++){A[ge]=0;for(var ye=0;ye<i.minIterations;ye++)A[ge]+=j[ye*o+ge];(A[ge]===0||A[ge]===i.minIterations)&&de++}if(de===o)break}}for(var ae=NB(o,f,p),pe=PB(o,u,ae),le={},me=0;me<ae.length;me++)le[ae[me]]=[];for(var he=0;he<n.length;he++){var xe=a[n[he].id()],we=pe[xe];we!=null&&le[we].push(n[he])}for(var Ge=new Array(ae.length),qe=0;qe<ae.length;qe++)Ge[qe]=r.collection(le[ae[qe]]);return Ge},MB={affinityPropagation:_T,ap:_T},AB=Ua({root:void 0,directed:!1}),LB={hierholzer:function(e){if(!Ir(e)){var r=arguments;e={root:r[0],directed:r[1]}}var n=AB(e),i=n.root,a=n.directed,s=this,o=!1,l,u,c;i&&(c=Wt(i)?this.filter(i)[0].id():i[0].id());var f={},p={};a?s.forEach(function(_){var C=_.id();if(_.isNode()){var N=_.indegree(!0),A=_.outdegree(!0),O=N-A,j=A-N;O==1?l?o=!0:l=C:j==1?u?o=!0:u=C:(j>1||O>1)&&(o=!0),f[C]=[],_.outgoers().forEach(function(D){D.isEdge()&&f[C].push(D.id())})}else p[C]=[void 0,_.target().id()]}):s.forEach(function(_){var C=_.id();if(_.isNode()){var N=_.degree(!0);N%2&&(l?u?o=!0:u=C:l=C),f[C]=[],_.connectedEdges().forEach(function(A){return f[C].push(A.id())})}else p[C]=[_.source().id(),_.target().id()]});var v={found:!1,trail:void 0};if(o)return v;if(u&&l)if(a){if(c&&u!=c)return v;c=u}else{if(c&&u!=c&&l!=c)return v;c||(c=u)}else c||(c=s[0].id());var y=function(C){for(var N=C,A=[C],O,j,D;f[N].length;)O=f[N].shift(),j=p[O][0],D=p[O][1],N!=D?(f[D]=f[D].filter(function(F){return F!=O}),N=D):!a&&N!=j&&(f[j]=f[j].filter(function(F){return F!=O}),N=j),A.unshift(O),A.unshift(N);return A},S=[],w=[];for(w=y(c);w.length!=1;)f[w[0]].length==0?(S.unshift(s.getElementById(w.shift())),S.unshift(s.getElementById(w.shift()))):w=y(w.shift()).concat(w);S.unshift(s.getElementById(w.shift()));for(var T in f)if(f[T].length)return v;return v.found=!0,v.trail=this.spawn(S,!0),v}},iy=function(){var e=this,r={},n=0,i=0,a=[],s=[],o={},l=function(p,v){for(var y=s.length-1,S=[],w=e.spawn();s[y].x!=p||s[y].y!=v;)S.push(s.pop().edge),y--;S.push(s.pop().edge),S.forEach(function(T){var _=T.connectedNodes().intersection(e);w.merge(T),_.forEach(function(C){var N=C.id(),A=C.connectedEdges().intersection(e);w.merge(C),r[N].cutVertex?w.merge(A.filter(function(O){return O.isLoop()})):w.merge(A)})}),a.push(w)},u=function(p,v,y){p===y&&(i+=1),r[v]={id:n,low:n++,cutVertex:!1};var S=e.getElementById(v).connectedEdges().intersection(e);if(S.size()===0)a.push(e.spawn(e.getElementById(v)));else{var w,T,_,C;S.forEach(function(N){w=N.source().id(),T=N.target().id(),_=w===v?T:w,_!==y&&(C=N.id(),o[C]||(o[C]=!0,s.push({x:v,y:_,edge:N})),_ in r?r[v].low=Math.min(r[v].low,r[_].id):(u(p,_,v),r[v].low=Math.min(r[v].low,r[_].low),r[v].id<=r[_].low&&(r[v].cutVertex=!0,l(v,_))))})}};e.forEach(function(f){if(f.isNode()){var p=f.id();p in r||(i=0,u(p,p),r[p].cutVertex=i>1)}});var c=Object.keys(r).filter(function(f){return r[f].cutVertex}).map(function(f){return e.getElementById(f)});return{cut:e.spawn(c),components:a}},RB={hopcroftTarjanBiconnected:iy,htbc:iy,htb:iy,hopcroftTarjanBiconnectedComponents:iy},ay=function(){var e=this,r={},n=0,i=[],a=[],s=e.spawn(e),o=function(u){a.push(u),r[u]={index:n,low:n++,explored:!1};var c=e.getElementById(u).connectedEdges().intersection(e);if(c.forEach(function(S){var w=S.target().id();w!==u&&(w in r||o(w),r[w].explored||(r[u].low=Math.min(r[u].low,r[w].low)))}),r[u].index===r[u].low){for(var f=e.spawn();;){var p=a.pop();if(f.merge(e.getElementById(p)),r[p].low=r[u].index,r[p].explored=!0,p===u)break}var v=f.edgesWith(f),y=f.merge(v);i.push(y),s=s.difference(y)}};return e.forEach(function(l){if(l.isNode()){var u=l.id();u in r||o(u)}}),{cut:s,components:i}},OB={tarjanStronglyConnected:ay,tsc:ay,tscc:ay,tarjanStronglyConnectedComponents:ay},wA={};[_v,c9,d9,h9,m9,v9,b9,$9,Up,Gp,GS,sB,xB,kB,MB,LB,RB,OB].forEach(function(t){Jt(wA,t)});var SA=0,kA=1,_A=2,Tl=function(e){if(!(this instanceof Tl))return new Tl(e);this.id="Thenable/1.0.7",this.state=SA,this.fulfillValue=void 0,this.rejectReason=void 0,this.onFulfilled=[],this.onRejected=[],this.proxy={then:this.then.bind(this)},typeof e=="function"&&e.call(this,this.fulfill.bind(this),this.reject.bind(this))};Tl.prototype={fulfill:function(e){return CT(this,kA,"fulfillValue",e)},reject:function(e){return CT(this,_A,"rejectReason",e)},then:function(e,r){var n=this,i=new Tl;return n.onFulfilled.push(TT(e,i,"fulfill")),n.onRejected.push(TT(r,i,"reject")),CA(n),i.proxy}};var CT=function(e,r,n,i){return e.state===SA&&(e.state=r,e[n]=i,CA(e)),e},CA=function(e){e.state===kA?ET(e,"onFulfilled",e.fulfillValue):e.state===_A&&ET(e,"onRejected",e.rejectReason)},ET=function(e,r,n){if(e[r].length!==0){var i=e[r];e[r]=[];var a=function(){for(var o=0;o<i.length;o++)i[o](n)};typeof setImmediate=="function"?setImmediate(a):setTimeout(a,0)}},TT=function(e,r,n){return function(i){if(typeof e!="function")r[n].call(r,i);else{var a;try{a=e(i)}catch(s){r.reject(s);return}EA(r,a)}}},EA=function(e,r){if(e===r||e.proxy===r){e.reject(new TypeError("cannot resolve promise with itself"));return}var n;if(Hi(r)==="object"&&r!==null||typeof r=="function")try{n=r.then}catch(a){e.reject(a);return}if(typeof n=="function"){var i=!1;try{n.call(r,function(a){i||(i=!0,a===r?e.reject(new TypeError("circular thenable chain")):EA(e,a))},function(a){i||(i=!0,e.reject(a))})}catch(a){i||e.reject(a)}return}e.fulfill(r)};Tl.all=function(t){return new Tl(function(e,r){for(var n=new Array(t.length),i=0,a=function(l,u){n[l]=u,i++,i===t.length&&e(n)},s=0;s<t.length;s++)(function(o){var l=t[o],u=l!=null&&l.then!=null;if(u)l.then(function(f){a(o,f)},function(f){r(f)});else{var c=l;a(o,c)}})(s)})};Tl.resolve=function(t){return new Tl(function(e,r){e(t)})};Tl.reject=function(t){return new Tl(function(e,r){r(t)})};var hm=typeof Promise<"u"?Promise:Tl,WS=function(e,r,n){var i=s_(e),a=!i,s=this._private=Jt({duration:1e3},r,n);if(s.target=e,s.style=s.style||s.css,s.started=!1,s.playing=!1,s.hooked=!1,s.applying=!1,s.progress=0,s.completes=[],s.frames=[],s.complete&&Kn(s.complete)&&s.completes.push(s.complete),a){var o=e.position();s.startPosition=s.startPosition||{x:o.x,y:o.y},s.startStyle=s.startStyle||e.cy().style().getAnimationStartStyle(e,s.style)}if(i){var l=e.pan();s.startPan={x:l.x,y:l.y},s.startZoom=e.zoom()}this.length=1,this[0]=this},xh=WS.prototype;Jt(xh,{instanceString:function(){return"animation"},hook:function(){var e=this._private;if(!e.hooked){var r,n=e.target._private.animation;e.queue?r=n.queue:r=n.current,r.push(this),uo(e.target)&&e.target.cy().addToAnimationPool(e.target),e.hooked=!0}return this},play:function(){var e=this._private;return e.progress===1&&(e.progress=0),e.playing=!0,e.started=!1,e.stopped=!1,this.hook(),this},playing:function(){return this._private.playing},apply:function(){var e=this._private;return e.applying=!0,e.started=!1,e.stopped=!1,this.hook(),this},applying:function(){return this._private.applying},pause:function(){var e=this._private;return e.playing=!1,e.started=!1,this},stop:function(){var e=this._private;return e.playing=!1,e.started=!1,e.stopped=!0,this},rewind:function(){return this.progress(0)},fastforward:function(){return this.progress(1)},time:function(e){var r=this._private;return e===void 0?r.progress*r.duration:this.progress(e/r.duration)},progress:function(e){var r=this._private,n=r.playing;return e===void 0?r.progress:(n&&this.pause(),r.progress=e,r.started=!1,n&&this.play(),this)},completed:function(){return this._private.progress===1},reverse:function(){var e=this._private,r=e.playing;r&&this.pause(),e.progress=1-e.progress,e.started=!1;var n=function(u,c){var f=e[u];f!=null&&(e[u]=e[c],e[c]=f)};if(n("zoom","startZoom"),n("pan","startPan"),n("position","startPosition"),e.style)for(var i=0;i<e.style.length;i++){var a=e.style[i],s=a.name,o=e.startStyle[s];e.startStyle[s]=a,e.style[i]=o}return r&&this.play(),this},promise:function(e){var r=this._private,n;switch(e){case"frame":n=r.frames;break;default:case"complete":case"completed":n=r.completes}return new hm(function(i,a){n.push(function(){i()})})}});xh.complete=xh.completed;xh.run=xh.play;xh.running=xh.playing;var DB={animated:function(){return function(){var r=this,n=r.length!==void 0,i=n?r:[r],a=this._private.cy||this;if(!a.styleEnabled())return!1;var s=i[0];if(s)return s._private.animation.current.length>0}},clearQueue:function(){return function(){var r=this,n=r.length!==void 0,i=n?r:[r],a=this._private.cy||this;if(!a.styleEnabled())return this;for(var s=0;s<i.length;s++){var o=i[s];o._private.animation.queue=[]}return this}},delay:function(){return function(r,n){var i=this._private.cy||this;return i.styleEnabled()?this.animate({delay:r,duration:r,complete:n}):this}},delayAnimation:function(){return function(r,n){var i=this._private.cy||this;return i.styleEnabled()?this.animation({delay:r,duration:r,complete:n}):this}},animation:function(){return function(r,n){var i=this,a=i.length!==void 0,s=a?i:[i],o=this._private.cy||this,l=!a,u=!l;if(!o.styleEnabled())return this;var c=o.style();r=Jt({},r,n);var f=Object.keys(r).length===0;if(f)return new WS(s[0],r);switch(r.duration===void 0&&(r.duration=400),r.duration){case"slow":r.duration=600;break;case"fast":r.duration=200;break}if(u&&(r.style=c.getPropsList(r.style||r.css),r.css=void 0),u&&r.renderedPosition!=null){var p=r.renderedPosition,v=o.pan(),y=o.zoom();r.position=dA(p,y,v)}if(l&&r.panBy!=null){var S=r.panBy,w=o.pan();r.pan={x:w.x+S.x,y:w.y+S.y}}var T=r.center||r.centre;if(l&&T!=null){var _=o.getCenterPan(T.eles,r.zoom);_!=null&&(r.pan=_)}if(l&&r.fit!=null){var C=r.fit,N=o.getFitViewport(C.eles||C.boundingBox,C.padding);N!=null&&(r.pan=N.pan,r.zoom=N.zoom)}if(l&&Ir(r.zoom)){var A=o.getZoomedViewport(r.zoom);A!=null?(A.zoomed&&(r.zoom=A.zoom),A.panned&&(r.pan=A.pan)):r.zoom=null}return new WS(s[0],r)}},animate:function(){return function(r,n){var i=this,a=i.length!==void 0,s=a?i:[i],o=this._private.cy||this;if(!o.styleEnabled())return this;n&&(r=Jt({},r,n));for(var l=0;l<s.length;l++){var u=s[l],c=u.animated()&&(r.queue===void 0||r.queue),f=u.animation(r,c?{queue:!0}:void 0);f.play()}return this}},stop:function(){return function(r,n){var i=this,a=i.length!==void 0,s=a?i:[i],o=this._private.cy||this;if(!o.styleEnabled())return this;for(var l=0;l<s.length;l++){for(var u=s[l],c=u._private,f=c.animation.current,p=0;p<f.length;p++){var v=f[p],y=v._private;n&&(y.duration=0)}r&&(c.animation.queue=[]),n||(c.animation.current=[])}return o.notify("draw"),this}}},pw,NT;function N1(){if(NT)return pw;NT=1;var t=Array.isArray;return pw=t,pw}var mw,PT;function IB(){if(PT)return mw;PT=1;var t=N1(),e=r0(),r=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,n=/^\w*$/;function i(a,s){if(t(a))return!1;var o=typeof a;return o=="number"||o=="symbol"||o=="boolean"||a==null||e(a)?!0:n.test(a)||!r.test(a)||s!=null&&a in Object(s)}return mw=i,mw}var gw,MT;function jB(){if(MT)return gw;MT=1;var t=rA(),e=t0(),r="[object AsyncFunction]",n="[object Function]",i="[object GeneratorFunction]",a="[object Proxy]";function s(o){if(!e(o))return!1;var l=t(o);return l==n||l==i||l==r||l==a}return gw=s,gw}var vw,AT;function FB(){if(AT)return vw;AT=1;var t=_1(),e=t["__core-js_shared__"];return vw=e,vw}var yw,LT;function BB(){if(LT)return yw;LT=1;var t=FB(),e=(function(){var n=/[^.]+$/.exec(t&&t.keys&&t.keys.IE_PROTO||"");return n?"Symbol(src)_1."+n:""})();function r(n){return!!e&&e in n}return yw=r,yw}var xw,RT;function zB(){if(RT)return xw;RT=1;var t=Function.prototype,e=t.toString;function r(n){if(n!=null){try{return e.call(n)}catch{}try{return n+""}catch{}}return""}return xw=r,xw}var bw,OT;function UB(){if(OT)return bw;OT=1;var t=jB(),e=BB(),r=t0(),n=zB(),i=/[\\^$.*+?()[\]{}|]/g,a=/^\[object .+?Constructor\]$/,s=Function.prototype,o=Object.prototype,l=s.toString,u=o.hasOwnProperty,c=RegExp("^"+l.call(u).replace(i,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function f(p){if(!r(p)||e(p))return!1;var v=t(p)?c:a;return v.test(n(p))}return bw=f,bw}var ww,DT;function GB(){if(DT)return ww;DT=1;function t(e,r){return e?.[r]}return ww=t,ww}var Sw,IT;function v_(){if(IT)return Sw;IT=1;var t=UB(),e=GB();function r(n,i){var a=e(n,i);return t(a)?a:void 0}return Sw=r,Sw}var kw,jT;function P1(){if(jT)return kw;jT=1;var t=v_(),e=t(Object,"create");return kw=e,kw}var _w,FT;function VB(){if(FT)return _w;FT=1;var t=P1();function e(){this.__data__=t?t(null):{},this.size=0}return _w=e,_w}var Cw,BT;function HB(){if(BT)return Cw;BT=1;function t(e){var r=this.has(e)&&delete this.__data__[e];return this.size-=r?1:0,r}return Cw=t,Cw}var Ew,zT;function WB(){if(zT)return Ew;zT=1;var t=P1(),e="__lodash_hash_undefined__",r=Object.prototype,n=r.hasOwnProperty;function i(a){var s=this.__data__;if(t){var o=s[a];return o===e?void 0:o}return n.call(s,a)?s[a]:void 0}return Ew=i,Ew}var Tw,UT;function qB(){if(UT)return Tw;UT=1;var t=P1(),e=Object.prototype,r=e.hasOwnProperty;function n(i){var a=this.__data__;return t?a[i]!==void 0:r.call(a,i)}return Tw=n,Tw}var Nw,GT;function $B(){if(GT)return Nw;GT=1;var t=P1(),e="__lodash_hash_undefined__";function r(n,i){var a=this.__data__;return this.size+=this.has(n)?0:1,a[n]=t&&i===void 0?e:i,this}return Nw=r,Nw}var Pw,VT;function KB(){if(VT)return Pw;VT=1;var t=VB(),e=HB(),r=WB(),n=qB(),i=$B();function a(s){var o=-1,l=s==null?0:s.length;for(this.clear();++o<l;){var u=s[o];this.set(u[0],u[1])}}return a.prototype.clear=t,a.prototype.delete=e,a.prototype.get=r,a.prototype.has=n,a.prototype.set=i,Pw=a,Pw}var Mw,HT;function ZB(){if(HT)return Mw;HT=1;function t(){this.__data__=[],this.size=0}return Mw=t,Mw}var Aw,WT;function TA(){if(WT)return Aw;WT=1;function t(e,r){return e===r||e!==e&&r!==r}return Aw=t,Aw}var Lw,qT;function M1(){if(qT)return Lw;qT=1;var t=TA();function e(r,n){for(var i=r.length;i--;)if(t(r[i][0],n))return i;return-1}return Lw=e,Lw}var Rw,$T;function YB(){if($T)return Rw;$T=1;var t=M1(),e=Array.prototype,r=e.splice;function n(i){var a=this.__data__,s=t(a,i);if(s<0)return!1;var o=a.length-1;return s==o?a.pop():r.call(a,s,1),--this.size,!0}return Rw=n,Rw}var Ow,KT;function XB(){if(KT)return Ow;KT=1;var t=M1();function e(r){var n=this.__data__,i=t(n,r);return i<0?void 0:n[i][1]}return Ow=e,Ow}var Dw,ZT;function QB(){if(ZT)return Dw;ZT=1;var t=M1();function e(r){return t(this.__data__,r)>-1}return Dw=e,Dw}var Iw,YT;function JB(){if(YT)return Iw;YT=1;var t=M1();function e(r,n){var i=this.__data__,a=t(i,r);return a<0?(++this.size,i.push([r,n])):i[a][1]=n,this}return Iw=e,Iw}var jw,XT;function e7(){if(XT)return jw;XT=1;var t=ZB(),e=YB(),r=XB(),n=QB(),i=JB();function a(s){var o=-1,l=s==null?0:s.length;for(this.clear();++o<l;){var u=s[o];this.set(u[0],u[1])}}return a.prototype.clear=t,a.prototype.delete=e,a.prototype.get=r,a.prototype.has=n,a.prototype.set=i,jw=a,jw}var Fw,QT;function t7(){if(QT)return Fw;QT=1;var t=v_(),e=_1(),r=t(e,"Map");return Fw=r,Fw}var Bw,JT;function r7(){if(JT)return Bw;JT=1;var t=KB(),e=e7(),r=t7();function n(){this.size=0,this.__data__={hash:new t,map:new(r||e),string:new t}}return Bw=n,Bw}var zw,eN;function n7(){if(eN)return zw;eN=1;function t(e){var r=typeof e;return r=="string"||r=="number"||r=="symbol"||r=="boolean"?e!=="__proto__":e===null}return zw=t,zw}var Uw,tN;function A1(){if(tN)return Uw;tN=1;var t=n7();function e(r,n){var i=r.__data__;return t(n)?i[typeof n=="string"?"string":"hash"]:i.map}return Uw=e,Uw}var Gw,rN;function i7(){if(rN)return Gw;rN=1;var t=A1();function e(r){var n=t(this,r).delete(r);return this.size-=n?1:0,n}return Gw=e,Gw}var Vw,nN;function a7(){if(nN)return Vw;nN=1;var t=A1();function e(r){return t(this,r).get(r)}return Vw=e,Vw}var Hw,iN;function s7(){if(iN)return Hw;iN=1;var t=A1();function e(r){return t(this,r).has(r)}return Hw=e,Hw}var Ww,aN;function o7(){if(aN)return Ww;aN=1;var t=A1();function e(r,n){var i=t(this,r),a=i.size;return i.set(r,n),this.size+=i.size==a?0:1,this}return Ww=e,Ww}var qw,sN;function l7(){if(sN)return qw;sN=1;var t=r7(),e=i7(),r=a7(),n=s7(),i=o7();function a(s){var o=-1,l=s==null?0:s.length;for(this.clear();++o<l;){var u=s[o];this.set(u[0],u[1])}}return a.prototype.clear=t,a.prototype.delete=e,a.prototype.get=r,a.prototype.has=n,a.prototype.set=i,qw=a,qw}var $w,oN;function u7(){if(oN)return $w;oN=1;var t=l7(),e="Expected a function";function r(n,i){if(typeof n!="function"||i!=null&&typeof i!="function")throw new TypeError(e);var a=function(){var s=arguments,o=i?i.apply(this,s):s[0],l=a.cache;if(l.has(o))return l.get(o);var u=n.apply(this,s);return a.cache=l.set(o,u)||l,u};return a.cache=new(r.Cache||t),a}return r.Cache=t,$w=r,$w}var Kw,lN;function c7(){if(lN)return Kw;lN=1;var t=u7(),e=500;function r(n){var i=t(n,function(s){return a.size===e&&a.clear(),s}),a=i.cache;return i}return Kw=r,Kw}var Zw,uN;function NA(){if(uN)return Zw;uN=1;var t=c7(),e=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,r=/\\(\\)?/g,n=t(function(i){var a=[];return i.charCodeAt(0)===46&&a.push(""),i.replace(e,function(s,o,l,u){a.push(l?u.replace(r,"$1"):o||s)}),a});return Zw=n,Zw}var Yw,cN;function PA(){if(cN)return Yw;cN=1;function t(e,r){for(var n=-1,i=e==null?0:e.length,a=Array(i);++n<i;)a[n]=r(e[n],n,e);return a}return Yw=t,Yw}var Xw,dN;function d7(){if(dN)return Xw;dN=1;var t=l_(),e=PA(),r=N1(),n=r0(),i=t?t.prototype:void 0,a=i?i.toString:void 0;function s(o){if(typeof o=="string")return o;if(r(o))return e(o,s)+"";if(n(o))return a?a.call(o):"";var l=o+"";return l=="0"&&1/o==-1/0?"-0":l}return Xw=s,Xw}var Qw,fN;function MA(){if(fN)return Qw;fN=1;var t=d7();function e(r){return r==null?"":t(r)}return Qw=e,Qw}var Jw,hN;function AA(){if(hN)return Jw;hN=1;var t=N1(),e=IB(),r=NA(),n=MA();function i(a,s){return t(a)?a:e(a,s)?[a]:r(n(a))}return Jw=i,Jw}var e2,pN;function y_(){if(pN)return e2;pN=1;var t=r0();function e(r){if(typeof r=="string"||t(r))return r;var n=r+"";return n=="0"&&1/r==-1/0?"-0":n}return e2=e,e2}var t2,mN;function f7(){if(mN)return t2;mN=1;var t=AA(),e=y_();function r(n,i){i=t(i,n);for(var a=0,s=i.length;n!=null&&a<s;)n=n[e(i[a++])];return a&&a==s?n:void 0}return t2=r,t2}var r2,gN;function h7(){if(gN)return r2;gN=1;var t=f7();function e(r,n,i){var a=r==null?void 0:t(r,n);return a===void 0?i:a}return r2=e,r2}var p7=h7(),m7=e0(p7),n2,vN;function g7(){if(vN)return n2;vN=1;var t=v_(),e=(function(){try{var r=t(Object,"defineProperty");return r({},"",{}),r}catch{}})();return n2=e,n2}var i2,yN;function v7(){if(yN)return i2;yN=1;var t=g7();function e(r,n,i){n=="__proto__"&&t?t(r,n,{configurable:!0,enumerable:!0,value:i,writable:!0}):r[n]=i}return i2=e,i2}var a2,xN;function y7(){if(xN)return a2;xN=1;var t=v7(),e=TA(),r=Object.prototype,n=r.hasOwnProperty;function i(a,s,o){var l=a[s];(!(n.call(a,s)&&e(l,o))||o===void 0&&!(s in a))&&t(a,s,o)}return a2=i,a2}var s2,bN;function x7(){if(bN)return s2;bN=1;var t=9007199254740991,e=/^(?:0|[1-9]\d*)$/;function r(n,i){var a=typeof n;return i=i??t,!!i&&(a=="number"||a!="symbol"&&e.test(n))&&n>-1&&n%1==0&&n<i}return s2=r,s2}var o2,wN;function b7(){if(wN)return o2;wN=1;var t=y7(),e=AA(),r=x7(),n=t0(),i=y_();function a(s,o,l,u){if(!n(s))return s;o=e(o,s);for(var c=-1,f=o.length,p=f-1,v=s;v!=null&&++c<f;){var y=i(o[c]),S=l;if(y==="__proto__"||y==="constructor"||y==="prototype")return s;if(c!=p){var w=v[y];S=u?u(w,y,v):void 0,S===void 0&&(S=n(w)?w:r(o[c+1])?[]:{})}t(v,y,S),v=v[y]}return s}return o2=a,o2}var l2,SN;function w7(){if(SN)return l2;SN=1;var t=b7();function e(r,n,i){return r==null?r:t(r,n,i)}return l2=e,l2}var S7=w7(),k7=e0(S7),u2,kN;function _7(){if(kN)return u2;kN=1;function t(e,r){var n=-1,i=e.length;for(r||(r=Array(i));++n<i;)r[n]=e[n];return r}return u2=t,u2}var c2,_N;function C7(){if(_N)return c2;_N=1;var t=PA(),e=_7(),r=N1(),n=r0(),i=NA(),a=y_(),s=MA();function o(l){return r(l)?t(l,a):n(l)?[l]:e(i(s(l)))}return c2=o,c2}var E7=C7(),T7=e0(E7),N7={data:function(e){var r={field:"data",bindingEvent:"data",allowBinding:!1,allowSetting:!1,allowGetting:!1,settingEvent:"data",settingTriggersEvent:!1,triggerFnName:"trigger",immutableKeys:{},updateStyle:!1,beforeGet:function(i){},beforeSet:function(i,a){},onSet:function(i){},canSet:function(i){return!0}};return e=Jt({},r,e),function(i,a){var s=e,o=this,l=o.length!==void 0,u=l?o:[o],c=l?o[0]:o;if(Wt(i)){var f=i.indexOf(".")!==-1,p=f&&T7(i);if(s.allowGetting&&a===void 0){var v;return c&&(s.beforeGet(c),p&&c._private[s.field][i]===void 0?v=m7(c._private[s.field],p):v=c._private[s.field][i]),v}else if(s.allowSetting&&a!==void 0){var y=!s.immutableKeys[i];if(y){var S=qM({},i,a);s.beforeSet(o,S);for(var w=0,T=u.length;w<T;w++){var _=u[w];s.canSet(_)&&(p&&c._private[s.field][i]===void 0?k7(_._private[s.field],p,a):_._private[s.field][i]=a)}s.updateStyle&&o.updateStyle(),s.onSet(o),s.settingTriggersEvent&&o[s.triggerFnName](s.settingEvent)}}}else if(s.allowSetting&&Ir(i)){var C=i,N,A,O=Object.keys(C);s.beforeSet(o,C);for(var j=0;j<O.length;j++){N=O[j],A=C[N];var D=!s.immutableKeys[N];if(D)for(var F=0;F<u.length;F++){var B=u[F];s.canSet(B)&&(B._private[s.field][N]=A)}}s.updateStyle&&o.updateStyle(),s.onSet(o),s.settingTriggersEvent&&o[s.triggerFnName](s.settingEvent)}else if(s.allowBinding&&Kn(i)){var $=i;o.on(s.bindingEvent,$)}else if(s.allowGetting&&i===void 0){var Z;return c&&(s.beforeGet(c),Z=c._private[s.field]),Z}return o}},removeData:function(e){var r={field:"data",event:"data",triggerFnName:"trigger",triggerEvent:!1,immutableKeys:{}};return e=Jt({},r,e),function(i){var a=e,s=this,o=s.length!==void 0,l=o?s:[s];if(Wt(i)){for(var u=i.split(/\s+/),c=u.length,f=0;f<c;f++){var p=u[f];if(!Xd(p)){var v=!a.immutableKeys[p];if(v)for(var y=0,S=l.length;y<S;y++)l[y]._private[a.field][p]=void 0}}a.triggerEvent&&s[a.triggerFnName](a.event)}else if(i===void 0){for(var w=0,T=l.length;w<T;w++)for(var _=l[w]._private[a.field],C=Object.keys(_),N=0;N<C.length;N++){var A=C[N],O=!a.immutableKeys[A];O&&(_[A]=void 0)}a.triggerEvent&&s[a.triggerFnName](a.event)}return s}}},P7={eventAliasesOn:function(e){var r=e;r.addListener=r.listen=r.bind=r.on,r.unlisten=r.unbind=r.off=r.removeListener,r.trigger=r.emit,r.pon=r.promiseOn=function(n,i){var a=this,s=Array.prototype.slice.call(arguments,0);return new hm(function(o,l){var u=function(v){a.off.apply(a,f),o(v)},c=s.concat([u]),f=c.concat([]);a.on.apply(a,c)})}}},Zr={};[DB,N7,P7].forEach(function(t){Jt(Zr,t)});var M7={animate:Zr.animate(),animation:Zr.animation(),animated:Zr.animated(),clearQueue:Zr.clearQueue(),delay:Zr.delay(),delayAnimation:Zr.delayAnimation(),stop:Zr.stop()},Gy={classes:function(e){var r=this;if(e===void 0){var n=[];return r[0]._private.classes.forEach(function(y){return n.push(y)}),n}else pn(e)||(e=(e||"").match(/\S+/g)||[]);for(var i=[],a=new fm(e),s=0;s<r.length;s++){for(var o=r[s],l=o._private,u=l.classes,c=!1,f=0;f<e.length;f++){var p=e[f],v=u.has(p);if(!v){c=!0;break}}c||(c=u.size!==e.length),c&&(l.classes=a,i.push(o))}return i.length>0&&this.spawn(i).updateStyle().emit("class"),r},addClass:function(e){return this.toggleClass(e,!0)},hasClass:function(e){var r=this[0];return r!=null&&r._private.classes.has(e)},toggleClass:function(e,r){pn(e)||(e=e.match(/\S+/g)||[]);for(var n=this,i=r===void 0,a=[],s=0,o=n.length;s<o;s++)for(var l=n[s],u=l._private.classes,c=!1,f=0;f<e.length;f++){var p=e[f],v=u.has(p),y=!1;r||i&&!v?(u.add(p),y=!0):(!r||i&&v)&&(u.delete(p),y=!0),!c&&y&&(a.push(l),c=!0)}return a.length>0&&this.spawn(a).updateStyle().emit("class"),n},removeClass:function(e){return this.toggleClass(e,!1)},flashClass:function(e,r){var n=this;if(r==null)r=250;else if(r===0)return n;return n.addClass(e),setTimeout(function(){n.removeClass(e)},r),n}};Gy.className=Gy.classNames=Gy.classes;var Dr={metaChar:"[\\!\\\"\\#\\$\\%\\&\\'\\(\\)\\*\\+\\,\\.\\/\\:\\;\\<\\=\\>\\?\\@\\[\\]\\^\\`\\{\\|\\}\\~]",comparatorOp:"=|\\!=|>|>=|<|<=|\\$=|\\^=|\\*=",boolOp:"\\?|\\!|\\^",string:`"(?:\\\\"|[^"])*"|'(?:\\\\'|[^'])*'`,number:Gi,meta:"degree|indegree|outdegree",separator:"\\s*,\\s*",descendant:"\\s+",child:"\\s+>\\s+",subject:"\\$",group:"node|edge|\\*",directedEdge:"\\s+->\\s+",undirectedEdge:"\\s+<->\\s+"};Dr.variable="(?:[\\w-.]|(?:\\\\"+Dr.metaChar+"))+";Dr.className="(?:[\\w-]|(?:\\\\"+Dr.metaChar+"))+";Dr.value=Dr.string+"|"+Dr.number;Dr.id=Dr.variable;(function(){var t,e,r;for(t=Dr.comparatorOp.split("|"),r=0;r<t.length;r++)e=t[r],Dr.comparatorOp+="|@"+e;for(t=Dr.comparatorOp.split("|"),r=0;r<t.length;r++)e=t[r],!(e.indexOf("!")>=0)&&e!=="="&&(Dr.comparatorOp+="|\\!"+e)})();var ln=function(){return{checks:[]}},Ot={GROUP:0,COLLECTION:1,FILTER:2,DATA_COMPARE:3,DATA_EXIST:4,DATA_BOOL:5,META_COMPARE:6,STATE:7,ID:8,CLASS:9,UNDIRECTED_EDGE:10,DIRECTED_EDGE:11,NODE_SOURCE:12,NODE_TARGET:13,NODE_NEIGHBOR:14,CHILD:15,DESCENDANT:16,PARENT:17,ANCESTOR:18,COMPOUND_SPLIT:19,TRUE:20},qS=[{selector:":selected",matches:function(e){return e.selected()}},{selector:":unselected",matches:function(e){return!e.selected()}},{selector:":selectable",matches:function(e){return e.selectable()}},{selector:":unselectable",matches:function(e){return!e.selectable()}},{selector:":locked",matches:function(e){return e.locked()}},{selector:":unlocked",matches:function(e){return!e.locked()}},{selector:":visible",matches:function(e){return e.visible()}},{selector:":hidden",matches:function(e){return!e.visible()}},{selector:":transparent",matches:function(e){return e.transparent()}},{selector:":grabbed",matches:function(e){return e.grabbed()}},{selector:":free",matches:function(e){return!e.grabbed()}},{selector:":removed",matches:function(e){return e.removed()}},{selector:":inside",matches:function(e){return!e.removed()}},{selector:":grabbable",matches:function(e){return e.grabbable()}},{selector:":ungrabbable",matches:function(e){return!e.grabbable()}},{selector:":animated",matches:function(e){return e.animated()}},{selector:":unanimated",matches:function(e){return!e.animated()}},{selector:":parent",matches:function(e){return e.isParent()}},{selector:":childless",matches:function(e){return e.isChildless()}},{selector:":child",matches:function(e){return e.isChild()}},{selector:":orphan",matches:function(e){return e.isOrphan()}},{selector:":nonorphan",matches:function(e){return e.isChild()}},{selector:":compound",matches:function(e){return e.isNode()?e.isParent():e.source().isParent()||e.target().isParent()}},{selector:":loop",matches:function(e){return e.isLoop()}},{selector:":simple",matches:function(e){return e.isSimple()}},{selector:":active",matches:function(e){return e.active()}},{selector:":inactive",matches:function(e){return!e.active()}},{selector:":backgrounding",matches:function(e){return e.backgrounding()}},{selector:":nonbackgrounding",matches:function(e){return!e.backgrounding()}}].sort(function(t,e){return NF(t.selector,e.selector)}),A7=(function(){for(var t={},e,r=0;r<qS.length;r++)e=qS[r],t[e.selector]=e.matches;return t})(),L7=function(e,r){return A7[e](r)},R7="("+qS.map(function(t){return t.selector}).join("|")+")",mp=function(e){return e.replace(new RegExp("\\\\("+Dr.metaChar+")","g"),function(r,n){return n})},bd=function(e,r,n){e[e.length-1]=n},$S=[{name:"group",query:!0,regex:"("+Dr.group+")",populate:function(e,r,n){var i=Ai(n,1),a=i[0];r.checks.push({type:Ot.GROUP,value:a==="*"?a:a+"s"})}},{name:"state",query:!0,regex:R7,populate:function(e,r,n){var i=Ai(n,1),a=i[0];r.checks.push({type:Ot.STATE,value:a})}},{name:"id",query:!0,regex:"\\#("+Dr.id+")",populate:function(e,r,n){var i=Ai(n,1),a=i[0];r.checks.push({type:Ot.ID,value:mp(a)})}},{name:"className",query:!0,regex:"\\.("+Dr.className+")",populate:function(e,r,n){var i=Ai(n,1),a=i[0];r.checks.push({type:Ot.CLASS,value:mp(a)})}},{name:"dataExists",query:!0,regex:"\\[\\s*("+Dr.variable+")\\s*\\]",populate:function(e,r,n){var i=Ai(n,1),a=i[0];r.checks.push({type:Ot.DATA_EXIST,field:mp(a)})}},{name:"dataCompare",query:!0,regex:"\\[\\s*("+Dr.variable+")\\s*("+Dr.comparatorOp+")\\s*("+Dr.value+")\\s*\\]",populate:function(e,r,n){var i=Ai(n,3),a=i[0],s=i[1],o=i[2],l=new RegExp("^"+Dr.string+"$").exec(o)!=null;l?o=o.substring(1,o.length-1):o=parseFloat(o),r.checks.push({type:Ot.DATA_COMPARE,field:mp(a),operator:s,value:o})}},{name:"dataBool",query:!0,regex:"\\[\\s*("+Dr.boolOp+")\\s*("+Dr.variable+")\\s*\\]",populate:function(e,r,n){var i=Ai(n,2),a=i[0],s=i[1];r.checks.push({type:Ot.DATA_BOOL,field:mp(s),operator:a})}},{name:"metaCompare",query:!0,regex:"\\[\\[\\s*("+Dr.meta+")\\s*("+Dr.comparatorOp+")\\s*("+Dr.number+")\\s*\\]\\]",populate:function(e,r,n){var i=Ai(n,3),a=i[0],s=i[1],o=i[2];r.checks.push({type:Ot.META_COMPARE,field:mp(a),operator:s,value:parseFloat(o)})}},{name:"nextQuery",separator:!0,regex:Dr.separator,populate:function(e,r){var n=e.currentSubject,i=e.edgeCount,a=e.compoundCount,s=e[e.length-1];n!=null&&(s.subject=n,e.currentSubject=null),s.edgeCount=i,s.compoundCount=a,e.edgeCount=0,e.compoundCount=0;var o=e[e.length++]=ln();return o}},{name:"directedEdge",separator:!0,regex:Dr.directedEdge,populate:function(e,r){if(e.currentSubject==null){var n=ln(),i=r,a=ln();return n.checks.push({type:Ot.DIRECTED_EDGE,source:i,target:a}),bd(e,r,n),e.edgeCount++,a}else{var s=ln(),o=r,l=ln();return s.checks.push({type:Ot.NODE_SOURCE,source:o,target:l}),bd(e,r,s),e.edgeCount++,l}}},{name:"undirectedEdge",separator:!0,regex:Dr.undirectedEdge,populate:function(e,r){if(e.currentSubject==null){var n=ln(),i=r,a=ln();return n.checks.push({type:Ot.UNDIRECTED_EDGE,nodes:[i,a]}),bd(e,r,n),e.edgeCount++,a}else{var s=ln(),o=r,l=ln();return s.checks.push({type:Ot.NODE_NEIGHBOR,node:o,neighbor:l}),bd(e,r,s),l}}},{name:"child",separator:!0,regex:Dr.child,populate:function(e,r){if(e.currentSubject==null){var n=ln(),i=ln(),a=e[e.length-1];return n.checks.push({type:Ot.CHILD,parent:a,child:i}),bd(e,r,n),e.compoundCount++,i}else if(e.currentSubject===r){var s=ln(),o=e[e.length-1],l=ln(),u=ln(),c=ln(),f=ln();return s.checks.push({type:Ot.COMPOUND_SPLIT,left:o,right:l,subject:u}),u.checks=r.checks,r.checks=[{type:Ot.TRUE}],f.checks.push({type:Ot.TRUE}),l.checks.push({type:Ot.PARENT,parent:f,child:c}),bd(e,o,s),e.currentSubject=u,e.compoundCount++,c}else{var p=ln(),v=ln(),y=[{type:Ot.PARENT,parent:p,child:v}];return p.checks=r.checks,r.checks=y,e.compoundCount++,v}}},{name:"descendant",separator:!0,regex:Dr.descendant,populate:function(e,r){if(e.currentSubject==null){var n=ln(),i=ln(),a=e[e.length-1];return n.checks.push({type:Ot.DESCENDANT,ancestor:a,descendant:i}),bd(e,r,n),e.compoundCount++,i}else if(e.currentSubject===r){var s=ln(),o=e[e.length-1],l=ln(),u=ln(),c=ln(),f=ln();return s.checks.push({type:Ot.COMPOUND_SPLIT,left:o,right:l,subject:u}),u.checks=r.checks,r.checks=[{type:Ot.TRUE}],f.checks.push({type:Ot.TRUE}),l.checks.push({type:Ot.ANCESTOR,ancestor:f,descendant:c}),bd(e,o,s),e.currentSubject=u,e.compoundCount++,c}else{var p=ln(),v=ln(),y=[{type:Ot.ANCESTOR,ancestor:p,descendant:v}];return p.checks=r.checks,r.checks=y,e.compoundCount++,v}}},{name:"subject",modifier:!0,regex:Dr.subject,populate:function(e,r){if(e.currentSubject!=null&&e.currentSubject!==r)return Yr("Redefinition of subject in selector `"+e.toString()+"`"),!1;e.currentSubject=r;var n=e[e.length-1],i=n.checks[0],a=i==null?null:i.type;a===Ot.DIRECTED_EDGE?i.type=Ot.NODE_TARGET:a===Ot.UNDIRECTED_EDGE&&(i.type=Ot.NODE_NEIGHBOR,i.node=i.nodes[1],i.neighbor=i.nodes[0],i.nodes=null)}}];$S.forEach(function(t){return t.regexObj=new RegExp("^"+t.regex)});var O7=function(e){for(var r,n,i,a=0;a<$S.length;a++){var s=$S[a],o=s.name,l=e.match(s.regexObj);if(l!=null){n=l,r=s,i=o;var u=l[0];e=e.substring(u.length);break}}return{expr:r,match:n,name:i,remaining:e}},D7=function(e){var r=e.match(/^\s+/);if(r){var n=r[0];e=e.substring(n.length)}return e},I7=function(e){var r=this,n=r.inputText=e,i=r[0]=ln();for(r.length=1,n=D7(n);;){var a=O7(n);if(a.expr==null)return Yr("The selector `"+e+"`is invalid"),!1;var s=a.match.slice(1),o=a.expr.populate(r,i,s);if(o===!1)return!1;if(o!=null&&(i=o),n=a.remaining,n.match(/^\s*$/))break}var l=r[r.length-1];r.currentSubject!=null&&(l.subject=r.currentSubject),l.edgeCount=r.edgeCount,l.compoundCount=r.compoundCount;for(var u=0;u<r.length;u++){var c=r[u];if(c.compoundCount>0&&c.edgeCount>0)return Yr("The selector `"+e+"` is invalid because it uses both a compound selector and an edge selector"),!1;if(c.edgeCount>1)return Yr("The selector `"+e+"` is invalid because it uses multiple edge selectors"),!1;c.edgeCount===1&&Yr("The selector `"+e+"` is deprecated.  Edge selectors do not take effect on changes to source and target nodes after an edge is added, for performance reasons.  Use a class or data selector on edges instead, updating the class or data of an edge when your app detects a change in source or target nodes.")}return!0},j7=function(){if(this.toStringCache!=null)return this.toStringCache;for(var e=function(c){return c??""},r=function(c){return Wt(c)?'"'+c+'"':e(c)},n=function(c){return" "+c+" "},i=function(c,f){var p=c.type,v=c.value;switch(p){case Ot.GROUP:{var y=e(v);return y.substring(0,y.length-1)}case Ot.DATA_COMPARE:{var S=c.field,w=c.operator;return"["+S+n(e(w))+r(v)+"]"}case Ot.DATA_BOOL:{var T=c.operator,_=c.field;return"["+e(T)+_+"]"}case Ot.DATA_EXIST:{var C=c.field;return"["+C+"]"}case Ot.META_COMPARE:{var N=c.operator,A=c.field;return"[["+A+n(e(N))+r(v)+"]]"}case Ot.STATE:return v;case Ot.ID:return"#"+v;case Ot.CLASS:return"."+v;case Ot.PARENT:case Ot.CHILD:return a(c.parent,f)+n(">")+a(c.child,f);case Ot.ANCESTOR:case Ot.DESCENDANT:return a(c.ancestor,f)+" "+a(c.descendant,f);case Ot.COMPOUND_SPLIT:{var O=a(c.left,f),j=a(c.subject,f),D=a(c.right,f);return O+(O.length>0?" ":"")+j+D}case Ot.TRUE:return""}},a=function(c,f){return c.checks.reduce(function(p,v,y){return p+(f===c&&y===0?"$":"")+i(v,f)},"")},s="",o=0;o<this.length;o++){var l=this[o];s+=a(l,l.subject),this.length>1&&o<this.length-1&&(s+=", ")}return this.toStringCache=s,s},F7={parse:I7,toString:j7},LA=function(e,r,n){var i,a=Wt(e),s=gt(e),o=Wt(n),l,u,c=!1,f=!1,p=!1;switch(r.indexOf("!")>=0&&(r=r.replace("!",""),f=!0),r.indexOf("@")>=0&&(r=r.replace("@",""),c=!0),(a||o||c)&&(l=!a&&!s?"":""+e,u=""+n),c&&(e=l=l.toLowerCase(),n=u=u.toLowerCase()),r){case"*=":i=l.indexOf(u)>=0;break;case"$=":i=l.indexOf(u,l.length-u.length)>=0;break;case"^=":i=l.indexOf(u)===0;break;case"=":i=e===n;break;case">":p=!0,i=e>n;break;case">=":p=!0,i=e>=n;break;case"<":p=!0,i=e<n;break;case"<=":p=!0,i=e<=n;break;default:i=!1;break}return f&&(e!=null||!p)&&(i=!i),i},B7=function(e,r){switch(r){case"?":return!!e;case"!":return!e;case"^":return e===void 0}},z7=function(e){return e!==void 0},x_=function(e,r){return e.data(r)},U7=function(e,r){return e[r]()},ai=[],Nn=function(e,r){return e.checks.every(function(n){return ai[n.type](n,r)})};ai[Ot.GROUP]=function(t,e){var r=t.value;return r==="*"||r===e.group()};ai[Ot.STATE]=function(t,e){var r=t.value;return L7(r,e)};ai[Ot.ID]=function(t,e){var r=t.value;return e.id()===r};ai[Ot.CLASS]=function(t,e){var r=t.value;return e.hasClass(r)};ai[Ot.META_COMPARE]=function(t,e){var r=t.field,n=t.operator,i=t.value;return LA(U7(e,r),n,i)};ai[Ot.DATA_COMPARE]=function(t,e){var r=t.field,n=t.operator,i=t.value;return LA(x_(e,r),n,i)};ai[Ot.DATA_BOOL]=function(t,e){var r=t.field,n=t.operator;return B7(x_(e,r),n)};ai[Ot.DATA_EXIST]=function(t,e){var r=t.field;return t.operator,z7(x_(e,r))};ai[Ot.UNDIRECTED_EDGE]=function(t,e){var r=t.nodes[0],n=t.nodes[1],i=e.source(),a=e.target();return Nn(r,i)&&Nn(n,a)||Nn(n,i)&&Nn(r,a)};ai[Ot.NODE_NEIGHBOR]=function(t,e){return Nn(t.node,e)&&e.neighborhood().some(function(r){return r.isNode()&&Nn(t.neighbor,r)})};ai[Ot.DIRECTED_EDGE]=function(t,e){return Nn(t.source,e.source())&&Nn(t.target,e.target())};ai[Ot.NODE_SOURCE]=function(t,e){return Nn(t.source,e)&&e.outgoers().some(function(r){return r.isNode()&&Nn(t.target,r)})};ai[Ot.NODE_TARGET]=function(t,e){return Nn(t.target,e)&&e.incomers().some(function(r){return r.isNode()&&Nn(t.source,r)})};ai[Ot.CHILD]=function(t,e){return Nn(t.child,e)&&Nn(t.parent,e.parent())};ai[Ot.PARENT]=function(t,e){return Nn(t.parent,e)&&e.children().some(function(r){return Nn(t.child,r)})};ai[Ot.DESCENDANT]=function(t,e){return Nn(t.descendant,e)&&e.ancestors().some(function(r){return Nn(t.ancestor,r)})};ai[Ot.ANCESTOR]=function(t,e){return Nn(t.ancestor,e)&&e.descendants().some(function(r){return Nn(t.descendant,r)})};ai[Ot.COMPOUND_SPLIT]=function(t,e){return Nn(t.subject,e)&&Nn(t.left,e)&&Nn(t.right,e)};ai[Ot.TRUE]=function(){return!0};ai[Ot.COLLECTION]=function(t,e){var r=t.value;return r.has(e)};ai[Ot.FILTER]=function(t,e){var r=t.value;return r(e)};var G7=function(e){var r=this;if(r.length===1&&r[0].checks.length===1&&r[0].checks[0].type===Ot.ID)return e.getElementById(r[0].checks[0].value).collection();var n=function(a){for(var s=0;s<r.length;s++){var o=r[s];if(Nn(o,a))return!0}return!1};return r.text()==null&&(n=function(){return!0}),e.filter(n)},V7=function(e){for(var r=this,n=0;n<r.length;n++){var i=r[n];if(Nn(i,e))return!0}return!1},H7={matches:V7,filter:G7},ef=function(e){this.inputText=e,this.currentSubject=null,this.compoundCount=0,this.edgeCount=0,this.length=0,e==null||Wt(e)&&e.match(/^\s*$/)||(uo(e)?this.addQuery({checks:[{type:Ot.COLLECTION,value:e.collection()}]}):Kn(e)?this.addQuery({checks:[{type:Ot.FILTER,value:e}]}):Wt(e)?this.parse(e)||(this.invalid=!0):Gn("A selector must be created from a string; found "))},tf=ef.prototype;[F7,H7].forEach(function(t){return Jt(tf,t)});tf.text=function(){return this.inputText};tf.size=function(){return this.length};tf.eq=function(t){return this[t]};tf.sameText=function(t){return!this.invalid&&!t.invalid&&this.text()===t.text()};tf.addQuery=function(t){this[this.length++]=t};tf.selector=tf.toString;var Vd={allAre:function(e){var r=new ef(e);return this.every(function(n){return r.matches(n)})},is:function(e){var r=new ef(e);return this.some(function(n){return r.matches(n)})},some:function(e,r){for(var n=0;n<this.length;n++){var i=r?e.apply(r,[this[n],n,this]):e(this[n],n,this);if(i)return!0}return!1},every:function(e,r){for(var n=0;n<this.length;n++){var i=r?e.apply(r,[this[n],n,this]):e(this[n],n,this);if(!i)return!1}return!0},same:function(e){if(this===e)return!0;e=this.cy().collection(e);var r=this.length,n=e.length;return r!==n?!1:r===1?this[0]===e[0]:this.every(function(i){return e.hasElementWithId(i.id())})},anySame:function(e){return e=this.cy().collection(e),this.some(function(r){return e.hasElementWithId(r.id())})},allAreNeighbors:function(e){e=this.cy().collection(e);var r=this.neighborhood();return e.every(function(n){return r.hasElementWithId(n.id())})},contains:function(e){e=this.cy().collection(e);var r=this;return e.every(function(n){return r.hasElementWithId(n.id())})}};Vd.allAreNeighbours=Vd.allAreNeighbors;Vd.has=Vd.contains;Vd.equal=Vd.equals=Vd.same;var Go=function(e,r){return function(i,a,s,o){var l=i,u=this,c;if(l==null?c="":uo(l)&&l.length===1&&(c=l.id()),u.length===1&&c){var f=u[0]._private,p=f.traversalCache=f.traversalCache||{},v=p[r]=p[r]||[],y=vh(c),S=v[y];return S||(v[y]=e.call(u,i,a,s,o))}else return e.call(u,i,a,s,o)}},Yp={parent:function(e){var r=[];if(this.length===1){var n=this[0]._private.parent;if(n)return n}for(var i=0;i<this.length;i++){var a=this[i],s=a._private.parent;s&&r.push(s)}return this.spawn(r,!0).filter(e)},parents:function(e){for(var r=[],n=this.parent();n.nonempty();){for(var i=0;i<n.length;i++){var a=n[i];r.push(a)}n=n.parent()}return this.spawn(r,!0).filter(e)},commonAncestors:function(e){for(var r,n=0;n<this.length;n++){var i=this[n],a=i.parents();r=r||a,r=r.intersect(a)}return r.filter(e)},orphans:function(e){return this.stdFilter(function(r){return r.isOrphan()}).filter(e)},nonorphans:function(e){return this.stdFilter(function(r){return r.isChild()}).filter(e)},children:Go(function(t){for(var e=[],r=0;r<this.length;r++)for(var n=this[r],i=n._private.children,a=0;a<i.length;a++)e.push(i[a]);return this.spawn(e,!0).filter(t)},"children"),siblings:function(e){return this.parent().children().not(this).filter(e)},isParent:function(){var e=this[0];if(e)return e.isNode()&&e._private.children.length!==0},isChildless:function(){var e=this[0];if(e)return e.isNode()&&e._private.children.length===0},isChild:function(){var e=this[0];if(e)return e.isNode()&&e._private.parent!=null},isOrphan:function(){var e=this[0];if(e)return e.isNode()&&e._private.parent==null},descendants:function(e){var r=[];function n(i){for(var a=0;a<i.length;a++){var s=i[a];r.push(s),s.children().nonempty()&&n(s.children())}}return n(this.children()),this.spawn(r,!0).filter(e)}};function b_(t,e,r,n){for(var i=[],a=new fm,s=t.cy(),o=s.hasCompoundNodes(),l=0;l<t.length;l++){var u=t[l];r?i.push(u):o&&n(i,a,u)}for(;i.length>0;){var c=i.shift();e(c),a.add(c.id()),o&&n(i,a,c)}return t}function RA(t,e,r){if(r.isParent())for(var n=r._private.children,i=0;i<n.length;i++){var a=n[i];e.has(a.id())||t.push(a)}}Yp.forEachDown=function(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return b_(this,t,e,RA)};function OA(t,e,r){if(r.isChild()){var n=r._private.parent;e.has(n.id())||t.push(n)}}Yp.forEachUp=function(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return b_(this,t,e,OA)};function W7(t,e,r){OA(t,e,r),RA(t,e,r)}Yp.forEachUpAndDown=function(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return b_(this,t,e,W7)};Yp.ancestors=Yp.parents;var Tv,DA;Tv=DA={data:Zr.data({field:"data",bindingEvent:"data",allowBinding:!0,allowSetting:!0,settingEvent:"data",settingTriggersEvent:!0,triggerFnName:"trigger",allowGetting:!0,immutableKeys:{id:!0,source:!0,target:!0,parent:!0},updateStyle:!0}),removeData:Zr.removeData({field:"data",event:"data",triggerFnName:"trigger",triggerEvent:!0,immutableKeys:{id:!0,source:!0,target:!0,parent:!0},updateStyle:!0}),scratch:Zr.data({field:"scratch",bindingEvent:"scratch",allowBinding:!0,allowSetting:!0,settingEvent:"scratch",settingTriggersEvent:!0,triggerFnName:"trigger",allowGetting:!0,updateStyle:!0}),removeScratch:Zr.removeData({field:"scratch",event:"scratch",triggerFnName:"trigger",triggerEvent:!0,updateStyle:!0}),rscratch:Zr.data({field:"rscratch",allowBinding:!1,allowSetting:!0,settingTriggersEvent:!1,allowGetting:!0}),removeRscratch:Zr.removeData({field:"rscratch",triggerEvent:!1}),id:function(){var e=this[0];if(e)return e._private.data.id}};Tv.attr=Tv.data;Tv.removeAttr=Tv.removeData;var q7=DA,L1={};function d2(t){return function(e){var r=this;if(e===void 0&&(e=!0),r.length!==0)if(r.isNode()&&!r.removed()){for(var n=0,i=r[0],a=i._private.edges,s=0;s<a.length;s++){var o=a[s];!e&&o.isLoop()||(n+=t(i,o))}return n}else return}}Jt(L1,{degree:d2(function(t,e){return e.source().same(e.target())?2:1}),indegree:d2(function(t,e){return e.target().same(t)?1:0}),outdegree:d2(function(t,e){return e.source().same(t)?1:0})});function gp(t,e){return function(r){for(var n,i=this.nodes(),a=0;a<i.length;a++){var s=i[a],o=s[t](r);o!==void 0&&(n===void 0||e(o,n))&&(n=o)}return n}}Jt(L1,{minDegree:gp("degree",function(t,e){return t<e}),maxDegree:gp("degree",function(t,e){return t>e}),minIndegree:gp("indegree",function(t,e){return t<e}),maxIndegree:gp("indegree",function(t,e){return t>e}),minOutdegree:gp("outdegree",function(t,e){return t<e}),maxOutdegree:gp("outdegree",function(t,e){return t>e})});Jt(L1,{totalDegree:function(e){for(var r=0,n=this.nodes(),i=0;i<n.length;i++)r+=n[i].degree(e);return r}});var El,IA,jA=function(e,r,n){for(var i=0;i<e.length;i++){var a=e[i];if(!a.locked()){var s=a._private.position,o={x:r.x!=null?r.x-s.x:0,y:r.y!=null?r.y-s.y:0};a.isParent()&&!(o.x===0&&o.y===0)&&a.children().shift(o,n),a.dirtyBoundingBoxCache()}}},CN={field:"position",bindingEvent:"position",allowBinding:!0,allowSetting:!0,settingEvent:"position",settingTriggersEvent:!0,triggerFnName:"emitAndNotify",allowGetting:!0,validKeys:["x","y"],beforeGet:function(e){e.updateCompoundBounds()},beforeSet:function(e,r){jA(e,r,!1)},onSet:function(e){e.dirtyCompoundBoundsCache()},canSet:function(e){return!e.locked()}};El=IA={position:Zr.data(CN),silentPosition:Zr.data(Jt({},CN,{allowBinding:!1,allowSetting:!0,settingTriggersEvent:!1,allowGetting:!1,beforeSet:function(e,r){jA(e,r,!0)},onSet:function(e){e.dirtyCompoundBoundsCache()}})),positions:function(e,r){if(Ir(e))r?this.silentPosition(e):this.position(e);else if(Kn(e)){var n=e,i=this.cy();i.startBatch();for(var a=0;a<this.length;a++){var s=this[a],o=void 0;(o=n(s,a))&&(r?s.silentPosition(o):s.position(o))}i.endBatch()}return this},silentPositions:function(e){return this.positions(e,!0)},shift:function(e,r,n){var i;if(Ir(e)?(i={x:gt(e.x)?e.x:0,y:gt(e.y)?e.y:0},n=r):Wt(e)&&gt(r)&&(i={x:0,y:0},i[e]=r),i!=null){var a=this.cy();a.startBatch();for(var s=0;s<this.length;s++){var o=this[s];if(!(a.hasCompoundNodes()&&o.isChild()&&o.ancestors().anySame(this))){var l=o.position(),u={x:l.x+i.x,y:l.y+i.y};n?o.silentPosition(u):o.position(u)}}a.endBatch()}return this},silentShift:function(e,r){return Ir(e)?this.shift(e,!0):Wt(e)&&gt(r)&&this.shift(e,r,!0),this},renderedPosition:function(e,r){var n=this[0],i=this.cy(),a=i.zoom(),s=i.pan(),o=Ir(e)?e:void 0,l=o!==void 0||r!==void 0&&Wt(e);if(n&&n.isNode())if(l)for(var u=0;u<this.length;u++){var c=this[u];r!==void 0?c.position(e,(r-s[e])/a):o!==void 0&&c.position(dA(o,a,s))}else{var f=n.position();return o=E1(f,a,s),e===void 0?o:o[e]}else if(!l)return;return this},relativePosition:function(e,r){var n=this[0],i=this.cy(),a=Ir(e)?e:void 0,s=a!==void 0||r!==void 0&&Wt(e),o=i.hasCompoundNodes();if(n&&n.isNode())if(s)for(var l=0;l<this.length;l++){var u=this[l],c=o?u.parent():null,f=c&&c.length>0,p=f;f&&(c=c[0]);var v=p?c.position():{x:0,y:0};r!==void 0?u.position(e,r+v[e]):a!==void 0&&u.position({x:a.x+v.x,y:a.y+v.y})}else{var y=n.position(),S=o?n.parent():null,w=S&&S.length>0,T=w;w&&(S=S[0]);var _=T?S.position():{x:0,y:0};return a={x:y.x-_.x,y:y.y-_.y},e===void 0?a:a[e]}else if(!s)return;return this}};El.modelPosition=El.point=El.position;El.modelPositions=El.points=El.positions;El.renderedPoint=El.renderedPosition;El.relativePoint=El.relativePosition;var $7=IA,Vp,cf;Vp=cf={};cf.renderedBoundingBox=function(t){var e=this.boundingBox(t),r=this.cy(),n=r.zoom(),i=r.pan(),a=e.x1*n+i.x,s=e.x2*n+i.x,o=e.y1*n+i.y,l=e.y2*n+i.y;return{x1:a,x2:s,y1:o,y2:l,w:s-a,h:l-o}};cf.dirtyCompoundBoundsCache=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,e=this.cy();return!e.styleEnabled()||!e.hasCompoundNodes()?this:(this.forEachUp(function(r){if(r.isParent()){var n=r._private;n.compoundBoundsClean=!1,n.bbCache=null,t||r.emitAndNotify("bounds")}}),this)};cf.updateCompoundBounds=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,e=this.cy();if(!e.styleEnabled()||!e.hasCompoundNodes())return this;if(!t&&e.batching())return this;function r(s){if(!s.isParent())return;var o=s._private,l=s.children(),u=s.pstyle("compound-sizing-wrt-labels").value==="include",c={width:{val:s.pstyle("min-width").pfValue,left:s.pstyle("min-width-bias-left"),right:s.pstyle("min-width-bias-right")},height:{val:s.pstyle("min-height").pfValue,top:s.pstyle("min-height-bias-top"),bottom:s.pstyle("min-height-bias-bottom")}},f=l.boundingBox({includeLabels:u,includeOverlays:!1,useCache:!1}),p=o.position;(f.w===0||f.h===0)&&(f={w:s.pstyle("width").pfValue,h:s.pstyle("height").pfValue},f.x1=p.x-f.w/2,f.x2=p.x+f.w/2,f.y1=p.y-f.h/2,f.y2=p.y+f.h/2);function v(F,B,$){var Z=0,I=0,q=B+$;return F>0&&q>0&&(Z=B/q*F,I=$/q*F),{biasDiff:Z,biasComplementDiff:I}}function y(F,B,$,Z){if($.units==="%")switch(Z){case"width":return F>0?$.pfValue*F:0;case"height":return B>0?$.pfValue*B:0;case"average":return F>0&&B>0?$.pfValue*(F+B)/2:0;case"min":return F>0&&B>0?F>B?$.pfValue*B:$.pfValue*F:0;case"max":return F>0&&B>0?F>B?$.pfValue*F:$.pfValue*B:0;default:return 0}else return $.units==="px"?$.pfValue:0}var S=c.width.left.value;c.width.left.units==="px"&&c.width.val>0&&(S=S*100/c.width.val);var w=c.width.right.value;c.width.right.units==="px"&&c.width.val>0&&(w=w*100/c.width.val);var T=c.height.top.value;c.height.top.units==="px"&&c.height.val>0&&(T=T*100/c.height.val);var _=c.height.bottom.value;c.height.bottom.units==="px"&&c.height.val>0&&(_=_*100/c.height.val);var C=v(c.width.val-f.w,S,w),N=C.biasDiff,A=C.biasComplementDiff,O=v(c.height.val-f.h,T,_),j=O.biasDiff,D=O.biasComplementDiff;o.autoPadding=y(f.w,f.h,s.pstyle("padding"),s.pstyle("padding-relative-to").value),o.autoWidth=Math.max(f.w,c.width.val),p.x=(-N+f.x1+f.x2+A)/2,o.autoHeight=Math.max(f.h,c.height.val),p.y=(-j+f.y1+f.y2+D)/2}for(var n=0;n<this.length;n++){var i=this[n],a=i._private;(!a.compoundBoundsClean||t)&&(r(i),e.batching()||(a.compoundBoundsClean=!0))}return this};var zo=function(e){return e===1/0||e===-1/0?0:e},Sl=function(e,r,n,i,a){i-r===0||a-n===0||r==null||n==null||i==null||a==null||(e.x1=r<e.x1?r:e.x1,e.x2=i>e.x2?i:e.x2,e.y1=n<e.y1?n:e.y1,e.y2=a>e.y2?a:e.y2,e.w=e.x2-e.x1,e.h=e.y2-e.y1)},Nd=function(e,r){return r==null?e:Sl(e,r.x1,r.y1,r.x2,r.y2)},qm=function(e,r,n){return Gs(e,r,n)},sy=function(e,r,n){if(!r.cy().headless()){var i=r._private,a=i.rstyle,s=a.arrowWidth/2,o=r.pstyle(n+"-arrow-shape").value,l,u;if(o!=="none"){n==="source"?(l=a.srcX,u=a.srcY):n==="target"?(l=a.tgtX,u=a.tgtY):(l=a.midX,u=a.midY);var c=i.arrowBounds=i.arrowBounds||{},f=c[n]=c[n]||{};f.x1=l-s,f.y1=u-s,f.x2=l+s,f.y2=u+s,f.w=f.x2-f.x1,f.h=f.y2-f.y1,zy(f,1),Sl(e,f.x1,f.y1,f.x2,f.y2)}}},f2=function(e,r,n){if(!r.cy().headless()){var i;n?i=n+"-":i="";var a=r._private,s=a.rstyle,o=r.pstyle(i+"label").strValue;if(o){var l=r.pstyle("text-halign"),u=r.pstyle("text-valign"),c=qm(s,"labelWidth",n),f=qm(s,"labelHeight",n),p=qm(s,"labelX",n),v=qm(s,"labelY",n),y=r.pstyle(i+"text-margin-x").pfValue,S=r.pstyle(i+"text-margin-y").pfValue,w=r.isEdge(),T=r.pstyle(i+"text-rotation"),_=r.pstyle("text-outline-width").pfValue,C=r.pstyle("text-border-width").pfValue,N=C/2,A=r.pstyle("text-background-padding").pfValue,O=2,j=f,D=c,F=D/2,B=j/2,$,Z,I,q;if(w)$=p-F,Z=p+F,I=v-B,q=v+B;else{switch(l.value){case"left":$=p-D,Z=p;break;case"center":$=p-F,Z=p+F;break;case"right":$=p,Z=p+D;break}switch(u.value){case"top":I=v-j,q=v;break;case"center":I=v-B,q=v+B;break;case"bottom":I=v,q=v+j;break}}var U=y-Math.max(_,N)-A-O,W=y+Math.max(_,N)+A+O,Y=S-Math.max(_,N)-A-O,Q=S+Math.max(_,N)+A+O;$+=U,Z+=W,I+=Y,q+=Q;var ne=n||"main",re=a.labelBounds,H=re[ne]=re[ne]||{};H.x1=$,H.y1=I,H.x2=Z,H.y2=q,H.w=Z-$,H.h=q-I,H.leftPad=U,H.rightPad=W,H.topPad=Y,H.botPad=Q;var te=w&&T.strValue==="autorotate",ie=T.pfValue!=null&&T.pfValue!==0;if(te||ie){var de=te?qm(a.rstyle,"labelAngle",n):T.pfValue,ge=Math.cos(de),ye=Math.sin(de),ae=($+Z)/2,pe=(I+q)/2;if(!w){switch(l.value){case"left":ae=Z;break;case"right":ae=$;break}switch(u.value){case"top":pe=q;break;case"bottom":pe=I;break}}var le=function(et,at){return et=et-ae,at=at-pe,{x:et*ge-at*ye+ae,y:et*ye+at*ge+pe}},me=le($,I),he=le($,q),xe=le(Z,I),we=le(Z,q);$=Math.min(me.x,he.x,xe.x,we.x),Z=Math.max(me.x,he.x,xe.x,we.x),I=Math.min(me.y,he.y,xe.y,we.y),q=Math.max(me.y,he.y,xe.y,we.y)}var Ge=ne+"Rot",qe=re[Ge]=re[Ge]||{};qe.x1=$,qe.y1=I,qe.x2=Z,qe.y2=q,qe.w=Z-$,qe.h=q-I,Sl(e,$,I,Z,q),Sl(a.labelBounds.all,$,I,Z,q)}return e}},EN=function(e,r){if(!r.cy().headless()){var n=r.pstyle("outline-opacity").value,i=r.pstyle("outline-width").value,a=r.pstyle("outline-offset").value,s=i+a;FA(e,r,n,s,"outside",s/2)}},FA=function(e,r,n,i,a,s){if(!(n===0||i<=0||a==="inside")){var o=r.cy(),l=r.pstyle("shape").value,u=o.renderer().nodeShapes[l],c=r.position(),f=c.x,p=c.y,v=r.width(),y=r.height();if(u.hasMiterBounds){a==="center"&&(i/=2);var S=u.miterBounds(f,p,v,y,i);Nd(e,S)}else s!=null&&s>0&&Uy(e,[s,s,s,s])}},K7=function(e,r){if(!r.cy().headless()){var n=r.pstyle("border-opacity").value,i=r.pstyle("border-width").pfValue,a=r.pstyle("border-position").value;FA(e,r,n,i,a)}},Z7=function(e,r){var n=e._private.cy,i=n.styleEnabled(),a=n.headless(),s=_s(),o=e._private,l=e.isNode(),u=e.isEdge(),c,f,p,v,y,S,w=o.rstyle,T=l&&i?e.pstyle("bounds-expansion").pfValue:[0],_=function(wt){return wt.pstyle("display").value!=="none"},C=!i||_(e)&&(!u||_(e.source())&&_(e.target()));if(C){var N=0,A=0;i&&r.includeOverlays&&(N=e.pstyle("overlay-opacity").value,N!==0&&(A=e.pstyle("overlay-padding").value));var O=0,j=0;i&&r.includeUnderlays&&(O=e.pstyle("underlay-opacity").value,O!==0&&(j=e.pstyle("underlay-padding").value));var D=Math.max(A,j),F=0,B=0;if(i&&(F=e.pstyle("width").pfValue,B=F/2),l&&r.includeNodes){var $=e.position();y=$.x,S=$.y;var Z=e.outerWidth(),I=Z/2,q=e.outerHeight(),U=q/2;c=y-I,f=y+I,p=S-U,v=S+U,Sl(s,c,p,f,v),i&&EN(s,e),i&&r.includeOutlines&&!a&&EN(s,e),i&&K7(s,e)}else if(u&&r.includeEdges)if(i&&!a){var W=e.pstyle("curve-style").strValue;if(c=Math.min(w.srcX,w.midX,w.tgtX),f=Math.max(w.srcX,w.midX,w.tgtX),p=Math.min(w.srcY,w.midY,w.tgtY),v=Math.max(w.srcY,w.midY,w.tgtY),c-=B,f+=B,p-=B,v+=B,Sl(s,c,p,f,v),W==="haystack"){var Y=w.haystackPts;if(Y&&Y.length===2){if(c=Y[0].x,p=Y[0].y,f=Y[1].x,v=Y[1].y,c>f){var Q=c;c=f,f=Q}if(p>v){var ne=p;p=v,v=ne}Sl(s,c-B,p-B,f+B,v+B)}}else if(W==="bezier"||W==="unbundled-bezier"||Dd(W,"segments")||Dd(W,"taxi")){var re;switch(W){case"bezier":case"unbundled-bezier":re=w.bezierPts;break;case"segments":case"taxi":case"round-segments":case"round-taxi":re=w.linePts;break}if(re!=null)for(var H=0;H<re.length;H++){var te=re[H];c=te.x-B,f=te.x+B,p=te.y-B,v=te.y+B,Sl(s,c,p,f,v)}}}else{var ie=e.source(),de=ie.position(),ge=e.target(),ye=ge.position();if(c=de.x,f=ye.x,p=de.y,v=ye.y,c>f){var ae=c;c=f,f=ae}if(p>v){var pe=p;p=v,v=pe}c-=B,f+=B,p-=B,v+=B,Sl(s,c,p,f,v)}if(i&&r.includeEdges&&u&&(sy(s,e,"mid-source"),sy(s,e,"mid-target"),sy(s,e,"source"),sy(s,e,"target")),i){var le=e.pstyle("ghost").value==="yes";if(le){var me=e.pstyle("ghost-offset-x").pfValue,he=e.pstyle("ghost-offset-y").pfValue;Sl(s,s.x1+me,s.y1+he,s.x2+me,s.y2+he)}}var xe=o.bodyBounds=o.bodyBounds||{};dT(xe,s),Uy(xe,T),zy(xe,1),i&&(c=s.x1,f=s.x2,p=s.y1,v=s.y2,Sl(s,c-D,p-D,f+D,v+D));var we=o.overlayBounds=o.overlayBounds||{};dT(we,s),Uy(we,T),zy(we,1);var Ge=o.labelBounds=o.labelBounds||{};Ge.all!=null?M9(Ge.all):Ge.all=_s(),i&&r.includeLabels&&(r.includeMainLabels&&f2(s,e,null),u&&(r.includeSourceLabels&&f2(s,e,"source"),r.includeTargetLabels&&f2(s,e,"target")))}return s.x1=zo(s.x1),s.y1=zo(s.y1),s.x2=zo(s.x2),s.y2=zo(s.y2),s.w=zo(s.x2-s.x1),s.h=zo(s.y2-s.y1),s.w>0&&s.h>0&&C&&(Uy(s,T),zy(s,1)),s},BA=function(e){var r=0,n=function(s){return(s?1:0)<<r++},i=0;return i+=n(e.incudeNodes),i+=n(e.includeEdges),i+=n(e.includeLabels),i+=n(e.includeMainLabels),i+=n(e.includeSourceLabels),i+=n(e.includeTargetLabels),i+=n(e.includeOverlays),i+=n(e.includeOutlines),i},zA=function(e){var r=function(o){return Math.round(o)};if(e.isEdge()){var n=e.source().position(),i=e.target().position();return aT([r(n.x),r(n.y),r(i.x),r(i.y)])}else{var a=e.position();return aT([r(a.x),r(a.y)])}},TN=function(e,r){var n=e._private,i,a=e.isEdge(),s=r==null?NN:BA(r),o=s===NN;if(n.bbCache==null?(i=Z7(e,Nv),n.bbCache=i,n.bbCachePosKey=zA(e)):i=n.bbCache,!o){var l=e.isNode();i=_s(),(r.includeNodes&&l||r.includeEdges&&!l)&&(r.includeOverlays?Nd(i,n.overlayBounds):Nd(i,n.bodyBounds)),r.includeLabels&&(r.includeMainLabels&&(!a||r.includeSourceLabels&&r.includeTargetLabels)?Nd(i,n.labelBounds.all):(r.includeMainLabels&&Nd(i,n.labelBounds.mainRot),r.includeSourceLabels&&Nd(i,n.labelBounds.sourceRot),r.includeTargetLabels&&Nd(i,n.labelBounds.targetRot))),i.w=i.x2-i.x1,i.h=i.y2-i.y1}return i},Nv={includeNodes:!0,includeEdges:!0,includeLabels:!0,includeMainLabels:!0,includeSourceLabels:!0,includeTargetLabels:!0,includeOverlays:!0,includeUnderlays:!0,includeOutlines:!0,useCache:!0},NN=BA(Nv),PN=Ua(Nv);cf.boundingBox=function(t){var e,r=t===void 0||t.useCache===void 0||t.useCache===!0,n=Kp(function(c){var f=c._private;return f.bbCache==null||f.styleDirty||f.bbCachePosKey!==zA(c)},function(c){return c.id()});if(r&&this.length===1&&!n(this[0]))t===void 0?t=Nv:t=PN(t),e=TN(this[0],t);else{e=_s(),t=t||Nv;var i=PN(t),a=this,s=a.cy(),o=s.styleEnabled();this.edges().forEach(n),this.nodes().forEach(n),o&&this.recalculateRenderedStyle(r),this.updateCompoundBounds(!r);for(var l=0;l<a.length;l++){var u=a[l];n(u)&&u.dirtyBoundingBoxCache(),Nd(e,TN(u,i))}}return e.x1=zo(e.x1),e.y1=zo(e.y1),e.x2=zo(e.x2),e.y2=zo(e.y2),e.w=zo(e.x2-e.x1),e.h=zo(e.y2-e.y1),e};cf.dirtyBoundingBoxCache=function(){for(var t=0;t<this.length;t++){var e=this[t]._private;e.bbCache=null,e.bbCachePosKey=null,e.bodyBounds=null,e.overlayBounds=null,e.labelBounds.all=null,e.labelBounds.source=null,e.labelBounds.target=null,e.labelBounds.main=null,e.labelBounds.sourceRot=null,e.labelBounds.targetRot=null,e.labelBounds.mainRot=null,e.arrowBounds.source=null,e.arrowBounds.target=null,e.arrowBounds["mid-source"]=null,e.arrowBounds["mid-target"]=null}return this.emitAndNotify("bounds"),this};cf.boundingBoxAt=function(t){var e=this.nodes(),r=this.cy(),n=r.hasCompoundNodes(),i=r.collection();if(n&&(i=e.filter(function(u){return u.isParent()}),e=e.not(i)),Ir(t)){var a=t;t=function(){return a}}var s=function(c,f){return c._private.bbAtOldPos=t(c,f)},o=function(c){return c._private.bbAtOldPos};r.startBatch(),e.forEach(s).silentPositions(t),n&&(i.dirtyCompoundBoundsCache(),i.dirtyBoundingBoxCache(),i.updateCompoundBounds(!0));var l=P9(this.boundingBox({useCache:!1}));return e.silentPositions(o),n&&(i.dirtyCompoundBoundsCache(),i.dirtyBoundingBoxCache(),i.updateCompoundBounds(!0)),r.endBatch(),l};Vp.boundingbox=Vp.bb=Vp.boundingBox;Vp.renderedBoundingbox=Vp.renderedBoundingBox;var Y7=cf,Zg,a0;Zg=a0={};var UA=function(e){e.uppercaseName=HE(e.name),e.autoName="auto"+e.uppercaseName,e.labelName="label"+e.uppercaseName,e.outerName="outer"+e.uppercaseName,e.uppercaseOuterName=HE(e.outerName),Zg[e.name]=function(){var n=this[0],i=n._private,a=i.cy,s=a._private.styleEnabled;if(n)if(s){if(n.isParent())return n.updateCompoundBounds(),i[e.autoName]||0;var o=n.pstyle(e.name);return o.strValue==="label"?(n.recalculateRenderedStyle(),i.rstyle[e.labelName]||0):o.pfValue}else return 1},Zg["outer"+e.uppercaseName]=function(){var n=this[0],i=n._private,a=i.cy,s=a._private.styleEnabled;if(n)if(s){var o=n[e.name](),l=n.pstyle("border-position").value,u;l==="center"?u=n.pstyle("border-width").pfValue:l==="outside"?u=2*n.pstyle("border-width").pfValue:u=0;var c=2*n.padding();return o+u+c}else return 1},Zg["rendered"+e.uppercaseName]=function(){var n=this[0];if(n){var i=n[e.name]();return i*this.cy().zoom()}},Zg["rendered"+e.uppercaseOuterName]=function(){var n=this[0];if(n){var i=n[e.outerName]();return i*this.cy().zoom()}}};UA({name:"width"});UA({name:"height"});a0.padding=function(){var t=this[0],e=t._private;return t.isParent()?(t.updateCompoundBounds(),e.autoPadding!==void 0?e.autoPadding:t.pstyle("padding").pfValue):t.pstyle("padding").pfValue};a0.paddedHeight=function(){var t=this[0];return t.height()+2*t.padding()};a0.paddedWidth=function(){var t=this[0];return t.width()+2*t.padding()};var X7=a0,Q7=function(e,r){if(e.isEdge()&&e.takesUpSpace())return r(e)},J7=function(e,r){if(e.isEdge()&&e.takesUpSpace()){var n=e.cy();return E1(r(e),n.zoom(),n.pan())}},ez=function(e,r){if(e.isEdge()&&e.takesUpSpace()){var n=e.cy(),i=n.pan(),a=n.zoom();return r(e).map(function(s){return E1(s,a,i)})}},tz=function(e){return e.renderer().getControlPoints(e)},rz=function(e){return e.renderer().getSegmentPoints(e)},nz=function(e){return e.renderer().getSourceEndpoint(e)},iz=function(e){return e.renderer().getTargetEndpoint(e)},az=function(e){return e.renderer().getEdgeMidpoint(e)},MN={controlPoints:{get:tz,mult:!0},segmentPoints:{get:rz,mult:!0},sourceEndpoint:{get:nz},targetEndpoint:{get:iz},midpoint:{get:az}},sz=function(e){return"rendered"+e[0].toUpperCase()+e.substr(1)},oz=Object.keys(MN).reduce(function(t,e){var r=MN[e],n=sz(e);return t[e]=function(){return Q7(this,r.get)},r.mult?t[n]=function(){return ez(this,r.get)}:t[n]=function(){return J7(this,r.get)},t},{}),lz=Jt({},$7,Y7,X7,oz);var GA=function(e,r){this.recycle(e,r)};function $m(){return!1}function oy(){return!0}GA.prototype={instanceString:function(){return"event"},recycle:function(e,r){if(this.isImmediatePropagationStopped=this.isPropagationStopped=this.isDefaultPrevented=$m,e!=null&&e.preventDefault?(this.type=e.type,this.isDefaultPrevented=e.defaultPrevented?oy:$m):e!=null&&e.type?r=e:this.type=e,r!=null&&(this.originalEvent=r.originalEvent,this.type=r.type!=null?r.type:this.type,this.cy=r.cy,this.target=r.target,this.position=r.position,this.renderedPosition=r.renderedPosition,this.namespace=r.namespace,this.layout=r.layout),this.cy!=null&&this.position!=null&&this.renderedPosition==null){var n=this.position,i=this.cy.zoom(),a=this.cy.pan();this.renderedPosition={x:n.x*i+a.x,y:n.y*i+a.y}}this.timeStamp=e&&e.timeStamp||Date.now()},preventDefault:function(){this.isDefaultPrevented=oy;var e=this.originalEvent;e&&e.preventDefault&&e.preventDefault()},stopPropagation:function(){this.isPropagationStopped=oy;var e=this.originalEvent;e&&e.stopPropagation&&e.stopPropagation()},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=oy,this.stopPropagation()},isDefaultPrevented:$m,isPropagationStopped:$m,isImmediatePropagationStopped:$m};var VA=/^([^.]+)(\.(?:[^.]+))?$/,uz=".*",HA={qualifierCompare:function(e,r){return e===r},eventMatches:function(){return!0},addEventFields:function(){},callbackContext:function(e){return e},beforeEmit:function(){},afterEmit:function(){},bubble:function(){return!1},parent:function(){return null},context:null},AN=Object.keys(HA),cz={};function R1(){for(var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:cz,e=arguments.length>1?arguments[1]:void 0,r=0;r<AN.length;r++){var n=AN[r];this[n]=t[n]||HA[n]}this.context=e||this.context,this.listeners=[],this.emitting=0}var rf=R1.prototype,WA=function(e,r,n,i,a,s,o){Kn(i)&&(a=i,i=null),o&&(s==null?s=o:s=Jt({},s,o));for(var l=pn(n)?n:n.split(/\s+/),u=0;u<l.length;u++){var c=l[u];if(!Xd(c)){var f=c.match(VA);if(f){var p=f[1],v=f[2]?f[2]:null,y=r(e,c,p,v,i,a,s);if(y===!1)break}}}},LN=function(e,r){return e.addEventFields(e.context,r),new GA(r.type,r)},dz=function(e,r,n){if(vF(n)){r(e,n);return}else if(Ir(n)){r(e,LN(e,n));return}for(var i=pn(n)?n:n.split(/\s+/),a=0;a<i.length;a++){var s=i[a];if(!Xd(s)){var o=s.match(VA);if(o){var l=o[1],u=o[2]?o[2]:null,c=LN(e,{type:l,namespace:u,target:e.context});r(e,c)}}}};rf.on=rf.addListener=function(t,e,r,n,i){return WA(this,function(a,s,o,l,u,c,f){Kn(c)&&a.listeners.push({event:s,callback:c,type:o,namespace:l,qualifier:u,conf:f})},t,e,r,n,i),this};rf.one=function(t,e,r,n){return this.on(t,e,r,n,{one:!0})};rf.removeListener=rf.off=function(t,e,r,n){var i=this;this.emitting!==0&&(this.listeners=JF(this.listeners));for(var a=this.listeners,s=function(u){var c=a[u];WA(i,function(f,p,v,y,S,w){if((c.type===v||t==="*")&&(!y&&c.namespace!==".*"||c.namespace===y)&&(!S||f.qualifierCompare(c.qualifier,S))&&(!w||c.callback===w))return a.splice(u,1),!1},t,e,r,n)},o=a.length-1;o>=0;o--)s(o);return this};rf.removeAllListeners=function(){return this.removeListener("*")};rf.emit=rf.trigger=function(t,e,r){var n=this.listeners,i=n.length;return this.emitting++,pn(e)||(e=[e]),dz(this,function(a,s){r!=null&&(n=[{event:s.event,type:s.type,namespace:s.namespace,callback:r}],i=n.length);for(var o=function(){var c=n[l];if(c.type===s.type&&(!c.namespace||c.namespace===s.namespace||c.namespace===uz)&&a.eventMatches(a.context,c,s)){var f=[s];e!=null&&t9(f,e),a.beforeEmit(a.context,c,s),c.conf&&c.conf.one&&(a.listeners=a.listeners.filter(function(y){return y!==c}));var p=a.callbackContext(a.context,c,s),v=c.callback.apply(p,f);a.afterEmit(a.context,c,s),v===!1&&(s.stopPropagation(),s.preventDefault())}},l=0;l<i;l++)o();a.bubble(a.context)&&!s.isPropagationStopped()&&a.parent(a.context).emit(s,e)},t),this.emitting--,this};var fz={qualifierCompare:function(e,r){return e==null||r==null?e==null&&r==null:e.sameText(r)},eventMatches:function(e,r,n){var i=r.qualifier;return i!=null?e!==n.target&&Jv(n.target)&&i.matches(n.target):!0},addEventFields:function(e,r){r.cy=e.cy(),r.target=e},callbackContext:function(e,r,n){return r.qualifier!=null?n.target:e},beforeEmit:function(e,r){r.conf&&r.conf.once&&r.conf.onceCollection.removeListener(r.event,r.qualifier,r.callback)},bubble:function(){return!0},parent:function(e){return e.isChild()?e.parent():e.cy()}},ly=function(e){return Wt(e)?new ef(e):e},qA={createEmitter:function(){for(var e=0;e<this.length;e++){var r=this[e],n=r._private;n.emitter||(n.emitter=new R1(fz,r))}return this},emitter:function(){return this._private.emitter},on:function(e,r,n){for(var i=ly(r),a=0;a<this.length;a++){var s=this[a];s.emitter().on(e,i,n)}return this},removeListener:function(e,r,n){for(var i=ly(r),a=0;a<this.length;a++){var s=this[a];s.emitter().removeListener(e,i,n)}return this},removeAllListeners:function(){for(var e=0;e<this.length;e++){var r=this[e];r.emitter().removeAllListeners()}return this},one:function(e,r,n){for(var i=ly(r),a=0;a<this.length;a++){var s=this[a];s.emitter().one(e,i,n)}return this},once:function(e,r,n){for(var i=ly(r),a=0;a<this.length;a++){var s=this[a];s.emitter().on(e,i,n,{once:!0,onceCollection:this})}},emit:function(e,r){for(var n=0;n<this.length;n++){var i=this[n];i.emitter().emit(e,r)}return this},emitAndNotify:function(e,r){if(this.length!==0)return this.cy().notify(e,this),this.emit(e,r),this}};Zr.eventAliasesOn(qA);var $A={nodes:function(e){return this.filter(function(r){return r.isNode()}).filter(e)},edges:function(e){return this.filter(function(r){return r.isEdge()}).filter(e)},byGroup:function(){for(var e=this.spawn(),r=this.spawn(),n=0;n<this.length;n++){var i=this[n];i.isNode()?e.push(i):r.push(i)}return{nodes:e,edges:r}},filter:function(e,r){if(e===void 0)return this;if(Wt(e)||uo(e))return new ef(e).filter(this);if(Kn(e)){for(var n=this.spawn(),i=this,a=0;a<i.length;a++){var s=i[a],o=r?e.apply(r,[s,a,i]):e(s,a,i);o&&n.push(s)}return n}return this.spawn()},not:function(e){if(e){Wt(e)&&(e=this.filter(e));for(var r=this.spawn(),n=0;n<this.length;n++){var i=this[n],a=e.has(i);a||r.push(i)}return r}else return this},absoluteComplement:function(){var e=this.cy();return e.mutableElements().not(this)},intersect:function(e){if(Wt(e)){var r=e;return this.filter(r)}for(var n=this.spawn(),i=this,a=e,s=this.length<e.length,o=s?i:a,l=s?a:i,u=0;u<o.length;u++){var c=o[u];l.has(c)&&n.push(c)}return n},xor:function(e){var r=this._private.cy;Wt(e)&&(e=r.$(e));var n=this.spawn(),i=this,a=e,s=function(l,u){for(var c=0;c<l.length;c++){var f=l[c],p=f._private.data.id,v=u.hasElementWithId(p);v||n.push(f)}};return s(i,a),s(a,i),n},diff:function(e){var r=this._private.cy;Wt(e)&&(e=r.$(e));var n=this.spawn(),i=this.spawn(),a=this.spawn(),s=this,o=e,l=function(c,f,p){for(var v=0;v<c.length;v++){var y=c[v],S=y._private.data.id,w=f.hasElementWithId(S);w?a.merge(y):p.push(y)}};return l(s,o,n),l(o,s,i),{left:n,right:i,both:a}},add:function(e){var r=this._private.cy;if(!e)return this;if(Wt(e)){var n=e;e=r.mutableElements().filter(n)}for(var i=this.spawnSelf(),a=0;a<e.length;a++){var s=e[a],o=!this.has(s);o&&i.push(s)}return i},merge:function(e){var r=this._private,n=r.cy;if(!e)return this;if(e&&Wt(e)){var i=e;e=n.mutableElements().filter(i)}for(var a=r.map,s=0;s<e.length;s++){var o=e[s],l=o._private.data.id,u=!a.has(l);if(u){var c=this.length++;this[c]=o,a.set(l,{ele:o,index:c})}}return this},unmergeAt:function(e){var r=this[e],n=r.id(),i=this._private,a=i.map;this[e]=void 0,a.delete(n);var s=e===this.length-1;if(this.length>1&&!s){var o=this.length-1,l=this[o],u=l._private.data.id;this[o]=void 0,this[e]=l,a.set(u,{ele:l,index:e})}return this.length--,this},unmergeOne:function(e){e=e[0];var r=this._private,n=e._private.data.id,i=r.map,a=i.get(n);if(!a)return this;var s=a.index;return this.unmergeAt(s),this},unmerge:function(e){var r=this._private.cy;if(!e)return this;if(e&&Wt(e)){var n=e;e=r.mutableElements().filter(n)}for(var i=0;i<e.length;i++)this.unmergeOne(e[i]);return this},unmergeBy:function(e){for(var r=this.length-1;r>=0;r--){var n=this[r];e(n)&&this.unmergeAt(r)}return this},map:function(e,r){for(var n=[],i=this,a=0;a<i.length;a++){var s=i[a],o=r?e.apply(r,[s,a,i]):e(s,a,i);n.push(o)}return n},reduce:function(e,r){for(var n=r,i=this,a=0;a<i.length;a++)n=e(n,i[a],a,i);return n},max:function(e,r){for(var n=-1/0,i,a=this,s=0;s<a.length;s++){var o=a[s],l=r?e.apply(r,[o,s,a]):e(o,s,a);l>n&&(n=l,i=o)}return{value:n,ele:i}},min:function(e,r){for(var n=1/0,i,a=this,s=0;s<a.length;s++){var o=a[s],l=r?e.apply(r,[o,s,a]):e(o,s,a);l<n&&(n=l,i=o)}return{value:n,ele:i}}},Br=$A;Br.u=Br["|"]=Br["+"]=Br.union=Br.or=Br.add;Br["\\"]=Br["!"]=Br["-"]=Br.difference=Br.relativeComplement=Br.subtract=Br.not;Br.n=Br["&"]=Br["."]=Br.and=Br.intersection=Br.intersect;Br["^"]=Br["(+)"]=Br["(-)"]=Br.symmetricDifference=Br.symdiff=Br.xor;Br.fnFilter=Br.filterFn=Br.stdFilter=Br.filter;Br.complement=Br.abscomp=Br.absoluteComplement;var hz={isNode:function(){return this.group()==="nodes"},isEdge:function(){return this.group()==="edges"},isLoop:function(){return this.isEdge()&&this.source()[0]===this.target()[0]},isSimple:function(){return this.isEdge()&&this.source()[0]!==this.target()[0]},group:function(){var e=this[0];if(e)return e._private.group}},KA=function(e,r){var n=e.cy(),i=n.hasCompoundNodes();function a(c){var f=c.pstyle("z-compound-depth");return f.value==="auto"?i?c.zDepth():0:f.value==="bottom"?-1:f.value==="top"?u_:0}var s=a(e)-a(r);if(s!==0)return s;function o(c){var f=c.pstyle("z-index-compare");return f.value==="auto"&&c.isNode()?1:0}var l=o(e)-o(r);if(l!==0)return l;var u=e.pstyle("z-index").value-r.pstyle("z-index").value;return u!==0?u:e.poolIndex()-r.poolIndex()},mx={forEach:function(e,r){if(Kn(e))for(var n=this.length,i=0;i<n;i++){var a=this[i],s=r?e.apply(r,[a,i,this]):e(a,i,this);if(s===!1)break}return this},toArray:function(){for(var e=[],r=0;r<this.length;r++)e.push(this[r]);return e},slice:function(e,r){var n=[],i=this.length;r==null&&(r=i),e==null&&(e=0),e<0&&(e=i+e),r<0&&(r=i+r);for(var a=e;a>=0&&a<r&&a<i;a++)n.push(this[a]);return this.spawn(n)},size:function(){return this.length},eq:function(e){return this[e]||this.spawn()},first:function(){return this[0]||this.spawn()},last:function(){return this[this.length-1]||this.spawn()},empty:function(){return this.length===0},nonempty:function(){return!this.empty()},sort:function(e){if(!Kn(e))return this;var r=this.toArray().sort(e);return this.spawn(r)},sortByZIndex:function(){return this.sort(KA)},zDepth:function(){var e=this[0];if(e){var r=e._private,n=r.group;if(n==="nodes"){var i=r.data.parent?e.parents().size():0;return e.isParent()?i:u_-1}else{var a=r.source,s=r.target,o=a.zDepth(),l=s.zDepth();return Math.max(o,l,0)}}}};mx.each=mx.forEach;var pz=function(){var e="undefined",r=(typeof Symbol>"u"?"undefined":Hi(Symbol))!=e&&Hi(Symbol.iterator)!=e;r&&(mx[Symbol.iterator]=function(){var n=this,i={value:void 0,done:!1},a=0,s=this.length;return qM({next:function(){return a<s?i.value=n[a++]:(i.value=void 0,i.done=!0),i}},Symbol.iterator,function(){return this})})};pz();var mz=Ua({nodeDimensionsIncludeLabels:!1}),Vy={layoutDimensions:function(e){e=mz(e);var r;if(!this.takesUpSpace())r={w:0,h:0};else if(e.nodeDimensionsIncludeLabels){var n=this.boundingBox();r={w:n.w,h:n.h}}else r={w:this.outerWidth(),h:this.outerHeight()};return(r.w===0||r.h===0)&&(r.w=r.h=1),r},layoutPositions:function(e,r,n){var i=this.nodes().filter(function(A){return!A.isParent()}),a=this.cy(),s=r.eles,o=function(O){return O.id()},l=Kp(n,o);e.emit({type:"layoutstart",layout:e}),e.animations=[];var u=function(O,j,D){var F={x:j.x1+j.w/2,y:j.y1+j.h/2},B={x:(D.x-F.x)*O,y:(D.y-F.y)*O};return{x:F.x+B.x,y:F.y+B.y}},c=r.spacingFactor&&r.spacingFactor!==1,f=function(){if(!c)return null;for(var O=_s(),j=0;j<i.length;j++){var D=i[j],F=l(D,j);fA(O,F.x,F.y)}return O},p=f(),v=Kp(function(A,O){var j=l(A,O);if(c){var D=Math.abs(r.spacingFactor);j=u(D,p,j)}return r.transform!=null&&(j=r.transform(A,j)),j},o);if(r.animate){for(var y=0;y<i.length;y++){var S=i[y],w=v(S,y),T=r.animateFilter==null||r.animateFilter(S,y);if(T){var _=S.animation({position:w,duration:r.animationDuration,easing:r.animationEasing});e.animations.push(_)}else S.position(w)}if(r.fit){var C=a.animation({fit:{boundingBox:s.boundingBoxAt(v),padding:r.padding},duration:r.animationDuration,easing:r.animationEasing});e.animations.push(C)}else if(r.zoom!==void 0&&r.pan!==void 0){var N=a.animation({zoom:r.zoom,pan:r.pan,duration:r.animationDuration,easing:r.animationEasing});e.animations.push(N)}e.animations.forEach(function(A){return A.play()}),e.one("layoutready",r.ready),e.emit({type:"layoutready",layout:e}),hm.all(e.animations.map(function(A){return A.promise()})).then(function(){e.one("layoutstop",r.stop),e.emit({type:"layoutstop",layout:e})})}else i.positions(v),r.fit&&a.fit(r.eles,r.padding),r.zoom!=null&&a.zoom(r.zoom),r.pan&&a.pan(r.pan),e.one("layoutready",r.ready),e.emit({type:"layoutready",layout:e}),e.one("layoutstop",r.stop),e.emit({type:"layoutstop",layout:e});return this},layout:function(e){var r=this.cy();return r.makeLayout(Jt({},e,{eles:this}))}};Vy.createLayout=Vy.makeLayout=Vy.layout;function ZA(t,e,r){var n=r._private,i=n.styleCache=n.styleCache||[],a;return(a=i[t])!=null||(a=i[t]=e(r)),a}function O1(t,e){return t=vh(t),function(n){return ZA(t,e,n)}}function D1(t,e){t=vh(t);var r=function(i){return e.call(i)};return function(){var i=this[0];if(i)return ZA(t,r,i)}}var ja={recalculateRenderedStyle:function(e){var r=this.cy(),n=r.renderer(),i=r.styleEnabled();return n&&i&&n.recalculateRenderedStyle(this,e),this},dirtyStyleCache:function(){var e=this.cy(),r=function(a){return a._private.styleCache=null};if(e.hasCompoundNodes()){var n;n=this.spawnSelf().merge(this.descendants()).merge(this.parents()),n.merge(n.connectedEdges()),n.forEach(r)}else this.forEach(function(i){r(i),i.connectedEdges().forEach(r)});return this},updateStyle:function(e){var r=this._private.cy;if(!r.styleEnabled())return this;if(r.batching()){var n=r._private.batchStyleEles;return n.merge(this),this}var i=r.hasCompoundNodes(),a=this;e=!!(e||e===void 0),i&&(a=this.spawnSelf().merge(this.descendants()).merge(this.parents()));var s=a;return e?s.emitAndNotify("style"):s.emit("style"),a.forEach(function(o){return o._private.styleDirty=!0}),this},cleanStyle:function(){var e=this.cy();if(e.styleEnabled())for(var r=0;r<this.length;r++){var n=this[r];n._private.styleDirty&&(n._private.styleDirty=!1,e.style().apply(n))}},parsedStyle:function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,n=this[0],i=n.cy();if(i.styleEnabled()&&n){n._private.styleDirty&&(n._private.styleDirty=!1,i.style().apply(n));var a=n._private.style[e];return a??(r?i.style().getDefaultProperty(e):null)}},numericStyle:function(e){var r=this[0];if(r.cy().styleEnabled()&&r){var n=r.pstyle(e);return n.pfValue!==void 0?n.pfValue:n.value}},numericStyleUnits:function(e){var r=this[0];if(r.cy().styleEnabled()&&r)return r.pstyle(e).units},renderedStyle:function(e){var r=this.cy();if(!r.styleEnabled())return this;var n=this[0];if(n)return r.style().getRenderedStyle(n,e)},style:function(e,r){var n=this.cy();if(!n.styleEnabled())return this;var i=!1,a=n.style();if(Ir(e)){var s=e;a.applyBypass(this,s,i),this.emitAndNotify("style")}else if(Wt(e))if(r===void 0){var o=this[0];return o?a.getStylePropertyValue(o,e):void 0}else a.applyBypass(this,e,r,i),this.emitAndNotify("style");else if(e===void 0){var l=this[0];return l?a.getRawStyle(l):void 0}return this},removeStyle:function(e){var r=this.cy();if(!r.styleEnabled())return this;var n=!1,i=r.style(),a=this;if(e===void 0)for(var s=0;s<a.length;s++){var o=a[s];i.removeAllBypasses(o,n)}else{e=e.split(/\s+/);for(var l=0;l<a.length;l++){var u=a[l];i.removeBypasses(u,e,n)}}return this.emitAndNotify("style"),this},show:function(){return this.css("display","element"),this},hide:function(){return this.css("display","none"),this},effectiveOpacity:function(){var e=this.cy();if(!e.styleEnabled())return 1;var r=e.hasCompoundNodes(),n=this[0];if(n){var i=n._private,a=n.pstyle("opacity").value;if(!r)return a;var s=i.data.parent?n.parents():null;if(s)for(var o=0;o<s.length;o++){var l=s[o],u=l.pstyle("opacity").value;a=u*a}return a}},transparent:function(){var e=this.cy();if(!e.styleEnabled())return!1;var r=this[0],n=r.cy().hasCompoundNodes();if(r)return n?r.effectiveOpacity()===0:r.pstyle("opacity").value===0},backgrounding:function(){var e=this.cy();if(!e.styleEnabled())return!1;var r=this[0];return!!r._private.backgrounding}};function h2(t,e){var r=t._private,n=r.data.parent?t.parents():null;if(n)for(var i=0;i<n.length;i++){var a=n[i];if(!e(a))return!1}return!0}function w_(t){var e=t.ok,r=t.edgeOkViaNode||t.ok,n=t.parentOk||t.ok;return function(){var i=this.cy();if(!i.styleEnabled())return!0;var a=this[0],s=i.hasCompoundNodes();if(a){var o=a._private;if(!e(a))return!1;if(a.isNode())return!s||h2(a,n);var l=o.source,u=o.target;return r(l)&&(!s||h2(l,r))&&(l===u||r(u)&&(!s||h2(u,r)))}}}var pm=O1("eleTakesUpSpace",function(t){return t.pstyle("display").value==="element"&&t.width()!==0&&(t.isNode()?t.height()!==0:!0)});ja.takesUpSpace=D1("takesUpSpace",w_({ok:pm}));var gz=O1("eleInteractive",function(t){return t.pstyle("events").value==="yes"&&t.pstyle("visibility").value==="visible"&&pm(t)}),vz=O1("parentInteractive",function(t){return t.pstyle("visibility").value==="visible"&&pm(t)});ja.interactive=D1("interactive",w_({ok:gz,parentOk:vz,edgeOkViaNode:pm}));ja.noninteractive=function(){var t=this[0];if(t)return!t.interactive()};var yz=O1("eleVisible",function(t){return t.pstyle("visibility").value==="visible"&&t.pstyle("opacity").pfValue!==0&&pm(t)}),xz=pm;ja.visible=D1("visible",w_({ok:yz,edgeOkViaNode:xz}));ja.hidden=function(){var t=this[0];if(t)return!t.visible()};ja.isBundledBezier=D1("isBundledBezier",function(){return this.cy().styleEnabled()?!this.removed()&&this.pstyle("curve-style").value==="bezier"&&this.takesUpSpace():!1});ja.bypass=ja.css=ja.style;ja.renderedCss=ja.renderedStyle;ja.removeBypass=ja.removeCss=ja.removeStyle;ja.pstyle=ja.parsedStyle;var Hd={};function RN(t){return function(){var e=arguments,r=[];if(e.length===2){var n=e[0],i=e[1];this.on(t.event,n,i)}else if(e.length===1&&Kn(e[0])){var a=e[0];this.on(t.event,a)}else if(e.length===0||e.length===1&&pn(e[0])){for(var s=e.length===1?e[0]:null,o=0;o<this.length;o++){var l=this[o],u=!t.ableField||l._private[t.ableField],c=l._private[t.field]!=t.value;if(t.overrideAble){var f=t.overrideAble(l);if(f!==void 0&&(u=f,!f))return this}u&&(l._private[t.field]=t.value,c&&r.push(l))}var p=this.spawn(r);p.updateStyle(),p.emit(t.event),s&&p.emit(s)}return this}}function mm(t){Hd[t.field]=function(){var e=this[0];if(e){if(t.overrideField){var r=t.overrideField(e);if(r!==void 0)return r}return e._private[t.field]}},Hd[t.on]=RN({event:t.on,field:t.field,ableField:t.ableField,overrideAble:t.overrideAble,value:!0}),Hd[t.off]=RN({event:t.off,field:t.field,ableField:t.ableField,overrideAble:t.overrideAble,value:!1})}mm({field:"locked",overrideField:function(e){return e.cy().autolock()?!0:void 0},on:"lock",off:"unlock"});mm({field:"grabbable",overrideField:function(e){return e.cy().autoungrabify()||e.pannable()?!1:void 0},on:"grabify",off:"ungrabify"});mm({field:"selected",ableField:"selectable",overrideAble:function(e){return e.cy().autounselectify()?!1:void 0},on:"select",off:"unselect"});mm({field:"selectable",overrideField:function(e){return e.cy().autounselectify()?!1:void 0},on:"selectify",off:"unselectify"});Hd.deselect=Hd.unselect;Hd.grabbed=function(){var t=this[0];if(t)return t._private.grabbed};mm({field:"active",on:"activate",off:"unactivate"});mm({field:"pannable",on:"panify",off:"unpanify"});Hd.inactive=function(){var t=this[0];if(t)return!t._private.active};var is={},ON=function(e){return function(n){for(var i=this,a=[],s=0;s<i.length;s++){var o=i[s];if(o.isNode()){for(var l=!1,u=o.connectedEdges(),c=0;c<u.length;c++){var f=u[c],p=f.source(),v=f.target();if(e.noIncomingEdges&&v===o&&p!==o||e.noOutgoingEdges&&p===o&&v!==o){l=!0;break}}l||a.push(o)}}return this.spawn(a,!0).filter(n)}},DN=function(e){return function(r){for(var n=this,i=[],a=0;a<n.length;a++){var s=n[a];if(s.isNode())for(var o=s.connectedEdges(),l=0;l<o.length;l++){var u=o[l],c=u.source(),f=u.target();e.outgoing&&c===s?(i.push(u),i.push(f)):e.incoming&&f===s&&(i.push(u),i.push(c))}}return this.spawn(i,!0).filter(r)}},IN=function(e){return function(r){for(var n=this,i=[],a={};;){var s=e.outgoing?n.outgoers():n.incomers();if(s.length===0)break;for(var o=!1,l=0;l<s.length;l++){var u=s[l],c=u.id();a[c]||(a[c]=!0,i.push(u),o=!0)}if(!o)break;n=s}return this.spawn(i,!0).filter(r)}};is.clearTraversalCache=function(){for(var t=0;t<this.length;t++)this[t]._private.traversalCache=null};Jt(is,{roots:ON({noIncomingEdges:!0}),leaves:ON({noOutgoingEdges:!0}),outgoers:Go(DN({outgoing:!0}),"outgoers"),successors:IN({outgoing:!0}),incomers:Go(DN({incoming:!0}),"incomers"),predecessors:IN({})});Jt(is,{neighborhood:Go(function(t){for(var e=[],r=this.nodes(),n=0;n<r.length;n++)for(var i=r[n],a=i.connectedEdges(),s=0;s<a.length;s++){var o=a[s],l=o.source(),u=o.target(),c=i===l?u:l;c.length>0&&e.push(c[0]),e.push(o[0])}return this.spawn(e,!0).filter(t)},"neighborhood"),closedNeighborhood:function(e){return this.neighborhood().add(this).filter(e)},openNeighborhood:function(e){return this.neighborhood(e)}});is.neighbourhood=is.neighborhood;is.closedNeighbourhood=is.closedNeighborhood;is.openNeighbourhood=is.openNeighborhood;Jt(is,{source:Go(function(e){var r=this[0],n;return r&&(n=r._private.source||r.cy().collection()),n&&e?n.filter(e):n},"source"),target:Go(function(e){var r=this[0],n;return r&&(n=r._private.target||r.cy().collection()),n&&e?n.filter(e):n},"target"),sources:jN({attr:"source"}),targets:jN({attr:"target"})});function jN(t){return function(r){for(var n=[],i=0;i<this.length;i++){var a=this[i],s=a._private[t.attr];s&&n.push(s)}return this.spawn(n,!0).filter(r)}}Jt(is,{edgesWith:Go(FN(),"edgesWith"),edgesTo:Go(FN({thisIsSrc:!0}),"edgesTo")});function FN(t){return function(r){var n=[],i=this._private.cy,a=t||{};Wt(r)&&(r=i.$(r));for(var s=0;s<r.length;s++)for(var o=r[s]._private.edges,l=0;l<o.length;l++){var u=o[l],c=u._private.data,f=this.hasElementWithId(c.source)&&r.hasElementWithId(c.target),p=r.hasElementWithId(c.source)&&this.hasElementWithId(c.target),v=f||p;v&&((a.thisIsSrc||a.thisIsTgt)&&(a.thisIsSrc&&!f||a.thisIsTgt&&!p)||n.push(u))}return this.spawn(n,!0)}}Jt(is,{connectedEdges:Go(function(t){for(var e=[],r=this,n=0;n<r.length;n++){var i=r[n];if(i.isNode())for(var a=i._private.edges,s=0;s<a.length;s++){var o=a[s];e.push(o)}}return this.spawn(e,!0).filter(t)},"connectedEdges"),connectedNodes:Go(function(t){for(var e=[],r=this,n=0;n<r.length;n++){var i=r[n];i.isEdge()&&(e.push(i.source()[0]),e.push(i.target()[0]))}return this.spawn(e,!0).filter(t)},"connectedNodes"),parallelEdges:Go(BN(),"parallelEdges"),codirectedEdges:Go(BN({codirected:!0}),"codirectedEdges")});function BN(t){var e={codirected:!1};return t=Jt({},e,t),function(n){for(var i=[],a=this.edges(),s=t,o=0;o<a.length;o++)for(var l=a[o],u=l._private,c=u.source,f=c._private.data.id,p=u.data.target,v=c._private.edges,y=0;y<v.length;y++){var S=v[y],w=S._private.data,T=w.target,_=w.source,C=T===p&&_===f,N=f===T&&p===_;(s.codirected&&C||!s.codirected&&(C||N))&&i.push(S)}return this.spawn(i,!0).filter(n)}}Jt(is,{components:function(e){var r=this,n=r.cy(),i=n.collection(),a=e==null?r.nodes():e.nodes(),s=[];e!=null&&a.empty()&&(a=e.sources());var o=function(c,f){i.merge(c),a.unmerge(c),f.merge(c)};if(a.empty())return r.spawn();var l=function(){var c=n.collection();s.push(c);var f=a[0];o(f,c),r.bfs({directed:!1,roots:f,visit:function(v){return o(v,c)}}),c.forEach(function(p){p.connectedEdges().forEach(function(v){r.has(v)&&c.has(v.source())&&c.has(v.target())&&c.merge(v)})})};do l();while(a.length>0);return s},component:function(){var e=this[0];return e.cy().mutableElements().components(e)[0]}});is.componentsOf=is.components;var Fa=function(e,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(e===void 0){Gn("A collection must have a reference to the core");return}var a=new fc,s=!1;if(!r)r=[];else if(r.length>0&&Ir(r[0])&&!Jv(r[0])){s=!0;for(var o=[],l=new fm,u=0,c=r.length;u<c;u++){var f=r[u];f.data==null&&(f.data={});var p=f.data;if(p.id==null)p.id=uA();else if(e.hasElementWithId(p.id)||l.has(p.id))continue;var v=new C1(e,f,!1);o.push(v),l.add(p.id)}r=o}this.length=0;for(var y=0,S=r.length;y<S;y++){var w=r[y][0];if(w!=null){var T=w._private.data.id;(!n||!a.has(T))&&(n&&a.set(T,{index:this.length,ele:w}),this[this.length]=w,this.length++)}}this._private={eles:this,cy:e,get map(){return this.lazyMap==null&&this.rebuildMap(),this.lazyMap},set map(_){this.lazyMap=_},rebuildMap:function(){for(var C=this.lazyMap=new fc,N=this.eles,A=0;A<N.length;A++){var O=N[A];C.set(O.id(),{index:A,ele:O})}}},n&&(this._private.map=a),s&&!i&&this.restore()},kn=C1.prototype=Fa.prototype=Object.create(Array.prototype);kn.instanceString=function(){return"collection"};kn.spawn=function(t,e){return new Fa(this.cy(),t,e)};kn.spawnSelf=function(){return this.spawn(this)};kn.cy=function(){return this._private.cy};kn.renderer=function(){return this._private.cy.renderer()};kn.element=function(){return this[0]};kn.collection=function(){return ZM(this)?this:new Fa(this._private.cy,[this])};kn.unique=function(){return new Fa(this._private.cy,this,!0)};kn.hasElementWithId=function(t){return t=""+t,this._private.map.has(t)};kn.getElementById=function(t){t=""+t;var e=this._private.cy,r=this._private.map.get(t);return r?r.ele:new Fa(e)};kn.$id=kn.getElementById;kn.poolIndex=function(){var t=this._private.cy,e=t._private.elements,r=this[0]._private.data.id;return e._private.map.get(r).index};kn.indexOf=function(t){var e=t[0]._private.data.id;return this._private.map.get(e).index};kn.indexOfId=function(t){return t=""+t,this._private.map.get(t).index};kn.json=function(t){var e=this.element(),r=this.cy();if(e==null&&t)return this;if(e!=null){var n=e._private;if(Ir(t)){if(r.startBatch(),t.data){e.data(t.data);var i=n.data;if(e.isEdge()){var a=!1,s={},o=t.data.source,l=t.data.target;o!=null&&o!=i.source&&(s.source=""+o,a=!0),l!=null&&l!=i.target&&(s.target=""+l,a=!0),a&&(e=e.move(s))}else{var u="parent"in t.data,c=t.data.parent;u&&(c!=null||i.parent!=null)&&c!=i.parent&&(c===void 0&&(c=null),c!=null&&(c=""+c),e=e.move({parent:c}))}}t.position&&e.position(t.position);var f=function(S,w,T){var _=t[S];_!=null&&_!==n[S]&&(_?e[w]():e[T]())};return f("removed","remove","restore"),f("selected","select","unselect"),f("selectable","selectify","unselectify"),f("locked","lock","unlock"),f("grabbable","grabify","ungrabify"),f("pannable","panify","unpanify"),t.classes!=null&&e.classes(t.classes),r.endBatch(),this}else if(t===void 0){var p={data:bu(n.data),position:bu(n.position),group:n.group,removed:n.removed,selected:n.selected,selectable:n.selectable,locked:n.locked,grabbable:n.grabbable,pannable:n.pannable,classes:null};p.classes="";var v=0;return n.classes.forEach(function(y){return p.classes+=v++===0?y:" "+y}),p}}};kn.jsons=function(){for(var t=[],e=0;e<this.length;e++){var r=this[e],n=r.json();t.push(n)}return t};kn.clone=function(){for(var t=this.cy(),e=[],r=0;r<this.length;r++){var n=this[r],i=n.json(),a=new C1(t,i,!1);e.push(a)}return new Fa(t,e)};kn.copy=kn.clone;kn.restore=function(){for(var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=this,n=r.cy(),i=n._private,a=[],s=[],o,l=0,u=r.length;l<u;l++){var c=r[l];e&&!c.removed()||(c.isNode()?a.push(c):s.push(c))}o=a.concat(s);var f,p=function(){o.splice(f,1),f--};for(f=0;f<o.length;f++){var v=o[f],y=v._private,S=y.data;if(v.clearTraversalCache(),!(!e&&!y.removed)){if(S.id===void 0)S.id=uA();else if(gt(S.id))S.id=""+S.id;else if(Xd(S.id)||!Wt(S.id)){Gn("Can not create element with invalid string ID `"+S.id+"`"),p();continue}else if(n.hasElementWithId(S.id)){Gn("Can not create second element with ID `"+S.id+"`"),p();continue}}var w=S.id;if(v.isNode()){var T=y.position;T.x==null&&(T.x=0),T.y==null&&(T.y=0)}if(v.isEdge()){for(var _=v,C=["source","target"],N=C.length,A=!1,O=0;O<N;O++){var j=C[O],D=S[j];gt(D)&&(D=S[j]=""+S[j]),D==null||D===""?(Gn("Can not create edge `"+w+"` with unspecified "+j),A=!0):n.hasElementWithId(D)||(Gn("Can not create edge `"+w+"` with nonexistant "+j+" `"+D+"`"),A=!0)}if(A){p();continue}var F=n.getElementById(S.source),B=n.getElementById(S.target);F.same(B)?F._private.edges.push(_):(F._private.edges.push(_),B._private.edges.push(_)),_._private.source=F,_._private.target=B}y.map=new fc,y.map.set(w,{ele:v,index:0}),y.removed=!1,e&&n.addToPool(v)}for(var $=0;$<a.length;$++){var Z=a[$],I=Z._private.data;gt(I.parent)&&(I.parent=""+I.parent);var q=I.parent,U=q!=null;if(U||Z._private.parent){var W=Z._private.parent?n.collection().merge(Z._private.parent):n.getElementById(q);if(W.empty())I.parent=void 0;else if(W[0].removed())Yr("Node added with missing parent, reference to parent removed"),I.parent=void 0,Z._private.parent=null;else{for(var Y=!1,Q=W;!Q.empty();){if(Z.same(Q)){Y=!0,I.parent=void 0;break}Q=Q.parent()}Y||(W[0]._private.children.push(Z),Z._private.parent=W[0],i.hasCompoundNodes=!0)}}}if(o.length>0){for(var ne=o.length===r.length?r:new Fa(n,o),re=0;re<ne.length;re++){var H=ne[re];H.isNode()||(H.parallelEdges().clearTraversalCache(),H.source().clearTraversalCache(),H.target().clearTraversalCache())}var te;i.hasCompoundNodes?te=n.collection().merge(ne).merge(ne.connectedNodes()).merge(ne.parent()):te=ne,te.dirtyCompoundBoundsCache().dirtyBoundingBoxCache().updateStyle(t),t?ne.emitAndNotify("add"):e&&ne.emit("add")}return r};kn.removed=function(){var t=this[0];return t&&t._private.removed};kn.inside=function(){var t=this[0];return t&&!t._private.removed};kn.remove=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=this,n=[],i={},a=r._private.cy;function s(q){for(var U=q._private.edges,W=0;W<U.length;W++)l(U[W])}function o(q){for(var U=q._private.children,W=0;W<U.length;W++)l(U[W])}function l(q){var U=i[q.id()];e&&q.removed()||U||(i[q.id()]=!0,q.isNode()?(n.push(q),s(q),o(q)):n.unshift(q))}for(var u=0,c=r.length;u<c;u++){var f=r[u];l(f)}function p(q,U){var W=q._private.edges;Qd(W,U),q.clearTraversalCache()}function v(q){q.clearTraversalCache()}var y=[];y.ids={};function S(q,U){U=U[0],q=q[0];var W=q._private.children,Y=q.id();Qd(W,U),U._private.parent=null,y.ids[Y]||(y.ids[Y]=!0,y.push(q))}r.dirtyCompoundBoundsCache(),e&&a.removeFromPool(n);for(var w=0;w<n.length;w++){var T=n[w];if(T.isEdge()){var _=T.source()[0],C=T.target()[0];p(_,T),p(C,T);for(var N=T.parallelEdges(),A=0;A<N.length;A++){var O=N[A];v(O),O.isBundledBezier()&&O.dirtyBoundingBoxCache()}}else{var j=T.parent();j.length!==0&&S(j,T)}e&&(T._private.removed=!0)}var D=a._private.elements;a._private.hasCompoundNodes=!1;for(var F=0;F<D.length;F++){var B=D[F];if(B.isParent()){a._private.hasCompoundNodes=!0;break}}var $=new Fa(this.cy(),n);$.size()>0&&(t?$.emitAndNotify("remove"):e&&$.emit("remove"));for(var Z=0;Z<y.length;Z++){var I=y[Z];(!e||!I.removed())&&I.updateStyle()}return $};kn.move=function(t){var e=this._private.cy,r=this,n=!1,i=!1,a=function(y){return y==null?y:""+y};if(t.source!==void 0||t.target!==void 0){var s=a(t.source),o=a(t.target),l=s!=null&&e.hasElementWithId(s),u=o!=null&&e.hasElementWithId(o);(l||u)&&(e.batch(function(){r.remove(n,i),r.emitAndNotify("moveout");for(var v=0;v<r.length;v++){var y=r[v],S=y._private.data;y.isEdge()&&(l&&(S.source=s),u&&(S.target=o))}r.restore(n,i)}),r.emitAndNotify("move"))}else if(t.parent!==void 0){var c=a(t.parent),f=c===null||e.hasElementWithId(c);if(f){var p=c===null?void 0:c;e.batch(function(){var v=r.remove(n,i);v.emitAndNotify("moveout");for(var y=0;y<r.length;y++){var S=r[y],w=S._private.data;S.isNode()&&(w.parent=p)}v.restore(n,i)}),r.emitAndNotify("move")}}return this};[wA,M7,Gy,Vd,Yp,q7,L1,lz,qA,$A,hz,mx,Vy,ja,Hd,is].forEach(function(t){Jt(kn,t)});var bz={add:function(e){var r,n=this;if(uo(e)){var i=e;if(i._private.cy===n)r=i.restore();else{for(var a=[],s=0;s<i.length;s++){var o=i[s];a.push(o.json())}r=new Fa(n,a)}}else if(pn(e)){var l=e;r=new Fa(n,l)}else if(Ir(e)&&(pn(e.nodes)||pn(e.edges))){for(var u=e,c=[],f=["nodes","edges"],p=0,v=f.length;p<v;p++){var y=f[p],S=u[y];if(pn(S))for(var w=0,T=S.length;w<T;w++){var _=Jt({group:y},S[w]);c.push(_)}}r=new Fa(n,c)}else{var C=e;r=new C1(n,C).collection()}return r},remove:function(e){if(!uo(e)){if(Wt(e)){var r=e;e=this.$(r)}}return e.remove()}};function wz(t,e,r,n){var i=4,a=.001,s=1e-7,o=10,l=11,u=1/(l-1),c=typeof Float32Array<"u";if(arguments.length!==4)return!1;for(var f=0;f<4;++f)if(typeof arguments[f]!="number"||isNaN(arguments[f])||!isFinite(arguments[f]))return!1;t=Math.min(t,1),r=Math.min(r,1),t=Math.max(t,0),r=Math.max(r,0);var p=c?new Float32Array(l):new Array(l);function v(B,$){return 1-3*$+3*B}function y(B,$){return 3*$-6*B}function S(B){return 3*B}function w(B,$,Z){return((v($,Z)*B+y($,Z))*B+S($))*B}function T(B,$,Z){return 3*v($,Z)*B*B+2*y($,Z)*B+S($)}function _(B,$){for(var Z=0;Z<i;++Z){var I=T($,t,r);if(I===0)return $;var q=w($,t,r)-B;$-=q/I}return $}function C(){for(var B=0;B<l;++B)p[B]=w(B*u,t,r)}function N(B,$,Z){var I,q,U=0;do q=$+(Z-$)/2,I=w(q,t,r)-B,I>0?Z=q:$=q;while(Math.abs(I)>s&&++U<o);return q}function A(B){for(var $=0,Z=1,I=l-1;Z!==I&&p[Z]<=B;++Z)$+=u;--Z;var q=(B-p[Z])/(p[Z+1]-p[Z]),U=$+q*u,W=T(U,t,r);return W>=a?_(B,U):W===0?U:N(B,$,$+u)}var O=!1;function j(){O=!0,(t!==e||r!==n)&&C()}var D=function($){return O||j(),t===e&&r===n?$:$===0?0:$===1?1:w(A($),e,n)};D.getControlPoints=function(){return[{x:t,y:e},{x:r,y:n}]};var F="generateBezier("+[t,e,r,n]+")";return D.toString=function(){return F},D}var Sz=(function(){function t(n){return-n.tension*n.x-n.friction*n.v}function e(n,i,a){var s={x:n.x+a.dx*i,v:n.v+a.dv*i,tension:n.tension,friction:n.friction};return{dx:s.v,dv:t(s)}}function r(n,i){var a={dx:n.v,dv:t(n)},s=e(n,i*.5,a),o=e(n,i*.5,s),l=e(n,i,o),u=1/6*(a.dx+2*(s.dx+o.dx)+l.dx),c=1/6*(a.dv+2*(s.dv+o.dv)+l.dv);return n.x=n.x+u*i,n.v=n.v+c*i,n}return function n(i,a,s){var o={x:-1,v:0,tension:null,friction:null},l=[0],u=0,c=1/1e4,f=16/1e3,p,v,y;for(i=parseFloat(i)||500,a=parseFloat(a)||20,s=s||null,o.tension=i,o.friction=a,p=s!==null,p?(u=n(i,a),v=u/s*f):v=f;y=r(y||o,v),l.push(1+y.x),u+=16,Math.abs(y.x)>c&&Math.abs(y.v)>c;);return p?function(S){return l[S*(l.length-1)|0]}:u}})(),Sn=function(e,r,n,i){var a=wz(e,r,n,i);return function(s,o,l){return s+(o-s)*a(l)}},Hy={linear:function(e,r,n){return e+(r-e)*n},ease:Sn(.25,.1,.25,1),"ease-in":Sn(.42,0,1,1),"ease-out":Sn(0,0,.58,1),"ease-in-out":Sn(.42,0,.58,1),"ease-in-sine":Sn(.47,0,.745,.715),"ease-out-sine":Sn(.39,.575,.565,1),"ease-in-out-sine":Sn(.445,.05,.55,.95),"ease-in-quad":Sn(.55,.085,.68,.53),"ease-out-quad":Sn(.25,.46,.45,.94),"ease-in-out-quad":Sn(.455,.03,.515,.955),"ease-in-cubic":Sn(.55,.055,.675,.19),"ease-out-cubic":Sn(.215,.61,.355,1),"ease-in-out-cubic":Sn(.645,.045,.355,1),"ease-in-quart":Sn(.895,.03,.685,.22),"ease-out-quart":Sn(.165,.84,.44,1),"ease-in-out-quart":Sn(.77,0,.175,1),"ease-in-quint":Sn(.755,.05,.855,.06),"ease-out-quint":Sn(.23,1,.32,1),"ease-in-out-quint":Sn(.86,0,.07,1),"ease-in-expo":Sn(.95,.05,.795,.035),"ease-out-expo":Sn(.19,1,.22,1),"ease-in-out-expo":Sn(1,0,0,1),"ease-in-circ":Sn(.6,.04,.98,.335),"ease-out-circ":Sn(.075,.82,.165,1),"ease-in-out-circ":Sn(.785,.135,.15,.86),spring:function(e,r,n){if(n===0)return Hy.linear;var i=Sz(e,r,n);return function(a,s,o){return a+(s-a)*i(o)}},"cubic-bezier":Sn};function zN(t,e,r,n,i){if(n===1||e===r)return r;var a=i(e,r,n);return t==null||((t.roundValue||t.color)&&(a=Math.round(a)),t.min!==void 0&&(a=Math.max(a,t.min)),t.max!==void 0&&(a=Math.min(a,t.max))),a}function UN(t,e){return t.pfValue!=null||t.value!=null?t.pfValue!=null&&(e==null||e.type.units!=="%")?t.pfValue:t.value:t}function vp(t,e,r,n,i){var a=i!=null?i.type:null;r<0?r=0:r>1&&(r=1);var s=UN(t,i),o=UN(e,i);if(gt(s)&&gt(o))return zN(a,s,o,r,n);if(pn(s)&&pn(o)){for(var l=[],u=0;u<o.length;u++){var c=s[u],f=o[u];if(c!=null&&f!=null){var p=zN(a,c,f,r,n);l.push(p)}else l.push(f)}return l}}function kz(t,e,r,n){var i=!n,a=t._private,s=e._private,o=s.easing,l=s.startTime,u=n?t:t.cy(),c=u.style();if(!s.easingImpl)if(o==null)s.easingImpl=Hy.linear;else{var f;if(Wt(o)){var p=c.parse("transition-timing-function",o);f=p.value}else f=o;var v,y;Wt(f)?(v=f,y=[]):(v=f[1],y=f.slice(2).map(function(ne){return+ne})),y.length>0?(v==="spring"&&y.push(s.duration),s.easingImpl=Hy[v].apply(null,y)):s.easingImpl=Hy[v]}var S=s.easingImpl,w;if(s.duration===0?w=1:w=(r-l)/s.duration,s.applying&&(w=s.progress),w<0?w=0:w>1&&(w=1),s.delay==null){var T=s.startPosition,_=s.position;if(_&&i&&!t.locked()){var C={};Km(T.x,_.x)&&(C.x=vp(T.x,_.x,w,S)),Km(T.y,_.y)&&(C.y=vp(T.y,_.y,w,S)),t.position(C)}var N=s.startPan,A=s.pan,O=a.pan,j=A!=null&&n;j&&(Km(N.x,A.x)&&(O.x=vp(N.x,A.x,w,S)),Km(N.y,A.y)&&(O.y=vp(N.y,A.y,w,S)),t.emit("pan"));var D=s.startZoom,F=s.zoom,B=F!=null&&n;B&&(Km(D,F)&&(a.zoom=Cv(a.minZoom,vp(D,F,w,S),a.maxZoom)),t.emit("zoom")),(j||B)&&t.emit("viewport");var $=s.style;if($&&$.length>0&&i){for(var Z=0;Z<$.length;Z++){var I=$[Z],q=I.name,U=I,W=s.startStyle[q],Y=c.properties[W.name],Q=vp(W,U,w,S,Y);c.overrideBypass(t,q,Q)}t.emit("style")}}return s.progress=w,w}function Km(t,e){return t==null||e==null?!1:gt(t)&&gt(e)?!0:!!(t&&e)}function _z(t,e,r,n){var i=e._private;i.started=!0,i.startTime=r-i.progress*i.duration}function GN(t,e){var r=e._private.aniEles,n=[];function i(c,f){var p=c._private,v=p.animation.current,y=p.animation.queue,S=!1;if(v.length===0){var w=y.shift();w&&v.push(w)}for(var T=function(O){for(var j=O.length-1;j>=0;j--){var D=O[j];D()}O.splice(0,O.length)},_=v.length-1;_>=0;_--){var C=v[_],N=C._private;if(N.stopped){v.splice(_,1),N.hooked=!1,N.playing=!1,N.started=!1,T(N.frames);continue}!N.playing&&!N.applying||(N.playing&&N.applying&&(N.applying=!1),N.started||_z(c,C,t),kz(c,C,t,f),N.applying&&(N.applying=!1),T(N.frames),N.step!=null&&N.step(t),C.completed()&&(v.splice(_,1),N.hooked=!1,N.playing=!1,N.started=!1,T(N.completes)),S=!0)}return!f&&v.length===0&&y.length===0&&n.push(c),S}for(var a=!1,s=0;s<r.length;s++){var o=r[s],l=i(o);a=a||l}var u=i(e,!0);(a||u)&&(r.length>0?e.notify("draw",r):e.notify("draw")),r.unmerge(n),e.emit("step")}var Cz={animate:Zr.animate(),animation:Zr.animation(),animated:Zr.animated(),clearQueue:Zr.clearQueue(),delay:Zr.delay(),delayAnimation:Zr.delayAnimation(),stop:Zr.stop(),addToAnimationPool:function(e){var r=this;r.styleEnabled()&&r._private.aniEles.merge(e)},stopAnimationLoop:function(){this._private.animationsRunning=!1},startAnimationLoop:function(){var e=this;if(e._private.animationsRunning=!0,!e.styleEnabled())return;function r(){e._private.animationsRunning&&cx(function(a){GN(a,e),r()})}var n=e.renderer();n&&n.beforeRender?n.beforeRender(function(a,s){GN(s,e)},n.beforeRenderPriorities.animations):r()}},Ez={qualifierCompare:function(e,r){return e==null||r==null?e==null&&r==null:e.sameText(r)},eventMatches:function(e,r,n){var i=r.qualifier;return i!=null?e!==n.target&&Jv(n.target)&&i.matches(n.target):!0},addEventFields:function(e,r){r.cy=e,r.target=e},callbackContext:function(e,r,n){return r.qualifier!=null?n.target:e}},uy=function(e){return Wt(e)?new ef(e):e},YA={createEmitter:function(){var e=this._private;return e.emitter||(e.emitter=new R1(Ez,this)),this},emitter:function(){return this._private.emitter},on:function(e,r,n){return this.emitter().on(e,uy(r),n),this},removeListener:function(e,r,n){return this.emitter().removeListener(e,uy(r),n),this},removeAllListeners:function(){return this.emitter().removeAllListeners(),this},one:function(e,r,n){return this.emitter().one(e,uy(r),n),this},once:function(e,r,n){return this.emitter().one(e,uy(r),n),this},emit:function(e,r){return this.emitter().emit(e,r),this},emitAndNotify:function(e,r){return this.emit(e),this.notify(e,r),this}};Zr.eventAliasesOn(YA);var KS={png:function(e){var r=this._private.renderer;return e=e||{},r.png(e)},jpg:function(e){var r=this._private.renderer;return e=e||{},e.bg=e.bg||"#fff",r.jpg(e)}};KS.jpeg=KS.jpg;var Wy={layout:function(e){var r=this;if(e==null){Gn("Layout options must be specified to make a layout");return}if(e.name==null){Gn("A `name` must be specified to make a layout");return}var n=e.name,i=r.extension("layout",n);if(i==null){Gn("No such layout `"+n+"` found.  Did you forget to import it and `cytoscape.use()` it?");return}var a;Wt(e.eles)?a=r.$(e.eles):a=e.eles!=null?e.eles:r.$();var s=new i(Jt({},e,{cy:r,eles:a}));return s}};Wy.createLayout=Wy.makeLayout=Wy.layout;var Tz={notify:function(e,r){var n=this._private;if(this.batching()){n.batchNotifications=n.batchNotifications||{};var i=n.batchNotifications[e]=n.batchNotifications[e]||this.collection();r!=null&&i.merge(r);return}if(n.notificationsEnabled){var a=this.renderer();this.destroyed()||!a||a.notify(e,r)}},notifications:function(e){var r=this._private;return e===void 0?r.notificationsEnabled:(r.notificationsEnabled=!!e,this)},noNotifications:function(e){this.notifications(!1),e(),this.notifications(!0)},batching:function(){return this._private.batchCount>0},startBatch:function(){var e=this._private;return e.batchCount==null&&(e.batchCount=0),e.batchCount===0&&(e.batchStyleEles=this.collection(),e.batchNotifications={}),e.batchCount++,this},endBatch:function(){var e=this._private;if(e.batchCount===0)return this;if(e.batchCount--,e.batchCount===0){e.batchStyleEles.updateStyle();var r=this.renderer();Object.keys(e.batchNotifications).forEach(function(n){var i=e.batchNotifications[n];i.empty()?r.notify(n):r.notify(n,i)})}return this},batch:function(e){return this.startBatch(),e(),this.endBatch(),this},batchData:function(e){var r=this;return this.batch(function(){for(var n=Object.keys(e),i=0;i<n.length;i++){var a=n[i],s=e[a],o=r.getElementById(a);o.data(s)}})}},Nz=Ua({hideEdgesOnViewport:!1,textureOnViewport:!1,motionBlur:!1,motionBlurOpacity:.05,pixelRatio:void 0,desktopTapThreshold:4,touchTapThreshold:8,wheelSensitivity:1,debug:!1,showFps:!1,webgl:!1,webglDebug:!1,webglDebugShowAtlases:!1,webglTexSize:2048,webglTexRows:36,webglTexRowsNodes:18,webglBatchSize:2048,webglTexPerBatch:14,webglBgColor:[255,255,255]}),ZS={renderTo:function(e,r,n,i){var a=this._private.renderer;return a.renderTo(e,r,n,i),this},renderer:function(){return this._private.renderer},forceRender:function(){return this.notify("draw"),this},resize:function(){return this.invalidateSize(),this.emitAndNotify("resize"),this},initRenderer:function(e){var r=this,n=r.extension("renderer",e.name);if(n==null){Gn("Can not initialise: No such renderer `".concat(e.name,"` found. Did you forget to import it and `cytoscape.use()` it?"));return}e.wheelSensitivity!==void 0&&Yr("You have set a custom wheel sensitivity.  This will make your app zoom unnaturally when using mainstream mice.  You should change this value from the default only if you can guarantee that all your users will use the same hardware and OS configuration as your current machine.");var i=Nz(e);i.cy=r,r._private.renderer=new n(i),this.notify("init")},destroyRenderer:function(){var e=this;e.notify("destroy");var r=e.container();if(r)for(r._cyreg=null;r.childNodes.length>0;)r.removeChild(r.childNodes[0]);e._private.renderer=null,e.mutableElements().forEach(function(n){var i=n._private;i.rscratch={},i.rstyle={},i.animation.current=[],i.animation.queue=[]})},onRender:function(e){return this.on("render",e)},offRender:function(e){return this.off("render",e)}};ZS.invalidateDimensions=ZS.resize;var qy={collection:function(e,r){return Wt(e)?this.$(e):uo(e)?e.collection():pn(e)?(r||(r={}),new Fa(this,e,r.unique,r.removed)):new Fa(this)},nodes:function(e){var r=this.$(function(n){return n.isNode()});return e?r.filter(e):r},edges:function(e){var r=this.$(function(n){return n.isEdge()});return e?r.filter(e):r},$:function(e){var r=this._private.elements;return e?r.filter(e):r.spawnSelf()},mutableElements:function(){return this._private.elements}};qy.elements=qy.filter=qy.$;var ha={},nv="t",Pz="f";ha.apply=function(t){for(var e=this,r=e._private,n=r.cy,i=n.collection(),a=0;a<t.length;a++){var s=t[a],o=e.getContextMeta(s);if(!o.empty){var l=e.getContextStyle(o),u=e.applyContextStyle(o,l,s);s._private.appliedInitStyle?e.updateTransitions(s,u.diffProps):s._private.appliedInitStyle=!0;var c=e.updateStyleHints(s);c&&i.push(s)}}return i};ha.getPropertiesDiff=function(t,e){var r=this,n=r._private.propDiffs=r._private.propDiffs||{},i=t+"-"+e,a=n[i];if(a)return a;for(var s=[],o={},l=0;l<r.length;l++){var u=r[l],c=t[l]===nv,f=e[l]===nv,p=c!==f,v=u.mappedProperties.length>0;if(p||f&&v){var y=void 0;p&&v||p?y=u.properties:v&&(y=u.mappedProperties);for(var S=0;S<y.length;S++){for(var w=y[S],T=w.name,_=!1,C=l+1;C<r.length;C++){var N=r[C],A=e[C]===nv;if(A&&(_=N.properties[w.name]!=null,_))break}!o[T]&&!_&&(o[T]=!0,s.push(T))}}}return n[i]=s,s};ha.getContextMeta=function(t){for(var e=this,r="",n,i=t._private.styleCxtKey||"",a=0;a<e.length;a++){var s=e[a],o=s.selector&&s.selector.matches(t);o?r+=nv:r+=Pz}return n=e.getPropertiesDiff(i,r),t._private.styleCxtKey=r,{key:r,diffPropNames:n,empty:n.length===0}};ha.getContextStyle=function(t){var e=t.key,r=this,n=this._private.contextStyles=this._private.contextStyles||{};if(n[e])return n[e];for(var i={_private:{key:e}},a=0;a<r.length;a++){var s=r[a],o=e[a]===nv;if(o)for(var l=0;l<s.properties.length;l++){var u=s.properties[l];i[u.name]=u}}return n[e]=i,i};ha.applyContextStyle=function(t,e,r){for(var n=this,i=t.diffPropNames,a={},s=n.types,o=0;o<i.length;o++){var l=i[o],u=e[l],c=r.pstyle(l);if(!u)if(c)c.bypass?u={name:l,deleteBypassed:!0}:u={name:l,delete:!0};else continue;if(c!==u){if(u.mapped===s.fn&&c!=null&&c.mapping!=null&&c.mapping.value===u.value){var f=c.mapping,p=f.fnValue=u.value(r);if(p===f.prevFnValue)continue}var v=a[l]={prev:c};n.applyParsedProperty(r,u),v.next=r.pstyle(l),v.next&&v.next.bypass&&(v.next=v.next.bypassed)}}return{diffProps:a}};ha.updateStyleHints=function(t){var e=t._private,r=this,n=r.propertyGroupNames,i=r.propertyGroupKeys,a=function(xe,we,Ge){return r.getPropertiesHash(xe,we,Ge)},s=e.styleKey;if(t.removed())return!1;var o=e.group==="nodes",l=t._private.style;n=Object.keys(l);for(var u=0;u<i.length;u++){var c=i[u];e.styleKeys[c]=[Jf,Np]}for(var f=function(xe,we){return e.styleKeys[we][0]=Sv(xe,e.styleKeys[we][0])},p=function(xe,we){return e.styleKeys[we][1]=kv(xe,e.styleKeys[we][1])},v=function(xe,we){f(xe,we),p(xe,we)},y=function(xe,we){for(var Ge=0;Ge<xe.length;Ge++){var qe=xe.charCodeAt(Ge);f(qe,we),p(qe,we)}},S=2e9,w=function(xe){return-128<xe&&xe<128&&Math.floor(xe)!==xe?S-(xe*1024|0):xe},T=0;T<n.length;T++){var _=n[T],C=l[_];if(C!=null){var N=this.properties[_],A=N.type,O=N.groupKey,j=void 0;N.hashOverride!=null?j=N.hashOverride(t,C):C.pfValue!=null&&(j=C.pfValue);var D=N.enums==null?C.value:null,F=j!=null,B=D!=null,$=F||B,Z=C.units;if(A.number&&$&&!A.multiple){var I=F?j:D;v(w(I),O),!F&&Z!=null&&y(Z,O)}else y(C.strValue,O)}}for(var q=[Jf,Np],U=0;U<i.length;U++){var W=i[U],Y=e.styleKeys[W];q[0]=Sv(Y[0],q[0]),q[1]=kv(Y[1],q[1])}e.styleKey=WF(q[0],q[1]);var Q=e.styleKeys;e.labelDimsKey=xd(Q.labelDimensions);var ne=a(t,["label"],Q.labelDimensions);if(e.labelKey=xd(ne),e.labelStyleKey=xd(ty(Q.commonLabel,ne)),!o){var re=a(t,["source-label"],Q.labelDimensions);e.sourceLabelKey=xd(re),e.sourceLabelStyleKey=xd(ty(Q.commonLabel,re));var H=a(t,["target-label"],Q.labelDimensions);e.targetLabelKey=xd(H),e.targetLabelStyleKey=xd(ty(Q.commonLabel,H))}if(o){var te=e.styleKeys,ie=te.nodeBody,de=te.nodeBorder,ge=te.nodeOutline,ye=te.backgroundImage,ae=te.compound,pe=te.pie,le=te.stripe,me=[ie,de,ge,ye,ae,pe,le].filter(function(he){return he!=null}).reduce(ty,[Jf,Np]);e.nodeKey=xd(me),e.hasPie=pe!=null&&pe[0]!==Jf&&pe[1]!==Np,e.hasStripe=le!=null&&le[0]!==Jf&&le[1]!==Np}return s!==e.styleKey};ha.clearStyleHints=function(t){var e=t._private;e.styleCxtKey="",e.styleKeys={},e.styleKey=null,e.labelKey=null,e.labelStyleKey=null,e.sourceLabelKey=null,e.sourceLabelStyleKey=null,e.targetLabelKey=null,e.targetLabelStyleKey=null,e.nodeKey=null,e.hasPie=null,e.hasStripe=null};ha.applyParsedProperty=function(t,e){var r=this,n=e,i=t._private.style,a,s=r.types,o=r.properties[n.name].type,l=n.bypass,u=i[n.name],c=u&&u.bypass,f=t._private,p="mapping",v=function(ie){return ie==null?null:ie.pfValue!=null?ie.pfValue:ie.value},y=function(){var ie=v(u),de=v(n);r.checkTriggers(t,n.name,ie,de)};if(e.name==="curve-style"&&t.isEdge()&&(e.value!=="bezier"&&t.isLoop()||e.value==="haystack"&&(t.source().isParent()||t.target().isParent()))&&(n=e=this.parse(e.name,"bezier",l)),n.delete)return i[n.name]=void 0,y(),!0;if(n.deleteBypassed)return u?u.bypass?(u.bypassed=void 0,y(),!0):!1:(y(),!0);if(n.deleteBypass)return u?u.bypass?(i[n.name]=u.bypassed,y(),!0):!1:(y(),!0);var S=function(){Yr("Do not assign mappings to elements without corresponding data (i.e. ele `"+t.id()+"` has no mapping for property `"+n.name+"` with data field `"+n.field+"`); try a `["+n.field+"]` selector to limit scope to elements with `"+n.field+"` defined")};switch(n.mapped){case s.mapData:{for(var w=n.field.split("."),T=f.data,_=0;_<w.length&&T;_++){var C=w[_];T=T[C]}if(T==null)return S(),!1;var N;if(gt(T)){var A=n.fieldMax-n.fieldMin;A===0?N=0:N=(T-n.fieldMin)/A}else return Yr("Do not use continuous mappers without specifying numeric data (i.e. `"+n.field+": "+T+"` for `"+t.id()+"` is non-numeric)"),!1;if(N<0?N=0:N>1&&(N=1),o.color){var O=n.valueMin[0],j=n.valueMax[0],D=n.valueMin[1],F=n.valueMax[1],B=n.valueMin[2],$=n.valueMax[2],Z=n.valueMin[3]==null?1:n.valueMin[3],I=n.valueMax[3]==null?1:n.valueMax[3],q=[Math.round(O+(j-O)*N),Math.round(D+(F-D)*N),Math.round(B+($-B)*N),Math.round(Z+(I-Z)*N)];a={bypass:n.bypass,name:n.name,value:q,strValue:"rgb("+q[0]+", "+q[1]+", "+q[2]+")"}}else if(o.number){var U=n.valueMin+(n.valueMax-n.valueMin)*N;a=this.parse(n.name,U,n.bypass,p)}else return!1;if(!a)return S(),!1;a.mapping=n,n=a;break}case s.data:{for(var W=n.field.split("."),Y=f.data,Q=0;Q<W.length&&Y;Q++){var ne=W[Q];Y=Y[ne]}if(Y!=null&&(a=this.parse(n.name,Y,n.bypass,p)),!a)return S(),!1;a.mapping=n,n=a;break}case s.fn:{var re=n.value,H=n.fnValue!=null?n.fnValue:re(t);if(n.prevFnValue=H,H==null)return Yr("Custom function mappers may not return null (i.e. `"+n.name+"` for ele `"+t.id()+"` is null)"),!1;if(a=this.parse(n.name,H,n.bypass,p),!a)return Yr("Custom function mappers may not return invalid values for the property type (i.e. `"+n.name+"` for ele `"+t.id()+"` is invalid)"),!1;a.mapping=bu(n),n=a;break}case void 0:break;default:return!1}return l?(c?n.bypassed=u.bypassed:n.bypassed=u,i[n.name]=n):c?u.bypassed=n:i[n.name]=n,y(),!0};ha.cleanElements=function(t,e){for(var r=0;r<t.length;r++){var n=t[r];if(this.clearStyleHints(n),n.dirtyCompoundBoundsCache(),n.dirtyBoundingBoxCache(),!e)n._private.style={};else for(var i=n._private.style,a=Object.keys(i),s=0;s<a.length;s++){var o=a[s],l=i[o];l!=null&&(l.bypass?l.bypassed=null:i[o]=null)}}};ha.update=function(){var t=this._private.cy,e=t.mutableElements();e.updateStyle()};ha.updateTransitions=function(t,e){var r=this,n=t._private,i=t.pstyle("transition-property").value,a=t.pstyle("transition-duration").pfValue,s=t.pstyle("transition-delay").pfValue;if(i.length>0&&a>0){for(var o={},l=!1,u=0;u<i.length;u++){var c=i[u],f=t.pstyle(c),p=e[c];if(p){var v=p.prev,y=v,S=p.next!=null?p.next:f,w=!1,T=void 0,_=1e-6;y&&(gt(y.pfValue)&&gt(S.pfValue)?(w=S.pfValue-y.pfValue,T=y.pfValue+_*w):gt(y.value)&&gt(S.value)?(w=S.value-y.value,T=y.value+_*w):pn(y.value)&&pn(S.value)&&(w=y.value[0]!==S.value[0]||y.value[1]!==S.value[1]||y.value[2]!==S.value[2],T=y.strValue),w&&(o[c]=S.strValue,this.applyBypass(t,c,T),l=!0))}}if(!l)return;n.transitioning=!0,new hm(function(C){s>0?t.delayAnimation(s).play().promise().then(C):C()}).then(function(){return t.animation({style:o,duration:a,easing:t.pstyle("transition-timing-function").value,queue:!1}).play().promise()}).then(function(){r.removeBypasses(t,i),t.emitAndNotify("style"),n.transitioning=!1})}else n.transitioning&&(this.removeBypasses(t,i),t.emitAndNotify("style"),n.transitioning=!1)};ha.checkTrigger=function(t,e,r,n,i,a){var s=this.properties[e],o=i(s);t.removed()||o!=null&&o(r,n,t)&&a(s)};ha.checkZOrderTrigger=function(t,e,r,n){var i=this;this.checkTrigger(t,e,r,n,function(a){return a.triggersZOrder},function(){i._private.cy.notify("zorder",t)})};ha.checkBoundsTrigger=function(t,e,r,n){this.checkTrigger(t,e,r,n,function(i){return i.triggersBounds},function(i){t.dirtyCompoundBoundsCache(),t.dirtyBoundingBoxCache()})};ha.checkConnectedEdgesBoundsTrigger=function(t,e,r,n){this.checkTrigger(t,e,r,n,function(i){return i.triggersBoundsOfConnectedEdges},function(i){t.connectedEdges().forEach(function(a){a.dirtyBoundingBoxCache()})})};ha.checkParallelEdgesBoundsTrigger=function(t,e,r,n){this.checkTrigger(t,e,r,n,function(i){return i.triggersBoundsOfParallelEdges},function(i){t.parallelEdges().forEach(function(a){a.dirtyBoundingBoxCache()})})};ha.checkTriggers=function(t,e,r,n){t.dirtyStyleCache(),this.checkZOrderTrigger(t,e,r,n),this.checkBoundsTrigger(t,e,r,n),this.checkConnectedEdgesBoundsTrigger(t,e,r,n),this.checkParallelEdgesBoundsTrigger(t,e,r,n)};var s0={};s0.applyBypass=function(t,e,r,n){var i=this,a=[],s=!0;if(e==="*"||e==="**"){if(r!==void 0)for(var o=0;o<i.properties.length;o++){var l=i.properties[o],u=l.name,c=this.parse(u,r,!0);c&&a.push(c)}}else if(Wt(e)){var f=this.parse(e,r,!0);f&&a.push(f)}else if(Ir(e)){var p=e;n=r;for(var v=Object.keys(p),y=0;y<v.length;y++){var S=v[y],w=p[S];if(w===void 0&&(w=p[k1(S)]),w!==void 0){var T=this.parse(S,w,!0);T&&a.push(T)}}}else return!1;if(a.length===0)return!1;for(var _=!1,C=0;C<t.length;C++){for(var N=t[C],A={},O=void 0,j=0;j<a.length;j++){var D=a[j];if(n){var F=N.pstyle(D.name);O=A[D.name]={prev:F}}_=this.applyParsedProperty(N,bu(D))||_,n&&(O.next=N.pstyle(D.name))}_&&this.updateStyleHints(N),n&&this.updateTransitions(N,A,s)}return _};s0.overrideBypass=function(t,e,r){e=o_(e);for(var n=0;n<t.length;n++){var i=t[n],a=i._private.style[e],s=this.properties[e].type,o=s.color,l=s.mutiple,u=a?a.pfValue!=null?a.pfValue:a.value:null;!a||!a.bypass?this.applyBypass(i,e,r):(a.value=r,a.pfValue!=null&&(a.pfValue=r),o?a.strValue="rgb("+r.join(",")+")":l?a.strValue=r.join(" "):a.strValue=""+r,this.updateStyleHints(i)),this.checkTriggers(i,e,u,r)}};s0.removeAllBypasses=function(t,e){return this.removeBypasses(t,this.propertyNames,e)};s0.removeBypasses=function(t,e,r){for(var n=!0,i=0;i<t.length;i++){for(var a=t[i],s={},o=0;o<e.length;o++){var l=e[o],u=this.properties[l],c=a.pstyle(u.name);if(!(!c||!c.bypass)){var f="",p=this.parse(l,f,!0),v=s[u.name]={prev:c};this.applyParsedProperty(a,p),v.next=a.pstyle(u.name)}}this.updateStyleHints(a),r&&this.updateTransitions(a,s,n)}};var S_={};S_.getEmSizeInPixels=function(){var t=this.containerCss("font-size");return t!=null?parseFloat(t):1};S_.containerCss=function(t){var e=this._private.cy,r=e.container(),n=e.window();if(n&&r&&n.getComputedStyle)return n.getComputedStyle(r).getPropertyValue(t)};var _u={};_u.getRenderedStyle=function(t,e){return e?this.getStylePropertyValue(t,e,!0):this.getRawStyle(t,!0)};_u.getRawStyle=function(t,e){var r=this;if(t=t[0],t){for(var n={},i=0;i<r.properties.length;i++){var a=r.properties[i],s=r.getStylePropertyValue(t,a.name,e);s!=null&&(n[a.name]=s,n[k1(a.name)]=s)}return n}};_u.getIndexedStyle=function(t,e,r,n){var i=t.pstyle(e)[r][n];return i??t.cy().style().getDefaultProperty(e)[r][0]};_u.getStylePropertyValue=function(t,e,r){var n=this;if(t=t[0],t){var i=n.properties[e];i.alias&&(i=i.pointsTo);var a=i.type,s=t.pstyle(i.name);if(s){var o=s.value,l=s.units,u=s.strValue;if(r&&a.number&&o!=null&&gt(o)){var c=t.cy().zoom(),f=function(w){return w*c},p=function(w,T){return f(w)+T},v=pn(o),y=v?l.every(function(S){return S!=null}):l!=null;return y?v?o.map(function(S,w){return p(S,l[w])}).join(" "):p(o,l):v?o.map(function(S){return Wt(S)?S:""+f(S)}).join(" "):""+f(o)}else if(u!=null)return u}return null}};_u.getAnimationStartStyle=function(t,e){for(var r={},n=0;n<e.length;n++){var i=e[n],a=i.name,s=t.pstyle(a);s!==void 0&&(Ir(s)?s=this.parse(a,s.strValue):s=this.parse(a,s)),s&&(r[a]=s)}return r};_u.getPropsList=function(t){var e=this,r=[],n=t,i=e.properties;if(n)for(var a=Object.keys(n),s=0;s<a.length;s++){var o=a[s],l=n[o],u=i[o]||i[o_(o)],c=this.parse(u.name,l);c&&r.push(c)}return r};_u.getNonDefaultPropertiesHash=function(t,e,r){var n=r.slice(),i,a,s,o,l,u;for(l=0;l<e.length;l++)if(i=e[l],a=t.pstyle(i,!1),a!=null)if(a.pfValue!=null)n[0]=Sv(o,n[0]),n[1]=kv(o,n[1]);else for(s=a.strValue,u=0;u<s.length;u++)o=s.charCodeAt(u),n[0]=Sv(o,n[0]),n[1]=kv(o,n[1]);return n};_u.getPropertiesHash=_u.getNonDefaultPropertiesHash;var I1={};I1.appendFromJson=function(t){for(var e=this,r=0;r<t.length;r++){var n=t[r],i=n.selector,a=n.style||n.css,s=Object.keys(a);e.selector(i);for(var o=0;o<s.length;o++){var l=s[o],u=a[l];e.css(l,u)}}return e};I1.fromJson=function(t){var e=this;return e.resetToDefault(),e.appendFromJson(t),e};I1.json=function(){for(var t=[],e=this.defaultLength;e<this.length;e++){for(var r=this[e],n=r.selector,i=r.properties,a={},s=0;s<i.length;s++){var o=i[s];a[o.name]=o.strValue}t.push({selector:n?n.toString():"core",style:a})}return t};var k_={};k_.appendFromString=function(t){var e=this,r=this,n=""+t,i,a,s;n=n.replace(/[/][*](\s|.)+?[*][/]/g,"");function o(){n.length>i.length?n=n.substr(i.length):n=""}function l(){a.length>s.length?a=a.substr(s.length):a=""}for(;;){var u=n.match(/^\s*$/);if(u)break;var c=n.match(/^\s*((?:.|\s)+?)\s*\{((?:.|\s)+?)\}/);if(!c){Yr("Halting stylesheet parsing: String stylesheet contains more to parse but no selector and block found in: "+n);break}i=c[0];var f=c[1];if(f!=="core"){var p=new ef(f);if(p.invalid){Yr("Skipping parsing of block: Invalid selector found in string stylesheet: "+f),o();continue}}var v=c[2],y=!1;a=v;for(var S=[];;){var w=a.match(/^\s*$/);if(w)break;var T=a.match(/^\s*(.+?)\s*:\s*(.+?)(?:\s*;|\s*$)/);if(!T){Yr("Skipping parsing of block: Invalid formatting of style property and value definitions found in:"+v),y=!0;break}s=T[0];var _=T[1],C=T[2],N=e.properties[_];if(!N){Yr("Skipping property: Invalid property name in: "+s),l();continue}var A=r.parse(_,C);if(!A){Yr("Skipping property: Invalid property definition in: "+s),l();continue}S.push({name:_,val:C}),l()}if(y){o();break}r.selector(f);for(var O=0;O<S.length;O++){var j=S[O];r.css(j.name,j.val)}o()}return r};k_.fromString=function(t){var e=this;return e.resetToDefault(),e.appendFromString(t),e};var Mi={};(function(){var t=Gi,e=kF,r=CF,n=EF,i=TF,a=function(he){return"^"+he+"\\s*\\(\\s*([\\w\\.]+)\\s*\\)$"},s=function(he){var xe=t+"|\\w+|"+e+"|"+r+"|"+n+"|"+i;return"^"+he+"\\s*\\(([\\w\\.]+)\\s*\\,\\s*("+t+")\\s*\\,\\s*("+t+")\\s*,\\s*("+xe+")\\s*\\,\\s*("+xe+")\\)$"},o=[`^url\\s*\\(\\s*['"]?(.+?)['"]?\\s*\\)$`,"^(none)$","^(.+)$"];Mi.types={time:{number:!0,min:0,units:"s|ms",implicitUnits:"ms"},percent:{number:!0,min:0,max:100,units:"%",implicitUnits:"%"},percentages:{number:!0,min:0,max:100,units:"%",implicitUnits:"%",multiple:!0},zeroOneNumber:{number:!0,min:0,max:1,unitless:!0},zeroOneNumbers:{number:!0,min:0,max:1,unitless:!0,multiple:!0},nOneOneNumber:{number:!0,min:-1,max:1,unitless:!0},nonNegativeInt:{number:!0,min:0,integer:!0,unitless:!0},nonNegativeNumber:{number:!0,min:0,unitless:!0},position:{enums:["parent","origin"]},nodeSize:{number:!0,min:0,enums:["label"]},number:{number:!0,unitless:!0},numbers:{number:!0,unitless:!0,multiple:!0},positiveNumber:{number:!0,unitless:!0,min:0,strictMin:!0},size:{number:!0,min:0},bidirectionalSize:{number:!0},bidirectionalSizeMaybePercent:{number:!0,allowPercent:!0},bidirectionalSizes:{number:!0,multiple:!0},sizeMaybePercent:{number:!0,min:0,allowPercent:!0},axisDirection:{enums:["horizontal","leftward","rightward","vertical","upward","downward","auto"]},axisDirectionExplicit:{enums:["leftward","rightward","upward","downward"]},axisDirectionPrimary:{enums:["horizontal","vertical"]},paddingRelativeTo:{enums:["width","height","average","min","max"]},bgWH:{number:!0,min:0,allowPercent:!0,enums:["auto"],multiple:!0},bgPos:{number:!0,allowPercent:!0,multiple:!0},bgRelativeTo:{enums:["inner","include-padding"],multiple:!0},bgRepeat:{enums:["repeat","repeat-x","repeat-y","no-repeat"],multiple:!0},bgFit:{enums:["none","contain","cover"],multiple:!0},bgCrossOrigin:{enums:["anonymous","use-credentials","null"],multiple:!0},bgClip:{enums:["none","node"],multiple:!0},bgContainment:{enums:["inside","over"],multiple:!0},boxSelection:{enums:["contain","overlap","none"]},color:{color:!0},colors:{color:!0,multiple:!0},fill:{enums:["solid","linear-gradient","radial-gradient"]},bool:{enums:["yes","no"]},bools:{enums:["yes","no"],multiple:!0},lineStyle:{enums:["solid","dotted","dashed"]},lineCap:{enums:["butt","round","square"]},linePosition:{enums:["center","inside","outside"]},lineJoin:{enums:["round","bevel","miter"]},borderStyle:{enums:["solid","dotted","dashed","double"]},curveStyle:{enums:["bezier","unbundled-bezier","haystack","segments","straight","straight-triangle","taxi","round-segments","round-taxi"]},radiusType:{enums:["arc-radius","influence-radius"],multiple:!0},fontFamily:{regex:'^([\\w- \\"]+(?:\\s*,\\s*[\\w- \\"]+)*)$'},fontStyle:{enums:["italic","normal","oblique"]},fontWeight:{enums:["normal","bold","bolder","lighter","100","200","300","400","500","600","800","900",100,200,300,400,500,600,700,800,900]},textDecoration:{enums:["none","underline","overline","line-through"]},textTransform:{enums:["none","uppercase","lowercase"]},textWrap:{enums:["none","wrap","ellipsis"]},textOverflowWrap:{enums:["whitespace","anywhere"]},textBackgroundShape:{enums:["rectangle","roundrectangle","round-rectangle","circle"]},nodeShape:{enums:["rectangle","roundrectangle","round-rectangle","cutrectangle","cut-rectangle","bottomroundrectangle","bottom-round-rectangle","barrel","ellipse","triangle","round-triangle","square","pentagon","round-pentagon","hexagon","round-hexagon","concavehexagon","concave-hexagon","heptagon","round-heptagon","octagon","round-octagon","tag","round-tag","star","diamond","round-diamond","vee","rhomboid","right-rhomboid","polygon"]},overlayShape:{enums:["roundrectangle","round-rectangle","ellipse"]},cornerRadius:{number:!0,min:0,units:"px|em",implicitUnits:"px",enums:["auto"]},compoundIncludeLabels:{enums:["include","exclude"]},arrowShape:{enums:["tee","triangle","triangle-tee","circle-triangle","triangle-cross","triangle-backcurve","vee","square","circle","diamond","chevron","none"]},arrowFill:{enums:["filled","hollow"]},arrowWidth:{number:!0,units:"%|px|em",implicitUnits:"px",enums:["match-line"]},display:{enums:["element","none"]},visibility:{enums:["hidden","visible"]},zCompoundDepth:{enums:["bottom","orphan","auto","top"]},zIndexCompare:{enums:["auto","manual"]},valign:{enums:["top","center","bottom"]},halign:{enums:["left","center","right"]},justification:{enums:["left","center","right","auto"]},text:{string:!0},data:{mapping:!0,regex:a("data")},layoutData:{mapping:!0,regex:a("layoutData")},scratch:{mapping:!0,regex:a("scratch")},mapData:{mapping:!0,regex:s("mapData")},mapLayoutData:{mapping:!0,regex:s("mapLayoutData")},mapScratch:{mapping:!0,regex:s("mapScratch")},fn:{mapping:!0,fn:!0},url:{regexes:o,singleRegexMatchValue:!0},urls:{regexes:o,singleRegexMatchValue:!0,multiple:!0},propList:{propList:!0},angle:{number:!0,units:"deg|rad",implicitUnits:"rad"},textRotation:{number:!0,units:"deg|rad",implicitUnits:"rad",enums:["none","autorotate"]},polygonPointList:{number:!0,multiple:!0,evenMultiple:!0,min:-1,max:1,unitless:!0},edgeDistances:{enums:["intersection","node-position","endpoints"]},edgeEndpoint:{number:!0,multiple:!0,units:"%|px|em|deg|rad",implicitUnits:"px",enums:["inside-to-node","outside-to-node","outside-to-node-or-label","outside-to-line","outside-to-line-or-label"],singleEnum:!0,validate:function(he,xe){switch(he.length){case 2:return xe[0]!=="deg"&&xe[0]!=="rad"&&xe[1]!=="deg"&&xe[1]!=="rad";case 1:return Wt(he[0])||xe[0]==="deg"||xe[0]==="rad";default:return!1}}},easing:{regexes:["^(spring)\\s*\\(\\s*("+t+")\\s*,\\s*("+t+")\\s*\\)$","^(cubic-bezier)\\s*\\(\\s*("+t+")\\s*,\\s*("+t+")\\s*,\\s*("+t+")\\s*,\\s*("+t+")\\s*\\)$"],enums:["linear","ease","ease-in","ease-out","ease-in-out","ease-in-sine","ease-out-sine","ease-in-out-sine","ease-in-quad","ease-out-quad","ease-in-out-quad","ease-in-cubic","ease-out-cubic","ease-in-out-cubic","ease-in-quart","ease-out-quart","ease-in-out-quart","ease-in-quint","ease-out-quint","ease-in-out-quint","ease-in-expo","ease-out-expo","ease-in-out-expo","ease-in-circ","ease-out-circ","ease-in-out-circ"]},gradientDirection:{enums:["to-bottom","to-top","to-left","to-right","to-bottom-right","to-bottom-left","to-top-right","to-top-left","to-right-bottom","to-left-bottom","to-right-top","to-left-top"]},boundsExpansion:{number:!0,multiple:!0,min:0,validate:function(he){var xe=he.length;return xe===1||xe===2||xe===4}}};var l={zeroNonZero:function(he,xe){return(he==null||xe==null)&&he!==xe||he==0&&xe!=0?!0:he!=0&&xe==0},any:function(he,xe){return he!=xe},emptyNonEmpty:function(he,xe){var we=Xd(he),Ge=Xd(xe);return we&&!Ge||!we&&Ge}},u=Mi.types,c=[{name:"label",type:u.text,triggersBounds:l.any,triggersZOrder:l.emptyNonEmpty},{name:"text-rotation",type:u.textRotation,triggersBounds:l.any},{name:"text-margin-x",type:u.bidirectionalSize,triggersBounds:l.any},{name:"text-margin-y",type:u.bidirectionalSize,triggersBounds:l.any}],f=[{name:"source-label",type:u.text,triggersBounds:l.any},{name:"source-text-rotation",type:u.textRotation,triggersBounds:l.any},{name:"source-text-margin-x",type:u.bidirectionalSize,triggersBounds:l.any},{name:"source-text-margin-y",type:u.bidirectionalSize,triggersBounds:l.any},{name:"source-text-offset",type:u.size,triggersBounds:l.any}],p=[{name:"target-label",type:u.text,triggersBounds:l.any},{name:"target-text-rotation",type:u.textRotation,triggersBounds:l.any},{name:"target-text-margin-x",type:u.bidirectionalSize,triggersBounds:l.any},{name:"target-text-margin-y",type:u.bidirectionalSize,triggersBounds:l.any},{name:"target-text-offset",type:u.size,triggersBounds:l.any}],v=[{name:"font-family",type:u.fontFamily,triggersBounds:l.any},{name:"font-style",type:u.fontStyle,triggersBounds:l.any},{name:"font-weight",type:u.fontWeight,triggersBounds:l.any},{name:"font-size",type:u.size,triggersBounds:l.any},{name:"text-transform",type:u.textTransform,triggersBounds:l.any},{name:"text-wrap",type:u.textWrap,triggersBounds:l.any},{name:"text-overflow-wrap",type:u.textOverflowWrap,triggersBounds:l.any},{name:"text-max-width",type:u.size,triggersBounds:l.any},{name:"text-outline-width",type:u.size,triggersBounds:l.any},{name:"line-height",type:u.positiveNumber,triggersBounds:l.any}],y=[{name:"text-valign",type:u.valign,triggersBounds:l.any},{name:"text-halign",type:u.halign,triggersBounds:l.any},{name:"color",type:u.color},{name:"text-outline-color",type:u.color},{name:"text-outline-opacity",type:u.zeroOneNumber},{name:"text-background-color",type:u.color},{name:"text-background-opacity",type:u.zeroOneNumber},{name:"text-background-padding",type:u.size,triggersBounds:l.any},{name:"text-border-opacity",type:u.zeroOneNumber},{name:"text-border-color",type:u.color},{name:"text-border-width",type:u.size,triggersBounds:l.any},{name:"text-border-style",type:u.borderStyle,triggersBounds:l.any},{name:"text-background-shape",type:u.textBackgroundShape,triggersBounds:l.any},{name:"text-justification",type:u.justification},{name:"box-select-labels",type:u.bool,triggersBounds:l.any}],S=[{name:"events",type:u.bool,triggersZOrder:l.any},{name:"text-events",type:u.bool,triggersZOrder:l.any},{name:"box-selection",type:u.boxSelection,triggersZOrder:l.any}],w=[{name:"display",type:u.display,triggersZOrder:l.any,triggersBounds:l.any,triggersBoundsOfConnectedEdges:l.any,triggersBoundsOfParallelEdges:function(he,xe,we){return he===xe?!1:we.pstyle("curve-style").value==="bezier"}},{name:"visibility",type:u.visibility,triggersZOrder:l.any},{name:"opacity",type:u.zeroOneNumber,triggersZOrder:l.zeroNonZero},{name:"text-opacity",type:u.zeroOneNumber},{name:"min-zoomed-font-size",type:u.size},{name:"z-compound-depth",type:u.zCompoundDepth,triggersZOrder:l.any},{name:"z-index-compare",type:u.zIndexCompare,triggersZOrder:l.any},{name:"z-index",type:u.number,triggersZOrder:l.any}],T=[{name:"overlay-padding",type:u.size,triggersBounds:l.any},{name:"overlay-color",type:u.color},{name:"overlay-opacity",type:u.zeroOneNumber,triggersBounds:l.zeroNonZero},{name:"overlay-shape",type:u.overlayShape,triggersBounds:l.any},{name:"overlay-corner-radius",type:u.cornerRadius}],_=[{name:"underlay-padding",type:u.size,triggersBounds:l.any},{name:"underlay-color",type:u.color},{name:"underlay-opacity",type:u.zeroOneNumber,triggersBounds:l.zeroNonZero},{name:"underlay-shape",type:u.overlayShape,triggersBounds:l.any},{name:"underlay-corner-radius",type:u.cornerRadius}],C=[{name:"transition-property",type:u.propList},{name:"transition-duration",type:u.time},{name:"transition-delay",type:u.time},{name:"transition-timing-function",type:u.easing}],N=function(he,xe){return xe.value==="label"?-he.poolIndex():xe.pfValue},A=[{name:"height",type:u.nodeSize,triggersBounds:l.any,hashOverride:N},{name:"width",type:u.nodeSize,triggersBounds:l.any,hashOverride:N},{name:"shape",type:u.nodeShape,triggersBounds:l.any},{name:"shape-polygon-points",type:u.polygonPointList,triggersBounds:l.any},{name:"corner-radius",type:u.cornerRadius},{name:"background-color",type:u.color},{name:"background-fill",type:u.fill},{name:"background-opacity",type:u.zeroOneNumber},{name:"background-blacken",type:u.nOneOneNumber},{name:"background-gradient-stop-colors",type:u.colors},{name:"background-gradient-stop-positions",type:u.percentages},{name:"background-gradient-direction",type:u.gradientDirection},{name:"padding",type:u.sizeMaybePercent,triggersBounds:l.any},{name:"padding-relative-to",type:u.paddingRelativeTo,triggersBounds:l.any},{name:"bounds-expansion",type:u.boundsExpansion,triggersBounds:l.any}],O=[{name:"border-color",type:u.color},{name:"border-opacity",type:u.zeroOneNumber},{name:"border-width",type:u.size,triggersBounds:l.any},{name:"border-style",type:u.borderStyle},{name:"border-cap",type:u.lineCap},{name:"border-join",type:u.lineJoin},{name:"border-dash-pattern",type:u.numbers},{name:"border-dash-offset",type:u.number},{name:"border-position",type:u.linePosition}],j=[{name:"outline-color",type:u.color},{name:"outline-opacity",type:u.zeroOneNumber},{name:"outline-width",type:u.size,triggersBounds:l.any},{name:"outline-style",type:u.borderStyle},{name:"outline-offset",type:u.size,triggersBounds:l.any}],D=[{name:"background-image",type:u.urls},{name:"background-image-crossorigin",type:u.bgCrossOrigin},{name:"background-image-opacity",type:u.zeroOneNumbers},{name:"background-image-containment",type:u.bgContainment},{name:"background-image-smoothing",type:u.bools},{name:"background-position-x",type:u.bgPos},{name:"background-position-y",type:u.bgPos},{name:"background-width-relative-to",type:u.bgRelativeTo},{name:"background-height-relative-to",type:u.bgRelativeTo},{name:"background-repeat",type:u.bgRepeat},{name:"background-fit",type:u.bgFit},{name:"background-clip",type:u.bgClip},{name:"background-width",type:u.bgWH},{name:"background-height",type:u.bgWH},{name:"background-offset-x",type:u.bgPos},{name:"background-offset-y",type:u.bgPos}],F=[{name:"position",type:u.position,triggersBounds:l.any},{name:"compound-sizing-wrt-labels",type:u.compoundIncludeLabels,triggersBounds:l.any},{name:"min-width",type:u.size,triggersBounds:l.any},{name:"min-width-bias-left",type:u.sizeMaybePercent,triggersBounds:l.any},{name:"min-width-bias-right",type:u.sizeMaybePercent,triggersBounds:l.any},{name:"min-height",type:u.size,triggersBounds:l.any},{name:"min-height-bias-top",type:u.sizeMaybePercent,triggersBounds:l.any},{name:"min-height-bias-bottom",type:u.sizeMaybePercent,triggersBounds:l.any}],B=[{name:"line-style",type:u.lineStyle},{name:"line-color",type:u.color},{name:"line-fill",type:u.fill},{name:"line-cap",type:u.lineCap},{name:"line-opacity",type:u.zeroOneNumber},{name:"line-dash-pattern",type:u.numbers},{name:"line-dash-offset",type:u.number},{name:"line-outline-width",type:u.size},{name:"line-outline-color",type:u.color},{name:"line-gradient-stop-colors",type:u.colors},{name:"line-gradient-stop-positions",type:u.percentages},{name:"curve-style",type:u.curveStyle,triggersBounds:l.any,triggersBoundsOfParallelEdges:function(he,xe){return he===xe?!1:he==="bezier"||xe==="bezier"}},{name:"haystack-radius",type:u.zeroOneNumber,triggersBounds:l.any},{name:"source-endpoint",type:u.edgeEndpoint,triggersBounds:l.any},{name:"target-endpoint",type:u.edgeEndpoint,triggersBounds:l.any},{name:"control-point-step-size",type:u.size,triggersBounds:l.any},{name:"control-point-distances",type:u.bidirectionalSizes,triggersBounds:l.any},{name:"control-point-weights",type:u.numbers,triggersBounds:l.any},{name:"segment-distances",type:u.bidirectionalSizes,triggersBounds:l.any},{name:"segment-weights",type:u.numbers,triggersBounds:l.any},{name:"segment-radii",type:u.numbers,triggersBounds:l.any},{name:"radius-type",type:u.radiusType,triggersBounds:l.any},{name:"taxi-turn",type:u.bidirectionalSizeMaybePercent,triggersBounds:l.any},{name:"taxi-turn-min-distance",type:u.size,triggersBounds:l.any},{name:"taxi-direction",type:u.axisDirection,triggersBounds:l.any},{name:"taxi-radius",type:u.number,triggersBounds:l.any},{name:"edge-distances",type:u.edgeDistances,triggersBounds:l.any},{name:"arrow-scale",type:u.positiveNumber,triggersBounds:l.any},{name:"loop-direction",type:u.angle,triggersBounds:l.any},{name:"loop-sweep",type:u.angle,triggersBounds:l.any},{name:"source-distance-from-node",type:u.size,triggersBounds:l.any},{name:"target-distance-from-node",type:u.size,triggersBounds:l.any}],$=[{name:"ghost",type:u.bool,triggersBounds:l.any},{name:"ghost-offset-x",type:u.bidirectionalSize,triggersBounds:l.any},{name:"ghost-offset-y",type:u.bidirectionalSize,triggersBounds:l.any},{name:"ghost-opacity",type:u.zeroOneNumber}],Z=[{name:"selection-box-color",type:u.color},{name:"selection-box-opacity",type:u.zeroOneNumber},{name:"selection-box-border-color",type:u.color},{name:"selection-box-border-width",type:u.size},{name:"active-bg-color",type:u.color},{name:"active-bg-opacity",type:u.zeroOneNumber},{name:"active-bg-size",type:u.size},{name:"outside-texture-bg-color",type:u.color},{name:"outside-texture-bg-opacity",type:u.zeroOneNumber}],I=[];Mi.pieBackgroundN=16,I.push({name:"pie-size",type:u.sizeMaybePercent}),I.push({name:"pie-hole",type:u.sizeMaybePercent}),I.push({name:"pie-start-angle",type:u.angle});for(var q=1;q<=Mi.pieBackgroundN;q++)I.push({name:"pie-"+q+"-background-color",type:u.color}),I.push({name:"pie-"+q+"-background-size",type:u.percent}),I.push({name:"pie-"+q+"-background-opacity",type:u.zeroOneNumber});var U=[];Mi.stripeBackgroundN=16,U.push({name:"stripe-size",type:u.sizeMaybePercent}),U.push({name:"stripe-direction",type:u.axisDirectionPrimary});for(var W=1;W<=Mi.stripeBackgroundN;W++)U.push({name:"stripe-"+W+"-background-color",type:u.color}),U.push({name:"stripe-"+W+"-background-size",type:u.percent}),U.push({name:"stripe-"+W+"-background-opacity",type:u.zeroOneNumber});var Y=[],Q=Mi.arrowPrefixes=["source","mid-source","target","mid-target"];[{name:"arrow-shape",type:u.arrowShape,triggersBounds:l.any},{name:"arrow-color",type:u.color},{name:"arrow-fill",type:u.arrowFill},{name:"arrow-width",type:u.arrowWidth}].forEach(function(me){Q.forEach(function(he){var xe=he+"-"+me.name,we=me.type,Ge=me.triggersBounds;Y.push({name:xe,type:we,triggersBounds:Ge})})},{});var ne=Mi.properties=[].concat(S,C,w,T,_,$,y,v,c,f,p,A,O,j,D,I,U,F,B,Y,Z),re=Mi.propertyGroups={behavior:S,transition:C,visibility:w,overlay:T,underlay:_,ghost:$,commonLabel:y,labelDimensions:v,mainLabel:c,sourceLabel:f,targetLabel:p,nodeBody:A,nodeBorder:O,nodeOutline:j,backgroundImage:D,pie:I,stripe:U,compound:F,edgeLine:B,edgeArrow:Y,core:Z},H=Mi.propertyGroupNames={},te=Mi.propertyGroupKeys=Object.keys(re);te.forEach(function(me){H[me]=re[me].map(function(he){return he.name}),re[me].forEach(function(he){return he.groupKey=me})});var ie=Mi.aliases=[{name:"content",pointsTo:"label"},{name:"control-point-distance",pointsTo:"control-point-distances"},{name:"control-point-weight",pointsTo:"control-point-weights"},{name:"segment-distance",pointsTo:"segment-distances"},{name:"segment-weight",pointsTo:"segment-weights"},{name:"segment-radius",pointsTo:"segment-radii"},{name:"edge-text-rotation",pointsTo:"text-rotation"},{name:"padding-left",pointsTo:"padding"},{name:"padding-right",pointsTo:"padding"},{name:"padding-top",pointsTo:"padding"},{name:"padding-bottom",pointsTo:"padding"}];Mi.propertyNames=ne.map(function(me){return me.name});for(var de=0;de<ne.length;de++){var ge=ne[de];ne[ge.name]=ge}for(var ye=0;ye<ie.length;ye++){var ae=ie[ye],pe=ne[ae.pointsTo],le={name:ae.name,alias:!0,pointsTo:pe};ne.push(le),ne[ae.name]=le}})();Mi.getDefaultProperty=function(t){return this.getDefaultProperties()[t]};Mi.getDefaultProperties=function(){var t=this._private;if(t.defaultProperties!=null)return t.defaultProperties;for(var e=Jt({"selection-box-color":"#ddd","selection-box-opacity":.65,"selection-box-border-color":"#aaa","selection-box-border-width":1,"active-bg-color":"black","active-bg-opacity":.15,"active-bg-size":30,"outside-texture-bg-color":"#000","outside-texture-bg-opacity":.125,events:"yes","text-events":"no","text-valign":"top","text-halign":"center","text-justification":"auto","line-height":1,color:"#000","box-selection":"contain","text-outline-color":"#000","text-outline-width":0,"text-outline-opacity":1,"text-opacity":1,"text-decoration":"none","text-transform":"none","text-wrap":"none","text-overflow-wrap":"whitespace","text-max-width":9999,"text-background-color":"#000","text-background-opacity":0,"text-background-shape":"rectangle","text-background-padding":0,"text-border-opacity":0,"text-border-width":0,"text-border-style":"solid","text-border-color":"#000","font-family":"Helvetica Neue, Helvetica, sans-serif","font-style":"normal","font-weight":"normal","font-size":16,"min-zoomed-font-size":0,"text-rotation":"none","source-text-rotation":"none","target-text-rotation":"none",visibility:"visible",display:"element",opacity:1,"z-compound-depth":"auto","z-index-compare":"auto","z-index":0,label:"","text-margin-x":0,"text-margin-y":0,"source-label":"","source-text-offset":0,"source-text-margin-x":0,"source-text-margin-y":0,"target-label":"","target-text-offset":0,"target-text-margin-x":0,"target-text-margin-y":0,"overlay-opacity":0,"overlay-color":"#000","overlay-padding":10,"overlay-shape":"round-rectangle","overlay-corner-radius":"auto","underlay-opacity":0,"underlay-color":"#000","underlay-padding":10,"underlay-shape":"round-rectangle","underlay-corner-radius":"auto","transition-property":"none","transition-duration":0,"transition-delay":0,"transition-timing-function":"linear","box-select-labels":"no","background-blacken":0,"background-color":"#999","background-fill":"solid","background-opacity":1,"background-image":"none","background-image-crossorigin":"anonymous","background-image-opacity":1,"background-image-containment":"inside","background-image-smoothing":"yes","background-position-x":"50%","background-position-y":"50%","background-offset-x":0,"background-offset-y":0,"background-width-relative-to":"include-padding","background-height-relative-to":"include-padding","background-repeat":"no-repeat","background-fit":"none","background-clip":"node","background-width":"auto","background-height":"auto","border-color":"#000","border-opacity":1,"border-width":0,"border-style":"solid","border-dash-pattern":[4,2],"border-dash-offset":0,"border-cap":"butt","border-join":"miter","border-position":"center","outline-color":"#999","outline-opacity":1,"outline-width":0,"outline-offset":0,"outline-style":"solid",height:30,width:30,shape:"ellipse","shape-polygon-points":"-1, -1,   1, -1,   1, 1,   -1, 1","corner-radius":"auto","bounds-expansion":0,"background-gradient-direction":"to-bottom","background-gradient-stop-colors":"#999","background-gradient-stop-positions":"0%",ghost:"no","ghost-offset-y":0,"ghost-offset-x":0,"ghost-opacity":0,padding:0,"padding-relative-to":"width",position:"origin","compound-sizing-wrt-labels":"include","min-width":0,"min-width-bias-left":0,"min-width-bias-right":0,"min-height":0,"min-height-bias-top":0,"min-height-bias-bottom":0},{"pie-size":"100%","pie-hole":0,"pie-start-angle":"0deg"},[{name:"pie-{{i}}-background-color",value:"black"},{name:"pie-{{i}}-background-size",value:"0%"},{name:"pie-{{i}}-background-opacity",value:1}].reduce(function(l,u){for(var c=1;c<=Mi.pieBackgroundN;c++){var f=u.name.replace("{{i}}",c),p=u.value;l[f]=p}return l},{}),{"stripe-size":"100%","stripe-direction":"horizontal"},[{name:"stripe-{{i}}-background-color",value:"black"},{name:"stripe-{{i}}-background-size",value:"0%"},{name:"stripe-{{i}}-background-opacity",value:1}].reduce(function(l,u){for(var c=1;c<=Mi.stripeBackgroundN;c++){var f=u.name.replace("{{i}}",c),p=u.value;l[f]=p}return l},{}),{"line-style":"solid","line-color":"#999","line-fill":"solid","line-cap":"butt","line-opacity":1,"line-outline-width":0,"line-outline-color":"#000","line-gradient-stop-colors":"#999","line-gradient-stop-positions":"0%","control-point-step-size":40,"control-point-weights":.5,"segment-weights":.5,"segment-distances":20,"segment-radii":15,"radius-type":"arc-radius","taxi-turn":"50%","taxi-radius":15,"taxi-turn-min-distance":10,"taxi-direction":"auto","edge-distances":"intersection","curve-style":"haystack","haystack-radius":0,"arrow-scale":1,"loop-direction":"-45deg","loop-sweep":"-90deg","source-distance-from-node":0,"target-distance-from-node":0,"source-endpoint":"outside-to-node","target-endpoint":"outside-to-node","line-dash-pattern":[6,3],"line-dash-offset":0},[{name:"arrow-shape",value:"none"},{name:"arrow-color",value:"#999"},{name:"arrow-fill",value:"filled"},{name:"arrow-width",value:1}].reduce(function(l,u){return Mi.arrowPrefixes.forEach(function(c){var f=c+"-"+u.name,p=u.value;l[f]=p}),l},{})),r={},n=0;n<this.properties.length;n++){var i=this.properties[n];if(!i.pointsTo){var a=i.name,s=e[a],o=this.parse(a,s);r[a]=o}}return t.defaultProperties=r,t.defaultProperties};Mi.addDefaultStylesheet=function(){this.selector(":parent").css({shape:"rectangle",padding:10,"background-color":"#eee","border-color":"#ccc","border-width":1}).selector("edge").css({width:3}).selector(":loop").css({"curve-style":"bezier"}).selector("edge:compound").css({"curve-style":"bezier","source-endpoint":"outside-to-line","target-endpoint":"outside-to-line"}).selector(":selected").css({"background-color":"#0169D9","line-color":"#0169D9","source-arrow-color":"#0169D9","target-arrow-color":"#0169D9","mid-source-arrow-color":"#0169D9","mid-target-arrow-color":"#0169D9"}).selector(":parent:selected").css({"background-color":"#CCE1F9","border-color":"#aec8e5"}).selector(":active").css({"overlay-color":"black","overlay-padding":10,"overlay-opacity":.25}),this.defaultLength=this.length};var j1={};j1.parse=function(t,e,r,n){var i=this;if(Kn(e))return i.parseImplWarn(t,e,r,n);var a=n==="mapping"||n===!0||n===!1||n==null?"dontcare":n,s=r?"t":"f",o=""+e,l=sA(t,o,s,a),u=i.propCache=i.propCache||[],c;return(c=u[l])||(c=u[l]=i.parseImplWarn(t,e,r,n)),(r||n==="mapping")&&(c=bu(c),c&&(c.value=bu(c.value))),c};j1.parseImplWarn=function(t,e,r,n){var i=this.parseImpl(t,e,r,n);return!i&&e!=null&&Yr("The style property `".concat(t,": ").concat(e,"` is invalid")),i&&(i.name==="width"||i.name==="height")&&e==="label"&&Yr("The style value of `label` is deprecated for `"+i.name+"`"),i};j1.parseImpl=function(t,e,r,n){var i=this;t=o_(t);var a=i.properties[t],s=e,o=i.types;if(!a||e===void 0)return null;a.alias&&(a=a.pointsTo,t=a.name);var l=Wt(e);l&&(e=e.trim());var u=a.type;if(!u)return null;if(r&&(e===""||e===null))return{name:t,value:e,bypass:!0,deleteBypass:!0};if(Kn(e))return{name:t,value:e,strValue:"fn",mapped:o.fn,bypass:r};var c,f;if(!(!l||n||e.length<7||e[1]!=="a")){if(e.length>=7&&e[0]==="d"&&(c=new RegExp(o.data.regex).exec(e))){if(r)return!1;var p=o.data;return{name:t,value:c,strValue:""+e,mapped:p,field:c[1],bypass:r}}else if(e.length>=10&&e[0]==="m"&&(f=new RegExp(o.mapData.regex).exec(e))){if(r||u.multiple)return!1;var v=o.mapData;if(!(u.color||u.number))return!1;var y=this.parse(t,f[4]);if(!y||y.mapped)return!1;var S=this.parse(t,f[5]);if(!S||S.mapped)return!1;if(y.pfValue===S.pfValue||y.strValue===S.strValue)return Yr("`"+t+": "+e+"` is not a valid mapper because the output range is zero; converting to `"+t+": "+y.strValue+"`"),this.parse(t,y.strValue);if(u.color){var w=y.value,T=S.value,_=w[0]===T[0]&&w[1]===T[1]&&w[2]===T[2]&&(w[3]===T[3]||(w[3]==null||w[3]===1)&&(T[3]==null||T[3]===1));if(_)return!1}return{name:t,value:f,strValue:""+e,mapped:v,field:f[1],fieldMin:parseFloat(f[2]),fieldMax:parseFloat(f[3]),valueMin:y.value,valueMax:S.value,bypass:r}}}if(u.multiple&&n!=="multiple"){var C;if(l?C=e.split(/\s+/):pn(e)?C=e:C=[e],u.evenMultiple&&C.length%2!==0)return null;for(var N=[],A=[],O=[],j="",D=!1,F=0;F<C.length;F++){var B=i.parse(t,C[F],r,"multiple");D=D||Wt(B.value),N.push(B.value),O.push(B.pfValue!=null?B.pfValue:B.value),A.push(B.units),j+=(F>0?" ":"")+B.strValue}return u.validate&&!u.validate(N,A)?null:u.singleEnum&&D?N.length===1&&Wt(N[0])?{name:t,value:N[0],strValue:N[0],bypass:r}:null:{name:t,value:N,pfValue:O,strValue:j,bypass:r,units:A}}var $=function(){for(var le=0;le<u.enums.length;le++){var me=u.enums[le];if(me===e)return{name:t,value:e,strValue:""+e,bypass:r}}return null};if(u.number){var Z,I="px";if(u.units&&(Z=u.units),u.implicitUnits&&(I=u.implicitUnits),!u.unitless)if(l){var q="px|em"+(u.allowPercent?"|\\%":"");Z&&(q=Z);var U=e.match("^("+Gi+")("+q+")?$");U&&(e=U[1],Z=U[2]||I)}else(!Z||u.implicitUnits)&&(Z=I);if(e=parseFloat(e),isNaN(e)&&u.enums===void 0)return null;if(isNaN(e)&&u.enums!==void 0)return e=s,$();if(u.integer&&!gF(e)||u.min!==void 0&&(e<u.min||u.strictMin&&e===u.min)||u.max!==void 0&&(e>u.max||u.strictMax&&e===u.max))return null;var W={name:t,value:e,strValue:""+e+(Z||""),units:Z,bypass:r};return u.unitless||Z!=="px"&&Z!=="em"?W.pfValue=e:W.pfValue=Z==="px"||!Z?e:this.getEmSizeInPixels()*e,(Z==="ms"||Z==="s")&&(W.pfValue=Z==="ms"?e:1e3*e),(Z==="deg"||Z==="rad")&&(W.pfValue=Z==="rad"?e:E9(e)),Z==="%"&&(W.pfValue=e/100),W}else if(u.propList){var Y=[],Q=""+e;if(Q!=="none"){for(var ne=Q.split(/\s*,\s*|\s+/),re=0;re<ne.length;re++){var H=ne[re].trim();i.properties[H]?Y.push(H):Yr("`"+H+"` is not a valid property name")}if(Y.length===0)return null}return{name:t,value:Y,strValue:Y.length===0?"none":Y.join(" "),bypass:r}}else if(u.color){var te=JM(e);return te?{name:t,value:te,pfValue:te,strValue:"rgb("+te[0]+","+te[1]+","+te[2]+")",bypass:r}:null}else if(u.regex||u.regexes){if(u.enums){var ie=$();if(ie)return ie}for(var de=u.regexes?u.regexes:[u.regex],ge=0;ge<de.length;ge++){var ye=new RegExp(de[ge]),ae=ye.exec(e);if(ae)return{name:t,value:u.singleRegexMatchValue?ae[1]:ae,strValue:""+e,bypass:r}}return null}else return u.string?{name:t,value:""+e,strValue:""+e,bypass:r}:u.enums?$():null};var ca=function(e){if(!(this instanceof ca))return new ca(e);if(!s_(e)){Gn("A style must have a core reference");return}this._private={cy:e,coreStyle:{}},this.length=0,this.resetToDefault()},as=ca.prototype;as.instanceString=function(){return"style"};as.clear=function(){for(var t=this._private,e=t.cy,r=e.elements(),n=0;n<this.length;n++)this[n]=void 0;return this.length=0,t.contextStyles={},t.propDiffs={},this.cleanElements(r,!0),r.forEach(function(i){var a=i[0]._private;a.styleDirty=!0,a.appliedInitStyle=!1}),this};as.resetToDefault=function(){return this.clear(),this.addDefaultStylesheet(),this};as.core=function(t){return this._private.coreStyle[t]||this.getDefaultProperty(t)};as.selector=function(t){var e=t==="core"?null:new ef(t),r=this.length++;return this[r]={selector:e,properties:[],mappedProperties:[],index:r},this};as.css=function(){var t=this,e=arguments;if(e.length===1)for(var r=e[0],n=0;n<t.properties.length;n++){var i=t.properties[n],a=r[i.name];a===void 0&&(a=r[k1(i.name)]),a!==void 0&&this.cssRule(i.name,a)}else e.length===2&&this.cssRule(e[0],e[1]);return this};as.style=as.css;as.cssRule=function(t,e){var r=this.parse(t,e);if(r){var n=this.length-1;this[n].properties.push(r),this[n].properties[r.name]=r,r.name.match(/pie-(\d+)-background-size/)&&r.value&&(this._private.hasPie=!0),r.name.match(/stripe-(\d+)-background-size/)&&r.value&&(this._private.hasStripe=!0),r.mapped&&this[n].mappedProperties.push(r);var i=!this[n].selector;i&&(this._private.coreStyle[r.name]=r)}return this};as.append=function(t){return YM(t)?t.appendToStyle(this):pn(t)?this.appendFromJson(t):Wt(t)&&this.appendFromString(t),this};ca.fromJson=function(t,e){var r=new ca(t);return r.fromJson(e),r};ca.fromString=function(t,e){return new ca(t).fromString(e)};[ha,s0,S_,_u,I1,k_,Mi,j1].forEach(function(t){Jt(as,t)});ca.types=as.types;ca.properties=as.properties;ca.propertyGroups=as.propertyGroups;ca.propertyGroupNames=as.propertyGroupNames;ca.propertyGroupKeys=as.propertyGroupKeys;var Mz={style:function(e){if(e){var r=this.setStyle(e);r.update()}return this._private.style},setStyle:function(e){var r=this._private;return YM(e)?r.style=e.generateStyle(this):pn(e)?r.style=ca.fromJson(this,e):Wt(e)?r.style=ca.fromString(this,e):r.style=ca(this),r.style},updateStyle:function(){this.mutableElements().updateStyle()}},Az="single",bh={autolock:function(e){if(e!==void 0)this._private.autolock=!!e;else return this._private.autolock;return this},autoungrabify:function(e){if(e!==void 0)this._private.autoungrabify=!!e;else return this._private.autoungrabify;return this},autounselectify:function(e){if(e!==void 0)this._private.autounselectify=!!e;else return this._private.autounselectify;return this},selectionType:function(e){var r=this._private;if(r.selectionType==null&&(r.selectionType=Az),e!==void 0)(e==="additive"||e==="single")&&(r.selectionType=e);else return r.selectionType;return this},panningEnabled:function(e){if(e!==void 0)this._private.panningEnabled=!!e;else return this._private.panningEnabled;return this},userPanningEnabled:function(e){if(e!==void 0)this._private.userPanningEnabled=!!e;else return this._private.userPanningEnabled;return this},zoomingEnabled:function(e){if(e!==void 0)this._private.zoomingEnabled=!!e;else return this._private.zoomingEnabled;return this},userZoomingEnabled:function(e){if(e!==void 0)this._private.userZoomingEnabled=!!e;else return this._private.userZoomingEnabled;return this},boxSelectionEnabled:function(e){if(e!==void 0)this._private.boxSelectionEnabled=!!e;else return this._private.boxSelectionEnabled;return this},pan:function(){var e=arguments,r=this._private.pan,n,i,a,s,o;switch(e.length){case 0:return r;case 1:if(Wt(e[0]))return n=e[0],r[n];if(Ir(e[0])){if(!this._private.panningEnabled)return this;a=e[0],s=a.x,o=a.y,gt(s)&&(r.x=s),gt(o)&&(r.y=o),this.emit("pan viewport")}break;case 2:if(!this._private.panningEnabled)return this;n=e[0],i=e[1],(n==="x"||n==="y")&&gt(i)&&(r[n]=i),this.emit("pan viewport");break}return this.notify("viewport"),this},panBy:function(e,r){var n=arguments,i=this._private.pan,a,s,o,l,u;if(!this._private.panningEnabled)return this;switch(n.length){case 1:Ir(e)&&(o=n[0],l=o.x,u=o.y,gt(l)&&(i.x+=l),gt(u)&&(i.y+=u),this.emit("pan viewport"));break;case 2:a=e,s=r,(a==="x"||a==="y")&&gt(s)&&(i[a]+=s),this.emit("pan viewport");break}return this.notify("viewport"),this},gc:function(){this.notify("gc")},fit:function(e,r){var n=this.getFitViewport(e,r);if(n){var i=this._private;i.zoom=n.zoom,i.pan=n.pan,this.emit("pan zoom viewport"),this.notify("viewport")}return this},getFitViewport:function(e,r){if(gt(e)&&r===void 0&&(r=e,e=void 0),!(!this._private.panningEnabled||!this._private.zoomingEnabled)){var n;if(Wt(e)){var i=e;e=this.$(i)}else if(xF(e)){var a=e;n={x1:a.x1,y1:a.y1,x2:a.x2,y2:a.y2},n.w=n.x2-n.x1,n.h=n.y2-n.y1}else uo(e)||(e=this.mutableElements());if(!(uo(e)&&e.empty())){n=n||e.boundingBox();var s=this.width(),o=this.height(),l;if(r=gt(r)?r:0,!isNaN(s)&&!isNaN(o)&&s>0&&o>0&&!isNaN(n.w)&&!isNaN(n.h)&&n.w>0&&n.h>0){l=Math.min((s-2*r)/n.w,(o-2*r)/n.h),l=l>this._private.maxZoom?this._private.maxZoom:l,l=l<this._private.minZoom?this._private.minZoom:l;var u={x:(s-l*(n.x1+n.x2))/2,y:(o-l*(n.y1+n.y2))/2};return{zoom:l,pan:u}}}}},zoomRange:function(e,r){var n=this._private;if(r==null){var i=e;e=i.min,r=i.max}return gt(e)&&gt(r)&&e<=r?(n.minZoom=e,n.maxZoom=r):gt(e)&&r===void 0&&e<=n.maxZoom?n.minZoom=e:gt(r)&&e===void 0&&r>=n.minZoom&&(n.maxZoom=r),this},minZoom:function(e){return e===void 0?this._private.minZoom:this.zoomRange({min:e})},maxZoom:function(e){return e===void 0?this._private.maxZoom:this.zoomRange({max:e})},getZoomedViewport:function(e){var r=this._private,n=r.pan,i=r.zoom,a,s,o=!1;if(r.zoomingEnabled||(o=!0),gt(e)?s=e:Ir(e)&&(s=e.level,e.position!=null?a=E1(e.position,i,n):e.renderedPosition!=null&&(a=e.renderedPosition),a!=null&&!r.panningEnabled&&(o=!0)),s=s>r.maxZoom?r.maxZoom:s,s=s<r.minZoom?r.minZoom:s,o||!gt(s)||s===i||a!=null&&(!gt(a.x)||!gt(a.y)))return null;if(a!=null){var l=n,u=i,c=s,f={x:-c/u*(a.x-l.x)+a.x,y:-c/u*(a.y-l.y)+a.y};return{zoomed:!0,panned:!0,zoom:c,pan:f}}else return{zoomed:!0,panned:!1,zoom:s,pan:n}},zoom:function(e){if(e===void 0)return this._private.zoom;var r=this.getZoomedViewport(e),n=this._private;return r==null||!r.zoomed?this:(n.zoom=r.zoom,r.panned&&(n.pan.x=r.pan.x,n.pan.y=r.pan.y),this.emit("zoom"+(r.panned?" pan":"")+" viewport"),this.notify("viewport"),this)},viewport:function(e){var r=this._private,n=!0,i=!0,a=[],s=!1,o=!1;if(!e)return this;if(gt(e.zoom)||(n=!1),Ir(e.pan)||(i=!1),!n&&!i)return this;if(n){var l=e.zoom;l<r.minZoom||l>r.maxZoom||!r.zoomingEnabled?s=!0:(r.zoom=l,a.push("zoom"))}if(i&&(!s||!e.cancelOnFailedZoom)&&r.panningEnabled){var u=e.pan;gt(u.x)&&(r.pan.x=u.x,o=!1),gt(u.y)&&(r.pan.y=u.y,o=!1),o||a.push("pan")}return a.length>0&&(a.push("viewport"),this.emit(a.join(" ")),this.notify("viewport")),this},center:function(e){var r=this.getCenterPan(e);return r&&(this._private.pan=r,this.emit("pan viewport"),this.notify("viewport")),this},getCenterPan:function(e,r){if(this._private.panningEnabled){if(Wt(e)){var n=e;e=this.mutableElements().filter(n)}else uo(e)||(e=this.mutableElements());if(e.length!==0){var i=e.boundingBox(),a=this.width(),s=this.height();r=r===void 0?this._private.zoom:r;var o={x:(a-r*(i.x1+i.x2))/2,y:(s-r*(i.y1+i.y2))/2};return o}}},reset:function(){return!this._private.panningEnabled||!this._private.zoomingEnabled?this:(this.viewport({pan:{x:0,y:0},zoom:1}),this)},invalidateSize:function(){this._private.sizeCache=null},size:function(){var e=this._private,r=e.container,n=this;return e.sizeCache=e.sizeCache||(r?(function(){var i=n.window().getComputedStyle(r),a=function(o){return parseFloat(i.getPropertyValue(o))};return{width:r.clientWidth-a("padding-left")-a("padding-right"),height:r.clientHeight-a("padding-top")-a("padding-bottom")}})():{width:1,height:1})},width:function(){return this.size().width},height:function(){return this.size().height},extent:function(){var e=this._private.pan,r=this._private.zoom,n=this.renderedExtent(),i={x1:(n.x1-e.x)/r,x2:(n.x2-e.x)/r,y1:(n.y1-e.y)/r,y2:(n.y2-e.y)/r};return i.w=i.x2-i.x1,i.h=i.y2-i.y1,i},renderedExtent:function(){var e=this.width(),r=this.height();return{x1:0,y1:0,x2:e,y2:r,w:e,h:r}},multiClickDebounceTime:function(e){if(e)this._private.multiClickDebounceTime=e;else return this._private.multiClickDebounceTime;return this}};bh.centre=bh.center;bh.autolockNodes=bh.autolock;bh.autoungrabifyNodes=bh.autoungrabify;var Pv={data:Zr.data({field:"data",bindingEvent:"data",allowBinding:!0,allowSetting:!0,settingEvent:"data",settingTriggersEvent:!0,triggerFnName:"trigger",allowGetting:!0,updateStyle:!0}),removeData:Zr.removeData({field:"data",event:"data",triggerFnName:"trigger",triggerEvent:!0,updateStyle:!0}),scratch:Zr.data({field:"scratch",bindingEvent:"scratch",allowBinding:!0,allowSetting:!0,settingEvent:"scratch",settingTriggersEvent:!0,triggerFnName:"trigger",allowGetting:!0,updateStyle:!0}),removeScratch:Zr.removeData({field:"scratch",event:"scratch",triggerFnName:"trigger",triggerEvent:!0,updateStyle:!0})};Pv.attr=Pv.data;Pv.removeAttr=Pv.removeData;var Mv=function(e){var r=this;e=Jt({},e);var n=e.container;n&&!ux(n)&&ux(n[0])&&(n=n[0]);var i=n?n._cyreg:null;i=i||{},i&&i.cy&&(i.cy.destroy(),i={});var a=i.readies=i.readies||[];n&&(n._cyreg=i),i.cy=r;var s=Ui!==void 0&&n!==void 0&&!e.headless,o=e;o.layout=Jt({name:s?"grid":"null"},o.layout),o.renderer=Jt({name:s?"canvas":"null"},o.renderer);var l=function(y,S,w){return S!==void 0?S:w!==void 0?w:y},u=this._private={container:n,ready:!1,options:o,elements:new Fa(this),listeners:[],aniEles:new Fa(this),data:o.data||{},scratch:{},layout:null,renderer:null,destroyed:!1,notificationsEnabled:!0,minZoom:1e-50,maxZoom:1e50,zoomingEnabled:l(!0,o.zoomingEnabled),userZoomingEnabled:l(!0,o.userZoomingEnabled),panningEnabled:l(!0,o.panningEnabled),userPanningEnabled:l(!0,o.userPanningEnabled),boxSelectionEnabled:l(!0,o.boxSelectionEnabled),autolock:l(!1,o.autolock,o.autolockNodes),autoungrabify:l(!1,o.autoungrabify,o.autoungrabifyNodes),autounselectify:l(!1,o.autounselectify),styleEnabled:o.styleEnabled===void 0?s:o.styleEnabled,zoom:gt(o.zoom)?o.zoom:1,pan:{x:Ir(o.pan)&&gt(o.pan.x)?o.pan.x:0,y:Ir(o.pan)&&gt(o.pan.y)?o.pan.y:0},animation:{current:[],queue:[]},hasCompoundNodes:!1,multiClickDebounceTime:l(250,o.multiClickDebounceTime)};this.createEmitter(),this.selectionType(o.selectionType),this.zoomRange({min:o.minZoom,max:o.maxZoom});var c=function(y,S){var w=y.some(bF);if(w)return hm.all(y).then(S);S(y)};u.styleEnabled&&r.setStyle([]);var f=Jt({},o,o.renderer);r.initRenderer(f);var p=function(y,S,w){r.notifications(!1);var T=r.mutableElements();T.length>0&&T.remove(),y!=null&&(Ir(y)||pn(y))&&r.add(y),r.one("layoutready",function(C){r.notifications(!0),r.emit(C),r.one("load",S),r.emitAndNotify("load")}).one("layoutstop",function(){r.one("done",w),r.emit("done")});var _=Jt({},r._private.options.layout);_.eles=r.elements(),r.layout(_).run()};c([o.style,o.elements],function(v){var y=v[0],S=v[1];u.styleEnabled&&r.style().append(y),p(S,function(){r.startAnimationLoop(),u.ready=!0,Kn(o.ready)&&r.on("ready",o.ready);for(var w=0;w<a.length;w++){var T=a[w];r.on("ready",T)}i&&(i.readies=[]),r.emit("ready")},o.done)})},gx=Mv.prototype;Jt(gx,{instanceString:function(){return"core"},isReady:function(){return this._private.ready},destroyed:function(){return this._private.destroyed},ready:function(e){return this.isReady()?this.emitter().emit("ready",[],e):this.on("ready",e),this},destroy:function(){var e=this;if(!e.destroyed())return e.stopAnimationLoop(),e.destroyRenderer(),this.emit("destroy"),e._private.destroyed=!0,e},hasElementWithId:function(e){return this._private.elements.hasElementWithId(e)},getElementById:function(e){return this._private.elements.getElementById(e)},hasCompoundNodes:function(){return this._private.hasCompoundNodes},headless:function(){return this._private.renderer.isHeadless()},styleEnabled:function(){return this._private.styleEnabled},addToPool:function(e){return this._private.elements.merge(e),this},removeFromPool:function(e){return this._private.elements.unmerge(e),this},container:function(){return this._private.container||null},window:function(){var e=this._private.container;if(e==null)return Ui;var r=this._private.container.ownerDocument;return r===void 0||r==null?Ui:r.defaultView||Ui},mount:function(e){if(e!=null){var r=this,n=r._private,i=n.options;return!ux(e)&&ux(e[0])&&(e=e[0]),r.stopAnimationLoop(),r.destroyRenderer(),n.container=e,n.styleEnabled=!0,r.invalidateSize(),r.initRenderer(Jt({},i,i.renderer,{name:i.renderer.name==="null"?"canvas":i.renderer.name})),r.startAnimationLoop(),r.style(i.style),r.emit("mount"),r}},unmount:function(){var e=this;return e.stopAnimationLoop(),e.destroyRenderer(),e.initRenderer({name:"null"}),e.emit("unmount"),e},options:function(){return bu(this._private.options)},json:function(e){var r=this,n=r._private,i=r.mutableElements(),a=function(N){return r.getElementById(N.id())};if(Ir(e)){if(r.startBatch(),e.elements){var s={},o=function(N,A){for(var O=[],j=[],D=0;D<N.length;D++){var F=N[D];if(!F.data.id){Yr("cy.json() cannot handle elements without an ID attribute");continue}var B=""+F.data.id,$=r.getElementById(B);s[B]=!0,$.length!==0?j.push({ele:$,json:F}):(A&&(F.group=A),O.push(F))}r.add(O);for(var Z=0;Z<j.length;Z++){var I=j[Z],q=I.ele,U=I.json;q.json(U)}};if(pn(e.elements))o(e.elements);else for(var l=["nodes","edges"],u=0;u<l.length;u++){var c=l[u],f=e.elements[c];pn(f)&&o(f,c)}var p=r.collection();i.filter(function(C){return!s[C.id()]}).forEach(function(C){C.isParent()?p.merge(C):C.remove()}),p.forEach(function(C){return C.children().move({parent:null})}),p.forEach(function(C){return a(C).remove()})}e.style&&r.style(e.style),e.zoom!=null&&e.zoom!==n.zoom&&r.zoom(e.zoom),e.pan&&(e.pan.x!==n.pan.x||e.pan.y!==n.pan.y)&&r.pan(e.pan),e.data&&r.data(e.data);for(var v=["minZoom","maxZoom","zoomingEnabled","userZoomingEnabled","panningEnabled","userPanningEnabled","boxSelectionEnabled","autolock","autoungrabify","autounselectify","multiClickDebounceTime"],y=0;y<v.length;y++){var S=v[y];e[S]!=null&&r[S](e[S])}return r.endBatch(),this}else{var w=!!e,T={};w?T.elements=this.elements().map(function(C){return C.json()}):(T.elements={},i.forEach(function(C){var N=C.group();T.elements[N]||(T.elements[N]=[]),T.elements[N].push(C.json())})),this._private.styleEnabled&&(T.style=r.style().json()),T.data=bu(r.data());var _=n.options;return T.zoomingEnabled=n.zoomingEnabled,T.userZoomingEnabled=n.userZoomingEnabled,T.zoom=n.zoom,T.minZoom=n.minZoom,T.maxZoom=n.maxZoom,T.panningEnabled=n.panningEnabled,T.userPanningEnabled=n.userPanningEnabled,T.pan=bu(n.pan),T.boxSelectionEnabled=n.boxSelectionEnabled,T.renderer=bu(_.renderer),T.hideEdgesOnViewport=_.hideEdgesOnViewport,T.textureOnViewport=_.textureOnViewport,T.wheelSensitivity=_.wheelSensitivity,T.motionBlur=_.motionBlur,T.multiClickDebounceTime=_.multiClickDebounceTime,T}}});gx.$id=gx.getElementById;[bz,Cz,YA,KS,Wy,Tz,ZS,qy,Mz,bh,Pv].forEach(function(t){Jt(gx,t)});var Lz={fit:!0,directed:!1,direction:"downward",padding:30,circle:!1,grid:!1,spacingFactor:1.75,boundingBox:void 0,avoidOverlap:!0,nodeDimensionsIncludeLabels:!1,roots:void 0,depthSort:void 0,animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function(e,r){return!0},ready:void 0,stop:void 0,transform:function(e,r){return r}},Rz={maximal:!1,acyclic:!1},yp=function(e){return e.scratch("breadthfirst")},VN=function(e,r){return e.scratch("breadthfirst",r)};function XA(t){this.options=Jt({},Lz,Rz,t)}XA.prototype.run=function(){var t=this.options,e=t.cy,r=t.eles,n=r.nodes().filter(function(je){return je.isChildless()}),i=r,a=t.directed,s=t.acyclic||t.maximal||t.maximalAdjustments>0,o=!!t.boundingBox,l=_s(o?t.boundingBox:structuredClone(e.extent())),u;if(uo(t.roots))u=t.roots;else if(pn(t.roots)){for(var c=[],f=0;f<t.roots.length;f++){var p=t.roots[f],v=e.getElementById(p);c.push(v)}u=e.collection(c)}else if(Wt(t.roots))u=e.$(t.roots);else if(a)u=n.roots();else{var y=r.components();u=e.collection();for(var S=function(){var Re=y[w],nt=Re.maxDegree(!1),Ce=Re.filter(function(Fe){return Fe.degree(!1)===nt});u=u.add(Ce)},w=0;w<y.length;w++)S()}var T=[],_={},C=function(Re,nt){T[nt]==null&&(T[nt]=[]);var Ce=T[nt].length;T[nt].push(Re),VN(Re,{index:Ce,depth:nt})},N=function(Re,nt){var Ce=yp(Re),Fe=Ce.depth,Ke=Ce.index;T[Fe][Ke]=null,Re.isChildless()&&C(Re,nt)};i.bfs({roots:u,directed:t.directed,visit:function(Re,nt,Ce,Fe,Ke){var pt=Re[0],vt=pt.id();pt.isChildless()&&C(pt,Ke),_[vt]=!0}});for(var A=[],O=0;O<n.length;O++){var j=n[O];_[j.id()]||A.push(j)}var D=function(Re){for(var nt=T[Re],Ce=0;Ce<nt.length;Ce++){var Fe=nt[Ce];if(Fe==null){nt.splice(Ce,1),Ce--;continue}VN(Fe,{depth:Re,index:Ce})}},F=function(Re,nt){for(var Ce=yp(Re),Fe=Re.incomers().filter(function(Ct){return Ct.isNode()&&r.has(Ct)}),Ke=-1,pt=Re.id(),vt=0;vt<Fe.length;vt++){var At=Fe[vt],Ut=yp(At);Ke=Math.max(Ke,Ut.depth)}if(Ce.depth<=Ke){if(!t.acyclic&&nt[pt])return null;var nr=Ke+1;return N(Re,nr),nt[pt]=nr,!0}return!1};if(a&&s){var B=[],$={},Z=function(Re){return B.push(Re)},I=function(){return B.shift()};for(n.forEach(function(je){return B.push(je)});B.length>0;){var q=I(),U=F(q,$);if(U)q.outgoers().filter(function(je){return je.isNode()&&r.has(je)}).forEach(Z);else if(U===null){Yr("Detected double maximal shift for node `"+q.id()+"`.  Bailing maximal adjustment due to cycle.  Use `options.maximal: true` only on DAGs.");break}}}var W=0;if(t.avoidOverlap)for(var Y=0;Y<n.length;Y++){var Q=n[Y],ne=Q.layoutDimensions(t),re=ne.w,H=ne.h;W=Math.max(W,re,H)}var te={},ie=function(Re){if(te[Re.id()])return te[Re.id()];for(var nt=yp(Re).depth,Ce=Re.neighborhood(),Fe=0,Ke=0,pt=0;pt<Ce.length;pt++){var vt=Ce[pt];if(!(vt.isEdge()||vt.isParent()||!n.has(vt))){var At=yp(vt);if(At!=null){var Ut=At.index,nr=At.depth;if(!(Ut==null||nr==null)){var Ct=T[nr].length;nr<nt&&(Fe+=Ut/Ct,Ke++)}}}}return Ke=Math.max(1,Ke),Fe=Fe/Ke,Ke===0&&(Fe=0),te[Re.id()]=Fe,Fe},de=function(Re,nt){var Ce=ie(Re),Fe=ie(nt),Ke=Ce-Fe;return Ke===0?QM(Re.id(),nt.id()):Ke};t.depthSort!==void 0&&(de=t.depthSort);for(var ge=T.length,ye=0;ye<ge;ye++)T[ye].sort(de),D(ye);for(var ae=[],pe=0;pe<A.length;pe++)ae.push(A[pe]);var le=function(){for(var Re=0;Re<ge;Re++)D(Re)};ae.length&&(T.unshift(ae),ge=T.length,le());for(var me=0,he=0;he<ge;he++)me=Math.max(T[he].length,me);var xe={x:l.x1+l.w/2,y:l.y1+l.h/2},we=n.reduce(function(je,Re){return(function(nt){return{w:je.w===-1?nt.w:(je.w+nt.w)/2,h:je.h===-1?nt.h:(je.h+nt.h)/2}})(Re.boundingBox({includeLabels:t.nodeDimensionsIncludeLabels}))},{w:-1,h:-1}),Ge=Math.max(ge===1?0:o?(l.h-t.padding*2-we.h)/(ge-1):(l.h-t.padding*2-we.h)/(ge+1),W),qe=T.reduce(function(je,Re){return Math.max(je,Re.length)},0),wt=function(Re){var nt=yp(Re),Ce=nt.depth,Fe=nt.index;if(t.circle){var Ke=Math.min(l.w/2/ge,l.h/2/ge);Ke=Math.max(Ke,W);var pt=Ke*Ce+Ke-(ge>0&&T[0].length<=3?Ke/2:0),vt=2*Math.PI/T[Ce].length*Fe;return Ce===0&&T[0].length===1&&(pt=1),{x:xe.x+pt*Math.cos(vt),y:xe.y+pt*Math.sin(vt)}}else{var At=T[Ce].length,Ut=Math.max(At===1?0:o?(l.w-t.padding*2-we.w)/((t.grid?qe:At)-1):(l.w-t.padding*2-we.w)/((t.grid?qe:At)+1),W),nr={x:xe.x+(Fe+1-(At+1)/2)*Ut,y:xe.y+(Ce+1-(ge+1)/2)*Ge};return nr}},et={downward:0,leftward:90,upward:180,rightward:-90};Object.keys(et).indexOf(t.direction)===-1&&Gn("Invalid direction '".concat(t.direction,"' specified for breadthfirst layout. Valid values are: ").concat(Object.keys(et).join(", ")));var at=function(Re){return ZF(wt(Re),l,et[t.direction])};return r.nodes().layoutPositions(this,t,at),this};var Oz={fit:!0,padding:30,boundingBox:void 0,avoidOverlap:!0,nodeDimensionsIncludeLabels:!1,spacingFactor:void 0,radius:void 0,startAngle:3/2*Math.PI,sweep:void 0,clockwise:!0,sort:void 0,animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function(e,r){return!0},ready:void 0,stop:void 0,transform:function(e,r){return r}};function QA(t){this.options=Jt({},Oz,t)}QA.prototype.run=function(){var t=this.options,e=t,r=t.cy,n=e.eles,i=e.counterclockwise!==void 0?!e.counterclockwise:e.clockwise,a=n.nodes().not(":parent");e.sort&&(a=a.sort(e.sort));for(var s=_s(e.boundingBox?e.boundingBox:{x1:0,y1:0,w:r.width(),h:r.height()}),o={x:s.x1+s.w/2,y:s.y1+s.h/2},l=e.sweep===void 0?2*Math.PI-2*Math.PI/a.length:e.sweep,u=l/Math.max(1,a.length-1),c,f=0,p=0;p<a.length;p++){var v=a[p],y=v.layoutDimensions(e),S=y.w,w=y.h;f=Math.max(f,S,w)}if(gt(e.radius)?c=e.radius:a.length<=1?c=0:c=Math.min(s.h,s.w)/2-f,a.length>1&&e.avoidOverlap){f*=1.75;var T=Math.cos(u)-Math.cos(0),_=Math.sin(u)-Math.sin(0),C=Math.sqrt(f*f/(T*T+_*_));c=Math.max(C,c)}var N=function(O,j){var D=e.startAngle+j*u*(i?1:-1),F=c*Math.cos(D),B=c*Math.sin(D),$={x:o.x+F,y:o.y+B};return $};return n.nodes().layoutPositions(this,e,N),this};var Dz={fit:!0,padding:30,startAngle:3/2*Math.PI,sweep:void 0,clockwise:!0,equidistant:!1,minNodeSpacing:10,boundingBox:void 0,avoidOverlap:!0,nodeDimensionsIncludeLabels:!1,height:void 0,width:void 0,spacingFactor:void 0,concentric:function(e){return e.degree()},levelWidth:function(e){return e.maxDegree()/4},animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function(e,r){return!0},ready:void 0,stop:void 0,transform:function(e,r){return r}};function JA(t){this.options=Jt({},Dz,t)}JA.prototype.run=function(){for(var t=this.options,e=t,r=e.counterclockwise!==void 0?!e.counterclockwise:e.clockwise,n=t.cy,i=e.eles,a=i.nodes().not(":parent"),s=_s(e.boundingBox?e.boundingBox:{x1:0,y1:0,w:n.width(),h:n.height()}),o={x:s.x1+s.w/2,y:s.y1+s.h/2},l=[],u=0,c=0;c<a.length;c++){var f=a[c],p=void 0;p=e.concentric(f),l.push({value:p,node:f}),f._private.scratch.concentric=p}a.updateStyle();for(var v=0;v<a.length;v++){var y=a[v],S=y.layoutDimensions(e);u=Math.max(u,S.w,S.h)}l.sort(function(Ge,qe){return qe.value-Ge.value});for(var w=e.levelWidth(a),T=[[]],_=T[0],C=0;C<l.length;C++){var N=l[C];if(_.length>0){var A=Math.abs(_[0].value-N.value);A>=w&&(_=[],T.push(_))}_.push(N)}var O=u+e.minNodeSpacing;if(!e.avoidOverlap){var j=T.length>0&&T[0].length>1,D=Math.min(s.w,s.h)/2-O,F=D/(T.length+j?1:0);O=Math.min(O,F)}for(var B=0,$=0;$<T.length;$++){var Z=T[$],I=e.sweep===void 0?2*Math.PI-2*Math.PI/Z.length:e.sweep,q=Z.dTheta=I/Math.max(1,Z.length-1);if(Z.length>1&&e.avoidOverlap){var U=Math.cos(q)-Math.cos(0),W=Math.sin(q)-Math.sin(0),Y=Math.sqrt(O*O/(U*U+W*W));B=Math.max(Y,B)}Z.r=B,B+=O}if(e.equidistant){for(var Q=0,ne=0,re=0;re<T.length;re++){var H=T[re],te=H.r-ne;Q=Math.max(Q,te)}ne=0;for(var ie=0;ie<T.length;ie++){var de=T[ie];ie===0&&(ne=de.r),de.r=ne,ne+=Q}}for(var ge={},ye=0;ye<T.length;ye++)for(var ae=T[ye],pe=ae.dTheta,le=ae.r,me=0;me<ae.length;me++){var he=ae[me],xe=e.startAngle+(r?1:-1)*pe*me,we={x:o.x+le*Math.cos(xe),y:o.y+le*Math.sin(xe)};ge[he.node.id()]=we}return i.nodes().layoutPositions(this,e,function(Ge){var qe=Ge.id();return ge[qe]}),this};var p2,Iz={ready:function(){},stop:function(){},animate:!0,animationEasing:void 0,animationDuration:void 0,animateFilter:function(e,r){return!0},animationThreshold:250,refresh:20,fit:!0,padding:30,boundingBox:void 0,nodeDimensionsIncludeLabels:!1,randomize:!1,componentSpacing:40,nodeRepulsion:function(e){return 2048},nodeOverlap:4,idealEdgeLength:function(e){return 32},edgeElasticity:function(e){return 32},nestingFactor:1.2,gravity:1,numIter:1e3,initialTemp:1e3,coolingFactor:.99,minTemp:1};function F1(t){this.options=Jt({},Iz,t),this.options.layout=this;var e=this.options.eles.nodes(),r=this.options.eles.edges(),n=r.filter(function(i){var a=i.source().data("id"),s=i.target().data("id"),o=e.some(function(u){return u.data("id")===a}),l=e.some(function(u){return u.data("id")===s});return!o||!l});this.options.eles=this.options.eles.not(n)}F1.prototype.run=function(){var t=this.options,e=t.cy,r=this;r.stopped=!1,(t.animate===!0||t.animate===!1)&&r.emit({type:"layoutstart",layout:r}),t.debug===!0?p2=!0:p2=!1;var n=jz(e,r,t);p2&&Bz(n),t.randomize&&zz(n);var i=yc(),a=function(){Uz(n,e,t),t.fit===!0&&e.fit(t.padding)},s=function(p){return!(r.stopped||p>=t.numIter||(Gz(n,t),n.temperature=n.temperature*t.coolingFactor,n.temperature<t.minTemp))},o=function(){if(t.animate===!0||t.animate===!1)a(),r.one("layoutstop",t.stop),r.emit({type:"layoutstop",layout:r});else{var p=t.eles.nodes(),v=tL(n,t,p);p.layoutPositions(r,t,v)}},l=0,u=!0;if(t.animate===!0){var c=function(){for(var p=0;u&&p<t.refresh;)u=s(l),l++,p++;if(!u)WN(n,t),o();else{var v=yc();v-i>=t.animationThreshold&&a(),cx(c)}};c()}else{for(;u;)u=s(l),l++;WN(n,t),o()}return this};F1.prototype.stop=function(){return this.stopped=!0,this.thread&&this.thread.stop(),this.emit("layoutstop"),this};F1.prototype.destroy=function(){return this.thread&&this.thread.stop(),this};var jz=function(e,r,n){for(var i=n.eles.edges(),a=n.eles.nodes(),s=_s(n.boundingBox?n.boundingBox:{x1:0,y1:0,w:e.width(),h:e.height()}),o={isCompound:e.hasCompoundNodes(),layoutNodes:[],idToIndex:{},nodeSize:a.size(),graphSet:[],indexToGraph:[],layoutEdges:[],edgeSize:i.size(),temperature:n.initialTemp,clientWidth:s.w,clientHeight:s.h,boundingBox:s},l=n.eles.components(),u={},c=0;c<l.length;c++)for(var f=l[c],p=0;p<f.length;p++){var v=f[p];u[v.id()]=c}for(var c=0;c<o.nodeSize;c++){var y=a[c],S=y.layoutDimensions(n),w={};w.isLocked=y.locked(),w.id=y.data("id"),w.parentId=y.data("parent"),w.cmptId=u[y.id()],w.children=[],w.positionX=y.position("x"),w.positionY=y.position("y"),w.offsetX=0,w.offsetY=0,w.height=S.w,w.width=S.h,w.maxX=w.positionX+w.width/2,w.minX=w.positionX-w.width/2,w.maxY=w.positionY+w.height/2,w.minY=w.positionY-w.height/2,w.padLeft=parseFloat(y.style("padding")),w.padRight=parseFloat(y.style("padding")),w.padTop=parseFloat(y.style("padding")),w.padBottom=parseFloat(y.style("padding")),w.nodeRepulsion=Kn(n.nodeRepulsion)?n.nodeRepulsion(y):n.nodeRepulsion,o.layoutNodes.push(w),o.idToIndex[w.id]=c}for(var T=[],_=0,C=-1,N=[],c=0;c<o.nodeSize;c++){var y=o.layoutNodes[c],A=y.parentId;A!=null?o.layoutNodes[o.idToIndex[A]].children.push(y.id):(T[++C]=y.id,N.push(y.id))}for(o.graphSet.push(N);_<=C;){var O=T[_++],j=o.idToIndex[O],v=o.layoutNodes[j],D=v.children;if(D.length>0){o.graphSet.push(D);for(var c=0;c<D.length;c++)T[++C]=D[c]}}for(var c=0;c<o.graphSet.length;c++)for(var F=o.graphSet[c],p=0;p<F.length;p++){var B=o.idToIndex[F[p]];o.indexToGraph[B]=c}for(var c=0;c<o.edgeSize;c++){var $=i[c],Z={};Z.id=$.data("id"),Z.sourceId=$.data("source"),Z.targetId=$.data("target");var I=Kn(n.idealEdgeLength)?n.idealEdgeLength($):n.idealEdgeLength,q=Kn(n.edgeElasticity)?n.edgeElasticity($):n.edgeElasticity,U=o.idToIndex[Z.sourceId],W=o.idToIndex[Z.targetId],Y=o.indexToGraph[U],Q=o.indexToGraph[W];if(Y!=Q){for(var ne=Fz(Z.sourceId,Z.targetId,o),re=o.graphSet[ne],H=0,w=o.layoutNodes[U];re.indexOf(w.id)===-1;)w=o.layoutNodes[o.idToIndex[w.parentId]],H++;for(w=o.layoutNodes[W];re.indexOf(w.id)===-1;)w=o.layoutNodes[o.idToIndex[w.parentId]],H++;I*=H*n.nestingFactor}Z.idealLength=I,Z.elasticity=q,o.layoutEdges.push(Z)}return o},Fz=function(e,r,n){var i=eL(e,r,0,n);return 2>i.count?0:i.graph},eL=function(e,r,n,i){var a=i.graphSet[n];if(-1<a.indexOf(e)&&-1<a.indexOf(r))return{count:2,graph:n};for(var s=0,o=0;o<a.length;o++){var l=a[o],u=i.idToIndex[l],c=i.layoutNodes[u].children;if(c.length!==0){var f=i.indexToGraph[i.idToIndex[c[0]]],p=eL(e,r,f,i);if(p.count!==0)if(p.count===1){if(s++,s===2)break}else return p}}return{count:s,graph:n}},Bz,zz=function(e,r){for(var n=e.clientWidth,i=e.clientHeight,a=0;a<e.nodeSize;a++){var s=e.layoutNodes[a];s.children.length===0&&!s.isLocked&&(s.positionX=Math.random()*n,s.positionY=Math.random()*i)}},tL=function(e,r,n){var i=e.boundingBox,a={x1:1/0,x2:-1/0,y1:1/0,y2:-1/0};return r.boundingBox&&(n.forEach(function(s){var o=e.layoutNodes[e.idToIndex[s.data("id")]];a.x1=Math.min(a.x1,o.positionX),a.x2=Math.max(a.x2,o.positionX),a.y1=Math.min(a.y1,o.positionY),a.y2=Math.max(a.y2,o.positionY)}),a.w=a.x2-a.x1,a.h=a.y2-a.y1),function(s,o){var l=e.layoutNodes[e.idToIndex[s.data("id")]];if(r.boundingBox){var u=a.w===0?.5:(l.positionX-a.x1)/a.w,c=a.h===0?.5:(l.positionY-a.y1)/a.h;return{x:i.x1+u*i.w,y:i.y1+c*i.h}}else return{x:l.positionX,y:l.positionY}}},Uz=function(e,r,n){var i=n.layout,a=n.eles.nodes(),s=tL(e,n,a);a.positions(s),e.ready!==!0&&(e.ready=!0,i.one("layoutready",n.ready),i.emit({type:"layoutready",layout:this}))},Gz=function(e,r,n){Vz(e,r),qz(e),$z(e,r),Kz(e),Zz(e)},Vz=function(e,r){for(var n=0;n<e.graphSet.length;n++)for(var i=e.graphSet[n],a=i.length,s=0;s<a;s++)for(var o=e.layoutNodes[e.idToIndex[i[s]]],l=s+1;l<a;l++){var u=e.layoutNodes[e.idToIndex[i[l]]];Hz(o,u,e,r)}},HN=function(e){return-1+2*e*Math.random()},Hz=function(e,r,n,i){var a=e.cmptId,s=r.cmptId;if(!(a!==s&&!n.isCompound)){var o=r.positionX-e.positionX,l=r.positionY-e.positionY,u=1;o===0&&l===0&&(o=HN(u),l=HN(u));var c=Wz(e,r,o,l);if(c>0)var f=i.nodeOverlap*c,p=Math.sqrt(o*o+l*l),v=f*o/p,y=f*l/p;else var S=vx(e,o,l),w=vx(r,-1*o,-1*l),T=w.x-S.x,_=w.y-S.y,C=T*T+_*_,p=Math.sqrt(C),f=(e.nodeRepulsion+r.nodeRepulsion)/C,v=f*T/p,y=f*_/p;e.isLocked||(e.offsetX-=v,e.offsetY-=y),r.isLocked||(r.offsetX+=v,r.offsetY+=y)}},Wz=function(e,r,n,i){if(n>0)var a=e.maxX-r.minX;else var a=r.maxX-e.minX;if(i>0)var s=e.maxY-r.minY;else var s=r.maxY-e.minY;return a>=0&&s>=0?Math.sqrt(a*a+s*s):0},vx=function(e,r,n){var i=e.positionX,a=e.positionY,s=e.height||1,o=e.width||1,l=n/r,u=s/o,c={};return r===0&&0<n||r===0&&0>n?(c.x=i,c.y=a+s/2,c):0<r&&-1*u<=l&&l<=u?(c.x=i+o/2,c.y=a+o*n/2/r,c):0>r&&-1*u<=l&&l<=u?(c.x=i-o/2,c.y=a-o*n/2/r,c):0<n&&(l<=-1*u||l>=u)?(c.x=i+s*r/2/n,c.y=a+s/2,c):(0>n&&(l<=-1*u||l>=u)&&(c.x=i-s*r/2/n,c.y=a-s/2),c)},qz=function(e,r){for(var n=0;n<e.edgeSize;n++){var i=e.layoutEdges[n],a=e.idToIndex[i.sourceId],s=e.layoutNodes[a],o=e.idToIndex[i.targetId],l=e.layoutNodes[o],u=l.positionX-s.positionX,c=l.positionY-s.positionY;if(!(u===0&&c===0)){var f=vx(s,u,c),p=vx(l,-1*u,-1*c),v=p.x-f.x,y=p.y-f.y,S=Math.sqrt(v*v+y*y),w=Math.pow(i.idealLength-S,2)/i.elasticity;if(S!==0)var T=w*v/S,_=w*y/S;else var T=0,_=0;s.isLocked||(s.offsetX+=T,s.offsetY+=_),l.isLocked||(l.offsetX-=T,l.offsetY-=_)}}},$z=function(e,r){if(r.gravity!==0)for(var n=1,i=0;i<e.graphSet.length;i++){var a=e.graphSet[i],s=a.length;if(i===0)var o=e.clientHeight/2,l=e.clientWidth/2;else var u=e.layoutNodes[e.idToIndex[a[0]]],c=e.layoutNodes[e.idToIndex[u.parentId]],o=c.positionX,l=c.positionY;for(var f=0;f<s;f++){var p=e.layoutNodes[e.idToIndex[a[f]]];if(!p.isLocked){var v=o-p.positionX,y=l-p.positionY,S=Math.sqrt(v*v+y*y);if(S>n){var w=r.gravity*v/S,T=r.gravity*y/S;p.offsetX+=w,p.offsetY+=T}}}}},Kz=function(e,r){var n=[],i=0,a=-1;for(n.push.apply(n,e.graphSet[0]),a+=e.graphSet[0].length;i<=a;){var s=n[i++],o=e.idToIndex[s],l=e.layoutNodes[o],u=l.children;if(0<u.length&&!l.isLocked){for(var c=l.offsetX,f=l.offsetY,p=0;p<u.length;p++){var v=e.layoutNodes[e.idToIndex[u[p]]];v.offsetX+=c,v.offsetY+=f,n[++a]=u[p]}l.offsetX=0,l.offsetY=0}}},Zz=function(e,r){for(var n=0;n<e.nodeSize;n++){var i=e.layoutNodes[n];0<i.children.length&&(i.maxX=void 0,i.minX=void 0,i.maxY=void 0,i.minY=void 0)}for(var n=0;n<e.nodeSize;n++){var i=e.layoutNodes[n];if(!(0<i.children.length||i.isLocked)){var a=Yz(i.offsetX,i.offsetY,e.temperature);i.positionX+=a.x,i.positionY+=a.y,i.offsetX=0,i.offsetY=0,i.minX=i.positionX-i.width,i.maxX=i.positionX+i.width,i.minY=i.positionY-i.height,i.maxY=i.positionY+i.height,rL(i,e)}}for(var n=0;n<e.nodeSize;n++){var i=e.layoutNodes[n];0<i.children.length&&!i.isLocked&&(i.positionX=(i.maxX+i.minX)/2,i.positionY=(i.maxY+i.minY)/2,i.width=i.maxX-i.minX,i.height=i.maxY-i.minY)}},Yz=function(e,r,n){var i=Math.sqrt(e*e+r*r);if(i>n)var a={x:n*e/i,y:n*r/i};else var a={x:e,y:r};return a},rL=function(e,r){var n=e.parentId;if(n!=null){var i=r.layoutNodes[r.idToIndex[n]],a=!1;if((i.maxX==null||e.maxX+i.padRight>i.maxX)&&(i.maxX=e.maxX+i.padRight,a=!0),(i.minX==null||e.minX-i.padLeft<i.minX)&&(i.minX=e.minX-i.padLeft,a=!0),(i.maxY==null||e.maxY+i.padBottom>i.maxY)&&(i.maxY=e.maxY+i.padBottom,a=!0),(i.minY==null||e.minY-i.padTop<i.minY)&&(i.minY=e.minY-i.padTop,a=!0),a)return rL(i,r)}},WN=function(e,r){for(var n=e.layoutNodes,i=[],a=0;a<n.length;a++){var s=n[a],o=s.cmptId,l=i[o]=i[o]||[];l.push(s)}for(var u=0,a=0;a<i.length;a++){var c=i[a];if(c){c.x1=1/0,c.x2=-1/0,c.y1=1/0,c.y2=-1/0;for(var f=0;f<c.length;f++){var p=c[f];c.x1=Math.min(c.x1,p.positionX-p.width/2),c.x2=Math.max(c.x2,p.positionX+p.width/2),c.y1=Math.min(c.y1,p.positionY-p.height/2),c.y2=Math.max(c.y2,p.positionY+p.height/2)}c.w=c.x2-c.x1,c.h=c.y2-c.y1,u+=c.w*c.h}}i.sort(function(_,C){return C.w*C.h-_.w*_.h});for(var v=0,y=0,S=0,w=0,T=Math.sqrt(u)*e.clientWidth/e.clientHeight,a=0;a<i.length;a++){var c=i[a];if(c){for(var f=0;f<c.length;f++){var p=c[f];p.isLocked||(p.positionX+=v-c.x1,p.positionY+=y-c.y1)}v+=c.w+r.componentSpacing,S+=c.w+r.componentSpacing,w=Math.max(w,c.h),S>T&&(y+=w+r.componentSpacing,v=0,S=0,w=0)}}},Xz={fit:!0,padding:30,boundingBox:void 0,avoidOverlap:!0,avoidOverlapPadding:10,nodeDimensionsIncludeLabels:!1,spacingFactor:void 0,condense:!1,rows:void 0,cols:void 0,position:function(e){},sort:void 0,animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function(e,r){return!0},ready:void 0,stop:void 0,transform:function(e,r){return r}};function nL(t){this.options=Jt({},Xz,t)}nL.prototype.run=function(){var t=this.options,e=t,r=t.cy,n=e.eles,i=n.nodes().not(":parent");e.sort&&(i=i.sort(e.sort));var a=_s(e.boundingBox?e.boundingBox:{x1:0,y1:0,w:r.width(),h:r.height()});if(a.h===0||a.w===0)n.nodes().layoutPositions(this,e,function(ie){return{x:a.x1,y:a.y1}});else{var s=i.size(),o=Math.sqrt(s*a.h/a.w),l=Math.round(o),u=Math.round(a.w/a.h*o),c=function(de){if(de==null)return Math.min(l,u);var ge=Math.min(l,u);ge==l?l=de:u=de},f=function(de){if(de==null)return Math.max(l,u);var ge=Math.max(l,u);ge==l?l=de:u=de},p=e.rows,v=e.cols!=null?e.cols:e.columns;if(p!=null&&v!=null)l=p,u=v;else if(p!=null&&v==null)l=p,u=Math.ceil(s/l);else if(p==null&&v!=null)u=v,l=Math.ceil(s/u);else if(u*l>s){var y=c(),S=f();(y-1)*S>=s?c(y-1):(S-1)*y>=s&&f(S-1)}else for(;u*l<s;){var w=c(),T=f();(T+1)*w>=s?f(T+1):c(w+1)}var _=a.w/u,C=a.h/l;if(e.condense&&(_=0,C=0),e.avoidOverlap)for(var N=0;N<i.length;N++){var A=i[N],O=A._private.position;(O.x==null||O.y==null)&&(O.x=0,O.y=0);var j=A.layoutDimensions(e),D=e.avoidOverlapPadding,F=j.w+D,B=j.h+D;_=Math.max(_,F),C=Math.max(C,B)}for(var $={},Z=function(de,ge){return!!$["c-"+de+"-"+ge]},I=function(de,ge){$["c-"+de+"-"+ge]=!0},q=0,U=0,W=function(){U++,U>=u&&(U=0,q++)},Y={},Q=0;Q<i.length;Q++){var ne=i[Q],re=e.position(ne);if(re&&(re.row!==void 0||re.col!==void 0)){var H={row:re.row,col:re.col};if(H.col===void 0)for(H.col=0;Z(H.row,H.col);)H.col++;else if(H.row===void 0)for(H.row=0;Z(H.row,H.col);)H.row++;Y[ne.id()]=H,I(H.row,H.col)}}var te=function(de,ge){var ye,ae;if(de.locked()||de.isParent())return!1;var pe=Y[de.id()];if(pe)ye=pe.col*_+_/2+a.x1,ae=pe.row*C+C/2+a.y1;else{for(;Z(q,U);)W();ye=U*_+_/2+a.x1,ae=q*C+C/2+a.y1,I(q,U),W()}return{x:ye,y:ae}};i.layoutPositions(this,e,te)}return this};var Qz={ready:function(){},stop:function(){}};function __(t){this.options=Jt({},Qz,t)}__.prototype.run=function(){var t=this.options,e=t.eles,r=this;return t.cy,r.emit("layoutstart"),e.nodes().positions(function(){return{x:0,y:0}}),r.one("layoutready",t.ready),r.emit("layoutready"),r.one("layoutstop",t.stop),r.emit("layoutstop"),this};__.prototype.stop=function(){return this};var Jz={positions:void 0,zoom:void 0,pan:void 0,fit:!0,padding:30,spacingFactor:void 0,animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function(e,r){return!0},ready:void 0,stop:void 0,transform:function(e,r){return r}};function iL(t){this.options=Jt({},Jz,t)}iL.prototype.run=function(){var t=this.options,e=t.eles,r=e.nodes(),n=Kn(t.positions);function i(a){if(t.positions==null)return w9(a.position());if(n)return t.positions(a);var s=t.positions[a._private.data.id];return s??null}return r.layoutPositions(this,t,function(a,s){var o=i(a);return a.locked()||o==null?!1:o}),this};var eU={fit:!0,padding:30,boundingBox:void 0,animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function(e,r){return!0},ready:void 0,stop:void 0,transform:function(e,r){return r}};function aL(t){this.options=Jt({},eU,t)}aL.prototype.run=function(){var t=this.options,e=t.cy,r=t.eles,n=_s(t.boundingBox?t.boundingBox:{x1:0,y1:0,w:e.width(),h:e.height()}),i=function(s,o){return{x:n.x1+Math.round(Math.random()*n.w),y:n.y1+Math.round(Math.random()*n.h)}};return r.nodes().layoutPositions(this,t,i),this};var tU=[{name:"breadthfirst",impl:XA},{name:"circle",impl:QA},{name:"concentric",impl:JA},{name:"cose",impl:F1},{name:"grid",impl:nL},{name:"null",impl:__},{name:"preset",impl:iL},{name:"random",impl:aL}];function sL(t){this.options=t,this.notifications=0}var qN=function(){},$N=function(){throw new Error("A headless instance can not render images")};sL.prototype={recalculateRenderedStyle:qN,notify:function(){this.notifications++},init:qN,isHeadless:function(){return!0},png:$N,jpg:$N};var C_={};C_.arrowShapeWidth=.3;C_.registerArrowShapes=function(){var t=this.arrowShapes={},e=this,r=function(u,c,f,p,v,y,S){var w=v.x-f/2-S,T=v.x+f/2+S,_=v.y-f/2-S,C=v.y+f/2+S,N=w<=u&&u<=T&&_<=c&&c<=C;return N},n=function(u,c,f,p,v){var y=u*Math.cos(p)-c*Math.sin(p),S=u*Math.sin(p)+c*Math.cos(p),w=y*f,T=S*f,_=w+v.x,C=T+v.y;return{x:_,y:C}},i=function(u,c,f,p){for(var v=[],y=0;y<u.length;y+=2){var S=u[y],w=u[y+1];v.push(n(S,w,c,f,p))}return v},a=function(u){for(var c=[],f=0;f<u.length;f++){var p=u[f];c.push(p.x,p.y)}return c},s=function(u){return u.pstyle("width").pfValue*u.pstyle("arrow-scale").pfValue*2},o=function(u,c){Wt(c)&&(c=t[c]),t[u]=Jt({name:u,points:[-.15,-.3,.15,-.3,.15,.3,-.15,.3],collide:function(p,v,y,S,w,T){var _=a(i(this.points,y+2*T,S,w)),C=Vs(p,v,_);return C},roughCollide:r,draw:function(p,v,y,S){var w=i(this.points,v,y,S);e.arrowShapeImpl("polygon")(p,w)},spacing:function(p){return 0},gap:s},c)};o("none",{collide:dx,roughCollide:dx,draw:c_,spacing:oT,gap:oT}),o("triangle",{points:[-.15,-.3,0,0,.15,-.3]}),o("arrow","triangle"),o("triangle-backcurve",{points:t.triangle.points,controlPoint:[0,-.15],roughCollide:r,draw:function(u,c,f,p,v){var y=i(this.points,c,f,p),S=this.controlPoint,w=n(S[0],S[1],c,f,p);e.arrowShapeImpl(this.name)(u,y,w)},gap:function(u){return s(u)*.8}}),o("triangle-tee",{points:[0,0,.15,-.3,-.15,-.3,0,0],pointsTee:[-.15,-.4,-.15,-.5,.15,-.5,.15,-.4],collide:function(u,c,f,p,v,y,S){var w=a(i(this.points,f+2*S,p,v)),T=a(i(this.pointsTee,f+2*S,p,v)),_=Vs(u,c,w)||Vs(u,c,T);return _},draw:function(u,c,f,p,v){var y=i(this.points,c,f,p),S=i(this.pointsTee,c,f,p);e.arrowShapeImpl(this.name)(u,y,S)}}),o("circle-triangle",{radius:.15,pointsTr:[0,-.15,.15,-.45,-.15,-.45,0,-.15],collide:function(u,c,f,p,v,y,S){var w=v,T=Math.pow(w.x-u,2)+Math.pow(w.y-c,2)<=Math.pow((f+2*S)*this.radius,2),_=a(i(this.points,f+2*S,p,v));return Vs(u,c,_)||T},draw:function(u,c,f,p,v){var y=i(this.pointsTr,c,f,p);e.arrowShapeImpl(this.name)(u,y,p.x,p.y,this.radius*c)},spacing:function(u){return e.getArrowWidth(u.pstyle("width").pfValue,u.pstyle("arrow-scale").value)*this.radius}}),o("triangle-cross",{points:[0,0,.15,-.3,-.15,-.3,0,0],baseCrossLinePts:[-.15,-.4,-.15,-.4,.15,-.4,.15,-.4],crossLinePts:function(u,c){var f=this.baseCrossLinePts.slice(),p=c/u,v=3,y=5;return f[v]=f[v]-p,f[y]=f[y]-p,f},collide:function(u,c,f,p,v,y,S){var w=a(i(this.points,f+2*S,p,v)),T=a(i(this.crossLinePts(f,y),f+2*S,p,v)),_=Vs(u,c,w)||Vs(u,c,T);return _},draw:function(u,c,f,p,v){var y=i(this.points,c,f,p),S=i(this.crossLinePts(c,v),c,f,p);e.arrowShapeImpl(this.name)(u,y,S)}}),o("vee",{points:[-.15,-.3,0,0,.15,-.3,0,-.15],gap:function(u){return s(u)*.525}}),o("circle",{radius:.15,collide:function(u,c,f,p,v,y,S){var w=v,T=Math.pow(w.x-u,2)+Math.pow(w.y-c,2)<=Math.pow((f+2*S)*this.radius,2);return T},draw:function(u,c,f,p,v){e.arrowShapeImpl(this.name)(u,p.x,p.y,this.radius*c)},spacing:function(u){return e.getArrowWidth(u.pstyle("width").pfValue,u.pstyle("arrow-scale").value)*this.radius}}),o("tee",{points:[-.15,0,-.15,-.1,.15,-.1,.15,0],spacing:function(u){return 1},gap:function(u){return 1}}),o("square",{points:[-.15,0,.15,0,.15,-.3,-.15,-.3]}),o("diamond",{points:[-.15,-.15,0,-.3,.15,-.15,0,0],gap:function(u){return u.pstyle("width").pfValue*u.pstyle("arrow-scale").value}}),o("chevron",{points:[0,0,-.15,-.15,-.1,-.2,0,-.1,.1,-.2,.15,-.15],gap:function(u){return .95*u.pstyle("width").pfValue*u.pstyle("arrow-scale").value}})};var Lh={};Lh.projectIntoViewport=function(t,e){var r=this.cy,n=this.findContainerClientCoords(),i=n[0],a=n[1],s=n[4],o=r.pan(),l=r.zoom(),u=((t-i)/s-o.x)/l,c=((e-a)/s-o.y)/l;return[u,c]};Lh.findContainerClientCoords=function(){if(this.containerBB)return this.containerBB;var t=this.container,e=t.getBoundingClientRect(),r=this.cy.window().getComputedStyle(t),n=function(T){return parseFloat(r.getPropertyValue(T))},i={left:n("padding-left"),right:n("padding-right"),top:n("padding-top"),bottom:n("padding-bottom")},a={left:n("border-left-width"),right:n("border-right-width"),top:n("border-top-width"),bottom:n("border-bottom-width")},s=t.clientWidth,o=t.clientHeight,l=i.left+i.right,u=i.top+i.bottom,c=a.left+a.right,f=e.width/(s+c),p=s-l,v=o-u,y=e.left+i.left+a.left,S=e.top+i.top+a.top;return this.containerBB=[y,S,p,v,f]};Lh.invalidateContainerClientCoordsCache=function(){this.containerBB=null};Lh.findNearestElement=function(t,e,r,n){return this.findNearestElements(t,e,r,n)[0]};Lh.findNearestElements=function(t,e,r,n){var i=this,a=this,s=a.getCachedZSortedEles(),o=[],l=a.cy.zoom(),u=a.cy.hasCompoundNodes(),c=(n?24:8)/l,f=(n?8:2)/l,p=(n?8:2)/l,v=1/0,y,S;r&&(s=s.interactive);function w(j,D){if(j.isNode()){if(S)return;S=j,o.push(j)}if(j.isEdge()&&(D==null||D<v))if(y){if(y.pstyle("z-compound-depth").value===j.pstyle("z-compound-depth").value&&y.pstyle("z-compound-depth").value===j.pstyle("z-compound-depth").value){for(var F=0;F<o.length;F++)if(o[F].isEdge()){o[F]=j,y=j,v=D??v;break}}}else o.push(j),y=j,v=D??v}function T(j){var D=j.outerWidth()+2*f,F=j.outerHeight()+2*f,B=D/2,$=F/2,Z=j.position(),I=j.pstyle("corner-radius").value==="auto"?"auto":j.pstyle("corner-radius").pfValue,q=j._private.rscratch;if(Z.x-B<=t&&t<=Z.x+B&&Z.y-$<=e&&e<=Z.y+$){var U=a.nodeShapes[i.getNodeShape(j)];if(U.checkPoint(t,e,0,D,F,Z.x,Z.y,I,q))return w(j,0),!0}}function _(j){var D=j._private,F=D.rscratch,B=j.pstyle("width").pfValue,$=j.pstyle("arrow-scale").value,Z=B/2+c,I=Z*Z,q=Z*2,Q=D.source,ne=D.target,U;if(F.edgeType==="segments"||F.edgeType==="straight"||F.edgeType==="haystack"){for(var W=F.allpts,Y=0;Y+3<W.length;Y+=2)if(D9(t,e,W[Y],W[Y+1],W[Y+2],W[Y+3],q)&&I>(U=z9(t,e,W[Y],W[Y+1],W[Y+2],W[Y+3])))return w(j,U),!0}else if(F.edgeType==="bezier"||F.edgeType==="multibezier"||F.edgeType==="self"||F.edgeType==="compound"){for(var W=F.allpts,Y=0;Y+5<F.allpts.length;Y+=4)if(I9(t,e,W[Y],W[Y+1],W[Y+2],W[Y+3],W[Y+4],W[Y+5],q)&&I>(U=B9(t,e,W[Y],W[Y+1],W[Y+2],W[Y+3],W[Y+4],W[Y+5])))return w(j,U),!0}for(var Q=Q||D.source,ne=ne||D.target,re=i.getArrowWidth(B,$),H=[{name:"source",x:F.arrowStartX,y:F.arrowStartY,angle:F.srcArrowAngle},{name:"target",x:F.arrowEndX,y:F.arrowEndY,angle:F.tgtArrowAngle},{name:"mid-source",x:F.midX,y:F.midY,angle:F.midsrcArrowAngle},{name:"mid-target",x:F.midX,y:F.midY,angle:F.midtgtArrowAngle}],Y=0;Y<H.length;Y++){var te=H[Y],ie=a.arrowShapes[j.pstyle(te.name+"-arrow-shape").value],de=j.pstyle("width").pfValue;if(ie.roughCollide(t,e,re,te.angle,{x:te.x,y:te.y},de,c)&&ie.collide(t,e,re,te.angle,{x:te.x,y:te.y},de,c))return w(j),!0}u&&o.length>0&&(T(Q),T(ne))}function C(j,D,F){return Gs(j,D,F)}function N(j,D){var F=j._private,B=p,$;D?$=D+"-":$="",j.boundingBox();var Z=F.labelBounds[D||"main"],I=j.pstyle($+"label").value,q=j.pstyle("text-events").strValue==="yes";if(!(!q||!I)){var U=C(F.rscratch,"labelX",D),W=C(F.rscratch,"labelY",D),Y=C(F.rscratch,"labelAngle",D),Q=j.pstyle($+"text-margin-x").pfValue,ne=j.pstyle($+"text-margin-y").pfValue,re=Z.x1-B-Q,H=Z.x2+B-Q,te=Z.y1-B-ne,ie=Z.y2+B-ne;if(Y){var de=Math.cos(Y),ge=Math.sin(Y),ye=function(we,Ge){return we=we-U,Ge=Ge-W,{x:we*de-Ge*ge+U,y:we*ge+Ge*de+W}},ae=ye(re,te),pe=ye(re,ie),le=ye(H,te),me=ye(H,ie),he=[ae.x+Q,ae.y+ne,le.x+Q,le.y+ne,me.x+Q,me.y+ne,pe.x+Q,pe.y+ne];if(Vs(t,e,he))return w(j),!0}else if(Id(Z,t,e))return w(j),!0}}for(var A=s.length-1;A>=0;A--){var O=s[A];O.isNode()?T(O)||N(O):_(O)||N(O)||N(O,"source")||N(O,"target")}return o};Lh.getAllInBox=function(t,e,r,n){var i=this.getCachedZSortedEles().interactive,a=this.cy.zoom(),s=2/a,o=[],l=Math.min(t,r),u=Math.max(t,r),c=Math.min(e,n),f=Math.max(e,n);t=l,r=u,e=c,n=f;var p=_s({x1:t,y1:e,x2:r,y2:n}),v=[{x:p.x1,y:p.y1},{x:p.x2,y:p.y1},{x:p.x2,y:p.y2},{x:p.x1,y:p.y2}],y=[[v[0],v[1]],[v[1],v[2]],[v[2],v[3]],[v[3],v[0]]];function S(we,Ge,qe){return Gs(we,Ge,qe)}function w(we,Ge){var qe=we._private,wt=s,et="";we.boundingBox();var at=qe.labelBounds.main;if(!at)return null;var je=S(qe.rscratch,"labelX",Ge),Re=S(qe.rscratch,"labelY",Ge),nt=S(qe.rscratch,"labelAngle",Ge),Ce=we.pstyle(et+"text-margin-x").pfValue,Fe=we.pstyle(et+"text-margin-y").pfValue,Ke=at.x1-wt-Ce,pt=at.x2+wt-Ce,vt=at.y1-wt-Fe,At=at.y2+wt-Fe;if(nt){var Ut=Math.cos(nt),nr=Math.sin(nt),Ct=function(We,ce){return We=We-je,ce=ce-Re,{x:We*Ut-ce*nr+je,y:We*nr+ce*Ut+Re}};return[Ct(Ke,vt),Ct(pt,vt),Ct(pt,At),Ct(Ke,At)]}else return[{x:Ke,y:vt},{x:pt,y:vt},{x:pt,y:At},{x:Ke,y:At}]}function T(we,Ge,qe,wt){function et(at,je,Re){return(Re.y-at.y)*(je.x-at.x)>(je.y-at.y)*(Re.x-at.x)}return et(we,qe,wt)!==et(Ge,qe,wt)&&et(we,Ge,qe)!==et(we,Ge,wt)}for(var _=0;_<i.length;_++){var C=i[_];if(C.isNode()){var N=C,A=N.pstyle("text-events").strValue==="yes",O=N.pstyle("box-selection").strValue,j=N.pstyle("box-select-labels").strValue==="yes";if(O==="none")continue;var D=(O==="overlap"||j)&&A,F=N.boundingBox({includeNodes:!0,includeEdges:!1,includeLabels:D});if(O==="contain"){var B=!1;if(j&&A){var $=w(N);$&&fw($,v)&&(o.push(N),B=!0)}!B&&hA(p,F)&&o.push(N)}else if(O==="overlap"&&p_(p,F)){var Z=N.boundingBox({includeNodes:!0,includeEdges:!0,includeLabels:!1,includeMainLabels:!1,includeSourceLabels:!1,includeTargetLabels:!1}),I=[{x:Z.x1,y:Z.y1},{x:Z.x2,y:Z.y1},{x:Z.x2,y:Z.y2},{x:Z.x1,y:Z.y2}];if(fw(I,v))o.push(N);else{var q=w(N);q&&fw(q,v)&&o.push(N)}}}else{var U=C,W=U._private,Y=W.rscratch,Q=U.pstyle("box-selection").strValue;if(Q==="none")continue;if(Q==="contain"){if(Y.startX!=null&&Y.startY!=null&&!Id(p,Y.startX,Y.startY)||Y.endX!=null&&Y.endY!=null&&!Id(p,Y.endX,Y.endY))continue;if(Y.edgeType==="bezier"||Y.edgeType==="multibezier"||Y.edgeType==="self"||Y.edgeType==="compound"||Y.edgeType==="segments"||Y.edgeType==="haystack"){for(var ne=W.rstyle.bezierPts||W.rstyle.linePts||W.rstyle.haystackPts,re=!0,H=0;H<ne.length;H++)if(!fT(p,ne[H])){re=!1;break}re&&o.push(U)}else Y.edgeType==="straight"&&o.push(U)}else if(Q==="overlap"){var te=!1;if(Y.startX!=null&&Y.startY!=null&&Y.endX!=null&&Y.endY!=null&&(Id(p,Y.startX,Y.startY)||Id(p,Y.endX,Y.endY)))o.push(U),te=!0;else if(!te&&Y.edgeType==="haystack"){for(var ie=W.rstyle.haystackPts,de=0;de<ie.length;de++)if(fT(p,ie[de])){o.push(U),te=!0;break}}if(!te){var ge=W.rstyle.bezierPts||W.rstyle.linePts||W.rstyle.haystackPts;if((!ge||ge.length<2)&&Y.edgeType==="straight"&&Y.startX!=null&&Y.startY!=null&&Y.endX!=null&&Y.endY!=null&&(ge=[{x:Y.startX,y:Y.startY},{x:Y.endX,y:Y.endY}]),!ge||ge.length<2)continue;for(var ye=0;ye<ge.length-1;ye++){for(var ae=ge[ye],pe=ge[ye+1],le=0;le<y.length;le++){var me=Ai(y[le],2),he=me[0],xe=me[1];if(T(ae,pe,he,xe)){o.push(U),te=!0;break}}if(te)break}}}}}return o};var yx={};yx.calculateArrowAngles=function(t){var e=t._private.rscratch,r=e.edgeType==="haystack",n=e.edgeType==="bezier",i=e.edgeType==="multibezier",a=e.edgeType==="segments",s=e.edgeType==="compound",o=e.edgeType==="self",l,u,c,f,p,v,T,_;if(r?(c=e.haystackPts[0],f=e.haystackPts[1],p=e.haystackPts[2],v=e.haystackPts[3]):(c=e.arrowStartX,f=e.arrowStartY,p=e.arrowEndX,v=e.arrowEndY),T=e.midX,_=e.midY,a)l=c-e.segpts[0],u=f-e.segpts[1];else if(i||s||o||n){var y=e.allpts,S=sa(y[0],y[2],y[4],.1),w=sa(y[1],y[3],y[5],.1);l=c-S,u=f-w}else l=c-T,u=f-_;e.srcArrowAngle=ry(l,u);var T=e.midX,_=e.midY;if(r&&(T=(c+p)/2,_=(f+v)/2),l=p-c,u=v-f,a){var y=e.allpts;if(y.length/2%2===0){var C=y.length/2,N=C-2;l=y[C]-y[N],u=y[C+1]-y[N+1]}else if(e.isRound)l=e.midVector[1],u=-e.midVector[0];else{var C=y.length/2-1,N=C-2;l=y[C]-y[N],u=y[C+1]-y[N+1]}}else if(i||s||o){var y=e.allpts,A=e.ctrlpts,O,j,D,F;if(A.length/2%2===0){var B=y.length/2-1,$=B+2,Z=$+2;O=sa(y[B],y[$],y[Z],0),j=sa(y[B+1],y[$+1],y[Z+1],0),D=sa(y[B],y[$],y[Z],1e-4),F=sa(y[B+1],y[$+1],y[Z+1],1e-4)}else{var $=y.length/2-1,B=$-2,Z=$+2;O=sa(y[B],y[$],y[Z],.4999),j=sa(y[B+1],y[$+1],y[Z+1],.4999),D=sa(y[B],y[$],y[Z],.5),F=sa(y[B+1],y[$+1],y[Z+1],.5)}l=D-O,u=F-j}if(e.midtgtArrowAngle=ry(l,u),e.midDispX=l,e.midDispY=u,l*=-1,u*=-1,a){var y=e.allpts;if(y.length/2%2!==0){if(!e.isRound){var C=y.length/2-1,I=C+2;l=-(y[I]-y[C]),u=-(y[I+1]-y[C+1])}}}if(e.midsrcArrowAngle=ry(l,u),a)l=p-e.segpts[e.segpts.length-2],u=v-e.segpts[e.segpts.length-1];else if(i||s||o||n){var y=e.allpts,q=y.length,S=sa(y[q-6],y[q-4],y[q-2],.9),w=sa(y[q-5],y[q-3],y[q-1],.9);l=p-S,u=v-w}else l=p-T,u=v-_;e.tgtArrowAngle=ry(l,u)};yx.getArrowWidth=yx.getArrowHeight=function(t,e){var r=this.arrowWidthCache=this.arrowWidthCache||{},n=r[t+", "+e];return n||(n=Math.max(Math.pow(t*13.37,.9),29)*e,r[t+", "+e]=n,n)};var YS,XS,pu={},jo={},KN,ZN,eh,$y,nc,Wf,Xf,du,xp,cy,oL,lL,QS,JS,YN,XN=function(e,r,n){n.x=r.x-e.x,n.y=r.y-e.y,n.len=Math.sqrt(n.x*n.x+n.y*n.y),n.nx=n.x/n.len,n.ny=n.y/n.len,n.ang=Math.atan2(n.ny,n.nx)},rU=function(e,r){r.x=e.x*-1,r.y=e.y*-1,r.nx=e.nx*-1,r.ny=e.ny*-1,r.ang=e.ang>0?-(Math.PI-e.ang):Math.PI+e.ang},nU=function(e,r,n,i,a){if(e!==YN?XN(r,e,pu):rU(jo,pu),XN(r,n,jo),KN=pu.nx*jo.ny-pu.ny*jo.nx,ZN=pu.nx*jo.nx-pu.ny*-jo.ny,nc=Math.asin(Math.max(-1,Math.min(1,KN))),Math.abs(nc)<1e-6){YS=r.x,XS=r.y,Xf=xp=0;return}eh=1,$y=!1,ZN<0?nc<0?nc=Math.PI+nc:(nc=Math.PI-nc,eh=-1,$y=!0):nc>0&&(eh=-1,$y=!0),r.radius!==void 0?xp=r.radius:xp=i,Wf=nc/2,cy=Math.min(pu.len/2,jo.len/2),a?(du=Math.abs(Math.cos(Wf)*xp/Math.sin(Wf)),du>cy?(du=cy,Xf=Math.abs(du*Math.sin(Wf)/Math.cos(Wf))):Xf=xp):(du=Math.min(cy,xp),Xf=Math.abs(du*Math.sin(Wf)/Math.cos(Wf))),QS=r.x+jo.nx*du,JS=r.y+jo.ny*du,YS=QS-jo.ny*Xf*eh,XS=JS+jo.nx*Xf*eh,oL=r.x+pu.nx*du,lL=r.y+pu.ny*du,YN=r};function uL(t,e){e.radius===0?t.lineTo(e.cx,e.cy):t.arc(e.cx,e.cy,e.radius,e.startAngle,e.endAngle,e.counterClockwise)}function E_(t,e,r,n){var i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0;return n===0||e.radius===0?{cx:e.x,cy:e.y,radius:0,startX:e.x,startY:e.y,stopX:e.x,stopY:e.y,startAngle:void 0,endAngle:void 0,counterClockwise:void 0}:(nU(t,e,r,n,i),{cx:YS,cy:XS,radius:Xf,startX:oL,startY:lL,stopX:QS,stopY:JS,startAngle:pu.ang+Math.PI/2*eh,endAngle:jo.ang-Math.PI/2*eh,counterClockwise:$y})}var Av=.01,iU=Math.sqrt(2*Av),ls={};ls.findMidptPtsEtc=function(t,e){var r=e.posPts,n=e.intersectionPts,i=e.vectorNormInverse,a,s=t.pstyle("source-endpoint"),o=t.pstyle("target-endpoint"),l=s.units!=null&&o.units!=null,u=function(A,O,j,D){var F=D-O,B=j-A,$=Math.sqrt(B*B+F*F);return{x:-F/$,y:B/$}},c=t.pstyle("edge-distances").value;switch(c){case"node-position":a=r;break;case"intersection":a=n;break;case"endpoints":{if(l){var f=this.manualEndptToPx(t.source()[0],s),p=Ai(f,2),v=p[0],y=p[1],S=this.manualEndptToPx(t.target()[0],o),w=Ai(S,2),T=w[0],_=w[1],C={x1:v,y1:y,x2:T,y2:_};i=u(v,y,T,_),a=C}else Yr("Edge ".concat(t.id()," has edge-distances:endpoints specified without manual endpoints specified via source-endpoint and target-endpoint.  Falling back on edge-distances:intersection (default).")),a=n;break}}return{midptPts:a,vectorNormInverse:i}};ls.findHaystackPoints=function(t){for(var e=0;e<t.length;e++){var r=t[e],n=r._private,i=n.rscratch;if(!i.haystack){var a=Math.random()*2*Math.PI;i.source={x:Math.cos(a),y:Math.sin(a)},a=Math.random()*2*Math.PI,i.target={x:Math.cos(a),y:Math.sin(a)}}var s=n.source,o=n.target,l=s.position(),u=o.position(),c=s.width(),f=o.width(),p=s.height(),v=o.height(),y=r.pstyle("haystack-radius").value,S=y/2;i.haystackPts=i.allpts=[i.source.x*c*S+l.x,i.source.y*p*S+l.y,i.target.x*f*S+u.x,i.target.y*v*S+u.y],i.midX=(i.allpts[0]+i.allpts[2])/2,i.midY=(i.allpts[1]+i.allpts[3])/2,i.edgeType="haystack",i.haystack=!0,this.storeEdgeProjections(r),this.calculateArrowAngles(r),this.recalculateEdgeLabelProjections(r),this.calculateLabelAngles(r)}};ls.findSegmentsPoints=function(t,e){var r=t._private.rscratch,n=t.pstyle("segment-weights"),i=t.pstyle("segment-distances"),a=t.pstyle("segment-radii"),s=t.pstyle("radius-type"),o=Math.min(n.pfValue.length,i.pfValue.length),l=a.pfValue[a.pfValue.length-1],u=s.pfValue[s.pfValue.length-1];r.edgeType="segments",r.segpts=[],r.radii=[],r.isArcRadius=[];for(var c=0;c<o;c++){var f=n.pfValue[c],p=i.pfValue[c],v=1-f,y=f,S=this.findMidptPtsEtc(t,e),w=S.midptPts,T=S.vectorNormInverse,_={x:w.x1*v+w.x2*y,y:w.y1*v+w.y2*y};r.segpts.push(_.x+T.x*p,_.y+T.y*p),r.radii.push(a.pfValue[c]!==void 0?a.pfValue[c]:l),r.isArcRadius.push((s.pfValue[c]!==void 0?s.pfValue[c]:u)==="arc-radius")}};ls.findLoopPoints=function(t,e,r,n){var i=t._private.rscratch,a=e.dirCounts,s=e.srcPos,o=t.pstyle("control-point-distances"),l=o?o.pfValue[0]:void 0,u=t.pstyle("loop-direction").pfValue,c=t.pstyle("loop-sweep").pfValue,f=t.pstyle("control-point-step-size").pfValue;i.edgeType="self";var p=r,v=f;n&&(p=0,v=l);var y=u-Math.PI/2,S=y-c/2,w=y+c/2,T=u+"_"+c;p=a[T]===void 0?a[T]=0:++a[T],i.ctrlpts=[s.x+Math.cos(S)*1.4*v*(p/3+1),s.y+Math.sin(S)*1.4*v*(p/3+1),s.x+Math.cos(w)*1.4*v*(p/3+1),s.y+Math.sin(w)*1.4*v*(p/3+1)]};ls.findCompoundLoopPoints=function(t,e,r,n){var i=t._private.rscratch;i.edgeType="compound";var a=e.srcPos,s=e.tgtPos,o=e.srcW,l=e.srcH,u=e.tgtW,c=e.tgtH,f=t.pstyle("control-point-step-size").pfValue,p=t.pstyle("control-point-distances"),v=p?p.pfValue[0]:void 0,y=r,S=f;n&&(y=0,S=v);var w=50,T={x:a.x-o/2,y:a.y-l/2},_={x:s.x-u/2,y:s.y-c/2},C={x:Math.min(T.x,_.x),y:Math.min(T.y,_.y)},N=.5,A=Math.max(N,Math.log(o*Av)),O=Math.max(N,Math.log(u*Av));i.ctrlpts=[C.x,C.y-(1+Math.pow(w,1.12)/100)*S*(y/3+1)*A,C.x-(1+Math.pow(w,1.12)/100)*S*(y/3+1)*O,C.y]};ls.findStraightEdgePoints=function(t){t._private.rscratch.edgeType="straight"};ls.findBezierPoints=function(t,e,r,n,i){var a=t._private.rscratch,s=t.pstyle("control-point-step-size").pfValue,o=t.pstyle("control-point-distances"),l=t.pstyle("control-point-weights"),u=o&&l?Math.min(o.value.length,l.value.length):1,c=o?o.pfValue[0]:void 0,f=l.value[0],p=n;a.edgeType=p?"multibezier":"bezier",a.ctrlpts=[];for(var v=0;v<u;v++){var y=(.5-e.eles.length/2+r)*s*(i?-1:1),S=void 0,w=h_(y);p&&(c=o?o.pfValue[v]:s,f=l.value[v]),n?S=c:S=c!==void 0?w*c:void 0;var T=S!==void 0?S:y,_=1-f,C=f,N=this.findMidptPtsEtc(t,e),A=N.midptPts,O=N.vectorNormInverse,j={x:A.x1*_+A.x2*C,y:A.y1*_+A.y2*C};a.ctrlpts.push(j.x+O.x*T,j.y+O.y*T)}};ls.findTaxiPoints=function(t,e){var r=t._private.rscratch;r.edgeType="segments";var n="vertical",i="horizontal",a="leftward",s="rightward",o="downward",l="upward",u="auto",c=e.posPts,f=e.srcW,p=e.srcH,v=e.tgtW,y=e.tgtH,S=t.pstyle("edge-distances").value,w=S!=="node-position",T=t.pstyle("taxi-direction").value,_=T,C=t.pstyle("taxi-turn"),N=C.units==="%",A=C.pfValue,O=A<0,j=t.pstyle("taxi-turn-min-distance").pfValue,D=w?(f+v)/2:0,F=w?(p+y)/2:0,B=c.x2-c.x1,$=c.y2-c.y1,Z=function(ce,ve){return ce>0?Math.max(ce-ve,0):Math.min(ce+ve,0)},I=Z(B,D),q=Z($,F),U=!1;_===u?T=Math.abs(I)>Math.abs(q)?i:n:_===l||_===o?(T=n,U=!0):(_===a||_===s)&&(T=i,U=!0);var W=T===n,Y=W?q:I,Q=W?$:B,ne=h_(Q),re=!1;!(U&&(N||O))&&(_===o&&Q<0||_===l&&Q>0||_===a&&Q>0||_===s&&Q<0)&&(ne*=-1,Y=ne*Math.abs(Y),re=!0);var H;if(N){var te=A<0?1+A:A;H=te*Y}else{var ie=A<0?Y:0;H=ie+A*ne}var de=function(ce){return Math.abs(ce)<j||Math.abs(ce)>=Math.abs(Y)},ge=de(H),ye=de(Math.abs(Y)-Math.abs(H)),ae=ge||ye;if(ae&&!re)if(W){var pe=Math.abs(Q)<=p/2,le=Math.abs(B)<=v/2;if(pe){var me=(c.x1+c.x2)/2,he=c.y1,xe=c.y2;r.segpts=[me,he,me,xe]}else if(le){var we=(c.y1+c.y2)/2,Ge=c.x1,qe=c.x2;r.segpts=[Ge,we,qe,we]}else r.segpts=[c.x1,c.y2]}else{var wt=Math.abs(Q)<=f/2,et=Math.abs($)<=y/2;if(wt){var at=(c.y1+c.y2)/2,je=c.x1,Re=c.x2;r.segpts=[je,at,Re,at]}else if(et){var nt=(c.x1+c.x2)/2,Ce=c.y1,Fe=c.y2;r.segpts=[nt,Ce,nt,Fe]}else r.segpts=[c.x2,c.y1]}else if(W){var Ke=c.y1+H+(w?p/2*ne:0),pt=c.x1,vt=c.x2;r.segpts=[pt,Ke,vt,Ke]}else{var At=c.x1+H+(w?f/2*ne:0),Ut=c.y1,nr=c.y2;r.segpts=[At,Ut,At,nr]}if(r.isRound){var Ct=t.pstyle("taxi-radius").value,ct=t.pstyle("radius-type").value[0]==="arc-radius";r.radii=new Array(r.segpts.length/2).fill(Ct),r.isArcRadius=new Array(r.segpts.length/2).fill(ct)}};ls.tryToCorrectInvalidPoints=function(t,e){var r=t._private.rscratch;if(r.edgeType==="bezier"){var n=e.srcPos,i=e.tgtPos,a=e.srcW,s=e.srcH,o=e.tgtW,l=e.tgtH,u=e.srcShape,c=e.tgtShape,f=e.srcCornerRadius,p=e.tgtCornerRadius,v=e.srcRs,y=e.tgtRs,S=!gt(r.startX)||!gt(r.startY),w=!gt(r.arrowStartX)||!gt(r.arrowStartY),T=!gt(r.endX)||!gt(r.endY),_=!gt(r.arrowEndX)||!gt(r.arrowEndY),C=3,N=this.getArrowWidth(t.pstyle("width").pfValue,t.pstyle("arrow-scale").value)*this.arrowShapeWidth,A=C*N,O=yh({x:r.ctrlpts[0],y:r.ctrlpts[1]},{x:r.startX,y:r.startY}),j=O<A,D=yh({x:r.ctrlpts[0],y:r.ctrlpts[1]},{x:r.endX,y:r.endY}),F=D<A,B=!1;if(S||w||j){B=!0;var $={x:r.ctrlpts[0]-n.x,y:r.ctrlpts[1]-n.y},Z=Math.sqrt($.x*$.x+$.y*$.y),I={x:$.x/Z,y:$.y/Z},q=Math.max(a,s),U={x:r.ctrlpts[0]+I.x*2*q,y:r.ctrlpts[1]+I.y*2*q},W=u.intersectLine(n.x,n.y,a,s,U.x,U.y,0,f,v);j?(r.ctrlpts[0]=r.ctrlpts[0]+I.x*(A-O),r.ctrlpts[1]=r.ctrlpts[1]+I.y*(A-O)):(r.ctrlpts[0]=W[0]+I.x*A,r.ctrlpts[1]=W[1]+I.y*A)}if(T||_||F){B=!0;var Y={x:r.ctrlpts[0]-i.x,y:r.ctrlpts[1]-i.y},Q=Math.sqrt(Y.x*Y.x+Y.y*Y.y),ne={x:Y.x/Q,y:Y.y/Q},re=Math.max(a,s),H={x:r.ctrlpts[0]+ne.x*2*re,y:r.ctrlpts[1]+ne.y*2*re},te=c.intersectLine(i.x,i.y,o,l,H.x,H.y,0,p,y);F?(r.ctrlpts[0]=r.ctrlpts[0]+ne.x*(A-D),r.ctrlpts[1]=r.ctrlpts[1]+ne.y*(A-D)):(r.ctrlpts[0]=te[0]+ne.x*A,r.ctrlpts[1]=te[1]+ne.y*A)}B&&this.findEndpoints(t)}};ls.storeAllpts=function(t){var e=t._private.rscratch;if(e.edgeType==="multibezier"||e.edgeType==="bezier"||e.edgeType==="self"||e.edgeType==="compound"){e.allpts=[],e.allpts.push(e.startX,e.startY);for(var r=0;r+1<e.ctrlpts.length;r+=2)e.allpts.push(e.ctrlpts[r],e.ctrlpts[r+1]),r+3<e.ctrlpts.length&&e.allpts.push((e.ctrlpts[r]+e.ctrlpts[r+2])/2,(e.ctrlpts[r+1]+e.ctrlpts[r+3])/2);e.allpts.push(e.endX,e.endY);var n,i;e.ctrlpts.length/2%2===0?(n=e.allpts.length/2-1,e.midX=e.allpts[n],e.midY=e.allpts[n+1]):(n=e.allpts.length/2-3,i=.5,e.midX=sa(e.allpts[n],e.allpts[n+2],e.allpts[n+4],i),e.midY=sa(e.allpts[n+1],e.allpts[n+3],e.allpts[n+5],i))}else if(e.edgeType==="straight")e.allpts=[e.startX,e.startY,e.endX,e.endY],e.midX=(e.startX+e.endX+e.arrowStartX+e.arrowEndX)/4,e.midY=(e.startY+e.endY+e.arrowStartY+e.arrowEndY)/4;else if(e.edgeType==="segments"){if(e.allpts=[],e.allpts.push(e.startX,e.startY),e.allpts.push.apply(e.allpts,e.segpts),e.allpts.push(e.endX,e.endY),e.isRound){e.roundCorners=[];for(var a=2;a+3<e.allpts.length;a+=2){var s=e.radii[a/2-1],o=e.isArcRadius[a/2-1];e.roundCorners.push(E_({x:e.allpts[a-2],y:e.allpts[a-1]},{x:e.allpts[a],y:e.allpts[a+1],radius:s},{x:e.allpts[a+2],y:e.allpts[a+3]},s,o))}}if(e.segpts.length%4===0){var l=e.segpts.length/2,u=l-2;e.midX=(e.segpts[u]+e.segpts[l])/2,e.midY=(e.segpts[u+1]+e.segpts[l+1])/2}else{var c=e.segpts.length/2-1;if(!e.isRound)e.midX=e.segpts[c],e.midY=e.segpts[c+1];else{var f={x:e.segpts[c],y:e.segpts[c+1]},p=e.roundCorners[c/2];if(p.radius===0){var v={x:e.segpts[c+2],y:e.segpts[c+3]};e.midX=f.x,e.midY=f.y,e.midVector=[f.y-v.y,v.x-f.x]}else{var y=[f.x-p.cx,f.y-p.cy],S=p.radius/Math.sqrt(Math.pow(y[0],2)+Math.pow(y[1],2));y=y.map(function(w){return w*S}),e.midX=p.cx+y[0],e.midY=p.cy+y[1],e.midVector=y}}}}};ls.checkForInvalidEdgeWarning=function(t){var e=t[0]._private.rscratch;e.nodesOverlap||gt(e.startX)&&gt(e.startY)&&gt(e.endX)&&gt(e.endY)?e.loggedErr=!1:e.loggedErr||(e.loggedErr=!0,Yr("Edge `"+t.id()+"` has invalid endpoints and so it is impossible to draw.  Adjust your edge style (e.g. control points) accordingly or use an alternative edge type.  This is expected behaviour when the source node and the target node overlap."))};ls.findEdgeControlPoints=function(t){var e=this;if(!(!t||t.length===0)){for(var r=this,n=r.cy,i=n.hasCompoundNodes(),a=new fc,s=function(F,B){return[].concat(lx(F),[B?1:0]).join("-")},o=[],l=[],u=0;u<t.length;u++){var c=t[u],f=c._private,p=c.pstyle("curve-style").value;if(!(c.removed()||!c.takesUpSpace())){if(p==="haystack"){l.push(c);continue}var v=p==="unbundled-bezier"||Dd(p,"segments")||p==="straight"||p==="straight-triangle"||Dd(p,"taxi"),y=p==="unbundled-bezier"||p==="bezier",S=f.source,w=f.target,T=S.poolIndex(),_=w.poolIndex(),C=[T,_].sort(),N=s(C,v),A=a.get(N);A==null&&(A={eles:[]},o.push({pairId:C,edgeIsUnbundled:v}),a.set(N,A)),A.eles.push(c),v&&(A.hasUnbundled=!0),y&&(A.hasBezier=!0)}}for(var O=function(){var F=o[j],B=F.pairId,$=F.edgeIsUnbundled,Z=s(B,$),I=a.get(Z),q;if(!I.hasUnbundled){var U=I.eles[0].parallelEdges().filter(function(ct){return ct.isBundledBezier()});d_(I.eles),U.forEach(function(ct){return I.eles.push(ct)}),I.eles.sort(function(ct,We){return ct.poolIndex()-We.poolIndex()})}var W=I.eles[0],Y=W.source(),Q=W.target();if(Y.poolIndex()>Q.poolIndex()){var ne=Y;Y=Q,Q=ne}var re=I.srcPos=Y.position(),H=I.tgtPos=Q.position(),te=I.srcW=Y.outerWidth(),ie=I.srcH=Y.outerHeight(),de=I.tgtW=Q.outerWidth(),ge=I.tgtH=Q.outerHeight(),ye=I.srcShape=r.nodeShapes[e.getNodeShape(Y)],ae=I.tgtShape=r.nodeShapes[e.getNodeShape(Q)],pe=I.srcCornerRadius=Y.pstyle("corner-radius").value==="auto"?"auto":Y.pstyle("corner-radius").pfValue,le=I.tgtCornerRadius=Q.pstyle("corner-radius").value==="auto"?"auto":Q.pstyle("corner-radius").pfValue,me=I.tgtRs=Q._private.rscratch,he=I.srcRs=Y._private.rscratch;I.dirCounts={north:0,west:0,south:0,east:0,northwest:0,southwest:0,northeast:0,southeast:0};for(var xe=0;xe<I.eles.length;xe++){var we=I.eles[xe],Ge=we[0]._private.rscratch,qe=we.pstyle("curve-style").value,wt=qe==="unbundled-bezier"||Dd(qe,"segments")||Dd(qe,"taxi"),et=!Y.same(we.source());if(!I.calculatedIntersection&&Y!==Q&&(I.hasBezier||I.hasUnbundled)){I.calculatedIntersection=!0;var at=ye.intersectLine(re.x,re.y,te,ie,H.x,H.y,0,pe,he),je=I.srcIntn=at,Re=ae.intersectLine(H.x,H.y,de,ge,re.x,re.y,0,le,me),nt=I.tgtIntn=Re,Ce=I.intersectionPts={x1:at[0],x2:Re[0],y1:at[1],y2:Re[1]},Fe=I.posPts={x1:re.x,x2:H.x,y1:re.y,y2:H.y},Ke=Re[1]-at[1],pt=Re[0]-at[0],vt=Math.sqrt(pt*pt+Ke*Ke);gt(vt)&&vt>=iU||(vt=Math.sqrt(Math.max(pt*pt,Av)+Math.max(Ke*Ke,Av)));var At=I.vector={x:pt,y:Ke},Ut=I.vectorNorm={x:At.x/vt,y:At.y/vt},nr={x:-Ut.y,y:Ut.x};I.nodesOverlap=!gt(vt)||ae.checkPoint(at[0],at[1],0,de,ge,H.x,H.y,le,me)||ye.checkPoint(Re[0],Re[1],0,te,ie,re.x,re.y,pe,he),I.vectorNormInverse=nr,q={nodesOverlap:I.nodesOverlap,dirCounts:I.dirCounts,calculatedIntersection:!0,hasBezier:I.hasBezier,hasUnbundled:I.hasUnbundled,eles:I.eles,srcPos:H,srcRs:me,tgtPos:re,tgtRs:he,srcW:de,srcH:ge,tgtW:te,tgtH:ie,srcIntn:nt,tgtIntn:je,srcShape:ae,tgtShape:ye,posPts:{x1:Fe.x2,y1:Fe.y2,x2:Fe.x1,y2:Fe.y1},intersectionPts:{x1:Ce.x2,y1:Ce.y2,x2:Ce.x1,y2:Ce.y1},vector:{x:-At.x,y:-At.y},vectorNorm:{x:-Ut.x,y:-Ut.y},vectorNormInverse:{x:-nr.x,y:-nr.y}}}var Ct=et?q:I;Ge.nodesOverlap=Ct.nodesOverlap,Ge.srcIntn=Ct.srcIntn,Ge.tgtIntn=Ct.tgtIntn,Ge.isRound=qe.startsWith("round"),i&&(Y.isParent()||Y.isChild()||Q.isParent()||Q.isChild())&&(Y.parents().anySame(Q)||Q.parents().anySame(Y)||Y.same(Q)&&Y.isParent())?e.findCompoundLoopPoints(we,Ct,xe,wt):Y===Q?e.findLoopPoints(we,Ct,xe,wt):qe.endsWith("segments")?e.findSegmentsPoints(we,Ct):qe.endsWith("taxi")?e.findTaxiPoints(we,Ct):qe==="straight"||!wt&&I.eles.length%2===1&&xe===Math.floor(I.eles.length/2)?e.findStraightEdgePoints(we):e.findBezierPoints(we,Ct,xe,wt,et),e.findEndpoints(we),e.tryToCorrectInvalidPoints(we,Ct),e.checkForInvalidEdgeWarning(we),e.storeAllpts(we),e.storeEdgeProjections(we),e.calculateArrowAngles(we),e.recalculateEdgeLabelProjections(we),e.calculateLabelAngles(we)}},j=0;j<o.length;j++)O();this.findHaystackPoints(l)}};function cL(t){var e=[];if(t!=null){for(var r=0;r<t.length;r+=2){var n=t[r],i=t[r+1];e.push({x:n,y:i})}return e}}ls.getSegmentPoints=function(t){var e=t[0]._private.rscratch;this.recalculateRenderedStyle(t);var r=e.edgeType;if(r==="segments")return cL(e.segpts)};ls.getControlPoints=function(t){var e=t[0]._private.rscratch;this.recalculateRenderedStyle(t);var r=e.edgeType;if(r==="bezier"||r==="multibezier"||r==="self"||r==="compound")return cL(e.ctrlpts)};ls.getEdgeMidpoint=function(t){var e=t[0]._private.rscratch;return this.recalculateRenderedStyle(t),{x:e.midX,y:e.midY}};var o0={};o0.manualEndptToPx=function(t,e){var r=this,n=t.position(),i=t.outerWidth(),a=t.outerHeight(),s=t._private.rscratch;if(e.value.length===2){var o=[e.pfValue[0],e.pfValue[1]];return e.units[0]==="%"&&(o[0]=o[0]*i),e.units[1]==="%"&&(o[1]=o[1]*a),o[0]+=n.x,o[1]+=n.y,o}else{var l=e.pfValue[0];l=-Math.PI/2+l;var u=2*Math.max(i,a),c=[n.x+Math.cos(l)*u,n.y+Math.sin(l)*u];return r.nodeShapes[this.getNodeShape(t)].intersectLine(n.x,n.y,i,a,c[0],c[1],0,t.pstyle("corner-radius").value==="auto"?"auto":t.pstyle("corner-radius").pfValue,s)}};o0.findEndpoints=function(t){var e,r,n,i,a=this,s,o=t.source()[0],l=t.target()[0],u=o.position(),c=l.position(),f=t.pstyle("target-arrow-shape").value,p=t.pstyle("source-arrow-shape").value,v=t.pstyle("target-distance-from-node").pfValue,y=t.pstyle("source-distance-from-node").pfValue,S=o._private.rscratch,w=l._private.rscratch,T=t.pstyle("curve-style").value,_=t._private.rscratch,C=_.edgeType,N=Dd(T,"taxi"),A=C==="self"||C==="compound",O=C==="bezier"||C==="multibezier"||A,j=C!=="bezier",D=C==="straight"||C==="segments",F=C==="segments",B=O||j||D,$=A||N,Z=t.pstyle("source-endpoint"),I=$?"outside-to-node":Z.value,q=o.pstyle("corner-radius").value==="auto"?"auto":o.pstyle("corner-radius").pfValue,U=t.pstyle("target-endpoint"),W=$?"outside-to-node":U.value,Y=l.pstyle("corner-radius").value==="auto"?"auto":l.pstyle("corner-radius").pfValue;_.srcManEndpt=Z,_.tgtManEndpt=U;var Q,ne,re,H,te=(e=(U==null||(r=U.pfValue)===null||r===void 0?void 0:r.length)===2?U.pfValue:null)!==null&&e!==void 0?e:[0,0],ie=(n=(Z==null||(i=Z.pfValue)===null||i===void 0?void 0:i.length)===2?Z.pfValue:null)!==null&&n!==void 0?n:[0,0];if(O){var de=[_.ctrlpts[0],_.ctrlpts[1]],ge=j?[_.ctrlpts[_.ctrlpts.length-2],_.ctrlpts[_.ctrlpts.length-1]]:de;Q=ge,ne=de}else if(D){var ye=F?_.segpts.slice(0,2):[c.x+te[0],c.y+te[1]],ae=F?_.segpts.slice(_.segpts.length-2):[u.x+ie[0],u.y+ie[1]];Q=ae,ne=ye}if(W==="inside-to-node")s=[c.x,c.y];else if(U.units)s=this.manualEndptToPx(l,U);else if(W==="outside-to-line")s=_.tgtIntn;else if(W==="outside-to-node"||W==="outside-to-node-or-label"?re=Q:(W==="outside-to-line"||W==="outside-to-line-or-label")&&(re=[u.x,u.y]),s=a.nodeShapes[this.getNodeShape(l)].intersectLine(c.x,c.y,l.outerWidth(),l.outerHeight(),re[0],re[1],0,Y,w),W==="outside-to-node-or-label"||W==="outside-to-line-or-label"){var pe=l._private.rscratch,le=pe.labelWidth,me=pe.labelHeight,he=pe.labelX,xe=pe.labelY,we=le/2,Ge=me/2,qe=l.pstyle("text-valign").value;qe==="top"?xe-=Ge:qe==="bottom"&&(xe+=Ge);var wt=l.pstyle("text-halign").value;wt==="left"?he-=we:wt==="right"&&(he+=we);var et=Ev(re[0],re[1],[he-we,xe-Ge,he+we,xe-Ge,he+we,xe+Ge,he-we,xe+Ge],c.x,c.y);if(et.length>0){var at=u,je=Yf(at,Dp(s)),Re=Yf(at,Dp(et)),nt=je;if(Re<je&&(s=et,nt=Re),et.length>2){var Ce=Yf(at,{x:et[2],y:et[3]});Ce<nt&&(s=[et[2],et[3]])}}}var Fe=ny(s,Q,a.arrowShapes[f].spacing(t)+v),Ke=ny(s,Q,a.arrowShapes[f].gap(t)+v);if(_.endX=Ke[0],_.endY=Ke[1],_.arrowEndX=Fe[0],_.arrowEndY=Fe[1],I==="inside-to-node")s=[u.x,u.y];else if(Z.units)s=this.manualEndptToPx(o,Z);else if(I==="outside-to-line")s=_.srcIntn;else if(I==="outside-to-node"||I==="outside-to-node-or-label"?H=ne:(I==="outside-to-line"||I==="outside-to-line-or-label")&&(H=[c.x,c.y]),s=a.nodeShapes[this.getNodeShape(o)].intersectLine(u.x,u.y,o.outerWidth(),o.outerHeight(),H[0],H[1],0,q,S),I==="outside-to-node-or-label"||I==="outside-to-line-or-label"){var pt=o._private.rscratch,vt=pt.labelWidth,At=pt.labelHeight,Ut=pt.labelX,nr=pt.labelY,Ct=vt/2,ct=At/2,We=o.pstyle("text-valign").value;We==="top"?nr-=ct:We==="bottom"&&(nr+=ct);var ce=o.pstyle("text-halign").value;ce==="left"?Ut-=Ct:ce==="right"&&(Ut+=Ct);var ve=Ev(H[0],H[1],[Ut-Ct,nr-ct,Ut+Ct,nr-ct,Ut+Ct,nr+ct,Ut-Ct,nr+ct],u.x,u.y);if(ve.length>0){var _e=c,Te=Yf(_e,Dp(s)),Le=Yf(_e,Dp(ve)),Xe=Te;if(Le<Te&&(s=[ve[0],ve[1]],Xe=Le),ve.length>2){var He=Yf(_e,{x:ve[2],y:ve[3]});He<Xe&&(s=[ve[2],ve[3]])}}}var dt=ny(s,ne,a.arrowShapes[p].spacing(t)+y),ft=ny(s,ne,a.arrowShapes[p].gap(t)+y);_.startX=ft[0],_.startY=ft[1],_.arrowStartX=dt[0],_.arrowStartY=dt[1],B&&(!gt(_.startX)||!gt(_.startY)||!gt(_.endX)||!gt(_.endY)?_.badLine=!0:_.badLine=!1)};o0.getSourceEndpoint=function(t){var e=t[0]._private.rscratch;return this.recalculateRenderedStyle(t),e.edgeType==="haystack"?{x:e.haystackPts[0],y:e.haystackPts[1]}:{x:e.arrowStartX,y:e.arrowStartY}};o0.getTargetEndpoint=function(t){var e=t[0]._private.rscratch;return this.recalculateRenderedStyle(t),e.edgeType==="haystack"?{x:e.haystackPts[2],y:e.haystackPts[3]}:{x:e.arrowEndX,y:e.arrowEndY}};var T_={};function aU(t,e,r){for(var n=function(u,c,f,p){return sa(u,c,f,p)},i=e._private,a=i.rstyle.bezierPts,s=0;s<t.bezierProjPcts.length;s++){var o=t.bezierProjPcts[s];a.push({x:n(r[0],r[2],r[4],o),y:n(r[1],r[3],r[5],o)})}}T_.storeEdgeProjections=function(t){var e=t._private,r=e.rscratch,n=r.edgeType;if(e.rstyle.bezierPts=null,e.rstyle.linePts=null,e.rstyle.haystackPts=null,n==="multibezier"||n==="bezier"||n==="self"||n==="compound"){e.rstyle.bezierPts=[];for(var i=0;i+5<r.allpts.length;i+=4)aU(this,t,r.allpts.slice(i,i+6))}else if(n==="segments")for(var a=e.rstyle.linePts=[],i=0;i+1<r.allpts.length;i+=2)a.push({x:r.allpts[i],y:r.allpts[i+1]});else if(n==="haystack"){var s=r.haystackPts;e.rstyle.haystackPts=[{x:s[0],y:s[1]},{x:s[2],y:s[3]}]}e.rstyle.arrowWidth=this.getArrowWidth(t.pstyle("width").pfValue,t.pstyle("arrow-scale").value)*this.arrowShapeWidth};T_.recalculateEdgeProjections=function(t){this.findEdgeControlPoints(t)};var Nu={};Nu.recalculateNodeLabelProjection=function(t){var e=t.pstyle("label").strValue;if(!Xd(e)){var r,n,i=t._private,a=t.width(),s=t.height(),o=t.padding(),l=t.position(),u=t.pstyle("text-halign").strValue,c=t.pstyle("text-valign").strValue,f=i.rscratch,p=i.rstyle;switch(u){case"left":r=l.x-a/2-o;break;case"right":r=l.x+a/2+o;break;default:r=l.x}switch(c){case"top":n=l.y-s/2-o;break;case"bottom":n=l.y+s/2+o;break;default:n=l.y}f.labelX=r,f.labelY=n,p.labelX=r,p.labelY=n,this.calculateLabelAngles(t),this.applyLabelDimensions(t)}};var dL=function(e,r){var n=Math.atan(r/e);return e===0&&n<0&&(n=n*-1),n},fL=function(e,r){var n=r.x-e.x,i=r.y-e.y;return dL(n,i)},sU=function(e,r,n,i){var a=Cv(0,i-.001,1),s=Cv(0,i+.001,1),o=zp(e,r,n,a),l=zp(e,r,n,s);return fL(o,l)};Nu.recalculateEdgeLabelProjections=function(t){var e,r=t._private,n=r.rscratch,i=this,a={mid:t.pstyle("label").strValue,source:t.pstyle("source-label").strValue,target:t.pstyle("target-label").strValue};if(a.mid||a.source||a.target){e={x:n.midX,y:n.midY};var s=function(f,p,v){dc(r.rscratch,f,p,v),dc(r.rstyle,f,p,v)};s("labelX",null,e.x),s("labelY",null,e.y);var o=dL(n.midDispX,n.midDispY);s("labelAutoAngle",null,o);var l=function(){if(l.cache)return l.cache;for(var f=[],p=0;p+5<n.allpts.length;p+=4){var v={x:n.allpts[p],y:n.allpts[p+1]},y={x:n.allpts[p+2],y:n.allpts[p+3]},S={x:n.allpts[p+4],y:n.allpts[p+5]};f.push({p0:v,p1:y,p2:S,startDist:0,length:0,segments:[]})}var w=r.rstyle.bezierPts,T=i.bezierProjPcts.length;function _(j,D,F,B,$){var Z=yh(D,F),I=j.segments[j.segments.length-1],q={p0:D,p1:F,t0:B,t1:$,startDist:I?I.startDist+I.length:0,length:Z};j.segments.push(q),j.length+=Z}for(var C=0;C<f.length;C++){var N=f[C],A=f[C-1];A&&(N.startDist=A.startDist+A.length),_(N,N.p0,w[C*T],0,i.bezierProjPcts[0]);for(var O=0;O<T-1;O++)_(N,w[C*T+O],w[C*T+O+1],i.bezierProjPcts[O],i.bezierProjPcts[O+1]);_(N,w[C*T+T-1],N.p2,i.bezierProjPcts[T-1],1)}return l.cache=f},u=function(f){var p,v=f==="source";if(a[f]){var y=t.pstyle(f+"-text-offset").pfValue;switch(n.edgeType){case"self":case"compound":case"bezier":case"multibezier":{for(var S=l(),w,T=0,_=0,C=0;C<S.length;C++){for(var N=S[v?C:S.length-1-C],A=0;A<N.segments.length;A++){var O=N.segments[v?A:N.segments.length-1-A],j=C===S.length-1&&A===N.segments.length-1;if(T=_,_+=O.length,_>=y||j){w={cp:N,segment:O};break}}if(w)break}var D=w.cp,F=w.segment,B=(y-T)/F.length,$=F.t1-F.t0,Z=v?F.t0+$*B:F.t1-$*B;Z=Cv(0,Z,1),e=zp(D.p0,D.p1,D.p2,Z),p=sU(D.p0,D.p1,D.p2,Z);break}case"straight":case"segments":case"haystack":{for(var I=0,q,U,W,Y,Q=n.allpts.length,ne=0;ne+3<Q&&(v?(W={x:n.allpts[ne],y:n.allpts[ne+1]},Y={x:n.allpts[ne+2],y:n.allpts[ne+3]}):(W={x:n.allpts[Q-2-ne],y:n.allpts[Q-1-ne]},Y={x:n.allpts[Q-4-ne],y:n.allpts[Q-3-ne]}),q=yh(W,Y),U=I,I+=q,!(I>=y));ne+=2);var re=y-U,H=re/q;H=Cv(0,H,1),e=N9(W,Y,H),p=fL(W,Y);break}}s("labelX",f,e.x),s("labelY",f,e.y),s("labelAutoAngle",f,p)}};u("source"),u("target"),this.applyLabelDimensions(t)}};Nu.applyLabelDimensions=function(t){this.applyPrefixedLabelDimensions(t),t.isEdge()&&(this.applyPrefixedLabelDimensions(t,"source"),this.applyPrefixedLabelDimensions(t,"target"))};Nu.applyPrefixedLabelDimensions=function(t,e){var r=t._private,n=this.getLabelText(t,e),i=vh(n,t._private.labelDimsKey);if(Gs(r.rscratch,"prefixedLabelDimsKey",e)!==i){dc(r.rscratch,"prefixedLabelDimsKey",e,i);var a=this.calculateLabelDimensions(t,n),s=t.pstyle("line-height").pfValue,o=t.pstyle("text-wrap").strValue,l=Gs(r.rscratch,"labelWrapCachedLines",e)||[],u=o!=="wrap"?1:Math.max(l.length,1),c=a.height/u,f=c*s,p=a.width,v=a.height+(u-1)*(s-1)*c;dc(r.rstyle,"labelWidth",e,p),dc(r.rscratch,"labelWidth",e,p),dc(r.rstyle,"labelHeight",e,v),dc(r.rscratch,"labelHeight",e,v),dc(r.rscratch,"labelLineHeight",e,f)}};Nu.getLabelText=function(t,e){var r=t._private,n=e?e+"-":"",i=t.pstyle(n+"label").strValue,a=t.pstyle("text-transform").value,s=function(ie,de){return de?(dc(r.rscratch,ie,e,de),de):Gs(r.rscratch,ie,e)};if(!i)return"";a=="none"||(a=="uppercase"?i=i.toUpperCase():a=="lowercase"&&(i=i.toLowerCase()));var o=t.pstyle("text-wrap").value;if(o==="wrap"){var l=s("labelKey");if(l!=null&&s("labelWrapKey")===l)return s("labelWrapCachedText");for(var u="",c=i.split(`
`),f=t.pstyle("text-max-width").pfValue,p=t.pstyle("text-overflow-wrap").value,v=p==="anywhere",y=[],S=/[\s\u200b]+|$/g,w=0;w<c.length;w++){var T=c[w],_=this.calculateLabelDimensions(t,T),C=_.width;if(v){var N=T.split("").join(u);T=N}if(C>f){var A=T.matchAll(S),O="",j=0,D=Ws(A),F;try{for(D.s();!(F=D.n()).done;){var B=F.value,$=B[0],Z=T.substring(j,B.index);j=B.index+$.length;var I=O.length===0?Z:O+Z+$,q=this.calculateLabelDimensions(t,I),U=q.width;U<=f?O+=Z+$:(O&&y.push(O),O=Z+$)}}catch(te){D.e(te)}finally{D.f()}O.match(/^[\s\u200b]+$/)||y.push(O)}else y.push(T)}s("labelWrapCachedLines",y),i=s("labelWrapCachedText",y.join(`
`)),s("labelWrapKey",l)}else if(o==="ellipsis"){var W=t.pstyle("text-max-width").pfValue,Y="",Q="",ne=!1;if(this.calculateLabelDimensions(t,i).width<W)return i;for(var re=0;re<i.length;re++){var H=this.calculateLabelDimensions(t,Y+i[re]+Q).width;if(H>W)break;Y+=i[re],re===i.length-1&&(ne=!0)}return ne||(Y+=Q),Y}return i};Nu.getLabelJustification=function(t){var e=t.pstyle("text-justification").strValue,r=t.pstyle("text-halign").strValue;if(e==="auto")if(t.isNode())switch(r){case"left":return"right";case"right":return"left";default:return"center"}else return"center";else return e};Nu.calculateLabelDimensions=function(t,e){var r=this,n=r.cy.window(),i=n.document,a=0,s=t.pstyle("font-style").strValue,o=t.pstyle("font-size").pfValue,l=t.pstyle("font-family").strValue,u=t.pstyle("font-weight").strValue,c=this.labelCalcCanvas,f=this.labelCalcCanvasContext;if(!c){c=this.labelCalcCanvas=i.createElement("canvas"),f=this.labelCalcCanvasContext=c.getContext("2d");var p=c.style;p.position="absolute",p.left="-9999px",p.top="-9999px",p.zIndex="-1",p.visibility="hidden",p.pointerEvents="none"}f.font="".concat(s," ").concat(u," ").concat(o,"px ").concat(l);for(var v=0,y=0,S=e.split(`
`),w=0;w<S.length;w++){var T=S[w],_=f.measureText(T),C=Math.ceil(_.width),N=o;v=Math.max(C,v),y+=N}return v+=a,y+=a,{width:v,height:y}};Nu.calculateLabelAngle=function(t,e){var r=t._private,n=r.rscratch,i=t.isEdge(),a=e?e+"-":"",s=t.pstyle(a+"text-rotation"),o=s.strValue;return o==="none"?0:i&&o==="autorotate"?n.labelAutoAngle:o==="autorotate"?0:s.pfValue};Nu.calculateLabelAngles=function(t){var e=this,r=t.isEdge(),n=t._private,i=n.rscratch;i.labelAngle=e.calculateLabelAngle(t),r&&(i.sourceLabelAngle=e.calculateLabelAngle(t,"source"),i.targetLabelAngle=e.calculateLabelAngle(t,"target"))};var hL={},QN=28,JN=!1;hL.getNodeShape=function(t){var e=this,r=t.pstyle("shape").value;if(r==="cutrectangle"&&(t.width()<QN||t.height()<QN))return JN||(Yr("The `cutrectangle` node shape can not be used at small sizes so `rectangle` is used instead"),JN=!0),"rectangle";if(t.isParent())return r==="rectangle"||r==="roundrectangle"||r==="round-rectangle"||r==="cutrectangle"||r==="cut-rectangle"||r==="barrel"?r:"rectangle";if(r==="polygon"){var n=t.pstyle("shape-polygon-points").value;return e.nodeShapes.makePolygon(n).name}return r};var B1={};B1.registerCalculationListeners=function(){var t=this.cy,e=t.collection(),r=this,n=function(s){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(e.merge(s),o)for(var l=0;l<s.length;l++){var u=s[l],c=u._private,f=c.rstyle;f.clean=!1,f.cleanConnected=!1}};r.binder(t).on("bounds.* dirty.*",function(s){var o=s.target;n(o)}).on("style.* background.*",function(s){var o=s.target;n(o,!1)});var i=function(s){if(s){var o=r.onUpdateEleCalcsFns;e.cleanStyle();for(var l=0;l<e.length;l++){var u=e[l],c=u._private.rstyle;u.isNode()&&!c.cleanConnected&&(n(u.connectedEdges()),c.cleanConnected=!0)}if(o)for(var f=0;f<o.length;f++){var p=o[f];p(s,e)}r.recalculateRenderedStyle(e),e=t.collection()}};r.flushRenderedStyleQueue=function(){i(!0)},r.beforeRender(i,r.beforeRenderPriorities.eleCalcs)};B1.onUpdateEleCalcs=function(t){var e=this.onUpdateEleCalcsFns=this.onUpdateEleCalcsFns||[];e.push(t)};B1.recalculateRenderedStyle=function(t,e){var r=function(N){return N._private.rstyle.cleanConnected};if(t.length!==0){var n=[],i=[];if(!this.destroyed){e===void 0&&(e=!0);for(var a=0;a<t.length;a++){var s=t[a],o=s._private,l=o.rstyle;s.isEdge()&&(!r(s.source())||!r(s.target()))&&(l.clean=!1),s.isEdge()&&s.isBundledBezier()&&s.parallelEdges().some(function(C){return!C._private.rstyle.clean&&C.isBundledBezier()})&&(l.clean=!1),!(e&&l.clean||s.removed())&&s.pstyle("display").value!=="none"&&(o.group==="nodes"?i.push(s):n.push(s),l.clean=!0)}for(var u=0;u<i.length;u++){var c=i[u],f=c._private,p=f.rstyle,v=c.position();this.recalculateNodeLabelProjection(c),p.nodeX=v.x,p.nodeY=v.y,p.nodeW=c.pstyle("width").pfValue,p.nodeH=c.pstyle("height").pfValue}this.recalculateEdgeProjections(n);for(var y=0;y<n.length;y++){var S=n[y],w=S._private,T=w.rstyle,_=w.rscratch;T.srcX=_.arrowStartX,T.srcY=_.arrowStartY,T.tgtX=_.arrowEndX,T.tgtY=_.arrowEndY,T.midX=_.midX,T.midY=_.midY,T.labelAngle=_.labelAngle,T.sourceLabelAngle=_.sourceLabelAngle,T.targetLabelAngle=_.targetLabelAngle}}}};var z1={};z1.updateCachedGrabbedEles=function(){var t=this.cachedZSortedEles;if(t){t.drag=[],t.nondrag=[];for(var e=[],r=0;r<t.length;r++){var n=t[r],i=n._private.rscratch;n.grabbed()&&!n.isParent()?e.push(n):i.inDragLayer?t.drag.push(n):t.nondrag.push(n)}for(var r=0;r<e.length;r++){var n=e[r];t.drag.push(n)}}};z1.invalidateCachedZSortedEles=function(){this.cachedZSortedEles=null};z1.getCachedZSortedEles=function(t){if(t||!this.cachedZSortedEles){var e=this.cy.mutableElements().toArray();e.sort(KA),e.interactive=e.filter(function(r){return r.interactive()}),this.cachedZSortedEles=e,this.updateCachedGrabbedEles()}else e=this.cachedZSortedEles;return e};var pL={};[Lh,yx,ls,o0,T_,Nu,hL,B1,z1].forEach(function(t){Jt(pL,t)});var mL={};mL.getCachedImage=function(t,e,r){var n=this,i=n.imageCache=n.imageCache||{},a=i[t];if(a)return a.image.complete||a.image.addEventListener("load",r),a.image;a=i[t]=i[t]||{};var s=a.image=new Image;s.addEventListener("load",r),s.addEventListener("error",function(){s.error=!0});var o="data:",l=t.substring(0,o.length).toLowerCase()===o;return l||(e=e==="null"?null:e,s.crossOrigin=e),s.src=t,s};var gm={};gm.registerBinding=function(t,e,r,n){var i=Array.prototype.slice.apply(arguments,[1]);if(Array.isArray(t)){for(var a=[],s=0;s<t.length;s++){var o=t[s];if(o!==void 0){var l=this.binder(o);a.push(l.on.apply(l,i))}}return a}var l=this.binder(t);return l.on.apply(l,i)};gm.binder=function(t){var e=this,r=e.cy.window(),n=t===r||t===r.document||t===r.document.body||yF(t);if(e.supportsPassiveEvents==null){var i=!1;try{var a=Object.defineProperty({},"passive",{get:function(){return i=!0,!0}});r.addEventListener("test",null,a)}catch{}e.supportsPassiveEvents=i}var s=function(l,u,c){var f=Array.prototype.slice.call(arguments);return n&&e.supportsPassiveEvents&&(f[2]={capture:c??!1,passive:!1,once:!1}),e.bindings.push({target:t,args:f}),(t.addEventListener||t.on).apply(t,f),this};return{on:s,addEventListener:s,addListener:s,bind:s}};gm.nodeIsDraggable=function(t){return t&&t.isNode()&&!t.locked()&&t.grabbable()};gm.nodeIsGrabbable=function(t){return this.nodeIsDraggable(t)&&t.interactive()};gm.load=function(){var t=this,e=t.cy.window(),r=function(ce){return ce.selected()},n=function(ce){var ve=ce.getRootNode();if(ve&&ve.nodeType===11&&ve.host!==void 0)return ve},i=function(ce,ve,_e,Te){ce==null&&(ce=t.cy);for(var Le=0;Le<ve.length;Le++){var Xe=ve[Le];ce.emit({originalEvent:_e,type:Xe,position:Te})}},a=function(ce){return ce.shiftKey||ce.metaKey||ce.ctrlKey},s=function(ce,ve){var _e=!0;if(t.cy.hasCompoundNodes()&&ce&&ce.pannable())for(var Te=0;ve&&Te<ve.length;Te++){var ce=ve[Te];if(ce.isNode()&&ce.isParent()&&!ce.pannable()){_e=!1;break}}else _e=!0;return _e},o=function(ce){ce[0]._private.grabbed=!0},l=function(ce){ce[0]._private.grabbed=!1},u=function(ce){ce[0]._private.rscratch.inDragLayer=!0},c=function(ce){ce[0]._private.rscratch.inDragLayer=!1},f=function(ce){ce[0]._private.rscratch.isGrabTarget=!0},p=function(ce){ce[0]._private.rscratch.isGrabTarget=!1},v=function(ce,ve){var _e=ve.addToList,Te=_e.has(ce);!Te&&ce.grabbable()&&!ce.locked()&&(_e.merge(ce),o(ce))},y=function(ce,ve){if(ce.cy().hasCompoundNodes()&&!(ve.inDragLayer==null&&ve.addToList==null)){var _e=ce.descendants();ve.inDragLayer&&(_e.forEach(u),_e.connectedEdges().forEach(u)),ve.addToList&&v(_e,ve)}},S=function(ce,ve){ve=ve||{};var _e=ce.cy().hasCompoundNodes();ve.inDragLayer&&(ce.forEach(u),ce.neighborhood().stdFilter(function(Te){return!_e||Te.isEdge()}).forEach(u)),ve.addToList&&ce.forEach(function(Te){v(Te,ve)}),y(ce,ve),_(ce,{inDragLayer:ve.inDragLayer}),t.updateCachedGrabbedEles()},w=S,T=function(ce){ce&&(t.getCachedZSortedEles().forEach(function(ve){l(ve),c(ve),p(ve)}),t.updateCachedGrabbedEles())},_=function(ce,ve){if(!(ve.inDragLayer==null&&ve.addToList==null)&&ce.cy().hasCompoundNodes()){var _e=ce.ancestors().orphans();if(!_e.same(ce)){var Te=_e.descendants().spawnSelf().merge(_e).unmerge(ce).unmerge(ce.descendants()),Le=Te.connectedEdges();ve.inDragLayer&&(Le.forEach(u),Te.forEach(u)),ve.addToList&&Te.forEach(function(Xe){v(Xe,ve)})}}},C=function(){document.activeElement!=null&&document.activeElement.blur!=null&&document.activeElement.blur()},N=typeof MutationObserver<"u",A=typeof ResizeObserver<"u";N?(t.removeObserver=new MutationObserver(function(We){for(var ce=0;ce<We.length;ce++){var ve=We[ce],_e=ve.removedNodes;if(_e)for(var Te=0;Te<_e.length;Te++){var Le=_e[Te];if(Le===t.container){t.destroy();break}}}}),t.container.parentNode&&t.removeObserver.observe(t.container.parentNode,{childList:!0})):t.registerBinding(t.container,"DOMNodeRemoved",function(We){t.destroy()});var O=n0(function(){t.cy.resize()},100);N&&(t.styleObserver=new MutationObserver(O),t.styleObserver.observe(t.container,{attributes:!0})),t.registerBinding(e,"resize",O),A&&(t.resizeObserver=new ResizeObserver(O),t.resizeObserver.observe(t.container));var j=function(ce,ve){for(;ce!=null;)ve(ce),ce=ce.parentNode},D=function(){t.invalidateContainerClientCoordsCache()};j(t.container,function(We){t.registerBinding(We,"transitionend",D),t.registerBinding(We,"animationend",D),t.registerBinding(We,"scroll",D)}),t.registerBinding(t.container,"contextmenu",function(We){We.preventDefault()});var F=function(){return t.selection[4]!==0},B=function(ce){for(var ve=t.findContainerClientCoords(),_e=ve[0],Te=ve[1],Le=ve[2],Xe=ve[3],He=ce.touches?ce.touches:[ce],dt=!1,ft=0;ft<He.length;ft++){var Pt=He[ft];if(_e<=Pt.clientX&&Pt.clientX<=_e+Le&&Te<=Pt.clientY&&Pt.clientY<=Te+Xe){dt=!0;break}}if(!dt)return!1;for(var qt=t.container,$t=ce.target,kt=$t.parentNode,Zt=!1;kt;){if(kt===qt){Zt=!0;break}kt=kt.parentNode}return!!Zt};t.registerBinding(t.container,"mousedown",function(ce){if(B(ce)&&!(t.hoverData.which===1&&ce.which!==1)){ce.preventDefault(),C(),t.hoverData.capture=!0,t.hoverData.which=ce.which;var ve=t.cy,_e=[ce.clientX,ce.clientY],Te=t.projectIntoViewport(_e[0],_e[1]),Le=t.selection,Xe=t.findNearestElements(Te[0],Te[1],!0,!1),He=Xe[0],dt=t.dragData.possibleDragElements;t.hoverData.mdownPos=Te,t.hoverData.mdownGPos=_e;var ft=function(er){return{originalEvent:ce,type:er,position:{x:Te[0],y:Te[1]}}},Pt=function(){t.hoverData.tapholdCancelled=!1,clearTimeout(t.hoverData.tapholdTimeout),t.hoverData.tapholdTimeout=setTimeout(function(){if(!t.hoverData.tapholdCancelled){var er=t.hoverData.down;er?er.emit(ft("taphold")):ve.emit(ft("taphold"))}},t.tapholdDuration)};if(ce.which==3){t.hoverData.cxtStarted=!0;var qt={originalEvent:ce,type:"cxttapstart",position:{x:Te[0],y:Te[1]}};He?(He.activate(),He.emit(qt),t.hoverData.down=He):ve.emit(qt),t.hoverData.downTime=new Date().getTime(),t.hoverData.cxtDragged=!1}else if(ce.which==1){He&&He.activate();{if(He!=null&&t.nodeIsGrabbable(He)){var $t=function(er){er.emit(ft("grab"))};if(f(He),!He.selected())dt=t.dragData.possibleDragElements=ve.collection(),w(He,{addToList:dt}),He.emit(ft("grabon")).emit(ft("grab"));else{dt=t.dragData.possibleDragElements=ve.collection();var kt=ve.$(function(Zt){return Zt.isNode()&&Zt.selected()&&t.nodeIsGrabbable(Zt)});S(kt,{addToList:dt}),He.emit(ft("grabon")),kt.forEach($t)}t.redrawHint("eles",!0),t.redrawHint("drag",!0)}t.hoverData.down=He,t.hoverData.downs=Xe,t.hoverData.downTime=new Date().getTime()}i(He,["mousedown","tapstart","vmousedown"],ce,{x:Te[0],y:Te[1]}),He==null?(Le[4]=1,t.data.bgActivePosistion={x:Te[0],y:Te[1]},t.redrawHint("select",!0),t.redraw()):He.pannable()&&(Le[4]=1),Pt()}Le[0]=Le[2]=Te[0],Le[1]=Le[3]=Te[1]}},!1);var $=n(t.container);t.registerBinding([e,$],"mousemove",function(ce){var ve=t.hoverData.capture;if(!(!ve&&!B(ce))){var _e=!1,Te=t.cy,Le=Te.zoom(),Xe=[ce.clientX,ce.clientY],He=t.projectIntoViewport(Xe[0],Xe[1]),dt=t.hoverData.mdownPos,ft=t.hoverData.mdownGPos,Pt=t.selection,qt=null;!t.hoverData.draggingEles&&!t.hoverData.dragging&&!t.hoverData.selecting&&(qt=t.findNearestElement(He[0],He[1],!0,!1));var $t=t.hoverData.last,kt=t.hoverData.down,Zt=[He[0]-Pt[2],He[1]-Pt[3]],er=t.dragData.possibleDragElements,Ar;if(ft){var xr=Xe[0]-ft[0],$e=xr*xr,yt=Xe[1]-ft[1],Et=yt*yt,rr=$e+Et;t.hoverData.isOverThresholdDrag=Ar=rr>=t.desktopTapThreshold2}var zt=a(ce);Ar&&(t.hoverData.tapholdCancelled=!0);var lt=function(){var Oi=t.hoverData.dragDelta=t.hoverData.dragDelta||[];Oi.length===0?(Oi.push(Zt[0]),Oi.push(Zt[1])):(Oi[0]+=Zt[0],Oi[1]+=Zt[1])};_e=!0,i(qt,["mousemove","vmousemove","tapdrag"],ce,{x:He[0],y:He[1]});var Pr=function(Oi){return{originalEvent:ce,type:Oi,position:{x:He[0],y:He[1]}}},zr=function(){t.data.bgActivePosistion=void 0,t.hoverData.selecting||Te.emit(Pr("boxstart")),Pt[4]=1,t.hoverData.selecting=!0,t.redrawHint("select",!0),t.redraw()};if(t.hoverData.which===3){if(Ar){var wi=Pr("cxtdrag");kt?kt.emit(wi):Te.emit(wi),t.hoverData.cxtDragged=!0,(!t.hoverData.cxtOver||qt!==t.hoverData.cxtOver)&&(t.hoverData.cxtOver&&t.hoverData.cxtOver.emit(Pr("cxtdragout")),t.hoverData.cxtOver=qt,qt&&qt.emit(Pr("cxtdragover")))}}else if(t.hoverData.dragging){if(_e=!0,Te.panningEnabled()&&Te.userPanningEnabled()){var Va;if(t.hoverData.justStartedPan){var mo=t.hoverData.mdownPos;Va={x:(He[0]-mo[0])*Le,y:(He[1]-mo[1])*Le},t.hoverData.justStartedPan=!1}else Va={x:Zt[0]*Le,y:Zt[1]*Le};Te.panBy(Va),Te.emit(Pr("dragpan")),t.hoverData.dragged=!0}He=t.projectIntoViewport(ce.clientX,ce.clientY)}else if(Pt[4]==1&&(kt==null||kt.pannable())){if(Ar){if(!t.hoverData.dragging&&Te.boxSelectionEnabled()&&(zt||!Te.panningEnabled()||!Te.userPanningEnabled()))zr();else if(!t.hoverData.selecting&&Te.panningEnabled()&&Te.userPanningEnabled()){var Si=s(kt,t.hoverData.downs);Si&&(t.hoverData.dragging=!0,t.hoverData.justStartedPan=!0,Pt[4]=0,t.data.bgActivePosistion=Dp(dt),t.redrawHint("select",!0),t.redraw())}kt&&kt.pannable()&&kt.active()&&kt.unactivate()}}else{if(kt&&kt.pannable()&&kt.active()&&kt.unactivate(),(!kt||!kt.grabbed())&&qt!=$t&&($t&&i($t,["mouseout","tapdragout"],ce,{x:He[0],y:He[1]}),qt&&i(qt,["mouseover","tapdragover"],ce,{x:He[0],y:He[1]}),t.hoverData.last=qt),kt)if(Ar){if(Te.boxSelectionEnabled()&&zt)kt&&kt.grabbed()&&(T(er),kt.emit(Pr("freeon")),er.emit(Pr("free")),t.dragData.didDrag&&(kt.emit(Pr("dragfreeon")),er.emit(Pr("dragfree")))),zr();else if(kt&&kt.grabbed()&&t.nodeIsDraggable(kt)){var gn=!t.dragData.didDrag;gn&&t.redrawHint("eles",!0),t.dragData.didDrag=!0,t.hoverData.draggingEles||S(er,{inDragLayer:!0});var Pn={x:0,y:0};if(gt(Zt[0])&&gt(Zt[1])&&(Pn.x+=Zt[0],Pn.y+=Zt[1],gn)){var ki=t.hoverData.dragDelta;ki&&gt(ki[0])&&gt(ki[1])&&(Pn.x+=ki[0],Pn.y+=ki[1])}t.hoverData.draggingEles=!0,er.silentShift(Pn).emit(Pr("position")).emit(Pr("drag")),t.redrawHint("drag",!0),t.redraw()}}else lt();_e=!0}if(Pt[2]=He[0],Pt[3]=He[1],_e)return ce.stopPropagation&&ce.stopPropagation(),ce.preventDefault&&ce.preventDefault(),!1}},!1);var Z,I,q;t.registerBinding(e,"mouseup",function(ce){if(!(t.hoverData.which===1&&ce.which!==1&&t.hoverData.capture)){var ve=t.hoverData.capture;if(ve){t.hoverData.capture=!1;var _e=t.cy,Te=t.projectIntoViewport(ce.clientX,ce.clientY),Le=t.selection,Xe=t.findNearestElement(Te[0],Te[1],!0,!1),He=t.dragData.possibleDragElements,dt=t.hoverData.down,ft=a(ce);t.data.bgActivePosistion&&(t.redrawHint("select",!0),t.redraw()),t.hoverData.tapholdCancelled=!0,t.data.bgActivePosistion=void 0,dt&&dt.unactivate();var Pt=function(xr){return{originalEvent:ce,type:xr,position:{x:Te[0],y:Te[1]}}};if(t.hoverData.which===3){var qt=Pt("cxttapend");if(dt?dt.emit(qt):_e.emit(qt),!t.hoverData.cxtDragged){var $t=Pt("cxttap");dt?dt.emit($t):_e.emit($t)}t.hoverData.cxtDragged=!1,t.hoverData.which=null}else if(t.hoverData.which===1){if(i(Xe,["mouseup","tapend","vmouseup"],ce,{x:Te[0],y:Te[1]}),!t.dragData.didDrag&&!t.hoverData.dragged&&!t.hoverData.selecting&&!t.hoverData.isOverThresholdDrag&&(i(dt,["click","tap","vclick"],ce,{x:Te[0],y:Te[1]}),I=!1,ce.timeStamp-q<=_e.multiClickDebounceTime()?(Z&&clearTimeout(Z),I=!0,q=null,i(dt,["dblclick","dbltap","vdblclick"],ce,{x:Te[0],y:Te[1]})):(Z=setTimeout(function(){I||i(dt,["oneclick","onetap","voneclick"],ce,{x:Te[0],y:Te[1]})},_e.multiClickDebounceTime()),q=ce.timeStamp)),dt==null&&!t.dragData.didDrag&&!t.hoverData.selecting&&!t.hoverData.dragged&&!a(ce)&&(_e.$(r).unselect(["tapunselect"]),He.length>0&&t.redrawHint("eles",!0),t.dragData.possibleDragElements=He=_e.collection()),Xe==dt&&!t.dragData.didDrag&&!t.hoverData.selecting&&Xe!=null&&Xe._private.selectable&&(t.hoverData.dragging||(_e.selectionType()==="additive"||ft?Xe.selected()?Xe.unselect(["tapunselect"]):Xe.select(["tapselect"]):ft||(_e.$(r).unmerge(Xe).unselect(["tapunselect"]),Xe.select(["tapselect"]))),t.redrawHint("eles",!0)),t.hoverData.selecting){var kt=_e.collection(t.getAllInBox(Le[0],Le[1],Le[2],Le[3]));t.redrawHint("select",!0),kt.length>0&&t.redrawHint("eles",!0),_e.emit(Pt("boxend"));var Zt=function(xr){return xr.selectable()&&!xr.selected()};_e.selectionType()==="additive"||ft||_e.$(r).unmerge(kt).unselect(),kt.emit(Pt("box")).stdFilter(Zt).select().emit(Pt("boxselect")),t.redraw()}if(t.hoverData.dragging&&(t.hoverData.dragging=!1,t.redrawHint("select",!0),t.redrawHint("eles",!0),t.redraw()),!Le[4]){t.redrawHint("drag",!0),t.redrawHint("eles",!0);var er=dt&&dt.grabbed();T(He),er&&(dt.emit(Pt("freeon")),He.emit(Pt("free")),t.dragData.didDrag&&(dt.emit(Pt("dragfreeon")),He.emit(Pt("dragfree"))))}}Le[4]=0,t.hoverData.down=null,t.hoverData.cxtStarted=!1,t.hoverData.draggingEles=!1,t.hoverData.selecting=!1,t.hoverData.isOverThresholdDrag=!1,t.dragData.didDrag=!1,t.hoverData.dragged=!1,t.hoverData.dragDelta=[],t.hoverData.mdownPos=null,t.hoverData.mdownGPos=null,t.hoverData.which=null}}},!1);var U=[],W=4,Y,Q=1e5,ne=function(ce,ve){for(var _e=0;_e<ce.length;_e++)if(ce[_e]%ve!==0)return!1;return!0},re=function(ce){for(var ve=Math.abs(ce[0]),_e=1;_e<ce.length;_e++)if(Math.abs(ce[_e])!==ve)return!1;return!0},H=function(ce){var ve=!1,_e=ce.deltaY;if(_e==null&&(ce.wheelDeltaY!=null?_e=ce.wheelDeltaY/4:ce.wheelDelta!=null&&(_e=ce.wheelDelta/4)),_e!==0){if(Y==null)if(U.length>=W){var Te=U;if(Y=ne(Te,5),!Y){var Le=Math.abs(Te[0]);Y=re(Te)&&Le>5}if(Y)for(var Xe=0;Xe<Te.length;Xe++)Q=Math.min(Math.abs(Te[Xe]),Q)}else U.push(_e),ve=!0;else Y&&(Q=Math.min(Math.abs(_e),Q));if(!t.scrollingPage){var He=t.cy,dt=He.zoom(),ft=He.pan(),Pt=t.projectIntoViewport(ce.clientX,ce.clientY),qt=[Pt[0]*dt+ft.x,Pt[1]*dt+ft.y];if(t.hoverData.draggingEles||t.hoverData.dragging||t.hoverData.cxtStarted||F()){ce.preventDefault();return}if(He.panningEnabled()&&He.userPanningEnabled()&&He.zoomingEnabled()&&He.userZoomingEnabled()){ce.preventDefault(),t.data.wheelZooming=!0,clearTimeout(t.data.wheelTimeout),t.data.wheelTimeout=setTimeout(function(){t.data.wheelZooming=!1,t.redrawHint("eles",!0),t.redraw()},150);var $t;ve&&Math.abs(_e)>5&&(_e=h_(_e)*5),$t=_e/-250,Y&&($t/=Q,$t*=3),$t=$t*t.wheelSensitivity;var kt=ce.deltaMode===1;kt&&($t*=33);var Zt=He.zoom()*Math.pow(10,$t);ce.type==="gesturechange"&&(Zt=t.gestureStartZoom*ce.scale),He.zoom({level:Zt,renderedPosition:{x:qt[0],y:qt[1]}}),He.emit({type:ce.type==="gesturechange"?"pinchzoom":"scrollzoom",originalEvent:ce,position:{x:Pt[0],y:Pt[1]}})}}}};t.registerBinding(t.container,"wheel",H,!0),t.registerBinding(e,"scroll",function(ce){t.scrollingPage=!0,clearTimeout(t.scrollingPageTimeout),t.scrollingPageTimeout=setTimeout(function(){t.scrollingPage=!1},250)},!0),t.registerBinding(t.container,"gesturestart",function(ce){t.gestureStartZoom=t.cy.zoom(),t.hasTouchStarted||ce.preventDefault()},!0),t.registerBinding(t.container,"gesturechange",function(We){t.hasTouchStarted||H(We)},!0),t.registerBinding(t.container,"mouseout",function(ce){var ve=t.projectIntoViewport(ce.clientX,ce.clientY);t.cy.emit({originalEvent:ce,type:"mouseout",position:{x:ve[0],y:ve[1]}})},!1),t.registerBinding(t.container,"mouseover",function(ce){var ve=t.projectIntoViewport(ce.clientX,ce.clientY);t.cy.emit({originalEvent:ce,type:"mouseover",position:{x:ve[0],y:ve[1]}})},!1);var te,ie,de,ge,ye,ae,pe,le,me,he,xe,we,Ge,qe=function(ce,ve,_e,Te){return Math.sqrt((_e-ce)*(_e-ce)+(Te-ve)*(Te-ve))},wt=function(ce,ve,_e,Te){return(_e-ce)*(_e-ce)+(Te-ve)*(Te-ve)},et;t.registerBinding(t.container,"touchstart",et=function(ce){if(t.hasTouchStarted=!0,!!B(ce)){C(),t.touchData.capture=!0,t.data.bgActivePosistion=void 0;var ve=t.cy,_e=t.touchData.now,Te=t.touchData.earlier;if(ce.touches[0]){var Le=t.projectIntoViewport(ce.touches[0].clientX,ce.touches[0].clientY);_e[0]=Le[0],_e[1]=Le[1]}if(ce.touches[1]){var Le=t.projectIntoViewport(ce.touches[1].clientX,ce.touches[1].clientY);_e[2]=Le[0],_e[3]=Le[1]}if(ce.touches[2]){var Le=t.projectIntoViewport(ce.touches[2].clientX,ce.touches[2].clientY);_e[4]=Le[0],_e[5]=Le[1]}var Xe=function(zt){return{originalEvent:ce,type:zt,position:{x:_e[0],y:_e[1]}}};if(ce.touches[1]){t.touchData.singleTouchMoved=!0,T(t.dragData.touchDragEles);var He=t.findContainerClientCoords();me=He[0],he=He[1],xe=He[2],we=He[3],te=ce.touches[0].clientX-me,ie=ce.touches[0].clientY-he,de=ce.touches[1].clientX-me,ge=ce.touches[1].clientY-he,Ge=0<=te&&te<=xe&&0<=de&&de<=xe&&0<=ie&&ie<=we&&0<=ge&&ge<=we;var dt=ve.pan(),ft=ve.zoom();ye=qe(te,ie,de,ge),ae=wt(te,ie,de,ge),pe=[(te+de)/2,(ie+ge)/2],le=[(pe[0]-dt.x)/ft,(pe[1]-dt.y)/ft];var Pt=200,qt=Pt*Pt;if(ae<qt&&!ce.touches[2]){var $t=t.findNearestElement(_e[0],_e[1],!0,!0),kt=t.findNearestElement(_e[2],_e[3],!0,!0);$t&&$t.isNode()?($t.activate().emit(Xe("cxttapstart")),t.touchData.start=$t):kt&&kt.isNode()?(kt.activate().emit(Xe("cxttapstart")),t.touchData.start=kt):ve.emit(Xe("cxttapstart")),t.touchData.start&&(t.touchData.start._private.grabbed=!1),t.touchData.cxt=!0,t.touchData.cxtDragged=!1,t.data.bgActivePosistion=void 0,t.redraw();return}}if(ce.touches[2])ve.boxSelectionEnabled()&&ce.preventDefault();else if(!ce.touches[1]){if(ce.touches[0]){var Zt=t.findNearestElements(_e[0],_e[1],!0,!0),er=Zt[0];if(er!=null&&(er.activate(),t.touchData.start=er,t.touchData.starts=Zt,t.nodeIsGrabbable(er))){var Ar=t.dragData.touchDragEles=ve.collection(),xr=null;t.redrawHint("eles",!0),t.redrawHint("drag",!0),er.selected()?(xr=ve.$(function(rr){return rr.selected()&&t.nodeIsGrabbable(rr)}),S(xr,{addToList:Ar})):w(er,{addToList:Ar}),f(er),er.emit(Xe("grabon")),xr?xr.forEach(function(rr){rr.emit(Xe("grab"))}):er.emit(Xe("grab"))}i(er,["touchstart","tapstart","vmousedown"],ce,{x:_e[0],y:_e[1]}),er==null&&(t.data.bgActivePosistion={x:Le[0],y:Le[1]},t.redrawHint("select",!0),t.redraw()),t.touchData.singleTouchMoved=!1,t.touchData.singleTouchStartTime=+new Date,clearTimeout(t.touchData.tapholdTimeout),t.touchData.tapholdTimeout=setTimeout(function(){t.touchData.singleTouchMoved===!1&&!t.pinching&&!t.touchData.selecting&&i(t.touchData.start,["taphold"],ce,{x:_e[0],y:_e[1]})},t.tapholdDuration)}}if(ce.touches.length>=1){for(var $e=t.touchData.startPosition=[null,null,null,null,null,null],yt=0;yt<_e.length;yt++)$e[yt]=Te[yt]=_e[yt];var Et=ce.touches[0];t.touchData.startGPosition=[Et.clientX,Et.clientY]}}},!1);var at;t.registerBinding(e,"touchmove",at=function(ce){var ve=t.touchData.capture;if(!(!ve&&!B(ce))){var _e=t.selection,Te=t.cy,Le=t.touchData.now,Xe=t.touchData.earlier,He=Te.zoom();if(ce.touches[0]){var dt=t.projectIntoViewport(ce.touches[0].clientX,ce.touches[0].clientY);Le[0]=dt[0],Le[1]=dt[1]}if(ce.touches[1]){var dt=t.projectIntoViewport(ce.touches[1].clientX,ce.touches[1].clientY);Le[2]=dt[0],Le[3]=dt[1]}if(ce.touches[2]){var dt=t.projectIntoViewport(ce.touches[2].clientX,ce.touches[2].clientY);Le[4]=dt[0],Le[5]=dt[1]}var ft=function(Lr){return{originalEvent:ce,type:Lr,position:{x:Le[0],y:Le[1]}}},Pt=t.touchData.startGPosition,qt;if(ve&&ce.touches[0]&&Pt){for(var $t=[],kt=0;kt<Le.length;kt++)$t[kt]=Le[kt]-Xe[kt];var Zt=ce.touches[0].clientX-Pt[0],er=Zt*Zt,Ar=ce.touches[0].clientY-Pt[1],xr=Ar*Ar,$e=er+xr;qt=$e>=t.touchTapThreshold2}if(ve&&t.touchData.cxt){ce.preventDefault();var yt=ce.touches[0].clientX-me,Et=ce.touches[0].clientY-he,rr=ce.touches[1].clientX-me,zt=ce.touches[1].clientY-he,lt=wt(yt,Et,rr,zt),Pr=lt/ae,zr=150,wi=zr*zr,Va=1.5,mo=Va*Va;if(Pr>=mo||lt>=wi){t.touchData.cxt=!1,t.data.bgActivePosistion=void 0,t.redrawHint("select",!0);var Si=ft("cxttapend");t.touchData.start?(t.touchData.start.unactivate().emit(Si),t.touchData.start=null):Te.emit(Si)}}if(ve&&t.touchData.cxt){var Si=ft("cxtdrag");t.data.bgActivePosistion=void 0,t.redrawHint("select",!0),t.touchData.start?t.touchData.start.emit(Si):Te.emit(Si),t.touchData.start&&(t.touchData.start._private.grabbed=!1),t.touchData.cxtDragged=!0;var gn=t.findNearestElement(Le[0],Le[1],!0,!0);(!t.touchData.cxtOver||gn!==t.touchData.cxtOver)&&(t.touchData.cxtOver&&t.touchData.cxtOver.emit(ft("cxtdragout")),t.touchData.cxtOver=gn,gn&&gn.emit(ft("cxtdragover")))}else if(ve&&ce.touches[2]&&Te.boxSelectionEnabled())ce.preventDefault(),t.data.bgActivePosistion=void 0,this.lastThreeTouch=+new Date,t.touchData.selecting||Te.emit(ft("boxstart")),t.touchData.selecting=!0,t.touchData.didSelect=!0,_e[4]=1,!_e||_e.length===0||_e[0]===void 0?(_e[0]=(Le[0]+Le[2]+Le[4])/3,_e[1]=(Le[1]+Le[3]+Le[5])/3,_e[2]=(Le[0]+Le[2]+Le[4])/3+1,_e[3]=(Le[1]+Le[3]+Le[5])/3+1):(_e[2]=(Le[0]+Le[2]+Le[4])/3,_e[3]=(Le[1]+Le[3]+Le[5])/3),t.redrawHint("select",!0),t.redraw();else if(ve&&ce.touches[1]&&!t.touchData.didSelect&&Te.zoomingEnabled()&&Te.panningEnabled()&&Te.userZoomingEnabled()&&Te.userPanningEnabled()){ce.preventDefault(),t.data.bgActivePosistion=void 0,t.redrawHint("select",!0);var Pn=t.dragData.touchDragEles;if(Pn){t.redrawHint("drag",!0);for(var ki=0;ki<Pn.length;ki++){var go=Pn[ki]._private;go.grabbed=!1,go.rscratch.inDragLayer=!1}}var Oi=t.touchData.start,yt=ce.touches[0].clientX-me,Et=ce.touches[0].clientY-he,rr=ce.touches[1].clientX-me,zt=ce.touches[1].clientY-he,Au=qe(yt,Et,rr,zt),Lu=Au/ye;if(Ge){var yf=yt-te,Dl=Et-ie,cn=rr-de,Ru=zt-ge,Ys=(yf+cn)/2,Il=(Dl+Ru)/2,Ha=Te.zoom(),Zo=Ha*Lu,ma=Te.pan(),ga=le[0]*Ha+ma.x,_n=le[1]*Ha+ma.y,Mr={x:-Zo/Ha*(ga-ma.x-Ys)+ga,y:-Zo/Ha*(_n-ma.y-Il)+_n};if(Oi&&Oi.active()){var Pn=t.dragData.touchDragEles;T(Pn),t.redrawHint("drag",!0),t.redrawHint("eles",!0),Oi.unactivate().emit(ft("freeon")),Pn.emit(ft("free")),t.dragData.didDrag&&(Oi.emit(ft("dragfreeon")),Pn.emit(ft("dragfree")))}Te.viewport({zoom:Zo,pan:Mr,cancelOnFailedZoom:!0}),Te.emit(ft("pinchzoom")),ye=Au,te=yt,ie=Et,de=rr,ge=zt,t.pinching=!0}if(ce.touches[0]){var dt=t.projectIntoViewport(ce.touches[0].clientX,ce.touches[0].clientY);Le[0]=dt[0],Le[1]=dt[1]}if(ce.touches[1]){var dt=t.projectIntoViewport(ce.touches[1].clientX,ce.touches[1].clientY);Le[2]=dt[0],Le[3]=dt[1]}if(ce.touches[2]){var dt=t.projectIntoViewport(ce.touches[2].clientX,ce.touches[2].clientY);Le[4]=dt[0],Le[5]=dt[1]}}else if(ce.touches[0]&&!t.touchData.didSelect){var ht=t.touchData.start,kr=t.touchData.last,gn;if(!t.hoverData.draggingEles&&!t.swipePanning&&(gn=t.findNearestElement(Le[0],Le[1],!0,!0)),ve&&ht!=null&&ce.preventDefault(),ve&&ht!=null&&t.nodeIsDraggable(ht))if(qt){var Pn=t.dragData.touchDragEles,vn=!t.dragData.didDrag;vn&&S(Pn,{inDragLayer:!0}),t.dragData.didDrag=!0;var Qr={x:0,y:0};if(gt($t[0])&&gt($t[1])&&(Qr.x+=$t[0],Qr.y+=$t[1],vn)){t.redrawHint("eles",!0);var Ur=t.touchData.dragDelta;Ur&&gt(Ur[0])&&gt(Ur[1])&&(Qr.x+=Ur[0],Qr.y+=Ur[1])}t.hoverData.draggingEles=!0,Pn.silentShift(Qr).emit(ft("position")).emit(ft("drag")),t.redrawHint("drag",!0),t.touchData.startPosition[0]==Xe[0]&&t.touchData.startPosition[1]==Xe[1]&&t.redrawHint("eles",!0),t.redraw()}else{var Ur=t.touchData.dragDelta=t.touchData.dragDelta||[];Ur.length===0?(Ur.push($t[0]),Ur.push($t[1])):(Ur[0]+=$t[0],Ur[1]+=$t[1])}if(i(ht||gn,["touchmove","tapdrag","vmousemove"],ce,{x:Le[0],y:Le[1]}),(!ht||!ht.grabbed())&&gn!=kr&&(kr&&kr.emit(ft("tapdragout")),gn&&gn.emit(ft("tapdragover"))),t.touchData.last=gn,ve)for(var ki=0;ki<Le.length;ki++)Le[ki]&&t.touchData.startPosition[ki]&&qt&&(t.touchData.singleTouchMoved=!0);if(ve&&(ht==null||ht.pannable())&&Te.panningEnabled()&&Te.userPanningEnabled()){var va=s(ht,t.touchData.starts);va&&(ce.preventDefault(),t.data.bgActivePosistion||(t.data.bgActivePosistion=Dp(t.touchData.startPosition)),t.swipePanning?(Te.panBy({x:$t[0]*He,y:$t[1]*He}),Te.emit(ft("dragpan"))):qt&&(t.swipePanning=!0,Te.panBy({x:Zt*He,y:Ar*He}),Te.emit(ft("dragpan")),ht&&(ht.unactivate(),t.redrawHint("select",!0),t.touchData.start=null)));var dt=t.projectIntoViewport(ce.touches[0].clientX,ce.touches[0].clientY);Le[0]=dt[0],Le[1]=dt[1]}}for(var kt=0;kt<Le.length;kt++)Xe[kt]=Le[kt];ve&&ce.touches.length>0&&!t.hoverData.draggingEles&&!t.swipePanning&&t.data.bgActivePosistion!=null&&(t.data.bgActivePosistion=void 0,t.redrawHint("select",!0),t.redraw())}},!1);var je;t.registerBinding(e,"touchcancel",je=function(ce){var ve=t.touchData.start;t.touchData.capture=!1,ve&&ve.unactivate()});var Re,nt,Ce,Fe;if(t.registerBinding(e,"touchend",Re=function(ce){var ve=t.touchData.start,_e=t.touchData.capture;if(_e)ce.touches.length===0&&(t.touchData.capture=!1),ce.preventDefault();else return;var Te=t.selection;t.swipePanning=!1,t.hoverData.draggingEles=!1;var Le=t.cy,Xe=Le.zoom(),He=t.touchData.now,dt=t.touchData.earlier;if(ce.touches[0]){var ft=t.projectIntoViewport(ce.touches[0].clientX,ce.touches[0].clientY);He[0]=ft[0],He[1]=ft[1]}if(ce.touches[1]){var ft=t.projectIntoViewport(ce.touches[1].clientX,ce.touches[1].clientY);He[2]=ft[0],He[3]=ft[1]}if(ce.touches[2]){var ft=t.projectIntoViewport(ce.touches[2].clientX,ce.touches[2].clientY);He[4]=ft[0],He[5]=ft[1]}var Pt=function(wi){return{originalEvent:ce,type:wi,position:{x:He[0],y:He[1]}}};ve&&ve.unactivate();var qt;if(t.touchData.cxt){if(qt=Pt("cxttapend"),ve?ve.emit(qt):Le.emit(qt),!t.touchData.cxtDragged){var $t=Pt("cxttap");ve?ve.emit($t):Le.emit($t)}t.touchData.start&&(t.touchData.start._private.grabbed=!1),t.touchData.cxt=!1,t.touchData.start=null,t.redraw();return}if(!ce.touches[2]&&Le.boxSelectionEnabled()&&t.touchData.selecting){t.touchData.selecting=!1;var kt=Le.collection(t.getAllInBox(Te[0],Te[1],Te[2],Te[3]));Te[0]=void 0,Te[1]=void 0,Te[2]=void 0,Te[3]=void 0,Te[4]=0,t.redrawHint("select",!0),Le.emit(Pt("boxend"));var Zt=function(wi){return wi.selectable()&&!wi.selected()};kt.emit(Pt("box")).stdFilter(Zt).select().emit(Pt("boxselect")),kt.nonempty()&&t.redrawHint("eles",!0),t.redraw()}if(ve?.unactivate(),ce.touches[2])t.data.bgActivePosistion=void 0,t.redrawHint("select",!0);else if(!ce.touches[1]){if(!ce.touches[0]){if(!ce.touches[0]){t.data.bgActivePosistion=void 0,t.redrawHint("select",!0);var er=t.dragData.touchDragEles;if(ve!=null){var Ar=ve._private.grabbed;T(er),t.redrawHint("drag",!0),t.redrawHint("eles",!0),Ar&&(ve.emit(Pt("freeon")),er.emit(Pt("free")),t.dragData.didDrag&&(ve.emit(Pt("dragfreeon")),er.emit(Pt("dragfree")))),i(ve,["touchend","tapend","vmouseup","tapdragout"],ce,{x:He[0],y:He[1]}),ve.unactivate(),t.touchData.start=null}else{var xr=t.findNearestElement(He[0],He[1],!0,!0);i(xr,["touchend","tapend","vmouseup","tapdragout"],ce,{x:He[0],y:He[1]})}var $e=t.touchData.startPosition[0]-He[0],yt=$e*$e,Et=t.touchData.startPosition[1]-He[1],rr=Et*Et,zt=yt+rr,lt=zt*Xe*Xe;t.touchData.singleTouchMoved||(ve||Le.$(":selected").unselect(["tapunselect"]),i(ve,["tap","vclick"],ce,{x:He[0],y:He[1]}),nt=!1,ce.timeStamp-Fe<=Le.multiClickDebounceTime()?(Ce&&clearTimeout(Ce),nt=!0,Fe=null,i(ve,["dbltap","vdblclick"],ce,{x:He[0],y:He[1]})):(Ce=setTimeout(function(){nt||i(ve,["onetap","voneclick"],ce,{x:He[0],y:He[1]})},Le.multiClickDebounceTime()),Fe=ce.timeStamp)),ve!=null&&!t.dragData.didDrag&&ve._private.selectable&&lt<t.touchTapThreshold2&&!t.pinching&&(Le.selectionType()==="single"?(Le.$(r).unmerge(ve).unselect(["tapunselect"]),ve.select(["tapselect"])):ve.selected()?ve.unselect(["tapunselect"]):ve.select(["tapselect"]),t.redrawHint("eles",!0)),t.touchData.singleTouchMoved=!0}}}for(var Pr=0;Pr<He.length;Pr++)dt[Pr]=He[Pr];t.dragData.didDrag=!1,ce.touches.length===0&&(t.touchData.dragDelta=[],t.touchData.startPosition=[null,null,null,null,null,null],t.touchData.startGPosition=null,t.touchData.didSelect=!1),ce.touches.length<2&&(ce.touches.length===1&&(t.touchData.startGPosition=[ce.touches[0].clientX,ce.touches[0].clientY]),t.pinching=!1,t.redrawHint("eles",!0),t.redraw())},!1),typeof TouchEvent>"u"){var Ke=[],pt=function(ce){return{clientX:ce.clientX,clientY:ce.clientY,force:1,identifier:ce.pointerId,pageX:ce.pageX,pageY:ce.pageY,radiusX:ce.width/2,radiusY:ce.height/2,screenX:ce.screenX,screenY:ce.screenY,target:ce.target}},vt=function(ce){return{event:ce,touch:pt(ce)}},At=function(ce){Ke.push(vt(ce))},Ut=function(ce){for(var ve=0;ve<Ke.length;ve++){var _e=Ke[ve];if(_e.event.pointerId===ce.pointerId){Ke.splice(ve,1);return}}},nr=function(ce){var ve=Ke.filter(function(_e){return _e.event.pointerId===ce.pointerId})[0];ve.event=ce,ve.touch=pt(ce)},Ct=function(ce){ce.touches=Ke.map(function(ve){return ve.touch})},ct=function(ce){return ce.pointerType==="mouse"||ce.pointerType===4};t.registerBinding(t.container,"pointerdown",function(We){ct(We)||(We.preventDefault(),At(We),Ct(We),et(We))}),t.registerBinding(t.container,"pointerup",function(We){ct(We)||(Ut(We),Ct(We),Re(We))}),t.registerBinding(t.container,"pointercancel",function(We){ct(We)||(Ut(We),Ct(We),je(We))}),t.registerBinding(t.container,"pointermove",function(We){ct(We)||(We.preventDefault(),nr(We),Ct(We),at(We))})}};var kc={};kc.generatePolygon=function(t,e){return this.nodeShapes[t]={renderer:this,name:t,points:e,draw:function(n,i,a,s,o,l){this.renderer.nodeShapeImpl("polygon",n,i,a,s,o,this.points)},intersectLine:function(n,i,a,s,o,l,u,c){return Ev(o,l,this.points,n,i,a/2,s/2,u)},checkPoint:function(n,i,a,s,o,l,u,c){return xc(n,i,this.points,l,u,s,o,[0,-1],a)},hasMiterBounds:t!=="rectangle",miterBounds:function(n,i,a,s,o,l){return O9(this.points,n,i,a,s,o)}}};kc.generateEllipse=function(){return this.nodeShapes.ellipse={renderer:this,name:"ellipse",draw:function(e,r,n,i,a,s){this.renderer.nodeShapeImpl(this.name,e,r,n,i,a)},intersectLine:function(e,r,n,i,a,s,o,l){return G9(a,s,e,r,n/2+o,i/2+o)},checkPoint:function(e,r,n,i,a,s,o,l){return ih(e,r,i,a,s,o,n)}}};kc.generateRoundPolygon=function(t,e){return this.nodeShapes[t]={renderer:this,name:t,points:e,getOrCreateCorners:function(n,i,a,s,o,l,u){if(l[u]!==void 0&&l[u+"-cx"]===n&&l[u+"-cy"]===i)return l[u];l[u]=new Array(e.length/2),l[u+"-cx"]=n,l[u+"-cy"]=i;var c=a/2,f=s/2;o=o==="auto"?gA(a,s):o;for(var p=new Array(e.length/2),v=0;v<e.length/2;v++)p[v]={x:n+c*e[v*2],y:i+f*e[v*2+1]};var y,S,w,T,_=p.length;for(S=p[_-1],y=0;y<_;y++)w=p[y%_],T=p[(y+1)%_],l[u][y]=E_(S,w,T,o),S=w,w=T;return l[u]},draw:function(n,i,a,s,o,l,u){this.renderer.nodeShapeImpl("round-polygon",n,i,a,s,o,this.points,this.getOrCreateCorners(i,a,s,o,l,u,"drawCorners"))},intersectLine:function(n,i,a,s,o,l,u,c,f){return H9(o,l,this.points,n,i,a,s,u,this.getOrCreateCorners(n,i,a,s,c,f,"corners"))},checkPoint:function(n,i,a,s,o,l,u,c,f){return U9(n,i,this.points,l,u,s,o,this.getOrCreateCorners(l,u,s,o,c,f,"corners"))}}};kc.generateRoundRectangle=function(){return this.nodeShapes["round-rectangle"]=this.nodeShapes.roundrectangle={renderer:this,name:"round-rectangle",points:ks(4,0),draw:function(e,r,n,i,a,s){this.renderer.nodeShapeImpl(this.name,e,r,n,i,a,this.points,s)},intersectLine:function(e,r,n,i,a,s,o,l){return pA(a,s,e,r,n,i,o,l)},checkPoint:function(e,r,n,i,a,s,o,l){var u=i/2,c=a/2;l=l==="auto"?Jd(i,a):l,l=Math.min(u,c,l);var f=l*2;return!!(xc(e,r,this.points,s,o,i,a-f,[0,-1],n)||xc(e,r,this.points,s,o,i-f,a,[0,-1],n)||ih(e,r,f,f,s-u+l,o-c+l,n)||ih(e,r,f,f,s+u-l,o-c+l,n)||ih(e,r,f,f,s+u-l,o+c-l,n)||ih(e,r,f,f,s-u+l,o+c-l,n))}}};kc.generateCutRectangle=function(){return this.nodeShapes["cut-rectangle"]=this.nodeShapes.cutrectangle={renderer:this,name:"cut-rectangle",cornerLength:m_(),points:ks(4,0),draw:function(e,r,n,i,a,s){this.renderer.nodeShapeImpl(this.name,e,r,n,i,a,null,s)},generateCutTrianglePts:function(e,r,n,i,a){var s=a==="auto"?this.cornerLength:a,o=r/2,l=e/2,u=n-l,c=n+l,f=i-o,p=i+o;return{topLeft:[u,f+s,u+s,f,u+s,f+s],topRight:[c-s,f,c,f+s,c-s,f+s],bottomRight:[c,p-s,c-s,p,c-s,p-s],bottomLeft:[u+s,p,u,p-s,u+s,p-s]}},intersectLine:function(e,r,n,i,a,s,o,l){var u=this.generateCutTrianglePts(n+2*o,i+2*o,e,r,l),c=[].concat.apply([],[u.topLeft.splice(0,4),u.topRight.splice(0,4),u.bottomRight.splice(0,4),u.bottomLeft.splice(0,4)]);return Ev(a,s,c,e,r)},checkPoint:function(e,r,n,i,a,s,o,l){var u=l==="auto"?this.cornerLength:l;if(xc(e,r,this.points,s,o,i,a-2*u,[0,-1],n)||xc(e,r,this.points,s,o,i-2*u,a,[0,-1],n))return!0;var c=this.generateCutTrianglePts(i,a,s,o);return Vs(e,r,c.topLeft)||Vs(e,r,c.topRight)||Vs(e,r,c.bottomRight)||Vs(e,r,c.bottomLeft)}}};kc.generateBarrel=function(){return this.nodeShapes.barrel={renderer:this,name:"barrel",points:ks(4,0),draw:function(e,r,n,i,a,s){this.renderer.nodeShapeImpl(this.name,e,r,n,i,a)},intersectLine:function(e,r,n,i,a,s,o,l){var u=.15,c=.5,f=.85,p=this.generateBarrelBezierPts(n+2*o,i+2*o,e,r),v=function(w){var T=zp({x:w[0],y:w[1]},{x:w[2],y:w[3]},{x:w[4],y:w[5]},u),_=zp({x:w[0],y:w[1]},{x:w[2],y:w[3]},{x:w[4],y:w[5]},c),C=zp({x:w[0],y:w[1]},{x:w[2],y:w[3]},{x:w[4],y:w[5]},f);return[w[0],w[1],T.x,T.y,_.x,_.y,C.x,C.y,w[4],w[5]]},y=[].concat(v(p.topLeft),v(p.topRight),v(p.bottomRight),v(p.bottomLeft));return Ev(a,s,y,e,r)},generateBarrelBezierPts:function(e,r,n,i){var a=r/2,s=e/2,o=n-s,l=n+s,u=i-a,c=i+a,f=US(e,r),p=f.heightOffset,v=f.widthOffset,y=f.ctrlPtOffsetPct*e,S={topLeft:[o,u+p,o+y,u,o+v,u],topRight:[l-v,u,l-y,u,l,u+p],bottomRight:[l,c-p,l-y,c,l-v,c],bottomLeft:[o+v,c,o+y,c,o,c-p]};return S.topLeft.isTop=!0,S.topRight.isTop=!0,S.bottomLeft.isBottom=!0,S.bottomRight.isBottom=!0,S},checkPoint:function(e,r,n,i,a,s,o,l){var u=US(i,a),c=u.heightOffset,f=u.widthOffset;if(xc(e,r,this.points,s,o,i,a-2*c,[0,-1],n)||xc(e,r,this.points,s,o,i-2*f,a,[0,-1],n))return!0;for(var p=this.generateBarrelBezierPts(i,a,s,o),v=function(D,F,B){var $=B[4],Z=B[2],I=B[0],q=B[5],U=B[1],W=Math.min($,I),Y=Math.max($,I),Q=Math.min(q,U),ne=Math.max(q,U);if(W<=D&&D<=Y&&Q<=F&&F<=ne){var re=W9($,Z,I),H=j9(re[0],re[1],re[2],D),te=H.filter(function(ie){return 0<=ie&&ie<=1});if(te.length>0)return te[0]}return null},y=Object.keys(p),S=0;S<y.length;S++){var w=y[S],T=p[w],_=v(e,r,T);if(_!=null){var C=T[5],N=T[3],A=T[1],O=sa(C,N,A,_);if(T.isTop&&O<=r||T.isBottom&&r<=O)return!0}}return!1}}};kc.generateBottomRoundrectangle=function(){return this.nodeShapes["bottom-round-rectangle"]=this.nodeShapes.bottomroundrectangle={renderer:this,name:"bottom-round-rectangle",points:ks(4,0),draw:function(e,r,n,i,a,s){this.renderer.nodeShapeImpl(this.name,e,r,n,i,a,this.points,s)},intersectLine:function(e,r,n,i,a,s,o,l){var u=e-(n/2+o),c=r-(i/2+o),f=c,p=e+(n/2+o),v=jd(a,s,e,r,u,c,p,f,!1);return v.length>0?v:pA(a,s,e,r,n,i,o,l)},checkPoint:function(e,r,n,i,a,s,o,l){l=l==="auto"?Jd(i,a):l;var u=2*l;if(xc(e,r,this.points,s,o,i,a-u,[0,-1],n)||xc(e,r,this.points,s,o,i-u,a,[0,-1],n))return!0;var c=i/2+2*n,f=a/2+2*n,p=[s-c,o-f,s-c,o,s+c,o,s+c,o-f];return!!(Vs(e,r,p)||ih(e,r,u,u,s+i/2-l,o+a/2-l,n)||ih(e,r,u,u,s-i/2+l,o+a/2-l,n))}}};kc.registerNodeShapes=function(){var t=this.nodeShapes={},e=this;this.generateEllipse(),this.generatePolygon("triangle",ks(3,0)),this.generateRoundPolygon("round-triangle",ks(3,0)),this.generatePolygon("rectangle",ks(4,0)),t.square=t.rectangle,this.generateRoundRectangle(),this.generateCutRectangle(),this.generateBarrel(),this.generateBottomRoundrectangle();{var r=[0,1,1,0,0,-1,-1,0];this.generatePolygon("diamond",r),this.generateRoundPolygon("round-diamond",r)}this.generatePolygon("pentagon",ks(5,0)),this.generateRoundPolygon("round-pentagon",ks(5,0)),this.generatePolygon("hexagon",ks(6,0)),this.generateRoundPolygon("round-hexagon",ks(6,0)),this.generatePolygon("heptagon",ks(7,0)),this.generateRoundPolygon("round-heptagon",ks(7,0)),this.generatePolygon("octagon",ks(8,0)),this.generateRoundPolygon("round-octagon",ks(8,0));var n=new Array(20);{var i=zS(5,0),a=zS(5,Math.PI/5),s=.5*(3-Math.sqrt(5));s*=1.57;for(var o=0;o<a.length/2;o++)a[o*2]*=s,a[o*2+1]*=s;for(var o=0;o<20/4;o++)n[o*4]=i[o*2],n[o*4+1]=i[o*2+1],n[o*4+2]=a[o*2],n[o*4+3]=a[o*2+1]}n=mA(n),this.generatePolygon("star",n),this.generatePolygon("vee",[-1,-1,0,-.333,1,-1,0,1]),this.generatePolygon("rhomboid",[-1,-1,.333,-1,1,1,-.333,1]),this.generatePolygon("right-rhomboid",[-.333,-1,1,-1,.333,1,-1,1]),this.nodeShapes.concavehexagon=this.generatePolygon("concave-hexagon",[-1,-.95,-.75,0,-1,.95,1,.95,.75,0,1,-.95]);{var l=[-1,-1,.25,-1,1,0,.25,1,-1,1];this.generatePolygon("tag",l),this.generateRoundPolygon("round-tag",l)}t.makePolygon=function(u){var c=u.join("$"),f="polygon-"+c,p;return(p=this[f])?p:e.generatePolygon(f,u)}};var l0={};l0.timeToRender=function(){return this.redrawTotalTime/this.redrawCount};l0.redraw=function(t){t=t||cA();var e=this;e.averageRedrawTime===void 0&&(e.averageRedrawTime=0),e.lastRedrawTime===void 0&&(e.lastRedrawTime=0),e.lastDrawTime===void 0&&(e.lastDrawTime=0),e.requestedFrame=!0,e.renderOptions=t};l0.beforeRender=function(t,e){if(!this.destroyed){e==null&&Gn("Priority is not optional for beforeRender");var r=this.beforeRenderCallbacks;r.push({fn:t,priority:e}),r.sort(function(n,i){return i.priority-n.priority})}};var e5=function(e,r,n){for(var i=e.beforeRenderCallbacks,a=0;a<i.length;a++)i[a].fn(r,n)};l0.startRenderLoop=function(){var t=this,e=t.cy;if(!t.renderLoopStarted){t.renderLoopStarted=!0;var r=function(i){if(!t.destroyed){if(!e.batching())if(t.requestedFrame&&!t.skipFrame){e5(t,!0,i);var a=yc();t.render(t.renderOptions);var s=t.lastDrawTime=yc();t.averageRedrawTime===void 0&&(t.averageRedrawTime=s-a),t.redrawCount===void 0&&(t.redrawCount=0),t.redrawCount++,t.redrawTotalTime===void 0&&(t.redrawTotalTime=0);var o=s-a;t.redrawTotalTime+=o,t.lastRedrawTime=o,t.averageRedrawTime=t.averageRedrawTime/2+o/2,t.requestedFrame=!1}else e5(t,!1,i);t.skipFrame=!1,cx(r)}};cx(r)}};var oU=function(e){this.init(e)},gL=oU,vm=gL.prototype;vm.clientFunctions=["redrawHint","render","renderTo","matchCanvasSize","nodeShapeImpl","arrowShapeImpl"];vm.init=function(t){var e=this;e.options=t,e.cy=t.cy;var r=e.container=t.cy.container(),n=e.cy.window();if(n){var i=n.document,a=i.head,s="__________cytoscape_stylesheet",o="__________cytoscape_container",l=i.getElementById(s)!=null;if(r.className.indexOf(o)<0&&(r.className=(r.className||"")+" "+o),!l){var u=i.createElement("style");u.id=s,u.textContent="."+o+" { position: relative; }",a.insertBefore(u,a.children[0])}var c=n.getComputedStyle(r),f=c.getPropertyValue("position");f==="static"&&Yr("A Cytoscape container has style position:static and so can not use UI extensions properly")}e.selection=[void 0,void 0,void 0,void 0,0],e.bezierProjPcts=[.05,.225,.4,.5,.6,.775,.95],e.hoverData={down:null,last:null,downTime:null,triggerMode:null,dragging:!1,initialPan:[null,null],capture:!1},e.dragData={possibleDragElements:[]},e.touchData={start:null,capture:!1,startPosition:[null,null,null,null,null,null],singleTouchStartTime:null,singleTouchMoved:!0,now:[null,null,null,null,null,null],earlier:[null,null,null,null,null,null]},e.redraws=0,e.showFps=t.showFps,e.debug=t.debug,e.webgl=t.webgl,e.hideEdgesOnViewport=t.hideEdgesOnViewport,e.textureOnViewport=t.textureOnViewport,e.wheelSensitivity=t.wheelSensitivity,e.motionBlurEnabled=t.motionBlur,e.forcedPixelRatio=gt(t.pixelRatio)?t.pixelRatio:null,e.motionBlur=t.motionBlur,e.motionBlurOpacity=t.motionBlurOpacity,e.motionBlurTransparency=1-e.motionBlurOpacity,e.motionBlurPxRatio=1,e.mbPxRBlurry=1,e.minMbLowQualFrames=4,e.fullQualityMb=!1,e.clearedForMotionBlur=[],e.desktopTapThreshold=t.desktopTapThreshold,e.desktopTapThreshold2=t.desktopTapThreshold*t.desktopTapThreshold,e.touchTapThreshold=t.touchTapThreshold,e.touchTapThreshold2=t.touchTapThreshold*t.touchTapThreshold,e.tapholdDuration=500,e.bindings=[],e.beforeRenderCallbacks=[],e.beforeRenderPriorities={animations:400,eleCalcs:300,eleTxrDeq:200,lyrTxrDeq:150,lyrTxrSkip:100},e.registerNodeShapes(),e.registerArrowShapes(),e.registerCalculationListeners()};vm.notify=function(t,e){var r=this,n=r.cy;if(!this.destroyed){if(t==="init"){r.load();return}if(t==="destroy"){r.destroy();return}(t==="add"||t==="remove"||t==="move"&&n.hasCompoundNodes()||t==="load"||t==="zorder"||t==="mount")&&r.invalidateCachedZSortedEles(),t==="viewport"&&r.redrawHint("select",!0),t==="gc"&&r.redrawHint("gc",!0),(t==="load"||t==="resize"||t==="mount")&&(r.invalidateContainerClientCoordsCache(),r.matchCanvasSize(r.container)),r.redrawHint("eles",!0),r.redrawHint("drag",!0),this.startRenderLoop(),this.redraw()}};vm.destroy=function(){var t=this;t.destroyed=!0,t.cy.stopAnimationLoop();for(var e=0;e<t.bindings.length;e++){var r=t.bindings[e],n=r,i=n.target;(i.off||i.removeEventListener).apply(i,n.args)}if(t.bindings=[],t.beforeRenderCallbacks=[],t.onUpdateEleCalcsFns=[],t.removeObserver&&t.removeObserver.disconnect(),t.styleObserver&&t.styleObserver.disconnect(),t.resizeObserver&&t.resizeObserver.disconnect(),t.labelCalcDiv)try{document.body.removeChild(t.labelCalcDiv)}catch{}};vm.isHeadless=function(){return!1};[C_,pL,mL,gm,kc,l0].forEach(function(t){Jt(vm,t)});var m2=1e3/60,vL={setupDequeueing:function(e){return function(){var n=this,i=this.renderer;if(!n.dequeueingSetup){n.dequeueingSetup=!0;var a=n0(function(){i.redrawHint("eles",!0),i.redrawHint("drag",!0),i.redraw()},e.deqRedrawThreshold),s=function(u,c){var f=yc(),p=i.averageRedrawTime,v=i.lastRedrawTime,y=[],S=i.cy.extent(),w=i.getPixelRatio();for(u||i.flushRenderedStyleQueue();;){var T=yc(),_=T-f,C=T-c;if(v<m2){var N=m2-(u?p:0);if(C>=e.deqFastCost*N)break}else if(u){if(_>=e.deqCost*v||_>=e.deqAvgCost*p)break}else if(C>=e.deqNoDrawCost*m2)break;var A=e.deq(n,w,S);if(A.length>0)for(var O=0;O<A.length;O++)y.push(A[O]);else break}y.length>0&&(e.onDeqd(n,y),!u&&e.shouldRedraw(n,y,w,S)&&a())},o=e.priority||c_;i.beforeRender(s,o(n))}}}},lU=(function(){function t(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:dx;lf(this,t),this.idsByKey=new fc,this.keyForId=new fc,this.cachesByLvl=new fc,this.lvls=[],this.getKey=e,this.doesEleInvalidateKey=r}return uf(t,[{key:"getIdsFor",value:function(r){r==null&&Gn("Can not get id list for null key");var n=this.idsByKey,i=this.idsByKey.get(r);return i||(i=new fm,n.set(r,i)),i}},{key:"addIdForKey",value:function(r,n){r!=null&&this.getIdsFor(r).add(n)}},{key:"deleteIdForKey",value:function(r,n){r!=null&&this.getIdsFor(r).delete(n)}},{key:"getNumberOfIdsForKey",value:function(r){return r==null?0:this.getIdsFor(r).size}},{key:"updateKeyMappingFor",value:function(r){var n=r.id(),i=this.keyForId.get(n),a=this.getKey(r);this.deleteIdForKey(i,n),this.addIdForKey(a,n),this.keyForId.set(n,a)}},{key:"deleteKeyMappingFor",value:function(r){var n=r.id(),i=this.keyForId.get(n);this.deleteIdForKey(i,n),this.keyForId.delete(n)}},{key:"keyHasChangedFor",value:function(r){var n=r.id(),i=this.keyForId.get(n),a=this.getKey(r);return i!==a}},{key:"isInvalid",value:function(r){return this.keyHasChangedFor(r)||this.doesEleInvalidateKey(r)}},{key:"getCachesAt",value:function(r){var n=this.cachesByLvl,i=this.lvls,a=n.get(r);return a||(a=new fc,n.set(r,a),i.push(r)),a}},{key:"getCache",value:function(r,n){return this.getCachesAt(n).get(r)}},{key:"get",value:function(r,n){var i=this.getKey(r),a=this.getCache(i,n);return a!=null&&this.updateKeyMappingFor(r),a}},{key:"getForCachedKey",value:function(r,n){var i=this.keyForId.get(r.id()),a=this.getCache(i,n);return a}},{key:"hasCache",value:function(r,n){return this.getCachesAt(n).has(r)}},{key:"has",value:function(r,n){var i=this.getKey(r);return this.hasCache(i,n)}},{key:"setCache",value:function(r,n,i){i.key=r,this.getCachesAt(n).set(r,i)}},{key:"set",value:function(r,n,i){var a=this.getKey(r);this.setCache(a,n,i),this.updateKeyMappingFor(r)}},{key:"deleteCache",value:function(r,n){this.getCachesAt(n).delete(r)}},{key:"delete",value:function(r,n){var i=this.getKey(r);this.deleteCache(i,n)}},{key:"invalidateKey",value:function(r){var n=this;this.lvls.forEach(function(i){return n.deleteCache(r,i)})}},{key:"invalidate",value:function(r){var n=r.id(),i=this.keyForId.get(n);this.deleteKeyMappingFor(r);var a=this.doesEleInvalidateKey(r);return a&&this.invalidateKey(i),a||this.getNumberOfIdsForKey(i)===0}}])})(),t5=25,dy=50,Ky=-4,ek=3,yL=7.99,uU=8,cU=1024,dU=1024,fU=1024,hU=.2,pU=.8,mU=10,gU=.15,vU=.1,yU=.9,xU=.9,bU=100,wU=1,jp={dequeue:"dequeue",downscale:"downscale",highQuality:"highQuality"},SU=Ua({getKey:null,doesEleInvalidateKey:dx,drawElement:null,getBoundingBox:null,getRotationPoint:null,getRotationOffset:null,isVisible:oA,allowEdgeTxrCaching:!0,allowParentTxrCaching:!0}),Yg=function(e,r){var n=this;n.renderer=e,n.onDequeues=[];var i=SU(r);Jt(n,i),n.lookup=new lU(i.getKey,i.doesEleInvalidateKey),n.setupDequeueing()},Wi=Yg.prototype;Wi.reasons=jp;Wi.getTextureQueue=function(t){var e=this;return e.eleImgCaches=e.eleImgCaches||{},e.eleImgCaches[t]=e.eleImgCaches[t]||[]};Wi.getRetiredTextureQueue=function(t){var e=this,r=e.eleImgCaches.retired=e.eleImgCaches.retired||{},n=r[t]=r[t]||[];return n};Wi.getElementQueue=function(){var t=this,e=t.eleCacheQueue=t.eleCacheQueue||new i0(function(r,n){return n.reqs-r.reqs});return e};Wi.getElementKeyToQueue=function(){var t=this,e=t.eleKeyToCacheQueue=t.eleKeyToCacheQueue||{};return e};Wi.getElement=function(t,e,r,n,i){var a=this,s=this.renderer,o=s.cy.zoom(),l=this.lookup;if(!e||e.w===0||e.h===0||isNaN(e.w)||isNaN(e.h)||!t.visible()||t.removed()||!a.allowEdgeTxrCaching&&t.isEdge()||!a.allowParentTxrCaching&&t.isParent())return null;if(n==null&&(n=Math.ceil(f_(o*r))),n<Ky)n=Ky;else if(o>=yL||n>ek)return null;var u=Math.pow(2,n),c=e.h*u,f=e.w*u,p=s.eleTextBiggerThanMin(t,u);if(!this.isVisible(t,p))return null;var v=l.get(t,n);if(v&&v.invalidated&&(v.invalidated=!1,v.texture.invalidatedWidth-=v.width),v)return v;var y;if(c<=t5?y=t5:c<=dy?y=dy:y=Math.ceil(c/dy)*dy,c>fU||f>dU)return null;var S=a.getTextureQueue(y),w=S[S.length-2],T=function(){return a.recycleTexture(y,f)||a.addTexture(y,f)};w||(w=S[S.length-1]),w||(w=T()),w.width-w.usedWidth<f&&(w=T());for(var _=function(W){return W&&W.scaledLabelShown===p},C=i&&i===jp.dequeue,N=i&&i===jp.highQuality,A=i&&i===jp.downscale,O,j=n+1;j<=ek;j++){var D=l.get(t,j);if(D){O=D;break}}var F=O&&O.level===n+1?O:null,B=function(){w.context.drawImage(F.texture.canvas,F.x,0,F.width,F.height,w.usedWidth,0,f,c)};if(w.context.setTransform(1,0,0,1,0,0),w.context.clearRect(w.usedWidth,0,f,y),_(F))B();else if(_(O))if(N){for(var $=O.level;$>n;$--)F=a.getElement(t,e,r,$,jp.downscale);B()}else return a.queueElement(t,O.level-1),O;else{var Z;if(!C&&!N&&!A)for(var I=n-1;I>=Ky;I--){var q=l.get(t,I);if(q){Z=q;break}}if(_(Z))return a.queueElement(t,n),Z;w.context.translate(w.usedWidth,0),w.context.scale(u,u),this.drawElement(w.context,t,e,p,!1),w.context.scale(1/u,1/u),w.context.translate(-w.usedWidth,0)}return v={x:w.usedWidth,texture:w,level:n,scale:u,width:f,height:c,scaledLabelShown:p},w.usedWidth+=Math.ceil(f+uU),w.eleCaches.push(v),l.set(t,n,v),a.checkTextureFullness(w),v};Wi.invalidateElements=function(t){for(var e=0;e<t.length;e++)this.invalidateElement(t[e])};Wi.invalidateElement=function(t){var e=this,r=e.lookup,n=[],i=r.isInvalid(t);if(i){for(var a=Ky;a<=ek;a++){var s=r.getForCachedKey(t,a);s&&n.push(s)}var o=r.invalidate(t);if(o)for(var l=0;l<n.length;l++){var u=n[l],c=u.texture;c.invalidatedWidth+=u.width,u.invalidated=!0,e.checkTextureUtility(c)}e.removeFromQueue(t)}};Wi.checkTextureUtility=function(t){t.invalidatedWidth>=hU*t.width&&this.retireTexture(t)};Wi.checkTextureFullness=function(t){var e=this,r=e.getTextureQueue(t.height);t.usedWidth/t.width>pU&&t.fullnessChecks>=mU?Qd(r,t):t.fullnessChecks++};Wi.retireTexture=function(t){var e=this,r=t.height,n=e.getTextureQueue(r),i=this.lookup;Qd(n,t),t.retired=!0;for(var a=t.eleCaches,s=0;s<a.length;s++){var o=a[s];i.deleteCache(o.key,o.level)}d_(a);var l=e.getRetiredTextureQueue(r);l.push(t)};Wi.addTexture=function(t,e){var r=this,n=r.getTextureQueue(t),i={};return n.push(i),i.eleCaches=[],i.height=t,i.width=Math.max(cU,e),i.usedWidth=0,i.invalidatedWidth=0,i.fullnessChecks=0,i.canvas=r.renderer.makeOffscreenCanvas(i.width,i.height),i.context=i.canvas.getContext("2d"),i};Wi.recycleTexture=function(t,e){for(var r=this,n=r.getTextureQueue(t),i=r.getRetiredTextureQueue(t),a=0;a<i.length;a++){var s=i[a];if(s.width>=e)return s.retired=!1,s.usedWidth=0,s.invalidatedWidth=0,s.fullnessChecks=0,d_(s.eleCaches),s.context.setTransform(1,0,0,1,0,0),s.context.clearRect(0,0,s.width,s.height),Qd(i,s),n.push(s),s}};Wi.queueElement=function(t,e){var r=this,n=r.getElementQueue(),i=r.getElementKeyToQueue(),a=this.getKey(t),s=i[a];if(s)s.level=Math.max(s.level,e),s.eles.merge(t),s.reqs++,n.updateItem(s);else{var o={eles:t.spawn().merge(t),level:e,reqs:1,key:a};n.push(o),i[a]=o}};Wi.dequeue=function(t){for(var e=this,r=e.getElementQueue(),n=e.getElementKeyToQueue(),i=[],a=e.lookup,s=0;s<wU&&r.size()>0;s++){var o=r.pop(),l=o.key,u=o.eles[0],c=a.hasCache(u,o.level);if(n[l]=null,c)continue;i.push(o);var f=e.getBoundingBox(u);e.getElement(u,f,t,o.level,jp.dequeue)}return i};Wi.removeFromQueue=function(t){var e=this,r=e.getElementQueue(),n=e.getElementKeyToQueue(),i=this.getKey(t),a=n[i];a!=null&&(a.eles.length===1?(a.reqs=u_,r.updateItem(a),r.pop(),n[i]=null):a.eles.unmerge(t))};Wi.onDequeue=function(t){this.onDequeues.push(t)};Wi.offDequeue=function(t){Qd(this.onDequeues,t)};Wi.setupDequeueing=vL.setupDequeueing({deqRedrawThreshold:bU,deqCost:gU,deqAvgCost:vU,deqNoDrawCost:yU,deqFastCost:xU,deq:function(e,r,n){return e.dequeue(r,n)},onDeqd:function(e,r){for(var n=0;n<e.onDequeues.length;n++){var i=e.onDequeues[n];i(r)}},shouldRedraw:function(e,r,n,i){for(var a=0;a<r.length;a++)for(var s=r[a].eles,o=0;o<s.length;o++){var l=s[o].boundingBox();if(p_(l,i))return!0}return!1},priority:function(e){return e.renderer.beforeRenderPriorities.eleTxrDeq}});var kU=1,iv=-4,xx=2,_U=3.99,CU=50,EU=50,TU=.15,NU=.1,PU=.9,MU=.9,AU=1,r5=250,LU=4e3*4e3,n5=32767,RU=!0,xL=function(e){var r=this,n=r.renderer=e,i=n.cy;r.layersByLevel={},r.firstGet=!0,r.lastInvalidationTime=yc()-2*r5,r.skipping=!1,r.eleTxrDeqs=i.collection(),r.scheduleElementRefinement=n0(function(){r.refineElementTextures(r.eleTxrDeqs),r.eleTxrDeqs.unmerge(r.eleTxrDeqs)},EU),n.beforeRender(function(s,o){o-r.lastInvalidationTime<=r5?r.skipping=!0:r.skipping=!1},n.beforeRenderPriorities.lyrTxrSkip);var a=function(o,l){return l.reqs-o.reqs};r.layersQueue=new i0(a),r.setupDequeueing()},Ga=xL.prototype,i5=0,OU=Math.pow(2,53)-1;Ga.makeLayer=function(t,e){var r=Math.pow(2,e),n=Math.ceil(t.w*r),i=Math.ceil(t.h*r),a=this.renderer.makeOffscreenCanvas(n,i),s={id:i5=++i5%OU,bb:t,level:e,width:n,height:i,canvas:a,context:a.getContext("2d"),eles:[],elesQueue:[],reqs:0},o=s.context,l=-s.bb.x1,u=-s.bb.y1;return o.scale(r,r),o.translate(l,u),s};Ga.getLayers=function(t,e,r){var n=this,i=n.renderer,a=i.cy,s=a.zoom(),o=n.firstGet;if(n.firstGet=!1,r==null){if(r=Math.ceil(f_(s*e)),r<iv)r=iv;else if(s>=_U||r>xx)return null}n.validateLayersElesOrdering(r,t);var l=n.layersByLevel,u=Math.pow(2,r),c=l[r]=l[r]||[],f,p=n.levelIsComplete(r,t),v,y=function(){var B=function(U){if(n.validateLayersElesOrdering(U,t),n.levelIsComplete(U,t))return v=l[U],!0},$=function(U){if(!v)for(var W=r+U;iv<=W&&W<=xx&&!B(W);W+=U);};$(1),$(-1);for(var Z=c.length-1;Z>=0;Z--){var I=c[Z];I.invalid&&Qd(c,I)}};if(!p)y();else return c;var S=function(){if(!f){f=_s();for(var B=0;B<t.length;B++)A9(f,t[B].boundingBox())}return f},w=function(B){B=B||{};var $=B.after;S();var Z=Math.ceil(f.w*u),I=Math.ceil(f.h*u);if(Z>n5||I>n5)return null;var q=Z*I;if(q>LU)return null;var U=n.makeLayer(f,r);if($!=null){var W=c.indexOf($)+1;c.splice(W,0,U)}else(B.insert===void 0||B.insert)&&c.unshift(U);return U};if(n.skipping&&!o)return null;for(var T=null,_=t.length/kU,C=!o,N=0;N<t.length;N++){var A=t[N],O=A._private.rscratch,j=O.imgLayerCaches=O.imgLayerCaches||{},D=j[r];if(D){T=D;continue}if((!T||T.eles.length>=_||!hA(T.bb,A.boundingBox()))&&(T=w({insert:!0,after:T}),!T))return null;v||C?n.queueLayer(T,A):n.drawEleInLayer(T,A,r,e),T.eles.push(A),j[r]=T}return v||(C?null:c)};Ga.getEleLevelForLayerLevel=function(t,e){return t};Ga.drawEleInLayer=function(t,e,r,n){var i=this,a=this.renderer,s=t.context,o=e.boundingBox();o.w===0||o.h===0||!e.visible()||(r=i.getEleLevelForLayerLevel(r,n),a.setImgSmoothing(s,!1),a.drawCachedElement(s,e,null,null,r,RU),a.setImgSmoothing(s,!0))};Ga.levelIsComplete=function(t,e){var r=this,n=r.layersByLevel[t];if(!n||n.length===0)return!1;for(var i=0,a=0;a<n.length;a++){var s=n[a];if(s.reqs>0||s.invalid)return!1;i+=s.eles.length}return i===e.length};Ga.validateLayersElesOrdering=function(t,e){var r=this.layersByLevel[t];if(r)for(var n=0;n<r.length;n++){for(var i=r[n],a=-1,s=0;s<e.length;s++)if(i.eles[0]===e[s]){a=s;break}if(a<0){this.invalidateLayer(i);continue}for(var o=a,s=0;s<i.eles.length;s++)if(i.eles[s]!==e[o+s]){this.invalidateLayer(i);break}}};Ga.updateElementsInLayers=function(t,e){for(var r=this,n=Jv(t[0]),i=0;i<t.length;i++)for(var a=n?null:t[i],s=n?t[i]:t[i].ele,o=s._private.rscratch,l=o.imgLayerCaches=o.imgLayerCaches||{},u=iv;u<=xx;u++){var c=l[u];c&&(a&&r.getEleLevelForLayerLevel(c.level)!==a.level||e(c,s,a))}};Ga.haveLayers=function(){for(var t=this,e=!1,r=iv;r<=xx;r++){var n=t.layersByLevel[r];if(n&&n.length>0){e=!0;break}}return e};Ga.invalidateElements=function(t){var e=this;t.length!==0&&(e.lastInvalidationTime=yc(),!(t.length===0||!e.haveLayers())&&e.updateElementsInLayers(t,function(n,i,a){e.invalidateLayer(n)}))};Ga.invalidateLayer=function(t){if(this.lastInvalidationTime=yc(),!t.invalid){var e=t.level,r=t.eles,n=this.layersByLevel[e];Qd(n,t),t.elesQueue=[],t.invalid=!0,t.replacement&&(t.replacement.invalid=!0);for(var i=0;i<r.length;i++){var a=r[i]._private.rscratch.imgLayerCaches;a&&(a[e]=null)}}};Ga.refineElementTextures=function(t){var e=this;e.updateElementsInLayers(t,function(n,i,a){var s=n.replacement;if(s||(s=n.replacement=e.makeLayer(n.bb,n.level),s.replaces=n,s.eles=n.eles),!s.reqs)for(var o=0;o<s.eles.length;o++)e.queueLayer(s,s.eles[o])})};Ga.enqueueElementRefinement=function(t){this.eleTxrDeqs.merge(t),this.scheduleElementRefinement()};Ga.queueLayer=function(t,e){var r=this,n=r.layersQueue,i=t.elesQueue,a=i.hasId=i.hasId||{};if(!t.replacement){if(e){if(a[e.id()])return;i.push(e),a[e.id()]=!0}t.reqs?(t.reqs++,n.updateItem(t)):(t.reqs=1,n.push(t))}};Ga.dequeue=function(t){for(var e=this,r=e.layersQueue,n=[],i=0;i<AU&&r.size()!==0;){var a=r.peek();if(a.replacement){r.pop();continue}if(a.replaces&&a!==a.replaces.replacement){r.pop();continue}if(a.invalid){r.pop();continue}var s=a.elesQueue.shift();s&&(e.drawEleInLayer(a,s,a.level,t),i++),n.length===0&&n.push(!0),a.elesQueue.length===0&&(r.pop(),a.reqs=0,a.replaces&&e.applyLayerReplacement(a),e.requestRedraw())}return n};Ga.applyLayerReplacement=function(t){var e=this,r=e.layersByLevel[t.level],n=t.replaces,i=r.indexOf(n);if(!(i<0||n.invalid)){r[i]=t;for(var a=0;a<t.eles.length;a++){var s=t.eles[a]._private,o=s.imgLayerCaches=s.imgLayerCaches||{};o&&(o[t.level]=t)}e.requestRedraw()}};Ga.requestRedraw=n0(function(){var t=this.renderer;t.redrawHint("eles",!0),t.redrawHint("drag",!0),t.redraw()},100);Ga.setupDequeueing=vL.setupDequeueing({deqRedrawThreshold:CU,deqCost:TU,deqAvgCost:NU,deqNoDrawCost:PU,deqFastCost:MU,deq:function(e,r){return e.dequeue(r)},onDeqd:c_,shouldRedraw:oA,priority:function(e){return e.renderer.beforeRenderPriorities.lyrTxrDeq}});var bL={},a5;function DU(t,e){for(var r=0;r<e.length;r++){var n=e[r];t.lineTo(n.x,n.y)}}function IU(t,e,r){for(var n,i=0;i<e.length;i++){var a=e[i];i===0&&(n=a),t.lineTo(a.x,a.y)}t.quadraticCurveTo(r.x,r.y,n.x,n.y)}function s5(t,e,r){t.beginPath&&t.beginPath();for(var n=e,i=0;i<n.length;i++){var a=n[i];t.lineTo(a.x,a.y)}var s=r,o=r[0];t.moveTo(o.x,o.y);for(var i=1;i<s.length;i++){var a=s[i];t.lineTo(a.x,a.y)}t.closePath&&t.closePath()}function jU(t,e,r,n,i){t.beginPath&&t.beginPath(),t.arc(r,n,i,0,Math.PI*2,!1);var a=e,s=a[0];t.moveTo(s.x,s.y);for(var o=0;o<a.length;o++){var l=a[o];t.lineTo(l.x,l.y)}t.closePath&&t.closePath()}function FU(t,e,r,n){t.arc(e,r,n,0,Math.PI*2,!1)}bL.arrowShapeImpl=function(t){return(a5||(a5={polygon:DU,"triangle-backcurve":IU,"triangle-tee":s5,"circle-triangle":jU,"triangle-cross":s5,circle:FU}))[t]};var Pu={};Pu.drawElement=function(t,e,r,n,i,a){var s=this;e.isNode()?s.drawNode(t,e,r,n,i,a):s.drawEdge(t,e,r,n,i,a)};Pu.drawElementOverlay=function(t,e){var r=this;e.isNode()?r.drawNodeOverlay(t,e):r.drawEdgeOverlay(t,e)};Pu.drawElementUnderlay=function(t,e){var r=this;e.isNode()?r.drawNodeUnderlay(t,e):r.drawEdgeUnderlay(t,e)};Pu.drawCachedElementPortion=function(t,e,r,n,i,a,s,o){var l=this,u=r.getBoundingBox(e);if(!(u.w===0||u.h===0)){var c=r.getElement(e,u,n,i,a);if(c!=null){var f=o(l,e);if(f===0)return;var p=s(l,e),v=u.x1,y=u.y1,S=u.w,w=u.h,T,_,C,N,A;if(p!==0){var O=r.getRotationPoint(e);C=O.x,N=O.y,t.translate(C,N),t.rotate(p),A=l.getImgSmoothing(t),A||l.setImgSmoothing(t,!0);var j=r.getRotationOffset(e);T=j.x,_=j.y}else T=v,_=y;var D;f!==1&&(D=t.globalAlpha,t.globalAlpha=D*f),t.drawImage(c.texture.canvas,c.x,0,c.width,c.height,T,_,S,w),f!==1&&(t.globalAlpha=D),p!==0&&(t.rotate(-p),t.translate(-C,-N),A||l.setImgSmoothing(t,!1))}else r.drawElement(t,e)}};var BU=function(){return 0},zU=function(e,r){return e.getTextAngle(r,null)},UU=function(e,r){return e.getTextAngle(r,"source")},GU=function(e,r){return e.getTextAngle(r,"target")},VU=function(e,r){return r.effectiveOpacity()},g2=function(e,r){return r.pstyle("text-opacity").pfValue*r.effectiveOpacity()};Pu.drawCachedElement=function(t,e,r,n,i,a){var s=this,o=s.data,l=o.eleTxrCache,u=o.lblTxrCache,c=o.slbTxrCache,f=o.tlbTxrCache,p=e.boundingBox(),v=a===!0?l.reasons.highQuality:null;if(!(p.w===0||p.h===0||!e.visible())&&(!n||p_(p,n))){var y=e.isEdge(),S=e.element()._private.rscratch.badLine;s.drawElementUnderlay(t,e),s.drawCachedElementPortion(t,e,l,r,i,v,BU,VU),(!y||!S)&&s.drawCachedElementPortion(t,e,u,r,i,v,zU,g2),y&&!S&&(s.drawCachedElementPortion(t,e,c,r,i,v,UU,g2),s.drawCachedElementPortion(t,e,f,r,i,v,GU,g2)),s.drawElementOverlay(t,e)}};Pu.drawElements=function(t,e){for(var r=this,n=0;n<e.length;n++){var i=e[n];r.drawElement(t,i)}};Pu.drawCachedElements=function(t,e,r,n){for(var i=this,a=0;a<e.length;a++){var s=e[a];i.drawCachedElement(t,s,r,n)}};Pu.drawCachedNodes=function(t,e,r,n){for(var i=this,a=0;a<e.length;a++){var s=e[a];s.isNode()&&i.drawCachedElement(t,s,r,n)}};Pu.drawLayeredElements=function(t,e,r,n){var i=this,a=i.data.lyrTxrCache.getLayers(e,r);if(a)for(var s=0;s<a.length;s++){var o=a[s],l=o.bb;l.w===0||l.h===0||t.drawImage(o.canvas,l.x1,l.y1,l.w,l.h)}else i.drawCachedElements(t,e,r,n)};var _c={};_c.drawEdge=function(t,e,r){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!0,s=this,o=e._private.rscratch;if(!(a&&!e.visible())&&!(o.badLine||o.allpts==null||isNaN(o.allpts[0]))){var l;r&&(l=r,t.translate(-l.x1,-l.y1));var u=a?e.pstyle("opacity").value:1,c=a?e.pstyle("line-opacity").value:1,f=e.pstyle("curve-style").value,p=e.pstyle("line-style").value,v=e.pstyle("width").pfValue,y=e.pstyle("line-cap").value,S=e.pstyle("line-outline-width").value,w=e.pstyle("line-outline-color").value,T=u*c,_=u*c,C=function(){var U=arguments.length>0&&arguments[0]!==void 0?arguments[0]:T;f==="straight-triangle"?(s.eleStrokeStyle(t,e,U),s.drawEdgeTrianglePath(e,t,o.allpts)):(t.lineWidth=v,t.lineCap=y,s.eleStrokeStyle(t,e,U),s.drawEdgePath(e,t,o.allpts,p),t.lineCap="butt")},N=function(){var U=arguments.length>0&&arguments[0]!==void 0?arguments[0]:T;if(t.lineWidth=v+S,t.lineCap=y,S>0)s.colorStrokeStyle(t,w[0],w[1],w[2],U);else{t.lineCap="butt";return}f==="straight-triangle"?s.drawEdgeTrianglePath(e,t,o.allpts):(s.drawEdgePath(e,t,o.allpts,p),t.lineCap="butt")},A=function(){i&&s.drawEdgeOverlay(t,e)},O=function(){i&&s.drawEdgeUnderlay(t,e)},j=function(){var U=arguments.length>0&&arguments[0]!==void 0?arguments[0]:_;s.drawArrowheads(t,e,U)},D=function(){s.drawElementText(t,e,null,n)};t.lineJoin="round";var F=e.pstyle("ghost").value==="yes";if(F){var B=e.pstyle("ghost-offset-x").pfValue,$=e.pstyle("ghost-offset-y").pfValue,Z=e.pstyle("ghost-opacity").value,I=T*Z;t.translate(B,$),C(I),j(I),t.translate(-B,-$)}else N();O(),C(),j(),A(),D(),r&&t.translate(l.x1,l.y1)}};var wL=function(e){if(!["overlay","underlay"].includes(e))throw new Error("Invalid state");return function(r,n){if(n.visible()){var i=n.pstyle("".concat(e,"-opacity")).value;if(i!==0){var a=this,s=a.usePaths(),o=n._private.rscratch,l=n.pstyle("".concat(e,"-padding")).pfValue,u=2*l,c=n.pstyle("".concat(e,"-color")).value;r.lineWidth=u,o.edgeType==="self"&&!s?r.lineCap="butt":r.lineCap="round",a.colorStrokeStyle(r,c[0],c[1],c[2],i),a.drawEdgePath(n,r,o.allpts,"solid")}}}};_c.drawEdgeOverlay=wL("overlay");_c.drawEdgeUnderlay=wL("underlay");_c.drawEdgePath=function(t,e,r,n){var i=t._private.rscratch,a=e,s,o=!1,l=this.usePaths(),u=t.pstyle("line-dash-pattern").pfValue,c=t.pstyle("line-dash-offset").pfValue;if(l){var f=r.join("$"),p=i.pathCacheKey&&i.pathCacheKey===f;p?(s=e=i.pathCache,o=!0):(s=e=new Path2D,i.pathCacheKey=f,i.pathCache=s)}if(a.setLineDash)switch(n){case"dotted":a.setLineDash([1,1]);break;case"dashed":a.setLineDash(u),a.lineDashOffset=c;break;case"solid":a.setLineDash([]);break}if(!o&&!i.badLine)switch(e.beginPath&&e.beginPath(),e.moveTo(r[0],r[1]),i.edgeType){case"bezier":case"self":case"compound":case"multibezier":for(var v=2;v+3<r.length;v+=4)e.quadraticCurveTo(r[v],r[v+1],r[v+2],r[v+3]);break;case"straight":case"haystack":for(var y=2;y+1<r.length;y+=2)e.lineTo(r[y],r[y+1]);break;case"segments":if(i.isRound){var S=Ws(i.roundCorners),w;try{for(S.s();!(w=S.n()).done;){var T=w.value;uL(e,T)}}catch(C){S.e(C)}finally{S.f()}e.lineTo(r[r.length-2],r[r.length-1])}else for(var _=2;_+1<r.length;_+=2)e.lineTo(r[_],r[_+1]);break}e=a,l?e.stroke(s):e.stroke(),e.setLineDash&&e.setLineDash([])};_c.drawEdgeTrianglePath=function(t,e,r){e.fillStyle=e.strokeStyle;for(var n=t.pstyle("width").pfValue,i=0;i+1<r.length;i+=2){var a=[r[i+2]-r[i],r[i+3]-r[i+1]],s=Math.sqrt(a[0]*a[0]+a[1]*a[1]),o=[a[1]/s,-a[0]/s],l=[o[0]*n/2,o[1]*n/2];e.beginPath(),e.moveTo(r[i]-l[0],r[i+1]-l[1]),e.lineTo(r[i]+l[0],r[i+1]+l[1]),e.lineTo(r[i+2],r[i+3]),e.closePath(),e.fill()}};_c.drawArrowheads=function(t,e,r){var n=e._private.rscratch,i=n.edgeType==="haystack";i||this.drawArrowhead(t,e,"source",n.arrowStartX,n.arrowStartY,n.srcArrowAngle,r),this.drawArrowhead(t,e,"mid-target",n.midX,n.midY,n.midtgtArrowAngle,r),this.drawArrowhead(t,e,"mid-source",n.midX,n.midY,n.midsrcArrowAngle,r),i||this.drawArrowhead(t,e,"target",n.arrowEndX,n.arrowEndY,n.tgtArrowAngle,r)};_c.drawArrowhead=function(t,e,r,n,i,a,s){if(!(isNaN(n)||n==null||isNaN(i)||i==null||isNaN(a)||a==null)){var o=this,l=e.pstyle(r+"-arrow-shape").value;if(l!=="none"){var u=e.pstyle(r+"-arrow-fill").value==="hollow"?"both":"filled",c=e.pstyle(r+"-arrow-fill").value,f=e.pstyle("width").pfValue,p=e.pstyle(r+"-arrow-width"),v=p.value==="match-line"?f:p.pfValue;p.units==="%"&&(v*=f);var y=e.pstyle("opacity").value;s===void 0&&(s=y);var S=t.globalCompositeOperation;(s!==1||c==="hollow")&&(t.globalCompositeOperation="destination-out",o.colorFillStyle(t,255,255,255,1),o.colorStrokeStyle(t,255,255,255,1),o.drawArrowShape(e,t,u,f,l,v,n,i,a),t.globalCompositeOperation=S);var w=e.pstyle(r+"-arrow-color").value;o.colorFillStyle(t,w[0],w[1],w[2],s),o.colorStrokeStyle(t,w[0],w[1],w[2],s),o.drawArrowShape(e,t,c,f,l,v,n,i,a)}}};_c.drawArrowShape=function(t,e,r,n,i,a,s,o,l){var u=this,c=this.usePaths()&&i!=="triangle-cross",f=!1,p,v=e,y={x:s,y:o},S=t.pstyle("arrow-scale").value,w=this.getArrowWidth(n,S),T=u.arrowShapes[i];if(c){var _=u.arrowPathCache=u.arrowPathCache||[],C=vh(i),N=_[C];N!=null?(p=e=N,f=!0):(p=e=new Path2D,_[C]=p)}f||(e.beginPath&&e.beginPath(),c?T.draw(e,1,0,{x:0,y:0},1):T.draw(e,w,l,y,n),e.closePath&&e.closePath()),e=v,c&&(e.translate(s,o),e.rotate(l),e.scale(w,w)),(r==="filled"||r==="both")&&(c?e.fill(p):e.fill()),(r==="hollow"||r==="both")&&(e.lineWidth=a/(c?w:1),e.lineJoin="miter",c?e.stroke(p):e.stroke()),c&&(e.scale(1/w,1/w),e.rotate(-l),e.translate(-s,-o))};var N_={};N_.safeDrawImage=function(t,e,r,n,i,a,s,o,l,u){if(!(i<=0||a<=0||l<=0||u<=0))try{t.drawImage(e,r,n,i,a,s,o,l,u)}catch(c){Yr(c)}};N_.drawInscribedImage=function(t,e,r,n,i){var a=this,s=r.position(),o=s.x,l=s.y,u=r.cy().style(),c=u.getIndexedStyle.bind(u),f=c(r,"background-fit","value",n),p=c(r,"background-repeat","value",n),v=r.width(),y=r.height(),S=r.padding()*2,w=v+(c(r,"background-width-relative-to","value",n)==="inner"?0:S),T=y+(c(r,"background-height-relative-to","value",n)==="inner"?0:S),_=r._private.rscratch,C=c(r,"background-clip","value",n),N=C==="node",A=c(r,"background-image-opacity","value",n)*i,O=c(r,"background-image-smoothing","value",n),j=r.pstyle("corner-radius").value;j!=="auto"&&(j=r.pstyle("corner-radius").pfValue);var D=e.width||e.cachedW,F=e.height||e.cachedH;(D==null||F==null)&&(document.body.appendChild(e),D=e.cachedW=e.width||e.offsetWidth,F=e.cachedH=e.height||e.offsetHeight,document.body.removeChild(e));var B=D,$=F;if(c(r,"background-width","value",n)!=="auto"&&(c(r,"background-width","units",n)==="%"?B=c(r,"background-width","pfValue",n)*w:B=c(r,"background-width","pfValue",n)),c(r,"background-height","value",n)!=="auto"&&(c(r,"background-height","units",n)==="%"?$=c(r,"background-height","pfValue",n)*T:$=c(r,"background-height","pfValue",n)),!(B===0||$===0)){if(f==="contain"){var Z=Math.min(w/B,T/$);B*=Z,$*=Z}else if(f==="cover"){var Z=Math.max(w/B,T/$);B*=Z,$*=Z}var I=o-w/2,q=c(r,"background-position-x","units",n),U=c(r,"background-position-x","pfValue",n);q==="%"?I+=(w-B)*U:I+=U;var W=c(r,"background-offset-x","units",n),Y=c(r,"background-offset-x","pfValue",n);W==="%"?I+=(w-B)*Y:I+=Y;var Q=l-T/2,ne=c(r,"background-position-y","units",n),re=c(r,"background-position-y","pfValue",n);ne==="%"?Q+=(T-$)*re:Q+=re;var H=c(r,"background-offset-y","units",n),te=c(r,"background-offset-y","pfValue",n);H==="%"?Q+=(T-$)*te:Q+=te,_.pathCache&&(I-=o,Q-=l,o=0,l=0);var ie=t.globalAlpha;t.globalAlpha=A;var de=a.getImgSmoothing(t),ge=!1;if(O==="no"&&de?(a.setImgSmoothing(t,!1),ge=!0):O==="yes"&&!de&&(a.setImgSmoothing(t,!0),ge=!0),p==="no-repeat")N&&(t.save(),_.pathCache?t.clip(_.pathCache):(a.nodeShapes[a.getNodeShape(r)].draw(t,o,l,w,T,j,_),t.clip())),a.safeDrawImage(t,e,0,0,D,F,I,Q,B,$),N&&t.restore();else{var ye=t.createPattern(e,p);t.fillStyle=ye,a.nodeShapes[a.getNodeShape(r)].draw(t,o,l,w,T,j,_),t.translate(I,Q),t.fill(),t.translate(-I,-Q)}t.globalAlpha=ie,ge&&a.setImgSmoothing(t,de)}};var Rh={};Rh.eleTextBiggerThanMin=function(t,e){if(!e){var r=t.cy().zoom(),n=this.getPixelRatio(),i=Math.ceil(f_(r*n));e=Math.pow(2,i)}var a=t.pstyle("font-size").pfValue*e,s=t.pstyle("min-zoomed-font-size").pfValue;return!(a<s)};Rh.drawElementText=function(t,e,r,n,i){var a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!0,s=this;if(n==null){if(a&&!s.eleTextBiggerThanMin(e))return}else if(n===!1)return;if(e.isNode()){var o=e.pstyle("label");if(!o||!o.value)return;var l=s.getLabelJustification(e);t.textAlign=l,t.textBaseline="bottom"}else{var u=e.element()._private.rscratch.badLine,c=e.pstyle("label"),f=e.pstyle("source-label"),p=e.pstyle("target-label");if(u||(!c||!c.value)&&(!f||!f.value)&&(!p||!p.value))return;t.textAlign="center",t.textBaseline="bottom"}var v=!r,y;r&&(y=r,t.translate(-y.x1,-y.y1)),i==null?(s.drawText(t,e,null,v,a),e.isEdge()&&(s.drawText(t,e,"source",v,a),s.drawText(t,e,"target",v,a))):s.drawText(t,e,i,v,a),r&&t.translate(y.x1,y.y1)};Rh.getFontCache=function(t){var e;this.fontCaches=this.fontCaches||[];for(var r=0;r<this.fontCaches.length;r++)if(e=this.fontCaches[r],e.context===t)return e;return e={context:t},this.fontCaches.push(e),e};Rh.setupTextStyle=function(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,n=e.pstyle("font-style").strValue,i=e.pstyle("font-size").pfValue+"px",a=e.pstyle("font-family").strValue,s=e.pstyle("font-weight").strValue,o=r?e.effectiveOpacity()*e.pstyle("text-opacity").value:1,l=e.pstyle("text-outline-opacity").value*o,u=e.pstyle("color").value,c=e.pstyle("text-outline-color").value;t.font=n+" "+s+" "+i+" "+a,t.lineJoin="round",this.colorFillStyle(t,u[0],u[1],u[2],o),this.colorStrokeStyle(t,c[0],c[1],c[2],l)};function HU(t,e,r,n,i){var a=Math.min(n,i),s=a/2,o=e+n/2,l=r+i/2;t.beginPath(),t.arc(o,l,s,0,Math.PI*2),t.closePath()}function o5(t,e,r,n,i){var a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:5,s=Math.min(a,n/2,i/2);t.beginPath(),t.moveTo(e+s,r),t.lineTo(e+n-s,r),t.quadraticCurveTo(e+n,r,e+n,r+s),t.lineTo(e+n,r+i-s),t.quadraticCurveTo(e+n,r+i,e+n-s,r+i),t.lineTo(e+s,r+i),t.quadraticCurveTo(e,r+i,e,r+i-s),t.lineTo(e,r+s),t.quadraticCurveTo(e,r,e+s,r),t.closePath()}Rh.getTextAngle=function(t,e){var r,n=t._private,i=n.rscratch,a=e?e+"-":"",s=t.pstyle(a+"text-rotation");if(s.strValue==="autorotate"){var o=Gs(i,"labelAngle",e);r=t.isEdge()?o:0}else s.strValue==="none"?r=0:r=s.pfValue;return r};Rh.drawText=function(t,e,r){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,a=e._private,s=a.rscratch,o=i?e.effectiveOpacity():1;if(!(i&&(o===0||e.pstyle("text-opacity").value===0))){r==="main"&&(r=null);var l=Gs(s,"labelX",r),u=Gs(s,"labelY",r),c,f,p=this.getLabelText(e,r);if(p!=null&&p!==""&&!isNaN(l)&&!isNaN(u)){this.setupTextStyle(t,e,i);var v=r?r+"-":"",y=Gs(s,"labelWidth",r),S=Gs(s,"labelHeight",r),w=e.pstyle(v+"text-margin-x").pfValue,T=e.pstyle(v+"text-margin-y").pfValue,_=e.isEdge(),C=e.pstyle("text-halign").value,N=e.pstyle("text-valign").value;_&&(C="center",N="center"),l+=w,u+=T;var A;switch(n?A=this.getTextAngle(e,r):A=0,A!==0&&(c=l,f=u,t.translate(c,f),t.rotate(A),l=0,u=0),N){case"top":break;case"center":u+=S/2;break;case"bottom":u+=S;break}var O=e.pstyle("text-background-opacity").value,j=e.pstyle("text-border-opacity").value,D=e.pstyle("text-border-width").pfValue,F=e.pstyle("text-background-padding").pfValue,B=e.pstyle("text-background-shape").strValue,$=B==="round-rectangle"||B==="roundrectangle",Z=B==="circle",I=2;if(O>0||D>0&&j>0){var q=t.fillStyle,U=t.strokeStyle,W=t.lineWidth,Y=e.pstyle("text-background-color").value,Q=e.pstyle("text-border-color").value,ne=e.pstyle("text-border-style").value,re=O>0,H=D>0&&j>0,te=l-F;switch(C){case"left":te-=y;break;case"center":te-=y/2;break}var ie=u-S-F,de=y+2*F,ge=S+2*F;if(re&&(t.fillStyle="rgba(".concat(Y[0],",").concat(Y[1],",").concat(Y[2],",").concat(O*o,")")),H&&(t.strokeStyle="rgba(".concat(Q[0],",").concat(Q[1],",").concat(Q[2],",").concat(j*o,")"),t.lineWidth=D,t.setLineDash))switch(ne){case"dotted":t.setLineDash([1,1]);break;case"dashed":t.setLineDash([4,2]);break;case"double":t.lineWidth=D/4,t.setLineDash([]);break;default:t.setLineDash([]);break}if($?(t.beginPath(),o5(t,te,ie,de,ge,I)):Z?(t.beginPath(),HU(t,te,ie,de,ge)):(t.beginPath(),t.rect(te,ie,de,ge)),re&&t.fill(),H&&t.stroke(),H&&ne==="double"){var ye=D/2;t.beginPath(),$?o5(t,te+ye,ie+ye,de-2*ye,ge-2*ye,I):t.rect(te+ye,ie+ye,de-2*ye,ge-2*ye),t.stroke()}t.fillStyle=q,t.strokeStyle=U,t.lineWidth=W,t.setLineDash&&t.setLineDash([])}var ae=2*e.pstyle("text-outline-width").pfValue;if(ae>0&&(t.lineWidth=ae),e.pstyle("text-wrap").value==="wrap"){var pe=Gs(s,"labelWrapCachedLines",r),le=Gs(s,"labelLineHeight",r),me=y/2,he=this.getLabelJustification(e);switch(he==="auto"||(C==="left"?he==="left"?l+=-y:he==="center"&&(l+=-me):C==="center"?he==="left"?l+=-me:he==="right"&&(l+=me):C==="right"&&(he==="center"?l+=me:he==="right"&&(l+=y))),N){case"top":u-=(pe.length-1)*le;break;case"center":case"bottom":u-=(pe.length-1)*le;break}for(var xe=0;xe<pe.length;xe++)ae>0&&t.strokeText(pe[xe],l,u),t.fillText(pe[xe],l,u),u+=le}else ae>0&&t.strokeText(p,l,u),t.fillText(p,l,u);A!==0&&(t.rotate(-A),t.translate(-c,-f))}}};var df={};df.drawNode=function(t,e,r){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!0,s=this,o,l,u=e._private,c=u.rscratch,f=e.position();if(!(!gt(f.x)||!gt(f.y))&&!(a&&!e.visible())){var p=a?e.effectiveOpacity():1,v=s.usePaths(),y,S=!1,w=e.padding();o=e.width()+2*w,l=e.height()+2*w;var T;r&&(T=r,t.translate(-T.x1,-T.y1));for(var _=e.pstyle("background-image"),C=_.value,N=new Array(C.length),A=new Array(C.length),O=0,j=0;j<C.length;j++){var D=C[j],F=N[j]=D!=null&&D!=="none";if(F){var B=e.cy().style().getIndexedStyle(e,"background-image-crossorigin","value",j);O++,A[j]=s.getCachedImage(D,B,function(){u.backgroundTimestamp=Date.now(),e.emitAndNotify("background")})}}var $=e.pstyle("background-blacken").value,Z=e.pstyle("border-width").pfValue,I=e.pstyle("background-opacity").value*p,q=e.pstyle("border-color").value,U=e.pstyle("border-style").value,W=e.pstyle("border-join").value,Y=e.pstyle("border-cap").value,Q=e.pstyle("border-position").value,ne=e.pstyle("border-dash-pattern").pfValue,re=e.pstyle("border-dash-offset").pfValue,H=e.pstyle("border-opacity").value*p,te=e.pstyle("outline-width").pfValue,ie=e.pstyle("outline-color").value,de=e.pstyle("outline-style").value,ge=e.pstyle("outline-opacity").value*p,ye=e.pstyle("outline-offset").value,ae=e.pstyle("corner-radius").value;ae!=="auto"&&(ae=e.pstyle("corner-radius").pfValue);var pe=function(){var ct=arguments.length>0&&arguments[0]!==void 0?arguments[0]:I;s.eleFillStyle(t,e,ct)},le=function(){var ct=arguments.length>0&&arguments[0]!==void 0?arguments[0]:H;s.colorStrokeStyle(t,q[0],q[1],q[2],ct)},me=function(){var ct=arguments.length>0&&arguments[0]!==void 0?arguments[0]:ge;s.colorStrokeStyle(t,ie[0],ie[1],ie[2],ct)},he=function(ct,We,ce,ve){var _e=s.nodePathCache=s.nodePathCache||[],Te=sA(ce==="polygon"?ce+","+ve.join(","):ce,""+We,""+ct,""+ae),Le=_e[Te],Xe,He=!1;return Le!=null?(Xe=Le,He=!0,c.pathCache=Xe):(Xe=new Path2D,_e[Te]=c.pathCache=Xe),{path:Xe,cacheHit:He}},xe=e.pstyle("shape").strValue,we=e.pstyle("shape-polygon-points").pfValue;if(v){t.translate(f.x,f.y);var Ge=he(o,l,xe,we);y=Ge.path,S=Ge.cacheHit}var qe=function(){if(!S){var ct=f;v&&(ct={x:0,y:0}),s.nodeShapes[s.getNodeShape(e)].draw(y||t,ct.x,ct.y,o,l,ae,c)}v?t.fill(y):t.fill()},wt=function(){for(var ct=arguments.length>0&&arguments[0]!==void 0?arguments[0]:p,We=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,ce=u.backgrounding,ve=0,_e=0;_e<A.length;_e++){var Te=e.cy().style().getIndexedStyle(e,"background-image-containment","value",_e);if(We&&Te==="over"||!We&&Te==="inside"){ve++;continue}N[_e]&&A[_e].complete&&!A[_e].error&&(ve++,s.drawInscribedImage(t,A[_e],e,_e,ct))}u.backgrounding=ve!==O,ce!==u.backgrounding&&e.updateStyle(!1)},et=function(){var ct=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,We=arguments.length>1&&arguments[1]!==void 0?arguments[1]:p;s.hasPie(e)&&(s.drawPie(t,e,We),ct&&(v||s.nodeShapes[s.getNodeShape(e)].draw(t,f.x,f.y,o,l,ae,c)))},at=function(){var ct=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,We=arguments.length>1&&arguments[1]!==void 0?arguments[1]:p;s.hasStripe(e)&&(t.save(),v?t.clip(c.pathCache):(s.nodeShapes[s.getNodeShape(e)].draw(t,f.x,f.y,o,l,ae,c),t.clip()),s.drawStripe(t,e,We),t.restore(),ct&&(v||s.nodeShapes[s.getNodeShape(e)].draw(t,f.x,f.y,o,l,ae,c)))},je=function(){var ct=arguments.length>0&&arguments[0]!==void 0?arguments[0]:p,We=($>0?$:-$)*ct,ce=$>0?0:255;$!==0&&(s.colorFillStyle(t,ce,ce,ce,We),v?t.fill(y):t.fill())},Re=function(){if(Z>0){if(t.lineWidth=Z,t.lineCap=Y,t.lineJoin=W,t.setLineDash)switch(U){case"dotted":t.setLineDash([1,1]);break;case"dashed":t.setLineDash(ne),t.lineDashOffset=re;break;case"solid":case"double":t.setLineDash([]);break}if(Q!=="center"){if(t.save(),t.lineWidth*=2,Q==="inside")v?t.clip(y):t.clip();else{var ct=new Path2D;ct.rect(-o/2-Z,-l/2-Z,o+2*Z,l+2*Z),ct.addPath(y),t.clip(ct,"evenodd")}v?t.stroke(y):t.stroke(),t.restore()}else v?t.stroke(y):t.stroke();if(U==="double"){t.lineWidth=Z/3;var We=t.globalCompositeOperation;t.globalCompositeOperation="destination-out",v?t.stroke(y):t.stroke(),t.globalCompositeOperation=We}t.setLineDash&&t.setLineDash([])}},nt=function(){if(te>0){if(t.lineWidth=te,t.lineCap="butt",t.setLineDash)switch(de){case"dotted":t.setLineDash([1,1]);break;case"dashed":t.setLineDash([4,2]);break;case"solid":case"double":t.setLineDash([]);break}var ct=f;v&&(ct={x:0,y:0});var We=s.getNodeShape(e),ce=Z;Q==="inside"&&(ce=0),Q==="outside"&&(ce*=2);var ve=(o+ce+(te+ye))/o,_e=(l+ce+(te+ye))/l,Te=o*ve,Le=l*_e,Xe=s.nodeShapes[We].points,He;if(v){var dt=he(Te,Le,We,Xe);He=dt.path}if(We==="ellipse")s.drawEllipsePath(He||t,ct.x,ct.y,Te,Le);else if(["round-diamond","round-heptagon","round-hexagon","round-octagon","round-pentagon","round-polygon","round-triangle","round-tag"].includes(We)){var ft=0,Pt=0,qt=0;We==="round-diamond"?ft=(ce+ye+te)*1.4:We==="round-heptagon"?(ft=(ce+ye+te)*1.075,qt=-(ce/2+ye+te)/35):We==="round-hexagon"?ft=(ce+ye+te)*1.12:We==="round-pentagon"?(ft=(ce+ye+te)*1.13,qt=-(ce/2+ye+te)/15):We==="round-tag"?(ft=(ce+ye+te)*1.12,Pt=(ce/2+te+ye)*.07):We==="round-triangle"&&(ft=(ce+ye+te)*(Math.PI/2),qt=-(ce+ye/2+te)/Math.PI),ft!==0&&(ve=(o+ft)/o,Te=o*ve,["round-hexagon","round-tag"].includes(We)||(_e=(l+ft)/l,Le=l*_e)),ae=ae==="auto"?gA(Te,Le):ae;for(var $t=Te/2,kt=Le/2,Zt=ae+(ce+te+ye)/2,er=new Array(Xe.length/2),Ar=new Array(Xe.length/2),xr=0;xr<Xe.length/2;xr++)er[xr]={x:ct.x+Pt+$t*Xe[xr*2],y:ct.y+qt+kt*Xe[xr*2+1]};var $e,yt,Et,rr,zt=er.length;for(yt=er[zt-1],$e=0;$e<zt;$e++)Et=er[$e%zt],rr=er[($e+1)%zt],Ar[$e]=E_(yt,Et,rr,Zt),yt=Et,Et=rr;s.drawRoundPolygonPath(He||t,ct.x+Pt,ct.y+qt,o*ve,l*_e,Xe,Ar)}else if(["roundrectangle","round-rectangle"].includes(We))ae=ae==="auto"?Jd(Te,Le):ae,s.drawRoundRectanglePath(He||t,ct.x,ct.y,Te,Le,ae+(ce+te+ye)/2);else if(["cutrectangle","cut-rectangle"].includes(We))ae=ae==="auto"?m_():ae,s.drawCutRectanglePath(He||t,ct.x,ct.y,Te,Le,null,ae+(ce+te+ye)/4);else if(["bottomroundrectangle","bottom-round-rectangle"].includes(We))ae=ae==="auto"?Jd(Te,Le):ae,s.drawBottomRoundRectanglePath(He||t,ct.x,ct.y,Te,Le,ae+(ce+te+ye)/2);else if(We==="barrel")s.drawBarrelPath(He||t,ct.x,ct.y,Te,Le);else if(We.startsWith("polygon")||["rhomboid","right-rhomboid","round-tag","tag","vee"].includes(We)){var lt=(ce+te+ye)/o;Xe=fx(hx(Xe,lt)),s.drawPolygonPath(He||t,ct.x,ct.y,o,l,Xe)}else{var Pr=(ce+te+ye)/o;Xe=fx(hx(Xe,-Pr)),s.drawPolygonPath(He||t,ct.x,ct.y,o,l,Xe)}if(v?t.stroke(He):t.stroke(),de==="double"){t.lineWidth=ce/3;var zr=t.globalCompositeOperation;t.globalCompositeOperation="destination-out",v?t.stroke(He):t.stroke(),t.globalCompositeOperation=zr}t.setLineDash&&t.setLineDash([])}},Ce=function(){i&&s.drawNodeOverlay(t,e,f,o,l)},Fe=function(){i&&s.drawNodeUnderlay(t,e,f,o,l)},Ke=function(){s.drawElementText(t,e,null,n)},pt=e.pstyle("ghost").value==="yes";if(pt){var vt=e.pstyle("ghost-offset-x").pfValue,At=e.pstyle("ghost-offset-y").pfValue,Ut=e.pstyle("ghost-opacity").value,nr=Ut*p;t.translate(vt,At),me(),nt(),pe(Ut*I),qe(),wt(nr,!0),le(Ut*H),Re(),et($!==0||Z!==0),at($!==0||Z!==0),wt(nr,!1),je(nr),t.translate(-vt,-At)}v&&t.translate(-f.x,-f.y),Fe(),v&&t.translate(f.x,f.y),me(),nt(),pe(),qe(),wt(p,!0),le(),Re(),et($!==0||Z!==0),at($!==0||Z!==0),wt(p,!1),je(),v&&t.translate(-f.x,-f.y),Ke(),Ce(),r&&t.translate(T.x1,T.y1)}};var SL=function(e){if(!["overlay","underlay"].includes(e))throw new Error("Invalid state");return function(r,n,i,a,s){var o=this;if(n.visible()){var l=n.pstyle("".concat(e,"-padding")).pfValue,u=n.pstyle("".concat(e,"-opacity")).value,c=n.pstyle("".concat(e,"-color")).value,f=n.pstyle("".concat(e,"-shape")).value,p=n.pstyle("".concat(e,"-corner-radius")).value;if(u>0){if(i=i||n.position(),a==null||s==null){var v=n.padding();a=n.width()+2*v,s=n.height()+2*v}o.colorFillStyle(r,c[0],c[1],c[2],u),o.nodeShapes[f].draw(r,i.x,i.y,a+l*2,s+l*2,p),r.fill()}}}};df.drawNodeOverlay=SL("overlay");df.drawNodeUnderlay=SL("underlay");df.hasPie=function(t){return t=t[0],t._private.hasPie};df.hasStripe=function(t){return t=t[0],t._private.hasStripe};df.drawPie=function(t,e,r,n){e=e[0],n=n||e.position();var i=e.cy().style(),a=e.pstyle("pie-size"),s=e.pstyle("pie-hole"),o=e.pstyle("pie-start-angle").pfValue,l=n.x,u=n.y,c=e.width(),f=e.height(),p=Math.min(c,f)/2,v,y=0,S=this.usePaths();if(S&&(l=0,u=0),a.units==="%"?p=p*a.pfValue:a.pfValue!==void 0&&(p=a.pfValue/2),s.units==="%"?v=p*s.pfValue:s.pfValue!==void 0&&(v=s.pfValue/2),!(v>=p))for(var w=1;w<=i.pieBackgroundN;w++){var T=e.pstyle("pie-"+w+"-background-size").value,_=e.pstyle("pie-"+w+"-background-color").value,C=e.pstyle("pie-"+w+"-background-opacity").value*r,N=T/100;N+y>1&&(N=1-y);var A=1.5*Math.PI+2*Math.PI*y;A+=o;var O=2*Math.PI*N,j=A+O;T===0||y>=1||y+N>1||(v===0?(t.beginPath(),t.moveTo(l,u),t.arc(l,u,p,A,j),t.closePath()):(t.beginPath(),t.arc(l,u,p,A,j),t.arc(l,u,v,j,A,!0),t.closePath()),this.colorFillStyle(t,_[0],_[1],_[2],C),t.fill(),y+=N)}};df.drawStripe=function(t,e,r,n){e=e[0],n=n||e.position();var i=e.cy().style(),a=n.x,s=n.y,o=e.width(),l=e.height(),u=0,c=this.usePaths();t.save();var f=e.pstyle("stripe-direction").value,p=e.pstyle("stripe-size");switch(f){case"vertical":break;case"righward":t.rotate(-Math.PI/2);break}var v=o,y=l;p.units==="%"?(v=v*p.pfValue,y=y*p.pfValue):p.pfValue!==void 0&&(v=p.pfValue,y=p.pfValue),c&&(a=0,s=0),s-=v/2,a-=y/2;for(var S=1;S<=i.stripeBackgroundN;S++){var w=e.pstyle("stripe-"+S+"-background-size").value,T=e.pstyle("stripe-"+S+"-background-color").value,_=e.pstyle("stripe-"+S+"-background-opacity").value*r,C=w/100;C+u>1&&(C=1-u),!(w===0||u>=1||u+C>1)&&(t.beginPath(),t.rect(a,s+y*u,v,y*C),t.closePath(),this.colorFillStyle(t,T[0],T[1],T[2],_),t.fill(),u+=C)}t.restore()};var Ts={},WU=100;Ts.getPixelRatio=function(){var t=this.data.contexts[0];if(this.forcedPixelRatio!=null)return this.forcedPixelRatio;var e=this.cy.window(),r=t.backingStorePixelRatio||t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1;return(e.devicePixelRatio||1)/r};Ts.paintCache=function(t){for(var e=this.paintCaches=this.paintCaches||[],r=!0,n,i=0;i<e.length;i++)if(n=e[i],n.context===t){r=!1;break}return r&&(n={context:t},e.push(n)),n};Ts.createGradientStyleFor=function(t,e,r,n,i){var a,s=this.usePaths(),o=r.pstyle(e+"-gradient-stop-colors").value,l=r.pstyle(e+"-gradient-stop-positions").pfValue;if(n==="radial-gradient")if(r.isEdge()){var u=r.sourceEndpoint(),c=r.targetEndpoint(),f=r.midpoint(),p=yh(u,f),v=yh(c,f);a=t.createRadialGradient(f.x,f.y,0,f.x,f.y,Math.max(p,v))}else{var y=s?{x:0,y:0}:r.position(),S=r.paddedWidth(),w=r.paddedHeight();a=t.createRadialGradient(y.x,y.y,0,y.x,y.y,Math.max(S,w))}else if(r.isEdge()){var T=r.sourceEndpoint(),_=r.targetEndpoint();a=t.createLinearGradient(T.x,T.y,_.x,_.y)}else{var C=s?{x:0,y:0}:r.position(),N=r.paddedWidth(),A=r.paddedHeight(),O=N/2,j=A/2,D=r.pstyle("background-gradient-direction").value;switch(D){case"to-bottom":a=t.createLinearGradient(C.x,C.y-j,C.x,C.y+j);break;case"to-top":a=t.createLinearGradient(C.x,C.y+j,C.x,C.y-j);break;case"to-left":a=t.createLinearGradient(C.x+O,C.y,C.x-O,C.y);break;case"to-right":a=t.createLinearGradient(C.x-O,C.y,C.x+O,C.y);break;case"to-bottom-right":case"to-right-bottom":a=t.createLinearGradient(C.x-O,C.y-j,C.x+O,C.y+j);break;case"to-top-right":case"to-right-top":a=t.createLinearGradient(C.x-O,C.y+j,C.x+O,C.y-j);break;case"to-bottom-left":case"to-left-bottom":a=t.createLinearGradient(C.x+O,C.y-j,C.x-O,C.y+j);break;case"to-top-left":case"to-left-top":a=t.createLinearGradient(C.x+O,C.y+j,C.x-O,C.y-j);break}}if(!a)return null;for(var F=l.length===o.length,B=o.length,$=0;$<B;$++)a.addColorStop(F?l[$]:$/(B-1),"rgba("+o[$][0]+","+o[$][1]+","+o[$][2]+","+i+")");return a};Ts.gradientFillStyle=function(t,e,r,n){var i=this.createGradientStyleFor(t,"background",e,r,n);if(!i)return null;t.fillStyle=i};Ts.colorFillStyle=function(t,e,r,n,i){t.fillStyle="rgba("+e+","+r+","+n+","+i+")"};Ts.eleFillStyle=function(t,e,r){var n=e.pstyle("background-fill").value;if(n==="linear-gradient"||n==="radial-gradient")this.gradientFillStyle(t,e,n,r);else{var i=e.pstyle("background-color").value;this.colorFillStyle(t,i[0],i[1],i[2],r)}};Ts.gradientStrokeStyle=function(t,e,r,n){var i=this.createGradientStyleFor(t,"line",e,r,n);if(!i)return null;t.strokeStyle=i};Ts.colorStrokeStyle=function(t,e,r,n,i){t.strokeStyle="rgba("+e+","+r+","+n+","+i+")"};Ts.eleStrokeStyle=function(t,e,r){var n=e.pstyle("line-fill").value;if(n==="linear-gradient"||n==="radial-gradient")this.gradientStrokeStyle(t,e,n,r);else{var i=e.pstyle("line-color").value;this.colorStrokeStyle(t,i[0],i[1],i[2],r)}};Ts.matchCanvasSize=function(t){var e=this,r=e.data,n=e.findContainerClientCoords(),i=n[2],a=n[3],s=e.getPixelRatio(),o=e.motionBlurPxRatio;(t===e.data.bufferCanvases[e.MOTIONBLUR_BUFFER_NODE]||t===e.data.bufferCanvases[e.MOTIONBLUR_BUFFER_DRAG])&&(s=o);var l=i*s,u=a*s,c;if(!(l===e.canvasWidth&&u===e.canvasHeight)){e.fontCaches=null;var f=r.canvasContainer;f.style.width=i+"px",f.style.height=a+"px";for(var p=0;p<e.CANVAS_LAYERS;p++)c=r.canvases[p],c.width=l,c.height=u,c.style.width=i+"px",c.style.height=a+"px";for(var p=0;p<e.BUFFER_COUNT;p++)c=r.bufferCanvases[p],c.width=l,c.height=u,c.style.width=i+"px",c.style.height=a+"px";e.textureMult=1,s<=1&&(c=r.bufferCanvases[e.TEXTURE_BUFFER],e.textureMult=2,c.width=l*e.textureMult,c.height=u*e.textureMult),e.canvasWidth=l,e.canvasHeight=u,e.pixelRatio=s}};Ts.renderTo=function(t,e,r,n){this.render({forcedContext:t,forcedZoom:e,forcedPan:r,drawAllLayers:!0,forcedPxRatio:n})};Ts.clearCanvas=function(){var t=this,e=t.data;function r(n){n.clearRect(0,0,t.canvasWidth,t.canvasHeight)}r(e.contexts[t.NODE]),r(e.contexts[t.DRAG])};Ts.render=function(t){var e=this;t=t||cA();var r=e.cy,n=t.forcedContext,i=t.drawAllLayers,a=t.drawOnlyNodeLayer,s=t.forcedZoom,o=t.forcedPan,l=t.forcedPxRatio===void 0?this.getPixelRatio():t.forcedPxRatio,u=e.data,c=u.canvasNeedsRedraw,f=e.textureOnViewport&&!n&&(e.pinching||e.hoverData.dragging||e.swipePanning||e.data.wheelZooming),p=t.motionBlur!==void 0?t.motionBlur:e.motionBlur,v=e.motionBlurPxRatio,y=r.hasCompoundNodes(),S=e.hoverData.draggingEles,w=!!(e.hoverData.selecting||e.touchData.selecting);p=p&&!n&&e.motionBlurEnabled&&!w;var T=p;n||(e.prevPxRatio!==l&&(e.invalidateContainerClientCoordsCache(),e.matchCanvasSize(e.container),e.redrawHint("eles",!0),e.redrawHint("drag",!0)),e.prevPxRatio=l),!n&&e.motionBlurTimeout&&clearTimeout(e.motionBlurTimeout),p&&(e.mbFrames==null&&(e.mbFrames=0),e.mbFrames++,e.mbFrames<3&&(T=!1),e.mbFrames>e.minMbLowQualFrames&&(e.motionBlurPxRatio=e.mbPxRBlurry)),e.clearingMotionBlur&&(e.motionBlurPxRatio=1),e.textureDrawLastFrame&&!f&&(c[e.NODE]=!0,c[e.SELECT_BOX]=!0);var _=r.style(),C=r.zoom(),N=s!==void 0?s:C,A=r.pan(),O={x:A.x,y:A.y},j={zoom:C,pan:{x:A.x,y:A.y}},D=e.prevViewport,F=D===void 0||j.zoom!==D.zoom||j.pan.x!==D.pan.x||j.pan.y!==D.pan.y;!F&&!(S&&!y)&&(e.motionBlurPxRatio=1),o&&(O=o),N*=l,O.x*=l,O.y*=l;var B=e.getCachedZSortedEles();function $(le,me,he,xe,we){var Ge=le.globalCompositeOperation;le.globalCompositeOperation="destination-out",e.colorFillStyle(le,255,255,255,e.motionBlurTransparency),le.fillRect(me,he,xe,we),le.globalCompositeOperation=Ge}function Z(le,me){var he,xe,we,Ge;!e.clearingMotionBlur&&(le===u.bufferContexts[e.MOTIONBLUR_BUFFER_NODE]||le===u.bufferContexts[e.MOTIONBLUR_BUFFER_DRAG])?(he={x:A.x*v,y:A.y*v},xe=C*v,we=e.canvasWidth*v,Ge=e.canvasHeight*v):(he=O,xe=N,we=e.canvasWidth,Ge=e.canvasHeight),le.setTransform(1,0,0,1,0,0),me==="motionBlur"?$(le,0,0,we,Ge):!n&&(me===void 0||me)&&le.clearRect(0,0,we,Ge),i||(le.translate(he.x,he.y),le.scale(xe,xe)),o&&le.translate(o.x,o.y),s&&le.scale(s,s)}if(f||(e.textureDrawLastFrame=!1),f){if(e.textureDrawLastFrame=!0,!e.textureCache){e.textureCache={},e.textureCache.bb=r.mutableElements().boundingBox(),e.textureCache.texture=e.data.bufferCanvases[e.TEXTURE_BUFFER];var I=e.data.bufferContexts[e.TEXTURE_BUFFER];I.setTransform(1,0,0,1,0,0),I.clearRect(0,0,e.canvasWidth*e.textureMult,e.canvasHeight*e.textureMult),e.render({forcedContext:I,drawOnlyNodeLayer:!0,forcedPxRatio:l*e.textureMult});var j=e.textureCache.viewport={zoom:r.zoom(),pan:r.pan(),width:e.canvasWidth,height:e.canvasHeight};j.mpan={x:(0-j.pan.x)/j.zoom,y:(0-j.pan.y)/j.zoom}}c[e.DRAG]=!1,c[e.NODE]=!1;var q=u.contexts[e.NODE],U=e.textureCache.texture,j=e.textureCache.viewport;q.setTransform(1,0,0,1,0,0),p?$(q,0,0,j.width,j.height):q.clearRect(0,0,j.width,j.height);var W=_.core("outside-texture-bg-color").value,Y=_.core("outside-texture-bg-opacity").value;e.colorFillStyle(q,W[0],W[1],W[2],Y),q.fillRect(0,0,j.width,j.height);var C=r.zoom();Z(q,!1),q.clearRect(j.mpan.x,j.mpan.y,j.width/j.zoom/l,j.height/j.zoom/l),q.drawImage(U,j.mpan.x,j.mpan.y,j.width/j.zoom/l,j.height/j.zoom/l)}else e.textureOnViewport&&!n&&(e.textureCache=null);var Q=r.extent(),ne=e.pinching||e.hoverData.dragging||e.swipePanning||e.data.wheelZooming||e.hoverData.draggingEles||e.cy.animated(),re=e.hideEdgesOnViewport&&ne,H=[];if(H[e.NODE]=!c[e.NODE]&&p&&!e.clearedForMotionBlur[e.NODE]||e.clearingMotionBlur,H[e.NODE]&&(e.clearedForMotionBlur[e.NODE]=!0),H[e.DRAG]=!c[e.DRAG]&&p&&!e.clearedForMotionBlur[e.DRAG]||e.clearingMotionBlur,H[e.DRAG]&&(e.clearedForMotionBlur[e.DRAG]=!0),c[e.NODE]||i||a||H[e.NODE]){var te=p&&!H[e.NODE]&&v!==1,q=n||(te?e.data.bufferContexts[e.MOTIONBLUR_BUFFER_NODE]:u.contexts[e.NODE]),ie=p&&!te?"motionBlur":void 0;Z(q,ie),re?e.drawCachedNodes(q,B.nondrag,l,Q):e.drawLayeredElements(q,B.nondrag,l,Q),e.debug&&e.drawDebugPoints(q,B.nondrag),!i&&!p&&(c[e.NODE]=!1)}if(!a&&(c[e.DRAG]||i||H[e.DRAG])){var te=p&&!H[e.DRAG]&&v!==1,q=n||(te?e.data.bufferContexts[e.MOTIONBLUR_BUFFER_DRAG]:u.contexts[e.DRAG]);Z(q,p&&!te?"motionBlur":void 0),re?e.drawCachedNodes(q,B.drag,l,Q):e.drawCachedElements(q,B.drag,l,Q),e.debug&&e.drawDebugPoints(q,B.drag),!i&&!p&&(c[e.DRAG]=!1)}if(this.drawSelectionRectangle(t,Z),p&&v!==1){var de=u.contexts[e.NODE],ge=e.data.bufferCanvases[e.MOTIONBLUR_BUFFER_NODE],ye=u.contexts[e.DRAG],ae=e.data.bufferCanvases[e.MOTIONBLUR_BUFFER_DRAG],pe=function(me,he,xe){me.setTransform(1,0,0,1,0,0),xe||!T?me.clearRect(0,0,e.canvasWidth,e.canvasHeight):$(me,0,0,e.canvasWidth,e.canvasHeight);var we=v;me.drawImage(he,0,0,e.canvasWidth*we,e.canvasHeight*we,0,0,e.canvasWidth,e.canvasHeight)};(c[e.NODE]||H[e.NODE])&&(pe(de,ge,H[e.NODE]),c[e.NODE]=!1),(c[e.DRAG]||H[e.DRAG])&&(pe(ye,ae,H[e.DRAG]),c[e.DRAG]=!1)}e.prevViewport=j,e.clearingMotionBlur&&(e.clearingMotionBlur=!1,e.motionBlurCleared=!0,e.motionBlur=!0),p&&(e.motionBlurTimeout=setTimeout(function(){e.motionBlurTimeout=null,e.clearedForMotionBlur[e.NODE]=!1,e.clearedForMotionBlur[e.DRAG]=!1,e.motionBlur=!1,e.clearingMotionBlur=!f,e.mbFrames=0,c[e.NODE]=!0,c[e.DRAG]=!0,e.redraw()},WU)),n||r.emit("render")};var Zm;Ts.drawSelectionRectangle=function(t,e){var r=this,n=r.cy,i=r.data,a=n.style(),s=t.drawOnlyNodeLayer,o=t.drawAllLayers,l=i.canvasNeedsRedraw,u=t.forcedContext;if(r.showFps||!s&&l[r.SELECT_BOX]&&!o){var c=u||i.contexts[r.SELECT_BOX];if(e(c),r.selection[4]==1&&(r.hoverData.selecting||r.touchData.selecting)){var f=r.cy.zoom(),p=a.core("selection-box-border-width").value/f;c.lineWidth=p,c.fillStyle="rgba("+a.core("selection-box-color").value[0]+","+a.core("selection-box-color").value[1]+","+a.core("selection-box-color").value[2]+","+a.core("selection-box-opacity").value+")",c.fillRect(r.selection[0],r.selection[1],r.selection[2]-r.selection[0],r.selection[3]-r.selection[1]),p>0&&(c.strokeStyle="rgba("+a.core("selection-box-border-color").value[0]+","+a.core("selection-box-border-color").value[1]+","+a.core("selection-box-border-color").value[2]+","+a.core("selection-box-opacity").value+")",c.strokeRect(r.selection[0],r.selection[1],r.selection[2]-r.selection[0],r.selection[3]-r.selection[1]))}if(i.bgActivePosistion&&!r.hoverData.selecting){var f=r.cy.zoom(),v=i.bgActivePosistion;c.fillStyle="rgba("+a.core("active-bg-color").value[0]+","+a.core("active-bg-color").value[1]+","+a.core("active-bg-color").value[2]+","+a.core("active-bg-opacity").value+")",c.beginPath(),c.arc(v.x,v.y,a.core("active-bg-size").pfValue/f,0,2*Math.PI),c.fill()}var y=r.lastRedrawTime;if(r.showFps&&y){y=Math.round(y);var S=Math.round(1e3/y),w="1 frame = "+y+" ms = "+S+" fps";if(c.setTransform(1,0,0,1,0,0),c.fillStyle="rgba(255, 0, 0, 0.75)",c.strokeStyle="rgba(255, 0, 0, 0.75)",c.font="30px Arial",!Zm){var T=c.measureText(w);Zm=T.actualBoundingBoxAscent}c.fillText(w,0,Zm);var _=60;c.strokeRect(0,Zm+10,250,20),c.fillRect(0,Zm+10,250*Math.min(S/_,1),20)}o||(l[r.SELECT_BOX]=!1)}};function l5(t,e,r){var n=t.createShader(e);if(t.shaderSource(n,r),t.compileShader(n),!t.getShaderParameter(n,t.COMPILE_STATUS))throw new Error(t.getShaderInfoLog(n));return n}function qU(t,e,r){var n=l5(t,t.VERTEX_SHADER,e),i=l5(t,t.FRAGMENT_SHADER,r),a=t.createProgram();if(t.attachShader(a,n),t.attachShader(a,i),t.linkProgram(a),!t.getProgramParameter(a,t.LINK_STATUS))throw new Error("Could not initialize shaders");return a}function $U(t,e,r){r===void 0&&(r=e);var n=t.makeOffscreenCanvas(e,r),i=n.context=n.getContext("2d");return n.clear=function(){return i.clearRect(0,0,n.width,n.height)},n.clear(),n}function P_(t){var e=t.pixelRatio,r=t.cy.zoom(),n=t.cy.pan();return{zoom:r*e,pan:{x:n.x*e,y:n.y*e}}}function KU(t){var e=t.pixelRatio,r=t.cy.zoom();return r*e}function ZU(t,e,r,n,i){var a=n*r+e.x,s=i*r+e.y;return s=Math.round(t.canvasHeight-s),[a,s]}function YU(t){return t.pstyle("background-fill").value!=="solid"||t.pstyle("background-image").strValue!=="none"?!1:t.pstyle("border-width").value===0||t.pstyle("border-opacity").value===0?!0:t.pstyle("border-style").value==="solid"}function XU(t,e){if(t.length!==e.length)return!1;for(var r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function qf(t,e,r){var n=t[0]/255,i=t[1]/255,a=t[2]/255,s=e,o=r||new Array(4);return o[0]=n*s,o[1]=i*s,o[2]=a*s,o[3]=s,o}function bp(t,e){var r=e||new Array(4);return r[0]=(t>>0&255)/255,r[1]=(t>>8&255)/255,r[2]=(t>>16&255)/255,r[3]=(t>>24&255)/255,r}function QU(t){return t[0]+(t[1]<<8)+(t[2]<<16)+(t[3]<<24)}function JU(t,e){var r=t.createTexture();return r.buffer=function(n){t.bindTexture(t.TEXTURE_2D,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR_MIPMAP_NEAREST),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n),t.generateMipmap(t.TEXTURE_2D),t.bindTexture(t.TEXTURE_2D,null)},r.deleteTexture=function(){t.deleteTexture(r)},r}function kL(t,e){switch(e){case"float":return[1,t.FLOAT,4];case"vec2":return[2,t.FLOAT,4];case"vec3":return[3,t.FLOAT,4];case"vec4":return[4,t.FLOAT,4];case"int":return[1,t.INT,4];case"ivec2":return[2,t.INT,4]}}function _L(t,e,r){switch(e){case t.FLOAT:return new Float32Array(r);case t.INT:return new Int32Array(r)}}function eG(t,e,r,n,i,a){switch(e){case t.FLOAT:return new Float32Array(r.buffer,a*n,i);case t.INT:return new Int32Array(r.buffer,a*n,i)}}function tG(t,e,r,n){var i=kL(t,e),a=Ai(i,2),s=a[0],o=a[1],l=_L(t,o,n),u=t.createBuffer();return t.bindBuffer(t.ARRAY_BUFFER,u),t.bufferData(t.ARRAY_BUFFER,l,t.STATIC_DRAW),o===t.FLOAT?t.vertexAttribPointer(r,s,o,!1,0,0):o===t.INT&&t.vertexAttribIPointer(r,s,o,0,0),t.enableVertexAttribArray(r),t.bindBuffer(t.ARRAY_BUFFER,null),u}function fu(t,e,r,n){var i=kL(t,r),a=Ai(i,3),s=a[0],o=a[1],l=a[2],u=_L(t,o,e*s),c=s*l,f=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,f),t.bufferData(t.ARRAY_BUFFER,e*c,t.DYNAMIC_DRAW),t.enableVertexAttribArray(n),o===t.FLOAT?t.vertexAttribPointer(n,s,o,!1,c,0):o===t.INT&&t.vertexAttribIPointer(n,s,o,c,0),t.vertexAttribDivisor(n,1),t.bindBuffer(t.ARRAY_BUFFER,null);for(var p=new Array(e),v=0;v<e;v++)p[v]=eG(t,o,u,c,s,v);return f.dataArray=u,f.stride=c,f.size=s,f.getView=function(y){return p[y]},f.setPoint=function(y,S,w){var T=p[y];T[0]=S,T[1]=w},f.bufferSubData=function(y){t.bindBuffer(t.ARRAY_BUFFER,f),y?t.bufferSubData(t.ARRAY_BUFFER,0,u,0,y*s):t.bufferSubData(t.ARRAY_BUFFER,0,u)},f}function rG(t,e,r){for(var n=9,i=new Float32Array(e*n),a=new Array(e),s=0;s<e;s++){var o=s*n*4;a[s]=new Float32Array(i.buffer,o,n)}var l=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,l),t.bufferData(t.ARRAY_BUFFER,i.byteLength,t.DYNAMIC_DRAW);for(var u=0;u<3;u++){var c=r+u;t.enableVertexAttribArray(c),t.vertexAttribPointer(c,3,t.FLOAT,!1,36,u*12),t.vertexAttribDivisor(c,1)}return t.bindBuffer(t.ARRAY_BUFFER,null),l.getMatrixView=function(f){return a[f]},l.setData=function(f,p){a[p].set(f,0)},l.bufferSubData=function(){t.bindBuffer(t.ARRAY_BUFFER,l),t.bufferSubData(t.ARRAY_BUFFER,0,i)},l}function nG(t){var e=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,e);var r=t.createTexture();return t.bindTexture(t.TEXTURE_2D,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r,0),t.bindFramebuffer(t.FRAMEBUFFER,null),e.setFramebufferAttachmentSizes=function(n,i){t.bindTexture(t.TEXTURE_2D,r),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,n,i,0,t.RGBA,t.UNSIGNED_BYTE,null)},e}var u5=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});function v2(){var t=new u5(9);return u5!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function c5(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function iG(t,e,r){var n=e[0],i=e[1],a=e[2],s=e[3],o=e[4],l=e[5],u=e[6],c=e[7],f=e[8],p=r[0],v=r[1],y=r[2],S=r[3],w=r[4],T=r[5],_=r[6],C=r[7],N=r[8];return t[0]=p*n+v*s+y*u,t[1]=p*i+v*o+y*c,t[2]=p*a+v*l+y*f,t[3]=S*n+w*s+T*u,t[4]=S*i+w*o+T*c,t[5]=S*a+w*l+T*f,t[6]=_*n+C*s+N*u,t[7]=_*i+C*o+N*c,t[8]=_*a+C*l+N*f,t}function Zy(t,e,r){var n=e[0],i=e[1],a=e[2],s=e[3],o=e[4],l=e[5],u=e[6],c=e[7],f=e[8],p=r[0],v=r[1];return t[0]=n,t[1]=i,t[2]=a,t[3]=s,t[4]=o,t[5]=l,t[6]=p*n+v*s+u,t[7]=p*i+v*o+c,t[8]=p*a+v*l+f,t}function d5(t,e,r){var n=e[0],i=e[1],a=e[2],s=e[3],o=e[4],l=e[5],u=e[6],c=e[7],f=e[8],p=Math.sin(r),v=Math.cos(r);return t[0]=v*n+p*s,t[1]=v*i+p*o,t[2]=v*a+p*l,t[3]=v*s-p*n,t[4]=v*o-p*i,t[5]=v*l-p*a,t[6]=u,t[7]=c,t[8]=f,t}function tk(t,e,r){var n=r[0],i=r[1];return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=i*e[3],t[4]=i*e[4],t[5]=i*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function aG(t,e,r){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/r,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}var sG=(function(){function t(e,r,n,i){lf(this,t),this.debugID=Math.floor(Math.random()*1e4),this.r=e,this.texSize=r,this.texRows=n,this.texHeight=Math.floor(r/n),this.enableWrapping=!0,this.locked=!1,this.texture=null,this.needsBuffer=!0,this.freePointer={x:0,row:0},this.keyToLocation=new Map,this.canvas=i(e,r,r),this.scratch=i(e,r,this.texHeight,"scratch")}return uf(t,[{key:"lock",value:function(){this.locked=!0}},{key:"getKeys",value:function(){return new Set(this.keyToLocation.keys())}},{key:"getScale",value:function(r){var n=r.w,i=r.h,a=this.texHeight,s=this.texSize,o=a/i,l=n*o,u=i*o;return l>s&&(o=s/n,l=n*o,u=i*o),{scale:o,texW:l,texH:u}}},{key:"draw",value:function(r,n,i){var a=this;if(this.locked)throw new Error("can't draw, atlas is locked");var s=this.texSize,o=this.texRows,l=this.texHeight,u=this.getScale(n),c=u.scale,f=u.texW,p=u.texH,v=function(C,N){if(i&&N){var A=N.context,O=C.x,j=C.row,D=O,F=l*j;A.save(),A.translate(D,F),A.scale(c,c),i(A,n),A.restore()}},y=[null,null],S=function(){v(a.freePointer,a.canvas),y[0]={x:a.freePointer.x,y:a.freePointer.row*l,w:f,h:p},y[1]={x:a.freePointer.x+f,y:a.freePointer.row*l,w:0,h:p},a.freePointer.x+=f,a.freePointer.x==s&&(a.freePointer.x=0,a.freePointer.row++)},w=function(){var C=a.scratch,N=a.canvas;C.clear(),v({x:0,row:0},C);var A=s-a.freePointer.x,O=f-A,j=l;{var D=a.freePointer.x,F=a.freePointer.row*l,B=A;N.context.drawImage(C,0,0,B,j,D,F,B,j),y[0]={x:D,y:F,w:B,h:p}}{var $=A,Z=(a.freePointer.row+1)*l,I=O;N&&N.context.drawImage(C,$,0,I,j,0,Z,I,j),y[1]={x:0,y:Z,w:I,h:p}}a.freePointer.x=O,a.freePointer.row++},T=function(){a.freePointer.x=0,a.freePointer.row++};if(this.freePointer.x+f<=s)S();else{if(this.freePointer.row>=o-1)return!1;this.freePointer.x===s?(T(),S()):this.enableWrapping?w():(T(),S())}return this.keyToLocation.set(r,y),this.needsBuffer=!0,y}},{key:"getOffsets",value:function(r){return this.keyToLocation.get(r)}},{key:"isEmpty",value:function(){return this.freePointer.x===0&&this.freePointer.row===0}},{key:"canFit",value:function(r){if(this.locked)return!1;var n=this.texSize,i=this.texRows,a=this.getScale(r),s=a.texW;return this.freePointer.x+s>n?this.freePointer.row<i-1:!0}},{key:"bufferIfNeeded",value:function(r){this.texture||(this.texture=JU(r,this.debugID)),this.needsBuffer&&(this.texture.buffer(this.canvas),this.needsBuffer=!1,this.locked&&(this.canvas=null,this.scratch=null))}},{key:"dispose",value:function(){this.texture&&(this.texture.deleteTexture(),this.texture=null),this.canvas=null,this.scratch=null,this.locked=!0}}])})(),oG=(function(){function t(e,r,n,i){lf(this,t),this.r=e,this.texSize=r,this.texRows=n,this.createTextureCanvas=i,this.atlases=[],this.styleKeyToAtlas=new Map,this.markedKeys=new Set}return uf(t,[{key:"getKeys",value:function(){return new Set(this.styleKeyToAtlas.keys())}},{key:"_createAtlas",value:function(){var r=this.r,n=this.texSize,i=this.texRows,a=this.createTextureCanvas;return new sG(r,n,i,a)}},{key:"_getScratchCanvas",value:function(){if(!this.scratch){var r=this.r,n=this.texSize,i=this.texRows,a=this.createTextureCanvas,s=Math.floor(n/i);this.scratch=a(r,n,s,"scratch")}return this.scratch}},{key:"draw",value:function(r,n,i){var a=this.styleKeyToAtlas.get(r);return a||(a=this.atlases[this.atlases.length-1],(!a||!a.canFit(n))&&(a&&a.lock(),a=this._createAtlas(),this.atlases.push(a)),a.draw(r,n,i),this.styleKeyToAtlas.set(r,a)),a}},{key:"getAtlas",value:function(r){return this.styleKeyToAtlas.get(r)}},{key:"hasAtlas",value:function(r){return this.styleKeyToAtlas.has(r)}},{key:"markKeyForGC",value:function(r){this.markedKeys.add(r)}},{key:"gc",value:function(){var r=this,n=this.markedKeys;if(n.size===0){console.log("nothing to garbage collect");return}var i=[],a=new Map,s=null,o=Ws(this.atlases),l;try{var u=function(){var f=l.value,p=f.getKeys(),v=lG(n,p);if(v.size===0)return i.push(f),p.forEach(function(A){return a.set(A,f)}),1;s||(s=r._createAtlas(),i.push(s));var y=Ws(p),S;try{for(y.s();!(S=y.n()).done;){var w=S.value;if(!v.has(w)){var T=f.getOffsets(w),_=Ai(T,2),C=_[0],N=_[1];s.canFit({w:C.w+N.w,h:C.h})||(s.lock(),s=r._createAtlas(),i.push(s)),f.canvas&&(r._copyTextureToNewAtlas(w,f,s),a.set(w,s))}}}catch(A){y.e(A)}finally{y.f()}f.dispose()};for(o.s();!(l=o.n()).done;)u()}catch(c){o.e(c)}finally{o.f()}this.atlases=i,this.styleKeyToAtlas=a,this.markedKeys=new Set}},{key:"_copyTextureToNewAtlas",value:function(r,n,i){var a=n.getOffsets(r),s=Ai(a,2),o=s[0],l=s[1];if(l.w===0)i.draw(r,o,function(p){p.drawImage(n.canvas,o.x,o.y,o.w,o.h,0,0,o.w,o.h)});else{var u=this._getScratchCanvas();u.clear(),u.context.drawImage(n.canvas,o.x,o.y,o.w,o.h,0,0,o.w,o.h),u.context.drawImage(n.canvas,l.x,l.y,l.w,l.h,o.w,0,l.w,l.h);var c=o.w+l.w,f=o.h;i.draw(r,{w:c,h:f},function(p){p.drawImage(u,0,0,c,f,0,0,c,f)})}}},{key:"getCounts",value:function(){return{keyCount:this.styleKeyToAtlas.size,atlasCount:new Set(this.styleKeyToAtlas.values()).size}}}])})();function lG(t,e){return t.intersection?t.intersection(e):new Set(lx(t).filter(function(r){return e.has(r)}))}var uG=(function(){function t(e,r){lf(this,t),this.r=e,this.globalOptions=r,this.atlasSize=r.webglTexSize,this.maxAtlasesPerBatch=r.webglTexPerBatch,this.renderTypes=new Map,this.collections=new Map,this.typeAndIdToKey=new Map}return uf(t,[{key:"getAtlasSize",value:function(){return this.atlasSize}},{key:"addAtlasCollection",value:function(r,n){var i=this.globalOptions,a=i.webglTexSize,s=i.createTextureCanvas,o=n.texRows,l=this._cacheScratchCanvas(s),u=new oG(this.r,a,o,l);this.collections.set(r,u)}},{key:"addRenderType",value:function(r,n){var i=n.collection;if(!this.collections.has(i))throw new Error("invalid atlas collection name '".concat(i,"'"));var a=this.collections.get(i),s=Jt({type:r,atlasCollection:a},n);this.renderTypes.set(r,s)}},{key:"getRenderTypeOpts",value:function(r){return this.renderTypes.get(r)}},{key:"getAtlasCollection",value:function(r){return this.collections.get(r)}},{key:"_cacheScratchCanvas",value:function(r){var n=-1,i=-1,a=null;return function(s,o,l,u){return u?((!a||o!=n||l!=i)&&(n=o,i=l,a=r(s,o,l)),a):r(s,o,l)}}},{key:"_key",value:function(r,n){return"".concat(r,"-").concat(n)}},{key:"invalidate",value:function(r){var n=this,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=i.forceRedraw,s=a===void 0?!1:a,o=i.filterEle,l=o===void 0?function(){return!0}:o,u=i.filterType,c=u===void 0?function(){return!0}:u,f=!1,p=!1,v=Ws(r),y;try{for(v.s();!(y=v.n()).done;){var S=y.value;if(l(S)){var w=Ws(this.renderTypes.values()),T;try{var _=function(){var N=T.value,A=N.type;if(c(A)){var O=n.collections.get(N.collection),j=N.getKey(S),D=Array.isArray(j)?j:[j];if(s)D.forEach(function(Z){return O.markKeyForGC(Z)}),p=!0;else{var F=N.getID?N.getID(S):S.id(),B=n._key(A,F),$=n.typeAndIdToKey.get(B);$!==void 0&&!XU(D,$)&&(f=!0,n.typeAndIdToKey.delete(B),$.forEach(function(Z){return O.markKeyForGC(Z)}))}}};for(w.s();!(T=w.n()).done;)_()}catch(C){w.e(C)}finally{w.f()}}}}catch(C){v.e(C)}finally{v.f()}return p&&(this.gc(),f=!1),f}},{key:"gc",value:function(){var r=Ws(this.collections.values()),n;try{for(r.s();!(n=r.n()).done;){var i=n.value;i.gc()}}catch(a){r.e(a)}finally{r.f()}}},{key:"getOrCreateAtlas",value:function(r,n,i,a){var s=this.renderTypes.get(n),o=this.collections.get(s.collection),l=!1,u=o.draw(a,i,function(p){s.drawClipped?(p.save(),p.beginPath(),p.rect(0,0,i.w,i.h),p.clip(),s.drawElement(p,r,i,!0,!0),p.restore()):s.drawElement(p,r,i,!0,!0),l=!0});if(l){var c=s.getID?s.getID(r):r.id(),f=this._key(n,c);this.typeAndIdToKey.has(f)?this.typeAndIdToKey.get(f).push(a):this.typeAndIdToKey.set(f,[a])}return u}},{key:"getAtlasInfo",value:function(r,n){var i=this,a=this.renderTypes.get(n),s=a.getKey(r),o=Array.isArray(s)?s:[s];return o.map(function(l){var u=a.getBoundingBox(r,l),c=i.getOrCreateAtlas(r,n,u,l),f=c.getOffsets(l),p=Ai(f,2),v=p[0],y=p[1];return{atlas:c,tex:v,tex1:v,tex2:y,bb:u}})}},{key:"getDebugInfo",value:function(){var r=[],n=Ws(this.collections),i;try{for(n.s();!(i=n.n()).done;){var a=Ai(i.value,2),s=a[0],o=a[1],l=o.getCounts(),u=l.keyCount,c=l.atlasCount;r.push({type:s,keyCount:u,atlasCount:c})}}catch(f){n.e(f)}finally{n.f()}return r}}])})(),cG=(function(){function t(e){lf(this,t),this.globalOptions=e,this.atlasSize=e.webglTexSize,this.maxAtlasesPerBatch=e.webglTexPerBatch,this.batchAtlases=[]}return uf(t,[{key:"getMaxAtlasesPerBatch",value:function(){return this.maxAtlasesPerBatch}},{key:"getAtlasSize",value:function(){return this.atlasSize}},{key:"getIndexArray",value:function(){return Array.from({length:this.maxAtlasesPerBatch},function(r,n){return n})}},{key:"startBatch",value:function(){this.batchAtlases=[]}},{key:"getAtlasCount",value:function(){return this.batchAtlases.length}},{key:"getAtlases",value:function(){return this.batchAtlases}},{key:"canAddToCurrentBatch",value:function(r){return this.batchAtlases.length===this.maxAtlasesPerBatch?this.batchAtlases.includes(r):!0}},{key:"getAtlasIndexForBatch",value:function(r){var n=this.batchAtlases.indexOf(r);if(n<0){if(this.batchAtlases.length===this.maxAtlasesPerBatch)throw new Error("cannot add more atlases to batch");this.batchAtlases.push(r),n=this.batchAtlases.length-1}return n}}])})(),dG=`
  float circleSD(vec2 p, float r) {
    return distance(vec2(0), p) - r; // signed distance
  }
`,fG=`
  float rectangleSD(vec2 p, vec2 b) {
    vec2 d = abs(p)-b;
    return distance(vec2(0),max(d,0.0)) + min(max(d.x,d.y),0.0);
  }
`,hG=`
  float roundRectangleSD(vec2 p, vec2 b, vec4 cr) {
    cr.xy = (p.x > 0.0) ? cr.xy : cr.zw;
    cr.x  = (p.y > 0.0) ? cr.x  : cr.y;
    vec2 q = abs(p) - b + cr.x;
    return min(max(q.x, q.y), 0.0) + distance(vec2(0), max(q, 0.0)) - cr.x;
  }
`,pG=`
  float ellipseSD(vec2 p, vec2 ab) {
    p = abs( p ); // symmetry

    // find root with Newton solver
    vec2 q = ab*(p-ab);
    float w = (q.x<q.y)? 1.570796327 : 0.0;
    for( int i=0; i<5; i++ ) {
      vec2 cs = vec2(cos(w),sin(w));
      vec2 u = ab*vec2( cs.x,cs.y);
      vec2 v = ab*vec2(-cs.y,cs.x);
      w = w + dot(p-u,v)/(dot(p-u,u)+dot(v,v));
    }
    
    // compute final point and distance
    float d = length(p-ab*vec2(cos(w),sin(w)));
    
    // return signed distance
    return (dot(p/ab,p/ab)>1.0) ? d : -d;
  }
`,av={SCREEN:{name:"screen",screen:!0},PICKING:{name:"picking",picking:!0}},bx={IGNORE:1,USE_BB:2},y2=0,f5=1,h5=2,x2=3,wp=4,fy=5,Ym=6,Xm=7,mG=(function(){function t(e,r,n){lf(this,t),this.r=e,this.gl=r,this.maxInstances=n.webglBatchSize,this.atlasSize=n.webglTexSize,this.bgColor=n.bgColor,this.debug=n.webglDebug,this.batchDebugInfo=[],n.enableWrapping=!0,n.createTextureCanvas=$U,this.atlasManager=new uG(e,n),this.batchManager=new cG(n),this.simpleShapeOptions=new Map,this.program=this._createShaderProgram(av.SCREEN),this.pickingProgram=this._createShaderProgram(av.PICKING),this.vao=this._createVAO()}return uf(t,[{key:"addAtlasCollection",value:function(r,n){this.atlasManager.addAtlasCollection(r,n)}},{key:"addTextureAtlasRenderType",value:function(r,n){this.atlasManager.addRenderType(r,n)}},{key:"addSimpleShapeRenderType",value:function(r,n){this.simpleShapeOptions.set(r,n)}},{key:"invalidate",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=n.type,a=this.atlasManager;return i?a.invalidate(r,{filterType:function(o){return o===i},forceRedraw:!0}):a.invalidate(r)}},{key:"gc",value:function(){this.atlasManager.gc()}},{key:"_createShaderProgram",value:function(r){var n=this.gl,i=`#version 300 es
      precision highp float;

      uniform mat3 uPanZoomMatrix;
      uniform int  uAtlasSize;
      
      // instanced
      in vec2 aPosition; // a vertex from the unit square
      
      in mat3 aTransform; // used to transform verticies, eg into a bounding box
      in int aVertType; // the type of thing we are rendering

      // the z-index that is output when using picking mode
      in vec4 aIndex;
      
      // For textures
      in int aAtlasId; // which shader unit/atlas to use
      in vec4 aTex; // x/y/w/h of texture in atlas

      // for edges
      in vec4 aPointAPointB;
      in vec4 aPointCPointD;
      in vec2 aLineWidth; // also used for node border width

      // simple shapes
      in vec4 aCornerRadius; // for round-rectangle [top-right, bottom-right, top-left, bottom-left]
      in vec4 aColor; // also used for edges
      in vec4 aBorderColor; // aLineWidth is used for border width

      // output values passed to the fragment shader
      out vec2 vTexCoord;
      out vec4 vColor;
      out vec2 vPosition;
      // flat values are not interpolated
      flat out int vAtlasId; 
      flat out int vVertType;
      flat out vec2 vTopRight;
      flat out vec2 vBotLeft;
      flat out vec4 vCornerRadius;
      flat out vec4 vBorderColor;
      flat out vec2 vBorderWidth;
      flat out vec4 vIndex;
      
      void main(void) {
        int vid = gl_VertexID;
        vec2 position = aPosition; // TODO make this a vec3, simplifies some code below

        if(aVertType == `.concat(y2,`) {
          float texX = aTex.x; // texture coordinates
          float texY = aTex.y;
          float texW = aTex.z;
          float texH = aTex.w;

          if(vid == 1 || vid == 2 || vid == 4) {
            texX += texW;
          }
          if(vid == 2 || vid == 4 || vid == 5) {
            texY += texH;
          }

          float d = float(uAtlasSize);
          vTexCoord = vec2(texX / d, texY / d); // tex coords must be between 0 and 1

          gl_Position = vec4(uPanZoomMatrix * aTransform * vec3(position, 1.0), 1.0);
        }
        else if(aVertType == `).concat(wp," || aVertType == ").concat(Xm,` 
             || aVertType == `).concat(fy," || aVertType == ").concat(Ym,`) { // simple shapes

          // the bounding box is needed by the fragment shader
          vBotLeft  = (aTransform * vec3(0, 0, 1)).xy; // flat
          vTopRight = (aTransform * vec3(1, 1, 1)).xy; // flat
          vPosition = (aTransform * vec3(position, 1)).xy; // will be interpolated

          // calculations are done in the fragment shader, just pass these along
          vColor = aColor;
          vCornerRadius = aCornerRadius;
          vBorderColor = aBorderColor;
          vBorderWidth = aLineWidth;

          gl_Position = vec4(uPanZoomMatrix * aTransform * vec3(position, 1.0), 1.0);
        }
        else if(aVertType == `).concat(f5,`) {
          vec2 source = aPointAPointB.xy;
          vec2 target = aPointAPointB.zw;

          // adjust the geometry so that the line is centered on the edge
          position.y = position.y - 0.5;

          // stretch the unit square into a long skinny rectangle
          vec2 xBasis = target - source;
          vec2 yBasis = normalize(vec2(-xBasis.y, xBasis.x));
          vec2 point = source + xBasis * position.x + yBasis * aLineWidth[0] * position.y;

          gl_Position = vec4(uPanZoomMatrix * vec3(point, 1.0), 1.0);
          vColor = aColor;
        } 
        else if(aVertType == `).concat(h5,`) {
          vec2 pointA = aPointAPointB.xy;
          vec2 pointB = aPointAPointB.zw;
          vec2 pointC = aPointCPointD.xy;
          vec2 pointD = aPointCPointD.zw;

          // adjust the geometry so that the line is centered on the edge
          position.y = position.y - 0.5;

          vec2 p0, p1, p2, pos;
          if(position.x == 0.0) { // The left side of the unit square
            p0 = pointA;
            p1 = pointB;
            p2 = pointC;
            pos = position;
          } else { // The right side of the unit square, use same approach but flip the geometry upside down
            p0 = pointD;
            p1 = pointC;
            p2 = pointB;
            pos = vec2(0.0, -position.y);
          }

          vec2 p01 = p1 - p0;
          vec2 p12 = p2 - p1;
          vec2 p21 = p1 - p2;

          // Find the normal vector.
          vec2 tangent = normalize(normalize(p12) + normalize(p01));
          vec2 normal = vec2(-tangent.y, tangent.x);

          // Find the vector perpendicular to p0 -> p1.
          vec2 p01Norm = normalize(vec2(-p01.y, p01.x));

          // Determine the bend direction.
          float sigma = sign(dot(p01 + p21, normal));
          float width = aLineWidth[0];

          if(sign(pos.y) == -sigma) {
            // This is an intersecting vertex. Adjust the position so that there's no overlap.
            vec2 point = 0.5 * width * normal * -sigma / dot(normal, p01Norm);
            gl_Position = vec4(uPanZoomMatrix * vec3(p1 + point, 1.0), 1.0);
          } else {
            // This is a non-intersecting vertex. Treat it like a mitre join.
            vec2 point = 0.5 * width * normal * sigma * dot(normal, p01Norm);
            gl_Position = vec4(uPanZoomMatrix * vec3(p1 + point, 1.0), 1.0);
          }

          vColor = aColor;
        } 
        else if(aVertType == `).concat(x2,` && vid < 3) {
          // massage the first triangle into an edge arrow
          if(vid == 0)
            position = vec2(-0.15, -0.3);
          if(vid == 1)
            position = vec2(  0.0,  0.0);
          if(vid == 2)
            position = vec2( 0.15, -0.3);

          gl_Position = vec4(uPanZoomMatrix * aTransform * vec3(position, 1.0), 1.0);
          vColor = aColor;
        }
        else {
          gl_Position = vec4(2.0, 0.0, 0.0, 1.0); // discard vertex by putting it outside webgl clip space
        }

        vAtlasId = aAtlasId;
        vVertType = aVertType;
        vIndex = aIndex;
      }
    `),a=this.batchManager.getIndexArray(),s=`#version 300 es
      precision highp float;

      // declare texture unit for each texture atlas in the batch
      `.concat(a.map(function(u){return"uniform sampler2D uTexture".concat(u,";")}).join(`
	`),`

      uniform vec4 uBGColor;
      uniform float uZoom;

      in vec2 vTexCoord;
      in vec4 vColor;
      in vec2 vPosition; // model coordinates

      flat in int vAtlasId;
      flat in vec4 vIndex;
      flat in int vVertType;
      flat in vec2 vTopRight;
      flat in vec2 vBotLeft;
      flat in vec4 vCornerRadius;
      flat in vec4 vBorderColor;
      flat in vec2 vBorderWidth;

      out vec4 outColor;

      `).concat(dG,`
      `).concat(fG,`
      `).concat(hG,`
      `).concat(pG,`

      vec4 blend(vec4 top, vec4 bot) { // blend colors with premultiplied alpha
        return vec4( 
          top.rgb + (bot.rgb * (1.0 - top.a)),
          top.a   + (bot.a   * (1.0 - top.a)) 
        );
      }

      vec4 distInterp(vec4 cA, vec4 cB, float d) { // interpolate color using Signed Distance
        // scale to the zoom level so that borders don't look blurry when zoomed in
        // note 1.5 is an aribitrary value chosen because it looks good
        return mix(cA, cB, 1.0 - smoothstep(0.0, 1.5 / uZoom, abs(d))); 
      }

      void main(void) {
        if(vVertType == `).concat(y2,`) {
          // look up the texel from the texture unit
          `).concat(a.map(function(u){return"if(vAtlasId == ".concat(u,") outColor = texture(uTexture").concat(u,", vTexCoord);")}).join(`
	else `),`
        } 
        else if(vVertType == `).concat(x2,`) {
          // mimics how canvas renderer uses context.globalCompositeOperation = 'destination-out';
          outColor = blend(vColor, uBGColor);
          outColor.a = 1.0; // make opaque, masks out line under arrow
        }
        else if(vVertType == `).concat(wp,` && vBorderWidth == vec2(0.0)) { // simple rectangle with no border
          outColor = vColor; // unit square is already transformed to the rectangle, nothing else needs to be done
        }
        else if(vVertType == `).concat(wp," || vVertType == ").concat(Xm,` 
          || vVertType == `).concat(fy," || vVertType == ").concat(Ym,`) { // use SDF

          float outerBorder = vBorderWidth[0];
          float innerBorder = vBorderWidth[1];
          float borderPadding = outerBorder * 2.0;
          float w = vTopRight.x - vBotLeft.x - borderPadding;
          float h = vTopRight.y - vBotLeft.y - borderPadding;
          vec2 b = vec2(w/2.0, h/2.0); // half width, half height
          vec2 p = vPosition - vec2(vTopRight.x - b[0] - outerBorder, vTopRight.y - b[1] - outerBorder); // translate to center

          float d; // signed distance
          if(vVertType == `).concat(wp,`) {
            d = rectangleSD(p, b);
          } else if(vVertType == `).concat(Xm,` && w == h) {
            d = circleSD(p, b.x); // faster than ellipse
          } else if(vVertType == `).concat(Xm,`) {
            d = ellipseSD(p, b);
          } else {
            d = roundRectangleSD(p, b, vCornerRadius.wzyx);
          }

          // use the distance to interpolate a color to smooth the edges of the shape, doesn't need multisampling
          // we must smooth colors inwards, because we can't change pixels outside the shape's bounding box
          if(d > 0.0) {
            if(d > outerBorder) {
              discard;
            } else {
              outColor = distInterp(vBorderColor, vec4(0), d - outerBorder);
            }
          } else {
            if(d > innerBorder) {
              vec4 outerColor = outerBorder == 0.0 ? vec4(0) : vBorderColor;
              vec4 innerBorderColor = blend(vBorderColor, vColor);
              outColor = distInterp(innerBorderColor, outerColor, d);
            } 
            else {
              vec4 outerColor;
              if(innerBorder == 0.0 && outerBorder == 0.0) {
                outerColor = vec4(0);
              } else if(innerBorder == 0.0) {
                outerColor = vBorderColor;
              } else {
                outerColor = blend(vBorderColor, vColor);
              }
              outColor = distInterp(vColor, outerColor, d - innerBorder);
            }
          }
        }
        else {
          outColor = vColor;
        }

        `).concat(r.picking?`if(outColor.a == 0.0) discard;
             else outColor = vIndex;`:"",`
      }
    `),o=qU(n,i,s);o.aPosition=n.getAttribLocation(o,"aPosition"),o.aIndex=n.getAttribLocation(o,"aIndex"),o.aVertType=n.getAttribLocation(o,"aVertType"),o.aTransform=n.getAttribLocation(o,"aTransform"),o.aAtlasId=n.getAttribLocation(o,"aAtlasId"),o.aTex=n.getAttribLocation(o,"aTex"),o.aPointAPointB=n.getAttribLocation(o,"aPointAPointB"),o.aPointCPointD=n.getAttribLocation(o,"aPointCPointD"),o.aLineWidth=n.getAttribLocation(o,"aLineWidth"),o.aColor=n.getAttribLocation(o,"aColor"),o.aCornerRadius=n.getAttribLocation(o,"aCornerRadius"),o.aBorderColor=n.getAttribLocation(o,"aBorderColor"),o.uPanZoomMatrix=n.getUniformLocation(o,"uPanZoomMatrix"),o.uAtlasSize=n.getUniformLocation(o,"uAtlasSize"),o.uBGColor=n.getUniformLocation(o,"uBGColor"),o.uZoom=n.getUniformLocation(o,"uZoom"),o.uTextures=[];for(var l=0;l<this.batchManager.getMaxAtlasesPerBatch();l++)o.uTextures.push(n.getUniformLocation(o,"uTexture".concat(l)));return o}},{key:"_createVAO",value:function(){var r=[0,0,1,0,1,1,0,0,1,1,0,1];this.vertexCount=r.length/2;var n=this.maxInstances,i=this.gl,a=this.program,s=i.createVertexArray();return i.bindVertexArray(s),tG(i,"vec2",a.aPosition,r),this.transformBuffer=rG(i,n,a.aTransform),this.indexBuffer=fu(i,n,"vec4",a.aIndex),this.vertTypeBuffer=fu(i,n,"int",a.aVertType),this.atlasIdBuffer=fu(i,n,"int",a.aAtlasId),this.texBuffer=fu(i,n,"vec4",a.aTex),this.pointAPointBBuffer=fu(i,n,"vec4",a.aPointAPointB),this.pointCPointDBuffer=fu(i,n,"vec4",a.aPointCPointD),this.lineWidthBuffer=fu(i,n,"vec2",a.aLineWidth),this.colorBuffer=fu(i,n,"vec4",a.aColor),this.cornerRadiusBuffer=fu(i,n,"vec4",a.aCornerRadius),this.borderColorBuffer=fu(i,n,"vec4",a.aBorderColor),i.bindVertexArray(null),s}},{key:"buffers",get:function(){var r=this;return this._buffers||(this._buffers=Object.keys(this).filter(function(n){return Dd(n,"Buffer")}).map(function(n){return r[n]})),this._buffers}},{key:"startFrame",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:av.SCREEN;this.panZoomMatrix=r,this.renderTarget=n,this.batchDebugInfo=[],this.wrappedCount=0,this.simpleCount=0,this.startBatch()}},{key:"startBatch",value:function(){this.instanceCount=0,this.batchManager.startBatch()}},{key:"endFrame",value:function(){this.endBatch()}},{key:"_isVisible",value:function(r,n){return r.visible()?n&&n.isVisible?n.isVisible(r):!0:!1}},{key:"drawTexture",value:function(r,n,i){var a=this.atlasManager,s=this.batchManager,o=a.getRenderTypeOpts(i);if(this._isVisible(r,o)&&!(r.isEdge()&&!this._isValidEdge(r))){if(this.renderTarget.picking&&o.getTexPickingMode){var l=o.getTexPickingMode(r);if(l===bx.IGNORE)return;if(l==bx.USE_BB){this.drawPickingRectangle(r,n,i);return}}var u=a.getAtlasInfo(r,i),c=Ws(u),f;try{for(c.s();!(f=c.n()).done;){var p=f.value,v=p.atlas,y=p.tex1,S=p.tex2;s.canAddToCurrentBatch(v)||this.endBatch();for(var w=s.getAtlasIndexForBatch(v),T=0,_=[[y,!0],[S,!1]];T<_.length;T++){var C=Ai(_[T],2),N=C[0],A=C[1];if(N.w!=0){var O=this.instanceCount;this.vertTypeBuffer.getView(O)[0]=y2;var j=this.indexBuffer.getView(O);bp(n,j);var D=this.atlasIdBuffer.getView(O);D[0]=w;var F=this.texBuffer.getView(O);F[0]=N.x,F[1]=N.y,F[2]=N.w,F[3]=N.h;var B=this.transformBuffer.getMatrixView(O);this.setTransformMatrix(r,B,o,p,A),this.instanceCount++,A||this.wrappedCount++,this.instanceCount>=this.maxInstances&&this.endBatch()}}}}catch($){c.e($)}finally{c.f()}}}},{key:"setTransformMatrix",value:function(r,n,i,a){var s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,o=0;if(i.shapeProps&&i.shapeProps.padding&&(o=r.pstyle(i.shapeProps.padding).pfValue),a){var l=a.bb,u=a.tex1,c=a.tex2,f=u.w/(u.w+c.w);s||(f=1-f);var p=this._getAdjustedBB(l,o,s,f);this._applyTransformMatrix(n,p,i,r)}else{var v=i.getBoundingBox(r),y=this._getAdjustedBB(v,o,!0,1);this._applyTransformMatrix(n,y,i,r)}}},{key:"_applyTransformMatrix",value:function(r,n,i,a){var s,o;c5(r);var l=i.getRotation?i.getRotation(a):0;if(l!==0){var u=i.getRotationPoint(a),c=u.x,f=u.y;Zy(r,r,[c,f]),d5(r,r,l);var p=i.getRotationOffset(a);s=p.x+(n.xOffset||0),o=p.y+(n.yOffset||0)}else s=n.x1,o=n.y1;Zy(r,r,[s,o]),tk(r,r,[n.w,n.h])}},{key:"_getAdjustedBB",value:function(r,n,i,a){var s=r.x1,o=r.y1,l=r.w,u=r.h,c=r.yOffset;n&&(s-=n,o-=n,l+=2*n,u+=2*n);var f=0,p=l*a;return i&&a<1?l=p:!i&&a<1&&(f=l-p,s+=f,l=p),{x1:s,y1:o,w:l,h:u,xOffset:f,yOffset:c}}},{key:"drawPickingRectangle",value:function(r,n,i){var a=this.atlasManager.getRenderTypeOpts(i),s=this.instanceCount;this.vertTypeBuffer.getView(s)[0]=wp;var o=this.indexBuffer.getView(s);bp(n,o);var l=this.colorBuffer.getView(s);qf([0,0,0],1,l);var u=this.transformBuffer.getMatrixView(s);this.setTransformMatrix(r,u,a),this.simpleCount++,this.instanceCount++,this.instanceCount>=this.maxInstances&&this.endBatch()}},{key:"drawNode",value:function(r,n,i){var a=this.simpleShapeOptions.get(i);if(this._isVisible(r,a)){var s=a.shapeProps,o=this._getVertTypeForShape(r,s.shape);if(o===void 0||a.isSimple&&!a.isSimple(r)){this.drawTexture(r,n,i);return}var l=this.instanceCount;if(this.vertTypeBuffer.getView(l)[0]=o,o===fy||o===Ym){var u=a.getBoundingBox(r),c=this._getCornerRadius(r,s.radius,u),f=this.cornerRadiusBuffer.getView(l);f[0]=c,f[1]=c,f[2]=c,f[3]=c,o===Ym&&(f[0]=0,f[2]=0)}var p=this.indexBuffer.getView(l);bp(n,p);var v=r.pstyle(s.color).value,y=r.pstyle(s.opacity).value,S=this.colorBuffer.getView(l);qf(v,y,S);var w=this.lineWidthBuffer.getView(l);if(w[0]=0,w[1]=0,s.border){var T=r.pstyle("border-width").value;if(T>0){var _=r.pstyle("border-color").value,C=r.pstyle("border-opacity").value,N=this.borderColorBuffer.getView(l);qf(_,C,N);var A=r.pstyle("border-position").value;if(A==="inside")w[0]=0,w[1]=-T;else if(A==="outside")w[0]=T,w[1]=0;else{var O=T/2;w[0]=O,w[1]=-O}}}var j=this.transformBuffer.getMatrixView(l);this.setTransformMatrix(r,j,a),this.simpleCount++,this.instanceCount++,this.instanceCount>=this.maxInstances&&this.endBatch()}}},{key:"_getVertTypeForShape",value:function(r,n){var i=r.pstyle(n).value;switch(i){case"rectangle":return wp;case"ellipse":return Xm;case"roundrectangle":case"round-rectangle":return fy;case"bottom-round-rectangle":return Ym;default:return}}},{key:"_getCornerRadius",value:function(r,n,i){var a=i.w,s=i.h;if(r.pstyle(n).value==="auto")return Jd(a,s);var o=r.pstyle(n).pfValue,l=a/2,u=s/2;return Math.min(o,u,l)}},{key:"drawEdgeArrow",value:function(r,n,i){if(r.visible()){var a=r._private.rscratch,s,o,l;if(i==="source"?(s=a.arrowStartX,o=a.arrowStartY,l=a.srcArrowAngle):(s=a.arrowEndX,o=a.arrowEndY,l=a.tgtArrowAngle),!(isNaN(s)||s==null||isNaN(o)||o==null||isNaN(l)||l==null)){var u=r.pstyle(i+"-arrow-shape").value;if(u!=="none"){var c=r.pstyle(i+"-arrow-color").value,f=r.pstyle("opacity").value,p=r.pstyle("line-opacity").value,v=f*p,y=r.pstyle("width").pfValue,S=r.pstyle("arrow-scale").value,w=this.r.getArrowWidth(y,S),T=this.instanceCount,_=this.transformBuffer.getMatrixView(T);c5(_),Zy(_,_,[s,o]),tk(_,_,[w,w]),d5(_,_,l),this.vertTypeBuffer.getView(T)[0]=x2;var C=this.indexBuffer.getView(T);bp(n,C);var N=this.colorBuffer.getView(T);qf(c,v,N),this.instanceCount++,this.instanceCount>=this.maxInstances&&this.endBatch()}}}}},{key:"drawEdgeLine",value:function(r,n){if(r.visible()){var i=this._getEdgePoints(r);if(i){var a=r.pstyle("opacity").value,s=r.pstyle("line-opacity").value,o=r.pstyle("width").pfValue,l=r.pstyle("line-color").value,u=a*s;if(i.length/2+this.instanceCount>this.maxInstances&&this.endBatch(),i.length==4){var c=this.instanceCount;this.vertTypeBuffer.getView(c)[0]=f5;var f=this.indexBuffer.getView(c);bp(n,f);var p=this.colorBuffer.getView(c);qf(l,u,p);var v=this.lineWidthBuffer.getView(c);v[0]=o;var y=this.pointAPointBBuffer.getView(c);y[0]=i[0],y[1]=i[1],y[2]=i[2],y[3]=i[3],this.instanceCount++,this.instanceCount>=this.maxInstances&&this.endBatch()}else for(var S=0;S<i.length-2;S+=2){var w=this.instanceCount;this.vertTypeBuffer.getView(w)[0]=h5;var T=this.indexBuffer.getView(w);bp(n,T);var _=this.colorBuffer.getView(w);qf(l,u,_);var C=this.lineWidthBuffer.getView(w);C[0]=o;var N=i[S-2],A=i[S-1],O=i[S],j=i[S+1],D=i[S+2],F=i[S+3],B=i[S+4],$=i[S+5];S==0&&(N=2*O-D+.001,A=2*j-F+.001),S==i.length-4&&(B=2*D-O+.001,$=2*F-j+.001);var Z=this.pointAPointBBuffer.getView(w);Z[0]=N,Z[1]=A,Z[2]=O,Z[3]=j;var I=this.pointCPointDBuffer.getView(w);I[0]=D,I[1]=F,I[2]=B,I[3]=$,this.instanceCount++,this.instanceCount>=this.maxInstances&&this.endBatch()}}}}},{key:"_isValidEdge",value:function(r){var n=r._private.rscratch;return!(n.badLine||n.allpts==null||isNaN(n.allpts[0]))}},{key:"_getEdgePoints",value:function(r){var n=r._private.rscratch;if(this._isValidEdge(r)){var i=n.allpts;if(i.length==4)return i;var a=this._getNumSegments(r);return this._getCurveSegmentPoints(i,a)}}},{key:"_getNumSegments",value:function(r){var n=15;return Math.min(Math.max(n,5),this.maxInstances)}},{key:"_getCurveSegmentPoints",value:function(r,n){if(r.length==4)return r;for(var i=Array((n+1)*2),a=0;a<=n;a++)if(a==0)i[0]=r[0],i[1]=r[1];else if(a==n)i[a*2]=r[r.length-2],i[a*2+1]=r[r.length-1];else{var s=a/n;this._setCurvePoint(r,s,i,a*2)}return i}},{key:"_setCurvePoint",value:function(r,n,i,a){if(r.length<=2)i[a]=r[0],i[a+1]=r[1];else{for(var s=Array(r.length-2),o=0;o<s.length;o+=2){var l=(1-n)*r[o]+n*r[o+2],u=(1-n)*r[o+1]+n*r[o+3];s[o]=l,s[o+1]=u}return this._setCurvePoint(s,n,i,a)}}},{key:"endBatch",value:function(){var r=this.gl,n=this.vao,i=this.vertexCount,a=this.instanceCount;if(a!==0){var s=this.renderTarget.picking?this.pickingProgram:this.program;r.useProgram(s),r.bindVertexArray(n);var o=Ws(this.buffers),l;try{for(o.s();!(l=o.n()).done;){var u=l.value;u.bufferSubData(a)}}catch(y){o.e(y)}finally{o.f()}for(var c=this.batchManager.getAtlases(),f=0;f<c.length;f++)c[f].bufferIfNeeded(r);for(var p=0;p<c.length;p++)r.activeTexture(r.TEXTURE0+p),r.bindTexture(r.TEXTURE_2D,c[p].texture),r.uniform1i(s.uTextures[p],p);r.uniform1f(s.uZoom,KU(this.r)),r.uniformMatrix3fv(s.uPanZoomMatrix,!1,this.panZoomMatrix),r.uniform1i(s.uAtlasSize,this.batchManager.getAtlasSize());var v=qf(this.bgColor,1);r.uniform4fv(s.uBGColor,v),r.drawArraysInstanced(r.TRIANGLES,0,i,a),r.bindVertexArray(null),r.bindTexture(r.TEXTURE_2D,null),this.debug&&this.batchDebugInfo.push({count:a,atlasCount:c.length}),this.startBatch()}}},{key:"getDebugInfo",value:function(){var r=this.atlasManager.getDebugInfo(),n=r.reduce(function(s,o){return s+o.atlasCount},0),i=this.batchDebugInfo,a=i.reduce(function(s,o){return s+o.count},0);return{atlasInfo:r,totalAtlases:n,wrappedCount:this.wrappedCount,simpleCount:this.simpleCount,batchCount:i.length,batchInfo:i,totalInstances:a}}}])})(),CL={};CL.initWebgl=function(t,e){var r=this,n=r.data.contexts[r.WEBGL];t.bgColor=gG(r),t.webglTexSize=Math.min(t.webglTexSize,n.getParameter(n.MAX_TEXTURE_SIZE)),t.webglTexRows=Math.min(t.webglTexRows,54),t.webglTexRowsNodes=Math.min(t.webglTexRowsNodes,54),t.webglBatchSize=Math.min(t.webglBatchSize,16384),t.webglTexPerBatch=Math.min(t.webglTexPerBatch,n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS)),r.webglDebug=t.webglDebug,r.webglDebugShowAtlases=t.webglDebugShowAtlases,r.pickingFrameBuffer=nG(n),r.pickingFrameBuffer.needsDraw=!0,r.drawing=new mG(r,n,t);var i=function(f){return function(p){return r.getTextAngle(p,f)}},a=function(f){return function(p){var v=p.pstyle(f);return v&&v.value}},s=function(f){return function(p){return p.pstyle("".concat(f,"-opacity")).value>0}},o=function(f){var p=f.pstyle("text-events").strValue==="yes";return p?bx.USE_BB:bx.IGNORE},l=function(f){var p=f.position(),v=p.x,y=p.y,S=f.outerWidth(),w=f.outerHeight();return{w:S,h:w,x1:v-S/2,y1:y-w/2}};r.drawing.addAtlasCollection("node",{texRows:t.webglTexRowsNodes}),r.drawing.addAtlasCollection("label",{texRows:t.webglTexRows}),r.drawing.addTextureAtlasRenderType("node-body",{collection:"node",getKey:e.getStyleKey,getBoundingBox:e.getElementBox,drawElement:e.drawElement}),r.drawing.addSimpleShapeRenderType("node-body",{getBoundingBox:l,isSimple:YU,shapeProps:{shape:"shape",color:"background-color",opacity:"background-opacity",radius:"corner-radius",border:!0}}),r.drawing.addSimpleShapeRenderType("node-overlay",{getBoundingBox:l,isVisible:s("overlay"),shapeProps:{shape:"overlay-shape",color:"overlay-color",opacity:"overlay-opacity",padding:"overlay-padding",radius:"overlay-corner-radius"}}),r.drawing.addSimpleShapeRenderType("node-underlay",{getBoundingBox:l,isVisible:s("underlay"),shapeProps:{shape:"underlay-shape",color:"underlay-color",opacity:"underlay-opacity",padding:"underlay-padding",radius:"underlay-corner-radius"}}),r.drawing.addTextureAtlasRenderType("label",{collection:"label",getTexPickingMode:o,getKey:b2(e.getLabelKey,null),getBoundingBox:w2(e.getLabelBox,null),drawClipped:!0,drawElement:e.drawLabel,getRotation:i(null),getRotationPoint:e.getLabelRotationPoint,getRotationOffset:e.getLabelRotationOffset,isVisible:a("label")}),r.drawing.addTextureAtlasRenderType("edge-source-label",{collection:"label",getTexPickingMode:o,getKey:b2(e.getSourceLabelKey,"source"),getBoundingBox:w2(e.getSourceLabelBox,"source"),drawClipped:!0,drawElement:e.drawSourceLabel,getRotation:i("source"),getRotationPoint:e.getSourceLabelRotationPoint,getRotationOffset:e.getSourceLabelRotationOffset,isVisible:a("source-label")}),r.drawing.addTextureAtlasRenderType("edge-target-label",{collection:"label",getTexPickingMode:o,getKey:b2(e.getTargetLabelKey,"target"),getBoundingBox:w2(e.getTargetLabelBox,"target"),drawClipped:!0,drawElement:e.drawTargetLabel,getRotation:i("target"),getRotationPoint:e.getTargetLabelRotationPoint,getRotationOffset:e.getTargetLabelRotationOffset,isVisible:a("target-label")});var u=n0(function(){console.log("garbage collect flag set"),r.data.gc=!0},1e4);r.onUpdateEleCalcs(function(c,f){var p=!1;f&&f.length>0&&(p|=r.drawing.invalidate(f)),p&&u()}),vG(r)};function gG(t){var e=t.cy.container(),r=e&&e.style&&e.style.backgroundColor||"white";return JM(r)}function EL(t,e){var r=t._private.rscratch;return Gs(r,"labelWrapCachedLines",e)||[]}var b2=function(e,r){return function(n){var i=e(n),a=EL(n,r);return a.length>1?a.map(function(s,o){return"".concat(i,"_").concat(o)}):i}},w2=function(e,r){return function(n,i){var a=e(n);if(typeof i=="string"){var s=i.indexOf("_");if(s>0){var o=Number(i.substring(s+1)),l=EL(n,r),u=a.h/l.length,c=u*o,f=a.y1+c;return{x1:a.x1,w:a.w,y1:f,h:u,yOffset:c}}}return a}};function vG(t){{var e=t.render;t.render=function(a){a=a||{};var s=t.cy;t.webgl&&(s.zoom()>yL?(yG(t),e.call(t,a)):(xG(t),NL(t,a,av.SCREEN)))}}{var r=t.matchCanvasSize;t.matchCanvasSize=function(a){r.call(t,a),t.pickingFrameBuffer.setFramebufferAttachmentSizes(t.canvasWidth,t.canvasHeight),t.pickingFrameBuffer.needsDraw=!0}}t.findNearestElements=function(a,s,o,l){return CG(t,a,s)};{var n=t.invalidateCachedZSortedEles;t.invalidateCachedZSortedEles=function(){n.call(t),t.pickingFrameBuffer.needsDraw=!0}}{var i=t.notify;t.notify=function(a,s){i.call(t,a,s),a==="viewport"||a==="bounds"?t.pickingFrameBuffer.needsDraw=!0:a==="background"&&t.drawing.invalidate(s,{type:"node-body"})}}}function yG(t){var e=t.data.contexts[t.WEBGL];e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT)}function xG(t){var e=function(n){n.save(),n.setTransform(1,0,0,1,0,0),n.clearRect(0,0,t.canvasWidth,t.canvasHeight),n.restore()};e(t.data.contexts[t.NODE]),e(t.data.contexts[t.DRAG])}function bG(t){var e=t.canvasWidth,r=t.canvasHeight,n=P_(t),i=n.pan,a=n.zoom,s=v2();Zy(s,s,[i.x,i.y]),tk(s,s,[a,a]);var o=v2();aG(o,e,r);var l=v2();return iG(l,o,s),l}function TL(t,e){var r=t.canvasWidth,n=t.canvasHeight,i=P_(t),a=i.pan,s=i.zoom;e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,r,n),e.translate(a.x,a.y),e.scale(s,s)}function wG(t,e){t.drawSelectionRectangle(e,function(r){return TL(t,r)})}function SG(t){var e=t.data.contexts[t.NODE];e.save(),TL(t,e),e.strokeStyle="rgba(0, 0, 0, 0.3)",e.beginPath(),e.moveTo(-1e3,0),e.lineTo(1e3,0),e.stroke(),e.beginPath(),e.moveTo(0,-1e3),e.lineTo(0,1e3),e.stroke(),e.restore()}function kG(t){var e=function(i,a,s){for(var o=i.atlasManager.getAtlasCollection(a),l=t.data.contexts[t.NODE],u=o.atlases,c=0;c<u.length;c++){var f=u[c],p=f.canvas;if(p){var v=p.width,y=p.height,S=v*c,w=p.height*s,T=.4;l.save(),l.scale(T,T),l.drawImage(p,S,w),l.strokeStyle="black",l.rect(S,w,v,y),l.stroke(),l.restore()}}},r=0;e(t.drawing,"node",r++),e(t.drawing,"label",r++)}function _G(t,e,r,n,i){var a,s,o,l,u=P_(t),c=u.pan,f=u.zoom;{var p=ZU(t,c,f,e,r),v=Ai(p,2),y=v[0],S=v[1],w=6;a=y-w/2,s=S-w/2,o=w,l=w}if(o===0||l===0)return[];var T=t.data.contexts[t.WEBGL];T.bindFramebuffer(T.FRAMEBUFFER,t.pickingFrameBuffer),t.pickingFrameBuffer.needsDraw&&(T.viewport(0,0,T.canvas.width,T.canvas.height),NL(t,null,av.PICKING),t.pickingFrameBuffer.needsDraw=!1);var _=o*l,C=new Uint8Array(_*4);T.readPixels(a,s,o,l,T.RGBA,T.UNSIGNED_BYTE,C),T.bindFramebuffer(T.FRAMEBUFFER,null);for(var N=new Set,A=0;A<_;A++){var O=C.slice(A*4,A*4+4),j=QU(O)-1;j>=0&&N.add(j)}return N}function CG(t,e,r){var n=_G(t,e,r),i=t.getCachedZSortedEles(),a,s,o=Ws(n),l;try{for(o.s();!(l=o.n()).done;){var u=l.value,c=i[u];if(!a&&c.isNode()&&(a=c),!s&&c.isEdge()&&(s=c),a&&s)break}}catch(f){o.e(f)}finally{o.f()}return[a,s].filter(Boolean)}function S2(t,e,r){var n=t.drawing;e+=1,r.isNode()?(n.drawNode(r,e,"node-underlay"),n.drawNode(r,e,"node-body"),n.drawTexture(r,e,"label"),n.drawNode(r,e,"node-overlay")):(n.drawEdgeLine(r,e),n.drawEdgeArrow(r,e,"source"),n.drawEdgeArrow(r,e,"target"),n.drawTexture(r,e,"label"),n.drawTexture(r,e,"edge-source-label"),n.drawTexture(r,e,"edge-target-label"))}function NL(t,e,r){var n;t.webglDebug&&(n=performance.now());var i=t.drawing,a=0;if(r.screen&&t.data.canvasNeedsRedraw[t.SELECT_BOX]&&wG(t,e),t.data.canvasNeedsRedraw[t.NODE]||r.picking){var s=t.data.contexts[t.WEBGL];r.screen?(s.clearColor(0,0,0,0),s.enable(s.BLEND),s.blendFunc(s.ONE,s.ONE_MINUS_SRC_ALPHA)):s.disable(s.BLEND),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT),s.viewport(0,0,s.canvas.width,s.canvas.height);var o=bG(t),l=t.getCachedZSortedEles();if(a=l.length,i.startFrame(o,r),r.screen){for(var u=0;u<l.nondrag.length;u++)S2(t,u,l.nondrag[u]);for(var c=0;c<l.drag.length;c++)S2(t,c,l.drag[c])}else if(r.picking)for(var f=0;f<l.length;f++)S2(t,f,l[f]);i.endFrame(),r.screen&&t.webglDebugShowAtlases&&(SG(t),kG(t)),t.data.canvasNeedsRedraw[t.NODE]=!1,t.data.canvasNeedsRedraw[t.DRAG]=!1}if(t.webglDebug){var p=performance.now(),v=!1,y=Math.ceil(p-n),S=i.getDebugInfo(),w=["".concat(a," elements"),"".concat(S.totalInstances," instances"),"".concat(S.batchCount," batches"),"".concat(S.totalAtlases," atlases"),"".concat(S.wrappedCount," wrapped textures"),"".concat(S.simpleCount," simple shapes")].join(", ");if(v)console.log("WebGL (".concat(r.name,") - time ").concat(y,"ms, ").concat(w));else{console.log("WebGL (".concat(r.name,") - frame time ").concat(y,"ms")),console.log("Totals:"),console.log("  ".concat(w)),console.log("Texture Atlases Used:");var T=S.atlasInfo,_=Ws(T),C;try{for(_.s();!(C=_.n()).done;){var N=C.value;console.log("  ".concat(N.type,": ").concat(N.keyCount," keys, ").concat(N.atlasCount," atlases"))}}catch(A){_.e(A)}finally{_.f()}console.log("")}}t.data.gc&&(console.log("Garbage Collect!"),t.data.gc=!1,i.gc())}var ff={};ff.drawPolygonPath=function(t,e,r,n,i,a){var s=n/2,o=i/2;t.beginPath&&t.beginPath(),t.moveTo(e+s*a[0],r+o*a[1]);for(var l=1;l<a.length/2;l++)t.lineTo(e+s*a[l*2],r+o*a[l*2+1]);t.closePath()};ff.drawRoundPolygonPath=function(t,e,r,n,i,a,s){s.forEach(function(o){return uL(t,o)}),t.closePath()};ff.drawRoundRectanglePath=function(t,e,r,n,i,a){var s=n/2,o=i/2,l=a==="auto"?Jd(n,i):Math.min(a,o,s);t.beginPath&&t.beginPath(),t.moveTo(e,r-o),t.arcTo(e+s,r-o,e+s,r,l),t.arcTo(e+s,r+o,e,r+o,l),t.arcTo(e-s,r+o,e-s,r,l),t.arcTo(e-s,r-o,e,r-o,l),t.lineTo(e,r-o),t.closePath()};ff.drawBottomRoundRectanglePath=function(t,e,r,n,i,a){var s=n/2,o=i/2,l=a==="auto"?Jd(n,i):a;t.beginPath&&t.beginPath(),t.moveTo(e,r-o),t.lineTo(e+s,r-o),t.lineTo(e+s,r),t.arcTo(e+s,r+o,e,r+o,l),t.arcTo(e-s,r+o,e-s,r,l),t.lineTo(e-s,r-o),t.lineTo(e,r-o),t.closePath()};ff.drawCutRectanglePath=function(t,e,r,n,i,a,s){var o=n/2,l=i/2,u=s==="auto"?m_():s;t.beginPath&&t.beginPath(),t.moveTo(e-o+u,r-l),t.lineTo(e+o-u,r-l),t.lineTo(e+o,r-l+u),t.lineTo(e+o,r+l-u),t.lineTo(e+o-u,r+l),t.lineTo(e-o+u,r+l),t.lineTo(e-o,r+l-u),t.lineTo(e-o,r-l+u),t.closePath()};ff.drawBarrelPath=function(t,e,r,n,i){var a=n/2,s=i/2,o=e-a,l=e+a,u=r-s,c=r+s,f=US(n,i),p=f.widthOffset,v=f.heightOffset,y=f.ctrlPtOffsetPct*p;t.beginPath&&t.beginPath(),t.moveTo(o,u+v),t.lineTo(o,c-v),t.quadraticCurveTo(o+y,c,o+p,c),t.lineTo(l-p,c),t.quadraticCurveTo(l-y,c,l,c-v),t.lineTo(l,u+v),t.quadraticCurveTo(l-y,u,l-p,u),t.lineTo(o+p,u),t.quadraticCurveTo(o+y,u,o,u+v),t.closePath()};var p5=Math.sin(0),m5=Math.cos(0),rk={},nk={},PL=Math.PI/40;for(var Sp=0*Math.PI;Sp<2*Math.PI;Sp+=PL)rk[Sp]=Math.sin(Sp),nk[Sp]=Math.cos(Sp);ff.drawEllipsePath=function(t,e,r,n,i){if(t.beginPath&&t.beginPath(),t.ellipse)t.ellipse(e,r,n/2,i/2,0,0,2*Math.PI);else for(var a,s,o=n/2,l=i/2,u=0*Math.PI;u<2*Math.PI;u+=PL)a=e-o*rk[u]*p5+o*nk[u]*m5,s=r+l*nk[u]*p5+l*rk[u]*m5,u===0?t.moveTo(a,s):t.lineTo(a,s);t.closePath()};var u0={};u0.createBuffer=function(t,e){var r=document.createElement("canvas");return r.width=t,r.height=e,[r,r.getContext("2d")]};u0.bufferCanvasImage=function(t){var e=this.cy,r=e.mutableElements(),n=r.boundingBox(),i=this.findContainerClientCoords(),a=t.full?Math.ceil(n.w):i[2],s=t.full?Math.ceil(n.h):i[3],o=gt(t.maxWidth)||gt(t.maxHeight),l=this.getPixelRatio(),u=1;if(t.scale!==void 0)a*=t.scale,s*=t.scale,u=t.scale;else if(o){var c=1/0,f=1/0;gt(t.maxWidth)&&(c=u*t.maxWidth/a),gt(t.maxHeight)&&(f=u*t.maxHeight/s),u=Math.min(c,f),a*=u,s*=u}o||(a*=l,s*=l,u*=l);var p=document.createElement("canvas");p.width=a,p.height=s,p.style.width=a+"px",p.style.height=s+"px";var v=p.getContext("2d");if(a>0&&s>0){v.clearRect(0,0,a,s),v.globalCompositeOperation="source-over";var y=this.getCachedZSortedEles();if(t.full)v.translate(-n.x1*u,-n.y1*u),v.scale(u,u),this.drawElements(v,y),v.scale(1/u,1/u),v.translate(n.x1*u,n.y1*u);else{var S=e.pan(),w={x:S.x*u,y:S.y*u};u*=e.zoom(),v.translate(w.x,w.y),v.scale(u,u),this.drawElements(v,y),v.scale(1/u,1/u),v.translate(-w.x,-w.y)}t.bg&&(v.globalCompositeOperation="destination-over",v.fillStyle=t.bg,v.rect(0,0,a,s),v.fill())}return p};function EG(t,e){for(var r=atob(t),n=new ArrayBuffer(r.length),i=new Uint8Array(n),a=0;a<r.length;a++)i[a]=r.charCodeAt(a);return new Blob([n],{type:e})}function g5(t){var e=t.indexOf(",");return t.substr(e+1)}function ML(t,e,r){var n=function(){return e.toDataURL(r,t.quality)};switch(t.output){case"blob-promise":return new hm(function(i,a){try{e.toBlob(function(s){s!=null?i(s):a(new Error("`canvas.toBlob()` sent a null value in its callback"))},r,t.quality)}catch(s){a(s)}});case"blob":return EG(g5(n()),r);case"base64":return g5(n());default:return n()}}u0.png=function(t){return ML(t,this.bufferCanvasImage(t),"image/png")};u0.jpg=function(t){return ML(t,this.bufferCanvasImage(t),"image/jpeg")};var AL={};AL.nodeShapeImpl=function(t,e,r,n,i,a,s,o){switch(t){case"ellipse":return this.drawEllipsePath(e,r,n,i,a);case"polygon":return this.drawPolygonPath(e,r,n,i,a,s);case"round-polygon":return this.drawRoundPolygonPath(e,r,n,i,a,s,o);case"roundrectangle":case"round-rectangle":return this.drawRoundRectanglePath(e,r,n,i,a,o);case"cutrectangle":case"cut-rectangle":return this.drawCutRectanglePath(e,r,n,i,a,s,o);case"bottomroundrectangle":case"bottom-round-rectangle":return this.drawBottomRoundRectanglePath(e,r,n,i,a,o);case"barrel":return this.drawBarrelPath(e,r,n,i,a)}};var TG=LL,wr=LL.prototype;wr.CANVAS_LAYERS=3;wr.SELECT_BOX=0;wr.DRAG=1;wr.NODE=2;wr.WEBGL=3;wr.CANVAS_TYPES=["2d","2d","2d","webgl2"];wr.BUFFER_COUNT=3;wr.TEXTURE_BUFFER=0;wr.MOTIONBLUR_BUFFER_NODE=1;wr.MOTIONBLUR_BUFFER_DRAG=2;function LL(t){var e=this,r=e.cy.window(),n=r.document;t.webgl&&(wr.CANVAS_LAYERS=e.CANVAS_LAYERS=4,console.log("webgl rendering enabled")),e.data={canvases:new Array(wr.CANVAS_LAYERS),contexts:new Array(wr.CANVAS_LAYERS),canvasNeedsRedraw:new Array(wr.CANVAS_LAYERS),bufferCanvases:new Array(wr.BUFFER_COUNT),bufferContexts:new Array(wr.CANVAS_LAYERS)};var i="-webkit-tap-highlight-color",a="rgba(0,0,0,0)";e.data.canvasContainer=n.createElement("div");var s=e.data.canvasContainer.style;e.data.canvasContainer.style[i]=a,s.position="relative",s.zIndex="0",s.overflow="hidden";var o=t.cy.container();o.appendChild(e.data.canvasContainer),o.style[i]=a;var l={"-webkit-user-select":"none","-moz-user-select":"-moz-none","user-select":"none","-webkit-tap-highlight-color":"rgba(0,0,0,0)","outline-style":"none"};wF()&&(l["-ms-touch-action"]="none",l["touch-action"]="none");for(var u=0;u<wr.CANVAS_LAYERS;u++){var c=e.data.canvases[u]=n.createElement("canvas"),f=wr.CANVAS_TYPES[u];e.data.contexts[u]=c.getContext(f),e.data.contexts[u]||Gn("Could not create canvas of type "+f),Object.keys(l).forEach(function(le){c.style[le]=l[le]}),c.style.position="absolute",c.setAttribute("data-id","layer"+u),c.style.zIndex=String(wr.CANVAS_LAYERS-u),e.data.canvasContainer.appendChild(c),e.data.canvasNeedsRedraw[u]=!1}e.data.topCanvas=e.data.canvases[0],e.data.canvases[wr.NODE].setAttribute("data-id","layer"+wr.NODE+"-node"),e.data.canvases[wr.SELECT_BOX].setAttribute("data-id","layer"+wr.SELECT_BOX+"-selectbox"),e.data.canvases[wr.DRAG].setAttribute("data-id","layer"+wr.DRAG+"-drag"),e.data.canvases[wr.WEBGL]&&e.data.canvases[wr.WEBGL].setAttribute("data-id","layer"+wr.WEBGL+"-webgl");for(var u=0;u<wr.BUFFER_COUNT;u++)e.data.bufferCanvases[u]=n.createElement("canvas"),e.data.bufferContexts[u]=e.data.bufferCanvases[u].getContext("2d"),e.data.bufferCanvases[u].style.position="absolute",e.data.bufferCanvases[u].setAttribute("data-id","buffer"+u),e.data.bufferCanvases[u].style.zIndex=String(-u-1),e.data.bufferCanvases[u].style.visibility="hidden";e.pathsEnabled=!0;var p=_s(),v=function(me){return{x:(me.x1+me.x2)/2,y:(me.y1+me.y2)/2}},y=function(me){return{x:-me.w/2,y:-me.h/2}},S=function(me){var he=me[0]._private,xe=he.oldBackgroundTimestamp===he.backgroundTimestamp;return!xe},w=function(me){return me[0]._private.nodeKey},T=function(me){return me[0]._private.labelStyleKey},_=function(me){return me[0]._private.sourceLabelStyleKey},C=function(me){return me[0]._private.targetLabelStyleKey},N=function(me,he,xe,we,Ge){return e.drawElement(me,he,xe,!1,!1,Ge)},A=function(me,he,xe,we,Ge){return e.drawElementText(me,he,xe,we,"main",Ge)},O=function(me,he,xe,we,Ge){return e.drawElementText(me,he,xe,we,"source",Ge)},j=function(me,he,xe,we,Ge){return e.drawElementText(me,he,xe,we,"target",Ge)},D=function(me){return me.boundingBox(),me[0]._private.bodyBounds},F=function(me){return me.boundingBox(),me[0]._private.labelBounds.main||p},B=function(me){return me.boundingBox(),me[0]._private.labelBounds.source||p},$=function(me){return me.boundingBox(),me[0]._private.labelBounds.target||p},Z=function(me,he){return he},I=function(me){return v(D(me))},q=function(me,he,xe){var we=me?me+"-":"";return{x:he.x+xe.pstyle(we+"text-margin-x").pfValue,y:he.y+xe.pstyle(we+"text-margin-y").pfValue}},U=function(me,he,xe){var we=me[0]._private.rscratch;return{x:we[he],y:we[xe]}},W=function(me){return q("",U(me,"labelX","labelY"),me)},Y=function(me){return q("source",U(me,"sourceLabelX","sourceLabelY"),me)},Q=function(me){return q("target",U(me,"targetLabelX","targetLabelY"),me)},ne=function(me){return y(D(me))},re=function(me){return y(B(me))},H=function(me){return y($(me))},te=function(me){var he=F(me),xe=y(F(me));if(me.isNode()){switch(me.pstyle("text-halign").value){case"left":xe.x=-he.w-(he.leftPad||0);break;case"right":xe.x=-(he.rightPad||0);break}switch(me.pstyle("text-valign").value){case"top":xe.y=-he.h-(he.topPad||0);break;case"bottom":xe.y=-(he.botPad||0);break}}return xe},ie=e.data.eleTxrCache=new Yg(e,{getKey:w,doesEleInvalidateKey:S,drawElement:N,getBoundingBox:D,getRotationPoint:I,getRotationOffset:ne,allowEdgeTxrCaching:!1,allowParentTxrCaching:!1}),de=e.data.lblTxrCache=new Yg(e,{getKey:T,drawElement:A,getBoundingBox:F,getRotationPoint:W,getRotationOffset:te,isVisible:Z}),ge=e.data.slbTxrCache=new Yg(e,{getKey:_,drawElement:O,getBoundingBox:B,getRotationPoint:Y,getRotationOffset:re,isVisible:Z}),ye=e.data.tlbTxrCache=new Yg(e,{getKey:C,drawElement:j,getBoundingBox:$,getRotationPoint:Q,getRotationOffset:H,isVisible:Z}),ae=e.data.lyrTxrCache=new xL(e);e.onUpdateEleCalcs(function(me,he){ie.invalidateElements(he),de.invalidateElements(he),ge.invalidateElements(he),ye.invalidateElements(he),ae.invalidateElements(he);for(var xe=0;xe<he.length;xe++){var we=he[xe]._private;we.oldBackgroundTimestamp=we.backgroundTimestamp}});var pe=function(me){for(var he=0;he<me.length;he++)ae.enqueueElementRefinement(me[he].ele)};ie.onDequeue(pe),de.onDequeue(pe),ge.onDequeue(pe),ye.onDequeue(pe),t.webgl&&e.initWebgl(t,{getStyleKey:w,getLabelKey:T,getSourceLabelKey:_,getTargetLabelKey:C,drawElement:N,drawLabel:A,drawSourceLabel:O,drawTargetLabel:j,getElementBox:D,getLabelBox:F,getSourceLabelBox:B,getTargetLabelBox:$,getElementRotationPoint:I,getElementRotationOffset:ne,getLabelRotationPoint:W,getSourceLabelRotationPoint:Y,getTargetLabelRotationPoint:Q,getLabelRotationOffset:te,getSourceLabelRotationOffset:re,getTargetLabelRotationOffset:H})}wr.redrawHint=function(t,e){var r=this;switch(t){case"eles":r.data.canvasNeedsRedraw[wr.NODE]=e;break;case"drag":r.data.canvasNeedsRedraw[wr.DRAG]=e;break;case"select":r.data.canvasNeedsRedraw[wr.SELECT_BOX]=e;break;case"gc":r.data.gc=!0;break}};var NG=typeof Path2D<"u";wr.path2dEnabled=function(t){if(t===void 0)return this.pathsEnabled;this.pathsEnabled=!!t};wr.usePaths=function(){return NG&&this.pathsEnabled};wr.setImgSmoothing=function(t,e){t.imageSmoothingEnabled!=null?t.imageSmoothingEnabled=e:(t.webkitImageSmoothingEnabled=e,t.mozImageSmoothingEnabled=e,t.msImageSmoothingEnabled=e)};wr.getImgSmoothing=function(t){return t.imageSmoothingEnabled!=null?t.imageSmoothingEnabled:t.webkitImageSmoothingEnabled||t.mozImageSmoothingEnabled||t.msImageSmoothingEnabled};wr.makeOffscreenCanvas=function(t,e){var r;if((typeof OffscreenCanvas>"u"?"undefined":Hi(OffscreenCanvas))!=="undefined")r=new OffscreenCanvas(t,e);else{var n=this.cy.window(),i=n.document;r=i.createElement("canvas"),r.width=t,r.height=e}return r};[bL,Pu,_c,N_,Rh,df,Ts,CL,ff,u0,AL].forEach(function(t){Jt(wr,t)});var PG=[{name:"null",impl:sL},{name:"base",impl:gL},{name:"canvas",impl:TG}],MG=[{type:"layout",extensions:tU},{type:"renderer",extensions:PG}],RL={},OL={};function DL(t,e,r){var n=r,i=function(D){Yr("Can not register `"+e+"` for `"+t+"` since `"+D+"` already exists in the prototype and can not be overridden")};if(t==="core"){if(Mv.prototype[e])return i(e);Mv.prototype[e]=r}else if(t==="collection"){if(Fa.prototype[e])return i(e);Fa.prototype[e]=r}else if(t==="layout"){for(var a=function(D){this.options=D,r.call(this,D),Ir(this._private)||(this._private={}),this._private.cy=D.cy,this._private.listeners=[],this.createEmitter()},s=a.prototype=Object.create(r.prototype),o=[],l=0;l<o.length;l++){var u=o[l];s[u]=s[u]||function(){return this}}s.start&&!s.run?s.run=function(){return this.start(),this}:!s.start&&s.run&&(s.start=function(){return this.run(),this});var c=r.prototype.stop;s.stop=function(){var j=this.options;if(j&&j.animate){var D=this.animations;if(D)for(var F=0;F<D.length;F++)D[F].stop()}return c?c.call(this):this.emit("layoutstop"),this},s.destroy||(s.destroy=function(){return this}),s.cy=function(){return this._private.cy};var f=function(D){return D._private.cy},p={addEventFields:function(D,F){F.layout=D,F.cy=f(D),F.target=D},bubble:function(){return!0},parent:function(D){return f(D)}};Jt(s,{createEmitter:function(){return this._private.emitter=new R1(p,this),this},emitter:function(){return this._private.emitter},on:function(D,F){return this.emitter().on(D,F),this},one:function(D,F){return this.emitter().one(D,F),this},once:function(D,F){return this.emitter().one(D,F),this},removeListener:function(D,F){return this.emitter().removeListener(D,F),this},removeAllListeners:function(){return this.emitter().removeAllListeners(),this},emit:function(D,F){return this.emitter().emit(D,F),this}}),Zr.eventAliasesOn(s),n=a}else if(t==="renderer"&&e!=="null"&&e!=="base"){var v=IL("renderer","base"),y=v.prototype,S=r,w=r.prototype,T=function(){v.apply(this,arguments),S.apply(this,arguments)},_=T.prototype;for(var C in y){var N=y[C],A=w[C]!=null;if(A)return i(C);_[C]=N}for(var O in w)_[O]=w[O];y.clientFunctions.forEach(function(j){_[j]=_[j]||function(){Gn("Renderer does not implement `renderer."+j+"()` on its prototype")}}),n=T}else if(t==="__proto__"||t==="constructor"||t==="prototype")return Gn(t+" is an illegal type to be registered, possibly lead to prototype pollutions");return eA({map:RL,keys:[t,e],value:n})}function IL(t,e){return tA({map:RL,keys:[t,e]})}function AG(t,e,r,n,i){return eA({map:OL,keys:[t,e,r,n],value:i})}function LG(t,e,r,n){return tA({map:OL,keys:[t,e,r,n]})}var ik=function(){if(arguments.length===2)return IL.apply(null,arguments);if(arguments.length===3)return DL.apply(null,arguments);if(arguments.length===4)return LG.apply(null,arguments);if(arguments.length===5)return AG.apply(null,arguments);Gn("Invalid extension access syntax")};Mv.prototype.extension=ik;MG.forEach(function(t){t.extensions.forEach(function(e){DL(t.type,e.name,e.impl)})});var wx=function(){if(!(this instanceof wx))return new wx;this.length=0},wh=wx.prototype;wh.instanceString=function(){return"stylesheet"};wh.selector=function(t){var e=this.length++;return this[e]={selector:t,properties:[]},this};wh.css=function(t,e){var r=this.length-1;if(Wt(t))this[r].properties.push({name:t,value:e});else if(Ir(t))for(var n=t,i=Object.keys(n),a=0;a<i.length;a++){var s=i[a],o=n[s];if(o!=null){var l=ca.properties[s]||ca.properties[k1(s)];if(l!=null){var u=l.name,c=o;this[r].properties.push({name:u,value:c})}}}return this};wh.style=wh.css;wh.generateStyle=function(t){var e=new ca(t);return this.appendToStyle(e)};wh.appendToStyle=function(t){for(var e=0;e<this.length;e++){var r=this[e],n=r.selector,i=r.properties;t.selector(n);for(var a=0;a<i.length;a++){var s=i[a];t.css(s.name,s.value)}}return t};var RG="3.33.1",Sh=function(e){if(e===void 0&&(e={}),Ir(e))return new Mv(e);if(Wt(e))return ik.apply(ik,arguments)};Sh.use=function(t){var e=Array.prototype.slice.call(arguments,1);return e.unshift(Sh),t.apply(null,e),this};Sh.warnings=function(t){return lA(t)};Sh.version=RG;Sh.stylesheet=Sh.Stylesheet=wx;const{string:hy,array:v5,object:py,number:Qm,bool:oo,oneOfType:kp,any:my,func:Jm}=nF,OG={id:hy,className:hy,style:kp([hy,py]),elements:kp([v5,my]),stylesheet:kp([v5,my]),layout:kp([py,my]),pan:kp([py,my]),zoom:Qm,panningEnabled:oo,userPanningEnabled:oo,minZoom:Qm,maxZoom:Qm,zoomingEnabled:oo,userZoomingEnabled:oo,boxSelectionEnabled:oo,autoungrabify:oo,autolock:oo,autounselectify:oo,get:Jm,toJson:Jm,diff:Jm,forEach:Jm,cy:Jm,headless:oo,styleEnabled:oo,hideEdgesOnViewport:oo,textureOnViewport:oo,motionBlur:oo,motionBlurOpacity:Qm,wheelSensitivity:Qm,pixelRatio:kp([hy,py])},jL=(t,e)=>{if(((a,s)=>a==null||s==null)(t,e)&&(t!=null||e!=null))return!0;if(t===e)return!1;if(typeof t!="object"||typeof e!="object")return t!==e;const r=Object.keys(t),n=Object.keys(e),i=a=>t[a]!==e[a];return r.length!==n.length||!(!r.some(i)&&!n.some(i))},wl=(t,e)=>t!=null?t[e]:null,DG={diff:jL,get:wl,toJson:t=>t,forEach:(t,e)=>t.forEach(e),elements:[{data:{id:"a",label:"Example node A"}},{data:{id:"b",label:"Example node B"}},{data:{id:"e",source:"a",target:"b"}}],stylesheet:[{selector:"node",style:{label:"data(label)"}}],zoom:1,pan:{x:0,y:0}},gy=(t,e,r,n)=>r(wl(t,n),wl(e,n)),IG=(t,e,r,n,i,a,s)=>{t.batch(()=>{(n===jL||gy(e,r,n,"elements"))&&zG(t,wl(e,"elements"),wl(r,"elements"),i,a,s,n),gy(e,r,n,"stylesheet")&&BG(t,wl(e,"stylesheet"),wl(r,"stylesheet"),i),["zoom","minZoom","maxZoom","zoomingEnabled","userZoomingEnabled","pan","panningEnabled","userPanningEnabled","boxSelectionEnabled","autoungrabify","autolock","autounselectify"].forEach(o=>{gy(e,r,n,o)&&jG(t,o,wl(e,o),wl(r,o),i)})}),gy(e,r,n,"layout")&&FG(t,wl(e,"layout"),wl(r,"layout"),i)},jG=(t,e,r,n,i)=>{t[e](i(n))},FG=(t,e,r,n)=>{const i=n(r);i!=null&&t.layout(i).run()},BG=(t,e,r,n)=>{const i=t.style();i?.fromJson(n(r)).update()},zG=(t,e,r,n,i,a,s)=>{const o=[],l=t.collection(),u=[],c={},f={},p=v=>i(i(v,"data"),"id");a(r,v=>{const y=p(v);f[y]=v}),e!=null&&a(e,v=>{const y=p(v);c[y]=v,(S=>f[S]!=null)(y)||l.merge(t.getElementById(y))}),a(r,v=>{const y=p(v),S=(w=>c[w])(y);(w=>c[w]!=null)(y)?u.push({ele1:S,ele2:v}):o.push(n(v))}),l.length>0&&t.remove(l),o.length>0&&t.add(o),u.forEach(({ele1:v,ele2:y})=>UG(t,v,y,n,i,s))},UG=(t,e,r,n,i,a)=>{const s=i(i(r,"data"),"id"),o=t.getElementById(s),l={};["data","position","selected","selectable","locked","grabbable","classes"].forEach(c=>{const f=i(r,c);a(f,i(e,c))&&(l[c]=n(f))});const u=i(r,"scratch");a(u,i(e,"scratch"))&&o.scratch(n(u)),Object.keys(l).length>0&&o.json(l)};class GG extends sr.Component{static get propTypes(){return OG}static get defaultProps(){return DG}static normalizeElements(e){if(e.length!=null)return e;{let{nodes:r,edges:n}=e;return r==null&&(r=[]),n==null&&(n=[]),r.concat(n)}}constructor(e){super(e),this.displayName="CytoscapeComponent",this.containerRef=sr.createRef()}componentDidMount(){const e=this.containerRef.current,{global:r,headless:n,styleEnabled:i,hideEdgesOnViewport:a,textureOnViewport:s,motionBlur:o,motionBlurOpacity:l,wheelSensitivity:u,pixelRatio:c}=this.props,f=this._cy=new Sh({container:e,headless:n,styleEnabled:i,hideEdgesOnViewport:a,textureOnViewport:s,motionBlur:o,motionBlurOpacity:l,wheelSensitivity:u,pixelRatio:c});r&&(window[r]=f),this.updateCytoscape(null,this.props)}updateCytoscape(e,r){const n=this._cy,{diff:i,toJson:a,get:s,forEach:o}=r;IG(n,e,r,i,a,s,o),r.cy!=null&&r.cy(n)}componentDidUpdate(e){this.updateCytoscape(e,this.props)}componentWillUnmount(){this._cy.destroy()}render(){const{id:e,className:r,style:n}=this.props;return sr.createElement("div",{ref:this.containerRef,id:e,className:r,style:n})}}const VG=[{selector:"node",style:{"background-color":"#1f2937",label:"data(label)",color:"#cbd5e1","font-family":"Outfit, sans-serif","font-size":"12px","text-valign":"bottom","text-margin-y":8,width:40,height:40,"border-width":2,"border-color":"#475569","text-outline-width":2,"text-outline-color":"#050508","overlay-padding":6,"z-index":10}},{selector:'node[category="Individual"]',style:{"background-color":"rgba(49, 46, 129, 0.9)","border-color":"#6366f1",shape:"ellipse",width:50,height:50}},{selector:'node[category="Location"]',style:{"background-color":"rgba(6, 78, 59, 0.9)","border-color":"#10b981",shape:"hexagon",width:60,height:60}},{selector:'node[category="Group"]',style:{"background-color":"rgba(88, 28, 135, 0.9)","border-color":"#a855f7",shape:"round-rectangle"}},{selector:"edge",style:{width:2,"line-color":"#334155","target-arrow-color":"#334155","target-arrow-shape":"triangle","curve-style":"bezier"}},{selector:":selected",style:{"border-width":4,"border-color":"#fafafa","line-color":"#fafafa","target-arrow-color":"#fafafa","z-index":999}}],HG=()=>{const{username:t,projectName:e}=Vi(),{setRightPanelMode:r,setRightOpen:n,setRightPanelTitle:i}=Ll(),a=za(),[s,o]=se.useState([]),[l,u]=se.useState(""),[c,f]=se.useState(!0),[p,v]=se.useState(null),y=se.useRef(null),[S,w]=se.useState(null);se.useEffect(()=>{r("CUSTOM"),i("Inspector"),T()},[]),se.useEffect(()=>{const A=setInterval(()=>{const O=document.getElementById("architect-right-panel-portal");O&&(w(O),clearInterval(A))},100);return()=>clearInterval(A)},[]);const T=async()=>{f(!0);try{const A=await Qe.get("/world-bible/graph");A&&A.nodes&&o([...A.nodes,...A.edges])}catch(A){console.error("Failed to load graph data",A),a("/")}finally{f(!1)}},_=()=>{if(!y.current)return;y.current.layout({name:"cose",animate:!0,padding:50,nodeOverlap:20,componentSpacing:100}).run()};se.useEffect(()=>{y.current&&(_(),y.current.on("select","node",A=>{const O=A.target;v(O.data()),n(!0)}),y.current.on("unselect","node",()=>{v(null)}))},[s]);const C=()=>{if(!y.current||!l)return;const A=y.current;if(A.elements().removeClass("highlighted faded"),l.length>0){const O=A.nodes().filter(j=>j.data("label").toLowerCase().includes(l.toLowerCase()));O.length>0&&(A.elements().not(O).addClass("faded"),O.addClass("highlighted"),A.animate({fit:{eles:O,padding:50}}))}},N=()=>m.jsxs("div",{className:"p-6 flex flex-col h-full animate-in fade-in slide-in-from-right-4 duration-500 space-y-8",children:[m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsx("div",{className:"size-8 rounded bg-primary flex items-center justify-center",children:m.jsx("span",{className:"material-symbols-outlined text-primary-foreground text-sm",children:"hub"})}),m.jsx("h2",{className:"font-bold text-sm tracking-tight uppercase",children:"Network Controls"})]}),m.jsxs("div",{className:"flex gap-2",children:[m.jsx("input",{className:"bg-white/5 border border-white/10 rounded-xl px-4 py-2 text-xs w-full outline-none focus:ring-1 focus:ring-primary placeholder:text-slate-600 text-slate-200",placeholder:"Find cosmic entity...",value:l,onChange:A=>u(A.target.value),onKeyDown:A=>A.key==="Enter"&&C()}),m.jsx("button",{onClick:C,className:"px-4 bg-primary/20 hover:bg-primary/30 border border-primary/30 rounded-xl text-primary transition-colors",children:m.jsx("span",{className:"material-symbols-outlined text-base",children:"search"})})]}),m.jsxs("div",{className:"flex items-center justify-between pt-2",children:[m.jsxs("div",{className:"flex gap-2",children:[m.jsx("button",{onClick:_,className:"p-2.5 bg-white/5 hover:bg-white/10 rounded-xl text-slate-400 hover:text-white transition-colors border border-white/5",title:"Re-simulate Gravity",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"refresh"})}),m.jsx("button",{onClick:()=>y.current?.fit(),className:"p-2.5 bg-white/5 hover:bg-white/10 rounded-xl text-slate-400 hover:text-white transition-colors border border-white/5",title:"Fit View",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"fit_screen"})})]}),m.jsxs("div",{className:"flex flex-wrap gap-2 text-[8px] uppercase font-black text-slate-500",children:[m.jsxs("div",{className:"flex items-center gap-1",children:[m.jsx("div",{className:"size-1.5 rounded-full bg-indigo-500"})," IND"]}),m.jsxs("div",{className:"flex items-center gap-1",children:[m.jsx("div",{className:"size-1.5 rounded-full bg-emerald-500"})," LOC"]}),m.jsxs("div",{className:"flex items-center gap-1",children:[m.jsx("div",{className:"size-1.5 rounded-full bg-purple-500"})," GRP"]})]})]})]}),m.jsx("div",{className:"h-px bg-white/5"}),p?m.jsxs("div",{className:"space-y-6",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("div",{className:`size-12 rounded-2xl flex items-center justify-center text-white shadow-xl ${p.category==="Individual"?"bg-indigo-600 shadow-indigo-500/20":p.category==="Location"?"bg-emerald-600 shadow-emerald-500/20":"bg-purple-600 shadow-purple-500/20"}`,children:m.jsx("span",{className:"material-symbols-outlined",children:p.category==="Individual"?"person":p.category==="Location"?"location_on":"groups"})}),m.jsxs("div",{children:[m.jsx("h3",{className:"text-xl font-serif font-bold text-white leading-tight",children:p.label}),m.jsx("span",{className:"text-[10px] font-black uppercase tracking-tighter text-slate-500",children:p.category})]})]}),m.jsx("p",{className:"text-sm text-slate-400 font-serif leading-relaxed italic opacity-80",children:p.summary||"No description available for this cosmic entity."}),m.jsxs("div",{className:"pt-6 border-t border-white/5 space-y-3",children:[m.jsxs("button",{onClick:()=>a(`/${t}/${e}/entities/${p.type||"individual"}/${p.id}`),className:"w-full py-3 bg-white/5 hover:bg-white/10 border border-white/10 rounded-xl text-[10px] font-black uppercase tracking-widest text-slate-300 transition-all flex items-center justify-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"open_in_new"}),m.jsx("span",{children:"Open Bible Entry"})]}),m.jsxs("button",{onClick:()=>{if(!y.current)return;const A=y.current.$id(p.id);y.current.animate({center:{eles:A},zoom:2})},className:"w-full py-3 bg-indigo-600/10 hover:bg-indigo-600/20 border border-indigo-500/30 rounded-xl text-[10px] font-black uppercase tracking-widest text-indigo-300 transition-all flex items-center justify-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"center_focus_strong"}),m.jsx("span",{children:"Focus on Graph"})]})]})]}):m.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center text-slate-500 text-center opacity-40 py-12",children:[m.jsx("span",{className:"material-symbols-outlined text-4xl mb-4",children:"touch_app"}),m.jsxs("p",{className:"text-[10px] font-black uppercase tracking-widest leading-loose",children:["Select a node",m.jsx("br",{}),"to reveal its secrets"]})]})]});return m.jsxs("div",{className:"w-full h-full flex bg-background-dark relative overflow-hidden font-display text-foreground",children:[S&&Al.createPortal(N(),S),s.length===0&&!c&&m.jsx("div",{className:"absolute inset-0 flex items-center justify-center z-10 pointer-events-none",children:m.jsx("div",{className:"text-muted text-lg font-serif italic text-slate-600",children:"The void is empty. Document your world in the Bible."})}),m.jsx(GG,{elements:s,stylesheet:VG,style:{width:"100%",height:"100%"},cy:A=>{y.current=A},minZoom:.2,maxZoom:3,wheelSensitivity:.3,className:"bg-background-dark"})]})},WG=({id:t})=>{const{id:e}=Vi(),r=za(),[n,i]=se.useState("overview"),[a,s]=se.useState(null),[o,l]=se.useState(!0),[u,c]=se.useState(!1);se.useEffect(()=>{f()},[t]);const f=async()=>{l(!0);try{const S=await Qe.get(`/bd/entidadindividual/${t}`);s(S)}catch(S){console.error("Error loading character:",S)}finally{l(!1)}},p=async()=>{try{await Qe.patch("/bd/modificar",{...a,tipoEntidad:"entidadindividual"}),c(!1)}catch(S){console.error("Error saving:",S)}},v=async()=>{if(window.confirm("Move this character to the Trash Bin?"))try{await Qe.delete(`/bd/entidadindividual/${t}`),r(`/project/${e}`)}catch(S){console.error(S)}},y=(S,w)=>{s(T=>({...T,[S]:w}))};return o?m.jsx("div",{className:"p-20 text-center text-slate-500 animate-pulse",children:"Summoning entity..."}):a?m.jsxs("div",{className:"flex h-full",children:[m.jsxs("div",{className:"flex-1 flex flex-col overflow-y-auto custom-scrollbar p-8 gap-6",children:[m.jsxs("div",{className:"flex items-start gap-6",children:[m.jsx("div",{className:"relative",children:m.jsx(ox,{url:a.imagenUrl||"https://images.unsplash.com/photo-1544005313-94ddf0286df2?q=80&w=1976&auto=format&fit=crop",size:"xl",className:"rounded-2xl border-2 border-primary shadow-[0_0_30px_rgba(99,102,242,0.3)]"})}),m.jsxs("div",{className:"flex-1",children:[m.jsxs("div",{className:"flex items-center gap-3 mb-1",children:[m.jsx("span",{className:"text-xs font-bold text-primary bg-primary/10 px-2 py-0.5 rounded border border-primary/20",children:a.estado||"ACTIVE"}),m.jsx("span",{className:"text-xs font-bold text-slate-400 bg-surface-light px-2 py-0.5 rounded border border-white/5",children:a.tipo||"Unknown"})]}),m.jsxs("h1",{className:"text-4xl font-bold text-white mb-2",children:[a.nombre," ",a.apellidos]}),m.jsx("p",{className:"text-lg text-slate-300",children:a.origen||"Traveling the void"})]}),m.jsxs("div",{className:"flex gap-2",children:[!u&&m.jsx(mn,{className:"border-red-500/30 text-red-400 hover:bg-red-500/10",icon:"delete",onClick:v,children:"Delete"}),m.jsx(mn,{variant:"secondary",icon:u?"close":"edit",onClick:()=>c(!u),children:u?"Cancel":"Edit Profile"}),u&&m.jsx(mn,{variant:"primary",icon:"save",onClick:p,children:"Save Changes"})]})]}),m.jsx("div",{className:"border-b border-glass-border flex gap-6",children:["Overview","Biography","Attributes & Stats","Relationships"].map(S=>m.jsx("button",{onClick:()=>i(S.toLowerCase()),className:`pb-4 px-2 text-sm font-bold border-b-2 transition-colors ${n===S.toLowerCase()?"text-primary border-primary":"text-slate-500 border-transparent hover:text-white"}`,children:S},S))}),m.jsxs("div",{className:"grid grid-cols-3 gap-6",children:[m.jsx("div",{className:"col-span-1 space-y-6",children:m.jsxs(un,{className:"p-4",children:[m.jsxs("h3",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider mb-4 flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"fingerprint"})," Identity"]}),m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[m.jsxs("div",{children:[m.jsx("label",{className:"text-xs text-slate-400 block mb-1",children:"Name"}),m.jsx("input",{type:"text",value:a.nombre,onChange:S=>y("nombre",S.target.value),className:"w-full bg-surface-light border border-white/10 rounded px-3 py-2 text-white text-sm",readOnly:!u})]}),m.jsxs("div",{children:[m.jsx("label",{className:"text-xs text-slate-400 block mb-1",children:"Surnames"}),m.jsx("input",{type:"text",value:a.apellidos||"",onChange:S=>y("apellidos",S.target.value),className:"w-full bg-surface-light border border-white/10 rounded px-3 py-2 text-white text-sm",readOnly:!u})]})]}),m.jsxs("div",{children:[m.jsx("label",{className:"text-xs text-slate-400 block mb-1",children:"Type / Species"}),m.jsx("input",{type:"text",value:a.tipo||"",onChange:S=>y("tipo",S.target.value),className:"w-full bg-surface-light border border-white/10 rounded px-3 py-2 text-white text-sm",readOnly:!u})]}),m.jsxs("div",{children:[m.jsx("label",{className:"text-xs text-slate-400 block mb-1",children:"Origin"}),m.jsx("input",{type:"text",value:a.origen||"",onChange:S=>y("origen",S.target.value),className:"w-full bg-surface-light border border-white/10 rounded px-3 py-2 text-white text-sm",readOnly:!u})]})]})]})}),m.jsx("div",{className:"col-span-2 space-y-6",children:m.jsxs(un,{className:"p-6 relative overflow-hidden group",children:[m.jsxs("div",{className:"flex items-center justify-between mb-6",children:[m.jsxs("h3",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"auto_stories"})," Narrative & Connections"]}),!u&&m.jsx("span",{className:"text-[10px] text-slate-600 bg-white/5 px-2 py-1 rounded",children:"Read Only"})]}),m.jsxs("div",{className:"mb-8",children:[m.jsx("h4",{className:"text-[10px] font-black uppercase tracking-widest text-primary mb-3 opacity-80",children:"Biography"}),m.jsx("textarea",{value:a.descripcion||"",onChange:S=>y("descripcion",S.target.value),readOnly:!u,className:`w-full bg-transparent border-none outline-none text-slate-300 text-sm leading-relaxed resize-none custom-scrollbar ${u?"min-h-[150px] placeholder-white/20":"h-auto overflow-hidden"}`,placeholder:"Write the history of this person..."}),m.jsx("h4",{className:"text-[10px] font-black uppercase tracking-widest text-primary mt-6 mb-3 opacity-80",children:"Behavior & Personality"}),m.jsx("textarea",{value:a.comportamiento||"",onChange:S=>y("comportamiento",S.target.value),readOnly:!u,className:`w-full bg-transparent border-none outline-none text-slate-300 text-sm leading-relaxed resize-none custom-scrollbar ${u?"min-h-[100px]":"h-auto overflow-hidden"}`,placeholder:"How does this person act?"})]}),m.jsxs("div",{className:"pt-6 border-t border-white/5",children:[m.jsxs("h4",{className:"text-[10px] font-black uppercase tracking-widest text-primary mb-4 flex items-center gap-2 opacity-80",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"hub"})," Established Connections"]}),a.relaciones&&a.relaciones.length>0?m.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:a.relaciones.map((S,w)=>m.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white/5 rounded-xl border border-white/5 hover:border-primary/30 transition-colors",children:[m.jsx("div",{className:"size-8 rounded-full bg-white/10 flex items-center justify-center text-xs font-bold",children:S.entidadDestino?.nombre?.charAt(0)||"?"}),m.jsxs("div",{className:"flex-1 min-w-0",children:[m.jsx("div",{className:"text-sm font-bold text-white truncate",children:S.entidadDestino?.nombre||"Unknown"}),m.jsx("div",{className:"text-[10px] text-primary truncate",children:S.tipoRelacion||"Connected"})]})]},w))}):m.jsx("div",{className:"p-6 text-center bg-white/5 rounded-xl border border-dashed border-white/10",children:m.jsx("p",{className:"text-xs text-slate-500 italic",children:"No relationships recorded yet."})})]})]})})]})]}),m.jsxs("div",{className:"w-80 border-l border-glass-border bg-surface-dark/50 hidden xl:flex flex-col",children:[m.jsxs("div",{className:"p-4 border-b border-glass-border flex justify-between items-center",children:[m.jsx("span",{className:"text-xs font-bold text-slate-500",children:"QUICK NOTES"}),m.jsx("button",{className:"text-slate-400 hover:text-white",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"open_in_new"})})]}),m.jsx("div",{className:"p-4 flex-1",children:m.jsx("textarea",{className:"w-full h-full bg-transparent border-none outline-none text-sm text-slate-300 placeholder-slate-600 resize-none",placeholder:"Draft a quick scene or jot down notes for Elara here..."})}),m.jsx("div",{className:"p-2 border-t border-glass-border text-right text-[10px] text-slate-600",children:"0 words"})]})]}):m.jsx("div",{className:"p-20 text-center text-red-500",children:"Character not found in the archives."})},y5=({id:t})=>{const[e,r]=se.useState(null),[n,i]=se.useState(!0),[a,s]=se.useState(!1);se.useEffect(()=>{o()},[t]);const o=async()=>{i(!0);try{const c=await Qe.get(`/bd/zona/${t}`);r(c)}catch(c){console.error("Error loading location:",c)}finally{i(!1)}},l=async()=>{try{await Qe.patch("/bd/modificar",{...e,tipoEntidad:"zona"}),s(!1)}catch(c){console.error("Error saving:",c)}},u=(c,f)=>{r(p=>({...p,[c]:f}))};return n?m.jsx("div",{className:"p-20 text-center text-slate-500 animate-pulse",children:"Scanning terrain..."}):e?m.jsxs("div",{className:"flex h-full overflow-y-auto custom-scrollbar p-8 flex-col gap-8",children:[m.jsxs("header",{className:"flex justify-between items-end",children:[m.jsxs("div",{children:[m.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[m.jsx("span",{className:"text-xs font-bold text-emerald-400 bg-emerald-400/10 px-2 py-0.5 rounded border border-emerald-400/20",children:"LOCATION"}),m.jsx("span",{className:"text-xs font-bold text-slate-400 bg-surface-light px-2 py-0.5 rounded border border-white/5",children:e.tipo||"Wilderness"})]}),m.jsx("h1",{className:"text-5xl font-manrope font-black text-white tracking-tight",children:e.nombre}),m.jsx("p",{className:"text-slate-400 mt-2",children:e.apellidos||"Uncharted territory"})]}),m.jsxs("div",{className:"flex gap-2",children:[m.jsx(mn,{variant:"secondary",icon:a?"close":"edit",onClick:()=>s(!a),children:a?"Cancel":"Edit Location"}),a&&m.jsx(mn,{variant:"primary",icon:"save",onClick:l,children:"Update Records"})]})]}),m.jsxs("div",{className:"grid grid-cols-3 gap-8",children:[m.jsxs("div",{className:"col-span-1 space-y-6",children:[m.jsxs(un,{className:"p-6",children:[m.jsxs("h3",{className:"text-xs font-bold text-slate-500 uppercase tracking-widest mb-4 flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"straighten"})," Geography & Scale"]}),m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{children:[m.jsx("label",{className:"text-xs text-slate-400 block mb-1",children:"Size / Scale"}),m.jsx("input",{type:"text",value:e.tamanno||"",onChange:c=>u("tamanno",c.target.value),className:"w-full bg-surface-light border border-white/10 rounded px-3 py-2 text-white text-sm",readOnly:!a})]}),m.jsxs("div",{children:[m.jsx("label",{className:"text-xs text-slate-400 block mb-1",children:"Development Level"}),m.jsx("input",{type:"text",value:e.desarrollo||"",onChange:c=>u("desarrollo",c.target.value),className:"w-full bg-surface-light border border-white/10 rounded px-3 py-2 text-white text-sm",readOnly:!a})]})]})]}),m.jsxs(un,{className:"p-6",children:[m.jsx("h3",{className:"text-xs font-bold text-slate-500 uppercase tracking-widest mb-4",children:"Quick Stats"}),m.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[m.jsxs("div",{className:"bg-white/5 p-3 rounded-xl border border-white/5",children:[m.jsx("span",{className:"text-[10px] text-slate-500 block",children:"Density"}),m.jsx("span",{className:"text-white font-bold",children:"Medium"})]}),m.jsxs("div",{className:"bg-white/5 p-3 rounded-xl border border-white/5",children:[m.jsx("span",{className:"text-[10px] text-slate-500 block",children:"Security"}),m.jsx("span",{className:"text-emerald-400 font-bold",children:"Stable"})]})]})]})]}),m.jsx("div",{className:"col-span-2 space-y-6",children:m.jsxs(un,{className:"p-8",children:[m.jsxs("h3",{className:"text-xs font-bold text-slate-500 uppercase tracking-widest mb-4 flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"description"})," Topographic Records & Lore"]}),m.jsx("textarea",{value:e.descripcion||"",onChange:c=>u("descripcion",c.target.value),readOnly:!a,className:"w-full bg-transparent border-none outline-none text-slate-300 text-lg leading-relaxed min-h-[400px] resize-none",placeholder:"Describe the vistas, the smells, and the secrets of this place..."})]})})]})]}):m.jsx("div",{className:"p-20 text-center text-red-500",children:"Location not found in the maps."})},qG=({id:t})=>{const[e,r]=se.useState(null),[n,i]=se.useState(!0),[a,s]=se.useState(!1);se.useEffect(()=>{o()},[t]);const o=async()=>{i(!0);try{const c=await Qe.get(`/bd/entidadcolectiva/${t}`);r(c)}catch(c){console.error("Error loading collective:",c)}finally{i(!1)}},l=async()=>{try{await Qe.patch("/bd/modificar",{...e,tipoEntidad:"entidadcolectiva"}),s(!1)}catch(c){console.error("Error saving:",c)}},u=(c,f)=>{r(p=>({...p,[c]:f}))};return n?m.jsx("div",{className:"p-20 text-center text-slate-500 animate-pulse",children:"Gathering intelligence..."}):e?m.jsxs("div",{className:"flex h-full overflow-y-auto custom-scrollbar p-8 flex-col gap-8",children:[m.jsxs("header",{className:"flex justify-between items-end",children:[m.jsxs("div",{children:[m.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[m.jsx("span",{className:"text-xs font-bold text-indigo-400 bg-indigo-400/10 px-2 py-0.5 rounded border border-indigo-400/20",children:"COLLECTIVE"}),m.jsx("span",{className:"text-xs font-bold text-slate-400 bg-surface-light px-2 py-0.5 rounded border border-white/5",children:e.tipo||"Organization"})]}),m.jsx("h1",{className:"text-5xl font-manrope font-black text-white tracking-tight",children:e.nombre}),m.jsxs("p",{className:"text-slate-400 mt-2",children:[e.cantidadMiembros||"Unknown"," members"]})]}),m.jsxs("div",{className:"flex gap-2",children:[m.jsx(mn,{variant:"secondary",icon:a?"close":"edit",onClick:()=>s(!a),children:a?"Cancel":"Edit Collective"}),a&&m.jsx(mn,{variant:"primary",icon:"save",onClick:l,children:"Update Dossier"})]})]}),m.jsxs("div",{className:"grid grid-cols-3 gap-8",children:[m.jsx("div",{className:"col-span-1 space-y-6",children:m.jsxs(un,{className:"p-6",children:[m.jsxs("h3",{className:"text-xs font-bold text-slate-500 uppercase tracking-widest mb-4 flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"group_work"})," Group Dynamics"]}),m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{children:[m.jsx("label",{className:"text-xs text-slate-400 block mb-1",children:"Scale / Members"}),m.jsx("input",{type:"text",value:e.cantidadMiembros||"",onChange:c=>u("cantidadMiembros",c.target.value),className:"w-full bg-surface-light border border-white/10 rounded px-3 py-2 text-white text-sm",readOnly:!a})]}),m.jsxs("div",{children:[m.jsx("label",{className:"text-xs text-slate-400 block mb-1",children:"Behavior / Alignment"}),m.jsx("input",{type:"text",value:e.comportamiento||"",onChange:c=>u("comportamiento",c.target.value),className:"w-full bg-surface-light border border-white/10 rounded px-3 py-2 text-white text-sm",readOnly:!a})]})]})]})}),m.jsx("div",{className:"col-span-2 space-y-6",children:m.jsxs(un,{className:"p-8",children:[m.jsxs("h3",{className:"text-xs font-bold text-slate-500 uppercase tracking-widest mb-4 flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"history_edu"})," Mandate & History"]}),m.jsx("textarea",{value:e.descripcion||"",onChange:c=>u("descripcion",c.target.value),readOnly:!a,className:"w-full bg-transparent border-none outline-none text-slate-300 text-lg leading-relaxed min-h-[400px] resize-none",placeholder:"Detail the motives, the structure, and the legacy of this group..."})]})})]})]}):m.jsx("div",{className:"p-20 text-center text-red-500",children:"Collective not found in the records."})},$G=()=>m.jsx("div",{className:"flex-1 flex overflow-hidden bg-background-dark font-sans text-slate-300",children:m.jsxs("main",{className:"flex-1 flex flex-col p-12 overflow-y-auto custom-scrollbar relative",children:[m.jsxs("header",{className:"mb-12 space-y-4",children:[m.jsxs("div",{className:"flex items-center gap-2 text-slate-500 font-bold text-[10px] tracking-widest uppercase",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"grid_view"}),m.jsx("span",{children:"Universo Alpha"}),m.jsx("span",{className:"material-symbols-outlined text-sm",children:"chevron_right"}),m.jsx("span",{children:"Galaxia Andrmeda"}),m.jsx("span",{className:"material-symbols-outlined text-sm",children:"chevron_right"}),m.jsx("span",{className:"text-white",children:"Sistema Solar"})]}),m.jsxs("div",{className:"flex justify-between items-start",children:[m.jsxs("div",{className:"space-y-4 max-w-3xl",children:[m.jsxs("div",{className:"flex items-center gap-3 px-3 py-1 rounded bg-orange-500/10 text-orange-400 border border-orange-500/20 inline-block",children:[m.jsx("span",{className:"material-symbols-outlined text-[14px]",children:"sunny"}),m.jsx("span",{className:"text-[9px] font-black uppercase tracking-widest",children:"Sistema Planetario"}),m.jsx("span",{className:"text-[9px] font-bold text-slate-600 tracking-widest ml-2",children:"ID: SYS-SOL-001"})]}),m.jsx("h1",{className:"text-6xl font-manrope font-black text-white tracking-tight",children:"Sistema Solar"}),m.jsx("p",{className:"text-slate-400 text-lg leading-relaxed",children:"Sistema planetario principal ubicado en el Brazo de Orin, hogar de la nica vida biolgica compleja confirmada en el sector galctico Alpha-9."})]}),m.jsxs("div",{className:"flex gap-3",children:[m.jsx("button",{className:"p-3 rounded-2xl bg-white/5 hover:bg-red-500/10 text-slate-500 hover:text-red-400 border border-white/5 transition-all outline-none",children:m.jsx("span",{className:"material-symbols-outlined",children:"delete"})}),m.jsx(mn,{variant:"primary",icon:"save",children:"Guardar"})]})]})]}),m.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-12",children:[m.jsxs("div",{className:"lg:col-span-1 space-y-8",children:[m.jsxs("section",{className:"space-y-4",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-primary text-lg",children:"sell"}),m.jsx("h4",{className:"text-[10px] font-black uppercase tracking-[0.2em] text-slate-500",children:"Etiquetas"}),m.jsx("span",{className:"ml-auto text-[9px] font-bold text-slate-600 px-1.5 py-0.5 rounded bg-white/5",children:"3 ACTIVAS"})]}),m.jsxs("div",{className:"flex flex-wrap gap-2",children:[m.jsx(k2,{label:"Estrella Tipo G",color:"amber",icon:"star"}),m.jsx(k2,{label:"Vida Confirmada",color:"emerald",icon:"tempest"}),m.jsx(k2,{label:"Rico en Agua",color:"cyan",icon:"water_drop"}),m.jsx("button",{className:"size-8 rounded-full border border-dashed border-white/10 flex items-center justify-center text-slate-600 hover:text-white hover:border-white/30 transition-all",children:"+"})]})]}),m.jsxs("section",{className:"space-y-6",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-primary text-lg",children:"analytics"}),m.jsx("h4",{className:"text-[10px] font-black uppercase tracking-[0.2em] text-slate-500",children:"Atributos Principales"}),m.jsx("button",{className:"ml-auto text-slate-600 hover:text-white transition-colors",children:m.jsx("span",{className:"material-symbols-outlined text-lg",children:"settings"})})]}),m.jsxs("div",{className:"space-y-4",children:[m.jsx(vy,{label:"Forma / Estructura",value:"Heliosfrica Estndar",icon:"hive"}),m.jsx(vy,{label:"Composicin",value:"Hidrgeno (74%), Helio (24%)",icon:"experiment"}),m.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[m.jsx(vy,{label:"Edad (Aos)",value:"4.6 MM",unit:"Aos"}),m.jsx(vy,{label:"Ciclo Orbital",value:"230 MM",unit:"Aos"})]})]})]}),m.jsxs("section",{className:"space-y-4",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-primary text-lg",children:"menu_book"}),m.jsx("h4",{className:"text-[10px] font-black uppercase tracking-[0.2em] text-slate-500",children:"Notas de Lore"})]}),m.jsx("textarea",{className:"w-full h-48 bg-white/5 border border-white/5 rounded-[2rem] p-6 text-sm text-slate-400 placeholder:text-slate-700 focus:border-primary/50 outline-none transition-all resize-none leading-relaxed italic shadow-inner",defaultValue:"El sistema contiene un cinturn de asteroides inusualmente denso entre el 4 y 5 planeta. Se teoriza que es el remanente de una colisin planetaria antigua conocida como 'El Gran Impacto' en las escrituras sagradas de los habitantes de Terra."})]})]}),m.jsx("div",{className:"lg:col-span-2",children:m.jsxs(un,{className:"h-full border-white/5 bg-surface-dark/40 overflow-hidden flex flex-col shadow-2xl",children:[m.jsxs("header",{className:"p-8 border-b border-white/5 flex justify-between items-center",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("div",{className:"size-10 rounded-xl bg-primary/20 text-primary flex items-center justify-center",children:m.jsx("span",{className:"material-symbols-outlined",children:"hub"})}),m.jsxs("div",{children:[m.jsx("h3",{className:"font-bold text-white text-lg tracking-tight",children:"Contenido Interno (Planetas)"}),m.jsx("p",{className:"text-[10px] font-medium text-slate-500 mt-0.5",children:"Arrastra para reordenar la jerarqua orbital"})]})]}),m.jsxs("div",{className:"px-3 py-1 rounded-full bg-emerald-500/10 text-emerald-400 border border-emerald-500/20 text-[10px] font-black uppercase tracking-widest flex items-center gap-2",children:[m.jsx("div",{className:"size-1.5 rounded-full bg-emerald-500 animate-pulse"}),"8 Entidades"]})]}),m.jsxs("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-6 space-y-3",children:[m.jsx(eg,{name:"Mercurio",type:"Rocoso",stats:"430C | 88 Das",icon:"public"}),m.jsx(eg,{name:"Venus",type:"Atmsfera",stats:"462C | 225 Das",icon:"public"}),m.jsx(eg,{name:"Tierra",type:"Habitable",stats:"8B Hab | 1 Luna",icon:"public",active:!0}),m.jsx(eg,{name:"Marte",type:"Desierto",stats:"-60C | 2 Lunas",icon:"public"}),m.jsx(eg,{name:"Cinturn Asteroides",type:"Anillo",stats:">1M Obj",icon:"grain"})]}),m.jsx("div",{className:"p-8 bg-black/20 border-t border-white/5",children:m.jsxs("button",{className:"w-full py-4 rounded-[1.5rem] border-2 border-dashed border-white/10 text-slate-500 hover:text-white hover:border-primary/50 hover:bg-primary/5 transition-all flex items-center justify-center gap-3 font-black uppercase text-[10px] tracking-[0.2em]",children:[m.jsx("span",{className:"material-symbols-outlined",children:"add"}),"Aadir Nueva Entidad"]})})]})})]})]})}),k2=({label:t,color:e,icon:r})=>m.jsxs("div",{className:`px-4 py-1.5 rounded-xl bg-${e}-500/10 text-${e}-400 border border-${e}-500/20 flex items-center gap-2 text-[10px] font-black uppercase tracking-widest shadow-lg`,children:[m.jsx("span",{className:"material-symbols-outlined text-[14px]",children:r}),t]}),vy=({label:t,value:e,unit:r,icon:n})=>m.jsxs("div",{className:"space-y-2",children:[m.jsx("p",{className:"text-[9px] font-black uppercase tracking-widest text-slate-600 ml-1",children:t}),m.jsxs("div",{className:"w-full bg-white/5 border border-white/5 rounded-2xl px-5 py-3.5 flex items-center justify-between group hover:border-white/10 transition-all",children:[m.jsxs("div",{className:"flex items-center gap-3",children:[n&&m.jsx("span",{className:"material-symbols-outlined text-slate-500 text-lg group-hover:text-primary transition-colors",children:n}),m.jsx("span",{className:"text-sm font-bold text-slate-300",children:e})]}),r&&m.jsx("span",{className:"text-[10px] font-black text-slate-600 uppercase tracking-widest",children:r})]})]}),eg=({name:t,type:e,stats:r,icon:n,active:i})=>m.jsxs("div",{className:`group flex items-center gap-6 p-4 rounded-2xl transition-all cursor-pointer ${i?"bg-primary/10 border border-primary/20 shadow-xl":"hover:bg-white/5 border border-transparent"}`,children:[m.jsx("span",{className:"material-symbols-outlined text-slate-700 group-hover:text-slate-500",children:"drag_indicator"}),m.jsx("div",{className:`size-12 rounded-xl flex items-center justify-center ${i?"bg-primary text-white shadow-lg shadow-primary/30":"bg-surface-dark border border-white/5 text-slate-500"}`,children:m.jsx("span",{className:"material-symbols-outlined text-3xl",children:n})}),m.jsx("div",{className:"flex-1",children:m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsx("h4",{className:"text-sm font-bold text-white group-hover:text-primary transition-colors",children:t}),m.jsx("span",{className:`text-[8px] font-black px-1.5 py-0.5 rounded uppercase tracking-widest ${i?"bg-emerald-500/20 text-emerald-400 border border-emerald-500/30":"bg-white/5 text-slate-600"}`,children:e})]})}),m.jsx("div",{className:"flex flex-col items-end gap-1",children:m.jsxs("div",{className:"flex items-center gap-1.5 text-slate-500",children:[m.jsx("span",{className:"material-symbols-outlined text-[12px]",children:"analytics"}),m.jsx("span",{className:"text-[10px] font-mono tracking-tight group-hover:text-slate-300",children:r})]})}),m.jsxs("div",{className:"flex gap-2 ml-4",children:[m.jsx("button",{className:"p-2 rounded-lg text-slate-700 hover:text-white hover:bg-white/5 transition-all",children:m.jsx("span",{className:"material-symbols-outlined text-xl",children:"edit_note"})}),i?m.jsx("button",{className:"size-8 rounded-full bg-primary text-white flex items-center justify-center shadow-lg",children:m.jsx("span",{className:"material-symbols-outlined text-lg",children:"arrow_forward"})}):m.jsx("button",{className:"p-2 rounded-lg text-slate-700 hover:text-white hover:bg-white/5 transition-all",children:m.jsx("span",{className:"material-symbols-outlined text-xl",children:"open_in_new"})})]})]}),KG=()=>m.jsx("div",{className:"flex-1 flex overflow-hidden bg-background-dark font-sans text-slate-300",children:m.jsxs("main",{className:"flex-1 flex flex-col p-12 overflow-y-auto custom-scrollbar relative",children:[m.jsxs("header",{className:"mb-12 space-y-4",children:[m.jsxs("div",{className:"flex items-center gap-2 text-slate-500 font-bold text-[10px] tracking-widest uppercase",children:[m.jsx("span",{children:"Sistema Solar"}),m.jsx("span",{className:"material-symbols-outlined text-sm",children:"chevron_right"}),m.jsx("span",{children:"Kepler-186f"}),m.jsx("span",{className:"material-symbols-outlined text-sm",children:"chevron_right"}),m.jsx("span",{className:"text-white",children:"Territorios"})]}),m.jsxs("div",{className:"flex justify-between items-end",children:[m.jsxs("div",{children:[m.jsxs("div",{className:"flex items-center gap-4 mb-2",children:[m.jsx("h1",{className:"text-6xl font-manrope font-black text-white tracking-tight",children:"Kepler-186f"}),m.jsx("span",{className:"material-symbols-outlined text-4xl text-primary",children:"public"})]}),m.jsx("p",{className:"text-slate-400 text-lg max-w-2xl leading-relaxed",children:"Gestin geopoltica y geogrfica de la superficie planetaria. Administra biomas, asentamientos y recursos estratgicos."})]}),m.jsxs("div",{className:"flex gap-3",children:[m.jsx(mn,{variant:"secondary",icon:"map",children:"Ver Atlas"}),m.jsx(mn,{variant:"primary",icon:"add",children:"Nuevo Territorio"})]})]})]}),m.jsxs("section",{className:"space-y-8",children:[m.jsxs(un,{className:"p-2 flex items-center justify-between border-white/5",children:[m.jsxs("div",{className:"flex items-center gap-4 flex-1",children:[m.jsxs("div",{className:"relative flex-1 max-w-sm",children:[m.jsx("span",{className:"material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-slate-500 text-sm",children:"search"}),m.jsx("input",{type:"text",placeholder:"Buscar por nombre...",className:"w-full bg-transparent border-none rounded-xl py-2 pl-9 pr-4 text-xs focus:ring-1 focus:ring-primary/30 outline-none transition-all"})]}),m.jsx("div",{className:"w-px h-6 bg-white/5 mx-2"}),m.jsx(_2,{label:"Bioma: Todos"}),m.jsx(_2,{label:"Poblacin"}),m.jsx(_2,{label:"Estado"})]}),m.jsxs("div",{className:"flex items-center gap-1 p-1 bg-white/5 rounded-lg",children:[m.jsx("button",{className:"p-1.5 rounded-md text-slate-500 hover:text-white transition-colors",children:m.jsx("span",{className:"material-symbols-outlined text-lg",children:"format_list_bulleted"})}),m.jsx("button",{className:"p-1.5 rounded-md bg-white/10 text-white shadow-sm",children:m.jsx("span",{className:"material-symbols-outlined text-lg",children:"grid_view"})})]})]}),m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:[m.jsx(C2,{title:"Nueva Neo-Tokyo",desc:"Metrpolis vertical construida sobre las...",image:"https://lh3.googleusercontent.com/aida-public/AB6AXuAYF5Q6W3o1w1f1",badges:["Capital"],stats:["15M","Templado","Costero"],color:"cyan"}),m.jsx(C2,{title:"Mar de Dunas",desc:"Extensin rida rica en especia slica...",image:"https://lh3.googleusercontent.com/aida-public/AB6AXuBYG6R7X4p2x2g2",stats:["Hostil","rido"],color:"amber"}),m.jsx(C2,{title:"Sanctum Bio-Domo",desc:"Instalacin de investigacin...",image:"https://lh3.googleusercontent.com/aida-public/AB6AXuCZ H7S8Y5q3z3h3",badges:["Ciencia"],stats:["5K","Jungla"],color:"purple"}),m.jsxs("div",{className:"group border-2 border-dashed border-white/5 rounded-[2.5rem] flex flex-col items-center justify-center p-12 gap-4 hover:border-primary/30 hover:bg-primary/5 transition-all cursor-pointer",children:[m.jsx("div",{className:"size-16 rounded-3xl bg-white/5 flex items-center justify-center group-hover:scale-110 transition-transform",children:m.jsx("span",{className:"material-symbols-outlined text-3xl text-slate-600 group-hover:text-primary",children:"add_location_alt"})}),m.jsx("p",{className:"text-xs font-black uppercase tracking-widest text-slate-600 group-hover:text-white",children:"Aadir Territorio"})]})]})]})]})}),_2=({label:t})=>m.jsxs("button",{className:"flex items-center gap-2 px-3 py-1.5 rounded-xl hover:bg-white/5 transition-all group",children:[m.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest text-slate-500 group-hover:text-white",children:t}),m.jsx("span",{className:"material-symbols-outlined text-slate-600 text-[14px]",children:"expand_more"})]}),C2=({title:t,desc:e,image:r,badges:n=[],stats:i=[],color:a})=>m.jsxs("div",{className:"group relative rounded-[2.5rem] overflow-hidden border border-white/5 bg-surface-dark/50 hover:border-white/10 transition-all shadow-2xl",children:[m.jsxs("div",{className:"h-48 overflow-hidden relative",children:[m.jsx("img",{src:r,alt:t,className:"w-full h-full object-cover transition-transform duration-700 group-hover:scale-110 opacity-60 group-hover:opacity-100"}),m.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-surface-dark via-transparent to-transparent"}),m.jsx("div",{className:"absolute top-4 right-4 flex gap-2",children:n.map(s=>m.jsxs("span",{className:`px-3 py-1 rounded-full text-[9px] font-black uppercase tracking-widest bg-${a==="cyan"?"primary":a==="amber"?"amber-500":"purple-500"}/20 text-${a==="cyan"?"primary":a==="amber"?"amber-400":"purple-400"} border border-white/10 backdrop-blur-md flex items-center gap-1.5`,children:[m.jsx("span",{className:"material-symbols-outlined text-[12px]",children:s==="Capital"?"star":"science"}),s]},s))})]}),m.jsxs("div",{className:"p-8 space-y-6",children:[m.jsxs("header",{className:"flex justify-between items-start",children:[m.jsxs("div",{children:[m.jsx("h3",{className:"text-2xl font-manrope font-black text-white mb-2 group-hover:text-primary transition-colors",children:t}),m.jsx("p",{className:"text-xs text-slate-500 leading-relaxed line-clamp-2",children:e})]}),m.jsx("button",{className:"p-2 text-slate-700 hover:text-white",children:m.jsx("span",{className:"material-symbols-outlined",children:"more_vert"})})]}),m.jsx("div",{className:"flex flex-wrap gap-2",children:i.map(s=>m.jsxs("div",{className:"flex items-center gap-1.5 px-3 py-1 rounded-full bg-white/5 border border-white/5 text-[9px] font-black text-slate-400 uppercase tracking-widest",children:[m.jsx("div",{className:`size-1.5 rounded-full bg-${a==="cyan"?"primary":a==="amber"?"amber-500":"purple-500"}/50`}),s]},s))}),m.jsxs("div",{className:"flex gap-3 pt-2",children:[m.jsxs("button",{className:"flex-1 py-2.5 rounded-xl bg-white/5 hover:bg-white/10 border border-white/5 text-[10px] font-black uppercase tracking-widest text-slate-300 flex items-center justify-center gap-2 transition-all",children:[m.jsx("span",{className:"material-symbols-outlined text-sm opacity-50",children:"edit"})," Editar"]}),m.jsxs("button",{className:"flex-1 py-2.5 rounded-xl bg-white/5 hover:bg-white/10 border border-white/5 text-[10px] font-black uppercase tracking-widest text-slate-300 flex items-center justify-center gap-2 transition-all",children:[m.jsx("span",{className:"material-symbols-outlined text-sm opacity-50",children:"map"})," Ubicacin"]})]})]})]}),ZG=()=>{const{type:t,entityId:e}=Vi(),r=()=>{const n=t?.toLowerCase();switch(n){case"character":case"entidadindividual":return m.jsx(WG,{id:e});case"location":case"zona":return m.jsx(y5,{id:e});case"culture":case"entidadcolectiva":return m.jsx(qG,{id:e});case"universe":case"galaxy":case"system":return m.jsx($G,{id:e,type:n});case"planet":return m.jsx(KG,{id:e});case"construccion":return m.jsx(y5,{id:e});case"efectos":return m.jsxs("div",{className:"p-8 text-white",children:["Effect/Spell View for ID: ",e]});case"interaccion":return m.jsxs("div",{className:"p-8 text-white",children:["Interaction/Event View for ID: ",e]});case"magic":return m.jsxs("div",{className:"p-8 text-white",children:["Magic System View for ID: ",id]});default:return m.jsxs("div",{className:"p-8 text-white",children:["Unknown Entity Type: ",t]})}};return m.jsx("div",{className:"flex-1 bg-background-dark overflow-hidden",children:r()})},YG=()=>{const{t}=Sc(),{setRightPanelMode:e,setRightOpen:r,setRightPanelTitle:n}=Ll(),[i,a]=se.useState([]),[s,o]=se.useState(null),[l,u]=se.useState([]),[c,f]=se.useState(!0),[p,v]=se.useState(!1),[y,S]=se.useState(!1),[w,T]=se.useState({nombre:"",descripcion:"",fechaTexto:"",ordenAbsoluto:0}),[_,C]=se.useState({nombre:"",descripcion:""}),[N,A]=se.useState(null),[O,j]=se.useState(null),[D,F]=se.useState("eventos"),[B,$]=se.useState([]),[Z,I]=se.useState([]),[q,U]=se.useState(null),W=sr.useRef(!1),Y=async Ce=>{try{return(await Qe.get("/bd/relacion")).filter(vt=>vt.tipoOrigen==="lineatiempo"&&vt.idOrigen===Ce||vt.tipoDestino==="lineatiempo"&&vt.idDestino===Ce).map(vt=>vt.idOrigen===Ce?vt.idDestino:vt.idOrigen)}catch(Fe){return console.error(Fe),[]}},Q=async(Ce,Fe)=>{const Ke=await Y(Ce),pt=Fe.filter(At=>Ke.includes(At.id));$(pt);const vt=Fe.filter(At=>At.id!==Ce&&!Ke.includes(At.id));I(vt)},ne=async Ce=>{if(!(!s||!Ce))try{await Qe.put("/bd/insertar",{tipoEntidad:"relacion",tipoOrigen:"lineatiempo",idOrigen:s,tipoDestino:"lineatiempo",idDestino:Ce,descripcion:"Anexo de lnea de tiempo"}),Q(s,i)}catch(Fe){console.error(Fe)}},re=async Ce=>{const Ke=(await Qe.get("/bd/relacion")).find(pt=>pt.tipoOrigen==="lineatiempo"&&pt.idOrigen===s&&pt.idDestino===Ce||pt.tipoDestino==="lineatiempo"&&pt.idDestino===s&&pt.idOrigen===Ce);Ke&&(await Qe.delete(`/bd/relacion/${Ke.id}`),Q(s,i))};se.useEffect(()=>{e("CUSTOM"),n(t("timeline.title"));const Ce=setInterval(()=>{const Fe=document.getElementById("architect-right-panel-portal");Fe&&(U(Fe),clearInterval(Ce))},50);return()=>{clearInterval(Ce),e("NOTES"),n("")}},[]);const[H,te]=se.useState([]),[ie,de]=se.useState(null);se.useEffect(()=>{W.current||(W.current=!0,ye())},[]);const ge=Ce=>{n(m.jsxs("div",{className:"flex flex-col",children:[m.jsx("span",{children:t("timeline.title").toUpperCase()}),Ce&&m.jsx("span",{className:"text-[10px] text-slate-400 font-medium normal-case tracking-normal mt-0.5",children:Ce})]}))};se.useEffect(()=>{if(D==="eventos"||D==="anexos")if(s){const Fe=H.flatMap(Ke=>Ke.lineasTemporales||[]).find(Ke=>Ke.id===s);ge(Fe?.nombre)}else ge(null);else D==="universo"&&n(t("timeline.multiverse"))},[s,D,H]);const ye=async()=>{try{const Ce=await Qe.get("/multiverso/list");if(te(Ce),!s&&Ce.length>0){const Fe=Ce[0];Fe.lineasTemporales&&Fe.lineasTemporales.length>0&&o(Fe.lineasTemporales[0].id)}}catch(Ce){console.error("Failed to load multiverse",Ce)}},ae=async Ce=>{try{const Fe=await Qe.get(`/timeline/linea/${Ce}/eventos`);Fe.sort((Ke,pt)=>(Ke.ordenAbsoluto||0)-(pt.ordenAbsoluto||0)),u(Fe)}catch(Fe){console.error("Failed to load events",Fe)}},pe=async()=>{if(!s||!w.nombre)return;const Ce={...w,ordenAbsoluto:parseInt(w.ordenAbsoluto)||0};try{N?await Qe.put(`/timeline/evento/${N.id}`,{...Ce,lineaTiempo:{id:s}}):await Qe.post("/timeline/evento",{...Ce,lineaTiempo:{id:s}}),T({nombre:"",descripcion:"",fechaTexto:"",ordenAbsoluto:0}),A(null),ae(s)}catch(Fe){console.error(Fe)}},le=Ce=>{A(Ce),T({nombre:Ce.nombre,descripcion:Ce.descripcion,fechaTexto:Ce.fechaTexto,ordenAbsoluto:Ce.ordenAbsoluto||0}),F("eventos"),r(!0)},me=async()=>{if(!(!_.nombre||!_.universoId))try{const Ce=await Qe.post("/timeline/linea",{..._,esRaiz:!1,universo:{id:_.universoId}});S(!1),C({nombre:"",descripcion:"",universoId:null}),await ye(),o(Ce.id)}catch(Ce){console.error("Error creating timeline:",Ce)}},[he,xe]=se.useState({nombre:"",descripcion:""}),we=async()=>{if(he.nombre)try{const Ce=await Qe.post("/multiverso/crear",he);xe({nombre:"",descripcion:""}),r(!1),await ye()}catch(Ce){console.error("Error creating universe",Ce)}},Ge=async()=>{if(ie)try{await Qe.put(`/multiverso/${ie}`,{nombre:he.nombre,descripcion:he.descripcion}),r(!1),await ye()}catch(Ce){console.error("Error updating universe",Ce)}},qe=async()=>{if(ie&&window.confirm(t("timeline.delete_universe_confirm")))try{await Qe.delete(`/multiverso/${ie}`),r(!1),de(null),await ye()}catch(Ce){console.error("Error deleting universe",Ce)}};se.useEffect(()=>{if(D==="universe-create")xe({nombre:"",descripcion:""});else if(D==="universe-edit"&&ie){const Ce=H.find(Fe=>Fe.id===ie);Ce&&xe({nombre:Ce.nombre,descripcion:Ce.descripcion||""})}},[D,ie,H]);const[wt,et]=se.useState({open:!1,type:null,id:null,title:"",message:""}),at=(Ce,Fe)=>{Fe.stopPropagation(),et({open:!0,type:"TIMELINE",id:Ce,title:t("timeline.delete_line"),message:t("bible.delete_folder_msg")})},je=(Ce,Fe)=>{Fe.stopPropagation(),et({open:!0,type:"EVENT",id:Ce,title:t("timeline.delete_event"),message:t("common.are_you_sure")})},Re=async()=>{const{type:Ce,id:Fe}=wt;if(!(!Ce||!Fe))try{if(Ce==="TIMELINE"){if(await Qe.delete(`/timeline/linea/${Fe}`),s===Fe){const pt=H.flatMap(vt=>vt.lineasTemporales||[]).filter(vt=>vt.id!==Fe);o(pt.length>0?pt[0].id:null)}await ye()}else Ce==="EVENT"&&(await Qe.delete(`/timeline/evento/${Fe}`),ae(s),N&&N.id===Fe&&A(null))}catch(Ke){console.error(Ke),alert(t("common.error_delete"))}},nt=m.jsxs(m.Fragment,{children:[m.jsx("div",{className:"p-4 border-b border-white/5",children:m.jsxs("div",{className:"flex bg-black/40 rounded-lg p-1 overflow-x-auto gap-1",children:[m.jsx("button",{onClick:()=>F("eventos"),className:`flex-1 py-2 text-xs font-bold uppercase tracking-wider rounded-md transition-all ${D==="eventos"?"bg-primary text-white shadow-lg":"text-slate-500 hover:text-slate-300"}`,children:t("timeline.events_tab")}),m.jsx("button",{onClick:()=>F("anexos"),className:`flex-1 py-2 text-xs font-bold uppercase tracking-wider rounded-md transition-all ${D==="anexos"?"bg-primary text-white shadow-lg":"text-slate-500 hover:text-slate-300"}`,children:t("timeline.annexes_tab")}),m.jsx("button",{onClick:()=>F("universo"),className:`flex-1 py-2 text-xs font-bold uppercase tracking-wider rounded-md transition-all ${D==="universo"?"bg-amber-600 text-white shadow-lg":"text-slate-500 hover:text-amber-500/80"}`,children:t("timeline.multiverse")})]})}),m.jsxs("div",{className:"flex-1 overflow-y-auto p-4 custom-scrollbar",children:[D==="eventos"&&m.jsx("div",{className:"space-y-6 animate-in fade-in slide-in-from-right-4",children:m.jsxs("div",{className:"bg-black/20 rounded-xl p-4 border border-white/5",children:[m.jsxs("h3",{className:"text-xs font-black uppercase text-primary mb-4 flex items-center justify-between",children:[t(N?"timeline.edit_event":"timeline.add_event"),N&&m.jsx("button",{onClick:()=>{A(null),T({nombre:"",descripcion:"",fechaTexto:"",ordenAbsoluto:l.length+1})},className:"text-[10px] text-slate-500 hover:text-white underline",children:t("common.cancel").toUpperCase()})]}),m.jsxs("div",{className:"space-y-3",children:[m.jsxs("div",{children:[m.jsx("label",{className:"text-[10px] text-slate-500 uppercase font-bold mb-1 block",children:t("timeline.event_name")}),m.jsx("input",{className:"w-full bg-background-dark border border-white/10 rounded-lg p-2 text-sm text-white outline-none focus:border-primary",value:w.nombre,onChange:Ce=>T({...w,nombre:Ce.target.value}),placeholder:t("timeline.event_name")})]}),m.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[m.jsxs("div",{children:[m.jsx("label",{className:"text-[10px] text-slate-500 uppercase font-bold mb-1 block",children:t("timeline.date_label")}),m.jsx("input",{className:"w-full bg-background-dark border border-white/10 rounded-lg p-2 text-sm text-white outline-none focus:border-primary",value:w.fechaTexto,onChange:Ce=>T({...w,fechaTexto:Ce.target.value}),placeholder:"e.g. Year 500"})]}),m.jsxs("div",{children:[m.jsx("label",{className:"text-[10px] text-slate-500 uppercase font-bold mb-1 block",children:t("timeline.order")}),m.jsx("input",{type:"text",className:"w-full bg-background-dark border border-white/10 rounded-lg p-2 text-sm text-white outline-none focus:border-primary",value:w.ordenAbsoluto,onChange:Ce=>{const Fe=Ce.target.value;/^[-+]?\d*$/.test(Fe)&&T({...w,ordenAbsoluto:Fe})},placeholder:"+/- Num"})]})]}),m.jsxs("div",{children:[m.jsx("label",{className:"text-[10px] text-slate-500 uppercase font-bold mb-1 block",children:t("timeline.description")}),m.jsx("textarea",{className:"w-full bg-background-dark border border-white/10 rounded-lg p-2 text-sm text-white outline-none focus:border-primary h-24 resize-none",value:w.descripcion,onChange:Ce=>T({...w,descripcion:Ce.target.value}),placeholder:t("timeline.description")})]}),m.jsx("div",{className:"pt-2",children:m.jsx(mn,{variant:"primary",onClick:pe,className:"w-full justify-center",children:t(N?"timeline.save_changes":"timeline.create_event")})}),N&&m.jsx("button",{onClick:Ce=>je(N.id,Ce),className:"w-full text-center text-xs text-red-500 hover:text-red-400 py-2 border border-red-500/20 rounded-lg hover:bg-red-500/10 transition-colors",children:t("timeline.delete_event_btn")})]})]})}),D==="anexos"&&m.jsx("div",{className:"space-y-6 animate-in fade-in slide-in-from-right-4",children:m.jsxs("div",{className:"bg-black/20 rounded-xl p-4 border border-white/5",children:[m.jsx("h3",{className:"text-xs font-black uppercase text-primary mb-4",children:t("timeline.linked_timelines")}),m.jsx("p",{className:"text-xs text-slate-500 mb-4",children:t("timeline.annexed_desc")}),m.jsxs("div",{className:"space-y-2 mb-6",children:[B.map(Ce=>m.jsxs("div",{className:"flex items-center justify-between p-2 bg-white/5 rounded-lg border border-white/5",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-xs text-slate-400",children:"timeline"}),m.jsx("span",{className:"text-xs font-bold text-slate-300",children:Ce.nombre})]}),m.jsx("button",{onClick:()=>re(Ce.id),className:"text-slate-500 hover:text-red-500",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"link_off"})})]},Ce.id)),B.length===0&&m.jsx("span",{className:"text-xs text-slate-600 italic",children:t("timeline.no_linked")})]}),m.jsx("h4",{className:"text-[10px] font-bold uppercase text-slate-400 mb-2",children:t("timeline.available_to_link")}),m.jsxs("div",{className:"space-y-1",children:[Z.map(Ce=>m.jsxs("button",{onClick:()=>ne(Ce.id),className:"w-full flex items-center gap-2 p-2 hover:bg-white/5 rounded-lg text-left transition-colors group",children:[m.jsx("span",{className:"material-symbols-outlined text-xs text-green-500/50 group-hover:text-green-500",children:"add_link"}),m.jsx("span",{className:"text-xs text-slate-400 group-hover:text-white",children:Ce.nombre})]},Ce.id)),Z.length===0&&m.jsx("span",{className:"text-xs text-slate-600 italic",children:t("timeline.no_available")})]})]})}),D==="universo"&&m.jsx("div",{className:"space-y-6 animate-in fade-in slide-in-from-right-4",children:m.jsxs("div",{className:"bg-black/20 rounded-xl p-4 border border-white/5",children:[m.jsx("h3",{className:"text-xs font-black uppercase text-amber-500 mb-4",children:t(ie?"timeline.universe_settings":"timeline.new_universe")}),m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{children:[m.jsx("label",{className:"text-[10px] text-slate-500 uppercase font-bold mb-1 block",children:t("timeline.universe_name")}),m.jsx("input",{className:"w-full bg-background-dark border border-white/10 rounded-lg p-2 text-sm text-white outline-none focus:border-primary",value:he.nombre,onChange:Ce=>xe({...he,nombre:Ce.target.value}),placeholder:"e.g. Alternate Reality 1"})]}),m.jsxs("div",{children:[m.jsx("label",{className:"text-[10px] text-slate-500 uppercase font-bold mb-1 block",children:"Description"}),m.jsx("textarea",{className:"w-full bg-background-dark border border-white/10 rounded-lg p-2 text-sm text-white outline-none focus:border-primary h-24 resize-none",value:he.descripcion,onChange:Ce=>xe({...he,descripcion:Ce.target.value}),placeholder:t("timeline.universe_desc")})]}),m.jsx("div",{className:"pt-2",children:m.jsx(mn,{variant:"primary",onClick:ie?Ge:we,className:"w-full justify-center",children:t(ie?"common.save":"common.create")})}),ie&&m.jsx("button",{onClick:qe,className:"w-full text-center text-xs text-red-500 hover:text-red-400 py-2 border border-red-500/20 rounded-lg hover:bg-red-500/10 transition-colors",children:t("common.delete")})]})]})})]})]});return m.jsxs("div",{className:"flex h-screen bg-background-dark text-white overflow-hidden",children:[q&&Al.createPortal(nt,q),m.jsxs("aside",{className:"w-64 bg-surface-dark border-r border-white/5 flex flex-col p-4 z-20 shrink-0",children:[m.jsxs("header",{className:"flex justify-between items-center mb-6",children:[m.jsx("h2",{className:"text-xs font-black uppercase tracking-widest text-primary",children:t("timeline.multiverse")}),m.jsx("button",{onClick:()=>{e("CUSTOM"),F("universo"),de(null),xe({nombre:"",descripcion:""}),r(!0)},className:"text-slate-400 hover:text-white",title:"New Universe",children:m.jsx("span",{className:"material-symbols-outlined",children:"add_circle"})})]}),m.jsx("div",{className:"space-y-6 overflow-y-auto flex-1 custom-scrollbar",children:H.map(Ce=>m.jsxs("div",{className:"space-y-2",children:[m.jsxs("div",{className:"flex items-center justify-between group",children:[m.jsx("h3",{className:`text-[10px] font-bold uppercase pl-2 cursor-pointer ${ie===Ce.id?"text-white":"text-slate-500"}`,onClick:()=>{de(Ce.id),xe({nombre:Ce.nombre,descripcion:Ce.descripcion||""}),F("universo"),e("CUSTOM"),r(!0)},children:Ce.nombre}),m.jsx("div",{className:"flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:m.jsx("button",{onClick:()=>{C({..._,universoId:Ce.id}),S(!0)},className:"text-slate-500 hover:text-primary",title:"Add Timeline here",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"add"})})})]}),y&&_.universoId===Ce.id&&m.jsxs("div",{className:"ml-2 mb-2 p-2 bg-black/20 rounded-lg animate-in fade-in",children:[m.jsx("input",{className:"w-full bg-transparent border-b border-white/20 text-xs p-1 outline-none focus:border-primary mb-1",placeholder:"Timeline Name",value:_.nombre,onChange:Fe=>C({..._,nombre:Fe.target.value}),autoFocus:!0,onKeyDown:Fe=>Fe.key==="Enter"&&me()}),m.jsxs("div",{className:"flex justify-end gap-1",children:[m.jsx("button",{onClick:()=>S(!1),className:"text-[10px] text-slate-500 hover:text-white",children:t("common.cancel").toUpperCase()}),m.jsx("button",{onClick:me,className:"text-[10px] font-bold text-primary",children:t("common.create").toUpperCase()})]})]}),m.jsxs("div",{className:"space-y-1 pl-2 border-l border-white/5 ml-1",children:[Ce.lineasTemporales&&Ce.lineasTemporales.map(Fe=>m.jsxs("div",{onClick:()=>{o(Fe.id),F("eventos"),e("CUSTOM"),r(!0)},className:`group flex items-center justify-between p-2 rounded-lg cursor-pointer transition-all ${s===Fe.id?"bg-primary/10 text-white shadow-[0_0_10px_rgba(var(--primary-rgb),0.1)]":"text-slate-400 hover:bg-white/5"}`,children:[m.jsx("span",{className:"text-xs truncate",children:Fe.nombre}),m.jsx("button",{onClick:Ke=>at(Fe.id,Ke),className:"opacity-0 group-hover:opacity-100 text-slate-500 hover:text-red-500 transition-opacity",children:m.jsx("span",{className:"material-symbols-outlined text-[10px]",children:"delete"})})]},Fe.id)),(!Ce.lineasTemporales||Ce.lineasTemporales.length===0)&&m.jsx("div",{className:"p-2 text-[10px] italic text-slate-600",children:t("timeline.no_timelines")})]})]},Ce.id))})]}),m.jsxs("main",{className:"flex-1 relative flex flex-col h-full overflow-hidden bg-background-dark",children:[m.jsx("div",{className:"h-16 border-b border-white/5 bg-background-dark/80 backdrop-blur flex items-center px-8 z-10 shrink-0",children:m.jsx("div",{children:(()=>{const Fe=H.flatMap(Ke=>Ke.lineasTemporales||[]).find(Ke=>Ke.id===s);return m.jsxs(m.Fragment,{children:[m.jsxs("h1",{className:"text-xl font-bold flex items-center gap-2",children:[Fe?.esRaiz&&m.jsx("span",{className:"text-amber-400 material-symbols-outlined",children:"star"}),Fe?.nombre||t("timeline.select_timeline")]}),m.jsx("p",{className:"text-xs text-slate-500",children:Fe?.descripcion})]})})()})}),m.jsx("div",{className:"flex-1 overflow-y-auto p-8 relative custom-scrollbar z-10",children:m.jsxs("div",{className:"max-w-2xl mx-auto relative pl-8 border-l-2 border-white/10 space-y-8 pb-32",children:[l.length===0&&m.jsx("div",{className:"text-center text-slate-600 italic py-20",children:t("timeline.no_events")}),l.map((Ce,Fe)=>m.jsxs("div",{className:"relative group animate-in fade-in slide-in-from-bottom-4",style:{animationDelay:`${Fe*50}ms`},children:[m.jsx("div",{className:"absolute top-6 -left-[41px] size-4 rounded-full bg-white/20 border-4 border-background-dark group-hover:bg-primary transition-colors cursor-pointer",onClick:()=>le(Ce)}),m.jsxs("div",{className:"ml-4 bg-surface-dark/50 border border-white/5 p-5 rounded-2xl hover:border-primary/30 transition-all hover:bg-surface-dark group-hover:translate-x-1 duration-300 relative group/card",children:[m.jsxs("div",{className:"absolute top-3 right-3 opacity-0 group-hover/card:opacity-100 transition-opacity flex gap-1 bg-black/50 rounded-lg backdrop-blur-sm border border-white/5 p-1",children:[m.jsx("button",{onClick:()=>le(Ce),className:"p-1.5 text-slate-400 hover:text-white hover:bg-white/10 rounded transition-colors",title:"Edit",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"edit"})}),m.jsx("button",{onClick:Ke=>je(Ce.id,Ke),className:"p-1.5 text-slate-400 hover:text-red-500 hover:bg-red-500/10 rounded transition-colors",title:"Delete",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})})]}),m.jsx("div",{className:"flex justify-between items-start",children:m.jsxs("div",{children:[m.jsxs("div",{className:"flex flex-col mb-1",children:[m.jsx("h3",{className:"text-lg font-bold text-white",children:Ce.nombre}),m.jsx("span",{className:"text-xs font-mono font-bold text-primary opacity-80",children:Ce.fechaTexto})]}),m.jsx("p",{className:"text-sm text-slate-400 leading-relaxed",children:Ce.descripcion})]})})]})]},Ce.id))]})})]}),m.jsx(Xv,{isOpen:wt.open,onClose:()=>et({...wt,open:!1}),onConfirm:Re,title:wt.title,message:wt.message,confirmText:t("common.delete"),type:"danger"})]})},XG=({onCancel:t,onCreate:e})=>{const[r,n]=se.useState(1),[i,a]=se.useState("regional"),[s,o]=se.useState("upload"),[l,u]=se.useState(null),[c,f]=se.useState(""),p=sr.useRef(null),v=w=>{const T=w.target.files?.[0];T&&T.type.startsWith("image/")&&(u(T),o("upload"))},y=()=>{p.current?.click()},S=()=>{e(s,c||"Nuevo Mapa",l)};return m.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-background-dark/80 backdrop-blur-xl animate-in fade-in duration-300",children:m.jsx("div",{className:"w-full max-w-4xl max-h-[90vh] overflow-y-auto no-scrollbar relative animate-in zoom-in-95 duration-500",children:m.jsxs(un,{className:"p-0 border-white/10 shadow-[0_0_100px_rgba(0,0,0,0.5)] overflow-hidden",children:[m.jsxs("header",{className:"p-8 border-b border-white/5 flex justify-between items-center bg-white/[0.02]",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("div",{className:"size-12 rounded-2xl bg-primary/20 text-primary flex items-center justify-center",children:m.jsx("span",{className:"material-symbols-outlined text-2xl",children:"add_location_alt"})}),m.jsxs("div",{children:[m.jsx("h1",{className:"text-2xl font-manrope font-black text-white tracking-tight",children:"Crear Nuevo Mapa / Zona"}),m.jsx("p",{className:"text-xs text-slate-500 font-medium",children:"Configura los detalles para tu nueva entrada cartogrfica."})]})]}),m.jsx("button",{onClick:t,className:"text-slate-500 hover:text-white transition-colors",children:m.jsx("span",{className:"material-symbols-outlined",children:"close"})})]}),m.jsxs("div",{className:"p-12 space-y-12",children:[m.jsxs("section",{className:"space-y-6",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("div",{className:`size-8 rounded-full flex items-center justify-center text-[10px] font-black ${r===1?"bg-primary text-white shadow-lg shadow-primary/30":"bg-white/10 text-slate-500"}`,children:"1"}),m.jsx("h2",{className:"text-sm font-black uppercase tracking-[0.2em] text-white",children:"Identidad y Jerarqua"})]}),m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8 pl-12",children:[m.jsxs("div",{className:"space-y-1.5",children:[m.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-slate-600 ml-1",children:"Nombre del Mapa"}),m.jsx("input",{type:"text",placeholder:"ej. La Costa de Zafiro",value:c,onChange:w=>f(w.target.value),className:"w-full bg-white/5 border border-white/5 rounded-2xl px-4 py-3 text-sm text-white focus:border-primary/50 transition-all outline-none"})]}),m.jsxs("div",{className:"space-y-1.5 row-span-2",children:[m.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-slate-600 ml-1",children:"Descripcin"}),m.jsx("textarea",{placeholder:"Breve descripcin de la geografa, clima o importancia...",className:"w-full h-[120px] bg-white/5 border border-white/5 rounded-2xl p-4 text-sm text-white focus:border-primary/50 outline-none transition-all resize-none"})]}),m.jsxs("div",{className:"space-y-1.5",children:[m.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-slate-600 ml-1",children:"Zona Padre (Opcional)"}),m.jsxs("select",{className:"w-full bg-white/5 border border-white/5 rounded-2xl px-4 py-3 text-sm text-white focus:border-primary/50 outline-none appearance-none",children:[m.jsx("option",{children:"Ninguna (Nivel Superior)"}),m.jsx("option",{children:"Reino de Aethelgard"}),m.jsx("option",{children:"Continente de Aurum"})]}),m.jsx("p",{className:"text-[9px] text-slate-500 italic mt-1 ml-1 text-primary/70",children:"Seleccionar un padre convierte esto en sub-zona."})]})]})]}),m.jsx("div",{className:"h-px w-full bg-white/5"}),m.jsxs("section",{className:"space-y-6",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("div",{className:`size-8 rounded-full flex items-center justify-center text-[10px] font-black ${r===2?"bg-primary text-white shadow-lg shadow-primary/30":"bg-white/10 text-slate-500"}`,children:"2"}),m.jsx("h2",{className:"text-sm font-black uppercase tracking-[0.2em] text-white",children:"Tipo de Mapa"})]}),m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 pl-12",children:[m.jsx(E2,{active:i==="world",onClick:()=>a("world"),icon:"public",label:"Mapa Mundial",desc:"Continentes, ocanos, escala global."}),m.jsx(E2,{active:i==="regional",onClick:()=>a("regional"),icon:"map",label:"Mapa Regional",desc:"Reinos, provincias, biomas."}),m.jsx(E2,{active:i==="local",onClick:()=>a("local"),icon:"location_city",label:"Ciudad / Local",desc:"Ciudades, mazmorras, mapas de batalla."})]})]}),m.jsx("div",{className:"h-px w-full bg-white/5"}),m.jsxs("section",{className:"space-y-6",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("div",{className:`size-8 rounded-full flex items-center justify-center text-[10px] font-black ${r===3?"bg-primary text-white shadow-lg shadow-primary/30":"bg-white/10 text-slate-500"}`,children:"3"}),m.jsx("h2",{className:"text-sm font-black uppercase tracking-[0.2em] text-white",children:"Fuente del Lienzo"})]}),m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 pl-12",children:[m.jsx("input",{ref:p,type:"file",accept:"image/*",onChange:v,className:"hidden"}),m.jsx(x5,{active:s==="upload",onClick:y,icon:"cloud_upload",label:l?l.name:"Cargar Archivo de Imagen",desc:l?"Archivo seleccionado":"Arrastra y suelta o haz clic para buscar",subdesc:"JPG, PNG, WEBP  MAX 25MB"}),m.jsx(x5,{active:s==="blank",onClick:()=>o("blank"),icon:"brush",label:"Lienzo en Blanco",desc:"Crear un nuevo dibujo desde cero",subdesc:"4096 px x 4096 px"})]})]})]}),m.jsxs("footer",{className:"p-8 bg-white/[0.02] border-t border-white/5 flex justify-between items-center",children:[m.jsx("button",{onClick:t,className:"text-sm font-bold text-slate-500 hover:text-white transition-colors",children:"Cancelar"}),m.jsxs("div",{className:"flex items-center gap-6",children:[m.jsx("span",{className:"text-[9px] font-black uppercase tracking-widest text-slate-600",children:"Cambios guardados localmente"}),m.jsx(mn,{variant:"primary",className:"px-10 py-3 shadow-xl",onClick:S,children:"Crear Mapa"})]})]})]})})})},E2=({active:t,onClick:e,icon:r,label:n,desc:i})=>m.jsxs("div",{onClick:e,className:`p-6 rounded-3xl border transition-all cursor-pointer group ${t?"bg-primary/10 border-primary shadow-lg shadow-primary/10":"bg-white/5 border-white/5 hover:border-white/10"}`,children:[m.jsx("div",{className:`size-10 rounded-xl mb-4 flex items-center justify-center transition-all ${t?"bg-primary text-white":"bg-white/5 text-slate-500 group-hover:text-slate-300"}`,children:m.jsx("span",{className:"material-symbols-outlined",children:r})}),m.jsx("h3",{className:`text-sm font-bold mb-1 transition-colors ${t?"text-white":"text-slate-400 group-hover:text-slate-200"}`,children:n}),m.jsx("p",{className:"text-[10px] text-slate-500 leading-relaxed font-medium",children:i})]}),x5=({active:t,onClick:e,icon:r,label:n,desc:i,subdesc:a})=>m.jsxs("div",{onClick:e,className:`p-10 rounded-[2.5rem] border transition-all cursor-pointer group flex flex-col items-center text-center gap-4 ${t?"bg-primary/5 border-primary shadow-lg":"bg-white/[0.02] border-white/5 hover:border-white/10 hover:bg-white/[0.04]"}`,children:[m.jsx("div",{className:`size-16 rounded-[2rem] flex items-center justify-center transition-all ${t?"bg-primary text-white shadow-xl shadow-primary/20":"bg-white/5 text-slate-600 group-hover:text-slate-400"}`,children:m.jsx("span",{className:"material-symbols-outlined text-3xl",children:r})}),m.jsxs("div",{className:"space-y-1",children:[m.jsx("h3",{className:`font-bold transition-colors ${t?"text-white":"text-slate-400"}`,children:n}),m.jsx("p",{className:"text-xs text-slate-500 font-medium",children:i})]}),m.jsx("div",{className:"flex gap-2 mt-2",children:a.split("").map((s,o)=>m.jsx("span",{className:"px-2 py-1 rounded bg-black/20 text-[8px] font-black text-slate-600 tracking-tighter uppercase whitespace-nowrap",children:s.trim()},o))})]});var Yy={exports:{}},tg={},T2={},N2={},b5;function Sr(){return b5||(b5=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t._registerNode=t.Konva=t.glob=void 0;const e=Math.PI/180;function r(){return typeof window<"u"&&({}.toString.call(window)==="[object Window]"||{}.toString.call(window)==="[object global]")}t.glob=typeof yE<"u"?yE:typeof window<"u"?window:typeof WorkerGlobalScope<"u"?self:{},t.Konva={_global:t.glob,version:"9.3.16",isBrowser:r(),isUnminified:/param/.test((function(i){}).toString()),dblClickWindow:400,getAngle(i){return t.Konva.angleDeg?i*e:i},enableTrace:!1,pointerEventsEnabled:!0,autoDrawEnabled:!0,hitOnDragEnabled:!1,capturePointerEventsEnabled:!1,_mouseListenClick:!1,_touchListenClick:!1,_pointerListenClick:!1,_mouseInDblClickWindow:!1,_touchInDblClickWindow:!1,_pointerInDblClickWindow:!1,_mouseDblClickPointerId:null,_touchDblClickPointerId:null,_pointerDblClickPointerId:null,_fixTextRendering:!1,pixelRatio:typeof window<"u"&&window.devicePixelRatio||1,dragDistance:3,angleDeg:!0,showWarnings:!0,dragButtons:[0,1],isDragging(){return t.Konva.DD.isDragging},isTransforming(){var i;return(i=t.Konva.Transformer)===null||i===void 0?void 0:i.isTransforming()},isDragReady(){return!!t.Konva.DD.node},releaseCanvasOnDestroy:!0,document:t.glob.document,_injectGlobal(i){t.glob.Konva=i}};const n=i=>{t.Konva[i.prototype.getClassName()]=i};t._registerNode=n,t.Konva._injectGlobal(t.Konva)})(N2)),N2}var P2={},w5;function si(){return w5||(w5=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Util=t.Transform=void 0;const e=Sr();class r{constructor(N=[1,0,0,1,0,0]){this.dirty=!1,this.m=N&&N.slice()||[1,0,0,1,0,0]}reset(){this.m[0]=1,this.m[1]=0,this.m[2]=0,this.m[3]=1,this.m[4]=0,this.m[5]=0}copy(){return new r(this.m)}copyInto(N){N.m[0]=this.m[0],N.m[1]=this.m[1],N.m[2]=this.m[2],N.m[3]=this.m[3],N.m[4]=this.m[4],N.m[5]=this.m[5]}point(N){const A=this.m;return{x:A[0]*N.x+A[2]*N.y+A[4],y:A[1]*N.x+A[3]*N.y+A[5]}}translate(N,A){return this.m[4]+=this.m[0]*N+this.m[2]*A,this.m[5]+=this.m[1]*N+this.m[3]*A,this}scale(N,A){return this.m[0]*=N,this.m[1]*=N,this.m[2]*=A,this.m[3]*=A,this}rotate(N){const A=Math.cos(N),O=Math.sin(N),j=this.m[0]*A+this.m[2]*O,D=this.m[1]*A+this.m[3]*O,F=this.m[0]*-O+this.m[2]*A,B=this.m[1]*-O+this.m[3]*A;return this.m[0]=j,this.m[1]=D,this.m[2]=F,this.m[3]=B,this}getTranslation(){return{x:this.m[4],y:this.m[5]}}skew(N,A){const O=this.m[0]+this.m[2]*A,j=this.m[1]+this.m[3]*A,D=this.m[2]+this.m[0]*N,F=this.m[3]+this.m[1]*N;return this.m[0]=O,this.m[1]=j,this.m[2]=D,this.m[3]=F,this}multiply(N){const A=this.m[0]*N.m[0]+this.m[2]*N.m[1],O=this.m[1]*N.m[0]+this.m[3]*N.m[1],j=this.m[0]*N.m[2]+this.m[2]*N.m[3],D=this.m[1]*N.m[2]+this.m[3]*N.m[3],F=this.m[0]*N.m[4]+this.m[2]*N.m[5]+this.m[4],B=this.m[1]*N.m[4]+this.m[3]*N.m[5]+this.m[5];return this.m[0]=A,this.m[1]=O,this.m[2]=j,this.m[3]=D,this.m[4]=F,this.m[5]=B,this}invert(){const N=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),A=this.m[3]*N,O=-this.m[1]*N,j=-this.m[2]*N,D=this.m[0]*N,F=N*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),B=N*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);return this.m[0]=A,this.m[1]=O,this.m[2]=j,this.m[3]=D,this.m[4]=F,this.m[5]=B,this}getMatrix(){return this.m}decompose(){const N=this.m[0],A=this.m[1],O=this.m[2],j=this.m[3],D=this.m[4],F=this.m[5],B=N*j-A*O,$={x:D,y:F,rotation:0,scaleX:0,scaleY:0,skewX:0,skewY:0};if(N!=0||A!=0){const Z=Math.sqrt(N*N+A*A);$.rotation=A>0?Math.acos(N/Z):-Math.acos(N/Z),$.scaleX=Z,$.scaleY=B/Z,$.skewX=(N*O+A*j)/B,$.skewY=0}else if(O!=0||j!=0){const Z=Math.sqrt(O*O+j*j);$.rotation=Math.PI/2-(j>0?Math.acos(-O/Z):-Math.acos(O/Z)),$.scaleX=B/Z,$.scaleY=Z,$.skewX=0,$.skewY=(N*O+A*j)/B}return $.rotation=t.Util._getRotation($.rotation),$}}t.Transform=r;let n="[object Array]",i="[object Number]",a="[object String]",s="[object Boolean]",o=Math.PI/180,l=180/Math.PI,u="#",c="",f="0",p="Konva warning: ",v="Konva error: ",y="rgb(",S={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,132,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,255,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,203],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[119,128,144],slategrey:[119,128,144],snow:[255,255,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],transparent:[255,255,255,0],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,5]},w=/rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)/,T=[];const _=typeof requestAnimationFrame<"u"&&requestAnimationFrame||function(C){setTimeout(C,60)};t.Util={_isElement(C){return!!(C&&C.nodeType==1)},_isFunction(C){return!!(C&&C.constructor&&C.call&&C.apply)},_isPlainObject(C){return!!C&&C.constructor===Object},_isArray(C){return Object.prototype.toString.call(C)===n},_isNumber(C){return Object.prototype.toString.call(C)===i&&!isNaN(C)&&isFinite(C)},_isString(C){return Object.prototype.toString.call(C)===a},_isBoolean(C){return Object.prototype.toString.call(C)===s},isObject(C){return C instanceof Object},isValidSelector(C){if(typeof C!="string")return!1;const N=C[0];return N==="#"||N==="."||N===N.toUpperCase()},_sign(C){return C===0||C>0?1:-1},requestAnimFrame(C){T.push(C),T.length===1&&_(function(){const N=T;T=[],N.forEach(function(A){A()})})},createCanvasElement(){const C=document.createElement("canvas");try{C.style=C.style||{}}catch{}return C},createImageElement(){return document.createElement("img")},_isInDocument(C){for(;C=C.parentNode;)if(C==document)return!0;return!1},_urlToImage(C,N){const A=t.Util.createImageElement();A.onload=function(){N(A)},A.src=C},_rgbToHex(C,N,A){return((1<<24)+(C<<16)+(N<<8)+A).toString(16).slice(1)},_hexToRgb(C){C=C.replace(u,c);const N=parseInt(C,16);return{r:N>>16&255,g:N>>8&255,b:N&255}},getRandomColor(){let C=(Math.random()*16777215<<0).toString(16);for(;C.length<6;)C=f+C;return u+C},getRGB(C){let N;return C in S?(N=S[C],{r:N[0],g:N[1],b:N[2]}):C[0]===u?this._hexToRgb(C.substring(1)):C.substr(0,4)===y?(N=w.exec(C.replace(/ /g,"")),{r:parseInt(N[1],10),g:parseInt(N[2],10),b:parseInt(N[3],10)}):{r:0,g:0,b:0}},colorToRGBA(C){return C=C||"black",t.Util._namedColorToRBA(C)||t.Util._hex3ColorToRGBA(C)||t.Util._hex4ColorToRGBA(C)||t.Util._hex6ColorToRGBA(C)||t.Util._hex8ColorToRGBA(C)||t.Util._rgbColorToRGBA(C)||t.Util._rgbaColorToRGBA(C)||t.Util._hslColorToRGBA(C)},_namedColorToRBA(C){const N=S[C.toLowerCase()];return N?{r:N[0],g:N[1],b:N[2],a:1}:null},_rgbColorToRGBA(C){if(C.indexOf("rgb(")===0){C=C.match(/rgb\(([^)]+)\)/)[1];const N=C.split(/ *, */).map(Number);return{r:N[0],g:N[1],b:N[2],a:1}}},_rgbaColorToRGBA(C){if(C.indexOf("rgba(")===0){C=C.match(/rgba\(([^)]+)\)/)[1];const N=C.split(/ *, */).map((A,O)=>A.slice(-1)==="%"?O===3?parseInt(A)/100:parseInt(A)/100*255:Number(A));return{r:N[0],g:N[1],b:N[2],a:N[3]}}},_hex8ColorToRGBA(C){if(C[0]==="#"&&C.length===9)return{r:parseInt(C.slice(1,3),16),g:parseInt(C.slice(3,5),16),b:parseInt(C.slice(5,7),16),a:parseInt(C.slice(7,9),16)/255}},_hex6ColorToRGBA(C){if(C[0]==="#"&&C.length===7)return{r:parseInt(C.slice(1,3),16),g:parseInt(C.slice(3,5),16),b:parseInt(C.slice(5,7),16),a:1}},_hex4ColorToRGBA(C){if(C[0]==="#"&&C.length===5)return{r:parseInt(C[1]+C[1],16),g:parseInt(C[2]+C[2],16),b:parseInt(C[3]+C[3],16),a:parseInt(C[4]+C[4],16)/255}},_hex3ColorToRGBA(C){if(C[0]==="#"&&C.length===4)return{r:parseInt(C[1]+C[1],16),g:parseInt(C[2]+C[2],16),b:parseInt(C[3]+C[3],16),a:1}},_hslColorToRGBA(C){if(/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.test(C)){const[N,...A]=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(C),O=Number(A[0])/360,j=Number(A[1])/100,D=Number(A[2])/100;let F,B,$;if(j===0)return $=D*255,{r:Math.round($),g:Math.round($),b:Math.round($),a:1};D<.5?F=D*(1+j):F=D+j-D*j;const Z=2*D-F,I=[0,0,0];for(let q=0;q<3;q++)B=O+1/3*-(q-1),B<0&&B++,B>1&&B--,6*B<1?$=Z+(F-Z)*6*B:2*B<1?$=F:3*B<2?$=Z+(F-Z)*(2/3-B)*6:$=Z,I[q]=$*255;return{r:Math.round(I[0]),g:Math.round(I[1]),b:Math.round(I[2]),a:1}}},haveIntersection(C,N){return!(N.x>C.x+C.width||N.x+N.width<C.x||N.y>C.y+C.height||N.y+N.height<C.y)},cloneObject(C){const N={};for(const A in C)this._isPlainObject(C[A])?N[A]=this.cloneObject(C[A]):this._isArray(C[A])?N[A]=this.cloneArray(C[A]):N[A]=C[A];return N},cloneArray(C){return C.slice(0)},degToRad(C){return C*o},radToDeg(C){return C*l},_degToRad(C){return t.Util.warn("Util._degToRad is removed. Please use public Util.degToRad instead."),t.Util.degToRad(C)},_radToDeg(C){return t.Util.warn("Util._radToDeg is removed. Please use public Util.radToDeg instead."),t.Util.radToDeg(C)},_getRotation(C){return e.Konva.angleDeg?t.Util.radToDeg(C):C},_capitalize(C){return C.charAt(0).toUpperCase()+C.slice(1)},throw(C){throw new Error(v+C)},error(C){console.error(v+C)},warn(C){e.Konva.showWarnings&&console.warn(p+C)},each(C,N){for(const A in C)N(A,C[A])},_inRange(C,N,A){return N<=C&&C<A},_getProjectionToSegment(C,N,A,O,j,D){let F,B,$;const Z=(C-A)*(C-A)+(N-O)*(N-O);if(Z==0)F=C,B=N,$=(j-A)*(j-A)+(D-O)*(D-O);else{const I=((j-C)*(A-C)+(D-N)*(O-N))/Z;I<0?(F=C,B=N,$=(C-j)*(C-j)+(N-D)*(N-D)):I>1?(F=A,B=O,$=(A-j)*(A-j)+(O-D)*(O-D)):(F=C+I*(A-C),B=N+I*(O-N),$=(F-j)*(F-j)+(B-D)*(B-D))}return[F,B,$]},_getProjectionToLine(C,N,A){const O=t.Util.cloneObject(C);let j=Number.MAX_VALUE;return N.forEach(function(D,F){if(!A&&F===N.length-1)return;const B=N[(F+1)%N.length],$=t.Util._getProjectionToSegment(D.x,D.y,B.x,B.y,C.x,C.y),Z=$[0],I=$[1],q=$[2];q<j&&(O.x=Z,O.y=I,j=q)}),O},_prepareArrayForTween(C,N,A){let O,j=[],D=[];if(C.length>N.length){const B=N;N=C,C=B}for(O=0;O<C.length;O+=2)j.push({x:C[O],y:C[O+1]});for(O=0;O<N.length;O+=2)D.push({x:N[O],y:N[O+1]});const F=[];return D.forEach(function(B){const $=t.Util._getProjectionToLine(B,j,A);F.push($.x),F.push($.y)}),F},_prepareToStringify(C){let N;C.visitedByCircularReferenceRemoval=!0;for(const A in C)if(C.hasOwnProperty(A)&&C[A]&&typeof C[A]=="object"){if(N=Object.getOwnPropertyDescriptor(C,A),C[A].visitedByCircularReferenceRemoval||t.Util._isElement(C[A]))if(N.configurable)delete C[A];else return null;else if(t.Util._prepareToStringify(C[A])===null)if(N.configurable)delete C[A];else return null}return delete C.visitedByCircularReferenceRemoval,C},_assign(C,N){for(const A in N)C[A]=N[A];return C},_getFirstPointerId(C){return C.touches?C.changedTouches[0].identifier:C.pointerId||999},releaseCanvas(...C){e.Konva.releaseCanvasOnDestroy&&C.forEach(N=>{N.width=0,N.height=0})},drawRoundedRectPath(C,N,A,O){let j=0,D=0,F=0,B=0;typeof O=="number"?j=D=F=B=Math.min(O,N/2,A/2):(j=Math.min(O[0]||0,N/2,A/2),D=Math.min(O[1]||0,N/2,A/2),B=Math.min(O[2]||0,N/2,A/2),F=Math.min(O[3]||0,N/2,A/2)),C.moveTo(j,0),C.lineTo(N-D,0),C.arc(N-D,D,D,Math.PI*3/2,0,!1),C.lineTo(N,A-B),C.arc(N-B,A-B,B,0,Math.PI/2,!1),C.lineTo(F,A),C.arc(F,A-F,F,Math.PI/2,Math.PI,!1),C.lineTo(0,j),C.arc(j,j,j,Math.PI,Math.PI*3/2,!1)}}})(P2)),P2}var rg={},M2={},Us={},S5;function Tr(){if(S5)return Us;S5=1,Object.defineProperty(Us,"__esModule",{value:!0}),Us.RGBComponent=n,Us.alphaComponent=i,Us.getNumberValidator=a,Us.getNumberOrArrayOfNumbersValidator=s,Us.getNumberOrAutoValidator=o,Us.getStringValidator=l,Us.getStringOrGradientValidator=u,Us.getFunctionValidator=c,Us.getNumberArrayValidator=f,Us.getBooleanValidator=p,Us.getComponentValidator=v;const t=Sr(),e=si();function r(y){return e.Util._isString(y)?'"'+y+'"':Object.prototype.toString.call(y)==="[object Number]"||e.Util._isBoolean(y)?y:Object.prototype.toString.call(y)}function n(y){return y>255?255:y<0?0:Math.round(y)}function i(y){return y>1?1:y<1e-4?1e-4:y}function a(){if(t.Konva.isUnminified)return function(y,S){return e.Util._isNumber(y)||e.Util.warn(r(y)+' is a not valid value for "'+S+'" attribute. The value should be a number.'),y}}function s(y){if(t.Konva.isUnminified)return function(S,w){const T=e.Util._isNumber(S),_=e.Util._isArray(S)&&S.length==y;return!T&&!_&&e.Util.warn(r(S)+' is a not valid value for "'+w+'" attribute. The value should be a number or Array<number>('+y+")"),S}}function o(){if(t.Konva.isUnminified)return function(y,S){return e.Util._isNumber(y)||y==="auto"||e.Util.warn(r(y)+' is a not valid value for "'+S+'" attribute. The value should be a number or "auto".'),y}}function l(){if(t.Konva.isUnminified)return function(y,S){return e.Util._isString(y)||e.Util.warn(r(y)+' is a not valid value for "'+S+'" attribute. The value should be a string.'),y}}function u(){if(t.Konva.isUnminified)return function(y,S){const w=e.Util._isString(y),T=Object.prototype.toString.call(y)==="[object CanvasGradient]"||y&&y.addColorStop;return w||T||e.Util.warn(r(y)+' is a not valid value for "'+S+'" attribute. The value should be a string or a native gradient.'),y}}function c(){if(t.Konva.isUnminified)return function(y,S){return e.Util._isFunction(y)||e.Util.warn(r(y)+' is a not valid value for "'+S+'" attribute. The value should be a function.'),y}}function f(){if(t.Konva.isUnminified)return function(y,S){const w=Int8Array?Object.getPrototypeOf(Int8Array):null;return w&&y instanceof w||(e.Util._isArray(y)?y.forEach(function(T){e.Util._isNumber(T)||e.Util.warn('"'+S+'" attribute has non numeric element '+T+". Make sure that all elements are numbers.")}):e.Util.warn(r(y)+' is a not valid value for "'+S+'" attribute. The value should be a array of numbers.')),y}}function p(){if(t.Konva.isUnminified)return function(y,S){return y===!0||y===!1||e.Util.warn(r(y)+' is a not valid value for "'+S+'" attribute. The value should be a boolean.'),y}}function v(y){if(t.Konva.isUnminified)return function(S,w){return S==null||e.Util.isObject(S)||e.Util.warn(r(S)+' is a not valid value for "'+w+'" attribute. The value should be an object with properties '+y),S}}return Us}var k5;function Cr(){return k5||(k5=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Factory=void 0;const e=si(),r=Tr(),n="get",i="set";t.Factory={addGetterSetter(a,s,o,l,u){t.Factory.addGetter(a,s,o),t.Factory.addSetter(a,s,l,u),t.Factory.addOverloadedGetterSetter(a,s)},addGetter(a,s,o){const l=n+e.Util._capitalize(s);a.prototype[l]=a.prototype[l]||function(){const u=this.attrs[s];return u===void 0?o:u}},addSetter(a,s,o,l){const u=i+e.Util._capitalize(s);a.prototype[u]||t.Factory.overWriteSetter(a,s,o,l)},overWriteSetter(a,s,o,l){const u=i+e.Util._capitalize(s);a.prototype[u]=function(c){return o&&c!==void 0&&c!==null&&(c=o.call(this,c,s)),this._setAttr(s,c),l&&l.call(this),this}},addComponentsGetterSetter(a,s,o,l,u){let c=o.length,f=e.Util._capitalize,p=n+f(s),v=i+f(s),y,S;a.prototype[p]=function(){const T={};for(y=0;y<c;y++)S=o[y],T[S]=this.getAttr(s+f(S));return T};const w=(0,r.getComponentValidator)(o);a.prototype[v]=function(T){let _=this.attrs[s],C;l&&(T=l.call(this,T)),w&&w.call(this,T,s);for(C in T)T.hasOwnProperty(C)&&this._setAttr(s+f(C),T[C]);return T||o.forEach(N=>{this._setAttr(s+f(N),void 0)}),this._fireChangeEvent(s,_,T),u&&u.call(this),this},t.Factory.addOverloadedGetterSetter(a,s)},addOverloadedGetterSetter(a,s){const o=e.Util._capitalize(s),l=i+o,u=n+o;a.prototype[s]=function(){return arguments.length?(this[l](arguments[0]),this):this[u]()}},addDeprecatedGetterSetter(a,s,o,l){e.Util.error("Adding deprecated "+s);const u=n+e.Util._capitalize(s),c=s+" property is deprecated and will be removed soon. Look at Konva change log for more information.";a.prototype[u]=function(){e.Util.error(c);const f=this.attrs[s];return f===void 0?o:f},t.Factory.addSetter(a,s,l,function(){e.Util.error(c)}),t.Factory.addOverloadedGetterSetter(a,s)},backCompat(a,s){e.Util.each(s,function(o,l){const u=a.prototype[l],c=n+e.Util._capitalize(o),f=i+e.Util._capitalize(o);function p(){u.apply(this,arguments),e.Util.error('"'+o+'" method is deprecated and will be removed soon. Use ""'+l+'" instead.')}a.prototype[o]=p,a.prototype[c]=p,a.prototype[f]=p})},afterSetFilter(){this._filterUpToDate=!1}}})(M2)),M2}var ic={},ac={},_5;function FL(){if(_5)return ac;_5=1,Object.defineProperty(ac,"__esModule",{value:!0}),ac.HitContext=ac.SceneContext=ac.Context=void 0;const t=si(),e=Sr();function r(T){let _=[],C=T.length,N=t.Util,A,O;for(A=0;A<C;A++)O=T[A],N._isNumber(O)?O=Math.round(O*1e3)/1e3:N._isString(O)||(O=O+""),_.push(O);return _}const n=",",i="(",a=")",s="([",o="])",l=";",u="()",c="=",f=["arc","arcTo","beginPath","bezierCurveTo","clearRect","clip","closePath","createLinearGradient","createPattern","createRadialGradient","drawImage","ellipse","fill","fillText","getImageData","createImageData","lineTo","moveTo","putImageData","quadraticCurveTo","rect","roundRect","restore","rotate","save","scale","setLineDash","setTransform","stroke","strokeText","transform","translate"],p=["fillStyle","strokeStyle","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","letterSpacing","lineCap","lineDashOffset","lineJoin","lineWidth","miterLimit","direction","font","textAlign","textBaseline","globalAlpha","globalCompositeOperation","imageSmoothingEnabled"],v=100;let y=class{constructor(_){this.canvas=_,e.Konva.enableTrace&&(this.traceArr=[],this._enableTrace())}fillShape(_){_.fillEnabled()&&this._fill(_)}_fill(_){}strokeShape(_){_.hasStroke()&&this._stroke(_)}_stroke(_){}fillStrokeShape(_){_.attrs.fillAfterStrokeEnabled?(this.strokeShape(_),this.fillShape(_)):(this.fillShape(_),this.strokeShape(_))}getTrace(_,C){let N=this.traceArr,A=N.length,O="",j,D,F,B;for(j=0;j<A;j++)D=N[j],F=D.method,F?(B=D.args,O+=F,_?O+=u:t.Util._isArray(B[0])?O+=s+B.join(n)+o:(C&&(B=B.map($=>typeof $=="number"?Math.floor($):$)),O+=i+B.join(n)+a)):(O+=D.property,_||(O+=c+D.val)),O+=l;return O}clearTrace(){this.traceArr=[]}_trace(_){let C=this.traceArr,N;C.push(_),N=C.length,N>=v&&C.shift()}reset(){const _=this.getCanvas().getPixelRatio();this.setTransform(1*_,0,0,1*_,0,0)}getCanvas(){return this.canvas}clear(_){const C=this.getCanvas();_?this.clearRect(_.x||0,_.y||0,_.width||0,_.height||0):this.clearRect(0,0,C.getWidth()/C.pixelRatio,C.getHeight()/C.pixelRatio)}_applyLineCap(_){const C=_.attrs.lineCap;C&&this.setAttr("lineCap",C)}_applyOpacity(_){const C=_.getAbsoluteOpacity();C!==1&&this.setAttr("globalAlpha",C)}_applyLineJoin(_){const C=_.attrs.lineJoin;C&&this.setAttr("lineJoin",C)}setAttr(_,C){this._context[_]=C}arc(_,C,N,A,O,j){this._context.arc(_,C,N,A,O,j)}arcTo(_,C,N,A,O){this._context.arcTo(_,C,N,A,O)}beginPath(){this._context.beginPath()}bezierCurveTo(_,C,N,A,O,j){this._context.bezierCurveTo(_,C,N,A,O,j)}clearRect(_,C,N,A){this._context.clearRect(_,C,N,A)}clip(..._){this._context.clip.apply(this._context,_)}closePath(){this._context.closePath()}createImageData(_,C){const N=arguments;if(N.length===2)return this._context.createImageData(_,C);if(N.length===1)return this._context.createImageData(_)}createLinearGradient(_,C,N,A){return this._context.createLinearGradient(_,C,N,A)}createPattern(_,C){return this._context.createPattern(_,C)}createRadialGradient(_,C,N,A,O,j){return this._context.createRadialGradient(_,C,N,A,O,j)}drawImage(_,C,N,A,O,j,D,F,B){const $=arguments,Z=this._context;$.length===3?Z.drawImage(_,C,N):$.length===5?Z.drawImage(_,C,N,A,O):$.length===9&&Z.drawImage(_,C,N,A,O,j,D,F,B)}ellipse(_,C,N,A,O,j,D,F){this._context.ellipse(_,C,N,A,O,j,D,F)}isPointInPath(_,C,N,A){return N?this._context.isPointInPath(N,_,C,A):this._context.isPointInPath(_,C,A)}fill(..._){this._context.fill.apply(this._context,_)}fillRect(_,C,N,A){this._context.fillRect(_,C,N,A)}strokeRect(_,C,N,A){this._context.strokeRect(_,C,N,A)}fillText(_,C,N,A){A?this._context.fillText(_,C,N,A):this._context.fillText(_,C,N)}measureText(_){return this._context.measureText(_)}getImageData(_,C,N,A){return this._context.getImageData(_,C,N,A)}lineTo(_,C){this._context.lineTo(_,C)}moveTo(_,C){this._context.moveTo(_,C)}rect(_,C,N,A){this._context.rect(_,C,N,A)}roundRect(_,C,N,A,O){this._context.roundRect(_,C,N,A,O)}putImageData(_,C,N){this._context.putImageData(_,C,N)}quadraticCurveTo(_,C,N,A){this._context.quadraticCurveTo(_,C,N,A)}restore(){this._context.restore()}rotate(_){this._context.rotate(_)}save(){this._context.save()}scale(_,C){this._context.scale(_,C)}setLineDash(_){this._context.setLineDash?this._context.setLineDash(_):"mozDash"in this._context?this._context.mozDash=_:"webkitLineDash"in this._context&&(this._context.webkitLineDash=_)}getLineDash(){return this._context.getLineDash()}setTransform(_,C,N,A,O,j){this._context.setTransform(_,C,N,A,O,j)}stroke(_){_?this._context.stroke(_):this._context.stroke()}strokeText(_,C,N,A){this._context.strokeText(_,C,N,A)}transform(_,C,N,A,O,j){this._context.transform(_,C,N,A,O,j)}translate(_,C){this._context.translate(_,C)}_enableTrace(){let _=this,C=f.length,N=this.setAttr,A,O;const j=function(D){let F=_[D],B;_[D]=function(){return O=r(Array.prototype.slice.call(arguments,0)),B=F.apply(_,arguments),_._trace({method:D,args:O}),B}};for(A=0;A<C;A++)j(f[A]);_.setAttr=function(){N.apply(_,arguments);const D=arguments[0];let F=arguments[1];(D==="shadowOffsetX"||D==="shadowOffsetY"||D==="shadowBlur")&&(F=F/this.canvas.getPixelRatio()),_._trace({property:D,val:F})}}_applyGlobalCompositeOperation(_){const C=_.attrs.globalCompositeOperation;!C||C==="source-over"||this.setAttr("globalCompositeOperation",C)}};ac.Context=y,p.forEach(function(T){Object.defineProperty(y.prototype,T,{get(){return this._context[T]},set(_){this._context[T]=_}})});class S extends y{constructor(_,{willReadFrequently:C=!1}={}){super(_),this._context=_._canvas.getContext("2d",{willReadFrequently:C})}_fillColor(_){const C=_.fill();this.setAttr("fillStyle",C),_._fillFunc(this)}_fillPattern(_){this.setAttr("fillStyle",_._getFillPattern()),_._fillFunc(this)}_fillLinearGradient(_){const C=_._getLinearGradient();C&&(this.setAttr("fillStyle",C),_._fillFunc(this))}_fillRadialGradient(_){const C=_._getRadialGradient();C&&(this.setAttr("fillStyle",C),_._fillFunc(this))}_fill(_){const C=_.fill(),N=_.getFillPriority();if(C&&N==="color"){this._fillColor(_);return}const A=_.getFillPatternImage();if(A&&N==="pattern"){this._fillPattern(_);return}const O=_.getFillLinearGradientColorStops();if(O&&N==="linear-gradient"){this._fillLinearGradient(_);return}const j=_.getFillRadialGradientColorStops();if(j&&N==="radial-gradient"){this._fillRadialGradient(_);return}C?this._fillColor(_):A?this._fillPattern(_):O?this._fillLinearGradient(_):j&&this._fillRadialGradient(_)}_strokeLinearGradient(_){const C=_.getStrokeLinearGradientStartPoint(),N=_.getStrokeLinearGradientEndPoint(),A=_.getStrokeLinearGradientColorStops(),O=this.createLinearGradient(C.x,C.y,N.x,N.y);if(A){for(let j=0;j<A.length;j+=2)O.addColorStop(A[j],A[j+1]);this.setAttr("strokeStyle",O)}}_stroke(_){const C=_.dash(),N=_.getStrokeScaleEnabled();if(_.hasStroke()){if(!N){this.save();const O=this.getCanvas().getPixelRatio();this.setTransform(O,0,0,O,0,0)}this._applyLineCap(_),C&&_.dashEnabled()&&(this.setLineDash(C),this.setAttr("lineDashOffset",_.dashOffset())),this.setAttr("lineWidth",_.strokeWidth()),_.getShadowForStrokeEnabled()||this.setAttr("shadowColor","rgba(0,0,0,0)"),_.getStrokeLinearGradientColorStops()?this._strokeLinearGradient(_):this.setAttr("strokeStyle",_.stroke()),_._strokeFunc(this),N||this.restore()}}_applyShadow(_){var C,N,A;const O=(C=_.getShadowRGBA())!==null&&C!==void 0?C:"black",j=(N=_.getShadowBlur())!==null&&N!==void 0?N:5,D=(A=_.getShadowOffset())!==null&&A!==void 0?A:{x:0,y:0},F=_.getAbsoluteScale(),B=this.canvas.getPixelRatio(),$=F.x*B,Z=F.y*B;this.setAttr("shadowColor",O),this.setAttr("shadowBlur",j*Math.min(Math.abs($),Math.abs(Z))),this.setAttr("shadowOffsetX",D.x*$),this.setAttr("shadowOffsetY",D.y*Z)}}ac.SceneContext=S;class w extends y{constructor(_){super(_),this._context=_._canvas.getContext("2d",{willReadFrequently:!0})}_fill(_){this.save(),this.setAttr("fillStyle",_.colorKey),_._fillFuncHit(this),this.restore()}strokeShape(_){_.hasHitStroke()&&this._stroke(_)}_stroke(_){if(_.hasHitStroke()){const C=_.getStrokeScaleEnabled();if(!C){this.save();const O=this.getCanvas().getPixelRatio();this.setTransform(O,0,0,O,0,0)}this._applyLineCap(_);const N=_.hitStrokeWidth(),A=N==="auto"?_.strokeWidth():N;this.setAttr("lineWidth",A),this.setAttr("strokeStyle",_.colorKey),_._strokeFuncHit(this),C||this.restore()}}}return ac.HitContext=w,ac}var C5;function U1(){if(C5)return ic;C5=1,Object.defineProperty(ic,"__esModule",{value:!0}),ic.HitCanvas=ic.SceneCanvas=ic.Canvas=void 0;const t=si(),e=FL(),r=Sr(),n=Cr(),i=Tr();let a;function s(){if(a)return a;const c=t.Util.createCanvasElement(),f=c.getContext("2d");return a=(function(){const p=r.Konva._global.devicePixelRatio||1,v=f.webkitBackingStorePixelRatio||f.mozBackingStorePixelRatio||f.msBackingStorePixelRatio||f.oBackingStorePixelRatio||f.backingStorePixelRatio||1;return p/v})(),t.Util.releaseCanvas(c),a}let o=class{constructor(f){this.pixelRatio=1,this.width=0,this.height=0,this.isCache=!1;const v=(f||{}).pixelRatio||r.Konva.pixelRatio||s();this.pixelRatio=v,this._canvas=t.Util.createCanvasElement(),this._canvas.style.padding="0",this._canvas.style.margin="0",this._canvas.style.border="0",this._canvas.style.background="transparent",this._canvas.style.position="absolute",this._canvas.style.top="0",this._canvas.style.left="0"}getContext(){return this.context}getPixelRatio(){return this.pixelRatio}setPixelRatio(f){const p=this.pixelRatio;this.pixelRatio=f,this.setSize(this.getWidth()/p,this.getHeight()/p)}setWidth(f){this.width=this._canvas.width=f*this.pixelRatio,this._canvas.style.width=f+"px";const p=this.pixelRatio;this.getContext()._context.scale(p,p)}setHeight(f){this.height=this._canvas.height=f*this.pixelRatio,this._canvas.style.height=f+"px";const p=this.pixelRatio;this.getContext()._context.scale(p,p)}getWidth(){return this.width}getHeight(){return this.height}setSize(f,p){this.setWidth(f||0),this.setHeight(p||0)}toDataURL(f,p){try{return this._canvas.toDataURL(f,p)}catch{try{return this._canvas.toDataURL()}catch(y){return t.Util.error("Unable to get data URL. "+y.message+" For more info read https://konvajs.org/docs/posts/Tainted_Canvas.html."),""}}}};ic.Canvas=o,n.Factory.addGetterSetter(o,"pixelRatio",void 0,(0,i.getNumberValidator)());class l extends o{constructor(f={width:0,height:0,willReadFrequently:!1}){super(f),this.context=new e.SceneContext(this,{willReadFrequently:f.willReadFrequently}),this.setSize(f.width,f.height)}}ic.SceneCanvas=l;class u extends o{constructor(f={width:0,height:0}){super(f),this.hitCanvas=!0,this.context=new e.HitContext(this),this.setSize(f.width,f.height)}}return ic.HitCanvas=u,ic}var A2={},E5;function M_(){return E5||(E5=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.DD=void 0;const e=Sr(),r=si();t.DD={get isDragging(){let n=!1;return t.DD._dragElements.forEach(i=>{i.dragStatus==="dragging"&&(n=!0)}),n},justDragged:!1,get node(){let n;return t.DD._dragElements.forEach(i=>{n=i.node}),n},_dragElements:new Map,_drag(n){const i=[];t.DD._dragElements.forEach((a,s)=>{const{node:o}=a,l=o.getStage();l.setPointersPositions(n),a.pointerId===void 0&&(a.pointerId=r.Util._getFirstPointerId(n));const u=l._changedPointerPositions.find(c=>c.id===a.pointerId);if(u){if(a.dragStatus!=="dragging"){const c=o.dragDistance();if(Math.max(Math.abs(u.x-a.startPointerPos.x),Math.abs(u.y-a.startPointerPos.y))<c||(o.startDrag({evt:n}),!o.isDragging()))return}o._setDragPosition(n,a),i.push(o)}}),i.forEach(a=>{a.fire("dragmove",{type:"dragmove",target:a,evt:n},!0)})},_endDragBefore(n){const i=[];t.DD._dragElements.forEach(a=>{const{node:s}=a,o=s.getStage();if(n&&o.setPointersPositions(n),!o._changedPointerPositions.find(c=>c.id===a.pointerId))return;(a.dragStatus==="dragging"||a.dragStatus==="stopped")&&(t.DD.justDragged=!0,e.Konva._mouseListenClick=!1,e.Konva._touchListenClick=!1,e.Konva._pointerListenClick=!1,a.dragStatus="stopped");const u=a.node.getLayer()||a.node instanceof e.Konva.Stage&&a.node;u&&i.indexOf(u)===-1&&i.push(u)}),i.forEach(a=>{a.draw()})},_endDragAfter(n){t.DD._dragElements.forEach((i,a)=>{i.dragStatus==="stopped"&&i.node.fire("dragend",{type:"dragend",target:i.node,evt:n},!0),i.dragStatus!=="dragging"&&t.DD._dragElements.delete(a)})}},e.Konva.isBrowser&&(window.addEventListener("mouseup",t.DD._endDragBefore,!0),window.addEventListener("touchend",t.DD._endDragBefore,!0),window.addEventListener("touchcancel",t.DD._endDragBefore,!0),window.addEventListener("mousemove",t.DD._drag),window.addEventListener("touchmove",t.DD._drag),window.addEventListener("mouseup",t.DD._endDragAfter,!1),window.addEventListener("touchend",t.DD._endDragAfter,!1),window.addEventListener("touchcancel",t.DD._endDragAfter,!1))})(A2)),A2}var T5;function yi(){if(T5)return rg;T5=1,Object.defineProperty(rg,"__esModule",{value:!0}),rg.Node=void 0;const t=si(),e=Cr(),r=U1(),n=Sr(),i=M_(),a=Tr(),s="absoluteOpacity",o="allEventListeners",l="absoluteTransform",u="absoluteScale",c="canvas",f="Change",p="children",v="konva",y="listening",S="mouseenter",w="mouseleave",T="set",_="Shape",C=" ",N="stage",A="transform",O="Stage",j="visible",D=["xChange.konva","yChange.konva","scaleXChange.konva","scaleYChange.konva","skewXChange.konva","skewYChange.konva","rotationChange.konva","offsetXChange.konva","offsetYChange.konva","transformsEnabledChange.konva"].join(C);let F=1;class B{constructor(I){this._id=F++,this.eventListeners={},this.attrs={},this.index=0,this._allEventListeners=null,this.parent=null,this._cache=new Map,this._attachedDepsListeners=new Map,this._lastPos=null,this._batchingTransformChange=!1,this._needClearTransformCache=!1,this._filterUpToDate=!1,this._isUnderCache=!1,this._dragEventId=null,this._shouldFireChangeEvents=!1,this.setAttrs(I),this._shouldFireChangeEvents=!0}hasChildren(){return!1}_clearCache(I){(I===A||I===l)&&this._cache.get(I)?this._cache.get(I).dirty=!0:I?this._cache.delete(I):this._cache.clear()}_getCache(I,q){let U=this._cache.get(I);return(U===void 0||(I===A||I===l)&&U.dirty===!0)&&(U=q.call(this),this._cache.set(I,U)),U}_calculate(I,q,U){if(!this._attachedDepsListeners.get(I)){const W=q.map(Y=>Y+"Change.konva").join(C);this.on(W,()=>{this._clearCache(I)}),this._attachedDepsListeners.set(I,!0)}return this._getCache(I,U)}_getCanvasCache(){return this._cache.get(c)}_clearSelfAndDescendantCache(I){this._clearCache(I),I===l&&this.fire("absoluteTransformChange")}clearCache(){if(this._cache.has(c)){const{scene:I,filter:q,hit:U}=this._cache.get(c);t.Util.releaseCanvas(I,q,U),this._cache.delete(c)}return this._clearSelfAndDescendantCache(),this._requestDraw(),this}cache(I){const q=I||{};let U={};(q.x===void 0||q.y===void 0||q.width===void 0||q.height===void 0)&&(U=this.getClientRect({skipTransform:!0,relativeTo:this.getParent()||void 0}));let W=Math.ceil(q.width||U.width),Y=Math.ceil(q.height||U.height),Q=q.pixelRatio,ne=q.x===void 0?Math.floor(U.x):q.x,re=q.y===void 0?Math.floor(U.y):q.y,H=q.offset||0,te=q.drawBorder||!1,ie=q.hitCanvasPixelRatio||1;if(!W||!Y){t.Util.error("Can not cache the node. Width or height of the node equals 0. Caching is skipped.");return}const de=Math.abs(Math.round(U.x)-ne)>.5?1:0,ge=Math.abs(Math.round(U.y)-re)>.5?1:0;W+=H*2+de,Y+=H*2+ge,ne-=H,re-=H;const ye=new r.SceneCanvas({pixelRatio:Q,width:W,height:Y}),ae=new r.SceneCanvas({pixelRatio:Q,width:0,height:0,willReadFrequently:!0}),pe=new r.HitCanvas({pixelRatio:ie,width:W,height:Y}),le=ye.getContext(),me=pe.getContext();return pe.isCache=!0,ye.isCache=!0,this._cache.delete(c),this._filterUpToDate=!1,q.imageSmoothingEnabled===!1&&(ye.getContext()._context.imageSmoothingEnabled=!1,ae.getContext()._context.imageSmoothingEnabled=!1),le.save(),me.save(),le.translate(-ne,-re),me.translate(-ne,-re),this._isUnderCache=!0,this._clearSelfAndDescendantCache(s),this._clearSelfAndDescendantCache(u),this.drawScene(ye,this),this.drawHit(pe,this),this._isUnderCache=!1,le.restore(),me.restore(),te&&(le.save(),le.beginPath(),le.rect(0,0,W,Y),le.closePath(),le.setAttr("strokeStyle","red"),le.setAttr("lineWidth",5),le.stroke(),le.restore()),this._cache.set(c,{scene:ye,filter:ae,hit:pe,x:ne,y:re}),this._requestDraw(),this}isCached(){return this._cache.has(c)}getClientRect(I){throw new Error('abstract "getClientRect" method call')}_transformedRect(I,q){const U=[{x:I.x,y:I.y},{x:I.x+I.width,y:I.y},{x:I.x+I.width,y:I.y+I.height},{x:I.x,y:I.y+I.height}];let W=1/0,Y=1/0,Q=-1/0,ne=-1/0;const re=this.getAbsoluteTransform(q);return U.forEach(function(H){const te=re.point(H);W===void 0&&(W=Q=te.x,Y=ne=te.y),W=Math.min(W,te.x),Y=Math.min(Y,te.y),Q=Math.max(Q,te.x),ne=Math.max(ne,te.y)}),{x:W,y:Y,width:Q-W,height:ne-Y}}_drawCachedSceneCanvas(I){I.save(),I._applyOpacity(this),I._applyGlobalCompositeOperation(this);const q=this._getCanvasCache();I.translate(q.x,q.y);const U=this._getCachedSceneCanvas(),W=U.pixelRatio;I.drawImage(U._canvas,0,0,U.width/W,U.height/W),I.restore()}_drawCachedHitCanvas(I){const q=this._getCanvasCache(),U=q.hit;I.save(),I.translate(q.x,q.y),I.drawImage(U._canvas,0,0,U.width/U.pixelRatio,U.height/U.pixelRatio),I.restore()}_getCachedSceneCanvas(){let I=this.filters(),q=this._getCanvasCache(),U=q.scene,W=q.filter,Y=W.getContext(),Q,ne,re,H;if(I){if(!this._filterUpToDate){const te=U.pixelRatio;W.setSize(U.width/U.pixelRatio,U.height/U.pixelRatio);try{for(Q=I.length,Y.clear(),Y.drawImage(U._canvas,0,0,U.getWidth()/te,U.getHeight()/te),ne=Y.getImageData(0,0,W.getWidth(),W.getHeight()),re=0;re<Q;re++){if(H=I[re],typeof H!="function"){t.Util.error("Filter should be type of function, but got "+typeof H+" instead. Please check correct filters");continue}H.call(this,ne),Y.putImageData(ne,0,0)}}catch(ie){t.Util.error("Unable to apply filter. "+ie.message+" This post my help you https://konvajs.org/docs/posts/Tainted_Canvas.html.")}this._filterUpToDate=!0}return W}return U}on(I,q){if(this._cache&&this._cache.delete(o),arguments.length===3)return this._delegate.apply(this,arguments);let U=I.split(C),W=U.length,Y,Q,ne,re,H;for(Y=0;Y<W;Y++)Q=U[Y],ne=Q.split("."),re=ne[0],H=ne[1]||"",this.eventListeners[re]||(this.eventListeners[re]=[]),this.eventListeners[re].push({name:H,handler:q});return this}off(I,q){let U=(I||"").split(C),W=U.length,Y,Q,ne,re,H,te;if(this._cache&&this._cache.delete(o),!I)for(Q in this.eventListeners)this._off(Q);for(Y=0;Y<W;Y++)if(ne=U[Y],re=ne.split("."),H=re[0],te=re[1],H)this.eventListeners[H]&&this._off(H,te,q);else for(Q in this.eventListeners)this._off(Q,te,q);return this}dispatchEvent(I){const q={target:this,type:I.type,evt:I};return this.fire(I.type,q),this}addEventListener(I,q){return this.on(I,function(U){q.call(this,U.evt)}),this}removeEventListener(I){return this.off(I),this}_delegate(I,q,U){const W=this;this.on(I,function(Y){const Q=Y.target.findAncestors(q,!0,W);for(let ne=0;ne<Q.length;ne++)Y=t.Util.cloneObject(Y),Y.currentTarget=Q[ne],U.call(Q[ne],Y)})}remove(){return this.isDragging()&&this.stopDrag(),i.DD._dragElements.delete(this._id),this._remove(),this}_clearCaches(){this._clearSelfAndDescendantCache(l),this._clearSelfAndDescendantCache(s),this._clearSelfAndDescendantCache(u),this._clearSelfAndDescendantCache(N),this._clearSelfAndDescendantCache(j),this._clearSelfAndDescendantCache(y)}_remove(){this._clearCaches();const I=this.getParent();I&&I.children&&(I.children.splice(this.index,1),I._setChildrenIndices(),this.parent=null)}destroy(){return this.remove(),this.clearCache(),this}getAttr(I){const q="get"+t.Util._capitalize(I);return t.Util._isFunction(this[q])?this[q]():this.attrs[I]}getAncestors(){let I=this.getParent(),q=[];for(;I;)q.push(I),I=I.getParent();return q}getAttrs(){return this.attrs||{}}setAttrs(I){return this._batchTransformChanges(()=>{let q,U;if(!I)return this;for(q in I)q!==p&&(U=T+t.Util._capitalize(q),t.Util._isFunction(this[U])?this[U](I[q]):this._setAttr(q,I[q]))}),this}isListening(){return this._getCache(y,this._isListening)}_isListening(I){if(!this.listening())return!1;const U=this.getParent();return U&&U!==I&&this!==I?U._isListening(I):!0}isVisible(){return this._getCache(j,this._isVisible)}_isVisible(I){if(!this.visible())return!1;const U=this.getParent();return U&&U!==I&&this!==I?U._isVisible(I):!0}shouldDrawHit(I,q=!1){if(I)return this._isVisible(I)&&this._isListening(I);const U=this.getLayer();let W=!1;i.DD._dragElements.forEach(Q=>{Q.dragStatus==="dragging"&&(Q.node.nodeType==="Stage"||Q.node.getLayer()===U)&&(W=!0)});const Y=!q&&!n.Konva.hitOnDragEnabled&&(W||n.Konva.isTransforming());return this.isListening()&&this.isVisible()&&!Y}show(){return this.visible(!0),this}hide(){return this.visible(!1),this}getZIndex(){return this.index||0}getAbsoluteZIndex(){let I=this.getDepth(),q=this,U=0,W,Y,Q,ne;function re(te){for(W=[],Y=te.length,Q=0;Q<Y;Q++)ne=te[Q],U++,ne.nodeType!==_&&(W=W.concat(ne.getChildren().slice())),ne._id===q._id&&(Q=Y);W.length>0&&W[0].getDepth()<=I&&re(W)}const H=this.getStage();return q.nodeType!==O&&H&&re(H.getChildren()),U}getDepth(){let I=0,q=this.parent;for(;q;)I++,q=q.parent;return I}_batchTransformChanges(I){this._batchingTransformChange=!0,I(),this._batchingTransformChange=!1,this._needClearTransformCache&&(this._clearCache(A),this._clearSelfAndDescendantCache(l)),this._needClearTransformCache=!1}setPosition(I){return this._batchTransformChanges(()=>{this.x(I.x),this.y(I.y)}),this}getPosition(){return{x:this.x(),y:this.y()}}getRelativePointerPosition(){const I=this.getStage();if(!I)return null;const q=I.getPointerPosition();if(!q)return null;const U=this.getAbsoluteTransform().copy();return U.invert(),U.point(q)}getAbsolutePosition(I){let q=!1,U=this.parent;for(;U;){if(U.isCached()){q=!0;break}U=U.parent}q&&!I&&(I=!0);const W=this.getAbsoluteTransform(I).getMatrix(),Y=new t.Transform,Q=this.offset();return Y.m=W.slice(),Y.translate(Q.x,Q.y),Y.getTranslation()}setAbsolutePosition(I){const{x:q,y:U,...W}=this._clearTransform();this.attrs.x=q,this.attrs.y=U,this._clearCache(A);const Y=this._getAbsoluteTransform().copy();return Y.invert(),Y.translate(I.x,I.y),I={x:this.attrs.x+Y.getTranslation().x,y:this.attrs.y+Y.getTranslation().y},this._setTransform(W),this.setPosition({x:I.x,y:I.y}),this._clearCache(A),this._clearSelfAndDescendantCache(l),this}_setTransform(I){let q;for(q in I)this.attrs[q]=I[q]}_clearTransform(){const I={x:this.x(),y:this.y(),rotation:this.rotation(),scaleX:this.scaleX(),scaleY:this.scaleY(),offsetX:this.offsetX(),offsetY:this.offsetY(),skewX:this.skewX(),skewY:this.skewY()};return this.attrs.x=0,this.attrs.y=0,this.attrs.rotation=0,this.attrs.scaleX=1,this.attrs.scaleY=1,this.attrs.offsetX=0,this.attrs.offsetY=0,this.attrs.skewX=0,this.attrs.skewY=0,I}move(I){let q=I.x,U=I.y,W=this.x(),Y=this.y();return q!==void 0&&(W+=q),U!==void 0&&(Y+=U),this.setPosition({x:W,y:Y}),this}_eachAncestorReverse(I,q){let U=[],W=this.getParent(),Y,Q;if(!(q&&q._id===this._id)){for(U.unshift(this);W&&(!q||W._id!==q._id);)U.unshift(W),W=W.parent;for(Y=U.length,Q=0;Q<Y;Q++)I(U[Q])}}rotate(I){return this.rotation(this.rotation()+I),this}moveToTop(){if(!this.parent)return t.Util.warn("Node has no parent. moveToTop function is ignored."),!1;const I=this.index,q=this.parent.getChildren().length;return I<q-1?(this.parent.children.splice(I,1),this.parent.children.push(this),this.parent._setChildrenIndices(),!0):!1}moveUp(){if(!this.parent)return t.Util.warn("Node has no parent. moveUp function is ignored."),!1;const I=this.index,q=this.parent.getChildren().length;return I<q-1?(this.parent.children.splice(I,1),this.parent.children.splice(I+1,0,this),this.parent._setChildrenIndices(),!0):!1}moveDown(){if(!this.parent)return t.Util.warn("Node has no parent. moveDown function is ignored."),!1;const I=this.index;return I>0?(this.parent.children.splice(I,1),this.parent.children.splice(I-1,0,this),this.parent._setChildrenIndices(),!0):!1}moveToBottom(){if(!this.parent)return t.Util.warn("Node has no parent. moveToBottom function is ignored."),!1;const I=this.index;return I>0?(this.parent.children.splice(I,1),this.parent.children.unshift(this),this.parent._setChildrenIndices(),!0):!1}setZIndex(I){if(!this.parent)return t.Util.warn("Node has no parent. zIndex parameter is ignored."),this;(I<0||I>=this.parent.children.length)&&t.Util.warn("Unexpected value "+I+" for zIndex property. zIndex is just index of a node in children of its parent. Expected value is from 0 to "+(this.parent.children.length-1)+".");const q=this.index;return this.parent.children.splice(q,1),this.parent.children.splice(I,0,this),this.parent._setChildrenIndices(),this}getAbsoluteOpacity(){return this._getCache(s,this._getAbsoluteOpacity)}_getAbsoluteOpacity(){let I=this.opacity();const q=this.getParent();return q&&!q._isUnderCache&&(I*=q.getAbsoluteOpacity()),I}moveTo(I){return this.getParent()!==I&&(this._remove(),I.add(this)),this}toObject(){let I=this.getAttrs(),q,U,W,Y,Q;const ne={attrs:{},className:this.getClassName()};for(q in I)U=I[q],Q=t.Util.isObject(U)&&!t.Util._isPlainObject(U)&&!t.Util._isArray(U),!Q&&(W=typeof this[q]=="function"&&this[q],delete I[q],Y=W?W.call(this):null,I[q]=U,Y!==U&&(ne.attrs[q]=U));return t.Util._prepareToStringify(ne)}toJSON(){return JSON.stringify(this.toObject())}getParent(){return this.parent}findAncestors(I,q,U){const W=[];q&&this._isMatch(I)&&W.push(this);let Y=this.parent;for(;Y;){if(Y===U)return W;Y._isMatch(I)&&W.push(Y),Y=Y.parent}return W}isAncestorOf(I){return!1}findAncestor(I,q,U){return this.findAncestors(I,q,U)[0]}_isMatch(I){if(!I)return!1;if(typeof I=="function")return I(this);let q=I.replace(/ /g,"").split(","),U=q.length,W,Y;for(W=0;W<U;W++)if(Y=q[W],t.Util.isValidSelector(Y)||(t.Util.warn('Selector "'+Y+'" is invalid. Allowed selectors examples are "#foo", ".bar" or "Group".'),t.Util.warn('If you have a custom shape with such className, please change it to start with upper letter like "Triangle".'),t.Util.warn("Konva is awesome, right?")),Y.charAt(0)==="#"){if(this.id()===Y.slice(1))return!0}else if(Y.charAt(0)==="."){if(this.hasName(Y.slice(1)))return!0}else if(this.className===Y||this.nodeType===Y)return!0;return!1}getLayer(){const I=this.getParent();return I?I.getLayer():null}getStage(){return this._getCache(N,this._getStage)}_getStage(){const I=this.getParent();return I?I.getStage():null}fire(I,q={},U){return q.target=q.target||this,U?this._fireAndBubble(I,q):this._fire(I,q),this}getAbsoluteTransform(I){return I?this._getAbsoluteTransform(I):this._getCache(l,this._getAbsoluteTransform)}_getAbsoluteTransform(I){let q;if(I)return q=new t.Transform,this._eachAncestorReverse(function(U){const W=U.transformsEnabled();W==="all"?q.multiply(U.getTransform()):W==="position"&&q.translate(U.x()-U.offsetX(),U.y()-U.offsetY())},I),q;{q=this._cache.get(l)||new t.Transform,this.parent?this.parent.getAbsoluteTransform().copyInto(q):q.reset();const U=this.transformsEnabled();if(U==="all")q.multiply(this.getTransform());else if(U==="position"){const W=this.attrs.x||0,Y=this.attrs.y||0,Q=this.attrs.offsetX||0,ne=this.attrs.offsetY||0;q.translate(W-Q,Y-ne)}return q.dirty=!1,q}}getAbsoluteScale(I){let q=this;for(;q;)q._isUnderCache&&(I=q),q=q.getParent();const W=this.getAbsoluteTransform(I).decompose();return{x:W.scaleX,y:W.scaleY}}getAbsoluteRotation(){return this.getAbsoluteTransform().decompose().rotation}getTransform(){return this._getCache(A,this._getTransform)}_getTransform(){var I,q;const U=this._cache.get(A)||new t.Transform;U.reset();const W=this.x(),Y=this.y(),Q=n.Konva.getAngle(this.rotation()),ne=(I=this.attrs.scaleX)!==null&&I!==void 0?I:1,re=(q=this.attrs.scaleY)!==null&&q!==void 0?q:1,H=this.attrs.skewX||0,te=this.attrs.skewY||0,ie=this.attrs.offsetX||0,de=this.attrs.offsetY||0;return(W!==0||Y!==0)&&U.translate(W,Y),Q!==0&&U.rotate(Q),(H!==0||te!==0)&&U.skew(H,te),(ne!==1||re!==1)&&U.scale(ne,re),(ie!==0||de!==0)&&U.translate(-1*ie,-1*de),U.dirty=!1,U}clone(I){let q=t.Util.cloneObject(this.attrs),U,W,Y,Q,ne;for(U in I)q[U]=I[U];const re=new this.constructor(q);for(U in this.eventListeners)for(W=this.eventListeners[U],Y=W.length,Q=0;Q<Y;Q++)ne=W[Q],ne.name.indexOf(v)<0&&(re.eventListeners[U]||(re.eventListeners[U]=[]),re.eventListeners[U].push(ne));return re}_toKonvaCanvas(I){I=I||{};const q=this.getClientRect(),U=this.getStage(),W=I.x!==void 0?I.x:Math.floor(q.x),Y=I.y!==void 0?I.y:Math.floor(q.y),Q=I.pixelRatio||1,ne=new r.SceneCanvas({width:I.width||Math.ceil(q.width)||(U?U.width():0),height:I.height||Math.ceil(q.height)||(U?U.height():0),pixelRatio:Q}),re=ne.getContext(),H=new r.SceneCanvas({width:ne.width/ne.pixelRatio+Math.abs(W),height:ne.height/ne.pixelRatio+Math.abs(Y),pixelRatio:ne.pixelRatio});return I.imageSmoothingEnabled===!1&&(re._context.imageSmoothingEnabled=!1),re.save(),(W||Y)&&re.translate(-1*W,-1*Y),this.drawScene(ne,void 0,H),re.restore(),ne}toCanvas(I){return this._toKonvaCanvas(I)._canvas}toDataURL(I){I=I||{};const q=I.mimeType||null,U=I.quality||null,W=this._toKonvaCanvas(I).toDataURL(q,U);return I.callback&&I.callback(W),W}toImage(I){return new Promise((q,U)=>{try{const W=I?.callback;W&&delete I.callback,t.Util._urlToImage(this.toDataURL(I),function(Y){q(Y),W?.(Y)})}catch(W){U(W)}})}toBlob(I){return new Promise((q,U)=>{try{const W=I?.callback;W&&delete I.callback,this.toCanvas(I).toBlob(Y=>{q(Y),W?.(Y)},I?.mimeType,I?.quality)}catch(W){U(W)}})}setSize(I){return this.width(I.width),this.height(I.height),this}getSize(){return{width:this.width(),height:this.height()}}getClassName(){return this.className||this.nodeType}getType(){return this.nodeType}getDragDistance(){return this.attrs.dragDistance!==void 0?this.attrs.dragDistance:this.parent?this.parent.getDragDistance():n.Konva.dragDistance}_off(I,q,U){let W=this.eventListeners[I],Y,Q,ne;for(Y=0;Y<W.length;Y++)if(Q=W[Y].name,ne=W[Y].handler,(Q!=="konva"||q==="konva")&&(!q||Q===q)&&(!U||U===ne)){if(W.splice(Y,1),W.length===0){delete this.eventListeners[I];break}Y--}}_fireChangeEvent(I,q,U){this._fire(I+f,{oldVal:q,newVal:U})}addName(I){if(!this.hasName(I)){const q=this.name(),U=q?q+" "+I:I;this.name(U)}return this}hasName(I){if(!I)return!1;const q=this.name();return q?(q||"").split(/\s/g).indexOf(I)!==-1:!1}removeName(I){const q=(this.name()||"").split(/\s/g),U=q.indexOf(I);return U!==-1&&(q.splice(U,1),this.name(q.join(" "))),this}setAttr(I,q){const U=this[T+t.Util._capitalize(I)];return t.Util._isFunction(U)?U.call(this,q):this._setAttr(I,q),this}_requestDraw(){if(n.Konva.autoDrawEnabled){const I=this.getLayer()||this.getStage();I?.batchDraw()}}_setAttr(I,q){const U=this.attrs[I];U===q&&!t.Util.isObject(q)||(q==null?delete this.attrs[I]:this.attrs[I]=q,this._shouldFireChangeEvents&&this._fireChangeEvent(I,U,q),this._requestDraw())}_setComponentAttr(I,q,U){let W;U!==void 0&&(W=this.attrs[I],W||(this.attrs[I]=this.getAttr(I)),this.attrs[I][q]=U,this._fireChangeEvent(I,W,U))}_fireAndBubble(I,q,U){if(q&&this.nodeType===_&&(q.target=this),!((I===S||I===w)&&(U&&(this===U||this.isAncestorOf&&this.isAncestorOf(U))||this.nodeType==="Stage"&&!U))){this._fire(I,q);const Y=(I===S||I===w)&&U&&U.isAncestorOf&&U.isAncestorOf(this)&&!U.isAncestorOf(this.parent);(q&&!q.cancelBubble||!q)&&this.parent&&this.parent.isListening()&&!Y&&(U&&U.parent?this._fireAndBubble.call(this.parent,I,q,U):this._fireAndBubble.call(this.parent,I,q))}}_getProtoListeners(I){var q,U,W;const Y=(q=this._cache.get(o))!==null&&q!==void 0?q:{};let Q=Y?.[I];if(Q===void 0){Q=[];let ne=Object.getPrototypeOf(this);for(;ne;){const re=(W=(U=ne.eventListeners)===null||U===void 0?void 0:U[I])!==null&&W!==void 0?W:[];Q.push(...re),ne=Object.getPrototypeOf(ne)}Y[I]=Q,this._cache.set(o,Y)}return Q}_fire(I,q){q=q||{},q.currentTarget=this,q.type=I;const U=this._getProtoListeners(I);if(U)for(var W=0;W<U.length;W++)U[W].handler.call(this,q);const Y=this.eventListeners[I];if(Y)for(var W=0;W<Y.length;W++)Y[W].handler.call(this,q)}draw(){return this.drawScene(),this.drawHit(),this}_createDragElement(I){const q=I?I.pointerId:void 0,U=this.getStage(),W=this.getAbsolutePosition();if(!U)return;const Y=U._getPointerById(q)||U._changedPointerPositions[0]||W;i.DD._dragElements.set(this._id,{node:this,startPointerPos:Y,offset:{x:Y.x-W.x,y:Y.y-W.y},dragStatus:"ready",pointerId:q})}startDrag(I,q=!0){i.DD._dragElements.has(this._id)||this._createDragElement(I);const U=i.DD._dragElements.get(this._id);U.dragStatus="dragging",this.fire("dragstart",{type:"dragstart",target:this,evt:I&&I.evt},q)}_setDragPosition(I,q){const U=this.getStage()._getPointerById(q.pointerId);if(!U)return;let W={x:U.x-q.offset.x,y:U.y-q.offset.y};const Y=this.dragBoundFunc();if(Y!==void 0){const Q=Y.call(this,W,I);Q?W=Q:t.Util.warn("dragBoundFunc did not return any value. That is unexpected behavior. You must return new absolute position from dragBoundFunc.")}(!this._lastPos||this._lastPos.x!==W.x||this._lastPos.y!==W.y)&&(this.setAbsolutePosition(W),this._requestDraw()),this._lastPos=W}stopDrag(I){const q=i.DD._dragElements.get(this._id);q&&(q.dragStatus="stopped"),i.DD._endDragBefore(I),i.DD._endDragAfter(I)}setDraggable(I){this._setAttr("draggable",I),this._dragChange()}isDragging(){const I=i.DD._dragElements.get(this._id);return I?I.dragStatus==="dragging":!1}_listenDrag(){this._dragCleanup(),this.on("mousedown.konva touchstart.konva",function(I){if(!(!(I.evt.button!==void 0)||n.Konva.dragButtons.indexOf(I.evt.button)>=0)||this.isDragging())return;let W=!1;i.DD._dragElements.forEach(Y=>{this.isAncestorOf(Y.node)&&(W=!0)}),W||this._createDragElement(I)})}_dragChange(){if(this.attrs.draggable)this._listenDrag();else{if(this._dragCleanup(),!this.getStage())return;const q=i.DD._dragElements.get(this._id),U=q&&q.dragStatus==="dragging",W=q&&q.dragStatus==="ready";U?this.stopDrag():W&&i.DD._dragElements.delete(this._id)}}_dragCleanup(){this.off("mousedown.konva"),this.off("touchstart.konva")}isClientRectOnScreen(I={x:0,y:0}){const q=this.getStage();if(!q)return!1;const U={x:-I.x,y:-I.y,width:q.width()+2*I.x,height:q.height()+2*I.y};return t.Util.haveIntersection(U,this.getClientRect())}static create(I,q){return t.Util._isString(I)&&(I=JSON.parse(I)),this._createNode(I,q)}static _createNode(I,q){let U=B.prototype.getClassName.call(I),W=I.children,Y,Q,ne;q&&(I.attrs.container=q),n.Konva[U]||(t.Util.warn('Can not find a node with class name "'+U+'". Fallback to "Shape".'),U="Shape");const re=n.Konva[U];if(Y=new re(I.attrs),W)for(Q=W.length,ne=0;ne<Q;ne++)Y.add(B._createNode(W[ne]));return Y}}rg.Node=B,B.prototype.nodeType="Node",B.prototype._attrsAffectingSize=[],B.prototype.eventListeners={},B.prototype.on.call(B.prototype,D,function(){if(this._batchingTransformChange){this._needClearTransformCache=!0;return}this._clearCache(A),this._clearSelfAndDescendantCache(l)}),B.prototype.on.call(B.prototype,"visibleChange.konva",function(){this._clearSelfAndDescendantCache(j)}),B.prototype.on.call(B.prototype,"listeningChange.konva",function(){this._clearSelfAndDescendantCache(y)}),B.prototype.on.call(B.prototype,"opacityChange.konva",function(){this._clearSelfAndDescendantCache(s)});const $=e.Factory.addGetterSetter;return $(B,"zIndex"),$(B,"absolutePosition"),$(B,"position"),$(B,"x",0,(0,a.getNumberValidator)()),$(B,"y",0,(0,a.getNumberValidator)()),$(B,"globalCompositeOperation","source-over",(0,a.getStringValidator)()),$(B,"opacity",1,(0,a.getNumberValidator)()),$(B,"name","",(0,a.getStringValidator)()),$(B,"id","",(0,a.getStringValidator)()),$(B,"rotation",0,(0,a.getNumberValidator)()),e.Factory.addComponentsGetterSetter(B,"scale",["x","y"]),$(B,"scaleX",1,(0,a.getNumberValidator)()),$(B,"scaleY",1,(0,a.getNumberValidator)()),e.Factory.addComponentsGetterSetter(B,"skew",["x","y"]),$(B,"skewX",0,(0,a.getNumberValidator)()),$(B,"skewY",0,(0,a.getNumberValidator)()),e.Factory.addComponentsGetterSetter(B,"offset",["x","y"]),$(B,"offsetX",0,(0,a.getNumberValidator)()),$(B,"offsetY",0,(0,a.getNumberValidator)()),$(B,"dragDistance",null,(0,a.getNumberValidator)()),$(B,"width",0,(0,a.getNumberValidator)()),$(B,"height",0,(0,a.getNumberValidator)()),$(B,"listening",!0,(0,a.getBooleanValidator)()),$(B,"preventDefault",!0,(0,a.getBooleanValidator)()),$(B,"filters",null,function(Z){return this._filterUpToDate=!1,Z}),$(B,"visible",!0,(0,a.getBooleanValidator)()),$(B,"transformsEnabled","all",(0,a.getStringValidator)()),$(B,"size"),$(B,"dragBoundFunc"),$(B,"draggable",!1,(0,a.getBooleanValidator)()),e.Factory.backCompat(B,{rotateDeg:"rotate",setRotationDeg:"setRotation",getRotationDeg:"getRotation"}),rg}var ng={},N5;function G1(){if(N5)return ng;N5=1,Object.defineProperty(ng,"__esModule",{value:!0}),ng.Container=void 0;const t=Cr(),e=yi(),r=Tr();let n=class extends e.Node{constructor(){super(...arguments),this.children=[]}getChildren(a){if(!a)return this.children||[];const s=this.children||[],o=[];return s.forEach(function(l){a(l)&&o.push(l)}),o}hasChildren(){return this.getChildren().length>0}removeChildren(){return this.getChildren().forEach(a=>{a.parent=null,a.index=0,a.remove()}),this.children=[],this._requestDraw(),this}destroyChildren(){return this.getChildren().forEach(a=>{a.parent=null,a.index=0,a.destroy()}),this.children=[],this._requestDraw(),this}add(...a){if(a.length===0)return this;if(a.length>1){for(let o=0;o<a.length;o++)this.add(a[o]);return this}const s=a[0];return s.getParent()?(s.moveTo(this),this):(this._validateAdd(s),s.index=this.getChildren().length,s.parent=this,s._clearCaches(),this.getChildren().push(s),this._fire("add",{child:s}),this._requestDraw(),this)}destroy(){return this.hasChildren()&&this.destroyChildren(),super.destroy(),this}find(a){return this._generalFind(a,!1)}findOne(a){const s=this._generalFind(a,!0);return s.length>0?s[0]:void 0}_generalFind(a,s){const o=[];return this._descendants(l=>{const u=l._isMatch(a);return u&&o.push(l),!!(u&&s)}),o}_descendants(a){let s=!1;const o=this.getChildren();for(const l of o){if(s=a(l),s)return!0;if(l.hasChildren()&&(s=l._descendants(a),s))return!0}return!1}toObject(){const a=e.Node.prototype.toObject.call(this);return a.children=[],this.getChildren().forEach(s=>{a.children.push(s.toObject())}),a}isAncestorOf(a){let s=a.getParent();for(;s;){if(s._id===this._id)return!0;s=s.getParent()}return!1}clone(a){const s=e.Node.prototype.clone.call(this,a);return this.getChildren().forEach(function(o){s.add(o.clone())}),s}getAllIntersections(a){const s=[];return this.find("Shape").forEach(o=>{o.isVisible()&&o.intersects(a)&&s.push(o)}),s}_clearSelfAndDescendantCache(a){var s;super._clearSelfAndDescendantCache(a),!this.isCached()&&((s=this.children)===null||s===void 0||s.forEach(function(o){o._clearSelfAndDescendantCache(a)}))}_setChildrenIndices(){var a;(a=this.children)===null||a===void 0||a.forEach(function(s,o){s.index=o}),this._requestDraw()}drawScene(a,s,o){const l=this.getLayer(),u=a||l&&l.getCanvas(),c=u&&u.getContext(),f=this._getCanvasCache(),p=f&&f.scene,v=u&&u.isCache;if(!this.isVisible()&&!v)return this;if(p){c.save();const y=this.getAbsoluteTransform(s).getMatrix();c.transform(y[0],y[1],y[2],y[3],y[4],y[5]),this._drawCachedSceneCanvas(c),c.restore()}else this._drawChildren("drawScene",u,s,o);return this}drawHit(a,s){if(!this.shouldDrawHit(s))return this;const o=this.getLayer(),l=a||o&&o.hitCanvas,u=l&&l.getContext(),c=this._getCanvasCache();if(c&&c.hit){u.save();const p=this.getAbsoluteTransform(s).getMatrix();u.transform(p[0],p[1],p[2],p[3],p[4],p[5]),this._drawCachedHitCanvas(u),u.restore()}else this._drawChildren("drawHit",l,s);return this}_drawChildren(a,s,o,l){var u;const c=s&&s.getContext(),f=this.clipWidth(),p=this.clipHeight(),v=this.clipFunc(),y=typeof f=="number"&&typeof p=="number"||v,S=o===this;if(y){c.save();const T=this.getAbsoluteTransform(o);let _=T.getMatrix();c.transform(_[0],_[1],_[2],_[3],_[4],_[5]),c.beginPath();let C;if(v)C=v.call(this,c,this);else{const N=this.clipX(),A=this.clipY();c.rect(N||0,A||0,f,p)}c.clip.apply(c,C),_=T.copy().invert().getMatrix(),c.transform(_[0],_[1],_[2],_[3],_[4],_[5])}const w=!S&&this.globalCompositeOperation()!=="source-over"&&a==="drawScene";w&&(c.save(),c._applyGlobalCompositeOperation(this)),(u=this.children)===null||u===void 0||u.forEach(function(T){T[a](s,o,l)}),w&&c.restore(),y&&c.restore()}getClientRect(a={}){var s;const o=a.skipTransform,l=a.relativeTo;let u,c,f,p,v={x:1/0,y:1/0,width:0,height:0};const y=this;(s=this.children)===null||s===void 0||s.forEach(function(T){if(!T.visible())return;const _=T.getClientRect({relativeTo:y,skipShadow:a.skipShadow,skipStroke:a.skipStroke});_.width===0&&_.height===0||(u===void 0?(u=_.x,c=_.y,f=_.x+_.width,p=_.y+_.height):(u=Math.min(u,_.x),c=Math.min(c,_.y),f=Math.max(f,_.x+_.width),p=Math.max(p,_.y+_.height)))});const S=this.find("Shape");let w=!1;for(let T=0;T<S.length;T++)if(S[T]._isVisible(this)){w=!0;break}return w&&u!==void 0?v={x:u,y:c,width:f-u,height:p-c}:v={x:0,y:0,width:0,height:0},o?v:this._transformedRect(v,l)}};return ng.Container=n,t.Factory.addComponentsGetterSetter(n,"clip",["x","y","width","height"]),t.Factory.addGetterSetter(n,"clipX",void 0,(0,r.getNumberValidator)()),t.Factory.addGetterSetter(n,"clipY",void 0,(0,r.getNumberValidator)()),t.Factory.addGetterSetter(n,"clipWidth",void 0,(0,r.getNumberValidator)()),t.Factory.addGetterSetter(n,"clipHeight",void 0,(0,r.getNumberValidator)()),t.Factory.addGetterSetter(n,"clipFunc"),ng}var L2={},wd={},P5;function BL(){if(P5)return wd;P5=1,Object.defineProperty(wd,"__esModule",{value:!0}),wd.getCapturedShape=n,wd.createEvent=i,wd.hasPointerCapture=a,wd.setPointerCapture=s,wd.releaseCapture=o;const t=Sr(),e=new Map,r=t.Konva._global.PointerEvent!==void 0;function n(l){return e.get(l)}function i(l){return{evt:l,pointerId:l.pointerId}}function a(l,u){return e.get(l)===u}function s(l,u){o(l),u.getStage()&&(e.set(l,u),r&&u._fire("gotpointercapture",i(new PointerEvent("gotpointercapture"))))}function o(l,u){const c=e.get(l);if(!c)return;const f=c.getStage();f&&f.content,e.delete(l),r&&c._fire("lostpointercapture",i(new PointerEvent("lostpointercapture")))}return wd}var M5;function QG(){return M5||(M5=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Stage=t.stages=void 0;const e=si(),r=Cr(),n=G1(),i=Sr(),a=U1(),s=M_(),o=Sr(),l=BL(),u="Stage",c="string",f="px",p="mouseout",v="mouseleave",y="mouseover",S="mouseenter",w="mousemove",T="mousedown",_="mouseup",C="pointermove",N="pointerdown",A="pointerup",O="pointercancel",j="lostpointercapture",D="pointerout",F="pointerleave",B="pointerover",$="pointerenter",Z="contextmenu",I="touchstart",q="touchend",U="touchmove",W="touchcancel",Y="wheel",Q=5,ne=[[S,"_pointerenter"],[T,"_pointerdown"],[w,"_pointermove"],[_,"_pointerup"],[v,"_pointerleave"],[I,"_pointerdown"],[U,"_pointermove"],[q,"_pointerup"],[W,"_pointercancel"],[y,"_pointerover"],[Y,"_wheel"],[Z,"_contextmenu"],[N,"_pointerdown"],[C,"_pointermove"],[A,"_pointerup"],[O,"_pointercancel"],[j,"_lostpointercapture"]],re={mouse:{[D]:p,[F]:v,[B]:y,[$]:S,[C]:w,[N]:T,[A]:_,[O]:"mousecancel",pointerclick:"click",pointerdblclick:"dblclick"},touch:{[D]:"touchout",[F]:"touchleave",[B]:"touchover",[$]:"touchenter",[C]:U,[N]:I,[A]:q,[O]:W,pointerclick:"tap",pointerdblclick:"dbltap"},pointer:{[D]:D,[F]:F,[B]:B,[$]:$,[C]:C,[N]:N,[A]:A,[O]:O,pointerclick:"pointerclick",pointerdblclick:"pointerdblclick"}},H=ye=>ye.indexOf("pointer")>=0?"pointer":ye.indexOf("touch")>=0?"touch":"mouse",te=ye=>{const ae=H(ye);if(ae==="pointer")return i.Konva.pointerEventsEnabled&&re.pointer;if(ae==="touch")return re.touch;if(ae==="mouse")return re.mouse};function ie(ye={}){return(ye.clipFunc||ye.clipWidth||ye.clipHeight)&&e.Util.warn("Stage does not support clipping. Please use clip for Layers or Groups."),ye}const de="Pointer position is missing and not registered by the stage. Looks like it is outside of the stage container. You can set it manually from event: stage.setPointersPositions(event);";t.stages=[];class ge extends n.Container{constructor(ae){super(ie(ae)),this._pointerPositions=[],this._changedPointerPositions=[],this._buildDOM(),this._bindContentEvents(),t.stages.push(this),this.on("widthChange.konva heightChange.konva",this._resizeDOM),this.on("visibleChange.konva",this._checkVisibility),this.on("clipWidthChange.konva clipHeightChange.konva clipFuncChange.konva",()=>{ie(this.attrs)}),this._checkVisibility()}_validateAdd(ae){const pe=ae.getType()==="Layer",le=ae.getType()==="FastLayer";pe||le||e.Util.throw("You may only add layers to the stage.")}_checkVisibility(){if(!this.content)return;const ae=this.visible()?"":"none";this.content.style.display=ae}setContainer(ae){if(typeof ae===c){if(ae.charAt(0)==="."){const le=ae.slice(1);ae=document.getElementsByClassName(le)[0]}else{var pe;ae.charAt(0)!=="#"?pe=ae:pe=ae.slice(1),ae=document.getElementById(pe)}if(!ae)throw"Can not find container in document with id "+pe}return this._setAttr("container",ae),this.content&&(this.content.parentElement&&this.content.parentElement.removeChild(this.content),ae.appendChild(this.content)),this}shouldDrawHit(){return!0}clear(){let ae=this.children,pe=ae.length,le;for(le=0;le<pe;le++)ae[le].clear();return this}clone(ae){return ae||(ae={}),ae.container=typeof document<"u"&&document.createElement("div"),n.Container.prototype.clone.call(this,ae)}destroy(){super.destroy();const ae=this.content;ae&&e.Util._isInDocument(ae)&&this.container().removeChild(ae);const pe=t.stages.indexOf(this);return pe>-1&&t.stages.splice(pe,1),e.Util.releaseCanvas(this.bufferCanvas._canvas,this.bufferHitCanvas._canvas),this}getPointerPosition(){const ae=this._pointerPositions[0]||this._changedPointerPositions[0];return ae?{x:ae.x,y:ae.y}:(e.Util.warn(de),null)}_getPointerById(ae){return this._pointerPositions.find(pe=>pe.id===ae)}getPointersPositions(){return this._pointerPositions}getStage(){return this}getContent(){return this.content}_toKonvaCanvas(ae){ae=ae||{},ae.x=ae.x||0,ae.y=ae.y||0,ae.width=ae.width||this.width(),ae.height=ae.height||this.height();const pe=new a.SceneCanvas({width:ae.width,height:ae.height,pixelRatio:ae.pixelRatio||1}),le=pe.getContext()._context,me=this.children;return(ae.x||ae.y)&&le.translate(-1*ae.x,-1*ae.y),me.forEach(function(he){if(!he.isVisible())return;const xe=he._toKonvaCanvas(ae);le.drawImage(xe._canvas,ae.x,ae.y,xe.getWidth()/xe.getPixelRatio(),xe.getHeight()/xe.getPixelRatio())}),pe}getIntersection(ae){if(!ae)return null;let pe=this.children,le=pe.length,me=le-1,he;for(he=me;he>=0;he--){const xe=pe[he].getIntersection(ae);if(xe)return xe}return null}_resizeDOM(){const ae=this.width(),pe=this.height();this.content&&(this.content.style.width=ae+f,this.content.style.height=pe+f),this.bufferCanvas.setSize(ae,pe),this.bufferHitCanvas.setSize(ae,pe),this.children.forEach(le=>{le.setSize({width:ae,height:pe}),le.draw()})}add(ae,...pe){if(arguments.length>1){for(let me=0;me<arguments.length;me++)this.add(arguments[me]);return this}super.add(ae);const le=this.children.length;return le>Q&&e.Util.warn("The stage has "+le+" layers. Recommended maximum number of layers is 3-5. Adding more layers into the stage may drop the performance. Rethink your tree structure, you can use Konva.Group."),ae.setSize({width:this.width(),height:this.height()}),ae.draw(),i.Konva.isBrowser&&this.content.appendChild(ae.canvas._canvas),this}getParent(){return null}getLayer(){return null}hasPointerCapture(ae){return l.hasPointerCapture(ae,this)}setPointerCapture(ae){l.setPointerCapture(ae,this)}releaseCapture(ae){l.releaseCapture(ae,this)}getLayers(){return this.children}_bindContentEvents(){i.Konva.isBrowser&&ne.forEach(([ae,pe])=>{this.content.addEventListener(ae,le=>{this[pe](le)},{passive:!1})})}_pointerenter(ae){this.setPointersPositions(ae);const pe=te(ae.type);pe&&this._fire(pe.pointerenter,{evt:ae,target:this,currentTarget:this})}_pointerover(ae){this.setPointersPositions(ae);const pe=te(ae.type);pe&&this._fire(pe.pointerover,{evt:ae,target:this,currentTarget:this})}_getTargetShape(ae){let pe=this[ae+"targetShape"];return pe&&!pe.getStage()&&(pe=null),pe}_pointerleave(ae){const pe=te(ae.type),le=H(ae.type);if(!pe)return;this.setPointersPositions(ae);const me=this._getTargetShape(le),he=!(i.Konva.isDragging()||i.Konva.isTransforming())||i.Konva.hitOnDragEnabled;me&&he?(me._fireAndBubble(pe.pointerout,{evt:ae}),me._fireAndBubble(pe.pointerleave,{evt:ae}),this._fire(pe.pointerleave,{evt:ae,target:this,currentTarget:this}),this[le+"targetShape"]=null):he&&(this._fire(pe.pointerleave,{evt:ae,target:this,currentTarget:this}),this._fire(pe.pointerout,{evt:ae,target:this,currentTarget:this})),this.pointerPos=null,this._pointerPositions=[]}_pointerdown(ae){const pe=te(ae.type),le=H(ae.type);if(!pe)return;this.setPointersPositions(ae);let me=!1;this._changedPointerPositions.forEach(he=>{const xe=this.getIntersection(he);if(s.DD.justDragged=!1,i.Konva["_"+le+"ListenClick"]=!0,!xe||!xe.isListening()){this[le+"ClickStartShape"]=void 0;return}i.Konva.capturePointerEventsEnabled&&xe.setPointerCapture(he.id),this[le+"ClickStartShape"]=xe,xe._fireAndBubble(pe.pointerdown,{evt:ae,pointerId:he.id}),me=!0;const we=ae.type.indexOf("touch")>=0;xe.preventDefault()&&ae.cancelable&&we&&ae.preventDefault()}),me||this._fire(pe.pointerdown,{evt:ae,target:this,currentTarget:this,pointerId:this._pointerPositions[0].id})}_pointermove(ae){const pe=te(ae.type),le=H(ae.type);if(!pe||(i.Konva.isDragging()&&s.DD.node.preventDefault()&&ae.cancelable&&ae.preventDefault(),this.setPointersPositions(ae),!(!(i.Konva.isDragging()||i.Konva.isTransforming())||i.Konva.hitOnDragEnabled)))return;const he={};let xe=!1;const we=this._getTargetShape(le);this._changedPointerPositions.forEach(Ge=>{const qe=l.getCapturedShape(Ge.id)||this.getIntersection(Ge),wt=Ge.id,et={evt:ae,pointerId:wt},at=we!==qe;if(at&&we&&(we._fireAndBubble(pe.pointerout,{...et},qe),we._fireAndBubble(pe.pointerleave,{...et},qe)),qe){if(he[qe._id])return;he[qe._id]=!0}qe&&qe.isListening()?(xe=!0,at&&(qe._fireAndBubble(pe.pointerover,{...et},we),qe._fireAndBubble(pe.pointerenter,{...et},we),this[le+"targetShape"]=qe),qe._fireAndBubble(pe.pointermove,{...et})):we&&(this._fire(pe.pointerover,{evt:ae,target:this,currentTarget:this,pointerId:wt}),this[le+"targetShape"]=null)}),xe||this._fire(pe.pointermove,{evt:ae,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id})}_pointerup(ae){const pe=te(ae.type),le=H(ae.type);if(!pe)return;this.setPointersPositions(ae);const me=this[le+"ClickStartShape"],he=this[le+"ClickEndShape"],xe={};let we=!1;this._changedPointerPositions.forEach(Ge=>{const qe=l.getCapturedShape(Ge.id)||this.getIntersection(Ge);if(qe){if(qe.releaseCapture(Ge.id),xe[qe._id])return;xe[qe._id]=!0}const wt=Ge.id,et={evt:ae,pointerId:wt};let at=!1;i.Konva["_"+le+"InDblClickWindow"]?(at=!0,clearTimeout(this[le+"DblTimeout"])):s.DD.justDragged||(i.Konva["_"+le+"InDblClickWindow"]=!0,clearTimeout(this[le+"DblTimeout"])),this[le+"DblTimeout"]=setTimeout(function(){i.Konva["_"+le+"InDblClickWindow"]=!1},i.Konva.dblClickWindow),qe&&qe.isListening()?(we=!0,this[le+"ClickEndShape"]=qe,qe._fireAndBubble(pe.pointerup,{...et}),i.Konva["_"+le+"ListenClick"]&&me&&me===qe&&(qe._fireAndBubble(pe.pointerclick,{...et}),at&&he&&he===qe&&qe._fireAndBubble(pe.pointerdblclick,{...et}))):(this[le+"ClickEndShape"]=null,i.Konva["_"+le+"ListenClick"]&&this._fire(pe.pointerclick,{evt:ae,target:this,currentTarget:this,pointerId:wt}),at&&this._fire(pe.pointerdblclick,{evt:ae,target:this,currentTarget:this,pointerId:wt}))}),we||this._fire(pe.pointerup,{evt:ae,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id}),i.Konva["_"+le+"ListenClick"]=!1,ae.cancelable&&le!=="touch"&&ae.preventDefault()}_contextmenu(ae){this.setPointersPositions(ae);const pe=this.getIntersection(this.getPointerPosition());pe&&pe.isListening()?pe._fireAndBubble(Z,{evt:ae}):this._fire(Z,{evt:ae,target:this,currentTarget:this})}_wheel(ae){this.setPointersPositions(ae);const pe=this.getIntersection(this.getPointerPosition());pe&&pe.isListening()?pe._fireAndBubble(Y,{evt:ae}):this._fire(Y,{evt:ae,target:this,currentTarget:this})}_pointercancel(ae){this.setPointersPositions(ae);const pe=l.getCapturedShape(ae.pointerId)||this.getIntersection(this.getPointerPosition());pe&&pe._fireAndBubble(A,l.createEvent(ae)),l.releaseCapture(ae.pointerId)}_lostpointercapture(ae){l.releaseCapture(ae.pointerId)}setPointersPositions(ae){let pe=this._getContentPosition(),le=null,me=null;ae=ae||window.event,ae.touches!==void 0?(this._pointerPositions=[],this._changedPointerPositions=[],Array.prototype.forEach.call(ae.touches,he=>{this._pointerPositions.push({id:he.identifier,x:(he.clientX-pe.left)/pe.scaleX,y:(he.clientY-pe.top)/pe.scaleY})}),Array.prototype.forEach.call(ae.changedTouches||ae.touches,he=>{this._changedPointerPositions.push({id:he.identifier,x:(he.clientX-pe.left)/pe.scaleX,y:(he.clientY-pe.top)/pe.scaleY})})):(le=(ae.clientX-pe.left)/pe.scaleX,me=(ae.clientY-pe.top)/pe.scaleY,this.pointerPos={x:le,y:me},this._pointerPositions=[{x:le,y:me,id:e.Util._getFirstPointerId(ae)}],this._changedPointerPositions=[{x:le,y:me,id:e.Util._getFirstPointerId(ae)}])}_setPointerPosition(ae){e.Util.warn('Method _setPointerPosition is deprecated. Use "stage.setPointersPositions(event)" instead.'),this.setPointersPositions(ae)}_getContentPosition(){if(!this.content||!this.content.getBoundingClientRect)return{top:0,left:0,scaleX:1,scaleY:1};const ae=this.content.getBoundingClientRect();return{top:ae.top,left:ae.left,scaleX:ae.width/this.content.clientWidth||1,scaleY:ae.height/this.content.clientHeight||1}}_buildDOM(){if(this.bufferCanvas=new a.SceneCanvas({width:this.width(),height:this.height()}),this.bufferHitCanvas=new a.HitCanvas({pixelRatio:1,width:this.width(),height:this.height()}),!i.Konva.isBrowser)return;const ae=this.container();if(!ae)throw"Stage has no container. A container is required.";ae.innerHTML="",this.content=document.createElement("div"),this.content.style.position="relative",this.content.style.userSelect="none",this.content.className="konvajs-content",this.content.setAttribute("role","presentation"),ae.appendChild(this.content),this._resizeDOM()}cache(){return e.Util.warn("Cache function is not allowed for stage. You may use cache only for layers, groups and shapes."),this}clearCache(){return this}batchDraw(){return this.getChildren().forEach(function(ae){ae.batchDraw()}),this}}t.Stage=ge,ge.prototype.nodeType=u,(0,o._registerNode)(ge),r.Factory.addGetterSetter(ge,"container"),i.Konva.isBrowser&&document.addEventListener("visibilitychange",()=>{t.stages.forEach(ye=>{ye.batchDraw()})})})(L2)),L2}var ig={},R2={},A5;function pa(){return A5||(A5=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Shape=t.shapes=void 0;const e=Sr(),r=si(),n=Cr(),i=yi(),a=Tr(),s=Sr(),o=BL(),l="hasShadow",u="shadowRGBA",c="patternImage",f="linearGradient",p="radialGradient";let v;function y(){return v||(v=r.Util.createCanvasElement().getContext("2d"),v)}t.shapes={};function S(F){const B=this.attrs.fillRule;B?F.fill(B):F.fill()}function w(F){F.stroke()}function T(F){const B=this.attrs.fillRule;B?F.fill(B):F.fill()}function _(F){F.stroke()}function C(){this._clearCache(l)}function N(){this._clearCache(u)}function A(){this._clearCache(c)}function O(){this._clearCache(f)}function j(){this._clearCache(p)}class D extends i.Node{constructor(B){super(B);let $;for(;$=r.Util.getRandomColor(),!($&&!($ in t.shapes)););this.colorKey=$,t.shapes[$]=this}getContext(){return r.Util.warn("shape.getContext() method is deprecated. Please do not use it."),this.getLayer().getContext()}getCanvas(){return r.Util.warn("shape.getCanvas() method is deprecated. Please do not use it."),this.getLayer().getCanvas()}getSceneFunc(){return this.attrs.sceneFunc||this._sceneFunc}getHitFunc(){return this.attrs.hitFunc||this._hitFunc}hasShadow(){return this._getCache(l,this._hasShadow)}_hasShadow(){return this.shadowEnabled()&&this.shadowOpacity()!==0&&!!(this.shadowColor()||this.shadowBlur()||this.shadowOffsetX()||this.shadowOffsetY())}_getFillPattern(){return this._getCache(c,this.__getFillPattern)}__getFillPattern(){if(this.fillPatternImage()){const $=y().createPattern(this.fillPatternImage(),this.fillPatternRepeat()||"repeat");if($&&$.setTransform){const Z=new r.Transform;Z.translate(this.fillPatternX(),this.fillPatternY()),Z.rotate(e.Konva.getAngle(this.fillPatternRotation())),Z.scale(this.fillPatternScaleX(),this.fillPatternScaleY()),Z.translate(-1*this.fillPatternOffsetX(),-1*this.fillPatternOffsetY());const I=Z.getMatrix(),q=typeof DOMMatrix>"u"?{a:I[0],b:I[1],c:I[2],d:I[3],e:I[4],f:I[5]}:new DOMMatrix(I);$.setTransform(q)}return $}}_getLinearGradient(){return this._getCache(f,this.__getLinearGradient)}__getLinearGradient(){const B=this.fillLinearGradientColorStops();if(B){const $=y(),Z=this.fillLinearGradientStartPoint(),I=this.fillLinearGradientEndPoint(),q=$.createLinearGradient(Z.x,Z.y,I.x,I.y);for(let U=0;U<B.length;U+=2)q.addColorStop(B[U],B[U+1]);return q}}_getRadialGradient(){return this._getCache(p,this.__getRadialGradient)}__getRadialGradient(){const B=this.fillRadialGradientColorStops();if(B){const $=y(),Z=this.fillRadialGradientStartPoint(),I=this.fillRadialGradientEndPoint(),q=$.createRadialGradient(Z.x,Z.y,this.fillRadialGradientStartRadius(),I.x,I.y,this.fillRadialGradientEndRadius());for(let U=0;U<B.length;U+=2)q.addColorStop(B[U],B[U+1]);return q}}getShadowRGBA(){return this._getCache(u,this._getShadowRGBA)}_getShadowRGBA(){if(!this.hasShadow())return;const B=r.Util.colorToRGBA(this.shadowColor());if(B)return"rgba("+B.r+","+B.g+","+B.b+","+B.a*(this.shadowOpacity()||1)+")"}hasFill(){return this._calculate("hasFill",["fillEnabled","fill","fillPatternImage","fillLinearGradientColorStops","fillRadialGradientColorStops"],()=>this.fillEnabled()&&!!(this.fill()||this.fillPatternImage()||this.fillLinearGradientColorStops()||this.fillRadialGradientColorStops()))}hasStroke(){return this._calculate("hasStroke",["strokeEnabled","strokeWidth","stroke","strokeLinearGradientColorStops"],()=>this.strokeEnabled()&&this.strokeWidth()&&!!(this.stroke()||this.strokeLinearGradientColorStops()))}hasHitStroke(){const B=this.hitStrokeWidth();return B==="auto"?this.hasStroke():this.strokeEnabled()&&!!B}intersects(B){const $=this.getStage();if(!$)return!1;const Z=$.bufferHitCanvas;return Z.getContext().clear(),this.drawHit(Z,void 0,!0),Z.context.getImageData(Math.round(B.x),Math.round(B.y),1,1).data[3]>0}destroy(){return i.Node.prototype.destroy.call(this),delete t.shapes[this.colorKey],delete this.colorKey,this}_useBufferCanvas(B){var $;if(!(($=this.attrs.perfectDrawEnabled)!==null&&$!==void 0?$:!0))return!1;const I=B||this.hasFill(),q=this.hasStroke(),U=this.getAbsoluteOpacity()!==1;if(I&&q&&U)return!0;const W=this.hasShadow(),Y=this.shadowForStrokeEnabled();return!!(I&&q&&W&&Y)}setStrokeHitEnabled(B){r.Util.warn("strokeHitEnabled property is deprecated. Please use hitStrokeWidth instead."),B?this.hitStrokeWidth("auto"):this.hitStrokeWidth(0)}getStrokeHitEnabled(){return this.hitStrokeWidth()!==0}getSelfRect(){const B=this.size();return{x:this._centroid?-B.width/2:0,y:this._centroid?-B.height/2:0,width:B.width,height:B.height}}getClientRect(B={}){let $=!1,Z=this.getParent();for(;Z;){if(Z.isCached()){$=!0;break}Z=Z.getParent()}const I=B.skipTransform,q=B.relativeTo||$&&this.getStage()||void 0,U=this.getSelfRect(),Y=!B.skipStroke&&this.hasStroke()&&this.strokeWidth()||0,Q=U.width+Y,ne=U.height+Y,re=!B.skipShadow&&this.hasShadow(),H=re?this.shadowOffsetX():0,te=re?this.shadowOffsetY():0,ie=Q+Math.abs(H),de=ne+Math.abs(te),ge=re&&this.shadowBlur()||0,ye=ie+ge*2,ae=de+ge*2,pe={width:ye,height:ae,x:-(Y/2+ge)+Math.min(H,0)+U.x,y:-(Y/2+ge)+Math.min(te,0)+U.y};return I?pe:this._transformedRect(pe,q)}drawScene(B,$,Z){const I=this.getLayer();let q=B||I.getCanvas(),U=q.getContext(),W=this._getCanvasCache(),Y=this.getSceneFunc(),Q=this.hasShadow(),ne,re;const H=q.isCache,te=$===this;if(!this.isVisible()&&!te)return this;if(W){U.save();const de=this.getAbsoluteTransform($).getMatrix();return U.transform(de[0],de[1],de[2],de[3],de[4],de[5]),this._drawCachedSceneCanvas(U),U.restore(),this}if(!Y)return this;if(U.save(),this._useBufferCanvas()&&!H){ne=this.getStage();const de=Z||ne.bufferCanvas;re=de.getContext(),re.clear(),re.save(),re._applyLineJoin(this);var ie=this.getAbsoluteTransform($).getMatrix();re.transform(ie[0],ie[1],ie[2],ie[3],ie[4],ie[5]),Y.call(this,re,this),re.restore();const ge=de.pixelRatio;Q&&U._applyShadow(this),U._applyOpacity(this),U._applyGlobalCompositeOperation(this),U.drawImage(de._canvas,0,0,de.width/ge,de.height/ge)}else{if(U._applyLineJoin(this),!te){var ie=this.getAbsoluteTransform($).getMatrix();U.transform(ie[0],ie[1],ie[2],ie[3],ie[4],ie[5]),U._applyOpacity(this),U._applyGlobalCompositeOperation(this)}Q&&U._applyShadow(this),Y.call(this,U,this)}return U.restore(),this}drawHit(B,$,Z=!1){if(!this.shouldDrawHit($,Z))return this;const I=this.getLayer(),q=B||I.hitCanvas,U=q&&q.getContext(),W=this.hitFunc()||this.sceneFunc(),Y=this._getCanvasCache(),Q=Y&&Y.hit;if(this.colorKey||r.Util.warn("Looks like your canvas has a destroyed shape in it. Do not reuse shape after you destroyed it. If you want to reuse shape you should call remove() instead of destroy()"),Q){U.save();const re=this.getAbsoluteTransform($).getMatrix();return U.transform(re[0],re[1],re[2],re[3],re[4],re[5]),this._drawCachedHitCanvas(U),U.restore(),this}if(!W)return this;if(U.save(),U._applyLineJoin(this),!(this===$)){const re=this.getAbsoluteTransform($).getMatrix();U.transform(re[0],re[1],re[2],re[3],re[4],re[5])}return W.call(this,U,this),U.restore(),this}drawHitFromCache(B=0){let $=this._getCanvasCache(),Z=this._getCachedSceneCanvas(),I=$.hit,q=I.getContext(),U=I.getWidth(),W=I.getHeight(),Y,Q,ne,re,H,te;q.clear(),q.drawImage(Z._canvas,0,0,U,W);try{for(Y=q.getImageData(0,0,U,W),Q=Y.data,ne=Q.length,re=r.Util._hexToRgb(this.colorKey),H=0;H<ne;H+=4)te=Q[H+3],te>B?(Q[H]=re.r,Q[H+1]=re.g,Q[H+2]=re.b,Q[H+3]=255):Q[H+3]=0;q.putImageData(Y,0,0)}catch(ie){r.Util.error("Unable to draw hit graph from cached scene canvas. "+ie.message)}return this}hasPointerCapture(B){return o.hasPointerCapture(B,this)}setPointerCapture(B){o.setPointerCapture(B,this)}releaseCapture(B){o.releaseCapture(B,this)}}t.Shape=D,D.prototype._fillFunc=S,D.prototype._strokeFunc=w,D.prototype._fillFuncHit=T,D.prototype._strokeFuncHit=_,D.prototype._centroid=!1,D.prototype.nodeType="Shape",(0,s._registerNode)(D),D.prototype.eventListeners={},D.prototype.on.call(D.prototype,"shadowColorChange.konva shadowBlurChange.konva shadowOffsetChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",C),D.prototype.on.call(D.prototype,"shadowColorChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",N),D.prototype.on.call(D.prototype,"fillPriorityChange.konva fillPatternImageChange.konva fillPatternRepeatChange.konva fillPatternScaleXChange.konva fillPatternScaleYChange.konva fillPatternOffsetXChange.konva fillPatternOffsetYChange.konva fillPatternXChange.konva fillPatternYChange.konva fillPatternRotationChange.konva",A),D.prototype.on.call(D.prototype,"fillPriorityChange.konva fillLinearGradientColorStopsChange.konva fillLinearGradientStartPointXChange.konva fillLinearGradientStartPointYChange.konva fillLinearGradientEndPointXChange.konva fillLinearGradientEndPointYChange.konva",O),D.prototype.on.call(D.prototype,"fillPriorityChange.konva fillRadialGradientColorStopsChange.konva fillRadialGradientStartPointXChange.konva fillRadialGradientStartPointYChange.konva fillRadialGradientEndPointXChange.konva fillRadialGradientEndPointYChange.konva fillRadialGradientStartRadiusChange.konva fillRadialGradientEndRadiusChange.konva",j),n.Factory.addGetterSetter(D,"stroke",void 0,(0,a.getStringOrGradientValidator)()),n.Factory.addGetterSetter(D,"strokeWidth",2,(0,a.getNumberValidator)()),n.Factory.addGetterSetter(D,"fillAfterStrokeEnabled",!1),n.Factory.addGetterSetter(D,"hitStrokeWidth","auto",(0,a.getNumberOrAutoValidator)()),n.Factory.addGetterSetter(D,"strokeHitEnabled",!0,(0,a.getBooleanValidator)()),n.Factory.addGetterSetter(D,"perfectDrawEnabled",!0,(0,a.getBooleanValidator)()),n.Factory.addGetterSetter(D,"shadowForStrokeEnabled",!0,(0,a.getBooleanValidator)()),n.Factory.addGetterSetter(D,"lineJoin"),n.Factory.addGetterSetter(D,"lineCap"),n.Factory.addGetterSetter(D,"sceneFunc"),n.Factory.addGetterSetter(D,"hitFunc"),n.Factory.addGetterSetter(D,"dash"),n.Factory.addGetterSetter(D,"dashOffset",0,(0,a.getNumberValidator)()),n.Factory.addGetterSetter(D,"shadowColor",void 0,(0,a.getStringValidator)()),n.Factory.addGetterSetter(D,"shadowBlur",0,(0,a.getNumberValidator)()),n.Factory.addGetterSetter(D,"shadowOpacity",1,(0,a.getNumberValidator)()),n.Factory.addComponentsGetterSetter(D,"shadowOffset",["x","y"]),n.Factory.addGetterSetter(D,"shadowOffsetX",0,(0,a.getNumberValidator)()),n.Factory.addGetterSetter(D,"shadowOffsetY",0,(0,a.getNumberValidator)()),n.Factory.addGetterSetter(D,"fillPatternImage"),n.Factory.addGetterSetter(D,"fill",void 0,(0,a.getStringOrGradientValidator)()),n.Factory.addGetterSetter(D,"fillPatternX",0,(0,a.getNumberValidator)()),n.Factory.addGetterSetter(D,"fillPatternY",0,(0,a.getNumberValidator)()),n.Factory.addGetterSetter(D,"fillLinearGradientColorStops"),n.Factory.addGetterSetter(D,"strokeLinearGradientColorStops"),n.Factory.addGetterSetter(D,"fillRadialGradientStartRadius",0),n.Factory.addGetterSetter(D,"fillRadialGradientEndRadius",0),n.Factory.addGetterSetter(D,"fillRadialGradientColorStops"),n.Factory.addGetterSetter(D,"fillPatternRepeat","repeat"),n.Factory.addGetterSetter(D,"fillEnabled",!0),n.Factory.addGetterSetter(D,"strokeEnabled",!0),n.Factory.addGetterSetter(D,"shadowEnabled",!0),n.Factory.addGetterSetter(D,"dashEnabled",!0),n.Factory.addGetterSetter(D,"strokeScaleEnabled",!0),n.Factory.addGetterSetter(D,"fillPriority","color"),n.Factory.addComponentsGetterSetter(D,"fillPatternOffset",["x","y"]),n.Factory.addGetterSetter(D,"fillPatternOffsetX",0,(0,a.getNumberValidator)()),n.Factory.addGetterSetter(D,"fillPatternOffsetY",0,(0,a.getNumberValidator)()),n.Factory.addComponentsGetterSetter(D,"fillPatternScale",["x","y"]),n.Factory.addGetterSetter(D,"fillPatternScaleX",1,(0,a.getNumberValidator)()),n.Factory.addGetterSetter(D,"fillPatternScaleY",1,(0,a.getNumberValidator)()),n.Factory.addComponentsGetterSetter(D,"fillLinearGradientStartPoint",["x","y"]),n.Factory.addComponentsGetterSetter(D,"strokeLinearGradientStartPoint",["x","y"]),n.Factory.addGetterSetter(D,"fillLinearGradientStartPointX",0),n.Factory.addGetterSetter(D,"strokeLinearGradientStartPointX",0),n.Factory.addGetterSetter(D,"fillLinearGradientStartPointY",0),n.Factory.addGetterSetter(D,"strokeLinearGradientStartPointY",0),n.Factory.addComponentsGetterSetter(D,"fillLinearGradientEndPoint",["x","y"]),n.Factory.addComponentsGetterSetter(D,"strokeLinearGradientEndPoint",["x","y"]),n.Factory.addGetterSetter(D,"fillLinearGradientEndPointX",0),n.Factory.addGetterSetter(D,"strokeLinearGradientEndPointX",0),n.Factory.addGetterSetter(D,"fillLinearGradientEndPointY",0),n.Factory.addGetterSetter(D,"strokeLinearGradientEndPointY",0),n.Factory.addComponentsGetterSetter(D,"fillRadialGradientStartPoint",["x","y"]),n.Factory.addGetterSetter(D,"fillRadialGradientStartPointX",0),n.Factory.addGetterSetter(D,"fillRadialGradientStartPointY",0),n.Factory.addComponentsGetterSetter(D,"fillRadialGradientEndPoint",["x","y"]),n.Factory.addGetterSetter(D,"fillRadialGradientEndPointX",0),n.Factory.addGetterSetter(D,"fillRadialGradientEndPointY",0),n.Factory.addGetterSetter(D,"fillPatternRotation",0),n.Factory.addGetterSetter(D,"fillRule",void 0,(0,a.getStringValidator)()),n.Factory.backCompat(D,{dashArray:"dash",getDashArray:"getDash",setDashArray:"getDash",drawFunc:"sceneFunc",getDrawFunc:"getSceneFunc",setDrawFunc:"setSceneFunc",drawHitFunc:"hitFunc",getDrawHitFunc:"getHitFunc",setDrawHitFunc:"setHitFunc"})})(R2)),R2}var L5;function zL(){if(L5)return ig;L5=1,Object.defineProperty(ig,"__esModule",{value:!0}),ig.Layer=void 0;const t=si(),e=G1(),r=yi(),n=Cr(),i=U1(),a=Tr(),s=pa(),o=Sr(),l="#",u="beforeDraw",c="draw",f=[{x:0,y:0},{x:-1,y:-1},{x:1,y:-1},{x:1,y:1},{x:-1,y:1}],p=f.length;class v extends e.Container{constructor(S){super(S),this.canvas=new i.SceneCanvas,this.hitCanvas=new i.HitCanvas({pixelRatio:1}),this._waitingForDraw=!1,this.on("visibleChange.konva",this._checkVisibility),this._checkVisibility(),this.on("imageSmoothingEnabledChange.konva",this._setSmoothEnabled),this._setSmoothEnabled()}createPNGStream(){return this.canvas._canvas.createPNGStream()}getCanvas(){return this.canvas}getNativeCanvasElement(){return this.canvas._canvas}getHitCanvas(){return this.hitCanvas}getContext(){return this.getCanvas().getContext()}clear(S){return this.getContext().clear(S),this.getHitCanvas().getContext().clear(S),this}setZIndex(S){super.setZIndex(S);const w=this.getStage();return w&&w.content&&(w.content.removeChild(this.getNativeCanvasElement()),S<w.children.length-1?w.content.insertBefore(this.getNativeCanvasElement(),w.children[S+1].getCanvas()._canvas):w.content.appendChild(this.getNativeCanvasElement())),this}moveToTop(){r.Node.prototype.moveToTop.call(this);const S=this.getStage();return S&&S.content&&(S.content.removeChild(this.getNativeCanvasElement()),S.content.appendChild(this.getNativeCanvasElement())),!0}moveUp(){if(!r.Node.prototype.moveUp.call(this))return!1;const w=this.getStage();return!w||!w.content?!1:(w.content.removeChild(this.getNativeCanvasElement()),this.index<w.children.length-1?w.content.insertBefore(this.getNativeCanvasElement(),w.children[this.index+1].getCanvas()._canvas):w.content.appendChild(this.getNativeCanvasElement()),!0)}moveDown(){if(r.Node.prototype.moveDown.call(this)){const S=this.getStage();if(S){const w=S.children;S.content&&(S.content.removeChild(this.getNativeCanvasElement()),S.content.insertBefore(this.getNativeCanvasElement(),w[this.index+1].getCanvas()._canvas))}return!0}return!1}moveToBottom(){if(r.Node.prototype.moveToBottom.call(this)){const S=this.getStage();if(S){const w=S.children;S.content&&(S.content.removeChild(this.getNativeCanvasElement()),S.content.insertBefore(this.getNativeCanvasElement(),w[1].getCanvas()._canvas))}return!0}return!1}getLayer(){return this}remove(){const S=this.getNativeCanvasElement();return r.Node.prototype.remove.call(this),S&&S.parentNode&&t.Util._isInDocument(S)&&S.parentNode.removeChild(S),this}getStage(){return this.parent}setSize({width:S,height:w}){return this.canvas.setSize(S,w),this.hitCanvas.setSize(S,w),this._setSmoothEnabled(),this}_validateAdd(S){const w=S.getType();w!=="Group"&&w!=="Shape"&&t.Util.throw("You may only add groups and shapes to a layer.")}_toKonvaCanvas(S){return S=S||{},S.width=S.width||this.getWidth(),S.height=S.height||this.getHeight(),S.x=S.x!==void 0?S.x:this.x(),S.y=S.y!==void 0?S.y:this.y(),r.Node.prototype._toKonvaCanvas.call(this,S)}_checkVisibility(){this.visible()?this.canvas._canvas.style.display="block":this.canvas._canvas.style.display="none"}_setSmoothEnabled(){this.getContext()._context.imageSmoothingEnabled=this.imageSmoothingEnabled()}getWidth(){if(this.parent)return this.parent.width()}setWidth(){t.Util.warn('Can not change width of layer. Use "stage.width(value)" function instead.')}getHeight(){if(this.parent)return this.parent.height()}setHeight(){t.Util.warn('Can not change height of layer. Use "stage.height(value)" function instead.')}batchDraw(){return this._waitingForDraw||(this._waitingForDraw=!0,t.Util.requestAnimFrame(()=>{this.draw(),this._waitingForDraw=!1})),this}getIntersection(S){if(!this.isListening()||!this.isVisible())return null;let w=1,T=!1;for(;;){for(let _=0;_<p;_++){const C=f[_],N=this._getIntersection({x:S.x+C.x*w,y:S.y+C.y*w}),A=N.shape;if(A)return A;if(T=!!N.antialiased,!N.antialiased)break}if(T)w+=1;else return null}}_getIntersection(S){const w=this.hitCanvas.pixelRatio,T=this.hitCanvas.context.getImageData(Math.round(S.x*w),Math.round(S.y*w),1,1).data,_=T[3];if(_===255){const C=t.Util._rgbToHex(T[0],T[1],T[2]),N=s.shapes[l+C];return N?{shape:N}:{antialiased:!0}}else if(_>0)return{antialiased:!0};return{}}drawScene(S,w){const T=this.getLayer(),_=S||T&&T.getCanvas();return this._fire(u,{node:this}),this.clearBeforeDraw()&&_.getContext().clear(),e.Container.prototype.drawScene.call(this,_,w),this._fire(c,{node:this}),this}drawHit(S,w){const T=this.getLayer(),_=S||T&&T.hitCanvas;return T&&T.clearBeforeDraw()&&T.getHitCanvas().getContext().clear(),e.Container.prototype.drawHit.call(this,_,w),this}enableHitGraph(){return this.hitGraphEnabled(!0),this}disableHitGraph(){return this.hitGraphEnabled(!1),this}setHitGraphEnabled(S){t.Util.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening(S)}getHitGraphEnabled(S){return t.Util.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening()}toggleHitCanvas(){if(!this.parent||!this.parent.content)return;const S=this.parent;!!this.hitCanvas._canvas.parentNode?S.content.removeChild(this.hitCanvas._canvas):S.content.appendChild(this.hitCanvas._canvas)}destroy(){return t.Util.releaseCanvas(this.getNativeCanvasElement(),this.getHitCanvas()._canvas),super.destroy()}}return ig.Layer=v,v.prototype.nodeType="Layer",(0,o._registerNode)(v),n.Factory.addGetterSetter(v,"imageSmoothingEnabled",!0),n.Factory.addGetterSetter(v,"clearBeforeDraw",!0),n.Factory.addGetterSetter(v,"hitGraphEnabled",!0,(0,a.getBooleanValidator)()),ig}var ag={},R5;function JG(){if(R5)return ag;R5=1,Object.defineProperty(ag,"__esModule",{value:!0}),ag.FastLayer=void 0;const t=si(),e=zL(),r=Sr();let n=class extends e.Layer{constructor(a){super(a),this.listening(!1),t.Util.warn('Konva.Fast layer is deprecated. Please use "new Konva.Layer({ listening: false })" instead.')}};return ag.FastLayer=n,n.prototype.nodeType="FastLayer",(0,r._registerNode)(n),ag}var sg={},O5;function A_(){if(O5)return sg;O5=1,Object.defineProperty(sg,"__esModule",{value:!0}),sg.Group=void 0;const t=si(),e=G1(),r=Sr();let n=class extends e.Container{_validateAdd(a){const s=a.getType();s!=="Group"&&s!=="Shape"&&t.Util.throw("You may only add groups and shapes to groups.")}};return sg.Group=n,n.prototype.nodeType="Group",(0,r._registerNode)(n),sg}var og={},D5;function L_(){if(D5)return og;D5=1,Object.defineProperty(og,"__esModule",{value:!0}),og.Animation=void 0;const t=Sr(),e=si(),r=(function(){return t.glob.performance&&t.glob.performance.now?function(){return t.glob.performance.now()}:function(){return new Date().getTime()}})();let n=class Pp{constructor(a,s){this.id=Pp.animIdCounter++,this.frame={time:0,timeDiff:0,lastTime:r(),frameRate:0},this.func=a,this.setLayers(s)}setLayers(a){let s=[];return a&&(s=Array.isArray(a)?a:[a]),this.layers=s,this}getLayers(){return this.layers}addLayer(a){const s=this.layers,o=s.length;for(let l=0;l<o;l++)if(s[l]._id===a._id)return!1;return this.layers.push(a),!0}isRunning(){const s=Pp.animations,o=s.length;for(let l=0;l<o;l++)if(s[l].id===this.id)return!0;return!1}start(){return this.stop(),this.frame.timeDiff=0,this.frame.lastTime=r(),Pp._addAnimation(this),this}stop(){return Pp._removeAnimation(this),this}_updateFrameObject(a){this.frame.timeDiff=a-this.frame.lastTime,this.frame.lastTime=a,this.frame.time+=this.frame.timeDiff,this.frame.frameRate=1e3/this.frame.timeDiff}static _addAnimation(a){this.animations.push(a),this._handleAnimation()}static _removeAnimation(a){const s=a.id,o=this.animations,l=o.length;for(let u=0;u<l;u++)if(o[u].id===s){this.animations.splice(u,1);break}}static _runFrames(){const a={},s=this.animations;for(let o=0;o<s.length;o++){const l=s[o],u=l.layers,c=l.func;l._updateFrameObject(r());const f=u.length;let p;if(c?p=c.call(l,l.frame)!==!1:p=!0,!!p)for(let v=0;v<f;v++){const y=u[v];y._id!==void 0&&(a[y._id]=y)}}for(const o in a)a.hasOwnProperty(o)&&a[o].batchDraw()}static _animationLoop(){const a=Pp;a.animations.length?(a._runFrames(),e.Util.requestAnimFrame(a._animationLoop)):a.animRunning=!1}static _handleAnimation(){this.animRunning||(this.animRunning=!0,e.Util.requestAnimFrame(this._animationLoop))}};return og.Animation=n,n.animations=[],n.animIdCounter=0,n.animRunning=!1,og}var O2={},I5;function eV(){return I5||(I5=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Easings=t.Tween=void 0;const e=si(),r=L_(),n=yi(),i=Sr();let a={node:1,duration:1,easing:1,onFinish:1,yoyo:1},s=1,o=2,l=3,u=0,c=["fill","stroke","shadowColor"];class f{constructor(y,S,w,T,_,C,N){this.prop=y,this.propFunc=S,this.begin=T,this._pos=T,this.duration=C,this._change=0,this.prevPos=0,this.yoyo=N,this._time=0,this._position=0,this._startTime=0,this._finish=0,this.func=w,this._change=_-this.begin,this.pause()}fire(y){const S=this[y];S&&S()}setTime(y){y>this.duration?this.yoyo?(this._time=this.duration,this.reverse()):this.finish():y<0?this.yoyo?(this._time=0,this.play()):this.reset():(this._time=y,this.update())}getTime(){return this._time}setPosition(y){this.prevPos=this._pos,this.propFunc(y),this._pos=y}getPosition(y){return y===void 0&&(y=this._time),this.func(y,this.begin,this._change,this.duration)}play(){this.state=o,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onPlay")}reverse(){this.state=l,this._time=this.duration-this._time,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onReverse")}seek(y){this.pause(),this._time=y,this.update(),this.fire("onSeek")}reset(){this.pause(),this._time=0,this.update(),this.fire("onReset")}finish(){this.pause(),this._time=this.duration,this.update(),this.fire("onFinish")}update(){this.setPosition(this.getPosition(this._time)),this.fire("onUpdate")}onEnterFrame(){const y=this.getTimer()-this._startTime;this.state===o?this.setTime(y):this.state===l&&this.setTime(this.duration-y)}pause(){this.state=s,this.fire("onPause")}getTimer(){return new Date().getTime()}}class p{constructor(y){let S=this,w=y.node,T=w._id,_,C=y.easing||t.Easings.Linear,N=!!y.yoyo,A;typeof y.duration>"u"?_=.3:y.duration===0?_=.001:_=y.duration,this.node=w,this._id=u++;const O=w.getLayer()||(w instanceof i.Konva.Stage?w.getLayers():null);O||e.Util.error("Tween constructor have `node` that is not in a layer. Please add node into layer first."),this.anim=new r.Animation(function(){S.tween.onEnterFrame()},O),this.tween=new f(A,function(j){S._tweenFunc(j)},C,0,1,_*1e3,N),this._addListeners(),p.attrs[T]||(p.attrs[T]={}),p.attrs[T][this._id]||(p.attrs[T][this._id]={}),p.tweens[T]||(p.tweens[T]={});for(A in y)a[A]===void 0&&this._addAttr(A,y[A]);this.reset(),this.onFinish=y.onFinish,this.onReset=y.onReset,this.onUpdate=y.onUpdate}_addAttr(y,S){let w=this.node,T=w._id,_,C,N,A,O,j,D,F;if(N=p.tweens[T][y],N&&delete p.attrs[T][N][y],_=w.getAttr(y),e.Util._isArray(S))if(C=[],O=Math.max(S.length,_.length),y==="points"&&S.length!==_.length&&(S.length>_.length?(D=_,_=e.Util._prepareArrayForTween(_,S,w.closed())):(j=S,S=e.Util._prepareArrayForTween(S,_,w.closed()))),y.indexOf("fill")===0)for(A=0;A<O;A++)if(A%2===0)C.push(S[A]-_[A]);else{const B=e.Util.colorToRGBA(_[A]);F=e.Util.colorToRGBA(S[A]),_[A]=B,C.push({r:F.r-B.r,g:F.g-B.g,b:F.b-B.b,a:F.a-B.a})}else for(A=0;A<O;A++)C.push(S[A]-_[A]);else c.indexOf(y)!==-1?(_=e.Util.colorToRGBA(_),F=e.Util.colorToRGBA(S),C={r:F.r-_.r,g:F.g-_.g,b:F.b-_.b,a:F.a-_.a}):C=S-_;p.attrs[T][this._id][y]={start:_,diff:C,end:S,trueEnd:j,trueStart:D},p.tweens[T][y]=this._id}_tweenFunc(y){let S=this.node,w=p.attrs[S._id][this._id],T,_,C,N,A,O,j,D;for(T in w){if(_=w[T],C=_.start,N=_.diff,D=_.end,e.Util._isArray(C))if(A=[],j=Math.max(C.length,D.length),T.indexOf("fill")===0)for(O=0;O<j;O++)O%2===0?A.push((C[O]||0)+N[O]*y):A.push("rgba("+Math.round(C[O].r+N[O].r*y)+","+Math.round(C[O].g+N[O].g*y)+","+Math.round(C[O].b+N[O].b*y)+","+(C[O].a+N[O].a*y)+")");else for(O=0;O<j;O++)A.push((C[O]||0)+N[O]*y);else c.indexOf(T)!==-1?A="rgba("+Math.round(C.r+N.r*y)+","+Math.round(C.g+N.g*y)+","+Math.round(C.b+N.b*y)+","+(C.a+N.a*y)+")":A=C+N*y;S.setAttr(T,A)}}_addListeners(){this.tween.onPlay=()=>{this.anim.start()},this.tween.onReverse=()=>{this.anim.start()},this.tween.onPause=()=>{this.anim.stop()},this.tween.onFinish=()=>{const y=this.node,S=p.attrs[y._id][this._id];S.points&&S.points.trueEnd&&y.setAttr("points",S.points.trueEnd),this.onFinish&&this.onFinish.call(this)},this.tween.onReset=()=>{const y=this.node,S=p.attrs[y._id][this._id];S.points&&S.points.trueStart&&y.points(S.points.trueStart),this.onReset&&this.onReset()},this.tween.onUpdate=()=>{this.onUpdate&&this.onUpdate.call(this)}}play(){return this.tween.play(),this}reverse(){return this.tween.reverse(),this}reset(){return this.tween.reset(),this}seek(y){return this.tween.seek(y*1e3),this}pause(){return this.tween.pause(),this}finish(){return this.tween.finish(),this}destroy(){let y=this.node._id,S=this._id,w=p.tweens[y],T;this.pause();for(T in w)delete p.tweens[y][T];delete p.attrs[y][S]}}t.Tween=p,p.attrs={},p.tweens={},n.Node.prototype.to=function(v){const y=v.onFinish;v.node=this,v.onFinish=function(){this.destroy(),y&&y()},new p(v).play()},t.Easings={BackEaseIn(v,y,S,w){return S*(v/=w)*v*((1.70158+1)*v-1.70158)+y},BackEaseOut(v,y,S,w){return S*((v=v/w-1)*v*((1.70158+1)*v+1.70158)+1)+y},BackEaseInOut(v,y,S,w){let T=1.70158;return(v/=w/2)<1?S/2*(v*v*(((T*=1.525)+1)*v-T))+y:S/2*((v-=2)*v*(((T*=1.525)+1)*v+T)+2)+y},ElasticEaseIn(v,y,S,w,T,_){let C=0;return v===0?y:(v/=w)===1?y+S:(_||(_=w*.3),!T||T<Math.abs(S)?(T=S,C=_/4):C=_/(2*Math.PI)*Math.asin(S/T),-(T*Math.pow(2,10*(v-=1))*Math.sin((v*w-C)*(2*Math.PI)/_))+y)},ElasticEaseOut(v,y,S,w,T,_){let C=0;return v===0?y:(v/=w)===1?y+S:(_||(_=w*.3),!T||T<Math.abs(S)?(T=S,C=_/4):C=_/(2*Math.PI)*Math.asin(S/T),T*Math.pow(2,-10*v)*Math.sin((v*w-C)*(2*Math.PI)/_)+S+y)},ElasticEaseInOut(v,y,S,w,T,_){let C=0;return v===0?y:(v/=w/2)===2?y+S:(_||(_=w*(.3*1.5)),!T||T<Math.abs(S)?(T=S,C=_/4):C=_/(2*Math.PI)*Math.asin(S/T),v<1?-.5*(T*Math.pow(2,10*(v-=1))*Math.sin((v*w-C)*(2*Math.PI)/_))+y:T*Math.pow(2,-10*(v-=1))*Math.sin((v*w-C)*(2*Math.PI)/_)*.5+S+y)},BounceEaseOut(v,y,S,w){return(v/=w)<1/2.75?S*(7.5625*v*v)+y:v<2/2.75?S*(7.5625*(v-=1.5/2.75)*v+.75)+y:v<2.5/2.75?S*(7.5625*(v-=2.25/2.75)*v+.9375)+y:S*(7.5625*(v-=2.625/2.75)*v+.984375)+y},BounceEaseIn(v,y,S,w){return S-t.Easings.BounceEaseOut(w-v,0,S,w)+y},BounceEaseInOut(v,y,S,w){return v<w/2?t.Easings.BounceEaseIn(v*2,0,S,w)*.5+y:t.Easings.BounceEaseOut(v*2-w,0,S,w)*.5+S*.5+y},EaseIn(v,y,S,w){return S*(v/=w)*v+y},EaseOut(v,y,S,w){return-S*(v/=w)*(v-2)+y},EaseInOut(v,y,S,w){return(v/=w/2)<1?S/2*v*v+y:-S/2*(--v*(v-2)-1)+y},StrongEaseIn(v,y,S,w){return S*(v/=w)*v*v*v*v+y},StrongEaseOut(v,y,S,w){return S*((v=v/w-1)*v*v*v*v+1)+y},StrongEaseInOut(v,y,S,w){return(v/=w/2)<1?S/2*v*v*v*v*v+y:S/2*((v-=2)*v*v*v*v+2)+y},Linear(v,y,S,w){return S*v/w+y}}})(O2)),O2}var j5;function ak(){return j5||(j5=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Konva=void 0;const e=Sr(),r=si(),n=yi(),i=G1(),a=QG(),s=zL(),o=JG(),l=A_(),u=M_(),c=pa(),f=L_(),p=eV(),v=FL(),y=U1();t.Konva=r.Util._assign(e.Konva,{Util:r.Util,Transform:r.Transform,Node:n.Node,Container:i.Container,Stage:a.Stage,stages:a.stages,Layer:s.Layer,FastLayer:o.FastLayer,Group:l.Group,DD:u.DD,Shape:c.Shape,shapes:c.shapes,Animation:f.Animation,Tween:p.Tween,Easings:p.Easings,Context:v.Context,Canvas:y.Canvas}),t.default=t.Konva})(T2)),T2}var lg={},F5;function tV(){if(F5)return lg;F5=1,Object.defineProperty(lg,"__esModule",{value:!0}),lg.Arc=void 0;const t=Cr(),e=pa(),r=Sr(),n=Tr(),i=Sr();let a=class extends e.Shape{_sceneFunc(o){const l=r.Konva.getAngle(this.angle()),u=this.clockwise();o.beginPath(),o.arc(0,0,this.outerRadius(),0,l,u),o.arc(0,0,this.innerRadius(),l,0,!u),o.closePath(),o.fillStrokeShape(this)}getWidth(){return this.outerRadius()*2}getHeight(){return this.outerRadius()*2}setWidth(o){this.outerRadius(o/2)}setHeight(o){this.outerRadius(o/2)}getSelfRect(){const o=this.innerRadius(),l=this.outerRadius(),u=this.clockwise(),c=r.Konva.getAngle(u?360-this.angle():this.angle()),f=Math.cos(Math.min(c,Math.PI)),p=1,v=Math.sin(Math.min(Math.max(Math.PI,c),3*Math.PI/2)),y=Math.sin(Math.min(c,Math.PI/2)),S=f*(f>0?o:l),w=p*l,T=v*(v>0?o:l),_=y*(y>0?l:o);return{x:S,y:u?-1*_:T,width:w-S,height:_-T}}};return lg.Arc=a,a.prototype._centroid=!0,a.prototype.className="Arc",a.prototype._attrsAffectingSize=["innerRadius","outerRadius"],(0,i._registerNode)(a),t.Factory.addGetterSetter(a,"innerRadius",0,(0,n.getNumberValidator)()),t.Factory.addGetterSetter(a,"outerRadius",0,(0,n.getNumberValidator)()),t.Factory.addGetterSetter(a,"angle",0,(0,n.getNumberValidator)()),t.Factory.addGetterSetter(a,"clockwise",!1,(0,n.getBooleanValidator)()),lg}var ug={},cg={},B5;function UL(){if(B5)return cg;B5=1,Object.defineProperty(cg,"__esModule",{value:!0}),cg.Line=void 0;const t=Cr(),e=Sr(),r=pa(),n=Tr();function i(o,l,u,c,f,p,v){const y=Math.sqrt(Math.pow(u-o,2)+Math.pow(c-l,2)),S=Math.sqrt(Math.pow(f-u,2)+Math.pow(p-c,2)),w=v*y/(y+S),T=v*S/(y+S),_=u-w*(f-o),C=c-w*(p-l),N=u+T*(f-o),A=c+T*(p-l);return[_,C,N,A]}function a(o,l){const u=o.length,c=[];for(let f=2;f<u-2;f+=2){const p=i(o[f-2],o[f-1],o[f],o[f+1],o[f+2],o[f+3],l);isNaN(p[0])||(c.push(p[0]),c.push(p[1]),c.push(o[f]),c.push(o[f+1]),c.push(p[2]),c.push(p[3]))}return c}class s extends r.Shape{constructor(l){super(l),this.on("pointsChange.konva tensionChange.konva closedChange.konva bezierChange.konva",function(){this._clearCache("tensionPoints")})}_sceneFunc(l){let u=this.points(),c=u.length,f=this.tension(),p=this.closed(),v=this.bezier(),y,S,w;if(c){if(l.beginPath(),l.moveTo(u[0],u[1]),f!==0&&c>4){for(y=this.getTensionPoints(),S=y.length,w=p?0:4,p||l.quadraticCurveTo(y[0],y[1],y[2],y[3]);w<S-2;)l.bezierCurveTo(y[w++],y[w++],y[w++],y[w++],y[w++],y[w++]);p||l.quadraticCurveTo(y[S-2],y[S-1],u[c-2],u[c-1])}else if(v)for(w=2;w<c;)l.bezierCurveTo(u[w++],u[w++],u[w++],u[w++],u[w++],u[w++]);else for(w=2;w<c;w+=2)l.lineTo(u[w],u[w+1]);p?(l.closePath(),l.fillStrokeShape(this)):l.strokeShape(this)}}getTensionPoints(){return this._getCache("tensionPoints",this._getTensionPoints)}_getTensionPoints(){return this.closed()?this._getTensionPointsClosed():a(this.points(),this.tension())}_getTensionPointsClosed(){const l=this.points(),u=l.length,c=this.tension(),f=i(l[u-2],l[u-1],l[0],l[1],l[2],l[3],c),p=i(l[u-4],l[u-3],l[u-2],l[u-1],l[0],l[1],c),v=a(l,c);return[f[2],f[3]].concat(v).concat([p[0],p[1],l[u-2],l[u-1],p[2],p[3],f[0],f[1],l[0],l[1]])}getWidth(){return this.getSelfRect().width}getHeight(){return this.getSelfRect().height}getSelfRect(){let l=this.points();if(l.length<4)return{x:l[0]||0,y:l[1]||0,width:0,height:0};this.tension()!==0?l=[l[0],l[1],...this._getTensionPoints(),l[l.length-2],l[l.length-1]]:l=this.points();let u=l[0],c=l[0],f=l[1],p=l[1],v,y;for(let S=0;S<l.length/2;S++)v=l[S*2],y=l[S*2+1],u=Math.min(u,v),c=Math.max(c,v),f=Math.min(f,y),p=Math.max(p,y);return{x:u,y:f,width:c-u,height:p-f}}}return cg.Line=s,s.prototype.className="Line",s.prototype._attrsAffectingSize=["points","bezier","tension"],(0,e._registerNode)(s),t.Factory.addGetterSetter(s,"closed",!1),t.Factory.addGetterSetter(s,"bezier",!1),t.Factory.addGetterSetter(s,"tension",0,(0,n.getNumberValidator)()),t.Factory.addGetterSetter(s,"points",[],(0,n.getNumberArrayValidator)()),cg}var dg={},D2={},z5;function rV(){return z5||(z5=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.t2length=t.getQuadraticArcLength=t.getCubicArcLength=t.binomialCoefficients=t.cValues=t.tValues=void 0,t.tValues=[[],[],[-.5773502691896257,.5773502691896257],[0,-.7745966692414834,.7745966692414834],[-.33998104358485626,.33998104358485626,-.8611363115940526,.8611363115940526],[0,-.5384693101056831,.5384693101056831,-.906179845938664,.906179845938664],[.6612093864662645,-.6612093864662645,-.2386191860831969,.2386191860831969,-.932469514203152,.932469514203152],[0,.4058451513773972,-.4058451513773972,-.7415311855993945,.7415311855993945,-.9491079123427585,.9491079123427585],[-.1834346424956498,.1834346424956498,-.525532409916329,.525532409916329,-.7966664774136267,.7966664774136267,-.9602898564975363,.9602898564975363],[0,-.8360311073266358,.8360311073266358,-.9681602395076261,.9681602395076261,-.3242534234038089,.3242534234038089,-.6133714327005904,.6133714327005904],[-.14887433898163122,.14887433898163122,-.4333953941292472,.4333953941292472,-.6794095682990244,.6794095682990244,-.8650633666889845,.8650633666889845,-.9739065285171717,.9739065285171717],[0,-.26954315595234496,.26954315595234496,-.5190961292068118,.5190961292068118,-.7301520055740494,.7301520055740494,-.8870625997680953,.8870625997680953,-.978228658146057,.978228658146057],[-.1252334085114689,.1252334085114689,-.3678314989981802,.3678314989981802,-.5873179542866175,.5873179542866175,-.7699026741943047,.7699026741943047,-.9041172563704749,.9041172563704749,-.9815606342467192,.9815606342467192],[0,-.2304583159551348,.2304583159551348,-.44849275103644687,.44849275103644687,-.6423493394403402,.6423493394403402,-.8015780907333099,.8015780907333099,-.9175983992229779,.9175983992229779,-.9841830547185881,.9841830547185881],[-.10805494870734367,.10805494870734367,-.31911236892788974,.31911236892788974,-.5152486363581541,.5152486363581541,-.6872929048116855,.6872929048116855,-.827201315069765,.827201315069765,-.9284348836635735,.9284348836635735,-.9862838086968123,.9862838086968123],[0,-.20119409399743451,.20119409399743451,-.3941513470775634,.3941513470775634,-.5709721726085388,.5709721726085388,-.7244177313601701,.7244177313601701,-.8482065834104272,.8482065834104272,-.937273392400706,.937273392400706,-.9879925180204854,.9879925180204854],[-.09501250983763744,.09501250983763744,-.2816035507792589,.2816035507792589,-.45801677765722737,.45801677765722737,-.6178762444026438,.6178762444026438,-.755404408355003,.755404408355003,-.8656312023878318,.8656312023878318,-.9445750230732326,.9445750230732326,-.9894009349916499,.9894009349916499],[0,-.17848418149584785,.17848418149584785,-.3512317634538763,.3512317634538763,-.5126905370864769,.5126905370864769,-.6576711592166907,.6576711592166907,-.7815140038968014,.7815140038968014,-.8802391537269859,.8802391537269859,-.9506755217687678,.9506755217687678,-.9905754753144174,.9905754753144174],[-.0847750130417353,.0847750130417353,-.2518862256915055,.2518862256915055,-.41175116146284263,.41175116146284263,-.5597708310739475,.5597708310739475,-.6916870430603532,.6916870430603532,-.8037049589725231,.8037049589725231,-.8926024664975557,.8926024664975557,-.9558239495713977,.9558239495713977,-.9915651684209309,.9915651684209309],[0,-.16035864564022537,.16035864564022537,-.31656409996362983,.31656409996362983,-.46457074137596094,.46457074137596094,-.600545304661681,.600545304661681,-.7209661773352294,.7209661773352294,-.8227146565371428,.8227146565371428,-.9031559036148179,.9031559036148179,-.96020815213483,.96020815213483,-.9924068438435844,.9924068438435844],[-.07652652113349734,.07652652113349734,-.22778585114164507,.22778585114164507,-.37370608871541955,.37370608871541955,-.5108670019508271,.5108670019508271,-.636053680726515,.636053680726515,-.7463319064601508,.7463319064601508,-.8391169718222188,.8391169718222188,-.912234428251326,.912234428251326,-.9639719272779138,.9639719272779138,-.9931285991850949,.9931285991850949],[0,-.1455618541608951,.1455618541608951,-.2880213168024011,.2880213168024011,-.4243421202074388,.4243421202074388,-.5516188358872198,.5516188358872198,-.6671388041974123,.6671388041974123,-.7684399634756779,.7684399634756779,-.8533633645833173,.8533633645833173,-.9200993341504008,.9200993341504008,-.9672268385663063,.9672268385663063,-.9937521706203895,.9937521706203895],[-.06973927331972223,.06973927331972223,-.20786042668822127,.20786042668822127,-.34193582089208424,.34193582089208424,-.469355837986757,.469355837986757,-.5876404035069116,.5876404035069116,-.6944872631866827,.6944872631866827,-.7878168059792081,.7878168059792081,-.8658125777203002,.8658125777203002,-.926956772187174,.926956772187174,-.9700604978354287,.9700604978354287,-.9942945854823992,.9942945854823992],[0,-.1332568242984661,.1332568242984661,-.26413568097034495,.26413568097034495,-.3903010380302908,.3903010380302908,-.5095014778460075,.5095014778460075,-.6196098757636461,.6196098757636461,-.7186613631319502,.7186613631319502,-.8048884016188399,.8048884016188399,-.8767523582704416,.8767523582704416,-.9329710868260161,.9329710868260161,-.9725424712181152,.9725424712181152,-.9947693349975522,.9947693349975522],[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213]],t.cValues=[[],[],[1,1],[.8888888888888888,.5555555555555556,.5555555555555556],[.6521451548625461,.6521451548625461,.34785484513745385,.34785484513745385],[.5688888888888889,.47862867049936647,.47862867049936647,.23692688505618908,.23692688505618908],[.3607615730481386,.3607615730481386,.46791393457269104,.46791393457269104,.17132449237917036,.17132449237917036],[.4179591836734694,.3818300505051189,.3818300505051189,.27970539148927664,.27970539148927664,.1294849661688697,.1294849661688697],[.362683783378362,.362683783378362,.31370664587788727,.31370664587788727,.22238103445337448,.22238103445337448,.10122853629037626,.10122853629037626],[.3302393550012598,.1806481606948574,.1806481606948574,.08127438836157441,.08127438836157441,.31234707704000286,.31234707704000286,.26061069640293544,.26061069640293544],[.29552422471475287,.29552422471475287,.26926671930999635,.26926671930999635,.21908636251598204,.21908636251598204,.1494513491505806,.1494513491505806,.06667134430868814,.06667134430868814],[.2729250867779006,.26280454451024665,.26280454451024665,.23319376459199048,.23319376459199048,.18629021092773426,.18629021092773426,.1255803694649046,.1255803694649046,.05566856711617366,.05566856711617366],[.24914704581340277,.24914704581340277,.2334925365383548,.2334925365383548,.20316742672306592,.20316742672306592,.16007832854334622,.16007832854334622,.10693932599531843,.10693932599531843,.04717533638651183,.04717533638651183],[.2325515532308739,.22628318026289723,.22628318026289723,.2078160475368885,.2078160475368885,.17814598076194574,.17814598076194574,.13887351021978725,.13887351021978725,.09212149983772845,.09212149983772845,.04048400476531588,.04048400476531588],[.2152638534631578,.2152638534631578,.2051984637212956,.2051984637212956,.18553839747793782,.18553839747793782,.15720316715819355,.15720316715819355,.12151857068790319,.12151857068790319,.08015808715976021,.08015808715976021,.03511946033175186,.03511946033175186],[.2025782419255613,.19843148532711158,.19843148532711158,.1861610000155622,.1861610000155622,.16626920581699392,.16626920581699392,.13957067792615432,.13957067792615432,.10715922046717194,.10715922046717194,.07036604748810812,.07036604748810812,.03075324199611727,.03075324199611727],[.1894506104550685,.1894506104550685,.18260341504492358,.18260341504492358,.16915651939500254,.16915651939500254,.14959598881657674,.14959598881657674,.12462897125553388,.12462897125553388,.09515851168249279,.09515851168249279,.062253523938647894,.062253523938647894,.027152459411754096,.027152459411754096],[.17944647035620653,.17656270536699264,.17656270536699264,.16800410215645004,.16800410215645004,.15404576107681028,.15404576107681028,.13513636846852548,.13513636846852548,.11188384719340397,.11188384719340397,.08503614831717918,.08503614831717918,.0554595293739872,.0554595293739872,.02414830286854793,.02414830286854793],[.1691423829631436,.1691423829631436,.16427648374583273,.16427648374583273,.15468467512626524,.15468467512626524,.14064291467065065,.14064291467065065,.12255520671147846,.12255520671147846,.10094204410628717,.10094204410628717,.07642573025488905,.07642573025488905,.0497145488949698,.0497145488949698,.02161601352648331,.02161601352648331],[.1610544498487837,.15896884339395434,.15896884339395434,.15276604206585967,.15276604206585967,.1426067021736066,.1426067021736066,.12875396253933621,.12875396253933621,.11156664554733399,.11156664554733399,.09149002162245,.09149002162245,.06904454273764123,.06904454273764123,.0448142267656996,.0448142267656996,.019461788229726478,.019461788229726478],[.15275338713072584,.15275338713072584,.14917298647260374,.14917298647260374,.14209610931838204,.14209610931838204,.13168863844917664,.13168863844917664,.11819453196151841,.11819453196151841,.10193011981724044,.10193011981724044,.08327674157670475,.08327674157670475,.06267204833410907,.06267204833410907,.04060142980038694,.04060142980038694,.017614007139152118,.017614007139152118],[.14608113364969041,.14452440398997005,.14452440398997005,.13988739479107315,.13988739479107315,.13226893863333747,.13226893863333747,.12183141605372853,.12183141605372853,.10879729916714838,.10879729916714838,.09344442345603386,.09344442345603386,.0761001136283793,.0761001136283793,.057134425426857205,.057134425426857205,.036953789770852494,.036953789770852494,.016017228257774335,.016017228257774335],[.13925187285563198,.13925187285563198,.13654149834601517,.13654149834601517,.13117350478706238,.13117350478706238,.12325237681051242,.12325237681051242,.11293229608053922,.11293229608053922,.10041414444288096,.10041414444288096,.08594160621706773,.08594160621706773,.06979646842452049,.06979646842452049,.052293335152683286,.052293335152683286,.03377490158481415,.03377490158481415,.0146279952982722,.0146279952982722],[.13365457218610619,.1324620394046966,.1324620394046966,.12890572218808216,.12890572218808216,.12304908430672953,.12304908430672953,.11499664022241136,.11499664022241136,.10489209146454141,.10489209146454141,.09291576606003515,.09291576606003515,.07928141177671895,.07928141177671895,.06423242140852585,.06423242140852585,.04803767173108467,.04803767173108467,.030988005856979445,.030988005856979445,.013411859487141771,.013411859487141771],[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872]],t.binomialCoefficients=[[1],[1,1],[1,2,1],[1,3,3,1]];const e=(s,o,l)=>{let u,c;const p=l/2;u=0;for(let v=0;v<20;v++)c=p*t.tValues[20][v]+p,u+=t.cValues[20][v]*n(s,o,c);return p*u};t.getCubicArcLength=e;const r=(s,o,l)=>{l===void 0&&(l=1);const u=s[0]-2*s[1]+s[2],c=o[0]-2*o[1]+o[2],f=2*s[1]-2*s[0],p=2*o[1]-2*o[0],v=4*(u*u+c*c),y=4*(u*f+c*p),S=f*f+p*p;if(v===0)return l*Math.sqrt(Math.pow(s[2]-s[0],2)+Math.pow(o[2]-o[0],2));const w=y/(2*v),T=S/v,_=l+w,C=T-w*w,N=_*_+C>0?Math.sqrt(_*_+C):0,A=w*w+C>0?Math.sqrt(w*w+C):0,O=w+Math.sqrt(w*w+C)!==0?C*Math.log(Math.abs((_+N)/(w+A))):0;return Math.sqrt(v)/2*(_*N-w*A+O)};t.getQuadraticArcLength=r;function n(s,o,l){const u=i(1,l,s),c=i(1,l,o),f=u*u+c*c;return Math.sqrt(f)}const i=(s,o,l)=>{const u=l.length-1;let c,f;if(u===0)return 0;if(s===0){f=0;for(let p=0;p<=u;p++)f+=t.binomialCoefficients[u][p]*Math.pow(1-o,u-p)*Math.pow(o,p)*l[p];return f}else{c=new Array(u);for(let p=0;p<u;p++)c[p]=u*(l[p+1]-l[p]);return i(s-1,o,c)}},a=(s,o,l)=>{let u=1,c=s/o,f=(s-l(c))/o,p=0;for(;u>.001;){const v=l(c+f),y=Math.abs(s-v)/o;if(y<u)u=y,c+=f;else{const S=l(c-f),w=Math.abs(s-S)/o;w<u?(u=w,c-=f):f/=2}if(p++,p>500)break}return c};t.t2length=a})(D2)),D2}var U5;function R_(){if(U5)return dg;U5=1,Object.defineProperty(dg,"__esModule",{value:!0}),dg.Path=void 0;const t=Cr(),e=pa(),r=Sr(),n=rV();class i extends e.Shape{constructor(s){super(s),this.dataArray=[],this.pathLength=0,this._readDataAttribute(),this.on("dataChange.konva",function(){this._readDataAttribute()})}_readDataAttribute(){this.dataArray=i.parsePathData(this.data()),this.pathLength=i.getPathLength(this.dataArray)}_sceneFunc(s){const o=this.dataArray;s.beginPath();let l=!1;for(let N=0;N<o.length;N++){const A=o[N].command,O=o[N].points;switch(A){case"L":s.lineTo(O[0],O[1]);break;case"M":s.moveTo(O[0],O[1]);break;case"C":s.bezierCurveTo(O[0],O[1],O[2],O[3],O[4],O[5]);break;case"Q":s.quadraticCurveTo(O[0],O[1],O[2],O[3]);break;case"A":var u=O[0],c=O[1],f=O[2],p=O[3],v=O[4],y=O[5],S=O[6],w=O[7],T=f>p?f:p,_=f>p?1:f/p,C=f>p?p/f:1;s.translate(u,c),s.rotate(S),s.scale(_,C),s.arc(0,0,T,v,v+y,1-w),s.scale(1/_,1/C),s.rotate(-S),s.translate(-u,-c);break;case"z":l=!0,s.closePath();break}}!l&&!this.hasFill()?s.strokeShape(this):s.fillStrokeShape(this)}getSelfRect(){let s=[];this.dataArray.forEach(function(v){if(v.command==="A"){const y=v.points[4],S=v.points[5],w=v.points[4]+S;let T=Math.PI/180;if(Math.abs(y-w)<T&&(T=Math.abs(y-w)),S<0)for(let _=y-T;_>w;_-=T){const C=i.getPointOnEllipticalArc(v.points[0],v.points[1],v.points[2],v.points[3],_,0);s.push(C.x,C.y)}else for(let _=y+T;_<w;_+=T){const C=i.getPointOnEllipticalArc(v.points[0],v.points[1],v.points[2],v.points[3],_,0);s.push(C.x,C.y)}}else if(v.command==="C")for(let y=0;y<=1;y+=.01){const S=i.getPointOnCubicBezier(y,v.start.x,v.start.y,v.points[0],v.points[1],v.points[2],v.points[3],v.points[4],v.points[5]);s.push(S.x,S.y)}else s=s.concat(v.points)});let o=s[0],l=s[0],u=s[1],c=s[1],f,p;for(let v=0;v<s.length/2;v++)f=s[v*2],p=s[v*2+1],isNaN(f)||(o=Math.min(o,f),l=Math.max(l,f)),isNaN(p)||(u=Math.min(u,p),c=Math.max(c,p));return{x:o,y:u,width:l-o,height:c-u}}getLength(){return this.pathLength}getPointAtLength(s){return i.getPointAtLengthOfDataArray(s,this.dataArray)}static getLineLength(s,o,l,u){return Math.sqrt((l-s)*(l-s)+(u-o)*(u-o))}static getPathLength(s){let o=0;for(let l=0;l<s.length;++l)o+=s[l].pathLength;return o}static getPointAtLengthOfDataArray(s,o){let l,u=0,c=o.length;if(!c)return null;for(;u<c&&s>o[u].pathLength;)s-=o[u].pathLength,++u;if(u===c)return l=o[u-1].points.slice(-2),{x:l[0],y:l[1]};if(s<.01)return l=o[u].points.slice(0,2),{x:l[0],y:l[1]};const f=o[u],p=f.points;switch(f.command){case"L":return i.getPointOnLine(s,f.start.x,f.start.y,p[0],p[1]);case"C":return i.getPointOnCubicBezier((0,n.t2length)(s,i.getPathLength(o),N=>(0,n.getCubicArcLength)([f.start.x,p[0],p[2],p[4]],[f.start.y,p[1],p[3],p[5]],N)),f.start.x,f.start.y,p[0],p[1],p[2],p[3],p[4],p[5]);case"Q":return i.getPointOnQuadraticBezier((0,n.t2length)(s,i.getPathLength(o),N=>(0,n.getQuadraticArcLength)([f.start.x,p[0],p[2]],[f.start.y,p[1],p[3]],N)),f.start.x,f.start.y,p[0],p[1],p[2],p[3]);case"A":var v=p[0],y=p[1],S=p[2],w=p[3],T=p[4],_=p[5],C=p[6];return T+=_*s/f.pathLength,i.getPointOnEllipticalArc(v,y,S,w,T,C)}return null}static getPointOnLine(s,o,l,u,c,f,p){f=f??o,p=p??l;const v=this.getLineLength(o,l,u,c);if(v<1e-10)return{x:o,y:l};if(u===o)return{x:f,y:p+(c>l?s:-s)};const y=(c-l)/(u-o),S=Math.sqrt(s*s/(1+y*y))*(u<o?-1:1),w=y*S;if(Math.abs(p-l-y*(f-o))<1e-10)return{x:f+S,y:p+w};const T=((f-o)*(u-o)+(p-l)*(c-l))/(v*v),_=o+T*(u-o),C=l+T*(c-l),N=this.getLineLength(f,p,_,C),A=Math.sqrt(s*s-N*N),O=Math.sqrt(A*A/(1+y*y))*(u<o?-1:1),j=y*O;return{x:_+O,y:C+j}}static getPointOnCubicBezier(s,o,l,u,c,f,p,v,y){function S(A){return A*A*A}function w(A){return 3*A*A*(1-A)}function T(A){return 3*A*(1-A)*(1-A)}function _(A){return(1-A)*(1-A)*(1-A)}const C=v*S(s)+f*w(s)+u*T(s)+o*_(s),N=y*S(s)+p*w(s)+c*T(s)+l*_(s);return{x:C,y:N}}static getPointOnQuadraticBezier(s,o,l,u,c,f,p){function v(_){return _*_}function y(_){return 2*_*(1-_)}function S(_){return(1-_)*(1-_)}const w=f*v(s)+u*y(s)+o*S(s),T=p*v(s)+c*y(s)+l*S(s);return{x:w,y:T}}static getPointOnEllipticalArc(s,o,l,u,c,f){const p=Math.cos(f),v=Math.sin(f),y={x:l*Math.cos(c),y:u*Math.sin(c)};return{x:s+(y.x*p-y.y*v),y:o+(y.x*v+y.y*p)}}static parsePathData(s){if(!s)return[];let o=s;const l=["m","M","l","L","v","V","h","H","z","Z","c","C","q","Q","t","T","s","S","a","A"];o=o.replace(new RegExp(" ","g"),",");for(var u=0;u<l.length;u++)o=o.replace(new RegExp(l[u],"g"),"|"+l[u]);const c=o.split("|"),f=[],p=[];let v=0,y=0;const S=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/gi;let w;for(u=1;u<c.length;u++){let I=c[u],q=I.charAt(0);for(I=I.slice(1),p.length=0;w=S.exec(I);)p.push(w[0]);const U=[];for(let W=0,Y=p.length;W<Y;W++){if(p[W]==="00"){U.push(0,0);continue}const Q=parseFloat(p[W]);isNaN(Q)?U.push(0):U.push(Q)}for(;U.length>0&&!isNaN(U[0]);){let W="",Y=[];const Q=v,ne=y;var T,_,C,N,A,O,j,D,F,B;switch(q){case"l":v+=U.shift(),y+=U.shift(),W="L",Y.push(v,y);break;case"L":v=U.shift(),y=U.shift(),Y.push(v,y);break;case"m":var $=U.shift(),Z=U.shift();if(v+=$,y+=Z,W="M",f.length>2&&f[f.length-1].command==="z"){for(let re=f.length-2;re>=0;re--)if(f[re].command==="M"){v=f[re].points[0]+$,y=f[re].points[1]+Z;break}}Y.push(v,y),q="l";break;case"M":v=U.shift(),y=U.shift(),W="M",Y.push(v,y),q="L";break;case"h":v+=U.shift(),W="L",Y.push(v,y);break;case"H":v=U.shift(),W="L",Y.push(v,y);break;case"v":y+=U.shift(),W="L",Y.push(v,y);break;case"V":y=U.shift(),W="L",Y.push(v,y);break;case"C":Y.push(U.shift(),U.shift(),U.shift(),U.shift()),v=U.shift(),y=U.shift(),Y.push(v,y);break;case"c":Y.push(v+U.shift(),y+U.shift(),v+U.shift(),y+U.shift()),v+=U.shift(),y+=U.shift(),W="C",Y.push(v,y);break;case"S":_=v,C=y,T=f[f.length-1],T.command==="C"&&(_=v+(v-T.points[2]),C=y+(y-T.points[3])),Y.push(_,C,U.shift(),U.shift()),v=U.shift(),y=U.shift(),W="C",Y.push(v,y);break;case"s":_=v,C=y,T=f[f.length-1],T.command==="C"&&(_=v+(v-T.points[2]),C=y+(y-T.points[3])),Y.push(_,C,v+U.shift(),y+U.shift()),v+=U.shift(),y+=U.shift(),W="C",Y.push(v,y);break;case"Q":Y.push(U.shift(),U.shift()),v=U.shift(),y=U.shift(),Y.push(v,y);break;case"q":Y.push(v+U.shift(),y+U.shift()),v+=U.shift(),y+=U.shift(),W="Q",Y.push(v,y);break;case"T":_=v,C=y,T=f[f.length-1],T.command==="Q"&&(_=v+(v-T.points[0]),C=y+(y-T.points[1])),v=U.shift(),y=U.shift(),W="Q",Y.push(_,C,v,y);break;case"t":_=v,C=y,T=f[f.length-1],T.command==="Q"&&(_=v+(v-T.points[0]),C=y+(y-T.points[1])),v+=U.shift(),y+=U.shift(),W="Q",Y.push(_,C,v,y);break;case"A":N=U.shift(),A=U.shift(),O=U.shift(),j=U.shift(),D=U.shift(),F=v,B=y,v=U.shift(),y=U.shift(),W="A",Y=this.convertEndpointToCenterParameterization(F,B,v,y,j,D,N,A,O);break;case"a":N=U.shift(),A=U.shift(),O=U.shift(),j=U.shift(),D=U.shift(),F=v,B=y,v+=U.shift(),y+=U.shift(),W="A",Y=this.convertEndpointToCenterParameterization(F,B,v,y,j,D,N,A,O);break}f.push({command:W||q,points:Y,start:{x:Q,y:ne},pathLength:this.calcLength(Q,ne,W||q,Y)})}(q==="z"||q==="Z")&&f.push({command:"z",points:[],start:void 0,pathLength:0})}return f}static calcLength(s,o,l,u){let c,f,p,v;const y=i;switch(l){case"L":return y.getLineLength(s,o,u[0],u[1]);case"C":return(0,n.getCubicArcLength)([s,u[0],u[2],u[4]],[o,u[1],u[3],u[5]],1);case"Q":return(0,n.getQuadraticArcLength)([s,u[0],u[2]],[o,u[1],u[3]],1);case"A":c=0;var S=u[4],w=u[5],T=u[4]+w,_=Math.PI/180;if(Math.abs(S-T)<_&&(_=Math.abs(S-T)),f=y.getPointOnEllipticalArc(u[0],u[1],u[2],u[3],S,0),w<0)for(v=S-_;v>T;v-=_)p=y.getPointOnEllipticalArc(u[0],u[1],u[2],u[3],v,0),c+=y.getLineLength(f.x,f.y,p.x,p.y),f=p;else for(v=S+_;v<T;v+=_)p=y.getPointOnEllipticalArc(u[0],u[1],u[2],u[3],v,0),c+=y.getLineLength(f.x,f.y,p.x,p.y),f=p;return p=y.getPointOnEllipticalArc(u[0],u[1],u[2],u[3],T,0),c+=y.getLineLength(f.x,f.y,p.x,p.y),c}return 0}static convertEndpointToCenterParameterization(s,o,l,u,c,f,p,v,y){const S=y*(Math.PI/180),w=Math.cos(S)*(s-l)/2+Math.sin(S)*(o-u)/2,T=-1*Math.sin(S)*(s-l)/2+Math.cos(S)*(o-u)/2,_=w*w/(p*p)+T*T/(v*v);_>1&&(p*=Math.sqrt(_),v*=Math.sqrt(_));let C=Math.sqrt((p*p*(v*v)-p*p*(T*T)-v*v*(w*w))/(p*p*(T*T)+v*v*(w*w)));c===f&&(C*=-1),isNaN(C)&&(C=0);const N=C*p*T/v,A=C*-v*w/p,O=(s+l)/2+Math.cos(S)*N-Math.sin(S)*A,j=(o+u)/2+Math.sin(S)*N+Math.cos(S)*A,D=function(U){return Math.sqrt(U[0]*U[0]+U[1]*U[1])},F=function(U,W){return(U[0]*W[0]+U[1]*W[1])/(D(U)*D(W))},B=function(U,W){return(U[0]*W[1]<U[1]*W[0]?-1:1)*Math.acos(F(U,W))},$=B([1,0],[(w-N)/p,(T-A)/v]),Z=[(w-N)/p,(T-A)/v],I=[(-1*w-N)/p,(-1*T-A)/v];let q=B(Z,I);return F(Z,I)<=-1&&(q=Math.PI),F(Z,I)>=1&&(q=0),f===0&&q>0&&(q=q-2*Math.PI),f===1&&q<0&&(q=q+2*Math.PI),[O,j,p,v,$,q,S,f]}}return dg.Path=i,i.prototype.className="Path",i.prototype._attrsAffectingSize=["data"],(0,r._registerNode)(i),t.Factory.addGetterSetter(i,"data"),dg}var G5;function nV(){if(G5)return ug;G5=1,Object.defineProperty(ug,"__esModule",{value:!0}),ug.Arrow=void 0;const t=Cr(),e=UL(),r=Tr(),n=Sr(),i=R_();let a=class extends e.Line{_sceneFunc(o){super._sceneFunc(o);const l=Math.PI*2,u=this.points();let c=u;const f=this.tension()!==0&&u.length>4;f&&(c=this.getTensionPoints());const p=this.pointerLength(),v=u.length;let y,S;if(f){const _=[c[c.length-4],c[c.length-3],c[c.length-2],c[c.length-1],u[v-2],u[v-1]],C=i.Path.calcLength(c[c.length-4],c[c.length-3],"C",_),N=i.Path.getPointOnQuadraticBezier(Math.min(1,1-p/C),_[0],_[1],_[2],_[3],_[4],_[5]);y=u[v-2]-N.x,S=u[v-1]-N.y}else y=u[v-2]-u[v-4],S=u[v-1]-u[v-3];const w=(Math.atan2(S,y)+l)%l,T=this.pointerWidth();this.pointerAtEnding()&&(o.save(),o.beginPath(),o.translate(u[v-2],u[v-1]),o.rotate(w),o.moveTo(0,0),o.lineTo(-p,T/2),o.lineTo(-p,-T/2),o.closePath(),o.restore(),this.__fillStroke(o)),this.pointerAtBeginning()&&(o.save(),o.beginPath(),o.translate(u[0],u[1]),f?(y=(c[0]+c[2])/2-u[0],S=(c[1]+c[3])/2-u[1]):(y=u[2]-u[0],S=u[3]-u[1]),o.rotate((Math.atan2(-S,-y)+l)%l),o.moveTo(0,0),o.lineTo(-p,T/2),o.lineTo(-p,-T/2),o.closePath(),o.restore(),this.__fillStroke(o))}__fillStroke(o){const l=this.dashEnabled();l&&(this.attrs.dashEnabled=!1,o.setLineDash([])),o.fillStrokeShape(this),l&&(this.attrs.dashEnabled=!0)}getSelfRect(){const o=super.getSelfRect(),l=this.pointerWidth()/2;return{x:o.x-l,y:o.y-l,width:o.width+l*2,height:o.height+l*2}}};return ug.Arrow=a,a.prototype.className="Arrow",(0,n._registerNode)(a),t.Factory.addGetterSetter(a,"pointerLength",10,(0,r.getNumberValidator)()),t.Factory.addGetterSetter(a,"pointerWidth",10,(0,r.getNumberValidator)()),t.Factory.addGetterSetter(a,"pointerAtBeginning",!1),t.Factory.addGetterSetter(a,"pointerAtEnding",!0),ug}var fg={},V5;function iV(){if(V5)return fg;V5=1,Object.defineProperty(fg,"__esModule",{value:!0}),fg.Circle=void 0;const t=Cr(),e=pa(),r=Tr(),n=Sr();let i=class extends e.Shape{_sceneFunc(s){s.beginPath(),s.arc(0,0,this.attrs.radius||0,0,Math.PI*2,!1),s.closePath(),s.fillStrokeShape(this)}getWidth(){return this.radius()*2}getHeight(){return this.radius()*2}setWidth(s){this.radius()!==s/2&&this.radius(s/2)}setHeight(s){this.radius()!==s/2&&this.radius(s/2)}};return fg.Circle=i,i.prototype._centroid=!0,i.prototype.className="Circle",i.prototype._attrsAffectingSize=["radius"],(0,n._registerNode)(i),t.Factory.addGetterSetter(i,"radius",0,(0,r.getNumberValidator)()),fg}var hg={},H5;function aV(){if(H5)return hg;H5=1,Object.defineProperty(hg,"__esModule",{value:!0}),hg.Ellipse=void 0;const t=Cr(),e=pa(),r=Tr(),n=Sr();let i=class extends e.Shape{_sceneFunc(s){const o=this.radiusX(),l=this.radiusY();s.beginPath(),s.save(),o!==l&&s.scale(1,l/o),s.arc(0,0,o,0,Math.PI*2,!1),s.restore(),s.closePath(),s.fillStrokeShape(this)}getWidth(){return this.radiusX()*2}getHeight(){return this.radiusY()*2}setWidth(s){this.radiusX(s/2)}setHeight(s){this.radiusY(s/2)}};return hg.Ellipse=i,i.prototype.className="Ellipse",i.prototype._centroid=!0,i.prototype._attrsAffectingSize=["radiusX","radiusY"],(0,n._registerNode)(i),t.Factory.addComponentsGetterSetter(i,"radius",["x","y"]),t.Factory.addGetterSetter(i,"radiusX",0,(0,r.getNumberValidator)()),t.Factory.addGetterSetter(i,"radiusY",0,(0,r.getNumberValidator)()),hg}var pg={},W5;function sV(){if(W5)return pg;W5=1,Object.defineProperty(pg,"__esModule",{value:!0}),pg.Image=void 0;const t=si(),e=Cr(),r=pa(),n=Sr(),i=Tr();class a extends r.Shape{constructor(o){super(o),this.on("imageChange.konva",()=>{this._setImageLoad()}),this._setImageLoad()}_setImageLoad(){const o=this.image();o&&o.complete||o&&o.readyState===4||o&&o.addEventListener&&o.addEventListener("load",()=>{this._requestDraw()})}_useBufferCanvas(){const o=!!this.cornerRadius(),l=this.hasShadow();return o&&l?!0:super._useBufferCanvas(!0)}_sceneFunc(o){const l=this.getWidth(),u=this.getHeight(),c=this.cornerRadius(),f=this.attrs.image;let p;if(f){const v=this.attrs.cropWidth,y=this.attrs.cropHeight;v&&y?p=[f,this.cropX(),this.cropY(),v,y,0,0,l,u]:p=[f,0,0,l,u]}(this.hasFill()||this.hasStroke()||c)&&(o.beginPath(),c?t.Util.drawRoundedRectPath(o,l,u,c):o.rect(0,0,l,u),o.closePath(),o.fillStrokeShape(this)),f&&(c&&o.clip(),o.drawImage.apply(o,p))}_hitFunc(o){const l=this.width(),u=this.height(),c=this.cornerRadius();o.beginPath(),c?t.Util.drawRoundedRectPath(o,l,u,c):o.rect(0,0,l,u),o.closePath(),o.fillStrokeShape(this)}getWidth(){var o,l;return(o=this.attrs.width)!==null&&o!==void 0?o:(l=this.image())===null||l===void 0?void 0:l.width}getHeight(){var o,l;return(o=this.attrs.height)!==null&&o!==void 0?o:(l=this.image())===null||l===void 0?void 0:l.height}static fromURL(o,l,u=null){const c=t.Util.createImageElement();c.onload=function(){const f=new a({image:c});l(f)},c.onerror=u,c.crossOrigin="Anonymous",c.src=o}}return pg.Image=a,a.prototype.className="Image",(0,n._registerNode)(a),e.Factory.addGetterSetter(a,"cornerRadius",0,(0,i.getNumberOrArrayOfNumbersValidator)(4)),e.Factory.addGetterSetter(a,"image"),e.Factory.addComponentsGetterSetter(a,"crop",["x","y","width","height"]),e.Factory.addGetterSetter(a,"cropX",0,(0,i.getNumberValidator)()),e.Factory.addGetterSetter(a,"cropY",0,(0,i.getNumberValidator)()),e.Factory.addGetterSetter(a,"cropWidth",0,(0,i.getNumberValidator)()),e.Factory.addGetterSetter(a,"cropHeight",0,(0,i.getNumberValidator)()),pg}var $f={},q5;function oV(){if(q5)return $f;q5=1,Object.defineProperty($f,"__esModule",{value:!0}),$f.Tag=$f.Label=void 0;const t=Cr(),e=pa(),r=A_(),n=Tr(),i=Sr(),a=["fontFamily","fontSize","fontStyle","padding","lineHeight","text","width","height","pointerDirection","pointerWidth","pointerHeight"],s="Change.konva",o="none",l="up",u="right",c="down",f="left",p=a.length;let v=class extends r.Group{constructor(w){super(w),this.on("add.konva",function(T){this._addListeners(T.child),this._sync()})}getText(){return this.find("Text")[0]}getTag(){return this.find("Tag")[0]}_addListeners(w){let T=this,_;const C=function(){T._sync()};for(_=0;_<p;_++)w.on(a[_]+s,C)}getWidth(){return this.getText().width()}getHeight(){return this.getText().height()}_sync(){let w=this.getText(),T=this.getTag(),_,C,N,A,O,j,D;if(w&&T){switch(_=w.width(),C=w.height(),N=T.pointerDirection(),A=T.pointerWidth(),D=T.pointerHeight(),O=0,j=0,N){case l:O=_/2,j=-1*D;break;case u:O=_+A,j=C/2;break;case c:O=_/2,j=C+D;break;case f:O=-1*A,j=C/2;break}T.setAttrs({x:-1*O,y:-1*j,width:_,height:C}),w.setAttrs({x:-1*O,y:-1*j})}}};$f.Label=v,v.prototype.className="Label",(0,i._registerNode)(v);class y extends e.Shape{_sceneFunc(w){const T=this.width(),_=this.height(),C=this.pointerDirection(),N=this.pointerWidth(),A=this.pointerHeight(),O=this.cornerRadius();let j=0,D=0,F=0,B=0;typeof O=="number"?j=D=F=B=Math.min(O,T/2,_/2):(j=Math.min(O[0]||0,T/2,_/2),D=Math.min(O[1]||0,T/2,_/2),B=Math.min(O[2]||0,T/2,_/2),F=Math.min(O[3]||0,T/2,_/2)),w.beginPath(),w.moveTo(j,0),C===l&&(w.lineTo((T-N)/2,0),w.lineTo(T/2,-1*A),w.lineTo((T+N)/2,0)),w.lineTo(T-D,0),w.arc(T-D,D,D,Math.PI*3/2,0,!1),C===u&&(w.lineTo(T,(_-A)/2),w.lineTo(T+N,_/2),w.lineTo(T,(_+A)/2)),w.lineTo(T,_-B),w.arc(T-B,_-B,B,0,Math.PI/2,!1),C===c&&(w.lineTo((T+N)/2,_),w.lineTo(T/2,_+A),w.lineTo((T-N)/2,_)),w.lineTo(F,_),w.arc(F,_-F,F,Math.PI/2,Math.PI,!1),C===f&&(w.lineTo(0,(_+A)/2),w.lineTo(-1*N,_/2),w.lineTo(0,(_-A)/2)),w.lineTo(0,j),w.arc(j,j,j,Math.PI,Math.PI*3/2,!1),w.closePath(),w.fillStrokeShape(this)}getSelfRect(){let w=0,T=0,_=this.pointerWidth(),C=this.pointerHeight(),N=this.pointerDirection(),A=this.width(),O=this.height();return N===l?(T-=C,O+=C):N===c?O+=C:N===f?(w-=_*1.5,A+=_):N===u&&(A+=_*1.5),{x:w,y:T,width:A,height:O}}}return $f.Tag=y,y.prototype.className="Tag",(0,i._registerNode)(y),t.Factory.addGetterSetter(y,"pointerDirection",o),t.Factory.addGetterSetter(y,"pointerWidth",0,(0,n.getNumberValidator)()),t.Factory.addGetterSetter(y,"pointerHeight",0,(0,n.getNumberValidator)()),t.Factory.addGetterSetter(y,"cornerRadius",0,(0,n.getNumberOrArrayOfNumbersValidator)(4)),$f}var mg={},$5;function GL(){if($5)return mg;$5=1,Object.defineProperty(mg,"__esModule",{value:!0}),mg.Rect=void 0;const t=Cr(),e=pa(),r=Sr(),n=si(),i=Tr();class a extends e.Shape{_sceneFunc(o){const l=this.cornerRadius(),u=this.width(),c=this.height();o.beginPath(),l?n.Util.drawRoundedRectPath(o,u,c,l):o.rect(0,0,u,c),o.closePath(),o.fillStrokeShape(this)}}return mg.Rect=a,a.prototype.className="Rect",(0,r._registerNode)(a),t.Factory.addGetterSetter(a,"cornerRadius",0,(0,i.getNumberOrArrayOfNumbersValidator)(4)),mg}var gg={},K5;function lV(){if(K5)return gg;K5=1,Object.defineProperty(gg,"__esModule",{value:!0}),gg.RegularPolygon=void 0;const t=Cr(),e=pa(),r=Tr(),n=Sr();let i=class extends e.Shape{_sceneFunc(s){const o=this._getPoints();s.beginPath(),s.moveTo(o[0].x,o[0].y);for(let l=1;l<o.length;l++)s.lineTo(o[l].x,o[l].y);s.closePath(),s.fillStrokeShape(this)}_getPoints(){const s=this.attrs.sides,o=this.attrs.radius||0,l=[];for(let u=0;u<s;u++)l.push({x:o*Math.sin(u*2*Math.PI/s),y:-1*o*Math.cos(u*2*Math.PI/s)});return l}getSelfRect(){const s=this._getPoints();let o=s[0].x,l=s[0].y,u=s[0].x,c=s[0].y;return s.forEach(f=>{o=Math.min(o,f.x),l=Math.max(l,f.x),u=Math.min(u,f.y),c=Math.max(c,f.y)}),{x:o,y:u,width:l-o,height:c-u}}getWidth(){return this.radius()*2}getHeight(){return this.radius()*2}setWidth(s){this.radius(s/2)}setHeight(s){this.radius(s/2)}};return gg.RegularPolygon=i,i.prototype.className="RegularPolygon",i.prototype._centroid=!0,i.prototype._attrsAffectingSize=["radius"],(0,n._registerNode)(i),t.Factory.addGetterSetter(i,"radius",0,(0,r.getNumberValidator)()),t.Factory.addGetterSetter(i,"sides",0,(0,r.getNumberValidator)()),gg}var vg={},Z5;function uV(){if(Z5)return vg;Z5=1,Object.defineProperty(vg,"__esModule",{value:!0}),vg.Ring=void 0;const t=Cr(),e=pa(),r=Tr(),n=Sr(),i=Math.PI*2;let a=class extends e.Shape{_sceneFunc(o){o.beginPath(),o.arc(0,0,this.innerRadius(),0,i,!1),o.moveTo(this.outerRadius(),0),o.arc(0,0,this.outerRadius(),i,0,!0),o.closePath(),o.fillStrokeShape(this)}getWidth(){return this.outerRadius()*2}getHeight(){return this.outerRadius()*2}setWidth(o){this.outerRadius(o/2)}setHeight(o){this.outerRadius(o/2)}};return vg.Ring=a,a.prototype.className="Ring",a.prototype._centroid=!0,a.prototype._attrsAffectingSize=["innerRadius","outerRadius"],(0,n._registerNode)(a),t.Factory.addGetterSetter(a,"innerRadius",0,(0,r.getNumberValidator)()),t.Factory.addGetterSetter(a,"outerRadius",0,(0,r.getNumberValidator)()),vg}var yg={},Y5;function cV(){if(Y5)return yg;Y5=1,Object.defineProperty(yg,"__esModule",{value:!0}),yg.Sprite=void 0;const t=Cr(),e=pa(),r=L_(),n=Tr(),i=Sr();let a=class extends e.Shape{constructor(o){super(o),this._updated=!0,this.anim=new r.Animation(()=>{const l=this._updated;return this._updated=!1,l}),this.on("animationChange.konva",function(){this.frameIndex(0)}),this.on("frameIndexChange.konva",function(){this._updated=!0}),this.on("frameRateChange.konva",function(){this.anim.isRunning()&&(clearInterval(this.interval),this._setInterval())})}_sceneFunc(o){const l=this.animation(),u=this.frameIndex(),c=u*4,f=this.animations()[l],p=this.frameOffsets(),v=f[c+0],y=f[c+1],S=f[c+2],w=f[c+3],T=this.image();if((this.hasFill()||this.hasStroke())&&(o.beginPath(),o.rect(0,0,S,w),o.closePath(),o.fillStrokeShape(this)),T)if(p){const _=p[l],C=u*2;o.drawImage(T,v,y,S,w,_[C+0],_[C+1],S,w)}else o.drawImage(T,v,y,S,w,0,0,S,w)}_hitFunc(o){const l=this.animation(),u=this.frameIndex(),c=u*4,f=this.animations()[l],p=this.frameOffsets(),v=f[c+2],y=f[c+3];if(o.beginPath(),p){const S=p[l],w=u*2;o.rect(S[w+0],S[w+1],v,y)}else o.rect(0,0,v,y);o.closePath(),o.fillShape(this)}_useBufferCanvas(){return super._useBufferCanvas(!0)}_setInterval(){const o=this;this.interval=setInterval(function(){o._updateIndex()},1e3/this.frameRate())}start(){if(this.isRunning())return;const o=this.getLayer();this.anim.setLayers(o),this._setInterval(),this.anim.start()}stop(){this.anim.stop(),clearInterval(this.interval)}isRunning(){return this.anim.isRunning()}_updateIndex(){const o=this.frameIndex(),l=this.animation(),u=this.animations(),c=u[l],f=c.length/4;o<f-1?this.frameIndex(o+1):this.frameIndex(0)}};return yg.Sprite=a,a.prototype.className="Sprite",(0,i._registerNode)(a),t.Factory.addGetterSetter(a,"animation"),t.Factory.addGetterSetter(a,"animations"),t.Factory.addGetterSetter(a,"frameOffsets"),t.Factory.addGetterSetter(a,"image"),t.Factory.addGetterSetter(a,"frameIndex",0,(0,n.getNumberValidator)()),t.Factory.addGetterSetter(a,"frameRate",17,(0,n.getNumberValidator)()),t.Factory.backCompat(a,{index:"frameIndex",getIndex:"getFrameIndex",setIndex:"setFrameIndex"}),yg}var xg={},X5;function dV(){if(X5)return xg;X5=1,Object.defineProperty(xg,"__esModule",{value:!0}),xg.Star=void 0;const t=Cr(),e=pa(),r=Tr(),n=Sr();let i=class extends e.Shape{_sceneFunc(s){const o=this.innerRadius(),l=this.outerRadius(),u=this.numPoints();s.beginPath(),s.moveTo(0,0-l);for(let c=1;c<u*2;c++){const f=c%2===0?l:o,p=f*Math.sin(c*Math.PI/u),v=-1*f*Math.cos(c*Math.PI/u);s.lineTo(p,v)}s.closePath(),s.fillStrokeShape(this)}getWidth(){return this.outerRadius()*2}getHeight(){return this.outerRadius()*2}setWidth(s){this.outerRadius(s/2)}setHeight(s){this.outerRadius(s/2)}};return xg.Star=i,i.prototype.className="Star",i.prototype._centroid=!0,i.prototype._attrsAffectingSize=["innerRadius","outerRadius"],(0,n._registerNode)(i),t.Factory.addGetterSetter(i,"numPoints",5,(0,r.getNumberValidator)()),t.Factory.addGetterSetter(i,"innerRadius",0,(0,r.getNumberValidator)()),t.Factory.addGetterSetter(i,"outerRadius",0,(0,r.getNumberValidator)()),xg}var _p={},Q5;function VL(){if(Q5)return _p;Q5=1,Object.defineProperty(_p,"__esModule",{value:!0}),_p.Text=void 0,_p.stringToArray=s;const t=si(),e=Cr(),r=pa(),n=Sr(),i=Tr(),a=Sr();function s(te){return[...te].reduce((ie,de,ge,ye)=>(new RegExp("\\p{Emoji_Modifier_Base}\\p{Emoji_Modifier}?(?:\\u200D\\p{Emoji_Presentation})+","u").test(de)?ie.push(de):new RegExp("\\p{Regional_Indicator}{2}","u").test(de+(ye[ge+1]||""))?ie.push(de+ye[ge+1]):ge>0&&new RegExp("\\p{Mn}|\\p{Me}|\\p{Mc}","u").test(de)?ie[ie.length-1]+=de:ie.push(de),ie),[])}const o="auto",l="center",u="inherit",c="justify",f="Change.konva",p="2d",v="-",y="left",S="text",w="Text",T="top",_="bottom",C="middle",N="normal",A="px ",O=" ",j="right",D="rtl",F="word",B="char",$="none",Z="",I=["direction","fontFamily","fontSize","fontStyle","fontVariant","padding","align","verticalAlign","lineHeight","text","width","height","wrap","ellipsis","letterSpacing"],q=I.length;function U(te){return te.split(",").map(ie=>{ie=ie.trim();const de=ie.indexOf(" ")>=0,ge=ie.indexOf('"')>=0||ie.indexOf("'")>=0;return de&&!ge&&(ie=`"${ie}"`),ie}).join(", ")}let W;function Y(){return W||(W=t.Util.createCanvasElement().getContext(p),W)}function Q(te){te.fillText(this._partialText,this._partialTextX,this._partialTextY)}function ne(te){te.setAttr("miterLimit",2),te.strokeText(this._partialText,this._partialTextX,this._partialTextY)}function re(te){return te=te||{},!te.fillLinearGradientColorStops&&!te.fillRadialGradientColorStops&&!te.fillPatternImage&&(te.fill=te.fill||"black"),te}class H extends r.Shape{constructor(ie){super(re(ie)),this._partialTextX=0,this._partialTextY=0;for(let de=0;de<q;de++)this.on(I[de]+f,this._setTextData);this._setTextData()}_sceneFunc(ie){const de=this.textArr,ge=de.length;if(!this.text())return;let ye=this.padding(),ae=this.fontSize(),pe=this.lineHeight()*ae,le=this.verticalAlign(),me=this.direction(),he=0,xe=this.align(),we=this.getWidth(),Ge=this.letterSpacing(),qe=this.fill(),wt=this.textDecoration(),et=wt.indexOf("underline")!==-1,at=wt.indexOf("line-through")!==-1,je;me=me===u?ie.direction:me;let Re=pe/2,nt=C;if(n.Konva._fixTextRendering){const ct=this.measureSize("M");nt="alphabetic",Re=(ct.fontBoundingBoxAscent-ct.fontBoundingBoxDescent)/2+pe/2}var Ce=0,Fe=0;for(me===D&&ie.setAttr("direction",me),ie.setAttr("font",this._getContextFont()),ie.setAttr("textBaseline",nt),ie.setAttr("textAlign",y),le===C?he=(this.getHeight()-ge*pe-ye*2)/2:le===_&&(he=this.getHeight()-ge*pe-ye*2),ie.translate(ye,he+ye),je=0;je<ge;je++){var Ce=0,Fe=0,Ke=de[je],pt=Ke.text,vt=Ke.width,At=Ke.lastInParagraph,Ut,nr,Ct;if(ie.save(),xe===j?Ce+=we-vt-ye*2:xe===l&&(Ce+=(we-vt-ye*2)/2),et){ie.save(),ie.beginPath();const ce=n.Konva._fixTextRendering?Math.round(ae/4):Math.round(ae/2),ve=Ce,_e=Re+Fe+ce;ie.moveTo(ve,_e),Ut=pt.split(" ").length-1,nr=Ut===0,Ct=xe===c&&!At?we-ye*2:vt,ie.lineTo(ve+Math.round(Ct),_e),ie.lineWidth=ae/15;const Te=this._getLinearGradient();ie.strokeStyle=Te||qe,ie.stroke(),ie.restore()}if(at){ie.save(),ie.beginPath();const ce=n.Konva._fixTextRendering?-Math.round(ae/4):0;ie.moveTo(Ce,Re+Fe+ce),Ut=pt.split(" ").length-1,nr=Ut===0,Ct=xe===c&&At&&!nr?we-ye*2:vt,ie.lineTo(Ce+Math.round(Ct),Re+Fe+ce),ie.lineWidth=ae/15;const ve=this._getLinearGradient();ie.strokeStyle=ve||qe,ie.stroke(),ie.restore()}if(me!==D&&(Ge!==0||xe===c)){Ut=pt.split(" ").length-1;const ce=s(pt);for(let ve=0;ve<ce.length;ve++){const _e=ce[ve];_e===" "&&!At&&xe===c&&(Ce+=(we-ye*2-vt)/Ut),this._partialTextX=Ce,this._partialTextY=Re+Fe,this._partialText=_e,ie.fillStrokeShape(this),Ce+=this.measureSize(_e).width+Ge}}else Ge!==0&&ie.setAttr("letterSpacing",`${Ge}px`),this._partialTextX=Ce,this._partialTextY=Re+Fe,this._partialText=pt,ie.fillStrokeShape(this);ie.restore(),ge>1&&(Re+=pe)}}_hitFunc(ie){const de=this.getWidth(),ge=this.getHeight();ie.beginPath(),ie.rect(0,0,de,ge),ie.closePath(),ie.fillStrokeShape(this)}setText(ie){const de=t.Util._isString(ie)?ie:ie==null?"":ie+"";return this._setAttr(S,de),this}getWidth(){return this.attrs.width===o||this.attrs.width===void 0?this.getTextWidth()+this.padding()*2:this.attrs.width}getHeight(){return this.attrs.height===o||this.attrs.height===void 0?this.fontSize()*this.textArr.length*this.lineHeight()+this.padding()*2:this.attrs.height}getTextWidth(){return this.textWidth}getTextHeight(){return t.Util.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height."),this.textHeight}measureSize(ie){var de,ge,ye,ae,pe,le,me,he,xe,we,Ge;let qe=Y(),wt=this.fontSize(),et;qe.save(),qe.font=this._getContextFont(),et=qe.measureText(ie),qe.restore();const at=wt/100;return{actualBoundingBoxAscent:(de=et.actualBoundingBoxAscent)!==null&&de!==void 0?de:71.58203125*at,actualBoundingBoxDescent:(ge=et.actualBoundingBoxDescent)!==null&&ge!==void 0?ge:0,actualBoundingBoxLeft:(ye=et.actualBoundingBoxLeft)!==null&&ye!==void 0?ye:-7.421875*at,actualBoundingBoxRight:(ae=et.actualBoundingBoxRight)!==null&&ae!==void 0?ae:75.732421875*at,alphabeticBaseline:(pe=et.alphabeticBaseline)!==null&&pe!==void 0?pe:0,emHeightAscent:(le=et.emHeightAscent)!==null&&le!==void 0?le:100*at,emHeightDescent:(me=et.emHeightDescent)!==null&&me!==void 0?me:-20*at,fontBoundingBoxAscent:(he=et.fontBoundingBoxAscent)!==null&&he!==void 0?he:91*at,fontBoundingBoxDescent:(xe=et.fontBoundingBoxDescent)!==null&&xe!==void 0?xe:21*at,hangingBaseline:(we=et.hangingBaseline)!==null&&we!==void 0?we:72.80000305175781*at,ideographicBaseline:(Ge=et.ideographicBaseline)!==null&&Ge!==void 0?Ge:-21*at,width:et.width,height:wt}}_getContextFont(){return this.fontStyle()+O+this.fontVariant()+O+(this.fontSize()+A)+U(this.fontFamily())}_addTextLine(ie){this.align()===c&&(ie=ie.trim());const ge=this._getTextWidth(ie);return this.textArr.push({text:ie,width:ge,lastInParagraph:!1})}_getTextWidth(ie){const de=this.letterSpacing(),ge=ie.length;return Y().measureText(ie).width+(ge?de*(ge-1):0)}_setTextData(){let ie=this.text().split(`
`),de=+this.fontSize(),ge=0,ye=this.lineHeight()*de,ae=this.attrs.width,pe=this.attrs.height,le=ae!==o&&ae!==void 0,me=pe!==o&&pe!==void 0,he=this.padding(),xe=ae-he*2,we=pe-he*2,Ge=0,qe=this.wrap(),wt=qe!==$,et=qe!==B&&wt,at=this.ellipsis();this.textArr=[],Y().font=this._getContextFont();const je=at?this._getTextWidth(Z):0;for(let nt=0,Ce=ie.length;nt<Ce;++nt){let Fe=ie[nt],Ke=this._getTextWidth(Fe);if(le&&Ke>xe)for(;Fe.length>0;){let pt=0,vt=Fe.length,At="",Ut=0;for(;pt<vt;){const nr=pt+vt>>>1,Ct=Fe.slice(0,nr+1),ct=this._getTextWidth(Ct)+je;ct<=xe?(pt=nr+1,At=Ct,Ut=ct):vt=nr}if(At){if(et){var Re;const Ct=Fe[At.length];(Ct===O||Ct===v)&&Ut<=xe?Re=At.length:Re=Math.max(At.lastIndexOf(O),At.lastIndexOf(v))+1,Re>0&&(pt=Re,At=At.slice(0,pt),Ut=this._getTextWidth(At))}if(At=At.trimRight(),this._addTextLine(At),ge=Math.max(ge,Ut),Ge+=ye,this._shouldHandleEllipsis(Ge)){this._tryToAddEllipsisToLastLine();break}if(Fe=Fe.slice(pt),Fe=Fe.trimLeft(),Fe.length>0&&(Ke=this._getTextWidth(Fe),Ke<=xe)){this._addTextLine(Fe),Ge+=ye,ge=Math.max(ge,Ke);break}}else break}else this._addTextLine(Fe),Ge+=ye,ge=Math.max(ge,Ke),this._shouldHandleEllipsis(Ge)&&nt<Ce-1&&this._tryToAddEllipsisToLastLine();if(this.textArr[this.textArr.length-1]&&(this.textArr[this.textArr.length-1].lastInParagraph=!0),me&&Ge+ye>we)break}this.textHeight=de,this.textWidth=ge}_shouldHandleEllipsis(ie){const de=+this.fontSize(),ge=this.lineHeight()*de,ye=this.attrs.height,ae=ye!==o&&ye!==void 0,pe=this.padding(),le=ye-pe*2;return!(this.wrap()!==$)||ae&&ie+ge>le}_tryToAddEllipsisToLastLine(){const ie=this.attrs.width,de=ie!==o&&ie!==void 0,ge=this.padding(),ye=ie-ge*2,ae=this.ellipsis(),pe=this.textArr[this.textArr.length-1];!pe||!ae||(de&&(this._getTextWidth(pe.text+Z)<ye||(pe.text=pe.text.slice(0,pe.text.length-3))),this.textArr.splice(this.textArr.length-1,1),this._addTextLine(pe.text+Z))}getStrokeScaleEnabled(){return!0}_useBufferCanvas(){const ie=this.textDecoration().indexOf("underline")!==-1||this.textDecoration().indexOf("line-through")!==-1,de=this.hasShadow();return ie&&de?!0:super._useBufferCanvas()}}return _p.Text=H,H.prototype._fillFunc=Q,H.prototype._strokeFunc=ne,H.prototype.className=w,H.prototype._attrsAffectingSize=["text","fontSize","padding","wrap","lineHeight","letterSpacing"],(0,a._registerNode)(H),e.Factory.overWriteSetter(H,"width",(0,i.getNumberOrAutoValidator)()),e.Factory.overWriteSetter(H,"height",(0,i.getNumberOrAutoValidator)()),e.Factory.addGetterSetter(H,"direction",u),e.Factory.addGetterSetter(H,"fontFamily","Arial"),e.Factory.addGetterSetter(H,"fontSize",12,(0,i.getNumberValidator)()),e.Factory.addGetterSetter(H,"fontStyle",N),e.Factory.addGetterSetter(H,"fontVariant",N),e.Factory.addGetterSetter(H,"padding",0,(0,i.getNumberValidator)()),e.Factory.addGetterSetter(H,"align",y),e.Factory.addGetterSetter(H,"verticalAlign",T),e.Factory.addGetterSetter(H,"lineHeight",1,(0,i.getNumberValidator)()),e.Factory.addGetterSetter(H,"wrap",F),e.Factory.addGetterSetter(H,"ellipsis",!1,(0,i.getBooleanValidator)()),e.Factory.addGetterSetter(H,"letterSpacing",0,(0,i.getNumberValidator)()),e.Factory.addGetterSetter(H,"text","",(0,i.getStringValidator)()),e.Factory.addGetterSetter(H,"textDecoration",""),_p}var bg={},J5;function fV(){if(J5)return bg;J5=1,Object.defineProperty(bg,"__esModule",{value:!0}),bg.TextPath=void 0;const t=si(),e=Cr(),r=pa(),n=R_(),i=VL(),a=Tr(),s=Sr(),o="",l="normal";function u(p){p.fillText(this.partialText,0,0)}function c(p){p.strokeText(this.partialText,0,0)}let f=class extends r.Shape{constructor(v){super(v),this.dummyCanvas=t.Util.createCanvasElement(),this.dataArray=[],this._readDataAttribute(),this.on("dataChange.konva",function(){this._readDataAttribute(),this._setTextData()}),this.on("textChange.konva alignChange.konva letterSpacingChange.konva kerningFuncChange.konva fontSizeChange.konva fontFamilyChange.konva",this._setTextData),this._setTextData()}_getTextPathLength(){return n.Path.getPathLength(this.dataArray)}_getPointAtLength(v){if(!this.attrs.data)return null;const y=this.pathLength;return v-1>y?null:n.Path.getPointAtLengthOfDataArray(v,this.dataArray)}_readDataAttribute(){this.dataArray=n.Path.parsePathData(this.attrs.data),this.pathLength=this._getTextPathLength()}_sceneFunc(v){v.setAttr("font",this._getContextFont()),v.setAttr("textBaseline",this.textBaseline()),v.setAttr("textAlign","left"),v.save();const y=this.textDecoration(),S=this.fill(),w=this.fontSize(),T=this.glyphInfo;y==="underline"&&v.beginPath();for(let _=0;_<T.length;_++){v.save();const C=T[_].p0;v.translate(C.x,C.y),v.rotate(T[_].rotation),this.partialText=T[_].text,v.fillStrokeShape(this),y==="underline"&&(_===0&&v.moveTo(0,w/2+1),v.lineTo(w,w/2+1)),v.restore()}y==="underline"&&(v.strokeStyle=S,v.lineWidth=w/20,v.stroke()),v.restore()}_hitFunc(v){v.beginPath();const y=this.glyphInfo;if(y.length>=1){const S=y[0].p0;v.moveTo(S.x,S.y)}for(let S=0;S<y.length;S++){const w=y[S].p1;v.lineTo(w.x,w.y)}v.setAttr("lineWidth",this.fontSize()),v.setAttr("strokeStyle",this.colorKey),v.stroke()}getTextWidth(){return this.textWidth}getTextHeight(){return t.Util.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height."),this.textHeight}setText(v){return i.Text.prototype.setText.call(this,v)}_getContextFont(){return i.Text.prototype._getContextFont.call(this)}_getTextSize(v){const S=this.dummyCanvas.getContext("2d");S.save(),S.font=this._getContextFont();const w=S.measureText(v);return S.restore(),{width:w.width,height:parseInt(`${this.fontSize()}`,10)}}_setTextData(){const{width:v,height:y}=this._getTextSize(this.attrs.text);if(this.textWidth=v,this.textHeight=y,this.glyphInfo=[],!this.attrs.data)return null;const S=this.letterSpacing(),w=this.align(),T=this.kerningFunc(),_=Math.max(this.textWidth+((this.attrs.text||"").length-1)*S,0);let C=0;w==="center"&&(C=Math.max(0,this.pathLength/2-_/2)),w==="right"&&(C=Math.max(0,this.pathLength-_));const N=(0,i.stringToArray)(this.text());let A=C;for(let O=0;O<N.length;O++){const j=this._getPointAtLength(A);if(!j)return;let D=this._getTextSize(N[O]).width+S;if(N[O]===" "&&w==="justify"){const q=this.text().split(" ").length-1;D+=(this.pathLength-_)/q}const F=this._getPointAtLength(A+D);if(!F)return;const B=n.Path.getLineLength(j.x,j.y,F.x,F.y);let $=0;if(T)try{$=T(N[O-1],N[O])*this.fontSize()}catch{$=0}j.x+=$,F.x+=$,this.textWidth+=$;const Z=n.Path.getPointOnLine($+B/2,j.x,j.y,F.x,F.y),I=Math.atan2(F.y-j.y,F.x-j.x);this.glyphInfo.push({transposeX:Z.x,transposeY:Z.y,text:N[O],rotation:I,p0:j,p1:F}),A+=D}}getSelfRect(){if(!this.glyphInfo.length)return{x:0,y:0,width:0,height:0};const v=[];this.glyphInfo.forEach(function(A){v.push(A.p0.x),v.push(A.p0.y),v.push(A.p1.x),v.push(A.p1.y)});let y=v[0]||0,S=v[0]||0,w=v[1]||0,T=v[1]||0,_,C;for(let A=0;A<v.length/2;A++)_=v[A*2],C=v[A*2+1],y=Math.min(y,_),S=Math.max(S,_),w=Math.min(w,C),T=Math.max(T,C);const N=this.fontSize();return{x:y-N/2,y:w-N/2,width:S-y+N,height:T-w+N}}destroy(){return t.Util.releaseCanvas(this.dummyCanvas),super.destroy()}};return bg.TextPath=f,f.prototype._fillFunc=u,f.prototype._strokeFunc=c,f.prototype._fillFuncHit=u,f.prototype._strokeFuncHit=c,f.prototype.className="TextPath",f.prototype._attrsAffectingSize=["text","fontSize","data"],(0,s._registerNode)(f),e.Factory.addGetterSetter(f,"data"),e.Factory.addGetterSetter(f,"fontFamily","Arial"),e.Factory.addGetterSetter(f,"fontSize",12,(0,a.getNumberValidator)()),e.Factory.addGetterSetter(f,"fontStyle",l),e.Factory.addGetterSetter(f,"align","left"),e.Factory.addGetterSetter(f,"letterSpacing",0,(0,a.getNumberValidator)()),e.Factory.addGetterSetter(f,"textBaseline","middle"),e.Factory.addGetterSetter(f,"fontVariant",l),e.Factory.addGetterSetter(f,"text",o),e.Factory.addGetterSetter(f,"textDecoration",null),e.Factory.addGetterSetter(f,"kerningFunc",null),bg}var wg={},e4;function hV(){if(e4)return wg;e4=1,Object.defineProperty(wg,"__esModule",{value:!0}),wg.Transformer=void 0;const t=si(),e=Cr(),r=yi(),n=pa(),i=GL(),a=A_(),s=Sr(),o=Tr(),l=Sr(),u="tr-konva",c=["resizeEnabledChange","rotateAnchorOffsetChange","rotateEnabledChange","enabledAnchorsChange","anchorSizeChange","borderEnabledChange","borderStrokeChange","borderStrokeWidthChange","borderDashChange","anchorStrokeChange","anchorStrokeWidthChange","anchorFillChange","anchorCornerRadiusChange","ignoreStrokeChange","anchorStyleFuncChange"].map(D=>D+`.${u}`).join(" "),f="nodesRect",p=["widthChange","heightChange","scaleXChange","scaleYChange","skewXChange","skewYChange","rotationChange","offsetXChange","offsetYChange","transformsEnabledChange","strokeWidthChange"],v={"top-left":-45,"top-center":0,"top-right":45,"middle-right":-90,"middle-left":90,"bottom-left":-135,"bottom-center":180,"bottom-right":135},y="ontouchstart"in s.Konva._global;function S(D,F,B){if(D==="rotater")return B;F+=t.Util.degToRad(v[D]||0);const $=(t.Util.radToDeg(F)%360+360)%360;return t.Util._inRange($,315+22.5,360)||t.Util._inRange($,0,22.5)?"ns-resize":t.Util._inRange($,45-22.5,45+22.5)?"nesw-resize":t.Util._inRange($,90-22.5,90+22.5)?"ew-resize":t.Util._inRange($,135-22.5,135+22.5)?"nwse-resize":t.Util._inRange($,180-22.5,180+22.5)?"ns-resize":t.Util._inRange($,225-22.5,225+22.5)?"nesw-resize":t.Util._inRange($,270-22.5,270+22.5)?"ew-resize":t.Util._inRange($,315-22.5,315+22.5)?"nwse-resize":(t.Util.error("Transformer has unknown angle for cursor detection: "+$),"pointer")}const w=["top-left","top-center","top-right","middle-right","middle-left","bottom-left","bottom-center","bottom-right"];function T(D){return{x:D.x+D.width/2*Math.cos(D.rotation)+D.height/2*Math.sin(-D.rotation),y:D.y+D.height/2*Math.cos(D.rotation)+D.width/2*Math.sin(D.rotation)}}function _(D,F,B){const $=B.x+(D.x-B.x)*Math.cos(F)-(D.y-B.y)*Math.sin(F),Z=B.y+(D.x-B.x)*Math.sin(F)+(D.y-B.y)*Math.cos(F);return{...D,rotation:D.rotation+F,x:$,y:Z}}function C(D,F){const B=T(D);return _(D,F,B)}function N(D,F,B){let $=F;for(let Z=0;Z<D.length;Z++){const I=s.Konva.getAngle(D[Z]),q=Math.abs(I-F)%(Math.PI*2);Math.min(q,Math.PI*2-q)<B&&($=I)}return $}let A=0;class O extends a.Group{constructor(F){super(F),this._movingAnchorName=null,this._transforming=!1,this._createElements(),this._handleMouseMove=this._handleMouseMove.bind(this),this._handleMouseUp=this._handleMouseUp.bind(this),this.update=this.update.bind(this),this.on(c,this.update),this.getNode()&&this.update()}attachTo(F){return this.setNode(F),this}setNode(F){return t.Util.warn("tr.setNode(shape), tr.node(shape) and tr.attachTo(shape) methods are deprecated. Please use tr.nodes(nodesArray) instead."),this.setNodes([F])}getNode(){return this._nodes&&this._nodes[0]}_getEventNamespace(){return u+this._id}setNodes(F=[]){this._nodes&&this._nodes.length&&this.detach();const B=F.filter(Z=>Z.isAncestorOf(this)?(t.Util.error("Konva.Transformer cannot be an a child of the node you are trying to attach"),!1):!0);return this._nodes=F=B,F.length===1&&this.useSingleNodeRotation()?this.rotation(F[0].getAbsoluteRotation()):this.rotation(0),this._nodes.forEach(Z=>{const I=()=>{this.nodes().length===1&&this.useSingleNodeRotation()&&this.rotation(this.nodes()[0].getAbsoluteRotation()),this._resetTransformCache(),!this._transforming&&!this.isDragging()&&this.update()},q=Z._attrsAffectingSize.map(U=>U+"Change."+this._getEventNamespace()).join(" ");Z.on(q,I),Z.on(p.map(U=>U+`.${this._getEventNamespace()}`).join(" "),I),Z.on(`absoluteTransformChange.${this._getEventNamespace()}`,I),this._proxyDrag(Z)}),this._resetTransformCache(),this.findOne(".top-left")&&this.update(),this}_proxyDrag(F){let B;F.on(`dragstart.${this._getEventNamespace()}`,$=>{B=F.getAbsolutePosition(),!this.isDragging()&&F!==this.findOne(".back")&&this.startDrag($,!1)}),F.on(`dragmove.${this._getEventNamespace()}`,$=>{if(!B)return;const Z=F.getAbsolutePosition(),I=Z.x-B.x,q=Z.y-B.y;this.nodes().forEach(U=>{if(U===F||U.isDragging())return;const W=U.getAbsolutePosition();U.setAbsolutePosition({x:W.x+I,y:W.y+q}),U.startDrag($)}),B=null})}getNodes(){return this._nodes||[]}getActiveAnchor(){return this._movingAnchorName}detach(){this._nodes&&this._nodes.forEach(F=>{F.off("."+this._getEventNamespace())}),this._nodes=[],this._resetTransformCache()}_resetTransformCache(){this._clearCache(f),this._clearCache("transform"),this._clearSelfAndDescendantCache("absoluteTransform")}_getNodeRect(){return this._getCache(f,this.__getNodeRect)}__getNodeShape(F,B=this.rotation(),$){const Z=F.getClientRect({skipTransform:!0,skipShadow:!0,skipStroke:this.ignoreStroke()}),I=F.getAbsoluteScale($),q=F.getAbsolutePosition($),U=Z.x*I.x-F.offsetX()*I.x,W=Z.y*I.y-F.offsetY()*I.y,Y=(s.Konva.getAngle(F.getAbsoluteRotation())+Math.PI*2)%(Math.PI*2),Q={x:q.x+U*Math.cos(Y)+W*Math.sin(-Y),y:q.y+W*Math.cos(Y)+U*Math.sin(Y),width:Z.width*I.x,height:Z.height*I.y,rotation:Y};return _(Q,-s.Konva.getAngle(B),{x:0,y:0})}__getNodeRect(){if(!this.getNode())return{x:-1e8,y:-1e8,width:0,height:0,rotation:0};const B=[];this.nodes().map(Y=>{const Q=Y.getClientRect({skipTransform:!0,skipShadow:!0,skipStroke:this.ignoreStroke()}),ne=[{x:Q.x,y:Q.y},{x:Q.x+Q.width,y:Q.y},{x:Q.x+Q.width,y:Q.y+Q.height},{x:Q.x,y:Q.y+Q.height}],re=Y.getAbsoluteTransform();ne.forEach(function(H){const te=re.point(H);B.push(te)})});const $=new t.Transform;$.rotate(-s.Konva.getAngle(this.rotation()));let Z=1/0,I=1/0,q=-1/0,U=-1/0;B.forEach(function(Y){const Q=$.point(Y);Z===void 0&&(Z=q=Q.x,I=U=Q.y),Z=Math.min(Z,Q.x),I=Math.min(I,Q.y),q=Math.max(q,Q.x),U=Math.max(U,Q.y)}),$.invert();const W=$.point({x:Z,y:I});return{x:W.x,y:W.y,width:q-Z,height:U-I,rotation:s.Konva.getAngle(this.rotation())}}getX(){return this._getNodeRect().x}getY(){return this._getNodeRect().y}getWidth(){return this._getNodeRect().width}getHeight(){return this._getNodeRect().height}_createElements(){this._createBack(),w.forEach(F=>{this._createAnchor(F)}),this._createAnchor("rotater")}_createAnchor(F){const B=new i.Rect({stroke:"rgb(0, 161, 255)",fill:"white",strokeWidth:1,name:F+" _anchor",dragDistance:0,draggable:!0,hitStrokeWidth:y?10:"auto"}),$=this;B.on("mousedown touchstart",function(Z){$._handleMouseDown(Z)}),B.on("dragstart",Z=>{B.stopDrag(),Z.cancelBubble=!0}),B.on("dragend",Z=>{Z.cancelBubble=!0}),B.on("mouseenter",()=>{const Z=s.Konva.getAngle(this.rotation()),I=this.rotateAnchorCursor(),q=S(F,Z,I);B.getStage().content&&(B.getStage().content.style.cursor=q),this._cursorChange=!0}),B.on("mouseout",()=>{B.getStage().content&&(B.getStage().content.style.cursor=""),this._cursorChange=!1}),this.add(B)}_createBack(){const F=new n.Shape({name:"back",width:0,height:0,draggable:!0,sceneFunc(B,$){const Z=$.getParent(),I=Z.padding();B.beginPath(),B.rect(-I,-I,$.width()+I*2,$.height()+I*2),B.moveTo($.width()/2,-I),Z.rotateEnabled()&&Z.rotateLineVisible()&&B.lineTo($.width()/2,-Z.rotateAnchorOffset()*t.Util._sign($.height())-I),B.fillStrokeShape($)},hitFunc:(B,$)=>{if(!this.shouldOverdrawWholeArea())return;const Z=this.padding();B.beginPath(),B.rect(-Z,-Z,$.width()+Z*2,$.height()+Z*2),B.fillStrokeShape($)}});this.add(F),this._proxyDrag(F),F.on("dragstart",B=>{B.cancelBubble=!0}),F.on("dragmove",B=>{B.cancelBubble=!0}),F.on("dragend",B=>{B.cancelBubble=!0}),this.on("dragmove",B=>{this.update()})}_handleMouseDown(F){if(this._transforming)return;this._movingAnchorName=F.target.name().split(" ")[0];const B=this._getNodeRect(),$=B.width,Z=B.height,I=Math.sqrt(Math.pow($,2)+Math.pow(Z,2));this.sin=Math.abs(Z/I),this.cos=Math.abs($/I),typeof window<"u"&&(window.addEventListener("mousemove",this._handleMouseMove),window.addEventListener("touchmove",this._handleMouseMove),window.addEventListener("mouseup",this._handleMouseUp,!0),window.addEventListener("touchend",this._handleMouseUp,!0)),this._transforming=!0;const q=F.target.getAbsolutePosition(),U=F.target.getStage().getPointerPosition();this._anchorDragOffset={x:U.x-q.x,y:U.y-q.y},A++,this._fire("transformstart",{evt:F.evt,target:this.getNode()}),this._nodes.forEach(W=>{W._fire("transformstart",{evt:F.evt,target:W})})}_handleMouseMove(F){let B,$,Z;const I=this.findOne("."+this._movingAnchorName),q=I.getStage();q.setPointersPositions(F);const U=q.getPointerPosition();let W={x:U.x-this._anchorDragOffset.x,y:U.y-this._anchorDragOffset.y};const Y=I.getAbsolutePosition();this.anchorDragBoundFunc()&&(W=this.anchorDragBoundFunc()(Y,W,F)),I.setAbsolutePosition(W);const Q=I.getAbsolutePosition();if(Y.x===Q.x&&Y.y===Q.y)return;if(this._movingAnchorName==="rotater"){const le=this._getNodeRect();B=I.x()-le.width/2,$=-I.y()+le.height/2;let me=Math.atan2(-$,B)+Math.PI/2;le.height<0&&(me-=Math.PI);const xe=s.Konva.getAngle(this.rotation())+me,we=s.Konva.getAngle(this.rotationSnapTolerance()),qe=N(this.rotationSnaps(),xe,we)-le.rotation,wt=C(le,qe);this._fitNodesInto(wt,F);return}const ne=this.shiftBehavior();let re;ne==="inverted"?re=this.keepRatio()&&!F.shiftKey:ne==="none"?re=this.keepRatio():re=this.keepRatio()||F.shiftKey;var ge=this.centeredScaling()||F.altKey;if(this._movingAnchorName==="top-left"){if(re){var H=ge?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".bottom-right").x(),y:this.findOne(".bottom-right").y()};Z=Math.sqrt(Math.pow(H.x-I.x(),2)+Math.pow(H.y-I.y(),2));var te=this.findOne(".top-left").x()>H.x?-1:1,ie=this.findOne(".top-left").y()>H.y?-1:1;B=Z*this.cos*te,$=Z*this.sin*ie,this.findOne(".top-left").x(H.x-B),this.findOne(".top-left").y(H.y-$)}}else if(this._movingAnchorName==="top-center")this.findOne(".top-left").y(I.y());else if(this._movingAnchorName==="top-right"){if(re){var H=ge?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".bottom-left").x(),y:this.findOne(".bottom-left").y()};Z=Math.sqrt(Math.pow(I.x()-H.x,2)+Math.pow(H.y-I.y(),2));var te=this.findOne(".top-right").x()<H.x?-1:1,ie=this.findOne(".top-right").y()>H.y?-1:1;B=Z*this.cos*te,$=Z*this.sin*ie,this.findOne(".top-right").x(H.x+B),this.findOne(".top-right").y(H.y-$)}var de=I.position();this.findOne(".top-left").y(de.y),this.findOne(".bottom-right").x(de.x)}else if(this._movingAnchorName==="middle-left")this.findOne(".top-left").x(I.x());else if(this._movingAnchorName==="middle-right")this.findOne(".bottom-right").x(I.x());else if(this._movingAnchorName==="bottom-left"){if(re){var H=ge?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".top-right").x(),y:this.findOne(".top-right").y()};Z=Math.sqrt(Math.pow(H.x-I.x(),2)+Math.pow(I.y()-H.y,2));var te=H.x<I.x()?-1:1,ie=I.y()<H.y?-1:1;B=Z*this.cos*te,$=Z*this.sin*ie,I.x(H.x-B),I.y(H.y+$)}de=I.position(),this.findOne(".top-left").x(de.x),this.findOne(".bottom-right").y(de.y)}else if(this._movingAnchorName==="bottom-center")this.findOne(".bottom-right").y(I.y());else if(this._movingAnchorName==="bottom-right"){if(re){var H=ge?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".top-left").x(),y:this.findOne(".top-left").y()};Z=Math.sqrt(Math.pow(I.x()-H.x,2)+Math.pow(I.y()-H.y,2));var te=this.findOne(".bottom-right").x()<H.x?-1:1,ie=this.findOne(".bottom-right").y()<H.y?-1:1;B=Z*this.cos*te,$=Z*this.sin*ie,this.findOne(".bottom-right").x(H.x+B),this.findOne(".bottom-right").y(H.y+$)}}else console.error(new Error("Wrong position argument of selection resizer: "+this._movingAnchorName));var ge=this.centeredScaling()||F.altKey;if(ge){const le=this.findOne(".top-left"),me=this.findOne(".bottom-right"),he=le.x(),xe=le.y(),we=this.getWidth()-me.x(),Ge=this.getHeight()-me.y();me.move({x:-he,y:-xe}),le.move({x:we,y:Ge})}const ye=this.findOne(".top-left").getAbsolutePosition();B=ye.x,$=ye.y;const ae=this.findOne(".bottom-right").x()-this.findOne(".top-left").x(),pe=this.findOne(".bottom-right").y()-this.findOne(".top-left").y();this._fitNodesInto({x:B,y:$,width:ae,height:pe,rotation:s.Konva.getAngle(this.rotation())},F)}_handleMouseUp(F){this._removeEvents(F)}getAbsoluteTransform(){return this.getTransform()}_removeEvents(F){var B;if(this._transforming){this._transforming=!1,typeof window<"u"&&(window.removeEventListener("mousemove",this._handleMouseMove),window.removeEventListener("touchmove",this._handleMouseMove),window.removeEventListener("mouseup",this._handleMouseUp,!0),window.removeEventListener("touchend",this._handleMouseUp,!0));const $=this.getNode();A--,this._fire("transformend",{evt:F,target:$}),(B=this.getLayer())===null||B===void 0||B.batchDraw(),$&&this._nodes.forEach(Z=>{var I;Z._fire("transformend",{evt:F,target:Z}),(I=Z.getLayer())===null||I===void 0||I.batchDraw()}),this._movingAnchorName=null}}_fitNodesInto(F,B){const $=this._getNodeRect(),Z=1;if(t.Util._inRange(F.width,-this.padding()*2-Z,Z)){this.update();return}if(t.Util._inRange(F.height,-this.padding()*2-Z,Z)){this.update();return}const I=new t.Transform;if(I.rotate(s.Konva.getAngle(this.rotation())),this._movingAnchorName&&F.width<0&&this._movingAnchorName.indexOf("left")>=0){const re=I.point({x:-this.padding()*2,y:0});F.x+=re.x,F.y+=re.y,F.width+=this.padding()*2,this._movingAnchorName=this._movingAnchorName.replace("left","right"),this._anchorDragOffset.x-=re.x,this._anchorDragOffset.y-=re.y}else if(this._movingAnchorName&&F.width<0&&this._movingAnchorName.indexOf("right")>=0){const re=I.point({x:this.padding()*2,y:0});this._movingAnchorName=this._movingAnchorName.replace("right","left"),this._anchorDragOffset.x-=re.x,this._anchorDragOffset.y-=re.y,F.width+=this.padding()*2}if(this._movingAnchorName&&F.height<0&&this._movingAnchorName.indexOf("top")>=0){const re=I.point({x:0,y:-this.padding()*2});F.x+=re.x,F.y+=re.y,this._movingAnchorName=this._movingAnchorName.replace("top","bottom"),this._anchorDragOffset.x-=re.x,this._anchorDragOffset.y-=re.y,F.height+=this.padding()*2}else if(this._movingAnchorName&&F.height<0&&this._movingAnchorName.indexOf("bottom")>=0){const re=I.point({x:0,y:this.padding()*2});this._movingAnchorName=this._movingAnchorName.replace("bottom","top"),this._anchorDragOffset.x-=re.x,this._anchorDragOffset.y-=re.y,F.height+=this.padding()*2}if(this.boundBoxFunc()){const re=this.boundBoxFunc()($,F);re?F=re:t.Util.warn("boundBoxFunc returned falsy. You should return new bound rect from it!")}const q=1e7,U=new t.Transform;U.translate($.x,$.y),U.rotate($.rotation),U.scale($.width/q,$.height/q);const W=new t.Transform,Y=F.width/q,Q=F.height/q;this.flipEnabled()===!1?(W.translate(F.x,F.y),W.rotate(F.rotation),W.translate(F.width<0?F.width:0,F.height<0?F.height:0),W.scale(Math.abs(Y),Math.abs(Q))):(W.translate(F.x,F.y),W.rotate(F.rotation),W.scale(Y,Q));const ne=W.multiply(U.invert());this._nodes.forEach(re=>{var H;const te=re.getParent().getAbsoluteTransform(),ie=re.getTransform().copy();ie.translate(re.offsetX(),re.offsetY());const de=new t.Transform;de.multiply(te.copy().invert()).multiply(ne).multiply(te).multiply(ie);const ge=de.decompose();re.setAttrs(ge),(H=re.getLayer())===null||H===void 0||H.batchDraw()}),this.rotation(t.Util._getRotation(F.rotation)),this._nodes.forEach(re=>{this._fire("transform",{evt:B,target:re}),re._fire("transform",{evt:B,target:re})}),this._resetTransformCache(),this.update(),this.getLayer().batchDraw()}forceUpdate(){this._resetTransformCache(),this.update()}_batchChangeChild(F,B){this.findOne(F).setAttrs(B)}update(){var F;const B=this._getNodeRect();this.rotation(t.Util._getRotation(B.rotation));const $=B.width,Z=B.height,I=this.enabledAnchors(),q=this.resizeEnabled(),U=this.padding(),W=this.anchorSize(),Y=this.find("._anchor");Y.forEach(ne=>{ne.setAttrs({width:W,height:W,offsetX:W/2,offsetY:W/2,stroke:this.anchorStroke(),strokeWidth:this.anchorStrokeWidth(),fill:this.anchorFill(),cornerRadius:this.anchorCornerRadius()})}),this._batchChangeChild(".top-left",{x:0,y:0,offsetX:W/2+U,offsetY:W/2+U,visible:q&&I.indexOf("top-left")>=0}),this._batchChangeChild(".top-center",{x:$/2,y:0,offsetY:W/2+U,visible:q&&I.indexOf("top-center")>=0}),this._batchChangeChild(".top-right",{x:$,y:0,offsetX:W/2-U,offsetY:W/2+U,visible:q&&I.indexOf("top-right")>=0}),this._batchChangeChild(".middle-left",{x:0,y:Z/2,offsetX:W/2+U,visible:q&&I.indexOf("middle-left")>=0}),this._batchChangeChild(".middle-right",{x:$,y:Z/2,offsetX:W/2-U,visible:q&&I.indexOf("middle-right")>=0}),this._batchChangeChild(".bottom-left",{x:0,y:Z,offsetX:W/2+U,offsetY:W/2-U,visible:q&&I.indexOf("bottom-left")>=0}),this._batchChangeChild(".bottom-center",{x:$/2,y:Z,offsetY:W/2-U,visible:q&&I.indexOf("bottom-center")>=0}),this._batchChangeChild(".bottom-right",{x:$,y:Z,offsetX:W/2-U,offsetY:W/2-U,visible:q&&I.indexOf("bottom-right")>=0}),this._batchChangeChild(".rotater",{x:$/2,y:-this.rotateAnchorOffset()*t.Util._sign(Z)-U,visible:this.rotateEnabled()}),this._batchChangeChild(".back",{width:$,height:Z,visible:this.borderEnabled(),stroke:this.borderStroke(),strokeWidth:this.borderStrokeWidth(),dash:this.borderDash(),x:0,y:0});const Q=this.anchorStyleFunc();Q&&Y.forEach(ne=>{Q(ne)}),(F=this.getLayer())===null||F===void 0||F.batchDraw()}isTransforming(){return this._transforming}stopTransform(){if(this._transforming){this._removeEvents();const F=this.findOne("."+this._movingAnchorName);F&&F.stopDrag()}}destroy(){return this.getStage()&&this._cursorChange&&this.getStage().content&&(this.getStage().content.style.cursor=""),a.Group.prototype.destroy.call(this),this.detach(),this._removeEvents(),this}toObject(){return r.Node.prototype.toObject.call(this)}clone(F){return r.Node.prototype.clone.call(this,F)}getClientRect(){return this.nodes().length>0?super.getClientRect():{x:0,y:0,width:0,height:0}}}wg.Transformer=O,O.isTransforming=()=>A>0;function j(D){return D instanceof Array||t.Util.warn("enabledAnchors value should be an array"),D instanceof Array&&D.forEach(function(F){w.indexOf(F)===-1&&t.Util.warn("Unknown anchor name: "+F+". Available names are: "+w.join(", "))}),D||[]}return O.prototype.className="Transformer",(0,l._registerNode)(O),e.Factory.addGetterSetter(O,"enabledAnchors",w,j),e.Factory.addGetterSetter(O,"flipEnabled",!0,(0,o.getBooleanValidator)()),e.Factory.addGetterSetter(O,"resizeEnabled",!0),e.Factory.addGetterSetter(O,"anchorSize",10,(0,o.getNumberValidator)()),e.Factory.addGetterSetter(O,"rotateEnabled",!0),e.Factory.addGetterSetter(O,"rotateLineVisible",!0),e.Factory.addGetterSetter(O,"rotationSnaps",[]),e.Factory.addGetterSetter(O,"rotateAnchorOffset",50,(0,o.getNumberValidator)()),e.Factory.addGetterSetter(O,"rotateAnchorCursor","crosshair"),e.Factory.addGetterSetter(O,"rotationSnapTolerance",5,(0,o.getNumberValidator)()),e.Factory.addGetterSetter(O,"borderEnabled",!0),e.Factory.addGetterSetter(O,"anchorStroke","rgb(0, 161, 255)"),e.Factory.addGetterSetter(O,"anchorStrokeWidth",1,(0,o.getNumberValidator)()),e.Factory.addGetterSetter(O,"anchorFill","white"),e.Factory.addGetterSetter(O,"anchorCornerRadius",0,(0,o.getNumberValidator)()),e.Factory.addGetterSetter(O,"borderStroke","rgb(0, 161, 255)"),e.Factory.addGetterSetter(O,"borderStrokeWidth",1,(0,o.getNumberValidator)()),e.Factory.addGetterSetter(O,"borderDash"),e.Factory.addGetterSetter(O,"keepRatio",!0),e.Factory.addGetterSetter(O,"shiftBehavior","default"),e.Factory.addGetterSetter(O,"centeredScaling",!1),e.Factory.addGetterSetter(O,"ignoreStroke",!1),e.Factory.addGetterSetter(O,"padding",0,(0,o.getNumberValidator)()),e.Factory.addGetterSetter(O,"node"),e.Factory.addGetterSetter(O,"nodes"),e.Factory.addGetterSetter(O,"boundBoxFunc"),e.Factory.addGetterSetter(O,"anchorDragBoundFunc"),e.Factory.addGetterSetter(O,"anchorStyleFunc"),e.Factory.addGetterSetter(O,"shouldOverdrawWholeArea",!1),e.Factory.addGetterSetter(O,"useSingleNodeRotation",!0),e.Factory.backCompat(O,{lineEnabled:"borderEnabled",rotateHandlerOffset:"rotateAnchorOffset",enabledHandlers:"enabledAnchors"}),wg}var Sg={},t4;function pV(){if(t4)return Sg;t4=1,Object.defineProperty(Sg,"__esModule",{value:!0}),Sg.Wedge=void 0;const t=Cr(),e=pa(),r=Sr(),n=Tr(),i=Sr();let a=class extends e.Shape{_sceneFunc(o){o.beginPath(),o.arc(0,0,this.radius(),0,r.Konva.getAngle(this.angle()),this.clockwise()),o.lineTo(0,0),o.closePath(),o.fillStrokeShape(this)}getWidth(){return this.radius()*2}getHeight(){return this.radius()*2}setWidth(o){this.radius(o/2)}setHeight(o){this.radius(o/2)}};return Sg.Wedge=a,a.prototype.className="Wedge",a.prototype._centroid=!0,a.prototype._attrsAffectingSize=["radius"],(0,i._registerNode)(a),t.Factory.addGetterSetter(a,"radius",0,(0,n.getNumberValidator)()),t.Factory.addGetterSetter(a,"angle",0,(0,n.getNumberValidator)()),t.Factory.addGetterSetter(a,"clockwise",!1),t.Factory.backCompat(a,{angleDeg:"angle",getAngleDeg:"getAngle",setAngleDeg:"setAngle"}),Sg}var kg={},r4;function mV(){if(r4)return kg;r4=1,Object.defineProperty(kg,"__esModule",{value:!0}),kg.Blur=void 0;const t=Cr(),e=yi(),r=Tr();function n(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}const i=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],a=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function s(l,u){const c=l.data,f=l.width,p=l.height;let v,y,S,w,T,_,C,N,A,O,j,D,F,B,$,Z,I,q,U,W,Y,Q,ne,re,H=u+u+1,te=f-1,ie=p-1,de=u+1,ge=de*(de+1)/2,ye=new n,ae=null,pe=ye,le=null,me=null,he=i[u],xe=a[u];for(S=1;S<H;S++)pe=pe.next=new n,S===de&&(ae=pe);for(pe.next=ye,C=_=0,y=0;y<p;y++){for(Z=I=q=U=N=A=O=j=0,D=de*(W=c[_]),F=de*(Y=c[_+1]),B=de*(Q=c[_+2]),$=de*(ne=c[_+3]),N+=ge*W,A+=ge*Y,O+=ge*Q,j+=ge*ne,pe=ye,S=0;S<de;S++)pe.r=W,pe.g=Y,pe.b=Q,pe.a=ne,pe=pe.next;for(S=1;S<de;S++)w=_+((te<S?te:S)<<2),N+=(pe.r=W=c[w])*(re=de-S),A+=(pe.g=Y=c[w+1])*re,O+=(pe.b=Q=c[w+2])*re,j+=(pe.a=ne=c[w+3])*re,Z+=W,I+=Y,q+=Q,U+=ne,pe=pe.next;for(le=ye,me=ae,v=0;v<f;v++)c[_+3]=ne=j*he>>xe,ne!==0?(ne=255/ne,c[_]=(N*he>>xe)*ne,c[_+1]=(A*he>>xe)*ne,c[_+2]=(O*he>>xe)*ne):c[_]=c[_+1]=c[_+2]=0,N-=D,A-=F,O-=B,j-=$,D-=le.r,F-=le.g,B-=le.b,$-=le.a,w=C+((w=v+u+1)<te?w:te)<<2,Z+=le.r=c[w],I+=le.g=c[w+1],q+=le.b=c[w+2],U+=le.a=c[w+3],N+=Z,A+=I,O+=q,j+=U,le=le.next,D+=W=me.r,F+=Y=me.g,B+=Q=me.b,$+=ne=me.a,Z-=W,I-=Y,q-=Q,U-=ne,me=me.next,_+=4;C+=f}for(v=0;v<f;v++){for(I=q=U=Z=A=O=j=N=0,_=v<<2,D=de*(W=c[_]),F=de*(Y=c[_+1]),B=de*(Q=c[_+2]),$=de*(ne=c[_+3]),N+=ge*W,A+=ge*Y,O+=ge*Q,j+=ge*ne,pe=ye,S=0;S<de;S++)pe.r=W,pe.g=Y,pe.b=Q,pe.a=ne,pe=pe.next;for(T=f,S=1;S<=u;S++)_=T+v<<2,N+=(pe.r=W=c[_])*(re=de-S),A+=(pe.g=Y=c[_+1])*re,O+=(pe.b=Q=c[_+2])*re,j+=(pe.a=ne=c[_+3])*re,Z+=W,I+=Y,q+=Q,U+=ne,pe=pe.next,S<ie&&(T+=f);for(_=v,le=ye,me=ae,y=0;y<p;y++)w=_<<2,c[w+3]=ne=j*he>>xe,ne>0?(ne=255/ne,c[w]=(N*he>>xe)*ne,c[w+1]=(A*he>>xe)*ne,c[w+2]=(O*he>>xe)*ne):c[w]=c[w+1]=c[w+2]=0,N-=D,A-=F,O-=B,j-=$,D-=le.r,F-=le.g,B-=le.b,$-=le.a,w=v+((w=y+de)<ie?w:ie)*f<<2,N+=Z+=le.r=c[w],A+=I+=le.g=c[w+1],O+=q+=le.b=c[w+2],j+=U+=le.a=c[w+3],le=le.next,D+=W=me.r,F+=Y=me.g,B+=Q=me.b,$+=ne=me.a,Z-=W,I-=Y,q-=Q,U-=ne,me=me.next,_+=f}}const o=function(u){const c=Math.round(this.blurRadius());c>0&&s(u,c)};return kg.Blur=o,t.Factory.addGetterSetter(e.Node,"blurRadius",0,(0,r.getNumberValidator)(),t.Factory.afterSetFilter),kg}var _g={},n4;function gV(){if(n4)return _g;n4=1,Object.defineProperty(_g,"__esModule",{value:!0}),_g.Brighten=void 0;const t=Cr(),e=yi(),r=Tr(),n=function(i){let a=this.brightness()*255,s=i.data,o=s.length,l;for(l=0;l<o;l+=4)s[l]+=a,s[l+1]+=a,s[l+2]+=a};return _g.Brighten=n,t.Factory.addGetterSetter(e.Node,"brightness",0,(0,r.getNumberValidator)(),t.Factory.afterSetFilter),_g}var Cg={},i4;function vV(){if(i4)return Cg;i4=1,Object.defineProperty(Cg,"__esModule",{value:!0}),Cg.Contrast=void 0;const t=Cr(),e=yi(),r=Tr(),n=function(i){const a=Math.pow((this.contrast()+100)/100,2);let s=i.data,o=s.length,l=150,u=150,c=150,f;for(f=0;f<o;f+=4)l=s[f],u=s[f+1],c=s[f+2],l/=255,l-=.5,l*=a,l+=.5,l*=255,u/=255,u-=.5,u*=a,u+=.5,u*=255,c/=255,c-=.5,c*=a,c+=.5,c*=255,l=l<0?0:l>255?255:l,u=u<0?0:u>255?255:u,c=c<0?0:c>255?255:c,s[f]=l,s[f+1]=u,s[f+2]=c};return Cg.Contrast=n,t.Factory.addGetterSetter(e.Node,"contrast",0,(0,r.getNumberValidator)(),t.Factory.afterSetFilter),Cg}var Eg={},a4;function yV(){if(a4)return Eg;a4=1,Object.defineProperty(Eg,"__esModule",{value:!0}),Eg.Emboss=void 0;const t=Cr(),e=yi(),r=si(),n=Tr(),i=function(a){let s=this.embossStrength()*10,o=this.embossWhiteLevel()*255,l=this.embossDirection(),u=this.embossBlend(),c=0,f=0,p=a.data,v=a.width,y=a.height,S=v*4,w=y;switch(l){case"top-left":c=-1,f=-1;break;case"top":c=-1,f=0;break;case"top-right":c=-1,f=1;break;case"right":c=0,f=1;break;case"bottom-right":c=1,f=1;break;case"bottom":c=1,f=0;break;case"bottom-left":c=1,f=-1;break;case"left":c=0,f=-1;break;default:r.Util.error("Unknown emboss direction: "+l)}do{const T=(w-1)*S;let _=c;w+_<1&&(_=0),w+_>y&&(_=0);const C=(w-1+_)*v*4;let N=v;do{const A=T+(N-1)*4;let O=f;N+O<1&&(O=0),N+O>v&&(O=0);const j=C+(N-1+O)*4,D=p[A]-p[j],F=p[A+1]-p[j+1],B=p[A+2]-p[j+2];let $=D;const Z=$>0?$:-$,I=F>0?F:-F,q=B>0?B:-B;if(I>Z&&($=F),q>Z&&($=B),$*=s,u){const U=p[A]+$,W=p[A+1]+$,Y=p[A+2]+$;p[A]=U>255?255:U<0?0:U,p[A+1]=W>255?255:W<0?0:W,p[A+2]=Y>255?255:Y<0?0:Y}else{let U=o-$;U<0?U=0:U>255&&(U=255),p[A]=p[A+1]=p[A+2]=U}}while(--N)}while(--w)};return Eg.Emboss=i,t.Factory.addGetterSetter(e.Node,"embossStrength",.5,(0,n.getNumberValidator)(),t.Factory.afterSetFilter),t.Factory.addGetterSetter(e.Node,"embossWhiteLevel",.5,(0,n.getNumberValidator)(),t.Factory.afterSetFilter),t.Factory.addGetterSetter(e.Node,"embossDirection","top-left",null,t.Factory.afterSetFilter),t.Factory.addGetterSetter(e.Node,"embossBlend",!1,null,t.Factory.afterSetFilter),Eg}var Tg={},s4;function xV(){if(s4)return Tg;s4=1,Object.defineProperty(Tg,"__esModule",{value:!0}),Tg.Enhance=void 0;const t=Cr(),e=yi(),r=Tr();function n(a,s,o,l,u){let c=o-s,f=u-l,p;return c===0?l+f/2:f===0?l:(p=(a-s)/c,p=f*p+l,p)}const i=function(a){let s=a.data,o=s.length,l=s[0],u=l,c,f=s[1],p=f,v,y=s[2],S=y,w,T;const _=this.enhance();if(_===0)return;for(T=0;T<o;T+=4)c=s[T+0],c<l?l=c:c>u&&(u=c),v=s[T+1],v<f?f=v:v>p&&(p=v),w=s[T+2],w<y?y=w:w>S&&(S=w);u===l&&(u=255,l=0),p===f&&(p=255,f=0),S===y&&(S=255,y=0);let C,N,A,O,j,D,F,B,$;for(_>0?(N=u+_*(255-u),A=l-_*(l-0),j=p+_*(255-p),D=f-_*(f-0),B=S+_*(255-S),$=y-_*(y-0)):(C=(u+l)*.5,N=u+_*(u-C),A=l+_*(l-C),O=(p+f)*.5,j=p+_*(p-O),D=f+_*(f-O),F=(S+y)*.5,B=S+_*(S-F),$=y+_*(y-F)),T=0;T<o;T+=4)s[T+0]=n(s[T+0],l,u,A,N),s[T+1]=n(s[T+1],f,p,D,j),s[T+2]=n(s[T+2],y,S,$,B)};return Tg.Enhance=i,t.Factory.addGetterSetter(e.Node,"enhance",0,(0,r.getNumberValidator)(),t.Factory.afterSetFilter),Tg}var Ng={},o4;function bV(){if(o4)return Ng;o4=1,Object.defineProperty(Ng,"__esModule",{value:!0}),Ng.Grayscale=void 0;const t=function(e){let r=e.data,n=r.length,i,a;for(i=0;i<n;i+=4)a=.34*r[i]+.5*r[i+1]+.16*r[i+2],r[i]=a,r[i+1]=a,r[i+2]=a};return Ng.Grayscale=t,Ng}var Pg={},l4;function wV(){if(l4)return Pg;l4=1,Object.defineProperty(Pg,"__esModule",{value:!0}),Pg.HSL=void 0;const t=Cr(),e=yi(),r=Tr();t.Factory.addGetterSetter(e.Node,"hue",0,(0,r.getNumberValidator)(),t.Factory.afterSetFilter),t.Factory.addGetterSetter(e.Node,"saturation",0,(0,r.getNumberValidator)(),t.Factory.afterSetFilter),t.Factory.addGetterSetter(e.Node,"luminance",0,(0,r.getNumberValidator)(),t.Factory.afterSetFilter);const n=function(i){let a=i.data,s=a.length,o=1,l=Math.pow(2,this.saturation()),u=Math.abs(this.hue()+360)%360,c=this.luminance()*127,f;const p=o*l*Math.cos(u*Math.PI/180),v=o*l*Math.sin(u*Math.PI/180),y=.299*o+.701*p+.167*v,S=.587*o-.587*p+.33*v,w=.114*o-.114*p-.497*v,T=.299*o-.299*p-.328*v,_=.587*o+.413*p+.035*v,C=.114*o-.114*p+.293*v,N=.299*o-.3*p+1.25*v,A=.587*o-.586*p-1.05*v,O=.114*o+.886*p-.2*v;let j,D,F,B;for(f=0;f<s;f+=4)j=a[f+0],D=a[f+1],F=a[f+2],B=a[f+3],a[f+0]=y*j+S*D+w*F+c,a[f+1]=T*j+_*D+C*F+c,a[f+2]=N*j+A*D+O*F+c,a[f+3]=B};return Pg.HSL=n,Pg}var Mg={},u4;function SV(){if(u4)return Mg;u4=1,Object.defineProperty(Mg,"__esModule",{value:!0}),Mg.HSV=void 0;const t=Cr(),e=yi(),r=Tr(),n=function(i){const a=i.data,s=a.length,o=Math.pow(2,this.value()),l=Math.pow(2,this.saturation()),u=Math.abs(this.hue()+360)%360,c=o*l*Math.cos(u*Math.PI/180),f=o*l*Math.sin(u*Math.PI/180),p=.299*o+.701*c+.167*f,v=.587*o-.587*c+.33*f,y=.114*o-.114*c-.497*f,S=.299*o-.299*c-.328*f,w=.587*o+.413*c+.035*f,T=.114*o-.114*c+.293*f,_=.299*o-.3*c+1.25*f,C=.587*o-.586*c-1.05*f,N=.114*o+.886*c-.2*f;let A,O,j,D;for(let F=0;F<s;F+=4)A=a[F+0],O=a[F+1],j=a[F+2],D=a[F+3],a[F+0]=p*A+v*O+y*j,a[F+1]=S*A+w*O+T*j,a[F+2]=_*A+C*O+N*j,a[F+3]=D};return Mg.HSV=n,t.Factory.addGetterSetter(e.Node,"hue",0,(0,r.getNumberValidator)(),t.Factory.afterSetFilter),t.Factory.addGetterSetter(e.Node,"saturation",0,(0,r.getNumberValidator)(),t.Factory.afterSetFilter),t.Factory.addGetterSetter(e.Node,"value",0,(0,r.getNumberValidator)(),t.Factory.afterSetFilter),Mg}var Ag={},c4;function kV(){if(c4)return Ag;c4=1,Object.defineProperty(Ag,"__esModule",{value:!0}),Ag.Invert=void 0;const t=function(e){let r=e.data,n=r.length,i;for(i=0;i<n;i+=4)r[i]=255-r[i],r[i+1]=255-r[i+1],r[i+2]=255-r[i+2]};return Ag.Invert=t,Ag}var Lg={},d4;function _V(){if(d4)return Lg;d4=1,Object.defineProperty(Lg,"__esModule",{value:!0}),Lg.Kaleidoscope=void 0;const t=Cr(),e=yi(),r=si(),n=Tr(),i=function(o,l,u){let c=o.data,f=l.data,p=o.width,v=o.height,y=u.polarCenterX||p/2,S=u.polarCenterY||v/2,w,T,_,C=0,N=0,A=0,O=0,j,D=Math.sqrt(y*y+S*S);T=p-y,_=v-S,j=Math.sqrt(T*T+_*_),D=j>D?j:D;let F=v,B=p,$,Z,I=360/B*Math.PI/180,q,U;for(Z=0;Z<B;Z+=1)for(q=Math.sin(Z*I),U=Math.cos(Z*I),$=0;$<F;$+=1)T=Math.floor(y+D*$/F*U),_=Math.floor(S+D*$/F*q),w=(_*p+T)*4,C=c[w+0],N=c[w+1],A=c[w+2],O=c[w+3],w=(Z+$*p)*4,f[w+0]=C,f[w+1]=N,f[w+2]=A,f[w+3]=O},a=function(o,l,u){let c=o.data,f=l.data,p=o.width,v=o.height,y=u.polarCenterX||p/2,S=u.polarCenterY||v/2,w,T,_,C,N,A=0,O=0,j=0,D=0,F,B=Math.sqrt(y*y+S*S);T=p-y,_=v-S,F=Math.sqrt(T*T+_*_),B=F>B?F:B;let $=v,Z=p,I,q,U=0,W,Y;for(T=0;T<p;T+=1)for(_=0;_<v;_+=1)C=T-y,N=_-S,I=Math.sqrt(C*C+N*N)*$/B,q=(Math.atan2(N,C)*180/Math.PI+360+U)%360,q=q*Z/360,W=Math.floor(q),Y=Math.floor(I),w=(Y*p+W)*4,A=c[w+0],O=c[w+1],j=c[w+2],D=c[w+3],w=(_*p+T)*4,f[w+0]=A,f[w+1]=O,f[w+2]=j,f[w+3]=D},s=function(o){const l=o.width,u=o.height;let c,f,p,v,y,S,w,T,_,C,N=Math.round(this.kaleidoscopePower());const A=Math.round(this.kaleidoscopeAngle()),O=Math.floor(l*(A%360)/360);if(N<1)return;const j=r.Util.createCanvasElement();j.width=l,j.height=u;const D=j.getContext("2d").getImageData(0,0,l,u);r.Util.releaseCanvas(j),i(o,D,{polarCenterX:l/2,polarCenterY:u/2});let F=l/Math.pow(2,N);for(;F<=8;)F=F*2,N-=1;F=Math.ceil(F);let B=F,$=0,Z=B,I=1;for(O+F>l&&($=B,Z=0,I=-1),f=0;f<u;f+=1)for(c=$;c!==Z;c+=I)p=Math.round(c+O)%l,_=(l*f+p)*4,y=D.data[_+0],S=D.data[_+1],w=D.data[_+2],T=D.data[_+3],C=(l*f+c)*4,D.data[C+0]=y,D.data[C+1]=S,D.data[C+2]=w,D.data[C+3]=T;for(f=0;f<u;f+=1)for(B=Math.floor(F),v=0;v<N;v+=1){for(c=0;c<B+1;c+=1)_=(l*f+c)*4,y=D.data[_+0],S=D.data[_+1],w=D.data[_+2],T=D.data[_+3],C=(l*f+B*2-c-1)*4,D.data[C+0]=y,D.data[C+1]=S,D.data[C+2]=w,D.data[C+3]=T;B*=2}a(D,o,{})};return Lg.Kaleidoscope=s,t.Factory.addGetterSetter(e.Node,"kaleidoscopePower",2,(0,n.getNumberValidator)(),t.Factory.afterSetFilter),t.Factory.addGetterSetter(e.Node,"kaleidoscopeAngle",0,(0,n.getNumberValidator)(),t.Factory.afterSetFilter),Lg}var Rg={},f4;function CV(){if(f4)return Rg;f4=1,Object.defineProperty(Rg,"__esModule",{value:!0}),Rg.Mask=void 0;const t=Cr(),e=yi(),r=Tr();function n(p,v,y){let S=(y*p.width+v)*4;const w=[];return w.push(p.data[S++],p.data[S++],p.data[S++],p.data[S++]),w}function i(p,v){return Math.sqrt(Math.pow(p[0]-v[0],2)+Math.pow(p[1]-v[1],2)+Math.pow(p[2]-v[2],2))}function a(p){const v=[0,0,0];for(let y=0;y<p.length;y++)v[0]+=p[y][0],v[1]+=p[y][1],v[2]+=p[y][2];return v[0]/=p.length,v[1]/=p.length,v[2]/=p.length,v}function s(p,v){const y=n(p,0,0),S=n(p,p.width-1,0),w=n(p,0,p.height-1),T=n(p,p.width-1,p.height-1),_=v||10;if(i(y,S)<_&&i(S,T)<_&&i(T,w)<_&&i(w,y)<_){const C=a([S,y,T,w]),N=[];for(let A=0;A<p.width*p.height;A++){const O=i(C,[p.data[A*4],p.data[A*4+1],p.data[A*4+2]]);N[A]=O<_?0:255}return N}}function o(p,v){for(let y=0;y<p.width*p.height;y++)p.data[4*y+3]=v[y]}function l(p,v,y){const S=[1,1,1,1,0,1,1,1,1],w=Math.round(Math.sqrt(S.length)),T=Math.floor(w/2),_=[];for(let C=0;C<y;C++)for(let N=0;N<v;N++){const A=C*v+N;let O=0;for(let j=0;j<w;j++)for(let D=0;D<w;D++){const F=C+j-T,B=N+D-T;if(F>=0&&F<y&&B>=0&&B<v){const $=F*v+B,Z=S[j*w+D];O+=p[$]*Z}}_[A]=O===2040?255:0}return _}function u(p,v,y){const S=[1,1,1,1,1,1,1,1,1],w=Math.round(Math.sqrt(S.length)),T=Math.floor(w/2),_=[];for(let C=0;C<y;C++)for(let N=0;N<v;N++){const A=C*v+N;let O=0;for(let j=0;j<w;j++)for(let D=0;D<w;D++){const F=C+j-T,B=N+D-T;if(F>=0&&F<y&&B>=0&&B<v){const $=F*v+B,Z=S[j*w+D];O+=p[$]*Z}}_[A]=O>=1020?255:0}return _}function c(p,v,y){const S=[.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111],w=Math.round(Math.sqrt(S.length)),T=Math.floor(w/2),_=[];for(let C=0;C<y;C++)for(let N=0;N<v;N++){const A=C*v+N;let O=0;for(let j=0;j<w;j++)for(let D=0;D<w;D++){const F=C+j-T,B=N+D-T;if(F>=0&&F<y&&B>=0&&B<v){const $=F*v+B,Z=S[j*w+D];O+=p[$]*Z}}_[A]=O}return _}const f=function(p){let v=this.threshold(),y=s(p,v);return y&&(y=l(y,p.width,p.height),y=u(y,p.width,p.height),y=c(y,p.width,p.height),o(p,y)),p};return Rg.Mask=f,t.Factory.addGetterSetter(e.Node,"threshold",0,(0,r.getNumberValidator)(),t.Factory.afterSetFilter),Rg}var Og={},h4;function EV(){if(h4)return Og;h4=1,Object.defineProperty(Og,"__esModule",{value:!0}),Og.Noise=void 0;const t=Cr(),e=yi(),r=Tr(),n=function(i){const a=this.noise()*255,s=i.data,o=s.length,l=a/2;for(let u=0;u<o;u+=4)s[u+0]+=l-2*l*Math.random(),s[u+1]+=l-2*l*Math.random(),s[u+2]+=l-2*l*Math.random()};return Og.Noise=n,t.Factory.addGetterSetter(e.Node,"noise",.2,(0,r.getNumberValidator)(),t.Factory.afterSetFilter),Og}var Dg={},p4;function TV(){if(p4)return Dg;p4=1,Object.defineProperty(Dg,"__esModule",{value:!0}),Dg.Pixelate=void 0;const t=Cr(),e=si(),r=yi(),n=Tr(),i=function(a){let s=Math.ceil(this.pixelSize()),o=a.width,l=a.height,u,c,f,p,v,y,S,w=Math.ceil(o/s),T=Math.ceil(l/s),_,C,N,A,O,j,D,F=a.data;if(s<=0){e.Util.error("pixelSize value can not be <= 0");return}for(O=0;O<w;O+=1)for(j=0;j<T;j+=1){for(p=0,v=0,y=0,S=0,_=O*s,C=_+s,N=j*s,A=N+s,D=0,u=_;u<C;u+=1)if(!(u>=o))for(c=N;c<A;c+=1)c>=l||(f=(o*c+u)*4,p+=F[f+0],v+=F[f+1],y+=F[f+2],S+=F[f+3],D+=1);for(p=p/D,v=v/D,y=y/D,S=S/D,u=_;u<C;u+=1)if(!(u>=o))for(c=N;c<A;c+=1)c>=l||(f=(o*c+u)*4,F[f+0]=p,F[f+1]=v,F[f+2]=y,F[f+3]=S)}};return Dg.Pixelate=i,t.Factory.addGetterSetter(r.Node,"pixelSize",8,(0,n.getNumberValidator)(),t.Factory.afterSetFilter),Dg}var Ig={},m4;function NV(){if(m4)return Ig;m4=1,Object.defineProperty(Ig,"__esModule",{value:!0}),Ig.Posterize=void 0;const t=Cr(),e=yi(),r=Tr(),n=function(i){let a=Math.round(this.levels()*254)+1,s=i.data,o=s.length,l=255/a,u;for(u=0;u<o;u+=1)s[u]=Math.floor(s[u]/l)*l};return Ig.Posterize=n,t.Factory.addGetterSetter(e.Node,"levels",.5,(0,r.getNumberValidator)(),t.Factory.afterSetFilter),Ig}var jg={},g4;function PV(){if(g4)return jg;g4=1,Object.defineProperty(jg,"__esModule",{value:!0}),jg.RGB=void 0;const t=Cr(),e=yi(),r=Tr(),n=function(i){let a=i.data,s=a.length,o=this.red(),l=this.green(),u=this.blue(),c,f;for(c=0;c<s;c+=4)f=(.34*a[c]+.5*a[c+1]+.16*a[c+2])/255,a[c]=f*o,a[c+1]=f*l,a[c+2]=f*u,a[c+3]=a[c+3]};return jg.RGB=n,t.Factory.addGetterSetter(e.Node,"red",0,function(i){return this._filterUpToDate=!1,i>255?255:i<0?0:Math.round(i)}),t.Factory.addGetterSetter(e.Node,"green",0,function(i){return this._filterUpToDate=!1,i>255?255:i<0?0:Math.round(i)}),t.Factory.addGetterSetter(e.Node,"blue",0,r.RGBComponent,t.Factory.afterSetFilter),jg}var Fg={},v4;function MV(){if(v4)return Fg;v4=1,Object.defineProperty(Fg,"__esModule",{value:!0}),Fg.RGBA=void 0;const t=Cr(),e=yi(),r=Tr(),n=function(i){const a=i.data,s=a.length,o=this.red(),l=this.green(),u=this.blue(),c=this.alpha();for(let f=0;f<s;f+=4){const p=1-c;a[f]=o*c+a[f]*p,a[f+1]=l*c+a[f+1]*p,a[f+2]=u*c+a[f+2]*p}};return Fg.RGBA=n,t.Factory.addGetterSetter(e.Node,"red",0,function(i){return this._filterUpToDate=!1,i>255?255:i<0?0:Math.round(i)}),t.Factory.addGetterSetter(e.Node,"green",0,function(i){return this._filterUpToDate=!1,i>255?255:i<0?0:Math.round(i)}),t.Factory.addGetterSetter(e.Node,"blue",0,r.RGBComponent,t.Factory.afterSetFilter),t.Factory.addGetterSetter(e.Node,"alpha",1,function(i){return this._filterUpToDate=!1,i>1?1:i<0?0:i}),Fg}var Bg={},y4;function AV(){if(y4)return Bg;y4=1,Object.defineProperty(Bg,"__esModule",{value:!0}),Bg.Sepia=void 0;const t=function(e){let r=e.data,n=r.length,i,a,s,o;for(i=0;i<n;i+=4)a=r[i+0],s=r[i+1],o=r[i+2],r[i+0]=Math.min(255,a*.393+s*.769+o*.189),r[i+1]=Math.min(255,a*.349+s*.686+o*.168),r[i+2]=Math.min(255,a*.272+s*.534+o*.131)};return Bg.Sepia=t,Bg}var zg={},x4;function LV(){if(x4)return zg;x4=1,Object.defineProperty(zg,"__esModule",{value:!0}),zg.Solarize=void 0;const t=function(e){const r=e.data,n=e.width,i=e.height,a=n*4;let s=i;do{const o=(s-1)*a;let l=n;do{const u=o+(l-1)*4;let c=r[u],f=r[u+1],p=r[u+2];c>127&&(c=255-c),f>127&&(f=255-f),p>127&&(p=255-p),r[u]=c,r[u+1]=f,r[u+2]=p}while(--l)}while(--s)};return zg.Solarize=t,zg}var Ug={},b4;function RV(){if(b4)return Ug;b4=1,Object.defineProperty(Ug,"__esModule",{value:!0}),Ug.Threshold=void 0;const t=Cr(),e=yi(),r=Tr(),n=function(i){const a=this.threshold()*255,s=i.data,o=s.length;for(let l=0;l<o;l+=1)s[l]=s[l]<a?0:255};return Ug.Threshold=n,t.Factory.addGetterSetter(e.Node,"threshold",.5,(0,r.getNumberValidator)(),t.Factory.afterSetFilter),Ug}var w4;function OV(){if(w4)return tg;w4=1,Object.defineProperty(tg,"__esModule",{value:!0}),tg.Konva=void 0;const t=ak(),e=tV(),r=nV(),n=iV(),i=aV(),a=sV(),s=oV(),o=UL(),l=R_(),u=GL(),c=lV(),f=uV(),p=cV(),v=dV(),y=VL(),S=fV(),w=hV(),T=pV(),_=mV(),C=gV(),N=vV(),A=yV(),O=xV(),j=bV(),D=wV(),F=SV(),B=kV(),$=_V(),Z=CV(),I=EV(),q=TV(),U=NV(),W=PV(),Y=MV(),Q=AV(),ne=LV(),re=RV();return tg.Konva=t.Konva.Util._assign(t.Konva,{Arc:e.Arc,Arrow:r.Arrow,Circle:n.Circle,Ellipse:i.Ellipse,Image:a.Image,Label:s.Label,Tag:s.Tag,Line:o.Line,Path:l.Path,Rect:u.Rect,RegularPolygon:c.RegularPolygon,Ring:f.Ring,Sprite:p.Sprite,Star:v.Star,Text:y.Text,TextPath:S.TextPath,Transformer:w.Transformer,Wedge:T.Wedge,Filters:{Blur:_.Blur,Brighten:C.Brighten,Contrast:N.Contrast,Emboss:A.Emboss,Enhance:O.Enhance,Grayscale:j.Grayscale,HSL:D.HSL,HSV:F.HSV,Invert:B.Invert,Kaleidoscope:$.Kaleidoscope,Mask:Z.Mask,Noise:I.Noise,Pixelate:q.Pixelate,Posterize:U.Posterize,RGB:W.RGB,RGBA:Y.RGBA,Sepia:Q.Sepia,Solarize:ne.Solarize,Threshold:re.Threshold}}),tg}var DV=Yy.exports,S4;function IV(){if(S4)return Yy.exports;S4=1,Object.defineProperty(DV,"__esModule",{value:!0});const t=OV();return Yy.exports=t.Konva,Yy.exports}IV();var yy={exports:{}},k4;function jV(){return k4||(k4=1,(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.Konva=void 0;var r=ak();Object.defineProperty(e,"Konva",{enumerable:!0,get:function(){return r.Konva}});const n=ak();t.exports=n.Konva})(yy,yy.exports)),yy.exports}var FV=jV();const Lv=Mh(FV);var I2={exports:{}};var j2,_4;function BV(){return _4||(_4=1,j2=function(e){var r={},n=um(),i=e_(),a=Object.assign;function s(x){for(var b="https://reactjs.org/docs/error-decoder.html?invariant="+x,M=1;M<arguments.length;M++)b+="&args[]="+encodeURIComponent(arguments[M]);return"Minified React error #"+x+"; visit "+b+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,l=Symbol.for("react.element"),u=Symbol.for("react.portal"),c=Symbol.for("react.fragment"),f=Symbol.for("react.strict_mode"),p=Symbol.for("react.profiler"),v=Symbol.for("react.provider"),y=Symbol.for("react.context"),S=Symbol.for("react.forward_ref"),w=Symbol.for("react.suspense"),T=Symbol.for("react.suspense_list"),_=Symbol.for("react.memo"),C=Symbol.for("react.lazy"),N=Symbol.for("react.offscreen"),A=Symbol.iterator;function O(x){return x===null||typeof x!="object"?null:(x=A&&x[A]||x["@@iterator"],typeof x=="function"?x:null)}function j(x){if(x==null)return null;if(typeof x=="function")return x.displayName||x.name||null;if(typeof x=="string")return x;switch(x){case c:return"Fragment";case u:return"Portal";case p:return"Profiler";case f:return"StrictMode";case w:return"Suspense";case T:return"SuspenseList"}if(typeof x=="object")switch(x.$$typeof){case y:return(x.displayName||"Context")+".Consumer";case v:return(x._context.displayName||"Context")+".Provider";case S:var b=x.render;return x=x.displayName,x||(x=b.displayName||b.name||"",x=x!==""?"ForwardRef("+x+")":"ForwardRef"),x;case _:return b=x.displayName||null,b!==null?b:j(x.type)||"Memo";case C:b=x._payload,x=x._init;try{return j(x(b))}catch{}}return null}function D(x){var b=x.type;switch(x.tag){case 24:return"Cache";case 9:return(b.displayName||"Context")+".Consumer";case 10:return(b._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return x=b.render,x=x.displayName||x.name||"",b.displayName||(x!==""?"ForwardRef("+x+")":"ForwardRef");case 7:return"Fragment";case 5:return b;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return j(b);case 8:return b===f?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof b=="function")return b.displayName||b.name||null;if(typeof b=="string")return b}return null}function F(x){var b=x,M=x;if(x.alternate)for(;b.return;)b=b.return;else{x=b;do b=x,(b.flags&4098)!==0&&(M=b.return),x=b.return;while(x)}return b.tag===3?M:null}function B(x){if(F(x)!==x)throw Error(s(188))}function $(x){var b=x.alternate;if(!b){if(b=F(x),b===null)throw Error(s(188));return b!==x?null:x}for(var M=x,z=b;;){var K=M.return;if(K===null)break;var ee=K.alternate;if(ee===null){if(z=K.return,z!==null){M=z;continue}break}if(K.child===ee.child){for(ee=K.child;ee;){if(ee===M)return B(K),x;if(ee===z)return B(K),b;ee=ee.sibling}throw Error(s(188))}if(M.return!==z.return)M=K,z=ee;else{for(var fe=!1,Ne=K.child;Ne;){if(Ne===M){fe=!0,M=K,z=ee;break}if(Ne===z){fe=!0,z=K,M=ee;break}Ne=Ne.sibling}if(!fe){for(Ne=ee.child;Ne;){if(Ne===M){fe=!0,M=ee,z=K;break}if(Ne===z){fe=!0,z=ee,M=K;break}Ne=Ne.sibling}if(!fe)throw Error(s(189))}}if(M.alternate!==z)throw Error(s(190))}if(M.tag!==3)throw Error(s(188));return M.stateNode.current===M?x:b}function Z(x){return x=$(x),x!==null?I(x):null}function I(x){if(x.tag===5||x.tag===6)return x;for(x=x.child;x!==null;){var b=I(x);if(b!==null)return b;x=x.sibling}return null}function q(x){if(x.tag===5||x.tag===6)return x;for(x=x.child;x!==null;){if(x.tag!==4){var b=q(x);if(b!==null)return b}x=x.sibling}return null}var U=Array.isArray,W=e.getPublicInstance,Y=e.getRootHostContext,Q=e.getChildHostContext,ne=e.prepareForCommit,re=e.resetAfterCommit,H=e.createInstance,te=e.appendInitialChild,ie=e.finalizeInitialChildren,de=e.prepareUpdate,ge=e.shouldSetTextContent,ye=e.createTextInstance,ae=e.scheduleTimeout,pe=e.cancelTimeout,le=e.noTimeout,me=e.isPrimaryRenderer,he=e.supportsMutation,xe=e.supportsPersistence,we=e.supportsHydration,Ge=e.getInstanceFromNode,qe=e.preparePortalMount,wt=e.getCurrentEventPriority,et=e.detachDeletedInstance,at=e.supportsMicrotasks,je=e.scheduleMicrotask,Re=e.supportsTestSelectors,nt=e.findFiberRoot,Ce=e.getBoundingRect,Fe=e.getTextContent,Ke=e.isHiddenSubtree,pt=e.matchAccessibilityRole,vt=e.setFocusIfFocusable,At=e.setupIntersectionObserver,Ut=e.appendChild,nr=e.appendChildToContainer,Ct=e.commitTextUpdate,ct=e.commitMount,We=e.commitUpdate,ce=e.insertBefore,ve=e.insertInContainerBefore,_e=e.removeChild,Te=e.removeChildFromContainer,Le=e.resetTextContent,Xe=e.hideInstance,He=e.hideTextInstance,dt=e.unhideInstance,ft=e.unhideTextInstance,Pt=e.clearContainer,qt=e.cloneInstance,$t=e.createContainerChildSet,kt=e.appendChildToContainerChildSet,Zt=e.finalizeContainerChildren,er=e.replaceContainerChildren,Ar=e.cloneHiddenInstance,xr=e.cloneHiddenTextInstance,$e=e.canHydrateInstance,yt=e.canHydrateTextInstance,Et=e.canHydrateSuspenseInstance,rr=e.isSuspenseInstancePending,zt=e.isSuspenseInstanceFallback,lt=e.getSuspenseInstanceFallbackErrorDetails,Pr=e.registerSuspenseInstanceRetry,zr=e.getNextHydratableSibling,wi=e.getFirstHydratableChild,Va=e.getFirstHydratableChildWithinContainer,mo=e.getFirstHydratableChildWithinSuspenseInstance,Si=e.hydrateInstance,gn=e.hydrateTextInstance,Pn=e.hydrateSuspenseInstance,ki=e.getNextHydratableInstanceAfterSuspenseInstance,go=e.commitHydratedContainer,Oi=e.commitHydratedSuspenseInstance,Au=e.clearSuspenseBoundary,Lu=e.clearSuspenseBoundaryFromContainer,yf=e.shouldDeleteUnhydratedTailInstances,Dl=e.didNotMatchHydratedContainerTextInstance,cn=e.didNotMatchHydratedTextInstance,Ru;function Ys(x){if(Ru===void 0)try{throw Error()}catch(M){var b=M.stack.trim().match(/\n( *(at )?)/);Ru=b&&b[1]||""}return`
`+Ru+x}var Il=!1;function Ha(x,b){if(!x||Il)return"";Il=!0;var M=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(b)if(b=function(){throw Error()},Object.defineProperty(b.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(b,[])}catch(ot){var z=ot}Reflect.construct(x,[],b)}else{try{b.call()}catch(ot){z=ot}x.call(b.prototype)}else{try{throw Error()}catch(ot){z=ot}x()}}catch(ot){if(ot&&z&&typeof ot.stack=="string"){for(var K=ot.stack.split(`
`),ee=z.stack.split(`
`),fe=K.length-1,Ne=ee.length-1;1<=fe&&0<=Ne&&K[fe]!==ee[Ne];)Ne--;for(;1<=fe&&0<=Ne;fe--,Ne--)if(K[fe]!==ee[Ne]){if(fe!==1||Ne!==1)do if(fe--,Ne--,0>Ne||K[fe]!==ee[Ne]){var Ue=`
`+K[fe].replace(" at new "," at ");return x.displayName&&Ue.includes("<anonymous>")&&(Ue=Ue.replace("<anonymous>",x.displayName)),Ue}while(1<=fe&&0<=Ne);break}}}finally{Il=!1,Error.prepareStackTrace=M}return(x=x?x.displayName||x.name:"")?Ys(x):""}var Zo=Object.prototype.hasOwnProperty,ma=[],ga=-1;function _n(x){return{current:x}}function Mr(x){0>ga||(x.current=ma[ga],ma[ga]=null,ga--)}function ht(x,b){ga++,ma[ga]=x.current,x.current=b}var kr={},vn=_n(kr),Qr=_n(!1),Ur=kr;function va(x,b){var M=x.type.contextTypes;if(!M)return kr;var z=x.stateNode;if(z&&z.__reactInternalMemoizedUnmaskedChildContext===b)return z.__reactInternalMemoizedMaskedChildContext;var K={},ee;for(ee in M)K[ee]=b[ee];return z&&(x=x.stateNode,x.__reactInternalMemoizedUnmaskedChildContext=b,x.__reactInternalMemoizedMaskedChildContext=K),K}function Ft(x){return x=x.childContextTypes,x!=null}function Lr(){Mr(Qr),Mr(vn)}function Ec(x,b,M){if(vn.current!==kr)throw Error(s(168));ht(vn,b),ht(Qr,M)}function Ou(x,b,M){var z=x.stateNode;if(b=b.childContextTypes,typeof z.getChildContext!="function")return M;z=z.getChildContext();for(var K in z)if(!(K in b))throw Error(s(108,D(x)||"Unknown",K));return a({},M,z)}function li(x){return x=(x=x.stateNode)&&x.__reactInternalMemoizedMergedChildContext||kr,Ur=vn.current,ht(vn,x),ht(Qr,Qr.current),!0}function xf(x,b,M){var z=x.stateNode;if(!z)throw Error(s(169));M?(x=Ou(x,b,Ur),z.__reactInternalMemoizedMergedChildContext=x,Mr(Qr),Mr(vn),ht(vn,x)):Mr(Qr),ht(Qr,M)}var _i=Math.clz32?Math.clz32:Xs,cs=Math.log,Mn=Math.LN2;function Xs(x){return x>>>=0,x===0?32:31-(cs(x)/Mn|0)|0}var mr=64,Qs=4194304;function vo(x){switch(x&-x){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return x&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return x&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return x}}function Ns(x,b){var M=x.pendingLanes;if(M===0)return 0;var z=0,K=x.suspendedLanes,ee=x.pingedLanes,fe=M&268435455;if(fe!==0){var Ne=fe&~K;Ne!==0?z=vo(Ne):(ee&=fe,ee!==0&&(z=vo(ee)))}else fe=M&~K,fe!==0?z=vo(fe):ee!==0&&(z=vo(ee));if(z===0)return 0;if(b!==0&&b!==z&&(b&K)===0&&(K=z&-z,ee=b&-b,K>=ee||K===16&&(ee&4194240)!==0))return b;if((z&4)!==0&&(z|=M&16),b=x.entangledLanes,b!==0)for(x=x.entanglements,b&=z;0<b;)M=31-_i(b),K=1<<M,z|=x[M],b&=~K;return z}function Tc(x,b){switch(x){case 1:case 2:case 4:return b+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return b+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Nc(x,b){for(var M=x.suspendedLanes,z=x.pingedLanes,K=x.expirationTimes,ee=x.pendingLanes;0<ee;){var fe=31-_i(ee),Ne=1<<fe,Ue=K[fe];Ue===-1?((Ne&M)===0||(Ne&z)!==0)&&(K[fe]=Tc(Ne,b)):Ue<=b&&(x.expiredLanes|=Ne),ee&=~Ne}}function Yo(x){return x=x.pendingLanes&-1073741825,x!==0?x:x&1073741824?1073741824:0}function jl(){var x=mr;return mr<<=1,(mr&4194240)===0&&(mr=64),x}function yo(x){for(var b=[],M=0;31>M;M++)b.push(x);return b}function Di(x,b,M){x.pendingLanes|=b,b!==536870912&&(x.suspendedLanes=0,x.pingedLanes=0),x=x.eventTimes,b=31-_i(b),x[b]=M}function Js(x,b){var M=x.pendingLanes&~b;x.pendingLanes=b,x.suspendedLanes=0,x.pingedLanes=0,x.expiredLanes&=b,x.mutableReadLanes&=b,x.entangledLanes&=b,b=x.entanglements;var z=x.eventTimes;for(x=x.expirationTimes;0<M;){var K=31-_i(M),ee=1<<K;b[K]=0,z[K]=-1,x[K]=-1,M&=~ee}}function Wa(x,b){var M=x.entangledLanes|=b;for(x=x.entanglements;M;){var z=31-_i(M),K=1<<z;K&b|x[z]&b&&(x[z]|=b),M&=~K}}var gr=0;function tr(x){return x&=-x,1<x?4<x?(x&268435455)!==0?16:536870912:4:1}var Wn=i.unstable_scheduleCallback,Gr=i.unstable_cancelCallback,bf=i.unstable_shouldYield,Xo=i.unstable_requestPaint,An=i.unstable_now,Fl=i.unstable_ImmediatePriority,Ps=i.unstable_UserBlockingPriority,Bl=i.unstable_NormalPriority,Du=i.unstable_IdlePriority,nn=null,Ln=null;function Qo(x){if(Ln&&typeof Ln.onCommitFiberRoot=="function")try{Ln.onCommitFiberRoot(nn,x,void 0,(x.current.flags&128)===128)}catch{}}function Iu(x,b){return x===b&&(x!==0||1/x===1/b)||x!==x&&b!==b}var ds=typeof Object.is=="function"?Object.is:Iu,Ms=null,xo=!1,zl=!1;function ju(x){Ms===null?Ms=[x]:Ms.push(x)}function br(x){xo=!0,ju(x)}function ui(){if(!zl&&Ms!==null){zl=!0;var x=0,b=gr;try{var M=Ms;for(gr=1;x<M.length;x++){var z=M[x];do z=z(!0);while(z!==null)}Ms=null,xo=!1}catch(K){throw Ms!==null&&(Ms=Ms.slice(x+1)),Wn(Fl,ui),K}finally{gr=b,zl=!1}}return null}var Zn=[],ya=0,Ul=null,Jo=0,ci=[],xa=0,Rn=null,qi=1,fs="";function ba(x,b){Zn[ya++]=Jo,Zn[ya++]=Ul,Ul=x,Jo=b}function jh(x,b,M){ci[xa++]=qi,ci[xa++]=fs,ci[xa++]=Rn,Rn=x;var z=qi;x=fs;var K=32-_i(z)-1;z&=~(1<<K),M+=1;var ee=32-_i(b)+K;if(30<ee){var fe=K-K%5;ee=(z&(1<<fe)-1).toString(32),z>>=fe,K-=fe,qi=1<<32-_i(b)+K|M<<K|z,fs=ee+x}else qi=1<<ee|M<<K|z,fs=x}function $i(x){x.return!==null&&(ba(x,1),jh(x,1,0))}function Fu(x){for(;x===Ul;)Ul=Zn[--ya],Zn[ya]=null,Jo=Zn[--ya],Zn[ya]=null;for(;x===Rn;)Rn=ci[--xa],ci[xa]=null,fs=ci[--xa],ci[xa]=null,qi=ci[--xa],ci[xa]=null}var Yn=null,yn=null,$r=!1,Gl=!1,wa=null;function Fh(x,b){var M=ws(5,null,null,0);M.elementType="DELETED",M.stateNode=b,M.return=x,b=x.deletions,b===null?(x.deletions=[M],x.flags|=16):b.push(M)}function Bu(x,b){switch(x.tag){case 5:return b=$e(b,x.type,x.pendingProps),b!==null?(x.stateNode=b,Yn=x,yn=wi(b),!0):!1;case 6:return b=yt(b,x.pendingProps),b!==null?(x.stateNode=b,Yn=x,yn=null,!0):!1;case 13:if(b=Et(b),b!==null){var M=Rn!==null?{id:qi,overflow:fs}:null;return x.memoizedState={dehydrated:b,treeContext:M,retryLane:1073741824},M=ws(18,null,null,0),M.stateNode=b,M.return=x,x.child=M,Yn=x,yn=null,!0}return!1;default:return!1}}function Pc(x){return(x.mode&1)!==0&&(x.flags&128)===0}function wf(x){if($r){var b=yn;if(b){var M=b;if(!Bu(x,b)){if(Pc(x))throw Error(s(418));b=zr(M);var z=Yn;b&&Bu(x,b)?Fh(z,M):(x.flags=x.flags&-4097|2,$r=!1,Yn=x)}}else{if(Pc(x))throw Error(s(418));x.flags=x.flags&-4097|2,$r=!1,Yn=x}}}function Bh(x){for(x=x.return;x!==null&&x.tag!==5&&x.tag!==3&&x.tag!==13;)x=x.return;Yn=x}function Vl(x){if(!we||x!==Yn)return!1;if(!$r)return Bh(x),$r=!0,!1;if(x.tag!==3&&(x.tag!==5||yf(x.type)&&!ge(x.type,x.memoizedProps))){var b=yn;if(b){if(Pc(x))throw zh(),Error(s(418));for(;b;)Fh(x,b),b=zr(b)}}if(Bh(x),x.tag===13){if(!we)throw Error(s(316));if(x=x.memoizedState,x=x!==null?x.dehydrated:null,!x)throw Error(s(317));yn=ki(x)}else yn=Yn?zr(x.stateNode):null;return!0}function zh(){for(var x=yn;x;)x=zr(x)}function bo(){we&&(yn=Yn=null,Gl=$r=!1)}function Mc(x){wa===null?wa=[x]:wa.push(x)}var Ac=o.ReactCurrentBatchConfig;function As(x,b){if(ds(x,b))return!0;if(typeof x!="object"||x===null||typeof b!="object"||b===null)return!1;var M=Object.keys(x),z=Object.keys(b);if(M.length!==z.length)return!1;for(z=0;z<M.length;z++){var K=M[z];if(!Zo.call(b,K)||!ds(x[K],b[K]))return!1}return!0}function wm(x){switch(x.tag){case 5:return Ys(x.type);case 16:return Ys("Lazy");case 13:return Ys("Suspense");case 19:return Ys("SuspenseList");case 0:case 2:case 15:return x=Ha(x.type,!1),x;case 11:return x=Ha(x.type.render,!1),x;case 1:return x=Ha(x.type,!0),x;default:return""}}function hs(x,b,M){if(x=M.ref,x!==null&&typeof x!="function"&&typeof x!="object"){if(M._owner){if(M=M._owner,M){if(M.tag!==1)throw Error(s(309));var z=M.stateNode}if(!z)throw Error(s(147,x));var K=z,ee=""+x;return b!==null&&b.ref!==null&&typeof b.ref=="function"&&b.ref._stringRef===ee?b.ref:(b=function(fe){var Ne=K.refs;fe===null?delete Ne[ee]:Ne[ee]=fe},b._stringRef=ee,b)}if(typeof x!="string")throw Error(s(284));if(!M._owner)throw Error(s(290,x))}return x}function Ii(x,b){throw x=Object.prototype.toString.call(b),Error(s(31,x==="[object Object]"?"object with keys {"+Object.keys(b).join(", ")+"}":x))}function Sf(x){var b=x._init;return b(x._payload)}function kf(x){function b(Ie,Pe){if(x){var Ve=Ie.deletions;Ve===null?(Ie.deletions=[Pe],Ie.flags|=16):Ve.push(Pe)}}function M(Ie,Pe){if(!x)return null;for(;Pe!==null;)b(Ie,Pe),Pe=Pe.sibling;return null}function z(Ie,Pe){for(Ie=new Map;Pe!==null;)Pe.key!==null?Ie.set(Pe.key,Pe):Ie.set(Pe.index,Pe),Pe=Pe.sibling;return Ie}function K(Ie,Pe){return Ie=uu(Ie,Pe),Ie.index=0,Ie.sibling=null,Ie}function ee(Ie,Pe,Ve){return Ie.index=Ve,x?(Ve=Ie.alternate,Ve!==null?(Ve=Ve.index,Ve<Pe?(Ie.flags|=2,Pe):Ve):(Ie.flags|=2,Pe)):(Ie.flags|=1048576,Pe)}function fe(Ie){return x&&Ie.alternate===null&&(Ie.flags|=2),Ie}function Ne(Ie,Pe,Ve,_t){return Pe===null||Pe.tag!==6?(Pe=od(Ve,Ie.mode,_t),Pe.return=Ie,Pe):(Pe=K(Pe,Ve),Pe.return=Ie,Pe)}function Ue(Ie,Pe,Ve,_t){var Vt=Ve.type;return Vt===c?Lt(Ie,Pe,Ve.props.children,_t,Ve.key):Pe!==null&&(Pe.elementType===Vt||typeof Vt=="object"&&Vt!==null&&Vt.$$typeof===C&&Sf(Vt)===Pe.type)?(_t=K(Pe,Ve.props),_t.ref=hs(Ie,Pe,Ve),_t.return=Ie,_t):(_t=sp(Ve.type,Ve.key,Ve.props,null,Ie.mode,_t),_t.ref=hs(Ie,Pe,Ve),_t.return=Ie,_t)}function ot(Ie,Pe,Ve,_t){return Pe===null||Pe.tag!==4||Pe.stateNode.containerInfo!==Ve.containerInfo||Pe.stateNode.implementation!==Ve.implementation?(Pe=op(Ve,Ie.mode,_t),Pe.return=Ie,Pe):(Pe=K(Pe,Ve.children||[]),Pe.return=Ie,Pe)}function Lt(Ie,Pe,Ve,_t,Vt){return Pe===null||Pe.tag!==7?(Pe=Bi(Ve,Ie.mode,_t,Vt),Pe.return=Ie,Pe):(Pe=K(Pe,Ve),Pe.return=Ie,Pe)}function lr(Ie,Pe,Ve){if(typeof Pe=="string"&&Pe!==""||typeof Pe=="number")return Pe=od(""+Pe,Ie.mode,Ve),Pe.return=Ie,Pe;if(typeof Pe=="object"&&Pe!==null){switch(Pe.$$typeof){case l:return Ve=sp(Pe.type,Pe.key,Pe.props,null,Ie.mode,Ve),Ve.ref=hs(Ie,null,Pe),Ve.return=Ie,Ve;case u:return Pe=op(Pe,Ie.mode,Ve),Pe.return=Ie,Pe;case C:var _t=Pe._init;return lr(Ie,_t(Pe._payload),Ve)}if(U(Pe)||O(Pe))return Pe=Bi(Pe,Ie.mode,Ve,null),Pe.return=Ie,Pe;Ii(Ie,Pe)}return null}function St(Ie,Pe,Ve,_t){var Vt=Pe!==null?Pe.key:null;if(typeof Ve=="string"&&Ve!==""||typeof Ve=="number")return Vt!==null?null:Ne(Ie,Pe,""+Ve,_t);if(typeof Ve=="object"&&Ve!==null){switch(Ve.$$typeof){case l:return Ve.key===Vt?Ue(Ie,Pe,Ve,_t):null;case u:return Ve.key===Vt?ot(Ie,Pe,Ve,_t):null;case C:return Vt=Ve._init,St(Ie,Pe,Vt(Ve._payload),_t)}if(U(Ve)||O(Ve))return Vt!==null?null:Lt(Ie,Pe,Ve,_t,null);Ii(Ie,Ve)}return null}function on(Ie,Pe,Ve,_t,Vt){if(typeof _t=="string"&&_t!==""||typeof _t=="number")return Ie=Ie.get(Ve)||null,Ne(Pe,Ie,""+_t,Vt);if(typeof _t=="object"&&_t!==null){switch(_t.$$typeof){case l:return Ie=Ie.get(_t.key===null?Ve:_t.key)||null,Ue(Pe,Ie,_t,Vt);case u:return Ie=Ie.get(_t.key===null?Ve:_t.key)||null,ot(Pe,Ie,_t,Vt);case C:var hr=_t._init;return on(Ie,Pe,Ve,hr(_t._payload),Vt)}if(U(_t)||O(_t))return Ie=Ie.get(Ve)||null,Lt(Pe,Ie,_t,Vt,null);Ii(Pe,_t)}return null}function qr(Ie,Pe,Ve,_t){for(var Vt=null,hr=null,ur=Pe,Nr=Pe=0,mi=null;ur!==null&&Nr<Ve.length;Nr++){ur.index>Nr?(mi=ur,ur=null):mi=ur.sibling;var Er=St(Ie,ur,Ve[Nr],_t);if(Er===null){ur===null&&(ur=mi);break}x&&ur&&Er.alternate===null&&b(Ie,ur),Pe=ee(Er,Pe,Nr),hr===null?Vt=Er:hr.sibling=Er,hr=Er,ur=mi}if(Nr===Ve.length)return M(Ie,ur),$r&&ba(Ie,Nr),Vt;if(ur===null){for(;Nr<Ve.length;Nr++)ur=lr(Ie,Ve[Nr],_t),ur!==null&&(Pe=ee(ur,Pe,Nr),hr===null?Vt=ur:hr.sibling=ur,hr=ur);return $r&&ba(Ie,Nr),Vt}for(ur=z(Ie,ur);Nr<Ve.length;Nr++)mi=on(ur,Ie,Nr,Ve[Nr],_t),mi!==null&&(x&&mi.alternate!==null&&ur.delete(mi.key===null?Nr:mi.key),Pe=ee(mi,Pe,Nr),hr===null?Vt=mi:hr.sibling=mi,hr=mi);return x&&ur.forEach(function(na){return b(Ie,na)}),$r&&ba(Ie,Nr),Vt}function Aa(Ie,Pe,Ve,_t){var Vt=O(Ve);if(typeof Vt!="function")throw Error(s(150));if(Ve=Vt.call(Ve),Ve==null)throw Error(s(151));for(var hr=Vt=null,ur=Pe,Nr=Pe=0,mi=null,Er=Ve.next();ur!==null&&!Er.done;Nr++,Er=Ve.next()){ur.index>Nr?(mi=ur,ur=null):mi=ur.sibling;var na=St(Ie,ur,Er.value,_t);if(na===null){ur===null&&(ur=mi);break}x&&ur&&na.alternate===null&&b(Ie,ur),Pe=ee(na,Pe,Nr),hr===null?Vt=na:hr.sibling=na,hr=na,ur=mi}if(Er.done)return M(Ie,ur),$r&&ba(Ie,Nr),Vt;if(ur===null){for(;!Er.done;Nr++,Er=Ve.next())Er=lr(Ie,Er.value,_t),Er!==null&&(Pe=ee(Er,Pe,Nr),hr===null?Vt=Er:hr.sibling=Er,hr=Er);return $r&&ba(Ie,Nr),Vt}for(ur=z(Ie,ur);!Er.done;Nr++,Er=Ve.next())Er=on(ur,Ie,Nr,Er.value,_t),Er!==null&&(x&&Er.alternate!==null&&ur.delete(Er.key===null?Nr:Er.key),Pe=ee(Er,Pe,Nr),hr===null?Vt=Er:hr.sibling=Er,hr=Er);return x&&ur.forEach(function(pb){return b(Ie,pb)}),$r&&ba(Ie,Nr),Vt}function Ro(Ie,Pe,Ve,_t){if(typeof Ve=="object"&&Ve!==null&&Ve.type===c&&Ve.key===null&&(Ve=Ve.props.children),typeof Ve=="object"&&Ve!==null){switch(Ve.$$typeof){case l:e:{for(var Vt=Ve.key,hr=Pe;hr!==null;){if(hr.key===Vt){if(Vt=Ve.type,Vt===c){if(hr.tag===7){M(Ie,hr.sibling),Pe=K(hr,Ve.props.children),Pe.return=Ie,Ie=Pe;break e}}else if(hr.elementType===Vt||typeof Vt=="object"&&Vt!==null&&Vt.$$typeof===C&&Sf(Vt)===hr.type){M(Ie,hr.sibling),Pe=K(hr,Ve.props),Pe.ref=hs(Ie,hr,Ve),Pe.return=Ie,Ie=Pe;break e}M(Ie,hr);break}else b(Ie,hr);hr=hr.sibling}Ve.type===c?(Pe=Bi(Ve.props.children,Ie.mode,_t,Ve.key),Pe.return=Ie,Ie=Pe):(_t=sp(Ve.type,Ve.key,Ve.props,null,Ie.mode,_t),_t.ref=hs(Ie,Pe,Ve),_t.return=Ie,Ie=_t)}return fe(Ie);case u:e:{for(hr=Ve.key;Pe!==null;){if(Pe.key===hr)if(Pe.tag===4&&Pe.stateNode.containerInfo===Ve.containerInfo&&Pe.stateNode.implementation===Ve.implementation){M(Ie,Pe.sibling),Pe=K(Pe,Ve.children||[]),Pe.return=Ie,Ie=Pe;break e}else{M(Ie,Pe);break}else b(Ie,Pe);Pe=Pe.sibling}Pe=op(Ve,Ie.mode,_t),Pe.return=Ie,Ie=Pe}return fe(Ie);case C:return hr=Ve._init,Ro(Ie,Pe,hr(Ve._payload),_t)}if(U(Ve))return qr(Ie,Pe,Ve,_t);if(O(Ve))return Aa(Ie,Pe,Ve,_t);Ii(Ie,Ve)}return typeof Ve=="string"&&Ve!==""||typeof Ve=="number"?(Ve=""+Ve,Pe!==null&&Pe.tag===6?(M(Ie,Pe.sibling),Pe=K(Pe,Ve),Pe.return=Ie,Ie=Pe):(M(Ie,Pe),Pe=od(Ve,Ie.mode,_t),Pe.return=Ie,Ie=Pe),fe(Ie)):M(Ie,Pe)}return Ro}var el=kf(!0),Lc=kf(!1),Hl=_n(null),Rc=null,Wl=null,Oc=null;function _f(){Oc=Wl=Rc=null}function qa(x,b,M){me?(ht(Hl,b._currentValue),b._currentValue=M):(ht(Hl,b._currentValue2),b._currentValue2=M)}function Ls(x){var b=Hl.current;Mr(Hl),me?x._currentValue=b:x._currentValue2=b}function tl(x,b,M){for(;x!==null;){var z=x.alternate;if((x.childLanes&b)!==b?(x.childLanes|=b,z!==null&&(z.childLanes|=b)):z!==null&&(z.childLanes&b)!==b&&(z.childLanes|=b),x===M)break;x=x.return}}function Ki(x,b){Rc=x,Oc=Wl=null,x=x.dependencies,x!==null&&x.firstContext!==null&&((x.lanes&b)!==0&&(jn=!0),x.firstContext=null)}function Sa(x){var b=me?x._currentValue:x._currentValue2;if(Oc!==x)if(x={context:x,memoizedValue:b,next:null},Wl===null){if(Rc===null)throw Error(s(308));Wl=x,Rc.dependencies={lanes:0,firstContext:x}}else Wl=Wl.next=x;return b}var ka=null;function Dc(x){ka===null?ka=[x]:ka.push(x)}function rl(x,b,M,z){var K=b.interleaved;return K===null?(M.next=M,Dc(b)):(M.next=K.next,K.next=M),b.interleaved=M,$a(x,z)}function $a(x,b){x.lanes|=b;var M=x.alternate;for(M!==null&&(M.lanes|=b),M=x,x=x.return;x!==null;)x.childLanes|=b,M=x.alternate,M!==null&&(M.childLanes|=b),M=x,x=x.return;return M.tag===3?M.stateNode:null}var Ci=!1;function Cf(x){x.updateQueue={baseState:x.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function eo(x,b){x=x.updateQueue,b.updateQueue===x&&(b.updateQueue={baseState:x.baseState,firstBaseUpdate:x.firstBaseUpdate,lastBaseUpdate:x.lastBaseUpdate,shared:x.shared,effects:x.effects})}function Ka(x,b){return{eventTime:x,lane:b,tag:0,payload:null,callback:null,next:null}}function to(x,b,M){var z=x.updateQueue;if(z===null)return null;if(z=z.shared,(fr&2)!==0){var K=z.pending;return K===null?b.next=b:(b.next=K.next,K.next=b),z.pending=b,$a(x,M)}return K=z.interleaved,K===null?(b.next=b,Dc(z)):(b.next=K.next,K.next=b),z.interleaved=b,$a(x,M)}function nl(x,b,M){if(b=b.updateQueue,b!==null&&(b=b.shared,(M&4194240)!==0)){var z=b.lanes;z&=x.pendingLanes,M|=z,b.lanes=M,Wa(x,M)}}function ql(x,b){var M=x.updateQueue,z=x.alternate;if(z!==null&&(z=z.updateQueue,M===z)){var K=null,ee=null;if(M=M.firstBaseUpdate,M!==null){do{var fe={eventTime:M.eventTime,lane:M.lane,tag:M.tag,payload:M.payload,callback:M.callback,next:null};ee===null?K=ee=fe:ee=ee.next=fe,M=M.next}while(M!==null);ee===null?K=ee=b:ee=ee.next=b}else K=ee=b;M={baseState:z.baseState,firstBaseUpdate:K,lastBaseUpdate:ee,shared:z.shared,effects:z.effects},x.updateQueue=M;return}x=M.lastBaseUpdate,x===null?M.firstBaseUpdate=b:x.next=b,M.lastBaseUpdate=b}function Ei(x,b,M,z){var K=x.updateQueue;Ci=!1;var ee=K.firstBaseUpdate,fe=K.lastBaseUpdate,Ne=K.shared.pending;if(Ne!==null){K.shared.pending=null;var Ue=Ne,ot=Ue.next;Ue.next=null,fe===null?ee=ot:fe.next=ot,fe=Ue;var Lt=x.alternate;Lt!==null&&(Lt=Lt.updateQueue,Ne=Lt.lastBaseUpdate,Ne!==fe&&(Ne===null?Lt.firstBaseUpdate=ot:Ne.next=ot,Lt.lastBaseUpdate=Ue))}if(ee!==null){var lr=K.baseState;fe=0,Lt=ot=Ue=null,Ne=ee;do{var St=Ne.lane,on=Ne.eventTime;if((z&St)===St){Lt!==null&&(Lt=Lt.next={eventTime:on,lane:0,tag:Ne.tag,payload:Ne.payload,callback:Ne.callback,next:null});e:{var qr=x,Aa=Ne;switch(St=b,on=M,Aa.tag){case 1:if(qr=Aa.payload,typeof qr=="function"){lr=qr.call(on,lr,St);break e}lr=qr;break e;case 3:qr.flags=qr.flags&-65537|128;case 0:if(qr=Aa.payload,St=typeof qr=="function"?qr.call(on,lr,St):qr,St==null)break e;lr=a({},lr,St);break e;case 2:Ci=!0}}Ne.callback!==null&&Ne.lane!==0&&(x.flags|=64,St=K.effects,St===null?K.effects=[Ne]:St.push(Ne))}else on={eventTime:on,lane:St,tag:Ne.tag,payload:Ne.payload,callback:Ne.callback,next:null},Lt===null?(ot=Lt=on,Ue=lr):Lt=Lt.next=on,fe|=St;if(Ne=Ne.next,Ne===null){if(Ne=K.shared.pending,Ne===null)break;St=Ne,Ne=St.next,St.next=null,K.lastBaseUpdate=St,K.shared.pending=null}}while(!0);if(Lt===null&&(Ue=lr),K.baseState=Ue,K.firstBaseUpdate=ot,K.lastBaseUpdate=Lt,b=K.shared.interleaved,b!==null){K=b;do fe|=K.lane,K=K.next;while(K!==b)}else ee===null&&(K.shared.lanes=0);ml|=fe,x.lanes=fe,x.memoizedState=lr}}function Uh(x,b,M){if(x=b.effects,b.effects=null,x!==null)for(b=0;b<x.length;b++){var z=x[b],K=z.callback;if(K!==null){if(z.callback=null,z=M,typeof K!="function")throw Error(s(191,K));K.call(z)}}}var _a={},Za=_n(_a),Zi=_n(_a),ps=_n(_a);function Ca(x){if(x===_a)throw Error(s(174));return x}function $l(x,b){ht(ps,b),ht(Zi,x),ht(Za,_a),x=Y(b),Mr(Za),ht(Za,x)}function Rs(){Mr(Za),Mr(Zi),Mr(ps)}function zu(x){var b=Ca(ps.current),M=Ca(Za.current);b=Q(M,x.type,b),M!==b&&(ht(Zi,x),ht(Za,b))}function Kl(x){Zi.current===x&&(Mr(Za),Mr(Zi))}var jr=_n(0);function il(x){for(var b=x;b!==null;){if(b.tag===13){var M=b.memoizedState;if(M!==null&&(M=M.dehydrated,M===null||rr(M)||zt(M)))return b}else if(b.tag===19&&b.memoizedProps.revealOrder!==void 0){if((b.flags&128)!==0)return b}else if(b.child!==null){b.child.return=b,b=b.child;continue}if(b===x)break;for(;b.sibling===null;){if(b.return===null||b.return===x)return null;b=b.return}b.sibling.return=b.return,b=b.sibling}return null}var Uu=[];function Ic(){for(var x=0;x<Uu.length;x++){var b=Uu[x];me?b._workInProgressVersionPrimary=null:b._workInProgressVersionSecondary=null}Uu.length=0}var Yi=o.ReactCurrentDispatcher,Os=o.ReactCurrentBatchConfig,wo=0,Jr=null,On=null,Dn=null,Zl=!1,Xi=!1,So=0,Yl=0;function Cn(){throw Error(s(321))}function al(x,b){if(b===null)return!1;for(var M=0;M<b.length&&M<x.length;M++)if(!ds(x[M],b[M]))return!1;return!0}function Xl(x,b,M,z,K,ee){if(wo=ee,Jr=b,b.memoizedState=null,b.updateQueue=null,b.lanes=0,Yi.current=x===null||x.memoizedState===null?xt:Kt,x=M(z,K),Xi){ee=0;do{if(Xi=!1,So=0,25<=ee)throw Error(s(301));ee+=1,Dn=On=null,b.updateQueue=null,Yi.current=dr,x=M(z,K)}while(Xi)}if(Yi.current=Ze,b=On!==null&&On.next!==null,wo=0,Dn=On=Jr=null,Zl=!1,b)throw Error(s(300));return x}function jc(){var x=So!==0;return So=0,x}function di(){var x={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Dn===null?Jr.memoizedState=Dn=x:Dn=Dn.next=x,Dn}function fi(){if(On===null){var x=Jr.alternate;x=x!==null?x.memoizedState:null}else x=On.next;var b=Dn===null?Jr.memoizedState:Dn.next;if(b!==null)Dn=b,On=x;else{if(x===null)throw Error(s(310));On=x,x={memoizedState:On.memoizedState,baseState:On.baseState,baseQueue:On.baseQueue,queue:On.queue,next:null},Dn===null?Jr.memoizedState=Dn=x:Dn=Dn.next=x}return Dn}function Ya(x,b){return typeof b=="function"?b(x):b}function Gu(x){var b=fi(),M=b.queue;if(M===null)throw Error(s(311));M.lastRenderedReducer=x;var z=On,K=z.baseQueue,ee=M.pending;if(ee!==null){if(K!==null){var fe=K.next;K.next=ee.next,ee.next=fe}z.baseQueue=K=ee,M.pending=null}if(K!==null){ee=K.next,z=z.baseState;var Ne=fe=null,Ue=null,ot=ee;do{var Lt=ot.lane;if((wo&Lt)===Lt)Ue!==null&&(Ue=Ue.next={lane:0,action:ot.action,hasEagerState:ot.hasEagerState,eagerState:ot.eagerState,next:null}),z=ot.hasEagerState?ot.eagerState:x(z,ot.action);else{var lr={lane:Lt,action:ot.action,hasEagerState:ot.hasEagerState,eagerState:ot.eagerState,next:null};Ue===null?(Ne=Ue=lr,fe=z):Ue=Ue.next=lr,Jr.lanes|=Lt,ml|=Lt}ot=ot.next}while(ot!==null&&ot!==ee);Ue===null?fe=z:Ue.next=Ne,ds(z,b.memoizedState)||(jn=!0),b.memoizedState=z,b.baseState=fe,b.baseQueue=Ue,M.lastRenderedState=z}if(x=M.interleaved,x!==null){K=x;do ee=K.lane,Jr.lanes|=ee,ml|=ee,K=K.next;while(K!==x)}else K===null&&(M.lanes=0);return[b.memoizedState,M.dispatch]}function sl(x){var b=fi(),M=b.queue;if(M===null)throw Error(s(311));M.lastRenderedReducer=x;var z=M.dispatch,K=M.pending,ee=b.memoizedState;if(K!==null){M.pending=null;var fe=K=K.next;do ee=x(ee,fe.action),fe=fe.next;while(fe!==K);ds(ee,b.memoizedState)||(jn=!0),b.memoizedState=ee,b.baseQueue===null&&(b.baseState=ee),M.lastRenderedState=ee}return[ee,z]}function Ef(){}function ms(x,b){var M=Jr,z=fi(),K=b(),ee=!ds(z.memoizedState,K);if(ee&&(z.memoizedState=K,jn=!0),z=z.queue,Vu(ol.bind(null,M,z,x),[x]),z.getSnapshot!==b||ee||Dn!==null&&Dn.memoizedState.tag&1){if(M.flags|=2048,_o(9,Bc.bind(null,M,z,K,b),void 0,null),tn===null)throw Error(s(349));(wo&30)!==0||Fc(M,b,K)}return K}function Fc(x,b,M){x.flags|=16384,x={getSnapshot:b,value:M},b=Jr.updateQueue,b===null?(b={lastEffect:null,stores:null},Jr.updateQueue=b,b.stores=[x]):(M=b.stores,M===null?b.stores=[x]:M.push(x))}function Bc(x,b,M,z){b.value=M,b.getSnapshot=z,Tf(b)&&Xa(x)}function ol(x,b,M){return M(function(){Tf(b)&&Xa(x)})}function Tf(x){var b=x.getSnapshot;x=x.value;try{var M=b();return!ds(x,M)}catch{return!0}}function Xa(x){var b=$a(x,1);b!==null&&ta(b,x,1,-1)}function ko(x){var b=di();return typeof x=="function"&&(x=x()),b.memoizedState=b.baseState=x,x={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ya,lastRenderedState:x},b.queue=x,x=x.dispatch=ue.bind(null,Jr,x),[b.memoizedState,x]}function _o(x,b,M,z){return x={tag:x,create:b,destroy:M,deps:z,next:null},b=Jr.updateQueue,b===null?(b={lastEffect:null,stores:null},Jr.updateQueue=b,b.lastEffect=x.next=x):(M=b.lastEffect,M===null?b.lastEffect=x.next=x:(z=M.next,M.next=x,x.next=z,b.lastEffect=x)),x}function Nf(){return fi().memoizedState}function zc(x,b,M,z){var K=di();Jr.flags|=x,K.memoizedState=_o(1|b,M,void 0,z===void 0?null:z)}function ro(x,b,M,z){var K=fi();z=z===void 0?null:z;var ee=void 0;if(On!==null){var fe=On.memoizedState;if(ee=fe.destroy,z!==null&&al(z,fe.deps)){K.memoizedState=_o(b,M,ee,z);return}}Jr.flags|=x,K.memoizedState=_o(1|b,M,ee,z)}function Pf(x,b){return zc(8390656,8,x,b)}function Vu(x,b){return ro(2048,8,x,b)}function Uc(x,b){return ro(4,2,x,b)}function Vr(x,b){return ro(4,4,x,b)}function Gc(x,b){if(typeof b=="function")return x=x(),b(x),function(){b(null)};if(b!=null)return x=x(),b.current=x,function(){b.current=null}}function Ql(x,b,M){return M=M!=null?M.concat([x]):null,ro(4,4,Gc.bind(null,b,x),M)}function Co(){}function Mf(x,b){var M=fi();b=b===void 0?null:b;var z=M.memoizedState;return z!==null&&b!==null&&al(b,z[1])?z[0]:(M.memoizedState=[x,b],x)}function h(x,b){var M=fi();b=b===void 0?null:b;var z=M.memoizedState;return z!==null&&b!==null&&al(b,z[1])?z[0]:(x=x(),M.memoizedState=[x,b],x)}function k(x,b,M){return(wo&21)===0?(x.baseState&&(x.baseState=!1,jn=!0),x.memoizedState=M):(ds(M,b)||(M=jl(),Jr.lanes|=M,ml|=M,x.baseState=!0),b)}function P(x,b){var M=gr;gr=M!==0&&4>M?M:4,x(!0);var z=Os.transition;Os.transition={};try{x(!1),b()}finally{gr=M,Os.transition=z}}function G(){return fi().memoizedState}function J(x,b,M){var z=pi(x);if(M={lane:z,action:M,hasEagerState:!1,eagerState:null,next:null},Se(x))Me(b,M);else if(M=rl(x,b,M,z),M!==null){var K=dn();ta(M,x,z,K),De(M,b,z)}}function ue(x,b,M){var z=pi(x),K={lane:z,action:M,hasEagerState:!1,eagerState:null,next:null};if(Se(x))Me(b,K);else{var ee=x.alternate;if(x.lanes===0&&(ee===null||ee.lanes===0)&&(ee=b.lastRenderedReducer,ee!==null))try{var fe=b.lastRenderedState,Ne=ee(fe,M);if(K.hasEagerState=!0,K.eagerState=Ne,ds(Ne,fe)){var Ue=b.interleaved;Ue===null?(K.next=K,Dc(b)):(K.next=Ue.next,Ue.next=K),b.interleaved=K;return}}catch{}M=rl(x,b,K,z),M!==null&&(K=dn(),ta(M,x,z,K),De(M,b,z))}}function Se(x){var b=x.alternate;return x===Jr||b!==null&&b===Jr}function Me(x,b){Xi=Zl=!0;var M=x.pending;M===null?b.next=b:(b.next=M.next,M.next=b),x.pending=b}function De(x,b,M){if((M&4194240)!==0){var z=b.lanes;z&=x.pendingLanes,M|=z,b.lanes=M,Wa(x,M)}}var Ze={readContext:Sa,useCallback:Cn,useContext:Cn,useEffect:Cn,useImperativeHandle:Cn,useInsertionEffect:Cn,useLayoutEffect:Cn,useMemo:Cn,useReducer:Cn,useRef:Cn,useState:Cn,useDebugValue:Cn,useDeferredValue:Cn,useTransition:Cn,useMutableSource:Cn,useSyncExternalStore:Cn,useId:Cn,unstable_isNewReconciler:!1},xt={readContext:Sa,useCallback:function(x,b){return di().memoizedState=[x,b===void 0?null:b],x},useContext:Sa,useEffect:Pf,useImperativeHandle:function(x,b,M){return M=M!=null?M.concat([x]):null,zc(4194308,4,Gc.bind(null,b,x),M)},useLayoutEffect:function(x,b){return zc(4194308,4,x,b)},useInsertionEffect:function(x,b){return zc(4,2,x,b)},useMemo:function(x,b){var M=di();return b=b===void 0?null:b,x=x(),M.memoizedState=[x,b],x},useReducer:function(x,b,M){var z=di();return b=M!==void 0?M(b):b,z.memoizedState=z.baseState=b,x={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:x,lastRenderedState:b},z.queue=x,x=x.dispatch=J.bind(null,Jr,x),[z.memoizedState,x]},useRef:function(x){var b=di();return x={current:x},b.memoizedState=x},useState:ko,useDebugValue:Co,useDeferredValue:function(x){return di().memoizedState=x},useTransition:function(){var x=ko(!1),b=x[0];return x=P.bind(null,x[1]),di().memoizedState=x,[b,x]},useMutableSource:function(){},useSyncExternalStore:function(x,b,M){var z=Jr,K=di();if($r){if(M===void 0)throw Error(s(407));M=M()}else{if(M=b(),tn===null)throw Error(s(349));(wo&30)!==0||Fc(z,b,M)}K.memoizedState=M;var ee={value:M,getSnapshot:b};return K.queue=ee,Pf(ol.bind(null,z,ee,x),[x]),z.flags|=2048,_o(9,Bc.bind(null,z,ee,M,b),void 0,null),M},useId:function(){var x=di(),b=tn.identifierPrefix;if($r){var M=fs,z=qi;M=(z&~(1<<32-_i(z)-1)).toString(32)+M,b=":"+b+"R"+M,M=So++,0<M&&(b+="H"+M.toString(32)),b+=":"}else M=Yl++,b=":"+b+"r"+M.toString(32)+":";return x.memoizedState=b},unstable_isNewReconciler:!1},Kt={readContext:Sa,useCallback:Mf,useContext:Sa,useEffect:Vu,useImperativeHandle:Ql,useInsertionEffect:Uc,useLayoutEffect:Vr,useMemo:h,useReducer:Gu,useRef:Nf,useState:function(){return Gu(Ya)},useDebugValue:Co,useDeferredValue:function(x){var b=fi();return k(b,On.memoizedState,x)},useTransition:function(){var x=Gu(Ya)[0],b=fi().memoizedState;return[x,b]},useMutableSource:Ef,useSyncExternalStore:ms,useId:G,unstable_isNewReconciler:!1},dr={readContext:Sa,useCallback:Mf,useContext:Sa,useEffect:Vu,useImperativeHandle:Ql,useInsertionEffect:Uc,useLayoutEffect:Vr,useMemo:h,useReducer:sl,useRef:Nf,useState:function(){return sl(Ya)},useDebugValue:Co,useDeferredValue:function(x){var b=fi();return On===null?b.memoizedState=x:k(b,On.memoizedState,x)},useTransition:function(){var x=sl(Ya)[0],b=fi().memoizedState;return[x,b]},useMutableSource:Ef,useSyncExternalStore:ms,useId:G,unstable_isNewReconciler:!1};function Hr(x,b){if(x&&x.defaultProps){b=a({},b),x=x.defaultProps;for(var M in x)b[M]===void 0&&(b[M]=x[M]);return b}return b}function In(x,b,M,z){b=x.memoizedState,M=M(z,b),M=M==null?b:a({},b,M),x.memoizedState=M,x.lanes===0&&(x.updateQueue.baseState=M)}var Ti={isMounted:function(x){return(x=x._reactInternals)?F(x)===x:!1},enqueueSetState:function(x,b,M){x=x._reactInternals;var z=dn(),K=pi(x),ee=Ka(z,K);ee.payload=b,M!=null&&(ee.callback=M),b=to(x,ee,K),b!==null&&(ta(b,x,K,z),nl(b,x,K))},enqueueReplaceState:function(x,b,M){x=x._reactInternals;var z=dn(),K=pi(x),ee=Ka(z,K);ee.tag=1,ee.payload=b,M!=null&&(ee.callback=M),b=to(x,ee,K),b!==null&&(ta(b,x,K,z),nl(b,x,K))},enqueueForceUpdate:function(x,b){x=x._reactInternals;var M=dn(),z=pi(x),K=Ka(M,z);K.tag=2,b!=null&&(K.callback=b),b=to(x,K,z),b!==null&&(ta(b,x,z,M),nl(b,x,z))}};function ji(x,b,M,z,K,ee,fe){return x=x.stateNode,typeof x.shouldComponentUpdate=="function"?x.shouldComponentUpdate(z,ee,fe):b.prototype&&b.prototype.isPureReactComponent?!As(M,z)||!As(K,ee):!0}function ll(x,b,M){var z=!1,K=kr,ee=b.contextType;return typeof ee=="object"&&ee!==null?ee=Sa(ee):(K=Ft(b)?Ur:vn.current,z=b.contextTypes,ee=(z=z!=null)?va(x,K):kr),b=new b(M,ee),x.memoizedState=b.state!==null&&b.state!==void 0?b.state:null,b.updater=Ti,x.stateNode=b,b._reactInternals=x,z&&(x=x.stateNode,x.__reactInternalMemoizedUnmaskedChildContext=K,x.__reactInternalMemoizedMaskedChildContext=ee),b}function Vc(x,b,M,z){x=b.state,typeof b.componentWillReceiveProps=="function"&&b.componentWillReceiveProps(M,z),typeof b.UNSAFE_componentWillReceiveProps=="function"&&b.UNSAFE_componentWillReceiveProps(M,z),b.state!==x&&Ti.enqueueReplaceState(b,b.state,null)}function Ds(x,b,M,z){var K=x.stateNode;K.props=M,K.state=x.memoizedState,K.refs={},Cf(x);var ee=b.contextType;typeof ee=="object"&&ee!==null?K.context=Sa(ee):(ee=Ft(b)?Ur:vn.current,K.context=va(x,ee)),K.state=x.memoizedState,ee=b.getDerivedStateFromProps,typeof ee=="function"&&(In(x,b,ee,M),K.state=x.memoizedState),typeof b.getDerivedStateFromProps=="function"||typeof K.getSnapshotBeforeUpdate=="function"||typeof K.UNSAFE_componentWillMount!="function"&&typeof K.componentWillMount!="function"||(b=K.state,typeof K.componentWillMount=="function"&&K.componentWillMount(),typeof K.UNSAFE_componentWillMount=="function"&&K.UNSAFE_componentWillMount(),b!==K.state&&Ti.enqueueReplaceState(K,K.state,null),Ei(x,M,K,z),K.state=x.memoizedState),typeof K.componentDidMount=="function"&&(x.flags|=4194308)}function ul(x,b){try{var M="",z=b;do M+=wm(z),z=z.return;while(z);var K=M}catch(ee){K=`
Error generating stack: `+ee.message+`
`+ee.stack}return{value:x,source:b,stack:K,digest:null}}function no(x,b,M){return{value:x,source:null,stack:M??null,digest:b??null}}function Qa(x,b){try{console.error(b.value)}catch(M){setTimeout(function(){throw M})}}var Jl=typeof WeakMap=="function"?WeakMap:Map;function Rr(x,b,M){M=Ka(-1,M),M.tag=3,M.payload={element:null};var z=b.value;return M.callback=function(){Bn||(Bn=!0,Qn=z),Qa(x,b)},M}function cl(x,b,M){M=Ka(-1,M),M.tag=3;var z=x.type.getDerivedStateFromError;if(typeof z=="function"){var K=b.value;M.payload=function(){return z(K)},M.callback=function(){Qa(x,b)}}var ee=x.stateNode;return ee!==null&&typeof ee.componentDidCatch=="function"&&(M.callback=function(){Qa(x,b),typeof z!="function"&&(ao===null?ao=new Set([this]):ao.add(this));var fe=b.stack;this.componentDidCatch(b.value,{componentStack:fe!==null?fe:""})}),M}function Gh(x,b,M){var z=x.pingCache;if(z===null){z=x.pingCache=new Jl;var K=new Set;z.set(b,K)}else K=z.get(b),K===void 0&&(K=new Set,z.set(b,K));K.has(M)||(K.add(M),x=N0.bind(null,x,b,M),b.then(x,x))}function Vh(x){do{var b;if((b=x.tag===13)&&(b=x.memoizedState,b=b!==null?b.dehydrated!==null:!0),b)return x;x=x.return}while(x!==null);return null}function Eo(x,b,M,z,K){return(x.mode&1)===0?(x===b?x.flags|=65536:(x.flags|=128,M.flags|=131072,M.flags&=-52805,M.tag===1&&(M.alternate===null?M.tag=17:(b=Ka(-1,1),b.tag=2,to(M,b,1))),M.lanes|=1),x):(x.flags|=65536,x.lanes=K,x)}var dl=o.ReactCurrentOwner,jn=!1;function Xn(x,b,M,z){b.child=x===null?Lc(b,null,M,z):el(b,x.child,M,z)}function Hh(x,b,M,z,K){M=M.render;var ee=b.ref;return Ki(b,K),z=Xl(x,b,M,z,ee,K),M=jc(),x!==null&&!jn?(b.updateQueue=x.updateQueue,b.flags&=-2053,x.lanes&=~K,hl(x,b,K)):($r&&M&&$i(b),b.flags|=1,Xn(x,b,z,K),b.child)}function Hu(x,b,M,z,K){if(x===null){var ee=M.type;return typeof ee=="function"&&!ad(ee)&&ee.defaultProps===void 0&&M.compare===null&&M.defaultProps===void 0?(b.tag=15,b.type=ee,fl(x,b,ee,z,K)):(x=sp(M.type,null,z,b,b.mode,K),x.ref=b.ref,x.return=b,b.child=x)}if(ee=x.child,(x.lanes&K)===0){var fe=ee.memoizedProps;if(M=M.compare,M=M!==null?M:As,M(fe,z)&&x.ref===b.ref)return hl(x,b,K)}return b.flags|=1,x=uu(ee,z),x.ref=b.ref,x.return=b,b.child=x}function fl(x,b,M,z,K){if(x!==null){var ee=x.memoizedProps;if(As(ee,z)&&x.ref===b.ref)if(jn=!1,b.pendingProps=z=ee,(x.lanes&K)!==0)(x.flags&131072)!==0&&(jn=!0);else return b.lanes=x.lanes,hl(x,b,K)}return To(x,b,M,z,K)}function an(x,b,M){var z=b.pendingProps,K=z.children,ee=x!==null?x.memoizedState:null;if(z.mode==="hidden")if((b.mode&1)===0)b.memoizedState={baseLanes:0,cachePool:null,transitions:null},ht(au,hi),hi|=M;else{if((M&1073741824)===0)return x=ee!==null?ee.baseLanes|M:M,b.lanes=b.childLanes=1073741824,b.memoizedState={baseLanes:x,cachePool:null,transitions:null},b.updateQueue=null,ht(au,hi),hi|=x,null;b.memoizedState={baseLanes:0,cachePool:null,transitions:null},z=ee!==null?ee.baseLanes:M,ht(au,hi),hi|=z}else ee!==null?(z=ee.baseLanes|M,b.memoizedState=null):z=M,ht(au,hi),hi|=z;return Xn(x,b,K,M),b.child}function en(x,b){var M=b.ref;(x===null&&M!==null||x!==null&&x.ref!==M)&&(b.flags|=512,b.flags|=2097152)}function To(x,b,M,z,K){var ee=Ft(M)?Ur:vn.current;return ee=va(b,ee),Ki(b,K),M=Xl(x,b,M,z,ee,K),z=jc(),x!==null&&!jn?(b.updateQueue=x.updateQueue,b.flags&=-2053,x.lanes&=~K,hl(x,b,K)):($r&&z&&$i(b),b.flags|=1,Xn(x,b,M,K),b.child)}function Fi(x,b,M,z,K){if(Ft(M)){var ee=!0;li(b)}else ee=!1;if(Ki(b,K),b.stateNode===null)Af(x,b),ll(b,M,z),Ds(b,M,z,K),z=!0;else if(x===null){var fe=b.stateNode,Ne=b.memoizedProps;fe.props=Ne;var Ue=fe.context,ot=M.contextType;typeof ot=="object"&&ot!==null?ot=Sa(ot):(ot=Ft(M)?Ur:vn.current,ot=va(b,ot));var Lt=M.getDerivedStateFromProps,lr=typeof Lt=="function"||typeof fe.getSnapshotBeforeUpdate=="function";lr||typeof fe.UNSAFE_componentWillReceiveProps!="function"&&typeof fe.componentWillReceiveProps!="function"||(Ne!==z||Ue!==ot)&&Vc(b,fe,z,ot),Ci=!1;var St=b.memoizedState;fe.state=St,Ei(b,z,fe,K),Ue=b.memoizedState,Ne!==z||St!==Ue||Qr.current||Ci?(typeof Lt=="function"&&(In(b,M,Lt,z),Ue=b.memoizedState),(Ne=Ci||ji(b,M,Ne,z,St,Ue,ot))?(lr||typeof fe.UNSAFE_componentWillMount!="function"&&typeof fe.componentWillMount!="function"||(typeof fe.componentWillMount=="function"&&fe.componentWillMount(),typeof fe.UNSAFE_componentWillMount=="function"&&fe.UNSAFE_componentWillMount()),typeof fe.componentDidMount=="function"&&(b.flags|=4194308)):(typeof fe.componentDidMount=="function"&&(b.flags|=4194308),b.memoizedProps=z,b.memoizedState=Ue),fe.props=z,fe.state=Ue,fe.context=ot,z=Ne):(typeof fe.componentDidMount=="function"&&(b.flags|=4194308),z=!1)}else{fe=b.stateNode,eo(x,b),Ne=b.memoizedProps,ot=b.type===b.elementType?Ne:Hr(b.type,Ne),fe.props=ot,lr=b.pendingProps,St=fe.context,Ue=M.contextType,typeof Ue=="object"&&Ue!==null?Ue=Sa(Ue):(Ue=Ft(M)?Ur:vn.current,Ue=va(b,Ue));var on=M.getDerivedStateFromProps;(Lt=typeof on=="function"||typeof fe.getSnapshotBeforeUpdate=="function")||typeof fe.UNSAFE_componentWillReceiveProps!="function"&&typeof fe.componentWillReceiveProps!="function"||(Ne!==lr||St!==Ue)&&Vc(b,fe,z,Ue),Ci=!1,St=b.memoizedState,fe.state=St,Ei(b,z,fe,K);var qr=b.memoizedState;Ne!==lr||St!==qr||Qr.current||Ci?(typeof on=="function"&&(In(b,M,on,z),qr=b.memoizedState),(ot=Ci||ji(b,M,ot,z,St,qr,Ue)||!1)?(Lt||typeof fe.UNSAFE_componentWillUpdate!="function"&&typeof fe.componentWillUpdate!="function"||(typeof fe.componentWillUpdate=="function"&&fe.componentWillUpdate(z,qr,Ue),typeof fe.UNSAFE_componentWillUpdate=="function"&&fe.UNSAFE_componentWillUpdate(z,qr,Ue)),typeof fe.componentDidUpdate=="function"&&(b.flags|=4),typeof fe.getSnapshotBeforeUpdate=="function"&&(b.flags|=1024)):(typeof fe.componentDidUpdate!="function"||Ne===x.memoizedProps&&St===x.memoizedState||(b.flags|=4),typeof fe.getSnapshotBeforeUpdate!="function"||Ne===x.memoizedProps&&St===x.memoizedState||(b.flags|=1024),b.memoizedProps=z,b.memoizedState=qr),fe.props=z,fe.state=qr,fe.context=Ue,z=ot):(typeof fe.componentDidUpdate!="function"||Ne===x.memoizedProps&&St===x.memoizedState||(b.flags|=4),typeof fe.getSnapshotBeforeUpdate!="function"||Ne===x.memoizedProps&&St===x.memoizedState||(b.flags|=1024),z=!1)}return Qi(x,b,M,z,ee,K)}function Qi(x,b,M,z,K,ee){en(x,b);var fe=(b.flags&128)!==0;if(!z&&!fe)return K&&xf(b,M,!1),hl(x,b,ee);z=b.stateNode,dl.current=b;var Ne=fe&&typeof M.getDerivedStateFromError!="function"?null:z.render();return b.flags|=1,x!==null&&fe?(b.child=el(b,x.child,null,ee),b.child=el(b,null,Ne,ee)):Xn(x,b,Ne,ee),b.memoizedState=z.state,K&&xf(b,M,!0),b.child}function eu(x){var b=x.stateNode;b.pendingContext?Ec(x,b.pendingContext,b.pendingContext!==b.context):b.context&&Ec(x,b.context,!1),$l(x,b.containerInfo)}function Wu(x,b,M,z,K){return bo(),Mc(K),b.flags|=256,Xn(x,b,M,z),b.child}var Ji={dehydrated:null,treeContext:null,retryLane:0};function Hc(x){return{baseLanes:x,cachePool:null,transitions:null}}function Sm(x,b,M){var z=b.pendingProps,K=jr.current,ee=!1,fe=(b.flags&128)!==0,Ne;if((Ne=fe)||(Ne=x!==null&&x.memoizedState===null?!1:(K&2)!==0),Ne?(ee=!0,b.flags&=-129):(x===null||x.memoizedState!==null)&&(K|=1),ht(jr,K&1),x===null)return wf(b),x=b.memoizedState,x!==null&&(x=x.dehydrated,x!==null)?((b.mode&1)===0?b.lanes=1:zt(x)?b.lanes=8:b.lanes=1073741824,null):(fe=z.children,x=z.fallback,ee?(z=b.mode,ee=b.child,fe={mode:"hidden",children:fe},(z&1)===0&&ee!==null?(ee.childLanes=0,ee.pendingProps=fe):ee=sd(fe,z,0,null),x=Bi(x,z,M,null),ee.return=b,x.return=b,ee.sibling=x,b.child=ee,b.child.memoizedState=Hc(M),b.memoizedState=Ji,x):Wh(b,fe));if(K=x.memoizedState,K!==null&&(Ne=K.dehydrated,Ne!==null))return S0(x,b,fe,z,Ne,K,M);if(ee){ee=z.fallback,fe=b.mode,K=x.child,Ne=K.sibling;var Ue={mode:"hidden",children:z.children};return(fe&1)===0&&b.child!==K?(z=b.child,z.childLanes=0,z.pendingProps=Ue,b.deletions=null):(z=uu(K,Ue),z.subtreeFlags=K.subtreeFlags&14680064),Ne!==null?ee=uu(Ne,ee):(ee=Bi(ee,fe,M,null),ee.flags|=2),ee.return=b,z.return=b,z.sibling=ee,b.child=z,z=ee,ee=b.child,fe=x.child.memoizedState,fe=fe===null?Hc(M):{baseLanes:fe.baseLanes|M,cachePool:null,transitions:fe.transitions},ee.memoizedState=fe,ee.childLanes=x.childLanes&~M,b.memoizedState=Ji,z}return ee=x.child,x=ee.sibling,z=uu(ee,{mode:"visible",children:z.children}),(b.mode&1)===0&&(z.lanes=M),z.return=b,z.sibling=null,x!==null&&(M=b.deletions,M===null?(b.deletions=[x],b.flags|=16):M.push(x)),b.child=z,b.memoizedState=null,z}function Wh(x,b){return b=sd({mode:"visible",children:b},x.mode,0,null),b.return=x,x.child=b}function qu(x,b,M,z){return z!==null&&Mc(z),el(b,x.child,null,M),x=Wh(b,b.pendingProps.children),x.flags|=2,b.memoizedState=null,x}function S0(x,b,M,z,K,ee,fe){if(M)return b.flags&256?(b.flags&=-257,z=no(Error(s(422))),qu(x,b,fe,z)):b.memoizedState!==null?(b.child=x.child,b.flags|=128,null):(ee=z.fallback,K=b.mode,z=sd({mode:"visible",children:z.children},K,0,null),ee=Bi(ee,K,fe,null),ee.flags|=2,z.return=b,ee.return=b,z.sibling=ee,b.child=z,(b.mode&1)!==0&&el(b,x.child,null,fe),b.child.memoizedState=Hc(fe),b.memoizedState=Ji,ee);if((b.mode&1)===0)return qu(x,b,fe,null);if(zt(K))return z=lt(K).digest,ee=Error(s(419)),z=no(ee,z,void 0),qu(x,b,fe,z);if(M=(fe&x.childLanes)!==0,jn||M){if(z=tn,z!==null){switch(fe&-fe){case 4:K=2;break;case 16:K=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:K=32;break;case 536870912:K=268435456;break;default:K=0}K=(K&(z.suspendedLanes|fe))!==0?0:K,K!==0&&K!==ee.retryLane&&(ee.retryLane=K,$a(x,K),ta(z,x,K,-1))}return nd(),z=no(Error(s(421))),qu(x,b,fe,z)}return rr(K)?(b.flags|=128,b.child=x.child,b=M0.bind(null,x),Pr(K,b),null):(x=ee.treeContext,we&&(yn=mo(K),Yn=b,$r=!0,wa=null,Gl=!1,x!==null&&(ci[xa++]=qi,ci[xa++]=fs,ci[xa++]=Rn,qi=x.id,fs=x.overflow,Rn=b)),b=Wh(b,z.children),b.flags|=4096,b)}function No(x,b,M){x.lanes|=b;var z=x.alternate;z!==null&&(z.lanes|=b),tl(x.return,b,M)}function Wc(x,b,M,z,K){var ee=x.memoizedState;ee===null?x.memoizedState={isBackwards:b,rendering:null,renderingStartTime:0,last:z,tail:M,tailMode:K}:(ee.isBackwards=b,ee.rendering=null,ee.renderingStartTime=0,ee.last=z,ee.tail=M,ee.tailMode=K)}function qh(x,b,M){var z=b.pendingProps,K=z.revealOrder,ee=z.tail;if(Xn(x,b,z.children,M),z=jr.current,(z&2)!==0)z=z&1|2,b.flags|=128;else{if(x!==null&&(x.flags&128)!==0)e:for(x=b.child;x!==null;){if(x.tag===13)x.memoizedState!==null&&No(x,M,b);else if(x.tag===19)No(x,M,b);else if(x.child!==null){x.child.return=x,x=x.child;continue}if(x===b)break e;for(;x.sibling===null;){if(x.return===null||x.return===b)break e;x=x.return}x.sibling.return=x.return,x=x.sibling}z&=1}if(ht(jr,z),(b.mode&1)===0)b.memoizedState=null;else switch(K){case"forwards":for(M=b.child,K=null;M!==null;)x=M.alternate,x!==null&&il(x)===null&&(K=M),M=M.sibling;M=K,M===null?(K=b.child,b.child=null):(K=M.sibling,M.sibling=null),Wc(b,!1,K,M,ee);break;case"backwards":for(M=null,K=b.child,b.child=null;K!==null;){if(x=K.alternate,x!==null&&il(x)===null){b.child=K;break}x=K.sibling,K.sibling=M,M=K,K=x}Wc(b,!0,M,null,ee);break;case"together":Wc(b,!1,null,null,void 0);break;default:b.memoizedState=null}return b.child}function Af(x,b){(b.mode&1)===0&&x!==null&&(x.alternate=null,b.alternate=null,b.flags|=2)}function hl(x,b,M){if(x!==null&&(b.dependencies=x.dependencies),ml|=b.lanes,(M&b.childLanes)===0)return null;if(x!==null&&b.child!==x.child)throw Error(s(153));if(b.child!==null){for(x=b.child,M=uu(x,x.pendingProps),b.child=M,M.return=b;x.sibling!==null;)x=x.sibling,M=M.sibling=uu(x,x.pendingProps),M.return=b;M.sibling=null}return b.child}function tu(x,b,M){switch(b.tag){case 3:eu(b),bo();break;case 5:zu(b);break;case 1:Ft(b.type)&&li(b);break;case 4:$l(b,b.stateNode.containerInfo);break;case 10:qa(b,b.type._context,b.memoizedProps.value);break;case 13:var z=b.memoizedState;if(z!==null)return z.dehydrated!==null?(ht(jr,jr.current&1),b.flags|=128,null):(M&b.child.childLanes)!==0?Sm(x,b,M):(ht(jr,jr.current&1),x=hl(x,b,M),x!==null?x.sibling:null);ht(jr,jr.current&1);break;case 19:if(z=(M&b.childLanes)!==0,(x.flags&128)!==0){if(z)return qh(x,b,M);b.flags|=128}var K=b.memoizedState;if(K!==null&&(K.rendering=null,K.tail=null,K.lastEffect=null),ht(jr,jr.current),z)break;return null;case 22:case 23:return b.lanes=0,an(x,b,M)}return hl(x,b,M)}function Ea(x){x.flags|=4}function $u(x,b){if(x!==null&&x.child===b.child)return!0;if((b.flags&16)!==0)return!1;for(x=b.child;x!==null;){if((x.flags&12854)!==0||(x.subtreeFlags&12854)!==0)return!1;x=x.sibling}return!0}var ru,nu,Ta,Na;if(he)ru=function(x,b){for(var M=b.child;M!==null;){if(M.tag===5||M.tag===6)te(x,M.stateNode);else if(M.tag!==4&&M.child!==null){M.child.return=M,M=M.child;continue}if(M===b)break;for(;M.sibling===null;){if(M.return===null||M.return===b)return;M=M.return}M.sibling.return=M.return,M=M.sibling}},nu=function(){},Ta=function(x,b,M,z,K){if(x=x.memoizedProps,x!==z){var ee=b.stateNode,fe=Ca(Za.current);M=de(ee,M,x,z,K,fe),(b.updateQueue=M)&&Ea(b)}},Na=function(x,b,M,z){M!==z&&Ea(b)};else if(xe){ru=function(x,b,M,z){for(var K=b.child;K!==null;){if(K.tag===5){var ee=K.stateNode;M&&z&&(ee=Ar(ee,K.type,K.memoizedProps,K)),te(x,ee)}else if(K.tag===6)ee=K.stateNode,M&&z&&(ee=xr(ee,K.memoizedProps,K)),te(x,ee);else if(K.tag!==4){if(K.tag===22&&K.memoizedState!==null)ee=K.child,ee!==null&&(ee.return=K),ru(x,K,!0,!0);else if(K.child!==null){K.child.return=K,K=K.child;continue}}if(K===b)break;for(;K.sibling===null;){if(K.return===null||K.return===b)return;K=K.return}K.sibling.return=K.return,K=K.sibling}};var iu=function(x,b,M,z){for(var K=b.child;K!==null;){if(K.tag===5){var ee=K.stateNode;M&&z&&(ee=Ar(ee,K.type,K.memoizedProps,K)),kt(x,ee)}else if(K.tag===6)ee=K.stateNode,M&&z&&(ee=xr(ee,K.memoizedProps,K)),kt(x,ee);else if(K.tag!==4){if(K.tag===22&&K.memoizedState!==null)ee=K.child,ee!==null&&(ee.return=K),iu(x,K,!0,!0);else if(K.child!==null){K.child.return=K,K=K.child;continue}}if(K===b)break;for(;K.sibling===null;){if(K.return===null||K.return===b)return;K=K.return}K.sibling.return=K.return,K=K.sibling}};nu=function(x,b){var M=b.stateNode;if(!$u(x,b)){x=M.containerInfo;var z=$t(x);iu(z,b,!1,!1),M.pendingChildren=z,Ea(b),Zt(x,z)}},Ta=function(x,b,M,z,K){var ee=x.stateNode,fe=x.memoizedProps;if((x=$u(x,b))&&fe===z)b.stateNode=ee;else{var Ne=b.stateNode,Ue=Ca(Za.current),ot=null;fe!==z&&(ot=de(Ne,M,fe,z,K,Ue)),x&&ot===null?b.stateNode=ee:(ee=qt(ee,ot,M,fe,z,b,x,Ne),ie(ee,M,z,K,Ue)&&Ea(b),b.stateNode=ee,x?Ea(b):ru(ee,b,!1,!1))}},Na=function(x,b,M,z){M!==z?(x=Ca(ps.current),M=Ca(Za.current),b.stateNode=ye(z,x,M,b),Ea(b)):b.stateNode=x.stateNode}}else nu=function(){},Ta=function(){},Na=function(){};function gs(x,b){if(!$r)switch(x.tailMode){case"hidden":b=x.tail;for(var M=null;b!==null;)b.alternate!==null&&(M=b),b=b.sibling;M===null?x.tail=null:M.sibling=null;break;case"collapsed":M=x.tail;for(var z=null;M!==null;)M.alternate!==null&&(z=M),M=M.sibling;z===null?b||x.tail===null?x.tail=null:x.tail.sibling=null:z.sibling=null}}function xn(x){var b=x.alternate!==null&&x.alternate.child===x.child,M=0,z=0;if(b)for(var K=x.child;K!==null;)M|=K.lanes|K.childLanes,z|=K.subtreeFlags&14680064,z|=K.flags&14680064,K.return=x,K=K.sibling;else for(K=x.child;K!==null;)M|=K.lanes|K.childLanes,z|=K.subtreeFlags,z|=K.flags,K.return=x,K=K.sibling;return x.subtreeFlags|=z,x.childLanes=M,b}function Ku(x,b,M){var z=b.pendingProps;switch(Fu(b),b.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return xn(b),null;case 1:return Ft(b.type)&&Lr(),xn(b),null;case 3:return M=b.stateNode,Rs(),Mr(Qr),Mr(vn),Ic(),M.pendingContext&&(M.context=M.pendingContext,M.pendingContext=null),(x===null||x.child===null)&&(Vl(b)?Ea(b):x===null||x.memoizedState.isDehydrated&&(b.flags&256)===0||(b.flags|=1024,wa!==null&&(ip(wa),wa=null))),nu(x,b),xn(b),null;case 5:Kl(b),M=Ca(ps.current);var K=b.type;if(x!==null&&b.stateNode!=null)Ta(x,b,K,z,M),x.ref!==b.ref&&(b.flags|=512,b.flags|=2097152);else{if(!z){if(b.stateNode===null)throw Error(s(166));return xn(b),null}if(x=Ca(Za.current),Vl(b)){if(!we)throw Error(s(175));x=Si(b.stateNode,b.type,b.memoizedProps,M,x,b,!Gl),b.updateQueue=x,x!==null&&Ea(b)}else{var ee=H(K,z,M,x,b);ru(ee,b,!1,!1),b.stateNode=ee,ie(ee,K,z,M,x)&&Ea(b)}b.ref!==null&&(b.flags|=512,b.flags|=2097152)}return xn(b),null;case 6:if(x&&b.stateNode!=null)Na(x,b,x.memoizedProps,z);else{if(typeof z!="string"&&b.stateNode===null)throw Error(s(166));if(x=Ca(ps.current),M=Ca(Za.current),Vl(b)){if(!we)throw Error(s(176));if(x=b.stateNode,M=b.memoizedProps,(z=gn(x,M,b,!Gl))&&(K=Yn,K!==null))switch(K.tag){case 3:Dl(K.stateNode.containerInfo,x,M,(K.mode&1)!==0);break;case 5:cn(K.type,K.memoizedProps,K.stateNode,x,M,(K.mode&1)!==0)}z&&Ea(b)}else b.stateNode=ye(z,x,M,b)}return xn(b),null;case 13:if(Mr(jr),z=b.memoizedState,x===null||x.memoizedState!==null&&x.memoizedState.dehydrated!==null){if($r&&yn!==null&&(b.mode&1)!==0&&(b.flags&128)===0)zh(),bo(),b.flags|=98560,K=!1;else if(K=Vl(b),z!==null&&z.dehydrated!==null){if(x===null){if(!K)throw Error(s(318));if(!we)throw Error(s(344));if(K=b.memoizedState,K=K!==null?K.dehydrated:null,!K)throw Error(s(317));Pn(K,b)}else bo(),(b.flags&128)===0&&(b.memoizedState=null),b.flags|=4;xn(b),K=!1}else wa!==null&&(ip(wa),wa=null),K=!0;if(!K)return b.flags&65536?b:null}return(b.flags&128)!==0?(b.lanes=M,b):(M=z!==null,M!==(x!==null&&x.memoizedState!==null)&&M&&(b.child.flags|=8192,(b.mode&1)!==0&&(x===null||(jr.current&1)!==0?wn===0&&(wn=3):nd())),b.updateQueue!==null&&(b.flags|=4),xn(b),null);case 4:return Rs(),nu(x,b),x===null&&qe(b.stateNode.containerInfo),xn(b),null;case 10:return Ls(b.type._context),xn(b),null;case 17:return Ft(b.type)&&Lr(),xn(b),null;case 19:if(Mr(jr),K=b.memoizedState,K===null)return xn(b),null;if(z=(b.flags&128)!==0,ee=K.rendering,ee===null)if(z)gs(K,!1);else{if(wn!==0||x!==null&&(x.flags&128)!==0)for(x=b.child;x!==null;){if(ee=il(x),ee!==null){for(b.flags|=128,gs(K,!1),x=ee.updateQueue,x!==null&&(b.updateQueue=x,b.flags|=4),b.subtreeFlags=0,x=M,M=b.child;M!==null;)z=M,K=x,z.flags&=14680066,ee=z.alternate,ee===null?(z.childLanes=0,z.lanes=K,z.child=null,z.subtreeFlags=0,z.memoizedProps=null,z.memoizedState=null,z.updateQueue=null,z.dependencies=null,z.stateNode=null):(z.childLanes=ee.childLanes,z.lanes=ee.lanes,z.child=ee.child,z.subtreeFlags=0,z.deletions=null,z.memoizedProps=ee.memoizedProps,z.memoizedState=ee.memoizedState,z.updateQueue=ee.updateQueue,z.type=ee.type,K=ee.dependencies,z.dependencies=K===null?null:{lanes:K.lanes,firstContext:K.firstContext}),M=M.sibling;return ht(jr,jr.current&1|2),b.child}x=x.sibling}K.tail!==null&&An()>Ff&&(b.flags|=128,z=!0,gs(K,!1),b.lanes=4194304)}else{if(!z)if(x=il(ee),x!==null){if(b.flags|=128,z=!0,x=x.updateQueue,x!==null&&(b.updateQueue=x,b.flags|=4),gs(K,!0),K.tail===null&&K.tailMode==="hidden"&&!ee.alternate&&!$r)return xn(b),null}else 2*An()-K.renderingStartTime>Ff&&M!==1073741824&&(b.flags|=128,z=!0,gs(K,!1),b.lanes=4194304);K.isBackwards?(ee.sibling=b.child,b.child=ee):(x=K.last,x!==null?x.sibling=ee:b.child=ee,K.last=ee)}return K.tail!==null?(b=K.tail,K.rendering=b,K.tail=b.sibling,K.renderingStartTime=An(),b.sibling=null,x=jr.current,ht(jr,z?x&1|2:x&1),b):(xn(b),null);case 22:case 23:return ap(),M=b.memoizedState!==null,x!==null&&x.memoizedState!==null!==M&&(b.flags|=8192),M&&(b.mode&1)!==0?(hi&1073741824)!==0&&(xn(b),he&&b.subtreeFlags&6&&(b.flags|=8192)):xn(b),null;case 24:return null;case 25:return null}throw Error(s(156,b.tag))}function k0(x,b){switch(Fu(b),b.tag){case 1:return Ft(b.type)&&Lr(),x=b.flags,x&65536?(b.flags=x&-65537|128,b):null;case 3:return Rs(),Mr(Qr),Mr(vn),Ic(),x=b.flags,(x&65536)!==0&&(x&128)===0?(b.flags=x&-65537|128,b):null;case 5:return Kl(b),null;case 13:if(Mr(jr),x=b.memoizedState,x!==null&&x.dehydrated!==null){if(b.alternate===null)throw Error(s(340));bo()}return x=b.flags,x&65536?(b.flags=x&-65537|128,b):null;case 19:return Mr(jr),null;case 4:return Rs(),null;case 10:return Ls(b.type._context),null;case 22:case 23:return ap(),null;case 24:return null;default:return null}}var qc=!1,Ni=!1,vs=typeof WeakSet=="function"?WeakSet:Set,mt=null;function Wr(x,b){var M=x.ref;if(M!==null)if(typeof M=="function")try{M(null)}catch(z){fn(x,b,z)}else M.current=null}function ys(x,b,M){try{M()}catch(z){fn(x,b,z)}}var km=!1;function _0(x,b){for(ne(x.containerInfo),mt=b;mt!==null;)if(x=mt,b=x.child,(x.subtreeFlags&1028)!==0&&b!==null)b.return=x,mt=b;else for(;mt!==null;){x=mt;try{var M=x.alternate;if((x.flags&1024)!==0)switch(x.tag){case 0:case 11:case 15:break;case 1:if(M!==null){var z=M.memoizedProps,K=M.memoizedState,ee=x.stateNode,fe=ee.getSnapshotBeforeUpdate(x.elementType===x.type?z:Hr(x.type,z),K);ee.__reactInternalSnapshotBeforeUpdate=fe}break;case 3:he&&Pt(x.stateNode.containerInfo);break;case 5:case 6:case 4:case 17:break;default:throw Error(s(163))}}catch(Ne){fn(x,x.return,Ne)}if(b=x.sibling,b!==null){b.return=x.return,mt=b;break}mt=x.return}return M=km,km=!1,M}function Zu(x,b,M){var z=b.updateQueue;if(z=z!==null?z.lastEffect:null,z!==null){var K=z=z.next;do{if((K.tag&x)===x){var ee=K.destroy;K.destroy=void 0,ee!==void 0&&ys(b,M,ee)}K=K.next}while(K!==z)}}function $c(x,b){if(b=b.updateQueue,b=b!==null?b.lastEffect:null,b!==null){var M=b=b.next;do{if((M.tag&x)===x){var z=M.create;M.destroy=z()}M=M.next}while(M!==b)}}function $h(x){var b=x.ref;if(b!==null){var M=x.stateNode;x.tag===5?x=W(M):x=M,typeof b=="function"?b(x):b.current=x}}function Lf(x){var b=x.alternate;b!==null&&(x.alternate=null,Lf(b)),x.child=null,x.deletions=null,x.sibling=null,x.tag===5&&(b=x.stateNode,b!==null&&et(b)),x.stateNode=null,x.return=null,x.dependencies=null,x.memoizedProps=null,x.memoizedState=null,x.pendingProps=null,x.stateNode=null,x.updateQueue=null}function _m(x){return x.tag===5||x.tag===3||x.tag===4}function Yu(x){e:for(;;){for(;x.sibling===null;){if(x.return===null||_m(x.return))return null;x=x.return}for(x.sibling.return=x.return,x=x.sibling;x.tag!==5&&x.tag!==6&&x.tag!==18;){if(x.flags&2||x.child===null||x.tag===4)continue e;x.child.return=x,x=x.child}if(!(x.flags&2))return x.stateNode}}function Rf(x,b,M){var z=x.tag;if(z===5||z===6)x=x.stateNode,b?ve(M,x,b):nr(M,x);else if(z!==4&&(x=x.child,x!==null))for(Rf(x,b,M),x=x.sibling;x!==null;)Rf(x,b,M),x=x.sibling}function Cm(x,b,M){var z=x.tag;if(z===5||z===6)x=x.stateNode,b?ce(M,x,b):Ut(M,x);else if(z!==4&&(x=x.child,x!==null))for(Cm(x,b,M),x=x.sibling;x!==null;)Cm(x,b,M),x=x.sibling}var qn=null,Ja=!1;function io(x,b,M){for(M=M.child;M!==null;)Kh(x,b,M),M=M.sibling}function Kh(x,b,M){if(Ln&&typeof Ln.onCommitFiberUnmount=="function")try{Ln.onCommitFiberUnmount(nn,M)}catch{}switch(M.tag){case 5:Ni||Wr(M,b);case 6:if(he){var z=qn,K=Ja;qn=null,io(x,b,M),qn=z,Ja=K,qn!==null&&(Ja?Te(qn,M.stateNode):_e(qn,M.stateNode))}else io(x,b,M);break;case 18:he&&qn!==null&&(Ja?Lu(qn,M.stateNode):Au(qn,M.stateNode));break;case 4:he?(z=qn,K=Ja,qn=M.stateNode.containerInfo,Ja=!0,io(x,b,M),qn=z,Ja=K):(xe&&(z=M.stateNode.containerInfo,K=$t(z),er(z,K)),io(x,b,M));break;case 0:case 11:case 14:case 15:if(!Ni&&(z=M.updateQueue,z!==null&&(z=z.lastEffect,z!==null))){K=z=z.next;do{var ee=K,fe=ee.destroy;ee=ee.tag,fe!==void 0&&((ee&2)!==0||(ee&4)!==0)&&ys(M,b,fe),K=K.next}while(K!==z)}io(x,b,M);break;case 1:if(!Ni&&(Wr(M,b),z=M.stateNode,typeof z.componentWillUnmount=="function"))try{z.props=M.memoizedProps,z.state=M.memoizedState,z.componentWillUnmount()}catch(Ne){fn(M,b,Ne)}io(x,b,M);break;case 21:io(x,b,M);break;case 22:M.mode&1?(Ni=(z=Ni)||M.memoizedState!==null,io(x,b,M),Ni=z):io(x,b,M);break;default:io(x,b,M)}}function Xu(x){var b=x.updateQueue;if(b!==null){x.updateQueue=null;var M=x.stateNode;M===null&&(M=x.stateNode=new vs),b.forEach(function(z){var K=db.bind(null,x,z);M.has(z)||(M.add(z),z.then(K,K))})}}function Is(x,b){var M=b.deletions;if(M!==null)for(var z=0;z<M.length;z++){var K=M[z];try{var ee=x,fe=b;if(he){var Ne=fe;e:for(;Ne!==null;){switch(Ne.tag){case 5:qn=Ne.stateNode,Ja=!1;break e;case 3:qn=Ne.stateNode.containerInfo,Ja=!0;break e;case 4:qn=Ne.stateNode.containerInfo,Ja=!0;break e}Ne=Ne.return}if(qn===null)throw Error(s(160));Kh(ee,fe,K),qn=null,Ja=!1}else Kh(ee,fe,K);var Ue=K.alternate;Ue!==null&&(Ue.return=null),K.return=null}catch(ot){fn(K,b,ot)}}if(b.subtreeFlags&12854)for(b=b.child;b!==null;)Of(b,x),b=b.sibling}function Of(x,b){var M=x.alternate,z=x.flags;switch(x.tag){case 0:case 11:case 14:case 15:if(Is(b,x),xs(x),z&4){try{Zu(3,x,x.return),$c(3,x)}catch(St){fn(x,x.return,St)}try{Zu(5,x,x.return)}catch(St){fn(x,x.return,St)}}break;case 1:Is(b,x),xs(x),z&512&&M!==null&&Wr(M,M.return);break;case 5:if(Is(b,x),xs(x),z&512&&M!==null&&Wr(M,M.return),he){if(x.flags&32){var K=x.stateNode;try{Le(K)}catch(St){fn(x,x.return,St)}}if(z&4&&(K=x.stateNode,K!=null)){var ee=x.memoizedProps;if(M=M!==null?M.memoizedProps:ee,z=x.type,b=x.updateQueue,x.updateQueue=null,b!==null)try{We(K,b,z,M,ee,x)}catch(St){fn(x,x.return,St)}}}break;case 6:if(Is(b,x),xs(x),z&4&&he){if(x.stateNode===null)throw Error(s(162));K=x.stateNode,ee=x.memoizedProps,M=M!==null?M.memoizedProps:ee;try{Ct(K,M,ee)}catch(St){fn(x,x.return,St)}}break;case 3:if(Is(b,x),xs(x),z&4){if(he&&we&&M!==null&&M.memoizedState.isDehydrated)try{go(b.containerInfo)}catch(St){fn(x,x.return,St)}if(xe){K=b.containerInfo,ee=b.pendingChildren;try{er(K,ee)}catch(St){fn(x,x.return,St)}}}break;case 4:if(Is(b,x),xs(x),z&4&&xe){ee=x.stateNode,K=ee.containerInfo,ee=ee.pendingChildren;try{er(K,ee)}catch(St){fn(x,x.return,St)}}break;case 13:Is(b,x),xs(x),K=x.child,K.flags&8192&&(ee=K.memoizedState!==null,K.stateNode.isHidden=ee,!ee||K.alternate!==null&&K.alternate.memoizedState!==null||(Jc=An())),z&4&&Xu(x);break;case 22:var fe=M!==null&&M.memoizedState!==null;if(x.mode&1?(Ni=(M=Ni)||fe,Is(b,x),Ni=M):Is(b,x),xs(x),z&8192){if(M=x.memoizedState!==null,(x.stateNode.isHidden=M)&&!fe&&(x.mode&1)!==0)for(mt=x,z=x.child;z!==null;){for(b=mt=z;mt!==null;){fe=mt;var Ne=fe.child;switch(fe.tag){case 0:case 11:case 14:case 15:Zu(4,fe,fe.return);break;case 1:Wr(fe,fe.return);var Ue=fe.stateNode;if(typeof Ue.componentWillUnmount=="function"){var ot=fe,Lt=fe.return;try{var lr=ot;Ue.props=lr.memoizedProps,Ue.state=lr.memoizedState,Ue.componentWillUnmount()}catch(St){fn(ot,Lt,St)}}break;case 5:Wr(fe,fe.return);break;case 22:if(fe.memoizedState!==null){Xh(b);continue}}Ne!==null?(Ne.return=fe,mt=Ne):Xh(b)}z=z.sibling}if(he){e:if(z=null,he)for(b=x;;){if(b.tag===5){if(z===null){z=b;try{K=b.stateNode,M?Xe(K):dt(b.stateNode,b.memoizedProps)}catch(St){fn(x,x.return,St)}}}else if(b.tag===6){if(z===null)try{ee=b.stateNode,M?He(ee):ft(ee,b.memoizedProps)}catch(St){fn(x,x.return,St)}}else if((b.tag!==22&&b.tag!==23||b.memoizedState===null||b===x)&&b.child!==null){b.child.return=b,b=b.child;continue}if(b===x)break e;for(;b.sibling===null;){if(b.return===null||b.return===x)break e;z===b&&(z=null),b=b.return}z===b&&(z=null),b.sibling.return=b.return,b=b.sibling}}}break;case 19:Is(b,x),xs(x),z&4&&Xu(x);break;case 21:break;default:Is(b,x),xs(x)}}function xs(x){var b=x.flags;if(b&2){try{if(he){e:{for(var M=x.return;M!==null;){if(_m(M)){var z=M;break e}M=M.return}throw Error(s(160))}switch(z.tag){case 5:var K=z.stateNode;z.flags&32&&(Le(K),z.flags&=-33);var ee=Yu(x);Cm(x,ee,K);break;case 3:case 4:var fe=z.stateNode.containerInfo,Ne=Yu(x);Rf(x,Ne,fe);break;default:throw Error(s(161))}}}catch(Ue){fn(x,x.return,Ue)}x.flags&=-3}b&4096&&(x.flags&=-4097)}function Kc(x,b,M){mt=x,Zh(x)}function Zh(x,b,M){for(var z=(x.mode&1)!==0;mt!==null;){var K=mt,ee=K.child;if(K.tag===22&&z){var fe=K.memoizedState!==null||qc;if(!fe){var Ne=K.alternate,Ue=Ne!==null&&Ne.memoizedState!==null||Ni;Ne=qc;var ot=Ni;if(qc=fe,(Ni=Ue)&&!ot)for(mt=K;mt!==null;)fe=mt,Ue=fe.child,fe.tag===22&&fe.memoizedState!==null?Qh(K):Ue!==null?(Ue.return=fe,mt=Ue):Qh(K);for(;ee!==null;)mt=ee,Zh(ee),ee=ee.sibling;mt=K,qc=Ne,Ni=ot}Yh(x)}else(K.subtreeFlags&8772)!==0&&ee!==null?(ee.return=K,mt=ee):Yh(x)}}function Yh(x){for(;mt!==null;){var b=mt;if((b.flags&8772)!==0){var M=b.alternate;try{if((b.flags&8772)!==0)switch(b.tag){case 0:case 11:case 15:Ni||$c(5,b);break;case 1:var z=b.stateNode;if(b.flags&4&&!Ni)if(M===null)z.componentDidMount();else{var K=b.elementType===b.type?M.memoizedProps:Hr(b.type,M.memoizedProps);z.componentDidUpdate(K,M.memoizedState,z.__reactInternalSnapshotBeforeUpdate)}var ee=b.updateQueue;ee!==null&&Uh(b,ee,z);break;case 3:var fe=b.updateQueue;if(fe!==null){if(M=null,b.child!==null)switch(b.child.tag){case 5:M=W(b.child.stateNode);break;case 1:M=b.child.stateNode}Uh(b,fe,M)}break;case 5:var Ne=b.stateNode;M===null&&b.flags&4&&ct(Ne,b.type,b.memoizedProps,b);break;case 6:break;case 4:break;case 12:break;case 13:if(we&&b.memoizedState===null){var Ue=b.alternate;if(Ue!==null){var ot=Ue.memoizedState;if(ot!==null){var Lt=ot.dehydrated;Lt!==null&&Oi(Lt)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(s(163))}Ni||b.flags&512&&$h(b)}catch(lr){fn(b,b.return,lr)}}if(b===x){mt=null;break}if(M=b.sibling,M!==null){M.return=b.return,mt=M;break}mt=b.return}}function Xh(x){for(;mt!==null;){var b=mt;if(b===x){mt=null;break}var M=b.sibling;if(M!==null){M.return=b.return,mt=M;break}mt=b.return}}function Qh(x){for(;mt!==null;){var b=mt;try{switch(b.tag){case 0:case 11:case 15:var M=b.return;try{$c(4,b)}catch(Ue){fn(b,M,Ue)}break;case 1:var z=b.stateNode;if(typeof z.componentDidMount=="function"){var K=b.return;try{z.componentDidMount()}catch(Ue){fn(b,K,Ue)}}var ee=b.return;try{$h(b)}catch(Ue){fn(b,ee,Ue)}break;case 5:var fe=b.return;try{$h(b)}catch(Ue){fn(b,fe,Ue)}}}catch(Ue){fn(b,b.return,Ue)}if(b===x){mt=null;break}var Ne=b.sibling;if(Ne!==null){Ne.return=b.return,mt=Ne;break}mt=b.return}}var pl=0,Pa=1,Po=2,Zc=3,Df=4;if(typeof Symbol=="function"&&Symbol.for){var bs=Symbol.for;pl=bs("selector.component"),Pa=bs("selector.has_pseudo_class"),Po=bs("selector.role"),Zc=bs("selector.test_id"),Df=bs("selector.text")}function Mo(x){var b=Ge(x);if(b!=null){if(typeof b.memoizedProps["data-testname"]!="string")throw Error(s(364));return b}if(x=nt(x),x===null)throw Error(s(362));return x.stateNode.current}function If(x,b){switch(b.$$typeof){case pl:if(x.type===b.value)return!0;break;case Pa:e:{b=b.value,x=[x,0];for(var M=0;M<x.length;){var z=x[M++],K=x[M++],ee=b[K];if(z.tag!==5||!Ke(z)){for(;ee!=null&&If(z,ee);)K++,ee=b[K];if(K===b.length){b=!0;break e}else for(z=z.child;z!==null;)x.push(z,K),z=z.sibling}}b=!1}return b;case Po:if(x.tag===5&&pt(x.stateNode,b.value))return!0;break;case Df:if((x.tag===5||x.tag===6)&&(x=Fe(x),x!==null&&0<=x.indexOf(b.value)))return!0;break;case Zc:if(x.tag===5&&(x=x.memoizedProps["data-testname"],typeof x=="string"&&x.toLowerCase()===b.value.toLowerCase()))return!0;break;default:throw Error(s(365))}return!1}function Jh(x){switch(x.$$typeof){case pl:return"<"+(j(x.value)||"Unknown")+">";case Pa:return":has("+(Jh(x)||"")+")";case Po:return'[role="'+x.value+'"]';case Df:return'"'+x.value+'"';case Zc:return'[data-testname="'+x.value+'"]';default:throw Error(s(365))}}function Ao(x,b){var M=[];x=[x,0];for(var z=0;z<x.length;){var K=x[z++],ee=x[z++],fe=b[ee];if(K.tag!==5||!Ke(K)){for(;fe!=null&&If(K,fe);)ee++,fe=b[ee];if(ee===b.length)M.push(K);else for(K=K.child;K!==null;)x.push(K,ee),K=K.sibling}}return M}function Lo(x,b){if(!Re)throw Error(s(363));x=Mo(x),x=Ao(x,b),b=[],x=Array.from(x);for(var M=0;M<x.length;){var z=x[M++];if(z.tag===5)Ke(z)||b.push(z.stateNode);else for(z=z.child;z!==null;)x.push(z),z=z.sibling}return b}var ep=Math.ceil,jf=o.ReactCurrentDispatcher,Yc=o.ReactCurrentOwner,Fn=o.ReactCurrentBatchConfig,fr=0,tn=null,bn=null,$n=0,hi=0,au=_n(0),wn=0,Xc=null,ml=0,sn=0,Qc=0,Qu=null,ea=null,Jc=0,Ff=1/0,Ma=null;function Kr(){Ff=An()+500}var Bn=!1,Qn=null,ao=null,su=!1,js=null,tp=0,Jn=0,Bf=null,ed=-1,td=0;function dn(){return(fr&6)!==0?An():ed!==-1?ed:ed=An()}function pi(x){return(x.mode&1)===0?1:(fr&2)!==0&&$n!==0?$n&-$n:Ac.transition!==null?(td===0&&(td=jl()),td):(x=gr,x!==0?x:wt())}function ta(x,b,M,z){if(50<Jn)throw Jn=0,Bf=null,Error(s(185));Di(x,M,z),((fr&2)===0||x!==tn)&&(x===tn&&((fr&2)===0&&(sn|=M),wn===4&&gl(x,$n)),ra(x,z),M===1&&fr===0&&(b.mode&1)===0&&(Kr(),xo&&ui()))}function ra(x,b){var M=x.callbackNode;Nc(x,b);var z=Ns(x,x===tn?$n:0);if(z===0)M!==null&&Gr(M),x.callbackNode=null,x.callbackPriority=0;else if(b=z&-z,x.callbackPriority!==b){if(M!=null&&Gr(M),b===1)x.tag===0?br(Em.bind(null,x)):ju(Em.bind(null,x)),at?je(function(){(fr&6)===0&&ui()}):Wn(Fl,ui),M=null;else{switch(tr(z)){case 1:M=Fl;break;case 4:M=Ps;break;case 16:M=Bl;break;case 536870912:M=Du;break;default:M=Bl}M=Rm(M,rp.bind(null,x))}x.callbackPriority=b,x.callbackNode=M}}function rp(x,b){if(ed=-1,td=0,(fr&6)!==0)throw Error(s(327));var M=x.callbackNode;if(vl()&&x.callbackNode!==M)return null;var z=Ns(x,x===tn?$n:0);if(z===0)return null;if((z&30)!==0||(z&x.expiredLanes)!==0||b)b=Ju(x,z);else{b=z;var K=fr;fr|=2;var ee=Nm();(tn!==x||$n!==b)&&(Ma=null,Kr(),ou(x,b));do try{Pm();break}catch(Ne){rd(x,Ne)}while(!0);_f(),jf.current=ee,fr=K,bn!==null?b=0:(tn=null,$n=0,b=wn)}if(b!==0){if(b===2&&(K=Yo(x),K!==0&&(z=K,b=np(x,K))),b===1)throw M=Xc,ou(x,0),gl(x,z),ra(x,An()),M;if(b===6)gl(x,z);else{if(K=x.current.alternate,(z&30)===0&&!C0(K)&&(b=Ju(x,z),b===2&&(ee=Yo(x),ee!==0&&(z=ee,b=np(x,ee))),b===1))throw M=Xc,ou(x,0),gl(x,z),ra(x,An()),M;switch(x.finishedWork=K,x.finishedLanes=z,b){case 0:case 1:throw Error(s(345));case 2:lu(x,ea,Ma);break;case 3:if(gl(x,z),(z&130023424)===z&&(b=Jc+500-An(),10<b)){if(Ns(x,0)!==0)break;if(K=x.suspendedLanes,(K&z)!==z){dn(),x.pingedLanes|=x.suspendedLanes&K;break}x.timeoutHandle=ae(lu.bind(null,x,ea,Ma),b);break}lu(x,ea,Ma);break;case 4:if(gl(x,z),(z&4194240)===z)break;for(b=x.eventTimes,K=-1;0<z;){var fe=31-_i(z);ee=1<<fe,fe=b[fe],fe>K&&(K=fe),z&=~ee}if(z=K,z=An()-z,z=(120>z?120:480>z?480:1080>z?1080:1920>z?1920:3e3>z?3e3:4320>z?4320:1960*ep(z/1960))-z,10<z){x.timeoutHandle=ae(lu.bind(null,x,ea,Ma),z);break}lu(x,ea,Ma);break;case 5:lu(x,ea,Ma);break;default:throw Error(s(329))}}}return ra(x,An()),x.callbackNode===M?rp.bind(null,x):null}function np(x,b){var M=Qu;return x.current.memoizedState.isDehydrated&&(ou(x,b).flags|=256),x=Ju(x,b),x!==2&&(b=ea,ea=M,b!==null&&ip(b)),x}function ip(x){ea===null?ea=x:ea.push.apply(ea,x)}function C0(x){for(var b=x;;){if(b.flags&16384){var M=b.updateQueue;if(M!==null&&(M=M.stores,M!==null))for(var z=0;z<M.length;z++){var K=M[z],ee=K.getSnapshot;K=K.value;try{if(!ds(ee(),K))return!1}catch{return!1}}}if(M=b.child,b.subtreeFlags&16384&&M!==null)M.return=b,b=M;else{if(b===x)break;for(;b.sibling===null;){if(b.return===null||b.return===x)return!0;b=b.return}b.sibling.return=b.return,b=b.sibling}}return!0}function gl(x,b){for(b&=~Qc,b&=~sn,x.suspendedLanes|=b,x.pingedLanes&=~b,x=x.expirationTimes;0<b;){var M=31-_i(b),z=1<<M;x[M]=-1,b&=~z}}function Em(x){if((fr&6)!==0)throw Error(s(327));vl();var b=Ns(x,0);if((b&1)===0)return ra(x,An()),null;var M=Ju(x,b);if(x.tag!==0&&M===2){var z=Yo(x);z!==0&&(b=z,M=np(x,z))}if(M===1)throw M=Xc,ou(x,0),gl(x,b),ra(x,An()),M;if(M===6)throw Error(s(345));return x.finishedWork=x.current.alternate,x.finishedLanes=b,lu(x,ea,Ma),ra(x,An()),null}function Tm(x){js!==null&&js.tag===0&&(fr&6)===0&&vl();var b=fr;fr|=1;var M=Fn.transition,z=gr;try{if(Fn.transition=null,gr=1,x)return x()}finally{gr=z,Fn.transition=M,fr=b,(fr&6)===0&&ui()}}function ap(){hi=au.current,Mr(au)}function ou(x,b){x.finishedWork=null,x.finishedLanes=0;var M=x.timeoutHandle;if(M!==le&&(x.timeoutHandle=le,pe(M)),bn!==null)for(M=bn.return;M!==null;){var z=M;switch(Fu(z),z.tag){case 1:z=z.type.childContextTypes,z!=null&&Lr();break;case 3:Rs(),Mr(Qr),Mr(vn),Ic();break;case 5:Kl(z);break;case 4:Rs();break;case 13:Mr(jr);break;case 19:Mr(jr);break;case 10:Ls(z.type._context);break;case 22:case 23:ap()}M=M.return}if(tn=x,bn=x=uu(x.current,null),$n=hi=b,wn=0,Xc=null,Qc=sn=ml=0,ea=Qu=null,ka!==null){for(b=0;b<ka.length;b++)if(M=ka[b],z=M.interleaved,z!==null){M.interleaved=null;var K=z.next,ee=M.pending;if(ee!==null){var fe=ee.next;ee.next=K,z.next=fe}M.pending=z}ka=null}return x}function rd(x,b){do{var M=bn;try{if(_f(),Yi.current=Ze,Zl){for(var z=Jr.memoizedState;z!==null;){var K=z.queue;K!==null&&(K.pending=null),z=z.next}Zl=!1}if(wo=0,Dn=On=Jr=null,Xi=!1,So=0,Yc.current=null,M===null||M.return===null){wn=1,Xc=b,bn=null;break}e:{var ee=x,fe=M.return,Ne=M,Ue=b;if(b=$n,Ne.flags|=32768,Ue!==null&&typeof Ue=="object"&&typeof Ue.then=="function"){var ot=Ue,Lt=Ne,lr=Lt.tag;if((Lt.mode&1)===0&&(lr===0||lr===11||lr===15)){var St=Lt.alternate;St?(Lt.updateQueue=St.updateQueue,Lt.memoizedState=St.memoizedState,Lt.lanes=St.lanes):(Lt.updateQueue=null,Lt.memoizedState=null)}var on=Vh(fe);if(on!==null){on.flags&=-257,Eo(on,fe,Ne,ee,b),on.mode&1&&Gh(ee,ot,b),b=on,Ue=ot;var qr=b.updateQueue;if(qr===null){var Aa=new Set;Aa.add(Ue),b.updateQueue=Aa}else qr.add(Ue);break e}else{if((b&1)===0){Gh(ee,ot,b),nd();break e}Ue=Error(s(426))}}else if($r&&Ne.mode&1){var Ro=Vh(fe);if(Ro!==null){(Ro.flags&65536)===0&&(Ro.flags|=256),Eo(Ro,fe,Ne,ee,b),Mc(ul(Ue,Ne));break e}}ee=Ue=ul(Ue,Ne),wn!==4&&(wn=2),Qu===null?Qu=[ee]:Qu.push(ee),ee=fe;do{switch(ee.tag){case 3:ee.flags|=65536,b&=-b,ee.lanes|=b;var Ie=Rr(ee,Ue,b);ql(ee,Ie);break e;case 1:Ne=Ue;var Pe=ee.type,Ve=ee.stateNode;if((ee.flags&128)===0&&(typeof Pe.getDerivedStateFromError=="function"||Ve!==null&&typeof Ve.componentDidCatch=="function"&&(ao===null||!ao.has(Ve)))){ee.flags|=65536,b&=-b,ee.lanes|=b;var _t=cl(ee,Ne,b);ql(ee,_t);break e}}ee=ee.return}while(ee!==null)}Am(M)}catch(Vt){b=Vt,bn===M&&M!==null&&(bn=M=M.return);continue}break}while(!0)}function Nm(){var x=jf.current;return jf.current=Ze,x===null?Ze:x}function nd(){(wn===0||wn===3||wn===2)&&(wn=4),tn===null||(ml&268435455)===0&&(sn&268435455)===0||gl(tn,$n)}function Ju(x,b){var M=fr;fr|=2;var z=Nm();(tn!==x||$n!==b)&&(Ma=null,ou(x,b));do try{E0();break}catch(K){rd(x,K)}while(!0);if(_f(),fr=M,jf.current=z,bn!==null)throw Error(s(261));return tn=null,$n=0,wn}function E0(){for(;bn!==null;)Mm(bn)}function Pm(){for(;bn!==null&&!bf();)Mm(bn)}function Mm(x){var b=A0(x.alternate,x,hi);x.memoizedProps=x.pendingProps,b===null?Am(x):bn=b,Yc.current=null}function Am(x){var b=x;do{var M=b.alternate;if(x=b.return,(b.flags&32768)===0){if(M=Ku(M,b,hi),M!==null){bn=M;return}}else{if(M=k0(M,b),M!==null){M.flags&=32767,bn=M;return}if(x!==null)x.flags|=32768,x.subtreeFlags=0,x.deletions=null;else{wn=6,bn=null;return}}if(b=b.sibling,b!==null){bn=b;return}bn=b=x}while(b!==null);wn===0&&(wn=5)}function lu(x,b,M){var z=gr,K=Fn.transition;try{Fn.transition=null,gr=1,T0(x,b,M,z)}finally{Fn.transition=K,gr=z}return null}function T0(x,b,M,z){do vl();while(js!==null);if((fr&6)!==0)throw Error(s(327));M=x.finishedWork;var K=x.finishedLanes;if(M===null)return null;if(x.finishedWork=null,x.finishedLanes=0,M===x.current)throw Error(s(177));x.callbackNode=null,x.callbackPriority=0;var ee=M.lanes|M.childLanes;if(Js(x,ee),x===tn&&(bn=tn=null,$n=0),(M.subtreeFlags&2064)===0&&(M.flags&2064)===0||su||(su=!0,Rm(Bl,function(){return vl(),null})),ee=(M.flags&15990)!==0,(M.subtreeFlags&15990)!==0||ee){ee=Fn.transition,Fn.transition=null;var fe=gr;gr=1;var Ne=fr;fr|=4,Yc.current=null,_0(x,M),Of(M,x),re(x.containerInfo),x.current=M,Kc(M),Xo(),fr=Ne,gr=fe,Fn.transition=ee}else x.current=M;if(su&&(su=!1,js=x,tp=K),ee=x.pendingLanes,ee===0&&(ao=null),Qo(M.stateNode),ra(x,An()),b!==null)for(z=x.onRecoverableError,M=0;M<b.length;M++)K=b[M],z(K.value,{componentStack:K.stack,digest:K.digest});if(Bn)throw Bn=!1,x=Qn,Qn=null,x;return(tp&1)!==0&&x.tag!==0&&vl(),ee=x.pendingLanes,(ee&1)!==0?x===Bf?Jn++:(Jn=0,Bf=x):Jn=0,ui(),null}function vl(){if(js!==null){var x=tr(tp),b=Fn.transition,M=gr;try{if(Fn.transition=null,gr=16>x?16:x,js===null)var z=!1;else{if(x=js,js=null,tp=0,(fr&6)!==0)throw Error(s(331));var K=fr;for(fr|=4,mt=x.current;mt!==null;){var ee=mt,fe=ee.child;if((mt.flags&16)!==0){var Ne=ee.deletions;if(Ne!==null){for(var Ue=0;Ue<Ne.length;Ue++){var ot=Ne[Ue];for(mt=ot;mt!==null;){var Lt=mt;switch(Lt.tag){case 0:case 11:case 15:Zu(8,Lt,ee)}var lr=Lt.child;if(lr!==null)lr.return=Lt,mt=lr;else for(;mt!==null;){Lt=mt;var St=Lt.sibling,on=Lt.return;if(Lf(Lt),Lt===ot){mt=null;break}if(St!==null){St.return=on,mt=St;break}mt=on}}}var qr=ee.alternate;if(qr!==null){var Aa=qr.child;if(Aa!==null){qr.child=null;do{var Ro=Aa.sibling;Aa.sibling=null,Aa=Ro}while(Aa!==null)}}mt=ee}}if((ee.subtreeFlags&2064)!==0&&fe!==null)fe.return=ee,mt=fe;else e:for(;mt!==null;){if(ee=mt,(ee.flags&2048)!==0)switch(ee.tag){case 0:case 11:case 15:Zu(9,ee,ee.return)}var Ie=ee.sibling;if(Ie!==null){Ie.return=ee.return,mt=Ie;break e}mt=ee.return}}var Pe=x.current;for(mt=Pe;mt!==null;){fe=mt;var Ve=fe.child;if((fe.subtreeFlags&2064)!==0&&Ve!==null)Ve.return=fe,mt=Ve;else e:for(fe=Pe;mt!==null;){if(Ne=mt,(Ne.flags&2048)!==0)try{switch(Ne.tag){case 0:case 11:case 15:$c(9,Ne)}}catch(Vt){fn(Ne,Ne.return,Vt)}if(Ne===fe){mt=null;break e}var _t=Ne.sibling;if(_t!==null){_t.return=Ne.return,mt=_t;break e}mt=Ne.return}}if(fr=K,ui(),Ln&&typeof Ln.onPostCommitFiberRoot=="function")try{Ln.onPostCommitFiberRoot(nn,x)}catch{}z=!0}return z}finally{gr=M,Fn.transition=b}}return!1}function Lm(x,b,M){b=ul(M,b),b=Rr(x,b,1),x=to(x,b,1),b=dn(),x!==null&&(Di(x,1,b),ra(x,b))}function fn(x,b,M){if(x.tag===3)Lm(x,x,M);else for(;b!==null;){if(b.tag===3){Lm(b,x,M);break}else if(b.tag===1){var z=b.stateNode;if(typeof b.type.getDerivedStateFromError=="function"||typeof z.componentDidCatch=="function"&&(ao===null||!ao.has(z))){x=ul(M,x),x=cl(b,x,1),b=to(b,x,1),x=dn(),b!==null&&(Di(b,1,x),ra(b,x));break}}b=b.return}}function N0(x,b,M){var z=x.pingCache;z!==null&&z.delete(b),b=dn(),x.pingedLanes|=x.suspendedLanes&M,tn===x&&($n&M)===M&&(wn===4||wn===3&&($n&130023424)===$n&&500>An()-Jc?ou(x,0):Qc|=M),ra(x,b)}function P0(x,b){b===0&&((x.mode&1)===0?b=1:(b=Qs,Qs<<=1,(Qs&130023424)===0&&(Qs=4194304)));var M=dn();x=$a(x,b),x!==null&&(Di(x,b,M),ra(x,M))}function M0(x){var b=x.memoizedState,M=0;b!==null&&(M=b.retryLane),P0(x,M)}function db(x,b){var M=0;switch(x.tag){case 13:var z=x.stateNode,K=x.memoizedState;K!==null&&(M=K.retryLane);break;case 19:z=x.stateNode;break;default:throw Error(s(314))}z!==null&&z.delete(b),P0(x,M)}var A0;A0=function(x,b,M){if(x!==null)if(x.memoizedProps!==b.pendingProps||Qr.current)jn=!0;else{if((x.lanes&M)===0&&(b.flags&128)===0)return jn=!1,tu(x,b,M);jn=(x.flags&131072)!==0}else jn=!1,$r&&(b.flags&1048576)!==0&&jh(b,Jo,b.index);switch(b.lanes=0,b.tag){case 2:var z=b.type;Af(x,b),x=b.pendingProps;var K=va(b,vn.current);Ki(b,M),K=Xl(null,b,z,x,K,M);var ee=jc();return b.flags|=1,typeof K=="object"&&K!==null&&typeof K.render=="function"&&K.$$typeof===void 0?(b.tag=1,b.memoizedState=null,b.updateQueue=null,Ft(z)?(ee=!0,li(b)):ee=!1,b.memoizedState=K.state!==null&&K.state!==void 0?K.state:null,Cf(b),K.updater=Ti,b.stateNode=K,K._reactInternals=b,Ds(b,z,x,M),b=Qi(null,b,z,!0,ee,M)):(b.tag=0,$r&&ee&&$i(b),Xn(null,b,K,M),b=b.child),b;case 16:z=b.elementType;e:{switch(Af(x,b),x=b.pendingProps,K=z._init,z=K(z._payload),b.type=z,K=b.tag=fb(z),x=Hr(z,x),K){case 0:b=To(null,b,z,x,M);break e;case 1:b=Fi(null,b,z,x,M);break e;case 11:b=Hh(null,b,z,x,M);break e;case 14:b=Hu(null,b,z,Hr(z.type,x),M);break e}throw Error(s(306,z,""))}return b;case 0:return z=b.type,K=b.pendingProps,K=b.elementType===z?K:Hr(z,K),To(x,b,z,K,M);case 1:return z=b.type,K=b.pendingProps,K=b.elementType===z?K:Hr(z,K),Fi(x,b,z,K,M);case 3:e:{if(eu(b),x===null)throw Error(s(387));z=b.pendingProps,ee=b.memoizedState,K=ee.element,eo(x,b),Ei(b,z,null,M);var fe=b.memoizedState;if(z=fe.element,we&&ee.isDehydrated)if(ee={element:z,isDehydrated:!1,cache:fe.cache,pendingSuspenseBoundaries:fe.pendingSuspenseBoundaries,transitions:fe.transitions},b.updateQueue.baseState=ee,b.memoizedState=ee,b.flags&256){K=ul(Error(s(423)),b),b=Wu(x,b,z,M,K);break e}else if(z!==K){K=ul(Error(s(424)),b),b=Wu(x,b,z,M,K);break e}else for(we&&(yn=Va(b.stateNode.containerInfo),Yn=b,$r=!0,wa=null,Gl=!1),M=Lc(b,null,z,M),b.child=M;M;)M.flags=M.flags&-3|4096,M=M.sibling;else{if(bo(),z===K){b=hl(x,b,M);break e}Xn(x,b,z,M)}b=b.child}return b;case 5:return zu(b),x===null&&wf(b),z=b.type,K=b.pendingProps,ee=x!==null?x.memoizedProps:null,fe=K.children,ge(z,K)?fe=null:ee!==null&&ge(z,ee)&&(b.flags|=32),en(x,b),Xn(x,b,fe,M),b.child;case 6:return x===null&&wf(b),null;case 13:return Sm(x,b,M);case 4:return $l(b,b.stateNode.containerInfo),z=b.pendingProps,x===null?b.child=el(b,null,z,M):Xn(x,b,z,M),b.child;case 11:return z=b.type,K=b.pendingProps,K=b.elementType===z?K:Hr(z,K),Hh(x,b,z,K,M);case 7:return Xn(x,b,b.pendingProps,M),b.child;case 8:return Xn(x,b,b.pendingProps.children,M),b.child;case 12:return Xn(x,b,b.pendingProps.children,M),b.child;case 10:e:{if(z=b.type._context,K=b.pendingProps,ee=b.memoizedProps,fe=K.value,qa(b,z,fe),ee!==null)if(ds(ee.value,fe)){if(ee.children===K.children&&!Qr.current){b=hl(x,b,M);break e}}else for(ee=b.child,ee!==null&&(ee.return=b);ee!==null;){var Ne=ee.dependencies;if(Ne!==null){fe=ee.child;for(var Ue=Ne.firstContext;Ue!==null;){if(Ue.context===z){if(ee.tag===1){Ue=Ka(-1,M&-M),Ue.tag=2;var ot=ee.updateQueue;if(ot!==null){ot=ot.shared;var Lt=ot.pending;Lt===null?Ue.next=Ue:(Ue.next=Lt.next,Lt.next=Ue),ot.pending=Ue}}ee.lanes|=M,Ue=ee.alternate,Ue!==null&&(Ue.lanes|=M),tl(ee.return,M,b),Ne.lanes|=M;break}Ue=Ue.next}}else if(ee.tag===10)fe=ee.type===b.type?null:ee.child;else if(ee.tag===18){if(fe=ee.return,fe===null)throw Error(s(341));fe.lanes|=M,Ne=fe.alternate,Ne!==null&&(Ne.lanes|=M),tl(fe,M,b),fe=ee.sibling}else fe=ee.child;if(fe!==null)fe.return=ee;else for(fe=ee;fe!==null;){if(fe===b){fe=null;break}if(ee=fe.sibling,ee!==null){ee.return=fe.return,fe=ee;break}fe=fe.return}ee=fe}Xn(x,b,K.children,M),b=b.child}return b;case 9:return K=b.type,z=b.pendingProps.children,Ki(b,M),K=Sa(K),z=z(K),b.flags|=1,Xn(x,b,z,M),b.child;case 14:return z=b.type,K=Hr(z,b.pendingProps),K=Hr(z.type,K),Hu(x,b,z,K,M);case 15:return fl(x,b,b.type,b.pendingProps,M);case 17:return z=b.type,K=b.pendingProps,K=b.elementType===z?K:Hr(z,K),Af(x,b),b.tag=1,Ft(z)?(x=!0,li(b)):x=!1,Ki(b,M),ll(b,z,K),Ds(b,z,K,M),Qi(null,b,z,!0,x,M);case 19:return qh(x,b,M);case 22:return an(x,b,M)}throw Error(s(156,b.tag))};function Rm(x,b){return Wn(x,b)}function L0(x,b,M,z){this.tag=x,this.key=M,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=b,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=z,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ws(x,b,M,z){return new L0(x,b,M,z)}function ad(x){return x=x.prototype,!(!x||!x.isReactComponent)}function fb(x){if(typeof x=="function")return ad(x)?1:0;if(x!=null){if(x=x.$$typeof,x===S)return 11;if(x===_)return 14}return 2}function uu(x,b){var M=x.alternate;return M===null?(M=ws(x.tag,b,x.key,x.mode),M.elementType=x.elementType,M.type=x.type,M.stateNode=x.stateNode,M.alternate=x,x.alternate=M):(M.pendingProps=b,M.type=x.type,M.flags=0,M.subtreeFlags=0,M.deletions=null),M.flags=x.flags&14680064,M.childLanes=x.childLanes,M.lanes=x.lanes,M.child=x.child,M.memoizedProps=x.memoizedProps,M.memoizedState=x.memoizedState,M.updateQueue=x.updateQueue,b=x.dependencies,M.dependencies=b===null?null:{lanes:b.lanes,firstContext:b.firstContext},M.sibling=x.sibling,M.index=x.index,M.ref=x.ref,M}function sp(x,b,M,z,K,ee){var fe=2;if(z=x,typeof x=="function")ad(x)&&(fe=1);else if(typeof x=="string")fe=5;else e:switch(x){case c:return Bi(M.children,K,ee,b);case f:fe=8,K|=8;break;case p:return x=ws(12,M,b,K|2),x.elementType=p,x.lanes=ee,x;case w:return x=ws(13,M,b,K),x.elementType=w,x.lanes=ee,x;case T:return x=ws(19,M,b,K),x.elementType=T,x.lanes=ee,x;case N:return sd(M,K,ee,b);default:if(typeof x=="object"&&x!==null)switch(x.$$typeof){case v:fe=10;break e;case y:fe=9;break e;case S:fe=11;break e;case _:fe=14;break e;case C:fe=16,z=null;break e}throw Error(s(130,x==null?x:typeof x,""))}return b=ws(fe,M,b,K),b.elementType=x,b.type=z,b.lanes=ee,b}function Bi(x,b,M,z){return x=ws(7,x,z,b),x.lanes=M,x}function sd(x,b,M,z){return x=ws(22,x,z,b),x.elementType=N,x.lanes=M,x.stateNode={isHidden:!1},x}function od(x,b,M){return x=ws(6,x,null,b),x.lanes=M,x}function op(x,b,M){return b=ws(4,x.children!==null?x.children:[],x.key,b),b.lanes=M,b.stateNode={containerInfo:x.containerInfo,pendingChildren:null,implementation:x.implementation},b}function R0(x,b,M,z,K){this.tag=b,this.containerInfo=x,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=le,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=yo(0),this.expirationTimes=yo(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=yo(0),this.identifierPrefix=z,this.onRecoverableError=K,we&&(this.mutableSourceEagerHydrationData=null)}function Om(x,b,M,z,K,ee,fe,Ne,Ue){return x=new R0(x,b,M,Ne,Ue),b===1?(b=1,ee===!0&&(b|=8)):b=0,ee=ws(3,null,null,b),x.current=ee,ee.stateNode=x,ee.memoizedState={element:z,isDehydrated:M,cache:null,transitions:null,pendingSuspenseBoundaries:null},Cf(ee),x}function lp(x){if(!x)return kr;x=x._reactInternals;e:{if(F(x)!==x||x.tag!==1)throw Error(s(170));var b=x;do{switch(b.tag){case 3:b=b.stateNode.context;break e;case 1:if(Ft(b.type)){b=b.stateNode.__reactInternalMemoizedMergedChildContext;break e}}b=b.return}while(b!==null);throw Error(s(171))}if(x.tag===1){var M=x.type;if(Ft(M))return Ou(x,M,b)}return b}function ec(x){var b=x._reactInternals;if(b===void 0)throw typeof x.render=="function"?Error(s(188)):(x=Object.keys(x).join(","),Error(s(268,x)));return x=Z(b),x===null?null:x.stateNode}function up(x,b){if(x=x.memoizedState,x!==null&&x.dehydrated!==null){var M=x.retryLane;x.retryLane=M!==0&&M<b?M:b}}function ld(x,b){up(x,b),(x=x.alternate)&&up(x,b)}function hb(x){return x=Z(x),x===null?null:x.stateNode}function O0(){return null}return r.attemptContinuousHydration=function(x){if(x.tag===13){var b=$a(x,134217728);if(b!==null){var M=dn();ta(b,x,134217728,M)}ld(x,134217728)}},r.attemptDiscreteHydration=function(x){if(x.tag===13){var b=$a(x,1);if(b!==null){var M=dn();ta(b,x,1,M)}ld(x,1)}},r.attemptHydrationAtCurrentPriority=function(x){if(x.tag===13){var b=pi(x),M=$a(x,b);if(M!==null){var z=dn();ta(M,x,b,z)}ld(x,b)}},r.attemptSynchronousHydration=function(x){switch(x.tag){case 3:var b=x.stateNode;if(b.current.memoizedState.isDehydrated){var M=vo(b.pendingLanes);M!==0&&(Wa(b,M|1),ra(b,An()),(fr&6)===0&&(Kr(),ui()))}break;case 13:Tm(function(){var z=$a(x,1);if(z!==null){var K=dn();ta(z,x,1,K)}}),ld(x,1)}},r.batchedUpdates=function(x,b){var M=fr;fr|=1;try{return x(b)}finally{fr=M,fr===0&&(Kr(),xo&&ui())}},r.createComponentSelector=function(x){return{$$typeof:pl,value:x}},r.createContainer=function(x,b,M,z,K,ee,fe){return Om(x,b,!1,null,M,z,K,ee,fe)},r.createHasPseudoClassSelector=function(x){return{$$typeof:Pa,value:x}},r.createHydrationContainer=function(x,b,M,z,K,ee,fe,Ne,Ue){return x=Om(M,z,!0,x,K,ee,fe,Ne,Ue),x.context=lp(null),M=x.current,z=dn(),K=pi(M),ee=Ka(z,K),ee.callback=b??null,to(M,ee,K),x.current.lanes=K,Di(x,K,z),ra(x,z),x},r.createPortal=function(x,b,M){var z=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:u,key:z==null?null:""+z,children:x,containerInfo:b,implementation:M}},r.createRoleSelector=function(x){return{$$typeof:Po,value:x}},r.createTestNameSelector=function(x){return{$$typeof:Zc,value:x}},r.createTextSelector=function(x){return{$$typeof:Df,value:x}},r.deferredUpdates=function(x){var b=gr,M=Fn.transition;try{return Fn.transition=null,gr=16,x()}finally{gr=b,Fn.transition=M}},r.discreteUpdates=function(x,b,M,z,K){var ee=gr,fe=Fn.transition;try{return Fn.transition=null,gr=1,x(b,M,z,K)}finally{gr=ee,Fn.transition=fe,fr===0&&Kr()}},r.findAllNodes=Lo,r.findBoundingRects=function(x,b){if(!Re)throw Error(s(363));b=Lo(x,b),x=[];for(var M=0;M<b.length;M++)x.push(Ce(b[M]));for(b=x.length-1;0<b;b--){M=x[b];for(var z=M.x,K=z+M.width,ee=M.y,fe=ee+M.height,Ne=b-1;0<=Ne;Ne--)if(b!==Ne){var Ue=x[Ne],ot=Ue.x,Lt=ot+Ue.width,lr=Ue.y,St=lr+Ue.height;if(z>=ot&&ee>=lr&&K<=Lt&&fe<=St){x.splice(b,1);break}else if(z!==ot||M.width!==Ue.width||St<ee||lr>fe){if(!(ee!==lr||M.height!==Ue.height||Lt<z||ot>K)){ot>z&&(Ue.width+=ot-z,Ue.x=z),Lt<K&&(Ue.width=K-ot),x.splice(b,1);break}}else{lr>ee&&(Ue.height+=lr-ee,Ue.y=ee),St<fe&&(Ue.height=fe-lr),x.splice(b,1);break}}}return x},r.findHostInstance=ec,r.findHostInstanceWithNoPortals=function(x){return x=$(x),x=x!==null?q(x):null,x===null?null:x.stateNode},r.findHostInstanceWithWarning=function(x){return ec(x)},r.flushControlled=function(x){var b=fr;fr|=1;var M=Fn.transition,z=gr;try{Fn.transition=null,gr=1,x()}finally{gr=z,Fn.transition=M,fr=b,fr===0&&(Kr(),ui())}},r.flushPassiveEffects=vl,r.flushSync=Tm,r.focusWithin=function(x,b){if(!Re)throw Error(s(363));for(x=Mo(x),b=Ao(x,b),b=Array.from(b),x=0;x<b.length;){var M=b[x++];if(!Ke(M)){if(M.tag===5&&vt(M.stateNode))return!0;for(M=M.child;M!==null;)b.push(M),M=M.sibling}}return!1},r.getCurrentUpdatePriority=function(){return gr},r.getFindAllNodesFailureDescription=function(x,b){if(!Re)throw Error(s(363));var M=0,z=[];x=[Mo(x),0];for(var K=0;K<x.length;){var ee=x[K++],fe=x[K++],Ne=b[fe];if((ee.tag!==5||!Ke(ee))&&(If(ee,Ne)&&(z.push(Jh(Ne)),fe++,fe>M&&(M=fe)),fe<b.length))for(ee=ee.child;ee!==null;)x.push(ee,fe),ee=ee.sibling}if(M<b.length){for(x=[];M<b.length;M++)x.push(Jh(b[M]));return`findAllNodes was able to match part of the selector:
  `+(z.join(" > ")+`

No matching component was found for:
  `)+x.join(" > ")}return null},r.getPublicRootInstance=function(x){return x=x.current,x.child?x.child.tag===5?W(x.child.stateNode):x.child.stateNode:null},r.injectIntoDevTools=function(x){if(x={bundleType:x.bundleType,version:x.version,rendererPackageName:x.rendererPackageName,rendererConfig:x.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:o.ReactCurrentDispatcher,findHostInstanceByFiber:hb,findFiberByHostInstance:x.findFiberByHostInstance||O0,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1"},typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u")x=!1;else{var b=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(b.isDisabled||!b.supportsFiber)x=!0;else{try{nn=b.inject(x),Ln=b}catch{}x=!!b.checkDCE}}return x},r.isAlreadyRendering=function(){return!1},r.observeVisibleRects=function(x,b,M,z){if(!Re)throw Error(s(363));x=Lo(x,b);var K=At(x,M,z).disconnect;return{disconnect:function(){K()}}},r.registerMutableSourceForHydration=function(x,b){var M=b._getVersion;M=M(b._source),x.mutableSourceEagerHydrationData==null?x.mutableSourceEagerHydrationData=[b,M]:x.mutableSourceEagerHydrationData.push(b,M)},r.runWithPriority=function(x,b){var M=gr;try{return gr=x,b()}finally{gr=M}},r.shouldError=function(){return null},r.shouldSuspend=function(){return!1},r.updateContainer=function(x,b,M,z){var K=b.current,ee=dn(),fe=pi(K);return M=lp(M),b.context===null?b.context=M:b.pendingContext=M,b=Ka(ee,fe),b.payload={element:x},z=z===void 0?null:z,z!==null&&(b.callback=z),x=to(K,b,fe),x!==null&&(ta(x,K,fe,ee),nl(x,K,fe)),fe},r}),j2}var C4;function zV(){return C4||(C4=1,I2.exports=BV()),I2.exports}var UV=zV();const GV=Mh(UV);var F2={exports:{}},Sd={};var E4;function VV(){return E4||(E4=1,Sd.ConcurrentRoot=1,Sd.ContinuousEventPriority=4,Sd.DefaultEventPriority=16,Sd.DiscreteEventPriority=1,Sd.IdleEventPriority=536870912,Sd.LegacyRoot=0),Sd}var T4;function HV(){return T4||(T4=1,F2.exports=VV()),F2.exports}var HL=HV(),WV=Sr();const N4={children:!0,ref:!0,key:!0,style:!0,forwardedRef:!0,unstable_applyCache:!0,unstable_applyDrawHitFromCache:!0};let P4=!1,M4=!1;const O_=".react-konva-event",qV=`ReactKonva: You have a Konva node with draggable = true and position defined but no onDragMove or onDragEnd events are handled.
Position of a node will be changed during drag&drop, so you should update state of the react app as well.
Consider to add onDragMove or onDragEnd events.
For more info see: https://github.com/konvajs/react-konva/issues/256
`,$V=`ReactKonva: You are using "zIndex" attribute for a Konva node.
react-konva may get confused with ordering. Just define correct order of elements in your render function of a component.
For more info see: https://github.com/konvajs/react-konva/issues/194
`,KV={};function V1(t,e,r=KV){if(!P4&&"zIndex"in e&&(console.warn($V),P4=!0),!M4&&e.draggable){var n=e.x!==void 0||e.y!==void 0,i=e.onDragEnd||e.onDragMove;n&&!i&&(console.warn(qV),M4=!0)}for(var a in r)if(!N4[a]){var s=a.slice(0,2)==="on",o=r[a]!==e[a];if(s&&o){var l=a.substr(2).toLowerCase();l.substr(0,7)==="content"&&(l="content"+l.substr(7,1).toUpperCase()+l.substr(8)),t.off(l,r[a])}var u=!e.hasOwnProperty(a);u&&t.setAttr(a,void 0)}var c=e._useStrictMode,f={},p=!1;const v={};for(var a in e)if(!N4[a]){var s=a.slice(0,2)==="on",y=r[a]!==e[a];if(s&&y){var l=a.substr(2).toLowerCase();l.substr(0,7)==="content"&&(l="content"+l.substr(7,1).toUpperCase()+l.substr(8)),e[a]&&(v[l]=e[a])}!s&&(e[a]!==r[a]||c&&e[a]!==t.getAttr(a))&&(p=!0,f[a]=e[a])}p&&(t.setAttrs(f),hf(t));for(var l in v)t.on(l+O_,v[l])}function hf(t){if(!WV.Konva.autoDrawEnabled){var e=t.getLayer()||t.getStage();e&&e.batchDraw()}}var B2=e_();const WL={},ZV={};Lv.Node.prototype._applyProps=V1;function YV(t,e){if(typeof e=="string"){console.error(`Do not use plain text as child of Konva.Node. You are using text: ${e}`);return}t.add(e),hf(t)}function XV(t,e,r){let n=Lv[t];n||(console.error(`Konva has no node with the type ${t}. Group will be used instead. If you use minimal version of react-konva, just import required nodes into Konva: "import "konva/lib/shapes/${t}"  If you want to render DOM elements as part of canvas tree take a look into this demo: https://konvajs.github.io/docs/react/DOM_Portal.html`),n=Lv.Group);const i={},a={};for(var s in e){var o=s.slice(0,2)==="on";o?a[s]=e[s]:i[s]=e[s]}const l=new n(i);return V1(l,a),l}function QV(t,e,r){console.error(`Text components are not supported for now in ReactKonva. Your text is: "${t}"`)}function JV(t,e,r){return!1}function eH(t){return t}function tH(){return null}function rH(){return null}function nH(t,e,r,n){return ZV}function iH(){}function aH(t){}function sH(t,e){return!1}function oH(){return WL}function lH(){return WL}const uH=setTimeout,cH=clearTimeout,dH=-1;function fH(t,e){return!1}const hH=!1,pH=!0,mH=!0;function gH(t,e){e.parent===t?e.moveToTop():t.add(e),hf(t)}function vH(t,e){e.parent===t?e.moveToTop():t.add(e),hf(t)}function qL(t,e,r){e._remove(),t.add(e),e.setZIndex(r.getZIndex()),hf(t)}function yH(t,e,r){qL(t,e,r)}function xH(t,e){e.destroy(),e.off(O_),hf(t)}function bH(t,e){e.destroy(),e.off(O_),hf(t)}function wH(t,e,r){console.error(`Text components are not yet supported in ReactKonva. You text is: "${r}"`)}function SH(t,e,r){}function kH(t,e,r,n,i){V1(t,i,n)}function _H(t){t.hide(),hf(t)}function CH(t){}function EH(t,e){(e.visible==null||e.visible)&&t.show()}function TH(t,e){}function NH(t){}function PH(){}const MH=()=>HL.DefaultEventPriority,AH=Object.freeze(Object.defineProperty({__proto__:null,appendChild:gH,appendChildToContainer:vH,appendInitialChild:YV,cancelTimeout:cH,clearContainer:NH,commitMount:SH,commitTextUpdate:wH,commitUpdate:kH,createInstance:XV,createTextInstance:QV,detachDeletedInstance:PH,finalizeInitialChildren:JV,getChildHostContext:lH,getCurrentEventPriority:MH,getPublicInstance:eH,getRootHostContext:oH,hideInstance:_H,hideTextInstance:CH,idlePriority:B2.unstable_IdlePriority,insertBefore:qL,insertInContainerBefore:yH,isPrimaryRenderer:hH,noTimeout:dH,now:B2.unstable_now,prepareForCommit:tH,preparePortalMount:rH,prepareUpdate:nH,removeChild:xH,removeChildFromContainer:bH,resetAfterCommit:iH,resetTextContent:aH,run:B2.unstable_runWithPriority,scheduleTimeout:uH,shouldDeprioritizeSubtree:sH,shouldSetTextContent:fH,supportsMutation:mH,unhideInstance:EH,unhideTextInstance:TH,warnsIfNotActing:pH},Symbol.toStringTag,{value:"Module"}));var LH=Object.defineProperty,RH=Object.defineProperties,OH=Object.getOwnPropertyDescriptors,A4=Object.getOwnPropertySymbols,DH=Object.prototype.hasOwnProperty,IH=Object.prototype.propertyIsEnumerable,L4=(t,e,r)=>e in t?LH(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,R4=(t,e)=>{for(var r in e||(e={}))DH.call(e,r)&&L4(t,r,e[r]);if(A4)for(var r of A4(e))IH.call(e,r)&&L4(t,r,e[r]);return t},jH=(t,e)=>RH(t,OH(e)),O4,D4;typeof window<"u"&&((O4=window.document)!=null&&O4.createElement||((D4=window.navigator)==null?void 0:D4.product)==="ReactNative")?se.useLayoutEffect:se.useEffect;function $L(t,e,r){if(!t)return;if(r(t)===!0)return t;let n=t.child;for(;n;){const i=$L(n,e,r);if(i)return i;n=n.sibling}}function KL(t){try{return Object.defineProperties(t,{_currentRenderer:{get(){return null},set(){}},_currentRenderer2:{get(){return null},set(){}}})}catch{return t}}const I4=console.error;console.error=function(){const t=[...arguments].join("");if(t?.startsWith("Warning:")&&t.includes("useContext")){console.error=I4;return}return I4.apply(this,arguments)};const D_=KL(se.createContext(null));class ZL extends se.Component{render(){return se.createElement(D_.Provider,{value:this._reactInternals},this.props.children)}}function FH(){const t=se.useContext(D_);if(t===null)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const e=se.useId();return se.useMemo(()=>{for(const n of[t,t?.alternate]){if(!n)continue;const i=$L(n,!1,a=>{let s=a.memoizedState;for(;s;){if(s.memoizedState===e)return!0;s=s.next}});if(i)return i}},[t,e])}function BH(){const t=FH(),[e]=se.useState(()=>new Map);e.clear();let r=t;for(;r;){if(r.type&&typeof r.type=="object"){const i=r.type._context===void 0&&r.type.Provider===r.type?r.type:r.type._context;i&&i!==D_&&!e.has(i)&&e.set(i,se.useContext(KL(i)))}r=r.return}return e}function zH(){const t=BH();return se.useMemo(()=>Array.from(t.keys()).reduce((e,r)=>n=>se.createElement(e,null,se.createElement(r.Provider,jH(R4({},n),{value:t.get(r)}))),e=>se.createElement(ZL,R4({},e))),[t])}function UH(t){const e=sr.useRef({});return sr.useLayoutEffect(()=>{e.current=t}),sr.useLayoutEffect(()=>()=>{e.current={}},[]),e.current}const GH=t=>{const e=sr.useRef(),r=sr.useRef(),n=sr.useRef(),i=UH(t),a=zH(),s=o=>{const{forwardedRef:l}=t;l&&(typeof l=="function"?l(o):l.current=o)};return sr.useLayoutEffect(()=>(r.current=new Lv.Stage({width:t.width,height:t.height,container:e.current}),s(r.current),n.current=Xg.createContainer(r.current,HL.LegacyRoot,!1,null),Xg.updateContainer(sr.createElement(a,{},t.children),n.current),()=>{Lv.isBrowser&&(s(null),Xg.updateContainer(null,n.current,null),r.current.destroy())}),[]),sr.useLayoutEffect(()=>{s(r.current),V1(r.current,t,i),Xg.updateContainer(sr.createElement(a,{},t.children),n.current,null)}),sr.createElement("div",{ref:e,id:t.id,accessKey:t.accessKey,className:t.className,role:t.role,style:t.style,tabIndex:t.tabIndex,title:t.title})},sk="Layer",j4="Rect",YL="Line",VH="Image",HH="Text",WH="Transformer",Xg=GV(AH);Xg.injectIntoDevTools({findHostInstanceByFiber:()=>null,bundleType:0,version:sr.version,rendererPackageName:"react-konva"});const XL=sr.forwardRef((t,e)=>sr.createElement(ZL,{},sr.createElement(GH,{...t,forwardedRef:e}))),qH=({isOpen:t,onClose:e,onConfirm:r,title:n,message:i,initialValue:a="",placeholder:s="",confirmText:o="Confirmar",cancelText:l="Cancelar"})=>{const[u,c]=se.useState(a),f=se.useRef(null);if(se.useEffect(()=>{c(a)},[a,t]),se.useEffect(()=>{t&&f.current&&setTimeout(()=>f.current.focus(),50)},[t]),!t)return null;const p=v=>{v.preventDefault(),r(u),e()};return Al.createPortal(m.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/80 backdrop-blur-md animate-in fade-in duration-300",children:m.jsxs("div",{className:"bg-[#0f0f13] border border-white/10 rounded-2xl p-6 shadow-2xl shadow-black/50 w-full max-w-md space-y-5 animate-in zoom-in-95 slide-in-from-bottom-2 duration-300 relative overflow-hidden ring-1 ring-white/5",onClick:v=>v.stopPropagation(),children:[m.jsx("div",{className:"absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-primary to-transparent opacity-70"}),m.jsx("div",{className:"absolute -top-10 -right-10 size-40 bg-primary/5 rounded-full blur-3xl pointer-events-none"}),m.jsxs("div",{children:[m.jsx("h3",{className:"text-xl font-bold text-white tracking-tight",children:n}),i&&m.jsx("p",{className:"text-sm text-slate-400 leading-relaxed mt-2",children:i})]}),m.jsxs("form",{onSubmit:p,className:"space-y-6",children:[m.jsx("input",{ref:f,type:"text",value:u,onChange:v=>c(v.target.value),placeholder:s,className:"w-full bg-black/30 border border-white/10 rounded-xl px-4 py-3.5 text-white placeholder-slate-600 focus:border-primary/50 focus:ring-1 focus:ring-primary/50 outline-none transition-all font-sans text-sm shadow-inner"}),m.jsxs("div",{className:"flex justify-end gap-3 pt-2",children:[m.jsx("button",{type:"button",onClick:e,className:"px-4 py-2 text-sm text-slate-400 hover:text-white transition-colors",children:l}),m.jsx(mn,{type:"submit",variant:"primary",disabled:!u.trim(),children:o})]})]})]})}),document.body)},z2=({stepNumber:t,title:e,isOpen:r,onClick:n,children:i})=>m.jsxs("div",{className:`border border-white/10 rounded-2xl bg-[#13141f] overflow-hidden transition-all duration-300 ${r?"ring-1 ring-primary/50":"opacity-80"}`,children:[m.jsxs("button",{onClick:n,className:"w-full flex items-center justify-between p-6 hover:bg-white/5 transition-colors",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("div",{className:`size-8 rounded-full flex items-center justify-center font-black text-sm ${r?"bg-primary text-white":"bg-white/10 text-slate-400"}`,children:t}),m.jsx("h3",{className:`text-lg font-bold ${r?"text-white":"text-slate-400"}`,children:e})]}),m.jsx("span",{className:`material-symbols-outlined transition-transform duration-300 ${r?"rotate-180 text-primary":"text-slate-500"}`,children:"expand_more"})]}),r&&m.jsx("div",{className:"p-6 pt-0 border-t border-white/5 animate-in fade-in slide-in-from-top-2",children:i})]}),U2=({icon:t,title:e,desc:r,selected:n,onClick:i})=>m.jsxs("div",{onClick:i,className:`p-6 rounded-xl border cursor-pointer transition-all relative group h-full flex flex-col justify-between ${n?"bg-primary/20 border-primary shadow-[0_0_30px_rgba(var(--color-primary),0.3)]":"bg-[#0a0a0c] border-white/10 hover:border-white/30"}`,children:[m.jsxs("div",{className:"mb-4",children:[m.jsx("div",{className:`size-12 rounded-lg flex items-center justify-center mb-4 ${n?"bg-primary text-white":"bg-white/10 text-slate-400 group-hover:text-white group-hover:bg-white/20"}`,children:m.jsx("span",{className:"material-symbols-outlined text-2xl",children:t})}),m.jsx("h4",{className:"font-bold text-white mb-1",children:e}),m.jsx("p",{className:"text-xs text-slate-500 leading-relaxed",children:r})]}),n&&m.jsx("div",{className:"absolute top-4 right-4 size-3 bg-primary rounded-full shadow-glow"})]}),$H=({src:t,x:e,y:r,width:n,height:i,...a})=>{const[s,o]=se.useState(null);return se.useEffect(()=>{if(!t)return;const l=new window.Image;l.src=t,l.crossOrigin="Anonymous",l.onload=()=>{o(l)}},[t]),m.jsx(VH,{image:s,x:e,y:r,width:n,height:i,...a})},KH=({selectedId:t})=>{const e=sr.useRef();return sr.useEffect(()=>{if(t){const r=e.current.getStage().findOne("#"+t);r&&(e.current.nodes([r]),e.current.getLayer().batchDraw())}else e.current.nodes([])},[t]),m.jsx(WH,{ref:e})},ok=({mode:t})=>{const{username:e,projectName:r,folderId:n,entityId:i}=Vi(),a=za(),s=Ah(),{setRightOpen:o,setRightPanelMode:l,setAvailableTemplates:u,mapSettings:c,setMapSettings:f,setOnMapSettingsChange:p}=Ll(),[v,y]=se.useState(t==="create"?"setup":"editor");se.useEffect(()=>{y(t==="create"?"setup":"editor")},[t]);const[S,w]=se.useState(s.state?.folderId||null),[T,_]=se.useState(1),[C,N]=se.useState({name:"New Map",description:"",parentZone:null,type:"regional",sourceType:"blank",dims:{width:800,height:600},bgImage:null}),[A,O]=se.useState(!1),[j,D]=se.useState("brush"),[F,B]=se.useState([]),[$,Z]=se.useState([]),[I,q]=se.useState([]),[U,W]=se.useState(null),Y=sr.useRef(!1),[Q,ne]=se.useState({isOpen:!1,id:null,text:""}),re=le=>{(le.target===le.target.getStage()||le.target.name()==="bg-image")&&W(null)},H=le=>{re(le);const he=le.target.getStage().getPointerPosition();j!=="select"&&(Y.current=!0,j==="brush"||j==="eraser"?B([...F,{id:`line-${Date.now()}`,tool:j,points:[he.x,he.y],color:j==="eraser"?"#ffffff":"#df4b26",size:j==="eraser"?20:5}]):j==="rect"?Z([...$,{id:`rect-${Date.now()}`,x:he.x,y:he.y,width:0,height:0,color:"#df4b26"}]):j==="text"&&(q([...I,{id:`text-${Date.now()}`,x:he.x,y:he.y,text:"Double click to edit",fontSize:20,color:"#ffffff"}]),Y.current=!1))},te=le=>{if(!Y.current)return;const he=le.target.getStage().getPointerPosition();j==="brush"||j==="eraser"?B(xe=>{const we=[...xe],Ge={...we[we.length-1]};return Ge.points=Ge.points.concat([he.x,he.y]),we[we.length-1]=Ge,we}):j==="rect"&&Z(xe=>{const we=[...xe],Ge={...we[we.length-1]};return Ge.width=he.x-Ge.x,Ge.height=he.y-Ge.y,we[we.length-1]=Ge,we})},ie=()=>{Y.current=!1};se.useEffect(()=>{if(o(v==="editor"),v==="editor"){l("MAP");const le={showGrid:!0,gridSize:50,width:C.dims.width,height:C.dims.height};f(le),p(me=>{me&&N(he=>({...he,dims:{width:me.width,height:me.height},bgImage:me.bgImage||he.bgImage}))})}},[v]),se.useEffect(()=>{t==="create"&&!S&&n&&(console.log("Resolving folder ID for slug:",n),Qe.get(`/world-bible/folders/${n}`).then(le=>w(le.id)).catch(le=>console.error("Could not resolve folder ID",le)))},[t,n,S]);const de=le=>{const me=le.target.files[0];if(me){const he=new FileReader;he.onload=xe=>{const we=new Image;we.onload=()=>{N(Ge=>({...Ge,bgImage:xe.target.result,dims:{width:we.width,height:we.height},sourceType:"upload"}))},we.src=xe.target.result},he.readAsDataURL(me)}},ge=sr.useRef(null),ye=async()=>{if(!S){alert("Folder context missing. Please start from the folder view again.");return}O(!0);try{let le=C.bgImage;if(ge.current){const xe=ge.current.findOne("Transformer");if(xe&&xe.nodes([]),le=ge.current.toDataURL({pixelRatio:.5}),xe&&U){const we=ge.current.findOne("#"+U);we&&xe.nodes([we])}}const me={nombre:C.name,tipoEspecial:"map",carpetaId:S,descripcion:C.description,attributes:{type:C.type,width:C.dims.width,height:C.dims.height,bgImage:C.bgImage,layers:{lines:F,rectangles:$,texts:I},snapshotUrl:le},iconUrl:le},he=await Qe.post("/world-bible/entities",me);window.dispatchEvent(new CustomEvent("folder-update",{detail:{folderId:S}})),a(`/${e}/${r}/map-editor/edit/${he.id}`,{replace:!0})}catch(le){console.error(le),alert("Error creating map. Check console.")}finally{O(!1)}},ae=sr.useRef(null);se.useEffect(()=>{(!t||t==="edit")&&i&&Qe.get(`/world-bible/entities/${i}`).then(le=>{w(le.carpetaId),ae.current=le.iconUrl,y("editor");let me=le.attributes||{},he={};const xe=me.layers||me.bgImage;if(!xe&&le.descripcion&&le.descripcion.trim().startsWith("{"))try{he=JSON.parse(le.descripcion)}catch(qe){console.error("Error parsing legacy map data",qe)}const we=xe?me:he;let Ge=le.descripcion;le.descripcion&&le.descripcion.trim().startsWith("{")&&(Ge=he.description||""),N({name:le.nombre,description:Ge||"",parentZone:null,type:we.type||"regional",sourceType:we.bgImage?"upload":"blank",dims:{width:we.width||800,height:we.height||600},bgImage:we.bgImage}),we.layers&&(B(we.layers.lines||[]),Z(we.layers.rectangles||[]),q(we.layers.texts||[])),f({name:le.nombre,description:Ge||"",type:we.type||"regional",showGrid:!0,gridSize:50,width:we.width||800,height:we.height||600,bgImage:we.bgImage})}).catch(le=>console.error("Error loading entity",le))},[t,i]);const pe=async()=>{O(!0);try{let le=C.bgImage;if(ge.current){W(null);const he=ge.current.findOne("Transformer");he&&he.nodes([]),le=ge.current.toDataURL({pixelRatio:.5})}const me={id:i,nombre:C.name,tipoEspecial:"map",carpetaId:S,descripcion:C.description,attributes:{type:C.type,width:C.dims.width,height:C.dims.height,bgImage:C.bgImage,layers:{lines:F,rectangles:$,texts:I},snapshotUrl:le},iconUrl:ae.current};await Qe.put(`/world-bible/entities/${i}`,me),a(S?`/${e}/${r}/bible/folder/${S}`:`/${e}/${r}/bible`)}catch(le){console.error("Save failed",le),alert("Error saving map")}finally{O(!1)}};return v==="setup"?m.jsxs("div",{className:"flex-1 flex flex-col h-screen bg-[#060608] text-white",children:[m.jsxs("div",{className:"h-16 border-b border-white/5 flex items-center justify-between px-8 bg-[#0a0a0c]",children:[m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsx("div",{className:"p-2 bg-primary/20 rounded-lg text-primary",children:m.jsx("span",{className:"material-symbols-outlined",children:"add_circle"})}),m.jsxs("div",{children:[m.jsx("h1",{className:"text-lg font-bold leading-tight",children:"Create New Map / Zone"}),m.jsx("p",{className:"text-[10px] text-slate-500 uppercase font-bold tracking-wider",children:"Configure details for your new cartography entry"})]})]}),m.jsx("button",{onClick:()=>a(-1),className:"p-2 hover:bg-white/5 rounded-full text-slate-500 hover:text-white transition-colors",children:m.jsx("span",{className:"material-symbols-outlined",children:"close"})})]}),m.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-8",children:m.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[m.jsx(z2,{stepNumber:"1",title:"Identity & Hierarchy",isOpen:T===1,onClick:()=>_(1),children:m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{children:[m.jsx("label",{className:"text-[10px] uppercase font-bold text-slate-500 mb-2 block",children:"Map Name"}),m.jsx("input",{autoFocus:!0,value:C.name,onChange:le=>N({...C,name:le.target.value}),className:"w-full bg-[#0a0a0c] border border-white/10 rounded-xl p-4 text-white focus:border-primary outline-none transition-colors",placeholder:"e.g. The Sapphire Coast"})]}),m.jsxs("div",{children:[m.jsx("label",{className:"text-[10px] uppercase font-bold text-slate-500 mb-2 block",children:"Parent Zone (Optional)"}),m.jsxs("div",{className:"w-full bg-[#0a0a0c] border border-white/10 rounded-xl p-4 text-slate-400 flex items-center justify-between cursor-pointer hover:border-white/20",children:[m.jsx("span",{children:"Current Folder (Default)"}),m.jsx("span",{className:"material-symbols-outlined text-sm",children:"expand_more"})]}),m.jsx("p",{className:"text-[10px] text-slate-600 mt-2",children:"Selecting a parent makes this a sub-zone."})]})]}),m.jsxs("div",{children:[m.jsx("label",{className:"text-[10px] uppercase font-bold text-slate-500 mb-2 block",children:"Description"}),m.jsx("textarea",{value:C.description,onChange:le=>N({...C,description:le.target.value}),className:"w-full h-40 bg-[#0a0a0c] border border-white/10 rounded-xl p-4 text-white resize-none focus:border-primary outline-none transition-colors leading-relaxed",placeholder:"Brief description of geography, climate, or importance..."})]})]})}),m.jsx(z2,{stepNumber:"2",title:"Map Type",isOpen:T===2,onClick:()=>_(2),children:m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[m.jsx(U2,{icon:"public",title:"World Map",desc:"Continents, oceans, global scale.",selected:C.type==="world",onClick:()=>N({...C,type:"world"})}),m.jsx(U2,{icon:"map",title:"Regional Map",desc:"Kingdoms, provinces, biomes.",selected:C.type==="regional",onClick:()=>N({...C,type:"regional"})}),m.jsx(U2,{icon:"location_city",title:"City / Local",desc:"Cities, dungeons, battlemaps.",selected:C.type==="local",onClick:()=>N({...C,type:"local"})})]})}),m.jsx(z2,{stepNumber:"3",title:"Canvas Source",isOpen:T===3,onClick:()=>_(3),children:m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[m.jsxs("div",{onClick:()=>document.getElementById("map-upload-input").click(),className:`relative p-8 rounded-xl border-2 border-dashed flex flex-col items-center justify-center text-center cursor-pointer transition-all group min-h-[200px] ${C.sourceType==="upload"?"border-primary bg-primary/5":"border-white/10 hover:border-white/30 bg-[#0a0a0c]"}`,children:[m.jsx("input",{id:"map-upload-input",type:"file",accept:"image/*",className:"hidden",onChange:de}),C.bgImage?m.jsx("img",{src:C.bgImage,alt:"Preview",className:"absolute inset-0 w-full h-full object-cover rounded-xl opacity-50 group-hover:opacity-70"}):m.jsxs(m.Fragment,{children:[m.jsx("div",{className:"size-16 bg-white/5 rounded-full flex items-center justify-center mb-4 group-hover:scale-110 transition-transform",children:m.jsx("span",{className:"material-symbols-outlined text-3xl text-slate-400",children:"cloud_upload"})}),m.jsx("h4",{className:"font-bold text-white",children:"Upload Image File"}),m.jsx("p",{className:"text-xs text-slate-500 mt-2",children:"Drag & drop or click to browse"}),m.jsx("p",{className:"text-[10px] text-slate-600 mt-1 uppercase font-bold",children:"JPG, PNG, WEBP  Max 20MB"})]}),C.sourceType==="upload"&&m.jsx("div",{className:"absolute top-4 right-4 size-3 bg-primary rounded-full shadow-glow z-10"})]}),m.jsxs("div",{onClick:()=>N({...C,sourceType:"blank",bgImage:null}),className:`p-8 rounded-xl border flex flex-col items-center justify-center text-center cursor-pointer transition-all min-h-[200px] ${C.sourceType==="blank"?"border-primary bg-primary/5":"border-white/10 hover:border-white/30 bg-[#0a0a0c]"}`,children:[m.jsx("div",{className:"size-16 bg-white/5 rounded-full flex items-center justify-center mb-4",children:m.jsx("span",{className:"material-symbols-outlined text-3xl text-slate-400",children:"check_box_outline_blank"})}),m.jsx("h4",{className:"font-bold text-white",children:"Blank Canvas"}),m.jsx("p",{className:"text-xs text-slate-500 mt-2",children:"Start a new drawing from scratch"}),C.sourceType==="blank"&&m.jsxs("div",{className:"mt-6 flex items-center gap-2 bg-black/50 p-1 rounded-lg border border-white/10",children:[m.jsx("span",{className:"text-[10px] uppercase font-bold text-slate-500 px-2",children:"Size"}),m.jsx("span",{className:"text-xs font-mono text-white",children:"4096 px"}),m.jsx("span",{className:"text-xs text-slate-500",children:"x"}),m.jsx("span",{className:"text-xs font-mono text-white",children:"4096 px"})]})]})]})})]})}),m.jsxs("div",{className:"h-20 border-t border-white/5 bg-[#0a0a0c] flex items-center justify-between px-8 z-20",children:[m.jsx("button",{onClick:()=>a(-1),className:"text-sm font-bold text-slate-500 hover:text-white transition-colors",children:"Cancel"}),m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("span",{className:"text-xs text-slate-600 italic",children:"Changes saved locally"}),m.jsx(mn,{variant:"primary",size:"lg",icon:"check",onClick:ye,disabled:!C.name||A,className:"bg-primary hover:bg-primary-light text-white shadow-lg shadow-primary/25 px-8",children:A?"Creating...":"Create Map"})]})]})]}):m.jsxs("div",{className:"flex flex-col h-screen w-full bg-[#0f0f13] text-white overflow-hidden",children:[m.jsxs("header",{className:"h-14 border-b border-white/5 flex items-center justify-between px-4 bg-[#1a1a20] shrink-0",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("button",{onClick:()=>a(-1),className:"p-2 hover:bg-white/5 rounded-full",title:"Back to Collection",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"arrow_back"})}),m.jsxs("div",{className:"flex flex-col",children:[m.jsx("input",{value:C.name,onChange:le=>N({...C,name:le.target.value}),className:"bg-transparent font-bold text-sm outline-none focus:bg-white/5 rounded px-2 -ml-2"}),m.jsxs("span",{className:"text-[10px] text-text-muted px-2",children:[C.dims.width," x ",C.dims.height,"  ",c?.gridSize||50,"px Grid"]})]})]}),m.jsx("div",{className:"flex items-center gap-2",children:m.jsx(mn,{variant:"primary",size:"sm",icon:"save",onClick:pe,disabled:A,children:A?"Saving...":"Save Changes"})})]}),m.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[m.jsx("div",{className:"w-14 bg-[#1a1a20] border-r border-white/5 flex flex-col items-center py-4 gap-4 z-10",children:[{id:"select",icon:"near_me"},{id:"brush",icon:"brush"},{id:"eraser",icon:"ink_eraser"},{id:"rect",icon:"check_box_outline_blank"},{id:"text",icon:"title"}].map(le=>m.jsx("button",{onClick:()=>D(le.id),className:`p-2 rounded-lg transition-colors ${j===le.id?"bg-primary text-white shadow-lg shadow-primary/30":"hover:bg-white/5 text-slate-400 hover:text-white"}`,children:m.jsx("span",{className:"material-symbols-outlined",children:le.icon})},le.id))}),m.jsx("div",{className:"flex-1 overflow-auto bg-[#0f0f13] relative flex items-center justify-center p-8 custom-scrollbar",children:m.jsx("div",{className:"bg-[#1a1a20] shadow-[0_0_50px_rgba(0,0,0,0.5)] flex-none",children:m.jsxs(XL,{ref:ge,width:C.dims.width,height:C.dims.height,onMouseDown:H,onMouseMove:te,onMouseUp:ie,className:"bg-white",children:[m.jsxs(sk,{children:[C.bgImage&&m.jsx($H,{name:"bg-image",src:C.bgImage,x:0,y:0,width:C.dims.width,height:C.dims.height,onMouseDown:H,onTouchStart:H}),c?.showGrid&&m.jsx(j4,{width:C.dims.width,height:C.dims.height,fillPatternImage:(()=>{const le=document.createElement("canvas");le.width=c.gridSize||50,le.height=c.gridSize||50;const me=le.getContext("2d");return me.strokeStyle="rgba(0,0,0,0.2)",me.lineWidth=1,me.strokeRect(0,0,le.width,le.height),le})(),listening:!1})]}),m.jsxs(sk,{children:[F.map((le,me)=>m.jsx(YL,{points:le.points,stroke:le.color,strokeWidth:le.size,tension:.5,lineCap:"round",lineJoin:"round",globalCompositeOperation:le.tool==="eraser"?"destination-out":"source-over"},me)),$.map((le,me)=>m.jsx(j4,{id:le.id,x:le.x,y:le.y,width:le.width,height:le.height,stroke:le.color,strokeWidth:2,draggable:j==="select",onClick:()=>j==="select"&&W(le.id),onTap:()=>j==="select"&&W(le.id)},le.id)),I.map((le,me)=>m.jsx(HH,{id:le.id,x:le.x,y:le.y,text:le.text,fontSize:le.fontSize,fill:le.color,draggable:j==="select",onClick:()=>j==="select"&&W(le.id),onTap:()=>j==="select"&&W(le.id),onDblClick:he=>{ne({isOpen:!0,id:le.id,text:le.text})}},le.id)),m.jsx(KH,{selectedId:U})]})]})})})]}),m.jsx(qH,{isOpen:Q.isOpen,onClose:()=>ne(le=>({...le,isOpen:!1})),title:"Edit Map Text",initialValue:Q.text,onConfirm:le=>{q(me=>me.map(he=>he.id===Q.id?{...he,text:le}:he))},confirmText:"Save Text"})]})};function QL(t,e){const r=se.useRef(e);se.useEffect(function(){e!==r.current&&t.attributionControl!=null&&(r.current!=null&&t.attributionControl.removeAttribution(r.current),e!=null&&t.attributionControl.addAttribution(e)),r.current=e},[t,e])}const ZH=1;function YH(t){return Object.freeze({__version:ZH,map:t})}function JL(t,e){return Object.freeze({...t,...e})}const eR=se.createContext(null),tR=eR.Provider;function I_(){const t=se.useContext(eR);if(t==null)throw new Error("No context provided: useLeafletContext() can only be used in a descendant of <MapContainer>");return t}function XH(t){function e(r,n){const{instance:i,context:a}=t(r).current;return se.useImperativeHandle(n,()=>i),r.children==null?null:sr.createElement(tR,{value:a},r.children)}return se.forwardRef(e)}function QH(t){function e(r,n){const[i,a]=se.useState(!1),{instance:s}=t(r,a).current;se.useImperativeHandle(n,()=>s),se.useEffect(function(){i&&s.update()},[s,i,r.children]);const o=s._contentNode;return o?Al.createPortal(r.children,o):null}return se.forwardRef(e)}function rR(t,e){const r=se.useRef();se.useEffect(function(){return e!=null&&t.instance.on(e),r.current=e,function(){r.current!=null&&t.instance.off(r.current),r.current=null}},[t,e])}function nR(t,e){const r=t.pane??e.pane;return r?{...t,pane:r}:t}function JH(t,e){return function(n,i){const a=I_(),s=t(nR(n,a),a);return QL(a.map,n.attribution),rR(s.current,n.eventHandlers),e(s.current,a,n,i),s}}var Qg={exports:{}};var eW=Qg.exports,F4;function tW(){return F4||(F4=1,(function(t,e){(function(r,n){n(e)})(eW,(function(r){var n="1.9.4";function i(h){var k,P,G,J;for(P=1,G=arguments.length;P<G;P++){J=arguments[P];for(k in J)h[k]=J[k]}return h}var a=Object.create||(function(){function h(){}return function(k){return h.prototype=k,new h}})();function s(h,k){var P=Array.prototype.slice;if(h.bind)return h.bind.apply(h,P.call(arguments,1));var G=P.call(arguments,2);return function(){return h.apply(k,G.length?G.concat(P.call(arguments)):arguments)}}var o=0;function l(h){return"_leaflet_id"in h||(h._leaflet_id=++o),h._leaflet_id}function u(h,k,P){var G,J,ue,Se;return Se=function(){G=!1,J&&(ue.apply(P,J),J=!1)},ue=function(){G?J=arguments:(h.apply(P,arguments),setTimeout(Se,k),G=!0)},ue}function c(h,k,P){var G=k[1],J=k[0],ue=G-J;return h===G&&P?h:((h-J)%ue+ue)%ue+J}function f(){return!1}function p(h,k){if(k===!1)return h;var P=Math.pow(10,k===void 0?6:k);return Math.round(h*P)/P}function v(h){return h.trim?h.trim():h.replace(/^\s+|\s+$/g,"")}function y(h){return v(h).split(/\s+/)}function S(h,k){Object.prototype.hasOwnProperty.call(h,"options")||(h.options=h.options?a(h.options):{});for(var P in k)h.options[P]=k[P];return h.options}function w(h,k,P){var G=[];for(var J in h)G.push(encodeURIComponent(P?J.toUpperCase():J)+"="+encodeURIComponent(h[J]));return(!k||k.indexOf("?")===-1?"?":"&")+G.join("&")}var T=/\{ *([\w_ -]+) *\}/g;function _(h,k){return h.replace(T,function(P,G){var J=k[G];if(J===void 0)throw new Error("No value provided for variable "+P);return typeof J=="function"&&(J=J(k)),J})}var C=Array.isArray||function(h){return Object.prototype.toString.call(h)==="[object Array]"};function N(h,k){for(var P=0;P<h.length;P++)if(h[P]===k)return P;return-1}var A="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function O(h){return window["webkit"+h]||window["moz"+h]||window["ms"+h]}var j=0;function D(h){var k=+new Date,P=Math.max(0,16-(k-j));return j=k+P,window.setTimeout(h,P)}var F=window.requestAnimationFrame||O("RequestAnimationFrame")||D,B=window.cancelAnimationFrame||O("CancelAnimationFrame")||O("CancelRequestAnimationFrame")||function(h){window.clearTimeout(h)};function $(h,k,P){if(P&&F===D)h.call(k);else return F.call(window,s(h,k))}function Z(h){h&&B.call(window,h)}var I={__proto__:null,extend:i,create:a,bind:s,get lastId(){return o},stamp:l,throttle:u,wrapNum:c,falseFn:f,formatNum:p,trim:v,splitWords:y,setOptions:S,getParamString:w,template:_,isArray:C,indexOf:N,emptyImageUrl:A,requestFn:F,cancelFn:B,requestAnimFrame:$,cancelAnimFrame:Z};function q(){}q.extend=function(h){var k=function(){S(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},P=k.__super__=this.prototype,G=a(P);G.constructor=k,k.prototype=G;for(var J in this)Object.prototype.hasOwnProperty.call(this,J)&&J!=="prototype"&&J!=="__super__"&&(k[J]=this[J]);return h.statics&&i(k,h.statics),h.includes&&(U(h.includes),i.apply(null,[G].concat(h.includes))),i(G,h),delete G.statics,delete G.includes,G.options&&(G.options=P.options?a(P.options):{},i(G.options,h.options)),G._initHooks=[],G.callInitHooks=function(){if(!this._initHooksCalled){P.callInitHooks&&P.callInitHooks.call(this),this._initHooksCalled=!0;for(var ue=0,Se=G._initHooks.length;ue<Se;ue++)G._initHooks[ue].call(this)}},k},q.include=function(h){var k=this.prototype.options;return i(this.prototype,h),h.options&&(this.prototype.options=k,this.mergeOptions(h.options)),this},q.mergeOptions=function(h){return i(this.prototype.options,h),this},q.addInitHook=function(h){var k=Array.prototype.slice.call(arguments,1),P=typeof h=="function"?h:function(){this[h].apply(this,k)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(P),this};function U(h){if(!(typeof L>"u"||!L||!L.Mixin)){h=C(h)?h:[h];for(var k=0;k<h.length;k++)h[k]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",new Error().stack)}}var W={on:function(h,k,P){if(typeof h=="object")for(var G in h)this._on(G,h[G],k);else{h=y(h);for(var J=0,ue=h.length;J<ue;J++)this._on(h[J],k,P)}return this},off:function(h,k,P){if(!arguments.length)delete this._events;else if(typeof h=="object")for(var G in h)this._off(G,h[G],k);else{h=y(h);for(var J=arguments.length===1,ue=0,Se=h.length;ue<Se;ue++)J?this._off(h[ue]):this._off(h[ue],k,P)}return this},_on:function(h,k,P,G){if(typeof k!="function"){console.warn("wrong listener type: "+typeof k);return}if(this._listens(h,k,P)===!1){P===this&&(P=void 0);var J={fn:k,ctx:P};G&&(J.once=!0),this._events=this._events||{},this._events[h]=this._events[h]||[],this._events[h].push(J)}},_off:function(h,k,P){var G,J,ue;if(this._events&&(G=this._events[h],!!G)){if(arguments.length===1){if(this._firingCount)for(J=0,ue=G.length;J<ue;J++)G[J].fn=f;delete this._events[h];return}if(typeof k!="function"){console.warn("wrong listener type: "+typeof k);return}var Se=this._listens(h,k,P);if(Se!==!1){var Me=G[Se];this._firingCount&&(Me.fn=f,this._events[h]=G=G.slice()),G.splice(Se,1)}}},fire:function(h,k,P){if(!this.listens(h,P))return this;var G=i({},k,{type:h,target:this,sourceTarget:k&&k.sourceTarget||this});if(this._events){var J=this._events[h];if(J){this._firingCount=this._firingCount+1||1;for(var ue=0,Se=J.length;ue<Se;ue++){var Me=J[ue],De=Me.fn;Me.once&&this.off(h,De,Me.ctx),De.call(Me.ctx||this,G)}this._firingCount--}}return P&&this._propagateEvent(G),this},listens:function(h,k,P,G){typeof h!="string"&&console.warn('"string" type argument expected');var J=k;typeof k!="function"&&(G=!!k,J=void 0,P=void 0);var ue=this._events&&this._events[h];if(ue&&ue.length&&this._listens(h,J,P)!==!1)return!0;if(G){for(var Se in this._eventParents)if(this._eventParents[Se].listens(h,k,P,G))return!0}return!1},_listens:function(h,k,P){if(!this._events)return!1;var G=this._events[h]||[];if(!k)return!!G.length;P===this&&(P=void 0);for(var J=0,ue=G.length;J<ue;J++)if(G[J].fn===k&&G[J].ctx===P)return J;return!1},once:function(h,k,P){if(typeof h=="object")for(var G in h)this._on(G,h[G],k,!0);else{h=y(h);for(var J=0,ue=h.length;J<ue;J++)this._on(h[J],k,P,!0)}return this},addEventParent:function(h){return this._eventParents=this._eventParents||{},this._eventParents[l(h)]=h,this},removeEventParent:function(h){return this._eventParents&&delete this._eventParents[l(h)],this},_propagateEvent:function(h){for(var k in this._eventParents)this._eventParents[k].fire(h.type,i({layer:h.target,propagatedFrom:h.target},h),!0)}};W.addEventListener=W.on,W.removeEventListener=W.clearAllEventListeners=W.off,W.addOneTimeEventListener=W.once,W.fireEvent=W.fire,W.hasEventListeners=W.listens;var Y=q.extend(W);function Q(h,k,P){this.x=P?Math.round(h):h,this.y=P?Math.round(k):k}var ne=Math.trunc||function(h){return h>0?Math.floor(h):Math.ceil(h)};Q.prototype={clone:function(){return new Q(this.x,this.y)},add:function(h){return this.clone()._add(re(h))},_add:function(h){return this.x+=h.x,this.y+=h.y,this},subtract:function(h){return this.clone()._subtract(re(h))},_subtract:function(h){return this.x-=h.x,this.y-=h.y,this},divideBy:function(h){return this.clone()._divideBy(h)},_divideBy:function(h){return this.x/=h,this.y/=h,this},multiplyBy:function(h){return this.clone()._multiplyBy(h)},_multiplyBy:function(h){return this.x*=h,this.y*=h,this},scaleBy:function(h){return new Q(this.x*h.x,this.y*h.y)},unscaleBy:function(h){return new Q(this.x/h.x,this.y/h.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=ne(this.x),this.y=ne(this.y),this},distanceTo:function(h){h=re(h);var k=h.x-this.x,P=h.y-this.y;return Math.sqrt(k*k+P*P)},equals:function(h){return h=re(h),h.x===this.x&&h.y===this.y},contains:function(h){return h=re(h),Math.abs(h.x)<=Math.abs(this.x)&&Math.abs(h.y)<=Math.abs(this.y)},toString:function(){return"Point("+p(this.x)+", "+p(this.y)+")"}};function re(h,k,P){return h instanceof Q?h:C(h)?new Q(h[0],h[1]):h==null?h:typeof h=="object"&&"x"in h&&"y"in h?new Q(h.x,h.y):new Q(h,k,P)}function H(h,k){if(h)for(var P=k?[h,k]:h,G=0,J=P.length;G<J;G++)this.extend(P[G])}H.prototype={extend:function(h){var k,P;if(!h)return this;if(h instanceof Q||typeof h[0]=="number"||"x"in h)k=P=re(h);else if(h=te(h),k=h.min,P=h.max,!k||!P)return this;return!this.min&&!this.max?(this.min=k.clone(),this.max=P.clone()):(this.min.x=Math.min(k.x,this.min.x),this.max.x=Math.max(P.x,this.max.x),this.min.y=Math.min(k.y,this.min.y),this.max.y=Math.max(P.y,this.max.y)),this},getCenter:function(h){return re((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,h)},getBottomLeft:function(){return re(this.min.x,this.max.y)},getTopRight:function(){return re(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(h){var k,P;return typeof h[0]=="number"||h instanceof Q?h=re(h):h=te(h),h instanceof H?(k=h.min,P=h.max):k=P=h,k.x>=this.min.x&&P.x<=this.max.x&&k.y>=this.min.y&&P.y<=this.max.y},intersects:function(h){h=te(h);var k=this.min,P=this.max,G=h.min,J=h.max,ue=J.x>=k.x&&G.x<=P.x,Se=J.y>=k.y&&G.y<=P.y;return ue&&Se},overlaps:function(h){h=te(h);var k=this.min,P=this.max,G=h.min,J=h.max,ue=J.x>k.x&&G.x<P.x,Se=J.y>k.y&&G.y<P.y;return ue&&Se},isValid:function(){return!!(this.min&&this.max)},pad:function(h){var k=this.min,P=this.max,G=Math.abs(k.x-P.x)*h,J=Math.abs(k.y-P.y)*h;return te(re(k.x-G,k.y-J),re(P.x+G,P.y+J))},equals:function(h){return h?(h=te(h),this.min.equals(h.getTopLeft())&&this.max.equals(h.getBottomRight())):!1}};function te(h,k){return!h||h instanceof H?h:new H(h,k)}function ie(h,k){if(h)for(var P=k?[h,k]:h,G=0,J=P.length;G<J;G++)this.extend(P[G])}ie.prototype={extend:function(h){var k=this._southWest,P=this._northEast,G,J;if(h instanceof ge)G=h,J=h;else if(h instanceof ie){if(G=h._southWest,J=h._northEast,!G||!J)return this}else return h?this.extend(ye(h)||de(h)):this;return!k&&!P?(this._southWest=new ge(G.lat,G.lng),this._northEast=new ge(J.lat,J.lng)):(k.lat=Math.min(G.lat,k.lat),k.lng=Math.min(G.lng,k.lng),P.lat=Math.max(J.lat,P.lat),P.lng=Math.max(J.lng,P.lng)),this},pad:function(h){var k=this._southWest,P=this._northEast,G=Math.abs(k.lat-P.lat)*h,J=Math.abs(k.lng-P.lng)*h;return new ie(new ge(k.lat-G,k.lng-J),new ge(P.lat+G,P.lng+J))},getCenter:function(){return new ge((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new ge(this.getNorth(),this.getWest())},getSouthEast:function(){return new ge(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(h){typeof h[0]=="number"||h instanceof ge||"lat"in h?h=ye(h):h=de(h);var k=this._southWest,P=this._northEast,G,J;return h instanceof ie?(G=h.getSouthWest(),J=h.getNorthEast()):G=J=h,G.lat>=k.lat&&J.lat<=P.lat&&G.lng>=k.lng&&J.lng<=P.lng},intersects:function(h){h=de(h);var k=this._southWest,P=this._northEast,G=h.getSouthWest(),J=h.getNorthEast(),ue=J.lat>=k.lat&&G.lat<=P.lat,Se=J.lng>=k.lng&&G.lng<=P.lng;return ue&&Se},overlaps:function(h){h=de(h);var k=this._southWest,P=this._northEast,G=h.getSouthWest(),J=h.getNorthEast(),ue=J.lat>k.lat&&G.lat<P.lat,Se=J.lng>k.lng&&G.lng<P.lng;return ue&&Se},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(h,k){return h?(h=de(h),this._southWest.equals(h.getSouthWest(),k)&&this._northEast.equals(h.getNorthEast(),k)):!1},isValid:function(){return!!(this._southWest&&this._northEast)}};function de(h,k){return h instanceof ie?h:new ie(h,k)}function ge(h,k,P){if(isNaN(h)||isNaN(k))throw new Error("Invalid LatLng object: ("+h+", "+k+")");this.lat=+h,this.lng=+k,P!==void 0&&(this.alt=+P)}ge.prototype={equals:function(h,k){if(!h)return!1;h=ye(h);var P=Math.max(Math.abs(this.lat-h.lat),Math.abs(this.lng-h.lng));return P<=(k===void 0?1e-9:k)},toString:function(h){return"LatLng("+p(this.lat,h)+", "+p(this.lng,h)+")"},distanceTo:function(h){return pe.distance(this,ye(h))},wrap:function(){return pe.wrapLatLng(this)},toBounds:function(h){var k=180*h/40075017,P=k/Math.cos(Math.PI/180*this.lat);return de([this.lat-k,this.lng-P],[this.lat+k,this.lng+P])},clone:function(){return new ge(this.lat,this.lng,this.alt)}};function ye(h,k,P){return h instanceof ge?h:C(h)&&typeof h[0]!="object"?h.length===3?new ge(h[0],h[1],h[2]):h.length===2?new ge(h[0],h[1]):null:h==null?h:typeof h=="object"&&"lat"in h?new ge(h.lat,"lng"in h?h.lng:h.lon,h.alt):k===void 0?null:new ge(h,k,P)}var ae={latLngToPoint:function(h,k){var P=this.projection.project(h),G=this.scale(k);return this.transformation._transform(P,G)},pointToLatLng:function(h,k){var P=this.scale(k),G=this.transformation.untransform(h,P);return this.projection.unproject(G)},project:function(h){return this.projection.project(h)},unproject:function(h){return this.projection.unproject(h)},scale:function(h){return 256*Math.pow(2,h)},zoom:function(h){return Math.log(h/256)/Math.LN2},getProjectedBounds:function(h){if(this.infinite)return null;var k=this.projection.bounds,P=this.scale(h),G=this.transformation.transform(k.min,P),J=this.transformation.transform(k.max,P);return new H(G,J)},infinite:!1,wrapLatLng:function(h){var k=this.wrapLng?c(h.lng,this.wrapLng,!0):h.lng,P=this.wrapLat?c(h.lat,this.wrapLat,!0):h.lat,G=h.alt;return new ge(P,k,G)},wrapLatLngBounds:function(h){var k=h.getCenter(),P=this.wrapLatLng(k),G=k.lat-P.lat,J=k.lng-P.lng;if(G===0&&J===0)return h;var ue=h.getSouthWest(),Se=h.getNorthEast(),Me=new ge(ue.lat-G,ue.lng-J),De=new ge(Se.lat-G,Se.lng-J);return new ie(Me,De)}},pe=i({},ae,{wrapLng:[-180,180],R:6371e3,distance:function(h,k){var P=Math.PI/180,G=h.lat*P,J=k.lat*P,ue=Math.sin((k.lat-h.lat)*P/2),Se=Math.sin((k.lng-h.lng)*P/2),Me=ue*ue+Math.cos(G)*Math.cos(J)*Se*Se,De=2*Math.atan2(Math.sqrt(Me),Math.sqrt(1-Me));return this.R*De}}),le=6378137,me={R:le,MAX_LATITUDE:85.0511287798,project:function(h){var k=Math.PI/180,P=this.MAX_LATITUDE,G=Math.max(Math.min(P,h.lat),-P),J=Math.sin(G*k);return new Q(this.R*h.lng*k,this.R*Math.log((1+J)/(1-J))/2)},unproject:function(h){var k=180/Math.PI;return new ge((2*Math.atan(Math.exp(h.y/this.R))-Math.PI/2)*k,h.x*k/this.R)},bounds:(function(){var h=le*Math.PI;return new H([-h,-h],[h,h])})()};function he(h,k,P,G){if(C(h)){this._a=h[0],this._b=h[1],this._c=h[2],this._d=h[3];return}this._a=h,this._b=k,this._c=P,this._d=G}he.prototype={transform:function(h,k){return this._transform(h.clone(),k)},_transform:function(h,k){return k=k||1,h.x=k*(this._a*h.x+this._b),h.y=k*(this._c*h.y+this._d),h},untransform:function(h,k){return k=k||1,new Q((h.x/k-this._b)/this._a,(h.y/k-this._d)/this._c)}};function xe(h,k,P,G){return new he(h,k,P,G)}var we=i({},pe,{code:"EPSG:3857",projection:me,transformation:(function(){var h=.5/(Math.PI*me.R);return xe(h,.5,-h,.5)})()}),Ge=i({},we,{code:"EPSG:900913"});function qe(h){return document.createElementNS("http://www.w3.org/2000/svg",h)}function wt(h,k){var P="",G,J,ue,Se,Me,De;for(G=0,ue=h.length;G<ue;G++){for(Me=h[G],J=0,Se=Me.length;J<Se;J++)De=Me[J],P+=(J?"L":"M")+De.x+" "+De.y;P+=k?lt.svg?"z":"x":""}return P||"M0 0"}var et=document.documentElement.style,at="ActiveXObject"in window,je=at&&!document.addEventListener,Re="msLaunchUri"in navigator&&!("documentMode"in document),nt=zt("webkit"),Ce=zt("android"),Fe=zt("android 2")||zt("android 3"),Ke=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),pt=Ce&&zt("Google")&&Ke<537&&!("AudioNode"in window),vt=!!window.opera,At=!Re&&zt("chrome"),Ut=zt("gecko")&&!nt&&!vt&&!at,nr=!At&&zt("safari"),Ct=zt("phantom"),ct="OTransition"in et,We=navigator.platform.indexOf("Win")===0,ce=at&&"transition"in et,ve="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!Fe,_e="MozPerspective"in et,Te=!window.L_DISABLE_3D&&(ce||ve||_e)&&!ct&&!Ct,Le=typeof orientation<"u"||zt("mobile"),Xe=Le&&nt,He=Le&&ve,dt=!window.PointerEvent&&window.MSPointerEvent,ft=!!(window.PointerEvent||dt),Pt="ontouchstart"in window||!!window.TouchEvent,qt=!window.L_NO_TOUCH&&(Pt||ft),$t=Le&&vt,kt=Le&&Ut,Zt=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,er=(function(){var h=!1;try{var k=Object.defineProperty({},"passive",{get:function(){h=!0}});window.addEventListener("testPassiveEventSupport",f,k),window.removeEventListener("testPassiveEventSupport",f,k)}catch{}return h})(),Ar=(function(){return!!document.createElement("canvas").getContext})(),xr=!!(document.createElementNS&&qe("svg").createSVGRect),$e=!!xr&&(function(){var h=document.createElement("div");return h.innerHTML="<svg/>",(h.firstChild&&h.firstChild.namespaceURI)==="http://www.w3.org/2000/svg"})(),yt=!xr&&(function(){try{var h=document.createElement("div");h.innerHTML='<v:shape adj="1"/>';var k=h.firstChild;return k.style.behavior="url(#default#VML)",k&&typeof k.adj=="object"}catch{return!1}})(),Et=navigator.platform.indexOf("Mac")===0,rr=navigator.platform.indexOf("Linux")===0;function zt(h){return navigator.userAgent.toLowerCase().indexOf(h)>=0}var lt={ie:at,ielt9:je,edge:Re,webkit:nt,android:Ce,android23:Fe,androidStock:pt,opera:vt,chrome:At,gecko:Ut,safari:nr,phantom:Ct,opera12:ct,win:We,ie3d:ce,webkit3d:ve,gecko3d:_e,any3d:Te,mobile:Le,mobileWebkit:Xe,mobileWebkit3d:He,msPointer:dt,pointer:ft,touch:qt,touchNative:Pt,mobileOpera:$t,mobileGecko:kt,retina:Zt,passiveEvents:er,canvas:Ar,svg:xr,vml:yt,inlineSvg:$e,mac:Et,linux:rr},Pr=lt.msPointer?"MSPointerDown":"pointerdown",zr=lt.msPointer?"MSPointerMove":"pointermove",wi=lt.msPointer?"MSPointerUp":"pointerup",Va=lt.msPointer?"MSPointerCancel":"pointercancel",mo={touchstart:Pr,touchmove:zr,touchend:wi,touchcancel:Va},Si={touchstart:cn,touchmove:Dl,touchend:Dl,touchcancel:Dl},gn={},Pn=!1;function ki(h,k,P){return k==="touchstart"&&yf(),Si[k]?(P=Si[k].bind(this,P),h.addEventListener(mo[k],P,!1),P):(console.warn("wrong event specified:",k),f)}function go(h,k,P){if(!mo[k]){console.warn("wrong event specified:",k);return}h.removeEventListener(mo[k],P,!1)}function Oi(h){gn[h.pointerId]=h}function Au(h){gn[h.pointerId]&&(gn[h.pointerId]=h)}function Lu(h){delete gn[h.pointerId]}function yf(){Pn||(document.addEventListener(Pr,Oi,!0),document.addEventListener(zr,Au,!0),document.addEventListener(wi,Lu,!0),document.addEventListener(Va,Lu,!0),Pn=!0)}function Dl(h,k){if(k.pointerType!==(k.MSPOINTER_TYPE_MOUSE||"mouse")){k.touches=[];for(var P in gn)k.touches.push(gn[P]);k.changedTouches=[k],h(k)}}function cn(h,k){k.MSPOINTER_TYPE_TOUCH&&k.pointerType===k.MSPOINTER_TYPE_TOUCH&&nn(k),Dl(h,k)}function Ru(h){var k={},P,G;for(G in h)P=h[G],k[G]=P&&P.bind?P.bind(h):P;return h=k,k.type="dblclick",k.detail=2,k.isTrusted=!1,k._simulated=!0,k}var Ys=200;function Il(h,k){h.addEventListener("dblclick",k);var P=0,G;function J(ue){if(ue.detail!==1){G=ue.detail;return}if(!(ue.pointerType==="mouse"||ue.sourceCapabilities&&!ue.sourceCapabilities.firesTouchEvents)){var Se=Qo(ue);if(!(Se.some(function(De){return De instanceof HTMLLabelElement&&De.attributes.for})&&!Se.some(function(De){return De instanceof HTMLInputElement||De instanceof HTMLSelectElement}))){var Me=Date.now();Me-P<=Ys?(G++,G===2&&k(Ru(ue))):G=1,P=Me}}}return h.addEventListener("click",J),{dblclick:k,simDblclick:J}}function Ha(h,k){h.removeEventListener("dblclick",k.dblclick),h.removeEventListener("click",k.simDblclick)}var Zo=_i(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),ma=_i(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),ga=ma==="webkitTransition"||ma==="OTransition"?ma+"End":"transitionend";function _n(h){return typeof h=="string"?document.getElementById(h):h}function Mr(h,k){var P=h.style[k]||h.currentStyle&&h.currentStyle[k];if((!P||P==="auto")&&document.defaultView){var G=document.defaultView.getComputedStyle(h,null);P=G?G[k]:null}return P==="auto"?null:P}function ht(h,k,P){var G=document.createElement(h);return G.className=k||"",P&&P.appendChild(G),G}function kr(h){var k=h.parentNode;k&&k.removeChild(h)}function vn(h){for(;h.firstChild;)h.removeChild(h.firstChild)}function Qr(h){var k=h.parentNode;k&&k.lastChild!==h&&k.appendChild(h)}function Ur(h){var k=h.parentNode;k&&k.firstChild!==h&&k.insertBefore(h,k.firstChild)}function va(h,k){if(h.classList!==void 0)return h.classList.contains(k);var P=Ou(h);return P.length>0&&new RegExp("(^|\\s)"+k+"(\\s|$)").test(P)}function Ft(h,k){if(h.classList!==void 0)for(var P=y(k),G=0,J=P.length;G<J;G++)h.classList.add(P[G]);else if(!va(h,k)){var ue=Ou(h);Ec(h,(ue?ue+" ":"")+k)}}function Lr(h,k){h.classList!==void 0?h.classList.remove(k):Ec(h,v((" "+Ou(h)+" ").replace(" "+k+" "," ")))}function Ec(h,k){h.className.baseVal===void 0?h.className=k:h.className.baseVal=k}function Ou(h){return h.correspondingElement&&(h=h.correspondingElement),h.className.baseVal===void 0?h.className:h.className.baseVal}function li(h,k){"opacity"in h.style?h.style.opacity=k:"filter"in h.style&&xf(h,k)}function xf(h,k){var P=!1,G="DXImageTransform.Microsoft.Alpha";try{P=h.filters.item(G)}catch{if(k===1)return}k=Math.round(k*100),P?(P.Enabled=k!==100,P.Opacity=k):h.style.filter+=" progid:"+G+"(opacity="+k+")"}function _i(h){for(var k=document.documentElement.style,P=0;P<h.length;P++)if(h[P]in k)return h[P];return!1}function cs(h,k,P){var G=k||new Q(0,0);h.style[Zo]=(lt.ie3d?"translate("+G.x+"px,"+G.y+"px)":"translate3d("+G.x+"px,"+G.y+"px,0)")+(P?" scale("+P+")":"")}function Mn(h,k){h._leaflet_pos=k,lt.any3d?cs(h,k):(h.style.left=k.x+"px",h.style.top=k.y+"px")}function Xs(h){return h._leaflet_pos||new Q(0,0)}var mr,Qs,vo;if("onselectstart"in document)mr=function(){tr(window,"selectstart",nn)},Qs=function(){Gr(window,"selectstart",nn)};else{var Ns=_i(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);mr=function(){if(Ns){var h=document.documentElement.style;vo=h[Ns],h[Ns]="none"}},Qs=function(){Ns&&(document.documentElement.style[Ns]=vo,vo=void 0)}}function Tc(){tr(window,"dragstart",nn)}function Nc(){Gr(window,"dragstart",nn)}var Yo,jl;function yo(h){for(;h.tabIndex===-1;)h=h.parentNode;h.style&&(Di(),Yo=h,jl=h.style.outlineStyle,h.style.outlineStyle="none",tr(window,"keydown",Di))}function Di(){Yo&&(Yo.style.outlineStyle=jl,Yo=void 0,jl=void 0,Gr(window,"keydown",Di))}function Js(h){do h=h.parentNode;while((!h.offsetWidth||!h.offsetHeight)&&h!==document.body);return h}function Wa(h){var k=h.getBoundingClientRect();return{x:k.width/h.offsetWidth||1,y:k.height/h.offsetHeight||1,boundingClientRect:k}}var gr={__proto__:null,TRANSFORM:Zo,TRANSITION:ma,TRANSITION_END:ga,get:_n,getStyle:Mr,create:ht,remove:kr,empty:vn,toFront:Qr,toBack:Ur,hasClass:va,addClass:Ft,removeClass:Lr,setClass:Ec,getClass:Ou,setOpacity:li,testProp:_i,setTransform:cs,setPosition:Mn,getPosition:Xs,get disableTextSelection(){return mr},get enableTextSelection(){return Qs},disableImageDrag:Tc,enableImageDrag:Nc,preventOutline:yo,restoreOutline:Di,getSizedParentNode:Js,getScale:Wa};function tr(h,k,P,G){if(k&&typeof k=="object")for(var J in k)An(h,J,k[J],P);else{k=y(k);for(var ue=0,Se=k.length;ue<Se;ue++)An(h,k[ue],P,G)}return this}var Wn="_leaflet_events";function Gr(h,k,P,G){if(arguments.length===1)bf(h),delete h[Wn];else if(k&&typeof k=="object")for(var J in k)Fl(h,J,k[J],P);else if(k=y(k),arguments.length===2)bf(h,function(Me){return N(k,Me)!==-1});else for(var ue=0,Se=k.length;ue<Se;ue++)Fl(h,k[ue],P,G);return this}function bf(h,k){for(var P in h[Wn]){var G=P.split(/\d/)[0];(!k||k(G))&&Fl(h,G,null,null,P)}}var Xo={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function An(h,k,P,G){var J=k+l(P)+(G?"_"+l(G):"");if(h[Wn]&&h[Wn][J])return this;var ue=function(Me){return P.call(G||h,Me||window.event)},Se=ue;!lt.touchNative&&lt.pointer&&k.indexOf("touch")===0?ue=ki(h,k,ue):lt.touch&&k==="dblclick"?ue=Il(h,ue):"addEventListener"in h?k==="touchstart"||k==="touchmove"||k==="wheel"||k==="mousewheel"?h.addEventListener(Xo[k]||k,ue,lt.passiveEvents?{passive:!1}:!1):k==="mouseenter"||k==="mouseleave"?(ue=function(Me){Me=Me||window.event,xo(h,Me)&&Se(Me)},h.addEventListener(Xo[k],ue,!1)):h.addEventListener(k,Se,!1):h.attachEvent("on"+k,ue),h[Wn]=h[Wn]||{},h[Wn][J]=ue}function Fl(h,k,P,G,J){J=J||k+l(P)+(G?"_"+l(G):"");var ue=h[Wn]&&h[Wn][J];if(!ue)return this;!lt.touchNative&&lt.pointer&&k.indexOf("touch")===0?go(h,k,ue):lt.touch&&k==="dblclick"?Ha(h,ue):"removeEventListener"in h?h.removeEventListener(Xo[k]||k,ue,!1):h.detachEvent("on"+k,ue),h[Wn][J]=null}function Ps(h){return h.stopPropagation?h.stopPropagation():h.originalEvent?h.originalEvent._stopped=!0:h.cancelBubble=!0,this}function Bl(h){return An(h,"wheel",Ps),this}function Du(h){return tr(h,"mousedown touchstart dblclick contextmenu",Ps),h._leaflet_disable_click=!0,this}function nn(h){return h.preventDefault?h.preventDefault():h.returnValue=!1,this}function Ln(h){return nn(h),Ps(h),this}function Qo(h){if(h.composedPath)return h.composedPath();for(var k=[],P=h.target;P;)k.push(P),P=P.parentNode;return k}function Iu(h,k){if(!k)return new Q(h.clientX,h.clientY);var P=Wa(k),G=P.boundingClientRect;return new Q((h.clientX-G.left)/P.x-k.clientLeft,(h.clientY-G.top)/P.y-k.clientTop)}var ds=lt.linux&&lt.chrome?window.devicePixelRatio:lt.mac?window.devicePixelRatio*3:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function Ms(h){return lt.edge?h.wheelDeltaY/2:h.deltaY&&h.deltaMode===0?-h.deltaY/ds:h.deltaY&&h.deltaMode===1?-h.deltaY*20:h.deltaY&&h.deltaMode===2?-h.deltaY*60:h.deltaX||h.deltaZ?0:h.wheelDelta?(h.wheelDeltaY||h.wheelDelta)/2:h.detail&&Math.abs(h.detail)<32765?-h.detail*20:h.detail?h.detail/-32765*60:0}function xo(h,k){var P=k.relatedTarget;if(!P)return!0;try{for(;P&&P!==h;)P=P.parentNode}catch{return!1}return P!==h}var zl={__proto__:null,on:tr,off:Gr,stopPropagation:Ps,disableScrollPropagation:Bl,disableClickPropagation:Du,preventDefault:nn,stop:Ln,getPropagationPath:Qo,getMousePosition:Iu,getWheelDelta:Ms,isExternalTarget:xo,addListener:tr,removeListener:Gr},ju=Y.extend({run:function(h,k,P,G){this.stop(),this._el=h,this._inProgress=!0,this._duration=P||.25,this._easeOutPower=1/Math.max(G||.5,.2),this._startPos=Xs(h),this._offset=k.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=$(this._animate,this),this._step()},_step:function(h){var k=+new Date-this._startTime,P=this._duration*1e3;k<P?this._runFrame(this._easeOut(k/P),h):(this._runFrame(1),this._complete())},_runFrame:function(h,k){var P=this._startPos.add(this._offset.multiplyBy(h));k&&P._round(),Mn(this._el,P),this.fire("step")},_complete:function(){Z(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(h){return 1-Math.pow(1-h,this._easeOutPower)}}),br=Y.extend({options:{crs:we,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(h,k){k=S(this,k),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(h),this._initLayout(),this._onResize=s(this._onResize,this),this._initEvents(),k.maxBounds&&this.setMaxBounds(k.maxBounds),k.zoom!==void 0&&(this._zoom=this._limitZoom(k.zoom)),k.center&&k.zoom!==void 0&&this.setView(ye(k.center),k.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=ma&&lt.any3d&&!lt.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),tr(this._proxy,ga,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(h,k,P){if(k=k===void 0?this._zoom:this._limitZoom(k),h=this._limitCenter(ye(h),k,this.options.maxBounds),P=P||{},this._stop(),this._loaded&&!P.reset&&P!==!0){P.animate!==void 0&&(P.zoom=i({animate:P.animate},P.zoom),P.pan=i({animate:P.animate,duration:P.duration},P.pan));var G=this._zoom!==k?this._tryAnimatedZoom&&this._tryAnimatedZoom(h,k,P.zoom):this._tryAnimatedPan(h,P.pan);if(G)return clearTimeout(this._sizeTimer),this}return this._resetView(h,k,P.pan&&P.pan.noMoveStart),this},setZoom:function(h,k){return this._loaded?this.setView(this.getCenter(),h,{zoom:k}):(this._zoom=h,this)},zoomIn:function(h,k){return h=h||(lt.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+h,k)},zoomOut:function(h,k){return h=h||(lt.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-h,k)},setZoomAround:function(h,k,P){var G=this.getZoomScale(k),J=this.getSize().divideBy(2),ue=h instanceof Q?h:this.latLngToContainerPoint(h),Se=ue.subtract(J).multiplyBy(1-1/G),Me=this.containerPointToLatLng(J.add(Se));return this.setView(Me,k,{zoom:P})},_getBoundsCenterZoom:function(h,k){k=k||{},h=h.getBounds?h.getBounds():de(h);var P=re(k.paddingTopLeft||k.padding||[0,0]),G=re(k.paddingBottomRight||k.padding||[0,0]),J=this.getBoundsZoom(h,!1,P.add(G));if(J=typeof k.maxZoom=="number"?Math.min(k.maxZoom,J):J,J===1/0)return{center:h.getCenter(),zoom:J};var ue=G.subtract(P).divideBy(2),Se=this.project(h.getSouthWest(),J),Me=this.project(h.getNorthEast(),J),De=this.unproject(Se.add(Me).divideBy(2).add(ue),J);return{center:De,zoom:J}},fitBounds:function(h,k){if(h=de(h),!h.isValid())throw new Error("Bounds are not valid.");var P=this._getBoundsCenterZoom(h,k);return this.setView(P.center,P.zoom,k)},fitWorld:function(h){return this.fitBounds([[-90,-180],[90,180]],h)},panTo:function(h,k){return this.setView(h,this._zoom,{pan:k})},panBy:function(h,k){if(h=re(h).round(),k=k||{},!h.x&&!h.y)return this.fire("moveend");if(k.animate!==!0&&!this.getSize().contains(h))return this._resetView(this.unproject(this.project(this.getCenter()).add(h)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new ju,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),k.noMoveStart||this.fire("movestart"),k.animate!==!1){Ft(this._mapPane,"leaflet-pan-anim");var P=this._getMapPanePos().subtract(h).round();this._panAnim.run(this._mapPane,P,k.duration||.25,k.easeLinearity)}else this._rawPanBy(h),this.fire("move").fire("moveend");return this},flyTo:function(h,k,P){if(P=P||{},P.animate===!1||!lt.any3d)return this.setView(h,k,P);this._stop();var G=this.project(this.getCenter()),J=this.project(h),ue=this.getSize(),Se=this._zoom;h=ye(h),k=k===void 0?Se:k;var Me=Math.max(ue.x,ue.y),De=Me*this.getZoomScale(Se,k),Ze=J.distanceTo(G)||1,xt=1.42,Kt=xt*xt;function dr(Rr){var cl=Rr?-1:1,Gh=Rr?De:Me,Vh=De*De-Me*Me+cl*Kt*Kt*Ze*Ze,Eo=2*Gh*Kt*Ze,dl=Vh/Eo,jn=Math.sqrt(dl*dl+1)-dl,Xn=jn<1e-9?-18:Math.log(jn);return Xn}function Hr(Rr){return(Math.exp(Rr)-Math.exp(-Rr))/2}function In(Rr){return(Math.exp(Rr)+Math.exp(-Rr))/2}function Ti(Rr){return Hr(Rr)/In(Rr)}var ji=dr(0);function ll(Rr){return Me*(In(ji)/In(ji+xt*Rr))}function Vc(Rr){return Me*(In(ji)*Ti(ji+xt*Rr)-Hr(ji))/Kt}function Ds(Rr){return 1-Math.pow(1-Rr,1.5)}var ul=Date.now(),no=(dr(1)-ji)/xt,Qa=P.duration?1e3*P.duration:1e3*no*.8;function Jl(){var Rr=(Date.now()-ul)/Qa,cl=Ds(Rr)*no;Rr<=1?(this._flyToFrame=$(Jl,this),this._move(this.unproject(G.add(J.subtract(G).multiplyBy(Vc(cl)/Ze)),Se),this.getScaleZoom(Me/ll(cl),Se),{flyTo:!0})):this._move(h,k)._moveEnd(!0)}return this._moveStart(!0,P.noMoveStart),Jl.call(this),this},flyToBounds:function(h,k){var P=this._getBoundsCenterZoom(h,k);return this.flyTo(P.center,P.zoom,k)},setMaxBounds:function(h){return h=de(h),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),h.isValid()?(this.options.maxBounds=h,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(h){var k=this.options.minZoom;return this.options.minZoom=h,this._loaded&&k!==h&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(h):this},setMaxZoom:function(h){var k=this.options.maxZoom;return this.options.maxZoom=h,this._loaded&&k!==h&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(h):this},panInsideBounds:function(h,k){this._enforcingBounds=!0;var P=this.getCenter(),G=this._limitCenter(P,this._zoom,de(h));return P.equals(G)||this.panTo(G,k),this._enforcingBounds=!1,this},panInside:function(h,k){k=k||{};var P=re(k.paddingTopLeft||k.padding||[0,0]),G=re(k.paddingBottomRight||k.padding||[0,0]),J=this.project(this.getCenter()),ue=this.project(h),Se=this.getPixelBounds(),Me=te([Se.min.add(P),Se.max.subtract(G)]),De=Me.getSize();if(!Me.contains(ue)){this._enforcingBounds=!0;var Ze=ue.subtract(Me.getCenter()),xt=Me.extend(ue).getSize().subtract(De);J.x+=Ze.x<0?-xt.x:xt.x,J.y+=Ze.y<0?-xt.y:xt.y,this.panTo(this.unproject(J),k),this._enforcingBounds=!1}return this},invalidateSize:function(h){if(!this._loaded)return this;h=i({animate:!1,pan:!0},h===!0?{animate:!0}:h);var k=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var P=this.getSize(),G=k.divideBy(2).round(),J=P.divideBy(2).round(),ue=G.subtract(J);return!ue.x&&!ue.y?this:(h.animate&&h.pan?this.panBy(ue):(h.pan&&this._rawPanBy(ue),this.fire("move"),h.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(s(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:k,newSize:P}))},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(h){if(h=this._locateOptions=i({timeout:1e4,watch:!1},h),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var k=s(this._handleGeolocationResponse,this),P=s(this._handleGeolocationError,this);return h.watch?this._locationWatchId=navigator.geolocation.watchPosition(k,P,h):navigator.geolocation.getCurrentPosition(k,P,h),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(h){if(this._container._leaflet_id){var k=h.code,P=h.message||(k===1?"permission denied":k===2?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:k,message:"Geolocation error: "+P+"."})}},_handleGeolocationResponse:function(h){if(this._container._leaflet_id){var k=h.coords.latitude,P=h.coords.longitude,G=new ge(k,P),J=G.toBounds(h.coords.accuracy*2),ue=this._locateOptions;if(ue.setView){var Se=this.getBoundsZoom(J);this.setView(G,ue.maxZoom?Math.min(Se,ue.maxZoom):Se)}var Me={latlng:G,bounds:J,timestamp:h.timestamp};for(var De in h.coords)typeof h.coords[De]=="number"&&(Me[De]=h.coords[De]);this.fire("locationfound",Me)}},addHandler:function(h,k){if(!k)return this;var P=this[h]=new k(this);return this._handlers.push(P),this.options[h]&&P.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch{this._container._leaflet_id=void 0,this._containerId=void 0}this._locationWatchId!==void 0&&this.stopLocate(),this._stop(),kr(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(Z(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload");var h;for(h in this._layers)this._layers[h].remove();for(h in this._panes)kr(this._panes[h]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(h,k){var P="leaflet-pane"+(h?" leaflet-"+h.replace("Pane","")+"-pane":""),G=ht("div",P,k||this._mapPane);return h&&(this._panes[h]=G),G},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var h=this.getPixelBounds(),k=this.unproject(h.getBottomLeft()),P=this.unproject(h.getTopRight());return new ie(k,P)},getMinZoom:function(){return this.options.minZoom===void 0?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===void 0?this._layersMaxZoom===void 0?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(h,k,P){h=de(h),P=re(P||[0,0]);var G=this.getZoom()||0,J=this.getMinZoom(),ue=this.getMaxZoom(),Se=h.getNorthWest(),Me=h.getSouthEast(),De=this.getSize().subtract(P),Ze=te(this.project(Me,G),this.project(Se,G)).getSize(),xt=lt.any3d?this.options.zoomSnap:1,Kt=De.x/Ze.x,dr=De.y/Ze.y,Hr=k?Math.max(Kt,dr):Math.min(Kt,dr);return G=this.getScaleZoom(Hr,G),xt&&(G=Math.round(G/(xt/100))*(xt/100),G=k?Math.ceil(G/xt)*xt:Math.floor(G/xt)*xt),Math.max(J,Math.min(ue,G))},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new Q(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(h,k){var P=this._getTopLeftPoint(h,k);return new H(P,P.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(h){return this.options.crs.getProjectedBounds(h===void 0?this.getZoom():h)},getPane:function(h){return typeof h=="string"?this._panes[h]:h},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(h,k){var P=this.options.crs;return k=k===void 0?this._zoom:k,P.scale(h)/P.scale(k)},getScaleZoom:function(h,k){var P=this.options.crs;k=k===void 0?this._zoom:k;var G=P.zoom(h*P.scale(k));return isNaN(G)?1/0:G},project:function(h,k){return k=k===void 0?this._zoom:k,this.options.crs.latLngToPoint(ye(h),k)},unproject:function(h,k){return k=k===void 0?this._zoom:k,this.options.crs.pointToLatLng(re(h),k)},layerPointToLatLng:function(h){var k=re(h).add(this.getPixelOrigin());return this.unproject(k)},latLngToLayerPoint:function(h){var k=this.project(ye(h))._round();return k._subtract(this.getPixelOrigin())},wrapLatLng:function(h){return this.options.crs.wrapLatLng(ye(h))},wrapLatLngBounds:function(h){return this.options.crs.wrapLatLngBounds(de(h))},distance:function(h,k){return this.options.crs.distance(ye(h),ye(k))},containerPointToLayerPoint:function(h){return re(h).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(h){return re(h).add(this._getMapPanePos())},containerPointToLatLng:function(h){var k=this.containerPointToLayerPoint(re(h));return this.layerPointToLatLng(k)},latLngToContainerPoint:function(h){return this.layerPointToContainerPoint(this.latLngToLayerPoint(ye(h)))},mouseEventToContainerPoint:function(h){return Iu(h,this._container)},mouseEventToLayerPoint:function(h){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(h))},mouseEventToLatLng:function(h){return this.layerPointToLatLng(this.mouseEventToLayerPoint(h))},_initContainer:function(h){var k=this._container=_n(h);if(k){if(k._leaflet_id)throw new Error("Map container is already initialized.")}else throw new Error("Map container not found.");tr(k,"scroll",this._onScroll,this),this._containerId=l(k)},_initLayout:function(){var h=this._container;this._fadeAnimated=this.options.fadeAnimation&&lt.any3d,Ft(h,"leaflet-container"+(lt.touch?" leaflet-touch":"")+(lt.retina?" leaflet-retina":"")+(lt.ielt9?" leaflet-oldie":"")+(lt.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var k=Mr(h,"position");k!=="absolute"&&k!=="relative"&&k!=="fixed"&&k!=="sticky"&&(h.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var h=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),Mn(this._mapPane,new Q(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(Ft(h.markerPane,"leaflet-zoom-hide"),Ft(h.shadowPane,"leaflet-zoom-hide"))},_resetView:function(h,k,P){Mn(this._mapPane,new Q(0,0));var G=!this._loaded;this._loaded=!0,k=this._limitZoom(k),this.fire("viewprereset");var J=this._zoom!==k;this._moveStart(J,P)._move(h,k)._moveEnd(J),this.fire("viewreset"),G&&this.fire("load")},_moveStart:function(h,k){return h&&this.fire("zoomstart"),k||this.fire("movestart"),this},_move:function(h,k,P,G){k===void 0&&(k=this._zoom);var J=this._zoom!==k;return this._zoom=k,this._lastCenter=h,this._pixelOrigin=this._getNewPixelOrigin(h),G?P&&P.pinch&&this.fire("zoom",P):((J||P&&P.pinch)&&this.fire("zoom",P),this.fire("move",P)),this},_moveEnd:function(h){return h&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return Z(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(h){Mn(this._mapPane,this._getMapPanePos().subtract(h))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(h){this._targets={},this._targets[l(this._container)]=this;var k=h?Gr:tr;k(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&k(window,"resize",this._onResize,this),lt.any3d&&this.options.transform3DLimit&&(h?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){Z(this._resizeRequest),this._resizeRequest=$(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var h=this._getMapPanePos();Math.max(Math.abs(h.x),Math.abs(h.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(h,k){for(var P=[],G,J=k==="mouseout"||k==="mouseover",ue=h.target||h.srcElement,Se=!1;ue;){if(G=this._targets[l(ue)],G&&(k==="click"||k==="preclick")&&this._draggableMoved(G)){Se=!0;break}if(G&&G.listens(k,!0)&&(J&&!xo(ue,h)||(P.push(G),J))||ue===this._container)break;ue=ue.parentNode}return!P.length&&!Se&&!J&&this.listens(k,!0)&&(P=[this]),P},_isClickDisabled:function(h){for(;h&&h!==this._container;){if(h._leaflet_disable_click)return!0;h=h.parentNode}},_handleDOMEvent:function(h){var k=h.target||h.srcElement;if(!(!this._loaded||k._leaflet_disable_events||h.type==="click"&&this._isClickDisabled(k))){var P=h.type;P==="mousedown"&&yo(k),this._fireDOMEvent(h,P)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(h,k,P){if(h.type==="click"){var G=i({},h);G.type="preclick",this._fireDOMEvent(G,G.type,P)}var J=this._findEventTargets(h,k);if(P){for(var ue=[],Se=0;Se<P.length;Se++)P[Se].listens(k,!0)&&ue.push(P[Se]);J=ue.concat(J)}if(J.length){k==="contextmenu"&&nn(h);var Me=J[0],De={originalEvent:h};if(h.type!=="keypress"&&h.type!=="keydown"&&h.type!=="keyup"){var Ze=Me.getLatLng&&(!Me._radius||Me._radius<=10);De.containerPoint=Ze?this.latLngToContainerPoint(Me.getLatLng()):this.mouseEventToContainerPoint(h),De.layerPoint=this.containerPointToLayerPoint(De.containerPoint),De.latlng=Ze?Me.getLatLng():this.layerPointToLatLng(De.layerPoint)}for(Se=0;Se<J.length;Se++)if(J[Se].fire(k,De,!0),De.originalEvent._stopped||J[Se].options.bubblingMouseEvents===!1&&N(this._mouseEvents,k)!==-1)return}},_draggableMoved:function(h){return h=h.dragging&&h.dragging.enabled()?h:this,h.dragging&&h.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var h=0,k=this._handlers.length;h<k;h++)this._handlers[h].disable()},whenReady:function(h,k){return this._loaded?h.call(k||this,{target:this}):this.on("load",h,k),this},_getMapPanePos:function(){return Xs(this._mapPane)||new Q(0,0)},_moved:function(){var h=this._getMapPanePos();return h&&!h.equals([0,0])},_getTopLeftPoint:function(h,k){var P=h&&k!==void 0?this._getNewPixelOrigin(h,k):this.getPixelOrigin();return P.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(h,k){var P=this.getSize()._divideBy(2);return this.project(h,k)._subtract(P)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(h,k,P){var G=this._getNewPixelOrigin(P,k);return this.project(h,k)._subtract(G)},_latLngBoundsToNewLayerBounds:function(h,k,P){var G=this._getNewPixelOrigin(P,k);return te([this.project(h.getSouthWest(),k)._subtract(G),this.project(h.getNorthWest(),k)._subtract(G),this.project(h.getSouthEast(),k)._subtract(G),this.project(h.getNorthEast(),k)._subtract(G)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(h){return this.latLngToLayerPoint(h).subtract(this._getCenterLayerPoint())},_limitCenter:function(h,k,P){if(!P)return h;var G=this.project(h,k),J=this.getSize().divideBy(2),ue=new H(G.subtract(J),G.add(J)),Se=this._getBoundsOffset(ue,P,k);return Math.abs(Se.x)<=1&&Math.abs(Se.y)<=1?h:this.unproject(G.add(Se),k)},_limitOffset:function(h,k){if(!k)return h;var P=this.getPixelBounds(),G=new H(P.min.add(h),P.max.add(h));return h.add(this._getBoundsOffset(G,k))},_getBoundsOffset:function(h,k,P){var G=te(this.project(k.getNorthEast(),P),this.project(k.getSouthWest(),P)),J=G.min.subtract(h.min),ue=G.max.subtract(h.max),Se=this._rebound(J.x,-ue.x),Me=this._rebound(J.y,-ue.y);return new Q(Se,Me)},_rebound:function(h,k){return h+k>0?Math.round(h-k)/2:Math.max(0,Math.ceil(h))-Math.max(0,Math.floor(k))},_limitZoom:function(h){var k=this.getMinZoom(),P=this.getMaxZoom(),G=lt.any3d?this.options.zoomSnap:1;return G&&(h=Math.round(h/G)*G),Math.max(k,Math.min(P,h))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){Lr(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(h,k){var P=this._getCenterOffset(h)._trunc();return(k&&k.animate)!==!0&&!this.getSize().contains(P)?!1:(this.panBy(P,k),!0)},_createAnimProxy:function(){var h=this._proxy=ht("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(h),this.on("zoomanim",function(k){var P=Zo,G=this._proxy.style[P];cs(this._proxy,this.project(k.center,k.zoom),this.getZoomScale(k.zoom,1)),G===this._proxy.style[P]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){kr(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var h=this.getCenter(),k=this.getZoom();cs(this._proxy,this.project(h,k),this.getZoomScale(k,1))},_catchTransitionEnd:function(h){this._animatingZoom&&h.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(h,k,P){if(this._animatingZoom)return!0;if(P=P||{},!this._zoomAnimated||P.animate===!1||this._nothingToAnimate()||Math.abs(k-this._zoom)>this.options.zoomAnimationThreshold)return!1;var G=this.getZoomScale(k),J=this._getCenterOffset(h)._divideBy(1-1/G);return P.animate!==!0&&!this.getSize().contains(J)?!1:($(function(){this._moveStart(!0,P.noMoveStart||!1)._animateZoom(h,k,!0)},this),!0)},_animateZoom:function(h,k,P,G){this._mapPane&&(P&&(this._animatingZoom=!0,this._animateToCenter=h,this._animateToZoom=k,Ft(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:h,zoom:k,noUpdate:G}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(s(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&Lr(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function ui(h,k){return new br(h,k)}var Zn=q.extend({options:{position:"topright"},initialize:function(h){S(this,h)},getPosition:function(){return this.options.position},setPosition:function(h){var k=this._map;return k&&k.removeControl(this),this.options.position=h,k&&k.addControl(this),this},getContainer:function(){return this._container},addTo:function(h){this.remove(),this._map=h;var k=this._container=this.onAdd(h),P=this.getPosition(),G=h._controlCorners[P];return Ft(k,"leaflet-control"),P.indexOf("bottom")!==-1?G.insertBefore(k,G.firstChild):G.appendChild(k),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(kr(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(h){this._map&&h&&h.screenX>0&&h.screenY>0&&this._map.getContainer().focus()}}),ya=function(h){return new Zn(h)};br.include({addControl:function(h){return h.addTo(this),this},removeControl:function(h){return h.remove(),this},_initControlPos:function(){var h=this._controlCorners={},k="leaflet-",P=this._controlContainer=ht("div",k+"control-container",this._container);function G(J,ue){var Se=k+J+" "+k+ue;h[J+ue]=ht("div",Se,P)}G("top","left"),G("top","right"),G("bottom","left"),G("bottom","right")},_clearControlPos:function(){for(var h in this._controlCorners)kr(this._controlCorners[h]);kr(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var Ul=Zn.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(h,k,P,G){return P<G?-1:G<P?1:0}},initialize:function(h,k,P){S(this,P),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1;for(var G in h)this._addLayer(h[G],G);for(G in k)this._addLayer(k[G],G,!0)},onAdd:function(h){this._initLayout(),this._update(),this._map=h,h.on("zoomend",this._checkDisabledLayers,this);for(var k=0;k<this._layers.length;k++)this._layers[k].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(h){return Zn.prototype.addTo.call(this,h),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var h=0;h<this._layers.length;h++)this._layers[h].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(h,k){return this._addLayer(h,k),this._map?this._update():this},addOverlay:function(h,k){return this._addLayer(h,k,!0),this._map?this._update():this},removeLayer:function(h){h.off("add remove",this._onLayerChange,this);var k=this._getLayer(l(h));return k&&this._layers.splice(this._layers.indexOf(k),1),this._map?this._update():this},expand:function(){Ft(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var h=this._map.getSize().y-(this._container.offsetTop+50);return h<this._section.clientHeight?(Ft(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=h+"px"):Lr(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return Lr(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var h="leaflet-control-layers",k=this._container=ht("div",h),P=this.options.collapsed;k.setAttribute("aria-haspopup",!0),Du(k),Bl(k);var G=this._section=ht("section",h+"-list");P&&(this._map.on("click",this.collapse,this),tr(k,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var J=this._layersLink=ht("a",h+"-toggle",k);J.href="#",J.title="Layers",J.setAttribute("role","button"),tr(J,{keydown:function(ue){ue.keyCode===13&&this._expandSafely()},click:function(ue){nn(ue),this._expandSafely()}},this),P||this.expand(),this._baseLayersList=ht("div",h+"-base",G),this._separator=ht("div",h+"-separator",G),this._overlaysList=ht("div",h+"-overlays",G),k.appendChild(G)},_getLayer:function(h){for(var k=0;k<this._layers.length;k++)if(this._layers[k]&&l(this._layers[k].layer)===h)return this._layers[k]},_addLayer:function(h,k,P){this._map&&h.on("add remove",this._onLayerChange,this),this._layers.push({layer:h,name:k,overlay:P}),this.options.sortLayers&&this._layers.sort(s(function(G,J){return this.options.sortFunction(G.layer,J.layer,G.name,J.name)},this)),this.options.autoZIndex&&h.setZIndex&&(this._lastZIndex++,h.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;vn(this._baseLayersList),vn(this._overlaysList),this._layerControlInputs=[];var h,k,P,G,J=0;for(P=0;P<this._layers.length;P++)G=this._layers[P],this._addItem(G),k=k||G.overlay,h=h||!G.overlay,J+=G.overlay?0:1;return this.options.hideSingleBase&&(h=h&&J>1,this._baseLayersList.style.display=h?"":"none"),this._separator.style.display=k&&h?"":"none",this},_onLayerChange:function(h){this._handlingClick||this._update();var k=this._getLayer(l(h.target)),P=k.overlay?h.type==="add"?"overlayadd":"overlayremove":h.type==="add"?"baselayerchange":null;P&&this._map.fire(P,k)},_createRadioElement:function(h,k){var P='<input type="radio" class="leaflet-control-layers-selector" name="'+h+'"'+(k?' checked="checked"':"")+"/>",G=document.createElement("div");return G.innerHTML=P,G.firstChild},_addItem:function(h){var k=document.createElement("label"),P=this._map.hasLayer(h.layer),G;h.overlay?(G=document.createElement("input"),G.type="checkbox",G.className="leaflet-control-layers-selector",G.defaultChecked=P):G=this._createRadioElement("leaflet-base-layers_"+l(this),P),this._layerControlInputs.push(G),G.layerId=l(h.layer),tr(G,"click",this._onInputClick,this);var J=document.createElement("span");J.innerHTML=" "+h.name;var ue=document.createElement("span");k.appendChild(ue),ue.appendChild(G),ue.appendChild(J);var Se=h.overlay?this._overlaysList:this._baseLayersList;return Se.appendChild(k),this._checkDisabledLayers(),k},_onInputClick:function(){if(!this._preventClick){var h=this._layerControlInputs,k,P,G=[],J=[];this._handlingClick=!0;for(var ue=h.length-1;ue>=0;ue--)k=h[ue],P=this._getLayer(k.layerId).layer,k.checked?G.push(P):k.checked||J.push(P);for(ue=0;ue<J.length;ue++)this._map.hasLayer(J[ue])&&this._map.removeLayer(J[ue]);for(ue=0;ue<G.length;ue++)this._map.hasLayer(G[ue])||this._map.addLayer(G[ue]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var h=this._layerControlInputs,k,P,G=this._map.getZoom(),J=h.length-1;J>=0;J--)k=h[J],P=this._getLayer(k.layerId).layer,k.disabled=P.options.minZoom!==void 0&&G<P.options.minZoom||P.options.maxZoom!==void 0&&G>P.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var h=this._section;this._preventClick=!0,tr(h,"click",nn),this.expand();var k=this;setTimeout(function(){Gr(h,"click",nn),k._preventClick=!1})}}),Jo=function(h,k,P){return new Ul(h,k,P)},ci=Zn.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(h){var k="leaflet-control-zoom",P=ht("div",k+" leaflet-bar"),G=this.options;return this._zoomInButton=this._createButton(G.zoomInText,G.zoomInTitle,k+"-in",P,this._zoomIn),this._zoomOutButton=this._createButton(G.zoomOutText,G.zoomOutTitle,k+"-out",P,this._zoomOut),this._updateDisabled(),h.on("zoomend zoomlevelschange",this._updateDisabled,this),P},onRemove:function(h){h.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(h){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(h.shiftKey?3:1))},_zoomOut:function(h){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(h.shiftKey?3:1))},_createButton:function(h,k,P,G,J){var ue=ht("a",P,G);return ue.innerHTML=h,ue.href="#",ue.title=k,ue.setAttribute("role","button"),ue.setAttribute("aria-label",k),Du(ue),tr(ue,"click",Ln),tr(ue,"click",J,this),tr(ue,"click",this._refocusOnMap,this),ue},_updateDisabled:function(){var h=this._map,k="leaflet-disabled";Lr(this._zoomInButton,k),Lr(this._zoomOutButton,k),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||h._zoom===h.getMinZoom())&&(Ft(this._zoomOutButton,k),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||h._zoom===h.getMaxZoom())&&(Ft(this._zoomInButton,k),this._zoomInButton.setAttribute("aria-disabled","true"))}});br.mergeOptions({zoomControl:!0}),br.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new ci,this.addControl(this.zoomControl))});var xa=function(h){return new ci(h)},Rn=Zn.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(h){var k="leaflet-control-scale",P=ht("div",k),G=this.options;return this._addScales(G,k+"-line",P),h.on(G.updateWhenIdle?"moveend":"move",this._update,this),h.whenReady(this._update,this),P},onRemove:function(h){h.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(h,k,P){h.metric&&(this._mScale=ht("div",k,P)),h.imperial&&(this._iScale=ht("div",k,P))},_update:function(){var h=this._map,k=h.getSize().y/2,P=h.distance(h.containerPointToLatLng([0,k]),h.containerPointToLatLng([this.options.maxWidth,k]));this._updateScales(P)},_updateScales:function(h){this.options.metric&&h&&this._updateMetric(h),this.options.imperial&&h&&this._updateImperial(h)},_updateMetric:function(h){var k=this._getRoundNum(h),P=k<1e3?k+" m":k/1e3+" km";this._updateScale(this._mScale,P,k/h)},_updateImperial:function(h){var k=h*3.2808399,P,G,J;k>5280?(P=k/5280,G=this._getRoundNum(P),this._updateScale(this._iScale,G+" mi",G/P)):(J=this._getRoundNum(k),this._updateScale(this._iScale,J+" ft",J/k))},_updateScale:function(h,k,P){h.style.width=Math.round(this.options.maxWidth*P)+"px",h.innerHTML=k},_getRoundNum:function(h){var k=Math.pow(10,(Math.floor(h)+"").length-1),P=h/k;return P=P>=10?10:P>=5?5:P>=3?3:P>=2?2:1,k*P}}),qi=function(h){return new Rn(h)},fs='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',ba=Zn.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(lt.inlineSvg?fs+" ":"")+"Leaflet</a>"},initialize:function(h){S(this,h),this._attributions={}},onAdd:function(h){h.attributionControl=this,this._container=ht("div","leaflet-control-attribution"),Du(this._container);for(var k in h._layers)h._layers[k].getAttribution&&this.addAttribution(h._layers[k].getAttribution());return this._update(),h.on("layeradd",this._addAttribution,this),this._container},onRemove:function(h){h.off("layeradd",this._addAttribution,this)},_addAttribution:function(h){h.layer.getAttribution&&(this.addAttribution(h.layer.getAttribution()),h.layer.once("remove",function(){this.removeAttribution(h.layer.getAttribution())},this))},setPrefix:function(h){return this.options.prefix=h,this._update(),this},addAttribution:function(h){return h?(this._attributions[h]||(this._attributions[h]=0),this._attributions[h]++,this._update(),this):this},removeAttribution:function(h){return h?(this._attributions[h]&&(this._attributions[h]--,this._update()),this):this},_update:function(){if(this._map){var h=[];for(var k in this._attributions)this._attributions[k]&&h.push(k);var P=[];this.options.prefix&&P.push(this.options.prefix),h.length&&P.push(h.join(", ")),this._container.innerHTML=P.join(' <span aria-hidden="true">|</span> ')}}});br.mergeOptions({attributionControl:!0}),br.addInitHook(function(){this.options.attributionControl&&new ba().addTo(this)});var jh=function(h){return new ba(h)};Zn.Layers=Ul,Zn.Zoom=ci,Zn.Scale=Rn,Zn.Attribution=ba,ya.layers=Jo,ya.zoom=xa,ya.scale=qi,ya.attribution=jh;var $i=q.extend({initialize:function(h){this._map=h},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});$i.addTo=function(h,k){return h.addHandler(k,this),this};var Fu={Events:W},Yn=lt.touch?"touchstart mousedown":"mousedown",yn=Y.extend({options:{clickTolerance:3},initialize:function(h,k,P,G){S(this,G),this._element=h,this._dragStartTarget=k||h,this._preventOutline=P},enable:function(){this._enabled||(tr(this._dragStartTarget,Yn,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(yn._dragging===this&&this.finishDrag(!0),Gr(this._dragStartTarget,Yn,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(h){if(this._enabled&&(this._moved=!1,!va(this._element,"leaflet-zoom-anim"))){if(h.touches&&h.touches.length!==1){yn._dragging===this&&this.finishDrag();return}if(!(yn._dragging||h.shiftKey||h.which!==1&&h.button!==1&&!h.touches)&&(yn._dragging=this,this._preventOutline&&yo(this._element),Tc(),mr(),!this._moving)){this.fire("down");var k=h.touches?h.touches[0]:h,P=Js(this._element);this._startPoint=new Q(k.clientX,k.clientY),this._startPos=Xs(this._element),this._parentScale=Wa(P);var G=h.type==="mousedown";tr(document,G?"mousemove":"touchmove",this._onMove,this),tr(document,G?"mouseup":"touchend touchcancel",this._onUp,this)}}},_onMove:function(h){if(this._enabled){if(h.touches&&h.touches.length>1){this._moved=!0;return}var k=h.touches&&h.touches.length===1?h.touches[0]:h,P=new Q(k.clientX,k.clientY)._subtract(this._startPoint);!P.x&&!P.y||Math.abs(P.x)+Math.abs(P.y)<this.options.clickTolerance||(P.x/=this._parentScale.x,P.y/=this._parentScale.y,nn(h),this._moved||(this.fire("dragstart"),this._moved=!0,Ft(document.body,"leaflet-dragging"),this._lastTarget=h.target||h.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),Ft(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(P),this._moving=!0,this._lastEvent=h,this._updatePosition())}},_updatePosition:function(){var h={originalEvent:this._lastEvent};this.fire("predrag",h),Mn(this._element,this._newPos),this.fire("drag",h)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(h){Lr(document.body,"leaflet-dragging"),this._lastTarget&&(Lr(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),Gr(document,"mousemove touchmove",this._onMove,this),Gr(document,"mouseup touchend touchcancel",this._onUp,this),Nc(),Qs();var k=this._moved&&this._moving;this._moving=!1,yn._dragging=!1,k&&this.fire("dragend",{noInertia:h,distance:this._newPos.distanceTo(this._startPos)})}});function $r(h,k,P){var G,J=[1,4,2,8],ue,Se,Me,De,Ze,xt,Kt,dr;for(ue=0,xt=h.length;ue<xt;ue++)h[ue]._code=As(h[ue],k);for(Me=0;Me<4;Me++){for(Kt=J[Me],G=[],ue=0,xt=h.length,Se=xt-1;ue<xt;Se=ue++)De=h[ue],Ze=h[Se],De._code&Kt?Ze._code&Kt||(dr=Ac(Ze,De,Kt,k,P),dr._code=As(dr,k),G.push(dr)):(Ze._code&Kt&&(dr=Ac(Ze,De,Kt,k,P),dr._code=As(dr,k),G.push(dr)),G.push(De));h=G}return h}function Gl(h,k){var P,G,J,ue,Se,Me,De,Ze,xt;if(!h||h.length===0)throw new Error("latlngs not passed");Ii(h)||(console.warn("latlngs are not flat! Only the first ring will be used"),h=h[0]);var Kt=ye([0,0]),dr=de(h),Hr=dr.getNorthWest().distanceTo(dr.getSouthWest())*dr.getNorthEast().distanceTo(dr.getNorthWest());Hr<1700&&(Kt=wa(h));var In=h.length,Ti=[];for(P=0;P<In;P++){var ji=ye(h[P]);Ti.push(k.project(ye([ji.lat-Kt.lat,ji.lng-Kt.lng])))}for(Me=De=Ze=0,P=0,G=In-1;P<In;G=P++)J=Ti[P],ue=Ti[G],Se=J.y*ue.x-ue.y*J.x,De+=(J.x+ue.x)*Se,Ze+=(J.y+ue.y)*Se,Me+=Se*3;Me===0?xt=Ti[0]:xt=[De/Me,Ze/Me];var ll=k.unproject(re(xt));return ye([ll.lat+Kt.lat,ll.lng+Kt.lng])}function wa(h){for(var k=0,P=0,G=0,J=0;J<h.length;J++){var ue=ye(h[J]);k+=ue.lat,P+=ue.lng,G++}return ye([k/G,P/G])}var Fh={__proto__:null,clipPolygon:$r,polygonCenter:Gl,centroid:wa};function Bu(h,k){if(!k||!h.length)return h.slice();var P=k*k;return h=zh(h,P),h=Bh(h,P),h}function Pc(h,k,P){return Math.sqrt(hs(h,k,P,!0))}function wf(h,k,P){return hs(h,k,P)}function Bh(h,k){var P=h.length,G=typeof Uint8Array<"u"?Uint8Array:Array,J=new G(P);J[0]=J[P-1]=1,Vl(h,J,k,0,P-1);var ue,Se=[];for(ue=0;ue<P;ue++)J[ue]&&Se.push(h[ue]);return Se}function Vl(h,k,P,G,J){var ue=0,Se,Me,De;for(Me=G+1;Me<=J-1;Me++)De=hs(h[Me],h[G],h[J],!0),De>ue&&(Se=Me,ue=De);ue>P&&(k[Se]=1,Vl(h,k,P,G,Se),Vl(h,k,P,Se,J))}function zh(h,k){for(var P=[h[0]],G=1,J=0,ue=h.length;G<ue;G++)wm(h[G],h[J])>k&&(P.push(h[G]),J=G);return J<ue-1&&P.push(h[ue-1]),P}var bo;function Mc(h,k,P,G,J){var ue=G?bo:As(h,P),Se=As(k,P),Me,De,Ze;for(bo=Se;;){if(!(ue|Se))return[h,k];if(ue&Se)return!1;Me=ue||Se,De=Ac(h,k,Me,P,J),Ze=As(De,P),Me===ue?(h=De,ue=Ze):(k=De,Se=Ze)}}function Ac(h,k,P,G,J){var ue=k.x-h.x,Se=k.y-h.y,Me=G.min,De=G.max,Ze,xt;return P&8?(Ze=h.x+ue*(De.y-h.y)/Se,xt=De.y):P&4?(Ze=h.x+ue*(Me.y-h.y)/Se,xt=Me.y):P&2?(Ze=De.x,xt=h.y+Se*(De.x-h.x)/ue):P&1&&(Ze=Me.x,xt=h.y+Se*(Me.x-h.x)/ue),new Q(Ze,xt,J)}function As(h,k){var P=0;return h.x<k.min.x?P|=1:h.x>k.max.x&&(P|=2),h.y<k.min.y?P|=4:h.y>k.max.y&&(P|=8),P}function wm(h,k){var P=k.x-h.x,G=k.y-h.y;return P*P+G*G}function hs(h,k,P,G){var J=k.x,ue=k.y,Se=P.x-J,Me=P.y-ue,De=Se*Se+Me*Me,Ze;return De>0&&(Ze=((h.x-J)*Se+(h.y-ue)*Me)/De,Ze>1?(J=P.x,ue=P.y):Ze>0&&(J+=Se*Ze,ue+=Me*Ze)),Se=h.x-J,Me=h.y-ue,G?Se*Se+Me*Me:new Q(J,ue)}function Ii(h){return!C(h[0])||typeof h[0][0]!="object"&&typeof h[0][0]<"u"}function Sf(h){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),Ii(h)}function kf(h,k){var P,G,J,ue,Se,Me,De,Ze;if(!h||h.length===0)throw new Error("latlngs not passed");Ii(h)||(console.warn("latlngs are not flat! Only the first ring will be used"),h=h[0]);var xt=ye([0,0]),Kt=de(h),dr=Kt.getNorthWest().distanceTo(Kt.getSouthWest())*Kt.getNorthEast().distanceTo(Kt.getNorthWest());dr<1700&&(xt=wa(h));var Hr=h.length,In=[];for(P=0;P<Hr;P++){var Ti=ye(h[P]);In.push(k.project(ye([Ti.lat-xt.lat,Ti.lng-xt.lng])))}for(P=0,G=0;P<Hr-1;P++)G+=In[P].distanceTo(In[P+1])/2;if(G===0)Ze=In[0];else for(P=0,ue=0;P<Hr-1;P++)if(Se=In[P],Me=In[P+1],J=Se.distanceTo(Me),ue+=J,ue>G){De=(ue-G)/J,Ze=[Me.x-De*(Me.x-Se.x),Me.y-De*(Me.y-Se.y)];break}var ji=k.unproject(re(Ze));return ye([ji.lat+xt.lat,ji.lng+xt.lng])}var el={__proto__:null,simplify:Bu,pointToSegmentDistance:Pc,closestPointOnSegment:wf,clipSegment:Mc,_getEdgeIntersection:Ac,_getBitCode:As,_sqClosestPointOnSegment:hs,isFlat:Ii,_flat:Sf,polylineCenter:kf},Lc={project:function(h){return new Q(h.lng,h.lat)},unproject:function(h){return new ge(h.y,h.x)},bounds:new H([-180,-90],[180,90])},Hl={R:6378137,R_MINOR:6356752314245179e-9,bounds:new H([-2003750834279e-5,-1549657073972e-5],[2003750834279e-5,1876465623138e-5]),project:function(h){var k=Math.PI/180,P=this.R,G=h.lat*k,J=this.R_MINOR/P,ue=Math.sqrt(1-J*J),Se=ue*Math.sin(G),Me=Math.tan(Math.PI/4-G/2)/Math.pow((1-Se)/(1+Se),ue/2);return G=-P*Math.log(Math.max(Me,1e-10)),new Q(h.lng*k*P,G)},unproject:function(h){for(var k=180/Math.PI,P=this.R,G=this.R_MINOR/P,J=Math.sqrt(1-G*G),ue=Math.exp(-h.y/P),Se=Math.PI/2-2*Math.atan(ue),Me=0,De=.1,Ze;Me<15&&Math.abs(De)>1e-7;Me++)Ze=J*Math.sin(Se),Ze=Math.pow((1-Ze)/(1+Ze),J/2),De=Math.PI/2-2*Math.atan(ue*Ze)-Se,Se+=De;return new ge(Se*k,h.x*k/P)}},Rc={__proto__:null,LonLat:Lc,Mercator:Hl,SphericalMercator:me},Wl=i({},pe,{code:"EPSG:3395",projection:Hl,transformation:(function(){var h=.5/(Math.PI*Hl.R);return xe(h,.5,-h,.5)})()}),Oc=i({},pe,{code:"EPSG:4326",projection:Lc,transformation:xe(1/180,1,-1/180,.5)}),_f=i({},ae,{projection:Lc,transformation:xe(1,0,-1,0),scale:function(h){return Math.pow(2,h)},zoom:function(h){return Math.log(h)/Math.LN2},distance:function(h,k){var P=k.lng-h.lng,G=k.lat-h.lat;return Math.sqrt(P*P+G*G)},infinite:!0});ae.Earth=pe,ae.EPSG3395=Wl,ae.EPSG3857=we,ae.EPSG900913=Ge,ae.EPSG4326=Oc,ae.Simple=_f;var qa=Y.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(h){return h.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(h){return h&&h.removeLayer(this),this},getPane:function(h){return this._map.getPane(h?this.options[h]||h:this.options.pane)},addInteractiveTarget:function(h){return this._map._targets[l(h)]=this,this},removeInteractiveTarget:function(h){return delete this._map._targets[l(h)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(h){var k=h.target;if(k.hasLayer(this)){if(this._map=k,this._zoomAnimated=k._zoomAnimated,this.getEvents){var P=this.getEvents();k.on(P,this),this.once("remove",function(){k.off(P,this)},this)}this.onAdd(k),this.fire("add"),k.fire("layeradd",{layer:this})}}});br.include({addLayer:function(h){if(!h._layerAdd)throw new Error("The provided object is not a Layer.");var k=l(h);return this._layers[k]?this:(this._layers[k]=h,h._mapToAdd=this,h.beforeAdd&&h.beforeAdd(this),this.whenReady(h._layerAdd,h),this)},removeLayer:function(h){var k=l(h);return this._layers[k]?(this._loaded&&h.onRemove(this),delete this._layers[k],this._loaded&&(this.fire("layerremove",{layer:h}),h.fire("remove")),h._map=h._mapToAdd=null,this):this},hasLayer:function(h){return l(h)in this._layers},eachLayer:function(h,k){for(var P in this._layers)h.call(k,this._layers[P]);return this},_addLayers:function(h){h=h?C(h)?h:[h]:[];for(var k=0,P=h.length;k<P;k++)this.addLayer(h[k])},_addZoomLimit:function(h){(!isNaN(h.options.maxZoom)||!isNaN(h.options.minZoom))&&(this._zoomBoundLayers[l(h)]=h,this._updateZoomLevels())},_removeZoomLimit:function(h){var k=l(h);this._zoomBoundLayers[k]&&(delete this._zoomBoundLayers[k],this._updateZoomLevels())},_updateZoomLevels:function(){var h=1/0,k=-1/0,P=this._getZoomSpan();for(var G in this._zoomBoundLayers){var J=this._zoomBoundLayers[G].options;h=J.minZoom===void 0?h:Math.min(h,J.minZoom),k=J.maxZoom===void 0?k:Math.max(k,J.maxZoom)}this._layersMaxZoom=k===-1/0?void 0:k,this._layersMinZoom=h===1/0?void 0:h,P!==this._getZoomSpan()&&this.fire("zoomlevelschange"),this.options.maxZoom===void 0&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),this.options.minZoom===void 0&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var Ls=qa.extend({initialize:function(h,k){S(this,k),this._layers={};var P,G;if(h)for(P=0,G=h.length;P<G;P++)this.addLayer(h[P])},addLayer:function(h){var k=this.getLayerId(h);return this._layers[k]=h,this._map&&this._map.addLayer(h),this},removeLayer:function(h){var k=h in this._layers?h:this.getLayerId(h);return this._map&&this._layers[k]&&this._map.removeLayer(this._layers[k]),delete this._layers[k],this},hasLayer:function(h){var k=typeof h=="number"?h:this.getLayerId(h);return k in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(h){var k=Array.prototype.slice.call(arguments,1),P,G;for(P in this._layers)G=this._layers[P],G[h]&&G[h].apply(G,k);return this},onAdd:function(h){this.eachLayer(h.addLayer,h)},onRemove:function(h){this.eachLayer(h.removeLayer,h)},eachLayer:function(h,k){for(var P in this._layers)h.call(k,this._layers[P]);return this},getLayer:function(h){return this._layers[h]},getLayers:function(){var h=[];return this.eachLayer(h.push,h),h},setZIndex:function(h){return this.invoke("setZIndex",h)},getLayerId:function(h){return l(h)}}),tl=function(h,k){return new Ls(h,k)},Ki=Ls.extend({addLayer:function(h){return this.hasLayer(h)?this:(h.addEventParent(this),Ls.prototype.addLayer.call(this,h),this.fire("layeradd",{layer:h}))},removeLayer:function(h){return this.hasLayer(h)?(h in this._layers&&(h=this._layers[h]),h.removeEventParent(this),Ls.prototype.removeLayer.call(this,h),this.fire("layerremove",{layer:h})):this},setStyle:function(h){return this.invoke("setStyle",h)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var h=new ie;for(var k in this._layers){var P=this._layers[k];h.extend(P.getBounds?P.getBounds():P.getLatLng())}return h}}),Sa=function(h,k){return new Ki(h,k)},ka=q.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(h){S(this,h)},createIcon:function(h){return this._createIcon("icon",h)},createShadow:function(h){return this._createIcon("shadow",h)},_createIcon:function(h,k){var P=this._getIconUrl(h);if(!P){if(h==="icon")throw new Error("iconUrl not set in Icon options (see the docs).");return null}var G=this._createImg(P,k&&k.tagName==="IMG"?k:null);return this._setIconStyles(G,h),(this.options.crossOrigin||this.options.crossOrigin==="")&&(G.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),G},_setIconStyles:function(h,k){var P=this.options,G=P[k+"Size"];typeof G=="number"&&(G=[G,G]);var J=re(G),ue=re(k==="shadow"&&P.shadowAnchor||P.iconAnchor||J&&J.divideBy(2,!0));h.className="leaflet-marker-"+k+" "+(P.className||""),ue&&(h.style.marginLeft=-ue.x+"px",h.style.marginTop=-ue.y+"px"),J&&(h.style.width=J.x+"px",h.style.height=J.y+"px")},_createImg:function(h,k){return k=k||document.createElement("img"),k.src=h,k},_getIconUrl:function(h){return lt.retina&&this.options[h+"RetinaUrl"]||this.options[h+"Url"]}});function Dc(h){return new ka(h)}var rl=ka.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(h){return typeof rl.imagePath!="string"&&(rl.imagePath=this._detectIconPath()),(this.options.imagePath||rl.imagePath)+ka.prototype._getIconUrl.call(this,h)},_stripUrl:function(h){var k=function(P,G,J){var ue=G.exec(P);return ue&&ue[J]};return h=k(h,/^url\((['"])?(.+)\1\)$/,2),h&&k(h,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var h=ht("div","leaflet-default-icon-path",document.body),k=Mr(h,"background-image")||Mr(h,"backgroundImage");if(document.body.removeChild(h),k=this._stripUrl(k),k)return k;var P=document.querySelector('link[href$="leaflet.css"]');return P?P.href.substring(0,P.href.length-11-1):""}}),$a=$i.extend({initialize:function(h){this._marker=h},addHooks:function(){var h=this._marker._icon;this._draggable||(this._draggable=new yn(h,h,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),Ft(h,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&Lr(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(h){var k=this._marker,P=k._map,G=this._marker.options.autoPanSpeed,J=this._marker.options.autoPanPadding,ue=Xs(k._icon),Se=P.getPixelBounds(),Me=P.getPixelOrigin(),De=te(Se.min._subtract(Me).add(J),Se.max._subtract(Me).subtract(J));if(!De.contains(ue)){var Ze=re((Math.max(De.max.x,ue.x)-De.max.x)/(Se.max.x-De.max.x)-(Math.min(De.min.x,ue.x)-De.min.x)/(Se.min.x-De.min.x),(Math.max(De.max.y,ue.y)-De.max.y)/(Se.max.y-De.max.y)-(Math.min(De.min.y,ue.y)-De.min.y)/(Se.min.y-De.min.y)).multiplyBy(G);P.panBy(Ze,{animate:!1}),this._draggable._newPos._add(Ze),this._draggable._startPos._add(Ze),Mn(k._icon,this._draggable._newPos),this._onDrag(h),this._panRequest=$(this._adjustPan.bind(this,h))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(h){this._marker.options.autoPan&&(Z(this._panRequest),this._panRequest=$(this._adjustPan.bind(this,h)))},_onDrag:function(h){var k=this._marker,P=k._shadow,G=Xs(k._icon),J=k._map.layerPointToLatLng(G);P&&Mn(P,G),k._latlng=J,h.latlng=J,h.oldLatLng=this._oldLatLng,k.fire("move",h).fire("drag",h)},_onDragEnd:function(h){Z(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",h)}}),Ci=qa.extend({options:{icon:new rl,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(h,k){S(this,k),this._latlng=ye(h)},onAdd:function(h){this._zoomAnimated=this._zoomAnimated&&h.options.markerZoomAnimation,this._zoomAnimated&&h.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(h){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&h.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(h){var k=this._latlng;return this._latlng=ye(h),this.update(),this.fire("move",{oldLatLng:k,latlng:this._latlng})},setZIndexOffset:function(h){return this.options.zIndexOffset=h,this.update()},getIcon:function(){return this.options.icon},setIcon:function(h){return this.options.icon=h,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var h=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(h)}return this},_initIcon:function(){var h=this.options,k="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),P=h.icon.createIcon(this._icon),G=!1;P!==this._icon&&(this._icon&&this._removeIcon(),G=!0,h.title&&(P.title=h.title),P.tagName==="IMG"&&(P.alt=h.alt||"")),Ft(P,k),h.keyboard&&(P.tabIndex="0",P.setAttribute("role","button")),this._icon=P,h.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&tr(P,"focus",this._panOnFocus,this);var J=h.icon.createShadow(this._shadow),ue=!1;J!==this._shadow&&(this._removeShadow(),ue=!0),J&&(Ft(J,k),J.alt=""),this._shadow=J,h.opacity<1&&this._updateOpacity(),G&&this.getPane().appendChild(this._icon),this._initInteraction(),J&&ue&&this.getPane(h.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&Gr(this._icon,"focus",this._panOnFocus,this),kr(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&kr(this._shadow),this._shadow=null},_setPos:function(h){this._icon&&Mn(this._icon,h),this._shadow&&Mn(this._shadow,h),this._zIndex=h.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(h){this._icon&&(this._icon.style.zIndex=this._zIndex+h)},_animateZoom:function(h){var k=this._map._latLngToNewLayerPoint(this._latlng,h.zoom,h.center).round();this._setPos(k)},_initInteraction:function(){if(this.options.interactive&&(Ft(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),$a)){var h=this.options.draggable;this.dragging&&(h=this.dragging.enabled(),this.dragging.disable()),this.dragging=new $a(this),h&&this.dragging.enable()}},setOpacity:function(h){return this.options.opacity=h,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var h=this.options.opacity;this._icon&&li(this._icon,h),this._shadow&&li(this._shadow,h)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var h=this._map;if(h){var k=this.options.icon.options,P=k.iconSize?re(k.iconSize):re(0,0),G=k.iconAnchor?re(k.iconAnchor):re(0,0);h.panInside(this._latlng,{paddingTopLeft:G,paddingBottomRight:P.subtract(G)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function Cf(h,k){return new Ci(h,k)}var eo=qa.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(h){this._renderer=h.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(h){return S(this,h),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&h&&Object.prototype.hasOwnProperty.call(h,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),Ka=eo.extend({options:{fill:!0,radius:10},initialize:function(h,k){S(this,k),this._latlng=ye(h),this._radius=this.options.radius},setLatLng:function(h){var k=this._latlng;return this._latlng=ye(h),this.redraw(),this.fire("move",{oldLatLng:k,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(h){return this.options.radius=this._radius=h,this.redraw()},getRadius:function(){return this._radius},setStyle:function(h){var k=h&&h.radius||this._radius;return eo.prototype.setStyle.call(this,h),this.setRadius(k),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var h=this._radius,k=this._radiusY||h,P=this._clickTolerance(),G=[h+P,k+P];this._pxBounds=new H(this._point.subtract(G),this._point.add(G))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(h){return h.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function to(h,k){return new Ka(h,k)}var nl=Ka.extend({initialize:function(h,k,P){if(typeof k=="number"&&(k=i({},P,{radius:k})),S(this,k),this._latlng=ye(h),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(h){return this._mRadius=h,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var h=[this._radius,this._radiusY||this._radius];return new ie(this._map.layerPointToLatLng(this._point.subtract(h)),this._map.layerPointToLatLng(this._point.add(h)))},setStyle:eo.prototype.setStyle,_project:function(){var h=this._latlng.lng,k=this._latlng.lat,P=this._map,G=P.options.crs;if(G.distance===pe.distance){var J=Math.PI/180,ue=this._mRadius/pe.R/J,Se=P.project([k+ue,h]),Me=P.project([k-ue,h]),De=Se.add(Me).divideBy(2),Ze=P.unproject(De).lat,xt=Math.acos((Math.cos(ue*J)-Math.sin(k*J)*Math.sin(Ze*J))/(Math.cos(k*J)*Math.cos(Ze*J)))/J;(isNaN(xt)||xt===0)&&(xt=ue/Math.cos(Math.PI/180*k)),this._point=De.subtract(P.getPixelOrigin()),this._radius=isNaN(xt)?0:De.x-P.project([Ze,h-xt]).x,this._radiusY=De.y-Se.y}else{var Kt=G.unproject(G.project(this._latlng).subtract([this._mRadius,0]));this._point=P.latLngToLayerPoint(this._latlng),this._radius=this._point.x-P.latLngToLayerPoint(Kt).x}this._updateBounds()}});function ql(h,k,P){return new nl(h,k,P)}var Ei=eo.extend({options:{smoothFactor:1,noClip:!1},initialize:function(h,k){S(this,k),this._setLatLngs(h)},getLatLngs:function(){return this._latlngs},setLatLngs:function(h){return this._setLatLngs(h),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(h){for(var k=1/0,P=null,G=hs,J,ue,Se=0,Me=this._parts.length;Se<Me;Se++)for(var De=this._parts[Se],Ze=1,xt=De.length;Ze<xt;Ze++){J=De[Ze-1],ue=De[Ze];var Kt=G(h,J,ue,!0);Kt<k&&(k=Kt,P=G(h,J,ue))}return P&&(P.distance=Math.sqrt(k)),P},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return kf(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(h,k){return k=k||this._defaultShape(),h=ye(h),k.push(h),this._bounds.extend(h),this.redraw()},_setLatLngs:function(h){this._bounds=new ie,this._latlngs=this._convertLatLngs(h)},_defaultShape:function(){return Ii(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(h){for(var k=[],P=Ii(h),G=0,J=h.length;G<J;G++)P?(k[G]=ye(h[G]),this._bounds.extend(k[G])):k[G]=this._convertLatLngs(h[G]);return k},_project:function(){var h=new H;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,h),this._bounds.isValid()&&h.isValid()&&(this._rawPxBounds=h,this._updateBounds())},_updateBounds:function(){var h=this._clickTolerance(),k=new Q(h,h);this._rawPxBounds&&(this._pxBounds=new H([this._rawPxBounds.min.subtract(k),this._rawPxBounds.max.add(k)]))},_projectLatlngs:function(h,k,P){var G=h[0]instanceof ge,J=h.length,ue,Se;if(G){for(Se=[],ue=0;ue<J;ue++)Se[ue]=this._map.latLngToLayerPoint(h[ue]),P.extend(Se[ue]);k.push(Se)}else for(ue=0;ue<J;ue++)this._projectLatlngs(h[ue],k,P)},_clipPoints:function(){var h=this._renderer._bounds;if(this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(h))){if(this.options.noClip){this._parts=this._rings;return}var k=this._parts,P,G,J,ue,Se,Me,De;for(P=0,J=0,ue=this._rings.length;P<ue;P++)for(De=this._rings[P],G=0,Se=De.length;G<Se-1;G++)Me=Mc(De[G],De[G+1],h,G,!0),Me&&(k[J]=k[J]||[],k[J].push(Me[0]),(Me[1]!==De[G+1]||G===Se-2)&&(k[J].push(Me[1]),J++))}},_simplifyPoints:function(){for(var h=this._parts,k=this.options.smoothFactor,P=0,G=h.length;P<G;P++)h[P]=Bu(h[P],k)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(h,k){var P,G,J,ue,Se,Me,De=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(h))return!1;for(P=0,ue=this._parts.length;P<ue;P++)for(Me=this._parts[P],G=0,Se=Me.length,J=Se-1;G<Se;J=G++)if(!(!k&&G===0)&&Pc(h,Me[J],Me[G])<=De)return!0;return!1}});function Uh(h,k){return new Ei(h,k)}Ei._flat=Sf;var _a=Ei.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Gl(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(h){var k=Ei.prototype._convertLatLngs.call(this,h),P=k.length;return P>=2&&k[0]instanceof ge&&k[0].equals(k[P-1])&&k.pop(),k},_setLatLngs:function(h){Ei.prototype._setLatLngs.call(this,h),Ii(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return Ii(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var h=this._renderer._bounds,k=this.options.weight,P=new Q(k,k);if(h=new H(h.min.subtract(P),h.max.add(P)),this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(h))){if(this.options.noClip){this._parts=this._rings;return}for(var G=0,J=this._rings.length,ue;G<J;G++)ue=$r(this._rings[G],h,!0),ue.length&&this._parts.push(ue)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(h){var k=!1,P,G,J,ue,Se,Me,De,Ze;if(!this._pxBounds||!this._pxBounds.contains(h))return!1;for(ue=0,De=this._parts.length;ue<De;ue++)for(P=this._parts[ue],Se=0,Ze=P.length,Me=Ze-1;Se<Ze;Me=Se++)G=P[Se],J=P[Me],G.y>h.y!=J.y>h.y&&h.x<(J.x-G.x)*(h.y-G.y)/(J.y-G.y)+G.x&&(k=!k);return k||Ei.prototype._containsPoint.call(this,h,!0)}});function Za(h,k){return new _a(h,k)}var Zi=Ki.extend({initialize:function(h,k){S(this,k),this._layers={},h&&this.addData(h)},addData:function(h){var k=C(h)?h:h.features,P,G,J;if(k){for(P=0,G=k.length;P<G;P++)J=k[P],(J.geometries||J.geometry||J.features||J.coordinates)&&this.addData(J);return this}var ue=this.options;if(ue.filter&&!ue.filter(h))return this;var Se=ps(h,ue);return Se?(Se.feature=il(h),Se.defaultOptions=Se.options,this.resetStyle(Se),ue.onEachFeature&&ue.onEachFeature(h,Se),this.addLayer(Se)):this},resetStyle:function(h){return h===void 0?this.eachLayer(this.resetStyle,this):(h.options=i({},h.defaultOptions),this._setLayerStyle(h,this.options.style),this)},setStyle:function(h){return this.eachLayer(function(k){this._setLayerStyle(k,h)},this)},_setLayerStyle:function(h,k){h.setStyle&&(typeof k=="function"&&(k=k(h.feature)),h.setStyle(k))}});function ps(h,k){var P=h.type==="Feature"?h.geometry:h,G=P?P.coordinates:null,J=[],ue=k&&k.pointToLayer,Se=k&&k.coordsToLatLng||$l,Me,De,Ze,xt;if(!G&&!P)return null;switch(P.type){case"Point":return Me=Se(G),Ca(ue,h,Me,k);case"MultiPoint":for(Ze=0,xt=G.length;Ze<xt;Ze++)Me=Se(G[Ze]),J.push(Ca(ue,h,Me,k));return new Ki(J);case"LineString":case"MultiLineString":return De=Rs(G,P.type==="LineString"?0:1,Se),new Ei(De,k);case"Polygon":case"MultiPolygon":return De=Rs(G,P.type==="Polygon"?1:2,Se),new _a(De,k);case"GeometryCollection":for(Ze=0,xt=P.geometries.length;Ze<xt;Ze++){var Kt=ps({geometry:P.geometries[Ze],type:"Feature",properties:h.properties},k);Kt&&J.push(Kt)}return new Ki(J);case"FeatureCollection":for(Ze=0,xt=P.features.length;Ze<xt;Ze++){var dr=ps(P.features[Ze],k);dr&&J.push(dr)}return new Ki(J);default:throw new Error("Invalid GeoJSON object.")}}function Ca(h,k,P,G){return h?h(k,P):new Ci(P,G&&G.markersInheritOptions&&G)}function $l(h){return new ge(h[1],h[0],h[2])}function Rs(h,k,P){for(var G=[],J=0,ue=h.length,Se;J<ue;J++)Se=k?Rs(h[J],k-1,P):(P||$l)(h[J]),G.push(Se);return G}function zu(h,k){return h=ye(h),h.alt!==void 0?[p(h.lng,k),p(h.lat,k),p(h.alt,k)]:[p(h.lng,k),p(h.lat,k)]}function Kl(h,k,P,G){for(var J=[],ue=0,Se=h.length;ue<Se;ue++)J.push(k?Kl(h[ue],Ii(h[ue])?0:k-1,P,G):zu(h[ue],G));return!k&&P&&J.length>0&&J.push(J[0].slice()),J}function jr(h,k){return h.feature?i({},h.feature,{geometry:k}):il(k)}function il(h){return h.type==="Feature"||h.type==="FeatureCollection"?h:{type:"Feature",properties:{},geometry:h}}var Uu={toGeoJSON:function(h){return jr(this,{type:"Point",coordinates:zu(this.getLatLng(),h)})}};Ci.include(Uu),nl.include(Uu),Ka.include(Uu),Ei.include({toGeoJSON:function(h){var k=!Ii(this._latlngs),P=Kl(this._latlngs,k?1:0,!1,h);return jr(this,{type:(k?"Multi":"")+"LineString",coordinates:P})}}),_a.include({toGeoJSON:function(h){var k=!Ii(this._latlngs),P=k&&!Ii(this._latlngs[0]),G=Kl(this._latlngs,P?2:k?1:0,!0,h);return k||(G=[G]),jr(this,{type:(P?"Multi":"")+"Polygon",coordinates:G})}}),Ls.include({toMultiPoint:function(h){var k=[];return this.eachLayer(function(P){k.push(P.toGeoJSON(h).geometry.coordinates)}),jr(this,{type:"MultiPoint",coordinates:k})},toGeoJSON:function(h){var k=this.feature&&this.feature.geometry&&this.feature.geometry.type;if(k==="MultiPoint")return this.toMultiPoint(h);var P=k==="GeometryCollection",G=[];return this.eachLayer(function(J){if(J.toGeoJSON){var ue=J.toGeoJSON(h);if(P)G.push(ue.geometry);else{var Se=il(ue);Se.type==="FeatureCollection"?G.push.apply(G,Se.features):G.push(Se)}}}),P?jr(this,{geometries:G,type:"GeometryCollection"}):{type:"FeatureCollection",features:G}}});function Ic(h,k){return new Zi(h,k)}var Yi=Ic,Os=qa.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(h,k,P){this._url=h,this._bounds=de(k),S(this,P)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(Ft(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){kr(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(h){return this.options.opacity=h,this._image&&this._updateOpacity(),this},setStyle:function(h){return h.opacity&&this.setOpacity(h.opacity),this},bringToFront:function(){return this._map&&Qr(this._image),this},bringToBack:function(){return this._map&&Ur(this._image),this},setUrl:function(h){return this._url=h,this._image&&(this._image.src=h),this},setBounds:function(h){return this._bounds=de(h),this._map&&this._reset(),this},getEvents:function(){var h={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(h.zoomanim=this._animateZoom),h},setZIndex:function(h){return this.options.zIndex=h,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var h=this._url.tagName==="IMG",k=this._image=h?this._url:ht("img");if(Ft(k,"leaflet-image-layer"),this._zoomAnimated&&Ft(k,"leaflet-zoom-animated"),this.options.className&&Ft(k,this.options.className),k.onselectstart=f,k.onmousemove=f,k.onload=s(this.fire,this,"load"),k.onerror=s(this._overlayOnError,this,"error"),(this.options.crossOrigin||this.options.crossOrigin==="")&&(k.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),h){this._url=k.src;return}k.src=this._url,k.alt=this.options.alt},_animateZoom:function(h){var k=this._map.getZoomScale(h.zoom),P=this._map._latLngBoundsToNewLayerBounds(this._bounds,h.zoom,h.center).min;cs(this._image,P,k)},_reset:function(){var h=this._image,k=new H(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),P=k.getSize();Mn(h,k.min),h.style.width=P.x+"px",h.style.height=P.y+"px"},_updateOpacity:function(){li(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var h=this.options.errorOverlayUrl;h&&this._url!==h&&(this._url=h,this._image.src=h)},getCenter:function(){return this._bounds.getCenter()}}),wo=function(h,k,P){return new Os(h,k,P)},Jr=Os.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var h=this._url.tagName==="VIDEO",k=this._image=h?this._url:ht("video");if(Ft(k,"leaflet-image-layer"),this._zoomAnimated&&Ft(k,"leaflet-zoom-animated"),this.options.className&&Ft(k,this.options.className),k.onselectstart=f,k.onmousemove=f,k.onloadeddata=s(this.fire,this,"load"),h){for(var P=k.getElementsByTagName("source"),G=[],J=0;J<P.length;J++)G.push(P[J].src);this._url=P.length>0?G:[k.src];return}C(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(k.style,"objectFit")&&(k.style.objectFit="fill"),k.autoplay=!!this.options.autoplay,k.loop=!!this.options.loop,k.muted=!!this.options.muted,k.playsInline=!!this.options.playsInline;for(var ue=0;ue<this._url.length;ue++){var Se=ht("source");Se.src=this._url[ue],k.appendChild(Se)}}});function On(h,k,P){return new Jr(h,k,P)}var Dn=Os.extend({_initImage:function(){var h=this._image=this._url;Ft(h,"leaflet-image-layer"),this._zoomAnimated&&Ft(h,"leaflet-zoom-animated"),this.options.className&&Ft(h,this.options.className),h.onselectstart=f,h.onmousemove=f}});function Zl(h,k,P){return new Dn(h,k,P)}var Xi=qa.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(h,k){h&&(h instanceof ge||C(h))?(this._latlng=ye(h),S(this,k)):(S(this,h),this._source=k),this.options.content&&(this._content=this.options.content)},openOn:function(h){return h=arguments.length?h:this._source._map,h.hasLayer(this)||h.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(h){return this._map?this.close():(arguments.length?this._source=h:h=this._source,this._prepareOpen(),this.openOn(h._map)),this},onAdd:function(h){this._zoomAnimated=h._zoomAnimated,this._container||this._initLayout(),h._fadeAnimated&&li(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),h._fadeAnimated&&li(this._container,1),this.bringToFront(),this.options.interactive&&(Ft(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(h){h._fadeAnimated?(li(this._container,0),this._removeTimeout=setTimeout(s(kr,void 0,this._container),200)):kr(this._container),this.options.interactive&&(Lr(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(h){return this._latlng=ye(h),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(h){return this._content=h,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var h={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(h.zoomanim=this._animateZoom),h},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&Qr(this._container),this},bringToBack:function(){return this._map&&Ur(this._container),this},_prepareOpen:function(h){var k=this._source;if(!k._map)return!1;if(k instanceof Ki){k=null;var P=this._source._layers;for(var G in P)if(P[G]._map){k=P[G];break}if(!k)return!1;this._source=k}if(!h)if(k.getCenter)h=k.getCenter();else if(k.getLatLng)h=k.getLatLng();else if(k.getBounds)h=k.getBounds().getCenter();else throw new Error("Unable to get source layer LatLng.");return this.setLatLng(h),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var h=this._contentNode,k=typeof this._content=="function"?this._content(this._source||this):this._content;if(typeof k=="string")h.innerHTML=k;else{for(;h.hasChildNodes();)h.removeChild(h.firstChild);h.appendChild(k)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var h=this._map.latLngToLayerPoint(this._latlng),k=re(this.options.offset),P=this._getAnchor();this._zoomAnimated?Mn(this._container,h.add(P)):k=k.add(h).add(P);var G=this._containerBottom=-k.y,J=this._containerLeft=-Math.round(this._containerWidth/2)+k.x;this._container.style.bottom=G+"px",this._container.style.left=J+"px"}},_getAnchor:function(){return[0,0]}});br.include({_initOverlay:function(h,k,P,G){var J=k;return J instanceof h||(J=new h(G).setContent(k)),P&&J.setLatLng(P),J}}),qa.include({_initOverlay:function(h,k,P,G){var J=P;return J instanceof h?(S(J,G),J._source=this):(J=k&&!G?k:new h(G,this),J.setContent(P)),J}});var So=Xi.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(h){return h=arguments.length?h:this._source._map,!h.hasLayer(this)&&h._popup&&h._popup.options.autoClose&&h.removeLayer(h._popup),h._popup=this,Xi.prototype.openOn.call(this,h)},onAdd:function(h){Xi.prototype.onAdd.call(this,h),h.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof eo||this._source.on("preclick",Ps))},onRemove:function(h){Xi.prototype.onRemove.call(this,h),h.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof eo||this._source.off("preclick",Ps))},getEvents:function(){var h=Xi.prototype.getEvents.call(this);return(this.options.closeOnClick!==void 0?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(h.preclick=this.close),this.options.keepInView&&(h.moveend=this._adjustPan),h},_initLayout:function(){var h="leaflet-popup",k=this._container=ht("div",h+" "+(this.options.className||"")+" leaflet-zoom-animated"),P=this._wrapper=ht("div",h+"-content-wrapper",k);if(this._contentNode=ht("div",h+"-content",P),Du(k),Bl(this._contentNode),tr(k,"contextmenu",Ps),this._tipContainer=ht("div",h+"-tip-container",k),this._tip=ht("div",h+"-tip",this._tipContainer),this.options.closeButton){var G=this._closeButton=ht("a",h+"-close-button",k);G.setAttribute("role","button"),G.setAttribute("aria-label","Close popup"),G.href="#close",G.innerHTML='<span aria-hidden="true">&#215;</span>',tr(G,"click",function(J){nn(J),this.close()},this)}},_updateLayout:function(){var h=this._contentNode,k=h.style;k.width="",k.whiteSpace="nowrap";var P=h.offsetWidth;P=Math.min(P,this.options.maxWidth),P=Math.max(P,this.options.minWidth),k.width=P+1+"px",k.whiteSpace="",k.height="";var G=h.offsetHeight,J=this.options.maxHeight,ue="leaflet-popup-scrolled";J&&G>J?(k.height=J+"px",Ft(h,ue)):Lr(h,ue),this._containerWidth=this._container.offsetWidth},_animateZoom:function(h){var k=this._map._latLngToNewLayerPoint(this._latlng,h.zoom,h.center),P=this._getAnchor();Mn(this._container,k.add(P))},_adjustPan:function(){if(this.options.autoPan){if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning){this._autopanning=!1;return}var h=this._map,k=parseInt(Mr(this._container,"marginBottom"),10)||0,P=this._container.offsetHeight+k,G=this._containerWidth,J=new Q(this._containerLeft,-P-this._containerBottom);J._add(Xs(this._container));var ue=h.layerPointToContainerPoint(J),Se=re(this.options.autoPanPadding),Me=re(this.options.autoPanPaddingTopLeft||Se),De=re(this.options.autoPanPaddingBottomRight||Se),Ze=h.getSize(),xt=0,Kt=0;ue.x+G+De.x>Ze.x&&(xt=ue.x+G-Ze.x+De.x),ue.x-xt-Me.x<0&&(xt=ue.x-Me.x),ue.y+P+De.y>Ze.y&&(Kt=ue.y+P-Ze.y+De.y),ue.y-Kt-Me.y<0&&(Kt=ue.y-Me.y),(xt||Kt)&&(this.options.keepInView&&(this._autopanning=!0),h.fire("autopanstart").panBy([xt,Kt]))}},_getAnchor:function(){return re(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),Yl=function(h,k){return new So(h,k)};br.mergeOptions({closePopupOnClick:!0}),br.include({openPopup:function(h,k,P){return this._initOverlay(So,h,k,P).openOn(this),this},closePopup:function(h){return h=arguments.length?h:this._popup,h&&h.close(),this}}),qa.include({bindPopup:function(h,k){return this._popup=this._initOverlay(So,this._popup,h,k),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(h){return this._popup&&(this instanceof Ki||(this._popup._source=this),this._popup._prepareOpen(h||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return this._popup?this._popup.isOpen():!1},setPopupContent:function(h){return this._popup&&this._popup.setContent(h),this},getPopup:function(){return this._popup},_openPopup:function(h){if(!(!this._popup||!this._map)){Ln(h);var k=h.layer||h.target;if(this._popup._source===k&&!(k instanceof eo)){this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(h.latlng);return}this._popup._source=k,this.openPopup(h.latlng)}},_movePopup:function(h){this._popup.setLatLng(h.latlng)},_onKeyPress:function(h){h.originalEvent.keyCode===13&&this._openPopup(h)}});var Cn=Xi.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(h){Xi.prototype.onAdd.call(this,h),this.setOpacity(this.options.opacity),h.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(h){Xi.prototype.onRemove.call(this,h),h.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var h=Xi.prototype.getEvents.call(this);return this.options.permanent||(h.preclick=this.close),h},_initLayout:function(){var h="leaflet-tooltip",k=h+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=ht("div",k),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+l(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(h){var k,P,G=this._map,J=this._container,ue=G.latLngToContainerPoint(G.getCenter()),Se=G.layerPointToContainerPoint(h),Me=this.options.direction,De=J.offsetWidth,Ze=J.offsetHeight,xt=re(this.options.offset),Kt=this._getAnchor();Me==="top"?(k=De/2,P=Ze):Me==="bottom"?(k=De/2,P=0):Me==="center"?(k=De/2,P=Ze/2):Me==="right"?(k=0,P=Ze/2):Me==="left"?(k=De,P=Ze/2):Se.x<ue.x?(Me="right",k=0,P=Ze/2):(Me="left",k=De+(xt.x+Kt.x)*2,P=Ze/2),h=h.subtract(re(k,P,!0)).add(xt).add(Kt),Lr(J,"leaflet-tooltip-right"),Lr(J,"leaflet-tooltip-left"),Lr(J,"leaflet-tooltip-top"),Lr(J,"leaflet-tooltip-bottom"),Ft(J,"leaflet-tooltip-"+Me),Mn(J,h)},_updatePosition:function(){var h=this._map.latLngToLayerPoint(this._latlng);this._setPosition(h)},setOpacity:function(h){this.options.opacity=h,this._container&&li(this._container,h)},_animateZoom:function(h){var k=this._map._latLngToNewLayerPoint(this._latlng,h.zoom,h.center);this._setPosition(k)},_getAnchor:function(){return re(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),al=function(h,k){return new Cn(h,k)};br.include({openTooltip:function(h,k,P){return this._initOverlay(Cn,h,k,P).openOn(this),this},closeTooltip:function(h){return h.close(),this}}),qa.include({bindTooltip:function(h,k){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(Cn,this._tooltip,h,k),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(h){if(!(!h&&this._tooltipHandlersAdded)){var k=h?"off":"on",P={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?P.add=this._openTooltip:(P.mouseover=this._openTooltip,P.mouseout=this.closeTooltip,P.click=this._openTooltip,this._map?this._addFocusListeners():P.add=this._addFocusListeners),this._tooltip.options.sticky&&(P.mousemove=this._moveTooltip),this[k](P),this._tooltipHandlersAdded=!h}},openTooltip:function(h){return this._tooltip&&(this instanceof Ki||(this._tooltip._source=this),this._tooltip._prepareOpen(h)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(h){return this._tooltip&&this._tooltip.setContent(h),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(h){var k=typeof h.getElement=="function"&&h.getElement();k&&(tr(k,"focus",function(){this._tooltip._source=h,this.openTooltip()},this),tr(k,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(h){var k=typeof h.getElement=="function"&&h.getElement();k&&k.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(h){if(!(!this._tooltip||!this._map)){if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var k=this;this._map.once("moveend",function(){k._openOnceFlag=!1,k._openTooltip(h)});return}this._tooltip._source=h.layer||h.target,this.openTooltip(this._tooltip.options.sticky?h.latlng:void 0)}},_moveTooltip:function(h){var k=h.latlng,P,G;this._tooltip.options.sticky&&h.originalEvent&&(P=this._map.mouseEventToContainerPoint(h.originalEvent),G=this._map.containerPointToLayerPoint(P),k=this._map.layerPointToLatLng(G)),this._tooltip.setLatLng(k)}});var Xl=ka.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(h){var k=h&&h.tagName==="DIV"?h:document.createElement("div"),P=this.options;if(P.html instanceof Element?(vn(k),k.appendChild(P.html)):k.innerHTML=P.html!==!1?P.html:"",P.bgPos){var G=re(P.bgPos);k.style.backgroundPosition=-G.x+"px "+-G.y+"px"}return this._setIconStyles(k,"icon"),k},createShadow:function(){return null}});function jc(h){return new Xl(h)}ka.Default=rl;var di=qa.extend({options:{tileSize:256,opacity:1,updateWhenIdle:lt.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(h){S(this,h)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(h){h._addZoomLimit(this)},onRemove:function(h){this._removeAllTiles(),kr(this._container),h._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(Qr(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(Ur(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(h){return this.options.opacity=h,this._updateOpacity(),this},setZIndex:function(h){return this.options.zIndex=h,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var h=this._clampZoom(this._map.getZoom());h!==this._tileZoom&&(this._tileZoom=h,this._updateLevels()),this._update()}return this},getEvents:function(){var h={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=u(this._onMoveEnd,this.options.updateInterval,this)),h.move=this._onMove),this._zoomAnimated&&(h.zoomanim=this._animateZoom),h},createTile:function(){return document.createElement("div")},getTileSize:function(){var h=this.options.tileSize;return h instanceof Q?h:new Q(h,h)},_updateZIndex:function(){this._container&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(h){for(var k=this.getPane().children,P=-h(-1/0,1/0),G=0,J=k.length,ue;G<J;G++)ue=k[G].style.zIndex,k[G]!==this._container&&ue&&(P=h(P,+ue));isFinite(P)&&(this.options.zIndex=P+h(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!lt.ielt9){li(this._container,this.options.opacity);var h=+new Date,k=!1,P=!1;for(var G in this._tiles){var J=this._tiles[G];if(!(!J.current||!J.loaded)){var ue=Math.min(1,(h-J.loaded)/200);li(J.el,ue),ue<1?k=!0:(J.active?P=!0:this._onOpaqueTile(J),J.active=!0)}}P&&!this._noPrune&&this._pruneTiles(),k&&(Z(this._fadeFrame),this._fadeFrame=$(this._updateOpacity,this))}},_onOpaqueTile:f,_initContainer:function(){this._container||(this._container=ht("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var h=this._tileZoom,k=this.options.maxZoom;if(h!==void 0){for(var P in this._levels)P=Number(P),this._levels[P].el.children.length||P===h?(this._levels[P].el.style.zIndex=k-Math.abs(h-P),this._onUpdateLevel(P)):(kr(this._levels[P].el),this._removeTilesAtZoom(P),this._onRemoveLevel(P),delete this._levels[P]);var G=this._levels[h],J=this._map;return G||(G=this._levels[h]={},G.el=ht("div","leaflet-tile-container leaflet-zoom-animated",this._container),G.el.style.zIndex=k,G.origin=J.project(J.unproject(J.getPixelOrigin()),h).round(),G.zoom=h,this._setZoomTransform(G,J.getCenter(),J.getZoom()),f(G.el.offsetWidth),this._onCreateLevel(G)),this._level=G,G}},_onUpdateLevel:f,_onRemoveLevel:f,_onCreateLevel:f,_pruneTiles:function(){if(this._map){var h,k,P=this._map.getZoom();if(P>this.options.maxZoom||P<this.options.minZoom){this._removeAllTiles();return}for(h in this._tiles)k=this._tiles[h],k.retain=k.current;for(h in this._tiles)if(k=this._tiles[h],k.current&&!k.active){var G=k.coords;this._retainParent(G.x,G.y,G.z,G.z-5)||this._retainChildren(G.x,G.y,G.z,G.z+2)}for(h in this._tiles)this._tiles[h].retain||this._removeTile(h)}},_removeTilesAtZoom:function(h){for(var k in this._tiles)this._tiles[k].coords.z===h&&this._removeTile(k)},_removeAllTiles:function(){for(var h in this._tiles)this._removeTile(h)},_invalidateAll:function(){for(var h in this._levels)kr(this._levels[h].el),this._onRemoveLevel(Number(h)),delete this._levels[h];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(h,k,P,G){var J=Math.floor(h/2),ue=Math.floor(k/2),Se=P-1,Me=new Q(+J,+ue);Me.z=+Se;var De=this._tileCoordsToKey(Me),Ze=this._tiles[De];return Ze&&Ze.active?(Ze.retain=!0,!0):(Ze&&Ze.loaded&&(Ze.retain=!0),Se>G?this._retainParent(J,ue,Se,G):!1)},_retainChildren:function(h,k,P,G){for(var J=2*h;J<2*h+2;J++)for(var ue=2*k;ue<2*k+2;ue++){var Se=new Q(J,ue);Se.z=P+1;var Me=this._tileCoordsToKey(Se),De=this._tiles[Me];if(De&&De.active){De.retain=!0;continue}else De&&De.loaded&&(De.retain=!0);P+1<G&&this._retainChildren(J,ue,P+1,G)}},_resetView:function(h){var k=h&&(h.pinch||h.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),k,k)},_animateZoom:function(h){this._setView(h.center,h.zoom,!0,h.noUpdate)},_clampZoom:function(h){var k=this.options;return k.minNativeZoom!==void 0&&h<k.minNativeZoom?k.minNativeZoom:k.maxNativeZoom!==void 0&&k.maxNativeZoom<h?k.maxNativeZoom:h},_setView:function(h,k,P,G){var J=Math.round(k);this.options.maxZoom!==void 0&&J>this.options.maxZoom||this.options.minZoom!==void 0&&J<this.options.minZoom?J=void 0:J=this._clampZoom(J);var ue=this.options.updateWhenZooming&&J!==this._tileZoom;(!G||ue)&&(this._tileZoom=J,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),J!==void 0&&this._update(h),P||this._pruneTiles(),this._noPrune=!!P),this._setZoomTransforms(h,k)},_setZoomTransforms:function(h,k){for(var P in this._levels)this._setZoomTransform(this._levels[P],h,k)},_setZoomTransform:function(h,k,P){var G=this._map.getZoomScale(P,h.zoom),J=h.origin.multiplyBy(G).subtract(this._map._getNewPixelOrigin(k,P)).round();lt.any3d?cs(h.el,J,G):Mn(h.el,J)},_resetGrid:function(){var h=this._map,k=h.options.crs,P=this._tileSize=this.getTileSize(),G=this._tileZoom,J=this._map.getPixelWorldBounds(this._tileZoom);J&&(this._globalTileRange=this._pxBoundsToTileRange(J)),this._wrapX=k.wrapLng&&!this.options.noWrap&&[Math.floor(h.project([0,k.wrapLng[0]],G).x/P.x),Math.ceil(h.project([0,k.wrapLng[1]],G).x/P.y)],this._wrapY=k.wrapLat&&!this.options.noWrap&&[Math.floor(h.project([k.wrapLat[0],0],G).y/P.x),Math.ceil(h.project([k.wrapLat[1],0],G).y/P.y)]},_onMoveEnd:function(){!this._map||this._map._animatingZoom||this._update()},_getTiledPixelBounds:function(h){var k=this._map,P=k._animatingZoom?Math.max(k._animateToZoom,k.getZoom()):k.getZoom(),G=k.getZoomScale(P,this._tileZoom),J=k.project(h,this._tileZoom).floor(),ue=k.getSize().divideBy(G*2);return new H(J.subtract(ue),J.add(ue))},_update:function(h){var k=this._map;if(k){var P=this._clampZoom(k.getZoom());if(h===void 0&&(h=k.getCenter()),this._tileZoom!==void 0){var G=this._getTiledPixelBounds(h),J=this._pxBoundsToTileRange(G),ue=J.getCenter(),Se=[],Me=this.options.keepBuffer,De=new H(J.getBottomLeft().subtract([Me,-Me]),J.getTopRight().add([Me,-Me]));if(!(isFinite(J.min.x)&&isFinite(J.min.y)&&isFinite(J.max.x)&&isFinite(J.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var Ze in this._tiles){var xt=this._tiles[Ze].coords;(xt.z!==this._tileZoom||!De.contains(new Q(xt.x,xt.y)))&&(this._tiles[Ze].current=!1)}if(Math.abs(P-this._tileZoom)>1){this._setView(h,P);return}for(var Kt=J.min.y;Kt<=J.max.y;Kt++)for(var dr=J.min.x;dr<=J.max.x;dr++){var Hr=new Q(dr,Kt);if(Hr.z=this._tileZoom,!!this._isValidTile(Hr)){var In=this._tiles[this._tileCoordsToKey(Hr)];In?In.current=!0:Se.push(Hr)}}if(Se.sort(function(ji,ll){return ji.distanceTo(ue)-ll.distanceTo(ue)}),Se.length!==0){this._loading||(this._loading=!0,this.fire("loading"));var Ti=document.createDocumentFragment();for(dr=0;dr<Se.length;dr++)this._addTile(Se[dr],Ti);this._level.el.appendChild(Ti)}}}},_isValidTile:function(h){var k=this._map.options.crs;if(!k.infinite){var P=this._globalTileRange;if(!k.wrapLng&&(h.x<P.min.x||h.x>P.max.x)||!k.wrapLat&&(h.y<P.min.y||h.y>P.max.y))return!1}if(!this.options.bounds)return!0;var G=this._tileCoordsToBounds(h);return de(this.options.bounds).overlaps(G)},_keyToBounds:function(h){return this._tileCoordsToBounds(this._keyToTileCoords(h))},_tileCoordsToNwSe:function(h){var k=this._map,P=this.getTileSize(),G=h.scaleBy(P),J=G.add(P),ue=k.unproject(G,h.z),Se=k.unproject(J,h.z);return[ue,Se]},_tileCoordsToBounds:function(h){var k=this._tileCoordsToNwSe(h),P=new ie(k[0],k[1]);return this.options.noWrap||(P=this._map.wrapLatLngBounds(P)),P},_tileCoordsToKey:function(h){return h.x+":"+h.y+":"+h.z},_keyToTileCoords:function(h){var k=h.split(":"),P=new Q(+k[0],+k[1]);return P.z=+k[2],P},_removeTile:function(h){var k=this._tiles[h];k&&(kr(k.el),delete this._tiles[h],this.fire("tileunload",{tile:k.el,coords:this._keyToTileCoords(h)}))},_initTile:function(h){Ft(h,"leaflet-tile");var k=this.getTileSize();h.style.width=k.x+"px",h.style.height=k.y+"px",h.onselectstart=f,h.onmousemove=f,lt.ielt9&&this.options.opacity<1&&li(h,this.options.opacity)},_addTile:function(h,k){var P=this._getTilePos(h),G=this._tileCoordsToKey(h),J=this.createTile(this._wrapCoords(h),s(this._tileReady,this,h));this._initTile(J),this.createTile.length<2&&$(s(this._tileReady,this,h,null,J)),Mn(J,P),this._tiles[G]={el:J,coords:h,current:!0},k.appendChild(J),this.fire("tileloadstart",{tile:J,coords:h})},_tileReady:function(h,k,P){k&&this.fire("tileerror",{error:k,tile:P,coords:h});var G=this._tileCoordsToKey(h);P=this._tiles[G],P&&(P.loaded=+new Date,this._map._fadeAnimated?(li(P.el,0),Z(this._fadeFrame),this._fadeFrame=$(this._updateOpacity,this)):(P.active=!0,this._pruneTiles()),k||(Ft(P.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:P.el,coords:h})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),lt.ielt9||!this._map._fadeAnimated?$(this._pruneTiles,this):setTimeout(s(this._pruneTiles,this),250)))},_getTilePos:function(h){return h.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(h){var k=new Q(this._wrapX?c(h.x,this._wrapX):h.x,this._wrapY?c(h.y,this._wrapY):h.y);return k.z=h.z,k},_pxBoundsToTileRange:function(h){var k=this.getTileSize();return new H(h.min.unscaleBy(k).floor(),h.max.unscaleBy(k).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var h in this._tiles)if(!this._tiles[h].loaded)return!1;return!0}});function fi(h){return new di(h)}var Ya=di.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(h,k){this._url=h,k=S(this,k),k.detectRetina&&lt.retina&&k.maxZoom>0?(k.tileSize=Math.floor(k.tileSize/2),k.zoomReverse?(k.zoomOffset--,k.minZoom=Math.min(k.maxZoom,k.minZoom+1)):(k.zoomOffset++,k.maxZoom=Math.max(k.minZoom,k.maxZoom-1)),k.minZoom=Math.max(0,k.minZoom)):k.zoomReverse?k.minZoom=Math.min(k.maxZoom,k.minZoom):k.maxZoom=Math.max(k.minZoom,k.maxZoom),typeof k.subdomains=="string"&&(k.subdomains=k.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(h,k){return this._url===h&&k===void 0&&(k=!0),this._url=h,k||this.redraw(),this},createTile:function(h,k){var P=document.createElement("img");return tr(P,"load",s(this._tileOnLoad,this,k,P)),tr(P,"error",s(this._tileOnError,this,k,P)),(this.options.crossOrigin||this.options.crossOrigin==="")&&(P.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),typeof this.options.referrerPolicy=="string"&&(P.referrerPolicy=this.options.referrerPolicy),P.alt="",P.src=this.getTileUrl(h),P},getTileUrl:function(h){var k={r:lt.retina?"@2x":"",s:this._getSubdomain(h),x:h.x,y:h.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var P=this._globalTileRange.max.y-h.y;this.options.tms&&(k.y=P),k["-y"]=P}return _(this._url,i(k,this.options))},_tileOnLoad:function(h,k){lt.ielt9?setTimeout(s(h,this,null,k),0):h(null,k)},_tileOnError:function(h,k,P){var G=this.options.errorTileUrl;G&&k.getAttribute("src")!==G&&(k.src=G),h(P,k)},_onTileRemove:function(h){h.tile.onload=null},_getZoomForUrl:function(){var h=this._tileZoom,k=this.options.maxZoom,P=this.options.zoomReverse,G=this.options.zoomOffset;return P&&(h=k-h),h+G},_getSubdomain:function(h){var k=Math.abs(h.x+h.y)%this.options.subdomains.length;return this.options.subdomains[k]},_abortLoading:function(){var h,k;for(h in this._tiles)if(this._tiles[h].coords.z!==this._tileZoom&&(k=this._tiles[h].el,k.onload=f,k.onerror=f,!k.complete)){k.src=A;var P=this._tiles[h].coords;kr(k),delete this._tiles[h],this.fire("tileabort",{tile:k,coords:P})}},_removeTile:function(h){var k=this._tiles[h];if(k)return k.el.setAttribute("src",A),di.prototype._removeTile.call(this,h)},_tileReady:function(h,k,P){if(!(!this._map||P&&P.getAttribute("src")===A))return di.prototype._tileReady.call(this,h,k,P)}});function Gu(h,k){return new Ya(h,k)}var sl=Ya.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(h,k){this._url=h;var P=i({},this.defaultWmsParams);for(var G in k)G in this.options||(P[G]=k[G]);k=S(this,k);var J=k.detectRetina&&lt.retina?2:1,ue=this.getTileSize();P.width=ue.x*J,P.height=ue.y*J,this.wmsParams=P},onAdd:function(h){this._crs=this.options.crs||h.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var k=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[k]=this._crs.code,Ya.prototype.onAdd.call(this,h)},getTileUrl:function(h){var k=this._tileCoordsToNwSe(h),P=this._crs,G=te(P.project(k[0]),P.project(k[1])),J=G.min,ue=G.max,Se=(this._wmsVersion>=1.3&&this._crs===Oc?[J.y,J.x,ue.y,ue.x]:[J.x,J.y,ue.x,ue.y]).join(","),Me=Ya.prototype.getTileUrl.call(this,h);return Me+w(this.wmsParams,Me,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+Se},setParams:function(h,k){return i(this.wmsParams,h),k||this.redraw(),this}});function Ef(h,k){return new sl(h,k)}Ya.WMS=sl,Gu.wms=Ef;var ms=qa.extend({options:{padding:.1},initialize:function(h){S(this,h),l(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),Ft(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var h={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(h.zoomanim=this._onAnimZoom),h},_onAnimZoom:function(h){this._updateTransform(h.center,h.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(h,k){var P=this._map.getZoomScale(k,this._zoom),G=this._map.getSize().multiplyBy(.5+this.options.padding),J=this._map.project(this._center,k),ue=G.multiplyBy(-P).add(J).subtract(this._map._getNewPixelOrigin(h,k));lt.any3d?cs(this._container,ue,P):Mn(this._container,ue)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var h in this._layers)this._layers[h]._reset()},_onZoomEnd:function(){for(var h in this._layers)this._layers[h]._project()},_updatePaths:function(){for(var h in this._layers)this._layers[h]._update()},_update:function(){var h=this.options.padding,k=this._map.getSize(),P=this._map.containerPointToLayerPoint(k.multiplyBy(-h)).round();this._bounds=new H(P,P.add(k.multiplyBy(1+h*2)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),Fc=ms.extend({options:{tolerance:0},getEvents:function(){var h=ms.prototype.getEvents.call(this);return h.viewprereset=this._onViewPreReset,h},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){ms.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var h=this._container=document.createElement("canvas");tr(h,"mousemove",this._onMouseMove,this),tr(h,"click dblclick mousedown mouseup contextmenu",this._onClick,this),tr(h,"mouseout",this._handleMouseOut,this),h._leaflet_disable_events=!0,this._ctx=h.getContext("2d")},_destroyContainer:function(){Z(this._redrawRequest),delete this._ctx,kr(this._container),Gr(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){var h;this._redrawBounds=null;for(var k in this._layers)h=this._layers[k],h._update();this._redraw()}},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){ms.prototype._update.call(this);var h=this._bounds,k=this._container,P=h.getSize(),G=lt.retina?2:1;Mn(k,h.min),k.width=G*P.x,k.height=G*P.y,k.style.width=P.x+"px",k.style.height=P.y+"px",lt.retina&&this._ctx.scale(2,2),this._ctx.translate(-h.min.x,-h.min.y),this.fire("update")}},_reset:function(){ms.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(h){this._updateDashArray(h),this._layers[l(h)]=h;var k=h._order={layer:h,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=k),this._drawLast=k,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(h){this._requestRedraw(h)},_removePath:function(h){var k=h._order,P=k.next,G=k.prev;P?P.prev=G:this._drawLast=G,G?G.next=P:this._drawFirst=P,delete h._order,delete this._layers[l(h)],this._requestRedraw(h)},_updatePath:function(h){this._extendRedrawBounds(h),h._project(),h._update(),this._requestRedraw(h)},_updateStyle:function(h){this._updateDashArray(h),this._requestRedraw(h)},_updateDashArray:function(h){if(typeof h.options.dashArray=="string"){var k=h.options.dashArray.split(/[, ]+/),P=[],G,J;for(J=0;J<k.length;J++){if(G=Number(k[J]),isNaN(G))return;P.push(G)}h.options._dashArray=P}else h.options._dashArray=h.options.dashArray},_requestRedraw:function(h){this._map&&(this._extendRedrawBounds(h),this._redrawRequest=this._redrawRequest||$(this._redraw,this))},_extendRedrawBounds:function(h){if(h._pxBounds){var k=(h.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new H,this._redrawBounds.extend(h._pxBounds.min.subtract([k,k])),this._redrawBounds.extend(h._pxBounds.max.add([k,k]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var h=this._redrawBounds;if(h){var k=h.getSize();this._ctx.clearRect(h.min.x,h.min.y,k.x,k.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var h,k=this._redrawBounds;if(this._ctx.save(),k){var P=k.getSize();this._ctx.beginPath(),this._ctx.rect(k.min.x,k.min.y,P.x,P.y),this._ctx.clip()}this._drawing=!0;for(var G=this._drawFirst;G;G=G.next)h=G.layer,(!k||h._pxBounds&&h._pxBounds.intersects(k))&&h._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(h,k){if(this._drawing){var P,G,J,ue,Se=h._parts,Me=Se.length,De=this._ctx;if(Me){for(De.beginPath(),P=0;P<Me;P++){for(G=0,J=Se[P].length;G<J;G++)ue=Se[P][G],De[G?"lineTo":"moveTo"](ue.x,ue.y);k&&De.closePath()}this._fillStroke(De,h)}}},_updateCircle:function(h){if(!(!this._drawing||h._empty())){var k=h._point,P=this._ctx,G=Math.max(Math.round(h._radius),1),J=(Math.max(Math.round(h._radiusY),1)||G)/G;J!==1&&(P.save(),P.scale(1,J)),P.beginPath(),P.arc(k.x,k.y/J,G,0,Math.PI*2,!1),J!==1&&P.restore(),this._fillStroke(P,h)}},_fillStroke:function(h,k){var P=k.options;P.fill&&(h.globalAlpha=P.fillOpacity,h.fillStyle=P.fillColor||P.color,h.fill(P.fillRule||"evenodd")),P.stroke&&P.weight!==0&&(h.setLineDash&&h.setLineDash(k.options&&k.options._dashArray||[]),h.globalAlpha=P.opacity,h.lineWidth=P.weight,h.strokeStyle=P.color,h.lineCap=P.lineCap,h.lineJoin=P.lineJoin,h.stroke())},_onClick:function(h){for(var k=this._map.mouseEventToLayerPoint(h),P,G,J=this._drawFirst;J;J=J.next)P=J.layer,P.options.interactive&&P._containsPoint(k)&&(!(h.type==="click"||h.type==="preclick")||!this._map._draggableMoved(P))&&(G=P);this._fireEvent(G?[G]:!1,h)},_onMouseMove:function(h){if(!(!this._map||this._map.dragging.moving()||this._map._animatingZoom)){var k=this._map.mouseEventToLayerPoint(h);this._handleMouseHover(h,k)}},_handleMouseOut:function(h){var k=this._hoveredLayer;k&&(Lr(this._container,"leaflet-interactive"),this._fireEvent([k],h,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(h,k){if(!this._mouseHoverThrottled){for(var P,G,J=this._drawFirst;J;J=J.next)P=J.layer,P.options.interactive&&P._containsPoint(k)&&(G=P);G!==this._hoveredLayer&&(this._handleMouseOut(h),G&&(Ft(this._container,"leaflet-interactive"),this._fireEvent([G],h,"mouseover"),this._hoveredLayer=G)),this._fireEvent(this._hoveredLayer?[this._hoveredLayer]:!1,h),this._mouseHoverThrottled=!0,setTimeout(s(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(h,k,P){this._map._fireDOMEvent(k,P||k.type,h)},_bringToFront:function(h){var k=h._order;if(k){var P=k.next,G=k.prev;if(P)P.prev=G;else return;G?G.next=P:P&&(this._drawFirst=P),k.prev=this._drawLast,this._drawLast.next=k,k.next=null,this._drawLast=k,this._requestRedraw(h)}},_bringToBack:function(h){var k=h._order;if(k){var P=k.next,G=k.prev;if(G)G.next=P;else return;P?P.prev=G:G&&(this._drawLast=G),k.prev=null,k.next=this._drawFirst,this._drawFirst.prev=k,this._drawFirst=k,this._requestRedraw(h)}}});function Bc(h){return lt.canvas?new Fc(h):null}var ol=(function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(h){return document.createElement("<lvml:"+h+' class="lvml">')}}catch{}return function(h){return document.createElement("<"+h+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}})(),Tf={_initContainer:function(){this._container=ht("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(ms.prototype._update.call(this),this.fire("update"))},_initPath:function(h){var k=h._container=ol("shape");Ft(k,"leaflet-vml-shape "+(this.options.className||"")),k.coordsize="1 1",h._path=ol("path"),k.appendChild(h._path),this._updateStyle(h),this._layers[l(h)]=h},_addPath:function(h){var k=h._container;this._container.appendChild(k),h.options.interactive&&h.addInteractiveTarget(k)},_removePath:function(h){var k=h._container;kr(k),h.removeInteractiveTarget(k),delete this._layers[l(h)]},_updateStyle:function(h){var k=h._stroke,P=h._fill,G=h.options,J=h._container;J.stroked=!!G.stroke,J.filled=!!G.fill,G.stroke?(k||(k=h._stroke=ol("stroke")),J.appendChild(k),k.weight=G.weight+"px",k.color=G.color,k.opacity=G.opacity,G.dashArray?k.dashStyle=C(G.dashArray)?G.dashArray.join(" "):G.dashArray.replace(/( *, *)/g," "):k.dashStyle="",k.endcap=G.lineCap.replace("butt","flat"),k.joinstyle=G.lineJoin):k&&(J.removeChild(k),h._stroke=null),G.fill?(P||(P=h._fill=ol("fill")),J.appendChild(P),P.color=G.fillColor||G.color,P.opacity=G.fillOpacity):P&&(J.removeChild(P),h._fill=null)},_updateCircle:function(h){var k=h._point.round(),P=Math.round(h._radius),G=Math.round(h._radiusY||P);this._setPath(h,h._empty()?"M0 0":"AL "+k.x+","+k.y+" "+P+","+G+" 0,"+65535*360)},_setPath:function(h,k){h._path.v=k},_bringToFront:function(h){Qr(h._container)},_bringToBack:function(h){Ur(h._container)}},Xa=lt.vml?ol:qe,ko=ms.extend({_initContainer:function(){this._container=Xa("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=Xa("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){kr(this._container),Gr(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){ms.prototype._update.call(this);var h=this._bounds,k=h.getSize(),P=this._container;(!this._svgSize||!this._svgSize.equals(k))&&(this._svgSize=k,P.setAttribute("width",k.x),P.setAttribute("height",k.y)),Mn(P,h.min),P.setAttribute("viewBox",[h.min.x,h.min.y,k.x,k.y].join(" ")),this.fire("update")}},_initPath:function(h){var k=h._path=Xa("path");h.options.className&&Ft(k,h.options.className),h.options.interactive&&Ft(k,"leaflet-interactive"),this._updateStyle(h),this._layers[l(h)]=h},_addPath:function(h){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(h._path),h.addInteractiveTarget(h._path)},_removePath:function(h){kr(h._path),h.removeInteractiveTarget(h._path),delete this._layers[l(h)]},_updatePath:function(h){h._project(),h._update()},_updateStyle:function(h){var k=h._path,P=h.options;k&&(P.stroke?(k.setAttribute("stroke",P.color),k.setAttribute("stroke-opacity",P.opacity),k.setAttribute("stroke-width",P.weight),k.setAttribute("stroke-linecap",P.lineCap),k.setAttribute("stroke-linejoin",P.lineJoin),P.dashArray?k.setAttribute("stroke-dasharray",P.dashArray):k.removeAttribute("stroke-dasharray"),P.dashOffset?k.setAttribute("stroke-dashoffset",P.dashOffset):k.removeAttribute("stroke-dashoffset")):k.setAttribute("stroke","none"),P.fill?(k.setAttribute("fill",P.fillColor||P.color),k.setAttribute("fill-opacity",P.fillOpacity),k.setAttribute("fill-rule",P.fillRule||"evenodd")):k.setAttribute("fill","none"))},_updatePoly:function(h,k){this._setPath(h,wt(h._parts,k))},_updateCircle:function(h){var k=h._point,P=Math.max(Math.round(h._radius),1),G=Math.max(Math.round(h._radiusY),1)||P,J="a"+P+","+G+" 0 1,0 ",ue=h._empty()?"M0 0":"M"+(k.x-P)+","+k.y+J+P*2+",0 "+J+-P*2+",0 ";this._setPath(h,ue)},_setPath:function(h,k){h._path.setAttribute("d",k)},_bringToFront:function(h){Qr(h._path)},_bringToBack:function(h){Ur(h._path)}});lt.vml&&ko.include(Tf);function _o(h){return lt.svg||lt.vml?new ko(h):null}br.include({getRenderer:function(h){var k=h.options.renderer||this._getPaneRenderer(h.options.pane)||this.options.renderer||this._renderer;return k||(k=this._renderer=this._createRenderer()),this.hasLayer(k)||this.addLayer(k),k},_getPaneRenderer:function(h){if(h==="overlayPane"||h===void 0)return!1;var k=this._paneRenderers[h];return k===void 0&&(k=this._createRenderer({pane:h}),this._paneRenderers[h]=k),k},_createRenderer:function(h){return this.options.preferCanvas&&Bc(h)||_o(h)}});var Nf=_a.extend({initialize:function(h,k){_a.prototype.initialize.call(this,this._boundsToLatLngs(h),k)},setBounds:function(h){return this.setLatLngs(this._boundsToLatLngs(h))},_boundsToLatLngs:function(h){return h=de(h),[h.getSouthWest(),h.getNorthWest(),h.getNorthEast(),h.getSouthEast()]}});function zc(h,k){return new Nf(h,k)}ko.create=Xa,ko.pointsToPath=wt,Zi.geometryToLayer=ps,Zi.coordsToLatLng=$l,Zi.coordsToLatLngs=Rs,Zi.latLngToCoords=zu,Zi.latLngsToCoords=Kl,Zi.getFeature=jr,Zi.asFeature=il,br.mergeOptions({boxZoom:!0});var ro=$i.extend({initialize:function(h){this._map=h,this._container=h._container,this._pane=h._panes.overlayPane,this._resetStateTimeout=0,h.on("unload",this._destroy,this)},addHooks:function(){tr(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){Gr(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){kr(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){this._resetStateTimeout!==0&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(h){if(!h.shiftKey||h.which!==1&&h.button!==1)return!1;this._clearDeferredResetState(),this._resetState(),mr(),Tc(),this._startPoint=this._map.mouseEventToContainerPoint(h),tr(document,{contextmenu:Ln,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(h){this._moved||(this._moved=!0,this._box=ht("div","leaflet-zoom-box",this._container),Ft(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(h);var k=new H(this._point,this._startPoint),P=k.getSize();Mn(this._box,k.min),this._box.style.width=P.x+"px",this._box.style.height=P.y+"px"},_finish:function(){this._moved&&(kr(this._box),Lr(this._container,"leaflet-crosshair")),Qs(),Nc(),Gr(document,{contextmenu:Ln,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(h){if(!(h.which!==1&&h.button!==1)&&(this._finish(),!!this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(s(this._resetState,this),0);var k=new ie(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(k).fire("boxzoomend",{boxZoomBounds:k})}},_onKeyDown:function(h){h.keyCode===27&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});br.addInitHook("addHandler","boxZoom",ro),br.mergeOptions({doubleClickZoom:!0});var Pf=$i.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(h){var k=this._map,P=k.getZoom(),G=k.options.zoomDelta,J=h.originalEvent.shiftKey?P-G:P+G;k.options.doubleClickZoom==="center"?k.setZoom(J):k.setZoomAround(h.containerPoint,J)}});br.addInitHook("addHandler","doubleClickZoom",Pf),br.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var Vu=$i.extend({addHooks:function(){if(!this._draggable){var h=this._map;this._draggable=new yn(h._mapPane,h._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),h.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),h.on("zoomend",this._onZoomEnd,this),h.whenReady(this._onZoomEnd,this))}Ft(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){Lr(this._map._container,"leaflet-grab"),Lr(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var h=this._map;if(h._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var k=de(this._map.options.maxBounds);this._offsetLimit=te(this._map.latLngToContainerPoint(k.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(k.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;h.fire("movestart").fire("dragstart"),h.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(h){if(this._map.options.inertia){var k=this._lastTime=+new Date,P=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(P),this._times.push(k),this._prunePositions(k)}this._map.fire("move",h).fire("drag",h)},_prunePositions:function(h){for(;this._positions.length>1&&h-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var h=this._map.getSize().divideBy(2),k=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=k.subtract(h).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(h,k){return h-(h-k)*this._viscosity},_onPreDragLimit:function(){if(!(!this._viscosity||!this._offsetLimit)){var h=this._draggable._newPos.subtract(this._draggable._startPos),k=this._offsetLimit;h.x<k.min.x&&(h.x=this._viscousLimit(h.x,k.min.x)),h.y<k.min.y&&(h.y=this._viscousLimit(h.y,k.min.y)),h.x>k.max.x&&(h.x=this._viscousLimit(h.x,k.max.x)),h.y>k.max.y&&(h.y=this._viscousLimit(h.y,k.max.y)),this._draggable._newPos=this._draggable._startPos.add(h)}},_onPreDragWrap:function(){var h=this._worldWidth,k=Math.round(h/2),P=this._initialWorldOffset,G=this._draggable._newPos.x,J=(G-k+P)%h+k-P,ue=(G+k+P)%h-k-P,Se=Math.abs(J+P)<Math.abs(ue+P)?J:ue;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=Se},_onDragEnd:function(h){var k=this._map,P=k.options,G=!P.inertia||h.noInertia||this._times.length<2;if(k.fire("dragend",h),G)k.fire("moveend");else{this._prunePositions(+new Date);var J=this._lastPos.subtract(this._positions[0]),ue=(this._lastTime-this._times[0])/1e3,Se=P.easeLinearity,Me=J.multiplyBy(Se/ue),De=Me.distanceTo([0,0]),Ze=Math.min(P.inertiaMaxSpeed,De),xt=Me.multiplyBy(Ze/De),Kt=Ze/(P.inertiaDeceleration*Se),dr=xt.multiplyBy(-Kt/2).round();!dr.x&&!dr.y?k.fire("moveend"):(dr=k._limitOffset(dr,k.options.maxBounds),$(function(){k.panBy(dr,{duration:Kt,easeLinearity:Se,noMoveStart:!0,animate:!0})}))}}});br.addInitHook("addHandler","dragging",Vu),br.mergeOptions({keyboard:!0,keyboardPanDelta:80});var Uc=$i.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(h){this._map=h,this._setPanDelta(h.options.keyboardPanDelta),this._setZoomDelta(h.options.zoomDelta)},addHooks:function(){var h=this._map._container;h.tabIndex<=0&&(h.tabIndex="0"),tr(h,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),Gr(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var h=document.body,k=document.documentElement,P=h.scrollTop||k.scrollTop,G=h.scrollLeft||k.scrollLeft;this._map._container.focus(),window.scrollTo(G,P)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(h){var k=this._panKeys={},P=this.keyCodes,G,J;for(G=0,J=P.left.length;G<J;G++)k[P.left[G]]=[-1*h,0];for(G=0,J=P.right.length;G<J;G++)k[P.right[G]]=[h,0];for(G=0,J=P.down.length;G<J;G++)k[P.down[G]]=[0,h];for(G=0,J=P.up.length;G<J;G++)k[P.up[G]]=[0,-1*h]},_setZoomDelta:function(h){var k=this._zoomKeys={},P=this.keyCodes,G,J;for(G=0,J=P.zoomIn.length;G<J;G++)k[P.zoomIn[G]]=h;for(G=0,J=P.zoomOut.length;G<J;G++)k[P.zoomOut[G]]=-h},_addHooks:function(){tr(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){Gr(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(h){if(!(h.altKey||h.ctrlKey||h.metaKey)){var k=h.keyCode,P=this._map,G;if(k in this._panKeys){if(!P._panAnim||!P._panAnim._inProgress)if(G=this._panKeys[k],h.shiftKey&&(G=re(G).multiplyBy(3)),P.options.maxBounds&&(G=P._limitOffset(re(G),P.options.maxBounds)),P.options.worldCopyJump){var J=P.wrapLatLng(P.unproject(P.project(P.getCenter()).add(G)));P.panTo(J)}else P.panBy(G)}else if(k in this._zoomKeys)P.setZoom(P.getZoom()+(h.shiftKey?3:1)*this._zoomKeys[k]);else if(k===27&&P._popup&&P._popup.options.closeOnEscapeKey)P.closePopup();else return;Ln(h)}}});br.addInitHook("addHandler","keyboard",Uc),br.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var Vr=$i.extend({addHooks:function(){tr(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){Gr(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(h){var k=Ms(h),P=this._map.options.wheelDebounceTime;this._delta+=k,this._lastMousePos=this._map.mouseEventToContainerPoint(h),this._startTime||(this._startTime=+new Date);var G=Math.max(P-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(s(this._performZoom,this),G),Ln(h)},_performZoom:function(){var h=this._map,k=h.getZoom(),P=this._map.options.zoomSnap||0;h._stop();var G=this._delta/(this._map.options.wheelPxPerZoomLevel*4),J=4*Math.log(2/(1+Math.exp(-Math.abs(G))))/Math.LN2,ue=P?Math.ceil(J/P)*P:J,Se=h._limitZoom(k+(this._delta>0?ue:-ue))-k;this._delta=0,this._startTime=null,Se&&(h.options.scrollWheelZoom==="center"?h.setZoom(k+Se):h.setZoomAround(this._lastMousePos,k+Se))}});br.addInitHook("addHandler","scrollWheelZoom",Vr);var Gc=600;br.mergeOptions({tapHold:lt.touchNative&&lt.safari&&lt.mobile,tapTolerance:15});var Ql=$i.extend({addHooks:function(){tr(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){Gr(this._map._container,"touchstart",this._onDown,this)},_onDown:function(h){if(clearTimeout(this._holdTimeout),h.touches.length===1){var k=h.touches[0];this._startPos=this._newPos=new Q(k.clientX,k.clientY),this._holdTimeout=setTimeout(s(function(){this._cancel(),this._isTapValid()&&(tr(document,"touchend",nn),tr(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",k))},this),Gc),tr(document,"touchend touchcancel contextmenu",this._cancel,this),tr(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function h(){Gr(document,"touchend",nn),Gr(document,"touchend touchcancel",h)},_cancel:function(){clearTimeout(this._holdTimeout),Gr(document,"touchend touchcancel contextmenu",this._cancel,this),Gr(document,"touchmove",this._onMove,this)},_onMove:function(h){var k=h.touches[0];this._newPos=new Q(k.clientX,k.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(h,k){var P=new MouseEvent(h,{bubbles:!0,cancelable:!0,view:window,screenX:k.screenX,screenY:k.screenY,clientX:k.clientX,clientY:k.clientY});P._simulated=!0,k.target.dispatchEvent(P)}});br.addInitHook("addHandler","tapHold",Ql),br.mergeOptions({touchZoom:lt.touch,bounceAtZoomLimits:!0});var Co=$i.extend({addHooks:function(){Ft(this._map._container,"leaflet-touch-zoom"),tr(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){Lr(this._map._container,"leaflet-touch-zoom"),Gr(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(h){var k=this._map;if(!(!h.touches||h.touches.length!==2||k._animatingZoom||this._zooming)){var P=k.mouseEventToContainerPoint(h.touches[0]),G=k.mouseEventToContainerPoint(h.touches[1]);this._centerPoint=k.getSize()._divideBy(2),this._startLatLng=k.containerPointToLatLng(this._centerPoint),k.options.touchZoom!=="center"&&(this._pinchStartLatLng=k.containerPointToLatLng(P.add(G)._divideBy(2))),this._startDist=P.distanceTo(G),this._startZoom=k.getZoom(),this._moved=!1,this._zooming=!0,k._stop(),tr(document,"touchmove",this._onTouchMove,this),tr(document,"touchend touchcancel",this._onTouchEnd,this),nn(h)}},_onTouchMove:function(h){if(!(!h.touches||h.touches.length!==2||!this._zooming)){var k=this._map,P=k.mouseEventToContainerPoint(h.touches[0]),G=k.mouseEventToContainerPoint(h.touches[1]),J=P.distanceTo(G)/this._startDist;if(this._zoom=k.getScaleZoom(J,this._startZoom),!k.options.bounceAtZoomLimits&&(this._zoom<k.getMinZoom()&&J<1||this._zoom>k.getMaxZoom()&&J>1)&&(this._zoom=k._limitZoom(this._zoom)),k.options.touchZoom==="center"){if(this._center=this._startLatLng,J===1)return}else{var ue=P._add(G)._divideBy(2)._subtract(this._centerPoint);if(J===1&&ue.x===0&&ue.y===0)return;this._center=k.unproject(k.project(this._pinchStartLatLng,this._zoom).subtract(ue),this._zoom)}this._moved||(k._moveStart(!0,!1),this._moved=!0),Z(this._animRequest);var Se=s(k._move,k,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=$(Se,this,!0),nn(h)}},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=!1;return}this._zooming=!1,Z(this._animRequest),Gr(document,"touchmove",this._onTouchMove,this),Gr(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))}});br.addInitHook("addHandler","touchZoom",Co),br.BoxZoom=ro,br.DoubleClickZoom=Pf,br.Drag=Vu,br.Keyboard=Uc,br.ScrollWheelZoom=Vr,br.TapHold=Ql,br.TouchZoom=Co,r.Bounds=H,r.Browser=lt,r.CRS=ae,r.Canvas=Fc,r.Circle=nl,r.CircleMarker=Ka,r.Class=q,r.Control=Zn,r.DivIcon=Xl,r.DivOverlay=Xi,r.DomEvent=zl,r.DomUtil=gr,r.Draggable=yn,r.Evented=Y,r.FeatureGroup=Ki,r.GeoJSON=Zi,r.GridLayer=di,r.Handler=$i,r.Icon=ka,r.ImageOverlay=Os,r.LatLng=ge,r.LatLngBounds=ie,r.Layer=qa,r.LayerGroup=Ls,r.LineUtil=el,r.Map=br,r.Marker=Ci,r.Mixin=Fu,r.Path=eo,r.Point=Q,r.PolyUtil=Fh,r.Polygon=_a,r.Polyline=Ei,r.Popup=So,r.PosAnimation=ju,r.Projection=Rc,r.Rectangle=Nf,r.Renderer=ms,r.SVG=ko,r.SVGOverlay=Dn,r.TileLayer=Ya,r.Tooltip=Cn,r.Transformation=he,r.Util=I,r.VideoOverlay=Jr,r.bind=s,r.bounds=te,r.canvas=Bc,r.circle=ql,r.circleMarker=to,r.control=ya,r.divIcon=jc,r.extend=i,r.featureGroup=Sa,r.geoJSON=Ic,r.geoJson=Yi,r.gridLayer=fi,r.icon=Dc,r.imageOverlay=wo,r.latLng=ye,r.latLngBounds=de,r.layerGroup=tl,r.map=ui,r.marker=Cf,r.point=re,r.polygon=Za,r.polyline=Uh,r.popup=Yl,r.rectangle=zc,r.setOptions=S,r.stamp=l,r.svg=_o,r.svgOverlay=Zl,r.tileLayer=Gu,r.tooltip=al,r.transformation=xe,r.version=n,r.videoOverlay=On;var Mf=window.L;r.noConflict=function(){return window.L=Mf,this},window.L=r}))})(Qg,Qg.exports)),Qg.exports}var Wd=tW();const H1=Mh(Wd);function j_(t,e,r){return Object.freeze({instance:t,context:e,container:r})}function iR(t,e){return e==null?function(n,i){const a=se.useRef();return a.current||(a.current=t(n,i)),a}:function(n,i){const a=se.useRef();a.current||(a.current=t(n,i));const s=se.useRef(n),{instance:o}=a.current;return se.useEffect(function(){s.current!==n&&(e(o,n,s.current),s.current=n)},[o,n,i]),a}}function rW(t,e){se.useEffect(function(){return(e.layerContainer??e.map).addLayer(t.instance),function(){e.layerContainer?.removeLayer(t.instance),e.map.removeLayer(t.instance)}},[e,t])}function nW(t){return function(r){const n=I_(),i=t(nR(r,n),n);return QL(n.map,r.attribution),rR(i.current,r.eventHandlers),rW(i.current,n),i}}function aR(t,e){const r=iR(t,e),n=nW(r);return XH(n)}function iW(t,e){const r=iR(t),n=JH(r,e);return QH(n)}function aW(t,e,r){e.bounds instanceof Wd.LatLngBounds&&e.bounds!==r.bounds&&t.setBounds(e.bounds),e.opacity!=null&&e.opacity!==r.opacity&&t.setOpacity(e.opacity),e.zIndex!=null&&e.zIndex!==r.zIndex&&t.setZIndex(e.zIndex)}function sW(){return I_().map}const oW=aR(function({bounds:e,url:r,...n},i){const a=new Wd.ImageOverlay(r,e,n);return j_(a,JL(i,{overlayContainer:a}))},function(e,r,n){if(aW(e,r,n),r.bounds!==n.bounds){const i=r.bounds instanceof Wd.LatLngBounds?r.bounds:new Wd.LatLngBounds(r.bounds);e.setBounds(i)}r.url!==n.url&&e.setUrl(r.url)});function lk(){return lk=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},lk.apply(this,arguments)}function lW({bounds:t,boundsOptions:e,center:r,children:n,className:i,id:a,placeholder:s,style:o,whenReady:l,zoom:u,...c},f){const[p]=se.useState({className:i,id:a,style:o}),[v,y]=se.useState(null);se.useImperativeHandle(f,()=>v?.map??null,[v]);const S=se.useCallback(T=>{if(T!==null&&v===null){const _=new Wd.Map(T,c);r!=null&&u!=null?_.setView(r,u):t!=null&&_.fitBounds(t,e),l!=null&&_.whenReady(l),y(YH(_))}},[]);se.useEffect(()=>()=>{v?.map.remove()},[v]);const w=v?sr.createElement(tR,{value:v},n):s??null;return sr.createElement("div",lk({},p,{ref:S}),w)}const uW=se.forwardRef(lW),cW=aR(function({position:e,...r},n){const i=new Wd.Marker(e,r);return j_(i,JL(n,{overlayContainer:i}))},function(e,r,n){r.position!==n.position&&e.setLatLng(r.position),r.icon!=null&&r.icon!==n.icon&&e.setIcon(r.icon),r.zIndexOffset!=null&&r.zIndexOffset!==n.zIndexOffset&&e.setZIndexOffset(r.zIndexOffset),r.opacity!=null&&r.opacity!==n.opacity&&e.setOpacity(r.opacity),e.dragging!=null&&r.draggable!==n.draggable&&(r.draggable===!0?e.dragging.enable():e.dragging.disable())}),dW=iW(function(e,r){const n=new Wd.Popup(e,r.overlayContainer);return j_(n,r)},function(e,r,{position:n},i){se.useEffect(function(){const{instance:s}=e;function o(u){u.popup===s&&(s.update(),i(!0))}function l(u){u.popup===s&&i(!1)}return r.map.on({popupopen:o,popupclose:l}),r.overlayContainer==null?(n!=null&&s.setLatLng(n),s.openOn(r.map)):r.overlayContainer.bindPopup(s),function(){r.map.off({popupopen:o,popupclose:l}),r.overlayContainer?.unbindPopup(),r.map.removeLayer(s)}},[e,r,i,n])});delete H1.Icon.Default.prototype._getIconUrl;H1.Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png"});const fW=(t="default")=>{const e=`
        <div class="custom-marker-icon marker-${t}">
            <span class="material-symbols-outlined" style="font-size: 18px; color: white;">
                ${hW(t)}
            </span>
        </div>
    `;return H1.divIcon({html:e,className:"custom-leaflet-marker",iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-32]})},hW=t=>{const e={city:"location_city",dungeon:"castle",landmark:"place",battle:"swords",default:"location_on"};return e[t]||e.default},pW=({bounds:t})=>{const e=sW();return sr.useEffect(()=>{t&&e.fitBounds(t)},[e,t]),null},mW=({mapImage:t,markers:e=[],onMarkerClick:r,imageWidth:n=1920,imageHeight:i=1080})=>{const a=se.useMemo(()=>[[0,0],[i,n]],[n,i]),s=se.useMemo(()=>[i/2,n/2],[n,i]),o=e.length>0?e:[];return m.jsxs("div",{className:"w-full h-full relative",children:[m.jsxs(uW,{center:s,zoom:0,minZoom:-2,maxZoom:3,crs:H1.CRS.Simple,style:{height:"100%",width:"100%",background:"#0a0a0c"},zoomControl:!0,attributionControl:!1,children:[t&&m.jsx(oW,{url:t,bounds:a,opacity:1}),m.jsx(pW,{bounds:a}),o.map((l,u)=>{const c=l.position||[i/2,n/2];return m.jsx(cW,{position:c,icon:fW(l.type),eventHandlers:{click:()=>{r&&r(l)}},children:m.jsx(dW,{children:m.jsxs("div",{className:"space-y-2",children:[m.jsx("h3",{className:"text-white font-bold",children:l.label||"Unnamed Location"}),l.description&&m.jsx("p",{className:"text-slate-400 text-sm",children:l.description}),l.entityId&&m.jsxs("a",{href:`#/entity/${l.entityId}`,className:"text-primary hover:underline text-sm inline-flex items-center gap-1",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"open_in_new"}),"View Details"]})]})})},l.id||u)})]}),o.length>0&&m.jsxs("div",{className:"absolute bottom-4 left-4 bg-surface-dark/90 backdrop-blur-xl border border-white/10 rounded-2xl p-4 max-w-xs z-[1000]",children:[m.jsxs("h4",{className:"text-white font-bold text-sm mb-2 flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-primary",children:"map"}),"Locations (",o.length,")"]}),m.jsxs("div",{className:"space-y-1 max-h-40 overflow-y-auto no-scrollbar",children:[o.slice(0,10).map((l,u)=>m.jsxs("div",{className:"text-xs text-slate-400 flex items-center gap-2 hover:text-white cursor-pointer transition-colors",onClick:()=>r&&r(l),children:[m.jsx("span",{className:"w-2 h-2 rounded-full bg-primary"}),l.label||`Location ${u+1}`]},l.id||u)),o.length>10&&m.jsxs("p",{className:"text-xs text-slate-500 italic",children:["+",o.length-10," more..."]})]})]})]})},gW=({map:t})=>{const{t:e}=Sc(),[r,n]=se.useState(null),i=t?.nombre||e("maps.explorer"),a=t?.attributes||{};let s={};if(!a.bgImage&&t?.descripcion&&t?.descripcion.startsWith("{"))try{s=JSON.parse(t.descripcion)}catch{}const o=a.bgImage||s.bgImage||t?.iconUrl||null,l=a.markers||[],u=a.imageWidth||1920,c=a.imageHeight||1080,f=p=>{n(p),console.log("Marker clicked:",p)};return m.jsxs("div",{className:"flex-1 flex overflow-hidden bg-background-dark font-sans text-slate-300 relative",children:[m.jsxs("main",{className:"flex-1 overflow-hidden relative group",children:[m.jsx("div",{className:"absolute inset-4 rounded-[2.5rem] overflow-hidden border border-white/5 shadow-2xl bg-surface-dark",children:o?m.jsx(mW,{mapImage:o,markers:l,onMarkerClick:f,imageWidth:u,imageHeight:c}):m.jsx("div",{className:"w-full h-full flex items-center justify-center text-slate-500",children:m.jsxs("div",{className:"text-center space-y-4",children:[m.jsx("span",{className:"material-symbols-outlined text-6xl opacity-20",children:"map"}),m.jsx("p",{children:e("maps.not_found")}),m.jsx("p",{className:"text-xs text-slate-600",children:e("maps.upload_desc")})]})})}),m.jsx("div",{className:"absolute top-8 left-8 z-[1000]",children:m.jsx(un,{className:"px-6 py-3 border-white/10",children:m.jsxs("h1",{className:"text-2xl font-black text-white tracking-tight flex items-center gap-3",children:[m.jsx("span",{className:"material-symbols-outlined text-primary",children:"public"}),i]})})}),m.jsxs("div",{className:"absolute top-8 right-8 z-[1000] flex gap-3",children:[m.jsx("button",{className:"size-12 rounded-xl bg-surface-dark/90 backdrop-blur-xl border border-white/10 flex items-center justify-center text-slate-400 hover:text-white hover:border-primary/50 transition-all shadow-lg",title:e("maps.fullscreen"),children:m.jsx("span",{className:"material-symbols-outlined",children:"fullscreen"})}),m.jsx("button",{className:"size-12 rounded-xl bg-surface-dark/90 backdrop-blur-xl border border-white/10 flex items-center justify-center text-slate-400 hover:text-white hover:border-primary/50 transition-all shadow-lg",title:e("maps.share"),children:m.jsx("span",{className:"material-symbols-outlined",children:"share"})})]})]}),m.jsx("aside",{className:`flex-none bg-surface-dark border-l border-white/5 transition-all duration-700 relative z-30 ${r?"w-96 p-8 opacity-100":"w-0 p-0 opacity-0 overflow-hidden"}`,children:r&&m.jsxs("div",{className:"flex flex-col h-full gap-8 animate-in slide-in-from-right-8 duration-500",children:[m.jsxs("header",{className:"space-y-6",children:[m.jsxs("div",{className:"relative aspect-[4/3] rounded-3xl overflow-hidden border border-white/10 shadow-xl group",children:[m.jsx("img",{src:"https://images.unsplash.com/photo-1533154683836-84ea7a0bc310?auto=format&fit=crop&w=500&q=80",alt:"Detail",className:"w-full h-full object-cover grayscale-[0.4] group-hover:grayscale-0 transition-all duration-700"}),m.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-background-dark via-transparent to-transparent"}),m.jsx("div",{className:"absolute top-4 right-4 flex gap-2",children:m.jsx("button",{onClick:()=>n(null),className:"size-8 rounded-lg bg-black/40 border border-white/10 backdrop-blur-md text-white flex items-center justify-center hover:bg-black/60 transition-colors",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"close"})})}),m.jsxs("div",{className:"absolute bottom-4 left-4 flex gap-2",children:[m.jsx("span",{className:"px-3 py-1 rounded bg-primary/20 text-primary border border-primary/20 text-[8px] font-black uppercase tracking-widest backdrop-blur-md",children:e("maps.place")}),m.jsx("span",{className:"px-3 py-1 rounded bg-emerald-500/20 text-emerald-400 border border-emerald-500/20 text-[8px] font-black uppercase tracking-widest backdrop-blur-md",children:e("maps.capital")})]})]}),m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{className:"flex justify-between items-start",children:[m.jsx("h2",{className:"text-3xl font-manrope font-black text-white tracking-tight leading-none",children:r.label||r.name}),m.jsx("button",{className:"text-slate-500 hover:text-white transition-colors p-2 rounded-xl hover:bg-white/5",children:m.jsx("span",{className:"material-symbols-outlined",children:"edit"})})]}),m.jsx("p",{className:"text-sm text-slate-400 leading-relaxed font-manrope",children:r.description||"No description available"})]})]}),m.jsxs("div",{className:"space-y-8 flex-1 overflow-y-auto no-scrollbar",children:[m.jsxs("section",{className:"space-y-4",children:[m.jsxs("div",{className:"flex justify-between items-center px-1",children:[m.jsx("h3",{className:"text-[10px] font-black uppercase tracking-[0.2em] text-slate-500",children:e("maps.inhabitants")}),m.jsx("button",{className:"text-[10px] font-bold text-primary hover:underline transition-all",children:e("maps.view_all")})]}),m.jsxs("div",{className:"space-y-3",children:[m.jsx(B4,{name:"Lyra Ignis",role:"Gran Maga"}),m.jsx(B4,{name:"Kaelen",role:"Capitn de la Guardia"})]})]}),m.jsxs("section",{className:"space-y-4",children:[m.jsx("h3",{className:"text-[10px] font-black uppercase tracking-[0.2em] text-slate-500 px-1",children:e("maps.related_events")}),m.jsx(un,{className:"p-4 border-white/5 hover:border-white/10 transition-all cursor-pointer group",children:m.jsxs("div",{className:"flex gap-4 items-center",children:[m.jsx("div",{className:"size-10 rounded-xl bg-amber-500/10 text-amber-500 border border-amber-500/20 flex items-center justify-center",children:m.jsx("span",{className:"material-symbols-outlined text-xl",children:"history_edu"})}),m.jsxs("div",{children:[m.jsx("h4",{className:"text-xs font-bold text-white group-hover:text-primary transition-colors",children:"El Asedio de Ceniza"}),m.jsx("p",{className:"text-[10px] text-slate-500 font-medium",children:"Hace 300 aos"})]})]})})]})]}),m.jsx("footer",{className:"pt-6 border-t border-white/5",children:m.jsx(mn,{variant:"primary",icon:"auto_stories",className:"w-full py-4 rounded-2xl shadow-xl shadow-primary/20",children:e("maps.open_bible")})})]})})]})},B4=({name:t,role:e})=>m.jsxs("div",{className:"flex items-center gap-4 p-3 rounded-2xl bg-white/[0.02] border border-white/5 hover:border-white/10 transition-all cursor-pointer group",children:[m.jsx(ox,{name:t,size:"sm",className:"border-white/10 group-hover:border-primary/50 transition-all"}),m.jsxs("div",{className:"flex-1 min-w-0",children:[m.jsx("h4",{className:"text-xs font-bold text-white truncate",children:t}),m.jsx("p",{className:"text-[10px] text-slate-500 font-medium truncate",children:e})]}),m.jsx("span",{className:"material-symbols-outlined text-slate-700 text-sm group-hover:text-white transition-colors",children:"chevron_right"})]}),vW=({maps:t,onSelect:e,onCreateNew:r,onClose:n})=>m.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-background-dark/80 backdrop-blur-xl animate-in fade-in duration-300",children:m.jsx("div",{className:"w-full max-w-3xl animate-in zoom-in-95 duration-500",children:m.jsxs(un,{className:"overflow-hidden border-white/10 shadow-2xl",children:[m.jsxs("header",{className:"p-6 border-b border-white/5 flex justify-between items-center bg-white/[0.02]",children:[m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsx("span",{className:"material-symbols-outlined text-primary",children:"map"}),m.jsx("h2",{className:"text-xl font-manrope font-black text-white",children:"Cartografa del Proyecto"})]}),m.jsx("button",{onClick:n,className:"text-slate-500 hover:text-white transition-colors",children:m.jsx("span",{className:"material-symbols-outlined",children:"close"})})]}),m.jsxs("div",{className:"p-8 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 max-h-[60vh] overflow-y-auto custom-scrollbar",children:[m.jsxs("div",{onClick:r,className:"group p-6 rounded-2xl border-2 border-dashed border-white/5 hover:border-primary/50 hover:bg-primary/5 transition-all cursor-pointer flex flex-col items-center justify-center text-center gap-3",children:[m.jsx("div",{className:"size-12 rounded-full bg-primary/10 text-primary flex items-center justify-center group-hover:scale-110 transition-transform",children:m.jsx("span",{className:"material-symbols-outlined",children:"add"})}),m.jsxs("div",{children:[m.jsx("h3",{className:"text-sm font-bold text-white",children:"Nuevo Mapa"}),m.jsx("p",{className:"text-[10px] text-slate-500 uppercase font-black tracking-tighter",children:"Crear desde cero"})]})]}),t.map(i=>{const a=i.attributes?.snapshotUrl||i.attributes?.bgImage||i.iconUrl;return m.jsxs("div",{onClick:()=>e(i),className:"group p-4 rounded-2xl bg-white/5 border border-white/5 hover:border-primary/50 hover:bg-white/10 transition-all cursor-pointer space-y-3",children:[m.jsx("div",{className:"aspect-video rounded-xl bg-surface-light border border-white/5 flex items-center justify-center overflow-hidden",children:a?m.jsx("img",{src:a,alt:i.nombre,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"}):m.jsx("span",{className:"material-symbols-outlined text-4xl opacity-20 group-hover:opacity-40 transition-opacity",children:"image"})}),m.jsxs("div",{children:[m.jsx("h3",{className:"text-sm font-bold text-white truncate",children:i.nombre}),m.jsxs("p",{className:"text-[10px] text-slate-500 uppercase font-black tracking-tighter",children:[i.attributes?.layers?.length||0," capas"]})]})]},i.id)})]}),m.jsx("footer",{className:"p-6 bg-white/[0.02] border-t border-white/5 flex justify-end",children:m.jsx("p",{className:"text-[10px] text-slate-600 font-bold uppercase tracking-widest",children:"Selecciona un mapa para cargar el visor"})})]})})}),yW=()=>{const{username:t,projectName:e}=Vi(),r=za(),[n,i]=se.useState("viewer"),[a,s]=se.useState([]),[o,l]=se.useState(null),[u,c]=se.useState(!1),[f,p]=se.useState(null);sr.useEffect(()=>{v()},[]);const v=async()=>{try{const w=(await Qe.get("/world-bible/entities")).filter(T=>T.tipoEspecial==="map");s(w),w.length>0&&!o&&l(w[0])}catch(S){console.error("Error loading maps",S)}},y=async(S,w,T)=>{try{const _=await Qe.get("/world-bible/folders"),C=_.find(A=>A.nombre.toLowerCase().includes("map"))||_[0];if(!C){console.error("No folders available to create map");return}const N=await Qe.post("/world-bible/entities",{nombre:w,carpetaId:C.id,tipoEspecial:"map",categoria:"Location",descripcion:"",iconUrl:"",attributes:{mapType:"regional",layers:[]}});p(N.id),i("wizard"),c(!1),await v(),setTimeout(()=>{i("editor")},100)}catch(_){console.error("Error creating map:",_)}};return m.jsxs("div",{className:"flex-1 flex flex-col h-full bg-background-dark overflow-hidden",children:[n==="viewer"&&m.jsxs("div",{className:"flex-1 flex flex-col h-full relative",children:[m.jsx("button",{onClick:()=>c(!0),className:"absolute right-12 bottom-12 z-50 size-16 rounded-3xl bg-primary text-white flex items-center justify-center shadow-2xl shadow-primary/40 hover:scale-110 active:scale-95 transition-all group",children:m.jsx("span",{className:"material-symbols-outlined text-3xl group-hover:rotate-90 transition-transform duration-300",children:"add"})}),m.jsx(gW,{map:o}),u&&m.jsx(vW,{maps:a,onSelect:S=>{l(S),c(!1)},onCreateNew:()=>{c(!1),i("wizard")},onClose:()=>c(!1)})]}),n==="wizard"&&m.jsx(XG,{onCancel:()=>i("viewer"),onCreate:y}),n==="editor"&&m.jsx(ok,{mode:f?"create":"edit",entityId:f,onBack:()=>{i("viewer"),p(null)},onSave:async()=>{await v(),f?r(`/local/${e}/entity/${f}`):i("viewer"),p(null)}})]})};String.prototype.codePointAt||(function(){var t=(function(){try{var r={},n=Object.defineProperty,i=n(r,r,r)&&n}catch{}return i})(),e=function(r){if(this==null)throw TypeError();var n=String(this),i=n.length,a=r?Number(r):0;if(a!=a&&(a=0),!(a<0||a>=i)){var s=n.charCodeAt(a),o;return s>=55296&&s<=56319&&i>a+1&&(o=n.charCodeAt(a+1),o>=56320&&o<=57343)?(s-55296)*1024+o-56320+65536:s}};t?t(String.prototype,"codePointAt",{value:e,configurable:!0,writable:!0}):String.prototype.codePointAt=e})();var F_=0,sR=-3;function Rv(){this.table=new Uint16Array(16),this.trans=new Uint16Array(288)}function xW(t,e){this.source=t,this.sourceIndex=0,this.tag=0,this.bitcount=0,this.dest=e,this.destLen=0,this.ltree=new Rv,this.dtree=new Rv}var oR=new Rv,lR=new Rv,B_=new Uint8Array(30),z_=new Uint16Array(30),uR=new Uint8Array(30),cR=new Uint16Array(30),bW=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),z4=new Rv,hu=new Uint8Array(320);function dR(t,e,r,n){var i,a;for(i=0;i<r;++i)t[i]=0;for(i=0;i<30-r;++i)t[i+r]=i/r|0;for(a=n,i=0;i<30;++i)e[i]=a,a+=1<<t[i]}function wW(t,e){var r;for(r=0;r<7;++r)t.table[r]=0;for(t.table[7]=24,t.table[8]=152,t.table[9]=112,r=0;r<24;++r)t.trans[r]=256+r;for(r=0;r<144;++r)t.trans[24+r]=r;for(r=0;r<8;++r)t.trans[168+r]=280+r;for(r=0;r<112;++r)t.trans[176+r]=144+r;for(r=0;r<5;++r)e.table[r]=0;for(e.table[5]=32,r=0;r<32;++r)e.trans[r]=r}var U4=new Uint16Array(16);function G2(t,e,r,n){var i,a;for(i=0;i<16;++i)t.table[i]=0;for(i=0;i<n;++i)t.table[e[r+i]]++;for(t.table[0]=0,a=0,i=0;i<16;++i)U4[i]=a,a+=t.table[i];for(i=0;i<n;++i)e[r+i]&&(t.trans[U4[e[r+i]]++]=i)}function SW(t){t.bitcount--||(t.tag=t.source[t.sourceIndex++],t.bitcount=7);var e=t.tag&1;return t.tag>>>=1,e}function yu(t,e,r){if(!e)return r;for(;t.bitcount<24;)t.tag|=t.source[t.sourceIndex++]<<t.bitcount,t.bitcount+=8;var n=t.tag&65535>>>16-e;return t.tag>>>=e,t.bitcount-=e,n+r}function uk(t,e){for(;t.bitcount<24;)t.tag|=t.source[t.sourceIndex++]<<t.bitcount,t.bitcount+=8;var r=0,n=0,i=0,a=t.tag;do n=2*n+(a&1),a>>>=1,++i,r+=e.table[i],n-=e.table[i];while(n>=0);return t.tag=a,t.bitcount-=i,e.trans[r+n]}function kW(t,e,r){var n,i,a,s,o,l;for(n=yu(t,5,257),i=yu(t,5,1),a=yu(t,4,4),s=0;s<19;++s)hu[s]=0;for(s=0;s<a;++s){var u=yu(t,3,0);hu[bW[s]]=u}for(G2(z4,hu,0,19),o=0;o<n+i;){var c=uk(t,z4);switch(c){case 16:var f=hu[o-1];for(l=yu(t,2,3);l;--l)hu[o++]=f;break;case 17:for(l=yu(t,3,3);l;--l)hu[o++]=0;break;case 18:for(l=yu(t,7,11);l;--l)hu[o++]=0;break;default:hu[o++]=c;break}}G2(e,hu,0,n),G2(r,hu,n,i)}function G4(t,e,r){for(;;){var n=uk(t,e);if(n===256)return F_;if(n<256)t.dest[t.destLen++]=n;else{var i,a,s,o;for(n-=257,i=yu(t,B_[n],z_[n]),a=uk(t,r),s=t.destLen-yu(t,uR[a],cR[a]),o=s;o<s+i;++o)t.dest[t.destLen++]=t.dest[o]}}}function _W(t){for(var e,r,n;t.bitcount>8;)t.sourceIndex--,t.bitcount-=8;if(e=t.source[t.sourceIndex+1],e=256*e+t.source[t.sourceIndex],r=t.source[t.sourceIndex+3],r=256*r+t.source[t.sourceIndex+2],e!==(~r&65535))return sR;for(t.sourceIndex+=4,n=e;n;--n)t.dest[t.destLen++]=t.source[t.sourceIndex++];return t.bitcount=0,F_}function CW(t,e){var r=new xW(t,e),n,i,a;do{switch(n=SW(r),i=yu(r,2,0),i){case 0:a=_W(r);break;case 1:a=G4(r,oR,lR);break;case 2:kW(r,r.ltree,r.dtree),a=G4(r,r.ltree,r.dtree);break;default:a=sR}if(a!==F_)throw new Error("Data error")}while(!n);return r.destLen<r.dest.length?typeof r.dest.slice=="function"?r.dest.slice(0,r.destLen):r.dest.subarray(0,r.destLen):r.dest}wW(oR,lR);dR(B_,z_,4,3);dR(uR,cR,2,1);B_[28]=0;z_[28]=258;var EW=CW;function Cp(t,e,r,n,i){return Math.pow(1-i,3)*t+3*Math.pow(1-i,2)*i*e+3*(1-i)*Math.pow(i,2)*r+Math.pow(i,3)*n}function Mu(){this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN}Mu.prototype.isEmpty=function(){return isNaN(this.x1)||isNaN(this.y1)||isNaN(this.x2)||isNaN(this.y2)};Mu.prototype.addPoint=function(t,e){typeof t=="number"&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=t,this.x2=t),t<this.x1&&(this.x1=t),t>this.x2&&(this.x2=t)),typeof e=="number"&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=e,this.y2=e),e<this.y1&&(this.y1=e),e>this.y2&&(this.y2=e))};Mu.prototype.addX=function(t){this.addPoint(t,null)};Mu.prototype.addY=function(t){this.addPoint(null,t)};Mu.prototype.addBezier=function(t,e,r,n,i,a,s,o){var l=[t,e],u=[r,n],c=[i,a],f=[s,o];this.addPoint(t,e),this.addPoint(s,o);for(var p=0;p<=1;p++){var v=6*l[p]-12*u[p]+6*c[p],y=-3*l[p]+9*u[p]-9*c[p]+3*f[p],S=3*u[p]-3*l[p];if(y===0){if(v===0)continue;var w=-S/v;0<w&&w<1&&(p===0&&this.addX(Cp(l[p],u[p],c[p],f[p],w)),p===1&&this.addY(Cp(l[p],u[p],c[p],f[p],w)));continue}var T=Math.pow(v,2)-4*S*y;if(!(T<0)){var _=(-v+Math.sqrt(T))/(2*y);0<_&&_<1&&(p===0&&this.addX(Cp(l[p],u[p],c[p],f[p],_)),p===1&&this.addY(Cp(l[p],u[p],c[p],f[p],_)));var C=(-v-Math.sqrt(T))/(2*y);0<C&&C<1&&(p===0&&this.addX(Cp(l[p],u[p],c[p],f[p],C)),p===1&&this.addY(Cp(l[p],u[p],c[p],f[p],C)))}}};Mu.prototype.addQuad=function(t,e,r,n,i,a){var s=t+.6666666666666666*(r-t),o=e+2/3*(n-e),l=s+1/3*(i-t),u=o+1/3*(a-e);this.addBezier(t,e,s,o,l,u,i,a)};function ii(){this.commands=[],this.fill="black",this.stroke=null,this.strokeWidth=1}ii.prototype.moveTo=function(t,e){this.commands.push({type:"M",x:t,y:e})};ii.prototype.lineTo=function(t,e){this.commands.push({type:"L",x:t,y:e})};ii.prototype.curveTo=ii.prototype.bezierCurveTo=function(t,e,r,n,i,a){this.commands.push({type:"C",x1:t,y1:e,x2:r,y2:n,x:i,y:a})};ii.prototype.quadTo=ii.prototype.quadraticCurveTo=function(t,e,r,n){this.commands.push({type:"Q",x1:t,y1:e,x:r,y:n})};ii.prototype.close=ii.prototype.closePath=function(){this.commands.push({type:"Z"})};ii.prototype.extend=function(t){if(t.commands)t=t.commands;else if(t instanceof Mu){var e=t;this.moveTo(e.x1,e.y1),this.lineTo(e.x2,e.y1),this.lineTo(e.x2,e.y2),this.lineTo(e.x1,e.y2),this.close();return}Array.prototype.push.apply(this.commands,t)};ii.prototype.getBoundingBox=function(){for(var t=new Mu,e=0,r=0,n=0,i=0,a=0;a<this.commands.length;a++){var s=this.commands[a];switch(s.type){case"M":t.addPoint(s.x,s.y),e=n=s.x,r=i=s.y;break;case"L":t.addPoint(s.x,s.y),n=s.x,i=s.y;break;case"Q":t.addQuad(n,i,s.x1,s.y1,s.x,s.y),n=s.x,i=s.y;break;case"C":t.addBezier(n,i,s.x1,s.y1,s.x2,s.y2,s.x,s.y),n=s.x,i=s.y;break;case"Z":n=e,i=r;break;default:throw new Error("Unexpected path command "+s.type)}}return t.isEmpty()&&t.addPoint(0,0),t};ii.prototype.draw=function(t){t.beginPath();for(var e=0;e<this.commands.length;e+=1){var r=this.commands[e];r.type==="M"?t.moveTo(r.x,r.y):r.type==="L"?t.lineTo(r.x,r.y):r.type==="C"?t.bezierCurveTo(r.x1,r.y1,r.x2,r.y2,r.x,r.y):r.type==="Q"?t.quadraticCurveTo(r.x1,r.y1,r.x,r.y):r.type==="Z"&&t.closePath()}this.fill&&(t.fillStyle=this.fill,t.fill()),this.stroke&&(t.strokeStyle=this.stroke,t.lineWidth=this.strokeWidth,t.stroke())};ii.prototype.toPathData=function(t){t=t!==void 0?t:2;function e(s){return Math.round(s)===s?""+Math.round(s):s.toFixed(t)}function r(){for(var s=arguments,o="",l=0;l<arguments.length;l+=1){var u=s[l];u>=0&&l>0&&(o+=" "),o+=e(u)}return o}for(var n="",i=0;i<this.commands.length;i+=1){var a=this.commands[i];a.type==="M"?n+="M"+r(a.x,a.y):a.type==="L"?n+="L"+r(a.x,a.y):a.type==="C"?n+="C"+r(a.x1,a.y1,a.x2,a.y2,a.x,a.y):a.type==="Q"?n+="Q"+r(a.x1,a.y1,a.x,a.y):a.type==="Z"&&(n+="Z")}return n};ii.prototype.toSVG=function(t){var e='<path d="';return e+=this.toPathData(t),e+='"',this.fill&&this.fill!=="black"&&(this.fill===null?e+=' fill="none"':e+=' fill="'+this.fill+'"'),this.stroke&&(e+=' stroke="'+this.stroke+'" stroke-width="'+this.strokeWidth+'"'),e+="/>",e};ii.prototype.toDOMElement=function(t){var e=this.toPathData(t),r=document.createElementNS("http://www.w3.org/2000/svg","path");return r.setAttribute("d",e),r};function fR(t){throw new Error(t)}function V4(t,e){t||fR(e)}var ir={fail:fR,argument:V4,assert:V4},H4=32768,W4=2147483648,Xp={},bt={},or={};function Rl(t){return function(){return t}}bt.BYTE=function(t){return ir.argument(t>=0&&t<=255,"Byte value should be between 0 and 255."),[t]};or.BYTE=Rl(1);bt.CHAR=function(t){return[t.charCodeAt(0)]};or.CHAR=Rl(1);bt.CHARARRAY=function(t){typeof t>"u"&&(t="",console.warn("Undefined CHARARRAY encountered and treated as an empty string. This is probably caused by a missing glyph name."));for(var e=[],r=0;r<t.length;r+=1)e[r]=t.charCodeAt(r);return e};or.CHARARRAY=function(t){return typeof t>"u"?0:t.length};bt.USHORT=function(t){return[t>>8&255,t&255]};or.USHORT=Rl(2);bt.SHORT=function(t){return t>=H4&&(t=-(2*H4-t)),[t>>8&255,t&255]};or.SHORT=Rl(2);bt.UINT24=function(t){return[t>>16&255,t>>8&255,t&255]};or.UINT24=Rl(3);bt.ULONG=function(t){return[t>>24&255,t>>16&255,t>>8&255,t&255]};or.ULONG=Rl(4);bt.LONG=function(t){return t>=W4&&(t=-(2*W4-t)),[t>>24&255,t>>16&255,t>>8&255,t&255]};or.LONG=Rl(4);bt.FIXED=bt.ULONG;or.FIXED=or.ULONG;bt.FWORD=bt.SHORT;or.FWORD=or.SHORT;bt.UFWORD=bt.USHORT;or.UFWORD=or.USHORT;bt.LONGDATETIME=function(t){return[0,0,0,0,t>>24&255,t>>16&255,t>>8&255,t&255]};or.LONGDATETIME=Rl(8);bt.TAG=function(t){return ir.argument(t.length===4,"Tag should be exactly 4 ASCII characters."),[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]};or.TAG=Rl(4);bt.Card8=bt.BYTE;or.Card8=or.BYTE;bt.Card16=bt.USHORT;or.Card16=or.USHORT;bt.OffSize=bt.BYTE;or.OffSize=or.BYTE;bt.SID=bt.USHORT;or.SID=or.USHORT;bt.NUMBER=function(t){return t>=-107&&t<=107?[t+139]:t>=108&&t<=1131?(t=t-108,[(t>>8)+247,t&255]):t>=-1131&&t<=-108?(t=-t-108,[(t>>8)+251,t&255]):t>=-32768&&t<=32767?bt.NUMBER16(t):bt.NUMBER32(t)};or.NUMBER=function(t){return bt.NUMBER(t).length};bt.NUMBER16=function(t){return[28,t>>8&255,t&255]};or.NUMBER16=Rl(3);bt.NUMBER32=function(t){return[29,t>>24&255,t>>16&255,t>>8&255,t&255]};or.NUMBER32=Rl(5);bt.REAL=function(t){var e=t.toString(),r=/\.(\d*?)(?:9{5,20}|0{5,20})\d{0,2}(?:e(.+)|$)/.exec(e);if(r){var n=parseFloat("1e"+((r[2]?+r[2]:0)+r[1].length));e=(Math.round(t*n)/n).toString()}for(var i="",a=0,s=e.length;a<s;a+=1){var o=e[a];o==="e"?i+=e[++a]==="-"?"c":"b":o==="."?i+="a":o==="-"?i+="e":i+=o}i+=i.length&1?"f":"ff";for(var l=[30],u=0,c=i.length;u<c;u+=2)l.push(parseInt(i.substr(u,2),16));return l};or.REAL=function(t){return bt.REAL(t).length};bt.NAME=bt.CHARARRAY;or.NAME=or.CHARARRAY;bt.STRING=bt.CHARARRAY;or.STRING=or.CHARARRAY;Xp.UTF8=function(t,e,r){for(var n=[],i=r,a=0;a<i;a++,e+=1)n[a]=t.getUint8(e);return String.fromCharCode.apply(null,n)};Xp.UTF16=function(t,e,r){for(var n=[],i=r/2,a=0;a<i;a++,e+=2)n[a]=t.getUint16(e);return String.fromCharCode.apply(null,n)};bt.UTF16=function(t){for(var e=[],r=0;r<t.length;r+=1){var n=t.charCodeAt(r);e[e.length]=n>>8&255,e[e.length]=n&255}return e};or.UTF16=function(t){return t.length*2};var ck={"x-mac-croatian":"","x-mac-cyrillic":"","x-mac-gaelic":"","x-mac-greek":"","x-mac-icelandic":"","x-mac-inuit":"","x-mac-ce":"",macintosh:"","x-mac-romanian":"","x-mac-turkish":""};Xp.MACSTRING=function(t,e,r,n){var i=ck[n];if(i!==void 0){for(var a="",s=0;s<r;s++){var o=t.getUint8(e+s);o<=127?a+=String.fromCharCode(o):a+=i[o&127]}return a}};var xy=typeof WeakMap=="function"&&new WeakMap,by,TW=function(t){if(!by){by={};for(var e in ck)by[e]=new String(e)}var r=by[t];if(r!==void 0){if(xy){var n=xy.get(r);if(n!==void 0)return n}var i=ck[t];if(i!==void 0){for(var a={},s=0;s<i.length;s++)a[i.charCodeAt(s)]=s+128;return xy&&xy.set(r,a),a}}};bt.MACSTRING=function(t,e){var r=TW(e);if(r!==void 0){for(var n=[],i=0;i<t.length;i++){var a=t.charCodeAt(i);if(a>=128&&(a=r[a],a===void 0))return;n[i]=a}return n}};or.MACSTRING=function(t,e){var r=bt.MACSTRING(t,e);return r!==void 0?r.length:0};function dk(t){return t>=-128&&t<=127}function NW(t,e,r){for(var n=0,i=t.length;e<i&&n<64&&t[e]===0;)++e,++n;return r.push(128|n-1),e}function PW(t,e,r){for(var n=0,i=t.length,a=e;a<i&&n<64;){var s=t[a];if(!dk(s)||s===0&&a+1<i&&t[a+1]===0)break;++a,++n}r.push(n-1);for(var o=e;o<a;++o)r.push(t[o]+256&255);return a}function MW(t,e,r){for(var n=0,i=t.length,a=e;a<i&&n<64;){var s=t[a];if(s===0||dk(s)&&a+1<i&&dk(t[a+1]))break;++a,++n}r.push(64|n-1);for(var o=e;o<a;++o){var l=t[o];r.push(l+65536>>8&255,l+256&255)}return a}bt.VARDELTAS=function(t){for(var e=0,r=[];e<t.length;){var n=t[e];n===0?e=NW(t,e,r):n>=-128&&n<=127?e=PW(t,e,r):e=MW(t,e,r)}return r};bt.INDEX=function(t){for(var e=1,r=[e],n=[],i=0;i<t.length;i+=1){var a=bt.OBJECT(t[i]);Array.prototype.push.apply(n,a),e+=a.length,r.push(e)}if(n.length===0)return[0,0];for(var s=[],o=1+Math.floor(Math.log(e)/Math.log(2))/8|0,l=[void 0,bt.BYTE,bt.USHORT,bt.UINT24,bt.ULONG][o],u=0;u<r.length;u+=1){var c=l(r[u]);Array.prototype.push.apply(s,c)}return Array.prototype.concat(bt.Card16(t.length),bt.OffSize(o),s,n)};or.INDEX=function(t){return bt.INDEX(t).length};bt.DICT=function(t){for(var e=[],r=Object.keys(t),n=r.length,i=0;i<n;i+=1){var a=parseInt(r[i],0),s=t[a];e=e.concat(bt.OPERAND(s.value,s.type)),e=e.concat(bt.OPERATOR(a))}return e};or.DICT=function(t){return bt.DICT(t).length};bt.OPERATOR=function(t){return t<1200?[t]:[12,t-1200]};bt.OPERAND=function(t,e){var r=[];if(Array.isArray(e))for(var n=0;n<e.length;n+=1)ir.argument(t.length===e.length,"Not enough arguments given for type"+e),r=r.concat(bt.OPERAND(t[n],e[n]));else if(e==="SID")r=r.concat(bt.NUMBER(t));else if(e==="offset")r=r.concat(bt.NUMBER32(t));else if(e==="number")r=r.concat(bt.NUMBER(t));else if(e==="real")r=r.concat(bt.REAL(t));else throw new Error("Unknown operand type "+e);return r};bt.OP=bt.BYTE;or.OP=or.BYTE;var wy=typeof WeakMap=="function"&&new WeakMap;bt.CHARSTRING=function(t){if(wy){var e=wy.get(t);if(e!==void 0)return e}for(var r=[],n=t.length,i=0;i<n;i+=1){var a=t[i];r=r.concat(bt[a.type](a.value))}return wy&&wy.set(t,r),r};or.CHARSTRING=function(t){return bt.CHARSTRING(t).length};bt.OBJECT=function(t){var e=bt[t.type];return ir.argument(e!==void 0,"No encoding function for type "+t.type),e(t.value)};or.OBJECT=function(t){var e=or[t.type];return ir.argument(e!==void 0,"No sizeOf function for type "+t.type),e(t.value)};bt.TABLE=function(t){for(var e=[],r=t.fields.length,n=[],i=[],a=0;a<r;a+=1){var s=t.fields[a],o=bt[s.type];ir.argument(o!==void 0,"No encoding function for field type "+s.type+" ("+s.name+")");var l=t[s.name];l===void 0&&(l=s.value);var u=o(l);s.type==="TABLE"?(i.push(e.length),e=e.concat([0,0]),n.push(u)):e=e.concat(u)}for(var c=0;c<n.length;c+=1){var f=i[c],p=e.length;ir.argument(p<65536,"Table "+t.tableName+" too big."),e[f]=p>>8,e[f+1]=p&255,e=e.concat(n[c])}return e};or.TABLE=function(t){for(var e=0,r=t.fields.length,n=0;n<r;n+=1){var i=t.fields[n],a=or[i.type];ir.argument(a!==void 0,"No sizeOf function for field type "+i.type+" ("+i.name+")");var s=t[i.name];s===void 0&&(s=i.value),e+=a(s),i.type==="TABLE"&&(e+=2)}return e};bt.RECORD=bt.TABLE;or.RECORD=or.TABLE;bt.LITERAL=function(t){return t};or.LITERAL=function(t){return t.length};function la(t,e,r){if(e.length&&(e[0].name!=="coverageFormat"||e[0].value===1))for(var n=0;n<e.length;n+=1){var i=e[n];this[i.name]=i.value}if(this.tableName=t,this.fields=e,r)for(var a=Object.keys(r),s=0;s<a.length;s+=1){var o=a[s],l=r[o];this[o]!==void 0&&(this[o]=l)}}la.prototype.encode=function(){return bt.TABLE(this)};la.prototype.sizeOf=function(){return or.TABLE(this)};function Ov(t,e,r){r===void 0&&(r=e.length);var n=new Array(e.length+1);n[0]={name:t+"Count",type:"USHORT",value:r};for(var i=0;i<e.length;i++)n[i+1]={name:t+i,type:"USHORT",value:e[i]};return n}function fk(t,e,r){var n=e.length,i=new Array(n+1);i[0]={name:t+"Count",type:"USHORT",value:n};for(var a=0;a<n;a++)i[a+1]={name:t+a,type:"TABLE",value:r(e[a],a)};return i}function Dv(t,e,r){var n=e.length,i=[];i[0]={name:t+"Count",type:"USHORT",value:n};for(var a=0;a<n;a++)i=i.concat(r(e[a],a));return i}function Sx(t){t.format===1?la.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:1}].concat(Ov("glyph",t.glyphs))):t.format===2?la.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:2}].concat(Dv("rangeRecord",t.ranges,function(e){return[{name:"startGlyphID",type:"USHORT",value:e.start},{name:"endGlyphID",type:"USHORT",value:e.end},{name:"startCoverageIndex",type:"USHORT",value:e.index}]}))):ir.assert(!1,"Coverage format must be 1 or 2.")}Sx.prototype=Object.create(la.prototype);Sx.prototype.constructor=Sx;function kx(t){la.call(this,"scriptListTable",Dv("scriptRecord",t,function(e,r){var n=e.script,i=n.defaultLangSys;return ir.assert(!!i,"Unable to write GSUB: script "+e.tag+" has no default language system."),[{name:"scriptTag"+r,type:"TAG",value:e.tag},{name:"script"+r,type:"TABLE",value:new la("scriptTable",[{name:"defaultLangSys",type:"TABLE",value:new la("defaultLangSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:i.reqFeatureIndex}].concat(Ov("featureIndex",i.featureIndexes)))}].concat(Dv("langSys",n.langSysRecords,function(a,s){var o=a.langSys;return[{name:"langSysTag"+s,type:"TAG",value:a.tag},{name:"langSys"+s,type:"TABLE",value:new la("langSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:o.reqFeatureIndex}].concat(Ov("featureIndex",o.featureIndexes)))}]})))}]}))}kx.prototype=Object.create(la.prototype);kx.prototype.constructor=kx;function _x(t){la.call(this,"featureListTable",Dv("featureRecord",t,function(e,r){var n=e.feature;return[{name:"featureTag"+r,type:"TAG",value:e.tag},{name:"feature"+r,type:"TABLE",value:new la("featureTable",[{name:"featureParams",type:"USHORT",value:n.featureParams}].concat(Ov("lookupListIndex",n.lookupListIndexes)))}]}))}_x.prototype=Object.create(la.prototype);_x.prototype.constructor=_x;function Cx(t,e){la.call(this,"lookupListTable",fk("lookup",t,function(r){var n=e[r.lookupType];return ir.assert(!!n,"Unable to write GSUB lookup type "+r.lookupType+" tables."),new la("lookupTable",[{name:"lookupType",type:"USHORT",value:r.lookupType},{name:"lookupFlag",type:"USHORT",value:r.lookupFlag}].concat(fk("subtable",r.subtables,n)))}))}Cx.prototype=Object.create(la.prototype);Cx.prototype.constructor=Cx;var Mt={Table:la,Record:la,Coverage:Sx,ScriptList:kx,FeatureList:_x,LookupList:Cx,ushortList:Ov,tableList:fk,recordList:Dv};function q4(t,e){return t.getUint8(e)}function Ex(t,e){return t.getUint16(e,!1)}function AW(t,e){return t.getInt16(e,!1)}function U_(t,e){return t.getUint32(e,!1)}function hR(t,e){var r=t.getInt16(e,!1),n=t.getUint16(e+2,!1);return r+n/65535}function LW(t,e){for(var r="",n=e;n<e+4;n+=1)r+=String.fromCharCode(t.getInt8(n));return r}function RW(t,e,r){for(var n=0,i=0;i<r;i+=1)n<<=8,n+=t.getUint8(e+i);return n}function OW(t,e,r){for(var n=[],i=e;i<r;i+=1)n.push(t.getUint8(i));return n}function DW(t){for(var e="",r=0;r<t.length;r+=1)e+=String.fromCharCode(t[r]);return e}var IW={byte:1,uShort:2,short:2,uLong:4,fixed:4,longDateTime:8,tag:4};function ze(t,e){this.data=t,this.offset=e,this.relativeOffset=0}ze.prototype.parseByte=function(){var t=this.data.getUint8(this.offset+this.relativeOffset);return this.relativeOffset+=1,t};ze.prototype.parseChar=function(){var t=this.data.getInt8(this.offset+this.relativeOffset);return this.relativeOffset+=1,t};ze.prototype.parseCard8=ze.prototype.parseByte;ze.prototype.parseUShort=function(){var t=this.data.getUint16(this.offset+this.relativeOffset);return this.relativeOffset+=2,t};ze.prototype.parseCard16=ze.prototype.parseUShort;ze.prototype.parseSID=ze.prototype.parseUShort;ze.prototype.parseOffset16=ze.prototype.parseUShort;ze.prototype.parseShort=function(){var t=this.data.getInt16(this.offset+this.relativeOffset);return this.relativeOffset+=2,t};ze.prototype.parseF2Dot14=function(){var t=this.data.getInt16(this.offset+this.relativeOffset)/16384;return this.relativeOffset+=2,t};ze.prototype.parseULong=function(){var t=U_(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,t};ze.prototype.parseOffset32=ze.prototype.parseULong;ze.prototype.parseFixed=function(){var t=hR(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,t};ze.prototype.parseString=function(t){var e=this.data,r=this.offset+this.relativeOffset,n="";this.relativeOffset+=t;for(var i=0;i<t;i++)n+=String.fromCharCode(e.getUint8(r+i));return n};ze.prototype.parseTag=function(){return this.parseString(4)};ze.prototype.parseLongDateTime=function(){var t=U_(this.data,this.offset+this.relativeOffset+4);return t-=2082844800,this.relativeOffset+=8,t};ze.prototype.parseVersion=function(t){var e=Ex(this.data,this.offset+this.relativeOffset),r=Ex(this.data,this.offset+this.relativeOffset+2);return this.relativeOffset+=4,t===void 0&&(t=4096),e+r/t/10};ze.prototype.skip=function(t,e){e===void 0&&(e=1),this.relativeOffset+=IW[t]*e};ze.prototype.parseULongList=function(t){t===void 0&&(t=this.parseULong());for(var e=new Array(t),r=this.data,n=this.offset+this.relativeOffset,i=0;i<t;i++)e[i]=r.getUint32(n),n+=4;return this.relativeOffset+=t*4,e};ze.prototype.parseOffset16List=ze.prototype.parseUShortList=function(t){t===void 0&&(t=this.parseUShort());for(var e=new Array(t),r=this.data,n=this.offset+this.relativeOffset,i=0;i<t;i++)e[i]=r.getUint16(n),n+=2;return this.relativeOffset+=t*2,e};ze.prototype.parseShortList=function(t){for(var e=new Array(t),r=this.data,n=this.offset+this.relativeOffset,i=0;i<t;i++)e[i]=r.getInt16(n),n+=2;return this.relativeOffset+=t*2,e};ze.prototype.parseByteList=function(t){for(var e=new Array(t),r=this.data,n=this.offset+this.relativeOffset,i=0;i<t;i++)e[i]=r.getUint8(n++);return this.relativeOffset+=t,e};ze.prototype.parseList=function(t,e){e||(e=t,t=this.parseUShort());for(var r=new Array(t),n=0;n<t;n++)r[n]=e.call(this);return r};ze.prototype.parseList32=function(t,e){e||(e=t,t=this.parseULong());for(var r=new Array(t),n=0;n<t;n++)r[n]=e.call(this);return r};ze.prototype.parseRecordList=function(t,e){e||(e=t,t=this.parseUShort());for(var r=new Array(t),n=Object.keys(e),i=0;i<t;i++){for(var a={},s=0;s<n.length;s++){var o=n[s],l=e[o];a[o]=l.call(this)}r[i]=a}return r};ze.prototype.parseRecordList32=function(t,e){e||(e=t,t=this.parseULong());for(var r=new Array(t),n=Object.keys(e),i=0;i<t;i++){for(var a={},s=0;s<n.length;s++){var o=n[s],l=e[o];a[o]=l.call(this)}r[i]=a}return r};ze.prototype.parseStruct=function(t){if(typeof t=="function")return t.call(this);for(var e=Object.keys(t),r={},n=0;n<e.length;n++){var i=e[n],a=t[i];r[i]=a.call(this)}return r};ze.prototype.parseValueRecord=function(t){if(t===void 0&&(t=this.parseUShort()),t!==0){var e={};return t&1&&(e.xPlacement=this.parseShort()),t&2&&(e.yPlacement=this.parseShort()),t&4&&(e.xAdvance=this.parseShort()),t&8&&(e.yAdvance=this.parseShort()),t&16&&(e.xPlaDevice=void 0,this.parseShort()),t&32&&(e.yPlaDevice=void 0,this.parseShort()),t&64&&(e.xAdvDevice=void 0,this.parseShort()),t&128&&(e.yAdvDevice=void 0,this.parseShort()),e}};ze.prototype.parseValueRecordList=function(){for(var t=this.parseUShort(),e=this.parseUShort(),r=new Array(e),n=0;n<e;n++)r[n]=this.parseValueRecord(t);return r};ze.prototype.parsePointer=function(t){var e=this.parseOffset16();if(e>0)return new ze(this.data,this.offset+e).parseStruct(t)};ze.prototype.parsePointer32=function(t){var e=this.parseOffset32();if(e>0)return new ze(this.data,this.offset+e).parseStruct(t)};ze.prototype.parseListOfLists=function(t){for(var e=this.parseOffset16List(),r=e.length,n=this.relativeOffset,i=new Array(r),a=0;a<r;a++){var s=e[a];if(s===0){i[a]=void 0;continue}if(this.relativeOffset=s,t){for(var o=this.parseOffset16List(),l=new Array(o.length),u=0;u<o.length;u++)this.relativeOffset=s+o[u],l[u]=t.call(this);i[a]=l}else i[a]=this.parseUShortList()}return this.relativeOffset=n,i};ze.prototype.parseCoverage=function(){var t=this.offset+this.relativeOffset,e=this.parseUShort(),r=this.parseUShort();if(e===1)return{format:1,glyphs:this.parseUShortList(r)};if(e===2){for(var n=new Array(r),i=0;i<r;i++)n[i]={start:this.parseUShort(),end:this.parseUShort(),index:this.parseUShort()};return{format:2,ranges:n}}throw new Error("0x"+t.toString(16)+": Coverage format must be 1 or 2.")};ze.prototype.parseClassDef=function(){var t=this.offset+this.relativeOffset,e=this.parseUShort();if(e===1)return{format:1,startGlyph:this.parseUShort(),classes:this.parseUShortList()};if(e===2)return{format:2,ranges:this.parseRecordList({start:ze.uShort,end:ze.uShort,classId:ze.uShort})};throw new Error("0x"+t.toString(16)+": ClassDef format must be 1 or 2.")};ze.list=function(t,e){return function(){return this.parseList(t,e)}};ze.list32=function(t,e){return function(){return this.parseList32(t,e)}};ze.recordList=function(t,e){return function(){return this.parseRecordList(t,e)}};ze.recordList32=function(t,e){return function(){return this.parseRecordList32(t,e)}};ze.pointer=function(t){return function(){return this.parsePointer(t)}};ze.pointer32=function(t){return function(){return this.parsePointer32(t)}};ze.tag=ze.prototype.parseTag;ze.byte=ze.prototype.parseByte;ze.uShort=ze.offset16=ze.prototype.parseUShort;ze.uShortList=ze.prototype.parseUShortList;ze.uLong=ze.offset32=ze.prototype.parseULong;ze.uLongList=ze.prototype.parseULongList;ze.struct=ze.prototype.parseStruct;ze.coverage=ze.prototype.parseCoverage;ze.classDef=ze.prototype.parseClassDef;var $4={reserved:ze.uShort,reqFeatureIndex:ze.uShort,featureIndexes:ze.uShortList};ze.prototype.parseScriptList=function(){return this.parsePointer(ze.recordList({tag:ze.tag,script:ze.pointer({defaultLangSys:ze.pointer($4),langSysRecords:ze.recordList({tag:ze.tag,langSys:ze.pointer($4)})})}))||[]};ze.prototype.parseFeatureList=function(){return this.parsePointer(ze.recordList({tag:ze.tag,feature:ze.pointer({featureParams:ze.offset16,lookupListIndexes:ze.uShortList})}))||[]};ze.prototype.parseLookupList=function(t){return this.parsePointer(ze.list(ze.pointer(function(){var e=this.parseUShort();ir.argument(1<=e&&e<=9,"GPOS/GSUB lookup type "+e+" unknown.");var r=this.parseUShort(),n=r&16;return{lookupType:e,lookupFlag:r,subtables:this.parseList(ze.pointer(t[e])),markFilteringSet:n?this.parseUShort():void 0}})))||[]};ze.prototype.parseFeatureVariationsList=function(){return this.parsePointer32(function(){var t=this.parseUShort(),e=this.parseUShort();ir.argument(t===1&&e<1,"GPOS/GSUB feature variations table unknown.");var r=this.parseRecordList32({conditionSetOffset:ze.offset32,featureTableSubstitutionOffset:ze.offset32});return r})||[]};var Dt={getByte:q4,getCard8:q4,getUShort:Ex,getCard16:Ex,getShort:AW,getULong:U_,getFixed:hR,getTag:LW,getOffset:RW,getBytes:OW,bytesToString:DW,Parser:ze};function jW(t,e){e.parseUShort(),t.length=e.parseULong(),t.language=e.parseULong();var r;t.groupCount=r=e.parseULong(),t.glyphIndexMap={};for(var n=0;n<r;n+=1)for(var i=e.parseULong(),a=e.parseULong(),s=e.parseULong(),o=i;o<=a;o+=1)t.glyphIndexMap[o]=s,s++}function FW(t,e,r,n,i){t.length=e.parseUShort(),t.language=e.parseUShort();var a;t.segCount=a=e.parseUShort()>>1,e.skip("uShort",3),t.glyphIndexMap={};for(var s=new Dt.Parser(r,n+i+14),o=new Dt.Parser(r,n+i+16+a*2),l=new Dt.Parser(r,n+i+16+a*4),u=new Dt.Parser(r,n+i+16+a*6),c=n+i+16+a*8,f=0;f<a-1;f+=1)for(var p=void 0,v=s.parseUShort(),y=o.parseUShort(),S=l.parseShort(),w=u.parseUShort(),T=y;T<=v;T+=1)w!==0?(c=u.offset+u.relativeOffset-2,c+=w,c+=(T-y)*2,p=Dt.getUShort(r,c),p!==0&&(p=p+S&65535)):p=T+S&65535,t.glyphIndexMap[T]=p}function BW(t,e){var r={};r.version=Dt.getUShort(t,e),ir.argument(r.version===0,"cmap table version should be 0."),r.numTables=Dt.getUShort(t,e+2);for(var n=-1,i=r.numTables-1;i>=0;i-=1){var a=Dt.getUShort(t,e+4+i*8),s=Dt.getUShort(t,e+4+i*8+2);if(a===3&&(s===0||s===1||s===10)||a===0&&(s===0||s===1||s===2||s===3||s===4)){n=Dt.getULong(t,e+4+i*8+4);break}}if(n===-1)throw new Error("No valid cmap sub-tables found.");var o=new Dt.Parser(t,e+n);if(r.format=o.parseUShort(),r.format===12)jW(r,o);else if(r.format===4)FW(r,o,t,e,n);else throw new Error("Only format 4 and 12 cmap tables are supported (found format "+r.format+").");return r}function zW(t,e,r){t.segments.push({end:e,start:e,delta:-(e-r),offset:0,glyphIndex:r})}function UW(t){t.segments.push({end:65535,start:65535,delta:1,offset:0})}function GW(t){var e=!0,r;for(r=t.length-1;r>0;r-=1){var n=t.get(r);if(n.unicode>65535){console.log("Adding CMAP format 12 (needed!)"),e=!1;break}}var i=[{name:"version",type:"USHORT",value:0},{name:"numTables",type:"USHORT",value:e?1:2},{name:"platformID",type:"USHORT",value:3},{name:"encodingID",type:"USHORT",value:1},{name:"offset",type:"ULONG",value:e?12:20}];e||(i=i.concat([{name:"cmap12PlatformID",type:"USHORT",value:3},{name:"cmap12EncodingID",type:"USHORT",value:10},{name:"cmap12Offset",type:"ULONG",value:0}])),i=i.concat([{name:"format",type:"USHORT",value:4},{name:"cmap4Length",type:"USHORT",value:0},{name:"language",type:"USHORT",value:0},{name:"segCountX2",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);var a=new Mt.Table("cmap",i);for(a.segments=[],r=0;r<t.length;r+=1){for(var s=t.get(r),o=0;o<s.unicodes.length;o+=1)zW(a,s.unicodes[o],r);a.segments=a.segments.sort(function(_,C){return _.start-C.start})}UW(a);var l=a.segments.length,u=0,c=[],f=[],p=[],v=[],y=[],S=[];for(r=0;r<l;r+=1){var w=a.segments[r];w.end<=65535&&w.start<=65535?(c=c.concat({name:"end_"+r,type:"USHORT",value:w.end}),f=f.concat({name:"start_"+r,type:"USHORT",value:w.start}),p=p.concat({name:"idDelta_"+r,type:"SHORT",value:w.delta}),v=v.concat({name:"idRangeOffset_"+r,type:"USHORT",value:w.offset}),w.glyphId!==void 0&&(y=y.concat({name:"glyph_"+r,type:"USHORT",value:w.glyphId}))):u+=1,!e&&w.glyphIndex!==void 0&&(S=S.concat({name:"cmap12Start_"+r,type:"ULONG",value:w.start}),S=S.concat({name:"cmap12End_"+r,type:"ULONG",value:w.end}),S=S.concat({name:"cmap12Glyph_"+r,type:"ULONG",value:w.glyphIndex}))}if(a.segCountX2=(l-u)*2,a.searchRange=Math.pow(2,Math.floor(Math.log(l-u)/Math.log(2)))*2,a.entrySelector=Math.log(a.searchRange/2)/Math.log(2),a.rangeShift=a.segCountX2-a.searchRange,a.fields=a.fields.concat(c),a.fields.push({name:"reservedPad",type:"USHORT",value:0}),a.fields=a.fields.concat(f),a.fields=a.fields.concat(p),a.fields=a.fields.concat(v),a.fields=a.fields.concat(y),a.cmap4Length=14+c.length*2+2+f.length*2+p.length*2+v.length*2+y.length*2,!e){var T=16+S.length*4;a.cmap12Offset=20+a.cmap4Length,a.fields=a.fields.concat([{name:"cmap12Format",type:"USHORT",value:12},{name:"cmap12Reserved",type:"USHORT",value:0},{name:"cmap12Length",type:"ULONG",value:T},{name:"cmap12Language",type:"ULONG",value:0},{name:"cmap12nGroups",type:"ULONG",value:S.length/3}]),a.fields=a.fields.concat(S)}return a}var pR={parse:BW,make:GW},Xy=[".notdef","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","endash","dagger","daggerdbl","periodcentered","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","questiondown","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","ring","cedilla","hungarumlaut","ogonek","caron","emdash","AE","ordfeminine","Lslash","Oslash","OE","ordmasculine","ae","dotlessi","lslash","oslash","oe","germandbls","onesuperior","logicalnot","mu","trademark","Eth","onehalf","plusminus","Thorn","onequarter","divide","brokenbar","degree","thorn","threequarters","twosuperior","registered","minus","eth","multiply","threesuperior","copyright","Aacute","Acircumflex","Adieresis","Agrave","Aring","Atilde","Ccedilla","Eacute","Ecircumflex","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Ntilde","Oacute","Ocircumflex","Odieresis","Ograve","Otilde","Scaron","Uacute","Ucircumflex","Udieresis","Ugrave","Yacute","Ydieresis","Zcaron","aacute","acircumflex","adieresis","agrave","aring","atilde","ccedilla","eacute","ecircumflex","edieresis","egrave","iacute","icircumflex","idieresis","igrave","ntilde","oacute","ocircumflex","odieresis","ograve","otilde","scaron","uacute","ucircumflex","udieresis","ugrave","yacute","ydieresis","zcaron","exclamsmall","Hungarumlautsmall","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","266 ff","onedotenleader","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","commasuperior","threequartersemdash","periodsuperior","questionsmall","asuperior","bsuperior","centsuperior","dsuperior","esuperior","isuperior","lsuperior","msuperior","nsuperior","osuperior","rsuperior","ssuperior","tsuperior","ff","ffi","ffl","parenleftinferior","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","exclamdownsmall","centoldstyle","Lslashsmall","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","Dotaccentsmall","Macronsmall","figuredash","hypheninferior","Ogoneksmall","Ringsmall","Cedillasmall","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","zerosuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall","001.000","001.001","001.002","001.003","Black","Bold","Book","Light","Medium","Regular","Roman","Semibold"],VW=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","","endash","dagger","daggerdbl","periodcentered","","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","","questiondown","","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","","ring","cedilla","","hungarumlaut","ogonek","caron","emdash","","","","","","","","","","","","","","","","","AE","","ordfeminine","","","","","Lslash","Oslash","OE","ordmasculine","","","","","","ae","","","","dotlessi","","","lslash","oslash","oe","germandbls"],HW=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclamsmall","Hungarumlautsmall","","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","twodotenleader","onedotenleader","comma","hyphen","period","fraction","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","colon","semicolon","commasuperior","threequartersemdash","periodsuperior","questionsmall","","asuperior","bsuperior","centsuperior","dsuperior","esuperior","","","isuperior","","","lsuperior","msuperior","nsuperior","osuperior","","","rsuperior","ssuperior","tsuperior","","ff","fi","fl","ffi","ffl","parenleftinferior","","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdownsmall","centoldstyle","Lslashsmall","","","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","","Dotaccentsmall","","","Macronsmall","","","figuredash","hypheninferior","","","Ogoneksmall","Ringsmall","Cedillasmall","","","","onequarter","onehalf","threequarters","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","","","zerosuperior","onesuperior","twosuperior","threesuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall"],th=[".notdef",".null","nonmarkingreturn","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quotesingle","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","grave","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","Adieresis","Aring","Ccedilla","Eacute","Ntilde","Odieresis","Udieresis","aacute","agrave","acircumflex","adieresis","atilde","aring","ccedilla","eacute","egrave","ecircumflex","edieresis","iacute","igrave","icircumflex","idieresis","ntilde","oacute","ograve","ocircumflex","odieresis","otilde","uacute","ugrave","ucircumflex","udieresis","dagger","degree","cent","sterling","section","bullet","paragraph","germandbls","registered","copyright","trademark","acute","dieresis","notequal","AE","Oslash","infinity","plusminus","lessequal","greaterequal","yen","mu","partialdiff","summation","product","pi","integral","ordfeminine","ordmasculine","Omega","ae","oslash","questiondown","exclamdown","logicalnot","radical","florin","approxequal","Delta","guillemotleft","guillemotright","ellipsis","nonbreakingspace","Agrave","Atilde","Otilde","OE","oe","endash","emdash","quotedblleft","quotedblright","quoteleft","quoteright","divide","lozenge","ydieresis","Ydieresis","fraction","currency","guilsinglleft","guilsinglright","fi","fl","daggerdbl","periodcentered","quotesinglbase","quotedblbase","perthousand","Acircumflex","Ecircumflex","Aacute","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Oacute","Ocircumflex","apple","Ograve","Uacute","Ucircumflex","Ugrave","dotlessi","circumflex","tilde","macron","breve","dotaccent","ring","cedilla","hungarumlaut","ogonek","caron","Lslash","lslash","Scaron","scaron","Zcaron","zcaron","brokenbar","Eth","eth","Yacute","yacute","Thorn","thorn","minus","multiply","onesuperior","twosuperior","threesuperior","onehalf","onequarter","threequarters","franc","Gbreve","gbreve","Idotaccent","Scedilla","scedilla","Cacute","cacute","Ccaron","ccaron","dcroat"];function mR(t){this.font=t}mR.prototype.charToGlyphIndex=function(t){var e=t.codePointAt(0),r=this.font.glyphs;if(r){for(var n=0;n<r.length;n+=1)for(var i=r.get(n),a=0;a<i.unicodes.length;a+=1)if(i.unicodes[a]===e)return n}return null};function gR(t){this.cmap=t}gR.prototype.charToGlyphIndex=function(t){return this.cmap.glyphIndexMap[t.codePointAt(0)]||0};function Tx(t,e){this.encoding=t,this.charset=e}Tx.prototype.charToGlyphIndex=function(t){var e=t.codePointAt(0),r=this.encoding[e];return this.charset.indexOf(r)};function G_(t){switch(t.version){case 1:this.names=th.slice();break;case 2:this.names=new Array(t.numberOfGlyphs);for(var e=0;e<t.numberOfGlyphs;e++)t.glyphNameIndex[e]<th.length?this.names[e]=th[t.glyphNameIndex[e]]:this.names[e]=t.names[t.glyphNameIndex[e]-th.length];break;case 2.5:this.names=new Array(t.numberOfGlyphs);for(var r=0;r<t.numberOfGlyphs;r++)this.names[r]=th[r+t.glyphNameIndex[r]];break;case 3:this.names=[];break;default:this.names=[];break}}G_.prototype.nameToGlyphIndex=function(t){return this.names.indexOf(t)};G_.prototype.glyphIndexToName=function(t){return this.names[t]};function WW(t){for(var e,r=t.tables.cmap.glyphIndexMap,n=Object.keys(r),i=0;i<n.length;i+=1){var a=n[i],s=r[a];e=t.glyphs.get(s),e.addUnicode(parseInt(a))}for(var o=0;o<t.glyphs.length;o+=1)e=t.glyphs.get(o),t.cffEncoding?t.isCIDFont?e.name="gid"+o:e.name=t.cffEncoding.charset[o]:t.glyphNames.names&&(e.name=t.glyphNames.glyphIndexToName(o))}function qW(t){t._IndexToUnicodeMap={};for(var e=t.tables.cmap.glyphIndexMap,r=Object.keys(e),n=0;n<r.length;n+=1){var i=r[n],a=e[i];t._IndexToUnicodeMap[a]===void 0?t._IndexToUnicodeMap[a]={unicodes:[parseInt(i)]}:t._IndexToUnicodeMap[a].unicodes.push(parseInt(i))}}function $W(t,e){e.lowMemory?qW(t):WW(t)}function KW(t,e,r,n,i){t.beginPath(),t.moveTo(e,r),t.lineTo(n,i),t.stroke()}var Kf={line:KW};function ZW(t,e){var r=e||new ii;return{configurable:!0,get:function(){return typeof r=="function"&&(r=r()),r},set:function(n){r=n}}}function ss(t){this.bindConstructorValues(t)}ss.prototype.bindConstructorValues=function(t){this.index=t.index||0,this.name=t.name||null,this.unicode=t.unicode||void 0,this.unicodes=t.unicodes||t.unicode!==void 0?[t.unicode]:[],"xMin"in t&&(this.xMin=t.xMin),"yMin"in t&&(this.yMin=t.yMin),"xMax"in t&&(this.xMax=t.xMax),"yMax"in t&&(this.yMax=t.yMax),"advanceWidth"in t&&(this.advanceWidth=t.advanceWidth),Object.defineProperty(this,"path",ZW(this,t.path))};ss.prototype.addUnicode=function(t){this.unicodes.length===0&&(this.unicode=t),this.unicodes.push(t)};ss.prototype.getBoundingBox=function(){return this.path.getBoundingBox()};ss.prototype.getPath=function(t,e,r,n,i){t=t!==void 0?t:0,e=e!==void 0?e:0,r=r!==void 0?r:72;var a,s;n||(n={});var o=n.xScale,l=n.yScale;if(n.hinting&&i&&i.hinting&&(s=this.path&&i.hinting.exec(this,r)),s)a=i.hinting.getCommands(s),t=Math.round(t),e=Math.round(e),o=l=1;else{a=this.path.commands;var u=1/(this.path.unitsPerEm||1e3)*r;o===void 0&&(o=u),l===void 0&&(l=u)}for(var c=new ii,f=0;f<a.length;f+=1){var p=a[f];p.type==="M"?c.moveTo(t+p.x*o,e+-p.y*l):p.type==="L"?c.lineTo(t+p.x*o,e+-p.y*l):p.type==="Q"?c.quadraticCurveTo(t+p.x1*o,e+-p.y1*l,t+p.x*o,e+-p.y*l):p.type==="C"?c.curveTo(t+p.x1*o,e+-p.y1*l,t+p.x2*o,e+-p.y2*l,t+p.x*o,e+-p.y*l):p.type==="Z"&&c.closePath()}return c};ss.prototype.getContours=function(){if(this.points===void 0)return[];for(var t=[],e=[],r=0;r<this.points.length;r+=1){var n=this.points[r];e.push(n),n.lastPointOfContour&&(t.push(e),e=[])}return ir.argument(e.length===0,"There are still points left in the current contour."),t};ss.prototype.getMetrics=function(){for(var t=this.path.commands,e=[],r=[],n=0;n<t.length;n+=1){var i=t[n];i.type!=="Z"&&(e.push(i.x),r.push(i.y)),(i.type==="Q"||i.type==="C")&&(e.push(i.x1),r.push(i.y1)),i.type==="C"&&(e.push(i.x2),r.push(i.y2))}var a={xMin:Math.min.apply(null,e),yMin:Math.min.apply(null,r),xMax:Math.max.apply(null,e),yMax:Math.max.apply(null,r),leftSideBearing:this.leftSideBearing};return isFinite(a.xMin)||(a.xMin=0),isFinite(a.xMax)||(a.xMax=this.advanceWidth),isFinite(a.yMin)||(a.yMin=0),isFinite(a.yMax)||(a.yMax=0),a.rightSideBearing=this.advanceWidth-a.leftSideBearing-(a.xMax-a.xMin),a};ss.prototype.draw=function(t,e,r,n,i){this.getPath(e,r,n,i).draw(t)};ss.prototype.drawPoints=function(t,e,r,n){function i(f,p,v,y){t.beginPath();for(var S=0;S<f.length;S+=1)t.moveTo(p+f[S].x*y,v+f[S].y*y),t.arc(p+f[S].x*y,v+f[S].y*y,2,0,Math.PI*2,!1);t.closePath(),t.fill()}e=e!==void 0?e:0,r=r!==void 0?r:0,n=n!==void 0?n:24;for(var a=1/this.path.unitsPerEm*n,s=[],o=[],l=this.path,u=0;u<l.commands.length;u+=1){var c=l.commands[u];c.x!==void 0&&s.push({x:c.x,y:-c.y}),c.x1!==void 0&&o.push({x:c.x1,y:-c.y1}),c.x2!==void 0&&o.push({x:c.x2,y:-c.y2})}t.fillStyle="blue",i(s,e,r,a),t.fillStyle="red",i(o,e,r,a)};ss.prototype.drawMetrics=function(t,e,r,n){var i;e=e!==void 0?e:0,r=r!==void 0?r:0,n=n!==void 0?n:24,i=1/this.path.unitsPerEm*n,t.lineWidth=1,t.strokeStyle="black",Kf.line(t,e,-1e4,e,1e4),Kf.line(t,-1e4,r,1e4,r);var a=this.xMin||0,s=this.yMin||0,o=this.xMax||0,l=this.yMax||0,u=this.advanceWidth||0;t.strokeStyle="blue",Kf.line(t,e+a*i,-1e4,e+a*i,1e4),Kf.line(t,e+o*i,-1e4,e+o*i,1e4),Kf.line(t,-1e4,r+-s*i,1e4,r+-s*i),Kf.line(t,-1e4,r+-l*i,1e4,r+-l*i),t.strokeStyle="green",Kf.line(t,e+u*i,-1e4,e+u*i,1e4)};function Sy(t,e,r){Object.defineProperty(t,e,{get:function(){return t.path,t[r]},set:function(n){t[r]=n},enumerable:!0,configurable:!0})}function V_(t,e){if(this.font=t,this.glyphs={},Array.isArray(e))for(var r=0;r<e.length;r++){var n=e[r];n.path.unitsPerEm=t.unitsPerEm,this.glyphs[r]=n}this.length=e&&e.length||0}V_.prototype.get=function(t){if(this.glyphs[t]===void 0){this.font._push(t),typeof this.glyphs[t]=="function"&&(this.glyphs[t]=this.glyphs[t]());var e=this.glyphs[t],r=this.font._IndexToUnicodeMap[t];if(r)for(var n=0;n<r.unicodes.length;n++)e.addUnicode(r.unicodes[n]);this.font.cffEncoding?this.font.isCIDFont?e.name="gid"+t:e.name=this.font.cffEncoding.charset[t]:this.font.glyphNames.names&&(e.name=this.font.glyphNames.glyphIndexToName(t)),this.glyphs[t].advanceWidth=this.font._hmtxTableData[t].advanceWidth,this.glyphs[t].leftSideBearing=this.font._hmtxTableData[t].leftSideBearing}else typeof this.glyphs[t]=="function"&&(this.glyphs[t]=this.glyphs[t]());return this.glyphs[t]};V_.prototype.push=function(t,e){this.glyphs[t]=e,this.length++};function YW(t,e){return new ss({index:e,font:t})}function XW(t,e,r,n,i,a){return function(){var s=new ss({index:e,font:t});return s.path=function(){r(s,n,i);var o=a(t.glyphs,s);return o.unitsPerEm=t.unitsPerEm,o},Sy(s,"xMin","_xMin"),Sy(s,"xMax","_xMax"),Sy(s,"yMin","_yMin"),Sy(s,"yMax","_yMax"),s}}function QW(t,e,r,n){return function(){var i=new ss({index:e,font:t});return i.path=function(){var a=r(t,i,n);return a.unitsPerEm=t.unitsPerEm,a},i}}var Su={GlyphSet:V_,glyphLoader:YW,ttfGlyphLoader:XW,cffGlyphLoader:QW};function vR(t,e){if(t===e)return!0;if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return!1;for(var r=0;r<t.length;r+=1)if(!vR(t[r],e[r]))return!1;return!0}else return!1}function hk(t){var e;return t.length<1240?e=107:t.length<33900?e=1131:e=32768,e}function Ed(t,e,r){var n=[],i=[],a=Dt.getCard16(t,e),s,o;if(a!==0){var l=Dt.getByte(t,e+2);s=e+(a+1)*l+2;for(var u=e+3,c=0;c<a+1;c+=1)n.push(Dt.getOffset(t,u,l)),u+=l;o=s+n[a]}else o=e+2;for(var f=0;f<n.length-1;f+=1){var p=Dt.getBytes(t,s+n[f],s+n[f+1]);r&&(p=r(p)),i.push(p)}return{objects:i,startOffset:e,endOffset:o}}function JW(t,e){var r=[],n=Dt.getCard16(t,e),i,a;if(n!==0){var s=Dt.getByte(t,e+2);i=e+(n+1)*s+2;for(var o=e+3,l=0;l<n+1;l+=1)r.push(Dt.getOffset(t,o,s)),o+=s;a=i+r[n]}else a=e+2;return{offsets:r,startOffset:e,endOffset:a}}function eq(t,e,r,n,i){var a=Dt.getCard16(r,n),s=0;if(a!==0){var o=Dt.getByte(r,n+2);s=n+(a+1)*o+2}var l=Dt.getBytes(r,s+e[t],s+e[t+1]);return l}function tq(t){for(var e="",r=15,n=["0","1","2","3","4","5","6","7","8","9",".","E","E-",null,"-"];;){var i=t.parseByte(),a=i>>4,s=i&15;if(a===r||(e+=n[a],s===r))break;e+=n[s]}return parseFloat(e)}function rq(t,e){var r,n,i,a;if(e===28)return r=t.parseByte(),n=t.parseByte(),r<<8|n;if(e===29)return r=t.parseByte(),n=t.parseByte(),i=t.parseByte(),a=t.parseByte(),r<<24|n<<16|i<<8|a;if(e===30)return tq(t);if(e>=32&&e<=246)return e-139;if(e>=247&&e<=250)return r=t.parseByte(),(e-247)*256+r+108;if(e>=251&&e<=254)return r=t.parseByte(),-(e-251)*256-r-108;throw new Error("Invalid b0 "+e)}function nq(t){for(var e={},r=0;r<t.length;r+=1){var n=t[r][0],i=t[r][1],a=void 0;if(i.length===1?a=i[0]:a=i,e.hasOwnProperty(n)&&!isNaN(e[n]))throw new Error("Object "+e+" already has key "+n);e[n]=a}return e}function yR(t,e,r){e=e!==void 0?e:0;var n=new Dt.Parser(t,e),i=[],a=[];for(r=r!==void 0?r:t.length;n.relativeOffset<r;){var s=n.parseByte();s<=21?(s===12&&(s=1200+n.parseByte()),i.push([s,a]),a=[]):a.push(rq(n,s))}return nq(i)}function sv(t,e){return e<=390?e=Xy[e]:e=t[e-391],e}function xR(t,e,r){for(var n={},i,a=0;a<e.length;a+=1){var s=e[a];if(Array.isArray(s.type)){var o=[];o.length=s.type.length;for(var l=0;l<s.type.length;l++)i=t[s.op]!==void 0?t[s.op][l]:void 0,i===void 0&&(i=s.value!==void 0&&s.value[l]!==void 0?s.value[l]:null),s.type[l]==="SID"&&(i=sv(r,i)),o[l]=i;n[s.name]=o}else i=t[s.op],i===void 0&&(i=s.value!==void 0?s.value:null),s.type==="SID"&&(i=sv(r,i)),n[s.name]=i}return n}function iq(t,e){var r={};return r.formatMajor=Dt.getCard8(t,e),r.formatMinor=Dt.getCard8(t,e+1),r.size=Dt.getCard8(t,e+2),r.offsetSize=Dt.getCard8(t,e+3),r.startOffset=e,r.endOffset=e+4,r}var bR=[{name:"version",op:0,type:"SID"},{name:"notice",op:1,type:"SID"},{name:"copyright",op:1200,type:"SID"},{name:"fullName",op:2,type:"SID"},{name:"familyName",op:3,type:"SID"},{name:"weight",op:4,type:"SID"},{name:"isFixedPitch",op:1201,type:"number",value:0},{name:"italicAngle",op:1202,type:"number",value:0},{name:"underlinePosition",op:1203,type:"number",value:-100},{name:"underlineThickness",op:1204,type:"number",value:50},{name:"paintType",op:1205,type:"number",value:0},{name:"charstringType",op:1206,type:"number",value:2},{name:"fontMatrix",op:1207,type:["real","real","real","real","real","real"],value:[.001,0,0,.001,0,0]},{name:"uniqueId",op:13,type:"number"},{name:"fontBBox",op:5,type:["number","number","number","number"],value:[0,0,0,0]},{name:"strokeWidth",op:1208,type:"number",value:0},{name:"xuid",op:14,type:[],value:null},{name:"charset",op:15,type:"offset",value:0},{name:"encoding",op:16,type:"offset",value:0},{name:"charStrings",op:17,type:"offset",value:0},{name:"private",op:18,type:["number","offset"],value:[0,0]},{name:"ros",op:1230,type:["SID","SID","number"]},{name:"cidFontVersion",op:1231,type:"number",value:0},{name:"cidFontRevision",op:1232,type:"number",value:0},{name:"cidFontType",op:1233,type:"number",value:0},{name:"cidCount",op:1234,type:"number",value:8720},{name:"uidBase",op:1235,type:"number"},{name:"fdArray",op:1236,type:"offset"},{name:"fdSelect",op:1237,type:"offset"},{name:"fontName",op:1238,type:"SID"}],wR=[{name:"subrs",op:19,type:"offset",value:0},{name:"defaultWidthX",op:20,type:"number",value:0},{name:"nominalWidthX",op:21,type:"number",value:0}];function aq(t,e){var r=yR(t,0,t.byteLength);return xR(r,bR,e)}function SR(t,e,r,n){var i=yR(t,e,r);return xR(i,wR,n)}function K4(t,e,r,n){for(var i=[],a=0;a<r.length;a+=1){var s=new DataView(new Uint8Array(r[a]).buffer),o=aq(s,n);o._subrs=[],o._subrsBias=0,o._defaultWidthX=0,o._nominalWidthX=0;var l=o.private[0],u=o.private[1];if(l!==0&&u!==0){var c=SR(t,u+e,l,n);if(o._defaultWidthX=c.defaultWidthX,o._nominalWidthX=c.nominalWidthX,c.subrs!==0){var f=u+c.subrs,p=Ed(t,f+e);o._subrs=p.objects,o._subrsBias=hk(o._subrs)}o._privateDict=c}i.push(o)}return i}function sq(t,e,r,n){var i,a,s=new Dt.Parser(t,e);r-=1;var o=[".notdef"],l=s.parseCard8();if(l===0)for(var u=0;u<r;u+=1)i=s.parseSID(),o.push(sv(n,i));else if(l===1)for(;o.length<=r;){i=s.parseSID(),a=s.parseCard8();for(var c=0;c<=a;c+=1)o.push(sv(n,i)),i+=1}else if(l===2)for(;o.length<=r;){i=s.parseSID(),a=s.parseCard16();for(var f=0;f<=a;f+=1)o.push(sv(n,i)),i+=1}else throw new Error("Unknown charset format "+l);return o}function oq(t,e,r){var n,i={},a=new Dt.Parser(t,e),s=a.parseCard8();if(s===0)for(var o=a.parseCard8(),l=0;l<o;l+=1)n=a.parseCard8(),i[n]=l;else if(s===1){var u=a.parseCard8();n=1;for(var c=0;c<u;c+=1)for(var f=a.parseCard8(),p=a.parseCard8(),v=f;v<=f+p;v+=1)i[v]=n,n+=1}else throw new Error("Unknown encoding format "+s);return new Tx(i,r)}function Z4(t,e,r){var n,i,a,s,o=new ii,l=[],u=0,c=!1,f=!1,p=0,v=0,y,S,w,T;if(t.isCIDFont){var _=t.tables.cff.topDict._fdSelect[e.index],C=t.tables.cff.topDict._fdArray[_];y=C._subrs,S=C._subrsBias,w=C._defaultWidthX,T=C._nominalWidthX}else y=t.tables.cff.topDict._subrs,S=t.tables.cff.topDict._subrsBias,w=t.tables.cff.topDict._defaultWidthX,T=t.tables.cff.topDict._nominalWidthX;var N=w;function A(D,F){f&&o.closePath(),o.moveTo(D,F),f=!0}function O(){var D;D=l.length%2!==0,D&&!c&&(N=l.shift()+T),u+=l.length>>1,l.length=0,c=!0}function j(D){for(var F,B,$,Z,I,q,U,W,Y,Q,ne,re,H=0;H<D.length;){var te=D[H];switch(H+=1,te){case 1:O();break;case 3:O();break;case 4:l.length>1&&!c&&(N=l.shift()+T,c=!0),v+=l.pop(),A(p,v);break;case 5:for(;l.length>0;)p+=l.shift(),v+=l.shift(),o.lineTo(p,v);break;case 6:for(;l.length>0&&(p+=l.shift(),o.lineTo(p,v),l.length!==0);)v+=l.shift(),o.lineTo(p,v);break;case 7:for(;l.length>0&&(v+=l.shift(),o.lineTo(p,v),l.length!==0);)p+=l.shift(),o.lineTo(p,v);break;case 8:for(;l.length>0;)n=p+l.shift(),i=v+l.shift(),a=n+l.shift(),s=i+l.shift(),p=a+l.shift(),v=s+l.shift(),o.curveTo(n,i,a,s,p,v);break;case 10:I=l.pop()+S,q=y[I],q&&j(q);break;case 11:return;case 12:switch(te=D[H],H+=1,te){case 35:n=p+l.shift(),i=v+l.shift(),a=n+l.shift(),s=i+l.shift(),U=a+l.shift(),W=s+l.shift(),Y=U+l.shift(),Q=W+l.shift(),ne=Y+l.shift(),re=Q+l.shift(),p=ne+l.shift(),v=re+l.shift(),l.shift(),o.curveTo(n,i,a,s,U,W),o.curveTo(Y,Q,ne,re,p,v);break;case 34:n=p+l.shift(),i=v,a=n+l.shift(),s=i+l.shift(),U=a+l.shift(),W=s,Y=U+l.shift(),Q=s,ne=Y+l.shift(),re=v,p=ne+l.shift(),o.curveTo(n,i,a,s,U,W),o.curveTo(Y,Q,ne,re,p,v);break;case 36:n=p+l.shift(),i=v+l.shift(),a=n+l.shift(),s=i+l.shift(),U=a+l.shift(),W=s,Y=U+l.shift(),Q=s,ne=Y+l.shift(),re=Q+l.shift(),p=ne+l.shift(),o.curveTo(n,i,a,s,U,W),o.curveTo(Y,Q,ne,re,p,v);break;case 37:n=p+l.shift(),i=v+l.shift(),a=n+l.shift(),s=i+l.shift(),U=a+l.shift(),W=s+l.shift(),Y=U+l.shift(),Q=W+l.shift(),ne=Y+l.shift(),re=Q+l.shift(),Math.abs(ne-p)>Math.abs(re-v)?p=ne+l.shift():v=re+l.shift(),o.curveTo(n,i,a,s,U,W),o.curveTo(Y,Q,ne,re,p,v);break;default:console.log("Glyph "+e.index+": unknown operator 1200"+te),l.length=0}break;case 14:l.length>0&&!c&&(N=l.shift()+T,c=!0),f&&(o.closePath(),f=!1);break;case 18:O();break;case 19:case 20:O(),H+=u+7>>3;break;case 21:l.length>2&&!c&&(N=l.shift()+T,c=!0),v+=l.pop(),p+=l.pop(),A(p,v);break;case 22:l.length>1&&!c&&(N=l.shift()+T,c=!0),p+=l.pop(),A(p,v);break;case 23:O();break;case 24:for(;l.length>2;)n=p+l.shift(),i=v+l.shift(),a=n+l.shift(),s=i+l.shift(),p=a+l.shift(),v=s+l.shift(),o.curveTo(n,i,a,s,p,v);p+=l.shift(),v+=l.shift(),o.lineTo(p,v);break;case 25:for(;l.length>6;)p+=l.shift(),v+=l.shift(),o.lineTo(p,v);n=p+l.shift(),i=v+l.shift(),a=n+l.shift(),s=i+l.shift(),p=a+l.shift(),v=s+l.shift(),o.curveTo(n,i,a,s,p,v);break;case 26:for(l.length%2&&(p+=l.shift());l.length>0;)n=p,i=v+l.shift(),a=n+l.shift(),s=i+l.shift(),p=a,v=s+l.shift(),o.curveTo(n,i,a,s,p,v);break;case 27:for(l.length%2&&(v+=l.shift());l.length>0;)n=p+l.shift(),i=v,a=n+l.shift(),s=i+l.shift(),p=a+l.shift(),v=s,o.curveTo(n,i,a,s,p,v);break;case 28:F=D[H],B=D[H+1],l.push((F<<24|B<<16)>>16),H+=2;break;case 29:I=l.pop()+t.gsubrsBias,q=t.gsubrs[I],q&&j(q);break;case 30:for(;l.length>0&&(n=p,i=v+l.shift(),a=n+l.shift(),s=i+l.shift(),p=a+l.shift(),v=s+(l.length===1?l.shift():0),o.curveTo(n,i,a,s,p,v),l.length!==0);)n=p+l.shift(),i=v,a=n+l.shift(),s=i+l.shift(),v=s+l.shift(),p=a+(l.length===1?l.shift():0),o.curveTo(n,i,a,s,p,v);break;case 31:for(;l.length>0&&(n=p+l.shift(),i=v,a=n+l.shift(),s=i+l.shift(),v=s+l.shift(),p=a+(l.length===1?l.shift():0),o.curveTo(n,i,a,s,p,v),l.length!==0);)n=p,i=v+l.shift(),a=n+l.shift(),s=i+l.shift(),p=a+l.shift(),v=s+(l.length===1?l.shift():0),o.curveTo(n,i,a,s,p,v);break;default:te<32?console.log("Glyph "+e.index+": unknown operator "+te):te<247?l.push(te-139):te<251?(F=D[H],H+=1,l.push((te-247)*256+F+108)):te<255?(F=D[H],H+=1,l.push(-(te-251)*256-F-108)):(F=D[H],B=D[H+1],$=D[H+2],Z=D[H+3],H+=4,l.push((F<<24|B<<16|$<<8|Z)/65536))}}}return j(r),e.advanceWidth=N,o}function lq(t,e,r,n){var i=[],a,s=new Dt.Parser(t,e),o=s.parseCard8();if(o===0)for(var l=0;l<r;l++){if(a=s.parseCard8(),a>=n)throw new Error("CFF table CID Font FDSelect has bad FD index value "+a+" (FD count "+n+")");i.push(a)}else if(o===3){var u=s.parseCard16(),c=s.parseCard16();if(c!==0)throw new Error("CFF Table CID Font FDSelect format 3 range has bad initial GID "+c);for(var f,p=0;p<u;p++){if(a=s.parseCard8(),f=s.parseCard16(),a>=n)throw new Error("CFF table CID Font FDSelect has bad FD index value "+a+" (FD count "+n+")");if(f>r)throw new Error("CFF Table CID Font FDSelect format 3 range has bad GID "+f);for(;c<f;c++)i.push(a);c=f}if(f!==r)throw new Error("CFF Table CID Font FDSelect format 3 range has bad final GID "+f)}else throw new Error("CFF Table CID Font FDSelect table has unsupported format "+o);return i}function uq(t,e,r,n){r.tables.cff={};var i=iq(t,e),a=Ed(t,i.endOffset,Dt.bytesToString),s=Ed(t,a.endOffset),o=Ed(t,s.endOffset,Dt.bytesToString),l=Ed(t,o.endOffset);r.gsubrs=l.objects,r.gsubrsBias=hk(r.gsubrs);var u=K4(t,e,s.objects,o.objects);if(u.length!==1)throw new Error("CFF table has too many fonts in 'FontSet' - count of fonts NameIndex.length = "+u.length);var c=u[0];if(r.tables.cff.topDict=c,c._privateDict&&(r.defaultWidthX=c._privateDict.defaultWidthX,r.nominalWidthX=c._privateDict.nominalWidthX),c.ros[0]!==void 0&&c.ros[1]!==void 0&&(r.isCIDFont=!0),r.isCIDFont){var f=c.fdArray,p=c.fdSelect;if(f===0||p===0)throw new Error("Font is marked as a CID font, but FDArray and/or FDSelect information is missing");f+=e;var v=Ed(t,f),y=K4(t,e,v.objects,o.objects);c._fdArray=y,p+=e,c._fdSelect=lq(t,p,r.numGlyphs,y.length)}var S=e+c.private[1],w=SR(t,S,c.private[0],o.objects);if(r.defaultWidthX=w.defaultWidthX,r.nominalWidthX=w.nominalWidthX,w.subrs!==0){var T=S+w.subrs,_=Ed(t,T);r.subrs=_.objects,r.subrsBias=hk(r.subrs)}else r.subrs=[],r.subrsBias=0;var C;n.lowMemory?(C=JW(t,e+c.charStrings),r.nGlyphs=C.offsets.length):(C=Ed(t,e+c.charStrings),r.nGlyphs=C.objects.length);var N=sq(t,e+c.charset,r.nGlyphs,o.objects);if(c.encoding===0?r.cffEncoding=new Tx(VW,N):c.encoding===1?r.cffEncoding=new Tx(HW,N):r.cffEncoding=oq(t,e+c.encoding,N),r.encoding=r.encoding||r.cffEncoding,r.glyphs=new Su.GlyphSet(r),n.lowMemory)r._push=function(j){var D=eq(j,C.offsets,t,e+c.charStrings);r.glyphs.push(j,Su.cffGlyphLoader(r,j,Z4,D))};else for(var A=0;A<r.nGlyphs;A+=1){var O=C.objects[A];r.glyphs.push(A,Su.cffGlyphLoader(r,A,Z4,O))}}function kR(t,e){var r,n=Xy.indexOf(t);return n>=0&&(r=n),n=e.indexOf(t),n>=0?r=n+Xy.length:(r=Xy.length+e.length,e.push(t)),r}function cq(){return new Mt.Record("Header",[{name:"major",type:"Card8",value:1},{name:"minor",type:"Card8",value:0},{name:"hdrSize",type:"Card8",value:4},{name:"major",type:"Card8",value:1}])}function dq(t){var e=new Mt.Record("Name INDEX",[{name:"names",type:"INDEX",value:[]}]);e.names=[];for(var r=0;r<t.length;r+=1)e.names.push({name:"name_"+r,type:"NAME",value:t[r]});return e}function _R(t,e,r){for(var n={},i=0;i<t.length;i+=1){var a=t[i],s=e[a.name];s!==void 0&&!vR(s,a.value)&&(a.type==="SID"&&(s=kR(s,r)),n[a.op]={name:a.name,type:a.type,value:s})}return n}function Y4(t,e){var r=new Mt.Record("Top DICT",[{name:"dict",type:"DICT",value:{}}]);return r.dict=_R(bR,t,e),r}function X4(t){var e=new Mt.Record("Top DICT INDEX",[{name:"topDicts",type:"INDEX",value:[]}]);return e.topDicts=[{name:"topDict_0",type:"TABLE",value:t}],e}function fq(t){var e=new Mt.Record("String INDEX",[{name:"strings",type:"INDEX",value:[]}]);e.strings=[];for(var r=0;r<t.length;r+=1)e.strings.push({name:"string_"+r,type:"STRING",value:t[r]});return e}function hq(){return new Mt.Record("Global Subr INDEX",[{name:"subrs",type:"INDEX",value:[]}])}function pq(t,e){for(var r=new Mt.Record("Charsets",[{name:"format",type:"Card8",value:0}]),n=0;n<t.length;n+=1){var i=t[n],a=kR(i,e);r.fields.push({name:"glyph_"+n,type:"SID",value:a})}return r}function mq(t){var e=[],r=t.path;e.push({name:"width",type:"NUMBER",value:t.advanceWidth});for(var n=0,i=0,a=0;a<r.commands.length;a+=1){var s=void 0,o=void 0,l=r.commands[a];if(l.type==="Q"){var u=.3333333333333333,c=2/3;l={type:"C",x:l.x,y:l.y,x1:Math.round(u*n+c*l.x1),y1:Math.round(u*i+c*l.y1),x2:Math.round(u*l.x+c*l.x1),y2:Math.round(u*l.y+c*l.y1)}}if(l.type==="M")s=Math.round(l.x-n),o=Math.round(l.y-i),e.push({name:"dx",type:"NUMBER",value:s}),e.push({name:"dy",type:"NUMBER",value:o}),e.push({name:"rmoveto",type:"OP",value:21}),n=Math.round(l.x),i=Math.round(l.y);else if(l.type==="L")s=Math.round(l.x-n),o=Math.round(l.y-i),e.push({name:"dx",type:"NUMBER",value:s}),e.push({name:"dy",type:"NUMBER",value:o}),e.push({name:"rlineto",type:"OP",value:5}),n=Math.round(l.x),i=Math.round(l.y);else if(l.type==="C"){var f=Math.round(l.x1-n),p=Math.round(l.y1-i),v=Math.round(l.x2-l.x1),y=Math.round(l.y2-l.y1);s=Math.round(l.x-l.x2),o=Math.round(l.y-l.y2),e.push({name:"dx1",type:"NUMBER",value:f}),e.push({name:"dy1",type:"NUMBER",value:p}),e.push({name:"dx2",type:"NUMBER",value:v}),e.push({name:"dy2",type:"NUMBER",value:y}),e.push({name:"dx",type:"NUMBER",value:s}),e.push({name:"dy",type:"NUMBER",value:o}),e.push({name:"rrcurveto",type:"OP",value:8}),n=Math.round(l.x),i=Math.round(l.y)}}return e.push({name:"endchar",type:"OP",value:14}),e}function gq(t){for(var e=new Mt.Record("CharStrings INDEX",[{name:"charStrings",type:"INDEX",value:[]}]),r=0;r<t.length;r+=1){var n=t.get(r),i=mq(n);e.charStrings.push({name:n.name,type:"CHARSTRING",value:i})}return e}function vq(t,e){var r=new Mt.Record("Private DICT",[{name:"dict",type:"DICT",value:{}}]);return r.dict=_R(wR,t,e),r}function yq(t,e){for(var r=new Mt.Table("CFF ",[{name:"header",type:"RECORD"},{name:"nameIndex",type:"RECORD"},{name:"topDictIndex",type:"RECORD"},{name:"stringIndex",type:"RECORD"},{name:"globalSubrIndex",type:"RECORD"},{name:"charsets",type:"RECORD"},{name:"charStringsIndex",type:"RECORD"},{name:"privateDict",type:"RECORD"}]),n=1/e.unitsPerEm,i={version:e.version,fullName:e.fullName,familyName:e.familyName,weight:e.weightName,fontBBox:e.fontBBox||[0,0,0,0],fontMatrix:[n,0,0,n,0,0],charset:999,encoding:0,charStrings:999,private:[0,999]},a={},s=[],o,l=1;l<t.length;l+=1)o=t.get(l),s.push(o.name);var u=[];r.header=cq(),r.nameIndex=dq([e.postScriptName]);var c=Y4(i,u);r.topDictIndex=X4(c),r.globalSubrIndex=hq(),r.charsets=pq(s,u),r.charStringsIndex=gq(t),r.privateDict=vq(a,u),r.stringIndex=fq(u);var f=r.header.sizeOf()+r.nameIndex.sizeOf()+r.topDictIndex.sizeOf()+r.stringIndex.sizeOf()+r.globalSubrIndex.sizeOf();return i.charset=f,i.encoding=0,i.charStrings=i.charset+r.charsets.sizeOf(),i.private[1]=i.charStrings+r.charStringsIndex.sizeOf(),c=Y4(i,u),r.topDictIndex=X4(c),r}var CR={parse:uq,make:yq};function xq(t,e){var r={},n=new Dt.Parser(t,e);return r.version=n.parseVersion(),r.fontRevision=Math.round(n.parseFixed()*1e3)/1e3,r.checkSumAdjustment=n.parseULong(),r.magicNumber=n.parseULong(),ir.argument(r.magicNumber===1594834165,"Font header has wrong magic number."),r.flags=n.parseUShort(),r.unitsPerEm=n.parseUShort(),r.created=n.parseLongDateTime(),r.modified=n.parseLongDateTime(),r.xMin=n.parseShort(),r.yMin=n.parseShort(),r.xMax=n.parseShort(),r.yMax=n.parseShort(),r.macStyle=n.parseUShort(),r.lowestRecPPEM=n.parseUShort(),r.fontDirectionHint=n.parseShort(),r.indexToLocFormat=n.parseShort(),r.glyphDataFormat=n.parseShort(),r}function bq(t){var e=Math.round(new Date().getTime()/1e3)+2082844800,r=e;return t.createdTimestamp&&(r=t.createdTimestamp+2082844800),new Mt.Table("head",[{name:"version",type:"FIXED",value:65536},{name:"fontRevision",type:"FIXED",value:65536},{name:"checkSumAdjustment",type:"ULONG",value:0},{name:"magicNumber",type:"ULONG",value:1594834165},{name:"flags",type:"USHORT",value:0},{name:"unitsPerEm",type:"USHORT",value:1e3},{name:"created",type:"LONGDATETIME",value:r},{name:"modified",type:"LONGDATETIME",value:e},{name:"xMin",type:"SHORT",value:0},{name:"yMin",type:"SHORT",value:0},{name:"xMax",type:"SHORT",value:0},{name:"yMax",type:"SHORT",value:0},{name:"macStyle",type:"USHORT",value:0},{name:"lowestRecPPEM",type:"USHORT",value:0},{name:"fontDirectionHint",type:"SHORT",value:2},{name:"indexToLocFormat",type:"SHORT",value:0},{name:"glyphDataFormat",type:"SHORT",value:0}],t)}var ER={parse:xq,make:bq};function wq(t,e){var r={},n=new Dt.Parser(t,e);return r.version=n.parseVersion(),r.ascender=n.parseShort(),r.descender=n.parseShort(),r.lineGap=n.parseShort(),r.advanceWidthMax=n.parseUShort(),r.minLeftSideBearing=n.parseShort(),r.minRightSideBearing=n.parseShort(),r.xMaxExtent=n.parseShort(),r.caretSlopeRise=n.parseShort(),r.caretSlopeRun=n.parseShort(),r.caretOffset=n.parseShort(),n.relativeOffset+=8,r.metricDataFormat=n.parseShort(),r.numberOfHMetrics=n.parseUShort(),r}function Sq(t){return new Mt.Table("hhea",[{name:"version",type:"FIXED",value:65536},{name:"ascender",type:"FWORD",value:0},{name:"descender",type:"FWORD",value:0},{name:"lineGap",type:"FWORD",value:0},{name:"advanceWidthMax",type:"UFWORD",value:0},{name:"minLeftSideBearing",type:"FWORD",value:0},{name:"minRightSideBearing",type:"FWORD",value:0},{name:"xMaxExtent",type:"FWORD",value:0},{name:"caretSlopeRise",type:"SHORT",value:1},{name:"caretSlopeRun",type:"SHORT",value:0},{name:"caretOffset",type:"SHORT",value:0},{name:"reserved1",type:"SHORT",value:0},{name:"reserved2",type:"SHORT",value:0},{name:"reserved3",type:"SHORT",value:0},{name:"reserved4",type:"SHORT",value:0},{name:"metricDataFormat",type:"SHORT",value:0},{name:"numberOfHMetrics",type:"USHORT",value:0}],t)}var TR={parse:wq,make:Sq};function kq(t,e,r,n,i){for(var a,s,o=new Dt.Parser(t,e),l=0;l<n;l+=1){l<r&&(a=o.parseUShort(),s=o.parseShort());var u=i.get(l);u.advanceWidth=a,u.leftSideBearing=s}}function _q(t,e,r,n,i){t._hmtxTableData={};for(var a,s,o=new Dt.Parser(e,r),l=0;l<i;l+=1)l<n&&(a=o.parseUShort(),s=o.parseShort()),t._hmtxTableData[l]={advanceWidth:a,leftSideBearing:s}}function Cq(t,e,r,n,i,a,s){s.lowMemory?_q(t,e,r,n,i):kq(e,r,n,i,a)}function Eq(t){for(var e=new Mt.Table("hmtx",[]),r=0;r<t.length;r+=1){var n=t.get(r),i=n.advanceWidth||0,a=n.leftSideBearing||0;e.fields.push({name:"advanceWidth_"+r,type:"USHORT",value:i}),e.fields.push({name:"leftSideBearing_"+r,type:"SHORT",value:a})}return e}var NR={parse:Cq,make:Eq};function Tq(t){for(var e=new Mt.Table("ltag",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"numTags",type:"ULONG",value:t.length}]),r="",n=12+t.length*4,i=0;i<t.length;++i){var a=r.indexOf(t[i]);a<0&&(a=r.length,r+=t[i]),e.fields.push({name:"offset "+i,type:"USHORT",value:n+a}),e.fields.push({name:"length "+i,type:"USHORT",value:t[i].length})}return e.fields.push({name:"stringPool",type:"CHARARRAY",value:r}),e}function Nq(t,e){var r=new Dt.Parser(t,e),n=r.parseULong();ir.argument(n===1,"Unsupported ltag table version."),r.skip("uLong",1);for(var i=r.parseULong(),a=[],s=0;s<i;s++){for(var o="",l=e+r.parseUShort(),u=r.parseUShort(),c=l;c<l+u;++c)o+=String.fromCharCode(t.getInt8(c));a.push(o)}return a}var PR={make:Tq,parse:Nq};function Pq(t,e){var r={},n=new Dt.Parser(t,e);return r.version=n.parseVersion(),r.numGlyphs=n.parseUShort(),r.version===1&&(r.maxPoints=n.parseUShort(),r.maxContours=n.parseUShort(),r.maxCompositePoints=n.parseUShort(),r.maxCompositeContours=n.parseUShort(),r.maxZones=n.parseUShort(),r.maxTwilightPoints=n.parseUShort(),r.maxStorage=n.parseUShort(),r.maxFunctionDefs=n.parseUShort(),r.maxInstructionDefs=n.parseUShort(),r.maxStackElements=n.parseUShort(),r.maxSizeOfInstructions=n.parseUShort(),r.maxComponentElements=n.parseUShort(),r.maxComponentDepth=n.parseUShort()),r}function Mq(t){return new Mt.Table("maxp",[{name:"version",type:"FIXED",value:20480},{name:"numGlyphs",type:"USHORT",value:t}])}var MR={parse:Pq,make:Mq},AR=["copyright","fontFamily","fontSubfamily","uniqueID","fullName","version","postScriptName","trademark","manufacturer","designer","description","manufacturerURL","designerURL","license","licenseURL","reserved","preferredFamily","preferredSubfamily","compatibleFullName","sampleText","postScriptFindFontName","wwsFamily","wwsSubfamily"],LR={0:"en",1:"fr",2:"de",3:"it",4:"nl",5:"sv",6:"es",7:"da",8:"pt",9:"no",10:"he",11:"ja",12:"ar",13:"fi",14:"el",15:"is",16:"mt",17:"tr",18:"hr",19:"zh-Hant",20:"ur",21:"hi",22:"th",23:"ko",24:"lt",25:"pl",26:"hu",27:"es",28:"lv",29:"se",30:"fo",31:"fa",32:"ru",33:"zh",34:"nl-BE",35:"ga",36:"sq",37:"ro",38:"cz",39:"sk",40:"si",41:"yi",42:"sr",43:"mk",44:"bg",45:"uk",46:"be",47:"uz",48:"kk",49:"az-Cyrl",50:"az-Arab",51:"hy",52:"ka",53:"mo",54:"ky",55:"tg",56:"tk",57:"mn-CN",58:"mn",59:"ps",60:"ks",61:"ku",62:"sd",63:"bo",64:"ne",65:"sa",66:"mr",67:"bn",68:"as",69:"gu",70:"pa",71:"or",72:"ml",73:"kn",74:"ta",75:"te",76:"si",77:"my",78:"km",79:"lo",80:"vi",81:"id",82:"tl",83:"ms",84:"ms-Arab",85:"am",86:"ti",87:"om",88:"so",89:"sw",90:"rw",91:"rn",92:"ny",93:"mg",94:"eo",128:"cy",129:"eu",130:"ca",131:"la",132:"qu",133:"gn",134:"ay",135:"tt",136:"ug",137:"dz",138:"jv",139:"su",140:"gl",141:"af",142:"br",143:"iu",144:"gd",145:"gv",146:"ga",147:"to",148:"el-polyton",149:"kl",150:"az",151:"nn"},Aq={0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:5,11:1,12:4,13:0,14:6,15:0,16:0,17:0,18:0,19:2,20:4,21:9,22:21,23:3,24:29,25:29,26:29,27:29,28:29,29:0,30:0,31:4,32:7,33:25,34:0,35:0,36:0,37:0,38:29,39:29,40:0,41:5,42:7,43:7,44:7,45:7,46:7,47:7,48:7,49:7,50:4,51:24,52:23,53:7,54:7,55:7,56:7,57:27,58:7,59:4,60:4,61:4,62:4,63:26,64:9,65:9,66:9,67:13,68:13,69:11,70:10,71:12,72:17,73:16,74:14,75:15,76:18,77:19,78:20,79:22,80:30,81:0,82:0,83:0,84:4,85:28,86:28,87:28,88:0,89:0,90:0,91:0,92:0,93:0,94:0,128:0,129:0,130:0,131:0,132:0,133:0,134:0,135:7,136:4,137:26,138:0,139:0,140:0,141:0,142:0,143:28,144:0,145:0,146:0,147:0,148:6,149:0,150:0,151:0},RR={1078:"af",1052:"sq",1156:"gsw",1118:"am",5121:"ar-DZ",15361:"ar-BH",3073:"ar",2049:"ar-IQ",11265:"ar-JO",13313:"ar-KW",12289:"ar-LB",4097:"ar-LY",6145:"ary",8193:"ar-OM",16385:"ar-QA",1025:"ar-SA",10241:"ar-SY",7169:"aeb",14337:"ar-AE",9217:"ar-YE",1067:"hy",1101:"as",2092:"az-Cyrl",1068:"az",1133:"ba",1069:"eu",1059:"be",2117:"bn",1093:"bn-IN",8218:"bs-Cyrl",5146:"bs",1150:"br",1026:"bg",1027:"ca",3076:"zh-HK",5124:"zh-MO",2052:"zh",4100:"zh-SG",1028:"zh-TW",1155:"co",1050:"hr",4122:"hr-BA",1029:"cs",1030:"da",1164:"prs",1125:"dv",2067:"nl-BE",1043:"nl",3081:"en-AU",10249:"en-BZ",4105:"en-CA",9225:"en-029",16393:"en-IN",6153:"en-IE",8201:"en-JM",17417:"en-MY",5129:"en-NZ",13321:"en-PH",18441:"en-SG",7177:"en-ZA",11273:"en-TT",2057:"en-GB",1033:"en",12297:"en-ZW",1061:"et",1080:"fo",1124:"fil",1035:"fi",2060:"fr-BE",3084:"fr-CA",1036:"fr",5132:"fr-LU",6156:"fr-MC",4108:"fr-CH",1122:"fy",1110:"gl",1079:"ka",3079:"de-AT",1031:"de",5127:"de-LI",4103:"de-LU",2055:"de-CH",1032:"el",1135:"kl",1095:"gu",1128:"ha",1037:"he",1081:"hi",1038:"hu",1039:"is",1136:"ig",1057:"id",1117:"iu",2141:"iu-Latn",2108:"ga",1076:"xh",1077:"zu",1040:"it",2064:"it-CH",1041:"ja",1099:"kn",1087:"kk",1107:"km",1158:"quc",1159:"rw",1089:"sw",1111:"kok",1042:"ko",1088:"ky",1108:"lo",1062:"lv",1063:"lt",2094:"dsb",1134:"lb",1071:"mk",2110:"ms-BN",1086:"ms",1100:"ml",1082:"mt",1153:"mi",1146:"arn",1102:"mr",1148:"moh",1104:"mn",2128:"mn-CN",1121:"ne",1044:"nb",2068:"nn",1154:"oc",1096:"or",1123:"ps",1045:"pl",1046:"pt",2070:"pt-PT",1094:"pa",1131:"qu-BO",2155:"qu-EC",3179:"qu",1048:"ro",1047:"rm",1049:"ru",9275:"smn",4155:"smj-NO",5179:"smj",3131:"se-FI",1083:"se",2107:"se-SE",8251:"sms",6203:"sma-NO",7227:"sms",1103:"sa",7194:"sr-Cyrl-BA",3098:"sr",6170:"sr-Latn-BA",2074:"sr-Latn",1132:"nso",1074:"tn",1115:"si",1051:"sk",1060:"sl",11274:"es-AR",16394:"es-BO",13322:"es-CL",9226:"es-CO",5130:"es-CR",7178:"es-DO",12298:"es-EC",17418:"es-SV",4106:"es-GT",18442:"es-HN",2058:"es-MX",19466:"es-NI",6154:"es-PA",15370:"es-PY",10250:"es-PE",20490:"es-PR",3082:"es",1034:"es",21514:"es-US",14346:"es-UY",8202:"es-VE",2077:"sv-FI",1053:"sv",1114:"syr",1064:"tg",2143:"tzm",1097:"ta",1092:"tt",1098:"te",1054:"th",1105:"bo",1055:"tr",1090:"tk",1152:"ug",1058:"uk",1070:"hsb",1056:"ur",2115:"uz-Cyrl",1091:"uz",1066:"vi",1106:"cy",1160:"wo",1157:"sah",1144:"ii",1130:"yo"};function Lq(t,e,r){switch(t){case 0:if(e===65535)return"und";if(r)return r[e];break;case 1:return LR[e];case 3:return RR[e]}}var pk="utf-16",Rq={0:"macintosh",1:"x-mac-japanese",2:"x-mac-chinesetrad",3:"x-mac-korean",6:"x-mac-greek",7:"x-mac-cyrillic",9:"x-mac-devanagai",10:"x-mac-gurmukhi",11:"x-mac-gujarati",12:"x-mac-oriya",13:"x-mac-bengali",14:"x-mac-tamil",15:"x-mac-telugu",16:"x-mac-kannada",17:"x-mac-malayalam",18:"x-mac-sinhalese",19:"x-mac-burmese",20:"x-mac-khmer",21:"x-mac-thai",22:"x-mac-lao",23:"x-mac-georgian",24:"x-mac-armenian",25:"x-mac-chinesesimp",26:"x-mac-tibetan",27:"x-mac-mongolian",28:"x-mac-ethiopic",29:"x-mac-ce",30:"x-mac-vietnamese",31:"x-mac-extarabic"},Oq={15:"x-mac-icelandic",17:"x-mac-turkish",18:"x-mac-croatian",24:"x-mac-ce",25:"x-mac-ce",26:"x-mac-ce",27:"x-mac-ce",28:"x-mac-ce",30:"x-mac-icelandic",37:"x-mac-romanian",38:"x-mac-ce",39:"x-mac-ce",40:"x-mac-ce",143:"x-mac-inuit",146:"x-mac-gaelic"};function OR(t,e,r){switch(t){case 0:return pk;case 1:return Oq[r]||Rq[e];case 3:if(e===1||e===10)return pk;break}}function Dq(t,e,r){for(var n={},i=new Dt.Parser(t,e),a=i.parseUShort(),s=i.parseUShort(),o=i.offset+i.parseUShort(),l=0;l<s;l++){var u=i.parseUShort(),c=i.parseUShort(),f=i.parseUShort(),p=i.parseUShort(),v=AR[p]||p,y=i.parseUShort(),S=i.parseUShort(),w=Lq(u,f,r),T=OR(u,c,f);if(T!==void 0&&w!==void 0){var _=void 0;if(T===pk?_=Xp.UTF16(t,o+S,y):_=Xp.MACSTRING(t,o+S,y,T),_){var C=n[v];C===void 0&&(C=n[v]={}),C[w]=_}}}return a===1&&i.parseUShort(),n}function V2(t){var e={};for(var r in t)e[t[r]]=parseInt(r);return e}function Q4(t,e,r,n,i,a){return new Mt.Record("NameRecord",[{name:"platformID",type:"USHORT",value:t},{name:"encodingID",type:"USHORT",value:e},{name:"languageID",type:"USHORT",value:r},{name:"nameID",type:"USHORT",value:n},{name:"length",type:"USHORT",value:i},{name:"offset",type:"USHORT",value:a}])}function Iq(t,e){var r=t.length,n=e.length-r+1;e:for(var i=0;i<n;i++)for(;i<n;i++){for(var a=0;a<r;a++)if(e[i+a]!==t[a])continue e;return i}return-1}function J4(t,e){var r=Iq(t,e);if(r<0){r=e.length;for(var n=0,i=t.length;n<i;++n)e.push(t[n])}return r}function jq(t,e){var r,n=[],i={},a=V2(AR);for(var s in t){var o=a[s];if(o===void 0&&(o=s),r=parseInt(o),isNaN(r))throw new Error('Name table entry "'+s+'" does not exist, see nameTableNames for complete list.');i[r]=t[s],n.push(r)}for(var l=V2(LR),u=V2(RR),c=[],f=[],p=0;p<n.length;p++){r=n[p];var v=i[r];for(var y in v){var S=v[y],w=1,T=l[y],_=Aq[T],C=OR(w,_,T),N=bt.MACSTRING(S,C);N===void 0&&(w=0,T=e.indexOf(y),T<0&&(T=e.length,e.push(y)),_=4,N=bt.UTF16(S));var A=J4(N,f);c.push(Q4(w,_,T,r,N.length,A));var O=u[y];if(O!==void 0){var j=bt.UTF16(S),D=J4(j,f);c.push(Q4(3,1,O,r,j.length,D))}}}c.sort(function($,Z){return $.platformID-Z.platformID||$.encodingID-Z.encodingID||$.languageID-Z.languageID||$.nameID-Z.nameID});for(var F=new Mt.Table("name",[{name:"format",type:"USHORT",value:0},{name:"count",type:"USHORT",value:c.length},{name:"stringOffset",type:"USHORT",value:6+c.length*12}]),B=0;B<c.length;B++)F.fields.push({name:"record_"+B,type:"RECORD",value:c[B]});return F.fields.push({name:"strings",type:"LITERAL",value:f}),F}var DR={parse:Dq,make:jq},mk=[{begin:0,end:127},{begin:128,end:255},{begin:256,end:383},{begin:384,end:591},{begin:592,end:687},{begin:688,end:767},{begin:768,end:879},{begin:880,end:1023},{begin:11392,end:11519},{begin:1024,end:1279},{begin:1328,end:1423},{begin:1424,end:1535},{begin:42240,end:42559},{begin:1536,end:1791},{begin:1984,end:2047},{begin:2304,end:2431},{begin:2432,end:2559},{begin:2560,end:2687},{begin:2688,end:2815},{begin:2816,end:2943},{begin:2944,end:3071},{begin:3072,end:3199},{begin:3200,end:3327},{begin:3328,end:3455},{begin:3584,end:3711},{begin:3712,end:3839},{begin:4256,end:4351},{begin:6912,end:7039},{begin:4352,end:4607},{begin:7680,end:7935},{begin:7936,end:8191},{begin:8192,end:8303},{begin:8304,end:8351},{begin:8352,end:8399},{begin:8400,end:8447},{begin:8448,end:8527},{begin:8528,end:8591},{begin:8592,end:8703},{begin:8704,end:8959},{begin:8960,end:9215},{begin:9216,end:9279},{begin:9280,end:9311},{begin:9312,end:9471},{begin:9472,end:9599},{begin:9600,end:9631},{begin:9632,end:9727},{begin:9728,end:9983},{begin:9984,end:10175},{begin:12288,end:12351},{begin:12352,end:12447},{begin:12448,end:12543},{begin:12544,end:12591},{begin:12592,end:12687},{begin:43072,end:43135},{begin:12800,end:13055},{begin:13056,end:13311},{begin:44032,end:55215},{begin:55296,end:57343},{begin:67840,end:67871},{begin:19968,end:40959},{begin:57344,end:63743},{begin:12736,end:12783},{begin:64256,end:64335},{begin:64336,end:65023},{begin:65056,end:65071},{begin:65040,end:65055},{begin:65104,end:65135},{begin:65136,end:65279},{begin:65280,end:65519},{begin:65520,end:65535},{begin:3840,end:4095},{begin:1792,end:1871},{begin:1920,end:1983},{begin:3456,end:3583},{begin:4096,end:4255},{begin:4608,end:4991},{begin:5024,end:5119},{begin:5120,end:5759},{begin:5760,end:5791},{begin:5792,end:5887},{begin:6016,end:6143},{begin:6144,end:6319},{begin:10240,end:10495},{begin:40960,end:42127},{begin:5888,end:5919},{begin:66304,end:66351},{begin:66352,end:66383},{begin:66560,end:66639},{begin:118784,end:119039},{begin:119808,end:120831},{begin:1044480,end:1048573},{begin:65024,end:65039},{begin:917504,end:917631},{begin:6400,end:6479},{begin:6480,end:6527},{begin:6528,end:6623},{begin:6656,end:6687},{begin:11264,end:11359},{begin:11568,end:11647},{begin:19904,end:19967},{begin:43008,end:43055},{begin:65536,end:65663},{begin:65856,end:65935},{begin:66432,end:66463},{begin:66464,end:66527},{begin:66640,end:66687},{begin:66688,end:66735},{begin:67584,end:67647},{begin:68096,end:68191},{begin:119552,end:119647},{begin:73728,end:74751},{begin:119648,end:119679},{begin:7040,end:7103},{begin:7168,end:7247},{begin:7248,end:7295},{begin:43136,end:43231},{begin:43264,end:43311},{begin:43312,end:43359},{begin:43520,end:43615},{begin:65936,end:65999},{begin:66e3,end:66047},{begin:66208,end:66271},{begin:127024,end:127135}];function Fq(t){for(var e=0;e<mk.length;e+=1){var r=mk[e];if(t>=r.begin&&t<r.end)return e}return-1}function Bq(t,e){var r={},n=new Dt.Parser(t,e);r.version=n.parseUShort(),r.xAvgCharWidth=n.parseShort(),r.usWeightClass=n.parseUShort(),r.usWidthClass=n.parseUShort(),r.fsType=n.parseUShort(),r.ySubscriptXSize=n.parseShort(),r.ySubscriptYSize=n.parseShort(),r.ySubscriptXOffset=n.parseShort(),r.ySubscriptYOffset=n.parseShort(),r.ySuperscriptXSize=n.parseShort(),r.ySuperscriptYSize=n.parseShort(),r.ySuperscriptXOffset=n.parseShort(),r.ySuperscriptYOffset=n.parseShort(),r.yStrikeoutSize=n.parseShort(),r.yStrikeoutPosition=n.parseShort(),r.sFamilyClass=n.parseShort(),r.panose=[];for(var i=0;i<10;i++)r.panose[i]=n.parseByte();return r.ulUnicodeRange1=n.parseULong(),r.ulUnicodeRange2=n.parseULong(),r.ulUnicodeRange3=n.parseULong(),r.ulUnicodeRange4=n.parseULong(),r.achVendID=String.fromCharCode(n.parseByte(),n.parseByte(),n.parseByte(),n.parseByte()),r.fsSelection=n.parseUShort(),r.usFirstCharIndex=n.parseUShort(),r.usLastCharIndex=n.parseUShort(),r.sTypoAscender=n.parseShort(),r.sTypoDescender=n.parseShort(),r.sTypoLineGap=n.parseShort(),r.usWinAscent=n.parseUShort(),r.usWinDescent=n.parseUShort(),r.version>=1&&(r.ulCodePageRange1=n.parseULong(),r.ulCodePageRange2=n.parseULong()),r.version>=2&&(r.sxHeight=n.parseShort(),r.sCapHeight=n.parseShort(),r.usDefaultChar=n.parseUShort(),r.usBreakChar=n.parseUShort(),r.usMaxContent=n.parseUShort()),r}function zq(t){return new Mt.Table("OS/2",[{name:"version",type:"USHORT",value:3},{name:"xAvgCharWidth",type:"SHORT",value:0},{name:"usWeightClass",type:"USHORT",value:0},{name:"usWidthClass",type:"USHORT",value:0},{name:"fsType",type:"USHORT",value:0},{name:"ySubscriptXSize",type:"SHORT",value:650},{name:"ySubscriptYSize",type:"SHORT",value:699},{name:"ySubscriptXOffset",type:"SHORT",value:0},{name:"ySubscriptYOffset",type:"SHORT",value:140},{name:"ySuperscriptXSize",type:"SHORT",value:650},{name:"ySuperscriptYSize",type:"SHORT",value:699},{name:"ySuperscriptXOffset",type:"SHORT",value:0},{name:"ySuperscriptYOffset",type:"SHORT",value:479},{name:"yStrikeoutSize",type:"SHORT",value:49},{name:"yStrikeoutPosition",type:"SHORT",value:258},{name:"sFamilyClass",type:"SHORT",value:0},{name:"bFamilyType",type:"BYTE",value:0},{name:"bSerifStyle",type:"BYTE",value:0},{name:"bWeight",type:"BYTE",value:0},{name:"bProportion",type:"BYTE",value:0},{name:"bContrast",type:"BYTE",value:0},{name:"bStrokeVariation",type:"BYTE",value:0},{name:"bArmStyle",type:"BYTE",value:0},{name:"bLetterform",type:"BYTE",value:0},{name:"bMidline",type:"BYTE",value:0},{name:"bXHeight",type:"BYTE",value:0},{name:"ulUnicodeRange1",type:"ULONG",value:0},{name:"ulUnicodeRange2",type:"ULONG",value:0},{name:"ulUnicodeRange3",type:"ULONG",value:0},{name:"ulUnicodeRange4",type:"ULONG",value:0},{name:"achVendID",type:"CHARARRAY",value:"XXXX"},{name:"fsSelection",type:"USHORT",value:0},{name:"usFirstCharIndex",type:"USHORT",value:0},{name:"usLastCharIndex",type:"USHORT",value:0},{name:"sTypoAscender",type:"SHORT",value:0},{name:"sTypoDescender",type:"SHORT",value:0},{name:"sTypoLineGap",type:"SHORT",value:0},{name:"usWinAscent",type:"USHORT",value:0},{name:"usWinDescent",type:"USHORT",value:0},{name:"ulCodePageRange1",type:"ULONG",value:0},{name:"ulCodePageRange2",type:"ULONG",value:0},{name:"sxHeight",type:"SHORT",value:0},{name:"sCapHeight",type:"SHORT",value:0},{name:"usDefaultChar",type:"USHORT",value:0},{name:"usBreakChar",type:"USHORT",value:0},{name:"usMaxContext",type:"USHORT",value:0}],t)}var gk={parse:Bq,make:zq,unicodeRanges:mk,getUnicodeRange:Fq};function Uq(t,e){var r={},n=new Dt.Parser(t,e);switch(r.version=n.parseVersion(),r.italicAngle=n.parseFixed(),r.underlinePosition=n.parseShort(),r.underlineThickness=n.parseShort(),r.isFixedPitch=n.parseULong(),r.minMemType42=n.parseULong(),r.maxMemType42=n.parseULong(),r.minMemType1=n.parseULong(),r.maxMemType1=n.parseULong(),r.version){case 1:r.names=th.slice();break;case 2:r.numberOfGlyphs=n.parseUShort(),r.glyphNameIndex=new Array(r.numberOfGlyphs);for(var i=0;i<r.numberOfGlyphs;i++)r.glyphNameIndex[i]=n.parseUShort();r.names=[];for(var a=0;a<r.numberOfGlyphs;a++)if(r.glyphNameIndex[a]>=th.length){var s=n.parseChar();r.names.push(n.parseString(s))}break;case 2.5:r.numberOfGlyphs=n.parseUShort(),r.offset=new Array(r.numberOfGlyphs);for(var o=0;o<r.numberOfGlyphs;o++)r.offset[o]=n.parseChar();break}return r}function Gq(){return new Mt.Table("post",[{name:"version",type:"FIXED",value:196608},{name:"italicAngle",type:"FIXED",value:0},{name:"underlinePosition",type:"FWORD",value:0},{name:"underlineThickness",type:"FWORD",value:0},{name:"isFixedPitch",type:"ULONG",value:0},{name:"minMemType42",type:"ULONG",value:0},{name:"maxMemType42",type:"ULONG",value:0},{name:"minMemType1",type:"ULONG",value:0},{name:"maxMemType1",type:"ULONG",value:0}])}var IR={parse:Uq,make:Gq},Nl=new Array(9);Nl[1]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{substFormat:1,coverage:this.parsePointer(ze.coverage),deltaGlyphId:this.parseUShort()};if(r===2)return{substFormat:2,coverage:this.parsePointer(ze.coverage),substitute:this.parseOffset16List()};ir.assert(!1,"0x"+e.toString(16)+": lookup type 1 format must be 1 or 2.")};Nl[2]=function(){var e=this.parseUShort();return ir.argument(e===1,"GSUB Multiple Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(ze.coverage),sequences:this.parseListOfLists()}};Nl[3]=function(){var e=this.parseUShort();return ir.argument(e===1,"GSUB Alternate Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(ze.coverage),alternateSets:this.parseListOfLists()}};Nl[4]=function(){var e=this.parseUShort();return ir.argument(e===1,"GSUB ligature table identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(ze.coverage),ligatureSets:this.parseListOfLists(function(){return{ligGlyph:this.parseUShort(),components:this.parseUShortList(this.parseUShort()-1)}})}};var Hp={sequenceIndex:ze.uShort,lookupListIndex:ze.uShort};Nl[5]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{substFormat:r,coverage:this.parsePointer(ze.coverage),ruleSets:this.parseListOfLists(function(){var a=this.parseUShort(),s=this.parseUShort();return{input:this.parseUShortList(a-1),lookupRecords:this.parseRecordList(s,Hp)}})};if(r===2)return{substFormat:r,coverage:this.parsePointer(ze.coverage),classDef:this.parsePointer(ze.classDef),classSets:this.parseListOfLists(function(){var a=this.parseUShort(),s=this.parseUShort();return{classes:this.parseUShortList(a-1),lookupRecords:this.parseRecordList(s,Hp)}})};if(r===3){var n=this.parseUShort(),i=this.parseUShort();return{substFormat:r,coverages:this.parseList(n,ze.pointer(ze.coverage)),lookupRecords:this.parseRecordList(i,Hp)}}ir.assert(!1,"0x"+e.toString(16)+": lookup type 5 format must be 1, 2 or 3.")};Nl[6]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{substFormat:1,coverage:this.parsePointer(ze.coverage),chainRuleSets:this.parseListOfLists(function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(Hp)}})};if(r===2)return{substFormat:2,coverage:this.parsePointer(ze.coverage),backtrackClassDef:this.parsePointer(ze.classDef),inputClassDef:this.parsePointer(ze.classDef),lookaheadClassDef:this.parsePointer(ze.classDef),chainClassSet:this.parseListOfLists(function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(Hp)}})};if(r===3)return{substFormat:3,backtrackCoverage:this.parseList(ze.pointer(ze.coverage)),inputCoverage:this.parseList(ze.pointer(ze.coverage)),lookaheadCoverage:this.parseList(ze.pointer(ze.coverage)),lookupRecords:this.parseRecordList(Hp)};ir.assert(!1,"0x"+e.toString(16)+": lookup type 6 format must be 1, 2 or 3.")};Nl[7]=function(){var e=this.parseUShort();ir.argument(e===1,"GSUB Extension Substitution subtable identifier-format must be 1");var r=this.parseUShort(),n=new ze(this.data,this.offset+this.parseULong());return{substFormat:1,lookupType:r,extension:Nl[r].call(n)}};Nl[8]=function(){var e=this.parseUShort();return ir.argument(e===1,"GSUB Reverse Chaining Contextual Single Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(ze.coverage),backtrackCoverage:this.parseList(ze.pointer(ze.coverage)),lookaheadCoverage:this.parseList(ze.pointer(ze.coverage)),substitutes:this.parseUShortList()}};function Vq(t,e){e=e||0;var r=new ze(t,e),n=r.parseVersion(1);return ir.argument(n===1||n===1.1,"Unsupported GSUB table version."),n===1?{version:n,scripts:r.parseScriptList(),features:r.parseFeatureList(),lookups:r.parseLookupList(Nl)}:{version:n,scripts:r.parseScriptList(),features:r.parseFeatureList(),lookups:r.parseLookupList(Nl),variations:r.parseFeatureVariationsList()}}var ym=new Array(9);ym[1]=function(e){return e.substFormat===1?new Mt.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new Mt.Coverage(e.coverage)},{name:"deltaGlyphID",type:"USHORT",value:e.deltaGlyphId}]):new Mt.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:2},{name:"coverage",type:"TABLE",value:new Mt.Coverage(e.coverage)}].concat(Mt.ushortList("substitute",e.substitute)))};ym[2]=function(e){return ir.assert(e.substFormat===1,"Lookup type 2 substFormat must be 1."),new Mt.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new Mt.Coverage(e.coverage)}].concat(Mt.tableList("seqSet",e.sequences,function(r){return new Mt.Table("sequenceSetTable",Mt.ushortList("sequence",r))})))};ym[3]=function(e){return ir.assert(e.substFormat===1,"Lookup type 3 substFormat must be 1."),new Mt.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new Mt.Coverage(e.coverage)}].concat(Mt.tableList("altSet",e.alternateSets,function(r){return new Mt.Table("alternateSetTable",Mt.ushortList("alternate",r))})))};ym[4]=function(e){return ir.assert(e.substFormat===1,"Lookup type 4 substFormat must be 1."),new Mt.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new Mt.Coverage(e.coverage)}].concat(Mt.tableList("ligSet",e.ligatureSets,function(r){return new Mt.Table("ligatureSetTable",Mt.tableList("ligature",r,function(n){return new Mt.Table("ligatureTable",[{name:"ligGlyph",type:"USHORT",value:n.ligGlyph}].concat(Mt.ushortList("component",n.components,n.components.length+1)))}))})))};ym[6]=function(e){if(e.substFormat===1){var r=new Mt.Table("chainContextTable",[{name:"substFormat",type:"USHORT",value:e.substFormat},{name:"coverage",type:"TABLE",value:new Mt.Coverage(e.coverage)}].concat(Mt.tableList("chainRuleSet",e.chainRuleSets,function(a){return new Mt.Table("chainRuleSetTable",Mt.tableList("chainRule",a,function(s){var o=Mt.ushortList("backtrackGlyph",s.backtrack,s.backtrack.length).concat(Mt.ushortList("inputGlyph",s.input,s.input.length+1)).concat(Mt.ushortList("lookaheadGlyph",s.lookahead,s.lookahead.length)).concat(Mt.ushortList("substitution",[],s.lookupRecords.length));return s.lookupRecords.forEach(function(l,u){o=o.concat({name:"sequenceIndex"+u,type:"USHORT",value:l.sequenceIndex}).concat({name:"lookupListIndex"+u,type:"USHORT",value:l.lookupListIndex})}),new Mt.Table("chainRuleTable",o)}))})));return r}else if(e.substFormat===2)ir.assert(!1,"lookup type 6 format 2 is not yet supported.");else if(e.substFormat===3){var n=[{name:"substFormat",type:"USHORT",value:e.substFormat}];n.push({name:"backtrackGlyphCount",type:"USHORT",value:e.backtrackCoverage.length}),e.backtrackCoverage.forEach(function(a,s){n.push({name:"backtrackCoverage"+s,type:"TABLE",value:new Mt.Coverage(a)})}),n.push({name:"inputGlyphCount",type:"USHORT",value:e.inputCoverage.length}),e.inputCoverage.forEach(function(a,s){n.push({name:"inputCoverage"+s,type:"TABLE",value:new Mt.Coverage(a)})}),n.push({name:"lookaheadGlyphCount",type:"USHORT",value:e.lookaheadCoverage.length}),e.lookaheadCoverage.forEach(function(a,s){n.push({name:"lookaheadCoverage"+s,type:"TABLE",value:new Mt.Coverage(a)})}),n.push({name:"substitutionCount",type:"USHORT",value:e.lookupRecords.length}),e.lookupRecords.forEach(function(a,s){n=n.concat({name:"sequenceIndex"+s,type:"USHORT",value:a.sequenceIndex}).concat({name:"lookupListIndex"+s,type:"USHORT",value:a.lookupListIndex})});var i=new Mt.Table("chainContextTable",n);return i}ir.assert(!1,"lookup type 6 format must be 1, 2 or 3.")};function Hq(t){return new Mt.Table("GSUB",[{name:"version",type:"ULONG",value:65536},{name:"scripts",type:"TABLE",value:new Mt.ScriptList(t.scripts)},{name:"features",type:"TABLE",value:new Mt.FeatureList(t.features)},{name:"lookups",type:"TABLE",value:new Mt.LookupList(t.lookups,ym)}])}var jR={parse:Vq,make:Hq};function Wq(t,e){var r=new Dt.Parser(t,e),n=r.parseULong();ir.argument(n===1,"Unsupported META table version."),r.parseULong(),r.parseULong();for(var i=r.parseULong(),a={},s=0;s<i;s++){var o=r.parseTag(),l=r.parseULong(),u=r.parseULong(),c=Xp.UTF8(t,e+l,u);a[o]=c}return a}function qq(t){var e=Object.keys(t).length,r="",n=16+e*12,i=new Mt.Table("meta",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"offset",type:"ULONG",value:n},{name:"numTags",type:"ULONG",value:e}]);for(var a in t){var s=r.length;r+=t[a],i.fields.push({name:"tag "+a,type:"TAG",value:a}),i.fields.push({name:"offset "+a,type:"ULONG",value:n+s}),i.fields.push({name:"length "+a,type:"ULONG",value:t[a].length})}return i.fields.push({name:"stringPool",type:"CHARARRAY",value:r}),i}var FR={parse:Wq,make:qq};function e3(t){return Math.log(t)/Math.log(2)|0}function H_(t){for(;t.length%4!==0;)t.push(0);for(var e=0,r=0;r<t.length;r+=4)e+=(t[r]<<24)+(t[r+1]<<16)+(t[r+2]<<8)+t[r+3];return e%=Math.pow(2,32),e}function t3(t,e,r,n){return new Mt.Record("Table Record",[{name:"tag",type:"TAG",value:t!==void 0?t:""},{name:"checkSum",type:"ULONG",value:e!==void 0?e:0},{name:"offset",type:"ULONG",value:r!==void 0?r:0},{name:"length",type:"ULONG",value:n!==void 0?n:0}])}function BR(t){var e=new Mt.Table("sfnt",[{name:"version",type:"TAG",value:"OTTO"},{name:"numTables",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);e.tables=t,e.numTables=t.length;var r=Math.pow(2,e3(e.numTables));e.searchRange=16*r,e.entrySelector=e3(r),e.rangeShift=e.numTables*16-e.searchRange;for(var n=[],i=[],a=e.sizeOf()+t3().sizeOf()*e.numTables;a%4!==0;)a+=1,i.push({name:"padding",type:"BYTE",value:0});for(var s=0;s<t.length;s+=1){var o=t[s];ir.argument(o.tableName.length===4,"Table name"+o.tableName+" is invalid.");var l=o.sizeOf(),u=t3(o.tableName,H_(o.encode()),a,l);for(n.push({name:u.tag+" Table Record",type:"RECORD",value:u}),i.push({name:o.tableName+" table",type:"RECORD",value:o}),a+=l,ir.argument(!isNaN(a),"Something went wrong calculating the offset.");a%4!==0;)a+=1,i.push({name:"padding",type:"BYTE",value:0})}return n.sort(function(c,f){return c.value.tag>f.value.tag?1:-1}),e.fields=e.fields.concat(n),e.fields=e.fields.concat(i),e}function r3(t,e,r){for(var n=0;n<e.length;n+=1){var i=t.charToGlyphIndex(e[n]);if(i>0){var a=t.glyphs.get(i);return a.getMetrics()}}return r}function $q(t){for(var e=0,r=0;r<t.length;r+=1)e+=t[r];return e/t.length}function Kq(t){for(var e=[],r=[],n=[],i=[],a=[],s=[],o=[],l,u=0,c=0,f=0,p=0,v=0,y=0;y<t.glyphs.length;y+=1){var S=t.glyphs.get(y),w=S.unicode|0;if(isNaN(S.advanceWidth))throw new Error("Glyph "+S.name+" ("+y+"): advanceWidth is not a number.");(l>w||l===void 0)&&w>0&&(l=w),u<w&&(u=w);var T=gk.getUnicodeRange(w);if(T<32)c|=1<<T;else if(T<64)f|=1<<T-32;else if(T<96)p|=1<<T-64;else if(T<123)v|=1<<T-96;else throw new Error("Unicode ranges bits > 123 are reserved for internal usage");if(S.name!==".notdef"){var _=S.getMetrics();e.push(_.xMin),r.push(_.yMin),n.push(_.xMax),i.push(_.yMax),s.push(_.leftSideBearing),o.push(_.rightSideBearing),a.push(S.advanceWidth)}}var C={xMin:Math.min.apply(null,e),yMin:Math.min.apply(null,r),xMax:Math.max.apply(null,n),yMax:Math.max.apply(null,i),advanceWidthMax:Math.max.apply(null,a),advanceWidthAvg:$q(a),minLeftSideBearing:Math.min.apply(null,s),maxLeftSideBearing:Math.max.apply(null,s),minRightSideBearing:Math.min.apply(null,o)};C.ascender=t.ascender,C.descender=t.descender;var N=ER.make({flags:3,unitsPerEm:t.unitsPerEm,xMin:C.xMin,yMin:C.yMin,xMax:C.xMax,yMax:C.yMax,lowestRecPPEM:3,createdTimestamp:t.createdTimestamp}),A=TR.make({ascender:C.ascender,descender:C.descender,advanceWidthMax:C.advanceWidthMax,minLeftSideBearing:C.minLeftSideBearing,minRightSideBearing:C.minRightSideBearing,xMaxExtent:C.maxLeftSideBearing+(C.xMax-C.xMin),numberOfHMetrics:t.glyphs.length}),O=MR.make(t.glyphs.length),j=gk.make(Object.assign({xAvgCharWidth:Math.round(C.advanceWidthAvg),usFirstCharIndex:l,usLastCharIndex:u,ulUnicodeRange1:c,ulUnicodeRange2:f,ulUnicodeRange3:p,ulUnicodeRange4:v,sTypoAscender:C.ascender,sTypoDescender:C.descender,sTypoLineGap:0,usWinAscent:C.yMax,usWinDescent:Math.abs(C.yMin),ulCodePageRange1:1,sxHeight:r3(t,"xyvw",{yMax:Math.round(C.ascender/2)}).yMax,sCapHeight:r3(t,"HIKLEFJMNTZBDPRAGOQSUVWXY",C).yMax,usDefaultChar:t.hasChar(" ")?32:0,usBreakChar:t.hasChar(" ")?32:0},t.tables.os2)),D=NR.make(t.glyphs),F=pR.make(t.glyphs),B=t.getEnglishName("fontFamily"),$=t.getEnglishName("fontSubfamily"),Z=B+" "+$,I=t.getEnglishName("postScriptName");I||(I=B.replace(/\s/g,"")+"-"+$);var q={};for(var U in t.names)q[U]=t.names[U];q.uniqueID||(q.uniqueID={en:t.getEnglishName("manufacturer")+":"+Z}),q.postScriptName||(q.postScriptName={en:I}),q.preferredFamily||(q.preferredFamily=t.names.fontFamily),q.preferredSubfamily||(q.preferredSubfamily=t.names.fontSubfamily);var W=[],Y=DR.make(q,W),Q=W.length>0?PR.make(W):void 0,ne=IR.make(),re=CR.make(t.glyphs,{version:t.getEnglishName("version"),fullName:Z,familyName:B,weightName:$,postScriptName:I,unitsPerEm:t.unitsPerEm,fontBBox:[0,C.yMin,C.ascender,C.advanceWidthMax]}),H=t.metas&&Object.keys(t.metas).length>0?FR.make(t.metas):void 0,te=[N,A,O,j,Y,F,ne,re,D];Q&&te.push(Q),t.tables.gsub&&te.push(jR.make(t.tables.gsub)),H&&te.push(H);for(var ie=BR(te),de=ie.encode(),ge=H_(de),ye=ie.fields,ae=!1,pe=0;pe<ye.length;pe+=1)if(ye[pe].name==="head table"){ye[pe].value.checkSumAdjustment=2981146554-ge,ae=!0;break}if(!ae)throw new Error("Could not find head table with checkSum to adjust.");return ie}var Zq={make:BR,fontToTable:Kq,computeCheckSum:H_};function H2(t,e){for(var r=0,n=t.length-1;r<=n;){var i=r+n>>>1,a=t[i].tag;if(a===e)return i;a<e?r=i+1:n=i-1}return-r-1}function n3(t,e){for(var r=0,n=t.length-1;r<=n;){var i=r+n>>>1,a=t[i];if(a===e)return i;a<e?r=i+1:n=i-1}return-r-1}function i3(t,e){for(var r,n=0,i=t.length-1;n<=i;){var a=n+i>>>1;r=t[a];var s=r.start;if(s===e)return r;s<e?n=a+1:i=a-1}if(n>0)return r=t[n-1],e>r.end?0:r}function c0(t,e){this.font=t,this.tableName=e}c0.prototype={searchTag:H2,binSearch:n3,getTable:function(t){var e=this.font.tables[this.tableName];return!e&&t&&(e=this.font.tables[this.tableName]=this.createDefaultTable()),e},getScriptNames:function(){var t=this.getTable();return t?t.scripts.map(function(e){return e.tag}):[]},getDefaultScriptName:function(){var t=this.getTable();if(t){for(var e=!1,r=0;r<t.scripts.length;r++){var n=t.scripts[r].tag;if(n==="DFLT")return n;n==="latn"&&(e=!0)}if(e)return"latn"}},getScriptTable:function(t,e){var r=this.getTable(e);if(r){t=t||"DFLT";var n=r.scripts,i=H2(r.scripts,t);if(i>=0)return n[i].script;if(e){var a={tag:t,script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}};return n.splice(-1-i,0,a),a.script}}},getLangSysTable:function(t,e,r){var n=this.getScriptTable(t,r);if(n){if(!e||e==="dflt"||e==="DFLT")return n.defaultLangSys;var i=H2(n.langSysRecords,e);if(i>=0)return n.langSysRecords[i].langSys;if(r){var a={tag:e,langSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]}};return n.langSysRecords.splice(-1-i,0,a),a.langSys}}},getFeatureTable:function(t,e,r,n){var i=this.getLangSysTable(t,e,n);if(i){for(var a,s=i.featureIndexes,o=this.font.tables[this.tableName].features,l=0;l<s.length;l++)if(a=o[s[l]],a.tag===r)return a.feature;if(n){var u=o.length;return ir.assert(u===0||r>=o[u-1].tag,"Features must be added in alphabetical order."),a={tag:r,feature:{params:0,lookupListIndexes:[]}},o.push(a),s.push(u),a.feature}}},getLookupTables:function(t,e,r,n,i){var a=this.getFeatureTable(t,e,r,i),s=[];if(a){for(var o,l=a.lookupListIndexes,u=this.font.tables[this.tableName].lookups,c=0;c<l.length;c++)o=u[l[c]],o.lookupType===n&&s.push(o);if(s.length===0&&i){o={lookupType:n,lookupFlag:0,subtables:[],markFilteringSet:void 0};var f=u.length;return u.push(o),l.push(f),[o]}}return s},getGlyphClass:function(t,e){switch(t.format){case 1:return t.startGlyph<=e&&e<t.startGlyph+t.classes.length?t.classes[e-t.startGlyph]:0;case 2:var r=i3(t.ranges,e);return r?r.classId:0}},getCoverageIndex:function(t,e){switch(t.format){case 1:var r=n3(t.glyphs,e);return r>=0?r:-1;case 2:var n=i3(t.ranges,e);return n?n.index+e-n.start:-1}},expandCoverage:function(t){if(t.format===1)return t.glyphs;for(var e=[],r=t.ranges,n=0;n<r.length;n++)for(var i=r[n],a=i.start,s=i.end,o=a;o<=s;o++)e.push(o);return e}};function d0(t){c0.call(this,t,"gpos")}d0.prototype=c0.prototype;d0.prototype.init=function(){var t=this.getDefaultScriptName();this.defaultKerningTables=this.getKerningTables(t)};d0.prototype.getKerningValue=function(t,e,r){for(var n=0;n<t.length;n++)for(var i=t[n].subtables,a=0;a<i.length;a++){var s=i[a],o=this.getCoverageIndex(s.coverage,e);if(!(o<0))switch(s.posFormat){case 1:for(var l=s.pairSets[o],u=0;u<l.length;u++){var c=l[u];if(c.secondGlyph===r)return c.value1&&c.value1.xAdvance||0}break;case 2:var f=this.getGlyphClass(s.classDef1,e),p=this.getGlyphClass(s.classDef2,r),v=s.classRecords[f][p];return v.value1&&v.value1.xAdvance||0}}return 0};d0.prototype.getKerningTables=function(t,e){if(this.font.tables.gpos)return this.getLookupTables(t,e,"kern",2)};function ho(t){c0.call(this,t,"gsub")}function Yq(t,e){var r=t.length;if(r!==e.length)return!1;for(var n=0;n<r;n++)if(t[n]!==e[n])return!1;return!0}function W_(t,e,r){for(var n=t.subtables,i=0;i<n.length;i++){var a=n[i];if(a.substFormat===e)return a}if(r)return n.push(r),r}ho.prototype=c0.prototype;ho.prototype.createDefaultTable=function(){return{version:1,scripts:[{tag:"DFLT",script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}}],features:[],lookups:[]}};ho.prototype.getSingle=function(t,e,r){for(var n=[],i=this.getLookupTables(e,r,t,1),a=0;a<i.length;a++)for(var s=i[a].subtables,o=0;o<s.length;o++){var l=s[o],u=this.expandCoverage(l.coverage),c=void 0;if(l.substFormat===1){var f=l.deltaGlyphId;for(c=0;c<u.length;c++){var p=u[c];n.push({sub:p,by:p+f})}}else{var v=l.substitute;for(c=0;c<u.length;c++)n.push({sub:u[c],by:v[c]})}}return n};ho.prototype.getMultiple=function(t,e,r){for(var n=[],i=this.getLookupTables(e,r,t,2),a=0;a<i.length;a++)for(var s=i[a].subtables,o=0;o<s.length;o++){var l=s[o],u=this.expandCoverage(l.coverage),c=void 0;for(c=0;c<u.length;c++){var f=u[c],p=l.sequences[c];n.push({sub:f,by:p})}}return n};ho.prototype.getAlternates=function(t,e,r){for(var n=[],i=this.getLookupTables(e,r,t,3),a=0;a<i.length;a++)for(var s=i[a].subtables,o=0;o<s.length;o++)for(var l=s[o],u=this.expandCoverage(l.coverage),c=l.alternateSets,f=0;f<u.length;f++)n.push({sub:u[f],by:c[f]});return n};ho.prototype.getLigatures=function(t,e,r){for(var n=[],i=this.getLookupTables(e,r,t,4),a=0;a<i.length;a++)for(var s=i[a].subtables,o=0;o<s.length;o++)for(var l=s[o],u=this.expandCoverage(l.coverage),c=l.ligatureSets,f=0;f<u.length;f++)for(var p=u[f],v=c[f],y=0;y<v.length;y++){var S=v[y];n.push({sub:[p].concat(S.components),by:S.ligGlyph})}return n};ho.prototype.addSingle=function(t,e,r,n){var i=this.getLookupTables(r,n,t,1,!0)[0],a=W_(i,2,{substFormat:2,coverage:{format:1,glyphs:[]},substitute:[]});ir.assert(a.coverage.format===1,"Single: unable to modify coverage table format "+a.coverage.format);var s=e.sub,o=this.binSearch(a.coverage.glyphs,s);o<0&&(o=-1-o,a.coverage.glyphs.splice(o,0,s),a.substitute.splice(o,0,0)),a.substitute[o]=e.by};ho.prototype.addMultiple=function(t,e,r,n){ir.assert(e.by instanceof Array&&e.by.length>1,'Multiple: "by" must be an array of two or more ids');var i=this.getLookupTables(r,n,t,2,!0)[0],a=W_(i,1,{substFormat:1,coverage:{format:1,glyphs:[]},sequences:[]});ir.assert(a.coverage.format===1,"Multiple: unable to modify coverage table format "+a.coverage.format);var s=e.sub,o=this.binSearch(a.coverage.glyphs,s);o<0&&(o=-1-o,a.coverage.glyphs.splice(o,0,s),a.sequences.splice(o,0,0)),a.sequences[o]=e.by};ho.prototype.addAlternate=function(t,e,r,n){var i=this.getLookupTables(r,n,t,3,!0)[0],a=W_(i,1,{substFormat:1,coverage:{format:1,glyphs:[]},alternateSets:[]});ir.assert(a.coverage.format===1,"Alternate: unable to modify coverage table format "+a.coverage.format);var s=e.sub,o=this.binSearch(a.coverage.glyphs,s);o<0&&(o=-1-o,a.coverage.glyphs.splice(o,0,s),a.alternateSets.splice(o,0,0)),a.alternateSets[o]=e.by};ho.prototype.addLigature=function(t,e,r,n){var i=this.getLookupTables(r,n,t,4,!0)[0],a=i.subtables[0];a||(a={substFormat:1,coverage:{format:1,glyphs:[]},ligatureSets:[]},i.subtables[0]=a),ir.assert(a.coverage.format===1,"Ligature: unable to modify coverage table format "+a.coverage.format);var s=e.sub[0],o=e.sub.slice(1),l={ligGlyph:e.by,components:o},u=this.binSearch(a.coverage.glyphs,s);if(u>=0){for(var c=a.ligatureSets[u],f=0;f<c.length;f++)if(Yq(c[f].components,o))return;c.push(l)}else u=-1-u,a.coverage.glyphs.splice(u,0,s),a.ligatureSets.splice(u,0,[l])};ho.prototype.getFeature=function(t,e,r){if(/ss\d\d/.test(t))return this.getSingle(t,e,r);switch(t){case"aalt":case"salt":return this.getSingle(t,e,r).concat(this.getAlternates(t,e,r));case"dlig":case"liga":case"rlig":return this.getLigatures(t,e,r);case"ccmp":return this.getMultiple(t,e,r).concat(this.getLigatures(t,e,r));case"stch":return this.getMultiple(t,e,r)}};ho.prototype.add=function(t,e,r,n){if(/ss\d\d/.test(t))return this.addSingle(t,e,r,n);switch(t){case"aalt":case"salt":return typeof e.by=="number"?this.addSingle(t,e,r,n):this.addAlternate(t,e,r,n);case"dlig":case"liga":case"rlig":return this.addLigature(t,e,r,n);case"ccmp":return e.by instanceof Array?this.addMultiple(t,e,r,n):this.addLigature(t,e,r,n)}};function Xq(){return typeof window<"u"}function zR(t){for(var e=new ArrayBuffer(t.length),r=new Uint8Array(e),n=0;n<t.length;++n)r[n]=t[n];return e}function Qq(t){for(var e=new Buffer(t.byteLength),r=new Uint8Array(t),n=0;n<e.length;++n)e[n]=r[n];return e}function Gg(t,e){if(!t)throw e}function a3(t,e,r,n,i){var a;return(e&n)>0?(a=t.parseByte(),(e&i)===0&&(a=-a),a=r+a):(e&i)>0?a=r:a=r+t.parseShort(),a}function UR(t,e,r){var n=new Dt.Parser(e,r);t.numberOfContours=n.parseShort(),t._xMin=n.parseShort(),t._yMin=n.parseShort(),t._xMax=n.parseShort(),t._yMax=n.parseShort();var i,a;if(t.numberOfContours>0){for(var s=t.endPointIndices=[],o=0;o<t.numberOfContours;o+=1)s.push(n.parseUShort());t.instructionLength=n.parseUShort(),t.instructions=[];for(var l=0;l<t.instructionLength;l+=1)t.instructions.push(n.parseByte());var u=s[s.length-1]+1;i=[];for(var c=0;c<u;c+=1)if(a=n.parseByte(),i.push(a),(a&8)>0)for(var f=n.parseByte(),p=0;p<f;p+=1)i.push(a),c+=1;if(ir.argument(i.length===u,"Bad flags."),s.length>0){var v=[],y;if(u>0){for(var S=0;S<u;S+=1)a=i[S],y={},y.onCurve=!!(a&1),y.lastPointOfContour=s.indexOf(S)>=0,v.push(y);for(var w=0,T=0;T<u;T+=1)a=i[T],y=v[T],y.x=a3(n,a,w,2,16),w=y.x;for(var _=0,C=0;C<u;C+=1)a=i[C],y=v[C],y.y=a3(n,a,_,4,32),_=y.y}t.points=v}else t.points=[]}else if(t.numberOfContours===0)t.points=[];else{t.isComposite=!0,t.points=[],t.components=[];for(var N=!0;N;){i=n.parseUShort();var A={glyphIndex:n.parseUShort(),xScale:1,scale01:0,scale10:0,yScale:1,dx:0,dy:0};(i&1)>0?(i&2)>0?(A.dx=n.parseShort(),A.dy=n.parseShort()):A.matchedPoints=[n.parseUShort(),n.parseUShort()]:(i&2)>0?(A.dx=n.parseChar(),A.dy=n.parseChar()):A.matchedPoints=[n.parseByte(),n.parseByte()],(i&8)>0?A.xScale=A.yScale=n.parseF2Dot14():(i&64)>0?(A.xScale=n.parseF2Dot14(),A.yScale=n.parseF2Dot14()):(i&128)>0&&(A.xScale=n.parseF2Dot14(),A.scale01=n.parseF2Dot14(),A.scale10=n.parseF2Dot14(),A.yScale=n.parseF2Dot14()),t.components.push(A),N=!!(i&32)}if(i&256){t.instructionLength=n.parseUShort(),t.instructions=[];for(var O=0;O<t.instructionLength;O+=1)t.instructions.push(n.parseByte())}}}function W2(t,e){for(var r=[],n=0;n<t.length;n+=1){var i=t[n],a={x:e.xScale*i.x+e.scale01*i.y+e.dx,y:e.scale10*i.x+e.yScale*i.y+e.dy,onCurve:i.onCurve,lastPointOfContour:i.lastPointOfContour};r.push(a)}return r}function Jq(t){for(var e=[],r=[],n=0;n<t.length;n+=1){var i=t[n];r.push(i),i.lastPointOfContour&&(e.push(r),r=[])}return ir.argument(r.length===0,"There are still points left in the current contour."),e}function GR(t){var e=new ii;if(!t)return e;for(var r=Jq(t),n=0;n<r.length;++n){var i=r[n],a=null,s=i[i.length-1],o=i[0];if(s.onCurve)e.moveTo(s.x,s.y);else if(o.onCurve)e.moveTo(o.x,o.y);else{var l={x:(s.x+o.x)*.5,y:(s.y+o.y)*.5};e.moveTo(l.x,l.y)}for(var u=0;u<i.length;++u)if(a=s,s=o,o=i[(u+1)%i.length],s.onCurve)e.lineTo(s.x,s.y);else{var c=o;a.onCurve||((s.x+a.x)*.5,(s.y+a.y)*.5),o.onCurve||(c={x:(s.x+o.x)*.5,y:(s.y+o.y)*.5}),e.quadraticCurveTo(s.x,s.y,c.x,c.y)}e.closePath()}return e}function VR(t,e){if(e.isComposite)for(var r=0;r<e.components.length;r+=1){var n=e.components[r],i=t.get(n.glyphIndex);if(i.getPath(),i.points){var a=void 0;if(n.matchedPoints===void 0)a=W2(i.points,n);else{if(n.matchedPoints[0]>e.points.length-1||n.matchedPoints[1]>i.points.length-1)throw Error("Matched points out of range in "+e.name);var s=e.points[n.matchedPoints[0]],o=i.points[n.matchedPoints[1]],l={xScale:n.xScale,scale01:n.scale01,scale10:n.scale10,yScale:n.yScale,dx:0,dy:0};o=W2([o],l)[0],l.dx=s.x-o.x,l.dy=s.y-o.y,a=W2(i.points,l)}e.points=e.points.concat(a)}}return GR(e.points)}function e$(t,e,r,n){for(var i=new Su.GlyphSet(n),a=0;a<r.length-1;a+=1){var s=r[a],o=r[a+1];s!==o?i.push(a,Su.ttfGlyphLoader(n,a,UR,t,e+s,VR)):i.push(a,Su.glyphLoader(n,a))}return i}function t$(t,e,r,n){var i=new Su.GlyphSet(n);return n._push=function(a){var s=r[a],o=r[a+1];s!==o?i.push(a,Su.ttfGlyphLoader(n,a,UR,t,e+s,VR)):i.push(a,Su.glyphLoader(n,a))},i}function r$(t,e,r,n,i){return i.lowMemory?t$(t,e,r,n):e$(t,e,r,n)}var HR={getPath:GR,parse:r$},WR,kh,qR,vk;function $R(t){this.font=t,this.getCommands=function(e){return HR.getPath(e).commands},this._fpgmState=this._prepState=void 0,this._errorState=0}function n$(t){return t}function KR(t){return Math.sign(t)*Math.round(Math.abs(t))}function i$(t){return Math.sign(t)*Math.round(Math.abs(t*2))/2}function a$(t){return Math.sign(t)*(Math.round(Math.abs(t)+.5)-.5)}function s$(t){return Math.sign(t)*Math.ceil(Math.abs(t))}function o$(t){return Math.sign(t)*Math.floor(Math.abs(t))}var ZR=function(t){var e=this.srPeriod,r=this.srPhase,n=this.srThreshold,i=1;return t<0&&(t=-t,i=-1),t+=n-r,t=Math.trunc(t/e)*e,t+=r,t<0?r*i:t*i},wu={x:1,y:0,axis:"x",distance:function(t,e,r,n){return(r?t.xo:t.x)-(n?e.xo:e.x)},interpolate:function(t,e,r,n){var i,a,s,o,l,u,c;if(!n||n===this){if(i=t.xo-e.xo,a=t.xo-r.xo,l=e.x-e.xo,u=r.x-r.xo,s=Math.abs(i),o=Math.abs(a),c=s+o,c===0){t.x=t.xo+(l+u)/2;return}t.x=t.xo+(l*o+u*s)/c;return}if(i=n.distance(t,e,!0,!0),a=n.distance(t,r,!0,!0),l=n.distance(e,e,!1,!0),u=n.distance(r,r,!1,!0),s=Math.abs(i),o=Math.abs(a),c=s+o,c===0){wu.setRelative(t,t,(l+u)/2,n,!0);return}wu.setRelative(t,t,(l*o+u*s)/c,n,!0)},normalSlope:Number.NEGATIVE_INFINITY,setRelative:function(t,e,r,n,i){if(!n||n===this){t.x=(i?e.xo:e.x)+r;return}var a=i?e.xo:e.x,s=i?e.yo:e.y,o=a+r*n.x,l=s+r*n.y;t.x=o+(t.y-l)/n.normalSlope},slope:0,touch:function(t){t.xTouched=!0},touched:function(t){return t.xTouched},untouch:function(t){t.xTouched=!1}},hc={x:0,y:1,axis:"y",distance:function(t,e,r,n){return(r?t.yo:t.y)-(n?e.yo:e.y)},interpolate:function(t,e,r,n){var i,a,s,o,l,u,c;if(!n||n===this){if(i=t.yo-e.yo,a=t.yo-r.yo,l=e.y-e.yo,u=r.y-r.yo,s=Math.abs(i),o=Math.abs(a),c=s+o,c===0){t.y=t.yo+(l+u)/2;return}t.y=t.yo+(l*o+u*s)/c;return}if(i=n.distance(t,e,!0,!0),a=n.distance(t,r,!0,!0),l=n.distance(e,e,!1,!0),u=n.distance(r,r,!1,!0),s=Math.abs(i),o=Math.abs(a),c=s+o,c===0){hc.setRelative(t,t,(l+u)/2,n,!0);return}hc.setRelative(t,t,(l*o+u*s)/c,n,!0)},normalSlope:0,setRelative:function(t,e,r,n,i){if(!n||n===this){t.y=(i?e.yo:e.y)+r;return}var a=i?e.xo:e.x,s=i?e.yo:e.y,o=a+r*n.x,l=s+r*n.y;t.y=l+n.normalSlope*(t.x-o)},slope:Number.POSITIVE_INFINITY,touch:function(t){t.yTouched=!0},touched:function(t){return t.yTouched},untouch:function(t){t.yTouched=!1}};Object.freeze(wu);Object.freeze(hc);function f0(t,e){this.x=t,this.y=e,this.axis=void 0,this.slope=e/t,this.normalSlope=-t/e,Object.freeze(this)}f0.prototype.distance=function(t,e,r,n){return this.x*wu.distance(t,e,r,n)+this.y*hc.distance(t,e,r,n)};f0.prototype.interpolate=function(t,e,r,n){var i,a,s,o,l,u,c;if(s=n.distance(t,e,!0,!0),o=n.distance(t,r,!0,!0),i=n.distance(e,e,!1,!0),a=n.distance(r,r,!1,!0),l=Math.abs(s),u=Math.abs(o),c=l+u,c===0){this.setRelative(t,t,(i+a)/2,n,!0);return}this.setRelative(t,t,(i*u+a*l)/c,n,!0)};f0.prototype.setRelative=function(t,e,r,n,i){n=n||this;var a=i?e.xo:e.x,s=i?e.yo:e.y,o=a+r*n.x,l=s+r*n.y,u=n.normalSlope,c=this.slope,f=t.x,p=t.y;t.x=(c*f-u*o+l-p)/(c-u),t.y=c*(t.x-f)+p};f0.prototype.touch=function(t){t.xTouched=!0,t.yTouched=!0};function h0(t,e){var r=Math.sqrt(t*t+e*e);return t/=r,e/=r,t===1&&e===0?wu:t===0&&e===1?hc:new f0(t,e)}function mc(t,e,r,n){this.x=this.xo=Math.round(t*64)/64,this.y=this.yo=Math.round(e*64)/64,this.lastPointOfContour=r,this.onCurve=n,this.prevPointOnContour=void 0,this.nextPointOnContour=void 0,this.xTouched=!1,this.yTouched=!1,Object.preventExtensions(this)}mc.prototype.nextTouched=function(t){for(var e=this.nextPointOnContour;!t.touched(e)&&e!==this;)e=e.nextPointOnContour;return e};mc.prototype.prevTouched=function(t){for(var e=this.prevPointOnContour;!t.touched(e)&&e!==this;)e=e.prevPointOnContour;return e};var Iv=Object.freeze(new mc(0,0)),l$={cvCutIn:17/16,deltaBase:9,deltaShift:.125,loop:1,minDis:1,autoFlip:!0};function Fd(t,e){switch(this.env=t,this.stack=[],this.prog=e,t){case"glyf":this.zp0=this.zp1=this.zp2=1,this.rp0=this.rp1=this.rp2=0;case"prep":this.fv=this.pv=this.dpv=wu,this.round=KR}}$R.prototype.exec=function(t,e){if(typeof e!="number")throw new Error("Point size is not a number!");if(!(this._errorState>2)){var r=this.font,n=this._prepState;if(!n||n.ppem!==e){var i=this._fpgmState;if(!i){Fd.prototype=l$,i=this._fpgmState=new Fd("fpgm",r.tables.fpgm),i.funcs=[],i.font=r,Ye.DEBUG&&(console.log("---EXEC FPGM---"),i.step=-1);try{kh(i)}catch(u){console.log("Hinting error in FPGM:"+u),this._errorState=3;return}}Fd.prototype=i,n=this._prepState=new Fd("prep",r.tables.prep),n.ppem=e;var a=r.tables.cvt;if(a)for(var s=n.cvt=new Array(a.length),o=e/r.unitsPerEm,l=0;l<a.length;l++)s[l]=a[l]*o;else n.cvt=[];Ye.DEBUG&&(console.log("---EXEC PREP---"),n.step=-1);try{kh(n)}catch(u){this._errorState<2&&console.log("Hinting error in PREP:"+u),this._errorState=2}}if(!(this._errorState>1))try{return qR(t,n)}catch(u){this._errorState<1&&(console.log("Hinting error:"+u),console.log("Note: further hinting errors are silenced")),this._errorState=1;return}}};qR=function(t,e){var r=e.ppem/e.font.unitsPerEm,n=r,i=t.components,a,s,o;if(Fd.prototype=e,!i)o=new Fd("glyf",t.instructions),Ye.DEBUG&&(console.log("---EXEC GLYPH---"),o.step=-1),vk(t,o,r,n),s=o.gZone;else{var l=e.font;s=[],a=[];for(var u=0;u<i.length;u++){var c=i[u],f=l.glyphs.get(c.glyphIndex);o=new Fd("glyf",f.instructions),Ye.DEBUG&&(console.log("---EXEC COMP "+u+"---"),o.step=-1),vk(f,o,r,n);for(var p=Math.round(c.dx*r),v=Math.round(c.dy*n),y=o.gZone,S=o.contours,w=0;w<y.length;w++){var T=y[w];T.xTouched=T.yTouched=!1,T.xo=T.x=T.x+p,T.yo=T.y=T.y+v}var _=s.length;s.push.apply(s,y);for(var C=0;C<S.length;C++)a.push(S[C]+_)}t.instructions&&!o.inhibitGridFit&&(o=new Fd("glyf",t.instructions),o.gZone=o.z0=o.z1=o.z2=s,o.contours=a,s.push(new mc(0,0),new mc(Math.round(t.advanceWidth*r),0)),Ye.DEBUG&&(console.log("---EXEC COMPOSITE---"),o.step=-1),kh(o),s.length-=2)}return s};vk=function(t,e,r,n){for(var i=t.points||[],a=i.length,s=e.gZone=e.z0=e.z1=e.z2=[],o=e.contours=[],l,u=0;u<a;u++)l=i[u],s[u]=new mc(l.x*r,l.y*n,l.lastPointOfContour,l.onCurve);for(var c,f,p=0;p<a;p++)l=s[p],c||(c=l,o.push(p)),l.lastPointOfContour?(l.nextPointOnContour=c,c.prevPointOnContour=l,c=void 0):(f=s[p+1],l.nextPointOnContour=f,f.prevPointOnContour=l);if(!e.inhibitGridFit){if(Ye.DEBUG){console.log("PROCESSING GLYPH",e.stack);for(var v=0;v<a;v++)console.log(v,s[v].x,s[v].y)}if(s.push(new mc(0,0),new mc(Math.round(t.advanceWidth*r),0)),kh(e),s.length-=2,Ye.DEBUG){console.log("FINISHED GLYPH",e.stack);for(var y=0;y<a;y++)console.log(y,s[y].x,s[y].y)}}};kh=function(t){var e=t.prog;if(e){var r=e.length,n;for(t.ip=0;t.ip<r;t.ip++){if(Ye.DEBUG&&t.step++,n=WR[e[t.ip]],!n)throw new Error("unknown instruction: 0x"+Number(e[t.ip]).toString(16));n(t)}}};function W1(t){for(var e=t.tZone=new Array(t.gZone.length),r=0;r<e.length;r++)e[r]=new mc(0,0)}function YR(t,e){var r=t.prog,n=t.ip,i=1,a;do if(a=r[++n],a===88)i++;else if(a===89)i--;else if(a===64)n+=r[n+1]+1;else if(a===65)n+=2*r[n+1]+1;else if(a>=176&&a<=183)n+=a-176+1;else if(a>=184&&a<=191)n+=(a-184+1)*2;else if(e&&i===1&&a===27)break;while(i>0);t.ip=n}function s3(t,e){Ye.DEBUG&&console.log(e.step,"SVTCA["+t.axis+"]"),e.fv=e.pv=e.dpv=t}function o3(t,e){Ye.DEBUG&&console.log(e.step,"SPVTCA["+t.axis+"]"),e.pv=e.dpv=t}function l3(t,e){Ye.DEBUG&&console.log(e.step,"SFVTCA["+t.axis+"]"),e.fv=t}function u3(t,e){var r=e.stack,n=r.pop(),i=r.pop(),a=e.z2[n],s=e.z1[i];Ye.DEBUG&&console.log("SPVTL["+t+"]",n,i);var o,l;t?(o=a.y-s.y,l=s.x-a.x):(o=s.x-a.x,l=s.y-a.y),e.pv=e.dpv=h0(o,l)}function c3(t,e){var r=e.stack,n=r.pop(),i=r.pop(),a=e.z2[n],s=e.z1[i];Ye.DEBUG&&console.log("SFVTL["+t+"]",n,i);var o,l;t?(o=a.y-s.y,l=s.x-a.x):(o=s.x-a.x,l=s.y-a.y),e.fv=h0(o,l)}function u$(t){var e=t.stack,r=e.pop(),n=e.pop();Ye.DEBUG&&console.log(t.step,"SPVFS[]",r,n),t.pv=t.dpv=h0(n,r)}function c$(t){var e=t.stack,r=e.pop(),n=e.pop();Ye.DEBUG&&console.log(t.step,"SPVFS[]",r,n),t.fv=h0(n,r)}function d$(t){var e=t.stack,r=t.pv;Ye.DEBUG&&console.log(t.step,"GPV[]"),e.push(r.x*16384),e.push(r.y*16384)}function f$(t){var e=t.stack,r=t.fv;Ye.DEBUG&&console.log(t.step,"GFV[]"),e.push(r.x*16384),e.push(r.y*16384)}function h$(t){t.fv=t.pv,Ye.DEBUG&&console.log(t.step,"SFVTPV[]")}function p$(t){var e=t.stack,r=e.pop(),n=e.pop(),i=e.pop(),a=e.pop(),s=e.pop(),o=t.z0,l=t.z1,u=o[r],c=o[n],f=l[i],p=l[a],v=t.z2[s];Ye.DEBUG&&console.log("ISECT[], ",r,n,i,a,s);var y=u.x,S=u.y,w=c.x,T=c.y,_=f.x,C=f.y,N=p.x,A=p.y,O=(y-w)*(C-A)-(S-T)*(_-N),j=y*T-S*w,D=_*A-C*N;v.x=(j*(_-N)-D*(y-w))/O,v.y=(j*(C-A)-D*(S-T))/O}function m$(t){t.rp0=t.stack.pop(),Ye.DEBUG&&console.log(t.step,"SRP0[]",t.rp0)}function g$(t){t.rp1=t.stack.pop(),Ye.DEBUG&&console.log(t.step,"SRP1[]",t.rp1)}function v$(t){t.rp2=t.stack.pop(),Ye.DEBUG&&console.log(t.step,"SRP2[]",t.rp2)}function y$(t){var e=t.stack.pop();switch(Ye.DEBUG&&console.log(t.step,"SZP0[]",e),t.zp0=e,e){case 0:t.tZone||W1(t),t.z0=t.tZone;break;case 1:t.z0=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function x$(t){var e=t.stack.pop();switch(Ye.DEBUG&&console.log(t.step,"SZP1[]",e),t.zp1=e,e){case 0:t.tZone||W1(t),t.z1=t.tZone;break;case 1:t.z1=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function b$(t){var e=t.stack.pop();switch(Ye.DEBUG&&console.log(t.step,"SZP2[]",e),t.zp2=e,e){case 0:t.tZone||W1(t),t.z2=t.tZone;break;case 1:t.z2=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function w$(t){var e=t.stack.pop();switch(Ye.DEBUG&&console.log(t.step,"SZPS[]",e),t.zp0=t.zp1=t.zp2=e,e){case 0:t.tZone||W1(t),t.z0=t.z1=t.z2=t.tZone;break;case 1:t.z0=t.z1=t.z2=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function S$(t){t.loop=t.stack.pop(),Ye.DEBUG&&console.log(t.step,"SLOOP[]",t.loop)}function k$(t){Ye.DEBUG&&console.log(t.step,"RTG[]"),t.round=KR}function _$(t){Ye.DEBUG&&console.log(t.step,"RTHG[]"),t.round=a$}function C$(t){var e=t.stack.pop();Ye.DEBUG&&console.log(t.step,"SMD[]",e),t.minDis=e/64}function E$(t){Ye.DEBUG&&console.log(t.step,"ELSE[]"),YR(t,!1)}function T$(t){var e=t.stack.pop();Ye.DEBUG&&console.log(t.step,"JMPR[]",e),t.ip+=e-1}function N$(t){var e=t.stack.pop();Ye.DEBUG&&console.log(t.step,"SCVTCI[]",e),t.cvCutIn=e/64}function P$(t){var e=t.stack;Ye.DEBUG&&console.log(t.step,"DUP[]"),e.push(e[e.length-1])}function q2(t){Ye.DEBUG&&console.log(t.step,"POP[]"),t.stack.pop()}function M$(t){Ye.DEBUG&&console.log(t.step,"CLEAR[]"),t.stack.length=0}function A$(t){var e=t.stack,r=e.pop(),n=e.pop();Ye.DEBUG&&console.log(t.step,"SWAP[]"),e.push(r),e.push(n)}function L$(t){var e=t.stack;Ye.DEBUG&&console.log(t.step,"DEPTH[]"),e.push(e.length)}function R$(t){var e=t.stack,r=e.pop(),n=e.pop();Ye.DEBUG&&console.log(t.step,"LOOPCALL[]",r,n);var i=t.ip,a=t.prog;t.prog=t.funcs[r];for(var s=0;s<n;s++)kh(t),Ye.DEBUG&&console.log(++t.step,s+1<n?"next loopcall":"done loopcall",s);t.ip=i,t.prog=a}function O$(t){var e=t.stack.pop();Ye.DEBUG&&console.log(t.step,"CALL[]",e);var r=t.ip,n=t.prog;t.prog=t.funcs[e],kh(t),t.ip=r,t.prog=n,Ye.DEBUG&&console.log(++t.step,"returning from",e)}function D$(t){var e=t.stack,r=e.pop();Ye.DEBUG&&console.log(t.step,"CINDEX[]",r),e.push(e[e.length-r])}function I$(t){var e=t.stack,r=e.pop();Ye.DEBUG&&console.log(t.step,"MINDEX[]",r),e.push(e.splice(e.length-r,1)[0])}function j$(t){if(t.env!=="fpgm")throw new Error("FDEF not allowed here");var e=t.stack,r=t.prog,n=t.ip,i=e.pop(),a=n;for(Ye.DEBUG&&console.log(t.step,"FDEF[]",i);r[++n]!==45;);t.ip=n,t.funcs[i]=r.slice(a+1,n)}function d3(t,e){var r=e.stack.pop(),n=e.z0[r],i=e.fv,a=e.pv;Ye.DEBUG&&console.log(e.step,"MDAP["+t+"]",r);var s=a.distance(n,Iv);t&&(s=e.round(s)),i.setRelative(n,Iv,s,a),i.touch(n),e.rp0=e.rp1=r}function f3(t,e){var r=e.z2,n=r.length-2,i,a,s;Ye.DEBUG&&console.log(e.step,"IUP["+t.axis+"]");for(var o=0;o<n;o++)i=r[o],!t.touched(i)&&(a=i.prevTouched(t),a!==i&&(s=i.nextTouched(t),a===s&&t.setRelative(i,i,t.distance(a,a,!1,!0),t,!0),t.interpolate(i,a,s,t)))}function h3(t,e){for(var r=e.stack,n=t?e.rp1:e.rp2,i=(t?e.z0:e.z1)[n],a=e.fv,s=e.pv,o=e.loop,l=e.z2;o--;){var u=r.pop(),c=l[u],f=s.distance(i,i,!1,!0);a.setRelative(c,c,f,s),a.touch(c),Ye.DEBUG&&console.log(e.step,(e.loop>1?"loop "+(e.loop-o)+": ":"")+"SHP["+(t?"rp1":"rp2")+"]",u)}e.loop=1}function p3(t,e){var r=e.stack,n=t?e.rp1:e.rp2,i=(t?e.z0:e.z1)[n],a=e.fv,s=e.pv,o=r.pop(),l=e.z2[e.contours[o]],u=l;Ye.DEBUG&&console.log(e.step,"SHC["+t+"]",o);var c=s.distance(i,i,!1,!0);do u!==i&&a.setRelative(u,u,c,s),u=u.nextPointOnContour;while(u!==l)}function m3(t,e){var r=e.stack,n=t?e.rp1:e.rp2,i=(t?e.z0:e.z1)[n],a=e.fv,s=e.pv,o=r.pop();Ye.DEBUG&&console.log(e.step,"SHZ["+t+"]",o);var l;switch(o){case 0:l=e.tZone;break;case 1:l=e.gZone;break;default:throw new Error("Invalid zone")}for(var u,c=s.distance(i,i,!1,!0),f=l.length-2,p=0;p<f;p++)u=l[p],a.setRelative(u,u,c,s)}function F$(t){for(var e=t.stack,r=t.loop,n=t.fv,i=e.pop()/64,a=t.z2;r--;){var s=e.pop(),o=a[s];Ye.DEBUG&&console.log(t.step,(t.loop>1?"loop "+(t.loop-r)+": ":"")+"SHPIX[]",s,i),n.setRelative(o,o,i),n.touch(o)}t.loop=1}function B$(t){for(var e=t.stack,r=t.rp1,n=t.rp2,i=t.loop,a=t.z0[r],s=t.z1[n],o=t.fv,l=t.dpv,u=t.z2;i--;){var c=e.pop(),f=u[c];Ye.DEBUG&&console.log(t.step,(t.loop>1?"loop "+(t.loop-i)+": ":"")+"IP[]",c,r,"<->",n),o.interpolate(f,a,s,l),o.touch(f)}t.loop=1}function g3(t,e){var r=e.stack,n=r.pop()/64,i=r.pop(),a=e.z1[i],s=e.z0[e.rp0],o=e.fv,l=e.pv;o.setRelative(a,s,n,l),o.touch(a),Ye.DEBUG&&console.log(e.step,"MSIRP["+t+"]",n,i),e.rp1=e.rp0,e.rp2=i,t&&(e.rp0=i)}function z$(t){for(var e=t.stack,r=t.rp0,n=t.z0[r],i=t.loop,a=t.fv,s=t.pv,o=t.z1;i--;){var l=e.pop(),u=o[l];Ye.DEBUG&&console.log(t.step,(t.loop>1?"loop "+(t.loop-i)+": ":"")+"ALIGNRP[]",l),a.setRelative(u,n,0,s),a.touch(u)}t.loop=1}function U$(t){Ye.DEBUG&&console.log(t.step,"RTDG[]"),t.round=i$}function v3(t,e){var r=e.stack,n=r.pop(),i=r.pop(),a=e.z0[i],s=e.fv,o=e.pv,l=e.cvt[n];Ye.DEBUG&&console.log(e.step,"MIAP["+t+"]",n,"(",l,")",i);var u=o.distance(a,Iv);t&&(Math.abs(u-l)<e.cvCutIn&&(u=l),u=e.round(u)),s.setRelative(a,Iv,u,o),e.zp0===0&&(a.xo=a.x,a.yo=a.y),s.touch(a),e.rp0=e.rp1=i}function G$(t){var e=t.prog,r=t.ip,n=t.stack,i=e[++r];Ye.DEBUG&&console.log(t.step,"NPUSHB[]",i);for(var a=0;a<i;a++)n.push(e[++r]);t.ip=r}function V$(t){var e=t.ip,r=t.prog,n=t.stack,i=r[++e];Ye.DEBUG&&console.log(t.step,"NPUSHW[]",i);for(var a=0;a<i;a++){var s=r[++e]<<8|r[++e];s&32768&&(s=-((s^65535)+1)),n.push(s)}t.ip=e}function H$(t){var e=t.stack,r=t.store;r||(r=t.store=[]);var n=e.pop(),i=e.pop();Ye.DEBUG&&console.log(t.step,"WS",n,i),r[i]=n}function W$(t){var e=t.stack,r=t.store,n=e.pop();Ye.DEBUG&&console.log(t.step,"RS",n);var i=r&&r[n]||0;e.push(i)}function q$(t){var e=t.stack,r=e.pop(),n=e.pop();Ye.DEBUG&&console.log(t.step,"WCVTP",r,n),t.cvt[n]=r/64}function $$(t){var e=t.stack,r=e.pop();Ye.DEBUG&&console.log(t.step,"RCVT",r),e.push(t.cvt[r]*64)}function y3(t,e){var r=e.stack,n=r.pop(),i=e.z2[n];Ye.DEBUG&&console.log(e.step,"GC["+t+"]",n),r.push(e.dpv.distance(i,Iv,t,!1)*64)}function x3(t,e){var r=e.stack,n=r.pop(),i=r.pop(),a=e.z1[n],s=e.z0[i],o=e.dpv.distance(s,a,t,t);Ye.DEBUG&&console.log(e.step,"MD["+t+"]",n,i,"->",o),e.stack.push(Math.round(o*64))}function K$(t){Ye.DEBUG&&console.log(t.step,"MPPEM[]"),t.stack.push(t.ppem)}function Z$(t){Ye.DEBUG&&console.log(t.step,"FLIPON[]"),t.autoFlip=!0}function Y$(t){var e=t.stack,r=e.pop(),n=e.pop();Ye.DEBUG&&console.log(t.step,"LT[]",r,n),e.push(n<r?1:0)}function X$(t){var e=t.stack,r=e.pop(),n=e.pop();Ye.DEBUG&&console.log(t.step,"LTEQ[]",r,n),e.push(n<=r?1:0)}function Q$(t){var e=t.stack,r=e.pop(),n=e.pop();Ye.DEBUG&&console.log(t.step,"GT[]",r,n),e.push(n>r?1:0)}function J$(t){var e=t.stack,r=e.pop(),n=e.pop();Ye.DEBUG&&console.log(t.step,"GTEQ[]",r,n),e.push(n>=r?1:0)}function eK(t){var e=t.stack,r=e.pop(),n=e.pop();Ye.DEBUG&&console.log(t.step,"EQ[]",r,n),e.push(r===n?1:0)}function tK(t){var e=t.stack,r=e.pop(),n=e.pop();Ye.DEBUG&&console.log(t.step,"NEQ[]",r,n),e.push(r!==n?1:0)}function rK(t){var e=t.stack,r=e.pop();Ye.DEBUG&&console.log(t.step,"ODD[]",r),e.push(Math.trunc(r)%2?1:0)}function nK(t){var e=t.stack,r=e.pop();Ye.DEBUG&&console.log(t.step,"EVEN[]",r),e.push(Math.trunc(r)%2?0:1)}function iK(t){var e=t.stack.pop();Ye.DEBUG&&console.log(t.step,"IF[]",e),e||(YR(t,!0),Ye.DEBUG&&console.log(t.step,"EIF[]"))}function aK(t){Ye.DEBUG&&console.log(t.step,"EIF[]")}function sK(t){var e=t.stack,r=e.pop(),n=e.pop();Ye.DEBUG&&console.log(t.step,"AND[]",r,n),e.push(r&&n?1:0)}function oK(t){var e=t.stack,r=e.pop(),n=e.pop();Ye.DEBUG&&console.log(t.step,"OR[]",r,n),e.push(r||n?1:0)}function lK(t){var e=t.stack,r=e.pop();Ye.DEBUG&&console.log(t.step,"NOT[]",r),e.push(r?0:1)}function $2(t,e){var r=e.stack,n=r.pop(),i=e.fv,a=e.pv,s=e.ppem,o=e.deltaBase+(t-1)*16,l=e.deltaShift,u=e.z0;Ye.DEBUG&&console.log(e.step,"DELTAP["+t+"]",n,r);for(var c=0;c<n;c++){var f=r.pop(),p=r.pop(),v=o+((p&240)>>4);if(v===s){var y=(p&15)-8;y>=0&&y++,Ye.DEBUG&&console.log(e.step,"DELTAPFIX",f,"by",y*l);var S=u[f];i.setRelative(S,S,y*l,a)}}}function uK(t){var e=t.stack,r=e.pop();Ye.DEBUG&&console.log(t.step,"SDB[]",r),t.deltaBase=r}function cK(t){var e=t.stack,r=e.pop();Ye.DEBUG&&console.log(t.step,"SDS[]",r),t.deltaShift=Math.pow(.5,r)}function dK(t){var e=t.stack,r=e.pop(),n=e.pop();Ye.DEBUG&&console.log(t.step,"ADD[]",r,n),e.push(n+r)}function fK(t){var e=t.stack,r=e.pop(),n=e.pop();Ye.DEBUG&&console.log(t.step,"SUB[]",r,n),e.push(n-r)}function hK(t){var e=t.stack,r=e.pop(),n=e.pop();Ye.DEBUG&&console.log(t.step,"DIV[]",r,n),e.push(n*64/r)}function pK(t){var e=t.stack,r=e.pop(),n=e.pop();Ye.DEBUG&&console.log(t.step,"MUL[]",r,n),e.push(n*r/64)}function mK(t){var e=t.stack,r=e.pop();Ye.DEBUG&&console.log(t.step,"ABS[]",r),e.push(Math.abs(r))}function gK(t){var e=t.stack,r=e.pop();Ye.DEBUG&&console.log(t.step,"NEG[]",r),e.push(-r)}function vK(t){var e=t.stack,r=e.pop();Ye.DEBUG&&console.log(t.step,"FLOOR[]",r),e.push(Math.floor(r/64)*64)}function yK(t){var e=t.stack,r=e.pop();Ye.DEBUG&&console.log(t.step,"CEILING[]",r),e.push(Math.ceil(r/64)*64)}function ky(t,e){var r=e.stack,n=r.pop();Ye.DEBUG&&console.log(e.step,"ROUND[]"),r.push(e.round(n/64)*64)}function xK(t){var e=t.stack,r=e.pop(),n=e.pop();Ye.DEBUG&&console.log(t.step,"WCVTF[]",r,n),t.cvt[n]=r*t.ppem/t.font.unitsPerEm}function K2(t,e){var r=e.stack,n=r.pop(),i=e.ppem,a=e.deltaBase+(t-1)*16,s=e.deltaShift;Ye.DEBUG&&console.log(e.step,"DELTAC["+t+"]",n,r);for(var o=0;o<n;o++){var l=r.pop(),u=r.pop(),c=a+((u&240)>>4);if(c===i){var f=(u&15)-8;f>=0&&f++;var p=f*s;Ye.DEBUG&&console.log(e.step,"DELTACFIX",l,"by",p),e.cvt[l]+=p}}}function bK(t){var e=t.stack.pop();Ye.DEBUG&&console.log(t.step,"SROUND[]",e),t.round=ZR;var r;switch(e&192){case 0:r=.5;break;case 64:r=1;break;case 128:r=2;break;default:throw new Error("invalid SROUND value")}switch(t.srPeriod=r,e&48){case 0:t.srPhase=0;break;case 16:t.srPhase=.25*r;break;case 32:t.srPhase=.5*r;break;case 48:t.srPhase=.75*r;break;default:throw new Error("invalid SROUND value")}e&=15,e===0?t.srThreshold=0:t.srThreshold=(e/8-.5)*r}function wK(t){var e=t.stack.pop();Ye.DEBUG&&console.log(t.step,"S45ROUND[]",e),t.round=ZR;var r;switch(e&192){case 0:r=Math.sqrt(2)/2;break;case 64:r=Math.sqrt(2);break;case 128:r=2*Math.sqrt(2);break;default:throw new Error("invalid S45ROUND value")}switch(t.srPeriod=r,e&48){case 0:t.srPhase=0;break;case 16:t.srPhase=.25*r;break;case 32:t.srPhase=.5*r;break;case 48:t.srPhase=.75*r;break;default:throw new Error("invalid S45ROUND value")}e&=15,e===0?t.srThreshold=0:t.srThreshold=(e/8-.5)*r}function SK(t){Ye.DEBUG&&console.log(t.step,"ROFF[]"),t.round=n$}function kK(t){Ye.DEBUG&&console.log(t.step,"RUTG[]"),t.round=s$}function _K(t){Ye.DEBUG&&console.log(t.step,"RDTG[]"),t.round=o$}function CK(t){var e=t.stack.pop();Ye.DEBUG&&console.log(t.step,"SCANCTRL[]",e)}function b3(t,e){var r=e.stack,n=r.pop(),i=r.pop(),a=e.z2[n],s=e.z1[i];Ye.DEBUG&&console.log(e.step,"SDPVTL["+t+"]",n,i);var o,l;t?(o=a.y-s.y,l=s.x-a.x):(o=s.x-a.x,l=s.y-a.y),e.dpv=h0(o,l)}function EK(t){var e=t.stack,r=e.pop(),n=0;Ye.DEBUG&&console.log(t.step,"GETINFO[]",r),r&1&&(n=35),r&32&&(n|=4096),e.push(n)}function TK(t){var e=t.stack,r=e.pop(),n=e.pop(),i=e.pop();Ye.DEBUG&&console.log(t.step,"ROLL[]"),e.push(n),e.push(r),e.push(i)}function NK(t){var e=t.stack,r=e.pop(),n=e.pop();Ye.DEBUG&&console.log(t.step,"MAX[]",r,n),e.push(Math.max(n,r))}function PK(t){var e=t.stack,r=e.pop(),n=e.pop();Ye.DEBUG&&console.log(t.step,"MIN[]",r,n),e.push(Math.min(n,r))}function MK(t){var e=t.stack.pop();Ye.DEBUG&&console.log(t.step,"SCANTYPE[]",e)}function AK(t){var e=t.stack.pop(),r=t.stack.pop();switch(Ye.DEBUG&&console.log(t.step,"INSTCTRL[]",e,r),e){case 1:t.inhibitGridFit=!!r;return;case 2:t.ignoreCvt=!!r;return;default:throw new Error("invalid INSTCTRL[] selector")}}function kd(t,e){var r=e.stack,n=e.prog,i=e.ip;Ye.DEBUG&&console.log(e.step,"PUSHB["+t+"]");for(var a=0;a<t;a++)r.push(n[++i]);e.ip=i}function _d(t,e){var r=e.ip,n=e.prog,i=e.stack;Ye.DEBUG&&console.log(e.ip,"PUSHW["+t+"]");for(var a=0;a<t;a++){var s=n[++r]<<8|n[++r];s&32768&&(s=-((s^65535)+1)),i.push(s)}e.ip=r}function jt(t,e,r,n,i,a){var s=a.stack,o=t&&s.pop(),l=s.pop(),u=a.rp0,c=a.z0[u],f=a.z1[l],p=a.minDis,v=a.fv,y=a.dpv,S,w,T,_;w=S=y.distance(f,c,!0,!0),T=w>=0?1:-1,w=Math.abs(w),t&&(_=a.cvt[o],n&&Math.abs(w-_)<a.cvCutIn&&(w=_)),r&&w<p&&(w=p),n&&(w=a.round(w)),v.setRelative(f,c,T*w,y),v.touch(f),Ye.DEBUG&&console.log(a.step,(t?"MIRP[":"MDRP[")+(e?"M":"m")+(r?">":"_")+(n?"R":"_")+(i===0?"Gr":i===1?"Bl":i===2?"Wh":"")+"]",t?o+"("+a.cvt[o]+","+_+")":"",l,"(d =",S,"->",T*w,")"),a.rp1=a.rp0,a.rp2=l,e&&(a.rp0=l)}WR=[s3.bind(void 0,hc),s3.bind(void 0,wu),o3.bind(void 0,hc),o3.bind(void 0,wu),l3.bind(void 0,hc),l3.bind(void 0,wu),u3.bind(void 0,0),u3.bind(void 0,1),c3.bind(void 0,0),c3.bind(void 0,1),u$,c$,d$,f$,h$,p$,m$,g$,v$,y$,x$,b$,w$,S$,k$,_$,C$,E$,T$,N$,void 0,void 0,P$,q2,M$,A$,L$,D$,I$,void 0,void 0,void 0,R$,O$,j$,void 0,d3.bind(void 0,0),d3.bind(void 0,1),f3.bind(void 0,hc),f3.bind(void 0,wu),h3.bind(void 0,0),h3.bind(void 0,1),p3.bind(void 0,0),p3.bind(void 0,1),m3.bind(void 0,0),m3.bind(void 0,1),F$,B$,g3.bind(void 0,0),g3.bind(void 0,1),z$,U$,v3.bind(void 0,0),v3.bind(void 0,1),G$,V$,H$,W$,q$,$$,y3.bind(void 0,0),y3.bind(void 0,1),void 0,x3.bind(void 0,0),x3.bind(void 0,1),K$,void 0,Z$,void 0,void 0,Y$,X$,Q$,J$,eK,tK,rK,nK,iK,aK,sK,oK,lK,$2.bind(void 0,1),uK,cK,dK,fK,hK,pK,mK,gK,vK,yK,ky.bind(void 0,0),ky.bind(void 0,1),ky.bind(void 0,2),ky.bind(void 0,3),void 0,void 0,void 0,void 0,xK,$2.bind(void 0,2),$2.bind(void 0,3),K2.bind(void 0,1),K2.bind(void 0,2),K2.bind(void 0,3),bK,wK,void 0,void 0,SK,void 0,kK,_K,q2,q2,void 0,void 0,void 0,void 0,void 0,CK,b3.bind(void 0,0),b3.bind(void 0,1),EK,void 0,TK,NK,PK,MK,AK,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,kd.bind(void 0,1),kd.bind(void 0,2),kd.bind(void 0,3),kd.bind(void 0,4),kd.bind(void 0,5),kd.bind(void 0,6),kd.bind(void 0,7),kd.bind(void 0,8),_d.bind(void 0,1),_d.bind(void 0,2),_d.bind(void 0,3),_d.bind(void 0,4),_d.bind(void 0,5),_d.bind(void 0,6),_d.bind(void 0,7),_d.bind(void 0,8),jt.bind(void 0,0,0,0,0,0),jt.bind(void 0,0,0,0,0,1),jt.bind(void 0,0,0,0,0,2),jt.bind(void 0,0,0,0,0,3),jt.bind(void 0,0,0,0,1,0),jt.bind(void 0,0,0,0,1,1),jt.bind(void 0,0,0,0,1,2),jt.bind(void 0,0,0,0,1,3),jt.bind(void 0,0,0,1,0,0),jt.bind(void 0,0,0,1,0,1),jt.bind(void 0,0,0,1,0,2),jt.bind(void 0,0,0,1,0,3),jt.bind(void 0,0,0,1,1,0),jt.bind(void 0,0,0,1,1,1),jt.bind(void 0,0,0,1,1,2),jt.bind(void 0,0,0,1,1,3),jt.bind(void 0,0,1,0,0,0),jt.bind(void 0,0,1,0,0,1),jt.bind(void 0,0,1,0,0,2),jt.bind(void 0,0,1,0,0,3),jt.bind(void 0,0,1,0,1,0),jt.bind(void 0,0,1,0,1,1),jt.bind(void 0,0,1,0,1,2),jt.bind(void 0,0,1,0,1,3),jt.bind(void 0,0,1,1,0,0),jt.bind(void 0,0,1,1,0,1),jt.bind(void 0,0,1,1,0,2),jt.bind(void 0,0,1,1,0,3),jt.bind(void 0,0,1,1,1,0),jt.bind(void 0,0,1,1,1,1),jt.bind(void 0,0,1,1,1,2),jt.bind(void 0,0,1,1,1,3),jt.bind(void 0,1,0,0,0,0),jt.bind(void 0,1,0,0,0,1),jt.bind(void 0,1,0,0,0,2),jt.bind(void 0,1,0,0,0,3),jt.bind(void 0,1,0,0,1,0),jt.bind(void 0,1,0,0,1,1),jt.bind(void 0,1,0,0,1,2),jt.bind(void 0,1,0,0,1,3),jt.bind(void 0,1,0,1,0,0),jt.bind(void 0,1,0,1,0,1),jt.bind(void 0,1,0,1,0,2),jt.bind(void 0,1,0,1,0,3),jt.bind(void 0,1,0,1,1,0),jt.bind(void 0,1,0,1,1,1),jt.bind(void 0,1,0,1,1,2),jt.bind(void 0,1,0,1,1,3),jt.bind(void 0,1,1,0,0,0),jt.bind(void 0,1,1,0,0,1),jt.bind(void 0,1,1,0,0,2),jt.bind(void 0,1,1,0,0,3),jt.bind(void 0,1,1,0,1,0),jt.bind(void 0,1,1,0,1,1),jt.bind(void 0,1,1,0,1,2),jt.bind(void 0,1,1,0,1,3),jt.bind(void 0,1,1,1,0,0),jt.bind(void 0,1,1,1,0,1),jt.bind(void 0,1,1,1,0,2),jt.bind(void 0,1,1,1,0,3),jt.bind(void 0,1,1,1,1,0),jt.bind(void 0,1,1,1,1,1),jt.bind(void 0,1,1,1,1,2),jt.bind(void 0,1,1,1,1,3)];function xm(t){this.char=t,this.state={},this.activeState=null}function q_(t,e,r){this.contextName=r,this.startIndex=t,this.endOffset=e}function LK(t,e,r){this.contextName=t,this.openRange=null,this.ranges=[],this.checkStart=e,this.checkEnd=r}function Pl(t,e){this.context=t,this.index=e,this.length=t.length,this.current=t[e],this.backtrack=t.slice(0,e),this.lookahead=t.slice(e+1)}function q1(t){this.eventId=t,this.subscribers=[]}function RK(t){var e=this,r=["start","end","next","newToken","contextStart","contextEnd","insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD","updateContextsRanges"];r.forEach(function(i){Object.defineProperty(e.events,i,{value:new q1(i)})}),t&&r.forEach(function(i){var a=t[i];typeof a=="function"&&e.events[i].subscribe(a)});var n=["insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD"];n.forEach(function(i){e.events[i].subscribe(e.updateContextsRanges)})}function oi(t){this.tokens=[],this.registeredContexts={},this.contextCheckers=[],this.events={},this.registeredModifiers=[],RK.call(this,t)}xm.prototype.setState=function(t,e){return this.state[t]=e,this.activeState={key:t,value:this.state[t]},this.activeState};xm.prototype.getState=function(t){return this.state[t]||null};oi.prototype.inboundIndex=function(t){return t>=0&&t<this.tokens.length};oi.prototype.composeRUD=function(t){var e=this,r=!0,n=t.map(function(a){return e[a[0]].apply(e,a.slice(1).concat(r))}),i=function(a){return typeof a=="object"&&a.hasOwnProperty("FAIL")};if(n.every(i))return{FAIL:"composeRUD: one or more operations hasn't completed successfully",report:n.filter(i)};this.dispatch("composeRUD",[n.filter(function(a){return!i(a)})])};oi.prototype.replaceRange=function(t,e,r,n){e=e!==null?e:this.tokens.length;var i=r.every(function(s){return s instanceof xm});if(!isNaN(t)&&this.inboundIndex(t)&&i){var a=this.tokens.splice.apply(this.tokens,[t,e].concat(r));return n||this.dispatch("replaceToken",[t,e,r]),[a,r]}else return{FAIL:"replaceRange: invalid tokens or startIndex."}};oi.prototype.replaceToken=function(t,e,r){if(!isNaN(t)&&this.inboundIndex(t)&&e instanceof xm){var n=this.tokens.splice(t,1,e);return r||this.dispatch("replaceToken",[t,e]),[n[0],e]}else return{FAIL:"replaceToken: invalid token or index."}};oi.prototype.removeRange=function(t,e,r){e=isNaN(e)?this.tokens.length:e;var n=this.tokens.splice(t,e);return r||this.dispatch("removeRange",[n,t,e]),n};oi.prototype.removeToken=function(t,e){if(!isNaN(t)&&this.inboundIndex(t)){var r=this.tokens.splice(t,1);return e||this.dispatch("removeToken",[r,t]),r}else return{FAIL:"removeToken: invalid token index."}};oi.prototype.insertToken=function(t,e,r){var n=t.every(function(i){return i instanceof xm});return n?(this.tokens.splice.apply(this.tokens,[e,0].concat(t)),r||this.dispatch("insertToken",[t,e]),t):{FAIL:"insertToken: invalid token(s)."}};oi.prototype.registerModifier=function(t,e,r){this.events.newToken.subscribe(function(n,i){var a=[n,i],s=e===null||e.apply(this,a)===!0,o=[n,i];if(s){var l=r.apply(this,o);n.setState(t,l)}}),this.registeredModifiers.push(t)};q1.prototype.subscribe=function(t){return typeof t=="function"?this.subscribers.push(t)-1:{FAIL:"invalid '"+this.eventId+"' event handler"}};q1.prototype.unsubscribe=function(t){this.subscribers.splice(t,1)};Pl.prototype.setCurrentIndex=function(t){this.index=t,this.current=this.context[t],this.backtrack=this.context.slice(0,t),this.lookahead=this.context.slice(t+1)};Pl.prototype.get=function(t){switch(!0){case t===0:return this.current;case(t<0&&Math.abs(t)<=this.backtrack.length):return this.backtrack.slice(t)[0];case(t>0&&t<=this.lookahead.length):return this.lookahead[t-1];default:return null}};oi.prototype.rangeToText=function(t){if(t instanceof q_)return this.getRangeTokens(t).map(function(e){return e.char}).join("")};oi.prototype.getText=function(){return this.tokens.map(function(t){return t.char}).join("")};oi.prototype.getContext=function(t){var e=this.registeredContexts[t];return e||null};oi.prototype.on=function(t,e){var r=this.events[t];return r?r.subscribe(e):null};oi.prototype.dispatch=function(t,e){var r=this,n=this.events[t];n instanceof q1&&n.subscribers.forEach(function(i){i.apply(r,e||[])})};oi.prototype.registerContextChecker=function(t,e,r){if(this.getContext(t))return{FAIL:"context name '"+t+"' is already registered."};if(typeof e!="function")return{FAIL:"missing context start check."};if(typeof r!="function")return{FAIL:"missing context end check."};var n=new LK(t,e,r);return this.registeredContexts[t]=n,this.contextCheckers.push(n),n};oi.prototype.getRangeTokens=function(t){var e=t.startIndex+t.endOffset;return[].concat(this.tokens.slice(t.startIndex,e))};oi.prototype.getContextRanges=function(t){var e=this.getContext(t);return e?e.ranges:{FAIL:"context checker '"+t+"' is not registered."}};oi.prototype.resetContextsRanges=function(){var t=this.registeredContexts;for(var e in t)if(t.hasOwnProperty(e)){var r=t[e];r.ranges=[]}};oi.prototype.updateContextsRanges=function(){this.resetContextsRanges();for(var t=this.tokens.map(function(n){return n.char}),e=0;e<t.length;e++){var r=new Pl(t,e);this.runContextCheck(r)}this.dispatch("updateContextsRanges",[this.registeredContexts])};oi.prototype.setEndOffset=function(t,e){var r=this.getContext(e).openRange.startIndex,n=new q_(r,t,e),i=this.getContext(e).ranges;return n.rangeId=e+"."+i.length,i.push(n),this.getContext(e).openRange=null,n};oi.prototype.runContextCheck=function(t){var e=this,r=t.index;this.contextCheckers.forEach(function(n){var i=n.contextName,a=e.getContext(i).openRange;if(!a&&n.checkStart(t)&&(a=new q_(r,null,i),e.getContext(i).openRange=a,e.dispatch("contextStart",[i,r])),a&&n.checkEnd(t)){var s=r-a.startIndex+1,o=e.setEndOffset(s,i);e.dispatch("contextEnd",[i,o])}})};oi.prototype.tokenize=function(t){this.tokens=[],this.resetContextsRanges();var e=Array.from(t);this.dispatch("start");for(var r=0;r<e.length;r++){var n=e[r],i=new Pl(e,r);this.dispatch("next",[i]),this.runContextCheck(i);var a=new xm(n);this.tokens.push(a),this.dispatch("newToken",[a,i])}return this.dispatch("end",[this.tokens]),this.tokens};function qd(t){return/[\u0600-\u065F\u066A-\u06D2\u06FA-\u06FF]/.test(t)}function XR(t){return/[\u0630\u0690\u0621\u0631\u0661\u0671\u0622\u0632\u0672\u0692\u06C2\u0623\u0673\u0693\u06C3\u0624\u0694\u06C4\u0625\u0675\u0695\u06C5\u06E5\u0676\u0696\u06C6\u0627\u0677\u0697\u06C7\u0648\u0688\u0698\u06C8\u0689\u0699\u06C9\u068A\u06CA\u066B\u068B\u06CB\u068C\u068D\u06CD\u06FD\u068E\u06EE\u06FE\u062F\u068F\u06CF\u06EF]/.test(t)}function nf(t){return/[\u0600-\u0605\u060C-\u060E\u0610-\u061B\u061E\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED]/.test(t)}function Qy(t){return/[A-z]/.test(t)}function OK(t){return/\s/.test(t)}function po(t){this.font=t,this.features={}}function rh(t){this.id=t.id,this.tag=t.tag,this.substitution=t.substitution}function p0(t,e){if(!t)return-1;switch(e.format){case 1:return e.glyphs.indexOf(t);case 2:for(var r=e.ranges,n=0;n<r.length;n++){var i=r[n];if(t>=i.start&&t<=i.end){var a=t-i.start;return i.index+a}}break;default:return-1}return-1}function DK(t,e){var r=p0(t,e.coverage);return r===-1?null:t+e.deltaGlyphId}function IK(t,e){var r=p0(t,e.coverage);return r===-1?null:e.substitute[r]}function Z2(t,e){for(var r=[],n=0;n<t.length;n++){var i=t[n],a=e.current;a=Array.isArray(a)?a[0]:a;var s=p0(a,i);s!==-1&&r.push(s)}return r.length!==t.length?-1:r}function jK(t,e){var r=e.inputCoverage.length+e.lookaheadCoverage.length+e.backtrackCoverage.length;if(t.context.length<r)return[];var n=Z2(e.inputCoverage,t);if(n===-1)return[];var i=e.inputCoverage.length-1;if(t.lookahead.length<e.lookaheadCoverage.length)return[];for(var a=t.lookahead.slice(i);a.length&&nf(a[0].char);)a.shift();var s=new Pl(a,0),o=Z2(e.lookaheadCoverage,s),l=[].concat(t.backtrack);for(l.reverse();l.length&&nf(l[0].char);)l.shift();if(l.length<e.backtrackCoverage.length)return[];var u=new Pl(l,0),c=Z2(e.backtrackCoverage,u),f=n.length===e.inputCoverage.length&&o.length===e.lookaheadCoverage.length&&c.length===e.backtrackCoverage.length,p=[];if(f)for(var v=0;v<e.lookupRecords.length;v++)for(var y=e.lookupRecords[v],S=y.lookupListIndex,w=this.getLookupByIndex(S),T=0;T<w.subtables.length;T++){var _=w.subtables[T],C=this.getLookupMethod(w,_),N=this.getSubstitutionType(w,_);if(N==="12")for(var A=0;A<n.length;A++){var O=t.get(A),j=C(O);j&&p.push(j)}}return p}function FK(t,e){var r=t.current,n=p0(r,e.coverage);if(n===-1)return null;for(var i,a=e.ligatureSets[n],s=0;s<a.length;s++){i=a[s];for(var o=0;o<i.components.length;o++){var l=t.lookahead[o],u=i.components[o];if(l!==u)break;if(o===i.components.length-1)return i}}return null}function BK(t,e){var r=p0(t,e.coverage);return r===-1?null:e.sequences[r]}po.prototype.getDefaultScriptFeaturesIndexes=function(){for(var t=this.font.tables.gsub.scripts,e=0;e<t.length;e++){var r=t[e];if(r.tag==="DFLT")return r.script.defaultLangSys.featureIndexes}return[]};po.prototype.getScriptFeaturesIndexes=function(t){var e=this.font.tables;if(!e.gsub)return[];if(!t)return this.getDefaultScriptFeaturesIndexes();for(var r=this.font.tables.gsub.scripts,n=0;n<r.length;n++){var i=r[n];if(i.tag===t&&i.script.defaultLangSys)return i.script.defaultLangSys.featureIndexes;var a=i.langSysRecords;if(a)for(var s=0;s<a.length;s++){var o=a[s];if(o.tag===t){var l=o.langSys;return l.featureIndexes}}}return this.getDefaultScriptFeaturesIndexes()};po.prototype.mapTagsToFeatures=function(t,e){for(var r={},n=0;n<t.length;n++){var i=t[n].tag,a=t[n].feature;r[i]=a}this.features[e].tags=r};po.prototype.getScriptFeatures=function(t){var e=this.features[t];if(this.features.hasOwnProperty(t))return e;var r=this.getScriptFeaturesIndexes(t);if(!r)return null;var n=this.font.tables.gsub;return e=r.map(function(i){return n.features[i]}),this.features[t]=e,this.mapTagsToFeatures(e,t),e};po.prototype.getSubstitutionType=function(t,e){var r=t.lookupType.toString(),n=e.substFormat.toString();return r+n};po.prototype.getLookupMethod=function(t,e){var r=this,n=this.getSubstitutionType(t,e);switch(n){case"11":return function(i){return DK.apply(r,[i,e])};case"12":return function(i){return IK.apply(r,[i,e])};case"63":return function(i){return jK.apply(r,[i,e])};case"41":return function(i){return FK.apply(r,[i,e])};case"21":return function(i){return BK.apply(r,[i,e])};default:throw new Error("lookupType: "+t.lookupType+" - substFormat: "+e.substFormat+" is not yet supported")}};po.prototype.lookupFeature=function(t){var e=t.contextParams,r=e.index,n=this.getFeature({tag:t.tag,script:t.script});if(!n)return new Error("font '"+this.font.names.fullName.en+"' doesn't support feature '"+t.tag+"' for script '"+t.script+"'.");for(var i=this.getFeatureLookups(n),a=[].concat(e.context),s=0;s<i.length;s++)for(var o=i[s],l=this.getLookupSubtables(o),u=0;u<l.length;u++){var c=l[u],f=this.getSubstitutionType(o,c),p=this.getLookupMethod(o,c),v=void 0;switch(f){case"11":v=p(e.current),v&&a.splice(r,1,new rh({id:11,tag:t.tag,substitution:v}));break;case"12":v=p(e.current),v&&a.splice(r,1,new rh({id:12,tag:t.tag,substitution:v}));break;case"63":v=p(e),Array.isArray(v)&&v.length&&a.splice(r,1,new rh({id:63,tag:t.tag,substitution:v}));break;case"41":v=p(e),v&&a.splice(r,1,new rh({id:41,tag:t.tag,substitution:v}));break;case"21":v=p(e.current),v&&a.splice(r,1,new rh({id:21,tag:t.tag,substitution:v}));break}e=new Pl(a,r),!(Array.isArray(v)&&!v.length)&&(v=null)}return a.length?a:null};po.prototype.supports=function(t){if(!t.script)return!1;this.getScriptFeatures(t.script);var e=this.features.hasOwnProperty(t.script);if(!t.tag)return e;var r=this.features[t.script].some(function(n){return n.tag===t.tag});return e&&r};po.prototype.getLookupSubtables=function(t){return t.subtables||null};po.prototype.getLookupByIndex=function(t){var e=this.font.tables.gsub.lookups;return e[t]||null};po.prototype.getFeatureLookups=function(t){return t.lookupListIndexes.map(this.getLookupByIndex.bind(this))};po.prototype.getFeature=function(e){if(!this.font)return{FAIL:"No font was found"};this.features.hasOwnProperty(e.script)||this.getScriptFeatures(e.script);var r=this.features[e.script];return r?r.tags[e.tag]?this.features[e.script].tags[e.tag]:null:{FAIL:"No feature for script "+e.script}};function zK(t){var e=t.current,r=t.get(-1);return r===null&&qd(e)||!qd(r)&&qd(e)}function UK(t){var e=t.get(1);return e===null||!qd(e)}var GK={startCheck:zK,endCheck:UK};function VK(t){var e=t.current,r=t.get(-1);return(qd(e)||nf(e))&&!qd(r)}function HK(t){var e=t.get(1);switch(!0){case e===null:return!0;case(!qd(e)&&!nf(e)):var r=OK(e);if(!r)return!0;if(r){var n=!1;if(n=t.lookahead.some(function(i){return qd(i)||nf(i)}),!n)return!0}break;default:return!1}}var WK={startCheck:VK,endCheck:HK};function qK(t,e,r){e[r].setState(t.tag,t.substitution)}function $K(t,e,r){e[r].setState(t.tag,t.substitution)}function KK(t,e,r){t.substitution.forEach(function(n,i){var a=e[r+i];a.setState(t.tag,n)})}function ZK(t,e,r){var n=e[r];n.setState(t.tag,t.substitution.ligGlyph);for(var i=t.substitution.components.length,a=0;a<i;a++)n=e[r+a+1],n.setState("deleted",!0)}var w3={11:qK,12:$K,63:KK,41:ZK};function $_(t,e,r){t instanceof rh&&w3[t.id]&&w3[t.id](t,e,r)}function YK(t){for(var e=[].concat(t.backtrack),r=e.length-1;r>=0;r--){var n=e[r],i=XR(n),a=nf(n);if(!i&&!a)return!0;if(i)return!1}return!1}function XK(t){if(XR(t.current))return!1;for(var e=0;e<t.lookahead.length;e++){var r=t.lookahead[e],n=nf(r);if(!n)return!0}return!1}function QK(t){var e=this,r="arab",n=this.featuresTags[r],i=this.tokenizer.getRangeTokens(t);if(i.length!==1){var a=new Pl(i.map(function(o){return o.getState("glyphIndex")}),0),s=new Pl(i.map(function(o){return o.char}),0);i.forEach(function(o,l){if(!nf(o.char)){a.setCurrentIndex(l),s.setCurrentIndex(l);var u=0;YK(s)&&(u|=1),XK(s)&&(u|=2);var c;switch(u){case 1:c="fina";break;case 2:c="init";break;case 3:c="medi";break}if(n.indexOf(c)!==-1){var f=e.query.lookupFeature({tag:c,script:r,contextParams:a});if(f instanceof Error)return console.info(f.message);f.forEach(function(p,v){p instanceof rh&&($_(p,i,v),a.context[v]=p.substitution)})}}})}}function S3(t,e){var r=t.map(function(n){return n.activeState.value});return new Pl(r,0)}function JK(t){var e=this,r="arab",n=this.tokenizer.getRangeTokens(t),i=S3(n);i.context.forEach(function(a,s){i.setCurrentIndex(s);var o=e.query.lookupFeature({tag:"rlig",script:r,contextParams:i});o.length&&(o.forEach(function(l){return $_(l,n,s)}),i=S3(n))})}function eZ(t){var e=t.current,r=t.get(-1);return r===null&&Qy(e)||!Qy(r)&&Qy(e)}function tZ(t){var e=t.get(1);return e===null||!Qy(e)}var rZ={startCheck:eZ,endCheck:tZ};function k3(t,e){var r=t.map(function(n){return n.activeState.value});return new Pl(r,0)}function nZ(t){var e=this,r="latn",n=this.tokenizer.getRangeTokens(t),i=k3(n);i.context.forEach(function(a,s){i.setCurrentIndex(s);var o=e.query.lookupFeature({tag:"liga",script:r,contextParams:i});o.length&&(o.forEach(function(l){return $_(l,n,s)}),i=k3(n))})}function Ol(t){this.baseDir=t||"ltr",this.tokenizer=new oi,this.featuresTags={}}Ol.prototype.setText=function(t){this.text=t};Ol.prototype.contextChecks={latinWordCheck:rZ,arabicWordCheck:GK,arabicSentenceCheck:WK};function Y2(t){var e=this.contextChecks[t+"Check"];return this.tokenizer.registerContextChecker(t,e.startCheck,e.endCheck)}function iZ(){return Y2.call(this,"latinWord"),Y2.call(this,"arabicWord"),Y2.call(this,"arabicSentence"),this.tokenizer.tokenize(this.text)}function aZ(){var t=this,e=this.tokenizer.getContextRanges("arabicSentence");e.forEach(function(r){var n=t.tokenizer.getRangeTokens(r);t.tokenizer.replaceRange(r.startIndex,r.endOffset,n.reverse())})}Ol.prototype.registerFeatures=function(t,e){var r=this,n=e.filter(function(i){return r.query.supports({script:t,tag:i})});this.featuresTags.hasOwnProperty(t)?this.featuresTags[t]=this.featuresTags[t].concat(n):this.featuresTags[t]=n};Ol.prototype.applyFeatures=function(t,e){if(!t)throw new Error("No valid font was provided to apply features");this.query||(this.query=new po(t));for(var r=0;r<e.length;r++){var n=e[r];this.query.supports({script:n.script})&&this.registerFeatures(n.script,n.tags)}};Ol.prototype.registerModifier=function(t,e,r){this.tokenizer.registerModifier(t,e,r)};function K_(){if(this.tokenizer.registeredModifiers.indexOf("glyphIndex")===-1)throw new Error("glyphIndex modifier is required to apply arabic presentation features.")}function sZ(){var t=this,e="arab";if(this.featuresTags.hasOwnProperty(e)){K_.call(this);var r=this.tokenizer.getContextRanges("arabicWord");r.forEach(function(n){QK.call(t,n)})}}function oZ(){var t=this,e="arab";if(this.featuresTags.hasOwnProperty(e)){var r=this.featuresTags[e];if(r.indexOf("rlig")!==-1){K_.call(this);var n=this.tokenizer.getContextRanges("arabicWord");n.forEach(function(i){JK.call(t,i)})}}}function lZ(){var t=this,e="latn";if(this.featuresTags.hasOwnProperty(e)){var r=this.featuresTags[e];if(r.indexOf("liga")!==-1){K_.call(this);var n=this.tokenizer.getContextRanges("latinWord");n.forEach(function(i){nZ.call(t,i)})}}}Ol.prototype.checkContextReady=function(t){return!!this.tokenizer.getContext(t)};Ol.prototype.applyFeaturesToContexts=function(){this.checkContextReady("arabicWord")&&(sZ.call(this),oZ.call(this)),this.checkContextReady("latinWord")&&lZ.call(this),this.checkContextReady("arabicSentence")&&aZ.call(this)};Ol.prototype.processText=function(t){(!this.text||this.text!==t)&&(this.setText(t),iZ.call(this),this.applyFeaturesToContexts())};Ol.prototype.getBidiText=function(t){return this.processText(t),this.tokenizer.getText()};Ol.prototype.getTextGlyphs=function(t){this.processText(t);for(var e=[],r=0;r<this.tokenizer.tokens.length;r++){var n=this.tokenizer.tokens[r];if(!n.state.deleted){var i=n.activeState.value;e.push(Array.isArray(i)?i[0]:i)}}return e};function Xr(t){t=t||{},t.tables=t.tables||{},t.empty||(Gg(t.familyName,"When creating a new Font object, familyName is required."),Gg(t.styleName,"When creating a new Font object, styleName is required."),Gg(t.unitsPerEm,"When creating a new Font object, unitsPerEm is required."),Gg(t.ascender,"When creating a new Font object, ascender is required."),Gg(t.descender<=0,"When creating a new Font object, negative descender value is required."),this.names={fontFamily:{en:t.familyName||" "},fontSubfamily:{en:t.styleName||" "},fullName:{en:t.fullName||t.familyName+" "+t.styleName},postScriptName:{en:t.postScriptName||(t.familyName+t.styleName).replace(/\s/g,"")},designer:{en:t.designer||" "},designerURL:{en:t.designerURL||" "},manufacturer:{en:t.manufacturer||" "},manufacturerURL:{en:t.manufacturerURL||" "},license:{en:t.license||" "},licenseURL:{en:t.licenseURL||" "},version:{en:t.version||"Version 0.1"},description:{en:t.description||" "},copyright:{en:t.copyright||" "},trademark:{en:t.trademark||" "}},this.unitsPerEm=t.unitsPerEm||1e3,this.ascender=t.ascender,this.descender=t.descender,this.createdTimestamp=t.createdTimestamp,this.tables=Object.assign(t.tables,{os2:Object.assign({usWeightClass:t.weightClass||this.usWeightClasses.MEDIUM,usWidthClass:t.widthClass||this.usWidthClasses.MEDIUM,fsSelection:t.fsSelection||this.fsSelectionValues.REGULAR},t.tables.os2)})),this.supported=!0,this.glyphs=new Su.GlyphSet(this,t.glyphs||[]),this.encoding=new mR(this),this.position=new d0(this),this.substitution=new ho(this),this.tables=this.tables||{},this._push=null,this._hmtxTableData={},Object.defineProperty(this,"hinting",{get:function(){if(this._hinting)return this._hinting;if(this.outlinesFormat==="truetype")return this._hinting=new $R(this)}})}Xr.prototype.hasChar=function(t){return this.encoding.charToGlyphIndex(t)!==null};Xr.prototype.charToGlyphIndex=function(t){return this.encoding.charToGlyphIndex(t)};Xr.prototype.charToGlyph=function(t){var e=this.charToGlyphIndex(t),r=this.glyphs.get(e);return r||(r=this.glyphs.get(0)),r};Xr.prototype.updateFeatures=function(t){return this.defaultRenderOptions.features.map(function(e){return e.script==="latn"?{script:"latn",tags:e.tags.filter(function(r){return t[r]})}:e})};Xr.prototype.stringToGlyphs=function(t,e){var r=this,n=new Ol,i=function(f){return r.charToGlyphIndex(f.char)};n.registerModifier("glyphIndex",null,i);var a=e?this.updateFeatures(e.features):this.defaultRenderOptions.features;n.applyFeatures(this,a);for(var s=n.getTextGlyphs(t),o=s.length,l=new Array(o),u=this.glyphs.get(0),c=0;c<o;c+=1)l[c]=this.glyphs.get(s[c])||u;return l};Xr.prototype.nameToGlyphIndex=function(t){return this.glyphNames.nameToGlyphIndex(t)};Xr.prototype.nameToGlyph=function(t){var e=this.nameToGlyphIndex(t),r=this.glyphs.get(e);return r||(r=this.glyphs.get(0)),r};Xr.prototype.glyphIndexToName=function(t){return this.glyphNames.glyphIndexToName?this.glyphNames.glyphIndexToName(t):""};Xr.prototype.getKerningValue=function(t,e){t=t.index||t,e=e.index||e;var r=this.position.defaultKerningTables;return r?this.position.getKerningValue(r,t,e):this.kerningPairs[t+","+e]||0};Xr.prototype.defaultRenderOptions={kerning:!0,features:[{script:"arab",tags:["init","medi","fina","rlig"]},{script:"latn",tags:["liga","rlig"]}]};Xr.prototype.forEachGlyph=function(t,e,r,n,i,a){e=e!==void 0?e:0,r=r!==void 0?r:0,n=n!==void 0?n:72,i=Object.assign({},this.defaultRenderOptions,i);var s=1/this.unitsPerEm*n,o=this.stringToGlyphs(t,i),l;if(i.kerning){var u=i.script||this.position.getDefaultScriptName();l=this.position.getKerningTables(u,i.language)}for(var c=0;c<o.length;c+=1){var f=o[c];if(a.call(this,f,e,r,n,i),f.advanceWidth&&(e+=f.advanceWidth*s),i.kerning&&c<o.length-1){var p=l?this.position.getKerningValue(l,f.index,o[c+1].index):this.getKerningValue(f,o[c+1]);e+=p*s}i.letterSpacing?e+=i.letterSpacing*n:i.tracking&&(e+=i.tracking/1e3*n)}return e};Xr.prototype.getPath=function(t,e,r,n,i){var a=new ii;return this.forEachGlyph(t,e,r,n,i,function(s,o,l,u){var c=s.getPath(o,l,u,i,this);a.extend(c)}),a};Xr.prototype.getPaths=function(t,e,r,n,i){var a=[];return this.forEachGlyph(t,e,r,n,i,function(s,o,l,u){var c=s.getPath(o,l,u,i,this);a.push(c)}),a};Xr.prototype.getAdvanceWidth=function(t,e,r){return this.forEachGlyph(t,0,0,e,r,function(){})};Xr.prototype.draw=function(t,e,r,n,i,a){this.getPath(e,r,n,i,a).draw(t)};Xr.prototype.drawPoints=function(t,e,r,n,i,a){this.forEachGlyph(e,r,n,i,a,function(s,o,l,u){s.drawPoints(t,o,l,u)})};Xr.prototype.drawMetrics=function(t,e,r,n,i,a){this.forEachGlyph(e,r,n,i,a,function(s,o,l,u){s.drawMetrics(t,o,l,u)})};Xr.prototype.getEnglishName=function(t){var e=this.names[t];if(e)return e.en};Xr.prototype.validate=function(){var t=this;function e(n,i){}function r(n){var i=t.getEnglishName(n);i&&i.trim().length>0}r("fontFamily"),r("weightName"),r("manufacturer"),r("copyright"),r("version"),this.unitsPerEm>0};Xr.prototype.toTables=function(){return Zq.fontToTable(this)};Xr.prototype.toBuffer=function(){return console.warn("Font.toBuffer is deprecated. Use Font.toArrayBuffer instead."),this.toArrayBuffer()};Xr.prototype.toArrayBuffer=function(){for(var t=this.toTables(),e=t.encode(),r=new ArrayBuffer(e.length),n=new Uint8Array(r),i=0;i<e.length;i++)n[i]=e[i];return r};Xr.prototype.download=function(t){var e=this.getEnglishName("fontFamily"),r=this.getEnglishName("fontSubfamily");t=t||e.replace(/\s/g,"")+"-"+r+".otf";var n=this.toArrayBuffer();if(Xq())if(window.URL=window.URL||window.webkitURL,window.URL){var i=new DataView(n),a=new Blob([i],{type:"font/opentype"}),s=document.createElement("a");s.href=window.URL.createObjectURL(a),s.download=t;var o=document.createEvent("MouseEvents");o.initEvent("click",!0,!1),s.dispatchEvent(o)}else console.warn("Font file could not be downloaded. Try using a different browser.");else{var l=require("fs"),u=Qq(n);l.writeFileSync(t,u)}};Xr.prototype.fsSelectionValues={ITALIC:1,UNDERSCORE:2,NEGATIVE:4,OUTLINED:8,STRIKEOUT:16,BOLD:32,REGULAR:64,USER_TYPO_METRICS:128,WWS:256,OBLIQUE:512};Xr.prototype.usWidthClasses={ULTRA_CONDENSED:1,EXTRA_CONDENSED:2,CONDENSED:3,SEMI_CONDENSED:4,MEDIUM:5,SEMI_EXPANDED:6,EXPANDED:7,EXTRA_EXPANDED:8,ULTRA_EXPANDED:9};Xr.prototype.usWeightClasses={THIN:100,EXTRA_LIGHT:200,LIGHT:300,NORMAL:400,MEDIUM:500,SEMI_BOLD:600,BOLD:700,EXTRA_BOLD:800,BLACK:900};function QR(t,e){var r=JSON.stringify(t),n=256;for(var i in e){var a=parseInt(i);if(!(!a||a<256)){if(JSON.stringify(e[i])===r)return a;n<=a&&(n=a+1)}}return e[n]=t,n}function uZ(t,e,r){var n=QR(e.name,r);return[{name:"tag_"+t,type:"TAG",value:e.tag},{name:"minValue_"+t,type:"FIXED",value:e.minValue<<16},{name:"defaultValue_"+t,type:"FIXED",value:e.defaultValue<<16},{name:"maxValue_"+t,type:"FIXED",value:e.maxValue<<16},{name:"flags_"+t,type:"USHORT",value:0},{name:"nameID_"+t,type:"USHORT",value:n}]}function cZ(t,e,r){var n={},i=new Dt.Parser(t,e);return n.tag=i.parseTag(),n.minValue=i.parseFixed(),n.defaultValue=i.parseFixed(),n.maxValue=i.parseFixed(),i.skip("uShort",1),n.name=r[i.parseUShort()]||{},n}function dZ(t,e,r,n){for(var i=QR(e.name,n),a=[{name:"nameID_"+t,type:"USHORT",value:i},{name:"flags_"+t,type:"USHORT",value:0}],s=0;s<r.length;++s){var o=r[s].tag;a.push({name:"axis_"+t+" "+o,type:"FIXED",value:e.coordinates[o]<<16})}return a}function fZ(t,e,r,n){var i={},a=new Dt.Parser(t,e);i.name=n[a.parseUShort()]||{},a.skip("uShort",1),i.coordinates={};for(var s=0;s<r.length;++s)i.coordinates[r[s].tag]=a.parseFixed();return i}function hZ(t,e){var r=new Mt.Table("fvar",[{name:"version",type:"ULONG",value:65536},{name:"offsetToData",type:"USHORT",value:0},{name:"countSizePairs",type:"USHORT",value:2},{name:"axisCount",type:"USHORT",value:t.axes.length},{name:"axisSize",type:"USHORT",value:20},{name:"instanceCount",type:"USHORT",value:t.instances.length},{name:"instanceSize",type:"USHORT",value:4+t.axes.length*4}]);r.offsetToData=r.sizeOf();for(var n=0;n<t.axes.length;n++)r.fields=r.fields.concat(uZ(n,t.axes[n],e));for(var i=0;i<t.instances.length;i++)r.fields=r.fields.concat(dZ(i,t.instances[i],t.axes,e));return r}function pZ(t,e,r){var n=new Dt.Parser(t,e),i=n.parseULong();ir.argument(i===65536,"Unsupported fvar table version.");var a=n.parseOffset16();n.skip("uShort",1);for(var s=n.parseUShort(),o=n.parseUShort(),l=n.parseUShort(),u=n.parseUShort(),c=[],f=0;f<s;f++)c.push(cZ(t,e+a+f*o,r));for(var p=[],v=e+a+s*o,y=0;y<l;y++)p.push(fZ(t,v+y*u,c,r));return{axes:c,instances:p}}var mZ={make:hZ,parse:pZ},gZ=function(){return{coverage:this.parsePointer(ze.coverage),attachPoints:this.parseList(ze.pointer(ze.uShortList))}},vZ=function(){var t=this.parseUShort();if(ir.argument(t===1||t===2||t===3,"Unsupported CaretValue table version."),t===1)return{coordinate:this.parseShort()};if(t===2)return{pointindex:this.parseShort()};if(t===3)return{coordinate:this.parseShort()}},yZ=function(){return this.parseList(ze.pointer(vZ))},xZ=function(){return{coverage:this.parsePointer(ze.coverage),ligGlyphs:this.parseList(ze.pointer(yZ))}},bZ=function(){return this.parseUShort(),this.parseList(ze.pointer(ze.coverage))};function wZ(t,e){e=e||0;var r=new ze(t,e),n=r.parseVersion(1);ir.argument(n===1||n===1.2||n===1.3,"Unsupported GDEF table version.");var i={version:n,classDef:r.parsePointer(ze.classDef),attachList:r.parsePointer(gZ),ligCaretList:r.parsePointer(xZ),markAttachClassDef:r.parsePointer(ze.classDef)};return n>=1.2&&(i.markGlyphSets=r.parsePointer(bZ)),i}var SZ={parse:wZ},Ml=new Array(10);Ml[1]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{posFormat:1,coverage:this.parsePointer(ze.coverage),value:this.parseValueRecord()};if(r===2)return{posFormat:2,coverage:this.parsePointer(ze.coverage),values:this.parseValueRecordList()};ir.assert(!1,"0x"+e.toString(16)+": GPOS lookup type 1 format must be 1 or 2.")};Ml[2]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();ir.assert(r===1||r===2,"0x"+e.toString(16)+": GPOS lookup type 2 format must be 1 or 2.");var n=this.parsePointer(ze.coverage),i=this.parseUShort(),a=this.parseUShort();if(r===1)return{posFormat:r,coverage:n,valueFormat1:i,valueFormat2:a,pairSets:this.parseList(ze.pointer(ze.list(function(){return{secondGlyph:this.parseUShort(),value1:this.parseValueRecord(i),value2:this.parseValueRecord(a)}})))};if(r===2){var s=this.parsePointer(ze.classDef),o=this.parsePointer(ze.classDef),l=this.parseUShort(),u=this.parseUShort();return{posFormat:r,coverage:n,valueFormat1:i,valueFormat2:a,classDef1:s,classDef2:o,class1Count:l,class2Count:u,classRecords:this.parseList(l,ze.list(u,function(){return{value1:this.parseValueRecord(i),value2:this.parseValueRecord(a)}}))}}};Ml[3]=function(){return{error:"GPOS Lookup 3 not supported"}};Ml[4]=function(){return{error:"GPOS Lookup 4 not supported"}};Ml[5]=function(){return{error:"GPOS Lookup 5 not supported"}};Ml[6]=function(){return{error:"GPOS Lookup 6 not supported"}};Ml[7]=function(){return{error:"GPOS Lookup 7 not supported"}};Ml[8]=function(){return{error:"GPOS Lookup 8 not supported"}};Ml[9]=function(){return{error:"GPOS Lookup 9 not supported"}};function kZ(t,e){e=e||0;var r=new ze(t,e),n=r.parseVersion(1);return ir.argument(n===1||n===1.1,"Unsupported GPOS table version "+n),n===1?{version:n,scripts:r.parseScriptList(),features:r.parseFeatureList(),lookups:r.parseLookupList(Ml)}:{version:n,scripts:r.parseScriptList(),features:r.parseFeatureList(),lookups:r.parseLookupList(Ml),variations:r.parseFeatureVariationsList()}}var _Z=new Array(10);function CZ(t){return new Mt.Table("GPOS",[{name:"version",type:"ULONG",value:65536},{name:"scripts",type:"TABLE",value:new Mt.ScriptList(t.scripts)},{name:"features",type:"TABLE",value:new Mt.FeatureList(t.features)},{name:"lookups",type:"TABLE",value:new Mt.LookupList(t.lookups,_Z)}])}var EZ={parse:kZ,make:CZ};function TZ(t){var e={};t.skip("uShort");var r=t.parseUShort();ir.argument(r===0,"Unsupported kern sub-table version."),t.skip("uShort",2);var n=t.parseUShort();t.skip("uShort",3);for(var i=0;i<n;i+=1){var a=t.parseUShort(),s=t.parseUShort(),o=t.parseShort();e[a+","+s]=o}return e}function NZ(t){var e={};t.skip("uShort");var r=t.parseULong();r>1&&console.warn("Only the first kern subtable is supported."),t.skip("uLong");var n=t.parseUShort(),i=n&255;if(t.skip("uShort"),i===0){var a=t.parseUShort();t.skip("uShort",3);for(var s=0;s<a;s+=1){var o=t.parseUShort(),l=t.parseUShort(),u=t.parseShort();e[o+","+l]=u}}return e}function PZ(t,e){var r=new Dt.Parser(t,e),n=r.parseUShort();if(n===0)return TZ(r);if(n===1)return NZ(r);throw new Error("Unsupported kern table version ("+n+").")}var MZ={parse:PZ};function AZ(t,e,r,n){for(var i=new Dt.Parser(t,e),a=n?i.parseUShort:i.parseULong,s=[],o=0;o<r+1;o+=1){var l=a.call(i);n&&(l*=2),s.push(l)}return s}var LZ={parse:AZ};function RZ(t,e){var r=require("fs");r.readFile(t,function(n,i){if(n)return e(n.message);e(null,zR(i))})}function OZ(t,e){var r=new XMLHttpRequest;r.open("get",t,!0),r.responseType="arraybuffer",r.onload=function(){return r.response?e(null,r.response):e("Font could not be loaded: "+r.statusText)},r.onerror=function(){e("Font could not be loaded")},r.send()}function _3(t,e){for(var r=[],n=12,i=0;i<e;i+=1){var a=Dt.getTag(t,n),s=Dt.getULong(t,n+4),o=Dt.getULong(t,n+8),l=Dt.getULong(t,n+12);r.push({tag:a,checksum:s,offset:o,length:l,compression:!1}),n+=16}return r}function DZ(t,e){for(var r=[],n=44,i=0;i<e;i+=1){var a=Dt.getTag(t,n),s=Dt.getULong(t,n+4),o=Dt.getULong(t,n+8),l=Dt.getULong(t,n+12),u=void 0;o<l?u="WOFF":u=!1,r.push({tag:a,offset:s,compression:u,compressedLength:o,length:l}),n+=20}return r}function vi(t,e){if(e.compression==="WOFF"){var r=new Uint8Array(t.buffer,e.offset+2,e.compressedLength-2),n=new Uint8Array(e.length);if(EW(r,n),n.byteLength!==e.length)throw new Error("Decompression error: "+e.tag+" decompressed length doesn't match recorded length");var i=new DataView(n.buffer,0);return{data:i,offset:0}}else return{data:t,offset:e.offset}}function $1(t,e){e=e??{};var r,n,i=new Xr({empty:!0}),a=new DataView(t,0),s,o=[],l=Dt.getTag(a,0);if(l==="\0\0\0"||l==="true"||l==="typ1")i.outlinesFormat="truetype",s=Dt.getUShort(a,4),o=_3(a,s);else if(l==="OTTO")i.outlinesFormat="cff",s=Dt.getUShort(a,4),o=_3(a,s);else if(l==="wOFF"){var u=Dt.getTag(a,4);if(u==="\0\0\0")i.outlinesFormat="truetype";else if(u==="OTTO")i.outlinesFormat="cff";else throw new Error("Unsupported OpenType flavor "+l);s=Dt.getUShort(a,12),o=DZ(a,s)}else throw new Error("Unsupported OpenType signature "+l);for(var c,f,p,v,y,S,w,T,_,C,N,A,O=0;O<s;O+=1){var j=o[O],D=void 0;switch(j.tag){case"cmap":D=vi(a,j),i.tables.cmap=pR.parse(D.data,D.offset),i.encoding=new gR(i.tables.cmap);break;case"cvt ":D=vi(a,j),A=new Dt.Parser(D.data,D.offset),i.tables.cvt=A.parseShortList(j.length/2);break;case"fvar":f=j;break;case"fpgm":D=vi(a,j),A=new Dt.Parser(D.data,D.offset),i.tables.fpgm=A.parseByteList(j.length);break;case"head":D=vi(a,j),i.tables.head=ER.parse(D.data,D.offset),i.unitsPerEm=i.tables.head.unitsPerEm,r=i.tables.head.indexToLocFormat;break;case"hhea":D=vi(a,j),i.tables.hhea=TR.parse(D.data,D.offset),i.ascender=i.tables.hhea.ascender,i.descender=i.tables.hhea.descender,i.numberOfHMetrics=i.tables.hhea.numberOfHMetrics;break;case"hmtx":w=j;break;case"ltag":D=vi(a,j),n=PR.parse(D.data,D.offset);break;case"maxp":D=vi(a,j),i.tables.maxp=MR.parse(D.data,D.offset),i.numGlyphs=i.tables.maxp.numGlyphs;break;case"name":C=j;break;case"OS/2":D=vi(a,j),i.tables.os2=gk.parse(D.data,D.offset);break;case"post":D=vi(a,j),i.tables.post=IR.parse(D.data,D.offset),i.glyphNames=new G_(i.tables.post);break;case"prep":D=vi(a,j),A=new Dt.Parser(D.data,D.offset),i.tables.prep=A.parseByteList(j.length);break;case"glyf":p=j;break;case"loca":_=j;break;case"CFF ":c=j;break;case"kern":T=j;break;case"GDEF":v=j;break;case"GPOS":y=j;break;case"GSUB":S=j;break;case"meta":N=j;break}}var F=vi(a,C);if(i.tables.name=DR.parse(F.data,F.offset,n),i.names=i.tables.name,p&&_){var B=r===0,$=vi(a,_),Z=LZ.parse($.data,$.offset,i.numGlyphs,B),I=vi(a,p);i.glyphs=HR.parse(I.data,I.offset,Z,i,e)}else if(c){var q=vi(a,c);CR.parse(q.data,q.offset,i,e)}else throw new Error("Font doesn't contain TrueType or CFF outlines.");var U=vi(a,w);if(NR.parse(i,U.data,U.offset,i.numberOfHMetrics,i.numGlyphs,i.glyphs,e),$W(i,e),T){var W=vi(a,T);i.kerningPairs=MZ.parse(W.data,W.offset)}else i.kerningPairs={};if(v){var Y=vi(a,v);i.tables.gdef=SZ.parse(Y.data,Y.offset)}if(y){var Q=vi(a,y);i.tables.gpos=EZ.parse(Q.data,Q.offset),i.position.init()}if(S){var ne=vi(a,S);i.tables.gsub=jR.parse(ne.data,ne.offset)}if(f){var re=vi(a,f);i.tables.fvar=mZ.parse(re.data,re.offset,i.names)}if(N){var H=vi(a,N);i.tables.meta=FR.parse(H.data,H.offset),i.metas=i.tables.meta}return i}function JR(t,e,r){r=r??{};var n=typeof window>"u",i=n&&!r.isUrl?RZ:OZ;return new Promise(function(a,s){i(t,function(o,l){if(o){if(e)return e(o);s(o)}var u;try{u=$1(l,r)}catch(c){if(e)return e(c,null);s(c)}if(e)return e(null,u);a(u)})})}function eO(t,e){var r=require("fs"),n=r.readFileSync(t);return $1(zR(n),e)}var IZ=Object.freeze({__proto__:null,Font:Xr,Glyph:ss,Path:ii,BoundingBox:Mu,_parse:Dt,parse:$1,load:JR,loadSync:eO});const jZ=Object.freeze(Object.defineProperty({__proto__:null,BoundingBox:Mu,Font:Xr,Glyph:ss,Path:ii,_parse:Dt,default:IZ,load:JR,loadSync:eO,parse:$1},Symbol.toStringTag,{value:"Module"})),FZ=({onOpenEditor:t})=>{const{t:e}=Sc(),{projectName:r}=Vi(),{setRightPanelMode:n,setRightOpen:i,setRightPanelTitle:a}=Ll(),[s,o]=se.useState("..."),[l,u]=se.useState({words:0,rules:0,glyphs:0}),[c,f]=se.useState("..."),[p,v]=se.useState([]),[y,S]=se.useState([]),[w,T]=se.useState(null),[_,C]=se.useState(""),[N,A]=se.useState(""),[O,j]=se.useState("linguistics"),[D,F]=se.useState("lexicon"),[B,$]=se.useState("MANAGEMENT"),[Z,I]=se.useState("CHRONOS_ATLAS_V1"),[q,U]=se.useState("ARCHITECT_ID"),[W,Y]=se.useState("TTF"),[Q,ne]=se.useState(!0),[re,H]=se.useState(!0),[te,ie]=se.useState([{msg:"Inicializando Bfer de Glifos...",type:"info"},{msg:"Sincronizacin de Biblia Activa",type:"success"}]),de={ALPHABET:{id:"ALPHABET",name:"Alfabeto",desc:"Un smbolo por fonema (consonantes y vocales coordinadas)."},ABJAD:{id:"ABJAD",name:"Abjad",desc:"Consonantes marcadas; las vocales son diacrticos o se infieren (ej: rabe, Hebreo)."},SYLLABARY:{id:"SYLLABARY",name:"Silabario",desc:"Cada smbolo representa una slaba completa (Consonante + Vocal)."},ABUGIDA:{id:"ABUGIDA",name:"Abugida",desc:"Smbolos base para consonantes; las vocales modifican al smbolo base."}},[ge,ye]=se.useState(de.ALPHABET.id),[ae,pe]=se.useState(""),[le,me]=se.useState([]),[he,xe]=se.useState([]),we=($e,yt="info")=>{ie(Et=>[...Et.slice(-4),{msg:$e,type:yt}])},[Ge,qe]=se.useState(!1),[wt,et]=se.useState(null),[at,je]=se.useState([{id:"layer1",name:"Trazo Principal",visible:!0,locked:!1,shapes:[]},{id:"layer2",name:"Guas",visible:!0,locked:!1,shapes:[]}]),[Re,nt]=se.useState("layer1"),[Ce,Fe]=se.useState(null),[Ke,pt]=se.useState("brush"),[vt,At]=se.useState(4),[Ut,nr]=se.useState("#00E5FF"),[Ct,ct]=se.useState(1),We=sr.useRef(null);se.useEffect(()=>(Xe(),n("LINGUISTICS"),a("Lingstica"),i(!0),()=>{n("NOTES"),a("")}),[]);const ce=$e=>{et($e.id),qe(!0),n("LINGUISTICS")},ve=()=>{qe(!1),et(null)},_e=($e,yt)=>{if($e==="START"){const Et={id:crypto.randomUUID(),type:Ke,points:[yt.pos.x,yt.pos.y],x:yt.pos.x,y:yt.pos.y,stroke:Ut,strokeWidth:vt,opacity:Ct,lineCap:"round",lineJoin:"round"};Ke==="brush"?(Et.type="line",Et.points=[yt.pos.x,yt.pos.y]):Ke==="rect"&&(Et.width=0,Et.height=0),je(rr=>rr.map(zt=>zt.id===Re?{...zt,shapes:[...zt.shapes,Et]}:zt)),Fe(Et.id)}else $e==="MOVE"&&je(Et=>Et.map(rr=>{if(rr.id===Re){const zt=[...rr.shapes],lt=zt[zt.length-1];return lt?(Ke==="brush"?lt.points=lt.points.concat([yt.pos.x,yt.pos.y]):Ke==="rect"&&(lt.width=yt.pos.x-lt.x,lt.height=yt.pos.y-lt.y),zt[zt.length-1]=lt,{...rr,shapes:zt}):rr}return rr}))},Te=()=>{const $e={id:crypto.randomUUID()};et($e.id);const yt=crypto.randomUUID();je([{id:yt,name:"Capa 1",visible:!0,locked:!1,shapes:[]}]),nt(yt),qe(!0),n("LINGUISTICS")},Le=($e,yt)=>{je(Et=>Et.map(rr=>({...rr,shapes:rr.shapes.map(zt=>zt.id===$e?{...zt,...yt}:zt)})))},Xe=async()=>{try{const $e=await Qe.get("/bd/proyecto-activo");o($e.nombreProyecto);const yt=await Qe.get("/conlang/stats");u(yt);const Et=await Qe.get("/conlang/lenguas");Et&&Et.length>0&&(f(Et[0].nombre),T(Et[0].id),He(Et[0].id),dt(Et[0].id))}catch($e){console.error("Error loading conlang data:",$e),o("Default Project")}},He=async $e=>{try{const yt=await Qe.get(`/conlang/${$e}/rules`);S(yt)}catch(yt){console.error("Error loading rules:",yt)}},dt=async $e=>{try{const yt=await Qe.get(`/conlang/${$e}/diccionario`);v(yt),xe(yt.filter(Et=>["GLYPH","GLYFO","GLIFO"].includes(Et.categoriaGramatical)||Et.svgPathData&&Et.lema.length===1))}catch(yt){console.error("Error loading lexicon:",yt)}},ft=async()=>{if(!w)return;const $e=prompt("Enter rule title:");if(!$e)return;const yt=prompt("Enter rule description:"),Et=prompt("Enter category (Grammar, Syntax, etc.):");try{await Qe.post(`/conlang/${w}/rules`,{titulo:$e,descripcion:yt,categoria:Et,status:"IN_PROGRESS"}),He(w);const rr=await Qe.get("/conlang/stats");u(rr)}catch(rr){console.error("Error adding rule:",rr)}},Pt=$e=>{C($e);const yt=$e.split("").map(Et=>{const rr=he.find(zt=>zt.lema.toLowerCase()===Et.toLowerCase());return rr?rr.lema:Et}).join(" ");A(yt)},qt=$e=>{pe($e);const yt=$e.split("").map(Et=>he.find(zt=>zt.lema.toLowerCase()===Et.toLowerCase())||{lema:Et,placeholder:!0});me(yt)},$t=async()=>{if(!(!w||!ae))try{await Qe.post(`/conlang/${w}/palabra`,{lema:ae,definicion:`Entrada automtica (${new Date().toLocaleDateString()})`,categoriaGramatical:"COMPUESTA"}),dt(w),we(`Palabra "${ae}" sincronizada automticamente`,"success")}catch($e){console.error("Error al guardar automticamente:",$e)}},kt=()=>{const $e=he.map(Et=>Et.unicodeCode).filter(Et=>Et&&Et.startsWith("U+")).map(Et=>parseInt(Et.replace("U+",""),16));return`U+${($e.length>0?Math.max(...$e)+1:57344).toString(16).toUpperCase()}`},Zt=se.useRef(null),er=()=>{Zt.current.click()},Ar=async $e=>{const yt=$e.target.files[0];if(!yt)return;const Et=new FileReader;Et.onload=async rr=>{const lt=rr.target.result.match(/d="([^"]+)"/);if(lt&&lt[1]){const Pr=lt[1],zr=kt(),wi=String.fromCharCode(parseInt(zr.replace("U+",""),16));try{await Qe.post(`/conlang/${w}/palabra`,{lema:wi,categoriaGramatical:"GLYFO",definicion:`Glifo importado (${yt.name})`,svgPathData:Pr,unicodeCode:zr}),dt(w),we(`Glifo ${zr} importado con xito`,"success")}catch{we("Error al importar glifo","error")}}else alert("SVG invlido para renderizado de glifos.")},Et.readAsText(yt),$e.target.value=null},xr=async()=>{if(!w||he.length===0){alert("No hay glifos mapeados para exportar.");return}we("Compilando fuente tipogrfica...","info");try{if(!jZ)throw new Error("Motor de fuentes (opentype.js) no cargado.");const $e=new Xr({familyName:Z||"Atlas_Conlang",styleName:"Regular",unitsPerEm:1024,ascender:800,descender:-200}),yt=new ss({name:".notdef",unicode:0,advanceWidth:650,path:new ii});$e.glyphs.push(yt),he.forEach(zr=>{if(!zr.svgPathData||!zr.unicodeCode)return;const wi=parseInt(zr.unicodeCode.replace("U+",""),16),Va=new ss({name:`glyph_${zr.unicodeCode}`,unicode:wi,advanceWidth:800,path:(void 0)(zr.svgPathData)});$e.glyphs.push(Va)});const Et=$e.toArrayBuffer(),rr=new Blob([Et],{type:"font/ttf"}),zt=URL.createObjectURL(rr),lt=document.createElement("a");lt.href=zt,lt.download=`${Z}.ttf`,lt.click(),URL.revokeObjectURL(zt);const Pr=new FormData;Pr.append("file",rr,"font.ttf"),await Qe.post(`/conlang/${w}/upload-font`,Pr,{headers:{"Content-Type":"multipart/form-data"}}),we("Fuente sincronizada con el servidor [v1.0]","success"),alert("Fuente generada y guardada en el servidor con xito!")}catch($e){console.error("Error exportando fuente:",$e),we("Error en compilacin de fuente","error"),alert("Error al generar la fuente: "+$e.message)}};return m.jsxs("div",{className:"flex-1 flex flex-col h-full bg-[#050508] text-slate-300 font-sans overflow-hidden",children:[m.jsx("input",{type:"file",ref:Zt,onChange:Ar,accept:".svg",className:"hidden"}),m.jsxs("div",{className:"h-16 border-b border-white/5 flex items-center justify-between px-8 bg-black/40",children:[m.jsx("div",{className:"flex items-center gap-4"}),O==="linguistics"&&m.jsxs("div",{className:"flex bg-white/5 p-1 rounded-xl border border-white/5",children:[m.jsx("button",{onClick:()=>F("lexicon"),className:`px-6 py-1.5 rounded-lg text-[10px] font-black uppercase tracking-widest transition-all ${D==="lexicon"?"bg-primary text-white shadow-lg":"text-slate-500 hover:text-slate-300"}`,children:e("linguistics.lexicon")}),m.jsx("button",{onClick:()=>F("translator"),className:`px-6 py-1.5 rounded-lg text-[10px] font-black uppercase tracking-widest transition-all ${D==="translator"?"bg-primary text-white shadow-lg":"text-slate-500 hover:text-slate-300"}`,children:e("linguistics.translator")})]}),O==="biblia"&&m.jsx("div",{className:"flex-1 flex items-center justify-between",children:m.jsxs("div",{className:"flex items-center gap-4 animate-in slide-in-from-left duration-700",children:[m.jsx("div",{className:"p-3 rounded-2xl bg-[#00E5FF]/10 text-[#00E5FF] border border-[#00E5FF]/20 shadow-[0_0_20px_rgba(0,229,255,0.1)]",children:m.jsx("span",{className:"material-symbols-outlined text-2xl",children:"menu_book"})}),m.jsxs("div",{children:[m.jsx("h1",{className:"text-xl font-black uppercase tracking-[0.3em] text-white",children:"Biblia Lxica"}),m.jsxs("p",{className:"text-[9px] font-bold text-[#00E5FF]/50 uppercase tracking-widest flex items-center gap-2",children:[m.jsx("span",{className:"size-1 bg-[#00E5FF] rounded-full animate-pulse"}),"Sincronizacin Automtica Activa"]})]})]})})]}),m.jsx("main",{className:"flex-1 overflow-y-auto no-scrollbar p-8 lg:p-12",children:O==="linguistics"?m.jsx("div",{className:"max-w-6xl mx-auto w-full",children:D==="lexicon"?m.jsxs("section",{className:"space-y-8 animate-in fade-in slide-in-from-bottom-4 duration-700",children:[m.jsxs("div",{className:"flex justify-between items-center px-4",children:[m.jsxs("div",{className:"flex flex-col",children:[m.jsx("h3",{className:"text-3xl font-black text-white tracking-tight italic",children:e("linguistics.lexicon")}),m.jsxs("p",{className:"text-[10px] text-slate-500 font-bold uppercase tracking-widest",children:[l.words," Palabras Mapeadas"]})]}),m.jsx(mn,{variant:"primary",size:"md",onClick:Te,icon:"draw",children:"Nuevo Glifo"})]}),m.jsxs(un,{className:"p-0 border-white/5 bg-surface-dark/40 overflow-hidden shadow-2xl rounded-[2.5rem]",children:[m.jsxs("div",{className:"p-6 border-b border-white/5 flex items-center gap-4 bg-black/20",children:[m.jsxs("div",{className:"flex-1 relative",children:[m.jsx("span",{className:"material-symbols-outlined absolute left-4 top-1/2 -translate-y-1/2 text-primary/60 text-lg",children:"search"}),m.jsx("input",{type:"text",placeholder:e("linguistics.search_lexicon"),className:"w-full bg-white/5 border border-white/10 rounded-2xl py-4 pl-12 pr-4 text-xs font-bold text-white focus:ring-1 focus:ring-primary/30 outline-none transition-all placeholder-slate-600"})]}),m.jsx("button",{className:"size-12 rounded-2xl bg-white/5 border border-white/10 flex items-center justify-center text-slate-500 hover:text-white transition-all hover:bg-white/10",children:m.jsx("span",{className:"material-symbols-outlined text-xl",children:"tune"})})]}),m.jsxs("div",{className:"p-8 space-y-2 max-h-[70vh] overflow-y-auto no-scrollbar custom-scrollbar",children:[p.map($e=>m.jsx(BZ,{word:$e.lema||$e.palabraOriginal,type:$e.categoriaGramatical,gender:$e.genero,def:$e.definicion||$e.traduccionEspanol,onEditSymbol:()=>t($e)},$e.id)),p.length===0&&m.jsxs("div",{className:"py-20 flex flex-col items-center justify-center text-slate-600 opacity-20",children:[m.jsx("span",{className:"material-symbols-outlined text-8xl mb-4",children:"menu_book"}),m.jsx("p",{className:"text-[10px] uppercase tracking-[0.5em] font-black",children:"Flujo de Datos Vaco"})]})]})]})]}):m.jsxs("section",{className:"space-y-8 animate-in fade-in slide-in-from-bottom-4 duration-700",children:[m.jsxs("div",{className:"flex items-center gap-4 px-4",children:[m.jsx("span",{className:"material-symbols-outlined text-primary text-4xl",children:"sync_alt"}),m.jsx("h3",{className:"text-3xl font-black text-white tracking-tight italic",children:e("linguistics.translator")})]}),m.jsx(un,{className:"p-12 border-primary/20 bg-primary/5 rounded-[3rem] space-y-10 shadow-2xl shadow-primary/5",children:m.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-12 items-center",children:[m.jsxs("div",{className:"space-y-6",children:[m.jsx("label",{className:"text-[10px] font-black uppercase tracking-[0.4em] text-primary opacity-60",children:"Entrada de Origen"}),m.jsx("textarea",{value:_,onChange:$e=>Pt($e.target.value),placeholder:e("linguistics.source_text"),className:"w-full h-48 bg-black/40 border border-white/10 rounded-[2.5rem] p-8 text-lg font-bold text-white focus:border-primary/50 outline-none transition-all placeholder-slate-800 resize-none"})]}),m.jsxs("div",{className:"space-y-6",children:[m.jsx("label",{className:"text-[10px] font-black uppercase tracking-[0.4em] text-primary opacity-60",children:"Salida Visual"}),m.jsxs("div",{className:"h-48 rounded-[2.5rem] bg-black/60 border border-white/5 flex items-center justify-center relative overflow-hidden group shadow-inner",children:[m.jsx("span",{className:"text-7xl font-serif text-white opacity-40 group-hover:opacity-100 transition-all duration-1000 whitespace-pre drop-shadow-[0_0_20px_rgba(255,255,255,0.4)]",children:N||"   "}),m.jsxs("div",{className:"absolute bottom-4 right-8 flex gap-4 text-[8px] font-black uppercase tracking-widest text-slate-700",children:[m.jsx("span",{children:"Paso_Vector"}),m.jsx("span",{children:"Motor_V4"})]})]})]})]})})]})}):Ge?m.jsxs("div",{className:"flex-1 flex flex-col h-full relative",children:[m.jsx("div",{className:"absolute top-4 left-4 z-10",children:m.jsxs(mn,{onClick:ve,variant:"glass",className:"flex items-center gap-2 px-4 py-2 bg-black/60 backdrop-blur-md border border-white/10 hover:border-white/30 text-white rounded-full text-xs font-black uppercase tracking-widest",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"arrow_back"}),"Volver"]})}),m.jsx(GlyphEditorCanvas,{stageRef:We,layers:at,selectedShapeId:Ce,onSelectShape:Fe,onChangeShape:Le,tool:Ke,color:Ut,strokeWidth:vt,onDrawEnd:_e})]}):m.jsxs("section",{className:"max-w-7xl mx-auto w-full animate-in fade-in slide-in-from-bottom-8 duration-1000 flex flex-col gap-12",children:[m.jsxs("div",{className:"flex justify-between items-center px-4",children:[m.jsx("div",{className:"flex flex-col"}),m.jsx("div",{className:"px-6 py-2 rounded bg-[#00E5FF]/10 border border-[#00E5FF]/20 text-[10px] font-black text-[#00E5FF] uppercase tracking-[0.3em] animate-pulse",children:"Bfer de Sincronizacin Listo"})]}),m.jsxs("div",{className:"space-y-12",children:[m.jsxs("section",{className:"space-y-6",children:[m.jsxs("div",{className:"flex items-center justify-between px-2",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("div",{className:"size-2 bg-[#00E5FF] rounded-full shadow-[0_0_10px_#00E5FF]"}),m.jsx("h3",{className:"text-xs font-black uppercase tracking-[0.5em] text-[#00E5FF]/60",children:"Glifos Mapeados"})]}),m.jsxs("div",{className:"flex flex-col gap-3 items-end",children:[m.jsxs("span",{className:"text-[10px] font-bold text-[#00E5FF]/40",children:[he.length," Smbolos Indexados"]}),m.jsxs("div",{className:"flex items-center gap-4 px-6 py-2.5 rounded-2xl bg-black/40 border border-[#00E5FF]/10 backdrop-blur-md",children:[m.jsx("span",{className:"text-[9px] font-black uppercase tracking-[0.2em] text-[#00E5FF]/60 font-mono",children:"Estado del Bfer"}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("span",{className:"text-[10px] font-bold text-white tracking-widest",children:"SINCRONIZADO"}),m.jsx("div",{className:"size-1.5 bg-[#00E5FF] rounded-full shadow-[0_0_10px_#00E5FF] animate-pulse"})]})]})]})]}),m.jsxs("div",{className:"p-10 rounded-[2.5rem] border border-[#00E5FF]/10 bg-[#00E5FF]/[0.02] grid grid-cols-4 md:grid-cols-6 lg:grid-cols-8 gap-6",children:[he.map(($e,yt)=>m.jsx(zZ,{symbol:$e.lema,keyLabel:$e.lema.toUpperCase(),active:!1,onClick:()=>ce($e)},$e.id||yt)),m.jsxs("button",{onClick:Te,className:"aspect-square rounded-2xl border-2 border-dashed border-[#00E5FF]/10 flex flex-col items-center justify-center text-[#00E5FF]/20 hover:text-[#00E5FF] hover:border-[#00E5FF]/40 transition-all cursor-pointer group gap-2",title:"Dibujar Nuevo Glifo",children:[m.jsx("span",{className:"material-symbols-outlined text-3xl group-hover:scale-110 transition-transform",children:"draw"}),m.jsx("span",{className:"text-[8px] font-black uppercase tracking-widest opacity-0 group-hover:opacity-100 transition-opacity",children:"Dibujar"})]}),m.jsxs("button",{onClick:er,className:"aspect-square rounded-2xl border-2 border-dashed border-[#00E5FF]/10 flex flex-col items-center justify-center text-[#00E5FF]/20 hover:text-[#00E5FF] hover:border-[#00E5FF]/40 transition-all cursor-pointer group gap-2",title:"Importar desde SVG",children:[m.jsx("span",{className:"material-symbols-outlined text-3xl group-hover:scale-110 transition-transform",children:"upload_file"}),m.jsx("span",{className:"text-[8px] font-black uppercase tracking-widest opacity-0 group-hover:opacity-100 transition-opacity",children:"Importar"})]})]})]}),m.jsx("div",{className:"px-10",children:m.jsx("div",{className:"w-full h-[2px] bg-white/5 overflow-hidden rounded-full",children:m.jsx("div",{className:"h-full bg-[#00E5FF] shadow-[0_0_10px_#00E5FF] transition-all duration-1000",style:{width:`${Math.min(100,he.length/26*100)}%`}})})}),m.jsxs("section",{className:"space-y-6",children:[m.jsxs("div",{className:"flex items-center gap-4 px-2",children:[m.jsx("div",{className:"size-2 bg-primary rounded-full shadow-[0_0_10px_#7c3aed] opacity-60"}),m.jsx("h3",{className:"text-xs font-black uppercase tracking-[0.5em] text-primary/60",children:"Compositor de Palabras"})]}),m.jsxs(un,{className:"p-10 border-white/5 bg-black/40 rounded-[2.5rem] space-y-8",children:[m.jsxs("div",{className:"flex gap-8 items-start",children:[m.jsxs("div",{className:"flex-1 space-y-4",children:[m.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-slate-500",children:"Escritura Fontica"}),m.jsx("input",{type:"text",value:ae,onChange:$e=>qt($e.target.value),onBlur:()=>{ae&&$t()},onKeyDown:$e=>{$e.key==="Enter"&&$t()},placeholder:"Escribe para componer...",className:"w-full bg-white/5 border border-white/10 rounded-2xl py-6 px-8 text-2xl font-bold text-white outline-none focus:border-primary/40 transition-all placeholder:text-slate-800"})]}),m.jsxs("div",{className:"mt-10 px-6 py-4 rounded-xl bg-white/5 border border-white/10 flex items-center gap-3",children:[m.jsx("div",{className:"size-2 bg-emerald-500 rounded-full animate-pulse shadow-[0_0_10px_#10b981]"}),m.jsx("span",{className:"text-[9px] font-black uppercase tracking-widest text-slate-400",children:"Auto-Sincronizacin"})]})]}),m.jsxs("div",{className:"space-y-4",children:[m.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-slate-500",children:"Flujo de Renderizado Visual"}),m.jsx("div",{className:"min-h-32 p-8 rounded-2xl bg-black/60 border border-white/5 flex flex-wrap gap-4 items-center justify-center relative group",children:le.length>0?le.map(($e,yt)=>m.jsxs("div",{className:"flex flex-col items-center gap-1",children:[m.jsx("span",{className:`text-5xl font-serif ${$e.placeholder?"text-slate-800 animate-pulse":"text-[#00E5FF] drop-shadow-[0_0_10px_rgba(0,229,255,0.4)]"}`,children:$e.lema}),m.jsx("span",{className:"text-[8px] font-black text-slate-600 uppercase tracking-widest",children:$e.lema})]},yt)):m.jsx("span",{className:"text-slate-800 font-black uppercase tracking-[0.5em] text-[10px]",children:"Sin glifos detectados"})})]})]})]}),m.jsxs("section",{className:"space-y-6",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("div",{className:"size-2 bg-[#00E5FF] rounded-full shadow-[0_0_10px_#00E5FF] opacity-40"}),m.jsx("h3",{className:"text-xs font-black uppercase tracking-[0.5em] text-[#00E5FF]/60",children:"Previsualizacin de Transmisin"})]}),m.jsxs("div",{className:"h-64 rounded-[2.5rem] border border-[#00E5FF]/10 bg-black/40 flex flex-col p-12 items-center justify-center relative group shadow-inner",children:[m.jsx("div",{className:"absolute top-6 left-8 text-[8px] opacity-20 uppercase tracking-[0.3em] font-black",children:"Estado del Bfer: Activo"}),m.jsx("textarea",{className:"w-full bg-transparent border-none outline-none text-center text-7xl font-bold tracking-widest text-[#00E5FF]/10 group-hover:text-[#00E5FF]/40 transition-all placeholder:text-[#00E5FF]/5 resize-none italic font-serif",placeholder:"..."}),m.jsxs("div",{className:"absolute bottom-6 right-8 flex gap-6 text-[8px] font-black uppercase tracking-widest text-[#00E5FF]/20",children:[m.jsx("span",{children:"Motor_V4"}),m.jsx("span",{children:"ASCII/UTF-8"})]})]})]})]})]})}),Al.createPortal(m.jsxs("div",{className:"h-full flex flex-col bg-background relative overflow-hidden",children:[m.jsx("div",{className:"flex border-b border-white/5 bg-surface-dark/50 p-2 gap-1",children:["NOTES","MANAGEMENT","BIBLIA"].map($e=>m.jsx("button",{onClick:()=>{$($e),j($e==="BIBLIA"?"biblia":"linguistics")},className:`flex-1 py-2 text-[9px] font-black uppercase tracking-widest transition-all rounded-lg ${B===$e?"bg-primary text-white shadow-lg":"text-text-muted hover:text-white hover:bg-white/5"}`,children:$e==="NOTES"?"NOTAS":$e==="MANAGEMENT"?"HERRAMIENTAS":"BIBLIA"},$e))}),m.jsxs("div",{className:"flex-1 overflow-y-auto no-scrollbar custom-scrollbar p-0",children:[B==="NOTES"&&m.jsx("div",{className:"h-full",children:m.jsx(FS,{projectName:r})}),B==="MANAGEMENT"&&m.jsxs("div",{className:"p-4 space-y-8 pb-24 animate-in fade-in slide-in-from-right-4 duration-500",children:[m.jsxs("section",{className:"space-y-4",children:[m.jsxs("div",{className:"flex justify-between items-center px-1",children:[m.jsx("h4",{className:"text-[10px] font-black uppercase tracking-widest text-text-muted",children:"Sistemas de Escritura"}),m.jsx("span",{className:"material-symbols-outlined text-text-muted text-sm",children:"history_edu"})]}),m.jsx("div",{className:"space-y-2",children:Object.values(de).map($e=>m.jsxs("button",{onClick:()=>ye($e.id),className:`w-full p-3 rounded-xl border text-left transition-all group ${ge===$e.id?"bg-primary/10 border-primary/40":"bg-surface-dark border-white/5 hover:border-white/10"}`,children:[m.jsxs("div",{className:"flex justify-between items-center mb-1",children:[m.jsx("span",{className:`text-[10px] font-black uppercase tracking-widest group-hover:text-primary transition-colors ${ge===$e.id?"text-primary":"text-text-muted"}`,children:$e.name}),ge===$e.id&&m.jsx("div",{className:"size-1.5 rounded-full bg-primary animate-pulse"})]}),m.jsx("p",{className:"text-[9px] text-slate-500 leading-tight",children:$e.desc})]},$e.id))})]}),m.jsxs("section",{className:"space-y-4",children:[m.jsxs("div",{className:"flex justify-between items-center",children:[m.jsx("h4",{className:"text-[10px] font-black uppercase tracking-widest text-text-muted",children:e("linguistics.writing_system")}),m.jsx("button",{onClick:Te,className:"text-primary hover:text-white transition-colors",title:"Crear Nuevo Glifo",children:m.jsx("span",{className:"material-symbols-outlined text-lg",children:"add_circle"})})]}),m.jsxs("div",{className:"p-4 bg-surface-dark border border-white/5 rounded-2xl",children:[m.jsxs("div",{className:"grid grid-cols-4 gap-2",children:[he.slice(0,12).map($e=>m.jsx("div",{onClick:()=>t($e),className:"aspect-square rounded-lg bg-black/40 border border-white/5 flex items-center justify-center text-xl font-serif text-primary hover:border-primary/40 hover:bg-primary/5 transition-all cursor-pointer",title:$e.lema,children:m.jsx("span",{children:$e.lema})},$e.id)),he.length===0&&m.jsx("div",{className:"col-span-4 py-8 flex items-center justify-center opacity-20",children:m.jsx("span",{className:"text-[8px] font-black uppercase font-mono",children:"Sin Glifos"})})]}),m.jsx("div",{className:"mt-3 text-center",children:m.jsxs("button",{onClick:()=>F("lexicon"),className:"text-[9px] font-bold text-primary hover:underline uppercase tracking-wide",children:["Ver todos (",he.length,")"]})})]})]}),m.jsxs("section",{className:"space-y-4",children:[m.jsxs("div",{className:"flex justify-between items-center",children:[m.jsx("h4",{className:"text-[10px] font-black uppercase tracking-widest text-text-muted",children:e("linguistics.grammar")}),m.jsx("button",{onClick:ft,className:"text-primary hover:text-white transition-colors",children:m.jsx("span",{className:"material-symbols-outlined text-lg",children:"add_circle"})})]}),m.jsxs("div",{className:"space-y-2",children:[y.map($e=>m.jsxs("div",{className:"p-3 bg-surface-dark border border-white/5 rounded-xl hover:border-primary/30 transition-all cursor-pointer group",children:[m.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[m.jsx("div",{className:`size-1.5 rounded-full ${$e.status==="complete"?"bg-emerald-500":"bg-amber-500"}`}),m.jsx("span",{className:"text-[10px] font-bold text-white group-hover:text-primary transition-colors",children:$e.titulo})]}),m.jsx("p",{className:"text-[9px] text-slate-500 leading-tight line-clamp-2",children:$e.descripcion})]},$e.id)),y.length===0&&m.jsx("p",{className:"text-[9px] text-slate-600 italic px-2",children:"No hay reglas definidas."})]})]})]}),B==="BIBLIA"&&m.jsxs("div",{className:"p-6 space-y-8 animate-in fade-in slide-in-from-right-4 duration-500",children:[m.jsxs("div",{className:"space-y-1 text-primary",children:[m.jsx("h4",{className:"text-[10px] font-black uppercase tracking-[0.3em]",children:"Configuracin"}),m.jsx("p",{className:"text-[9px] opacity-60 font-bold",children:"Parmetros de Fuente"})]}),m.jsxs("div",{className:"space-y-4",children:[m.jsxs(un,{className:"p-4 border-primary/20 bg-primary/5 space-y-4 rounded-xl",children:[m.jsxs("div",{className:"space-y-2",children:[m.jsx("label",{className:"text-[8px] font-black uppercase tracking-widest text-primary/70 block",children:"Nombre de Fuente"}),m.jsx("input",{type:"text",value:Z,onChange:$e=>I($e.target.value),className:"w-full bg-black/40 border border-primary/30 px-3 py-2 text-[10px] font-black text-primary outline-none tracking-widest uppercase rounded-lg focus:ring-1 focus:ring-primary/50"})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx("label",{className:"text-[8px] font-black uppercase tracking-widest text-primary/70 block",children:"Autor"}),m.jsx("input",{type:"text",value:q,onChange:$e=>U($e.target.value),placeholder:"ARCHITECT_ID",className:"w-full bg-black/40 border border-primary/30 px-3 py-2 text-[10px] font-black text-primary outline-none tracking-widest uppercase rounded-lg"})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx("label",{className:"text-[8px] font-black uppercase tracking-widest text-primary/70 block",children:"Formato"}),m.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[m.jsx("button",{onClick:()=>{Y("TTF"),we("Formato cambiado a TTF")},className:`py-2 border text-[9px] font-black tracking-widest transition-all rounded-lg ${W==="TTF"?"border-primary bg-primary/10 text-primary shadow-sm":"border-primary/20 text-primary/40 hover:border-primary/40"}`,children:".TTF"}),m.jsx("button",{onClick:()=>{Y("OTF"),we("Formato cambiado a OTF")},className:`py-2 border text-[9px] font-black tracking-widest transition-all rounded-lg ${W==="OTF"?"border-primary bg-primary/10 text-primary shadow-sm":"border-primary/20 text-primary/40 hover:border-primary/40"}`,children:".OTF"})]})]}),m.jsxs("div",{className:"space-y-2 pt-2 border-t border-primary/10",children:[m.jsx(C3,{label:"Ligaduras",active:Q,onToggle:()=>{ne(!Q),we(`Ligaduras ${Q?"Desactivadas":"Activadas"}`)}}),m.jsx(C3,{label:"Interletraje",active:re,onToggle:()=>{H(!re),we(`Interletraje ${re?"Desactivado":"Activado"}`)}})]}),m.jsxs("button",{onClick:xr,className:"w-full py-3 bg-primary text-white font-black uppercase text-[9px] tracking-widest rounded-lg flex items-center justify-center gap-2 hover:bg-primary/90 hover:shadow-lg hover:shadow-primary/20 transition-all mt-4",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"download"}),"Exportar Recursos"]})]}),m.jsxs("div",{className:"p-4 rounded-xl border border-white/5 bg-black/20 space-y-3 font-mono text-[7px]",children:[m.jsxs("div",{className:"flex justify-between items-center text-[8px] font-black uppercase tracking-widest text-text-muted font-sans",children:[m.jsx("span",{children:"Registro"}),m.jsx("span",{className:"size-1.5 bg-primary rounded-full animate-pulse"})]}),m.jsx("div",{className:"space-y-1 opacity-60",children:te.map(($e,yt)=>m.jsxs("p",{className:$e.type==="success"?"text-emerald-400":"text-primary",children:["[",new Date().toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit"}),"] ",$e.msg]},yt))})]})]})]})]})]}),document.getElementById("architect-right-panel-portal"))]})},BZ=({word:t,type:e,gender:r,def:n,onEditSymbol:i})=>m.jsxs("div",{className:"p-4 rounded-2xl border border-transparent hover:bg-white/5 hover:border-white/5 transition-all group cursor-pointer relative",children:[m.jsxs("div",{className:"flex items-center gap-3 mb-1",children:[m.jsx("h4",{className:"text-xl font-manrope font-black text-white group-hover:text-primary transition-colors",children:t}),m.jsxs("div",{className:"flex gap-2",children:[m.jsx("span",{className:"text-[9px] font-bold text-slate-600 italic",children:e}),r&&m.jsxs("span",{className:"text-[9px] font-bold text-slate-700 uppercase",children:["(",r,")"]})]})]}),m.jsx("p",{className:"text-sm text-slate-400 leading-relaxed font-manrope",children:n}),m.jsxs("div",{className:"absolute right-4 top-1/2 -translate-y-1/2 flex gap-2",children:[m.jsx("button",{onClick:a=>{a.stopPropagation(),i?.()},className:"opacity-0 group-hover:opacity-100 transition-opacity p-2 text-primary hover:text-white",title:"Edit Symbol",children:m.jsx("span",{className:"material-symbols-outlined",children:"draw"})}),m.jsx("button",{className:"opacity-0 group-hover:opacity-100 transition-opacity p-2 text-slate-600 hover:text-white",children:m.jsx("span",{className:"material-symbols-outlined",children:"edit_note"})})]})]}),zZ=({symbol:t,keyLabel:e,active:r,onClick:n})=>m.jsxs("div",{onClick:n,className:`aspect-square rounded-2xl border transition-all cursor-pointer flex items-center justify-center relative group ${r?"bg-[#00E5FF]/20 border-[#00E5FF] shadow-[0_0_20px_rgba(0,229,255,0.3)]":"bg-black/40 border-[#00E5FF]/10 hover:border-[#00E5FF]/40"}`,children:[m.jsx("span",{className:`text-4xl font-serif ${r||t?"text-[#00E5FF]":"opacity-20 group-hover:opacity-60 text-white"}`,children:t||"?"}),e&&m.jsx("span",{className:`absolute top-2 right-3 text-[8px] font-black uppercase ${r?"text-[#00E5FF]/80":"opacity-20"}`,children:e})]}),C3=({label:t,active:e,onToggle:r})=>m.jsxs("div",{className:"flex justify-between items-center px-1",children:[m.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest text-[#00E5FF]/60",children:t}),m.jsx("button",{onClick:r,className:`w-10 h-5 rounded-full p-1 transition-colors relative ${e?"bg-[#00E5FF]/40":"bg-white/5"}`,children:m.jsx("div",{className:`size-3 rounded-full bg-[#00E5FF] shadow-[0_0_10px_#00E5FF] transition-transform ${e?"translate-x-5":"translate-x-0"}`})})]}),UZ=({onBack:t,onSave:e,word:r})=>{const[n,i]=se.useState(4),[a,s]=se.useState("curve"),[o,l]=se.useState(1),[u,c]=se.useState([]),f=se.useRef(!1),p=se.useRef(null),v=()=>{if(!p.current)return;const A='<svg width="600" height="600" xmlns="http://www.w3.org/2000/svg">',O="</svg>",j=u.map($=>`<path d="${$.points.reduce((I,q,U)=>I+(U%2===0?(U===0?"M":"L")+q:","+q),"")}" stroke="${$.color}" stroke-width="${$.strokeWidth}" fill="none" stroke-linecap="round" stroke-linejoin="round" />`).join(`
`),D=new Blob([A+j+O],{type:"image/svg+xml"}),F=URL.createObjectURL(D),B=document.createElement("a");B.href=F,B.download=`glyph_${r?.lema||"custom"}.svg`,B.click()},y=()=>{e&&e({wordId:r?.id,lines:u,svgPathData:u.map(A=>A.points.reduce((O,j,D)=>O+(D%2===0?(D===0?"M":"L")+j:","+j),"")).join(" "),svgData:p.current.toDataURL()})},S=A=>{if(a==="select")return;f.current=!0;const O=A.target.getStage().getPointerPosition();c([...u,{tool:a,points:[O.x,O.y],color:"#6366f1",strokeWidth:parseInt(n)}])},w=A=>{if(!f.current||a==="select")return;const j=A.target.getStage().getPointerPosition();let D=u[u.length-1];D.points=D.points.concat([j.x,j.y]),u.splice(u.length-1,1,D),c(u.concat())},T=()=>{f.current=!1},_=()=>{c(u.slice(0,-1))},C=[{id:"select",icon:"near_me"},{id:"curve",icon:"gesture"},{id:"eraser",icon:"ink_eraser"},{id:"line",icon:"horizontal_rule"},{id:"shape",icon:"pentagon"},{id:"text",icon:"title"}],N=[{id:1,name:"Trazo Principal",type:"Vector",locked:!0,visible:!0},{id:2,name:"Detalles Secundarios",type:"Vector",locked:!0,visible:!0},{id:3,name:"Boceto Ref.",type:"Imagen (Raster)",locked:!0,visible:!1}];return m.jsxs("div",{className:"flex-1 flex flex-col bg-[#0a0a0f] text-slate-300 font-sans h-full overflow-hidden relative",children:[m.jsxs("header",{className:"h-20 flex-none border-b border-white/5 flex items-center justify-between px-8 bg-surface-dark/80 backdrop-blur-md z-30",children:[m.jsxs("div",{className:"flex items-center gap-6",children:[m.jsx("button",{onClick:t,className:"p-2 rounded-xl bg-white/5 hover:bg-white/10 transition-colors",children:m.jsx("span",{className:"material-symbols-outlined",children:"arrow_back"})}),m.jsx("div",{className:"w-px h-8 bg-white/10"}),m.jsxs("div",{children:[m.jsxs("nav",{className:"flex items-center gap-2 text-[10px] font-black uppercase tracking-widest text-slate-500 mb-0.5",children:[m.jsx("span",{children:"Idiomas"}),m.jsx("span",{className:"material-symbols-outlined text-sm",children:"chevron_right"}),m.jsxs("span",{className:"text-white",children:["Editor de Glifos ",r?` ${r.lema||r.palabraOriginal}`:""]})]}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsxs("div",{className:"flex items-center gap-4 text-slate-500",children:[m.jsx("button",{onClick:_,className:"hover:text-white transition-colors",title:"Deshacer",children:m.jsx("span",{className:"material-symbols-outlined text-xl",children:"undo"})}),m.jsx("button",{className:"hover:text-white transition-colors opacity-20 cursor-not-allowed",children:m.jsx("span",{className:"material-symbols-outlined text-xl",children:"redo"})})]}),m.jsx("div",{className:"w-px h-4 bg-white/10 mx-2"}),m.jsxs("div",{className:"flex gap-1",children:[m.jsx("button",{className:"p-1 rounded hover:bg-white/5 text-slate-500 hover:text-white",children:m.jsx("span",{className:"material-symbols-outlined text-lg",children:"grid_on"})}),m.jsx("button",{className:"p-1 rounded bg-white/10 text-primary",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"hub"})})]})]})]})]}),m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsxs("button",{onClick:v,className:"flex items-center gap-2 px-6 py-2.5 rounded-xl bg-white/5 hover:bg-white/10 border border-white/5 transition-all text-xs font-black uppercase tracking-widest text-slate-400",children:[m.jsx("span",{className:"material-symbols-outlined text-lg",children:"download"}),"Exportar SVG"]}),m.jsx(mn,{variant:"primary",icon:"save",className:"px-8 py-3 shadow-xl shadow-primary/30",onClick:y,children:"Guardar Glifo"}),m.jsx("div",{className:"size-10 rounded-full bg-gradient-to-br from-primary to-orange-400 border-2 border-white/10 shadow-lg ml-2"})]})]}),m.jsxs("div",{className:"flex-1 flex relative overflow-hidden",children:[m.jsxs("aside",{className:"h-full w-20 flex-none border-r border-white/5 bg-surface-dark/40 backdrop-blur-xl flex flex-col items-center py-6 gap-2 z-40",children:[C.map(A=>m.jsx("button",{onClick:()=>s(A.id),className:`size-12 rounded-2xl flex items-center justify-center transition-all ${a===A.id?"bg-primary text-white shadow-lg shadow-primary/30":"text-slate-600 hover:text-white hover:bg-white/5"}`,children:m.jsx("span",{className:"material-symbols-outlined text-2xl",children:A.icon})},A.id)),m.jsx("div",{className:"flex-1"}),m.jsx("button",{className:"size-12 rounded-2xl flex items-center justify-center text-slate-600 hover:text-white transition-all",children:m.jsx("span",{className:"material-symbols-outlined text-2xl",children:"add_photo_alternate"})}),m.jsx("button",{className:"size-12 rounded-2xl flex items-center justify-center text-slate-600 hover:text-white transition-all",children:m.jsx("span",{className:"material-symbols-outlined text-2xl",children:"settings"})})]}),m.jsxs("main",{className:"flex-1 bg-[#050508] relative overflow-hidden flex items-center justify-center no-scrollbar",children:[m.jsx("div",{className:"absolute inset-x-20 top-1/2 h-px bg-red-500/20 pointer-events-none"}),m.jsxs("div",{className:"relative group animate-in zoom-in-95 duration-700",children:[m.jsx("div",{className:"absolute inset-x-0 top-10 h-px bg-white/10"}),m.jsx("div",{className:"absolute inset-x-0 bottom-10 h-px bg-white/10"}),m.jsx("div",{className:"w-[600px] h-[600px] border border-white/5 rounded-3xl bg-black/40 flex items-center justify-center relative overflow-hidden",children:m.jsx(XL,{ref:p,width:600,height:600,onMouseDown:S,onMousemove:w,onMouseup:T,className:"cursor-crosshair",children:m.jsx(sk,{children:u.map((A,O)=>m.jsx(YL,{points:A.points,stroke:A.color,strokeWidth:A.strokeWidth,tension:.5,lineCap:"round",lineJoin:"round",globalCompositeOperation:A.tool==="eraser"?"destination-out":"source-over"},O))})})})]}),m.jsx("div",{className:"absolute bottom-10 left-1/2 -translate-x-1/2",children:m.jsxs(un,{className:"px-6 py-2.5 flex items-center gap-6 rounded-2xl border-white/10 bg-surface-dark/40 backdrop-blur-2xl shadow-2xl",children:[m.jsx("button",{className:"text-slate-500 hover:text-white transition-colors",children:m.jsx("span",{className:"material-symbols-outlined text-lg",children:"remove"})}),m.jsx("span",{className:"text-[10px] font-black text-white w-12 text-center uppercase tracking-widest",children:"120%"}),m.jsx("button",{className:"text-slate-500 hover:text-white transition-colors",children:m.jsx("span",{className:"material-symbols-outlined text-lg",children:"add"})})]})})]}),m.jsxs("aside",{className:"w-96 flex-none flex flex-col p-10 gap-10 bg-surface-dark/20 backdrop-blur-xl border-l border-white/5 z-40 overflow-y-auto no-scrollbar",children:[m.jsxs("section",{className:"space-y-6",children:[m.jsxs("header",{className:"flex justify-between items-center group cursor-pointer",children:[m.jsx("h3",{className:"text-[10px] font-black uppercase tracking-[0.2em] text-slate-500",children:"Propiedades"}),m.jsx("span",{className:"material-symbols-outlined text-slate-700 text-sm",children:"more_horiz"})]}),m.jsxs(un,{className:"p-8 border-white/5 bg-surface-dark/40 rounded-[2rem] space-y-8",children:[m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{className:"flex justify-between items-center",children:[m.jsx("span",{className:"text-xs font-bold text-slate-400",children:"Grosor de Trazo"}),m.jsxs("span",{className:"px-2 py-0.5 rounded bg-white/5 text-[10px] font-black text-white",children:[n,"px"]})]}),m.jsx("input",{type:"range",min:"1",max:"20",value:n,onChange:A=>i(A.target.value),className:"w-full accent-primary h-1 bg-white/5 rounded-full appearance-none cursor-pointer"})]}),m.jsxs("div",{className:"space-y-4",children:[m.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest text-slate-600 block ml-1",children:"Color / Relleno"}),m.jsxs("div",{className:"flex items-center gap-4 bg-black/40 rounded-2xl p-4 border border-white/5",children:[m.jsx("div",{className:"size-10 rounded-full bg-primary shadow-[0_0_15px_rgba(99,102,242,0.4)] border-2 border-white/20"}),m.jsx("input",{type:"text",defaultValue:"#2F2CED",className:"bg-transparent border-none outline-none text-xs font-mono text-slate-300 w-full"})]})]}),m.jsxs("div",{className:"space-y-4",children:[m.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest text-slate-600 block ml-1",children:"Terminacin (Cap)"}),m.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[m.jsx(X2,{icon:"square"}),m.jsx(X2,{icon:"circle",active:!0}),m.jsx(X2,{icon:"rectangle"})]})]}),m.jsxs("button",{className:"w-full py-4 rounded-2xl bg-white/5 border border-white/5 text-[10px] font-black uppercase tracking-widest text-slate-300 flex items-center justify-center gap-3 hover:bg-white/10 transition-all",children:[m.jsx("span",{className:"material-symbols-outlined text-lg",children:"gesture"}),"Suavizar Trazo"]})]})]}),m.jsxs("section",{className:"flex-1 flex flex-col gap-6",children:[m.jsxs("header",{className:"flex justify-between items-center",children:[m.jsx("h3",{className:"text-[10px] font-black uppercase tracking-[0.2em] text-slate-500",children:"Capas"}),m.jsx("button",{className:"p-1 rounded bg-white/5 text-slate-500 hover:text-white transition-all",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"add"})})]}),m.jsx("div",{className:"space-y-3 overflow-y-auto no-scrollbar flex-1",children:N.map(A=>m.jsxs("div",{onClick:()=>l(A.id),className:`flex items-center gap-4 p-4 rounded-2xl transition-all cursor-pointer group ${o===A.id?"bg-primary/10 border border-primary/20":"bg-white/[0.02] border border-white/5 opacity-60 hover:opacity-100 hover:border-white/10"}`,children:[m.jsx("button",{className:"material-symbols-outlined text-sm text-slate-500 hover:text-white",children:A.visible?"visibility":"visibility_off"}),m.jsx("div",{className:"size-10 rounded-xl bg-black border border-white/10 flex items-center justify-center",children:m.jsx("span",{className:"material-symbols-outlined text-slate-600 group-hover:text-primary transition-colors text-xl",children:A.type.includes("Vector")?"timeline":"image"})}),m.jsxs("div",{className:"flex-1 min-w-0",children:[m.jsx("h4",{className:"text-xs font-bold text-white truncate",children:A.name}),m.jsx("p",{className:"text-[9px] text-slate-600 font-bold uppercase tracking-widest",children:A.type})]}),m.jsx("button",{className:"material-symbols-outlined text-slate-700 text-sm",children:"lock"})]},A.id))}),m.jsxs("div",{className:"flex gap-4 p-3 rounded-2xl bg-black/20 border border-white/5",children:[m.jsx("button",{className:"flex-1 p-2 rounded-xl hover:bg-white/5 text-slate-700 hover:text-white transition-all",children:m.jsx("span",{className:"material-symbols-outlined text-xl",children:"delete"})}),m.jsx("button",{className:"flex-1 p-2 rounded-xl hover:bg-white/5 text-slate-700 hover:text-white transition-all",children:m.jsx("span",{className:"material-symbols-outlined text-xl",children:"content_copy"})}),m.jsx("button",{className:"flex-1 p-2 rounded-xl hover:bg-white/5 text-slate-700 hover:text-white transition-all",children:m.jsx("span",{className:"material-symbols-outlined text-xl",children:"folder"})})]})]}),m.jsxs("div",{className:"p-6 rounded-[2rem] bg-gradient-to-br from-primary/20 to-orange-500/20 border border-white/10 space-y-4",children:[m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsx("span",{className:"material-symbols-outlined text-primary",children:"auto_fix_high"}),m.jsx("h4",{className:"text-[10px] font-black uppercase tracking-widest text-white",children:"Vectorizacin Inteligente"})]}),m.jsx("p",{className:"text-[10px] text-slate-500 leading-relaxed font-manrope",children:"Arrastra una imagen para convertirla automticamente en nodos editables."}),m.jsx(mn,{variant:"primary",size:"sm",className:"w-full text-[9px] py-3 rounded-xl shadow-lg",children:"Importar y Procesar"})]})]})]})]})},X2=({icon:t,active:e})=>m.jsx("button",{className:`py-4 rounded-xl border transition-all flex items-center justify-center ${e?"bg-primary/20 border-primary shadow-lg shadow-primary/20":"bg-white/5 border-white/5 hover:border-white/10"}`,children:m.jsx("span",{className:`material-symbols-outlined text-lg ${e?"text-white":"text-slate-600"}`,children:t})}),GZ=()=>{const[t,e]=se.useState("hub"),[r,n]=se.useState(null),i=s=>{n(s),e("editor")},a=async s=>{if(s.wordId)try{await Qe.patch(`/conlang/0/palabra/${s.wordId}/glyph`,{svgPathData:s.svgPathData}),console.log("Glyph saved successfully")}catch(o){console.error("Error saving glyph:",o)}n(null),e("hub")};return m.jsxs("div",{className:"flex-1 flex flex-col h-full bg-[#050508] overflow-hidden",children:[t==="hub"&&m.jsx(FZ,{onOpenEditor:i}),t==="editor"&&m.jsx(UZ,{word:r,onBack:()=>e("hub"),onSave:a})]})};var Q2={exports:{}},J2={};var E3;function VZ(){if(E3)return J2;E3=1;var t=um();function e(f,p){return f===p&&(f!==0||1/f===1/p)||f!==f&&p!==p}var r=typeof Object.is=="function"?Object.is:e,n=t.useState,i=t.useEffect,a=t.useLayoutEffect,s=t.useDebugValue;function o(f,p){var v=p(),y=n({inst:{value:v,getSnapshot:p}}),S=y[0].inst,w=y[1];return a(function(){S.value=v,S.getSnapshot=p,l(S)&&w({inst:S})},[f,v,p]),i(function(){return l(S)&&w({inst:S}),f(function(){l(S)&&w({inst:S})})},[f]),s(v),v}function l(f){var p=f.getSnapshot;f=f.value;try{var v=p();return!r(f,v)}catch{return!0}}function u(f,p){return p()}var c=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?u:o;return J2.useSyncExternalStore=t.useSyncExternalStore!==void 0?t.useSyncExternalStore:c,J2}var T3;function tO(){return T3||(T3=1,Q2.exports=VZ()),Q2.exports}var rO=tO();function Oa(t){this.content=t}Oa.prototype={constructor:Oa,find:function(t){for(var e=0;e<this.content.length;e+=2)if(this.content[e]===t)return e;return-1},get:function(t){var e=this.find(t);return e==-1?void 0:this.content[e+1]},update:function(t,e,r){var n=r&&r!=t?this.remove(r):this,i=n.find(t),a=n.content.slice();return i==-1?a.push(r||t,e):(a[i+1]=e,r&&(a[i]=r)),new Oa(a)},remove:function(t){var e=this.find(t);if(e==-1)return this;var r=this.content.slice();return r.splice(e,2),new Oa(r)},addToStart:function(t,e){return new Oa([t,e].concat(this.remove(t).content))},addToEnd:function(t,e){var r=this.remove(t).content.slice();return r.push(t,e),new Oa(r)},addBefore:function(t,e,r){var n=this.remove(e),i=n.content.slice(),a=n.find(t);return i.splice(a==-1?i.length:a,0,e,r),new Oa(i)},forEach:function(t){for(var e=0;e<this.content.length;e+=2)t(this.content[e],this.content[e+1])},prepend:function(t){return t=Oa.from(t),t.size?new Oa(t.content.concat(this.subtract(t).content)):this},append:function(t){return t=Oa.from(t),t.size?new Oa(this.subtract(t).content.concat(t.content)):this},subtract:function(t){var e=this;t=Oa.from(t);for(var r=0;r<t.content.length;r+=2)e=e.remove(t.content[r]);return e},toObject:function(){var t={};return this.forEach(function(e,r){t[e]=r}),t},get size(){return this.content.length>>1}};Oa.from=function(t){if(t instanceof Oa)return t;var e=[];if(t)for(var r in t)e.push(r,t[r]);return new Oa(e)};function nO(t,e,r){for(let n=0;;n++){if(n==t.childCount||n==e.childCount)return t.childCount==e.childCount?null:r;let i=t.child(n),a=e.child(n);if(i==a){r+=i.nodeSize;continue}if(!i.sameMarkup(a))return r;if(i.isText&&i.text!=a.text){for(let s=0;i.text[s]==a.text[s];s++)r++;return r}if(i.content.size||a.content.size){let s=nO(i.content,a.content,r+1);if(s!=null)return s}r+=i.nodeSize}}function iO(t,e,r,n){for(let i=t.childCount,a=e.childCount;;){if(i==0||a==0)return i==a?null:{a:r,b:n};let s=t.child(--i),o=e.child(--a),l=s.nodeSize;if(s==o){r-=l,n-=l;continue}if(!s.sameMarkup(o))return{a:r,b:n};if(s.isText&&s.text!=o.text){let u=0,c=Math.min(s.text.length,o.text.length);for(;u<c&&s.text[s.text.length-u-1]==o.text[o.text.length-u-1];)u++,r--,n--;return{a:r,b:n}}if(s.content.size||o.content.size){let u=iO(s.content,o.content,r-1,n-1);if(u)return u}r-=l,n-=l}}class rt{constructor(e,r){if(this.content=e,this.size=r||0,r==null)for(let n=0;n<e.length;n++)this.size+=e[n].nodeSize}nodesBetween(e,r,n,i=0,a){for(let s=0,o=0;o<r;s++){let l=this.content[s],u=o+l.nodeSize;if(u>e&&n(l,i+o,a||null,s)!==!1&&l.content.size){let c=o+1;l.nodesBetween(Math.max(0,e-c),Math.min(l.content.size,r-c),n,i+c)}o=u}}descendants(e){this.nodesBetween(0,this.size,e)}textBetween(e,r,n,i){let a="",s=!0;return this.nodesBetween(e,r,(o,l)=>{let u=o.isText?o.text.slice(Math.max(e,l)-l,r-l):o.isLeaf?i?typeof i=="function"?i(o):i:o.type.spec.leafText?o.type.spec.leafText(o):"":"";o.isBlock&&(o.isLeaf&&u||o.isTextblock)&&n&&(s?s=!1:a+=n),a+=u},0),a}append(e){if(!e.size)return this;if(!this.size)return e;let r=this.lastChild,n=e.firstChild,i=this.content.slice(),a=0;for(r.isText&&r.sameMarkup(n)&&(i[i.length-1]=r.withText(r.text+n.text),a=1);a<e.content.length;a++)i.push(e.content[a]);return new rt(i,this.size+e.size)}cut(e,r=this.size){if(e==0&&r==this.size)return this;let n=[],i=0;if(r>e)for(let a=0,s=0;s<r;a++){let o=this.content[a],l=s+o.nodeSize;l>e&&((s<e||l>r)&&(o.isText?o=o.cut(Math.max(0,e-s),Math.min(o.text.length,r-s)):o=o.cut(Math.max(0,e-s-1),Math.min(o.content.size,r-s-1))),n.push(o),i+=o.nodeSize),s=l}return new rt(n,i)}cutByIndex(e,r){return e==r?rt.empty:e==0&&r==this.content.length?this:new rt(this.content.slice(e,r))}replaceChild(e,r){let n=this.content[e];if(n==r)return this;let i=this.content.slice(),a=this.size+r.nodeSize-n.nodeSize;return i[e]=r,new rt(i,a)}addToStart(e){return new rt([e].concat(this.content),this.size+e.nodeSize)}addToEnd(e){return new rt(this.content.concat(e),this.size+e.nodeSize)}eq(e){if(this.content.length!=e.content.length)return!1;for(let r=0;r<this.content.length;r++)if(!this.content[r].eq(e.content[r]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(e){let r=this.content[e];if(!r)throw new RangeError("Index "+e+" out of range for "+this);return r}maybeChild(e){return this.content[e]||null}forEach(e){for(let r=0,n=0;r<this.content.length;r++){let i=this.content[r];e(i,n,r),n+=i.nodeSize}}findDiffStart(e,r=0){return nO(this,e,r)}findDiffEnd(e,r=this.size,n=e.size){return iO(this,e,r,n)}findIndex(e){if(e==0)return _y(0,e);if(e==this.size)return _y(this.content.length,e);if(e>this.size||e<0)throw new RangeError(`Position ${e} outside of fragment (${this})`);for(let r=0,n=0;;r++){let i=this.child(r),a=n+i.nodeSize;if(a>=e)return a==e?_y(r+1,a):_y(r,n);n=a}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(e=>e.toJSON()):null}static fromJSON(e,r){if(!r)return rt.empty;if(!Array.isArray(r))throw new RangeError("Invalid input for Fragment.fromJSON");return new rt(r.map(e.nodeFromJSON))}static fromArray(e){if(!e.length)return rt.empty;let r,n=0;for(let i=0;i<e.length;i++){let a=e[i];n+=a.nodeSize,i&&a.isText&&e[i-1].sameMarkup(a)?(r||(r=e.slice(0,i)),r[r.length-1]=a.withText(r[r.length-1].text+a.text)):r&&r.push(a)}return new rt(r||e,n)}static from(e){if(!e)return rt.empty;if(e instanceof rt)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new rt([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}rt.empty=new rt([],0);const eS={index:0,offset:0};function _y(t,e){return eS.index=t,eS.offset=e,eS}function Nx(t,e){if(t===e)return!0;if(!(t&&typeof t=="object")||!(e&&typeof e=="object"))return!1;let r=Array.isArray(t);if(Array.isArray(e)!=r)return!1;if(r){if(t.length!=e.length)return!1;for(let n=0;n<t.length;n++)if(!Nx(t[n],e[n]))return!1}else{for(let n in t)if(!(n in e)||!Nx(t[n],e[n]))return!1;for(let n in e)if(!(n in t))return!1}return!0}let hn=class yk{constructor(e,r){this.type=e,this.attrs=r}addToSet(e){let r,n=!1;for(let i=0;i<e.length;i++){let a=e[i];if(this.eq(a))return e;if(this.type.excludes(a.type))r||(r=e.slice(0,i));else{if(a.type.excludes(this.type))return e;!n&&a.type.rank>this.type.rank&&(r||(r=e.slice(0,i)),r.push(this),n=!0),r&&r.push(a)}}return r||(r=e.slice()),n||r.push(this),r}removeFromSet(e){for(let r=0;r<e.length;r++)if(this.eq(e[r]))return e.slice(0,r).concat(e.slice(r+1));return e}isInSet(e){for(let r=0;r<e.length;r++)if(this.eq(e[r]))return!0;return!1}eq(e){return this==e||this.type==e.type&&Nx(this.attrs,e.attrs)}toJSON(){let e={type:this.type.name};for(let r in this.attrs){e.attrs=this.attrs;break}return e}static fromJSON(e,r){if(!r)throw new RangeError("Invalid input for Mark.fromJSON");let n=e.marks[r.type];if(!n)throw new RangeError(`There is no mark type ${r.type} in this schema`);let i=n.create(r.attrs);return n.checkAttrs(i.attrs),i}static sameSet(e,r){if(e==r)return!0;if(e.length!=r.length)return!1;for(let n=0;n<e.length;n++)if(!e[n].eq(r[n]))return!1;return!0}static setFrom(e){if(!e||Array.isArray(e)&&e.length==0)return yk.none;if(e instanceof yk)return[e];let r=e.slice();return r.sort((n,i)=>n.type.rank-i.type.rank),r}};hn.none=[];class Px extends Error{}class Nt{constructor(e,r,n){this.content=e,this.openStart=r,this.openEnd=n}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(e,r){let n=sO(this.content,e+this.openStart,r);return n&&new Nt(n,this.openStart,this.openEnd)}removeBetween(e,r){return new Nt(aO(this.content,e+this.openStart,r+this.openStart),this.openStart,this.openEnd)}eq(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e}static fromJSON(e,r){if(!r)return Nt.empty;let n=r.openStart||0,i=r.openEnd||0;if(typeof n!="number"||typeof i!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new Nt(rt.fromJSON(e,r.content),n,i)}static maxOpen(e,r=!0){let n=0,i=0;for(let a=e.firstChild;a&&!a.isLeaf&&(r||!a.type.spec.isolating);a=a.firstChild)n++;for(let a=e.lastChild;a&&!a.isLeaf&&(r||!a.type.spec.isolating);a=a.lastChild)i++;return new Nt(e,n,i)}}Nt.empty=new Nt(rt.empty,0,0);function aO(t,e,r){let{index:n,offset:i}=t.findIndex(e),a=t.maybeChild(n),{index:s,offset:o}=t.findIndex(r);if(i==e||a.isText){if(o!=r&&!t.child(s).isText)throw new RangeError("Removing non-flat range");return t.cut(0,e).append(t.cut(r))}if(n!=s)throw new RangeError("Removing non-flat range");return t.replaceChild(n,a.copy(aO(a.content,e-i-1,r-i-1)))}function sO(t,e,r,n){let{index:i,offset:a}=t.findIndex(e),s=t.maybeChild(i);if(a==e||s.isText)return n&&!n.canReplace(i,i,r)?null:t.cut(0,e).append(r).append(t.cut(e));let o=sO(s.content,e-a-1,r,s);return o&&t.replaceChild(i,s.copy(o))}function HZ(t,e,r){if(r.openStart>t.depth)throw new Px("Inserted content deeper than insertion position");if(t.depth-r.openStart!=e.depth-r.openEnd)throw new Px("Inconsistent open depths");return oO(t,e,r,0)}function oO(t,e,r,n){let i=t.index(n),a=t.node(n);if(i==e.index(n)&&n<t.depth-r.openStart){let s=oO(t,e,r,n+1);return a.copy(a.content.replaceChild(i,s))}else if(r.content.size)if(!r.openStart&&!r.openEnd&&t.depth==n&&e.depth==n){let s=t.parent,o=s.content;return dh(s,o.cut(0,t.parentOffset).append(r.content).append(o.cut(e.parentOffset)))}else{let{start:s,end:o}=WZ(r,t);return dh(a,uO(t,s,o,e,n))}else return dh(a,Mx(t,e,n))}function lO(t,e){if(!e.type.compatibleContent(t.type))throw new Px("Cannot join "+e.type.name+" onto "+t.type.name)}function xk(t,e,r){let n=t.node(r);return lO(n,e.node(r)),n}function ch(t,e){let r=e.length-1;r>=0&&t.isText&&t.sameMarkup(e[r])?e[r]=t.withText(e[r].text+t.text):e.push(t)}function ov(t,e,r,n){let i=(e||t).node(r),a=0,s=e?e.index(r):i.childCount;t&&(a=t.index(r),t.depth>r?a++:t.textOffset&&(ch(t.nodeAfter,n),a++));for(let o=a;o<s;o++)ch(i.child(o),n);e&&e.depth==r&&e.textOffset&&ch(e.nodeBefore,n)}function dh(t,e){return t.type.checkContent(e),t.copy(e)}function uO(t,e,r,n,i){let a=t.depth>i&&xk(t,e,i+1),s=n.depth>i&&xk(r,n,i+1),o=[];return ov(null,t,i,o),a&&s&&e.index(i)==r.index(i)?(lO(a,s),ch(dh(a,uO(t,e,r,n,i+1)),o)):(a&&ch(dh(a,Mx(t,e,i+1)),o),ov(e,r,i,o),s&&ch(dh(s,Mx(r,n,i+1)),o)),ov(n,null,i,o),new rt(o)}function Mx(t,e,r){let n=[];if(ov(null,t,r,n),t.depth>r){let i=xk(t,e,r+1);ch(dh(i,Mx(t,e,r+1)),n)}return ov(e,null,r,n),new rt(n)}function WZ(t,e){let r=e.depth-t.openStart,i=e.node(r).copy(t.content);for(let a=r-1;a>=0;a--)i=e.node(a).copy(rt.from(i));return{start:i.resolveNoCache(t.openStart+r),end:i.resolveNoCache(i.content.size-t.openEnd-r)}}class jv{constructor(e,r,n){this.pos=e,this.path=r,this.parentOffset=n,this.depth=r.length/3-1}resolveDepth(e){return e==null?this.depth:e<0?this.depth+e:e}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(e){return this.path[this.resolveDepth(e)*3]}index(e){return this.path[this.resolveDepth(e)*3+1]}indexAfter(e){return e=this.resolveDepth(e),this.index(e)+(e==this.depth&&!this.textOffset?0:1)}start(e){return e=this.resolveDepth(e),e==0?0:this.path[e*3-1]+1}end(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size}before(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]}after(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]+this.path[e*3].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let e=this.parent,r=this.index(this.depth);if(r==e.childCount)return null;let n=this.pos-this.path[this.path.length-1],i=e.child(r);return n?e.child(r).cut(n):i}get nodeBefore(){let e=this.index(this.depth),r=this.pos-this.path[this.path.length-1];return r?this.parent.child(e).cut(0,r):e==0?null:this.parent.child(e-1)}posAtIndex(e,r){r=this.resolveDepth(r);let n=this.path[r*3],i=r==0?0:this.path[r*3-1]+1;for(let a=0;a<e;a++)i+=n.child(a).nodeSize;return i}marks(){let e=this.parent,r=this.index();if(e.content.size==0)return hn.none;if(this.textOffset)return e.child(r).marks;let n=e.maybeChild(r-1),i=e.maybeChild(r);if(!n){let o=n;n=i,i=o}let a=n.marks;for(var s=0;s<a.length;s++)a[s].type.spec.inclusive===!1&&(!i||!a[s].isInSet(i.marks))&&(a=a[s--].removeFromSet(a));return a}marksAcross(e){let r=this.parent.maybeChild(this.index());if(!r||!r.isInline)return null;let n=r.marks,i=e.parent.maybeChild(e.index());for(var a=0;a<n.length;a++)n[a].type.spec.inclusive===!1&&(!i||!n[a].isInSet(i.marks))&&(n=n[a--].removeFromSet(n));return n}sharedDepth(e){for(let r=this.depth;r>0;r--)if(this.start(r)<=e&&this.end(r)>=e)return r;return 0}blockRange(e=this,r){if(e.pos<this.pos)return e.blockRange(this);for(let n=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);n>=0;n--)if(e.pos<=this.end(n)&&(!r||r(this.node(n))))return new Ax(this,e,n);return null}sameParent(e){return this.pos-this.parentOffset==e.pos-e.parentOffset}max(e){return e.pos>this.pos?e:this}min(e){return e.pos<this.pos?e:this}toString(){let e="";for(let r=1;r<=this.depth;r++)e+=(e?"/":"")+this.node(r).type.name+"_"+this.index(r-1);return e+":"+this.parentOffset}static resolve(e,r){if(!(r>=0&&r<=e.content.size))throw new RangeError("Position "+r+" out of range");let n=[],i=0,a=r;for(let s=e;;){let{index:o,offset:l}=s.content.findIndex(a),u=a-l;if(n.push(s,o,i+l),!u||(s=s.child(o),s.isText))break;a=u-1,i+=l+1}return new jv(r,n,a)}static resolveCached(e,r){let n=N3.get(e);if(n)for(let a=0;a<n.elts.length;a++){let s=n.elts[a];if(s.pos==r)return s}else N3.set(e,n=new qZ);let i=n.elts[n.i]=jv.resolve(e,r);return n.i=(n.i+1)%$Z,i}}class qZ{constructor(){this.elts=[],this.i=0}}const $Z=12,N3=new WeakMap;class Ax{constructor(e,r,n){this.$from=e,this.$to=r,this.depth=n}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}const KZ=Object.create(null);class Vo{constructor(e,r,n,i=hn.none){this.type=e,this.attrs=r,this.marks=i,this.content=n||rt.empty}get children(){return this.content.content}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(e){return this.content.child(e)}maybeChild(e){return this.content.maybeChild(e)}forEach(e){this.content.forEach(e)}nodesBetween(e,r,n,i=0){this.content.nodesBetween(e,r,n,i,this)}descendants(e){this.nodesBetween(0,this.content.size,e)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(e,r,n,i){return this.content.textBetween(e,r,n,i)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)}sameMarkup(e){return this.hasMarkup(e.type,e.attrs,e.marks)}hasMarkup(e,r,n){return this.type==e&&Nx(this.attrs,r||e.defaultAttrs||KZ)&&hn.sameSet(this.marks,n||hn.none)}copy(e=null){return e==this.content?this:new Vo(this.type,this.attrs,e,this.marks)}mark(e){return e==this.marks?this:new Vo(this.type,this.attrs,this.content,e)}cut(e,r=this.content.size){return e==0&&r==this.content.size?this:this.copy(this.content.cut(e,r))}slice(e,r=this.content.size,n=!1){if(e==r)return Nt.empty;let i=this.resolve(e),a=this.resolve(r),s=n?0:i.sharedDepth(r),o=i.start(s),u=i.node(s).content.cut(i.pos-o,a.pos-o);return new Nt(u,i.depth-s,a.depth-s)}replace(e,r,n){return HZ(this.resolve(e),this.resolve(r),n)}nodeAt(e){for(let r=this;;){let{index:n,offset:i}=r.content.findIndex(e);if(r=r.maybeChild(n),!r)return null;if(i==e||r.isText)return r;e-=i+1}}childAfter(e){let{index:r,offset:n}=this.content.findIndex(e);return{node:this.content.maybeChild(r),index:r,offset:n}}childBefore(e){if(e==0)return{node:null,index:0,offset:0};let{index:r,offset:n}=this.content.findIndex(e);if(n<e)return{node:this.content.child(r),index:r,offset:n};let i=this.content.child(r-1);return{node:i,index:r-1,offset:n-i.nodeSize}}resolve(e){return jv.resolveCached(this,e)}resolveNoCache(e){return jv.resolve(this,e)}rangeHasMark(e,r,n){let i=!1;return r>e&&this.nodesBetween(e,r,a=>(n.isInSet(a.marks)&&(i=!0),!i)),i}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),cO(this.marks,e)}contentMatchAt(e){let r=this.type.contentMatch.matchFragment(this.content,0,e);if(!r)throw new Error("Called contentMatchAt on a node with invalid content");return r}canReplace(e,r,n=rt.empty,i=0,a=n.childCount){let s=this.contentMatchAt(e).matchFragment(n,i,a),o=s&&s.matchFragment(this.content,r);if(!o||!o.validEnd)return!1;for(let l=i;l<a;l++)if(!this.type.allowsMarks(n.child(l).marks))return!1;return!0}canReplaceWith(e,r,n,i){if(i&&!this.type.allowsMarks(i))return!1;let a=this.contentMatchAt(e).matchType(n),s=a&&a.matchFragment(this.content,r);return s?s.validEnd:!1}canAppend(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let e=hn.none;for(let r=0;r<this.marks.length;r++){let n=this.marks[r];n.type.checkAttrs(n.attrs),e=n.addToSet(e)}if(!hn.sameSet(e,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(r=>r.type.name)}`);this.content.forEach(r=>r.check())}toJSON(){let e={type:this.type.name};for(let r in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map(r=>r.toJSON())),e}static fromJSON(e,r){if(!r)throw new RangeError("Invalid input for Node.fromJSON");let n;if(r.marks){if(!Array.isArray(r.marks))throw new RangeError("Invalid mark data for Node.fromJSON");n=r.marks.map(e.markFromJSON)}if(r.type=="text"){if(typeof r.text!="string")throw new RangeError("Invalid text node in JSON");return e.text(r.text,n)}let i=rt.fromJSON(e,r.content),a=e.nodeType(r.type).create(r.attrs,i,n);return a.type.checkAttrs(a.attrs),a}}Vo.prototype.text=void 0;class Lx extends Vo{constructor(e,r,n,i){if(super(e,r,null,i),!n)throw new RangeError("Empty text nodes are not allowed");this.text=n}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):cO(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(e,r){return this.text.slice(e,r)}get nodeSize(){return this.text.length}mark(e){return e==this.marks?this:new Lx(this.type,this.attrs,this.text,e)}withText(e){return e==this.text?this:new Lx(this.type,this.attrs,e,this.marks)}cut(e=0,r=this.text.length){return e==0&&r==this.text.length?this:this.withText(this.text.slice(e,r))}eq(e){return this.sameMarkup(e)&&this.text==e.text}toJSON(){let e=super.toJSON();return e.text=this.text,e}}function cO(t,e){for(let r=t.length-1;r>=0;r--)e=t[r].type.name+"("+e+")";return e}class _h{constructor(e){this.validEnd=e,this.next=[],this.wrapCache=[]}static parse(e,r){let n=new ZZ(e,r);if(n.next==null)return _h.empty;let i=dO(n);n.next&&n.err("Unexpected trailing text");let a=rY(tY(i));return nY(a,n),a}matchType(e){for(let r=0;r<this.next.length;r++)if(this.next[r].type==e)return this.next[r].next;return null}matchFragment(e,r=0,n=e.childCount){let i=this;for(let a=r;i&&a<n;a++)i=i.matchType(e.child(a).type);return i}get inlineContent(){return this.next.length!=0&&this.next[0].type.isInline}get defaultType(){for(let e=0;e<this.next.length;e++){let{type:r}=this.next[e];if(!(r.isText||r.hasRequiredAttrs()))return r}return null}compatible(e){for(let r=0;r<this.next.length;r++)for(let n=0;n<e.next.length;n++)if(this.next[r].type==e.next[n].type)return!0;return!1}fillBefore(e,r=!1,n=0){let i=[this];function a(s,o){let l=s.matchFragment(e,n);if(l&&(!r||l.validEnd))return rt.from(o.map(u=>u.createAndFill()));for(let u=0;u<s.next.length;u++){let{type:c,next:f}=s.next[u];if(!(c.isText||c.hasRequiredAttrs())&&i.indexOf(f)==-1){i.push(f);let p=a(f,o.concat(c));if(p)return p}}return null}return a(this,[])}findWrapping(e){for(let n=0;n<this.wrapCache.length;n+=2)if(this.wrapCache[n]==e)return this.wrapCache[n+1];let r=this.computeWrapping(e);return this.wrapCache.push(e,r),r}computeWrapping(e){let r=Object.create(null),n=[{match:this,type:null,via:null}];for(;n.length;){let i=n.shift(),a=i.match;if(a.matchType(e)){let s=[];for(let o=i;o.type;o=o.via)s.push(o.type);return s.reverse()}for(let s=0;s<a.next.length;s++){let{type:o,next:l}=a.next[s];!o.isLeaf&&!o.hasRequiredAttrs()&&!(o.name in r)&&(!i.type||l.validEnd)&&(n.push({match:o.contentMatch,type:o,via:i}),r[o.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(e){if(e>=this.next.length)throw new RangeError(`There's no ${e}th edge in this content match`);return this.next[e]}toString(){let e=[];function r(n){e.push(n);for(let i=0;i<n.next.length;i++)e.indexOf(n.next[i].next)==-1&&r(n.next[i].next)}return r(this),e.map((n,i)=>{let a=i+(n.validEnd?"*":" ")+" ";for(let s=0;s<n.next.length;s++)a+=(s?", ":"")+n.next[s].type.name+"->"+e.indexOf(n.next[s].next);return a}).join(`
`)}}_h.empty=new _h(!0);class ZZ{constructor(e,r){this.string=e,this.nodeTypes=r,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(e){return this.next==e&&(this.pos++||!0)}err(e){throw new SyntaxError(e+" (in content expression '"+this.string+"')")}}function dO(t){let e=[];do e.push(YZ(t));while(t.eat("|"));return e.length==1?e[0]:{type:"choice",exprs:e}}function YZ(t){let e=[];do e.push(XZ(t));while(t.next&&t.next!=")"&&t.next!="|");return e.length==1?e[0]:{type:"seq",exprs:e}}function XZ(t){let e=eY(t);for(;;)if(t.eat("+"))e={type:"plus",expr:e};else if(t.eat("*"))e={type:"star",expr:e};else if(t.eat("?"))e={type:"opt",expr:e};else if(t.eat("{"))e=QZ(t,e);else break;return e}function P3(t){/\D/.test(t.next)&&t.err("Expected number, got '"+t.next+"'");let e=Number(t.next);return t.pos++,e}function QZ(t,e){let r=P3(t),n=r;return t.eat(",")&&(t.next!="}"?n=P3(t):n=-1),t.eat("}")||t.err("Unclosed braced range"),{type:"range",min:r,max:n,expr:e}}function JZ(t,e){let r=t.nodeTypes,n=r[e];if(n)return[n];let i=[];for(let a in r){let s=r[a];s.isInGroup(e)&&i.push(s)}return i.length==0&&t.err("No node type or group '"+e+"' found"),i}function eY(t){if(t.eat("(")){let e=dO(t);return t.eat(")")||t.err("Missing closing paren"),e}else if(/\W/.test(t.next))t.err("Unexpected token '"+t.next+"'");else{let e=JZ(t,t.next).map(r=>(t.inline==null?t.inline=r.isInline:t.inline!=r.isInline&&t.err("Mixing inline and block content"),{type:"name",value:r}));return t.pos++,e.length==1?e[0]:{type:"choice",exprs:e}}}function tY(t){let e=[[]];return i(a(t,0),r()),e;function r(){return e.push([])-1}function n(s,o,l){let u={term:l,to:o};return e[s].push(u),u}function i(s,o){s.forEach(l=>l.to=o)}function a(s,o){if(s.type=="choice")return s.exprs.reduce((l,u)=>l.concat(a(u,o)),[]);if(s.type=="seq")for(let l=0;;l++){let u=a(s.exprs[l],o);if(l==s.exprs.length-1)return u;i(u,o=r())}else if(s.type=="star"){let l=r();return n(o,l),i(a(s.expr,l),l),[n(l)]}else if(s.type=="plus"){let l=r();return i(a(s.expr,o),l),i(a(s.expr,l),l),[n(l)]}else{if(s.type=="opt")return[n(o)].concat(a(s.expr,o));if(s.type=="range"){let l=o;for(let u=0;u<s.min;u++){let c=r();i(a(s.expr,l),c),l=c}if(s.max==-1)i(a(s.expr,l),l);else for(let u=s.min;u<s.max;u++){let c=r();n(l,c),i(a(s.expr,l),c),l=c}return[n(l)]}else{if(s.type=="name")return[n(o,void 0,s.value)];throw new Error("Unknown expr type")}}}}function fO(t,e){return e-t}function M3(t,e){let r=[];return n(e),r.sort(fO);function n(i){let a=t[i];if(a.length==1&&!a[0].term)return n(a[0].to);r.push(i);for(let s=0;s<a.length;s++){let{term:o,to:l}=a[s];!o&&r.indexOf(l)==-1&&n(l)}}}function rY(t){let e=Object.create(null);return r(M3(t,0));function r(n){let i=[];n.forEach(s=>{t[s].forEach(({term:o,to:l})=>{if(!o)return;let u;for(let c=0;c<i.length;c++)i[c][0]==o&&(u=i[c][1]);M3(t,l).forEach(c=>{u||i.push([o,u=[]]),u.indexOf(c)==-1&&u.push(c)})})});let a=e[n.join(",")]=new _h(n.indexOf(t.length-1)>-1);for(let s=0;s<i.length;s++){let o=i[s][1].sort(fO);a.next.push({type:i[s][0],next:e[o.join(",")]||r(o)})}return a}}function nY(t,e){for(let r=0,n=[t];r<n.length;r++){let i=n[r],a=!i.validEnd,s=[];for(let o=0;o<i.next.length;o++){let{type:l,next:u}=i.next[o];s.push(l.name),a&&!(l.isText||l.hasRequiredAttrs())&&(a=!1),n.indexOf(u)==-1&&n.push(u)}a&&e.err("Only non-generatable nodes ("+s.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function hO(t){let e=Object.create(null);for(let r in t){let n=t[r];if(!n.hasDefault)return null;e[r]=n.default}return e}function pO(t,e){let r=Object.create(null);for(let n in t){let i=e&&e[n];if(i===void 0){let a=t[n];if(a.hasDefault)i=a.default;else throw new RangeError("No value supplied for attribute "+n)}r[n]=i}return r}function mO(t,e,r,n){for(let i in e)if(!(i in t))throw new RangeError(`Unsupported attribute ${i} for ${r} of type ${i}`);for(let i in t){let a=t[i];a.validate&&a.validate(e[i])}}function gO(t,e){let r=Object.create(null);if(e)for(let n in e)r[n]=new aY(t,n,e[n]);return r}let A3=class vO{constructor(e,r,n){this.name=e,this.schema=r,this.spec=n,this.markSet=null,this.groups=n.group?n.group.split(" "):[],this.attrs=gO(e,n.attrs),this.defaultAttrs=hO(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(n.inline||e=="text"),this.isText=e=="text"}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==_h.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}isInGroup(e){return this.groups.indexOf(e)>-1}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1}compatibleContent(e){return this==e||this.contentMatch.compatible(e.contentMatch)}computeAttrs(e){return!e&&this.defaultAttrs?this.defaultAttrs:pO(this.attrs,e)}create(e=null,r,n){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new Vo(this,this.computeAttrs(e),rt.from(r),hn.setFrom(n))}createChecked(e=null,r,n){return r=rt.from(r),this.checkContent(r),new Vo(this,this.computeAttrs(e),r,hn.setFrom(n))}createAndFill(e=null,r,n){if(e=this.computeAttrs(e),r=rt.from(r),r.size){let s=this.contentMatch.fillBefore(r);if(!s)return null;r=s.append(r)}let i=this.contentMatch.matchFragment(r),a=i&&i.fillBefore(rt.empty,!0);return a?new Vo(this,e,r.append(a),hn.setFrom(n)):null}validContent(e){let r=this.contentMatch.matchFragment(e);if(!r||!r.validEnd)return!1;for(let n=0;n<e.childCount;n++)if(!this.allowsMarks(e.child(n).marks))return!1;return!0}checkContent(e){if(!this.validContent(e))throw new RangeError(`Invalid content for node ${this.name}: ${e.toString().slice(0,50)}`)}checkAttrs(e){mO(this.attrs,e,"node",this.name)}allowsMarkType(e){return this.markSet==null||this.markSet.indexOf(e)>-1}allowsMarks(e){if(this.markSet==null)return!0;for(let r=0;r<e.length;r++)if(!this.allowsMarkType(e[r].type))return!1;return!0}allowedMarks(e){if(this.markSet==null)return e;let r;for(let n=0;n<e.length;n++)this.allowsMarkType(e[n].type)?r&&r.push(e[n]):r||(r=e.slice(0,n));return r?r.length?r:hn.none:e}static compile(e,r){let n=Object.create(null);e.forEach((a,s)=>n[a]=new vO(a,r,s));let i=r.spec.topNode||"doc";if(!n[i])throw new RangeError("Schema is missing its top node type ('"+i+"')");if(!n.text)throw new RangeError("Every schema needs a 'text' type");for(let a in n.text.attrs)throw new RangeError("The text node type should not have attributes");return n}};function iY(t,e,r){let n=r.split("|");return i=>{let a=i===null?"null":typeof i;if(n.indexOf(a)<0)throw new RangeError(`Expected value of type ${n} for attribute ${e} on type ${t}, got ${a}`)}}class aY{constructor(e,r,n){this.hasDefault=Object.prototype.hasOwnProperty.call(n,"default"),this.default=n.default,this.validate=typeof n.validate=="string"?iY(e,r,n.validate):n.validate}get isRequired(){return!this.hasDefault}}class K1{constructor(e,r,n,i){this.name=e,this.rank=r,this.schema=n,this.spec=i,this.attrs=gO(e,i.attrs),this.excluded=null;let a=hO(this.attrs);this.instance=a?new hn(this,a):null}create(e=null){return!e&&this.instance?this.instance:new hn(this,pO(this.attrs,e))}static compile(e,r){let n=Object.create(null),i=0;return e.forEach((a,s)=>n[a]=new K1(a,i++,r,s)),n}removeFromSet(e){for(var r=0;r<e.length;r++)e[r].type==this&&(e=e.slice(0,r).concat(e.slice(r+1)),r--);return e}isInSet(e){for(let r=0;r<e.length;r++)if(e[r].type==this)return e[r]}checkAttrs(e){mO(this.attrs,e,"mark",this.name)}excludes(e){return this.excluded.indexOf(e)>-1}}class yO{constructor(e){this.linebreakReplacement=null,this.cached=Object.create(null);let r=this.spec={};for(let i in e)r[i]=e[i];r.nodes=Oa.from(e.nodes),r.marks=Oa.from(e.marks||{}),this.nodes=A3.compile(this.spec.nodes,this),this.marks=K1.compile(this.spec.marks,this);let n=Object.create(null);for(let i in this.nodes){if(i in this.marks)throw new RangeError(i+" can not be both a node and a mark");let a=this.nodes[i],s=a.spec.content||"",o=a.spec.marks;if(a.contentMatch=n[s]||(n[s]=_h.parse(s,this.nodes)),a.inlineContent=a.contentMatch.inlineContent,a.spec.linebreakReplacement){if(this.linebreakReplacement)throw new RangeError("Multiple linebreak nodes defined");if(!a.isInline||!a.isLeaf)throw new RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=a}a.markSet=o=="_"?null:o?L3(this,o.split(" ")):o==""||!a.inlineContent?[]:null}for(let i in this.marks){let a=this.marks[i],s=a.spec.excludes;a.excluded=s==null?[a]:s==""?[]:L3(this,s.split(" "))}this.nodeFromJSON=i=>Vo.fromJSON(this,i),this.markFromJSON=i=>hn.fromJSON(this,i),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(e,r=null,n,i){if(typeof e=="string")e=this.nodeType(e);else if(e instanceof A3){if(e.schema!=this)throw new RangeError("Node type from different schema used ("+e.name+")")}else throw new RangeError("Invalid node type: "+e);return e.createChecked(r,n,i)}text(e,r){let n=this.nodes.text;return new Lx(n,n.defaultAttrs,e,hn.setFrom(r))}mark(e,r){return typeof e=="string"&&(e=this.marks[e]),e.create(r)}nodeType(e){let r=this.nodes[e];if(!r)throw new RangeError("Unknown node type: "+e);return r}}function L3(t,e){let r=[];for(let n=0;n<e.length;n++){let i=e[n],a=t.marks[i],s=a;if(a)r.push(a);else for(let o in t.marks){let l=t.marks[o];(i=="_"||l.spec.group&&l.spec.group.split(" ").indexOf(i)>-1)&&r.push(s=l)}if(!s)throw new SyntaxError("Unknown mark type: '"+e[n]+"'")}return r}function sY(t){return t.tag!=null}function oY(t){return t.style!=null}class $d{constructor(e,r){this.schema=e,this.rules=r,this.tags=[],this.styles=[];let n=this.matchedStyles=[];r.forEach(i=>{if(sY(i))this.tags.push(i);else if(oY(i)){let a=/[^=]*/.exec(i.style)[0];n.indexOf(a)<0&&n.push(a),this.styles.push(i)}}),this.normalizeLists=!this.tags.some(i=>{if(!/^(ul|ol)\b/.test(i.tag)||!i.node)return!1;let a=e.nodes[i.node];return a.contentMatch.matchType(a)})}parse(e,r={}){let n=new O3(this,r,!1);return n.addAll(e,hn.none,r.from,r.to),n.finish()}parseSlice(e,r={}){let n=new O3(this,r,!0);return n.addAll(e,hn.none,r.from,r.to),Nt.maxOpen(n.finish())}matchTag(e,r,n){for(let i=n?this.tags.indexOf(n)+1:0;i<this.tags.length;i++){let a=this.tags[i];if(cY(e,a.tag)&&(a.namespace===void 0||e.namespaceURI==a.namespace)&&(!a.context||r.matchesContext(a.context))){if(a.getAttrs){let s=a.getAttrs(e);if(s===!1)continue;a.attrs=s||void 0}return a}}}matchStyle(e,r,n,i){for(let a=i?this.styles.indexOf(i)+1:0;a<this.styles.length;a++){let s=this.styles[a],o=s.style;if(!(o.indexOf(e)!=0||s.context&&!n.matchesContext(s.context)||o.length>e.length&&(o.charCodeAt(e.length)!=61||o.slice(e.length+1)!=r))){if(s.getAttrs){let l=s.getAttrs(r);if(l===!1)continue;s.attrs=l||void 0}return s}}}static schemaRules(e){let r=[];function n(i){let a=i.priority==null?50:i.priority,s=0;for(;s<r.length;s++){let o=r[s];if((o.priority==null?50:o.priority)<a)break}r.splice(s,0,i)}for(let i in e.marks){let a=e.marks[i].spec.parseDOM;a&&a.forEach(s=>{n(s=D3(s)),s.mark||s.ignore||s.clearMark||(s.mark=i)})}for(let i in e.nodes){let a=e.nodes[i].spec.parseDOM;a&&a.forEach(s=>{n(s=D3(s)),s.node||s.ignore||s.mark||(s.node=i)})}return r}static fromSchema(e){return e.cached.domParser||(e.cached.domParser=new $d(e,$d.schemaRules(e)))}}const xO={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},lY={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},bO={ol:!0,ul:!0},Fv=1,bk=2,lv=4;function R3(t,e,r){return e!=null?(e?Fv:0)|(e==="full"?bk:0):t&&t.whitespace=="pre"?Fv|bk:r&~lv}class Cy{constructor(e,r,n,i,a,s){this.type=e,this.attrs=r,this.marks=n,this.solid=i,this.options=s,this.content=[],this.activeMarks=hn.none,this.match=a||(s&lv?null:e.contentMatch)}findWrapping(e){if(!this.match){if(!this.type)return[];let r=this.type.contentMatch.fillBefore(rt.from(e));if(r)this.match=this.type.contentMatch.matchFragment(r);else{let n=this.type.contentMatch,i;return(i=n.findWrapping(e.type))?(this.match=n,i):null}}return this.match.findWrapping(e.type)}finish(e){if(!(this.options&Fv)){let n=this.content[this.content.length-1],i;if(n&&n.isText&&(i=/[ \t\r\n\u000c]+$/.exec(n.text))){let a=n;n.text.length==i[0].length?this.content.pop():this.content[this.content.length-1]=a.withText(a.text.slice(0,a.text.length-i[0].length))}}let r=rt.from(this.content);return!e&&this.match&&(r=r.append(this.match.fillBefore(rt.empty,!0))),this.type?this.type.create(this.attrs,r,this.marks):r}inlineContext(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!xO.hasOwnProperty(e.parentNode.nodeName.toLowerCase())}}class O3{constructor(e,r,n){this.parser=e,this.options=r,this.isOpen=n,this.open=0,this.localPreserveWS=!1;let i=r.topNode,a,s=R3(null,r.preserveWhitespace,0)|(n?lv:0);i?a=new Cy(i.type,i.attrs,hn.none,!0,r.topMatch||i.type.contentMatch,s):n?a=new Cy(null,null,hn.none,!0,null,s):a=new Cy(e.schema.topNodeType,null,hn.none,!0,null,s),this.nodes=[a],this.find=r.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(e,r){e.nodeType==3?this.addTextNode(e,r):e.nodeType==1&&this.addElement(e,r)}addTextNode(e,r){let n=e.nodeValue,i=this.top,a=i.options&bk?"full":this.localPreserveWS||(i.options&Fv)>0,{schema:s}=this.parser;if(a==="full"||i.inlineContext(e)||/[^ \t\r\n\u000c]/.test(n)){if(a)if(a==="full")n=n.replace(/\r\n?/g,`
`);else if(s.linebreakReplacement&&/[\r\n]/.test(n)&&this.top.findWrapping(s.linebreakReplacement.create())){let o=n.split(/\r?\n|\r/);for(let l=0;l<o.length;l++)l&&this.insertNode(s.linebreakReplacement.create(),r,!0),o[l]&&this.insertNode(s.text(o[l]),r,!/\S/.test(o[l]));n=""}else n=n.replace(/\r?\n|\r/g," ");else if(n=n.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(n)&&this.open==this.nodes.length-1){let o=i.content[i.content.length-1],l=e.previousSibling;(!o||l&&l.nodeName=="BR"||o.isText&&/[ \t\r\n\u000c]$/.test(o.text))&&(n=n.slice(1))}n&&this.insertNode(s.text(n),r,!/\S/.test(n)),this.findInText(e)}else this.findInside(e)}addElement(e,r,n){let i=this.localPreserveWS,a=this.top;(e.tagName=="PRE"||/pre/.test(e.style&&e.style.whiteSpace))&&(this.localPreserveWS=!0);let s=e.nodeName.toLowerCase(),o;bO.hasOwnProperty(s)&&this.parser.normalizeLists&&uY(e);let l=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(o=this.parser.matchTag(e,this,n));e:if(l?l.ignore:lY.hasOwnProperty(s))this.findInside(e),this.ignoreFallback(e,r);else if(!l||l.skip||l.closeParent){l&&l.closeParent?this.open=Math.max(0,this.open-1):l&&l.skip.nodeType&&(e=l.skip);let u,c=this.needsBlock;if(xO.hasOwnProperty(s))a.content.length&&a.content[0].isInline&&this.open&&(this.open--,a=this.top),u=!0,a.type||(this.needsBlock=!0);else if(!e.firstChild){this.leafFallback(e,r);break e}let f=l&&l.skip?r:this.readStyles(e,r);f&&this.addAll(e,f),u&&this.sync(a),this.needsBlock=c}else{let u=this.readStyles(e,r);u&&this.addElementByRule(e,l,u,l.consuming===!1?o:void 0)}this.localPreserveWS=i}leafFallback(e,r){e.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode(`
`),r)}ignoreFallback(e,r){e.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"),r,!0)}readStyles(e,r){let n=e.style;if(n&&n.length)for(let i=0;i<this.parser.matchedStyles.length;i++){let a=this.parser.matchedStyles[i],s=n.getPropertyValue(a);if(s)for(let o=void 0;;){let l=this.parser.matchStyle(a,s,this,o);if(!l)break;if(l.ignore)return null;if(l.clearMark?r=r.filter(u=>!l.clearMark(u)):r=r.concat(this.parser.schema.marks[l.mark].create(l.attrs)),l.consuming===!1)o=l;else break}}return r}addElementByRule(e,r,n,i){let a,s;if(r.node)if(s=this.parser.schema.nodes[r.node],s.isLeaf)this.insertNode(s.create(r.attrs),n,e.nodeName=="BR")||this.leafFallback(e,n);else{let l=this.enter(s,r.attrs||null,n,r.preserveWhitespace);l&&(a=!0,n=l)}else{let l=this.parser.schema.marks[r.mark];n=n.concat(l.create(r.attrs))}let o=this.top;if(s&&s.isLeaf)this.findInside(e);else if(i)this.addElement(e,n,i);else if(r.getContent)this.findInside(e),r.getContent(e,this.parser.schema).forEach(l=>this.insertNode(l,n,!1));else{let l=e;typeof r.contentElement=="string"?l=e.querySelector(r.contentElement):typeof r.contentElement=="function"?l=r.contentElement(e):r.contentElement&&(l=r.contentElement),this.findAround(e,l,!0),this.addAll(l,n),this.findAround(e,l,!1)}a&&this.sync(o)&&this.open--}addAll(e,r,n,i){let a=n||0;for(let s=n?e.childNodes[n]:e.firstChild,o=i==null?null:e.childNodes[i];s!=o;s=s.nextSibling,++a)this.findAtPoint(e,a),this.addDOM(s,r);this.findAtPoint(e,a)}findPlace(e,r,n){let i,a;for(let s=this.open,o=0;s>=0;s--){let l=this.nodes[s],u=l.findWrapping(e);if(u&&(!i||i.length>u.length+o)&&(i=u,a=l,!u.length))break;if(l.solid){if(n)break;o+=2}}if(!i)return null;this.sync(a);for(let s=0;s<i.length;s++)r=this.enterInner(i[s],null,r,!1);return r}insertNode(e,r,n){if(e.isInline&&this.needsBlock&&!this.top.type){let a=this.textblockFromContext();a&&(r=this.enterInner(a,null,r))}let i=this.findPlace(e,r,n);if(i){this.closeExtra();let a=this.top;a.match&&(a.match=a.match.matchType(e.type));let s=hn.none;for(let o of i.concat(e.marks))(a.type?a.type.allowsMarkType(o.type):I3(o.type,e.type))&&(s=o.addToSet(s));return a.content.push(e.mark(s)),!0}return!1}enter(e,r,n,i){let a=this.findPlace(e.create(r),n,!1);return a&&(a=this.enterInner(e,r,n,!0,i)),a}enterInner(e,r,n,i=!1,a){this.closeExtra();let s=this.top;s.match=s.match&&s.match.matchType(e);let o=R3(e,a,s.options);s.options&lv&&s.content.length==0&&(o|=lv);let l=hn.none;return n=n.filter(u=>(s.type?s.type.allowsMarkType(u.type):I3(u.type,e))?(l=u.addToSet(l),!1):!0),this.nodes.push(new Cy(e,r,l,i,null,o)),this.open++,n}closeExtra(e=!1){let r=this.nodes.length-1;if(r>this.open){for(;r>this.open;r--)this.nodes[r-1].content.push(this.nodes[r].finish(e));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(!!(this.isOpen||this.options.topOpen))}sync(e){for(let r=this.open;r>=0;r--){if(this.nodes[r]==e)return this.open=r,!0;this.localPreserveWS&&(this.nodes[r].options|=Fv)}return!1}get currentPos(){this.closeExtra();let e=0;for(let r=this.open;r>=0;r--){let n=this.nodes[r].content;for(let i=n.length-1;i>=0;i--)e+=n[i].nodeSize;r&&e++}return e}findAtPoint(e,r){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].node==e&&this.find[n].offset==r&&(this.find[n].pos=this.currentPos)}findInside(e){if(this.find)for(let r=0;r<this.find.length;r++)this.find[r].pos==null&&e.nodeType==1&&e.contains(this.find[r].node)&&(this.find[r].pos=this.currentPos)}findAround(e,r,n){if(e!=r&&this.find)for(let i=0;i<this.find.length;i++)this.find[i].pos==null&&e.nodeType==1&&e.contains(this.find[i].node)&&r.compareDocumentPosition(this.find[i].node)&(n?2:4)&&(this.find[i].pos=this.currentPos)}findInText(e){if(this.find)for(let r=0;r<this.find.length;r++)this.find[r].node==e&&(this.find[r].pos=this.currentPos-(e.nodeValue.length-this.find[r].offset))}matchesContext(e){if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);let r=e.split("/"),n=this.options.context,i=!this.isOpen&&(!n||n.parent.type==this.nodes[0].type),a=-(n?n.depth+1:0)+(i?0:1),s=(o,l)=>{for(;o>=0;o--){let u=r[o];if(u==""){if(o==r.length-1||o==0)continue;for(;l>=a;l--)if(s(o-1,l))return!0;return!1}else{let c=l>0||l==0&&i?this.nodes[l].type:n&&l>=a?n.node(l-a).type:null;if(!c||c.name!=u&&!c.isInGroup(u))return!1;l--}}return!0};return s(r.length-1,this.open)}textblockFromContext(){let e=this.options.context;if(e)for(let r=e.depth;r>=0;r--){let n=e.node(r).contentMatchAt(e.indexAfter(r)).defaultType;if(n&&n.isTextblock&&n.defaultAttrs)return n}for(let r in this.parser.schema.nodes){let n=this.parser.schema.nodes[r];if(n.isTextblock&&n.defaultAttrs)return n}}}function uY(t){for(let e=t.firstChild,r=null;e;e=e.nextSibling){let n=e.nodeType==1?e.nodeName.toLowerCase():null;n&&bO.hasOwnProperty(n)&&r?(r.appendChild(e),e=r):n=="li"?r=e:n&&(r=null)}}function cY(t,e){return(t.matches||t.msMatchesSelector||t.webkitMatchesSelector||t.mozMatchesSelector).call(t,e)}function D3(t){let e={};for(let r in t)e[r]=t[r];return e}function I3(t,e){let r=e.schema.nodes;for(let n in r){let i=r[n];if(!i.allowsMarkType(t))continue;let a=[],s=o=>{a.push(o);for(let l=0;l<o.edgeCount;l++){let{type:u,next:c}=o.edge(l);if(u==e||a.indexOf(c)<0&&s(c))return!0}};if(s(i.contentMatch))return!0}}class Oh{constructor(e,r){this.nodes=e,this.marks=r}serializeFragment(e,r={},n){n||(n=tS(r).createDocumentFragment());let i=n,a=[];return e.forEach(s=>{if(a.length||s.marks.length){let o=0,l=0;for(;o<a.length&&l<s.marks.length;){let u=s.marks[l];if(!this.marks[u.type.name]){l++;continue}if(!u.eq(a[o][0])||u.type.spec.spanning===!1)break;o++,l++}for(;o<a.length;)i=a.pop()[1];for(;l<s.marks.length;){let u=s.marks[l++],c=this.serializeMark(u,s.isInline,r);c&&(a.push([u,i]),i.appendChild(c.dom),i=c.contentDOM||c.dom)}}i.appendChild(this.serializeNodeInner(s,r))}),n}serializeNodeInner(e,r){let{dom:n,contentDOM:i}=Jy(tS(r),this.nodes[e.type.name](e),null,e.attrs);if(i){if(e.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(e.content,r,i)}return n}serializeNode(e,r={}){let n=this.serializeNodeInner(e,r);for(let i=e.marks.length-1;i>=0;i--){let a=this.serializeMark(e.marks[i],e.isInline,r);a&&((a.contentDOM||a.dom).appendChild(n),n=a.dom)}return n}serializeMark(e,r,n={}){let i=this.marks[e.type.name];return i&&Jy(tS(n),i(e,r),null,e.attrs)}static renderSpec(e,r,n=null,i){return Jy(e,r,n,i)}static fromSchema(e){return e.cached.domSerializer||(e.cached.domSerializer=new Oh(this.nodesFromSchema(e),this.marksFromSchema(e)))}static nodesFromSchema(e){let r=j3(e.nodes);return r.text||(r.text=n=>n.text),r}static marksFromSchema(e){return j3(e.marks)}}function j3(t){let e={};for(let r in t){let n=t[r].spec.toDOM;n&&(e[r]=n)}return e}function tS(t){return t.document||window.document}const F3=new WeakMap;function dY(t){let e=F3.get(t);return e===void 0&&F3.set(t,e=fY(t)),e}function fY(t){let e=null;function r(n){if(n&&typeof n=="object")if(Array.isArray(n))if(typeof n[0]=="string")e||(e=[]),e.push(n);else for(let i=0;i<n.length;i++)r(n[i]);else for(let i in n)r(n[i])}return r(t),e}function Jy(t,e,r,n){if(typeof e=="string")return{dom:t.createTextNode(e)};if(e.nodeType!=null)return{dom:e};if(e.dom&&e.dom.nodeType!=null)return e;let i=e[0],a;if(typeof i!="string")throw new RangeError("Invalid array passed to renderSpec");if(n&&(a=dY(n))&&a.indexOf(e)>-1)throw new RangeError("Using an array from an attribute object as a DOM spec. This may be an attempted cross site scripting attack.");let s=i.indexOf(" ");s>0&&(r=i.slice(0,s),i=i.slice(s+1));let o,l=r?t.createElementNS(r,i):t.createElement(i),u=e[1],c=1;if(u&&typeof u=="object"&&u.nodeType==null&&!Array.isArray(u)){c=2;for(let f in u)if(u[f]!=null){let p=f.indexOf(" ");p>0?l.setAttributeNS(f.slice(0,p),f.slice(p+1),u[f]):f=="style"&&l.style?l.style.cssText=u[f]:l.setAttribute(f,u[f])}}for(let f=c;f<e.length;f++){let p=e[f];if(p===0){if(f<e.length-1||f>c)throw new RangeError("Content hole must be the only child of its parent node");return{dom:l,contentDOM:l}}else{let{dom:v,contentDOM:y}=Jy(t,p,r,n);if(l.appendChild(v),y){if(o)throw new RangeError("Multiple content holes");o=y}}}return{dom:l,contentDOM:o}}const wO=65535,SO=Math.pow(2,16);function hY(t,e){return t+e*SO}function B3(t){return t&wO}function pY(t){return(t-(t&wO))/SO}const kO=1,_O=2,ex=4,CO=8;class wk{constructor(e,r,n){this.pos=e,this.delInfo=r,this.recover=n}get deleted(){return(this.delInfo&CO)>0}get deletedBefore(){return(this.delInfo&(kO|ex))>0}get deletedAfter(){return(this.delInfo&(_O|ex))>0}get deletedAcross(){return(this.delInfo&ex)>0}}class lo{constructor(e,r=!1){if(this.ranges=e,this.inverted=r,!e.length&&lo.empty)return lo.empty}recover(e){let r=0,n=B3(e);if(!this.inverted)for(let i=0;i<n;i++)r+=this.ranges[i*3+2]-this.ranges[i*3+1];return this.ranges[n*3]+r+pY(e)}mapResult(e,r=1){return this._map(e,r,!1)}map(e,r=1){return this._map(e,r,!0)}_map(e,r,n){let i=0,a=this.inverted?2:1,s=this.inverted?1:2;for(let o=0;o<this.ranges.length;o+=3){let l=this.ranges[o]-(this.inverted?i:0);if(l>e)break;let u=this.ranges[o+a],c=this.ranges[o+s],f=l+u;if(e<=f){let p=u?e==l?-1:e==f?1:r:r,v=l+i+(p<0?0:c);if(n)return v;let y=e==(r<0?l:f)?null:hY(o/3,e-l),S=e==l?_O:e==f?kO:ex;return(r<0?e!=l:e!=f)&&(S|=CO),new wk(v,S,y)}i+=c-u}return n?e+i:new wk(e+i,0,null)}touches(e,r){let n=0,i=B3(r),a=this.inverted?2:1,s=this.inverted?1:2;for(let o=0;o<this.ranges.length;o+=3){let l=this.ranges[o]-(this.inverted?n:0);if(l>e)break;let u=this.ranges[o+a],c=l+u;if(e<=c&&o==i*3)return!0;n+=this.ranges[o+s]-u}return!1}forEach(e){let r=this.inverted?2:1,n=this.inverted?1:2;for(let i=0,a=0;i<this.ranges.length;i+=3){let s=this.ranges[i],o=s-(this.inverted?a:0),l=s+(this.inverted?0:a),u=this.ranges[i+r],c=this.ranges[i+n];e(o,o+u,l,l+c),a+=c-u}}invert(){return new lo(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(e){return e==0?lo.empty:new lo(e<0?[0,-e,0]:[0,0,e])}}lo.empty=new lo([]);class Bv{constructor(e,r,n=0,i=e?e.length:0){this.mirror=r,this.from=n,this.to=i,this._maps=e||[],this.ownData=!(e||r)}get maps(){return this._maps}slice(e=0,r=this.maps.length){return new Bv(this._maps,this.mirror,e,r)}appendMap(e,r){this.ownData||(this._maps=this._maps.slice(),this.mirror=this.mirror&&this.mirror.slice(),this.ownData=!0),this.to=this._maps.push(e),r!=null&&this.setMirror(this._maps.length-1,r)}appendMapping(e){for(let r=0,n=this._maps.length;r<e._maps.length;r++){let i=e.getMirror(r);this.appendMap(e._maps[r],i!=null&&i<r?n+i:void 0)}}getMirror(e){if(this.mirror){for(let r=0;r<this.mirror.length;r++)if(this.mirror[r]==e)return this.mirror[r+(r%2?-1:1)]}}setMirror(e,r){this.mirror||(this.mirror=[]),this.mirror.push(e,r)}appendMappingInverted(e){for(let r=e.maps.length-1,n=this._maps.length+e._maps.length;r>=0;r--){let i=e.getMirror(r);this.appendMap(e._maps[r].invert(),i!=null&&i>r?n-i-1:void 0)}}invert(){let e=new Bv;return e.appendMappingInverted(this),e}map(e,r=1){if(this.mirror)return this._map(e,r,!0);for(let n=this.from;n<this.to;n++)e=this._maps[n].map(e,r);return e}mapResult(e,r=1){return this._map(e,r,!1)}_map(e,r,n){let i=0;for(let a=this.from;a<this.to;a++){let s=this._maps[a],o=s.mapResult(e,r);if(o.recover!=null){let l=this.getMirror(a);if(l!=null&&l>a&&l<this.to){a=l,e=this._maps[l].recover(o.recover);continue}}i|=o.delInfo,e=o.pos}return n?e:new wk(e,i,null)}}const rS=Object.create(null);class us{getMap(){return lo.empty}merge(e){return null}static fromJSON(e,r){if(!r||!r.stepType)throw new RangeError("Invalid input for Step.fromJSON");let n=rS[r.stepType];if(!n)throw new RangeError(`No step type ${r.stepType} defined`);return n.fromJSON(e,r)}static jsonID(e,r){if(e in rS)throw new RangeError("Duplicate use of step JSON ID "+e);return rS[e]=r,r.prototype.jsonID=e,r}}class Li{constructor(e,r){this.doc=e,this.failed=r}static ok(e){return new Li(e,null)}static fail(e){return new Li(null,e)}static fromReplace(e,r,n,i){try{return Li.ok(e.replace(r,n,i))}catch(a){if(a instanceof Px)return Li.fail(a.message);throw a}}}function Z_(t,e,r){let n=[];for(let i=0;i<t.childCount;i++){let a=t.child(i);a.content.size&&(a=a.copy(Z_(a.content,e,a))),a.isInline&&(a=e(a,r,i)),n.push(a)}return rt.fromArray(n)}class Bd extends us{constructor(e,r,n){super(),this.from=e,this.to=r,this.mark=n}apply(e){let r=e.slice(this.from,this.to),n=e.resolve(this.from),i=n.node(n.sharedDepth(this.to)),a=new Nt(Z_(r.content,(s,o)=>!s.isAtom||!o.type.allowsMarkType(this.mark.type)?s:s.mark(this.mark.addToSet(s.marks)),i),r.openStart,r.openEnd);return Li.fromReplace(e,this.from,this.to,a)}invert(){return new _l(this.from,this.to,this.mark)}map(e){let r=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return r.deleted&&n.deleted||r.pos>=n.pos?null:new Bd(r.pos,n.pos,this.mark)}merge(e){return e instanceof Bd&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new Bd(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,r){if(typeof r.from!="number"||typeof r.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new Bd(r.from,r.to,e.markFromJSON(r.mark))}}us.jsonID("addMark",Bd);class _l extends us{constructor(e,r,n){super(),this.from=e,this.to=r,this.mark=n}apply(e){let r=e.slice(this.from,this.to),n=new Nt(Z_(r.content,i=>i.mark(this.mark.removeFromSet(i.marks)),e),r.openStart,r.openEnd);return Li.fromReplace(e,this.from,this.to,n)}invert(){return new Bd(this.from,this.to,this.mark)}map(e){let r=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return r.deleted&&n.deleted||r.pos>=n.pos?null:new _l(r.pos,n.pos,this.mark)}merge(e){return e instanceof _l&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new _l(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,r){if(typeof r.from!="number"||typeof r.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new _l(r.from,r.to,e.markFromJSON(r.mark))}}us.jsonID("removeMark",_l);class zd extends us{constructor(e,r){super(),this.pos=e,this.mark=r}apply(e){let r=e.nodeAt(this.pos);if(!r)return Li.fail("No node at mark step's position");let n=r.type.create(r.attrs,null,this.mark.addToSet(r.marks));return Li.fromReplace(e,this.pos,this.pos+1,new Nt(rt.from(n),0,r.isLeaf?0:1))}invert(e){let r=e.nodeAt(this.pos);if(r){let n=this.mark.addToSet(r.marks);if(n.length==r.marks.length){for(let i=0;i<r.marks.length;i++)if(!r.marks[i].isInSet(n))return new zd(this.pos,r.marks[i]);return new zd(this.pos,this.mark)}}return new Ch(this.pos,this.mark)}map(e){let r=e.mapResult(this.pos,1);return r.deletedAfter?null:new zd(r.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,r){if(typeof r.pos!="number")throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new zd(r.pos,e.markFromJSON(r.mark))}}us.jsonID("addNodeMark",zd);class Ch extends us{constructor(e,r){super(),this.pos=e,this.mark=r}apply(e){let r=e.nodeAt(this.pos);if(!r)return Li.fail("No node at mark step's position");let n=r.type.create(r.attrs,null,this.mark.removeFromSet(r.marks));return Li.fromReplace(e,this.pos,this.pos+1,new Nt(rt.from(n),0,r.isLeaf?0:1))}invert(e){let r=e.nodeAt(this.pos);return!r||!this.mark.isInSet(r.marks)?this:new zd(this.pos,this.mark)}map(e){let r=e.mapResult(this.pos,1);return r.deletedAfter?null:new Ch(r.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,r){if(typeof r.pos!="number")throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new Ch(r.pos,e.markFromJSON(r.mark))}}us.jsonID("removeNodeMark",Ch);class oa extends us{constructor(e,r,n,i=!1){super(),this.from=e,this.to=r,this.slice=n,this.structure=i}apply(e){return this.structure&&Sk(e,this.from,this.to)?Li.fail("Structure replace would overwrite content"):Li.fromReplace(e,this.from,this.to,this.slice)}getMap(){return new lo([this.from,this.to-this.from,this.slice.size])}invert(e){return new oa(this.from,this.from+this.slice.size,e.slice(this.from,this.to))}map(e){let r=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return r.deletedAcross&&n.deletedAcross?null:new oa(r.pos,Math.max(r.pos,n.pos),this.slice,this.structure)}merge(e){if(!(e instanceof oa)||e.structure||this.structure)return null;if(this.from+this.slice.size==e.from&&!this.slice.openEnd&&!e.slice.openStart){let r=this.slice.size+e.slice.size==0?Nt.empty:new Nt(this.slice.content.append(e.slice.content),this.slice.openStart,e.slice.openEnd);return new oa(this.from,this.to+(e.to-e.from),r,this.structure)}else if(e.to==this.from&&!this.slice.openStart&&!e.slice.openEnd){let r=this.slice.size+e.slice.size==0?Nt.empty:new Nt(e.slice.content.append(this.slice.content),e.slice.openStart,this.slice.openEnd);return new oa(e.from,this.to,r,this.structure)}else return null}toJSON(){let e={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,r){if(typeof r.from!="number"||typeof r.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new oa(r.from,r.to,Nt.fromJSON(e,r.slice),!!r.structure)}}us.jsonID("replace",oa);class da extends us{constructor(e,r,n,i,a,s,o=!1){super(),this.from=e,this.to=r,this.gapFrom=n,this.gapTo=i,this.slice=a,this.insert=s,this.structure=o}apply(e){if(this.structure&&(Sk(e,this.from,this.gapFrom)||Sk(e,this.gapTo,this.to)))return Li.fail("Structure gap-replace would overwrite content");let r=e.slice(this.gapFrom,this.gapTo);if(r.openStart||r.openEnd)return Li.fail("Gap is not a flat range");let n=this.slice.insertAt(this.insert,r.content);return n?Li.fromReplace(e,this.from,this.to,n):Li.fail("Content does not fit in gap")}getMap(){return new lo([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(e){let r=this.gapTo-this.gapFrom;return new da(this.from,this.from+this.slice.size+r,this.from+this.insert,this.from+this.insert+r,e.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(e){let r=e.mapResult(this.from,1),n=e.mapResult(this.to,-1),i=this.from==this.gapFrom?r.pos:e.map(this.gapFrom,-1),a=this.to==this.gapTo?n.pos:e.map(this.gapTo,1);return r.deletedAcross&&n.deletedAcross||i<r.pos||a>n.pos?null:new da(r.pos,n.pos,i,a,this.slice,this.insert,this.structure)}toJSON(){let e={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,r){if(typeof r.from!="number"||typeof r.to!="number"||typeof r.gapFrom!="number"||typeof r.gapTo!="number"||typeof r.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new da(r.from,r.to,r.gapFrom,r.gapTo,Nt.fromJSON(e,r.slice),r.insert,!!r.structure)}}us.jsonID("replaceAround",da);function Sk(t,e,r){let n=t.resolve(e),i=r-e,a=n.depth;for(;i>0&&a>0&&n.indexAfter(a)==n.node(a).childCount;)a--,i--;if(i>0){let s=n.node(a).maybeChild(n.indexAfter(a));for(;i>0;){if(!s||s.isLeaf)return!0;s=s.firstChild,i--}}return!1}function mY(t,e,r,n){let i=[],a=[],s,o;t.doc.nodesBetween(e,r,(l,u,c)=>{if(!l.isInline)return;let f=l.marks;if(!n.isInSet(f)&&c.type.allowsMarkType(n.type)){let p=Math.max(u,e),v=Math.min(u+l.nodeSize,r),y=n.addToSet(f);for(let S=0;S<f.length;S++)f[S].isInSet(y)||(s&&s.to==p&&s.mark.eq(f[S])?s.to=v:i.push(s=new _l(p,v,f[S])));o&&o.to==p?o.to=v:a.push(o=new Bd(p,v,n))}}),i.forEach(l=>t.step(l)),a.forEach(l=>t.step(l))}function gY(t,e,r,n){let i=[],a=0;t.doc.nodesBetween(e,r,(s,o)=>{if(!s.isInline)return;a++;let l=null;if(n instanceof K1){let u=s.marks,c;for(;c=n.isInSet(u);)(l||(l=[])).push(c),u=c.removeFromSet(u)}else n?n.isInSet(s.marks)&&(l=[n]):l=s.marks;if(l&&l.length){let u=Math.min(o+s.nodeSize,r);for(let c=0;c<l.length;c++){let f=l[c],p;for(let v=0;v<i.length;v++){let y=i[v];y.step==a-1&&f.eq(i[v].style)&&(p=y)}p?(p.to=u,p.step=a):i.push({style:f,from:Math.max(o,e),to:u,step:a})}}}),i.forEach(s=>t.step(new _l(s.from,s.to,s.style)))}function Y_(t,e,r,n=r.contentMatch,i=!0){let a=t.doc.nodeAt(e),s=[],o=e+1;for(let l=0;l<a.childCount;l++){let u=a.child(l),c=o+u.nodeSize,f=n.matchType(u.type);if(!f)s.push(new oa(o,c,Nt.empty));else{n=f;for(let p=0;p<u.marks.length;p++)r.allowsMarkType(u.marks[p].type)||t.step(new _l(o,c,u.marks[p]));if(i&&u.isText&&r.whitespace!="pre"){let p,v=/\r?\n|\r/g,y;for(;p=v.exec(u.text);)y||(y=new Nt(rt.from(r.schema.text(" ",r.allowedMarks(u.marks))),0,0)),s.push(new oa(o+p.index,o+p.index+p[0].length,y))}}o=c}if(!n.validEnd){let l=n.fillBefore(rt.empty,!0);t.replace(o,o,new Nt(l,0,0))}for(let l=s.length-1;l>=0;l--)t.step(s[l])}function vY(t,e,r){return(e==0||t.canReplace(e,t.childCount))&&(r==t.childCount||t.canReplace(0,r))}function bm(t){let r=t.parent.content.cutByIndex(t.startIndex,t.endIndex);for(let n=t.depth,i=0,a=0;;--n){let s=t.$from.node(n),o=t.$from.index(n)+i,l=t.$to.indexAfter(n)-a;if(n<t.depth&&s.canReplace(o,l,r))return n;if(n==0||s.type.spec.isolating||!vY(s,o,l))break;o&&(i=1),l<s.childCount&&(a=1)}return null}function yY(t,e,r){let{$from:n,$to:i,depth:a}=e,s=n.before(a+1),o=i.after(a+1),l=s,u=o,c=rt.empty,f=0;for(let y=a,S=!1;y>r;y--)S||n.index(y)>0?(S=!0,c=rt.from(n.node(y).copy(c)),f++):l--;let p=rt.empty,v=0;for(let y=a,S=!1;y>r;y--)S||i.after(y+1)<i.end(y)?(S=!0,p=rt.from(i.node(y).copy(p)),v++):u++;t.step(new da(l,u,s,o,new Nt(c.append(p),f,v),c.size-f,!0))}function X_(t,e,r=null,n=t){let i=xY(t,e),a=i&&bY(n,e);return a?i.map(z3).concat({type:e,attrs:r}).concat(a.map(z3)):null}function z3(t){return{type:t,attrs:null}}function xY(t,e){let{parent:r,startIndex:n,endIndex:i}=t,a=r.contentMatchAt(n).findWrapping(e);if(!a)return null;let s=a.length?a[0]:e;return r.canReplaceWith(n,i,s)?a:null}function bY(t,e){let{parent:r,startIndex:n,endIndex:i}=t,a=r.child(n),s=e.contentMatch.findWrapping(a.type);if(!s)return null;let l=(s.length?s[s.length-1]:e).contentMatch;for(let u=n;l&&u<i;u++)l=l.matchType(r.child(u).type);return!l||!l.validEnd?null:s}function wY(t,e,r){let n=rt.empty;for(let s=r.length-1;s>=0;s--){if(n.size){let o=r[s].type.contentMatch.matchFragment(n);if(!o||!o.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}n=rt.from(r[s].type.create(r[s].attrs,n))}let i=e.start,a=e.end;t.step(new da(i,a,i,a,new Nt(n,0,0),r.length,!0))}function SY(t,e,r,n,i){if(!n.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let a=t.steps.length;t.doc.nodesBetween(e,r,(s,o)=>{let l=typeof i=="function"?i(s):i;if(s.isTextblock&&!s.hasMarkup(n,l)&&kY(t.doc,t.mapping.slice(a).map(o),n)){let u=null;if(n.schema.linebreakReplacement){let v=n.whitespace=="pre",y=!!n.contentMatch.matchType(n.schema.linebreakReplacement);v&&!y?u=!1:!v&&y&&(u=!0)}u===!1&&TO(t,s,o,a),Y_(t,t.mapping.slice(a).map(o,1),n,void 0,u===null);let c=t.mapping.slice(a),f=c.map(o,1),p=c.map(o+s.nodeSize,1);return t.step(new da(f,p,f+1,p-1,new Nt(rt.from(n.create(l,null,s.marks)),0,0),1,!0)),u===!0&&EO(t,s,o,a),!1}})}function EO(t,e,r,n){e.forEach((i,a)=>{if(i.isText){let s,o=/\r?\n|\r/g;for(;s=o.exec(i.text);){let l=t.mapping.slice(n).map(r+1+a+s.index);t.replaceWith(l,l+1,e.type.schema.linebreakReplacement.create())}}})}function TO(t,e,r,n){e.forEach((i,a)=>{if(i.type==i.type.schema.linebreakReplacement){let s=t.mapping.slice(n).map(r+1+a);t.replaceWith(s,s+1,e.type.schema.text(`
`))}})}function kY(t,e,r){let n=t.resolve(e),i=n.index();return n.parent.canReplaceWith(i,i+1,r)}function _Y(t,e,r,n,i){let a=t.doc.nodeAt(e);if(!a)throw new RangeError("No node at given position");r||(r=a.type);let s=r.create(n,null,i||a.marks);if(a.isLeaf)return t.replaceWith(e,e+a.nodeSize,s);if(!r.validContent(a.content))throw new RangeError("Invalid content for node type "+r.name);t.step(new da(e,e+a.nodeSize,e+1,e+a.nodeSize-1,new Nt(rt.from(s),0,0),1,!0))}function gc(t,e,r=1,n){let i=t.resolve(e),a=i.depth-r,s=n&&n[n.length-1]||i.parent;if(a<0||i.parent.type.spec.isolating||!i.parent.canReplace(i.index(),i.parent.childCount)||!s.type.validContent(i.parent.content.cutByIndex(i.index(),i.parent.childCount)))return!1;for(let u=i.depth-1,c=r-2;u>a;u--,c--){let f=i.node(u),p=i.index(u);if(f.type.spec.isolating)return!1;let v=f.content.cutByIndex(p,f.childCount),y=n&&n[c+1];y&&(v=v.replaceChild(0,y.type.create(y.attrs)));let S=n&&n[c]||f;if(!f.canReplace(p+1,f.childCount)||!S.type.validContent(v))return!1}let o=i.indexAfter(a),l=n&&n[0];return i.node(a).canReplaceWith(o,o,l?l.type:i.node(a+1).type)}function CY(t,e,r=1,n){let i=t.doc.resolve(e),a=rt.empty,s=rt.empty;for(let o=i.depth,l=i.depth-r,u=r-1;o>l;o--,u--){a=rt.from(i.node(o).copy(a));let c=n&&n[u];s=rt.from(c?c.type.create(c.attrs,s):i.node(o).copy(s))}t.step(new oa(e,e,new Nt(a.append(s),r,r),!0))}function pf(t,e){let r=t.resolve(e),n=r.index();return NO(r.nodeBefore,r.nodeAfter)&&r.parent.canReplace(n,n+1)}function EY(t,e){e.content.size||t.type.compatibleContent(e.type);let r=t.contentMatchAt(t.childCount),{linebreakReplacement:n}=t.type.schema;for(let i=0;i<e.childCount;i++){let a=e.child(i),s=a.type==n?t.type.schema.nodes.text:a.type;if(r=r.matchType(s),!r||!t.type.allowsMarks(a.marks))return!1}return r.validEnd}function NO(t,e){return!!(t&&e&&!t.isLeaf&&EY(t,e))}function Z1(t,e,r=-1){let n=t.resolve(e);for(let i=n.depth;;i--){let a,s,o=n.index(i);if(i==n.depth?(a=n.nodeBefore,s=n.nodeAfter):r>0?(a=n.node(i+1),o++,s=n.node(i).maybeChild(o)):(a=n.node(i).maybeChild(o-1),s=n.node(i+1)),a&&!a.isTextblock&&NO(a,s)&&n.node(i).canReplace(o,o+1))return e;if(i==0)break;e=r<0?n.before(i):n.after(i)}}function TY(t,e,r){let n=null,{linebreakReplacement:i}=t.doc.type.schema,a=t.doc.resolve(e-r),s=a.node().type;if(i&&s.inlineContent){let c=s.whitespace=="pre",f=!!s.contentMatch.matchType(i);c&&!f?n=!1:!c&&f&&(n=!0)}let o=t.steps.length;if(n===!1){let c=t.doc.resolve(e+r);TO(t,c.node(),c.before(),o)}s.inlineContent&&Y_(t,e+r-1,s,a.node().contentMatchAt(a.index()),n==null);let l=t.mapping.slice(o),u=l.map(e-r);if(t.step(new oa(u,l.map(e+r,-1),Nt.empty,!0)),n===!0){let c=t.doc.resolve(u);EO(t,c.node(),c.before(),t.steps.length)}return t}function NY(t,e,r){let n=t.resolve(e);if(n.parent.canReplaceWith(n.index(),n.index(),r))return e;if(n.parentOffset==0)for(let i=n.depth-1;i>=0;i--){let a=n.index(i);if(n.node(i).canReplaceWith(a,a,r))return n.before(i+1);if(a>0)return null}if(n.parentOffset==n.parent.content.size)for(let i=n.depth-1;i>=0;i--){let a=n.indexAfter(i);if(n.node(i).canReplaceWith(a,a,r))return n.after(i+1);if(a<n.node(i).childCount)return null}return null}function PO(t,e,r){let n=t.resolve(e);if(!r.content.size)return e;let i=r.content;for(let a=0;a<r.openStart;a++)i=i.firstChild.content;for(let a=1;a<=(r.openStart==0&&r.size?2:1);a++)for(let s=n.depth;s>=0;s--){let o=s==n.depth?0:n.pos<=(n.start(s+1)+n.end(s+1))/2?-1:1,l=n.index(s)+(o>0?1:0),u=n.node(s),c=!1;if(a==1)c=u.canReplace(l,l,i);else{let f=u.contentMatchAt(l).findWrapping(i.firstChild.type);c=f&&u.canReplaceWith(l,l,f[0])}if(c)return o==0?n.pos:o<0?n.before(s+1):n.after(s+1)}return null}function Y1(t,e,r=e,n=Nt.empty){if(e==r&&!n.size)return null;let i=t.resolve(e),a=t.resolve(r);return MO(i,a,n)?new oa(e,r,n):new PY(i,a,n).fit()}function MO(t,e,r){return!r.openStart&&!r.openEnd&&t.start()==e.start()&&t.parent.canReplace(t.index(),e.index(),r.content)}class PY{constructor(e,r,n){this.$from=e,this.$to=r,this.unplaced=n,this.frontier=[],this.placed=rt.empty;for(let i=0;i<=e.depth;i++){let a=e.node(i);this.frontier.push({type:a.type,match:a.contentMatchAt(e.indexAfter(i))})}for(let i=e.depth;i>0;i--)this.placed=rt.from(e.node(i).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let u=this.findFittable();u?this.placeNodes(u):this.openMore()||this.dropNode()}let e=this.mustMoveInline(),r=this.placed.size-this.depth-this.$from.depth,n=this.$from,i=this.close(e<0?this.$to:n.doc.resolve(e));if(!i)return null;let a=this.placed,s=n.depth,o=i.depth;for(;s&&o&&a.childCount==1;)a=a.firstChild.content,s--,o--;let l=new Nt(a,s,o);return e>-1?new da(n.pos,e,this.$to.pos,this.$to.end(),l,r):l.size||n.pos!=this.$to.pos?new oa(n.pos,i.pos,l):null}findFittable(){let e=this.unplaced.openStart;for(let r=this.unplaced.content,n=0,i=this.unplaced.openEnd;n<e;n++){let a=r.firstChild;if(r.childCount>1&&(i=0),a.type.spec.isolating&&i<=n){e=n;break}r=a.content}for(let r=1;r<=2;r++)for(let n=r==1?e:this.unplaced.openStart;n>=0;n--){let i,a=null;n?(a=nS(this.unplaced.content,n-1).firstChild,i=a.content):i=this.unplaced.content;let s=i.firstChild;for(let o=this.depth;o>=0;o--){let{type:l,match:u}=this.frontier[o],c,f=null;if(r==1&&(s?u.matchType(s.type)||(f=u.fillBefore(rt.from(s),!1)):a&&l.compatibleContent(a.type)))return{sliceDepth:n,frontierDepth:o,parent:a,inject:f};if(r==2&&s&&(c=u.findWrapping(s.type)))return{sliceDepth:n,frontierDepth:o,parent:a,wrap:c};if(a&&u.matchType(a.type))break}}}openMore(){let{content:e,openStart:r,openEnd:n}=this.unplaced,i=nS(e,r);return!i.childCount||i.firstChild.isLeaf?!1:(this.unplaced=new Nt(e,r+1,Math.max(n,i.size+r>=e.size-n?r+1:0)),!0)}dropNode(){let{content:e,openStart:r,openEnd:n}=this.unplaced,i=nS(e,r);if(i.childCount<=1&&r>0){let a=e.size-r<=r+i.size;this.unplaced=new Nt(Jg(e,r-1,1),r-1,a?r-1:n)}else this.unplaced=new Nt(Jg(e,r,1),r,n)}placeNodes({sliceDepth:e,frontierDepth:r,parent:n,inject:i,wrap:a}){for(;this.depth>r;)this.closeFrontierNode();if(a)for(let S=0;S<a.length;S++)this.openFrontierNode(a[S]);let s=this.unplaced,o=n?n.content:s.content,l=s.openStart-e,u=0,c=[],{match:f,type:p}=this.frontier[r];if(i){for(let S=0;S<i.childCount;S++)c.push(i.child(S));f=f.matchFragment(i)}let v=o.size+e-(s.content.size-s.openEnd);for(;u<o.childCount;){let S=o.child(u),w=f.matchType(S.type);if(!w)break;u++,(u>1||l==0||S.content.size)&&(f=w,c.push(AO(S.mark(p.allowedMarks(S.marks)),u==1?l:0,u==o.childCount?v:-1)))}let y=u==o.childCount;y||(v=-1),this.placed=ev(this.placed,r,rt.from(c)),this.frontier[r].match=f,y&&v<0&&n&&n.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let S=0,w=o;S<v;S++){let T=w.lastChild;this.frontier.push({type:T.type,match:T.contentMatchAt(T.childCount)}),w=T.content}this.unplaced=y?e==0?Nt.empty:new Nt(Jg(s.content,e-1,1),e-1,v<0?s.openEnd:e-1):new Nt(Jg(s.content,e,u),s.openStart,s.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let e=this.frontier[this.depth],r;if(!e.type.isTextblock||!iS(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(r=this.findCloseLevel(this.$to))&&r.depth==this.depth)return-1;let{depth:n}=this.$to,i=this.$to.after(n);for(;n>1&&i==this.$to.end(--n);)++i;return i}findCloseLevel(e){e:for(let r=Math.min(this.depth,e.depth);r>=0;r--){let{match:n,type:i}=this.frontier[r],a=r<e.depth&&e.end(r+1)==e.pos+(e.depth-(r+1)),s=iS(e,r,i,n,a);if(s){for(let o=r-1;o>=0;o--){let{match:l,type:u}=this.frontier[o],c=iS(e,o,u,l,!0);if(!c||c.childCount)continue e}return{depth:r,fit:s,move:a?e.doc.resolve(e.after(r+1)):e}}}}close(e){let r=this.findCloseLevel(e);if(!r)return null;for(;this.depth>r.depth;)this.closeFrontierNode();r.fit.childCount&&(this.placed=ev(this.placed,r.depth,r.fit)),e=r.move;for(let n=r.depth+1;n<=e.depth;n++){let i=e.node(n),a=i.type.contentMatch.fillBefore(i.content,!0,e.index(n));this.openFrontierNode(i.type,i.attrs,a)}return e}openFrontierNode(e,r=null,n){let i=this.frontier[this.depth];i.match=i.match.matchType(e),this.placed=ev(this.placed,this.depth,rt.from(e.create(r,n))),this.frontier.push({type:e,match:e.contentMatch})}closeFrontierNode(){let r=this.frontier.pop().match.fillBefore(rt.empty,!0);r.childCount&&(this.placed=ev(this.placed,this.frontier.length,r))}}function Jg(t,e,r){return e==0?t.cutByIndex(r,t.childCount):t.replaceChild(0,t.firstChild.copy(Jg(t.firstChild.content,e-1,r)))}function ev(t,e,r){return e==0?t.append(r):t.replaceChild(t.childCount-1,t.lastChild.copy(ev(t.lastChild.content,e-1,r)))}function nS(t,e){for(let r=0;r<e;r++)t=t.firstChild.content;return t}function AO(t,e,r){if(e<=0)return t;let n=t.content;return e>1&&(n=n.replaceChild(0,AO(n.firstChild,e-1,n.childCount==1?r-1:0))),e>0&&(n=t.type.contentMatch.fillBefore(n).append(n),r<=0&&(n=n.append(t.type.contentMatch.matchFragment(n).fillBefore(rt.empty,!0)))),t.copy(n)}function iS(t,e,r,n,i){let a=t.node(e),s=i?t.indexAfter(e):t.index(e);if(s==a.childCount&&!r.compatibleContent(a.type))return null;let o=n.fillBefore(a.content,!0,s);return o&&!MY(r,a.content,s)?o:null}function MY(t,e,r){for(let n=r;n<e.childCount;n++)if(!t.allowsMarks(e.child(n).marks))return!0;return!1}function AY(t){return t.spec.defining||t.spec.definingForContent}function LY(t,e,r,n){if(!n.size)return t.deleteRange(e,r);let i=t.doc.resolve(e),a=t.doc.resolve(r);if(MO(i,a,n))return t.step(new oa(e,r,n));let s=RO(i,a);s[s.length-1]==0&&s.pop();let o=-(i.depth+1);s.unshift(o);for(let p=i.depth,v=i.pos-1;p>0;p--,v--){let y=i.node(p).type.spec;if(y.defining||y.definingAsContext||y.isolating)break;s.indexOf(p)>-1?o=p:i.before(p)==v&&s.splice(1,0,-p)}let l=s.indexOf(o),u=[],c=n.openStart;for(let p=n.content,v=0;;v++){let y=p.firstChild;if(u.push(y),v==n.openStart)break;p=y.content}for(let p=c-1;p>=0;p--){let v=u[p],y=AY(v.type);if(y&&!v.sameMarkup(i.node(Math.abs(o)-1)))c=p;else if(y||!v.type.isTextblock)break}for(let p=n.openStart;p>=0;p--){let v=(p+c+1)%(n.openStart+1),y=u[v];if(y)for(let S=0;S<s.length;S++){let w=s[(S+l)%s.length],T=!0;w<0&&(T=!1,w=-w);let _=i.node(w-1),C=i.index(w-1);if(_.canReplaceWith(C,C,y.type,y.marks))return t.replace(i.before(w),T?a.after(w):r,new Nt(LO(n.content,0,n.openStart,v),v,n.openEnd))}}let f=t.steps.length;for(let p=s.length-1;p>=0&&(t.replace(e,r,n),!(t.steps.length>f));p--){let v=s[p];v<0||(e=i.before(v),r=a.after(v))}}function LO(t,e,r,n,i){if(e<r){let a=t.firstChild;t=t.replaceChild(0,a.copy(LO(a.content,e+1,r,n,a)))}if(e>n){let a=i.contentMatchAt(0),s=a.fillBefore(t).append(t);t=s.append(a.matchFragment(s).fillBefore(rt.empty,!0))}return t}function RY(t,e,r,n){if(!n.isInline&&e==r&&t.doc.resolve(e).parent.content.size){let i=NY(t.doc,e,n.type);i!=null&&(e=r=i)}t.replaceRange(e,r,new Nt(rt.from(n),0,0))}function OY(t,e,r){let n=t.doc.resolve(e),i=t.doc.resolve(r),a=RO(n,i);for(let s=0;s<a.length;s++){let o=a[s],l=s==a.length-1;if(l&&o==0||n.node(o).type.contentMatch.validEnd)return t.delete(n.start(o),i.end(o));if(o>0&&(l||n.node(o-1).canReplace(n.index(o-1),i.indexAfter(o-1))))return t.delete(n.before(o),i.after(o))}for(let s=1;s<=n.depth&&s<=i.depth;s++)if(e-n.start(s)==n.depth-s&&r>n.end(s)&&i.end(s)-r!=i.depth-s&&n.start(s-1)==i.start(s-1)&&n.node(s-1).canReplace(n.index(s-1),i.index(s-1)))return t.delete(n.before(s),r);t.delete(e,r)}function RO(t,e){let r=[],n=Math.min(t.depth,e.depth);for(let i=n;i>=0;i--){let a=t.start(i);if(a<t.pos-(t.depth-i)||e.end(i)>e.pos+(e.depth-i)||t.node(i).type.spec.isolating||e.node(i).type.spec.isolating)break;(a==e.start(i)||i==t.depth&&i==e.depth&&t.parent.inlineContent&&e.parent.inlineContent&&i&&e.start(i-1)==a-1)&&r.push(i)}return r}class Wp extends us{constructor(e,r,n){super(),this.pos=e,this.attr=r,this.value=n}apply(e){let r=e.nodeAt(this.pos);if(!r)return Li.fail("No node at attribute step's position");let n=Object.create(null);for(let a in r.attrs)n[a]=r.attrs[a];n[this.attr]=this.value;let i=r.type.create(n,null,r.marks);return Li.fromReplace(e,this.pos,this.pos+1,new Nt(rt.from(i),0,r.isLeaf?0:1))}getMap(){return lo.empty}invert(e){return new Wp(this.pos,this.attr,e.nodeAt(this.pos).attrs[this.attr])}map(e){let r=e.mapResult(this.pos,1);return r.deletedAfter?null:new Wp(r.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(e,r){if(typeof r.pos!="number"||typeof r.attr!="string")throw new RangeError("Invalid input for AttrStep.fromJSON");return new Wp(r.pos,r.attr,r.value)}}us.jsonID("attr",Wp);class zv extends us{constructor(e,r){super(),this.attr=e,this.value=r}apply(e){let r=Object.create(null);for(let i in e.attrs)r[i]=e.attrs[i];r[this.attr]=this.value;let n=e.type.create(r,e.content,e.marks);return Li.ok(n)}getMap(){return lo.empty}invert(e){return new zv(this.attr,e.attrs[this.attr])}map(e){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(e,r){if(typeof r.attr!="string")throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new zv(r.attr,r.value)}}us.jsonID("docAttr",zv);let Qp=class extends Error{};Qp=function t(e){let r=Error.call(this,e);return r.__proto__=t.prototype,r};Qp.prototype=Object.create(Error.prototype);Qp.prototype.constructor=Qp;Qp.prototype.name="TransformError";class OO{constructor(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new Bv}get before(){return this.docs.length?this.docs[0]:this.doc}step(e){let r=this.maybeStep(e);if(r.failed)throw new Qp(r.failed);return this}maybeStep(e){let r=e.apply(this.doc);return r.failed||this.addStep(e,r.doc),r}get docChanged(){return this.steps.length>0}changedRange(){let e=1e9,r=-1e9;for(let n=0;n<this.mapping.maps.length;n++){let i=this.mapping.maps[n];n&&(e=i.map(e,1),r=i.map(r,-1)),i.forEach((a,s,o,l)=>{e=Math.min(e,o),r=Math.max(r,l)})}return e==1e9?null:{from:e,to:r}}addStep(e,r){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=r}replace(e,r=e,n=Nt.empty){let i=Y1(this.doc,e,r,n);return i&&this.step(i),this}replaceWith(e,r,n){return this.replace(e,r,new Nt(rt.from(n),0,0))}delete(e,r){return this.replace(e,r,Nt.empty)}insert(e,r){return this.replaceWith(e,e,r)}replaceRange(e,r,n){return LY(this,e,r,n),this}replaceRangeWith(e,r,n){return RY(this,e,r,n),this}deleteRange(e,r){return OY(this,e,r),this}lift(e,r){return yY(this,e,r),this}join(e,r=1){return TY(this,e,r),this}wrap(e,r){return wY(this,e,r),this}setBlockType(e,r=e,n,i=null){return SY(this,e,r,n,i),this}setNodeMarkup(e,r,n=null,i){return _Y(this,e,r,n,i),this}setNodeAttribute(e,r,n){return this.step(new Wp(e,r,n)),this}setDocAttribute(e,r){return this.step(new zv(e,r)),this}addNodeMark(e,r){return this.step(new zd(e,r)),this}removeNodeMark(e,r){let n=this.doc.nodeAt(e);if(!n)throw new RangeError("No node at position "+e);if(r instanceof hn)r.isInSet(n.marks)&&this.step(new Ch(e,r));else{let i=n.marks,a,s=[];for(;a=r.isInSet(i);)s.push(new Ch(e,a)),i=a.removeFromSet(i);for(let o=s.length-1;o>=0;o--)this.step(s[o])}return this}split(e,r=1,n){return CY(this,e,r,n),this}addMark(e,r,n){return mY(this,e,r,n),this}removeMark(e,r,n){return gY(this,e,r,n),this}clearIncompatible(e,r,n){return Y_(this,e,r,n),this}}const aS=Object.create(null);class yr{constructor(e,r,n){this.$anchor=e,this.$head=r,this.ranges=n||[new DY(e.min(r),e.max(r))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let r=0;r<e.length;r++)if(e[r].$from.pos!=e[r].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,r=Nt.empty){let n=r.content.lastChild,i=null;for(let o=0;o<r.openEnd;o++)i=n,n=n.lastChild;let a=e.steps.length,s=this.ranges;for(let o=0;o<s.length;o++){let{$from:l,$to:u}=s[o],c=e.mapping.slice(a);e.replaceRange(c.map(l.pos),c.map(u.pos),o?Nt.empty:r),o==0&&V3(e,a,(n?n.isInline:i&&i.isTextblock)?-1:1)}}replaceWith(e,r){let n=e.steps.length,i=this.ranges;for(let a=0;a<i.length;a++){let{$from:s,$to:o}=i[a],l=e.mapping.slice(n),u=l.map(s.pos),c=l.map(o.pos);a?e.deleteRange(u,c):(e.replaceRangeWith(u,c,r),V3(e,n,r.isInline?-1:1))}}static findFrom(e,r,n=!1){let i=e.parent.inlineContent?new cr(e):Mp(e.node(0),e.parent,e.pos,e.index(),r,n);if(i)return i;for(let a=e.depth-1;a>=0;a--){let s=r<0?Mp(e.node(0),e.node(a),e.before(a+1),e.index(a),r,n):Mp(e.node(0),e.node(a),e.after(a+1),e.index(a)+1,r,n);if(s)return s}return null}static near(e,r=1){return this.findFrom(e,r)||this.findFrom(e,-r)||new co(e.node(0))}static atStart(e){return Mp(e,e,0,0,1)||new co(e)}static atEnd(e){return Mp(e,e,e.content.size,e.childCount,-1)||new co(e)}static fromJSON(e,r){if(!r||!r.type)throw new RangeError("Invalid input for Selection.fromJSON");let n=aS[r.type];if(!n)throw new RangeError(`No selection type ${r.type} defined`);return n.fromJSON(e,r)}static jsonID(e,r){if(e in aS)throw new RangeError("Duplicate use of selection JSON ID "+e);return aS[e]=r,r.prototype.jsonID=e,r}getBookmark(){return cr.between(this.$anchor,this.$head).getBookmark()}}yr.prototype.visible=!0;class DY{constructor(e,r){this.$from=e,this.$to=r}}let U3=!1;function G3(t){!U3&&!t.parent.inlineContent&&(U3=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+t.parent.type.name+")"))}class cr extends yr{constructor(e,r=e){G3(e),G3(r),super(e,r)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(e,r){let n=e.resolve(r.map(this.head));if(!n.parent.inlineContent)return yr.near(n);let i=e.resolve(r.map(this.anchor));return new cr(i.parent.inlineContent?i:n,n)}replace(e,r=Nt.empty){if(super.replace(e,r),r==Nt.empty){let n=this.$from.marksAcross(this.$to);n&&e.ensureMarks(n)}}eq(e){return e instanceof cr&&e.anchor==this.anchor&&e.head==this.head}getBookmark(){return new X1(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(e,r){if(typeof r.anchor!="number"||typeof r.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new cr(e.resolve(r.anchor),e.resolve(r.head))}static create(e,r,n=r){let i=e.resolve(r);return new this(i,n==r?i:e.resolve(n))}static between(e,r,n){let i=e.pos-r.pos;if((!n||i)&&(n=i>=0?1:-1),!r.parent.inlineContent){let a=yr.findFrom(r,n,!0)||yr.findFrom(r,-n,!0);if(a)r=a.$head;else return yr.near(r,n)}return e.parent.inlineContent||(i==0?e=r:(e=(yr.findFrom(e,-n,!0)||yr.findFrom(e,n,!0)).$anchor,e.pos<r.pos!=i<0&&(e=r))),new cr(e,r)}}yr.jsonID("text",cr);class X1{constructor(e,r){this.anchor=e,this.head=r}map(e){return new X1(e.map(this.anchor),e.map(this.head))}resolve(e){return cr.between(e.resolve(this.anchor),e.resolve(this.head))}}class Yt extends yr{constructor(e){let r=e.nodeAfter,n=e.node(0).resolve(e.pos+r.nodeSize);super(e,n),this.node=r}map(e,r){let{deleted:n,pos:i}=r.mapResult(this.anchor),a=e.resolve(i);return n?yr.near(a):new Yt(a)}content(){return new Nt(rt.from(this.node),0,0)}eq(e){return e instanceof Yt&&e.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new Q_(this.anchor)}static fromJSON(e,r){if(typeof r.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new Yt(e.resolve(r.anchor))}static create(e,r){return new Yt(e.resolve(r))}static isSelectable(e){return!e.isText&&e.type.spec.selectable!==!1}}Yt.prototype.visible=!1;yr.jsonID("node",Yt);class Q_{constructor(e){this.anchor=e}map(e){let{deleted:r,pos:n}=e.mapResult(this.anchor);return r?new X1(n,n):new Q_(n)}resolve(e){let r=e.resolve(this.anchor),n=r.nodeAfter;return n&&Yt.isSelectable(n)?new Yt(r):yr.near(r)}}class co extends yr{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,r=Nt.empty){if(r==Nt.empty){e.delete(0,e.doc.content.size);let n=yr.atStart(e.doc);n.eq(e.selection)||e.setSelection(n)}else super.replace(e,r)}toJSON(){return{type:"all"}}static fromJSON(e){return new co(e)}map(e){return new co(e)}eq(e){return e instanceof co}getBookmark(){return IY}}yr.jsonID("all",co);const IY={map(){return this},resolve(t){return new co(t)}};function Mp(t,e,r,n,i,a=!1){if(e.inlineContent)return cr.create(t,r);for(let s=n-(i>0?0:1);i>0?s<e.childCount:s>=0;s+=i){let o=e.child(s);if(o.isAtom){if(!a&&Yt.isSelectable(o))return Yt.create(t,r-(i<0?o.nodeSize:0))}else{let l=Mp(t,o,r+i,i<0?o.childCount:0,i,a);if(l)return l}r+=o.nodeSize*i}return null}function V3(t,e,r){let n=t.steps.length-1;if(n<e)return;let i=t.steps[n];if(!(i instanceof oa||i instanceof da))return;let a=t.mapping.maps[n],s;a.forEach((o,l,u,c)=>{s==null&&(s=c)}),t.setSelection(yr.near(t.doc.resolve(s),r))}const H3=1,Ey=2,W3=4;class jY extends OO{constructor(e){super(e.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=e.selection,this.storedMarks=e.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(e){if(e.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=e,this.curSelectionFor=this.steps.length,this.updated=(this.updated|H3)&~Ey,this.storedMarks=null,this}get selectionSet(){return(this.updated&H3)>0}setStoredMarks(e){return this.storedMarks=e,this.updated|=Ey,this}ensureMarks(e){return hn.sameSet(this.storedMarks||this.selection.$from.marks(),e)||this.setStoredMarks(e),this}addStoredMark(e){return this.ensureMarks(e.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(e){return this.ensureMarks(e.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(this.updated&Ey)>0}addStep(e,r){super.addStep(e,r),this.updated=this.updated&~Ey,this.storedMarks=null}setTime(e){return this.time=e,this}replaceSelection(e){return this.selection.replace(this,e),this}replaceSelectionWith(e,r=!0){let n=this.selection;return r&&(e=e.mark(this.storedMarks||(n.empty?n.$from.marks():n.$from.marksAcross(n.$to)||hn.none))),n.replaceWith(this,e),this}deleteSelection(){return this.selection.replace(this),this}insertText(e,r,n){let i=this.doc.type.schema;if(r==null)return e?this.replaceSelectionWith(i.text(e),!0):this.deleteSelection();{if(n==null&&(n=r),!e)return this.deleteRange(r,n);let a=this.storedMarks;if(!a){let s=this.doc.resolve(r);a=n==r?s.marks():s.marksAcross(this.doc.resolve(n))}return this.replaceRangeWith(r,n,i.text(e,a)),!this.selection.empty&&this.selection.to==r+e.length&&this.setSelection(yr.near(this.selection.$to)),this}}setMeta(e,r){return this.meta[typeof e=="string"?e:e.key]=r,this}getMeta(e){return this.meta[typeof e=="string"?e:e.key]}get isGeneric(){for(let e in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=W3,this}get scrolledIntoView(){return(this.updated&W3)>0}}function q3(t,e){return!e||!t?t:t.bind(e)}class tv{constructor(e,r,n){this.name=e,this.init=q3(r.init,n),this.apply=q3(r.apply,n)}}const FY=[new tv("doc",{init(t){return t.doc||t.schema.topNodeType.createAndFill()},apply(t){return t.doc}}),new tv("selection",{init(t,e){return t.selection||yr.atStart(e.doc)},apply(t){return t.selection}}),new tv("storedMarks",{init(t){return t.storedMarks||null},apply(t,e,r,n){return n.selection.$cursor?t.storedMarks:null}}),new tv("scrollToSelection",{init(){return 0},apply(t,e){return t.scrolledIntoView?e+1:e}})];class sS{constructor(e,r){this.schema=e,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=FY.slice(),r&&r.forEach(n=>{if(this.pluginsByKey[n.key])throw new RangeError("Adding different instances of a keyed plugin ("+n.key+")");this.plugins.push(n),this.pluginsByKey[n.key]=n,n.spec.state&&this.fields.push(new tv(n.key,n.spec.state,n))})}}class Fp{constructor(e){this.config=e}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(e){return this.applyTransaction(e).state}filterTransaction(e,r=-1){for(let n=0;n<this.config.plugins.length;n++)if(n!=r){let i=this.config.plugins[n];if(i.spec.filterTransaction&&!i.spec.filterTransaction.call(i,e,this))return!1}return!0}applyTransaction(e){if(!this.filterTransaction(e))return{state:this,transactions:[]};let r=[e],n=this.applyInner(e),i=null;for(;;){let a=!1;for(let s=0;s<this.config.plugins.length;s++){let o=this.config.plugins[s];if(o.spec.appendTransaction){let l=i?i[s].n:0,u=i?i[s].state:this,c=l<r.length&&o.spec.appendTransaction.call(o,l?r.slice(l):r,u,n);if(c&&n.filterTransaction(c,s)){if(c.setMeta("appendedTransaction",e),!i){i=[];for(let f=0;f<this.config.plugins.length;f++)i.push(f<s?{state:n,n:r.length}:{state:this,n:0})}r.push(c),n=n.applyInner(c),a=!0}i&&(i[s]={state:n,n:r.length})}}if(!a)return{state:n,transactions:r}}}applyInner(e){if(!e.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");let r=new Fp(this.config),n=this.config.fields;for(let i=0;i<n.length;i++){let a=n[i];r[a.name]=a.apply(e,this[a.name],this,r)}return r}get tr(){return new jY(this)}static create(e){let r=new sS(e.doc?e.doc.type.schema:e.schema,e.plugins),n=new Fp(r);for(let i=0;i<r.fields.length;i++)n[r.fields[i].name]=r.fields[i].init(e,n);return n}reconfigure(e){let r=new sS(this.schema,e.plugins),n=r.fields,i=new Fp(r);for(let a=0;a<n.length;a++){let s=n[a].name;i[s]=this.hasOwnProperty(s)?this[s]:n[a].init(e,i)}return i}toJSON(e){let r={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(r.storedMarks=this.storedMarks.map(n=>n.toJSON())),e&&typeof e=="object")for(let n in e){if(n=="doc"||n=="selection")throw new RangeError("The JSON fields `doc` and `selection` are reserved");let i=e[n],a=i.spec.state;a&&a.toJSON&&(r[n]=a.toJSON.call(i,this[i.key]))}return r}static fromJSON(e,r,n){if(!r)throw new RangeError("Invalid input for EditorState.fromJSON");if(!e.schema)throw new RangeError("Required config field 'schema' missing");let i=new sS(e.schema,e.plugins),a=new Fp(i);return i.fields.forEach(s=>{if(s.name=="doc")a.doc=Vo.fromJSON(e.schema,r.doc);else if(s.name=="selection")a.selection=yr.fromJSON(a.doc,r.selection);else if(s.name=="storedMarks")r.storedMarks&&(a.storedMarks=r.storedMarks.map(e.schema.markFromJSON));else{if(n)for(let o in n){let l=n[o],u=l.spec.state;if(l.key==s.name&&u&&u.fromJSON&&Object.prototype.hasOwnProperty.call(r,o)){a[s.name]=u.fromJSON.call(l,e,r[o],a);return}}a[s.name]=s.init(e,a)}}),a}}function DO(t,e,r){for(let n in t){let i=t[n];i instanceof Function?i=i.bind(e):n=="handleDOMEvents"&&(i=DO(i,e,{})),r[n]=i}return r}class Hn{constructor(e){this.spec=e,this.props={},e.props&&DO(e.props,this,this.props),this.key=e.key?e.key.key:IO("plugin")}getState(e){return e[this.key]}}const oS=Object.create(null);function IO(t){return t in oS?t+"$"+ ++oS[t]:(oS[t]=0,t+"$")}class xi{constructor(e="key"){this.key=IO(e)}get(e){return e.config.pluginsByKey[this.key]}getState(e){return e[this.key]}}const J_=(t,e)=>t.selection.empty?!1:(e&&e(t.tr.deleteSelection().scrollIntoView()),!0);function jO(t,e){let{$cursor:r}=t.selection;return!r||(e?!e.endOfTextblock("backward",t):r.parentOffset>0)?null:r}const FO=(t,e,r)=>{let n=jO(t,r);if(!n)return!1;let i=eC(n);if(!i){let s=n.blockRange(),o=s&&bm(s);return o==null?!1:(e&&e(t.tr.lift(s,o).scrollIntoView()),!0)}let a=i.nodeBefore;if($O(t,i,e,-1))return!0;if(n.parent.content.size==0&&(Jp(a,"end")||Yt.isSelectable(a)))for(let s=n.depth;;s--){let o=Y1(t.doc,n.before(s),n.after(s),Nt.empty);if(o&&o.slice.size<o.to-o.from){if(e){let l=t.tr.step(o);l.setSelection(Jp(a,"end")?yr.findFrom(l.doc.resolve(l.mapping.map(i.pos,-1)),-1):Yt.create(l.doc,i.pos-a.nodeSize)),e(l.scrollIntoView())}return!0}if(s==1||n.node(s-1).childCount>1)break}return a.isAtom&&i.depth==n.depth-1?(e&&e(t.tr.delete(i.pos-a.nodeSize,i.pos).scrollIntoView()),!0):!1},BY=(t,e,r)=>{let n=jO(t,r);if(!n)return!1;let i=eC(n);return i?BO(t,i,e):!1},zY=(t,e,r)=>{let n=UO(t,r);if(!n)return!1;let i=tC(n);return i?BO(t,i,e):!1};function BO(t,e,r){let n=e.nodeBefore,i=n,a=e.pos-1;for(;!i.isTextblock;a--){if(i.type.spec.isolating)return!1;let c=i.lastChild;if(!c)return!1;i=c}let s=e.nodeAfter,o=s,l=e.pos+1;for(;!o.isTextblock;l++){if(o.type.spec.isolating)return!1;let c=o.firstChild;if(!c)return!1;o=c}let u=Y1(t.doc,a,l,Nt.empty);if(!u||u.from!=a||u instanceof oa&&u.slice.size>=l-a)return!1;if(r){let c=t.tr.step(u);c.setSelection(cr.create(c.doc,a)),r(c.scrollIntoView())}return!0}function Jp(t,e,r=!1){for(let n=t;n;n=e=="start"?n.firstChild:n.lastChild){if(n.isTextblock)return!0;if(r&&n.childCount!=1)return!1}return!1}const zO=(t,e,r)=>{let{$head:n,empty:i}=t.selection,a=n;if(!i)return!1;if(n.parent.isTextblock){if(r?!r.endOfTextblock("backward",t):n.parentOffset>0)return!1;a=eC(n)}let s=a&&a.nodeBefore;return!s||!Yt.isSelectable(s)?!1:(e&&e(t.tr.setSelection(Yt.create(t.doc,a.pos-s.nodeSize)).scrollIntoView()),!0)};function eC(t){if(!t.parent.type.spec.isolating)for(let e=t.depth-1;e>=0;e--){if(t.index(e)>0)return t.doc.resolve(t.before(e+1));if(t.node(e).type.spec.isolating)break}return null}function UO(t,e){let{$cursor:r}=t.selection;return!r||(e?!e.endOfTextblock("forward",t):r.parentOffset<r.parent.content.size)?null:r}const GO=(t,e,r)=>{let n=UO(t,r);if(!n)return!1;let i=tC(n);if(!i)return!1;let a=i.nodeAfter;if($O(t,i,e,1))return!0;if(n.parent.content.size==0&&(Jp(a,"start")||Yt.isSelectable(a))){let s=Y1(t.doc,n.before(),n.after(),Nt.empty);if(s&&s.slice.size<s.to-s.from){if(e){let o=t.tr.step(s);o.setSelection(Jp(a,"start")?yr.findFrom(o.doc.resolve(o.mapping.map(i.pos)),1):Yt.create(o.doc,o.mapping.map(i.pos))),e(o.scrollIntoView())}return!0}}return a.isAtom&&i.depth==n.depth-1?(e&&e(t.tr.delete(i.pos,i.pos+a.nodeSize).scrollIntoView()),!0):!1},VO=(t,e,r)=>{let{$head:n,empty:i}=t.selection,a=n;if(!i)return!1;if(n.parent.isTextblock){if(r?!r.endOfTextblock("forward",t):n.parentOffset<n.parent.content.size)return!1;a=tC(n)}let s=a&&a.nodeAfter;return!s||!Yt.isSelectable(s)?!1:(e&&e(t.tr.setSelection(Yt.create(t.doc,a.pos)).scrollIntoView()),!0)};function tC(t){if(!t.parent.type.spec.isolating)for(let e=t.depth-1;e>=0;e--){let r=t.node(e);if(t.index(e)+1<r.childCount)return t.doc.resolve(t.after(e+1));if(r.type.spec.isolating)break}return null}const UY=(t,e)=>{let r=t.selection,n=r instanceof Yt,i;if(n){if(r.node.isTextblock||!pf(t.doc,r.from))return!1;i=r.from}else if(i=Z1(t.doc,r.from,-1),i==null)return!1;if(e){let a=t.tr.join(i);n&&a.setSelection(Yt.create(a.doc,i-t.doc.resolve(i).nodeBefore.nodeSize)),e(a.scrollIntoView())}return!0},GY=(t,e)=>{let r=t.selection,n;if(r instanceof Yt){if(r.node.isTextblock||!pf(t.doc,r.to))return!1;n=r.to}else if(n=Z1(t.doc,r.to,1),n==null)return!1;return e&&e(t.tr.join(n).scrollIntoView()),!0},VY=(t,e)=>{let{$from:r,$to:n}=t.selection,i=r.blockRange(n),a=i&&bm(i);return a==null?!1:(e&&e(t.tr.lift(i,a).scrollIntoView()),!0)},HO=(t,e)=>{let{$head:r,$anchor:n}=t.selection;return!r.parent.type.spec.code||!r.sameParent(n)?!1:(e&&e(t.tr.insertText(`
`).scrollIntoView()),!0)};function rC(t){for(let e=0;e<t.edgeCount;e++){let{type:r}=t.edge(e);if(r.isTextblock&&!r.hasRequiredAttrs())return r}return null}const HY=(t,e)=>{let{$head:r,$anchor:n}=t.selection;if(!r.parent.type.spec.code||!r.sameParent(n))return!1;let i=r.node(-1),a=r.indexAfter(-1),s=rC(i.contentMatchAt(a));if(!s||!i.canReplaceWith(a,a,s))return!1;if(e){let o=r.after(),l=t.tr.replaceWith(o,o,s.createAndFill());l.setSelection(yr.near(l.doc.resolve(o),1)),e(l.scrollIntoView())}return!0},WO=(t,e)=>{let r=t.selection,{$from:n,$to:i}=r;if(r instanceof co||n.parent.inlineContent||i.parent.inlineContent)return!1;let a=rC(i.parent.contentMatchAt(i.indexAfter()));if(!a||!a.isTextblock)return!1;if(e){let s=(!n.parentOffset&&i.index()<i.parent.childCount?n:i).pos,o=t.tr.insert(s,a.createAndFill());o.setSelection(cr.create(o.doc,s+1)),e(o.scrollIntoView())}return!0},qO=(t,e)=>{let{$cursor:r}=t.selection;if(!r||r.parent.content.size)return!1;if(r.depth>1&&r.after()!=r.end(-1)){let a=r.before();if(gc(t.doc,a))return e&&e(t.tr.split(a).scrollIntoView()),!0}let n=r.blockRange(),i=n&&bm(n);return i==null?!1:(e&&e(t.tr.lift(n,i).scrollIntoView()),!0)};function WY(t){return(e,r)=>{let{$from:n,$to:i}=e.selection;if(e.selection instanceof Yt&&e.selection.node.isBlock)return!n.parentOffset||!gc(e.doc,n.pos)?!1:(r&&r(e.tr.split(n.pos).scrollIntoView()),!0);if(!n.depth)return!1;let a=[],s,o,l=!1,u=!1;for(let v=n.depth;;v--)if(n.node(v).isBlock){l=n.end(v)==n.pos+(n.depth-v),u=n.start(v)==n.pos-(n.depth-v),o=rC(n.node(v-1).contentMatchAt(n.indexAfter(v-1))),a.unshift(l&&o?{type:o}:null),s=v;break}else{if(v==1)return!1;a.unshift(null)}let c=e.tr;(e.selection instanceof cr||e.selection instanceof co)&&c.deleteSelection();let f=c.mapping.map(n.pos),p=gc(c.doc,f,a.length,a);if(p||(a[0]=o?{type:o}:null,p=gc(c.doc,f,a.length,a)),!p)return!1;if(c.split(f,a.length,a),!l&&u&&n.node(s).type!=o){let v=c.mapping.map(n.before(s)),y=c.doc.resolve(v);o&&n.node(s-1).canReplaceWith(y.index(),y.index()+1,o)&&c.setNodeMarkup(c.mapping.map(n.before(s)),o)}return r&&r(c.scrollIntoView()),!0}}const qY=WY(),$Y=(t,e)=>{let{$from:r,to:n}=t.selection,i,a=r.sharedDepth(n);return a==0?!1:(i=r.before(a),e&&e(t.tr.setSelection(Yt.create(t.doc,i))),!0)};function KY(t,e,r){let n=e.nodeBefore,i=e.nodeAfter,a=e.index();return!n||!i||!n.type.compatibleContent(i.type)?!1:!n.content.size&&e.parent.canReplace(a-1,a)?(r&&r(t.tr.delete(e.pos-n.nodeSize,e.pos).scrollIntoView()),!0):!e.parent.canReplace(a,a+1)||!(i.isTextblock||pf(t.doc,e.pos))?!1:(r&&r(t.tr.join(e.pos).scrollIntoView()),!0)}function $O(t,e,r,n){let i=e.nodeBefore,a=e.nodeAfter,s,o,l=i.type.spec.isolating||a.type.spec.isolating;if(!l&&KY(t,e,r))return!0;let u=!l&&e.parent.canReplace(e.index(),e.index()+1);if(u&&(s=(o=i.contentMatchAt(i.childCount)).findWrapping(a.type))&&o.matchType(s[0]||a.type).validEnd){if(r){let v=e.pos+a.nodeSize,y=rt.empty;for(let T=s.length-1;T>=0;T--)y=rt.from(s[T].create(null,y));y=rt.from(i.copy(y));let S=t.tr.step(new da(e.pos-1,v,e.pos,v,new Nt(y,1,0),s.length,!0)),w=S.doc.resolve(v+2*s.length);w.nodeAfter&&w.nodeAfter.type==i.type&&pf(S.doc,w.pos)&&S.join(w.pos),r(S.scrollIntoView())}return!0}let c=a.type.spec.isolating||n>0&&l?null:yr.findFrom(e,1),f=c&&c.$from.blockRange(c.$to),p=f&&bm(f);if(p!=null&&p>=e.depth)return r&&r(t.tr.lift(f,p).scrollIntoView()),!0;if(u&&Jp(a,"start",!0)&&Jp(i,"end")){let v=i,y=[];for(;y.push(v),!v.isTextblock;)v=v.lastChild;let S=a,w=1;for(;!S.isTextblock;S=S.firstChild)w++;if(v.canReplace(v.childCount,v.childCount,S.content)){if(r){let T=rt.empty;for(let C=y.length-1;C>=0;C--)T=rt.from(y[C].copy(T));let _=t.tr.step(new da(e.pos-y.length,e.pos+a.nodeSize,e.pos+w,e.pos+a.nodeSize-w,new Nt(T,y.length,0),0,!0));r(_.scrollIntoView())}return!0}}return!1}function KO(t){return function(e,r){let n=e.selection,i=t<0?n.$from:n.$to,a=i.depth;for(;i.node(a).isInline;){if(!a)return!1;a--}return i.node(a).isTextblock?(r&&r(e.tr.setSelection(cr.create(e.doc,t<0?i.start(a):i.end(a)))),!0):!1}}const ZY=KO(-1),YY=KO(1);function XY(t,e=null){return function(r,n){let{$from:i,$to:a}=r.selection,s=i.blockRange(a),o=s&&X_(s,t,e);return o?(n&&n(r.tr.wrap(s,o).scrollIntoView()),!0):!1}}function $3(t,e=null){return function(r,n){let i=!1;for(let a=0;a<r.selection.ranges.length&&!i;a++){let{$from:{pos:s},$to:{pos:o}}=r.selection.ranges[a];r.doc.nodesBetween(s,o,(l,u)=>{if(i)return!1;if(!(!l.isTextblock||l.hasMarkup(t,e)))if(l.type==t)i=!0;else{let c=r.doc.resolve(u),f=c.index();i=c.parent.canReplaceWith(f,f+1,t)}})}if(!i)return!1;if(n){let a=r.tr;for(let s=0;s<r.selection.ranges.length;s++){let{$from:{pos:o},$to:{pos:l}}=r.selection.ranges[s];a.setBlockType(o,l,t,e)}n(a.scrollIntoView())}return!0}}function nC(...t){return function(e,r,n){for(let i=0;i<t.length;i++)if(t[i](e,r,n))return!0;return!1}}nC(J_,FO,zO);nC(J_,GO,VO);nC(HO,WO,qO,qY);typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):typeof os<"u"&&os.platform&&os.platform()=="darwin";function QY(t,e=null){return function(r,n){let{$from:i,$to:a}=r.selection,s=i.blockRange(a);if(!s)return!1;let o=n?r.tr:null;return JY(o,s,t,e)?(n&&n(o.scrollIntoView()),!0):!1}}function JY(t,e,r,n=null){let i=!1,a=e,s=e.$from.doc;if(e.depth>=2&&e.$from.node(e.depth-1).type.compatibleContent(r)&&e.startIndex==0){if(e.$from.index(e.depth-1)==0)return!1;let l=s.resolve(e.start-2);a=new Ax(l,l,e.depth),e.endIndex<e.parent.childCount&&(e=new Ax(e.$from,s.resolve(e.$to.end(e.depth)),e.depth)),i=!0}let o=X_(a,r,n,e);return o?(t&&eX(t,e,o,i,r),!0):!1}function eX(t,e,r,n,i){let a=rt.empty;for(let c=r.length-1;c>=0;c--)a=rt.from(r[c].type.create(r[c].attrs,a));t.step(new da(e.start-(n?2:0),e.end,e.start,e.end,new Nt(a,0,0),r.length,!0));let s=0;for(let c=0;c<r.length;c++)r[c].type==i&&(s=c+1);let o=r.length-s,l=e.start+r.length-(n?2:0),u=e.parent;for(let c=e.startIndex,f=e.endIndex,p=!0;c<f;c++,p=!1)!p&&gc(t.doc,l,o)&&(t.split(l,o),l+=2*o),l+=u.child(c).nodeSize;return t}function tX(t){return function(e,r){let{$from:n,$to:i}=e.selection,a=n.blockRange(i,s=>s.childCount>0&&s.firstChild.type==t);return a?r?n.node(a.depth-1).type==t?rX(e,r,t,a):nX(e,r,a):!0:!1}}function rX(t,e,r,n){let i=t.tr,a=n.end,s=n.$to.end(n.depth);a<s&&(i.step(new da(a-1,s,a,s,new Nt(rt.from(r.create(null,n.parent.copy())),1,0),1,!0)),n=new Ax(i.doc.resolve(n.$from.pos),i.doc.resolve(s),n.depth));const o=bm(n);if(o==null)return!1;i.lift(n,o);let l=i.doc.resolve(i.mapping.map(a,-1)-1);return pf(i.doc,l.pos)&&l.nodeBefore.type==l.nodeAfter.type&&i.join(l.pos),e(i.scrollIntoView()),!0}function nX(t,e,r){let n=t.tr,i=r.parent;for(let v=r.end,y=r.endIndex-1,S=r.startIndex;y>S;y--)v-=i.child(y).nodeSize,n.delete(v-1,v+1);let a=n.doc.resolve(r.start),s=a.nodeAfter;if(n.mapping.map(r.end)!=r.start+a.nodeAfter.nodeSize)return!1;let o=r.startIndex==0,l=r.endIndex==i.childCount,u=a.node(-1),c=a.index(-1);if(!u.canReplace(c+(o?0:1),c+1,s.content.append(l?rt.empty:rt.from(i))))return!1;let f=a.pos,p=f+s.nodeSize;return n.step(new da(f-(o?1:0),p+(l?1:0),f+1,p-1,new Nt((o?rt.empty:rt.from(i.copy(rt.empty))).append(l?rt.empty:rt.from(i.copy(rt.empty))),o?0:1,l?0:1),o?0:1)),e(n.scrollIntoView()),!0}function iX(t){return function(e,r){let{$from:n,$to:i}=e.selection,a=n.blockRange(i,u=>u.childCount>0&&u.firstChild.type==t);if(!a)return!1;let s=a.startIndex;if(s==0)return!1;let o=a.parent,l=o.child(s-1);if(l.type!=t)return!1;if(r){let u=l.lastChild&&l.lastChild.type==o.type,c=rt.from(u?t.create():null),f=new Nt(rt.from(t.create(null,rt.from(o.type.create(null,c)))),u?3:1,0),p=a.start,v=a.end;r(e.tr.step(new da(p-(u?3:1),v,p,v,f,1,!0)).scrollIntoView())}return!0}}const Da=function(t){for(var e=0;;e++)if(t=t.previousSibling,!t)return e},em=function(t){let e=t.assignedSlot||t.parentNode;return e&&e.nodeType==11?e.host:e};let kk=null;const cc=function(t,e,r){let n=kk||(kk=document.createRange());return n.setEnd(t,r??t.nodeValue.length),n.setStart(t,e||0),n},aX=function(){kk=null},Eh=function(t,e,r,n){return r&&(K3(t,e,r,n,-1)||K3(t,e,r,n,1))},sX=/^(img|br|input|textarea|hr)$/i;function K3(t,e,r,n,i){for(var a;;){if(t==r&&e==n)return!0;if(e==(i<0?0:Uo(t))){let s=t.parentNode;if(!s||s.nodeType!=1||m0(t)||sX.test(t.nodeName)||t.contentEditable=="false")return!1;e=Da(t)+(i<0?0:1),t=s}else if(t.nodeType==1){let s=t.childNodes[e+(i<0?-1:0)];if(s.nodeType==1&&s.contentEditable=="false")if(!((a=s.pmViewDesc)===null||a===void 0)&&a.ignoreForSelection)e+=i;else return!1;else t=s,e=i<0?Uo(t):0}else return!1}}function Uo(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}function oX(t,e){for(;;){if(t.nodeType==3&&e)return t;if(t.nodeType==1&&e>0){if(t.contentEditable=="false")return null;t=t.childNodes[e-1],e=Uo(t)}else if(t.parentNode&&!m0(t))e=Da(t),t=t.parentNode;else return null}}function lX(t,e){for(;;){if(t.nodeType==3&&e<t.nodeValue.length)return t;if(t.nodeType==1&&e<t.childNodes.length){if(t.contentEditable=="false")return null;t=t.childNodes[e],e=0}else if(t.parentNode&&!m0(t))e=Da(t)+1,t=t.parentNode;else return null}}function uX(t,e,r){for(let n=e==0,i=e==Uo(t);n||i;){if(t==r)return!0;let a=Da(t);if(t=t.parentNode,!t)return!1;n=n&&a==0,i=i&&a==Uo(t)}}function m0(t){let e;for(let r=t;r&&!(e=r.pmViewDesc);r=r.parentNode);return e&&e.node&&e.node.isBlock&&(e.dom==t||e.contentDOM==t)}const Q1=function(t){return t.focusNode&&Eh(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset)};function nh(t,e){let r=document.createEvent("Event");return r.initEvent("keydown",!0,!0),r.keyCode=t,r.key=r.code=e,r}function cX(t){let e=t.activeElement;for(;e&&e.shadowRoot;)e=e.shadowRoot.activeElement;return e}function dX(t,e,r){if(t.caretPositionFromPoint)try{let n=t.caretPositionFromPoint(e,r);if(n)return{node:n.offsetNode,offset:Math.min(Uo(n.offsetNode),n.offset)}}catch{}if(t.caretRangeFromPoint){let n=t.caretRangeFromPoint(e,r);if(n)return{node:n.startContainer,offset:Math.min(Uo(n.startContainer),n.startOffset)}}}const Cu=typeof navigator<"u"?navigator:null,Z3=typeof document<"u"?document:null,mf=Cu&&Cu.userAgent||"",_k=/Edge\/(\d+)/.exec(mf),ZO=/MSIE \d/.exec(mf),Ck=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(mf),qs=!!(ZO||Ck||_k),Kd=ZO?document.documentMode:Ck?+Ck[1]:_k?+_k[1]:0,Ho=!qs&&/gecko\/(\d+)/i.test(mf);Ho&&+(/Firefox\/(\d+)/.exec(mf)||[0,0])[1];const Ek=!qs&&/Chrome\/(\d+)/.exec(mf),ua=!!Ek,YO=Ek?+Ek[1]:0,Ba=!qs&&!!Cu&&/Apple Computer/.test(Cu.vendor),tm=Ba&&(/Mobile\/\w+/.test(mf)||!!Cu&&Cu.maxTouchPoints>2),Bo=tm||(Cu?/Mac/.test(Cu.platform):!1),XO=Cu?/Win/.test(Cu.platform):!1,pc=/Android \d/.test(mf),g0=!!Z3&&"webkitFontSmoothing"in Z3.documentElement.style,fX=g0?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function hX(t){let e=t.defaultView&&t.defaultView.visualViewport;return e?{left:0,right:e.width,top:0,bottom:e.height}:{left:0,right:t.documentElement.clientWidth,top:0,bottom:t.documentElement.clientHeight}}function sc(t,e){return typeof t=="number"?t:t[e]}function pX(t){let e=t.getBoundingClientRect(),r=e.width/t.offsetWidth||1,n=e.height/t.offsetHeight||1;return{left:e.left,right:e.left+t.clientWidth*r,top:e.top,bottom:e.top+t.clientHeight*n}}function Y3(t,e,r){let n=t.someProp("scrollThreshold")||0,i=t.someProp("scrollMargin")||5,a=t.dom.ownerDocument;for(let s=r||t.dom;s;){if(s.nodeType!=1){s=em(s);continue}let o=s,l=o==a.body,u=l?hX(a):pX(o),c=0,f=0;if(e.top<u.top+sc(n,"top")?f=-(u.top-e.top+sc(i,"top")):e.bottom>u.bottom-sc(n,"bottom")&&(f=e.bottom-e.top>u.bottom-u.top?e.top+sc(i,"top")-u.top:e.bottom-u.bottom+sc(i,"bottom")),e.left<u.left+sc(n,"left")?c=-(u.left-e.left+sc(i,"left")):e.right>u.right-sc(n,"right")&&(c=e.right-u.right+sc(i,"right")),c||f)if(l)a.defaultView.scrollBy(c,f);else{let v=o.scrollLeft,y=o.scrollTop;f&&(o.scrollTop+=f),c&&(o.scrollLeft+=c);let S=o.scrollLeft-v,w=o.scrollTop-y;e={left:e.left-S,top:e.top-w,right:e.right-S,bottom:e.bottom-w}}let p=l?"fixed":getComputedStyle(s).position;if(/^(fixed|sticky)$/.test(p))break;s=p=="absolute"?s.offsetParent:em(s)}}function mX(t){let e=t.dom.getBoundingClientRect(),r=Math.max(0,e.top),n,i;for(let a=(e.left+e.right)/2,s=r+1;s<Math.min(innerHeight,e.bottom);s+=5){let o=t.root.elementFromPoint(a,s);if(!o||o==t.dom||!t.dom.contains(o))continue;let l=o.getBoundingClientRect();if(l.top>=r-20){n=o,i=l.top;break}}return{refDOM:n,refTop:i,stack:QO(t.dom)}}function QO(t){let e=[],r=t.ownerDocument;for(let n=t;n&&(e.push({dom:n,top:n.scrollTop,left:n.scrollLeft}),t!=r);n=em(n));return e}function gX({refDOM:t,refTop:e,stack:r}){let n=t?t.getBoundingClientRect().top:0;JO(r,n==0?0:n-e)}function JO(t,e){for(let r=0;r<t.length;r++){let{dom:n,top:i,left:a}=t[r];n.scrollTop!=i+e&&(n.scrollTop=i+e),n.scrollLeft!=a&&(n.scrollLeft=a)}}let Ep=null;function vX(t){if(t.setActive)return t.setActive();if(Ep)return t.focus(Ep);let e=QO(t);t.focus(Ep==null?{get preventScroll(){return Ep={preventScroll:!0},!0}}:void 0),Ep||(Ep=!1,JO(e,0))}function e6(t,e){let r,n=2e8,i,a=0,s=e.top,o=e.top,l,u;for(let c=t.firstChild,f=0;c;c=c.nextSibling,f++){let p;if(c.nodeType==1)p=c.getClientRects();else if(c.nodeType==3)p=cc(c).getClientRects();else continue;for(let v=0;v<p.length;v++){let y=p[v];if(y.top<=s&&y.bottom>=o){s=Math.max(y.bottom,s),o=Math.min(y.top,o);let S=y.left>e.left?y.left-e.left:y.right<e.left?e.left-y.right:0;if(S<n){r=c,n=S,i=S&&r.nodeType==3?{left:y.right<e.left?y.right:y.left,top:e.top}:e,c.nodeType==1&&S&&(a=f+(e.left>=(y.left+y.right)/2?1:0));continue}}else y.top>e.top&&!l&&y.left<=e.left&&y.right>=e.left&&(l=c,u={left:Math.max(y.left,Math.min(y.right,e.left)),top:y.top});!r&&(e.left>=y.right&&e.top>=y.top||e.left>=y.left&&e.top>=y.bottom)&&(a=f+1)}}return!r&&l&&(r=l,i=u,n=0),r&&r.nodeType==3?yX(r,i):!r||n&&r.nodeType==1?{node:t,offset:a}:e6(r,i)}function yX(t,e){let r=t.nodeValue.length,n=document.createRange(),i;for(let a=0;a<r;a++){n.setEnd(t,a+1),n.setStart(t,a);let s=Td(n,1);if(s.top!=s.bottom&&iC(e,s)){i={node:t,offset:a+(e.left>=(s.left+s.right)/2?1:0)};break}}return n.detach(),i||{node:t,offset:0}}function iC(t,e){return t.left>=e.left-1&&t.left<=e.right+1&&t.top>=e.top-1&&t.top<=e.bottom+1}function xX(t,e){let r=t.parentNode;return r&&/^li$/i.test(r.nodeName)&&e.left<t.getBoundingClientRect().left?r:t}function bX(t,e,r){let{node:n,offset:i}=e6(e,r),a=-1;if(n.nodeType==1&&!n.firstChild){let s=n.getBoundingClientRect();a=s.left!=s.right&&r.left>(s.left+s.right)/2?1:-1}return t.docView.posFromDOM(n,i,a)}function wX(t,e,r,n){let i=-1;for(let a=e,s=!1;a!=t.dom;){let o=t.docView.nearestDesc(a,!0),l;if(!o)return null;if(o.dom.nodeType==1&&(o.node.isBlock&&o.parent||!o.contentDOM)&&((l=o.dom.getBoundingClientRect()).width||l.height)&&(o.node.isBlock&&o.parent&&!/^T(R|BODY|HEAD|FOOT)$/.test(o.dom.nodeName)&&(!s&&l.left>n.left||l.top>n.top?i=o.posBefore:(!s&&l.right<n.left||l.bottom<n.top)&&(i=o.posAfter),s=!0),!o.contentDOM&&i<0&&!o.node.isText))return(o.node.isBlock?n.top<(l.top+l.bottom)/2:n.left<(l.left+l.right)/2)?o.posBefore:o.posAfter;a=o.dom.parentNode}return i>-1?i:t.docView.posFromDOM(e,r,-1)}function t6(t,e,r){let n=t.childNodes.length;if(n&&r.top<r.bottom)for(let i=Math.max(0,Math.min(n-1,Math.floor(n*(e.top-r.top)/(r.bottom-r.top))-2)),a=i;;){let s=t.childNodes[a];if(s.nodeType==1){let o=s.getClientRects();for(let l=0;l<o.length;l++){let u=o[l];if(iC(e,u))return t6(s,e,u)}}if((a=(a+1)%n)==i)break}return t}function SX(t,e){let r=t.dom.ownerDocument,n,i=0,a=dX(r,e.left,e.top);a&&({node:n,offset:i}=a);let s=(t.root.elementFromPoint?t.root:r).elementFromPoint(e.left,e.top),o;if(!s||!t.dom.contains(s.nodeType!=1?s.parentNode:s)){let u=t.dom.getBoundingClientRect();if(!iC(e,u)||(s=t6(t.dom,e,u),!s))return null}if(Ba)for(let u=s;n&&u;u=em(u))u.draggable&&(n=void 0);if(s=xX(s,e),n){if(Ho&&n.nodeType==1&&(i=Math.min(i,n.childNodes.length),i<n.childNodes.length)){let c=n.childNodes[i],f;c.nodeName=="IMG"&&(f=c.getBoundingClientRect()).right<=e.left&&f.bottom>e.top&&i++}let u;g0&&i&&n.nodeType==1&&(u=n.childNodes[i-1]).nodeType==1&&u.contentEditable=="false"&&u.getBoundingClientRect().top>=e.top&&i--,n==t.dom&&i==n.childNodes.length-1&&n.lastChild.nodeType==1&&e.top>n.lastChild.getBoundingClientRect().bottom?o=t.state.doc.content.size:(i==0||n.nodeType!=1||n.childNodes[i-1].nodeName!="BR")&&(o=wX(t,n,i,e))}o==null&&(o=bX(t,s,e));let l=t.docView.nearestDesc(s,!0);return{pos:o,inside:l?l.posAtStart-l.border:-1}}function X3(t){return t.top<t.bottom||t.left<t.right}function Td(t,e){let r=t.getClientRects();if(r.length){let n=r[e<0?0:r.length-1];if(X3(n))return n}return Array.prototype.find.call(r,X3)||t.getBoundingClientRect()}const kX=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function r6(t,e,r){let{node:n,offset:i,atom:a}=t.docView.domFromPos(e,r<0?-1:1),s=g0||Ho;if(n.nodeType==3)if(s&&(kX.test(n.nodeValue)||(r<0?!i:i==n.nodeValue.length))){let l=Td(cc(n,i,i),r);if(Ho&&i&&/\s/.test(n.nodeValue[i-1])&&i<n.nodeValue.length){let u=Td(cc(n,i-1,i-1),-1);if(u.top==l.top){let c=Td(cc(n,i,i+1),-1);if(c.top!=l.top)return Vg(c,c.left<u.left)}}return l}else{let l=i,u=i,c=r<0?1:-1;return r<0&&!i?(u++,c=-1):r>=0&&i==n.nodeValue.length?(l--,c=1):r<0?l--:u++,Vg(Td(cc(n,l,u),c),c<0)}if(!t.state.doc.resolve(e-(a||0)).parent.inlineContent){if(a==null&&i&&(r<0||i==Uo(n))){let l=n.childNodes[i-1];if(l.nodeType==1)return lS(l.getBoundingClientRect(),!1)}if(a==null&&i<Uo(n)){let l=n.childNodes[i];if(l.nodeType==1)return lS(l.getBoundingClientRect(),!0)}return lS(n.getBoundingClientRect(),r>=0)}if(a==null&&i&&(r<0||i==Uo(n))){let l=n.childNodes[i-1],u=l.nodeType==3?cc(l,Uo(l)-(s?0:1)):l.nodeType==1&&(l.nodeName!="BR"||!l.nextSibling)?l:null;if(u)return Vg(Td(u,1),!1)}if(a==null&&i<Uo(n)){let l=n.childNodes[i];for(;l.pmViewDesc&&l.pmViewDesc.ignoreForCoords;)l=l.nextSibling;let u=l?l.nodeType==3?cc(l,0,s?0:1):l.nodeType==1?l:null:null;if(u)return Vg(Td(u,-1),!0)}return Vg(Td(n.nodeType==3?cc(n):n,-r),r>=0)}function Vg(t,e){if(t.width==0)return t;let r=e?t.left:t.right;return{top:t.top,bottom:t.bottom,left:r,right:r}}function lS(t,e){if(t.height==0)return t;let r=e?t.top:t.bottom;return{top:r,bottom:r,left:t.left,right:t.right}}function n6(t,e,r){let n=t.state,i=t.root.activeElement;n!=e&&t.updateState(e),i!=t.dom&&t.focus();try{return r()}finally{n!=e&&t.updateState(n),i!=t.dom&&i&&i.focus()}}function _X(t,e,r){let n=e.selection,i=r=="up"?n.$from:n.$to;return n6(t,e,()=>{let{node:a}=t.docView.domFromPos(i.pos,r=="up"?-1:1);for(;;){let o=t.docView.nearestDesc(a,!0);if(!o)break;if(o.node.isBlock){a=o.contentDOM||o.dom;break}a=o.dom.parentNode}let s=r6(t,i.pos,1);for(let o=a.firstChild;o;o=o.nextSibling){let l;if(o.nodeType==1)l=o.getClientRects();else if(o.nodeType==3)l=cc(o,0,o.nodeValue.length).getClientRects();else continue;for(let u=0;u<l.length;u++){let c=l[u];if(c.bottom>c.top+1&&(r=="up"?s.top-c.top>(c.bottom-s.top)*2:c.bottom-s.bottom>(s.bottom-c.top)*2))return!1}}return!0})}const CX=/[\u0590-\u08ac]/;function EX(t,e,r){let{$head:n}=e.selection;if(!n.parent.isTextblock)return!1;let i=n.parentOffset,a=!i,s=i==n.parent.content.size,o=t.domSelection();return o?!CX.test(n.parent.textContent)||!o.modify?r=="left"||r=="backward"?a:s:n6(t,e,()=>{let{focusNode:l,focusOffset:u,anchorNode:c,anchorOffset:f}=t.domSelectionRange(),p=o.caretBidiLevel;o.modify("move",r,"character");let v=n.depth?t.docView.domAfterPos(n.before()):t.dom,{focusNode:y,focusOffset:S}=t.domSelectionRange(),w=y&&!v.contains(y.nodeType==1?y:y.parentNode)||l==y&&u==S;try{o.collapse(c,f),l&&(l!=c||u!=f)&&o.extend&&o.extend(l,u)}catch{}return p!=null&&(o.caretBidiLevel=p),w}):n.pos==n.start()||n.pos==n.end()}let Q3=null,J3=null,eP=!1;function TX(t,e,r){return Q3==e&&J3==r?eP:(Q3=e,J3=r,eP=r=="up"||r=="down"?_X(t,e,r):EX(t,e,r))}const Wo=0,tP=1,ah=2,Eu=3;class v0{constructor(e,r,n,i){this.parent=e,this.children=r,this.dom=n,this.contentDOM=i,this.dirty=Wo,n.pmViewDesc=this}matchesWidget(e){return!1}matchesMark(e){return!1}matchesNode(e,r,n){return!1}matchesHack(e){return!1}parseRule(){return null}stopEvent(e){return!1}get size(){let e=0;for(let r=0;r<this.children.length;r++)e+=this.children[r].size;return e}get border(){return 0}destroy(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(let e=0;e<this.children.length;e++)this.children[e].destroy()}posBeforeChild(e){for(let r=0,n=this.posAtStart;;r++){let i=this.children[r];if(i==e)return n;n+=i.size}}get posBefore(){return this.parent.posBeforeChild(this)}get posAtStart(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}get posAfter(){return this.posBefore+this.size}get posAtEnd(){return this.posAtStart+this.size-2*this.border}localPosFromDOM(e,r,n){if(this.contentDOM&&this.contentDOM.contains(e.nodeType==1?e:e.parentNode))if(n<0){let a,s;if(e==this.contentDOM)a=e.childNodes[r-1];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;a=e.previousSibling}for(;a&&!((s=a.pmViewDesc)&&s.parent==this);)a=a.previousSibling;return a?this.posBeforeChild(s)+s.size:this.posAtStart}else{let a,s;if(e==this.contentDOM)a=e.childNodes[r];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;a=e.nextSibling}for(;a&&!((s=a.pmViewDesc)&&s.parent==this);)a=a.nextSibling;return a?this.posBeforeChild(s):this.posAtEnd}let i;if(e==this.dom&&this.contentDOM)i=r>Da(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))i=e.compareDocumentPosition(this.contentDOM)&2;else if(this.dom.firstChild){if(r==0)for(let a=e;;a=a.parentNode){if(a==this.dom){i=!1;break}if(a.previousSibling)break}if(i==null&&r==e.childNodes.length)for(let a=e;;a=a.parentNode){if(a==this.dom){i=!0;break}if(a.nextSibling)break}}return i??n>0?this.posAtEnd:this.posAtStart}nearestDesc(e,r=!1){for(let n=!0,i=e;i;i=i.parentNode){let a=this.getDesc(i),s;if(a&&(!r||a.node))if(n&&(s=a.nodeDOM)&&!(s.nodeType==1?s.contains(e.nodeType==1?e:e.parentNode):s==e))n=!1;else return a}}getDesc(e){let r=e.pmViewDesc;for(let n=r;n;n=n.parent)if(n==this)return r}posFromDOM(e,r,n){for(let i=e;i;i=i.parentNode){let a=this.getDesc(i);if(a)return a.localPosFromDOM(e,r,n)}return-1}descAt(e){for(let r=0,n=0;r<this.children.length;r++){let i=this.children[r],a=n+i.size;if(n==e&&a!=n){for(;!i.border&&i.children.length;)for(let s=0;s<i.children.length;s++){let o=i.children[s];if(o.size){i=o;break}}return i}if(e<a)return i.descAt(e-n-i.border);n=a}}domFromPos(e,r){if(!this.contentDOM)return{node:this.dom,offset:0,atom:e+1};let n=0,i=0;for(let a=0;n<this.children.length;n++){let s=this.children[n],o=a+s.size;if(o>e||s instanceof a6){i=e-a;break}a=o}if(i)return this.children[n].domFromPos(i-this.children[n].border,r);for(let a;n&&!(a=this.children[n-1]).size&&a instanceof i6&&a.side>=0;n--);if(r<=0){let a,s=!0;for(;a=n?this.children[n-1]:null,!(!a||a.dom.parentNode==this.contentDOM);n--,s=!1);return a&&r&&s&&!a.border&&!a.domAtom?a.domFromPos(a.size,r):{node:this.contentDOM,offset:a?Da(a.dom)+1:0}}else{let a,s=!0;for(;a=n<this.children.length?this.children[n]:null,!(!a||a.dom.parentNode==this.contentDOM);n++,s=!1);return a&&s&&!a.border&&!a.domAtom?a.domFromPos(0,r):{node:this.contentDOM,offset:a?Da(a.dom):this.contentDOM.childNodes.length}}}parseRange(e,r,n=0){if(this.children.length==0)return{node:this.contentDOM,from:e,to:r,fromOffset:0,toOffset:this.contentDOM.childNodes.length};let i=-1,a=-1;for(let s=n,o=0;;o++){let l=this.children[o],u=s+l.size;if(i==-1&&e<=u){let c=s+l.border;if(e>=c&&r<=u-l.border&&l.node&&l.contentDOM&&this.contentDOM.contains(l.contentDOM))return l.parseRange(e,r,c);e=s;for(let f=o;f>0;f--){let p=this.children[f-1];if(p.size&&p.dom.parentNode==this.contentDOM&&!p.emptyChildAt(1)){i=Da(p.dom)+1;break}e-=p.size}i==-1&&(i=0)}if(i>-1&&(u>r||o==this.children.length-1)){r=u;for(let c=o+1;c<this.children.length;c++){let f=this.children[c];if(f.size&&f.dom.parentNode==this.contentDOM&&!f.emptyChildAt(-1)){a=Da(f.dom);break}r+=f.size}a==-1&&(a=this.contentDOM.childNodes.length);break}s=u}return{node:this.contentDOM,from:e,to:r,fromOffset:i,toOffset:a}}emptyChildAt(e){if(this.border||!this.contentDOM||!this.children.length)return!1;let r=this.children[e<0?0:this.children.length-1];return r.size==0||r.emptyChildAt(e)}domAfterPos(e){let{node:r,offset:n}=this.domFromPos(e,0);if(r.nodeType!=1||n==r.childNodes.length)throw new RangeError("No node after pos "+e);return r.childNodes[n]}setSelection(e,r,n,i=!1){let a=Math.min(e,r),s=Math.max(e,r);for(let v=0,y=0;v<this.children.length;v++){let S=this.children[v],w=y+S.size;if(a>y&&s<w)return S.setSelection(e-y-S.border,r-y-S.border,n,i);y=w}let o=this.domFromPos(e,e?-1:1),l=r==e?o:this.domFromPos(r,r?-1:1),u=n.root.getSelection(),c=n.domSelectionRange(),f=!1;if((Ho||Ba)&&e==r){let{node:v,offset:y}=o;if(v.nodeType==3){if(f=!!(y&&v.nodeValue[y-1]==`
`),f&&y==v.nodeValue.length)for(let S=v,w;S;S=S.parentNode){if(w=S.nextSibling){w.nodeName=="BR"&&(o=l={node:w.parentNode,offset:Da(w)+1});break}let T=S.pmViewDesc;if(T&&T.node&&T.node.isBlock)break}}else{let S=v.childNodes[y-1];f=S&&(S.nodeName=="BR"||S.contentEditable=="false")}}if(Ho&&c.focusNode&&c.focusNode!=l.node&&c.focusNode.nodeType==1){let v=c.focusNode.childNodes[c.focusOffset];v&&v.contentEditable=="false"&&(i=!0)}if(!(i||f&&Ba)&&Eh(o.node,o.offset,c.anchorNode,c.anchorOffset)&&Eh(l.node,l.offset,c.focusNode,c.focusOffset))return;let p=!1;if((u.extend||e==r)&&!(f&&Ho)){u.collapse(o.node,o.offset);try{e!=r&&u.extend(l.node,l.offset),p=!0}catch{}}if(!p){if(e>r){let y=o;o=l,l=y}let v=document.createRange();v.setEnd(l.node,l.offset),v.setStart(o.node,o.offset),u.removeAllRanges(),u.addRange(v)}}ignoreMutation(e){return!this.contentDOM&&e.type!="selection"}get contentLost(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}markDirty(e,r){for(let n=0,i=0;i<this.children.length;i++){let a=this.children[i],s=n+a.size;if(n==s?e<=s&&r>=n:e<s&&r>n){let o=n+a.border,l=s-a.border;if(e>=o&&r<=l){this.dirty=e==n||r==s?ah:tP,e==o&&r==l&&(a.contentLost||a.dom.parentNode!=this.contentDOM)?a.dirty=Eu:a.markDirty(e-o,r-o);return}else a.dirty=a.dom==a.contentDOM&&a.dom.parentNode==this.contentDOM&&!a.children.length?ah:Eu}n=s}this.dirty=ah}markParentsDirty(){let e=1;for(let r=this.parent;r;r=r.parent,e++){let n=e==1?ah:tP;r.dirty<n&&(r.dirty=n)}}get domAtom(){return!1}get ignoreForCoords(){return!1}get ignoreForSelection(){return!1}isText(e){return!1}}class i6 extends v0{constructor(e,r,n,i){let a,s=r.type.toDOM;if(typeof s=="function"&&(s=s(n,()=>{if(!a)return i;if(a.parent)return a.parent.posBeforeChild(a)})),!r.type.spec.raw){if(s.nodeType!=1){let o=document.createElement("span");o.appendChild(s),s=o}s.contentEditable="false",s.classList.add("ProseMirror-widget")}super(e,[],s,null),this.widget=r,this.widget=r,a=this}matchesWidget(e){return this.dirty==Wo&&e.type.eq(this.widget.type)}parseRule(){return{ignore:!0}}stopEvent(e){let r=this.widget.spec.stopEvent;return r?r(e):!1}ignoreMutation(e){return e.type!="selection"||this.widget.spec.ignoreSelection}destroy(){this.widget.type.destroy(this.dom),super.destroy()}get domAtom(){return!0}get ignoreForSelection(){return!!this.widget.type.spec.relaxedSide}get side(){return this.widget.type.side}}class NX extends v0{constructor(e,r,n,i){super(e,[],r,null),this.textDOM=n,this.text=i}get size(){return this.text.length}localPosFromDOM(e,r){return e!=this.textDOM?this.posAtStart+(r?this.size:0):this.posAtStart+r}domFromPos(e){return{node:this.textDOM,offset:e}}ignoreMutation(e){return e.type==="characterData"&&e.target.nodeValue==e.oldValue}}class Th extends v0{constructor(e,r,n,i,a){super(e,[],n,i),this.mark=r,this.spec=a}static create(e,r,n,i){let a=i.nodeViews[r.type.name],s=a&&a(r,i,n);return(!s||!s.dom)&&(s=Oh.renderSpec(document,r.type.spec.toDOM(r,n),null,r.attrs)),new Th(e,r,s.dom,s.contentDOM||s.dom,s)}parseRule(){return this.dirty&Eu||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}}matchesMark(e){return this.dirty!=Eu&&this.mark.eq(e)}markDirty(e,r){if(super.markDirty(e,r),this.dirty!=Wo){let n=this.parent;for(;!n.node;)n=n.parent;n.dirty<this.dirty&&(n.dirty=this.dirty),this.dirty=Wo}}slice(e,r,n){let i=Th.create(this.parent,this.mark,!0,n),a=this.children,s=this.size;r<s&&(a=Nk(a,r,s,n)),e>0&&(a=Nk(a,0,e,n));for(let o=0;o<a.length;o++)a[o].parent=i;return i.children=a,i}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}}class Zd extends v0{constructor(e,r,n,i,a,s,o,l,u){super(e,[],a,s),this.node=r,this.outerDeco=n,this.innerDeco=i,this.nodeDOM=o}static create(e,r,n,i,a,s){let o=a.nodeViews[r.type.name],l,u=o&&o(r,a,()=>{if(!l)return s;if(l.parent)return l.parent.posBeforeChild(l)},n,i),c=u&&u.dom,f=u&&u.contentDOM;if(r.isText){if(!c)c=document.createTextNode(r.text);else if(c.nodeType!=3)throw new RangeError("Text must be rendered as a DOM text node")}else c||({dom:c,contentDOM:f}=Oh.renderSpec(document,r.type.spec.toDOM(r),null,r.attrs));!f&&!r.isText&&c.nodeName!="BR"&&(c.hasAttribute("contenteditable")||(c.contentEditable="false"),r.type.spec.draggable&&(c.draggable=!0));let p=c;return c=l6(c,n,r),u?l=new PX(e,r,n,i,c,f||null,p,u,a,s+1):r.isText?new J1(e,r,n,i,c,p,a):new Zd(e,r,n,i,c,f||null,p,a,s+1)}parseRule(){if(this.node.type.spec.reparseInView)return null;let e={node:this.node.type.name,attrs:this.node.attrs};if(this.node.type.whitespace=="pre"&&(e.preserveWhitespace="full"),!this.contentDOM)e.getContent=()=>this.node.content;else if(!this.contentLost)e.contentElement=this.contentDOM;else{for(let r=this.children.length-1;r>=0;r--){let n=this.children[r];if(this.dom.contains(n.dom.parentNode)){e.contentElement=n.dom.parentNode;break}}e.contentElement||(e.getContent=()=>rt.empty)}return e}matchesNode(e,r,n){return this.dirty==Wo&&e.eq(this.node)&&Rx(r,this.outerDeco)&&n.eq(this.innerDeco)}get size(){return this.node.nodeSize}get border(){return this.node.isLeaf?0:1}updateChildren(e,r){let n=this.node.inlineContent,i=r,a=e.composing?this.localCompositionInfo(e,r):null,s=a&&a.pos>-1?a:null,o=a&&a.pos<0,l=new AX(this,s&&s.node,e);OX(this.node,this.innerDeco,(u,c,f)=>{u.spec.marks?l.syncToMarks(u.spec.marks,n,e,c):u.type.side>=0&&!f&&l.syncToMarks(c==this.node.childCount?hn.none:this.node.child(c).marks,n,e,c),l.placeWidget(u,e,i)},(u,c,f,p)=>{l.syncToMarks(u.marks,n,e,p);let v;l.findNodeMatch(u,c,f,p)||o&&e.state.selection.from>i&&e.state.selection.to<i+u.nodeSize&&(v=l.findIndexWithChild(a.node))>-1&&l.updateNodeAt(u,c,f,v,e)||l.updateNextNode(u,c,f,e,p,i)||l.addNode(u,c,f,e,i),i+=u.nodeSize}),l.syncToMarks([],n,e,0),this.node.isTextblock&&l.addTextblockHacks(),l.destroyRest(),(l.changed||this.dirty==ah)&&(s&&this.protectLocalComposition(e,s),s6(this.contentDOM,this.children,e),tm&&DX(this.dom))}localCompositionInfo(e,r){let{from:n,to:i}=e.state.selection;if(!(e.state.selection instanceof cr)||n<r||i>r+this.node.content.size)return null;let a=e.input.compositionNode;if(!a||!this.dom.contains(a.parentNode))return null;if(this.node.inlineContent){let s=a.nodeValue,o=IX(this.node.content,s,n-r,i-r);return o<0?null:{node:a,pos:o,text:s}}else return{node:a,pos:-1,text:""}}protectLocalComposition(e,{node:r,pos:n,text:i}){if(this.getDesc(r))return;let a=r;for(;a.parentNode!=this.contentDOM;a=a.parentNode){for(;a.previousSibling;)a.parentNode.removeChild(a.previousSibling);for(;a.nextSibling;)a.parentNode.removeChild(a.nextSibling);a.pmViewDesc&&(a.pmViewDesc=void 0)}let s=new NX(this,a,r,i);e.input.compositionNodes.push(s),this.children=Nk(this.children,n,n+i.length,e,s)}update(e,r,n,i){return this.dirty==Eu||!e.sameMarkup(this.node)?!1:(this.updateInner(e,r,n,i),!0)}updateInner(e,r,n,i){this.updateOuterDeco(r),this.node=e,this.innerDeco=n,this.contentDOM&&this.updateChildren(i,this.posAtStart),this.dirty=Wo}updateOuterDeco(e){if(Rx(e,this.outerDeco))return;let r=this.nodeDOM.nodeType!=1,n=this.dom;this.dom=o6(this.dom,this.nodeDOM,Tk(this.outerDeco,this.node,r),Tk(e,this.node,r)),this.dom!=n&&(n.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=e}selectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.add("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&(this.nodeDOM.draggable=!0))}deselectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.remove("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&this.nodeDOM.removeAttribute("draggable"))}get domAtom(){return this.node.isAtom}}function rP(t,e,r,n,i){l6(n,e,t);let a=new Zd(void 0,t,e,r,n,n,n,i,0);return a.contentDOM&&a.updateChildren(i,0),a}class J1 extends Zd{constructor(e,r,n,i,a,s,o){super(e,r,n,i,a,null,s,o,0)}parseRule(){let e=this.nodeDOM.parentNode;for(;e&&e!=this.dom&&!e.pmIsDeco;)e=e.parentNode;return{skip:e||!0}}update(e,r,n,i){return this.dirty==Eu||this.dirty!=Wo&&!this.inParent()||!e.sameMarkup(this.node)?!1:(this.updateOuterDeco(r),(this.dirty!=Wo||e.text!=this.node.text)&&e.text!=this.nodeDOM.nodeValue&&(this.nodeDOM.nodeValue=e.text,i.trackWrites==this.nodeDOM&&(i.trackWrites=null)),this.node=e,this.dirty=Wo,!0)}inParent(){let e=this.parent.contentDOM;for(let r=this.nodeDOM;r;r=r.parentNode)if(r==e)return!0;return!1}domFromPos(e){return{node:this.nodeDOM,offset:e}}localPosFromDOM(e,r,n){return e==this.nodeDOM?this.posAtStart+Math.min(r,this.node.text.length):super.localPosFromDOM(e,r,n)}ignoreMutation(e){return e.type!="characterData"&&e.type!="selection"}slice(e,r,n){let i=this.node.cut(e,r),a=document.createTextNode(i.text);return new J1(this.parent,i,this.outerDeco,this.innerDeco,a,a,n)}markDirty(e,r){super.markDirty(e,r),this.dom!=this.nodeDOM&&(e==0||r==this.nodeDOM.nodeValue.length)&&(this.dirty=Eu)}get domAtom(){return!1}isText(e){return this.node.text==e}}class a6 extends v0{parseRule(){return{ignore:!0}}matchesHack(e){return this.dirty==Wo&&this.dom.nodeName==e}get domAtom(){return!0}get ignoreForCoords(){return this.dom.nodeName=="IMG"}}class PX extends Zd{constructor(e,r,n,i,a,s,o,l,u,c){super(e,r,n,i,a,s,o,u,c),this.spec=l}update(e,r,n,i){if(this.dirty==Eu)return!1;if(this.spec.update&&(this.node.type==e.type||this.spec.multiType)){let a=this.spec.update(e,r,n);return a&&this.updateInner(e,r,n,i),a}else return!this.contentDOM&&!e.isLeaf?!1:super.update(e,r,n,i)}selectNode(){this.spec.selectNode?this.spec.selectNode():super.selectNode()}deselectNode(){this.spec.deselectNode?this.spec.deselectNode():super.deselectNode()}setSelection(e,r,n,i){this.spec.setSelection?this.spec.setSelection(e,r,n.root):super.setSelection(e,r,n,i)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}stopEvent(e){return this.spec.stopEvent?this.spec.stopEvent(e):!1}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}}function s6(t,e,r){let n=t.firstChild,i=!1;for(let a=0;a<e.length;a++){let s=e[a],o=s.dom;if(o.parentNode==t){for(;o!=n;)n=nP(n),i=!0;n=n.nextSibling}else i=!0,t.insertBefore(o,n);if(s instanceof Th){let l=n?n.previousSibling:t.lastChild;s6(s.contentDOM,s.children,r),n=l?l.nextSibling:t.firstChild}}for(;n;)n=nP(n),i=!0;i&&r.trackWrites==t&&(r.trackWrites=null)}const uv=function(t){t&&(this.nodeName=t)};uv.prototype=Object.create(null);const sh=[new uv];function Tk(t,e,r){if(t.length==0)return sh;let n=r?sh[0]:new uv,i=[n];for(let a=0;a<t.length;a++){let s=t[a].type.attrs;if(s){s.nodeName&&i.push(n=new uv(s.nodeName));for(let o in s){let l=s[o];l!=null&&(r&&i.length==1&&i.push(n=new uv(e.isInline?"span":"div")),o=="class"?n.class=(n.class?n.class+" ":"")+l:o=="style"?n.style=(n.style?n.style+";":"")+l:o!="nodeName"&&(n[o]=l))}}}return i}function o6(t,e,r,n){if(r==sh&&n==sh)return e;let i=e;for(let a=0;a<n.length;a++){let s=n[a],o=r[a];if(a){let l;o&&o.nodeName==s.nodeName&&i!=t&&(l=i.parentNode)&&l.nodeName.toLowerCase()==s.nodeName||(l=document.createElement(s.nodeName),l.pmIsDeco=!0,l.appendChild(i),o=sh[0]),i=l}MX(i,o||sh[0],s)}return i}function MX(t,e,r){for(let n in e)n!="class"&&n!="style"&&n!="nodeName"&&!(n in r)&&t.removeAttribute(n);for(let n in r)n!="class"&&n!="style"&&n!="nodeName"&&r[n]!=e[n]&&t.setAttribute(n,r[n]);if(e.class!=r.class){let n=e.class?e.class.split(" ").filter(Boolean):[],i=r.class?r.class.split(" ").filter(Boolean):[];for(let a=0;a<n.length;a++)i.indexOf(n[a])==-1&&t.classList.remove(n[a]);for(let a=0;a<i.length;a++)n.indexOf(i[a])==-1&&t.classList.add(i[a]);t.classList.length==0&&t.removeAttribute("class")}if(e.style!=r.style){if(e.style){let n=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g,i;for(;i=n.exec(e.style);)t.style.removeProperty(i[1])}r.style&&(t.style.cssText+=r.style)}}function l6(t,e,r){return o6(t,t,sh,Tk(e,r,t.nodeType!=1))}function Rx(t,e){if(t.length!=e.length)return!1;for(let r=0;r<t.length;r++)if(!t[r].type.eq(e[r].type))return!1;return!0}function nP(t){let e=t.nextSibling;return t.parentNode.removeChild(t),e}class AX{constructor(e,r,n){this.lock=r,this.view=n,this.index=0,this.stack=[],this.changed=!1,this.top=e,this.preMatch=LX(e.node.content,e)}destroyBetween(e,r){if(e!=r){for(let n=e;n<r;n++)this.top.children[n].destroy();this.top.children.splice(e,r-e),this.changed=!0}}destroyRest(){this.destroyBetween(this.index,this.top.children.length)}syncToMarks(e,r,n,i){let a=0,s=this.stack.length>>1,o=Math.min(s,e.length);for(;a<o&&(a==s-1?this.top:this.stack[a+1<<1]).matchesMark(e[a])&&e[a].type.spec.spanning!==!1;)a++;for(;a<s;)this.destroyRest(),this.top.dirty=Wo,this.index=this.stack.pop(),this.top=this.stack.pop(),s--;for(;s<e.length;){this.stack.push(this.top,this.index+1);let l=-1,u=this.top.children.length;i<this.preMatch.index&&(u=Math.min(this.index+3,u));for(let c=this.index;c<u;c++){let f=this.top.children[c];if(f.matchesMark(e[s])&&!this.isLocked(f.dom)){l=c;break}}if(l>-1)l>this.index&&(this.changed=!0,this.destroyBetween(this.index,l)),this.top=this.top.children[this.index];else{let c=Th.create(this.top,e[s],r,n);this.top.children.splice(this.index,0,c),this.top=c,this.changed=!0}this.index=0,s++}}findNodeMatch(e,r,n,i){let a=-1,s;if(i>=this.preMatch.index&&(s=this.preMatch.matches[i-this.preMatch.index]).parent==this.top&&s.matchesNode(e,r,n))a=this.top.children.indexOf(s,this.index);else for(let o=this.index,l=Math.min(this.top.children.length,o+5);o<l;o++){let u=this.top.children[o];if(u.matchesNode(e,r,n)&&!this.preMatch.matched.has(u)){a=o;break}}return a<0?!1:(this.destroyBetween(this.index,a),this.index++,!0)}updateNodeAt(e,r,n,i,a){let s=this.top.children[i];return s.dirty==Eu&&s.dom==s.contentDOM&&(s.dirty=ah),s.update(e,r,n,a)?(this.destroyBetween(this.index,i),this.index++,!0):!1}findIndexWithChild(e){for(;;){let r=e.parentNode;if(!r)return-1;if(r==this.top.contentDOM){let n=e.pmViewDesc;if(n){for(let i=this.index;i<this.top.children.length;i++)if(this.top.children[i]==n)return i}return-1}e=r}}updateNextNode(e,r,n,i,a,s){for(let o=this.index;o<this.top.children.length;o++){let l=this.top.children[o];if(l instanceof Zd){let u=this.preMatch.matched.get(l);if(u!=null&&u!=a)return!1;let c=l.dom,f,p=this.isLocked(c)&&!(e.isText&&l.node&&l.node.isText&&l.nodeDOM.nodeValue==e.text&&l.dirty!=Eu&&Rx(r,l.outerDeco));if(!p&&l.update(e,r,n,i))return this.destroyBetween(this.index,o),l.dom!=c&&(this.changed=!0),this.index++,!0;if(!p&&(f=this.recreateWrapper(l,e,r,n,i,s)))return this.destroyBetween(this.index,o),this.top.children[this.index]=f,f.contentDOM&&(f.dirty=ah,f.updateChildren(i,s+1),f.dirty=Wo),this.changed=!0,this.index++,!0;break}}return!1}recreateWrapper(e,r,n,i,a,s){if(e.dirty||r.isAtom||!e.children.length||!e.node.content.eq(r.content)||!Rx(n,e.outerDeco)||!i.eq(e.innerDeco))return null;let o=Zd.create(this.top,r,n,i,a,s);if(o.contentDOM){o.children=e.children,e.children=[];for(let l of o.children)l.parent=o}return e.destroy(),o}addNode(e,r,n,i,a){let s=Zd.create(this.top,e,r,n,i,a);s.contentDOM&&s.updateChildren(i,a+1),this.top.children.splice(this.index++,0,s),this.changed=!0}placeWidget(e,r,n){let i=this.index<this.top.children.length?this.top.children[this.index]:null;if(i&&i.matchesWidget(e)&&(e==i.widget||!i.widget.type.toDOM.parentNode))this.index++;else{let a=new i6(this.top,e,r,n);this.top.children.splice(this.index++,0,a),this.changed=!0}}addTextblockHacks(){let e=this.top.children[this.index-1],r=this.top;for(;e instanceof Th;)r=e,e=r.children[r.children.length-1];(!e||!(e instanceof J1)||/\n$/.test(e.node.text)||this.view.requiresGeckoHackNode&&/\s$/.test(e.node.text))&&((Ba||ua)&&e&&e.dom.contentEditable=="false"&&this.addHackNode("IMG",r),this.addHackNode("BR",this.top))}addHackNode(e,r){if(r==this.top&&this.index<r.children.length&&r.children[this.index].matchesHack(e))this.index++;else{let n=document.createElement(e);e=="IMG"&&(n.className="ProseMirror-separator",n.alt=""),e=="BR"&&(n.className="ProseMirror-trailingBreak");let i=new a6(this.top,[],n,null);r!=this.top?r.children.push(i):r.children.splice(this.index++,0,i),this.changed=!0}}isLocked(e){return this.lock&&(e==this.lock||e.nodeType==1&&e.contains(this.lock.parentNode))}}function LX(t,e){let r=e,n=r.children.length,i=t.childCount,a=new Map,s=[];e:for(;i>0;){let o;for(;;)if(n){let u=r.children[n-1];if(u instanceof Th)r=u,n=u.children.length;else{o=u,n--;break}}else{if(r==e)break e;n=r.parent.children.indexOf(r),r=r.parent}let l=o.node;if(l){if(l!=t.child(i-1))break;--i,a.set(o,i),s.push(o)}}return{index:i,matched:a,matches:s.reverse()}}function RX(t,e){return t.type.side-e.type.side}function OX(t,e,r,n){let i=e.locals(t),a=0;if(i.length==0){for(let u=0;u<t.childCount;u++){let c=t.child(u);n(c,i,e.forChild(a,c),u),a+=c.nodeSize}return}let s=0,o=[],l=null;for(let u=0;;){let c,f;for(;s<i.length&&i[s].to==a;){let w=i[s++];w.widget&&(c?(f||(f=[c])).push(w):c=w)}if(c)if(f){f.sort(RX);for(let w=0;w<f.length;w++)r(f[w],u,!!l)}else r(c,u,!!l);let p,v;if(l)v=-1,p=l,l=null;else if(u<t.childCount)v=u,p=t.child(u++);else break;for(let w=0;w<o.length;w++)o[w].to<=a&&o.splice(w--,1);for(;s<i.length&&i[s].from<=a&&i[s].to>a;)o.push(i[s++]);let y=a+p.nodeSize;if(p.isText){let w=y;s<i.length&&i[s].from<w&&(w=i[s].from);for(let T=0;T<o.length;T++)o[T].to<w&&(w=o[T].to);w<y&&(l=p.cut(w-a),p=p.cut(0,w-a),y=w,v=-1)}else for(;s<i.length&&i[s].to<y;)s++;let S=p.isInline&&!p.isLeaf?o.filter(w=>!w.inline):o.slice();n(p,S,e.forChild(a,p),v),a=y}}function DX(t){if(t.nodeName=="UL"||t.nodeName=="OL"){let e=t.style.cssText;t.style.cssText=e+"; list-style: square !important",window.getComputedStyle(t).listStyle,t.style.cssText=e}}function IX(t,e,r,n){for(let i=0,a=0;i<t.childCount&&a<=n;){let s=t.child(i++),o=a;if(a+=s.nodeSize,!s.isText)continue;let l=s.text;for(;i<t.childCount;){let u=t.child(i++);if(a+=u.nodeSize,!u.isText)break;l+=u.text}if(a>=r){if(a>=n&&l.slice(n-e.length-o,n-o)==e)return n-e.length;let u=o<n?l.lastIndexOf(e,n-o-1):-1;if(u>=0&&u+e.length+o>=r)return o+u;if(r==n&&l.length>=n+e.length-o&&l.slice(n-o,n-o+e.length)==e)return n}}return-1}function Nk(t,e,r,n,i){let a=[];for(let s=0,o=0;s<t.length;s++){let l=t[s],u=o,c=o+=l.size;u>=r||c<=e?a.push(l):(u<e&&a.push(l.slice(0,e-u,n)),i&&(a.push(i),i=void 0),c>r&&a.push(l.slice(r-u,l.size,n)))}return a}function aC(t,e=null){let r=t.domSelectionRange(),n=t.state.doc;if(!r.focusNode)return null;let i=t.docView.nearestDesc(r.focusNode),a=i&&i.size==0,s=t.docView.posFromDOM(r.focusNode,r.focusOffset,1);if(s<0)return null;let o=n.resolve(s),l,u;if(Q1(r)){for(l=s;i&&!i.node;)i=i.parent;let f=i.node;if(i&&f.isAtom&&Yt.isSelectable(f)&&i.parent&&!(f.isInline&&uX(r.focusNode,r.focusOffset,i.dom))){let p=i.posBefore;u=new Yt(s==p?o:n.resolve(p))}}else{if(r instanceof t.dom.ownerDocument.defaultView.Selection&&r.rangeCount>1){let f=s,p=s;for(let v=0;v<r.rangeCount;v++){let y=r.getRangeAt(v);f=Math.min(f,t.docView.posFromDOM(y.startContainer,y.startOffset,1)),p=Math.max(p,t.docView.posFromDOM(y.endContainer,y.endOffset,-1))}if(f<0)return null;[l,s]=p==t.state.selection.anchor?[p,f]:[f,p],o=n.resolve(s)}else l=t.docView.posFromDOM(r.anchorNode,r.anchorOffset,1);if(l<0)return null}let c=n.resolve(l);if(!u){let f=e=="pointer"||t.state.selection.head<o.pos&&!a?1:-1;u=sC(t,c,o,f)}return u}function u6(t){return t.editable?t.hasFocus():d6(t)&&document.activeElement&&document.activeElement.contains(t.dom)}function vc(t,e=!1){let r=t.state.selection;if(c6(t,r),!!u6(t)){if(!e&&t.input.mouseDown&&t.input.mouseDown.allowDefault&&ua){let n=t.domSelectionRange(),i=t.domObserver.currentSelection;if(n.anchorNode&&i.anchorNode&&Eh(n.anchorNode,n.anchorOffset,i.anchorNode,i.anchorOffset)){t.input.mouseDown.delayedSelectionSync=!0,t.domObserver.setCurSelection();return}}if(t.domObserver.disconnectSelection(),t.cursorWrapper)FX(t);else{let{anchor:n,head:i}=r,a,s;iP&&!(r instanceof cr)&&(r.$from.parent.inlineContent||(a=aP(t,r.from)),!r.empty&&!r.$from.parent.inlineContent&&(s=aP(t,r.to))),t.docView.setSelection(n,i,t,e),iP&&(a&&sP(a),s&&sP(s)),r.visible?t.dom.classList.remove("ProseMirror-hideselection"):(t.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&jX(t))}t.domObserver.setCurSelection(),t.domObserver.connectSelection()}}const iP=Ba||ua&&YO<63;function aP(t,e){let{node:r,offset:n}=t.docView.domFromPos(e,0),i=n<r.childNodes.length?r.childNodes[n]:null,a=n?r.childNodes[n-1]:null;if(Ba&&i&&i.contentEditable=="false")return uS(i);if((!i||i.contentEditable=="false")&&(!a||a.contentEditable=="false")){if(i)return uS(i);if(a)return uS(a)}}function uS(t){return t.contentEditable="true",Ba&&t.draggable&&(t.draggable=!1,t.wasDraggable=!0),t}function sP(t){t.contentEditable="false",t.wasDraggable&&(t.draggable=!0,t.wasDraggable=null)}function jX(t){let e=t.dom.ownerDocument;e.removeEventListener("selectionchange",t.input.hideSelectionGuard);let r=t.domSelectionRange(),n=r.anchorNode,i=r.anchorOffset;e.addEventListener("selectionchange",t.input.hideSelectionGuard=()=>{(r.anchorNode!=n||r.anchorOffset!=i)&&(e.removeEventListener("selectionchange",t.input.hideSelectionGuard),setTimeout(()=>{(!u6(t)||t.state.selection.visible)&&t.dom.classList.remove("ProseMirror-hideselection")},20))})}function FX(t){let e=t.domSelection();if(!e)return;let r=t.cursorWrapper.dom,n=r.nodeName=="IMG";n?e.collapse(r.parentNode,Da(r)+1):e.collapse(r,0),!n&&!t.state.selection.visible&&qs&&Kd<=11&&(r.disabled=!0,r.disabled=!1)}function c6(t,e){if(e instanceof Yt){let r=t.docView.descAt(e.from);r!=t.lastSelectedViewDesc&&(oP(t),r&&r.selectNode(),t.lastSelectedViewDesc=r)}else oP(t)}function oP(t){t.lastSelectedViewDesc&&(t.lastSelectedViewDesc.parent&&t.lastSelectedViewDesc.deselectNode(),t.lastSelectedViewDesc=void 0)}function sC(t,e,r,n){return t.someProp("createSelectionBetween",i=>i(t,e,r))||cr.between(e,r,n)}function lP(t){return t.editable&&!t.hasFocus()?!1:d6(t)}function d6(t){let e=t.domSelectionRange();if(!e.anchorNode)return!1;try{return t.dom.contains(e.anchorNode.nodeType==3?e.anchorNode.parentNode:e.anchorNode)&&(t.editable||t.dom.contains(e.focusNode.nodeType==3?e.focusNode.parentNode:e.focusNode))}catch{return!1}}function BX(t){let e=t.docView.domFromPos(t.state.selection.anchor,0),r=t.domSelectionRange();return Eh(e.node,e.offset,r.anchorNode,r.anchorOffset)}function Pk(t,e){let{$anchor:r,$head:n}=t.selection,i=e>0?r.max(n):r.min(n),a=i.parent.inlineContent?i.depth?t.doc.resolve(e>0?i.after():i.before()):null:i;return a&&yr.findFrom(a,e)}function Pd(t,e){return t.dispatch(t.state.tr.setSelection(e).scrollIntoView()),!0}function uP(t,e,r){let n=t.state.selection;if(n instanceof cr)if(r.indexOf("s")>-1){let{$head:i}=n,a=i.textOffset?null:e<0?i.nodeBefore:i.nodeAfter;if(!a||a.isText||!a.isLeaf)return!1;let s=t.state.doc.resolve(i.pos+a.nodeSize*(e<0?-1:1));return Pd(t,new cr(n.$anchor,s))}else if(n.empty){if(t.endOfTextblock(e>0?"forward":"backward")){let i=Pk(t.state,e);return i&&i instanceof Yt?Pd(t,i):!1}else if(!(Bo&&r.indexOf("m")>-1)){let i=n.$head,a=i.textOffset?null:e<0?i.nodeBefore:i.nodeAfter,s;if(!a||a.isText)return!1;let o=e<0?i.pos-a.nodeSize:i.pos;return a.isAtom||(s=t.docView.descAt(o))&&!s.contentDOM?Yt.isSelectable(a)?Pd(t,new Yt(e<0?t.state.doc.resolve(i.pos-a.nodeSize):i)):g0?Pd(t,new cr(t.state.doc.resolve(e<0?o:o+a.nodeSize))):!1:!1}}else return!1;else{if(n instanceof Yt&&n.node.isInline)return Pd(t,new cr(e>0?n.$to:n.$from));{let i=Pk(t.state,e);return i?Pd(t,i):!1}}}function Ox(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}function cv(t,e){let r=t.pmViewDesc;return r&&r.size==0&&(e<0||t.nextSibling||t.nodeName!="BR")}function Tp(t,e){return e<0?zX(t):UX(t)}function zX(t){let e=t.domSelectionRange(),r=e.focusNode,n=e.focusOffset;if(!r)return;let i,a,s=!1;for(Ho&&r.nodeType==1&&n<Ox(r)&&cv(r.childNodes[n],-1)&&(s=!0);;)if(n>0){if(r.nodeType!=1)break;{let o=r.childNodes[n-1];if(cv(o,-1))i=r,a=--n;else if(o.nodeType==3)r=o,n=r.nodeValue.length;else break}}else{if(f6(r))break;{let o=r.previousSibling;for(;o&&cv(o,-1);)i=r.parentNode,a=Da(o),o=o.previousSibling;if(o)r=o,n=Ox(r);else{if(r=r.parentNode,r==t.dom)break;n=0}}}s?Mk(t,r,n):i&&Mk(t,i,a)}function UX(t){let e=t.domSelectionRange(),r=e.focusNode,n=e.focusOffset;if(!r)return;let i=Ox(r),a,s;for(;;)if(n<i){if(r.nodeType!=1)break;let o=r.childNodes[n];if(cv(o,1))a=r,s=++n;else break}else{if(f6(r))break;{let o=r.nextSibling;for(;o&&cv(o,1);)a=o.parentNode,s=Da(o)+1,o=o.nextSibling;if(o)r=o,n=0,i=Ox(r);else{if(r=r.parentNode,r==t.dom)break;n=i=0}}}a&&Mk(t,a,s)}function f6(t){let e=t.pmViewDesc;return e&&e.node&&e.node.isBlock}function GX(t,e){for(;t&&e==t.childNodes.length&&!m0(t);)e=Da(t)+1,t=t.parentNode;for(;t&&e<t.childNodes.length;){let r=t.childNodes[e];if(r.nodeType==3)return r;if(r.nodeType==1&&r.contentEditable=="false")break;t=r,e=0}}function VX(t,e){for(;t&&!e&&!m0(t);)e=Da(t),t=t.parentNode;for(;t&&e;){let r=t.childNodes[e-1];if(r.nodeType==3)return r;if(r.nodeType==1&&r.contentEditable=="false")break;t=r,e=t.childNodes.length}}function Mk(t,e,r){if(e.nodeType!=3){let a,s;(s=GX(e,r))?(e=s,r=0):(a=VX(e,r))&&(e=a,r=a.nodeValue.length)}let n=t.domSelection();if(!n)return;if(Q1(n)){let a=document.createRange();a.setEnd(e,r),a.setStart(e,r),n.removeAllRanges(),n.addRange(a)}else n.extend&&n.extend(e,r);t.domObserver.setCurSelection();let{state:i}=t;setTimeout(()=>{t.state==i&&vc(t)},50)}function cP(t,e){let r=t.state.doc.resolve(e);if(!(ua||XO)&&r.parent.inlineContent){let i=t.coordsAtPos(e);if(e>r.start()){let a=t.coordsAtPos(e-1),s=(a.top+a.bottom)/2;if(s>i.top&&s<i.bottom&&Math.abs(a.left-i.left)>1)return a.left<i.left?"ltr":"rtl"}if(e<r.end()){let a=t.coordsAtPos(e+1),s=(a.top+a.bottom)/2;if(s>i.top&&s<i.bottom&&Math.abs(a.left-i.left)>1)return a.left>i.left?"ltr":"rtl"}}return getComputedStyle(t.dom).direction=="rtl"?"rtl":"ltr"}function dP(t,e,r){let n=t.state.selection;if(n instanceof cr&&!n.empty||r.indexOf("s")>-1||Bo&&r.indexOf("m")>-1)return!1;let{$from:i,$to:a}=n;if(!i.parent.inlineContent||t.endOfTextblock(e<0?"up":"down")){let s=Pk(t.state,e);if(s&&s instanceof Yt)return Pd(t,s)}if(!i.parent.inlineContent){let s=e<0?i:a,o=n instanceof co?yr.near(s,e):yr.findFrom(s,e);return o?Pd(t,o):!1}return!1}function fP(t,e){if(!(t.state.selection instanceof cr))return!0;let{$head:r,$anchor:n,empty:i}=t.state.selection;if(!r.sameParent(n))return!0;if(!i)return!1;if(t.endOfTextblock(e>0?"forward":"backward"))return!0;let a=!r.textOffset&&(e<0?r.nodeBefore:r.nodeAfter);if(a&&!a.isText){let s=t.state.tr;return e<0?s.delete(r.pos-a.nodeSize,r.pos):s.delete(r.pos,r.pos+a.nodeSize),t.dispatch(s),!0}return!1}function hP(t,e,r){t.domObserver.stop(),e.contentEditable=r,t.domObserver.start()}function HX(t){if(!Ba||t.state.selection.$head.parentOffset>0)return!1;let{focusNode:e,focusOffset:r}=t.domSelectionRange();if(e&&e.nodeType==1&&r==0&&e.firstChild&&e.firstChild.contentEditable=="false"){let n=e.firstChild;hP(t,n,"true"),setTimeout(()=>hP(t,n,"false"),20)}return!1}function WX(t){let e="";return t.ctrlKey&&(e+="c"),t.metaKey&&(e+="m"),t.altKey&&(e+="a"),t.shiftKey&&(e+="s"),e}function qX(t,e){let r=e.keyCode,n=WX(e);if(r==8||Bo&&r==72&&n=="c")return fP(t,-1)||Tp(t,-1);if(r==46&&!e.shiftKey||Bo&&r==68&&n=="c")return fP(t,1)||Tp(t,1);if(r==13||r==27)return!0;if(r==37||Bo&&r==66&&n=="c"){let i=r==37?cP(t,t.state.selection.from)=="ltr"?-1:1:-1;return uP(t,i,n)||Tp(t,i)}else if(r==39||Bo&&r==70&&n=="c"){let i=r==39?cP(t,t.state.selection.from)=="ltr"?1:-1:1;return uP(t,i,n)||Tp(t,i)}else{if(r==38||Bo&&r==80&&n=="c")return dP(t,-1,n)||Tp(t,-1);if(r==40||Bo&&r==78&&n=="c")return HX(t)||dP(t,1,n)||Tp(t,1);if(n==(Bo?"m":"c")&&(r==66||r==73||r==89||r==90))return!0}return!1}function oC(t,e){t.someProp("transformCopied",v=>{e=v(e,t)});let r=[],{content:n,openStart:i,openEnd:a}=e;for(;i>1&&a>1&&n.childCount==1&&n.firstChild.childCount==1;){i--,a--;let v=n.firstChild;r.push(v.type.name,v.attrs!=v.type.defaultAttrs?v.attrs:null),n=v.content}let s=t.someProp("clipboardSerializer")||Oh.fromSchema(t.state.schema),o=y6(),l=o.createElement("div");l.appendChild(s.serializeFragment(n,{document:o}));let u=l.firstChild,c,f=0;for(;u&&u.nodeType==1&&(c=v6[u.nodeName.toLowerCase()]);){for(let v=c.length-1;v>=0;v--){let y=o.createElement(c[v]);for(;l.firstChild;)y.appendChild(l.firstChild);l.appendChild(y),f++}u=l.firstChild}u&&u.nodeType==1&&u.setAttribute("data-pm-slice",`${i} ${a}${f?` -${f}`:""} ${JSON.stringify(r)}`);let p=t.someProp("clipboardTextSerializer",v=>v(e,t))||e.content.textBetween(0,e.content.size,`

`);return{dom:l,text:p,slice:e}}function h6(t,e,r,n,i){let a=i.parent.type.spec.code,s,o;if(!r&&!e)return null;let l=!!e&&(n||a||!r);if(l){if(t.someProp("transformPastedText",p=>{e=p(e,a||n,t)}),a)return o=new Nt(rt.from(t.state.schema.text(e.replace(/\r\n?/g,`
`))),0,0),t.someProp("transformPasted",p=>{o=p(o,t,!0)}),o;let f=t.someProp("clipboardTextParser",p=>p(e,i,n,t));if(f)o=f;else{let p=i.marks(),{schema:v}=t.state,y=Oh.fromSchema(v);s=document.createElement("div"),e.split(/(?:\r\n?|\n)+/).forEach(S=>{let w=s.appendChild(document.createElement("p"));S&&w.appendChild(y.serializeNode(v.text(S,p)))})}}else t.someProp("transformPastedHTML",f=>{r=f(r,t)}),s=YX(r),g0&&XX(s);let u=s&&s.querySelector("[data-pm-slice]"),c=u&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(u.getAttribute("data-pm-slice")||"");if(c&&c[3])for(let f=+c[3];f>0;f--){let p=s.firstChild;for(;p&&p.nodeType!=1;)p=p.nextSibling;if(!p)break;s=p}if(o||(o=(t.someProp("clipboardParser")||t.someProp("domParser")||$d.fromSchema(t.state.schema)).parseSlice(s,{preserveWhitespace:!!(l||c),context:i,ruleFromNode(p){return p.nodeName=="BR"&&!p.nextSibling&&p.parentNode&&!$X.test(p.parentNode.nodeName)?{ignore:!0}:null}})),c)o=QX(pP(o,+c[1],+c[2]),c[4]);else if(o=Nt.maxOpen(KX(o.content,i),!0),o.openStart||o.openEnd){let f=0,p=0;for(let v=o.content.firstChild;f<o.openStart&&!v.type.spec.isolating;f++,v=v.firstChild);for(let v=o.content.lastChild;p<o.openEnd&&!v.type.spec.isolating;p++,v=v.lastChild);o=pP(o,f,p)}return t.someProp("transformPasted",f=>{o=f(o,t,l)}),o}const $X=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function KX(t,e){if(t.childCount<2)return t;for(let r=e.depth;r>=0;r--){let i=e.node(r).contentMatchAt(e.index(r)),a,s=[];if(t.forEach(o=>{if(!s)return;let l=i.findWrapping(o.type),u;if(!l)return s=null;if(u=s.length&&a.length&&m6(l,a,o,s[s.length-1],0))s[s.length-1]=u;else{s.length&&(s[s.length-1]=g6(s[s.length-1],a.length));let c=p6(o,l);s.push(c),i=i.matchType(c.type),a=l}}),s)return rt.from(s)}return t}function p6(t,e,r=0){for(let n=e.length-1;n>=r;n--)t=e[n].create(null,rt.from(t));return t}function m6(t,e,r,n,i){if(i<t.length&&i<e.length&&t[i]==e[i]){let a=m6(t,e,r,n.lastChild,i+1);if(a)return n.copy(n.content.replaceChild(n.childCount-1,a));if(n.contentMatchAt(n.childCount).matchType(i==t.length-1?r.type:t[i+1]))return n.copy(n.content.append(rt.from(p6(r,t,i+1))))}}function g6(t,e){if(e==0)return t;let r=t.content.replaceChild(t.childCount-1,g6(t.lastChild,e-1)),n=t.contentMatchAt(t.childCount).fillBefore(rt.empty,!0);return t.copy(r.append(n))}function Ak(t,e,r,n,i,a){let s=e<0?t.firstChild:t.lastChild,o=s.content;return t.childCount>1&&(a=0),i<n-1&&(o=Ak(o,e,r,n,i+1,a)),i>=r&&(o=e<0?s.contentMatchAt(0).fillBefore(o,a<=i).append(o):o.append(s.contentMatchAt(s.childCount).fillBefore(rt.empty,!0))),t.replaceChild(e<0?0:t.childCount-1,s.copy(o))}function pP(t,e,r){return e<t.openStart&&(t=new Nt(Ak(t.content,-1,e,t.openStart,0,t.openEnd),e,t.openEnd)),r<t.openEnd&&(t=new Nt(Ak(t.content,1,r,t.openEnd,0,0),t.openStart,r)),t}const v6={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};let mP=null;function y6(){return mP||(mP=document.implementation.createHTMLDocument("title"))}let cS=null;function ZX(t){let e=window.trustedTypes;return e?(cS||(cS=e.defaultPolicy||e.createPolicy("ProseMirrorClipboard",{createHTML:r=>r})),cS.createHTML(t)):t}function YX(t){let e=/^(\s*<meta [^>]*>)*/.exec(t);e&&(t=t.slice(e[0].length));let r=y6().createElement("div"),n=/<([a-z][^>\s]+)/i.exec(t),i;if((i=n&&v6[n[1].toLowerCase()])&&(t=i.map(a=>"<"+a+">").join("")+t+i.map(a=>"</"+a+">").reverse().join("")),r.innerHTML=ZX(t),i)for(let a=0;a<i.length;a++)r=r.querySelector(i[a])||r;return r}function XX(t){let e=t.querySelectorAll(ua?"span:not([class]):not([style])":"span.Apple-converted-space");for(let r=0;r<e.length;r++){let n=e[r];n.childNodes.length==1&&n.textContent==""&&n.parentNode&&n.parentNode.replaceChild(t.ownerDocument.createTextNode(" "),n)}}function QX(t,e){if(!t.size)return t;let r=t.content.firstChild.type.schema,n;try{n=JSON.parse(e)}catch{return t}let{content:i,openStart:a,openEnd:s}=t;for(let o=n.length-2;o>=0;o-=2){let l=r.nodes[n[o]];if(!l||l.hasRequiredAttrs())break;i=rt.from(l.create(n[o+1],i)),a++,s++}return new Nt(i,a,s)}const Cs={},Es={},JX={touchstart:!0,touchmove:!0};class eQ{constructor(){this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:"",button:0},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastFocus=0,this.lastTouch=0,this.lastChromeDelete=0,this.composing=!1,this.compositionNode=null,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.compositionID=1,this.badSafariComposition=!1,this.compositionPendingChanges=0,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null}}function tQ(t){for(let e in Cs){let r=Cs[e];t.dom.addEventListener(e,t.input.eventHandlers[e]=n=>{nQ(t,n)&&!lC(t,n)&&(t.editable||!(n.type in Es))&&r(t,n)},JX[e]?{passive:!0}:void 0)}Ba&&t.dom.addEventListener("input",()=>null),Lk(t)}function Ud(t,e){t.input.lastSelectionOrigin=e,t.input.lastSelectionTime=Date.now()}function rQ(t){t.domObserver.stop();for(let e in t.input.eventHandlers)t.dom.removeEventListener(e,t.input.eventHandlers[e]);clearTimeout(t.input.composingTimeout),clearTimeout(t.input.lastIOSEnterFallbackTimeout)}function Lk(t){t.someProp("handleDOMEvents",e=>{for(let r in e)t.input.eventHandlers[r]||t.dom.addEventListener(r,t.input.eventHandlers[r]=n=>lC(t,n))})}function lC(t,e){return t.someProp("handleDOMEvents",r=>{let n=r[e.type];return n?n(t,e)||e.defaultPrevented:!1})}function nQ(t,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let r=e.target;r!=t.dom;r=r.parentNode)if(!r||r.nodeType==11||r.pmViewDesc&&r.pmViewDesc.stopEvent(e))return!1;return!0}function iQ(t,e){!lC(t,e)&&Cs[e.type]&&(t.editable||!(e.type in Es))&&Cs[e.type](t,e)}Es.keydown=(t,e)=>{let r=e;if(t.input.shiftKey=r.keyCode==16||r.shiftKey,!b6(t,r)&&(t.input.lastKeyCode=r.keyCode,t.input.lastKeyCodeTime=Date.now(),!(pc&&ua&&r.keyCode==13)))if(r.keyCode!=229&&t.domObserver.forceFlush(),tm&&r.keyCode==13&&!r.ctrlKey&&!r.altKey&&!r.metaKey){let n=Date.now();t.input.lastIOSEnter=n,t.input.lastIOSEnterFallbackTimeout=setTimeout(()=>{t.input.lastIOSEnter==n&&(t.someProp("handleKeyDown",i=>i(t,nh(13,"Enter"))),t.input.lastIOSEnter=0)},200)}else t.someProp("handleKeyDown",n=>n(t,r))||qX(t,r)?r.preventDefault():Ud(t,"key")};Es.keyup=(t,e)=>{e.keyCode==16&&(t.input.shiftKey=!1)};Es.keypress=(t,e)=>{let r=e;if(b6(t,r)||!r.charCode||r.ctrlKey&&!r.altKey||Bo&&r.metaKey)return;if(t.someProp("handleKeyPress",i=>i(t,r))){r.preventDefault();return}let n=t.state.selection;if(!(n instanceof cr)||!n.$from.sameParent(n.$to)){let i=String.fromCharCode(r.charCode),a=()=>t.state.tr.insertText(i).scrollIntoView();!/[\r\n]/.test(i)&&!t.someProp("handleTextInput",s=>s(t,n.$from.pos,n.$to.pos,i,a))&&t.dispatch(a()),r.preventDefault()}};function eb(t){return{left:t.clientX,top:t.clientY}}function aQ(t,e){let r=e.x-t.clientX,n=e.y-t.clientY;return r*r+n*n<100}function uC(t,e,r,n,i){if(n==-1)return!1;let a=t.state.doc.resolve(n);for(let s=a.depth+1;s>0;s--)if(t.someProp(e,o=>s>a.depth?o(t,r,a.nodeAfter,a.before(s),i,!0):o(t,r,a.node(s),a.before(s),i,!1)))return!0;return!1}function qp(t,e,r){if(t.focused||t.focus(),t.state.selection.eq(e))return;let n=t.state.tr.setSelection(e);n.setMeta("pointer",!0),t.dispatch(n)}function sQ(t,e){if(e==-1)return!1;let r=t.state.doc.resolve(e),n=r.nodeAfter;return n&&n.isAtom&&Yt.isSelectable(n)?(qp(t,new Yt(r)),!0):!1}function oQ(t,e){if(e==-1)return!1;let r=t.state.selection,n,i;r instanceof Yt&&(n=r.node);let a=t.state.doc.resolve(e);for(let s=a.depth+1;s>0;s--){let o=s>a.depth?a.nodeAfter:a.node(s);if(Yt.isSelectable(o)){n&&r.$from.depth>0&&s>=r.$from.depth&&a.before(r.$from.depth+1)==r.$from.pos?i=a.before(r.$from.depth):i=a.before(s);break}}return i!=null?(qp(t,Yt.create(t.state.doc,i)),!0):!1}function lQ(t,e,r,n,i){return uC(t,"handleClickOn",e,r,n)||t.someProp("handleClick",a=>a(t,e,n))||(i?oQ(t,r):sQ(t,r))}function uQ(t,e,r,n){return uC(t,"handleDoubleClickOn",e,r,n)||t.someProp("handleDoubleClick",i=>i(t,e,n))}function cQ(t,e,r,n){return uC(t,"handleTripleClickOn",e,r,n)||t.someProp("handleTripleClick",i=>i(t,e,n))||dQ(t,r,n)}function dQ(t,e,r){if(r.button!=0)return!1;let n=t.state.doc;if(e==-1)return n.inlineContent?(qp(t,cr.create(n,0,n.content.size)),!0):!1;let i=n.resolve(e);for(let a=i.depth+1;a>0;a--){let s=a>i.depth?i.nodeAfter:i.node(a),o=i.before(a);if(s.inlineContent)qp(t,cr.create(n,o+1,o+1+s.content.size));else if(Yt.isSelectable(s))qp(t,Yt.create(n,o));else continue;return!0}}function cC(t){return Dx(t)}const x6=Bo?"metaKey":"ctrlKey";Cs.mousedown=(t,e)=>{let r=e;t.input.shiftKey=r.shiftKey;let n=cC(t),i=Date.now(),a="singleClick";i-t.input.lastClick.time<500&&aQ(r,t.input.lastClick)&&!r[x6]&&t.input.lastClick.button==r.button&&(t.input.lastClick.type=="singleClick"?a="doubleClick":t.input.lastClick.type=="doubleClick"&&(a="tripleClick")),t.input.lastClick={time:i,x:r.clientX,y:r.clientY,type:a,button:r.button};let s=t.posAtCoords(eb(r));s&&(a=="singleClick"?(t.input.mouseDown&&t.input.mouseDown.done(),t.input.mouseDown=new fQ(t,s,r,!!n)):(a=="doubleClick"?uQ:cQ)(t,s.pos,s.inside,r)?r.preventDefault():Ud(t,"pointer"))};class fQ{constructor(e,r,n,i){this.view=e,this.pos=r,this.event=n,this.flushed=i,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=e.state.doc,this.selectNode=!!n[x6],this.allowDefault=n.shiftKey;let a,s;if(r.inside>-1)a=e.state.doc.nodeAt(r.inside),s=r.inside;else{let c=e.state.doc.resolve(r.pos);a=c.parent,s=c.depth?c.before():0}const o=i?null:n.target,l=o?e.docView.nearestDesc(o,!0):null;this.target=l&&l.nodeDOM.nodeType==1?l.nodeDOM:null;let{selection:u}=e.state;(n.button==0&&a.type.spec.draggable&&a.type.spec.selectable!==!1||u instanceof Yt&&u.from<=s&&u.to>s)&&(this.mightDrag={node:a,pos:s,addAttr:!!(this.target&&!this.target.draggable),setUneditable:!!(this.target&&Ho&&!this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),e.root.addEventListener("mouseup",this.up=this.up.bind(this)),e.root.addEventListener("mousemove",this.move=this.move.bind(this)),Ud(e,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(()=>vc(this.view)),this.view.input.mouseDown=null}up(e){if(this.done(),!this.view.dom.contains(e.target))return;let r=this.pos;this.view.state.doc!=this.startDoc&&(r=this.view.posAtCoords(eb(e))),this.updateAllowDefault(e),this.allowDefault||!r?Ud(this.view,"pointer"):lQ(this.view,r.pos,r.inside,e,this.selectNode)?e.preventDefault():e.button==0&&(this.flushed||Ba&&this.mightDrag&&!this.mightDrag.node.isAtom||ua&&!this.view.state.selection.visible&&Math.min(Math.abs(r.pos-this.view.state.selection.from),Math.abs(r.pos-this.view.state.selection.to))<=2)?(qp(this.view,yr.near(this.view.state.doc.resolve(r.pos))),e.preventDefault()):Ud(this.view,"pointer")}move(e){this.updateAllowDefault(e),Ud(this.view,"pointer"),e.buttons==0&&this.done()}updateAllowDefault(e){!this.allowDefault&&(Math.abs(this.event.x-e.clientX)>4||Math.abs(this.event.y-e.clientY)>4)&&(this.allowDefault=!0)}}Cs.touchstart=t=>{t.input.lastTouch=Date.now(),cC(t),Ud(t,"pointer")};Cs.touchmove=t=>{t.input.lastTouch=Date.now(),Ud(t,"pointer")};Cs.contextmenu=t=>cC(t);function b6(t,e){return t.composing?!0:Ba&&Math.abs(e.timeStamp-t.input.compositionEndedAt)<500?(t.input.compositionEndedAt=-2e8,!0):!1}const hQ=pc?5e3:-1;Es.compositionstart=Es.compositionupdate=t=>{if(!t.composing){t.domObserver.flush();let{state:e}=t,r=e.selection.$to;if(e.selection instanceof cr&&(e.storedMarks||!r.textOffset&&r.parentOffset&&r.nodeBefore.marks.some(n=>n.type.spec.inclusive===!1)||ua&&XO&&pQ(t)))t.markCursor=t.state.storedMarks||r.marks(),Dx(t,!0),t.markCursor=null;else if(Dx(t,!e.selection.empty),Ho&&e.selection.empty&&r.parentOffset&&!r.textOffset&&r.nodeBefore.marks.length){let n=t.domSelectionRange();for(let i=n.focusNode,a=n.focusOffset;i&&i.nodeType==1&&a!=0;){let s=a<0?i.lastChild:i.childNodes[a-1];if(!s)break;if(s.nodeType==3){let o=t.domSelection();o&&o.collapse(s,s.nodeValue.length);break}else i=s,a=-1}}t.input.composing=!0}w6(t,hQ)};function pQ(t){let{focusNode:e,focusOffset:r}=t.domSelectionRange();if(!e||e.nodeType!=1||r>=e.childNodes.length)return!1;let n=e.childNodes[r];return n.nodeType==1&&n.contentEditable=="false"}Es.compositionend=(t,e)=>{t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=e.timeStamp,t.input.compositionPendingChanges=t.domObserver.pendingRecords().length?t.input.compositionID:0,t.input.compositionNode=null,t.input.badSafariComposition?t.domObserver.forceFlush():t.input.compositionPendingChanges&&Promise.resolve().then(()=>t.domObserver.flush()),t.input.compositionID++,w6(t,20))};function w6(t,e){clearTimeout(t.input.composingTimeout),e>-1&&(t.input.composingTimeout=setTimeout(()=>Dx(t),e))}function S6(t){for(t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=gQ());t.input.compositionNodes.length>0;)t.input.compositionNodes.pop().markParentsDirty()}function mQ(t){let e=t.domSelectionRange();if(!e.focusNode)return null;let r=oX(e.focusNode,e.focusOffset),n=lX(e.focusNode,e.focusOffset);if(r&&n&&r!=n){let i=n.pmViewDesc,a=t.domObserver.lastChangedTextNode;if(r==a||n==a)return a;if(!i||!i.isText(n.nodeValue))return n;if(t.input.compositionNode==n){let s=r.pmViewDesc;if(!(!s||!s.isText(r.nodeValue)))return n}}return r||n}function gQ(){let t=document.createEvent("Event");return t.initEvent("event",!0,!0),t.timeStamp}function Dx(t,e=!1){if(!(pc&&t.domObserver.flushingSoon>=0)){if(t.domObserver.forceFlush(),S6(t),e||t.docView&&t.docView.dirty){let r=aC(t),n=t.state.selection;return r&&!r.eq(n)?t.dispatch(t.state.tr.setSelection(r)):(t.markCursor||e)&&!n.$from.node(n.$from.sharedDepth(n.to)).inlineContent?t.dispatch(t.state.tr.deleteSelection()):t.updateState(t.state),!0}return!1}}function vQ(t,e){if(!t.dom.parentNode)return;let r=t.dom.parentNode.appendChild(document.createElement("div"));r.appendChild(e),r.style.cssText="position: fixed; left: -10000px; top: 10px";let n=getSelection(),i=document.createRange();i.selectNodeContents(e),t.dom.blur(),n.removeAllRanges(),n.addRange(i),setTimeout(()=>{r.parentNode&&r.parentNode.removeChild(r),t.focus()},50)}const Uv=qs&&Kd<15||tm&&fX<604;Cs.copy=Es.cut=(t,e)=>{let r=e,n=t.state.selection,i=r.type=="cut";if(n.empty)return;let a=Uv?null:r.clipboardData,s=n.content(),{dom:o,text:l}=oC(t,s);a?(r.preventDefault(),a.clearData(),a.setData("text/html",o.innerHTML),a.setData("text/plain",l)):vQ(t,o),i&&t.dispatch(t.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))};function yQ(t){return t.openStart==0&&t.openEnd==0&&t.content.childCount==1?t.content.firstChild:null}function xQ(t,e){if(!t.dom.parentNode)return;let r=t.input.shiftKey||t.state.selection.$from.parent.type.spec.code,n=t.dom.parentNode.appendChild(document.createElement(r?"textarea":"div"));r||(n.contentEditable="true"),n.style.cssText="position: fixed; left: -10000px; top: 10px",n.focus();let i=t.input.shiftKey&&t.input.lastKeyCode!=45;setTimeout(()=>{t.focus(),n.parentNode&&n.parentNode.removeChild(n),r?Gv(t,n.value,null,i,e):Gv(t,n.textContent,n.innerHTML,i,e)},50)}function Gv(t,e,r,n,i){let a=h6(t,e,r,n,t.state.selection.$from);if(t.someProp("handlePaste",l=>l(t,i,a||Nt.empty)))return!0;if(!a)return!1;let s=yQ(a),o=s?t.state.tr.replaceSelectionWith(s,n):t.state.tr.replaceSelection(a);return t.dispatch(o.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}function k6(t){let e=t.getData("text/plain")||t.getData("Text");if(e)return e;let r=t.getData("text/uri-list");return r?r.replace(/\r?\n/g," "):""}Es.paste=(t,e)=>{let r=e;if(t.composing&&!pc)return;let n=Uv?null:r.clipboardData,i=t.input.shiftKey&&t.input.lastKeyCode!=45;n&&Gv(t,k6(n),n.getData("text/html"),i,r)?r.preventDefault():xQ(t,r)};class _6{constructor(e,r,n){this.slice=e,this.move=r,this.node=n}}const bQ=Bo?"altKey":"ctrlKey";function C6(t,e){let r=t.someProp("dragCopies",n=>!n(e));return r??!e[bQ]}Cs.dragstart=(t,e)=>{let r=e,n=t.input.mouseDown;if(n&&n.done(),!r.dataTransfer)return;let i=t.state.selection,a=i.empty?null:t.posAtCoords(eb(r)),s;if(!(a&&a.pos>=i.from&&a.pos<=(i instanceof Yt?i.to-1:i.to))){if(n&&n.mightDrag)s=Yt.create(t.state.doc,n.mightDrag.pos);else if(r.target&&r.target.nodeType==1){let f=t.docView.nearestDesc(r.target,!0);f&&f.node.type.spec.draggable&&f!=t.docView&&(s=Yt.create(t.state.doc,f.posBefore))}}let o=(s||t.state.selection).content(),{dom:l,text:u,slice:c}=oC(t,o);(!r.dataTransfer.files.length||!ua||YO>120)&&r.dataTransfer.clearData(),r.dataTransfer.setData(Uv?"Text":"text/html",l.innerHTML),r.dataTransfer.effectAllowed="copyMove",Uv||r.dataTransfer.setData("text/plain",u),t.dragging=new _6(c,C6(t,r),s)};Cs.dragend=t=>{let e=t.dragging;window.setTimeout(()=>{t.dragging==e&&(t.dragging=null)},50)};Es.dragover=Es.dragenter=(t,e)=>e.preventDefault();Es.drop=(t,e)=>{try{wQ(t,e,t.dragging)}finally{t.dragging=null}};function wQ(t,e,r){if(!e.dataTransfer)return;let n=t.posAtCoords(eb(e));if(!n)return;let i=t.state.doc.resolve(n.pos),a=r&&r.slice;a?t.someProp("transformPasted",v=>{a=v(a,t,!1)}):a=h6(t,k6(e.dataTransfer),Uv?null:e.dataTransfer.getData("text/html"),!1,i);let s=!!(r&&C6(t,e));if(t.someProp("handleDrop",v=>v(t,e,a||Nt.empty,s))){e.preventDefault();return}if(!a)return;e.preventDefault();let o=a?PO(t.state.doc,i.pos,a):i.pos;o==null&&(o=i.pos);let l=t.state.tr;if(s){let{node:v}=r;v?v.replace(l):l.deleteSelection()}let u=l.mapping.map(o),c=a.openStart==0&&a.openEnd==0&&a.content.childCount==1,f=l.doc;if(c?l.replaceRangeWith(u,u,a.content.firstChild):l.replaceRange(u,u,a),l.doc.eq(f))return;let p=l.doc.resolve(u);if(c&&Yt.isSelectable(a.content.firstChild)&&p.nodeAfter&&p.nodeAfter.sameMarkup(a.content.firstChild))l.setSelection(new Yt(p));else{let v=l.mapping.map(o);l.mapping.maps[l.mapping.maps.length-1].forEach((y,S,w,T)=>v=T),l.setSelection(sC(t,p,l.doc.resolve(v)))}t.focus(),t.dispatch(l.setMeta("uiEvent","drop"))}Cs.focus=t=>{t.input.lastFocus=Date.now(),t.focused||(t.domObserver.stop(),t.dom.classList.add("ProseMirror-focused"),t.domObserver.start(),t.focused=!0,setTimeout(()=>{t.docView&&t.hasFocus()&&!t.domObserver.currentSelection.eq(t.domSelectionRange())&&vc(t)},20))};Cs.blur=(t,e)=>{let r=e;t.focused&&(t.domObserver.stop(),t.dom.classList.remove("ProseMirror-focused"),t.domObserver.start(),r.relatedTarget&&t.dom.contains(r.relatedTarget)&&t.domObserver.currentSelection.clear(),t.focused=!1)};Cs.beforeinput=(t,e)=>{if(ua&&pc&&e.inputType=="deleteContentBackward"){t.domObserver.flushSoon();let{domChangeCount:n}=t.input;setTimeout(()=>{if(t.input.domChangeCount!=n||(t.dom.blur(),t.focus(),t.someProp("handleKeyDown",a=>a(t,nh(8,"Backspace")))))return;let{$cursor:i}=t.state.selection;i&&i.pos>0&&t.dispatch(t.state.tr.delete(i.pos-1,i.pos).scrollIntoView())},50)}};for(let t in Es)Cs[t]=Es[t];function Vv(t,e){if(t==e)return!0;for(let r in t)if(t[r]!==e[r])return!1;for(let r in e)if(!(r in t))return!1;return!0}class Ix{constructor(e,r){this.toDOM=e,this.spec=r||fh,this.side=this.spec.side||0}map(e,r,n,i){let{pos:a,deleted:s}=e.mapResult(r.from+i,this.side<0?-1:1);return s?null:new ns(a-n,a-n,this)}valid(){return!0}eq(e){return this==e||e instanceof Ix&&(this.spec.key&&this.spec.key==e.spec.key||this.toDOM==e.toDOM&&Vv(this.spec,e.spec))}destroy(e){this.spec.destroy&&this.spec.destroy(e)}}class Yd{constructor(e,r){this.attrs=e,this.spec=r||fh}map(e,r,n,i){let a=e.map(r.from+i,this.spec.inclusiveStart?-1:1)-n,s=e.map(r.to+i,this.spec.inclusiveEnd?1:-1)-n;return a>=s?null:new ns(a,s,this)}valid(e,r){return r.from<r.to}eq(e){return this==e||e instanceof Yd&&Vv(this.attrs,e.attrs)&&Vv(this.spec,e.spec)}static is(e){return e.type instanceof Yd}destroy(){}}class dC{constructor(e,r){this.attrs=e,this.spec=r||fh}map(e,r,n,i){let a=e.mapResult(r.from+i,1);if(a.deleted)return null;let s=e.mapResult(r.to+i,-1);return s.deleted||s.pos<=a.pos?null:new ns(a.pos-n,s.pos-n,this)}valid(e,r){let{index:n,offset:i}=e.content.findIndex(r.from),a;return i==r.from&&!(a=e.child(n)).isText&&i+a.nodeSize==r.to}eq(e){return this==e||e instanceof dC&&Vv(this.attrs,e.attrs)&&Vv(this.spec,e.spec)}destroy(){}}class ns{constructor(e,r,n){this.from=e,this.to=r,this.type=n}copy(e,r){return new ns(e,r,this.type)}eq(e,r=0){return this.type.eq(e.type)&&this.from+r==e.from&&this.to+r==e.to}map(e,r,n){return this.type.map(e,this,r,n)}static widget(e,r,n){return new ns(e,e,new Ix(r,n))}static inline(e,r,n,i){return new ns(e,r,new Yd(n,i))}static node(e,r,n,i){return new ns(e,r,new dC(n,i))}get spec(){return this.type.spec}get inline(){return this.type instanceof Yd}get widget(){return this.type instanceof Ix}}const Ap=[],fh={};class Un{constructor(e,r){this.local=e.length?e:Ap,this.children=r.length?r:Ap}static create(e,r){return r.length?jx(r,e,0,fh):rs}find(e,r,n){let i=[];return this.findInner(e??0,r??1e9,i,0,n),i}findInner(e,r,n,i,a){for(let s=0;s<this.local.length;s++){let o=this.local[s];o.from<=r&&o.to>=e&&(!a||a(o.spec))&&n.push(o.copy(o.from+i,o.to+i))}for(let s=0;s<this.children.length;s+=3)if(this.children[s]<r&&this.children[s+1]>e){let o=this.children[s]+1;this.children[s+2].findInner(e-o,r-o,n,i+o,a)}}map(e,r,n){return this==rs||e.maps.length==0?this:this.mapInner(e,r,0,0,n||fh)}mapInner(e,r,n,i,a){let s;for(let o=0;o<this.local.length;o++){let l=this.local[o].map(e,n,i);l&&l.type.valid(r,l)?(s||(s=[])).push(l):a.onRemove&&a.onRemove(this.local[o].spec)}return this.children.length?SQ(this.children,s||[],e,r,n,i,a):s?new Un(s.sort(hh),Ap):rs}add(e,r){return r.length?this==rs?Un.create(e,r):this.addInner(e,r,0):this}addInner(e,r,n){let i,a=0;e.forEach((o,l)=>{let u=l+n,c;if(c=T6(r,o,u)){for(i||(i=this.children.slice());a<i.length&&i[a]<l;)a+=3;i[a]==l?i[a+2]=i[a+2].addInner(o,c,u+1):i.splice(a,0,l,l+o.nodeSize,jx(c,o,u+1,fh)),a+=3}});let s=E6(a?N6(r):r,-n);for(let o=0;o<s.length;o++)s[o].type.valid(e,s[o])||s.splice(o--,1);return new Un(s.length?this.local.concat(s).sort(hh):this.local,i||this.children)}remove(e){return e.length==0||this==rs?this:this.removeInner(e,0)}removeInner(e,r){let n=this.children,i=this.local;for(let a=0;a<n.length;a+=3){let s,o=n[a]+r,l=n[a+1]+r;for(let c=0,f;c<e.length;c++)(f=e[c])&&f.from>o&&f.to<l&&(e[c]=null,(s||(s=[])).push(f));if(!s)continue;n==this.children&&(n=this.children.slice());let u=n[a+2].removeInner(s,o+1);u!=rs?n[a+2]=u:(n.splice(a,3),a-=3)}if(i.length){for(let a=0,s;a<e.length;a++)if(s=e[a])for(let o=0;o<i.length;o++)i[o].eq(s,r)&&(i==this.local&&(i=this.local.slice()),i.splice(o--,1))}return n==this.children&&i==this.local?this:i.length||n.length?new Un(i,n):rs}forChild(e,r){if(this==rs)return this;if(r.isLeaf)return Un.empty;let n,i;for(let o=0;o<this.children.length;o+=3)if(this.children[o]>=e){this.children[o]==e&&(n=this.children[o+2]);break}let a=e+1,s=a+r.content.size;for(let o=0;o<this.local.length;o++){let l=this.local[o];if(l.from<s&&l.to>a&&l.type instanceof Yd){let u=Math.max(a,l.from)-a,c=Math.min(s,l.to)-a;u<c&&(i||(i=[])).push(l.copy(u,c))}}if(i){let o=new Un(i.sort(hh),Ap);return n?new Ld([o,n]):o}return n||rs}eq(e){if(this==e)return!0;if(!(e instanceof Un)||this.local.length!=e.local.length||this.children.length!=e.children.length)return!1;for(let r=0;r<this.local.length;r++)if(!this.local[r].eq(e.local[r]))return!1;for(let r=0;r<this.children.length;r+=3)if(this.children[r]!=e.children[r]||this.children[r+1]!=e.children[r+1]||!this.children[r+2].eq(e.children[r+2]))return!1;return!0}locals(e){return fC(this.localsInner(e))}localsInner(e){if(this==rs)return Ap;if(e.inlineContent||!this.local.some(Yd.is))return this.local;let r=[];for(let n=0;n<this.local.length;n++)this.local[n].type instanceof Yd||r.push(this.local[n]);return r}forEachSet(e){e(this)}}Un.empty=new Un([],[]);Un.removeOverlap=fC;const rs=Un.empty;class Ld{constructor(e){this.members=e}map(e,r){const n=this.members.map(i=>i.map(e,r,fh));return Ld.from(n)}forChild(e,r){if(r.isLeaf)return Un.empty;let n=[];for(let i=0;i<this.members.length;i++){let a=this.members[i].forChild(e,r);a!=rs&&(a instanceof Ld?n=n.concat(a.members):n.push(a))}return Ld.from(n)}eq(e){if(!(e instanceof Ld)||e.members.length!=this.members.length)return!1;for(let r=0;r<this.members.length;r++)if(!this.members[r].eq(e.members[r]))return!1;return!0}locals(e){let r,n=!0;for(let i=0;i<this.members.length;i++){let a=this.members[i].localsInner(e);if(a.length)if(!r)r=a;else{n&&(r=r.slice(),n=!1);for(let s=0;s<a.length;s++)r.push(a[s])}}return r?fC(n?r:r.sort(hh)):Ap}static from(e){switch(e.length){case 0:return rs;case 1:return e[0];default:return new Ld(e.every(r=>r instanceof Un)?e:e.reduce((r,n)=>r.concat(n instanceof Un?n:n.members),[]))}}forEachSet(e){for(let r=0;r<this.members.length;r++)this.members[r].forEachSet(e)}}function SQ(t,e,r,n,i,a,s){let o=t.slice();for(let u=0,c=a;u<r.maps.length;u++){let f=0;r.maps[u].forEach((p,v,y,S)=>{let w=S-y-(v-p);for(let T=0;T<o.length;T+=3){let _=o[T+1];if(_<0||p>_+c-f)continue;let C=o[T]+c-f;v>=C?o[T+1]=p<=C?-2:-1:p>=c&&w&&(o[T]+=w,o[T+1]+=w)}f+=w}),c=r.maps[u].map(c,-1)}let l=!1;for(let u=0;u<o.length;u+=3)if(o[u+1]<0){if(o[u+1]==-2){l=!0,o[u+1]=-1;continue}let c=r.map(t[u]+a),f=c-i;if(f<0||f>=n.content.size){l=!0;continue}let p=r.map(t[u+1]+a,-1),v=p-i,{index:y,offset:S}=n.content.findIndex(f),w=n.maybeChild(y);if(w&&S==f&&S+w.nodeSize==v){let T=o[u+2].mapInner(r,w,c+1,t[u]+a+1,s);T!=rs?(o[u]=f,o[u+1]=v,o[u+2]=T):(o[u+1]=-2,l=!0)}else l=!0}if(l){let u=kQ(o,t,e,r,i,a,s),c=jx(u,n,0,s);e=c.local;for(let f=0;f<o.length;f+=3)o[f+1]<0&&(o.splice(f,3),f-=3);for(let f=0,p=0;f<c.children.length;f+=3){let v=c.children[f];for(;p<o.length&&o[p]<v;)p+=3;o.splice(p,0,c.children[f],c.children[f+1],c.children[f+2])}}return new Un(e.sort(hh),o)}function E6(t,e){if(!e||!t.length)return t;let r=[];for(let n=0;n<t.length;n++){let i=t[n];r.push(new ns(i.from+e,i.to+e,i.type))}return r}function kQ(t,e,r,n,i,a,s){function o(l,u){for(let c=0;c<l.local.length;c++){let f=l.local[c].map(n,i,u);f?r.push(f):s.onRemove&&s.onRemove(l.local[c].spec)}for(let c=0;c<l.children.length;c+=3)o(l.children[c+2],l.children[c]+u+1)}for(let l=0;l<t.length;l+=3)t[l+1]==-1&&o(t[l+2],e[l]+a+1);return r}function T6(t,e,r){if(e.isLeaf)return null;let n=r+e.nodeSize,i=null;for(let a=0,s;a<t.length;a++)(s=t[a])&&s.from>r&&s.to<n&&((i||(i=[])).push(s),t[a]=null);return i}function N6(t){let e=[];for(let r=0;r<t.length;r++)t[r]!=null&&e.push(t[r]);return e}function jx(t,e,r,n){let i=[],a=!1;e.forEach((o,l)=>{let u=T6(t,o,l+r);if(u){a=!0;let c=jx(u,o,r+l+1,n);c!=rs&&i.push(l,l+o.nodeSize,c)}});let s=E6(a?N6(t):t,-r).sort(hh);for(let o=0;o<s.length;o++)s[o].type.valid(e,s[o])||(n.onRemove&&n.onRemove(s[o].spec),s.splice(o--,1));return s.length||i.length?new Un(s,i):rs}function hh(t,e){return t.from-e.from||t.to-e.to}function fC(t){let e=t;for(let r=0;r<e.length-1;r++){let n=e[r];if(n.from!=n.to)for(let i=r+1;i<e.length;i++){let a=e[i];if(a.from==n.from){a.to!=n.to&&(e==t&&(e=t.slice()),e[i]=a.copy(a.from,n.to),gP(e,i+1,a.copy(n.to,a.to)));continue}else{a.from<n.to&&(e==t&&(e=t.slice()),e[r]=n.copy(n.from,a.from),gP(e,i,n.copy(a.from,n.to)));break}}}return e}function gP(t,e,r){for(;e<t.length&&hh(r,t[e])>0;)e++;t.splice(e,0,r)}function dS(t){let e=[];return t.someProp("decorations",r=>{let n=r(t.state);n&&n!=rs&&e.push(n)}),t.cursorWrapper&&e.push(Un.create(t.state.doc,[t.cursorWrapper.deco])),Ld.from(e)}const _Q={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},CQ=qs&&Kd<=11;class EQ{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}set(e){this.anchorNode=e.anchorNode,this.anchorOffset=e.anchorOffset,this.focusNode=e.focusNode,this.focusOffset=e.focusOffset}clear(){this.anchorNode=this.focusNode=null}eq(e){return e.anchorNode==this.anchorNode&&e.anchorOffset==this.anchorOffset&&e.focusNode==this.focusNode&&e.focusOffset==this.focusOffset}}class TQ{constructor(e,r){this.view=e,this.handleDOMChange=r,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new EQ,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.lastChangedTextNode=null,this.observer=window.MutationObserver&&new window.MutationObserver(n=>{for(let i=0;i<n.length;i++)this.queue.push(n[i]);qs&&Kd<=11&&n.some(i=>i.type=="childList"&&i.removedNodes.length||i.type=="characterData"&&i.oldValue.length>i.target.nodeValue.length)?this.flushSoon():Ba&&e.composing&&n.some(i=>i.type=="childList"&&i.target.nodeName=="TR")?(e.input.badSafariComposition=!0,this.flushSoon()):this.flush()}),CQ&&(this.onCharData=n=>{this.queue.push({target:n.target,type:"characterData",oldValue:n.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}flushSoon(){this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(()=>{this.flushingSoon=-1,this.flush()},20))}forceFlush(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}start(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,_Q)),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()}stop(){if(this.observer){let e=this.observer.takeRecords();if(e.length){for(let r=0;r<e.length;r++)this.queue.push(e[r]);window.setTimeout(()=>this.flush(),20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()}connectSelection(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}disconnectSelection(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)}suppressSelectionUpdates(){this.suppressingSelectionUpdates=!0,setTimeout(()=>this.suppressingSelectionUpdates=!1,50)}onSelectionChange(){if(lP(this.view)){if(this.suppressingSelectionUpdates)return vc(this.view);if(qs&&Kd<=11&&!this.view.state.selection.empty){let e=this.view.domSelectionRange();if(e.focusNode&&Eh(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset))return this.flushSoon()}this.flush()}}setCurSelection(){this.currentSelection.set(this.view.domSelectionRange())}ignoreSelectionChange(e){if(!e.focusNode)return!0;let r=new Set,n;for(let a=e.focusNode;a;a=em(a))r.add(a);for(let a=e.anchorNode;a;a=em(a))if(r.has(a)){n=a;break}let i=n&&this.view.docView.nearestDesc(n);if(i&&i.ignoreMutation({type:"selection",target:n.nodeType==3?n.parentNode:n}))return this.setCurSelection(),!0}pendingRecords(){if(this.observer)for(let e of this.observer.takeRecords())this.queue.push(e);return this.queue}flush(){let{view:e}=this;if(!e.docView||this.flushingSoon>-1)return;let r=this.pendingRecords();r.length&&(this.queue=[]);let n=e.domSelectionRange(),i=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(n)&&lP(e)&&!this.ignoreSelectionChange(n),a=-1,s=-1,o=!1,l=[];if(e.editable)for(let c=0;c<r.length;c++){let f=this.registerMutation(r[c],l);f&&(a=a<0?f.from:Math.min(f.from,a),s=s<0?f.to:Math.max(f.to,s),f.typeOver&&(o=!0))}if(Ho&&l.length){let c=l.filter(f=>f.nodeName=="BR");if(c.length==2){let[f,p]=c;f.parentNode&&f.parentNode.parentNode==p.parentNode?p.remove():f.remove()}else{let{focusNode:f}=this.currentSelection;for(let p of c){let v=p.parentNode;v&&v.nodeName=="LI"&&(!f||MQ(e,f)!=v)&&p.remove()}}}else if((ua||Ba)&&l.some(c=>c.nodeName=="BR")&&(e.input.lastKeyCode==8||e.input.lastKeyCode==46)){for(let c of l)if(c.nodeName=="BR"&&c.parentNode){let f=c.nextSibling;f&&f.nodeType==1&&f.contentEditable=="false"&&c.parentNode.removeChild(c)}}let u=null;a<0&&i&&e.input.lastFocus>Date.now()-200&&Math.max(e.input.lastTouch,e.input.lastClick.time)<Date.now()-300&&Q1(n)&&(u=aC(e))&&u.eq(yr.near(e.state.doc.resolve(0),1))?(e.input.lastFocus=0,vc(e),this.currentSelection.set(n),e.scrollToSelection()):(a>-1||i)&&(a>-1&&(e.docView.markDirty(a,s),NQ(e)),e.input.badSafariComposition&&(e.input.badSafariComposition=!1,AQ(e,l)),this.handleDOMChange(a,s,o,l),e.docView&&e.docView.dirty?e.updateState(e.state):this.currentSelection.eq(n)||vc(e),this.currentSelection.set(n))}registerMutation(e,r){if(r.indexOf(e.target)>-1)return null;let n=this.view.docView.nearestDesc(e.target);if(e.type=="attributes"&&(n==this.view.docView||e.attributeName=="contenteditable"||e.attributeName=="style"&&!e.oldValue&&!e.target.getAttribute("style"))||!n||n.ignoreMutation(e))return null;if(e.type=="childList"){for(let c=0;c<e.addedNodes.length;c++){let f=e.addedNodes[c];r.push(f),f.nodeType==3&&(this.lastChangedTextNode=f)}if(n.contentDOM&&n.contentDOM!=n.dom&&!n.contentDOM.contains(e.target))return{from:n.posBefore,to:n.posAfter};let i=e.previousSibling,a=e.nextSibling;if(qs&&Kd<=11&&e.addedNodes.length)for(let c=0;c<e.addedNodes.length;c++){let{previousSibling:f,nextSibling:p}=e.addedNodes[c];(!f||Array.prototype.indexOf.call(e.addedNodes,f)<0)&&(i=f),(!p||Array.prototype.indexOf.call(e.addedNodes,p)<0)&&(a=p)}let s=i&&i.parentNode==e.target?Da(i)+1:0,o=n.localPosFromDOM(e.target,s,-1),l=a&&a.parentNode==e.target?Da(a):e.target.childNodes.length,u=n.localPosFromDOM(e.target,l,1);return{from:o,to:u}}else return e.type=="attributes"?{from:n.posAtStart-n.border,to:n.posAtEnd+n.border}:(this.lastChangedTextNode=e.target,{from:n.posAtStart,to:n.posAtEnd,typeOver:e.target.nodeValue==e.oldValue})}}let vP=new WeakMap,yP=!1;function NQ(t){if(!vP.has(t)&&(vP.set(t,null),["normal","nowrap","pre-line"].indexOf(getComputedStyle(t.dom).whiteSpace)!==-1)){if(t.requiresGeckoHackNode=Ho,yP)return;console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."),yP=!0}}function xP(t,e){let r=e.startContainer,n=e.startOffset,i=e.endContainer,a=e.endOffset,s=t.domAtPos(t.state.selection.anchor);return Eh(s.node,s.offset,i,a)&&([r,n,i,a]=[i,a,r,n]),{anchorNode:r,anchorOffset:n,focusNode:i,focusOffset:a}}function PQ(t,e){if(e.getComposedRanges){let i=e.getComposedRanges(t.root)[0];if(i)return xP(t,i)}let r;function n(i){i.preventDefault(),i.stopImmediatePropagation(),r=i.getTargetRanges()[0]}return t.dom.addEventListener("beforeinput",n,!0),document.execCommand("indent"),t.dom.removeEventListener("beforeinput",n,!0),r?xP(t,r):null}function MQ(t,e){for(let r=e.parentNode;r&&r!=t.dom;r=r.parentNode){let n=t.docView.nearestDesc(r,!0);if(n&&n.node.isBlock)return r}return null}function AQ(t,e){var r;let{focusNode:n,focusOffset:i}=t.domSelectionRange();for(let a of e)if(((r=a.parentNode)===null||r===void 0?void 0:r.nodeName)=="TR"){let s=a.nextSibling;for(;s&&s.nodeName!="TD"&&s.nodeName!="TH";)s=s.nextSibling;if(s){let o=s;for(;;){let l=o.firstChild;if(!l||l.nodeType!=1||l.contentEditable=="false"||/^(BR|IMG)$/.test(l.nodeName))break;o=l}o.insertBefore(a,o.firstChild),n==a&&t.domSelection().collapse(a,i)}else a.parentNode.removeChild(a)}}function LQ(t,e,r){let{node:n,fromOffset:i,toOffset:a,from:s,to:o}=t.docView.parseRange(e,r),l=t.domSelectionRange(),u,c=l.anchorNode;if(c&&t.dom.contains(c.nodeType==1?c:c.parentNode)&&(u=[{node:c,offset:l.anchorOffset}],Q1(l)||u.push({node:l.focusNode,offset:l.focusOffset})),ua&&t.input.lastKeyCode===8)for(let w=a;w>i;w--){let T=n.childNodes[w-1],_=T.pmViewDesc;if(T.nodeName=="BR"&&!_){a=w;break}if(!_||_.size)break}let f=t.state.doc,p=t.someProp("domParser")||$d.fromSchema(t.state.schema),v=f.resolve(s),y=null,S=p.parse(n,{topNode:v.parent,topMatch:v.parent.contentMatchAt(v.index()),topOpen:!0,from:i,to:a,preserveWhitespace:v.parent.type.whitespace=="pre"?"full":!0,findPositions:u,ruleFromNode:RQ,context:v});if(u&&u[0].pos!=null){let w=u[0].pos,T=u[1]&&u[1].pos;T==null&&(T=w),y={anchor:w+s,head:T+s}}return{doc:S,sel:y,from:s,to:o}}function RQ(t){let e=t.pmViewDesc;if(e)return e.parseRule();if(t.nodeName=="BR"&&t.parentNode){if(Ba&&/^(ul|ol)$/i.test(t.parentNode.nodeName)){let r=document.createElement("div");return r.appendChild(document.createElement("li")),{skip:r}}else if(t.parentNode.lastChild==t||Ba&&/^(tr|table)$/i.test(t.parentNode.nodeName))return{ignore:!0}}else if(t.nodeName=="IMG"&&t.getAttribute("mark-placeholder"))return{ignore:!0};return null}const OQ=/^(a|abbr|acronym|b|bd[io]|big|br|button|cite|code|data(list)?|del|dfn|em|i|img|ins|kbd|label|map|mark|meter|output|q|ruby|s|samp|small|span|strong|su[bp]|time|u|tt|var)$/i;function DQ(t,e,r,n,i){let a=t.input.compositionPendingChanges||(t.composing?t.input.compositionID:0);if(t.input.compositionPendingChanges=0,e<0){let j=t.input.lastSelectionTime>Date.now()-50?t.input.lastSelectionOrigin:null,D=aC(t,j);if(D&&!t.state.selection.eq(D)){if(ua&&pc&&t.input.lastKeyCode===13&&Date.now()-100<t.input.lastKeyCodeTime&&t.someProp("handleKeyDown",B=>B(t,nh(13,"Enter"))))return;let F=t.state.tr.setSelection(D);j=="pointer"?F.setMeta("pointer",!0):j=="key"&&F.scrollIntoView(),a&&F.setMeta("composition",a),t.dispatch(F)}return}let s=t.state.doc.resolve(e),o=s.sharedDepth(r);e=s.before(o+1),r=t.state.doc.resolve(r).after(o+1);let l=t.state.selection,u=LQ(t,e,r),c=t.state.doc,f=c.slice(u.from,u.to),p,v;t.input.lastKeyCode===8&&Date.now()-100<t.input.lastKeyCodeTime?(p=t.state.selection.to,v="end"):(p=t.state.selection.from,v="start"),t.input.lastKeyCode=null;let y=FQ(f.content,u.doc.content,u.from,p,v);if(y&&t.input.domChangeCount++,(tm&&t.input.lastIOSEnter>Date.now()-225||pc)&&i.some(j=>j.nodeType==1&&!OQ.test(j.nodeName))&&(!y||y.endA>=y.endB)&&t.someProp("handleKeyDown",j=>j(t,nh(13,"Enter")))){t.input.lastIOSEnter=0;return}if(!y)if(n&&l instanceof cr&&!l.empty&&l.$head.sameParent(l.$anchor)&&!t.composing&&!(u.sel&&u.sel.anchor!=u.sel.head))y={start:l.from,endA:l.to,endB:l.to};else{if(u.sel){let j=bP(t,t.state.doc,u.sel);if(j&&!j.eq(t.state.selection)){let D=t.state.tr.setSelection(j);a&&D.setMeta("composition",a),t.dispatch(D)}}return}t.state.selection.from<t.state.selection.to&&y.start==y.endB&&t.state.selection instanceof cr&&(y.start>t.state.selection.from&&y.start<=t.state.selection.from+2&&t.state.selection.from>=u.from?y.start=t.state.selection.from:y.endA<t.state.selection.to&&y.endA>=t.state.selection.to-2&&t.state.selection.to<=u.to&&(y.endB+=t.state.selection.to-y.endA,y.endA=t.state.selection.to)),qs&&Kd<=11&&y.endB==y.start+1&&y.endA==y.start&&y.start>u.from&&u.doc.textBetween(y.start-u.from-1,y.start-u.from+1)==" "&&(y.start--,y.endA--,y.endB--);let S=u.doc.resolveNoCache(y.start-u.from),w=u.doc.resolveNoCache(y.endB-u.from),T=c.resolve(y.start),_=S.sameParent(w)&&S.parent.inlineContent&&T.end()>=y.endA;if((tm&&t.input.lastIOSEnter>Date.now()-225&&(!_||i.some(j=>j.nodeName=="DIV"||j.nodeName=="P"))||!_&&S.pos<u.doc.content.size&&(!S.sameParent(w)||!S.parent.inlineContent)&&S.pos<w.pos&&!/\S/.test(u.doc.textBetween(S.pos,w.pos,"","")))&&t.someProp("handleKeyDown",j=>j(t,nh(13,"Enter")))){t.input.lastIOSEnter=0;return}if(t.state.selection.anchor>y.start&&jQ(c,y.start,y.endA,S,w)&&t.someProp("handleKeyDown",j=>j(t,nh(8,"Backspace")))){pc&&ua&&t.domObserver.suppressSelectionUpdates();return}ua&&y.endB==y.start&&(t.input.lastChromeDelete=Date.now()),pc&&!_&&S.start()!=w.start()&&w.parentOffset==0&&S.depth==w.depth&&u.sel&&u.sel.anchor==u.sel.head&&u.sel.head==y.endA&&(y.endB-=2,w=u.doc.resolveNoCache(y.endB-u.from),setTimeout(()=>{t.someProp("handleKeyDown",function(j){return j(t,nh(13,"Enter"))})},20));let C=y.start,N=y.endA,A=j=>{let D=j||t.state.tr.replace(C,N,u.doc.slice(y.start-u.from,y.endB-u.from));if(u.sel){let F=bP(t,D.doc,u.sel);F&&!(ua&&t.composing&&F.empty&&(y.start!=y.endB||t.input.lastChromeDelete<Date.now()-100)&&(F.head==C||F.head==D.mapping.map(N)-1)||qs&&F.empty&&F.head==C)&&D.setSelection(F)}return a&&D.setMeta("composition",a),D.scrollIntoView()},O;if(_)if(S.pos==w.pos){qs&&Kd<=11&&S.parentOffset==0&&(t.domObserver.suppressSelectionUpdates(),setTimeout(()=>vc(t),20));let j=A(t.state.tr.delete(C,N)),D=c.resolve(y.start).marksAcross(c.resolve(y.endA));D&&j.ensureMarks(D),t.dispatch(j)}else if(y.endA==y.endB&&(O=IQ(S.parent.content.cut(S.parentOffset,w.parentOffset),T.parent.content.cut(T.parentOffset,y.endA-T.start())))){let j=A(t.state.tr);O.type=="add"?j.addMark(C,N,O.mark):j.removeMark(C,N,O.mark),t.dispatch(j)}else if(S.parent.child(S.index()).isText&&S.index()==w.index()-(w.textOffset?0:1)){let j=S.parent.textBetween(S.parentOffset,w.parentOffset),D=()=>A(t.state.tr.insertText(j,C,N));t.someProp("handleTextInput",F=>F(t,C,N,j,D))||t.dispatch(D())}else t.dispatch(A());else t.dispatch(A())}function bP(t,e,r){return Math.max(r.anchor,r.head)>e.content.size?null:sC(t,e.resolve(r.anchor),e.resolve(r.head))}function IQ(t,e){let r=t.firstChild.marks,n=e.firstChild.marks,i=r,a=n,s,o,l;for(let c=0;c<n.length;c++)i=n[c].removeFromSet(i);for(let c=0;c<r.length;c++)a=r[c].removeFromSet(a);if(i.length==1&&a.length==0)o=i[0],s="add",l=c=>c.mark(o.addToSet(c.marks));else if(i.length==0&&a.length==1)o=a[0],s="remove",l=c=>c.mark(o.removeFromSet(c.marks));else return null;let u=[];for(let c=0;c<e.childCount;c++)u.push(l(e.child(c)));if(rt.from(u).eq(t))return{mark:o,type:s}}function jQ(t,e,r,n,i){if(r-e<=i.pos-n.pos||fS(n,!0,!1)<i.pos)return!1;let a=t.resolve(e);if(!n.parent.isTextblock){let o=a.nodeAfter;return o!=null&&r==e+o.nodeSize}if(a.parentOffset<a.parent.content.size||!a.parent.isTextblock)return!1;let s=t.resolve(fS(a,!0,!0));return!s.parent.isTextblock||s.pos>r||fS(s,!0,!1)<r?!1:n.parent.content.cut(n.parentOffset).eq(s.parent.content)}function fS(t,e,r){let n=t.depth,i=e?t.end():t.pos;for(;n>0&&(e||t.indexAfter(n)==t.node(n).childCount);)n--,i++,e=!1;if(r){let a=t.node(n).maybeChild(t.indexAfter(n));for(;a&&!a.isLeaf;)a=a.firstChild,i++}return i}function FQ(t,e,r,n,i){let a=t.findDiffStart(e,r);if(a==null)return null;let{a:s,b:o}=t.findDiffEnd(e,r+t.size,r+e.size);if(i=="end"){let l=Math.max(0,a-Math.min(s,o));n-=s+l-a}if(s<a&&t.size<e.size){let l=n<=a&&n>=s?a-n:0;a-=l,a&&a<e.size&&wP(e.textBetween(a-1,a+1))&&(a+=l?1:-1),o=a+(o-s),s=a}else if(o<a){let l=n<=a&&n>=o?a-n:0;a-=l,a&&a<t.size&&wP(t.textBetween(a-1,a+1))&&(a+=l?1:-1),s=a+(s-o),o=a}return{start:a,endA:s,endB:o}}function wP(t){if(t.length!=2)return!1;let e=t.charCodeAt(0),r=t.charCodeAt(1);return e>=56320&&e<=57343&&r>=55296&&r<=56319}class P6{constructor(e,r){this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new eQ,this.prevDirectPlugins=[],this.pluginViews=[],this.requiresGeckoHackNode=!1,this.dragging=null,this._props=r,this.state=r.state,this.directPlugins=r.plugins||[],this.directPlugins.forEach(EP),this.dispatch=this.dispatch.bind(this),this.dom=e&&e.mount||document.createElement("div"),e&&(e.appendChild?e.appendChild(this.dom):typeof e=="function"?e(this.dom):e.mount&&(this.mounted=!0)),this.editable=_P(this),kP(this),this.nodeViews=CP(this),this.docView=rP(this.state.doc,SP(this),dS(this),this.dom,this),this.domObserver=new TQ(this,(n,i,a,s)=>DQ(this,n,i,a,s)),this.domObserver.start(),tQ(this),this.updatePluginViews()}get composing(){return this.input.composing}get props(){if(this._props.state!=this.state){let e=this._props;this._props={};for(let r in e)this._props[r]=e[r];this._props.state=this.state}return this._props}update(e){e.handleDOMEvents!=this._props.handleDOMEvents&&Lk(this);let r=this._props;this._props=e,e.plugins&&(e.plugins.forEach(EP),this.directPlugins=e.plugins),this.updateStateInner(e.state,r)}setProps(e){let r={};for(let n in this._props)r[n]=this._props[n];r.state=this.state;for(let n in e)r[n]=e[n];this.update(r)}updateState(e){this.updateStateInner(e,this._props)}updateStateInner(e,r){var n;let i=this.state,a=!1,s=!1;e.storedMarks&&this.composing&&(S6(this),s=!0),this.state=e;let o=i.plugins!=e.plugins||this._props.plugins!=r.plugins;if(o||this._props.plugins!=r.plugins||this._props.nodeViews!=r.nodeViews){let v=CP(this);zQ(v,this.nodeViews)&&(this.nodeViews=v,a=!0)}(o||r.handleDOMEvents!=this._props.handleDOMEvents)&&Lk(this),this.editable=_P(this),kP(this);let l=dS(this),u=SP(this),c=i.plugins!=e.plugins&&!i.doc.eq(e.doc)?"reset":e.scrollToSelection>i.scrollToSelection?"to selection":"preserve",f=a||!this.docView.matchesNode(e.doc,u,l);(f||!e.selection.eq(i.selection))&&(s=!0);let p=c=="preserve"&&s&&this.dom.style.overflowAnchor==null&&mX(this);if(s){this.domObserver.stop();let v=f&&(qs||ua)&&!this.composing&&!i.selection.empty&&!e.selection.empty&&BQ(i.selection,e.selection);if(f){let y=ua?this.trackWrites=this.domSelectionRange().focusNode:null;this.composing&&(this.input.compositionNode=mQ(this)),(a||!this.docView.update(e.doc,u,l,this))&&(this.docView.updateOuterDeco(u),this.docView.destroy(),this.docView=rP(e.doc,u,l,this.dom,this)),y&&(!this.trackWrites||!this.dom.contains(this.trackWrites))&&(v=!0)}v||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelectionRange())&&BX(this))?vc(this,v):(c6(this,e.selection),this.domObserver.setCurSelection()),this.domObserver.start()}this.updatePluginViews(i),!((n=this.dragging)===null||n===void 0)&&n.node&&!i.doc.eq(e.doc)&&this.updateDraggedNode(this.dragging,i),c=="reset"?this.dom.scrollTop=0:c=="to selection"?this.scrollToSelection():p&&gX(p)}scrollToSelection(){let e=this.domSelectionRange().focusNode;if(!(!e||!this.dom.contains(e.nodeType==1?e:e.parentNode))){if(!this.someProp("handleScrollToSelection",r=>r(this)))if(this.state.selection instanceof Yt){let r=this.docView.domAfterPos(this.state.selection.from);r.nodeType==1&&Y3(this,r.getBoundingClientRect(),e)}else Y3(this,this.coordsAtPos(this.state.selection.head,1),e)}}destroyPluginViews(){let e;for(;e=this.pluginViews.pop();)e.destroy&&e.destroy()}updatePluginViews(e){if(!e||e.plugins!=this.state.plugins||this.directPlugins!=this.prevDirectPlugins){this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(let r=0;r<this.directPlugins.length;r++){let n=this.directPlugins[r];n.spec.view&&this.pluginViews.push(n.spec.view(this))}for(let r=0;r<this.state.plugins.length;r++){let n=this.state.plugins[r];n.spec.view&&this.pluginViews.push(n.spec.view(this))}}else for(let r=0;r<this.pluginViews.length;r++){let n=this.pluginViews[r];n.update&&n.update(this,e)}}updateDraggedNode(e,r){let n=e.node,i=-1;if(this.state.doc.nodeAt(n.from)==n.node)i=n.from;else{let a=n.from+(this.state.doc.content.size-r.doc.content.size);(a>0&&this.state.doc.nodeAt(a))==n.node&&(i=a)}this.dragging=new _6(e.slice,e.move,i<0?void 0:Yt.create(this.state.doc,i))}someProp(e,r){let n=this._props&&this._props[e],i;if(n!=null&&(i=r?r(n):n))return i;for(let s=0;s<this.directPlugins.length;s++){let o=this.directPlugins[s].props[e];if(o!=null&&(i=r?r(o):o))return i}let a=this.state.plugins;if(a)for(let s=0;s<a.length;s++){let o=a[s].props[e];if(o!=null&&(i=r?r(o):o))return i}}hasFocus(){if(qs){let e=this.root.activeElement;if(e==this.dom)return!0;if(!e||!this.dom.contains(e))return!1;for(;e&&this.dom!=e&&this.dom.contains(e);){if(e.contentEditable=="false")return!1;e=e.parentElement}return!0}return this.root.activeElement==this.dom}focus(){this.domObserver.stop(),this.editable&&vX(this.dom),vc(this),this.domObserver.start()}get root(){let e=this._root;if(e==null){for(let r=this.dom.parentNode;r;r=r.parentNode)if(r.nodeType==9||r.nodeType==11&&r.host)return r.getSelection||(Object.getPrototypeOf(r).getSelection=()=>r.ownerDocument.getSelection()),this._root=r}return e||document}updateRoot(){this._root=null}posAtCoords(e){return SX(this,e)}coordsAtPos(e,r=1){return r6(this,e,r)}domAtPos(e,r=0){return this.docView.domFromPos(e,r)}nodeDOM(e){let r=this.docView.descAt(e);return r?r.nodeDOM:null}posAtDOM(e,r,n=-1){let i=this.docView.posFromDOM(e,r,n);if(i==null)throw new RangeError("DOM position not inside the editor");return i}endOfTextblock(e,r){return TX(this,r||this.state,e)}pasteHTML(e,r){return Gv(this,"",e,!1,r||new ClipboardEvent("paste"))}pasteText(e,r){return Gv(this,e,null,!0,r||new ClipboardEvent("paste"))}serializeForClipboard(e){return oC(this,e)}destroy(){this.docView&&(rQ(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],dS(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null,aX())}get isDestroyed(){return this.docView==null}dispatchEvent(e){return iQ(this,e)}domSelectionRange(){let e=this.domSelection();return e?Ba&&this.root.nodeType===11&&cX(this.dom.ownerDocument)==this.dom&&PQ(this,e)||e:{focusNode:null,focusOffset:0,anchorNode:null,anchorOffset:0}}domSelection(){return this.root.getSelection()}}P6.prototype.dispatch=function(t){let e=this._props.dispatchTransaction;e?e.call(this,t):this.updateState(this.state.apply(t))};function SP(t){let e=Object.create(null);return e.class="ProseMirror",e.contenteditable=String(t.editable),t.someProp("attributes",r=>{if(typeof r=="function"&&(r=r(t.state)),r)for(let n in r)n=="class"?e.class+=" "+r[n]:n=="style"?e.style=(e.style?e.style+";":"")+r[n]:!e[n]&&n!="contenteditable"&&n!="nodeName"&&(e[n]=String(r[n]))}),e.translate||(e.translate="no"),[ns.node(0,t.state.doc.content.size,e)]}function kP(t){if(t.markCursor){let e=document.createElement("img");e.className="ProseMirror-separator",e.setAttribute("mark-placeholder","true"),e.setAttribute("alt",""),t.cursorWrapper={dom:e,deco:ns.widget(t.state.selection.from,e,{raw:!0,marks:t.markCursor})}}else t.cursorWrapper=null}function _P(t){return!t.someProp("editable",e=>e(t.state)===!1)}function BQ(t,e){let r=Math.min(t.$anchor.sharedDepth(t.head),e.$anchor.sharedDepth(e.head));return t.$anchor.start(r)!=e.$anchor.start(r)}function CP(t){let e=Object.create(null);function r(n){for(let i in n)Object.prototype.hasOwnProperty.call(e,i)||(e[i]=n[i])}return t.someProp("nodeViews",r),t.someProp("markViews",r),e}function zQ(t,e){let r=0,n=0;for(let i in t){if(t[i]!=e[i])return!0;r++}for(let i in e)n++;return r!=n}function EP(t){if(t.spec.state||t.spec.filterTransaction||t.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}var af={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},Fx={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},UQ=typeof navigator<"u"&&/Mac/.test(navigator.platform),GQ=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);for(var Ia=0;Ia<10;Ia++)af[48+Ia]=af[96+Ia]=String(Ia);for(var Ia=1;Ia<=24;Ia++)af[Ia+111]="F"+Ia;for(var Ia=65;Ia<=90;Ia++)af[Ia]=String.fromCharCode(Ia+32),Fx[Ia]=String.fromCharCode(Ia);for(var hS in af)Fx.hasOwnProperty(hS)||(Fx[hS]=af[hS]);function VQ(t){var e=UQ&&t.metaKey&&t.shiftKey&&!t.ctrlKey&&!t.altKey||GQ&&t.shiftKey&&t.key&&t.key.length==1||t.key=="Unidentified",r=!e&&t.key||(t.shiftKey?Fx:af)[t.keyCode]||t.key||"Unidentified";return r=="Esc"&&(r="Escape"),r=="Del"&&(r="Delete"),r=="Left"&&(r="ArrowLeft"),r=="Up"&&(r="ArrowUp"),r=="Right"&&(r="ArrowRight"),r=="Down"&&(r="ArrowDown"),r}const HQ=typeof navigator<"u"&&/Mac|iP(hone|[oa]d)/.test(navigator.platform),WQ=typeof navigator<"u"&&/Win/.test(navigator.platform);function qQ(t){let e=t.split(/-(?!$)/),r=e[e.length-1];r=="Space"&&(r=" ");let n,i,a,s;for(let o=0;o<e.length-1;o++){let l=e[o];if(/^(cmd|meta|m)$/i.test(l))s=!0;else if(/^a(lt)?$/i.test(l))n=!0;else if(/^(c|ctrl|control)$/i.test(l))i=!0;else if(/^s(hift)?$/i.test(l))a=!0;else if(/^mod$/i.test(l))HQ?s=!0:i=!0;else throw new Error("Unrecognized modifier name: "+l)}return n&&(r="Alt-"+r),i&&(r="Ctrl-"+r),s&&(r="Meta-"+r),a&&(r="Shift-"+r),r}function $Q(t){let e=Object.create(null);for(let r in t)e[qQ(r)]=t[r];return e}function pS(t,e,r=!0){return e.altKey&&(t="Alt-"+t),e.ctrlKey&&(t="Ctrl-"+t),e.metaKey&&(t="Meta-"+t),r&&e.shiftKey&&(t="Shift-"+t),t}function KQ(t){return new Hn({props:{handleKeyDown:M6(t)}})}function M6(t){let e=$Q(t);return function(r,n){let i=VQ(n),a,s=e[pS(i,n)];if(s&&s(r.state,r.dispatch,r))return!0;if(i.length==1&&i!=" "){if(n.shiftKey){let o=e[pS(i,n,!1)];if(o&&o(r.state,r.dispatch,r))return!0}if((n.altKey||n.metaKey||n.ctrlKey)&&!(WQ&&n.ctrlKey&&n.altKey)&&(a=af[n.keyCode])&&a!=i){let o=e[pS(a,n)];if(o&&o(r.state,r.dispatch,r))return!0}}return!1}}var ZQ=Object.defineProperty,hC=(t,e)=>{for(var r in e)ZQ(t,r,{get:e[r],enumerable:!0})};function tb(t){const{state:e,transaction:r}=t;let{selection:n}=r,{doc:i}=r,{storedMarks:a}=r;return{...e,apply:e.apply.bind(e),applyTransaction:e.applyTransaction.bind(e),plugins:e.plugins,schema:e.schema,reconfigure:e.reconfigure.bind(e),toJSON:e.toJSON.bind(e),get storedMarks(){return a},get selection(){return n},get doc(){return i},get tr(){return n=r.selection,i=r.doc,a=r.storedMarks,r}}}var rb=class{constructor(t){this.editor=t.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=t.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:t,editor:e,state:r}=this,{view:n}=e,{tr:i}=r,a=this.buildProps(i);return Object.fromEntries(Object.entries(t).map(([s,o])=>[s,(...u)=>{const c=o(...u)(a);return!i.getMeta("preventDispatch")&&!this.hasCustomState&&n.dispatch(i),c}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(t,e=!0){const{rawCommands:r,editor:n,state:i}=this,{view:a}=n,s=[],o=!!t,l=t||i.tr,u=()=>(!o&&e&&!l.getMeta("preventDispatch")&&!this.hasCustomState&&a.dispatch(l),s.every(f=>f===!0)),c={...Object.fromEntries(Object.entries(r).map(([f,p])=>[f,(...y)=>{const S=this.buildProps(l,e),w=p(...y)(S);return s.push(w),c}])),run:u};return c}createCan(t){const{rawCommands:e,state:r}=this,n=!1,i=t||r.tr,a=this.buildProps(i,n);return{...Object.fromEntries(Object.entries(e).map(([o,l])=>[o,(...u)=>l(...u)({...a,dispatch:void 0})])),chain:()=>this.createChain(i,n)}}buildProps(t,e=!0){const{rawCommands:r,editor:n,state:i}=this,{view:a}=n,s={tr:t,editor:n,view:a,state:tb({state:i,transaction:t}),dispatch:e?()=>{}:void 0,chain:()=>this.createChain(t,e),can:()=>this.createCan(t),get commands(){return Object.fromEntries(Object.entries(r).map(([o,l])=>[o,(...u)=>l(...u)(s)]))}};return s}},A6={};hC(A6,{blur:()=>YQ,clearContent:()=>XQ,clearNodes:()=>QQ,command:()=>JQ,createParagraphNear:()=>eJ,cut:()=>tJ,deleteCurrentNode:()=>rJ,deleteNode:()=>nJ,deleteRange:()=>iJ,deleteSelection:()=>aJ,enter:()=>sJ,exitCode:()=>oJ,extendMarkRange:()=>lJ,first:()=>uJ,focus:()=>dJ,forEach:()=>fJ,insertContent:()=>hJ,insertContentAt:()=>gJ,joinBackward:()=>xJ,joinDown:()=>yJ,joinForward:()=>bJ,joinItemBackward:()=>wJ,joinItemForward:()=>SJ,joinTextblockBackward:()=>kJ,joinTextblockForward:()=>_J,joinUp:()=>vJ,keyboardShortcut:()=>EJ,lift:()=>TJ,liftEmptyBlock:()=>NJ,liftListItem:()=>PJ,newlineInCode:()=>MJ,resetAttributes:()=>AJ,scrollIntoView:()=>LJ,selectAll:()=>RJ,selectNodeBackward:()=>OJ,selectNodeForward:()=>DJ,selectParentNode:()=>IJ,selectTextblockEnd:()=>jJ,selectTextblockStart:()=>FJ,setContent:()=>BJ,setMark:()=>aee,setMeta:()=>see,setNode:()=>oee,setNodeSelection:()=>lee,setTextDirection:()=>uee,setTextSelection:()=>cee,sinkListItem:()=>dee,splitBlock:()=>fee,splitListItem:()=>hee,toggleList:()=>pee,toggleMark:()=>mee,toggleNode:()=>gee,toggleWrap:()=>vee,undoInputRule:()=>yee,unsetAllMarks:()=>xee,unsetMark:()=>bee,unsetTextDirection:()=>wee,updateAttributes:()=>See,wrapIn:()=>kee,wrapInList:()=>_ee});var YQ=()=>({editor:t,view:e})=>(requestAnimationFrame(()=>{var r;t.isDestroyed||(e.dom.blur(),(r=window?.getSelection())==null||r.removeAllRanges())}),!0),XQ=(t=!0)=>({commands:e})=>e.setContent("",{emitUpdate:t}),QQ=()=>({state:t,tr:e,dispatch:r})=>{const{selection:n}=e,{ranges:i}=n;return r&&i.forEach(({$from:a,$to:s})=>{t.doc.nodesBetween(a.pos,s.pos,(o,l)=>{if(o.type.isText)return;const{doc:u,mapping:c}=e,f=u.resolve(c.map(l)),p=u.resolve(c.map(l+o.nodeSize)),v=f.blockRange(p);if(!v)return;const y=bm(v);if(o.type.isTextblock){const{defaultType:S}=f.parent.contentMatchAt(f.index());e.setNodeMarkup(v.start,S)}(y||y===0)&&e.lift(v,y)})}),!0},JQ=t=>e=>t(e),eJ=()=>({state:t,dispatch:e})=>WO(t,e),tJ=(t,e)=>({editor:r,tr:n})=>{const{state:i}=r,a=i.doc.slice(t.from,t.to);n.deleteRange(t.from,t.to);const s=n.mapping.map(e);return n.insert(s,a.content),n.setSelection(new cr(n.doc.resolve(Math.max(s-1,0)))),!0},rJ=()=>({tr:t,dispatch:e})=>{const{selection:r}=t,n=r.$anchor.node();if(n.content.size>0)return!1;const i=t.selection.$anchor;for(let a=i.depth;a>0;a-=1)if(i.node(a).type===n.type){if(e){const o=i.before(a),l=i.after(a);t.delete(o,l).scrollIntoView()}return!0}return!1};function Ri(t,e){if(typeof t=="string"){if(!e.nodes[t])throw Error(`There is no node type named '${t}'. Maybe you forgot to add the extension?`);return e.nodes[t]}return t}var nJ=t=>({tr:e,state:r,dispatch:n})=>{const i=Ri(t,r.schema),a=e.selection.$anchor;for(let s=a.depth;s>0;s-=1)if(a.node(s).type===i){if(n){const l=a.before(s),u=a.after(s);e.delete(l,u).scrollIntoView()}return!0}return!1},iJ=t=>({tr:e,dispatch:r})=>{const{from:n,to:i}=t;return r&&e.delete(n,i),!0},aJ=()=>({state:t,dispatch:e})=>J_(t,e),sJ=()=>({commands:t})=>t.keyboardShortcut("Enter"),oJ=()=>({state:t,dispatch:e})=>HY(t,e);function pC(t){return Object.prototype.toString.call(t)==="[object RegExp]"}function Bx(t,e,r={strict:!0}){const n=Object.keys(e);return n.length?n.every(i=>r.strict?e[i]===t[i]:pC(e[i])?e[i].test(t[i]):e[i]===t[i]):!0}function L6(t,e,r={}){return t.find(n=>n.type===e&&Bx(Object.fromEntries(Object.keys(r).map(i=>[i,n.attrs[i]])),r))}function TP(t,e,r={}){return!!L6(t,e,r)}function mC(t,e,r){var n;if(!t||!e)return;let i=t.parent.childAfter(t.parentOffset);if((!i.node||!i.node.marks.some(c=>c.type===e))&&(i=t.parent.childBefore(t.parentOffset)),!i.node||!i.node.marks.some(c=>c.type===e)||(r=r||((n=i.node.marks[0])==null?void 0:n.attrs),!L6([...i.node.marks],e,r)))return;let s=i.index,o=t.start()+i.offset,l=s+1,u=o+i.node.nodeSize;for(;s>0&&TP([...t.parent.child(s-1).marks],e,r);)s-=1,o-=t.parent.child(s).nodeSize;for(;l<t.parent.childCount&&TP([...t.parent.child(l).marks],e,r);)u+=t.parent.child(l).nodeSize,l+=1;return{from:o,to:u}}function Cc(t,e){if(typeof t=="string"){if(!e.marks[t])throw Error(`There is no mark type named '${t}'. Maybe you forgot to add the extension?`);return e.marks[t]}return t}var lJ=(t,e={})=>({tr:r,state:n,dispatch:i})=>{const a=Cc(t,n.schema),{doc:s,selection:o}=r,{$from:l,from:u,to:c}=o;if(i){const f=mC(l,a,e);if(f&&f.from<=u&&f.to>=c){const p=cr.create(s,f.from,f.to);r.setSelection(p)}}return!0},uJ=t=>e=>{const r=typeof t=="function"?t(e):t;for(let n=0;n<r.length;n+=1)if(r[n](e))return!0;return!1};function R6(t){return t instanceof cr}function oh(t=0,e=0,r=0){return Math.min(Math.max(t,e),r)}function O6(t,e=null){if(!e)return null;const r=yr.atStart(t),n=yr.atEnd(t);if(e==="start"||e===!0)return r;if(e==="end")return n;const i=r.from,a=n.to;return e==="all"?cr.create(t,oh(0,i,a),oh(t.content.size,i,a)):cr.create(t,oh(e,i,a),oh(e,i,a))}function NP(){return navigator.platform==="Android"||/android/i.test(navigator.userAgent)}function zx(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}function cJ(){return typeof navigator<"u"?/^((?!chrome|android).)*safari/i.test(navigator.userAgent):!1}var dJ=(t=null,e={})=>({editor:r,view:n,tr:i,dispatch:a})=>{e={scrollIntoView:!0,...e};const s=()=>{(zx()||NP())&&n.dom.focus(),cJ()&&!zx()&&!NP()&&n.dom.focus({preventScroll:!0}),requestAnimationFrame(()=>{r.isDestroyed||(n.focus(),e?.scrollIntoView&&r.commands.scrollIntoView())})};if(n.hasFocus()&&t===null||t===!1)return!0;if(a&&t===null&&!R6(r.state.selection))return s(),!0;const o=O6(i.doc,t)||r.state.selection,l=r.state.selection.eq(o);return a&&(l||i.setSelection(o),l&&i.storedMarks&&i.setStoredMarks(i.storedMarks),s()),!0},fJ=(t,e)=>r=>t.every((n,i)=>e(n,{...r,index:i})),hJ=(t,e)=>({tr:r,commands:n})=>n.insertContentAt({from:r.selection.from,to:r.selection.to},t,e),D6=t=>{const e=t.childNodes;for(let r=e.length-1;r>=0;r-=1){const n=e[r];n.nodeType===3&&n.nodeValue&&/^(\n\s\s|\n)$/.test(n.nodeValue)?t.removeChild(n):n.nodeType===1&&D6(n)}return t};function Ty(t){if(typeof window>"u")throw new Error("[tiptap error]: there is no window object available, so this function cannot be used");const e=`<body>${t}</body>`,r=new window.DOMParser().parseFromString(e,"text/html").body;return D6(r)}function Hv(t,e,r){if(t instanceof Vo||t instanceof rt)return t;r={slice:!0,parseOptions:{},...r};const n=typeof t=="object"&&t!==null,i=typeof t=="string";if(n)try{if(Array.isArray(t)&&t.length>0)return rt.fromArray(t.map(o=>e.nodeFromJSON(o)));const s=e.nodeFromJSON(t);return r.errorOnInvalidContent&&s.check(),s}catch(a){if(r.errorOnInvalidContent)throw new Error("[tiptap error]: Invalid JSON content",{cause:a});return console.warn("[tiptap warn]: Invalid content.","Passed value:",t,"Error:",a),Hv("",e,r)}if(i){if(r.errorOnInvalidContent){let s=!1,o="";const l=new yO({topNode:e.spec.topNode,marks:e.spec.marks,nodes:e.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:u=>(s=!0,o=typeof u=="string"?u:u.outerHTML,null)}]}})});if(r.slice?$d.fromSchema(l).parseSlice(Ty(t),r.parseOptions):$d.fromSchema(l).parse(Ty(t),r.parseOptions),r.errorOnInvalidContent&&s)throw new Error("[tiptap error]: Invalid HTML content",{cause:new Error(`Invalid element found: ${o}`)})}const a=$d.fromSchema(e);return r.slice?a.parseSlice(Ty(t),r.parseOptions).content:a.parse(Ty(t),r.parseOptions)}return Hv("",e,r)}function pJ(t,e,r){const n=t.steps.length-1;if(n<e)return;const i=t.steps[n];if(!(i instanceof oa||i instanceof da))return;const a=t.mapping.maps[n];let s=0;a.forEach((o,l,u,c)=>{s===0&&(s=c)}),t.setSelection(yr.near(t.doc.resolve(s),r))}var mJ=t=>!("type"in t),gJ=(t,e,r)=>({tr:n,dispatch:i,editor:a})=>{var s;if(i){r={parseOptions:a.options.parseOptions,updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...r};let o;const l=w=>{a.emit("contentError",{editor:a,error:w,disableCollaboration:()=>{"collaboration"in a.storage&&typeof a.storage.collaboration=="object"&&a.storage.collaboration&&(a.storage.collaboration.isDisabled=!0)}})},u={preserveWhitespace:"full",...r.parseOptions};if(!r.errorOnInvalidContent&&!a.options.enableContentCheck&&a.options.emitContentError)try{Hv(e,a.schema,{parseOptions:u,errorOnInvalidContent:!0})}catch(w){l(w)}try{o=Hv(e,a.schema,{parseOptions:u,errorOnInvalidContent:(s=r.errorOnInvalidContent)!=null?s:a.options.enableContentCheck})}catch(w){return l(w),!1}let{from:c,to:f}=typeof t=="number"?{from:t,to:t}:{from:t.from,to:t.to},p=!0,v=!0;if((mJ(o)?o:[o]).forEach(w=>{w.check(),p=p?w.isText&&w.marks.length===0:!1,v=v?w.isBlock:!1}),c===f&&v){const{parent:w}=n.doc.resolve(c);w.isTextblock&&!w.type.spec.code&&!w.childCount&&(c-=1,f+=1)}let S;if(p){if(Array.isArray(e))S=e.map(w=>w.text||"").join("");else if(e instanceof rt){let w="";e.forEach(T=>{T.text&&(w+=T.text)}),S=w}else typeof e=="object"&&e&&e.text?S=e.text:S=e;n.insertText(S,c,f)}else{S=o;const w=n.doc.resolve(c),T=w.node(),_=w.parentOffset===0,C=T.isText||T.isTextblock,N=T.content.size>0;_&&C&&N&&(c=Math.max(0,c-1)),n.replaceWith(c,f,S)}r.updateSelection&&pJ(n,n.steps.length-1,-1),r.applyInputRules&&n.setMeta("applyInputRules",{from:c,text:S}),r.applyPasteRules&&n.setMeta("applyPasteRules",{from:c,text:S})}return!0},vJ=()=>({state:t,dispatch:e})=>UY(t,e),yJ=()=>({state:t,dispatch:e})=>GY(t,e),xJ=()=>({state:t,dispatch:e})=>FO(t,e),bJ=()=>({state:t,dispatch:e})=>GO(t,e),wJ=()=>({state:t,dispatch:e,tr:r})=>{try{const n=Z1(t.doc,t.selection.$from.pos,-1);return n==null?!1:(r.join(n,2),e&&e(r),!0)}catch{return!1}},SJ=()=>({state:t,dispatch:e,tr:r})=>{try{const n=Z1(t.doc,t.selection.$from.pos,1);return n==null?!1:(r.join(n,2),e&&e(r),!0)}catch{return!1}},kJ=()=>({state:t,dispatch:e})=>BY(t,e),_J=()=>({state:t,dispatch:e})=>zY(t,e);function I6(){return typeof navigator<"u"?/Mac/.test(navigator.platform):!1}function CJ(t){const e=t.split(/-(?!$)/);let r=e[e.length-1];r==="Space"&&(r=" ");let n,i,a,s;for(let o=0;o<e.length-1;o+=1){const l=e[o];if(/^(cmd|meta|m)$/i.test(l))s=!0;else if(/^a(lt)?$/i.test(l))n=!0;else if(/^(c|ctrl|control)$/i.test(l))i=!0;else if(/^s(hift)?$/i.test(l))a=!0;else if(/^mod$/i.test(l))zx()||I6()?s=!0:i=!0;else throw new Error(`Unrecognized modifier name: ${l}`)}return n&&(r=`Alt-${r}`),i&&(r=`Ctrl-${r}`),s&&(r=`Meta-${r}`),a&&(r=`Shift-${r}`),r}var EJ=t=>({editor:e,view:r,tr:n,dispatch:i})=>{const a=CJ(t).split(/-(?!$)/),s=a.find(u=>!["Alt","Ctrl","Meta","Shift"].includes(u)),o=new KeyboardEvent("keydown",{key:s==="Space"?" ":s,altKey:a.includes("Alt"),ctrlKey:a.includes("Ctrl"),metaKey:a.includes("Meta"),shiftKey:a.includes("Shift"),bubbles:!0,cancelable:!0}),l=e.captureTransaction(()=>{r.someProp("handleKeyDown",u=>u(r,o))});return l?.steps.forEach(u=>{const c=u.map(n.mapping);c&&i&&n.maybeStep(c)}),!0};function sf(t,e,r={}){const{from:n,to:i,empty:a}=t.selection,s=e?Ri(e,t.schema):null,o=[];t.doc.nodesBetween(n,i,(f,p)=>{if(f.isText)return;const v=Math.max(n,p),y=Math.min(i,p+f.nodeSize);o.push({node:f,from:v,to:y})});const l=i-n,u=o.filter(f=>s?s.name===f.node.type.name:!0).filter(f=>Bx(f.node.attrs,r,{strict:!1}));return a?!!u.length:u.reduce((f,p)=>f+p.to-p.from,0)>=l}var TJ=(t,e={})=>({state:r,dispatch:n})=>{const i=Ri(t,r.schema);return sf(r,i,e)?VY(r,n):!1},NJ=()=>({state:t,dispatch:e})=>qO(t,e),PJ=t=>({state:e,dispatch:r})=>{const n=Ri(t,e.schema);return tX(n)(e,r)},MJ=()=>({state:t,dispatch:e})=>HO(t,e);function nb(t,e){return e.nodes[t]?"node":e.marks[t]?"mark":null}function PP(t,e){const r=typeof e=="string"?[e]:e;return Object.keys(t).reduce((n,i)=>(r.includes(i)||(n[i]=t[i]),n),{})}var AJ=(t,e)=>({tr:r,state:n,dispatch:i})=>{let a=null,s=null;const o=nb(typeof t=="string"?t:t.name,n.schema);if(!o)return!1;o==="node"&&(a=Ri(t,n.schema)),o==="mark"&&(s=Cc(t,n.schema));let l=!1;return r.selection.ranges.forEach(u=>{n.doc.nodesBetween(u.$from.pos,u.$to.pos,(c,f)=>{a&&a===c.type&&(l=!0,i&&r.setNodeMarkup(f,void 0,PP(c.attrs,e))),s&&c.marks.length&&c.marks.forEach(p=>{s===p.type&&(l=!0,i&&r.addMark(f,f+c.nodeSize,s.create(PP(p.attrs,e))))})})}),l},LJ=()=>({tr:t,dispatch:e})=>(e&&t.scrollIntoView(),!0),RJ=()=>({tr:t,dispatch:e})=>{if(e){const r=new co(t.doc);t.setSelection(r)}return!0},OJ=()=>({state:t,dispatch:e})=>zO(t,e),DJ=()=>({state:t,dispatch:e})=>VO(t,e),IJ=()=>({state:t,dispatch:e})=>$Y(t,e),jJ=()=>({state:t,dispatch:e})=>YY(t,e),FJ=()=>({state:t,dispatch:e})=>ZY(t,e);function Rk(t,e,r={},n={}){return Hv(t,e,{slice:!1,parseOptions:r,errorOnInvalidContent:n.errorOnInvalidContent})}var BJ=(t,{errorOnInvalidContent:e,emitUpdate:r=!0,parseOptions:n={}}={})=>({editor:i,tr:a,dispatch:s,commands:o})=>{const{doc:l}=a;if(n.preserveWhitespace!=="full"){const u=Rk(t,i.schema,n,{errorOnInvalidContent:e??i.options.enableContentCheck});return s&&a.replaceWith(0,l.content.size,u).setMeta("preventUpdate",!r),!0}return s&&a.setMeta("preventUpdate",!r),o.insertContentAt({from:0,to:l.content.size},t,{parseOptions:n,errorOnInvalidContent:e??i.options.enableContentCheck})};function j6(t,e){const r=Cc(e,t.schema),{from:n,to:i,empty:a}=t.selection,s=[];a?(t.storedMarks&&s.push(...t.storedMarks),s.push(...t.selection.$head.marks())):t.doc.nodesBetween(n,i,l=>{s.push(...l.marks)});const o=s.find(l=>l.type.name===r.name);return o?{...o.attrs}:{}}function F6(t,e){const r=new OO(t);return e.forEach(n=>{n.steps.forEach(i=>{r.step(i)})}),r}function zJ(t){for(let e=0;e<t.edgeCount;e+=1){const{type:r}=t.edge(e);if(r.isTextblock&&!r.hasRequiredAttrs())return r}return null}function UJ(t,e,r){const n=[];return t.nodesBetween(e.from,e.to,(i,a)=>{r(i)&&n.push({node:i,pos:a})}),n}function GJ(t,e){for(let r=t.depth;r>0;r-=1){const n=t.node(r);if(e(n))return{pos:r>0?t.before(r):0,start:t.start(r),depth:r,node:n}}}function ib(t){return e=>GJ(e.$from,t)}function Ht(t,e,r){return t.config[e]===void 0&&t.parent?Ht(t.parent,e,r):typeof t.config[e]=="function"?t.config[e].bind({...r,parent:t.parent?Ht(t.parent,e,r):null}):t.config[e]}function gC(t){return t.map(e=>{const r={name:e.name,options:e.options,storage:e.storage},n=Ht(e,"addExtensions",r);return n?[e,...gC(n())]:e}).flat(10)}function vC(t,e){const r=Oh.fromSchema(e).serializeFragment(t),i=document.implementation.createHTMLDocument().createElement("div");return i.appendChild(r),i.innerHTML}function B6(t){return typeof t=="function"}function rn(t,e=void 0,...r){return B6(t)?e?t.bind(e)(...r):t(...r):t}function VJ(t={}){return Object.keys(t).length===0&&t.constructor===Object}function rm(t){const e=t.filter(i=>i.type==="extension"),r=t.filter(i=>i.type==="node"),n=t.filter(i=>i.type==="mark");return{baseExtensions:e,nodeExtensions:r,markExtensions:n}}function z6(t){const e=[],{nodeExtensions:r,markExtensions:n}=rm(t),i=[...r,...n],a={default:null,validate:void 0,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0,isRequired:!1};return t.forEach(s=>{const o={name:s.name,options:s.options,storage:s.storage,extensions:i},l=Ht(s,"addGlobalAttributes",o);if(!l)return;l().forEach(c=>{c.types.forEach(f=>{Object.entries(c.attributes).forEach(([p,v])=>{e.push({type:f,name:p,attribute:{...a,...v}})})})})}),i.forEach(s=>{const o={name:s.name,options:s.options,storage:s.storage},l=Ht(s,"addAttributes",o);if(!l)return;const u=l();Object.entries(u).forEach(([c,f])=>{const p={...a,...f};typeof p?.default=="function"&&(p.default=p.default()),p?.isRequired&&p?.default===void 0&&delete p.default,e.push({type:s.name,name:c,attribute:p})})}),e}function Vn(...t){return t.filter(e=>!!e).reduce((e,r)=>{const n={...e};return Object.entries(r).forEach(([i,a])=>{if(!n[i]){n[i]=a;return}if(i==="class"){const o=a?String(a).split(" "):[],l=n[i]?n[i].split(" "):[],u=o.filter(c=>!l.includes(c));n[i]=[...l,...u].join(" ")}else if(i==="style"){const o=a?a.split(";").map(c=>c.trim()).filter(Boolean):[],l=n[i]?n[i].split(";").map(c=>c.trim()).filter(Boolean):[],u=new Map;l.forEach(c=>{const[f,p]=c.split(":").map(v=>v.trim());u.set(f,p)}),o.forEach(c=>{const[f,p]=c.split(":").map(v=>v.trim());u.set(f,p)}),n[i]=Array.from(u.entries()).map(([c,f])=>`${c}: ${f}`).join("; ")}else n[i]=a}),n},{})}function Wv(t,e){return e.filter(r=>r.type===t.type.name).filter(r=>r.attribute.rendered).map(r=>r.attribute.renderHTML?r.attribute.renderHTML(t.attrs)||{}:{[r.name]:t.attrs[r.name]}).reduce((r,n)=>Vn(r,n),{})}function HJ(t){return typeof t!="string"?t:t.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(t):t==="true"?!0:t==="false"?!1:t}function MP(t,e){return"style"in t?t:{...t,getAttrs:r=>{const n=t.getAttrs?t.getAttrs(r):t.attrs;if(n===!1)return!1;const i=e.reduce((a,s)=>{const o=s.attribute.parseHTML?s.attribute.parseHTML(r):HJ(r.getAttribute(s.name));return o==null?a:{...a,[s.name]:o}},{});return{...n,...i}}}}function AP(t){return Object.fromEntries(Object.entries(t).filter(([e,r])=>e==="attrs"&&VJ(r)?!1:r!=null))}function LP(t){var e,r;const n={};return!((e=t?.attribute)!=null&&e.isRequired)&&"default"in(t?.attribute||{})&&(n.default=t.attribute.default),((r=t?.attribute)==null?void 0:r.validate)!==void 0&&(n.validate=t.attribute.validate),[t.name,n]}function WJ(t,e){var r;const n=z6(t),{nodeExtensions:i,markExtensions:a}=rm(t),s=(r=i.find(u=>Ht(u,"topNode")))==null?void 0:r.name,o=Object.fromEntries(i.map(u=>{const c=n.filter(T=>T.type===u.name),f={name:u.name,options:u.options,storage:u.storage,editor:e},p=t.reduce((T,_)=>{const C=Ht(_,"extendNodeSchema",f);return{...T,...C?C(u):{}}},{}),v=AP({...p,content:rn(Ht(u,"content",f)),marks:rn(Ht(u,"marks",f)),group:rn(Ht(u,"group",f)),inline:rn(Ht(u,"inline",f)),atom:rn(Ht(u,"atom",f)),selectable:rn(Ht(u,"selectable",f)),draggable:rn(Ht(u,"draggable",f)),code:rn(Ht(u,"code",f)),whitespace:rn(Ht(u,"whitespace",f)),linebreakReplacement:rn(Ht(u,"linebreakReplacement",f)),defining:rn(Ht(u,"defining",f)),isolating:rn(Ht(u,"isolating",f)),attrs:Object.fromEntries(c.map(LP))}),y=rn(Ht(u,"parseHTML",f));y&&(v.parseDOM=y.map(T=>MP(T,c)));const S=Ht(u,"renderHTML",f);S&&(v.toDOM=T=>S({node:T,HTMLAttributes:Wv(T,c)}));const w=Ht(u,"renderText",f);return w&&(v.toText=w),[u.name,v]})),l=Object.fromEntries(a.map(u=>{const c=n.filter(w=>w.type===u.name),f={name:u.name,options:u.options,storage:u.storage,editor:e},p=t.reduce((w,T)=>{const _=Ht(T,"extendMarkSchema",f);return{...w,..._?_(u):{}}},{}),v=AP({...p,inclusive:rn(Ht(u,"inclusive",f)),excludes:rn(Ht(u,"excludes",f)),group:rn(Ht(u,"group",f)),spanning:rn(Ht(u,"spanning",f)),code:rn(Ht(u,"code",f)),attrs:Object.fromEntries(c.map(LP))}),y=rn(Ht(u,"parseHTML",f));y&&(v.parseDOM=y.map(w=>MP(w,c)));const S=Ht(u,"renderHTML",f);return S&&(v.toDOM=w=>S({mark:w,HTMLAttributes:Wv(w,c)})),[u.name,v]}));return new yO({topNode:s,nodes:o,marks:l})}function qJ(t){const e=t.filter((r,n)=>t.indexOf(r)!==n);return Array.from(new Set(e))}function Ux(t){return t.sort((r,n)=>{const i=Ht(r,"priority")||100,a=Ht(n,"priority")||100;return i>a?-1:i<a?1:0})}function U6(t){const e=Ux(gC(t)),r=qJ(e.map(n=>n.name));return r.length&&console.warn(`[tiptap warn]: Duplicate extension names found: [${r.map(n=>`'${n}'`).join(", ")}]. This can lead to issues.`),e}function G6(t,e,r){const{from:n,to:i}=e,{blockSeparator:a=`

`,textSerializers:s={}}=r||{};let o="";return t.nodesBetween(n,i,(l,u,c,f)=>{var p;l.isBlock&&u>n&&(o+=a);const v=s?.[l.type.name];if(v)return c&&(o+=v({node:l,pos:u,parent:c,index:f,range:e})),!1;l.isText&&(o+=(p=l?.text)==null?void 0:p.slice(Math.max(n,u)-u,i-u))}),o}function $J(t,e){const r={from:0,to:t.content.size};return G6(t,r,e)}function V6(t){return Object.fromEntries(Object.entries(t.nodes).filter(([,e])=>e.spec.toText).map(([e,r])=>[e,r.spec.toText]))}function KJ(t,e){const r=Ri(e,t.schema),{from:n,to:i}=t.selection,a=[];t.doc.nodesBetween(n,i,o=>{a.push(o)});const s=a.reverse().find(o=>o.type.name===r.name);return s?{...s.attrs}:{}}function H6(t,e){const r=nb(typeof e=="string"?e:e.name,t.schema);return r==="node"?KJ(t,e):r==="mark"?j6(t,e):{}}function ZJ(t,e=JSON.stringify){const r={};return t.filter(n=>{const i=e(n);return Object.prototype.hasOwnProperty.call(r,i)?!1:r[i]=!0})}function YJ(t){const e=ZJ(t);return e.length===1?e:e.filter((r,n)=>!e.filter((a,s)=>s!==n).some(a=>r.oldRange.from>=a.oldRange.from&&r.oldRange.to<=a.oldRange.to&&r.newRange.from>=a.newRange.from&&r.newRange.to<=a.newRange.to))}function W6(t){const{mapping:e,steps:r}=t,n=[];return e.maps.forEach((i,a)=>{const s=[];if(i.ranges.length)i.forEach((o,l)=>{s.push({from:o,to:l})});else{const{from:o,to:l}=r[a];if(o===void 0||l===void 0)return;s.push({from:o,to:l})}s.forEach(({from:o,to:l})=>{const u=e.slice(a).map(o,-1),c=e.slice(a).map(l),f=e.invert().map(u,-1),p=e.invert().map(c);n.push({oldRange:{from:f,to:p},newRange:{from:u,to:c}})})}),YJ(n)}function yC(t,e,r){const n=[];return t===e?r.resolve(t).marks().forEach(i=>{const a=r.resolve(t),s=mC(a,i.type);s&&n.push({mark:i,...s})}):r.nodesBetween(t,e,(i,a)=>{!i||i?.nodeSize===void 0||n.push(...i.marks.map(s=>({from:a,to:a+i.nodeSize,mark:s})))}),n}var XJ=(t,e,r,n=20)=>{const i=t.doc.resolve(r);let a=n,s=null;for(;a>0&&s===null;){const o=i.node(a);o?.type.name===e?s=o:a-=1}return[s,a]};function Ny(t,e){return e.nodes[t]||e.marks[t]||null}function tx(t,e,r){return Object.fromEntries(Object.entries(r).filter(([n])=>{const i=t.find(a=>a.type===e&&a.name===n);return i?i.attribute.keepOnSplit:!1}))}var QJ=(t,e=500)=>{let r="";const n=t.parentOffset;return t.parent.nodesBetween(Math.max(0,n-e),n,(i,a,s,o)=>{var l,u;const c=((u=(l=i.type.spec).toText)==null?void 0:u.call(l,{node:i,pos:a,parent:s,index:o}))||i.textContent||"%leaf%";r+=i.isAtom&&!i.isText?c:c.slice(0,Math.max(0,n-a))}),r};function Ok(t,e,r={}){const{empty:n,ranges:i}=t.selection,a=e?Cc(e,t.schema):null;if(n)return!!(t.storedMarks||t.selection.$from.marks()).filter(f=>a?a.name===f.type.name:!0).find(f=>Bx(f.attrs,r,{strict:!1}));let s=0;const o=[];if(i.forEach(({$from:f,$to:p})=>{const v=f.pos,y=p.pos;t.doc.nodesBetween(v,y,(S,w)=>{if(!S.isText&&!S.marks.length)return;const T=Math.max(v,w),_=Math.min(y,w+S.nodeSize),C=_-T;s+=C,o.push(...S.marks.map(N=>({mark:N,from:T,to:_})))})}),s===0)return!1;const l=o.filter(f=>a?a.name===f.mark.type.name:!0).filter(f=>Bx(f.mark.attrs,r,{strict:!1})).reduce((f,p)=>f+p.to-p.from,0),u=o.filter(f=>a?f.mark.type!==a&&f.mark.type.excludes(a):!0).reduce((f,p)=>f+p.to-p.from,0);return(l>0?l+u:l)>=s}function JJ(t,e,r={}){if(!e)return sf(t,null,r)||Ok(t,null,r);const n=nb(e,t.schema);return n==="node"?sf(t,e,r):n==="mark"?Ok(t,e,r):!1}var eee=(t,e)=>{const{$from:r,$to:n,$anchor:i}=t.selection;if(e){const a=ib(o=>o.type.name===e)(t.selection);if(!a)return!1;const s=t.doc.resolve(a.pos+1);return i.pos+1===s.end()}return!(n.parentOffset<n.parent.nodeSize-2||r.pos!==n.pos)},tee=t=>{const{$from:e,$to:r}=t.selection;return!(e.parentOffset>0||e.pos!==r.pos)};function RP(t,e){return Array.isArray(e)?e.some(r=>(typeof r=="string"?r:r.name)===t.name):e}function OP(t,e){const{nodeExtensions:r}=rm(e),n=r.find(s=>s.name===t);if(!n)return!1;const i={name:n.name,options:n.options,storage:n.storage},a=rn(Ht(n,"group",i));return typeof a!="string"?!1:a.split(" ").includes("list")}function ab(t,{checkChildren:e=!0,ignoreWhitespace:r=!1}={}){var n;if(r){if(t.type.name==="hardBreak")return!0;if(t.isText)return/^\s*$/m.test((n=t.text)!=null?n:"")}if(t.isText)return!t.text;if(t.isAtom||t.isLeaf)return!1;if(t.content.childCount===0)return!0;if(e){let i=!0;return t.content.forEach(a=>{i!==!1&&(ab(a,{ignoreWhitespace:r,checkChildren:e})||(i=!1))}),i}return!1}function q6(t){return t instanceof Yt}var $6=class K6{constructor(e){this.position=e}static fromJSON(e){return new K6(e.position)}toJSON(){return{position:this.position}}};function ree(t,e){const r=e.mapping.mapResult(t.position);return{position:new $6(r.pos),mapResult:r}}function nee(t){return new $6(t)}function iee(t,e,r){var n;const{selection:i}=e;let a=null;if(R6(i)&&(a=i.$cursor),a){const o=(n=t.storedMarks)!=null?n:a.marks();return a.parent.type.allowsMarkType(r)&&(!!r.isInSet(o)||!o.some(u=>u.type.excludes(r)))}const{ranges:s}=i;return s.some(({$from:o,$to:l})=>{let u=o.depth===0?t.doc.inlineContent&&t.doc.type.allowsMarkType(r):!1;return t.doc.nodesBetween(o.pos,l.pos,(c,f,p)=>{if(u)return!1;if(c.isInline){const v=!p||p.type.allowsMarkType(r),y=!!r.isInSet(c.marks)||!c.marks.some(S=>S.type.excludes(r));u=v&&y}return!u}),u})}var aee=(t,e={})=>({tr:r,state:n,dispatch:i})=>{const{selection:a}=r,{empty:s,ranges:o}=a,l=Cc(t,n.schema);if(i)if(s){const u=j6(n,l);r.addStoredMark(l.create({...u,...e}))}else o.forEach(u=>{const c=u.$from.pos,f=u.$to.pos;n.doc.nodesBetween(c,f,(p,v)=>{const y=Math.max(v,c),S=Math.min(v+p.nodeSize,f);p.marks.find(T=>T.type===l)?p.marks.forEach(T=>{l===T.type&&r.addMark(y,S,l.create({...T.attrs,...e}))}):r.addMark(y,S,l.create(e))})});return iee(n,r,l)},see=(t,e)=>({tr:r})=>(r.setMeta(t,e),!0),oee=(t,e={})=>({state:r,dispatch:n,chain:i})=>{const a=Ri(t,r.schema);let s;return r.selection.$anchor.sameParent(r.selection.$head)&&(s=r.selection.$anchor.parent.attrs),a.isTextblock?i().command(({commands:o})=>$3(a,{...s,...e})(r)?!0:o.clearNodes()).command(({state:o})=>$3(a,{...s,...e})(o,n)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},lee=t=>({tr:e,dispatch:r})=>{if(r){const{doc:n}=e,i=oh(t,0,n.content.size),a=Yt.create(n,i);e.setSelection(a)}return!0},uee=(t,e)=>({tr:r,state:n,dispatch:i})=>{const{selection:a}=n;let s,o;return typeof e=="number"?(s=e,o=e):e&&"from"in e&&"to"in e?(s=e.from,o=e.to):(s=a.from,o=a.to),i&&r.doc.nodesBetween(s,o,(l,u)=>{l.isText||r.setNodeMarkup(u,void 0,{...l.attrs,dir:t})}),!0},cee=t=>({tr:e,dispatch:r})=>{if(r){const{doc:n}=e,{from:i,to:a}=typeof t=="number"?{from:t,to:t}:t,s=cr.atStart(n).from,o=cr.atEnd(n).to,l=oh(i,s,o),u=oh(a,s,o),c=cr.create(n,l,u);e.setSelection(c)}return!0},dee=t=>({state:e,dispatch:r})=>{const n=Ri(t,e.schema);return iX(n)(e,r)};function DP(t,e){const r=t.storedMarks||t.selection.$to.parentOffset&&t.selection.$from.marks();if(r){const n=r.filter(i=>e?.includes(i.type.name));t.tr.ensureMarks(n)}}var fee=({keepMarks:t=!0}={})=>({tr:e,state:r,dispatch:n,editor:i})=>{const{selection:a,doc:s}=e,{$from:o,$to:l}=a,u=i.extensionManager.attributes,c=tx(u,o.node().type.name,o.node().attrs);if(a instanceof Yt&&a.node.isBlock)return!o.parentOffset||!gc(s,o.pos)?!1:(n&&(t&&DP(r,i.extensionManager.splittableMarks),e.split(o.pos).scrollIntoView()),!0);if(!o.parent.isBlock)return!1;const f=l.parentOffset===l.parent.content.size,p=o.depth===0?void 0:zJ(o.node(-1).contentMatchAt(o.indexAfter(-1)));let v=f&&p?[{type:p,attrs:c}]:void 0,y=gc(e.doc,e.mapping.map(o.pos),1,v);if(!v&&!y&&gc(e.doc,e.mapping.map(o.pos),1,p?[{type:p}]:void 0)&&(y=!0,v=p?[{type:p,attrs:c}]:void 0),n){if(y&&(a instanceof cr&&e.deleteSelection(),e.split(e.mapping.map(o.pos),1,v),p&&!f&&!o.parentOffset&&o.parent.type!==p)){const S=e.mapping.map(o.before()),w=e.doc.resolve(S);o.node(-1).canReplaceWith(w.index(),w.index()+1,p)&&e.setNodeMarkup(e.mapping.map(o.before()),p)}t&&DP(r,i.extensionManager.splittableMarks),e.scrollIntoView()}return y},hee=(t,e={})=>({tr:r,state:n,dispatch:i,editor:a})=>{var s;const o=Ri(t,n.schema),{$from:l,$to:u}=n.selection,c=n.selection.node;if(c&&c.isBlock||l.depth<2||!l.sameParent(u))return!1;const f=l.node(-1);if(f.type!==o)return!1;const p=a.extensionManager.attributes;if(l.parent.content.size===0&&l.node(-1).childCount===l.indexAfter(-1)){if(l.depth===2||l.node(-3).type!==o||l.index(-2)!==l.node(-2).childCount-1)return!1;if(i){let T=rt.empty;const _=l.index(-1)?1:l.index(-2)?2:3;for(let D=l.depth-_;D>=l.depth-3;D-=1)T=rt.from(l.node(D).copy(T));const C=l.indexAfter(-1)<l.node(-2).childCount?1:l.indexAfter(-2)<l.node(-3).childCount?2:3,N={...tx(p,l.node().type.name,l.node().attrs),...e},A=((s=o.contentMatch.defaultType)==null?void 0:s.createAndFill(N))||void 0;T=T.append(rt.from(o.createAndFill(null,A)||void 0));const O=l.before(l.depth-(_-1));r.replace(O,l.after(-C),new Nt(T,4-_,0));let j=-1;r.doc.nodesBetween(O,r.doc.content.size,(D,F)=>{if(j>-1)return!1;D.isTextblock&&D.content.size===0&&(j=F+1)}),j>-1&&r.setSelection(cr.near(r.doc.resolve(j))),r.scrollIntoView()}return!0}const v=u.pos===l.end()?f.contentMatchAt(0).defaultType:null,y={...tx(p,f.type.name,f.attrs),...e},S={...tx(p,l.node().type.name,l.node().attrs),...e};r.delete(l.pos,u.pos);const w=v?[{type:o,attrs:y},{type:v,attrs:S}]:[{type:o,attrs:y}];if(!gc(r.doc,l.pos,2))return!1;if(i){const{selection:T,storedMarks:_}=n,{splittableMarks:C}=a.extensionManager,N=_||T.$to.parentOffset&&T.$from.marks();if(r.split(l.pos,2,w).scrollIntoView(),!N||!i)return!0;const A=N.filter(O=>C.includes(O.type.name));r.ensureMarks(A)}return!0},mS=(t,e)=>{const r=ib(s=>s.type===e)(t.selection);if(!r)return!0;const n=t.doc.resolve(Math.max(0,r.pos-1)).before(r.depth);if(n===void 0)return!0;const i=t.doc.nodeAt(n);return r.node.type===i?.type&&pf(t.doc,r.pos)&&t.join(r.pos),!0},gS=(t,e)=>{const r=ib(s=>s.type===e)(t.selection);if(!r)return!0;const n=t.doc.resolve(r.start).after(r.depth);if(n===void 0)return!0;const i=t.doc.nodeAt(n);return r.node.type===i?.type&&pf(t.doc,n)&&t.join(n),!0},pee=(t,e,r,n={})=>({editor:i,tr:a,state:s,dispatch:o,chain:l,commands:u,can:c})=>{const{extensions:f,splittableMarks:p}=i.extensionManager,v=Ri(t,s.schema),y=Ri(e,s.schema),{selection:S,storedMarks:w}=s,{$from:T,$to:_}=S,C=T.blockRange(_),N=w||S.$to.parentOffset&&S.$from.marks();if(!C)return!1;const A=ib(O=>OP(O.type.name,f))(S);if(C.depth>=1&&A&&C.depth-A.depth<=1){if(A.node.type===v)return u.liftListItem(y);if(OP(A.node.type.name,f)&&v.validContent(A.node.content)&&o)return l().command(()=>(a.setNodeMarkup(A.pos,v),!0)).command(()=>mS(a,v)).command(()=>gS(a,v)).run()}return!r||!N||!o?l().command(()=>c().wrapInList(v,n)?!0:u.clearNodes()).wrapInList(v,n).command(()=>mS(a,v)).command(()=>gS(a,v)).run():l().command(()=>{const O=c().wrapInList(v,n),j=N.filter(D=>p.includes(D.type.name));return a.ensureMarks(j),O?!0:u.clearNodes()}).wrapInList(v,n).command(()=>mS(a,v)).command(()=>gS(a,v)).run()},mee=(t,e={},r={})=>({state:n,commands:i})=>{const{extendEmptyMarkRange:a=!1}=r,s=Cc(t,n.schema);return Ok(n,s,e)?i.unsetMark(s,{extendEmptyMarkRange:a}):i.setMark(s,e)},gee=(t,e,r={})=>({state:n,commands:i})=>{const a=Ri(t,n.schema),s=Ri(e,n.schema),o=sf(n,a,r);let l;return n.selection.$anchor.sameParent(n.selection.$head)&&(l=n.selection.$anchor.parent.attrs),o?i.setNode(s,l):i.setNode(a,{...l,...r})},vee=(t,e={})=>({state:r,commands:n})=>{const i=Ri(t,r.schema);return sf(r,i,e)?n.lift(i):n.wrapIn(i,e)},yee=()=>({state:t,dispatch:e})=>{const r=t.plugins;for(let n=0;n<r.length;n+=1){const i=r[n];let a;if(i.spec.isInputRules&&(a=i.getState(t))){if(e){const s=t.tr,o=a.transform;for(let l=o.steps.length-1;l>=0;l-=1)s.step(o.steps[l].invert(o.docs[l]));if(a.text){const l=s.doc.resolve(a.from).marks();s.replaceWith(a.from,a.to,t.schema.text(a.text,l))}else s.delete(a.from,a.to)}return!0}}return!1},xee=()=>({tr:t,dispatch:e})=>{const{selection:r}=t,{empty:n,ranges:i}=r;return n||e&&i.forEach(a=>{t.removeMark(a.$from.pos,a.$to.pos)}),!0},bee=(t,e={})=>({tr:r,state:n,dispatch:i})=>{var a;const{extendEmptyMarkRange:s=!1}=e,{selection:o}=r,l=Cc(t,n.schema),{$from:u,empty:c,ranges:f}=o;if(!i)return!0;if(c&&s){let{from:p,to:v}=o;const y=(a=u.marks().find(w=>w.type===l))==null?void 0:a.attrs,S=mC(u,l,y);S&&(p=S.from,v=S.to),r.removeMark(p,v,l)}else f.forEach(p=>{r.removeMark(p.$from.pos,p.$to.pos,l)});return r.removeStoredMark(l),!0},wee=t=>({tr:e,state:r,dispatch:n})=>{const{selection:i}=r;let a,s;return typeof t=="number"?(a=t,s=t):t&&"from"in t&&"to"in t?(a=t.from,s=t.to):(a=i.from,s=i.to),n&&e.doc.nodesBetween(a,s,(o,l)=>{if(o.isText)return;const u={...o.attrs};delete u.dir,e.setNodeMarkup(l,void 0,u)}),!0},See=(t,e={})=>({tr:r,state:n,dispatch:i})=>{let a=null,s=null;const o=nb(typeof t=="string"?t:t.name,n.schema);if(!o)return!1;o==="node"&&(a=Ri(t,n.schema)),o==="mark"&&(s=Cc(t,n.schema));let l=!1;return r.selection.ranges.forEach(u=>{const c=u.$from.pos,f=u.$to.pos;let p,v,y,S;r.selection.empty?n.doc.nodesBetween(c,f,(w,T)=>{a&&a===w.type&&(l=!0,y=Math.max(T,c),S=Math.min(T+w.nodeSize,f),p=T,v=w)}):n.doc.nodesBetween(c,f,(w,T)=>{T<c&&a&&a===w.type&&(l=!0,y=Math.max(T,c),S=Math.min(T+w.nodeSize,f),p=T,v=w),T>=c&&T<=f&&(a&&a===w.type&&(l=!0,i&&r.setNodeMarkup(T,void 0,{...w.attrs,...e})),s&&w.marks.length&&w.marks.forEach(_=>{if(s===_.type&&(l=!0,i)){const C=Math.max(T,c),N=Math.min(T+w.nodeSize,f);r.addMark(C,N,s.create({..._.attrs,...e}))}}))}),v&&(p!==void 0&&i&&r.setNodeMarkup(p,void 0,{...v.attrs,...e}),s&&v.marks.length&&v.marks.forEach(w=>{s===w.type&&i&&r.addMark(y,S,s.create({...w.attrs,...e}))}))}),l},kee=(t,e={})=>({state:r,dispatch:n})=>{const i=Ri(t,r.schema);return XY(i,e)(r,n)},_ee=(t,e={})=>({state:r,dispatch:n})=>{const i=Ri(t,r.schema);return QY(i,e)(r,n)},Cee=class{constructor(){this.callbacks={}}on(t,e){return this.callbacks[t]||(this.callbacks[t]=[]),this.callbacks[t].push(e),this}emit(t,...e){const r=this.callbacks[t];return r&&r.forEach(n=>n.apply(this,e)),this}off(t,e){const r=this.callbacks[t];return r&&(e?this.callbacks[t]=r.filter(n=>n!==e):delete this.callbacks[t]),this}once(t,e){const r=(...n)=>{this.off(t,r),e.apply(this,n)};return this.on(t,r)}removeAllListeners(){this.callbacks={}}},sb=class{constructor(t){var e;this.find=t.find,this.handler=t.handler,this.undoable=(e=t.undoable)!=null?e:!0}},Eee=(t,e)=>{if(pC(e))return e.exec(t);const r=e(t);if(!r)return null;const n=[r.text];return n.index=r.index,n.input=t,n.data=r.data,r.replaceWith&&(r.text.includes(r.replaceWith)||console.warn('[tiptap warn]: "inputRuleMatch.replaceWith" must be part of "inputRuleMatch.text".'),n.push(r.replaceWith)),n};function Py(t){var e;const{editor:r,from:n,to:i,text:a,rules:s,plugin:o}=t,{view:l}=r;if(l.composing)return!1;const u=l.state.doc.resolve(n);if(u.parent.type.spec.code||(e=u.nodeBefore||u.nodeAfter)!=null&&e.marks.find(p=>p.type.spec.code))return!1;let c=!1;const f=QJ(u)+a;return s.forEach(p=>{if(c)return;const v=Eee(f,p.find);if(!v)return;const y=l.state.tr,S=tb({state:l.state,transaction:y}),w={from:n-(v[0].length-a.length),to:i},{commands:T,chain:_,can:C}=new rb({editor:r,state:S});p.handler({state:S,range:w,match:v,commands:T,chain:_,can:C})===null||!y.steps.length||(p.undoable&&y.setMeta(o,{transform:y,from:n,to:i,text:a}),l.dispatch(y),c=!0)}),c}function Tee(t){const{editor:e,rules:r}=t,n=new Hn({state:{init(){return null},apply(i,a,s){const o=i.getMeta(n);if(o)return o;const l=i.getMeta("applyInputRules");return l&&setTimeout(()=>{let{text:c}=l;typeof c=="string"?c=c:c=vC(rt.from(c),s.schema);const{from:f}=l,p=f+c.length;Py({editor:e,from:f,to:p,text:c,rules:r,plugin:n})}),i.selectionSet||i.docChanged?null:a}},props:{handleTextInput(i,a,s,o){return Py({editor:e,from:a,to:s,text:o,rules:r,plugin:n})},handleDOMEvents:{compositionend:i=>(setTimeout(()=>{const{$cursor:a}=i.state.selection;a&&Py({editor:e,from:a.pos,to:a.pos,text:"",rules:r,plugin:n})}),!1)},handleKeyDown(i,a){if(a.key!=="Enter")return!1;const{$cursor:s}=i.state.selection;return s?Py({editor:e,from:s.pos,to:s.pos,text:`
`,rules:r,plugin:n}):!1}},isInputRules:!0});return n}function Nee(t){return Object.prototype.toString.call(t).slice(8,-1)}function My(t){return Nee(t)!=="Object"?!1:t.constructor===Object&&Object.getPrototypeOf(t)===Object.prototype}function Z6(t,e){const r={...t};return My(t)&&My(e)&&Object.keys(e).forEach(n=>{My(e[n])&&My(t[n])?r[n]=Z6(t[n],e[n]):r[n]=e[n]}),r}var xC=class{constructor(t={}){this.type="extendable",this.parent=null,this.child=null,this.name="",this.config={name:this.name},this.config={...this.config,...t},this.name=this.config.name}get options(){return{...rn(Ht(this,"addOptions",{name:this.name}))||{}}}get storage(){return{...rn(Ht(this,"addStorage",{name:this.name,options:this.options}))||{}}}configure(t={}){const e=this.extend({...this.config,addOptions:()=>Z6(this.options,t)});return e.name=this.name,e.parent=this.parent,e}extend(t={}){const e=new this.constructor({...this.config,...t});return e.parent=this,this.child=e,e.name="name"in t?t.name:e.parent.name,e}},Dh=class Y6 extends xC{constructor(){super(...arguments),this.type="mark"}static create(e={}){const r=typeof e=="function"?e():e;return new Y6(r)}static handleExit({editor:e,mark:r}){const{tr:n}=e.state,i=e.state.selection.$from;if(i.pos===i.end()){const s=i.marks();if(!!!s.find(u=>u?.type.name===r.name))return!1;const l=s.find(u=>u?.type.name===r.name);return l&&n.removeStoredMark(l),n.insertText(" ",i.pos),e.view.dispatch(n),!0}return!1}configure(e){return super.configure(e)}extend(e){const r=typeof e=="function"?e():e;return super.extend(r)}};function Pee(t){return typeof t=="number"}var Mee=class{constructor(t){this.find=t.find,this.handler=t.handler}},Aee=(t,e,r)=>{if(pC(e))return[...t.matchAll(e)];const n=e(t,r);return n?n.map(i=>{const a=[i.text];return a.index=i.index,a.input=t,a.data=i.data,i.replaceWith&&(i.text.includes(i.replaceWith)||console.warn('[tiptap warn]: "pasteRuleMatch.replaceWith" must be part of "pasteRuleMatch.text".'),a.push(i.replaceWith)),a}):[]};function Lee(t){const{editor:e,state:r,from:n,to:i,rule:a,pasteEvent:s,dropEvent:o}=t,{commands:l,chain:u,can:c}=new rb({editor:e,state:r}),f=[];return r.doc.nodesBetween(n,i,(v,y)=>{var S,w,T,_,C;if((w=(S=v.type)==null?void 0:S.spec)!=null&&w.code||!(v.isText||v.isTextblock||v.isInline))return;const N=(C=(_=(T=v.content)==null?void 0:T.size)!=null?_:v.nodeSize)!=null?C:0,A=Math.max(n,y),O=Math.min(i,y+N);if(A>=O)return;const j=v.isText?v.text||"":v.textBetween(A-y,O-y,void 0,"");Aee(j,a.find,s).forEach(F=>{if(F.index===void 0)return;const B=A+F.index+1,$=B+F[0].length,Z={from:r.tr.mapping.map(B),to:r.tr.mapping.map($)},I=a.handler({state:r,range:Z,match:F,commands:l,chain:u,can:c,pasteEvent:s,dropEvent:o});f.push(I)})}),f.every(v=>v!==null)}var Ay=null,Ree=t=>{var e;const r=new ClipboardEvent("paste",{clipboardData:new DataTransfer});return(e=r.clipboardData)==null||e.setData("text/html",t),r};function Oee(t){const{editor:e,rules:r}=t;let n=null,i=!1,a=!1,s=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,o;try{o=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{o=null}const l=({state:c,from:f,to:p,rule:v,pasteEvt:y})=>{const S=c.tr,w=tb({state:c,transaction:S});if(!(!Lee({editor:e,state:w,from:Math.max(f-1,0),to:p.b-1,rule:v,pasteEvent:y,dropEvent:o})||!S.steps.length)){try{o=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{o=null}return s=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,S}};return r.map(c=>new Hn({view(f){const p=y=>{var S;n=(S=f.dom.parentElement)!=null&&S.contains(y.target)?f.dom.parentElement:null,n&&(Ay=e)},v=()=>{Ay&&(Ay=null)};return window.addEventListener("dragstart",p),window.addEventListener("dragend",v),{destroy(){window.removeEventListener("dragstart",p),window.removeEventListener("dragend",v)}}},props:{handleDOMEvents:{drop:(f,p)=>{if(a=n===f.dom.parentElement,o=p,!a){const v=Ay;v?.isEditable&&setTimeout(()=>{const y=v.state.selection;y&&v.commands.deleteRange({from:y.from,to:y.to})},10)}return!1},paste:(f,p)=>{var v;const y=(v=p.clipboardData)==null?void 0:v.getData("text/html");return s=p,i=!!y?.includes("data-pm-slice"),!1}}},appendTransaction:(f,p,v)=>{const y=f[0],S=y.getMeta("uiEvent")==="paste"&&!i,w=y.getMeta("uiEvent")==="drop"&&!a,T=y.getMeta("applyPasteRules"),_=!!T;if(!S&&!w&&!_)return;if(_){let{text:A}=T;typeof A=="string"?A=A:A=vC(rt.from(A),v.schema);const{from:O}=T,j=O+A.length,D=Ree(A);return l({rule:c,state:v,from:O,to:{b:j},pasteEvt:D})}const C=p.doc.content.findDiffStart(v.doc.content),N=p.doc.content.findDiffEnd(v.doc.content);if(!(!Pee(C)||!N||C===N.b))return l({rule:c,state:v,from:C,to:N,pasteEvt:s})}}))}var ob=class{constructor(t,e){this.splittableMarks=[],this.editor=e,this.baseExtensions=t,this.extensions=U6(t),this.schema=WJ(this.extensions,e),this.setupExtensions()}get commands(){return this.extensions.reduce((t,e)=>{const r={name:e.name,options:e.options,storage:this.editor.extensionStorage[e.name],editor:this.editor,type:Ny(e.name,this.schema)},n=Ht(e,"addCommands",r);return n?{...t,...n()}:t},{})}get plugins(){const{editor:t}=this;return Ux([...this.extensions].reverse()).flatMap(n=>{const i={name:n.name,options:n.options,storage:this.editor.extensionStorage[n.name],editor:t,type:Ny(n.name,this.schema)},a=[],s=Ht(n,"addKeyboardShortcuts",i);let o={};if(n.type==="mark"&&Ht(n,"exitable",i)&&(o.ArrowRight=()=>Dh.handleExit({editor:t,mark:n})),s){const p=Object.fromEntries(Object.entries(s()).map(([v,y])=>[v,()=>y({editor:t})]));o={...o,...p}}const l=KQ(o);a.push(l);const u=Ht(n,"addInputRules",i);if(RP(n,t.options.enableInputRules)&&u){const p=u();if(p&&p.length){const v=Tee({editor:t,rules:p}),y=Array.isArray(v)?v:[v];a.push(...y)}}const c=Ht(n,"addPasteRules",i);if(RP(n,t.options.enablePasteRules)&&c){const p=c();if(p&&p.length){const v=Oee({editor:t,rules:p});a.push(...v)}}const f=Ht(n,"addProseMirrorPlugins",i);if(f){const p=f();a.push(...p)}return a})}get attributes(){return z6(this.extensions)}get nodeViews(){const{editor:t}=this,{nodeExtensions:e}=rm(this.extensions);return Object.fromEntries(e.filter(r=>!!Ht(r,"addNodeView")).map(r=>{const n=this.attributes.filter(l=>l.type===r.name),i={name:r.name,options:r.options,storage:this.editor.extensionStorage[r.name],editor:t,type:Ri(r.name,this.schema)},a=Ht(r,"addNodeView",i);if(!a)return[];const s=a();if(!s)return[];const o=(l,u,c,f,p)=>{const v=Wv(l,n);return s({node:l,view:u,getPos:c,decorations:f,innerDecorations:p,editor:t,extension:r,HTMLAttributes:v})};return[r.name,o]}))}dispatchTransaction(t){const{editor:e}=this;return Ux([...this.extensions].reverse()).reduceRight((n,i)=>{const a={name:i.name,options:i.options,storage:this.editor.extensionStorage[i.name],editor:e,type:Ny(i.name,this.schema)},s=Ht(i,"dispatchTransaction",a);return s?o=>{s.call(a,{transaction:o,next:n})}:n},t)}get markViews(){const{editor:t}=this,{markExtensions:e}=rm(this.extensions);return Object.fromEntries(e.filter(r=>!!Ht(r,"addMarkView")).map(r=>{const n=this.attributes.filter(o=>o.type===r.name),i={name:r.name,options:r.options,storage:this.editor.extensionStorage[r.name],editor:t,type:Cc(r.name,this.schema)},a=Ht(r,"addMarkView",i);if(!a)return[];const s=(o,l,u)=>{const c=Wv(o,n);return a()({mark:o,view:l,inline:u,editor:t,extension:r,HTMLAttributes:c,updateAttributes:f=>{Kee(o,t,f)}})};return[r.name,s]}))}setupExtensions(){const t=this.extensions;this.editor.extensionStorage=Object.fromEntries(t.map(e=>[e.name,e.storage])),t.forEach(e=>{var r;const n={name:e.name,options:e.options,storage:this.editor.extensionStorage[e.name],editor:this.editor,type:Ny(e.name,this.schema)};e.type==="mark"&&((r=rn(Ht(e,"keepOnSplit",n)))==null||r)&&this.splittableMarks.push(e.name);const i=Ht(e,"onBeforeCreate",n),a=Ht(e,"onCreate",n),s=Ht(e,"onUpdate",n),o=Ht(e,"onSelectionUpdate",n),l=Ht(e,"onTransaction",n),u=Ht(e,"onFocus",n),c=Ht(e,"onBlur",n),f=Ht(e,"onDestroy",n);i&&this.editor.on("beforeCreate",i),a&&this.editor.on("create",a),s&&this.editor.on("update",s),o&&this.editor.on("selectionUpdate",o),l&&this.editor.on("transaction",l),u&&this.editor.on("focus",u),c&&this.editor.on("blur",c),f&&this.editor.on("destroy",f)})}};ob.resolve=U6;ob.sort=Ux;ob.flatten=gC;var Dee={};hC(Dee,{ClipboardTextSerializer:()=>Q6,Commands:()=>J6,Delete:()=>eD,Drop:()=>tD,Editable:()=>rD,FocusEvents:()=>iD,Keymap:()=>aD,Paste:()=>sD,Tabindex:()=>oD,TextDirection:()=>lD,focusEventsPluginKey:()=>nD});var bi=class X6 extends xC{constructor(){super(...arguments),this.type="extension"}static create(e={}){const r=typeof e=="function"?e():e;return new X6(r)}configure(e){return super.configure(e)}extend(e){const r=typeof e=="function"?e():e;return super.extend(r)}},Q6=bi.create({name:"clipboardTextSerializer",addOptions(){return{blockSeparator:void 0}},addProseMirrorPlugins(){return[new Hn({key:new xi("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:t}=this,{state:e,schema:r}=t,{doc:n,selection:i}=e,{ranges:a}=i,s=Math.min(...a.map(c=>c.$from.pos)),o=Math.max(...a.map(c=>c.$to.pos)),l=V6(r);return G6(n,{from:s,to:o},{...this.options.blockSeparator!==void 0?{blockSeparator:this.options.blockSeparator}:{},textSerializers:l})}}})]}}),J6=bi.create({name:"commands",addCommands(){return{...A6}}}),eD=bi.create({name:"delete",onUpdate({transaction:t,appendedTransactions:e}){var r,n,i;const a=()=>{var s,o,l,u;if((u=(l=(o=(s=this.editor.options.coreExtensionOptions)==null?void 0:s.delete)==null?void 0:o.filterTransaction)==null?void 0:l.call(o,t))!=null?u:t.getMeta("y-sync$"))return;const c=F6(t.before,[t,...e]);W6(c).forEach(v=>{c.mapping.mapResult(v.oldRange.from).deletedAfter&&c.mapping.mapResult(v.oldRange.to).deletedBefore&&c.before.nodesBetween(v.oldRange.from,v.oldRange.to,(y,S)=>{const w=S+y.nodeSize-2,T=v.oldRange.from<=S&&w<=v.oldRange.to;this.editor.emit("delete",{type:"node",node:y,from:S,to:w,newFrom:c.mapping.map(S),newTo:c.mapping.map(w),deletedRange:v.oldRange,newRange:v.newRange,partial:!T,editor:this.editor,transaction:t,combinedTransform:c})})});const p=c.mapping;c.steps.forEach((v,y)=>{var S,w;if(v instanceof _l){const T=p.slice(y).map(v.from,-1),_=p.slice(y).map(v.to),C=p.invert().map(T,-1),N=p.invert().map(_),A=(S=c.doc.nodeAt(T-1))==null?void 0:S.marks.some(j=>j.eq(v.mark)),O=(w=c.doc.nodeAt(_))==null?void 0:w.marks.some(j=>j.eq(v.mark));this.editor.emit("delete",{type:"mark",mark:v.mark,from:v.from,to:v.to,deletedRange:{from:C,to:N},newRange:{from:T,to:_},partial:!!(O||A),editor:this.editor,transaction:t,combinedTransform:c})}})};(i=(n=(r=this.editor.options.coreExtensionOptions)==null?void 0:r.delete)==null?void 0:n.async)==null||i?setTimeout(a,0):a()}}),tD=bi.create({name:"drop",addProseMirrorPlugins(){return[new Hn({key:new xi("tiptapDrop"),props:{handleDrop:(t,e,r,n)=>{this.editor.emit("drop",{editor:this.editor,event:e,slice:r,moved:n})}}})]}}),rD=bi.create({name:"editable",addProseMirrorPlugins(){return[new Hn({key:new xi("editable"),props:{editable:()=>this.editor.options.editable}})]}}),nD=new xi("focusEvents"),iD=bi.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:t}=this;return[new Hn({key:nD,props:{handleDOMEvents:{focus:(e,r)=>{t.isFocused=!0;const n=t.state.tr.setMeta("focus",{event:r}).setMeta("addToHistory",!1);return e.dispatch(n),!1},blur:(e,r)=>{t.isFocused=!1;const n=t.state.tr.setMeta("blur",{event:r}).setMeta("addToHistory",!1);return e.dispatch(n),!1}}}})]}}),aD=bi.create({name:"keymap",addKeyboardShortcuts(){const t=()=>this.editor.commands.first(({commands:s})=>[()=>s.undoInputRule(),()=>s.command(({tr:o})=>{const{selection:l,doc:u}=o,{empty:c,$anchor:f}=l,{pos:p,parent:v}=f,y=f.parent.isTextblock&&p>0?o.doc.resolve(p-1):f,S=y.parent.type.spec.isolating,w=f.pos-f.parentOffset,T=S&&y.parent.childCount===1?w===f.pos:yr.atStart(u).from===p;return!c||!v.type.isTextblock||v.textContent.length||!T||T&&f.parent.type.name==="paragraph"?!1:s.clearNodes()}),()=>s.deleteSelection(),()=>s.joinBackward(),()=>s.selectNodeBackward()]),e=()=>this.editor.commands.first(({commands:s})=>[()=>s.deleteSelection(),()=>s.deleteCurrentNode(),()=>s.joinForward(),()=>s.selectNodeForward()]),n={Enter:()=>this.editor.commands.first(({commands:s})=>[()=>s.newlineInCode(),()=>s.createParagraphNear(),()=>s.liftEmptyBlock(),()=>s.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:t,"Mod-Backspace":t,"Shift-Backspace":t,Delete:e,"Mod-Delete":e,"Mod-a":()=>this.editor.commands.selectAll()},i={...n},a={...n,"Ctrl-h":t,"Alt-Backspace":t,"Ctrl-d":e,"Ctrl-Alt-Backspace":e,"Alt-Delete":e,"Alt-d":e,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return zx()||I6()?a:i},addProseMirrorPlugins(){return[new Hn({key:new xi("clearDocument"),appendTransaction:(t,e,r)=>{if(t.some(S=>S.getMeta("composition")))return;const n=t.some(S=>S.docChanged)&&!e.doc.eq(r.doc),i=t.some(S=>S.getMeta("preventClearDocument"));if(!n||i)return;const{empty:a,from:s,to:o}=e.selection,l=yr.atStart(e.doc).from,u=yr.atEnd(e.doc).to;if(a||!(s===l&&o===u)||!ab(r.doc))return;const p=r.tr,v=tb({state:r,transaction:p}),{commands:y}=new rb({editor:this.editor,state:v});if(y.clearNodes(),!!p.steps.length)return p}})]}}),sD=bi.create({name:"paste",addProseMirrorPlugins(){return[new Hn({key:new xi("tiptapPaste"),props:{handlePaste:(t,e,r)=>{this.editor.emit("paste",{editor:this.editor,event:e,slice:r})}}})]}}),oD=bi.create({name:"tabindex",addProseMirrorPlugins(){return[new Hn({key:new xi("tabindex"),props:{attributes:()=>this.editor.isEditable?{tabindex:"0"}:{}}})]}}),lD=bi.create({name:"textDirection",addOptions(){return{direction:void 0}},addGlobalAttributes(){if(!this.options.direction)return[];const{nodeExtensions:t}=rm(this.extensions);return[{types:t.filter(e=>e.name!=="text").map(e=>e.name),attributes:{dir:{default:this.options.direction,parseHTML:e=>{const r=e.getAttribute("dir");return r&&(r==="ltr"||r==="rtl"||r==="auto")?r:this.options.direction},renderHTML:e=>e.dir?{dir:e.dir}:{}}}}]},addProseMirrorPlugins(){return[new Hn({key:new xi("textDirection"),props:{attributes:()=>{const t=this.options.direction;return t?{dir:t}:{}}}})]}}),Iee=class Lp{constructor(e,r,n=!1,i=null){this.currentNode=null,this.actualDepth=null,this.isBlock=n,this.resolvedPos=e,this.editor=r,this.currentNode=i}get name(){return this.node.type.name}get node(){return this.currentNode||this.resolvedPos.node()}get element(){return this.editor.view.domAtPos(this.pos).node}get depth(){var e;return(e=this.actualDepth)!=null?e:this.resolvedPos.depth}get pos(){return this.resolvedPos.pos}get content(){return this.node.content}set content(e){let r=this.from,n=this.to;if(this.isBlock){if(this.content.size===0){console.error(`You cant set content on a block node. Tried to set content on ${this.name} at ${this.pos}`);return}r=this.from+1,n=this.to-1}this.editor.commands.insertContentAt({from:r,to:n},e)}get attributes(){return this.node.attrs}get textContent(){return this.node.textContent}get size(){return this.node.nodeSize}get from(){return this.isBlock?this.pos:this.resolvedPos.start(this.resolvedPos.depth)}get range(){return{from:this.from,to:this.to}}get to(){return this.isBlock?this.pos+this.size:this.resolvedPos.end(this.resolvedPos.depth)+(this.node.isText?0:1)}get parent(){if(this.depth===0)return null;const e=this.resolvedPos.start(this.resolvedPos.depth-1),r=this.resolvedPos.doc.resolve(e);return new Lp(r,this.editor)}get before(){let e=this.resolvedPos.doc.resolve(this.from-(this.isBlock?1:2));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.from-3)),new Lp(e,this.editor)}get after(){let e=this.resolvedPos.doc.resolve(this.to+(this.isBlock?2:1));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.to+3)),new Lp(e,this.editor)}get children(){const e=[];return this.node.content.forEach((r,n)=>{const i=r.isBlock&&!r.isTextblock,a=r.isAtom&&!r.isText,s=this.pos+n+(a?0:1);if(s<0||s>this.resolvedPos.doc.nodeSize-2)return;const o=this.resolvedPos.doc.resolve(s);if(!i&&o.depth<=this.depth)return;const l=new Lp(o,this.editor,i,i?r:null);i&&(l.actualDepth=this.depth+1),e.push(new Lp(o,this.editor,i,i?r:null))}),e}get firstChild(){return this.children[0]||null}get lastChild(){const e=this.children;return e[e.length-1]||null}closest(e,r={}){let n=null,i=this.parent;for(;i&&!n;){if(i.node.type.name===e)if(Object.keys(r).length>0){const a=i.node.attrs,s=Object.keys(r);for(let o=0;o<s.length;o+=1){const l=s[o];if(a[l]!==r[l])break}}else n=i;i=i.parent}return n}querySelector(e,r={}){return this.querySelectorAll(e,r,!0)[0]||null}querySelectorAll(e,r={},n=!1){let i=[];if(!this.children||this.children.length===0)return i;const a=Object.keys(r);return this.children.forEach(s=>{n&&i.length>0||(s.node.type.name===e&&a.every(l=>r[l]===s.node.attrs[l])&&i.push(s),!(n&&i.length>0)&&(i=i.concat(s.querySelectorAll(e,r,n))))}),i}setAttribute(e){const{tr:r}=this.editor.state;r.setNodeMarkup(this.from,void 0,{...this.node.attrs,...e}),this.editor.view.dispatch(r)}},jee=`.ProseMirror {
  position: relative;
}

.ProseMirror {
  word-wrap: break-word;
  white-space: pre-wrap;
  white-space: break-spaces;
  -webkit-font-variant-ligatures: none;
  font-variant-ligatures: none;
  font-feature-settings: "liga" 0; /* the above doesn't seem to work in Edge */
}

.ProseMirror [contenteditable="false"] {
  white-space: normal;
}

.ProseMirror [contenteditable="false"] [contenteditable="true"] {
  white-space: pre-wrap;
}

.ProseMirror pre {
  white-space: pre-wrap;
}

img.ProseMirror-separator {
  display: inline !important;
  border: none !important;
  margin: 0 !important;
  width: 0 !important;
  height: 0 !important;
}

.ProseMirror-gapcursor {
  display: none;
  pointer-events: none;
  position: absolute;
  margin: 0;
}

.ProseMirror-gapcursor:after {
  content: "";
  display: block;
  position: absolute;
  top: -2px;
  width: 20px;
  border-top: 1px solid black;
  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;
}

@keyframes ProseMirror-cursor-blink {
  to {
    visibility: hidden;
  }
}

.ProseMirror-hideselection *::selection {
  background: transparent;
}

.ProseMirror-hideselection *::-moz-selection {
  background: transparent;
}

.ProseMirror-hideselection * {
  caret-color: transparent;
}

.ProseMirror-focused .ProseMirror-gapcursor {
  display: block;
}`;function Fee(t,e,r){const n=document.querySelector("style[data-tiptap-style]");if(n!==null)return n;const i=document.createElement("style");return e&&i.setAttribute("nonce",e),i.setAttribute("data-tiptap-style",""),i.innerHTML=t,document.getElementsByTagName("head")[0].appendChild(i),i}var Bee=class extends Cee{constructor(t={}){super(),this.css=null,this.className="tiptap",this.editorView=null,this.isFocused=!1,this.isInitialized=!1,this.extensionStorage={},this.instanceId=Math.random().toString(36).slice(2,9),this.options={element:typeof document<"u"?document.createElement("div"):null,content:"",injectCSS:!0,injectNonce:void 0,extensions:[],autofocus:!1,editable:!0,textDirection:void 0,editorProps:{},parseOptions:{},coreExtensionOptions:{},enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!0,enableContentCheck:!1,emitContentError:!1,onBeforeCreate:()=>null,onCreate:()=>null,onMount:()=>null,onUnmount:()=>null,onUpdate:()=>null,onSelectionUpdate:()=>null,onTransaction:()=>null,onFocus:()=>null,onBlur:()=>null,onDestroy:()=>null,onContentError:({error:n})=>{throw n},onPaste:()=>null,onDrop:()=>null,onDelete:()=>null,enableExtensionDispatchTransaction:!0},this.isCapturingTransaction=!1,this.capturedTransaction=null,this.utils={getUpdatedPosition:ree,createMappablePosition:nee},this.setOptions(t),this.createExtensionManager(),this.createCommandManager(),this.createSchema(),this.on("beforeCreate",this.options.onBeforeCreate),this.emit("beforeCreate",{editor:this}),this.on("mount",this.options.onMount),this.on("unmount",this.options.onUnmount),this.on("contentError",this.options.onContentError),this.on("create",this.options.onCreate),this.on("update",this.options.onUpdate),this.on("selectionUpdate",this.options.onSelectionUpdate),this.on("transaction",this.options.onTransaction),this.on("focus",this.options.onFocus),this.on("blur",this.options.onBlur),this.on("destroy",this.options.onDestroy),this.on("drop",({event:n,slice:i,moved:a})=>this.options.onDrop(n,i,a)),this.on("paste",({event:n,slice:i})=>this.options.onPaste(n,i)),this.on("delete",this.options.onDelete);const e=this.createDoc(),r=O6(e,this.options.autofocus);this.editorState=Fp.create({doc:e,schema:this.schema,selection:r||void 0}),this.options.element&&this.mount(this.options.element)}mount(t){if(typeof document>"u")throw new Error("[tiptap error]: The editor cannot be mounted because there is no 'document' defined in this environment.");this.createView(t),this.emit("mount",{editor:this}),this.css&&!document.head.contains(this.css)&&document.head.appendChild(this.css),window.setTimeout(()=>{this.isDestroyed||(this.options.autofocus!==!1&&this.options.autofocus!==null&&this.commands.focus(this.options.autofocus),this.emit("create",{editor:this}),this.isInitialized=!0)},0)}unmount(){if(this.editorView){const t=this.editorView.dom;t?.editor&&delete t.editor,this.editorView.destroy()}if(this.editorView=null,this.isInitialized=!1,this.css&&!document.querySelectorAll(`.${this.className}`).length)try{typeof this.css.remove=="function"?this.css.remove():this.css.parentNode&&this.css.parentNode.removeChild(this.css)}catch(t){console.warn("Failed to remove CSS element:",t)}this.css=null,this.emit("unmount",{editor:this})}get storage(){return this.extensionStorage}get commands(){return this.commandManager.commands}chain(){return this.commandManager.chain()}can(){return this.commandManager.can()}injectCSS(){this.options.injectCSS&&typeof document<"u"&&(this.css=Fee(jee,this.options.injectNonce))}setOptions(t={}){this.options={...this.options,...t},!(!this.editorView||!this.state||this.isDestroyed)&&(this.options.editorProps&&this.view.setProps(this.options.editorProps),this.view.updateState(this.state))}setEditable(t,e=!0){this.setOptions({editable:t}),e&&this.emit("update",{editor:this,transaction:this.state.tr,appendedTransactions:[]})}get isEditable(){return this.options.editable&&this.view&&this.view.editable}get view(){return this.editorView?this.editorView:new Proxy({state:this.editorState,updateState:t=>{this.editorState=t},dispatch:t=>{this.dispatchTransaction(t)},composing:!1,dragging:null,editable:!0,isDestroyed:!1},{get:(t,e)=>{if(this.editorView)return this.editorView[e];if(e==="state")return this.editorState;if(e in t)return Reflect.get(t,e);throw new Error(`[tiptap error]: The editor view is not available. Cannot access view['${e}']. The editor may not be mounted yet.`)}})}get state(){return this.editorView&&(this.editorState=this.view.state),this.editorState}registerPlugin(t,e){const r=B6(e)?e(t,[...this.state.plugins]):[...this.state.plugins,t],n=this.state.reconfigure({plugins:r});return this.view.updateState(n),n}unregisterPlugin(t){if(this.isDestroyed)return;const e=this.state.plugins;let r=e;if([].concat(t).forEach(i=>{const a=typeof i=="string"?`${i}$`:i.key;r=r.filter(s=>!s.key.startsWith(a))}),e.length===r.length)return;const n=this.state.reconfigure({plugins:r});return this.view.updateState(n),n}createExtensionManager(){var t,e;const n=[...this.options.enableCoreExtensions?[rD,Q6.configure({blockSeparator:(e=(t=this.options.coreExtensionOptions)==null?void 0:t.clipboardTextSerializer)==null?void 0:e.blockSeparator}),J6,iD,aD,oD,tD,sD,eD,lD.configure({direction:this.options.textDirection})].filter(i=>typeof this.options.enableCoreExtensions=="object"?this.options.enableCoreExtensions[i.name]!==!1:!0):[],...this.options.extensions].filter(i=>["extension","node","mark"].includes(i?.type));this.extensionManager=new ob(n,this)}createCommandManager(){this.commandManager=new rb({editor:this})}createSchema(){this.schema=this.extensionManager.schema}createDoc(){let t;try{t=Rk(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:this.options.enableContentCheck})}catch(e){if(!(e instanceof Error)||!["[tiptap error]: Invalid JSON content","[tiptap error]: Invalid HTML content"].includes(e.message))throw e;this.emit("contentError",{editor:this,error:e,disableCollaboration:()=>{"collaboration"in this.storage&&typeof this.storage.collaboration=="object"&&this.storage.collaboration&&(this.storage.collaboration.isDisabled=!0),this.options.extensions=this.options.extensions.filter(r=>r.name!=="collaboration"),this.createExtensionManager()}}),t=Rk(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:!1})}return t}createView(t){const{editorProps:e,enableExtensionDispatchTransaction:r}=this.options,n=e.dispatchTransaction||this.dispatchTransaction.bind(this),i=r?this.extensionManager.dispatchTransaction(n):n;this.editorView=new P6(t,{...e,attributes:{role:"textbox",...e?.attributes},dispatchTransaction:i,state:this.editorState,markViews:this.extensionManager.markViews,nodeViews:this.extensionManager.nodeViews});const a=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(a),this.prependClass(),this.injectCSS();const s=this.view.dom;s.editor=this}createNodeViews(){this.view.isDestroyed||this.view.setProps({markViews:this.extensionManager.markViews,nodeViews:this.extensionManager.nodeViews})}prependClass(){this.view.dom.className=`${this.className} ${this.view.dom.className}`}captureTransaction(t){this.isCapturingTransaction=!0,t(),this.isCapturingTransaction=!1;const e=this.capturedTransaction;return this.capturedTransaction=null,e}dispatchTransaction(t){if(this.view.isDestroyed)return;if(this.isCapturingTransaction){if(!this.capturedTransaction){this.capturedTransaction=t;return}t.steps.forEach(u=>{var c;return(c=this.capturedTransaction)==null?void 0:c.step(u)});return}const{state:e,transactions:r}=this.state.applyTransaction(t),n=!this.state.selection.eq(e.selection),i=r.includes(t),a=this.state;if(this.emit("beforeTransaction",{editor:this,transaction:t,nextState:e}),!i)return;this.view.updateState(e),this.emit("transaction",{editor:this,transaction:t,appendedTransactions:r.slice(1)}),n&&this.emit("selectionUpdate",{editor:this,transaction:t});const s=r.findLast(u=>u.getMeta("focus")||u.getMeta("blur")),o=s?.getMeta("focus"),l=s?.getMeta("blur");o&&this.emit("focus",{editor:this,event:o.event,transaction:s}),l&&this.emit("blur",{editor:this,event:l.event,transaction:s}),!(t.getMeta("preventUpdate")||!r.some(u=>u.docChanged)||a.doc.eq(e.doc))&&this.emit("update",{editor:this,transaction:t,appendedTransactions:r.slice(1)})}getAttributes(t){return H6(this.state,t)}isActive(t,e){const r=typeof t=="string"?t:null,n=typeof t=="string"?e:t;return JJ(this.state,r,n)}getJSON(){return this.state.doc.toJSON()}getHTML(){return vC(this.state.doc.content,this.schema)}getText(t){const{blockSeparator:e=`

`,textSerializers:r={}}=t||{};return $J(this.state.doc,{blockSeparator:e,textSerializers:{...V6(this.schema),...r}})}get isEmpty(){return ab(this.state.doc)}destroy(){this.emit("destroy"),this.unmount(),this.removeAllListeners()}get isDestroyed(){var t,e;return(e=(t=this.editorView)==null?void 0:t.isDestroyed)!=null?e:!0}$node(t,e){var r;return((r=this.$doc)==null?void 0:r.querySelector(t,e))||null}$nodes(t,e){var r;return((r=this.$doc)==null?void 0:r.querySelectorAll(t,e))||null}$pos(t){const e=this.state.doc.resolve(t);return new Iee(e,this)}get $doc(){return this.$pos(0)}};function nm(t){return new sb({find:t.find,handler:({state:e,range:r,match:n})=>{const i=rn(t.getAttributes,void 0,n);if(i===!1||i===null)return null;const{tr:a}=e,s=n[n.length-1],o=n[0];if(s){const l=o.search(/\S/),u=r.from+o.indexOf(s),c=u+s.length;if(yC(r.from,r.to,e.doc).filter(v=>v.mark.type.excluded.find(S=>S===t.type&&S!==v.mark.type)).filter(v=>v.to>u).length)return null;c<r.to&&a.delete(c,r.to),u>r.from&&a.delete(r.from+l,u);const p=r.from+l+s.length;a.addMark(r.from+l,p,t.type.create(i||{})),a.removeStoredMark(t.type)}},undoable:t.undoable})}function zee(t){return new sb({find:t.find,handler:({state:e,range:r,match:n})=>{const i=rn(t.getAttributes,void 0,n)||{},{tr:a}=e,s=r.from;let o=r.to;const l=t.type.create(i);if(n[1]){const u=n[0].lastIndexOf(n[1]);let c=s+u;c>o?c=o:o=c+n[1].length;const f=n[0][n[0].length-1];a.insertText(f,s+n[0].length-1),a.replaceWith(c,o,l)}else if(n[0]){const u=t.type.isInline?s:s-1;a.insert(u,t.type.create(i)).delete(a.mapping.map(s),a.mapping.map(o))}a.scrollIntoView()},undoable:t.undoable})}function Dk(t){return new sb({find:t.find,handler:({state:e,range:r,match:n})=>{const i=e.doc.resolve(r.from),a=rn(t.getAttributes,void 0,n)||{};if(!i.node(-1).canReplaceWith(i.index(-1),i.indexAfter(-1),t.type))return null;e.tr.delete(r.from,r.to).setBlockType(r.from,r.from,t.type,a)},undoable:t.undoable})}function im(t){return new sb({find:t.find,handler:({state:e,range:r,match:n,chain:i})=>{const a=rn(t.getAttributes,void 0,n)||{},s=e.tr.delete(r.from,r.to),l=s.doc.resolve(r.from).blockRange(),u=l&&X_(l,t.type,a);if(!u)return null;if(s.wrap(l,u),t.keepMarks&&t.editor){const{selection:f,storedMarks:p}=e,{splittableMarks:v}=t.editor.extensionManager,y=p||f.$to.parentOffset&&f.$from.marks();if(y){const S=y.filter(w=>v.includes(w.type.name));s.ensureMarks(S)}}if(t.keepAttributes){const f=t.type.name==="bulletList"||t.type.name==="orderedList"?"listItem":"taskList";i().updateAttributes(f,a).run()}const c=s.doc.resolve(r.from-1).nodeBefore;c&&c.type===t.type&&pf(s.doc,r.from-1)&&(!t.joinPredicate||t.joinPredicate(n,c))&&s.join(r.from-1)},undoable:t.undoable})}function Uee(t,e){const{selection:r}=t,{$from:n}=r;if(r instanceof Yt){const a=n.index();return n.parent.canReplaceWith(a,a+1,e)}let i=n.depth;for(;i>=0;){const a=n.index(i);if(n.node(i).contentMatchAt(a).matchType(e))return!0;i-=1}return!1}function Gee(t){return t.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&")}var Vee={};hC(Vee,{createAtomBlockMarkdownSpec:()=>Hee,createBlockMarkdownSpec:()=>Wee,createInlineMarkdownSpec:()=>uD,parseAttributes:()=>bC,parseIndentedBlocks:()=>Ik,renderNestedMarkdownContent:()=>SC,serializeAttributes:()=>wC});function bC(t){if(!t?.trim())return{};const e={},r=[],n=t.replace(/["']([^"']*)["']/g,u=>(r.push(u),`__QUOTED_${r.length-1}__`)),i=n.match(/(?:^|\s)\.([a-zA-Z][\w-]*)/g);if(i){const u=i.map(c=>c.trim().slice(1));e.class=u.join(" ")}const a=n.match(/(?:^|\s)#([a-zA-Z][\w-]*)/);a&&(e.id=a[1]);const s=/([a-zA-Z][\w-]*)\s*=\s*(__QUOTED_\d+__)/g;Array.from(n.matchAll(s)).forEach(([,u,c])=>{var f;const p=parseInt(((f=c.match(/__QUOTED_(\d+)__/))==null?void 0:f[1])||"0",10),v=r[p];v&&(e[u]=v.slice(1,-1))});const l=n.replace(/(?:^|\s)\.([a-zA-Z][\w-]*)/g,"").replace(/(?:^|\s)#([a-zA-Z][\w-]*)/g,"").replace(/([a-zA-Z][\w-]*)\s*=\s*__QUOTED_\d+__/g,"").trim();return l&&l.split(/\s+/).filter(Boolean).forEach(c=>{c.match(/^[a-zA-Z][\w-]*$/)&&(e[c]=!0)}),e}function wC(t){if(!t||Object.keys(t).length===0)return"";const e=[];return t.class&&String(t.class).split(/\s+/).filter(Boolean).forEach(n=>e.push(`.${n}`)),t.id&&e.push(`#${t.id}`),Object.entries(t).forEach(([r,n])=>{r==="class"||r==="id"||(n===!0?e.push(r):n!==!1&&n!=null&&e.push(`${r}="${String(n)}"`))}),e.join(" ")}function Hee(t){const{nodeName:e,name:r,parseAttributes:n=bC,serializeAttributes:i=wC,defaultAttributes:a={},requiredAttributes:s=[],allowedAttributes:o}=t,l=r||e,u=c=>{if(!o)return c;const f={};return o.forEach(p=>{p in c&&(f[p]=c[p])}),f};return{parseMarkdown:(c,f)=>{const p={...a,...c.attributes};return f.createNode(e,p,[])},markdownTokenizer:{name:e,level:"block",start(c){var f;const p=new RegExp(`^:::${l}(?:\\s|$)`,"m"),v=(f=c.match(p))==null?void 0:f.index;return v!==void 0?v:-1},tokenize(c,f,p){const v=new RegExp(`^:::${l}(?:\\s+\\{([^}]*)\\})?\\s*:::(?:\\n|$)`),y=c.match(v);if(!y)return;const S=y[1]||"",w=n(S);if(!s.find(_=>!(_ in w)))return{type:e,raw:y[0],attributes:w}}},renderMarkdown:c=>{const f=u(c.attrs||{}),p=i(f),v=p?` {${p}}`:"";return`:::${l}${v} :::`}}}function Wee(t){const{nodeName:e,name:r,getContent:n,parseAttributes:i=bC,serializeAttributes:a=wC,defaultAttributes:s={},content:o="block",allowedAttributes:l}=t,u=r||e,c=f=>{if(!l)return f;const p={};return l.forEach(v=>{v in f&&(p[v]=f[v])}),p};return{parseMarkdown:(f,p)=>{let v;if(n){const S=n(f);v=typeof S=="string"?[{type:"text",text:S}]:S}else o==="block"?v=p.parseChildren(f.tokens||[]):v=p.parseInline(f.tokens||[]);const y={...s,...f.attributes};return p.createNode(e,y,v)},markdownTokenizer:{name:e,level:"block",start(f){var p;const v=new RegExp(`^:::${u}`,"m"),y=(p=f.match(v))==null?void 0:p.index;return y!==void 0?y:-1},tokenize(f,p,v){var y;const S=new RegExp(`^:::${u}(?:\\s+\\{([^}]*)\\})?\\s*\\n`),w=f.match(S);if(!w)return;const[T,_=""]=w,C=i(_);let N=1;const A=T.length;let O="";const j=/^:::([\w-]*)(\s.*)?/gm,D=f.slice(A);for(j.lastIndex=0;;){const F=j.exec(D);if(F===null)break;const B=F.index,$=F[1];if(!((y=F[2])!=null&&y.endsWith(":::"))){if($)N+=1;else if(N-=1,N===0){const Z=D.slice(0,B);O=Z.trim();const I=f.slice(0,A+B+F[0].length);let q=[];if(O)if(o==="block")for(q=v.blockTokens(Z),q.forEach(U=>{U.text&&(!U.tokens||U.tokens.length===0)&&(U.tokens=v.inlineTokens(U.text))});q.length>0;){const U=q[q.length-1];if(U.type==="paragraph"&&(!U.text||U.text.trim()===""))q.pop();else break}else q=v.inlineTokens(O);return{type:e,raw:I,attributes:C,content:O,tokens:q}}}}}},renderMarkdown:(f,p)=>{const v=c(f.attrs||{}),y=a(v),S=y?` {${y}}`:"",w=p.renderChildren(f.content||[],`

`);return`:::${u}${S}

${w}

:::`}}}function qee(t){if(!t.trim())return{};const e={},r=/(\w+)=(?:"([^"]*)"|'([^']*)')/g;let n=r.exec(t);for(;n!==null;){const[,i,a,s]=n;e[i]=a||s,n=r.exec(t)}return e}function $ee(t){return Object.entries(t).filter(([,e])=>e!=null).map(([e,r])=>`${e}="${r}"`).join(" ")}function uD(t){const{nodeName:e,name:r,getContent:n,parseAttributes:i=qee,serializeAttributes:a=$ee,defaultAttributes:s={},selfClosing:o=!1,allowedAttributes:l}=t,u=r||e,c=p=>{if(!l)return p;const v={};return l.forEach(y=>{const S=typeof y=="string"?y:y.name,w=typeof y=="string"?void 0:y.skipIfDefault;if(S in p){const T=p[S];if(w!==void 0&&T===w)return;v[S]=T}}),v},f=u.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return{parseMarkdown:(p,v)=>{const y={...s,...p.attributes};if(o)return v.createNode(e,y);const S=n?n(p):p.content||"";return S?v.createNode(e,y,[v.createTextNode(S)]):v.createNode(e,y,[])},markdownTokenizer:{name:e,level:"inline",start(p){const v=o?new RegExp(`\\[${f}\\s*[^\\]]*\\]`):new RegExp(`\\[${f}\\s*[^\\]]*\\][\\s\\S]*?\\[\\/${f}\\]`),y=p.match(v),S=y?.index;return S!==void 0?S:-1},tokenize(p,v,y){const S=o?new RegExp(`^\\[${f}\\s*([^\\]]*)\\]`):new RegExp(`^\\[${f}\\s*([^\\]]*)\\]([\\s\\S]*?)\\[\\/${f}\\]`),w=p.match(S);if(!w)return;let T="",_="";if(o){const[,N]=w;_=N}else{const[,N,A]=w;_=N,T=A||""}const C=i(_.trim());return{type:e,raw:w[0],content:T.trim(),attributes:C}}},renderMarkdown:p=>{let v="";n?v=n(p):p.content&&p.content.length>0&&(v=p.content.filter(T=>T.type==="text").map(T=>T.text).join(""));const y=c(p.attrs||{}),S=a(y),w=S?` ${S}`:"";return o?`[${u}${w}]`:`[${u}${w}]${v}[/${u}]`}}}function Ik(t,e,r){var n,i,a,s;const o=t.split(`
`),l=[];let u="",c=0;const f=e.baseIndentSize||2;for(;c<o.length;){const p=o[c],v=p.match(e.itemPattern);if(!v){if(l.length>0)break;if(p.trim()===""){c+=1,u=`${u}${p}
`;continue}else return}const y=e.extractItemData(v),{indentLevel:S,mainContent:w}=y;u=`${u}${p}
`;const T=[w];for(c+=1;c<o.length;){const A=o[c];if(A.trim()===""){const j=o.slice(c+1).findIndex(B=>B.trim()!=="");if(j===-1)break;if((((i=(n=o[c+1+j].match(/^(\s*)/))==null?void 0:n[1])==null?void 0:i.length)||0)>S){T.push(A),u=`${u}${A}
`,c+=1;continue}else break}if((((s=(a=A.match(/^(\s*)/))==null?void 0:a[1])==null?void 0:s.length)||0)>S)T.push(A),u=`${u}${A}
`,c+=1;else break}let _;const C=T.slice(1);if(C.length>0){const A=C.map(O=>O.slice(S+f)).join(`
`);A.trim()&&(e.customNestedParser?_=e.customNestedParser(A):_=r.blockTokens(A))}const N=e.createToken(y,_);l.push(N)}if(l.length!==0)return{items:l,raw:u}}function SC(t,e,r,n){if(!t||!Array.isArray(t.content))return"";const i=typeof r=="function"?r(n):r,[a,...s]=t.content,o=e.renderChildren([a]),l=[`${i}${o}`];return s&&s.length>0&&s.forEach(u=>{const c=e.renderChildren([u]);if(c){const f=c.split(`
`).map(p=>p?e.indent(p):"").join(`
`);l.push(f)}}),l.join(`
`)}function Kee(t,e,r={}){const{state:n}=e,{doc:i,tr:a}=n,s=t;i.descendants((o,l)=>{const u=a.mapping.map(l),c=a.mapping.map(l)+o.nodeSize;let f=null;if(o.marks.forEach(v=>{if(v!==s)return!1;f=v}),!f)return;let p=!1;if(Object.keys(r).forEach(v=>{r[v]!==f.attrs[v]&&(p=!0)}),p){const v=t.type.create({...t.attrs,...r});a.removeMark(u,c,t.type),a.addMark(u,c,v)}}),a.docChanged&&e.view.dispatch(a)}var Zs=class cD extends xC{constructor(){super(...arguments),this.type="node"}static create(e={}){const r=typeof e=="function"?e():e;return new cD(r)}configure(e){return super.configure(e)}extend(e){const r=typeof e=="function"?e():e;return super.extend(r)}};function Nh(t){return new Mee({find:t.find,handler:({state:e,range:r,match:n,pasteEvent:i})=>{const a=rn(t.getAttributes,void 0,n,i);if(a===!1||a===null)return null;const{tr:s}=e,o=n[n.length-1],l=n[0];let u=r.to;if(o){const c=l.search(/\S/),f=r.from+l.indexOf(o),p=f+o.length;if(yC(r.from,r.to,e.doc).filter(y=>y.mark.type.excluded.find(w=>w===t.type&&w!==y.mark.type)).filter(y=>y.to>f).length)return null;p<r.to&&s.delete(p,r.to),f>r.from&&s.delete(r.from+c,f),u=r.from+c+o.length,s.addMark(r.from+c,u,t.type.create(a||{})),s.removeStoredMark(t.type)}}})}const{getOwnPropertyNames:Zee,getOwnPropertySymbols:Yee}=Object,{hasOwnProperty:Xee}=Object.prototype;function vS(t,e){return function(n,i,a){return t(n,i,a)&&e(n,i,a)}}function Ly(t){return function(r,n,i){if(!r||!n||typeof r!="object"||typeof n!="object")return t(r,n,i);const{cache:a}=i,s=a.get(r),o=a.get(n);if(s&&o)return s===n&&o===r;a.set(r,n),a.set(n,r);const l=t(r,n,i);return a.delete(r),a.delete(n),l}}function Qee(t){return t?.[Symbol.toStringTag]}function IP(t){return Zee(t).concat(Yee(t))}const Jee=Object.hasOwn||((t,e)=>Xee.call(t,e));function Ih(t,e){return t===e||!t&&!e&&t!==t&&e!==e}const ete="__v",tte="__o",rte="_owner",{getOwnPropertyDescriptor:jP,keys:FP}=Object;function nte(t,e){return t.byteLength===e.byteLength&&Gx(new Uint8Array(t),new Uint8Array(e))}function ite(t,e,r){let n=t.length;if(e.length!==n)return!1;for(;n-- >0;)if(!r.equals(t[n],e[n],n,n,t,e,r))return!1;return!0}function ate(t,e){return t.byteLength===e.byteLength&&Gx(new Uint8Array(t.buffer,t.byteOffset,t.byteLength),new Uint8Array(e.buffer,e.byteOffset,e.byteLength))}function ste(t,e){return Ih(t.getTime(),e.getTime())}function ote(t,e){return t.name===e.name&&t.message===e.message&&t.cause===e.cause&&t.stack===e.stack}function lte(t,e){return t===e}function BP(t,e,r){const n=t.size;if(n!==e.size)return!1;if(!n)return!0;const i=new Array(n),a=t.entries();let s,o,l=0;for(;(s=a.next())&&!s.done;){const u=e.entries();let c=!1,f=0;for(;(o=u.next())&&!o.done;){if(i[f]){f++;continue}const p=s.value,v=o.value;if(r.equals(p[0],v[0],l,f,t,e,r)&&r.equals(p[1],v[1],p[0],v[0],t,e,r)){c=i[f]=!0;break}f++}if(!c)return!1;l++}return!0}const ute=Ih;function cte(t,e,r){const n=FP(t);let i=n.length;if(FP(e).length!==i)return!1;for(;i-- >0;)if(!dD(t,e,r,n[i]))return!1;return!0}function Hg(t,e,r){const n=IP(t);let i=n.length;if(IP(e).length!==i)return!1;let a,s,o;for(;i-- >0;)if(a=n[i],!dD(t,e,r,a)||(s=jP(t,a),o=jP(e,a),(s||o)&&(!s||!o||s.configurable!==o.configurable||s.enumerable!==o.enumerable||s.writable!==o.writable)))return!1;return!0}function dte(t,e){return Ih(t.valueOf(),e.valueOf())}function fte(t,e){return t.source===e.source&&t.flags===e.flags}function zP(t,e,r){const n=t.size;if(n!==e.size)return!1;if(!n)return!0;const i=new Array(n),a=t.values();let s,o;for(;(s=a.next())&&!s.done;){const l=e.values();let u=!1,c=0;for(;(o=l.next())&&!o.done;){if(!i[c]&&r.equals(s.value,o.value,s.value,o.value,t,e,r)){u=i[c]=!0;break}c++}if(!u)return!1}return!0}function Gx(t,e){let r=t.byteLength;if(e.byteLength!==r||t.byteOffset!==e.byteOffset)return!1;for(;r-- >0;)if(t[r]!==e[r])return!1;return!0}function hte(t,e){return t.hostname===e.hostname&&t.pathname===e.pathname&&t.protocol===e.protocol&&t.port===e.port&&t.hash===e.hash&&t.username===e.username&&t.password===e.password}function dD(t,e,r,n){return(n===rte||n===tte||n===ete)&&(t.$$typeof||e.$$typeof)?!0:Jee(e,n)&&r.equals(t[n],e[n],n,n,t,e,r)}const pte="[object ArrayBuffer]",mte="[object Arguments]",gte="[object Boolean]",vte="[object DataView]",yte="[object Date]",xte="[object Error]",bte="[object Map]",wte="[object Number]",Ste="[object Object]",kte="[object RegExp]",_te="[object Set]",Cte="[object String]",Ete={"[object Int8Array]":!0,"[object Uint8Array]":!0,"[object Uint8ClampedArray]":!0,"[object Int16Array]":!0,"[object Uint16Array]":!0,"[object Int32Array]":!0,"[object Uint32Array]":!0,"[object Float16Array]":!0,"[object Float32Array]":!0,"[object Float64Array]":!0,"[object BigInt64Array]":!0,"[object BigUint64Array]":!0},Tte="[object URL]",Nte=Object.prototype.toString;function Pte({areArrayBuffersEqual:t,areArraysEqual:e,areDataViewsEqual:r,areDatesEqual:n,areErrorsEqual:i,areFunctionsEqual:a,areMapsEqual:s,areNumbersEqual:o,areObjectsEqual:l,arePrimitiveWrappersEqual:u,areRegExpsEqual:c,areSetsEqual:f,areTypedArraysEqual:p,areUrlsEqual:v,unknownTagComparators:y}){return function(w,T,_){if(w===T)return!0;if(w==null||T==null)return!1;const C=typeof w;if(C!==typeof T)return!1;if(C!=="object")return C==="number"?o(w,T,_):C==="function"?a(w,T,_):!1;const N=w.constructor;if(N!==T.constructor)return!1;if(N===Object)return l(w,T,_);if(Array.isArray(w))return e(w,T,_);if(N===Date)return n(w,T,_);if(N===RegExp)return c(w,T,_);if(N===Map)return s(w,T,_);if(N===Set)return f(w,T,_);const A=Nte.call(w);if(A===yte)return n(w,T,_);if(A===kte)return c(w,T,_);if(A===bte)return s(w,T,_);if(A===_te)return f(w,T,_);if(A===Ste)return typeof w.then!="function"&&typeof T.then!="function"&&l(w,T,_);if(A===Tte)return v(w,T,_);if(A===xte)return i(w,T,_);if(A===mte)return l(w,T,_);if(Ete[A])return p(w,T,_);if(A===pte)return t(w,T,_);if(A===vte)return r(w,T,_);if(A===gte||A===wte||A===Cte)return u(w,T,_);if(y){let O=y[A];if(!O){const j=Qee(w);j&&(O=y[j])}if(O)return O(w,T,_)}return!1}}function Mte({circular:t,createCustomConfig:e,strict:r}){let n={areArrayBuffersEqual:nte,areArraysEqual:r?Hg:ite,areDataViewsEqual:ate,areDatesEqual:ste,areErrorsEqual:ote,areFunctionsEqual:lte,areMapsEqual:r?vS(BP,Hg):BP,areNumbersEqual:ute,areObjectsEqual:r?Hg:cte,arePrimitiveWrappersEqual:dte,areRegExpsEqual:fte,areSetsEqual:r?vS(zP,Hg):zP,areTypedArraysEqual:r?vS(Gx,Hg):Gx,areUrlsEqual:hte,unknownTagComparators:void 0};if(e&&(n=Object.assign({},n,e(n))),t){const i=Ly(n.areArraysEqual),a=Ly(n.areMapsEqual),s=Ly(n.areObjectsEqual),o=Ly(n.areSetsEqual);n=Object.assign({},n,{areArraysEqual:i,areMapsEqual:a,areObjectsEqual:s,areSetsEqual:o})}return n}function Ate(t){return function(e,r,n,i,a,s,o){return t(e,r,o)}}function Lte({circular:t,comparator:e,createState:r,equals:n,strict:i}){if(r)return function(o,l){const{cache:u=t?new WeakMap:void 0,meta:c}=r();return e(o,l,{cache:u,equals:n,meta:c,strict:i})};if(t)return function(o,l){return e(o,l,{cache:new WeakMap,equals:n,meta:void 0,strict:i})};const a={cache:void 0,equals:n,meta:void 0,strict:i};return function(o,l){return e(o,l,a)}}const Rte=gf();gf({strict:!0});gf({circular:!0});gf({circular:!0,strict:!0});gf({createInternalComparator:()=>Ih});gf({strict:!0,createInternalComparator:()=>Ih});gf({circular:!0,createInternalComparator:()=>Ih});gf({circular:!0,createInternalComparator:()=>Ih,strict:!0});function gf(t={}){const{circular:e=!1,createInternalComparator:r,createState:n,strict:i=!1}=t,a=Mte(t),s=Pte(a),o=r?r(s):Ate(s);return Lte({circular:e,comparator:s,createState:n,equals:o,strict:i})}var yS={exports:{}},xS={};var UP;function Ote(){if(UP)return xS;UP=1;var t=um(),e=tO();function r(u,c){return u===c&&(u!==0||1/u===1/c)||u!==u&&c!==c}var n=typeof Object.is=="function"?Object.is:r,i=e.useSyncExternalStore,a=t.useRef,s=t.useEffect,o=t.useMemo,l=t.useDebugValue;return xS.useSyncExternalStoreWithSelector=function(u,c,f,p,v){var y=a(null);if(y.current===null){var S={hasValue:!1,value:null};y.current=S}else S=y.current;y=o(function(){function T(O){if(!_){if(_=!0,C=O,O=p(O),v!==void 0&&S.hasValue){var j=S.value;if(v(j,O))return N=j}return N=O}if(j=N,n(C,O))return j;var D=p(O);return v!==void 0&&v(j,D)?(C=O,j):(C=O,N=D)}var _=!1,C,N,A=f===void 0?null:f;return[function(){return T(c())},A===null?void 0:function(){return T(A())}]},[c,f,p,v]);var w=i(u,y[0],y[1]);return s(function(){S.hasValue=!0,S.value=w},[w]),l(w),w},xS}var GP;function Dte(){return GP||(GP=1,yS.exports=Ote()),yS.exports}var Ite=Dte(),jte=(...t)=>e=>{t.forEach(r=>{typeof r=="function"?r(e):r&&(r.current=e)})},Fte=({contentComponent:t})=>{const e=rO.useSyncExternalStore(t.subscribe,t.getSnapshot,t.getServerSnapshot);return m.jsx(m.Fragment,{children:Object.values(e)})};function Bte(){const t=new Set;let e={};return{subscribe(r){return t.add(r),()=>{t.delete(r)}},getSnapshot(){return e},getServerSnapshot(){return e},setRenderer(r,n){e={...e,[r]:I8.createPortal(n.reactElement,n.element,r)},t.forEach(i=>i())},removeRenderer(r){const n={...e};delete n[r],e=n,t.forEach(i=>i())}}}var zte=class extends sr.Component{constructor(t){var e;super(t),this.editorContentRef=sr.createRef(),this.initialized=!1,this.state={hasContentComponentInitialized:!!((e=t.editor)!=null&&e.contentComponent)}}componentDidMount(){this.init()}componentDidUpdate(){this.init()}init(){var t;const e=this.props.editor;if(e&&!e.isDestroyed&&((t=e.view.dom)!=null&&t.parentNode)){if(e.contentComponent)return;const r=this.editorContentRef.current;r.append(...e.view.dom.parentNode.childNodes),e.setOptions({element:r}),e.contentComponent=Bte(),this.state.hasContentComponentInitialized||(this.unsubscribeToContentComponent=e.contentComponent.subscribe(()=>{this.setState(n=>n.hasContentComponentInitialized?n:{hasContentComponentInitialized:!0}),this.unsubscribeToContentComponent&&this.unsubscribeToContentComponent()})),e.createNodeViews(),this.initialized=!0}}componentWillUnmount(){var t;const e=this.props.editor;if(e){this.initialized=!1,e.isDestroyed||e.view.setProps({nodeViews:{}}),this.unsubscribeToContentComponent&&this.unsubscribeToContentComponent(),e.contentComponent=null;try{if(!((t=e.view.dom)!=null&&t.parentNode))return;const r=document.createElement("div");r.append(...e.view.dom.parentNode.childNodes),e.setOptions({element:r})}catch{}}}render(){const{editor:t,innerRef:e,...r}=this.props;return m.jsxs(m.Fragment,{children:[m.jsx("div",{ref:jte(e,this.editorContentRef),...r}),t?.contentComponent&&m.jsx(Fte,{contentComponent:t.contentComponent})]})}},Ute=se.forwardRef((t,e)=>{const r=sr.useMemo(()=>Math.floor(Math.random()*4294967295).toString(),[t.editor]);return sr.createElement(zte,{key:r,innerRef:e,...t})}),Gte=sr.memo(Ute),Vte=typeof window<"u"?se.useLayoutEffect:se.useEffect,Hte=class{constructor(t){this.transactionNumber=0,this.lastTransactionNumber=0,this.subscribers=new Set,this.editor=t,this.lastSnapshot={editor:t,transactionNumber:0},this.getSnapshot=this.getSnapshot.bind(this),this.getServerSnapshot=this.getServerSnapshot.bind(this),this.watch=this.watch.bind(this),this.subscribe=this.subscribe.bind(this)}getSnapshot(){return this.transactionNumber===this.lastTransactionNumber?this.lastSnapshot:(this.lastTransactionNumber=this.transactionNumber,this.lastSnapshot={editor:this.editor,transactionNumber:this.transactionNumber},this.lastSnapshot)}getServerSnapshot(){return{editor:null,transactionNumber:0}}subscribe(t){return this.subscribers.add(t),()=>{this.subscribers.delete(t)}}watch(t){if(this.editor=t,this.editor){const e=()=>{this.transactionNumber+=1,this.subscribers.forEach(n=>n())},r=this.editor;return r.on("transaction",e),()=>{r.off("transaction",e)}}}};function Wte(t){var e;const[r]=se.useState(()=>new Hte(t.editor)),n=Ite.useSyncExternalStoreWithSelector(r.subscribe,r.getSnapshot,r.getServerSnapshot,t.selector,(e=t.equalityFn)!=null?e:Rte);return Vte(()=>r.watch(t.editor),[t.editor,r]),se.useDebugValue(n),n}var qte=!1,jk=typeof window>"u",$te=jk||!!(typeof window<"u"&&window.next),Kte=class fD{constructor(e){this.editor=null,this.subscriptions=new Set,this.isComponentMounted=!1,this.previousDeps=null,this.instanceId="",this.options=e,this.subscriptions=new Set,this.setEditor(this.getInitialEditor()),this.scheduleDestroy(),this.getEditor=this.getEditor.bind(this),this.getServerSnapshot=this.getServerSnapshot.bind(this),this.subscribe=this.subscribe.bind(this),this.refreshEditorInstance=this.refreshEditorInstance.bind(this),this.scheduleDestroy=this.scheduleDestroy.bind(this),this.onRender=this.onRender.bind(this),this.createEditor=this.createEditor.bind(this)}setEditor(e){this.editor=e,this.instanceId=Math.random().toString(36).slice(2,9),this.subscriptions.forEach(r=>r())}getInitialEditor(){return this.options.current.immediatelyRender===void 0?jk||$te?null:this.createEditor():(this.options.current.immediatelyRender,this.options.current.immediatelyRender?this.createEditor():null)}createEditor(){const e={...this.options.current,onBeforeCreate:(...n)=>{var i,a;return(a=(i=this.options.current).onBeforeCreate)==null?void 0:a.call(i,...n)},onBlur:(...n)=>{var i,a;return(a=(i=this.options.current).onBlur)==null?void 0:a.call(i,...n)},onCreate:(...n)=>{var i,a;return(a=(i=this.options.current).onCreate)==null?void 0:a.call(i,...n)},onDestroy:(...n)=>{var i,a;return(a=(i=this.options.current).onDestroy)==null?void 0:a.call(i,...n)},onFocus:(...n)=>{var i,a;return(a=(i=this.options.current).onFocus)==null?void 0:a.call(i,...n)},onSelectionUpdate:(...n)=>{var i,a;return(a=(i=this.options.current).onSelectionUpdate)==null?void 0:a.call(i,...n)},onTransaction:(...n)=>{var i,a;return(a=(i=this.options.current).onTransaction)==null?void 0:a.call(i,...n)},onUpdate:(...n)=>{var i,a;return(a=(i=this.options.current).onUpdate)==null?void 0:a.call(i,...n)},onContentError:(...n)=>{var i,a;return(a=(i=this.options.current).onContentError)==null?void 0:a.call(i,...n)},onDrop:(...n)=>{var i,a;return(a=(i=this.options.current).onDrop)==null?void 0:a.call(i,...n)},onPaste:(...n)=>{var i,a;return(a=(i=this.options.current).onPaste)==null?void 0:a.call(i,...n)},onDelete:(...n)=>{var i,a;return(a=(i=this.options.current).onDelete)==null?void 0:a.call(i,...n)}};return new Bee(e)}getEditor(){return this.editor}getServerSnapshot(){return null}subscribe(e){return this.subscriptions.add(e),()=>{this.subscriptions.delete(e)}}static compareOptions(e,r){return Object.keys(e).every(n=>["onCreate","onBeforeCreate","onDestroy","onUpdate","onTransaction","onFocus","onBlur","onSelectionUpdate","onContentError","onDrop","onPaste"].includes(n)?!0:n==="extensions"&&e.extensions&&r.extensions?e.extensions.length!==r.extensions.length?!1:e.extensions.every((i,a)=>{var s;return i===((s=r.extensions)==null?void 0:s[a])}):e[n]===r[n])}onRender(e){return()=>(this.isComponentMounted=!0,clearTimeout(this.scheduledDestructionTimeout),this.editor&&!this.editor.isDestroyed&&e.length===0?fD.compareOptions(this.options.current,this.editor.options)||this.editor.setOptions({...this.options.current,editable:this.editor.isEditable}):this.refreshEditorInstance(e),()=>{this.isComponentMounted=!1,this.scheduleDestroy()})}refreshEditorInstance(e){if(this.editor&&!this.editor.isDestroyed){if(this.previousDeps===null){this.previousDeps=e;return}if(this.previousDeps.length===e.length&&this.previousDeps.every((n,i)=>n===e[i]))return}this.editor&&!this.editor.isDestroyed&&this.editor.destroy(),this.setEditor(this.createEditor()),this.previousDeps=e}scheduleDestroy(){const e=this.instanceId,r=this.editor;this.scheduledDestructionTimeout=setTimeout(()=>{if(this.isComponentMounted&&this.instanceId===e){r&&r.setOptions(this.options.current);return}r&&!r.isDestroyed&&(r.destroy(),this.instanceId===e&&this.setEditor(null))},1)}};function Zte(t={},e=[]){const r=se.useRef(t);r.current=t;const[n]=se.useState(()=>new Kte(r)),i=rO.useSyncExternalStore(n.subscribe,n.getEditor,n.getServerSnapshot);return se.useDebugValue(i),se.useEffect(n.onRender(e)),Wte({editor:i,selector:({transactionNumber:a})=>t.shouldRerenderOnTransaction===!1||t.shouldRerenderOnTransaction===void 0?null:t.immediatelyRender&&a===0?0:a+1}),i}var Yte=se.createContext({editor:null});Yte.Consumer;var Xte=se.createContext({onDragStart:()=>{},nodeViewContentChildren:void 0,nodeViewContentRef:()=>{}}),Qte=()=>se.useContext(Xte);sr.forwardRef((t,e)=>{const{onDragStart:r}=Qte(),n=t.as||"div";return m.jsx(n,{...t,ref:e,"data-node-view-wrapper":"",onDragStart:r,style:{whiteSpace:"normal",...t.style}})});function VP(t){return!!(typeof t=="function"&&t.prototype&&t.prototype.isReactComponent)}function HP(t){return!!(typeof t=="object"&&t.$$typeof&&(t.$$typeof.toString()==="Symbol(react.forward_ref)"||t.$$typeof.description==="react.forward_ref"))}function Jte(t){return!!(typeof t=="object"&&t.$$typeof&&(t.$$typeof.toString()==="Symbol(react.memo)"||t.$$typeof.description==="react.memo"))}function ere(t){if(VP(t)||HP(t))return!0;if(Jte(t)){const e=t.type;if(e)return VP(e)||HP(e)}return!1}function tre(){try{if(se.version)return parseInt(se.version.split(".")[0],10)>=19}catch{}return!1}var rre=class{constructor(t,{editor:e,props:r={},as:n="div",className:i=""}){this.ref=null,this.destroyed=!1,this.id=Math.floor(Math.random()*4294967295).toString(),this.component=t,this.editor=e,this.props=r,this.element=document.createElement(n),this.element.classList.add("react-renderer"),i&&this.element.classList.add(...i.split(" ")),this.editor.isInitialized?Al.flushSync(()=>{this.render()}):queueMicrotask(()=>{this.destroyed||this.render()})}render(){var t;if(this.destroyed)return;const e=this.component,r=this.props,n=this.editor,i=tre(),a=ere(e),s={...r};s.ref&&!(i||a)&&delete s.ref,!s.ref&&(i||a)&&(s.ref=o=>{this.ref=o}),this.reactElement=m.jsx(e,{...s}),(t=n?.contentComponent)==null||t.setRenderer(this.id,this)}updateProps(t={}){this.destroyed||(this.props={...this.props,...t},this.render())}destroy(){var t;this.destroyed=!0;const e=this.editor;(t=e?.contentComponent)==null||t.removeRenderer(this.id);try{this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element)}catch{}}updateAttributes(t){Object.keys(t).forEach(e=>{this.element.setAttribute(e,t[e])})}};sr.createContext({markViewContentRef:()=>{}});var Vx=(t,e)=>{if(t==="slot")return 0;if(t instanceof Function)return t(e);const{children:r,...n}=e??{};if(t==="svg")throw new Error("SVG elements are not supported in the JSX syntax, use the array syntax instead");return[t,n,r]},nre=/^\s*>\s$/,ire=Zs.create({name:"blockquote",addOptions(){return{HTMLAttributes:{}}},content:"block+",group:"block",defining:!0,parseHTML(){return[{tag:"blockquote"}]},renderHTML({HTMLAttributes:t}){return Vx("blockquote",{...Vn(this.options.HTMLAttributes,t),children:Vx("slot",{})})},parseMarkdown:(t,e)=>e.createNode("blockquote",void 0,e.parseChildren(t.tokens||[])),renderMarkdown:(t,e)=>{if(!t.content)return"";const r=">",n=[];return t.content.forEach(i=>{const o=e.renderChildren([i]).split(`
`).map(l=>l.trim()===""?r:`${r} ${l}`);n.push(o.join(`
`))}),n.join(`
${r}
`)},addCommands(){return{setBlockquote:()=>({commands:t})=>t.wrapIn(this.name),toggleBlockquote:()=>({commands:t})=>t.toggleWrap(this.name),unsetBlockquote:()=>({commands:t})=>t.lift(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[im({find:nre,type:this.type})]}}),are=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))$/,sre=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))/g,ore=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))$/,lre=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))/g,ure=Dh.create({name:"bold",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"strong"},{tag:"b",getAttrs:t=>t.style.fontWeight!=="normal"&&null},{style:"font-weight=400",clearMark:t=>t.type.name===this.name},{style:"font-weight",getAttrs:t=>/^(bold(er)?|[5-9]\d{2,})$/.test(t)&&null}]},renderHTML({HTMLAttributes:t}){return Vx("strong",{...Vn(this.options.HTMLAttributes,t),children:Vx("slot",{})})},markdownTokenName:"strong",parseMarkdown:(t,e)=>e.applyMark("bold",e.parseInline(t.tokens||[])),renderMarkdown:(t,e)=>`**${e.renderChildren(t)}**`,addCommands(){return{setBold:()=>({commands:t})=>t.setMark(this.name),toggleBold:()=>({commands:t})=>t.toggleMark(this.name),unsetBold:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold(),"Mod-B":()=>this.editor.commands.toggleBold()}},addInputRules(){return[nm({find:are,type:this.type}),nm({find:ore,type:this.type})]},addPasteRules(){return[Nh({find:sre,type:this.type}),Nh({find:lre,type:this.type})]}}),cre=/(^|[^`])`([^`]+)`(?!`)$/,dre=/(^|[^`])`([^`]+)`(?!`)/g,fre=Dh.create({name:"code",addOptions(){return{HTMLAttributes:{}}},excludes:"_",code:!0,exitable:!0,parseHTML(){return[{tag:"code"}]},renderHTML({HTMLAttributes:t}){return["code",Vn(this.options.HTMLAttributes,t),0]},markdownTokenName:"codespan",parseMarkdown:(t,e)=>e.applyMark("code",[{type:"text",text:t.text||""}]),renderMarkdown:(t,e)=>t.content?`\`${e.renderChildren(t.content)}\``:"",addCommands(){return{setCode:()=>({commands:t})=>t.setMark(this.name),toggleCode:()=>({commands:t})=>t.toggleMark(this.name),unsetCode:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[nm({find:cre,type:this.type})]},addPasteRules(){return[Nh({find:dre,type:this.type})]}}),bS=4,hre=/^```([a-z]+)?[\s\n]$/,pre=/^~~~([a-z]+)?[\s\n]$/,mre=Zs.create({name:"codeBlock",addOptions(){return{languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,defaultLanguage:null,enableTabIndentation:!1,tabSize:bS,HTMLAttributes:{}}},content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes(){return{language:{default:this.options.defaultLanguage,parseHTML:t=>{var e;const{languageClassPrefix:r}=this.options;if(!r)return null;const a=[...((e=t.firstElementChild)==null?void 0:e.classList)||[]].filter(s=>s.startsWith(r)).map(s=>s.replace(r,""))[0];return a||null},rendered:!1}}},parseHTML(){return[{tag:"pre",preserveWhitespace:"full"}]},renderHTML({node:t,HTMLAttributes:e}){return["pre",Vn(this.options.HTMLAttributes,e),["code",{class:t.attrs.language?this.options.languageClassPrefix+t.attrs.language:null},0]]},markdownTokenName:"code",parseMarkdown:(t,e)=>{var r;return((r=t.raw)==null?void 0:r.startsWith("```"))===!1&&t.codeBlockStyle!=="indented"?[]:e.createNode("codeBlock",{language:t.lang||null},t.text?[e.createTextNode(t.text)]:[])},renderMarkdown:(t,e)=>{var r;let n="";const i=((r=t.attrs)==null?void 0:r.language)||"";return t.content?n=[`\`\`\`${i}`,e.renderChildren(t.content),"```"].join(`
`):n=`\`\`\`${i}

\`\`\``,n},addCommands(){return{setCodeBlock:t=>({commands:e})=>e.setNode(this.name,t),toggleCodeBlock:t=>({commands:e})=>e.toggleNode(this.name,"paragraph",t)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{const{empty:t,$anchor:e}=this.editor.state.selection,r=e.pos===1;return!t||e.parent.type.name!==this.name?!1:r||!e.parent.textContent.length?this.editor.commands.clearNodes():!1},Tab:({editor:t})=>{var e;if(!this.options.enableTabIndentation)return!1;const r=(e=this.options.tabSize)!=null?e:bS,{state:n}=t,{selection:i}=n,{$from:a,empty:s}=i;if(a.parent.type!==this.type)return!1;const o=" ".repeat(r);return s?t.commands.insertContent(o):t.commands.command(({tr:l})=>{const{from:u,to:c}=i,v=n.doc.textBetween(u,c,`
`,`
`).split(`
`).map(y=>o+y).join(`
`);return l.replaceWith(u,c,n.schema.text(v)),!0})},"Shift-Tab":({editor:t})=>{var e;if(!this.options.enableTabIndentation)return!1;const r=(e=this.options.tabSize)!=null?e:bS,{state:n}=t,{selection:i}=n,{$from:a,empty:s}=i;return a.parent.type!==this.type?!1:s?t.commands.command(({tr:o})=>{var l;const{pos:u}=a,c=a.start(),f=a.end(),v=n.doc.textBetween(c,f,`
`,`
`).split(`
`);let y=0,S=0;const w=u-c;for(let O=0;O<v.length;O+=1){if(S+v[O].length>=w){y=O;break}S+=v[O].length+1}const _=((l=v[y].match(/^ */))==null?void 0:l[0])||"",C=Math.min(_.length,r);if(C===0)return!0;let N=c;for(let O=0;O<y;O+=1)N+=v[O].length+1;return o.delete(N,N+C),u-N<=C&&o.setSelection(cr.create(o.doc,N)),!0}):t.commands.command(({tr:o})=>{const{from:l,to:u}=i,p=n.doc.textBetween(l,u,`
`,`
`).split(`
`).map(v=>{var y;const S=((y=v.match(/^ */))==null?void 0:y[0])||"",w=Math.min(S.length,r);return v.slice(w)}).join(`
`);return o.replaceWith(l,u,n.schema.text(p)),!0})},Enter:({editor:t})=>{if(!this.options.exitOnTripleEnter)return!1;const{state:e}=t,{selection:r}=e,{$from:n,empty:i}=r;if(!i||n.parent.type!==this.type)return!1;const a=n.parentOffset===n.parent.nodeSize-2,s=n.parent.textContent.endsWith(`

`);return!a||!s?!1:t.chain().command(({tr:o})=>(o.delete(n.pos-2,n.pos),!0)).exitCode().run()},ArrowDown:({editor:t})=>{if(!this.options.exitOnArrowDown)return!1;const{state:e}=t,{selection:r,doc:n}=e,{$from:i,empty:a}=r;if(!a||i.parent.type!==this.type||!(i.parentOffset===i.parent.nodeSize-2))return!1;const o=i.after();return o===void 0?!1:n.nodeAt(o)?t.commands.command(({tr:u})=>(u.setSelection(yr.near(n.resolve(o))),!0)):t.commands.exitCode()}}},addInputRules(){return[Dk({find:hre,type:this.type,getAttributes:t=>({language:t[1]})}),Dk({find:pre,type:this.type,getAttributes:t=>({language:t[1]})})]},addProseMirrorPlugins(){return[new Hn({key:new xi("codeBlockVSCodeHandler"),props:{handlePaste:(t,e)=>{if(!e.clipboardData||this.editor.isActive(this.type.name))return!1;const r=e.clipboardData.getData("text/plain"),n=e.clipboardData.getData("vscode-editor-data"),i=n?JSON.parse(n):void 0,a=i?.mode;if(!r||!a)return!1;const{tr:s,schema:o}=t.state,l=o.text(r.replace(/\r\n?/g,`
`));return s.replaceSelectionWith(this.type.create({language:a},l)),s.selection.$from.parent.type!==this.type&&s.setSelection(cr.near(s.doc.resolve(Math.max(0,s.selection.from-2)))),s.setMeta("paste",!0),t.dispatch(s),!0}}})]}}),gre=Zs.create({name:"doc",topNode:!0,content:"block+",renderMarkdown:(t,e)=>t.content?e.renderChildren(t.content,`

`):""}),vre=Zs.create({name:"hardBreak",markdownTokenName:"br",addOptions(){return{keepMarks:!0,HTMLAttributes:{}}},inline:!0,group:"inline",selectable:!1,linebreakReplacement:!0,parseHTML(){return[{tag:"br"}]},renderHTML({HTMLAttributes:t}){return["br",Vn(this.options.HTMLAttributes,t)]},renderText(){return`
`},renderMarkdown:()=>`  
`,parseMarkdown:()=>({type:"hardBreak"}),addCommands(){return{setHardBreak:()=>({commands:t,chain:e,state:r,editor:n})=>t.first([()=>t.exitCode(),()=>t.command(()=>{const{selection:i,storedMarks:a}=r;if(i.$from.parent.type.spec.isolating)return!1;const{keepMarks:s}=this.options,{splittableMarks:o}=n.extensionManager,l=a||i.$to.parentOffset&&i.$from.marks();return e().insertContent({type:this.name}).command(({tr:u,dispatch:c})=>{if(c&&l&&s){const f=l.filter(p=>o.includes(p.type.name));u.ensureMarks(f)}return!0}).run()})])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}}),yre=Zs.create({name:"heading",addOptions(){return{levels:[1,2,3,4,5,6],HTMLAttributes:{}}},content:"inline*",group:"block",defining:!0,addAttributes(){return{level:{default:1,rendered:!1}}},parseHTML(){return this.options.levels.map(t=>({tag:`h${t}`,attrs:{level:t}}))},renderHTML({node:t,HTMLAttributes:e}){return[`h${this.options.levels.includes(t.attrs.level)?t.attrs.level:this.options.levels[0]}`,Vn(this.options.HTMLAttributes,e),0]},parseMarkdown:(t,e)=>e.createNode("heading",{level:t.depth||1},e.parseInline(t.tokens||[])),renderMarkdown:(t,e)=>{var r;const n=(r=t.attrs)!=null&&r.level?parseInt(t.attrs.level,10):1,i="#".repeat(n);return t.content?`${i} ${e.renderChildren(t.content)}`:""},addCommands(){return{setHeading:t=>({commands:e})=>this.options.levels.includes(t.level)?e.setNode(this.name,t):!1,toggleHeading:t=>({commands:e})=>this.options.levels.includes(t.level)?e.toggleNode(this.name,"paragraph",t):!1}},addKeyboardShortcuts(){return this.options.levels.reduce((t,e)=>({...t,[`Mod-Alt-${e}`]:()=>this.editor.commands.toggleHeading({level:e})}),{})},addInputRules(){return this.options.levels.map(t=>Dk({find:new RegExp(`^(#{${Math.min(...this.options.levels)},${t}})\\s$`),type:this.type,getAttributes:{level:t}}))}}),xre=Zs.create({name:"horizontalRule",addOptions(){return{HTMLAttributes:{},nextNodeType:"paragraph"}},group:"block",parseHTML(){return[{tag:"hr"}]},renderHTML({HTMLAttributes:t}){return["hr",Vn(this.options.HTMLAttributes,t)]},markdownTokenName:"hr",parseMarkdown:(t,e)=>e.createNode("horizontalRule"),renderMarkdown:()=>"---",addCommands(){return{setHorizontalRule:()=>({chain:t,state:e})=>{if(!Uee(e,e.schema.nodes[this.name]))return!1;const{selection:r}=e,{$to:n}=r,i=t();return q6(r)?i.insertContentAt(n.pos,{type:this.name}):i.insertContent({type:this.name}),i.command(({state:a,tr:s,dispatch:o})=>{if(o){const{$to:l}=s.selection,u=l.end();if(l.nodeAfter)l.nodeAfter.isTextblock?s.setSelection(cr.create(s.doc,l.pos+1)):l.nodeAfter.isBlock?s.setSelection(Yt.create(s.doc,l.pos)):s.setSelection(cr.create(s.doc,l.pos));else{const c=a.schema.nodes[this.options.nextNodeType]||l.parent.type.contentMatch.defaultType,f=c?.create();f&&(s.insert(u,f),s.setSelection(cr.create(s.doc,u+1)))}s.scrollIntoView()}return!0}).run()}}},addInputRules(){return[zee({find:/^(?:---|-|___\s|\*\*\*\s)$/,type:this.type})]}}),bre=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))$/,wre=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))/g,Sre=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))$/,kre=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))/g,_re=Dh.create({name:"italic",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"em"},{tag:"i",getAttrs:t=>t.style.fontStyle!=="normal"&&null},{style:"font-style=normal",clearMark:t=>t.type.name===this.name},{style:"font-style=italic"}]},renderHTML({HTMLAttributes:t}){return["em",Vn(this.options.HTMLAttributes,t),0]},addCommands(){return{setItalic:()=>({commands:t})=>t.setMark(this.name),toggleItalic:()=>({commands:t})=>t.toggleMark(this.name),unsetItalic:()=>({commands:t})=>t.unsetMark(this.name)}},markdownTokenName:"em",parseMarkdown:(t,e)=>e.applyMark("italic",e.parseInline(t.tokens||[])),renderMarkdown:(t,e)=>`*${e.renderChildren(t)}*`,addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic(),"Mod-I":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[nm({find:bre,type:this.type}),nm({find:Sre,type:this.type})]},addPasteRules(){return[Nh({find:wre,type:this.type}),Nh({find:kre,type:this.type})]}});const Cre="aaa1rp3bb0ott3vie4c1le2ogado5udhabi7c0ademy5centure6ountant0s9o1tor4d0s1ult4e0g1ro2tna4f0l1rica5g0akhan5ency5i0g1rbus3force5tel5kdn3l0ibaba4pay4lfinanz6state5y2sace3tom5m0azon4ericanexpress7family11x2fam3ica3sterdam8nalytics7droid5quan4z2o0l2partments8p0le4q0uarelle8r0ab1mco4chi3my2pa2t0e3s0da2ia2sociates9t0hleta5torney7u0ction5di0ble3o3spost5thor3o0s4w0s2x0a2z0ure5ba0by2idu3namex4d1k2r0celona5laycard4s5efoot5gains6seball5ketball8uhaus5yern5b0c1t1va3cg1n2d1e0ats2uty4er2rlin4st0buy5t2f1g1h0arti5i0ble3d1ke2ng0o3o1z2j1lack0friday9ockbuster8g1omberg7ue3m0s1w2n0pparibas9o0ats3ehringer8fa2m1nd2o0k0ing5sch2tik2on4t1utique6x2r0adesco6idgestone9oadway5ker3ther5ussels7s1t1uild0ers6siness6y1zz3v1w1y1z0h3ca0b1fe2l0l1vinklein9m0era3p2non3petown5ital0one8r0avan4ds2e0er0s4s2sa1e1h1ino4t0ering5holic7ba1n1re3c1d1enter4o1rn3f0a1d2g1h0anel2nel4rity4se2t2eap3intai5ristmas6ome4urch5i0priani6rcle4sco3tadel4i0c2y3k1l0aims4eaning6ick2nic1que6othing5ud3ub0med6m1n1o0ach3des3ffee4llege4ogne5m0mbank4unity6pany2re3uter5sec4ndos3struction8ulting7tact3ractors9oking4l1p2rsica5untry4pon0s4rses6pa2r0edit0card4union9icket5own3s1uise0s6u0isinella9v1w1x1y0mru3ou3z2dad1nce3ta1e1ing3sun4y2clk3ds2e0al0er2s3gree4livery5l1oitte5ta3mocrat6ntal2ist5si0gn4v2hl2iamonds6et2gital5rect0ory7scount3ver5h2y2j1k1m1np2o0cs1tor4g1mains5t1wnload7rive4tv2ubai3nlop4pont4rban5vag2r2z2earth3t2c0o2deka3u0cation8e1g1mail3erck5nergy4gineer0ing9terprises10pson4quipment8r0icsson6ni3s0q1tate5t1u0rovision8s2vents5xchange6pert3osed4ress5traspace10fage2il1rwinds6th3mily4n0s2rm0ers5shion4t3edex3edback6rrari3ero6i0delity5o2lm2nal1nce1ial7re0stone6mdale6sh0ing5t0ness6j1k1lickr3ghts4r2orist4wers5y2m1o0o0d1tball6rd1ex2sale4um3undation8x2r0ee1senius7l1ogans4ntier7tr2ujitsu5n0d2rniture7tbol5yi3ga0l0lery3o1up4me0s3p1rden4y2b0iz3d0n2e0a1nt0ing5orge5f1g0ee3h1i0ft0s3ves2ing5l0ass3e1obal2o4m0ail3bh2o1x2n1odaddy5ld0point6f2o0dyear5g0le4p1t1v2p1q1r0ainger5phics5tis4een3ipe3ocery4up4s1t1u0cci3ge2ide2tars5ru3w1y2hair2mburg5ngout5us3bo2dfc0bank7ealth0care8lp1sinki6re1mes5iphop4samitsu7tachi5v2k0t2m1n1ockey4ldings5iday5medepot5goods5s0ense7nda3rse3spital5t0ing5t0els3mail5use3w2r1sbc3t1u0ghes5yatt3undai7ibm2cbc2e1u2d1e0ee3fm2kano4l1m0amat4db2mo0bilien9n0c1dustries8finiti5o2g1k1stitute6urance4e4t0ernational10uit4vestments10o1piranga7q1r0ish4s0maili5t0anbul7t0au2v3jaguar4va3cb2e0ep2tzt3welry6io2ll2m0p2nj2o0bs1urg4t1y2p0morgan6rs3uegos4niper7kaufen5ddi3e0rryhotels6properties14fh2g1h1i0a1ds2m1ndle4tchen5wi3m1n1oeln3matsu5sher5p0mg2n2r0d1ed3uokgroup8w1y0oto4z2la0caixa5mborghini8er3nd0rover6xess5salle5t0ino3robe5w0yer5b1c1ds2ease3clerc5frak4gal2o2xus4gbt3i0dl2fe0insurance9style7ghting6ke2lly3mited4o2ncoln4k2ve1ing5k1lc1p2oan0s3cker3us3l1ndon4tte1o3ve3pl0financial11r1s1t0d0a3u0ndbeck6xe1ury5v1y2ma0drid4if1son4keup4n0agement7go3p1rket0ing3s4riott5shalls7ttel5ba2c0kinsey7d1e0d0ia3et2lbourne7me1orial6n0u2rckmsd7g1h1iami3crosoft7l1ni1t2t0subishi9k1l0b1s2m0a2n1o0bi0le4da2e1i1m1nash3ey2ster5rmon3tgage6scow4to0rcycles9v0ie4p1q1r1s0d2t0n1r2u0seum3ic4v1w1x1y1z2na0b1goya4me2vy3ba2c1e0c1t0bank4flix4work5ustar5w0s2xt0direct7us4f0l2g0o2hk2i0co2ke1on3nja3ssan1y5l1o0kia3rton4w0ruz3tv4p1r0a1w2tt2u1yc2z2obi1server7ffice5kinawa6layan0group9lo3m0ega4ne1g1l0ine5oo2pen3racle3nge4g0anic5igins6saka4tsuka4t2vh3pa0ge2nasonic7ris2s1tners4s1y3y2ccw3e0t2f0izer5g1h0armacy6d1ilips5one2to0graphy6s4ysio5ics1tet2ures6d1n0g1k2oneer5zza4k1l0ace2y0station9umbing5s3m1n0c2ohl2ker3litie5rn2st3r0axi3ess3ime3o0d0uctions8f1gressive8mo2perties3y5tection8u0dential9s1t1ub2w0c2y2qa1pon3uebec3st5racing4dio4e0ad1lestate6tor2y4cipes5d0stone5umbrella9hab3ise0n3t2liance6n0t0als5pair3ort3ublican8st0aurant8view0s5xroth6ich0ardli6oh3l1o1p2o0cks3deo3gers4om3s0vp3u0gby3hr2n2w0e2yukyu6sa0arland6fe0ty4kura4le1on3msclub4ung5ndvik0coromant12ofi4p1rl2s1ve2xo3b0i1s2c0b1haeffler7midt4olarships8ol3ule3warz5ience5ot3d1e0arch3t2cure1ity6ek2lect4ner3rvices6ven3w1x0y3fr2g1h0angrila6rp3ell3ia1ksha5oes2p0ping5uji3w3i0lk2na1gles5te3j1k0i0n2y0pe4l0ing4m0art3ile4n0cf3o0ccer3ial4ftbank4ware6hu2lar2utions7ng1y2y2pa0ce3ort2t3r0l2s1t0ada2ples4r1tebank4farm7c0group6ockholm6rage3e3ream4udio2y3yle4u0cks3pplies3y2ort5rf1gery5zuki5v1watch4iss4x1y0dney4stems6z2tab1ipei4lk2obao4rget4tamotors6r2too4x0i3c0i2d0k2eam2ch0nology8l1masek5nnis4va3f1g1h0d1eater2re6iaa2ckets5enda4ps2res2ol4j0maxx4x2k0maxx5l1m0all4n1o0day3kyo3ols3p1ray3shiba5tal3urs3wn2yota3s3r0ade1ing4ining5vel0ers0insurance16ust3v2t1ube2i1nes3shu4v0s2w1z2ua1bank3s2g1k1nicom3versity8o2ol2ps2s1y1z2va0cations7na1guard7c1e0gas3ntures6risign5mgensberater2ung14sicherung10t2g1i0ajes4deo3g1king4llas4n1p1rgin4sa1ion4va1o3laanderen9n1odka3lvo3te1ing3o2yage5u2wales2mart4ter4ng0gou5tch0es6eather0channel12bcam3er2site5d0ding5ibo2r3f1hoswho6ien2ki2lliamhill9n0dows4e1ners6me2olterskluwer11odside6rk0s2ld3w2s1tc1f3xbox3erox4ihuan4n2xx2yz3yachts4hoo3maxun5ndex5e1odobashi7ga2kohama6u0tube6t1un3za0ppos4ra3ero3ip2m1one3uerich6w2",Ere="121342632165322333335355455655552435435422463632574574330355524444661154543332344423364211133222221212112052232222232212222223222241112222224322321222",Fk="numeric",Bk="ascii",zk="alpha",dv="asciinumeric",rv="alphanumeric",Uk="domain",hD="emoji",Tre="scheme",Nre="slashscheme",wS="whitespace";function Pre(t,e){return t in e||(e[t]=[]),e[t]}function lh(t,e,r){e[Fk]&&(e[dv]=!0,e[rv]=!0),e[Bk]&&(e[dv]=!0,e[zk]=!0),e[dv]&&(e[rv]=!0),e[zk]&&(e[rv]=!0),e[rv]&&(e[Uk]=!0),e[hD]&&(e[Uk]=!0);for(const n in e){const i=Pre(n,r);i.indexOf(t)<0&&i.push(t)}}function Mre(t,e){const r={};for(const n in e)e[n].indexOf(t)>=0&&(r[n]=!0);return r}function Hs(t=null){this.j={},this.jr=[],this.jd=null,this.t=t}Hs.groups={};Hs.prototype={accepts(){return!!this.t},go(t){const e=this,r=e.j[t];if(r)return r;for(let n=0;n<e.jr.length;n++){const i=e.jr[n][0],a=e.jr[n][1];if(a&&i.test(t))return a}return e.jd},has(t,e=!1){return e?t in this.j:!!this.go(t)},ta(t,e,r,n){for(let i=0;i<t.length;i++)this.tt(t[i],e,r,n)},tr(t,e,r,n){n=n||Hs.groups;let i;return e&&e.j?i=e:(i=new Hs(e),r&&n&&lh(e,r,n)),this.jr.push([t,i]),i},ts(t,e,r,n){let i=this;const a=t.length;if(!a)return i;for(let s=0;s<a-1;s++)i=i.tt(t[s]);return i.tt(t[a-1],e,r,n)},tt(t,e,r,n){n=n||Hs.groups;const i=this;if(e&&e.j)return i.j[t]=e,e;const a=e;let s,o=i.go(t);if(o?(s=new Hs,Object.assign(s.j,o.j),s.jr.push.apply(s.jr,o.jr),s.jd=o.jd,s.t=o.t):s=new Hs,a){if(n)if(s.t&&typeof s.t=="string"){const l=Object.assign(Mre(s.t,n),r);lh(a,l,n)}else r&&lh(a,r,n);s.t=a}return i.j[t]=s,s}};const vr=(t,e,r,n,i)=>t.ta(e,r,n,i),ti=(t,e,r,n,i)=>t.tr(e,r,n,i),WP=(t,e,r,n,i)=>t.ts(e,r,n,i),st=(t,e,r,n,i)=>t.tt(e,r,n,i),uc="WORD",Gk="UWORD",pD="ASCIINUMERICAL",mD="ALPHANUMERICAL",qv="LOCALHOST",Vk="TLD",Hk="UTLD",rx="SCHEME",Rp="SLASH_SCHEME",kC="NUM",Wk="WS",_C="NL",fv="OPENBRACE",hv="CLOSEBRACE",Hx="OPENBRACKET",Wx="CLOSEBRACKET",qx="OPENPAREN",$x="CLOSEPAREN",Kx="OPENANGLEBRACKET",Zx="CLOSEANGLEBRACKET",Yx="FULLWIDTHLEFTPAREN",Xx="FULLWIDTHRIGHTPAREN",Qx="LEFTCORNERBRACKET",Jx="RIGHTCORNERBRACKET",e1="LEFTWHITECORNERBRACKET",t1="RIGHTWHITECORNERBRACKET",r1="FULLWIDTHLESSTHAN",n1="FULLWIDTHGREATERTHAN",i1="AMPERSAND",a1="APOSTROPHE",s1="ASTERISK",Md="AT",o1="BACKSLASH",l1="BACKTICK",u1="CARET",Rd="COLON",CC="COMMA",c1="DOLLAR",mu="DOT",d1="EQUALS",EC="EXCLAMATION",Fo="HYPHEN",pv="PERCENT",f1="PIPE",h1="PLUS",p1="POUND",mv="QUERY",TC="QUOTE",gD="FULLWIDTHMIDDLEDOT",NC="SEMI",gu="SLASH",gv="TILDE",m1="UNDERSCORE",vD="EMOJI",g1="SYM";var yD=Object.freeze({__proto__:null,ALPHANUMERICAL:mD,AMPERSAND:i1,APOSTROPHE:a1,ASCIINUMERICAL:pD,ASTERISK:s1,AT:Md,BACKSLASH:o1,BACKTICK:l1,CARET:u1,CLOSEANGLEBRACKET:Zx,CLOSEBRACE:hv,CLOSEBRACKET:Wx,CLOSEPAREN:$x,COLON:Rd,COMMA:CC,DOLLAR:c1,DOT:mu,EMOJI:vD,EQUALS:d1,EXCLAMATION:EC,FULLWIDTHGREATERTHAN:n1,FULLWIDTHLEFTPAREN:Yx,FULLWIDTHLESSTHAN:r1,FULLWIDTHMIDDLEDOT:gD,FULLWIDTHRIGHTPAREN:Xx,HYPHEN:Fo,LEFTCORNERBRACKET:Qx,LEFTWHITECORNERBRACKET:e1,LOCALHOST:qv,NL:_C,NUM:kC,OPENANGLEBRACKET:Kx,OPENBRACE:fv,OPENBRACKET:Hx,OPENPAREN:qx,PERCENT:pv,PIPE:f1,PLUS:h1,POUND:p1,QUERY:mv,QUOTE:TC,RIGHTCORNERBRACKET:Jx,RIGHTWHITECORNERBRACKET:t1,SCHEME:rx,SEMI:NC,SLASH:gu,SLASH_SCHEME:Rp,SYM:g1,TILDE:gv,TLD:Vk,UNDERSCORE:m1,UTLD:Hk,UWORD:Gk,WORD:uc,WS:Wk});const oc=/[a-z]/,Wg=new RegExp("\\p{L}","u"),SS=new RegExp("\\p{Emoji}","u"),lc=/\d/,kS=/\s/,qP="\r",_S=`
`,Are="",Lre="",CS="";let Ry=null,Oy=null;function Rre(t=[]){const e={};Hs.groups=e;const r=new Hs;Ry==null&&(Ry=$P(Cre)),Oy==null&&(Oy=$P(Ere)),st(r,"'",a1),st(r,"{",fv),st(r,"}",hv),st(r,"[",Hx),st(r,"]",Wx),st(r,"(",qx),st(r,")",$x),st(r,"<",Kx),st(r,">",Zx),st(r,"",Yx),st(r,"",Xx),st(r,"",Qx),st(r,"",Jx),st(r,"",e1),st(r,"",t1),st(r,"",r1),st(r,"",n1),st(r,"&",i1),st(r,"*",s1),st(r,"@",Md),st(r,"`",l1),st(r,"^",u1),st(r,":",Rd),st(r,",",CC),st(r,"$",c1),st(r,".",mu),st(r,"=",d1),st(r,"!",EC),st(r,"-",Fo),st(r,"%",pv),st(r,"|",f1),st(r,"+",h1),st(r,"#",p1),st(r,"?",mv),st(r,'"',TC),st(r,"/",gu),st(r,";",NC),st(r,"~",gv),st(r,"_",m1),st(r,"\\",o1),st(r,"",gD);const n=ti(r,lc,kC,{[Fk]:!0});ti(n,lc,n);const i=ti(n,oc,pD,{[dv]:!0}),a=ti(n,Wg,mD,{[rv]:!0}),s=ti(r,oc,uc,{[Bk]:!0});ti(s,lc,i),ti(s,oc,s),ti(i,lc,i),ti(i,oc,i);const o=ti(r,Wg,Gk,{[zk]:!0});ti(o,oc),ti(o,lc,a),ti(o,Wg,o),ti(a,lc,a),ti(a,oc),ti(a,Wg,a);const l=st(r,_S,_C,{[wS]:!0}),u=st(r,qP,Wk,{[wS]:!0}),c=ti(r,kS,Wk,{[wS]:!0});st(r,CS,c),st(u,_S,l),st(u,CS,c),ti(u,kS,c),st(c,qP),st(c,_S),ti(c,kS,c),st(c,CS,c);const f=ti(r,SS,vD,{[hD]:!0});st(f,"#"),ti(f,SS,f),st(f,Are,f);const p=st(f,Lre);st(p,"#"),ti(p,SS,f);const v=[[oc,s],[lc,i]],y=[[oc,null],[Wg,o],[lc,a]];for(let S=0;S<Ry.length;S++)Cd(r,Ry[S],Vk,uc,v);for(let S=0;S<Oy.length;S++)Cd(r,Oy[S],Hk,Gk,y);lh(Vk,{tld:!0,ascii:!0},e),lh(Hk,{utld:!0,alpha:!0},e),Cd(r,"file",rx,uc,v),Cd(r,"mailto",rx,uc,v),Cd(r,"http",Rp,uc,v),Cd(r,"https",Rp,uc,v),Cd(r,"ftp",Rp,uc,v),Cd(r,"ftps",Rp,uc,v),lh(rx,{scheme:!0,ascii:!0},e),lh(Rp,{slashscheme:!0,ascii:!0},e),t=t.sort((S,w)=>S[0]>w[0]?1:-1);for(let S=0;S<t.length;S++){const w=t[S][0],_=t[S][1]?{[Tre]:!0}:{[Nre]:!0};w.indexOf("-")>=0?_[Uk]=!0:oc.test(w)?lc.test(w)?_[dv]=!0:_[Bk]=!0:_[Fk]=!0,WP(r,w,w,_)}return WP(r,"localhost",qv,{ascii:!0}),r.jd=new Hs(g1),{start:r,tokens:Object.assign({groups:e},yD)}}function xD(t,e){const r=Ore(e.replace(/[A-Z]/g,o=>o.toLowerCase())),n=r.length,i=[];let a=0,s=0;for(;s<n;){let o=t,l=null,u=0,c=null,f=-1,p=-1;for(;s<n&&(l=o.go(r[s]));)o=l,o.accepts()?(f=0,p=0,c=o):f>=0&&(f+=r[s].length,p++),u+=r[s].length,a+=r[s].length,s++;a-=f,s-=p,u-=f,i.push({t:c.t,v:e.slice(a-u,a),s:a-u,e:a})}return i}function Ore(t){const e=[],r=t.length;let n=0;for(;n<r;){let i=t.charCodeAt(n),a,s=i<55296||i>56319||n+1===r||(a=t.charCodeAt(n+1))<56320||a>57343?t[n]:t.slice(n,n+2);e.push(s),n+=s.length}return e}function Cd(t,e,r,n,i){let a;const s=e.length;for(let o=0;o<s-1;o++){const l=e[o];t.j[l]?a=t.j[l]:(a=new Hs(n),a.jr=i.slice(),t.j[l]=a),t=a}return a=new Hs(r),a.jr=i.slice(),t.j[e[s-1]]=a,a}function $P(t){const e=[],r=[];let n=0,i="0123456789";for(;n<t.length;){let a=0;for(;i.indexOf(t[n+a])>=0;)a++;if(a>0){e.push(r.join(""));for(let s=parseInt(t.substring(n,n+a),10);s>0;s--)r.pop();n+=a}else r.push(t[n]),n++}return e}const $v={defaultProtocol:"http",events:null,format:KP,formatHref:KP,nl2br:!1,tagName:"a",target:null,rel:null,validate:!0,truncate:1/0,className:null,attributes:null,ignoreTags:[],render:null};function PC(t,e=null){let r=Object.assign({},$v);t&&(r=Object.assign(r,t instanceof PC?t.o:t));const n=r.ignoreTags,i=[];for(let a=0;a<n.length;a++)i.push(n[a].toUpperCase());this.o=r,e&&(this.defaultRender=e),this.ignoreTags=i}PC.prototype={o:$v,ignoreTags:[],defaultRender(t){return t},check(t){return this.get("validate",t.toString(),t)},get(t,e,r){const n=e!=null;let i=this.o[t];return i&&(typeof i=="object"?(i=r.t in i?i[r.t]:$v[t],typeof i=="function"&&n&&(i=i(e,r))):typeof i=="function"&&n&&(i=i(e,r.t,r)),i)},getObj(t,e,r){let n=this.o[t];return typeof n=="function"&&e!=null&&(n=n(e,r.t,r)),n},render(t){const e=t.render(this);return(this.get("render",null,t)||this.defaultRender)(e,t.t,t)}};function KP(t){return t}function bD(t,e){this.t="token",this.v=t,this.tk=e}bD.prototype={isLink:!1,toString(){return this.v},toHref(t){return this.toString()},toFormattedString(t){const e=this.toString(),r=t.get("truncate",e,this),n=t.get("format",e,this);return r&&n.length>r?n.substring(0,r)+"":n},toFormattedHref(t){return t.get("formatHref",this.toHref(t.get("defaultProtocol")),this)},startIndex(){return this.tk[0].s},endIndex(){return this.tk[this.tk.length-1].e},toObject(t=$v.defaultProtocol){return{type:this.t,value:this.toString(),isLink:this.isLink,href:this.toHref(t),start:this.startIndex(),end:this.endIndex()}},toFormattedObject(t){return{type:this.t,value:this.toFormattedString(t),isLink:this.isLink,href:this.toFormattedHref(t),start:this.startIndex(),end:this.endIndex()}},validate(t){return t.get("validate",this.toString(),this)},render(t){const e=this,r=this.toHref(t.get("defaultProtocol")),n=t.get("formatHref",r,this),i=t.get("tagName",r,e),a=this.toFormattedString(t),s={},o=t.get("className",r,e),l=t.get("target",r,e),u=t.get("rel",r,e),c=t.getObj("attributes",r,e),f=t.getObj("events",r,e);return s.href=n,o&&(s.class=o),l&&(s.target=l),u&&(s.rel=u),c&&Object.assign(s,c),{tagName:i,attributes:s,content:a,eventListeners:f}}};function lb(t,e){class r extends bD{constructor(i,a){super(i,a),this.t=t}}for(const n in e)r.prototype[n]=e[n];return r.t=t,r}const ZP=lb("email",{isLink:!0,toHref(){return"mailto:"+this.toString()}}),YP=lb("text"),Dre=lb("nl"),Dy=lb("url",{isLink:!0,toHref(t=$v.defaultProtocol){return this.hasProtocol()?this.v:`${t}://${this.v}`},hasProtocol(){const t=this.tk;return t.length>=2&&t[0].t!==qv&&t[1].t===Rd}}),Io=t=>new Hs(t);function Ire({groups:t}){const e=t.domain.concat([i1,s1,Md,o1,l1,u1,c1,d1,Fo,kC,pv,f1,h1,p1,gu,g1,gv,m1]),r=[a1,Rd,CC,mu,EC,pv,mv,TC,NC,Kx,Zx,fv,hv,Wx,Hx,qx,$x,Yx,Xx,Qx,Jx,e1,t1,r1,n1],n=[i1,a1,s1,o1,l1,u1,c1,d1,Fo,fv,hv,pv,f1,h1,p1,mv,gu,g1,gv,m1],i=Io(),a=st(i,gv);vr(a,n,a),vr(a,t.domain,a);const s=Io(),o=Io(),l=Io();vr(i,t.domain,s),vr(i,t.scheme,o),vr(i,t.slashscheme,l),vr(s,n,a),vr(s,t.domain,s);const u=st(s,Md);st(a,Md,u),st(o,Md,u),st(l,Md,u);const c=st(a,mu);vr(c,n,a),vr(c,t.domain,a);const f=Io();vr(u,t.domain,f),vr(f,t.domain,f);const p=st(f,mu);vr(p,t.domain,f);const v=Io(ZP);vr(p,t.tld,v),vr(p,t.utld,v),st(u,qv,v);const y=st(f,Fo);st(y,Fo,y),vr(y,t.domain,f),vr(v,t.domain,f),st(v,mu,p),st(v,Fo,y);const S=st(v,Rd);vr(S,t.numeric,ZP);const w=st(s,Fo),T=st(s,mu);st(w,Fo,w),vr(w,t.domain,s),vr(T,n,a),vr(T,t.domain,s);const _=Io(Dy);vr(T,t.tld,_),vr(T,t.utld,_),vr(_,t.domain,s),vr(_,n,a),st(_,mu,T),st(_,Fo,w),st(_,Md,u);const C=st(_,Rd),N=Io(Dy);vr(C,t.numeric,N);const A=Io(Dy),O=Io();vr(A,e,A),vr(A,r,O),vr(O,e,A),vr(O,r,O),st(_,gu,A),st(N,gu,A);const j=st(o,Rd),D=st(l,Rd),F=st(D,gu),B=st(F,gu);vr(o,t.domain,s),st(o,mu,T),st(o,Fo,w),vr(l,t.domain,s),st(l,mu,T),st(l,Fo,w),vr(j,t.domain,A),st(j,gu,A),st(j,mv,A),vr(B,t.domain,A),vr(B,e,A),st(B,gu,A);const $=[[fv,hv],[Hx,Wx],[qx,$x],[Kx,Zx],[Yx,Xx],[Qx,Jx],[e1,t1],[r1,n1]];for(let Z=0;Z<$.length;Z++){const[I,q]=$[Z],U=st(A,I);st(O,I,U),st(U,q,A);const W=Io(Dy);vr(U,e,W);const Y=Io();vr(U,r),vr(W,e,W),vr(W,r,Y),vr(Y,e,W),vr(Y,r,Y),st(W,q,A),st(Y,q,A)}return st(i,qv,_),st(i,_C,Dre),{start:i,tokens:yD}}function jre(t,e,r){let n=r.length,i=0,a=[],s=[];for(;i<n;){let o=t,l=null,u=null,c=0,f=null,p=-1;for(;i<n&&!(l=o.go(r[i].t));)s.push(r[i++]);for(;i<n&&(u=l||o.go(r[i].t));)l=null,o=u,o.accepts()?(p=0,f=o):p>=0&&p++,i++,c++;if(p<0)i-=c,i<n&&(s.push(r[i]),i++);else{s.length>0&&(a.push(ES(YP,e,s)),s=[]),i-=p,c-=p;const v=f.t,y=r.slice(i-c,i);a.push(ES(v,e,y))}}return s.length>0&&a.push(ES(YP,e,s)),a}function ES(t,e,r){const n=r[0].s,i=r[r.length-1].e,a=e.slice(n,i);return new t(a,r)}const Fre=typeof console<"u"&&console&&console.warn||(()=>{}),Bre="until manual call of linkify.init(). Register all schemes and plugins before invoking linkify the first time.",Tn={scanner:null,parser:null,tokenQueue:[],pluginQueue:[],customSchemes:[],initialized:!1};function zre(){return Hs.groups={},Tn.scanner=null,Tn.parser=null,Tn.tokenQueue=[],Tn.pluginQueue=[],Tn.customSchemes=[],Tn.initialized=!1,Tn}function XP(t,e=!1){if(Tn.initialized&&Fre(`linkifyjs: already initialized - will not register custom scheme "${t}" ${Bre}`),!/^[0-9a-z]+(-[0-9a-z]+)*$/.test(t))throw new Error(`linkifyjs: incorrect scheme format.
1. Must only contain digits, lowercase ASCII letters or "-"
2. Cannot start or end with "-"
3. "-" cannot repeat`);Tn.customSchemes.push([t,e])}function Ure(){Tn.scanner=Rre(Tn.customSchemes);for(let t=0;t<Tn.tokenQueue.length;t++)Tn.tokenQueue[t][1]({scanner:Tn.scanner});Tn.parser=Ire(Tn.scanner.tokens);for(let t=0;t<Tn.pluginQueue.length;t++)Tn.pluginQueue[t][1]({scanner:Tn.scanner,parser:Tn.parser});return Tn.initialized=!0,Tn}function MC(t){return Tn.initialized||Ure(),jre(Tn.parser.start,t,xD(Tn.scanner.start,t))}MC.scan=xD;function wD(t,e=null,r=null){if(e&&typeof e=="object"){if(r)throw Error(`linkifyjs: Invalid link type ${e}; must be a string`);r=e,e=null}const n=new PC(r),i=MC(t),a=[];for(let s=0;s<i.length;s++){const o=i[s];o.isLink&&(!e||o.t===e)&&n.check(o)&&a.push(o.toFormattedObject(n))}return a}var AC="[\0- -\u2029]",Gre=new RegExp(AC),Vre=new RegExp(`${AC}$`),Hre=new RegExp(AC,"g");function Wre(t){return t.length===1?t[0].isLink:t.length===3&&t[1].isLink?["()","[]"].includes(t[0].value+t[2].value):!1}function qre(t){return new Hn({key:new xi("autolink"),appendTransaction:(e,r,n)=>{const i=e.some(u=>u.docChanged)&&!r.doc.eq(n.doc),a=e.some(u=>u.getMeta("preventAutolink"));if(!i||a)return;const{tr:s}=n,o=F6(r.doc,[...e]);if(W6(o).forEach(({newRange:u})=>{const c=UJ(n.doc,u,v=>v.isTextblock);let f,p;if(c.length>1)f=c[0],p=n.doc.textBetween(f.pos,f.pos+f.node.nodeSize,void 0," ");else if(c.length){const v=n.doc.textBetween(u.from,u.to," "," ");if(!Vre.test(v))return;f=c[0],p=n.doc.textBetween(f.pos,u.to,void 0," ")}if(f&&p){const v=p.split(Gre).filter(Boolean);if(v.length<=0)return!1;const y=v[v.length-1],S=f.pos+p.lastIndexOf(y);if(!y)return!1;const w=MC(y).map(T=>T.toObject(t.defaultProtocol));if(!Wre(w))return!1;w.filter(T=>T.isLink).map(T=>({...T,from:S+T.start+1,to:S+T.end+1})).filter(T=>n.schema.marks.code?!n.doc.rangeHasMark(T.from,T.to,n.schema.marks.code):!0).filter(T=>t.validate(T.value)).filter(T=>t.shouldAutoLink(T.value)).forEach(T=>{yC(T.from,T.to,n.doc).some(_=>_.mark.type===t.type)||s.addMark(T.from,T.to,t.type.create({href:T.href}))})}}),!!s.steps.length)return s}})}function $re(t){return new Hn({key:new xi("handleClickLink"),props:{handleClick:(e,r,n)=>{var i,a;if(n.button!==0||!e.editable)return!1;let s=null;if(n.target instanceof HTMLAnchorElement)s=n.target;else{const l=n.target;if(!l)return!1;const u=t.editor.view.dom;s=l.closest("a"),s&&!u.contains(s)&&(s=null)}if(!s)return!1;let o=!1;if(t.enableClickSelection&&(o=t.editor.commands.extendMarkRange(t.type.name)),t.openOnClick){const l=H6(e.state,t.type.name),u=(i=s.href)!=null?i:l.href,c=(a=s.target)!=null?a:l.target;u&&(window.open(u,c),o=!0)}return o}}})}function Kre(t){return new Hn({key:new xi("handlePasteLink"),props:{handlePaste:(e,r,n)=>{const{shouldAutoLink:i}=t,{state:a}=e,{selection:s}=a,{empty:o}=s;if(o)return!1;let l="";n.content.forEach(c=>{l+=c.textContent});const u=wD(l,{defaultProtocol:t.defaultProtocol}).find(c=>c.isLink&&c.value===l);return!l||!u||i!==void 0&&!i(u.value)?!1:t.editor.commands.setMark(t.type,{href:u.href})}}})}function Zf(t,e){const r=["http","https","ftp","ftps","mailto","tel","callto","sms","cid","xmpp"];return e&&e.forEach(n=>{const i=typeof n=="string"?n:n.scheme;i&&r.push(i)}),!t||t.replace(Hre,"").match(new RegExp(`^(?:(?:${r.join("|")}):|[^a-z]|[a-z0-9+.-]+(?:[^a-z+.-:]|$))`,"i"))}var Zre=Dh.create({name:"link",priority:1e3,keepOnSplit:!1,exitable:!0,onCreate(){this.options.validate&&!this.options.shouldAutoLink&&(this.options.shouldAutoLink=this.options.validate,console.warn("The `validate` option is deprecated. Rename to the `shouldAutoLink` option instead.")),this.options.protocols.forEach(t=>{if(typeof t=="string"){XP(t);return}XP(t.scheme,t.optionalSlashes)})},onDestroy(){zre()},inclusive(){return this.options.autolink},addOptions(){return{openOnClick:!0,enableClickSelection:!1,linkOnPaste:!0,autolink:!0,protocols:[],defaultProtocol:"http",HTMLAttributes:{target:"_blank",rel:"noopener noreferrer nofollow",class:null},isAllowedUri:(t,e)=>!!Zf(t,e.protocols),validate:t=>!!t,shouldAutoLink:t=>{const e=/^[a-z][a-z0-9+.-]*:\/\//i.test(t),r=/^[a-z][a-z0-9+.-]*:/i.test(t);if(e||r&&!t.includes("@"))return!0;const i=(t.includes("@")?t.split("@").pop():t).split(/[/?#:]/)[0];return!(/^\d{1,3}(\.\d{1,3}){3}$/.test(i)||!/\./.test(i))}}},addAttributes(){return{href:{default:null,parseHTML(t){return t.getAttribute("href")}},target:{default:this.options.HTMLAttributes.target},rel:{default:this.options.HTMLAttributes.rel},class:{default:this.options.HTMLAttributes.class}}},parseHTML(){return[{tag:"a[href]",getAttrs:t=>{const e=t.getAttribute("href");return!e||!this.options.isAllowedUri(e,{defaultValidate:r=>!!Zf(r,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?!1:null}}]},renderHTML({HTMLAttributes:t}){return this.options.isAllowedUri(t.href,{defaultValidate:e=>!!Zf(e,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?["a",Vn(this.options.HTMLAttributes,t),0]:["a",Vn(this.options.HTMLAttributes,{...t,href:""}),0]},markdownTokenName:"link",parseMarkdown:(t,e)=>e.applyMark("link",e.parseInline(t.tokens||[]),{href:t.href,title:t.title||null}),renderMarkdown:(t,e)=>{var r;const n=((r=t.attrs)==null?void 0:r.href)||"";return`[${e.renderChildren(t)}](${n})`},addCommands(){return{setLink:t=>({chain:e})=>{const{href:r}=t;return this.options.isAllowedUri(r,{defaultValidate:n=>!!Zf(n,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?e().setMark(this.name,t).setMeta("preventAutolink",!0).run():!1},toggleLink:t=>({chain:e})=>{const{href:r}=t||{};return r&&!this.options.isAllowedUri(r,{defaultValidate:n=>!!Zf(n,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?!1:e().toggleMark(this.name,t,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()},unsetLink:()=>({chain:t})=>t().unsetMark(this.name,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()}},addPasteRules(){return[Nh({find:t=>{const e=[];if(t){const{protocols:r,defaultProtocol:n}=this.options,i=wD(t).filter(a=>a.isLink&&this.options.isAllowedUri(a.value,{defaultValidate:s=>!!Zf(s,r),protocols:r,defaultProtocol:n}));i.length&&i.forEach(a=>{this.options.shouldAutoLink(a.value)&&e.push({text:a.value,data:{href:a.href},index:a.start})})}return e},type:this.type,getAttributes:t=>{var e;return{href:(e=t.data)==null?void 0:e.href}}})]},addProseMirrorPlugins(){const t=[],{protocols:e,defaultProtocol:r}=this.options;return this.options.autolink&&t.push(qre({type:this.type,defaultProtocol:this.options.defaultProtocol,validate:n=>this.options.isAllowedUri(n,{defaultValidate:i=>!!Zf(i,e),protocols:e,defaultProtocol:r}),shouldAutoLink:this.options.shouldAutoLink})),t.push($re({type:this.type,editor:this.editor,openOnClick:this.options.openOnClick==="whenNotEditable"?!0:this.options.openOnClick,enableClickSelection:this.options.enableClickSelection})),this.options.linkOnPaste&&t.push(Kre({editor:this.editor,defaultProtocol:this.options.defaultProtocol,type:this.type,shouldAutoLink:this.options.shouldAutoLink})),t}}),Yre=Object.defineProperty,Xre=(t,e)=>{for(var r in e)Yre(t,r,{get:e[r],enumerable:!0})},Qre="listItem",QP="textStyle",JP=/^\s*([-+*])\s$/,SD=Zs.create({name:"bulletList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:"ul"}]},renderHTML({HTMLAttributes:t}){return["ul",Vn(this.options.HTMLAttributes,t),0]},markdownTokenName:"list",parseMarkdown:(t,e)=>t.type!=="list"||t.ordered?[]:{type:"bulletList",content:t.items?e.parseChildren(t.items):[]},renderMarkdown:(t,e)=>t.content?e.renderChildren(t.content,`
`):"",markdownOptions:{indentsContent:!0},addCommands(){return{toggleBulletList:()=>({commands:t,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(Qre,this.editor.getAttributes(QP)).run():t.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){let t=im({find:JP,type:this.type});return(this.options.keepMarks||this.options.keepAttributes)&&(t=im({find:JP,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:()=>this.editor.getAttributes(QP),editor:this.editor})),[t]}}),kD=Zs.create({name:"listItem",addOptions(){return{HTMLAttributes:{},bulletListTypeName:"bulletList",orderedListTypeName:"orderedList"}},content:"paragraph block*",defining:!0,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:t}){return["li",Vn(this.options.HTMLAttributes,t),0]},markdownTokenName:"list_item",parseMarkdown:(t,e)=>{if(t.type!=="list_item")return[];let r=[];if(t.tokens&&t.tokens.length>0)if(t.tokens.some(i=>i.type==="paragraph"))r=e.parseChildren(t.tokens);else{const i=t.tokens[0];if(i&&i.type==="text"&&i.tokens&&i.tokens.length>0){if(r=[{type:"paragraph",content:e.parseInline(i.tokens)}],t.tokens.length>1){const s=t.tokens.slice(1),o=e.parseChildren(s);r.push(...o)}}else r=e.parseChildren(t.tokens)}return r.length===0&&(r=[{type:"paragraph",content:[]}]),{type:"listItem",content:r}},renderMarkdown:(t,e,r)=>SC(t,e,n=>n.parentType==="bulletList"?"- ":n.parentType==="orderedList"?`${n.index+1}. `:"- ",r),addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),Jre={};Xre(Jre,{findListItemPos:()=>y0,getNextListDepth:()=>LC,handleBackspace:()=>qk,handleDelete:()=>$k,hasListBefore:()=>_D,hasListItemAfter:()=>ene,hasListItemBefore:()=>CD,listItemHasSubList:()=>ED,nextListIsDeeper:()=>TD,nextListIsHigher:()=>ND});var y0=(t,e)=>{const{$from:r}=e.selection,n=Ri(t,e.schema);let i=null,a=r.depth,s=r.pos,o=null;for(;a>0&&o===null;)i=r.node(a),i.type===n?o=a:(a-=1,s-=1);return o===null?null:{$pos:e.doc.resolve(s),depth:o}},LC=(t,e)=>{const r=y0(t,e);if(!r)return!1;const[,n]=XJ(e,t,r.$pos.pos+4);return n},_D=(t,e,r)=>{const{$anchor:n}=t.selection,i=Math.max(0,n.pos-2),a=t.doc.resolve(i).node();return!(!a||!r.includes(a.type.name))},CD=(t,e)=>{var r;const{$anchor:n}=e.selection,i=e.doc.resolve(n.pos-2);return!(i.index()===0||((r=i.nodeBefore)==null?void 0:r.type.name)!==t)},ED=(t,e,r)=>{if(!r)return!1;const n=Ri(t,e.schema);let i=!1;return r.descendants(a=>{a.type===n&&(i=!0)}),i},qk=(t,e,r)=>{if(t.commands.undoInputRule())return!0;if(t.state.selection.from!==t.state.selection.to)return!1;if(!sf(t.state,e)&&_D(t.state,e,r)){const{$anchor:o}=t.state.selection,l=t.state.doc.resolve(o.before()-1),u=[];l.node().descendants((p,v)=>{p.type.name===e&&u.push({node:p,pos:v})});const c=u.at(-1);if(!c)return!1;const f=t.state.doc.resolve(l.start()+c.pos+1);return t.chain().cut({from:o.start()-1,to:o.end()+1},f.end()).joinForward().run()}if(!sf(t.state,e)||!tee(t.state))return!1;const n=y0(e,t.state);if(!n)return!1;const a=t.state.doc.resolve(n.$pos.pos-2).node(n.depth),s=ED(e,t.state,a);return CD(e,t.state)&&!s?t.commands.joinItemBackward():t.chain().liftListItem(e).run()},TD=(t,e)=>{const r=LC(t,e),n=y0(t,e);return!n||!r?!1:r>n.depth},ND=(t,e)=>{const r=LC(t,e),n=y0(t,e);return!n||!r?!1:r<n.depth},$k=(t,e)=>{if(!sf(t.state,e)||!eee(t.state,e))return!1;const{selection:r}=t.state,{$from:n,$to:i}=r;return!r.empty&&n.sameParent(i)?!1:TD(e,t.state)?t.chain().focus(t.state.selection.from+4).lift(e).joinBackward().run():ND(e,t.state)?t.chain().joinForward().joinBackward().run():t.commands.joinItemForward()},ene=(t,e)=>{var r;const{$anchor:n}=e.selection,i=e.doc.resolve(n.pos-n.parentOffset-2);return!(i.index()===i.parent.childCount-1||((r=i.nodeAfter)==null?void 0:r.type.name)!==t)},PD=bi.create({name:"listKeymap",addOptions(){return{listTypes:[{itemName:"listItem",wrapperNames:["bulletList","orderedList"]},{itemName:"taskItem",wrapperNames:["taskList"]}]}},addKeyboardShortcuts(){return{Delete:({editor:t})=>{let e=!1;return this.options.listTypes.forEach(({itemName:r})=>{t.state.schema.nodes[r]!==void 0&&$k(t,r)&&(e=!0)}),e},"Mod-Delete":({editor:t})=>{let e=!1;return this.options.listTypes.forEach(({itemName:r})=>{t.state.schema.nodes[r]!==void 0&&$k(t,r)&&(e=!0)}),e},Backspace:({editor:t})=>{let e=!1;return this.options.listTypes.forEach(({itemName:r,wrapperNames:n})=>{t.state.schema.nodes[r]!==void 0&&qk(t,r,n)&&(e=!0)}),e},"Mod-Backspace":({editor:t})=>{let e=!1;return this.options.listTypes.forEach(({itemName:r,wrapperNames:n})=>{t.state.schema.nodes[r]!==void 0&&qk(t,r,n)&&(e=!0)}),e}}}}),eM=/^(\s*)(\d+)\.\s+(.*)$/,tne=/^\s/;function rne(t){const e=[];let r=0,n=0;for(;r<t.length;){const i=t[r],a=i.match(eM);if(!a)break;const[,s,o,l]=a,u=s.length;let c=l,f=r+1;const p=[i];for(;f<t.length;){const v=t[f];if(v.match(eM))break;if(v.trim()==="")p.push(v),c+=`
`,f+=1;else if(v.match(tne))p.push(v),c+=`
${v.slice(u+2)}`,f+=1;else break}e.push({indent:u,number:parseInt(o,10),content:c.trim(),raw:p.join(`
`)}),n=f,r=f}return[e,n]}function MD(t,e,r){var n;const i=[];let a=0;for(;a<t.length;){const s=t[a];if(s.indent===e){const o=s.content.split(`
`),l=((n=o[0])==null?void 0:n.trim())||"",u=[];l&&u.push({type:"paragraph",raw:l,tokens:r.inlineTokens(l)});const c=o.slice(1).join(`
`).trim();if(c){const v=r.blockTokens(c);u.push(...v)}let f=a+1;const p=[];for(;f<t.length&&t[f].indent>e;)p.push(t[f]),f+=1;if(p.length>0){const v=Math.min(...p.map(S=>S.indent)),y=MD(p,v,r);u.push({type:"list",ordered:!0,start:p[0].number,items:y,raw:p.map(S=>S.raw).join(`
`)})}i.push({type:"list_item",raw:s.raw,tokens:u}),a=f}else a+=1}return i}function nne(t,e){return t.map(r=>{if(r.type!=="list_item")return e.parseChildren([r])[0];const n=[];return r.tokens&&r.tokens.length>0&&r.tokens.forEach(i=>{if(i.type==="paragraph"||i.type==="list"||i.type==="blockquote"||i.type==="code")n.push(...e.parseChildren([i]));else if(i.type==="text"&&i.tokens){const a=e.parseChildren([i]);n.push({type:"paragraph",content:a})}else{const a=e.parseChildren([i]);a.length>0&&n.push(...a)}}),{type:"listItem",content:n}})}var ine="listItem",tM="textStyle",rM=/^(\d+)\.\s$/,AD=Zs.create({name:"orderedList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},addAttributes(){return{start:{default:1,parseHTML:t=>t.hasAttribute("start")?parseInt(t.getAttribute("start")||"",10):1},type:{default:null,parseHTML:t=>t.getAttribute("type")}}},parseHTML(){return[{tag:"ol"}]},renderHTML({HTMLAttributes:t}){const{start:e,...r}=t;return e===1?["ol",Vn(this.options.HTMLAttributes,r),0]:["ol",Vn(this.options.HTMLAttributes,t),0]},markdownTokenName:"list",parseMarkdown:(t,e)=>{if(t.type!=="list"||!t.ordered)return[];const r=t.start||1,n=t.items?nne(t.items,e):[];return r!==1?{type:"orderedList",attrs:{start:r},content:n}:{type:"orderedList",content:n}},renderMarkdown:(t,e)=>t.content?e.renderChildren(t.content,`
`):"",markdownTokenizer:{name:"orderedList",level:"block",start:t=>{const e=t.match(/^(\s*)(\d+)\.\s+/),r=e?.index;return r!==void 0?r:-1},tokenize:(t,e,r)=>{var n;const i=t.split(`
`),[a,s]=rne(i);if(a.length===0)return;const o=MD(a,0,r);return o.length===0?void 0:{type:"list",ordered:!0,start:((n=a[0])==null?void 0:n.number)||1,items:o,raw:i.slice(0,s).join(`
`)}}},markdownOptions:{indentsContent:!0},addCommands(){return{toggleOrderedList:()=>({commands:t,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(ine,this.editor.getAttributes(tM)).run():t.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){let t=im({find:rM,type:this.type,getAttributes:e=>({start:+e[1]}),joinPredicate:(e,r)=>r.childCount+r.attrs.start===+e[1]});return(this.options.keepMarks||this.options.keepAttributes)&&(t=im({find:rM,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:e=>({start:+e[1],...this.editor.getAttributes(tM)}),joinPredicate:(e,r)=>r.childCount+r.attrs.start===+e[1],editor:this.editor})),[t]}}),ane=/^\s*(\[([( |x])?\])\s$/,sne=Zs.create({name:"taskItem",addOptions(){return{nested:!1,HTMLAttributes:{},taskListTypeName:"taskList",a11y:void 0}},content(){return this.options.nested?"paragraph block*":"paragraph+"},defining:!0,addAttributes(){return{checked:{default:!1,keepOnSplit:!1,parseHTML:t=>{const e=t.getAttribute("data-checked");return e===""||e==="true"},renderHTML:t=>({"data-checked":t.checked})}}},parseHTML(){return[{tag:`li[data-type="${this.name}"]`,priority:51}]},renderHTML({node:t,HTMLAttributes:e}){return["li",Vn(this.options.HTMLAttributes,e,{"data-type":this.name}),["label",["input",{type:"checkbox",checked:t.attrs.checked?"checked":null}],["span"]],["div",0]]},parseMarkdown:(t,e)=>{const r=[];if(t.tokens&&t.tokens.length>0?r.push(e.createNode("paragraph",{},e.parseInline(t.tokens))):t.text?r.push(e.createNode("paragraph",{},[e.createNode("text",{text:t.text})])):r.push(e.createNode("paragraph",{},[])),t.nestedTokens&&t.nestedTokens.length>0){const n=e.parseChildren(t.nestedTokens);r.push(...n)}return e.createNode("taskItem",{checked:t.checked||!1},r)},renderMarkdown:(t,e)=>{var r;const i=`- [${(r=t.attrs)!=null&&r.checked?"x":" "}] `;return SC(t,e,i)},addKeyboardShortcuts(){const t={Enter:()=>this.editor.commands.splitListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)};return this.options.nested?{...t,Tab:()=>this.editor.commands.sinkListItem(this.name)}:t},addNodeView(){return({node:t,HTMLAttributes:e,getPos:r,editor:n})=>{const i=document.createElement("li"),a=document.createElement("label"),s=document.createElement("span"),o=document.createElement("input"),l=document.createElement("div"),u=f=>{var p,v;o.ariaLabel=((v=(p=this.options.a11y)==null?void 0:p.checkboxLabel)==null?void 0:v.call(p,f,o.checked))||`Task item checkbox for ${f.textContent||"empty task item"}`};u(t),a.contentEditable="false",o.type="checkbox",o.addEventListener("mousedown",f=>f.preventDefault()),o.addEventListener("change",f=>{if(!n.isEditable&&!this.options.onReadOnlyChecked){o.checked=!o.checked;return}const{checked:p}=f.target;n.isEditable&&typeof r=="function"&&n.chain().focus(void 0,{scrollIntoView:!1}).command(({tr:v})=>{const y=r();if(typeof y!="number")return!1;const S=v.doc.nodeAt(y);return v.setNodeMarkup(y,void 0,{...S?.attrs,checked:p}),!0}).run(),!n.isEditable&&this.options.onReadOnlyChecked&&(this.options.onReadOnlyChecked(t,p)||(o.checked=!o.checked))}),Object.entries(this.options.HTMLAttributes).forEach(([f,p])=>{i.setAttribute(f,p)}),i.dataset.checked=t.attrs.checked,o.checked=t.attrs.checked,a.append(o,s),i.append(a,l),Object.entries(e).forEach(([f,p])=>{i.setAttribute(f,p)});let c=new Set(Object.keys(e));return{dom:i,contentDOM:l,update:f=>{if(f.type!==this.type)return!1;i.dataset.checked=f.attrs.checked,o.checked=f.attrs.checked,u(f);const p=n.extensionManager.attributes,v=Wv(f,p),y=new Set(Object.keys(v)),S=this.options.HTMLAttributes;return c.forEach(w=>{y.has(w)||(w in S?i.setAttribute(w,S[w]):i.removeAttribute(w))}),Object.entries(v).forEach(([w,T])=>{T==null?w in S?i.setAttribute(w,S[w]):i.removeAttribute(w):i.setAttribute(w,T)}),c=y,!0}}}},addInputRules(){return[im({find:ane,type:this.type,getAttributes:t=>({checked:t[t.length-1]==="x"})})]}}),one=Zs.create({name:"taskList",addOptions(){return{itemTypeName:"taskItem",HTMLAttributes:{}}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:`ul[data-type="${this.name}"]`,priority:51}]},renderHTML({HTMLAttributes:t}){return["ul",Vn(this.options.HTMLAttributes,t,{"data-type":this.name}),0]},parseMarkdown:(t,e)=>e.createNode("taskList",{},e.parseChildren(t.items||[])),renderMarkdown:(t,e)=>t.content?e.renderChildren(t.content,`
`):"",markdownTokenizer:{name:"taskList",level:"block",start(t){var e;const r=(e=t.match(/^\s*[-+*]\s+\[([ xX])\]\s+/))==null?void 0:e.index;return r!==void 0?r:-1},tokenize(t,e,r){const n=a=>{const s=Ik(a,{itemPattern:/^(\s*)([-+*])\s+\[([ xX])\]\s+(.*)$/,extractItemData:o=>({indentLevel:o[1].length,mainContent:o[4],checked:o[3].toLowerCase()==="x"}),createToken:(o,l)=>({type:"taskItem",raw:"",mainContent:o.mainContent,indentLevel:o.indentLevel,checked:o.checked,text:o.mainContent,tokens:r.inlineTokens(o.mainContent),nestedTokens:l}),customNestedParser:n},r);return s?[{type:"taskList",raw:s.raw,items:s.items}]:r.blockTokens(a)},i=Ik(t,{itemPattern:/^(\s*)([-+*])\s+\[([ xX])\]\s+(.*)$/,extractItemData:a=>({indentLevel:a[1].length,mainContent:a[4],checked:a[3].toLowerCase()==="x"}),createToken:(a,s)=>({type:"taskItem",raw:"",mainContent:a.mainContent,indentLevel:a.indentLevel,checked:a.checked,text:a.mainContent,tokens:r.inlineTokens(a.mainContent),nestedTokens:s}),customNestedParser:n},r);if(i)return{type:"taskList",raw:i.raw,items:i.items}}},markdownOptions:{indentsContent:!0},addCommands(){return{toggleTaskList:()=>({commands:t})=>t.toggleList(this.name,this.options.itemTypeName)}},addKeyboardShortcuts(){return{"Mod-Shift-9":()=>this.editor.commands.toggleTaskList()}}});bi.create({name:"listKit",addExtensions(){const t=[];return this.options.bulletList!==!1&&t.push(SD.configure(this.options.bulletList)),this.options.listItem!==!1&&t.push(kD.configure(this.options.listItem)),this.options.listKeymap!==!1&&t.push(PD.configure(this.options.listKeymap)),this.options.orderedList!==!1&&t.push(AD.configure(this.options.orderedList)),this.options.taskItem!==!1&&t.push(sne.configure(this.options.taskItem)),this.options.taskList!==!1&&t.push(one.configure(this.options.taskList)),t}});var lne=Zs.create({name:"paragraph",priority:1e3,addOptions(){return{HTMLAttributes:{}}},group:"block",content:"inline*",parseHTML(){return[{tag:"p"}]},renderHTML({HTMLAttributes:t}){return["p",Vn(this.options.HTMLAttributes,t),0]},parseMarkdown:(t,e)=>{const r=t.tokens||[];return r.length===1&&r[0].type==="image"?e.parseChildren([r[0]]):e.createNode("paragraph",void 0,e.parseInline(r))},renderMarkdown:(t,e)=>!t||!Array.isArray(t.content)?"":e.renderChildren(t.content),addCommands(){return{setParagraph:()=>({commands:t})=>t.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),une=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))$/,cne=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))/g,dne=Dh.create({name:"strike",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:t=>t.includes("line-through")?{}:!1}]},renderHTML({HTMLAttributes:t}){return["s",Vn(this.options.HTMLAttributes,t),0]},markdownTokenName:"del",parseMarkdown:(t,e)=>e.applyMark("strike",e.parseInline(t.tokens||[])),renderMarkdown:(t,e)=>`~~${e.renderChildren(t)}~~`,addCommands(){return{setStrike:()=>({commands:t})=>t.setMark(this.name),toggleStrike:()=>({commands:t})=>t.toggleMark(this.name),unsetStrike:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-s":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[nm({find:une,type:this.type})]},addPasteRules(){return[Nh({find:cne,type:this.type})]}}),fne=Zs.create({name:"text",group:"inline",parseMarkdown:t=>({type:"text",text:t.text||""}),renderMarkdown:t=>t.text||""}),hne=Dh.create({name:"underline",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"u"},{style:"text-decoration",consuming:!1,getAttrs:t=>t.includes("underline")?{}:!1}]},renderHTML({HTMLAttributes:t}){return["u",Vn(this.options.HTMLAttributes,t),0]},parseMarkdown(t,e){return e.applyMark(this.name||"underline",e.parseInline(t.tokens||[]))},renderMarkdown(t,e){return`++${e.renderChildren(t)}++`},markdownTokenizer:{name:"underline",level:"inline",start(t){return t.indexOf("++")},tokenize(t,e,r){const i=/^(\+\+)([\s\S]+?)(\+\+)/.exec(t);if(!i)return;const a=i[2].trim();return{type:"underline",raw:i[0],text:a,tokens:r.inlineTokens(a)}}},addCommands(){return{setUnderline:()=>({commands:t})=>t.setMark(this.name),toggleUnderline:()=>({commands:t})=>t.toggleMark(this.name),unsetUnderline:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-u":()=>this.editor.commands.toggleUnderline(),"Mod-U":()=>this.editor.commands.toggleUnderline()}}});function pne(t={}){return new Hn({view(e){return new mne(e,t)}})}class mne{constructor(e,r){var n;this.editorView=e,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=(n=r.width)!==null&&n!==void 0?n:1,this.color=r.color===!1?void 0:r.color||"black",this.class=r.class,this.handlers=["dragover","dragend","drop","dragleave"].map(i=>{let a=s=>{this[i](s)};return e.dom.addEventListener(i,a),{name:i,handler:a}})}destroy(){this.handlers.forEach(({name:e,handler:r})=>this.editorView.dom.removeEventListener(e,r))}update(e,r){this.cursorPos!=null&&r.doc!=e.state.doc&&(this.cursorPos>e.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(e){e!=this.cursorPos&&(this.cursorPos=e,e==null?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let e=this.editorView.state.doc.resolve(this.cursorPos),r=!e.parent.inlineContent,n,i=this.editorView.dom,a=i.getBoundingClientRect(),s=a.width/i.offsetWidth,o=a.height/i.offsetHeight;if(r){let f=e.nodeBefore,p=e.nodeAfter;if(f||p){let v=this.editorView.nodeDOM(this.cursorPos-(f?f.nodeSize:0));if(v){let y=v.getBoundingClientRect(),S=f?y.bottom:y.top;f&&p&&(S=(S+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2);let w=this.width/2*o;n={left:y.left,right:y.right,top:S-w,bottom:S+w}}}}if(!n){let f=this.editorView.coordsAtPos(this.cursorPos),p=this.width/2*s;n={left:f.left-p,right:f.left+p,top:f.top,bottom:f.bottom}}let l=this.editorView.dom.offsetParent;this.element||(this.element=l.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",r),this.element.classList.toggle("prosemirror-dropcursor-inline",!r);let u,c;if(!l||l==document.body&&getComputedStyle(l).position=="static")u=-pageXOffset,c=-pageYOffset;else{let f=l.getBoundingClientRect(),p=f.width/l.offsetWidth,v=f.height/l.offsetHeight;u=f.left-l.scrollLeft*p,c=f.top-l.scrollTop*v}this.element.style.left=(n.left-u)/s+"px",this.element.style.top=(n.top-c)/o+"px",this.element.style.width=(n.right-n.left)/s+"px",this.element.style.height=(n.bottom-n.top)/o+"px"}scheduleRemoval(e){clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.setCursor(null),e)}dragover(e){if(!this.editorView.editable)return;let r=this.editorView.posAtCoords({left:e.clientX,top:e.clientY}),n=r&&r.inside>=0&&this.editorView.state.doc.nodeAt(r.inside),i=n&&n.type.spec.disableDropCursor,a=typeof i=="function"?i(this.editorView,r,e):i;if(r&&!a){let s=r.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let o=PO(this.editorView.state.doc,s,this.editorView.dragging.slice);o!=null&&(s=o)}this.setCursor(s),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(e){this.editorView.dom.contains(e.relatedTarget)||this.setCursor(null)}}class ri extends yr{constructor(e){super(e,e)}map(e,r){let n=e.resolve(r.map(this.head));return ri.valid(n)?new ri(n):yr.near(n)}content(){return Nt.empty}eq(e){return e instanceof ri&&e.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(e,r){if(typeof r.pos!="number")throw new RangeError("Invalid input for GapCursor.fromJSON");return new ri(e.resolve(r.pos))}getBookmark(){return new RC(this.anchor)}static valid(e){let r=e.parent;if(r.isTextblock||!gne(e)||!vne(e))return!1;let n=r.type.spec.allowGapCursor;if(n!=null)return n;let i=r.contentMatchAt(e.index()).defaultType;return i&&i.isTextblock}static findGapCursorFrom(e,r,n=!1){e:for(;;){if(!n&&ri.valid(e))return e;let i=e.pos,a=null;for(let s=e.depth;;s--){let o=e.node(s);if(r>0?e.indexAfter(s)<o.childCount:e.index(s)>0){a=o.child(r>0?e.indexAfter(s):e.index(s)-1);break}else if(s==0)return null;i+=r;let l=e.doc.resolve(i);if(ri.valid(l))return l}for(;;){let s=r>0?a.firstChild:a.lastChild;if(!s){if(a.isAtom&&!a.isText&&!Yt.isSelectable(a)){e=e.doc.resolve(i+a.nodeSize*r),n=!1;continue e}break}a=s,i+=r;let o=e.doc.resolve(i);if(ri.valid(o))return o}return null}}}ri.prototype.visible=!1;ri.findFrom=ri.findGapCursorFrom;yr.jsonID("gapcursor",ri);class RC{constructor(e){this.pos=e}map(e){return new RC(e.map(this.pos))}resolve(e){let r=e.resolve(this.pos);return ri.valid(r)?new ri(r):yr.near(r)}}function LD(t){return t.isAtom||t.spec.isolating||t.spec.createGapCursor}function gne(t){for(let e=t.depth;e>=0;e--){let r=t.index(e),n=t.node(e);if(r==0){if(n.type.spec.isolating)return!0;continue}for(let i=n.child(r-1);;i=i.lastChild){if(i.childCount==0&&!i.inlineContent||LD(i.type))return!0;if(i.inlineContent)return!1}}return!0}function vne(t){for(let e=t.depth;e>=0;e--){let r=t.indexAfter(e),n=t.node(e);if(r==n.childCount){if(n.type.spec.isolating)return!0;continue}for(let i=n.child(r);;i=i.firstChild){if(i.childCount==0&&!i.inlineContent||LD(i.type))return!0;if(i.inlineContent)return!1}}return!0}function yne(){return new Hn({props:{decorations:Sne,createSelectionBetween(t,e,r){return e.pos==r.pos&&ri.valid(r)?new ri(r):null},handleClick:bne,handleKeyDown:xne,handleDOMEvents:{beforeinput:wne}}})}const xne=M6({ArrowLeft:Iy("horiz",-1),ArrowRight:Iy("horiz",1),ArrowUp:Iy("vert",-1),ArrowDown:Iy("vert",1)});function Iy(t,e){const r=t=="vert"?e>0?"down":"up":e>0?"right":"left";return function(n,i,a){let s=n.selection,o=e>0?s.$to:s.$from,l=s.empty;if(s instanceof cr){if(!a.endOfTextblock(r)||o.depth==0)return!1;l=!1,o=n.doc.resolve(e>0?o.after():o.before())}let u=ri.findGapCursorFrom(o,e,l);return u?(i&&i(n.tr.setSelection(new ri(u))),!0):!1}}function bne(t,e,r){if(!t||!t.editable)return!1;let n=t.state.doc.resolve(e);if(!ri.valid(n))return!1;let i=t.posAtCoords({left:r.clientX,top:r.clientY});return i&&i.inside>-1&&Yt.isSelectable(t.state.doc.nodeAt(i.inside))?!1:(t.dispatch(t.state.tr.setSelection(new ri(n))),!0)}function wne(t,e){if(e.inputType!="insertCompositionText"||!(t.state.selection instanceof ri))return!1;let{$from:r}=t.state.selection,n=r.parent.contentMatchAt(r.index()).findWrapping(t.state.schema.nodes.text);if(!n)return!1;let i=rt.empty;for(let s=n.length-1;s>=0;s--)i=rt.from(n[s].createAndFill(null,i));let a=t.state.tr.replace(r.pos,r.pos,new Nt(i,0,0));return a.setSelection(cr.near(a.doc.resolve(r.pos+1))),t.dispatch(a),!1}function Sne(t){if(!(t.selection instanceof ri))return null;let e=document.createElement("div");return e.className="ProseMirror-gapcursor",Un.create(t.doc,[ns.widget(t.selection.head,e,{key:"gapcursor"})])}var v1=200,fa=function(){};fa.prototype.append=function(e){return e.length?(e=fa.from(e),!this.length&&e||e.length<v1&&this.leafAppend(e)||this.length<v1&&e.leafPrepend(this)||this.appendInner(e)):this};fa.prototype.prepend=function(e){return e.length?fa.from(e).append(this):this};fa.prototype.appendInner=function(e){return new kne(this,e)};fa.prototype.slice=function(e,r){return e===void 0&&(e=0),r===void 0&&(r=this.length),e>=r?fa.empty:this.sliceInner(Math.max(0,e),Math.min(this.length,r))};fa.prototype.get=function(e){if(!(e<0||e>=this.length))return this.getInner(e)};fa.prototype.forEach=function(e,r,n){r===void 0&&(r=0),n===void 0&&(n=this.length),r<=n?this.forEachInner(e,r,n,0):this.forEachInvertedInner(e,r,n,0)};fa.prototype.map=function(e,r,n){r===void 0&&(r=0),n===void 0&&(n=this.length);var i=[];return this.forEach(function(a,s){return i.push(e(a,s))},r,n),i};fa.from=function(e){return e instanceof fa?e:e&&e.length?new RD(e):fa.empty};var RD=(function(t){function e(n){t.call(this),this.values=n}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={length:{configurable:!0},depth:{configurable:!0}};return e.prototype.flatten=function(){return this.values},e.prototype.sliceInner=function(i,a){return i==0&&a==this.length?this:new e(this.values.slice(i,a))},e.prototype.getInner=function(i){return this.values[i]},e.prototype.forEachInner=function(i,a,s,o){for(var l=a;l<s;l++)if(i(this.values[l],o+l)===!1)return!1},e.prototype.forEachInvertedInner=function(i,a,s,o){for(var l=a-1;l>=s;l--)if(i(this.values[l],o+l)===!1)return!1},e.prototype.leafAppend=function(i){if(this.length+i.length<=v1)return new e(this.values.concat(i.flatten()))},e.prototype.leafPrepend=function(i){if(this.length+i.length<=v1)return new e(i.flatten().concat(this.values))},r.length.get=function(){return this.values.length},r.depth.get=function(){return 0},Object.defineProperties(e.prototype,r),e})(fa);fa.empty=new RD([]);var kne=(function(t){function e(r,n){t.call(this),this.left=r,this.right=n,this.length=r.length+n.length,this.depth=Math.max(r.depth,n.depth)+1}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},e.prototype.getInner=function(n){return n<this.left.length?this.left.get(n):this.right.get(n-this.left.length)},e.prototype.forEachInner=function(n,i,a,s){var o=this.left.length;if(i<o&&this.left.forEachInner(n,i,Math.min(a,o),s)===!1||a>o&&this.right.forEachInner(n,Math.max(i-o,0),Math.min(this.length,a)-o,s+o)===!1)return!1},e.prototype.forEachInvertedInner=function(n,i,a,s){var o=this.left.length;if(i>o&&this.right.forEachInvertedInner(n,i-o,Math.max(a,o)-o,s+o)===!1||a<o&&this.left.forEachInvertedInner(n,Math.min(i,o),a,s)===!1)return!1},e.prototype.sliceInner=function(n,i){if(n==0&&i==this.length)return this;var a=this.left.length;return i<=a?this.left.slice(n,i):n>=a?this.right.slice(n-a,i-a):this.left.slice(n,a).append(this.right.slice(0,i-a))},e.prototype.leafAppend=function(n){var i=this.right.leafAppend(n);if(i)return new e(this.left,i)},e.prototype.leafPrepend=function(n){var i=this.left.leafPrepend(n);if(i)return new e(i,this.right)},e.prototype.appendInner=function(n){return this.left.depth>=Math.max(this.right.depth,n.depth)+1?new e(this.left,new e(this.right,n)):new e(this,n)},e})(fa);const _ne=500;class kl{constructor(e,r){this.items=e,this.eventCount=r}popEvent(e,r){if(this.eventCount==0)return null;let n=this.items.length;for(;;n--)if(this.items.get(n-1).selection){--n;break}let i,a;r&&(i=this.remapping(n,this.items.length),a=i.maps.length);let s=e.tr,o,l,u=[],c=[];return this.items.forEach((f,p)=>{if(!f.step){i||(i=this.remapping(n,p+1),a=i.maps.length),a--,c.push(f);return}if(i){c.push(new vu(f.map));let v=f.step.map(i.slice(a)),y;v&&s.maybeStep(v).doc&&(y=s.mapping.maps[s.mapping.maps.length-1],u.push(new vu(y,void 0,void 0,u.length+c.length))),a--,y&&i.appendMap(y,a)}else s.maybeStep(f.step);if(f.selection)return o=i?f.selection.map(i.slice(a)):f.selection,l=new kl(this.items.slice(0,n).append(c.reverse().concat(u)),this.eventCount-1),!1},this.items.length,0),{remaining:l,transform:s,selection:o}}addTransform(e,r,n,i){let a=[],s=this.eventCount,o=this.items,l=!i&&o.length?o.get(o.length-1):null;for(let c=0;c<e.steps.length;c++){let f=e.steps[c].invert(e.docs[c]),p=new vu(e.mapping.maps[c],f,r),v;(v=l&&l.merge(p))&&(p=v,c?a.pop():o=o.slice(0,o.length-1)),a.push(p),r&&(s++,r=void 0),i||(l=p)}let u=s-n.depth;return u>Ene&&(o=Cne(o,u),s-=u),new kl(o.append(a),s)}remapping(e,r){let n=new Bv;return this.items.forEach((i,a)=>{let s=i.mirrorOffset!=null&&a-i.mirrorOffset>=e?n.maps.length-i.mirrorOffset:void 0;n.appendMap(i.map,s)},e,r),n}addMaps(e){return this.eventCount==0?this:new kl(this.items.append(e.map(r=>new vu(r))),this.eventCount)}rebased(e,r){if(!this.eventCount)return this;let n=[],i=Math.max(0,this.items.length-r),a=e.mapping,s=e.steps.length,o=this.eventCount;this.items.forEach(p=>{p.selection&&o--},i);let l=r;this.items.forEach(p=>{let v=a.getMirror(--l);if(v==null)return;s=Math.min(s,v);let y=a.maps[v];if(p.step){let S=e.steps[v].invert(e.docs[v]),w=p.selection&&p.selection.map(a.slice(l+1,v));w&&o++,n.push(new vu(y,S,w))}else n.push(new vu(y))},i);let u=[];for(let p=r;p<s;p++)u.push(new vu(a.maps[p]));let c=this.items.slice(0,i).append(u).append(n),f=new kl(c,o);return f.emptyItemCount()>_ne&&(f=f.compress(this.items.length-n.length)),f}emptyItemCount(){let e=0;return this.items.forEach(r=>{r.step||e++}),e}compress(e=this.items.length){let r=this.remapping(0,e),n=r.maps.length,i=[],a=0;return this.items.forEach((s,o)=>{if(o>=e)i.push(s),s.selection&&a++;else if(s.step){let l=s.step.map(r.slice(n)),u=l&&l.getMap();if(n--,u&&r.appendMap(u,n),l){let c=s.selection&&s.selection.map(r.slice(n));c&&a++;let f=new vu(u.invert(),l,c),p,v=i.length-1;(p=i.length&&i[v].merge(f))?i[v]=p:i.push(f)}}else s.map&&n--},this.items.length,0),new kl(fa.from(i.reverse()),a)}}kl.empty=new kl(fa.empty,0);function Cne(t,e){let r;return t.forEach((n,i)=>{if(n.selection&&e--==0)return r=i,!1}),t.slice(r)}class vu{constructor(e,r,n,i){this.map=e,this.step=r,this.selection=n,this.mirrorOffset=i}merge(e){if(this.step&&e.step&&!e.selection){let r=e.step.merge(this.step);if(r)return new vu(r.getMap().invert(),r,this.selection)}}}class Ad{constructor(e,r,n,i,a){this.done=e,this.undone=r,this.prevRanges=n,this.prevTime=i,this.prevComposition=a}}const Ene=20;function Tne(t,e,r,n){let i=r.getMeta(ph),a;if(i)return i.historyState;r.getMeta(Mne)&&(t=new Ad(t.done,t.undone,null,0,-1));let s=r.getMeta("appendedTransaction");if(r.steps.length==0)return t;if(s&&s.getMeta(ph))return s.getMeta(ph).redo?new Ad(t.done.addTransform(r,void 0,n,nx(e)),t.undone,nM(r.mapping.maps),t.prevTime,t.prevComposition):new Ad(t.done,t.undone.addTransform(r,void 0,n,nx(e)),null,t.prevTime,t.prevComposition);if(r.getMeta("addToHistory")!==!1&&!(s&&s.getMeta("addToHistory")===!1)){let o=r.getMeta("composition"),l=t.prevTime==0||!s&&t.prevComposition!=o&&(t.prevTime<(r.time||0)-n.newGroupDelay||!Nne(r,t.prevRanges)),u=s?TS(t.prevRanges,r.mapping):nM(r.mapping.maps);return new Ad(t.done.addTransform(r,l?e.selection.getBookmark():void 0,n,nx(e)),kl.empty,u,r.time,o??t.prevComposition)}else return(a=r.getMeta("rebased"))?new Ad(t.done.rebased(r,a),t.undone.rebased(r,a),TS(t.prevRanges,r.mapping),t.prevTime,t.prevComposition):new Ad(t.done.addMaps(r.mapping.maps),t.undone.addMaps(r.mapping.maps),TS(t.prevRanges,r.mapping),t.prevTime,t.prevComposition)}function Nne(t,e){if(!e)return!1;if(!t.docChanged)return!0;let r=!1;return t.mapping.maps[0].forEach((n,i)=>{for(let a=0;a<e.length;a+=2)n<=e[a+1]&&i>=e[a]&&(r=!0)}),r}function nM(t){let e=[];for(let r=t.length-1;r>=0&&e.length==0;r--)t[r].forEach((n,i,a,s)=>e.push(a,s));return e}function TS(t,e){if(!t)return null;let r=[];for(let n=0;n<t.length;n+=2){let i=e.map(t[n],1),a=e.map(t[n+1],-1);i<=a&&r.push(i,a)}return r}function Pne(t,e,r){let n=nx(e),i=ph.get(e).spec.config,a=(r?t.undone:t.done).popEvent(e,n);if(!a)return null;let s=a.selection.resolve(a.transform.doc),o=(r?t.done:t.undone).addTransform(a.transform,e.selection.getBookmark(),i,n),l=new Ad(r?o:a.remaining,r?a.remaining:o,null,0,-1);return a.transform.setSelection(s).setMeta(ph,{redo:r,historyState:l})}let NS=!1,iM=null;function nx(t){let e=t.plugins;if(iM!=e){NS=!1,iM=e;for(let r=0;r<e.length;r++)if(e[r].spec.historyPreserveItems){NS=!0;break}}return NS}const ph=new xi("history"),Mne=new xi("closeHistory");function Ane(t={}){return t={depth:t.depth||100,newGroupDelay:t.newGroupDelay||500},new Hn({key:ph,state:{init(){return new Ad(kl.empty,kl.empty,null,0,-1)},apply(e,r,n){return Tne(r,n,e,t)}},config:t,props:{handleDOMEvents:{beforeinput(e,r){let n=r.inputType,i=n=="historyUndo"?DD:n=="historyRedo"?ID:null;return!i||!e.editable?!1:(r.preventDefault(),i(e.state,e.dispatch))}}}})}function OD(t,e){return(r,n)=>{let i=ph.getState(r);if(!i||(t?i.undone:i.done).eventCount==0)return!1;if(n){let a=Pne(i,r,t);a&&n(e?a.scrollIntoView():a)}return!0}}const DD=OD(!1,!0),ID=OD(!0,!0);bi.create({name:"characterCount",addOptions(){return{limit:null,mode:"textSize",textCounter:t=>t.length,wordCounter:t=>t.split(" ").filter(e=>e!=="").length}},addStorage(){return{characters:()=>0,words:()=>0}},onBeforeCreate(){this.storage.characters=t=>{const e=t?.node||this.editor.state.doc;if((t?.mode||this.options.mode)==="textSize"){const n=e.textBetween(0,e.content.size,void 0," ");return this.options.textCounter(n)}return e.nodeSize},this.storage.words=t=>{const e=t?.node||this.editor.state.doc,r=e.textBetween(0,e.content.size," "," ");return this.options.wordCounter(r)}},addProseMirrorPlugins(){let t=!1;return[new Hn({key:new xi("characterCount"),appendTransaction:(e,r,n)=>{if(t)return;const i=this.options.limit;if(i==null||i===0){t=!0;return}const a=this.storage.characters({node:n.doc});if(a>i){const s=a-i,o=0,l=s;console.warn(`[CharacterCount] Initial content exceeded limit of ${i} characters. Content was automatically trimmed.`);const u=n.tr.deleteRange(o,l);return t=!0,u}t=!0},filterTransaction:(e,r)=>{const n=this.options.limit;if(!e.docChanged||n===0||n===null||n===void 0)return!0;const i=this.storage.characters({node:r.doc}),a=this.storage.characters({node:e.doc});if(a<=n||i>n&&a>n&&a<=i)return!0;if(i>n&&a>n&&a>i||!e.getMeta("paste"))return!1;const o=e.selection.$head.pos,l=a-n,u=o-l,c=o;return e.deleteRange(u,c),!(this.storage.characters({node:e.doc})>n)}})]}});var Lne=bi.create({name:"dropCursor",addOptions(){return{color:"currentColor",width:1,class:void 0}},addProseMirrorPlugins(){return[pne(this.options)]}});bi.create({name:"focus",addOptions(){return{className:"has-focus",mode:"all"}},addProseMirrorPlugins(){return[new Hn({key:new xi("focus"),props:{decorations:({doc:t,selection:e})=>{const{isEditable:r,isFocused:n}=this.editor,{anchor:i}=e,a=[];if(!r||!n)return Un.create(t,[]);let s=0;this.options.mode==="deepest"&&t.descendants((l,u)=>{if(l.isText)return;if(!(i>=u&&i<=u+l.nodeSize-1))return!1;s+=1});let o=0;return t.descendants((l,u)=>{if(l.isText||!(i>=u&&i<=u+l.nodeSize-1))return!1;if(o+=1,this.options.mode==="deepest"&&s-o>0||this.options.mode==="shallowest"&&o>1)return this.options.mode==="deepest";a.push(ns.node(u,u+l.nodeSize,{class:this.options.className}))}),Un.create(t,a)}}})]}});var Rne=bi.create({name:"gapCursor",addProseMirrorPlugins(){return[yne()]},extendNodeSchema(t){var e;const r={name:t.name,options:t.options,storage:t.storage};return{allowGapCursor:(e=rn(Ht(t,"allowGapCursor",r)))!=null?e:null}}}),One=bi.create({name:"placeholder",addOptions(){return{emptyEditorClass:"is-editor-empty",emptyNodeClass:"is-empty",placeholder:"Write something ",showOnlyWhenEditable:!0,showOnlyCurrent:!0,includeChildren:!1}},addProseMirrorPlugins(){return[new Hn({key:new xi("placeholder"),props:{decorations:({doc:t,selection:e})=>{const r=this.editor.isEditable||!this.options.showOnlyWhenEditable,{anchor:n}=e,i=[];if(!r)return null;const a=this.editor.isEmpty;return t.descendants((s,o)=>{const l=n>=o&&n<=o+s.nodeSize,u=!s.isLeaf&&ab(s);if((l||!this.options.showOnlyCurrent)&&u){const c=[this.options.emptyNodeClass];a&&c.push(this.options.emptyEditorClass);const f=ns.node(o,o+s.nodeSize,{class:c.join(" "),"data-placeholder":typeof this.options.placeholder=="function"?this.options.placeholder({editor:this.editor,node:s,pos:o,hasAnchor:l}):this.options.placeholder});i.push(f)}return this.options.includeChildren}),Un.create(t,i)}}})]}});bi.create({name:"selection",addOptions(){return{className:"selection"}},addProseMirrorPlugins(){const{editor:t,options:e}=this;return[new Hn({key:new xi("selection"),props:{decorations(r){return r.selection.empty||t.isFocused||!t.isEditable||q6(r.selection)||t.view.dragging?null:Un.create(r.doc,[ns.inline(r.selection.from,r.selection.to,{class:e.className})])}}})]}});function aM({types:t,node:e}){return e&&Array.isArray(t)&&t.includes(e.type)||e?.type===t}var Dne=bi.create({name:"trailingNode",addOptions(){return{node:void 0,notAfter:[]}},addProseMirrorPlugins(){var t;const e=new xi(this.name),r=this.options.node||((t=this.editor.schema.topNodeType.contentMatch.defaultType)==null?void 0:t.name)||"paragraph",n=Object.entries(this.editor.schema.nodes).map(([,i])=>i).filter(i=>(this.options.notAfter||[]).concat(r).includes(i.name));return[new Hn({key:e,appendTransaction:(i,a,s)=>{const{doc:o,tr:l,schema:u}=s,c=e.getState(s),f=o.content.size,p=u.nodes[r];if(c)return l.insert(f,p.create())},state:{init:(i,a)=>{const s=a.tr.doc.lastChild;return!aM({node:s,types:n})},apply:(i,a)=>{if(!i.docChanged||i.getMeta("__uniqueIDTransaction"))return a;const s=i.doc.lastChild;return!aM({node:s,types:n})}}})]}}),Ine=bi.create({name:"undoRedo",addOptions(){return{depth:100,newGroupDelay:500}},addCommands(){return{undo:()=>({state:t,dispatch:e})=>DD(t,e),redo:()=>({state:t,dispatch:e})=>ID(t,e)}},addProseMirrorPlugins(){return[Ane(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-y":()=>this.editor.commands.redo(),"Mod-":()=>this.editor.commands.undo(),"Shift-Mod-":()=>this.editor.commands.redo()}}}),jne=bi.create({name:"starterKit",addExtensions(){var t,e,r,n;const i=[];return this.options.bold!==!1&&i.push(ure.configure(this.options.bold)),this.options.blockquote!==!1&&i.push(ire.configure(this.options.blockquote)),this.options.bulletList!==!1&&i.push(SD.configure(this.options.bulletList)),this.options.code!==!1&&i.push(fre.configure(this.options.code)),this.options.codeBlock!==!1&&i.push(mre.configure(this.options.codeBlock)),this.options.document!==!1&&i.push(gre.configure(this.options.document)),this.options.dropcursor!==!1&&i.push(Lne.configure(this.options.dropcursor)),this.options.gapcursor!==!1&&i.push(Rne.configure(this.options.gapcursor)),this.options.hardBreak!==!1&&i.push(vre.configure(this.options.hardBreak)),this.options.heading!==!1&&i.push(yre.configure(this.options.heading)),this.options.undoRedo!==!1&&i.push(Ine.configure(this.options.undoRedo)),this.options.horizontalRule!==!1&&i.push(xre.configure(this.options.horizontalRule)),this.options.italic!==!1&&i.push(_re.configure(this.options.italic)),this.options.listItem!==!1&&i.push(kD.configure(this.options.listItem)),this.options.listKeymap!==!1&&i.push(PD.configure((t=this.options)==null?void 0:t.listKeymap)),this.options.link!==!1&&i.push(Zre.configure((e=this.options)==null?void 0:e.link)),this.options.orderedList!==!1&&i.push(AD.configure(this.options.orderedList)),this.options.paragraph!==!1&&i.push(lne.configure(this.options.paragraph)),this.options.strike!==!1&&i.push(dne.configure(this.options.strike)),this.options.text!==!1&&i.push(fne.configure(this.options.text)),this.options.underline!==!1&&i.push(hne.configure((r=this.options)==null?void 0:r.underline)),this.options.trailingNode!==!1&&i.push(Dne.configure((n=this.options)==null?void 0:n.trailingNode)),i}}),Fne=jne,Bne=One;function zne(t){var e;const{char:r,allowSpaces:n,allowToIncludeChar:i,allowedPrefixes:a,startOfLine:s,$position:o}=t,l=n&&!i,u=Gee(r),c=new RegExp(`\\s${u}$`),f=s?"^":"",p=i?"":u,v=l?new RegExp(`${f}${u}.*?(?=\\s${p}|$)`,"gm"):new RegExp(`${f}(?:^)?${u}[^\\s${p}]*`,"gm"),y=((e=o.nodeBefore)==null?void 0:e.isText)&&o.nodeBefore.text;if(!y)return null;const S=o.pos-y.length,w=Array.from(y.matchAll(v)).pop();if(!w||w.input===void 0||w.index===void 0)return null;const T=w.input.slice(Math.max(0,w.index-1),w.index),_=new RegExp(`^[${a?.join("")}\0]?$`).test(T);if(a!==null&&!_)return null;const C=S+w.index;let N=C+w[0].length;return l&&c.test(y.slice(N-1,N+1))&&(w[0]+=" ",N+=1),C<o.pos&&N>=o.pos?{range:{from:C,to:N},query:w[0].slice(r.length),text:w[0]}:null}var Une=new xi("suggestion");function Gne({pluginKey:t=Une,editor:e,char:r="@",allowSpaces:n=!1,allowToIncludeChar:i=!1,allowedPrefixes:a=[" "],startOfLine:s=!1,decorationTag:o="span",decorationClass:l="suggestion",decorationContent:u="",decorationEmptyClass:c="is-empty",command:f=()=>null,items:p=()=>[],render:v=()=>({}),allow:y=()=>!0,findSuggestionMatch:S=zne,shouldShow:w}){let T;const _=v?.(),C=()=>{const j=e.state.selection.$anchor.pos,D=e.view.coordsAtPos(j),{top:F,right:B,bottom:$,left:Z}=D;try{return new DOMRect(Z,F,B-Z,$-F)}catch{return null}},N=(j,D)=>D?()=>{const F=t.getState(e.state),B=F?.decorationId,$=j.dom.querySelector(`[data-decoration-id="${B}"]`);return $?.getBoundingClientRect()||null}:C;function A(j,D){var F;try{const $=t.getState(j.state),Z=$?.decorationId?j.dom.querySelector(`[data-decoration-id="${$.decorationId}"]`):null,I={editor:e,range:$?.range||{from:0,to:0},query:$?.query||null,text:$?.text||null,items:[],command:q=>f({editor:e,range:$?.range||{from:0,to:0},props:q}),decorationNode:Z,clientRect:N(j,Z)};(F=_?.onExit)==null||F.call(_,I)}catch{}const B=j.state.tr.setMeta(D,{exit:!0});j.dispatch(B)}const O=new Hn({key:t,view(){return{update:async(j,D)=>{var F,B,$,Z,I,q,U;const W=(F=this.key)==null?void 0:F.getState(D),Y=(B=this.key)==null?void 0:B.getState(j.state),Q=W.active&&Y.active&&W.range.from!==Y.range.from,ne=!W.active&&Y.active,re=W.active&&!Y.active,H=!ne&&!re&&W.query!==Y.query,te=ne||Q&&H,ie=H||Q,de=re||Q&&H;if(!te&&!ie&&!de)return;const ge=de&&!te?W:Y,ye=j.dom.querySelector(`[data-decoration-id="${ge.decorationId}"]`);T={editor:e,range:ge.range,query:ge.query,text:ge.text,items:[],command:ae=>f({editor:e,range:ge.range,props:ae}),decorationNode:ye,clientRect:N(j,ye)},te&&(($=_?.onBeforeStart)==null||$.call(_,T)),ie&&((Z=_?.onBeforeUpdate)==null||Z.call(_,T)),(ie||te)&&(T.items=await p({editor:e,query:ge.query})),de&&((I=_?.onExit)==null||I.call(_,T)),ie&&((q=_?.onUpdate)==null||q.call(_,T)),te&&((U=_?.onStart)==null||U.call(_,T))},destroy:()=>{var j;T&&((j=_?.onExit)==null||j.call(_,T))}}},state:{init(){return{active:!1,range:{from:0,to:0},query:null,text:null,composing:!1}},apply(j,D,F,B){const{isEditable:$}=e,{composing:Z}=e.view,{selection:I}=j,{empty:q,from:U}=I,W={...D},Y=j.getMeta(t);if(Y&&Y.exit)return W.active=!1,W.decorationId=null,W.range={from:0,to:0},W.query=null,W.text=null,W;if(W.composing=Z,$&&(q||e.view.composing)){(U<D.range.from||U>D.range.to)&&!Z&&!D.composing&&(W.active=!1);const Q=S({char:r,allowSpaces:n,allowToIncludeChar:i,allowedPrefixes:a,startOfLine:s,$position:I.$from}),ne=`id_${Math.floor(Math.random()*4294967295)}`;Q&&y({editor:e,state:B,range:Q.range,isActive:D.active})&&(!w||w({editor:e,range:Q.range,query:Q.query,text:Q.text,transaction:j}))?(W.active=!0,W.decorationId=D.decorationId?D.decorationId:ne,W.range=Q.range,W.query=Q.query,W.text=Q.text):W.active=!1}else W.active=!1;return W.active||(W.decorationId=null,W.range={from:0,to:0},W.query=null,W.text=null),W}},props:{handleKeyDown(j,D){var F,B,$,Z;const{active:I,range:q}=O.getState(j.state);if(!I)return!1;if(D.key==="Escape"||D.key==="Esc"){const W=O.getState(j.state),Y=(F=T?.decorationNode)!=null?F:null,Q=Y??(W?.decorationId?j.dom.querySelector(`[data-decoration-id="${W.decorationId}"]`):null);if(((B=_?.onKeyDown)==null?void 0:B.call(_,{view:j,event:D,range:W.range}))||!1)return!0;const re={editor:e,range:W.range,query:W.query,text:W.text,items:[],command:H=>f({editor:e,range:W.range,props:H}),decorationNode:Q,clientRect:Q?()=>Q.getBoundingClientRect()||null:null};return($=_?.onExit)==null||$.call(_,re),A(j,t),!0}return((Z=_?.onKeyDown)==null?void 0:Z.call(_,{view:j,event:D,range:q}))||!1},decorations(j){const{active:D,range:F,decorationId:B,query:$}=O.getState(j);if(!D)return null;const Z=!$?.length,I=[l];return Z&&I.push(c),Un.create(j.doc,[ns.inline(F.from,F.to,{nodeName:o,class:I.join(" "),"data-decoration-id":B,"data-decoration-content":u})])}}});return O}function Vne({editor:t,overrideSuggestionOptions:e,extensionName:r,char:n="@"}){const i=new xi;return{editor:t,char:n,pluginKey:i,command:({editor:a,range:s,props:o})=>{var l,u,c;const f=a.view.state.selection.$to.nodeAfter;(l=f?.text)!=null&&l.startsWith(" ")&&(s.to+=1),a.chain().focus().insertContentAt(s,[{type:r,attrs:{...o,mentionSuggestionChar:n}},{type:"text",text:" "}]).run(),(c=(u=a.view.dom.ownerDocument.defaultView)==null?void 0:u.getSelection())==null||c.collapseToEnd()},allow:({state:a,range:s})=>{const o=a.doc.resolve(s.from),l=a.schema.nodes[r];return!!o.parent.type.contentMatch.matchType(l)},...e}}function jD(t){return(t.options.suggestions.length?t.options.suggestions:[t.options.suggestion]).map(e=>Vne({editor:t.editor,overrideSuggestionOptions:e,extensionName:t.name,char:e.char}))}function sM(t,e){const r=jD(t),n=r.find(i=>i.char===e);return n||(r.length?r[0]:null)}var Hne=Zs.create({name:"mention",priority:101,addOptions(){return{HTMLAttributes:{},renderText({node:t,suggestion:e}){var r,n;return`${(r=e?.char)!=null?r:"@"}${(n=t.attrs.label)!=null?n:t.attrs.id}`},deleteTriggerWithBackspace:!1,renderHTML({options:t,node:e,suggestion:r}){var n,i;return["span",Vn(this.HTMLAttributes,t.HTMLAttributes),`${(n=r?.char)!=null?n:"@"}${(i=e.attrs.label)!=null?i:e.attrs.id}`]},suggestions:[],suggestion:{}}},group:"inline",inline:!0,selectable:!1,atom:!0,addAttributes(){return{id:{default:null,parseHTML:t=>t.getAttribute("data-id"),renderHTML:t=>t.id?{"data-id":t.id}:{}},label:{default:null,parseHTML:t=>t.getAttribute("data-label"),renderHTML:t=>t.label?{"data-label":t.label}:{}},mentionSuggestionChar:{default:"@",parseHTML:t=>t.getAttribute("data-mention-suggestion-char"),renderHTML:t=>({"data-mention-suggestion-char":t.mentionSuggestionChar})}}},parseHTML(){return[{tag:`span[data-type="${this.name}"]`}]},renderHTML({node:t,HTMLAttributes:e}){const r=sM(this,t.attrs.mentionSuggestionChar);if(this.options.renderLabel!==void 0)return console.warn("renderLabel is deprecated use renderText and renderHTML instead"),["span",Vn({"data-type":this.name},this.options.HTMLAttributes,e),this.options.renderLabel({options:this.options,node:t,suggestion:r})];const n={...this.options};n.HTMLAttributes=Vn({"data-type":this.name},this.options.HTMLAttributes,e);const i=this.options.renderHTML({options:n,node:t,suggestion:r});return typeof i=="string"?["span",Vn({"data-type":this.name},this.options.HTMLAttributes,e),i]:i},...uD({nodeName:"mention",name:"@",selfClosing:!0,allowedAttributes:["id","label",{name:"mentionSuggestionChar",skipIfDefault:"@"}],parseAttributes:t=>{const e={},r=/(\w+)=(?:"([^"]*)"|'([^']*)')/g;let n=r.exec(t);for(;n!==null;){const[,i,a,s]=n,o=a??s;e[i==="char"?"mentionSuggestionChar":i]=o,n=r.exec(t)}return e},serializeAttributes:t=>Object.entries(t).filter(([,e])=>e!=null).map(([e,r])=>`${e==="mentionSuggestionChar"?"char":e}="${r}"`).join(" ")}),renderText({node:t}){const e={options:this.options,node:t,suggestion:sM(this,t.attrs.mentionSuggestionChar)};return this.options.renderLabel!==void 0?(console.warn("renderLabel is deprecated use renderText and renderHTML instead"),this.options.renderLabel(e)):this.options.renderText(e)},addKeyboardShortcuts(){return{Backspace:()=>this.editor.commands.command(({tr:t,state:e})=>{let r=!1;const{selection:n}=e,{empty:i,anchor:a}=n;if(!i)return!1;let s=new Vo,o=0;return e.doc.nodesBetween(a-1,a,(l,u)=>{if(l.type.name===this.name)return r=!0,s=l,o=u,!1}),r&&t.insertText(this.options.deleteTriggerWithBackspace?"":s.attrs.mentionSuggestionChar,o,o+s.nodeSize),r})}},addProseMirrorPlugins(){return jD(this).map(Gne)}}),Wne=Hne,$s="top",$o="bottom",Ko="right",Ks="left",OC="auto",x0=[$s,$o,Ko,Ks],am="start",Kv="end",qne="clippingParents",FD="viewport",qg="popper",$ne="reference",oM=x0.reduce(function(t,e){return t.concat([e+"-"+am,e+"-"+Kv])},[]),BD=[].concat(x0,[OC]).reduce(function(t,e){return t.concat([e,e+"-"+am,e+"-"+Kv])},[]),Kne="beforeRead",Zne="read",Yne="afterRead",Xne="beforeMain",Qne="main",Jne="afterMain",eie="beforeWrite",tie="write",rie="afterWrite",nie=[Kne,Zne,Yne,Xne,Qne,Jne,eie,tie,rie];function Tu(t){return t?(t.nodeName||"").toLowerCase():null}function fo(t){if(t==null)return window;if(t.toString()!=="[object Window]"){var e=t.ownerDocument;return e&&e.defaultView||window}return t}function Ph(t){var e=fo(t).Element;return t instanceof e||t instanceof Element}function qo(t){var e=fo(t).HTMLElement;return t instanceof e||t instanceof HTMLElement}function DC(t){if(typeof ShadowRoot>"u")return!1;var e=fo(t).ShadowRoot;return t instanceof e||t instanceof ShadowRoot}function iie(t){var e=t.state;Object.keys(e.elements).forEach(function(r){var n=e.styles[r]||{},i=e.attributes[r]||{},a=e.elements[r];!qo(a)||!Tu(a)||(Object.assign(a.style,n),Object.keys(i).forEach(function(s){var o=i[s];o===!1?a.removeAttribute(s):a.setAttribute(s,o===!0?"":o)}))})}function aie(t){var e=t.state,r={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,r.popper),e.styles=r,e.elements.arrow&&Object.assign(e.elements.arrow.style,r.arrow),function(){Object.keys(e.elements).forEach(function(n){var i=e.elements[n],a=e.attributes[n]||{},s=Object.keys(e.styles.hasOwnProperty(n)?e.styles[n]:r[n]),o=s.reduce(function(l,u){return l[u]="",l},{});!qo(i)||!Tu(i)||(Object.assign(i.style,o),Object.keys(a).forEach(function(l){i.removeAttribute(l)}))})}}const zD={name:"applyStyles",enabled:!0,phase:"write",fn:iie,effect:aie,requires:["computeStyles"]};function ku(t){return t.split("-")[0]}var mh=Math.max,y1=Math.min,sm=Math.round;function Kk(){var t=navigator.userAgentData;return t!=null&&t.brands&&Array.isArray(t.brands)?t.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function UD(){return!/^((?!chrome|android).)*safari/i.test(Kk())}function om(t,e,r){e===void 0&&(e=!1),r===void 0&&(r=!1);var n=t.getBoundingClientRect(),i=1,a=1;e&&qo(t)&&(i=t.offsetWidth>0&&sm(n.width)/t.offsetWidth||1,a=t.offsetHeight>0&&sm(n.height)/t.offsetHeight||1);var s=Ph(t)?fo(t):window,o=s.visualViewport,l=!UD()&&r,u=(n.left+(l&&o?o.offsetLeft:0))/i,c=(n.top+(l&&o?o.offsetTop:0))/a,f=n.width/i,p=n.height/a;return{width:f,height:p,top:c,right:u+f,bottom:c+p,left:u,x:u,y:c}}function IC(t){var e=om(t),r=t.offsetWidth,n=t.offsetHeight;return Math.abs(e.width-r)<=1&&(r=e.width),Math.abs(e.height-n)<=1&&(n=e.height),{x:t.offsetLeft,y:t.offsetTop,width:r,height:n}}function GD(t,e){var r=e.getRootNode&&e.getRootNode();if(t.contains(e))return!0;if(r&&DC(r)){var n=e;do{if(n&&t.isSameNode(n))return!0;n=n.parentNode||n.host}while(n)}return!1}function bc(t){return fo(t).getComputedStyle(t)}function sie(t){return["table","td","th"].indexOf(Tu(t))>=0}function vf(t){return((Ph(t)?t.ownerDocument:t.document)||window.document).documentElement}function ub(t){return Tu(t)==="html"?t:t.assignedSlot||t.parentNode||(DC(t)?t.host:null)||vf(t)}function lM(t){return!qo(t)||bc(t).position==="fixed"?null:t.offsetParent}function oie(t){var e=/firefox/i.test(Kk()),r=/Trident/i.test(Kk());if(r&&qo(t)){var n=bc(t);if(n.position==="fixed")return null}var i=ub(t);for(DC(i)&&(i=i.host);qo(i)&&["html","body"].indexOf(Tu(i))<0;){var a=bc(i);if(a.transform!=="none"||a.perspective!=="none"||a.contain==="paint"||["transform","perspective"].indexOf(a.willChange)!==-1||e&&a.willChange==="filter"||e&&a.filter&&a.filter!=="none")return i;i=i.parentNode}return null}function b0(t){for(var e=fo(t),r=lM(t);r&&sie(r)&&bc(r).position==="static";)r=lM(r);return r&&(Tu(r)==="html"||Tu(r)==="body"&&bc(r).position==="static")?e:r||oie(t)||e}function jC(t){return["top","bottom"].indexOf(t)>=0?"x":"y"}function vv(t,e,r){return mh(t,y1(e,r))}function lie(t,e,r){var n=vv(t,e,r);return n>r?r:n}function VD(){return{top:0,right:0,bottom:0,left:0}}function HD(t){return Object.assign({},VD(),t)}function WD(t,e){return e.reduce(function(r,n){return r[n]=t,r},{})}var uie=function(e,r){return e=typeof e=="function"?e(Object.assign({},r.rects,{placement:r.placement})):e,HD(typeof e!="number"?e:WD(e,x0))};function cie(t){var e,r=t.state,n=t.name,i=t.options,a=r.elements.arrow,s=r.modifiersData.popperOffsets,o=ku(r.placement),l=jC(o),u=[Ks,Ko].indexOf(o)>=0,c=u?"height":"width";if(!(!a||!s)){var f=uie(i.padding,r),p=IC(a),v=l==="y"?$s:Ks,y=l==="y"?$o:Ko,S=r.rects.reference[c]+r.rects.reference[l]-s[l]-r.rects.popper[c],w=s[l]-r.rects.reference[l],T=b0(a),_=T?l==="y"?T.clientHeight||0:T.clientWidth||0:0,C=S/2-w/2,N=f[v],A=_-p[c]-f[y],O=_/2-p[c]/2+C,j=vv(N,O,A),D=l;r.modifiersData[n]=(e={},e[D]=j,e.centerOffset=j-O,e)}}function die(t){var e=t.state,r=t.options,n=r.element,i=n===void 0?"[data-popper-arrow]":n;i!=null&&(typeof i=="string"&&(i=e.elements.popper.querySelector(i),!i)||GD(e.elements.popper,i)&&(e.elements.arrow=i))}const fie={name:"arrow",enabled:!0,phase:"main",fn:cie,effect:die,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function lm(t){return t.split("-")[1]}var hie={top:"auto",right:"auto",bottom:"auto",left:"auto"};function pie(t,e){var r=t.x,n=t.y,i=e.devicePixelRatio||1;return{x:sm(r*i)/i||0,y:sm(n*i)/i||0}}function uM(t){var e,r=t.popper,n=t.popperRect,i=t.placement,a=t.variation,s=t.offsets,o=t.position,l=t.gpuAcceleration,u=t.adaptive,c=t.roundOffsets,f=t.isFixed,p=s.x,v=p===void 0?0:p,y=s.y,S=y===void 0?0:y,w=typeof c=="function"?c({x:v,y:S}):{x:v,y:S};v=w.x,S=w.y;var T=s.hasOwnProperty("x"),_=s.hasOwnProperty("y"),C=Ks,N=$s,A=window;if(u){var O=b0(r),j="clientHeight",D="clientWidth";if(O===fo(r)&&(O=vf(r),bc(O).position!=="static"&&o==="absolute"&&(j="scrollHeight",D="scrollWidth")),O=O,i===$s||(i===Ks||i===Ko)&&a===Kv){N=$o;var F=f&&O===A&&A.visualViewport?A.visualViewport.height:O[j];S-=F-n.height,S*=l?1:-1}if(i===Ks||(i===$s||i===$o)&&a===Kv){C=Ko;var B=f&&O===A&&A.visualViewport?A.visualViewport.width:O[D];v-=B-n.width,v*=l?1:-1}}var $=Object.assign({position:o},u&&hie),Z=c===!0?pie({x:v,y:S},fo(r)):{x:v,y:S};if(v=Z.x,S=Z.y,l){var I;return Object.assign({},$,(I={},I[N]=_?"0":"",I[C]=T?"0":"",I.transform=(A.devicePixelRatio||1)<=1?"translate("+v+"px, "+S+"px)":"translate3d("+v+"px, "+S+"px, 0)",I))}return Object.assign({},$,(e={},e[N]=_?S+"px":"",e[C]=T?v+"px":"",e.transform="",e))}function mie(t){var e=t.state,r=t.options,n=r.gpuAcceleration,i=n===void 0?!0:n,a=r.adaptive,s=a===void 0?!0:a,o=r.roundOffsets,l=o===void 0?!0:o,u={placement:ku(e.placement),variation:lm(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:i,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,uM(Object.assign({},u,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:s,roundOffsets:l})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,uM(Object.assign({},u,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:l})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}const gie={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:mie,data:{}};var jy={passive:!0};function vie(t){var e=t.state,r=t.instance,n=t.options,i=n.scroll,a=i===void 0?!0:i,s=n.resize,o=s===void 0?!0:s,l=fo(e.elements.popper),u=[].concat(e.scrollParents.reference,e.scrollParents.popper);return a&&u.forEach(function(c){c.addEventListener("scroll",r.update,jy)}),o&&l.addEventListener("resize",r.update,jy),function(){a&&u.forEach(function(c){c.removeEventListener("scroll",r.update,jy)}),o&&l.removeEventListener("resize",r.update,jy)}}const yie={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:vie,data:{}};var xie={left:"right",right:"left",bottom:"top",top:"bottom"};function ix(t){return t.replace(/left|right|bottom|top/g,function(e){return xie[e]})}var bie={start:"end",end:"start"};function cM(t){return t.replace(/start|end/g,function(e){return bie[e]})}function FC(t){var e=fo(t),r=e.pageXOffset,n=e.pageYOffset;return{scrollLeft:r,scrollTop:n}}function BC(t){return om(vf(t)).left+FC(t).scrollLeft}function wie(t,e){var r=fo(t),n=vf(t),i=r.visualViewport,a=n.clientWidth,s=n.clientHeight,o=0,l=0;if(i){a=i.width,s=i.height;var u=UD();(u||!u&&e==="fixed")&&(o=i.offsetLeft,l=i.offsetTop)}return{width:a,height:s,x:o+BC(t),y:l}}function Sie(t){var e,r=vf(t),n=FC(t),i=(e=t.ownerDocument)==null?void 0:e.body,a=mh(r.scrollWidth,r.clientWidth,i?i.scrollWidth:0,i?i.clientWidth:0),s=mh(r.scrollHeight,r.clientHeight,i?i.scrollHeight:0,i?i.clientHeight:0),o=-n.scrollLeft+BC(t),l=-n.scrollTop;return bc(i||r).direction==="rtl"&&(o+=mh(r.clientWidth,i?i.clientWidth:0)-a),{width:a,height:s,x:o,y:l}}function zC(t){var e=bc(t),r=e.overflow,n=e.overflowX,i=e.overflowY;return/auto|scroll|overlay|hidden/.test(r+i+n)}function qD(t){return["html","body","#document"].indexOf(Tu(t))>=0?t.ownerDocument.body:qo(t)&&zC(t)?t:qD(ub(t))}function yv(t,e){var r;e===void 0&&(e=[]);var n=qD(t),i=n===((r=t.ownerDocument)==null?void 0:r.body),a=fo(n),s=i?[a].concat(a.visualViewport||[],zC(n)?n:[]):n,o=e.concat(s);return i?o:o.concat(yv(ub(s)))}function Zk(t){return Object.assign({},t,{left:t.x,top:t.y,right:t.x+t.width,bottom:t.y+t.height})}function kie(t,e){var r=om(t,!1,e==="fixed");return r.top=r.top+t.clientTop,r.left=r.left+t.clientLeft,r.bottom=r.top+t.clientHeight,r.right=r.left+t.clientWidth,r.width=t.clientWidth,r.height=t.clientHeight,r.x=r.left,r.y=r.top,r}function dM(t,e,r){return e===FD?Zk(wie(t,r)):Ph(e)?kie(e,r):Zk(Sie(vf(t)))}function _ie(t){var e=yv(ub(t)),r=["absolute","fixed"].indexOf(bc(t).position)>=0,n=r&&qo(t)?b0(t):t;return Ph(n)?e.filter(function(i){return Ph(i)&&GD(i,n)&&Tu(i)!=="body"}):[]}function Cie(t,e,r,n){var i=e==="clippingParents"?_ie(t):[].concat(e),a=[].concat(i,[r]),s=a[0],o=a.reduce(function(l,u){var c=dM(t,u,n);return l.top=mh(c.top,l.top),l.right=y1(c.right,l.right),l.bottom=y1(c.bottom,l.bottom),l.left=mh(c.left,l.left),l},dM(t,s,n));return o.width=o.right-o.left,o.height=o.bottom-o.top,o.x=o.left,o.y=o.top,o}function $D(t){var e=t.reference,r=t.element,n=t.placement,i=n?ku(n):null,a=n?lm(n):null,s=e.x+e.width/2-r.width/2,o=e.y+e.height/2-r.height/2,l;switch(i){case $s:l={x:s,y:e.y-r.height};break;case $o:l={x:s,y:e.y+e.height};break;case Ko:l={x:e.x+e.width,y:o};break;case Ks:l={x:e.x-r.width,y:o};break;default:l={x:e.x,y:e.y}}var u=i?jC(i):null;if(u!=null){var c=u==="y"?"height":"width";switch(a){case am:l[u]=l[u]-(e[c]/2-r[c]/2);break;case Kv:l[u]=l[u]+(e[c]/2-r[c]/2);break}}return l}function Zv(t,e){e===void 0&&(e={});var r=e,n=r.placement,i=n===void 0?t.placement:n,a=r.strategy,s=a===void 0?t.strategy:a,o=r.boundary,l=o===void 0?qne:o,u=r.rootBoundary,c=u===void 0?FD:u,f=r.elementContext,p=f===void 0?qg:f,v=r.altBoundary,y=v===void 0?!1:v,S=r.padding,w=S===void 0?0:S,T=HD(typeof w!="number"?w:WD(w,x0)),_=p===qg?$ne:qg,C=t.rects.popper,N=t.elements[y?_:p],A=Cie(Ph(N)?N:N.contextElement||vf(t.elements.popper),l,c,s),O=om(t.elements.reference),j=$D({reference:O,element:C,placement:i}),D=Zk(Object.assign({},C,j)),F=p===qg?D:O,B={top:A.top-F.top+T.top,bottom:F.bottom-A.bottom+T.bottom,left:A.left-F.left+T.left,right:F.right-A.right+T.right},$=t.modifiersData.offset;if(p===qg&&$){var Z=$[i];Object.keys(B).forEach(function(I){var q=[Ko,$o].indexOf(I)>=0?1:-1,U=[$s,$o].indexOf(I)>=0?"y":"x";B[I]+=Z[U]*q})}return B}function Eie(t,e){e===void 0&&(e={});var r=e,n=r.placement,i=r.boundary,a=r.rootBoundary,s=r.padding,o=r.flipVariations,l=r.allowedAutoPlacements,u=l===void 0?BD:l,c=lm(n),f=c?o?oM:oM.filter(function(y){return lm(y)===c}):x0,p=f.filter(function(y){return u.indexOf(y)>=0});p.length===0&&(p=f);var v=p.reduce(function(y,S){return y[S]=Zv(t,{placement:S,boundary:i,rootBoundary:a,padding:s})[ku(S)],y},{});return Object.keys(v).sort(function(y,S){return v[y]-v[S]})}function Tie(t){if(ku(t)===OC)return[];var e=ix(t);return[cM(t),e,cM(e)]}function Nie(t){var e=t.state,r=t.options,n=t.name;if(!e.modifiersData[n]._skip){for(var i=r.mainAxis,a=i===void 0?!0:i,s=r.altAxis,o=s===void 0?!0:s,l=r.fallbackPlacements,u=r.padding,c=r.boundary,f=r.rootBoundary,p=r.altBoundary,v=r.flipVariations,y=v===void 0?!0:v,S=r.allowedAutoPlacements,w=e.options.placement,T=ku(w),_=T===w,C=l||(_||!y?[ix(w)]:Tie(w)),N=[w].concat(C).reduce(function(de,ge){return de.concat(ku(ge)===OC?Eie(e,{placement:ge,boundary:c,rootBoundary:f,padding:u,flipVariations:y,allowedAutoPlacements:S}):ge)},[]),A=e.rects.reference,O=e.rects.popper,j=new Map,D=!0,F=N[0],B=0;B<N.length;B++){var $=N[B],Z=ku($),I=lm($)===am,q=[$s,$o].indexOf(Z)>=0,U=q?"width":"height",W=Zv(e,{placement:$,boundary:c,rootBoundary:f,altBoundary:p,padding:u}),Y=q?I?Ko:Ks:I?$o:$s;A[U]>O[U]&&(Y=ix(Y));var Q=ix(Y),ne=[];if(a&&ne.push(W[Z]<=0),o&&ne.push(W[Y]<=0,W[Q]<=0),ne.every(function(de){return de})){F=$,D=!1;break}j.set($,ne)}if(D)for(var re=y?3:1,H=function(ge){var ye=N.find(function(ae){var pe=j.get(ae);if(pe)return pe.slice(0,ge).every(function(le){return le})});if(ye)return F=ye,"break"},te=re;te>0;te--){var ie=H(te);if(ie==="break")break}e.placement!==F&&(e.modifiersData[n]._skip=!0,e.placement=F,e.reset=!0)}}const Pie={name:"flip",enabled:!0,phase:"main",fn:Nie,requiresIfExists:["offset"],data:{_skip:!1}};function fM(t,e,r){return r===void 0&&(r={x:0,y:0}),{top:t.top-e.height-r.y,right:t.right-e.width+r.x,bottom:t.bottom-e.height+r.y,left:t.left-e.width-r.x}}function hM(t){return[$s,Ko,$o,Ks].some(function(e){return t[e]>=0})}function Mie(t){var e=t.state,r=t.name,n=e.rects.reference,i=e.rects.popper,a=e.modifiersData.preventOverflow,s=Zv(e,{elementContext:"reference"}),o=Zv(e,{altBoundary:!0}),l=fM(s,n),u=fM(o,i,a),c=hM(l),f=hM(u);e.modifiersData[r]={referenceClippingOffsets:l,popperEscapeOffsets:u,isReferenceHidden:c,hasPopperEscaped:f},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":c,"data-popper-escaped":f})}const Aie={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:Mie};function Lie(t,e,r){var n=ku(t),i=[Ks,$s].indexOf(n)>=0?-1:1,a=typeof r=="function"?r(Object.assign({},e,{placement:t})):r,s=a[0],o=a[1];return s=s||0,o=(o||0)*i,[Ks,Ko].indexOf(n)>=0?{x:o,y:s}:{x:s,y:o}}function Rie(t){var e=t.state,r=t.options,n=t.name,i=r.offset,a=i===void 0?[0,0]:i,s=BD.reduce(function(c,f){return c[f]=Lie(f,e.rects,a),c},{}),o=s[e.placement],l=o.x,u=o.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=l,e.modifiersData.popperOffsets.y+=u),e.modifiersData[n]=s}const Oie={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:Rie};function Die(t){var e=t.state,r=t.name;e.modifiersData[r]=$D({reference:e.rects.reference,element:e.rects.popper,placement:e.placement})}const Iie={name:"popperOffsets",enabled:!0,phase:"read",fn:Die,data:{}};function jie(t){return t==="x"?"y":"x"}function Fie(t){var e=t.state,r=t.options,n=t.name,i=r.mainAxis,a=i===void 0?!0:i,s=r.altAxis,o=s===void 0?!1:s,l=r.boundary,u=r.rootBoundary,c=r.altBoundary,f=r.padding,p=r.tether,v=p===void 0?!0:p,y=r.tetherOffset,S=y===void 0?0:y,w=Zv(e,{boundary:l,rootBoundary:u,padding:f,altBoundary:c}),T=ku(e.placement),_=lm(e.placement),C=!_,N=jC(T),A=jie(N),O=e.modifiersData.popperOffsets,j=e.rects.reference,D=e.rects.popper,F=typeof S=="function"?S(Object.assign({},e.rects,{placement:e.placement})):S,B=typeof F=="number"?{mainAxis:F,altAxis:F}:Object.assign({mainAxis:0,altAxis:0},F),$=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,Z={x:0,y:0};if(O){if(a){var I,q=N==="y"?$s:Ks,U=N==="y"?$o:Ko,W=N==="y"?"height":"width",Y=O[N],Q=Y+w[q],ne=Y-w[U],re=v?-D[W]/2:0,H=_===am?j[W]:D[W],te=_===am?-D[W]:-j[W],ie=e.elements.arrow,de=v&&ie?IC(ie):{width:0,height:0},ge=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:VD(),ye=ge[q],ae=ge[U],pe=vv(0,j[W],de[W]),le=C?j[W]/2-re-pe-ye-B.mainAxis:H-pe-ye-B.mainAxis,me=C?-j[W]/2+re+pe+ae+B.mainAxis:te+pe+ae+B.mainAxis,he=e.elements.arrow&&b0(e.elements.arrow),xe=he?N==="y"?he.clientTop||0:he.clientLeft||0:0,we=(I=$?.[N])!=null?I:0,Ge=Y+le-we-xe,qe=Y+me-we,wt=vv(v?y1(Q,Ge):Q,Y,v?mh(ne,qe):ne);O[N]=wt,Z[N]=wt-Y}if(o){var et,at=N==="x"?$s:Ks,je=N==="x"?$o:Ko,Re=O[A],nt=A==="y"?"height":"width",Ce=Re+w[at],Fe=Re-w[je],Ke=[$s,Ks].indexOf(T)!==-1,pt=(et=$?.[A])!=null?et:0,vt=Ke?Ce:Re-j[nt]-D[nt]-pt+B.altAxis,At=Ke?Re+j[nt]+D[nt]-pt-B.altAxis:Fe,Ut=v&&Ke?lie(vt,Re,At):vv(v?vt:Ce,Re,v?At:Fe);O[A]=Ut,Z[A]=Ut-Re}e.modifiersData[n]=Z}}const Bie={name:"preventOverflow",enabled:!0,phase:"main",fn:Fie,requiresIfExists:["offset"]};function zie(t){return{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}}function Uie(t){return t===fo(t)||!qo(t)?FC(t):zie(t)}function Gie(t){var e=t.getBoundingClientRect(),r=sm(e.width)/t.offsetWidth||1,n=sm(e.height)/t.offsetHeight||1;return r!==1||n!==1}function Vie(t,e,r){r===void 0&&(r=!1);var n=qo(e),i=qo(e)&&Gie(e),a=vf(e),s=om(t,i,r),o={scrollLeft:0,scrollTop:0},l={x:0,y:0};return(n||!n&&!r)&&((Tu(e)!=="body"||zC(a))&&(o=Uie(e)),qo(e)?(l=om(e,!0),l.x+=e.clientLeft,l.y+=e.clientTop):a&&(l.x=BC(a))),{x:s.left+o.scrollLeft-l.x,y:s.top+o.scrollTop-l.y,width:s.width,height:s.height}}function Hie(t){var e=new Map,r=new Set,n=[];t.forEach(function(a){e.set(a.name,a)});function i(a){r.add(a.name);var s=[].concat(a.requires||[],a.requiresIfExists||[]);s.forEach(function(o){if(!r.has(o)){var l=e.get(o);l&&i(l)}}),n.push(a)}return t.forEach(function(a){r.has(a.name)||i(a)}),n}function Wie(t){var e=Hie(t);return nie.reduce(function(r,n){return r.concat(e.filter(function(i){return i.phase===n}))},[])}function qie(t){var e;return function(){return e||(e=new Promise(function(r){Promise.resolve().then(function(){e=void 0,r(t())})})),e}}function $ie(t){var e=t.reduce(function(r,n){var i=r[n.name];return r[n.name]=i?Object.assign({},i,n,{options:Object.assign({},i.options,n.options),data:Object.assign({},i.data,n.data)}):n,r},{});return Object.keys(e).map(function(r){return e[r]})}var pM={placement:"bottom",modifiers:[],strategy:"absolute"};function mM(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return!e.some(function(n){return!(n&&typeof n.getBoundingClientRect=="function")})}function Kie(t){t===void 0&&(t={});var e=t,r=e.defaultModifiers,n=r===void 0?[]:r,i=e.defaultOptions,a=i===void 0?pM:i;return function(o,l,u){u===void 0&&(u=a);var c={placement:"bottom",orderedModifiers:[],options:Object.assign({},pM,a),modifiersData:{},elements:{reference:o,popper:l},attributes:{},styles:{}},f=[],p=!1,v={state:c,setOptions:function(T){var _=typeof T=="function"?T(c.options):T;S(),c.options=Object.assign({},a,c.options,_),c.scrollParents={reference:Ph(o)?yv(o):o.contextElement?yv(o.contextElement):[],popper:yv(l)};var C=Wie($ie([].concat(n,c.options.modifiers)));return c.orderedModifiers=C.filter(function(N){return N.enabled}),y(),v.update()},forceUpdate:function(){if(!p){var T=c.elements,_=T.reference,C=T.popper;if(mM(_,C)){c.rects={reference:Vie(_,b0(C),c.options.strategy==="fixed"),popper:IC(C)},c.reset=!1,c.placement=c.options.placement,c.orderedModifiers.forEach(function(B){return c.modifiersData[B.name]=Object.assign({},B.data)});for(var N=0;N<c.orderedModifiers.length;N++){if(c.reset===!0){c.reset=!1,N=-1;continue}var A=c.orderedModifiers[N],O=A.fn,j=A.options,D=j===void 0?{}:j,F=A.name;typeof O=="function"&&(c=O({state:c,options:D,name:F,instance:v})||c)}}}},update:qie(function(){return new Promise(function(w){v.forceUpdate(),w(c)})}),destroy:function(){S(),p=!0}};if(!mM(o,l))return v;v.setOptions(u).then(function(w){!p&&u.onFirstUpdate&&u.onFirstUpdate(w)});function y(){c.orderedModifiers.forEach(function(w){var T=w.name,_=w.options,C=_===void 0?{}:_,N=w.effect;if(typeof N=="function"){var A=N({state:c,name:T,instance:v,options:C}),O=function(){};f.push(A||O)}})}function S(){f.forEach(function(w){return w()}),f=[]}return v}}var Zie=[yie,Iie,gie,zD,Oie,Pie,Bie,fie,Aie],Yie=Kie({defaultModifiers:Zie}),Xie="tippy-box",KD="tippy-content",Qie="tippy-backdrop",ZD="tippy-arrow",YD="tippy-svg-arrow",Qf={passive:!0,capture:!0},XD=function(){return document.body};function PS(t,e,r){if(Array.isArray(t)){var n=t[e];return n??(Array.isArray(r)?r[e]:r)}return t}function UC(t,e){var r={}.toString.call(t);return r.indexOf("[object")===0&&r.indexOf(e+"]")>-1}function QD(t,e){return typeof t=="function"?t.apply(void 0,e):t}function gM(t,e){if(e===0)return t;var r;return function(n){clearTimeout(r),r=setTimeout(function(){t(n)},e)}}function Jie(t){return t.split(/\s+/).filter(Boolean)}function Op(t){return[].concat(t)}function vM(t,e){t.indexOf(e)===-1&&t.push(e)}function eae(t){return t.filter(function(e,r){return t.indexOf(e)===r})}function tae(t){return t.split("-")[0]}function x1(t){return[].slice.call(t)}function yM(t){return Object.keys(t).reduce(function(e,r){return t[r]!==void 0&&(e[r]=t[r]),e},{})}function xv(){return document.createElement("div")}function cb(t){return["Element","Fragment"].some(function(e){return UC(t,e)})}function rae(t){return UC(t,"NodeList")}function nae(t){return UC(t,"MouseEvent")}function iae(t){return!!(t&&t._tippy&&t._tippy.reference===t)}function aae(t){return cb(t)?[t]:rae(t)?x1(t):Array.isArray(t)?t:x1(document.querySelectorAll(t))}function MS(t,e){t.forEach(function(r){r&&(r.style.transitionDuration=e+"ms")})}function xM(t,e){t.forEach(function(r){r&&r.setAttribute("data-state",e)})}function sae(t){var e,r=Op(t),n=r[0];return n!=null&&(e=n.ownerDocument)!=null&&e.body?n.ownerDocument:document}function oae(t,e){var r=e.clientX,n=e.clientY;return t.every(function(i){var a=i.popperRect,s=i.popperState,o=i.props,l=o.interactiveBorder,u=tae(s.placement),c=s.modifiersData.offset;if(!c)return!0;var f=u==="bottom"?c.top.y:0,p=u==="top"?c.bottom.y:0,v=u==="right"?c.left.x:0,y=u==="left"?c.right.x:0,S=a.top-n+f>l,w=n-a.bottom-p>l,T=a.left-r+v>l,_=r-a.right-y>l;return S||w||T||_})}function AS(t,e,r){var n=e+"EventListener";["transitionend","webkitTransitionEnd"].forEach(function(i){t[n](i,r)})}function bM(t,e){for(var r=e;r;){var n;if(t.contains(r))return!0;r=r.getRootNode==null||(n=r.getRootNode())==null?void 0:n.host}return!1}var xu={isTouch:!1},wM=0;function lae(){xu.isTouch||(xu.isTouch=!0,window.performance&&document.addEventListener("mousemove",JD))}function JD(){var t=performance.now();t-wM<20&&(xu.isTouch=!1,document.removeEventListener("mousemove",JD)),wM=t}function uae(){var t=document.activeElement;if(iae(t)){var e=t._tippy;t.blur&&!e.state.isVisible&&t.blur()}}function cae(){document.addEventListener("touchstart",lae,Qf),window.addEventListener("blur",uae)}var dae=typeof window<"u"&&typeof document<"u",fae=dae?!!window.msCrypto:!1,hae={animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},pae={allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999},Cl=Object.assign({appendTo:XD,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},hae,pae),mae=Object.keys(Cl),gae=function(e){var r=Object.keys(e);r.forEach(function(n){Cl[n]=e[n]})};function e8(t){var e=t.plugins||[],r=e.reduce(function(n,i){var a=i.name,s=i.defaultValue;if(a){var o;n[a]=t[a]!==void 0?t[a]:(o=Cl[a])!=null?o:s}return n},{});return Object.assign({},t,r)}function vae(t,e){var r=e?Object.keys(e8(Object.assign({},Cl,{plugins:e}))):mae,n=r.reduce(function(i,a){var s=(t.getAttribute("data-tippy-"+a)||"").trim();if(!s)return i;if(a==="content")i[a]=s;else try{i[a]=JSON.parse(s)}catch{i[a]=s}return i},{});return n}function SM(t,e){var r=Object.assign({},e,{content:QD(e.content,[t])},e.ignoreAttributes?{}:vae(t,e.plugins));return r.aria=Object.assign({},Cl.aria,r.aria),r.aria={expanded:r.aria.expanded==="auto"?e.interactive:r.aria.expanded,content:r.aria.content==="auto"?e.interactive?null:"describedby":r.aria.content},r}var yae=function(){return"innerHTML"};function Yk(t,e){t[yae()]=e}function kM(t){var e=xv();return t===!0?e.className=ZD:(e.className=YD,cb(t)?e.appendChild(t):Yk(e,t)),e}function _M(t,e){cb(e.content)?(Yk(t,""),t.appendChild(e.content)):typeof e.content!="function"&&(e.allowHTML?Yk(t,e.content):t.textContent=e.content)}function Xk(t){var e=t.firstElementChild,r=x1(e.children);return{box:e,content:r.find(function(n){return n.classList.contains(KD)}),arrow:r.find(function(n){return n.classList.contains(ZD)||n.classList.contains(YD)}),backdrop:r.find(function(n){return n.classList.contains(Qie)})}}function t8(t){var e=xv(),r=xv();r.className=Xie,r.setAttribute("data-state","hidden"),r.setAttribute("tabindex","-1");var n=xv();n.className=KD,n.setAttribute("data-state","hidden"),_M(n,t.props),e.appendChild(r),r.appendChild(n),i(t.props,t.props);function i(a,s){var o=Xk(e),l=o.box,u=o.content,c=o.arrow;s.theme?l.setAttribute("data-theme",s.theme):l.removeAttribute("data-theme"),typeof s.animation=="string"?l.setAttribute("data-animation",s.animation):l.removeAttribute("data-animation"),s.inertia?l.setAttribute("data-inertia",""):l.removeAttribute("data-inertia"),l.style.maxWidth=typeof s.maxWidth=="number"?s.maxWidth+"px":s.maxWidth,s.role?l.setAttribute("role",s.role):l.removeAttribute("role"),(a.content!==s.content||a.allowHTML!==s.allowHTML)&&_M(u,t.props),s.arrow?c?a.arrow!==s.arrow&&(l.removeChild(c),l.appendChild(kM(s.arrow))):l.appendChild(kM(s.arrow)):c&&l.removeChild(c)}return{popper:e,onUpdate:i}}t8.$$tippy=!0;var xae=1,Fy=[],LS=[];function bae(t,e){var r=SM(t,Object.assign({},Cl,e8(yM(e)))),n,i,a,s=!1,o=!1,l=!1,u=!1,c,f,p,v=[],y=gM(Ge,r.interactiveDebounce),S,w=xae++,T=null,_=eae(r.plugins),C={isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},N={id:w,reference:t,popper:xv(),popperInstance:T,props:r,state:C,plugins:_,clearDelayTimeouts:vt,setProps:At,setContent:Ut,show:nr,hide:Ct,hideWithInteractivity:ct,enable:Ke,disable:pt,unmount:We,destroy:ce};if(!r.render)return N;var A=r.render(N),O=A.popper,j=A.onUpdate;O.setAttribute("data-tippy-root",""),O.id="tippy-"+N.id,N.popper=O,t._tippy=N,O._tippy=N;var D=_.map(function(ve){return ve.fn(N)}),F=t.hasAttribute("aria-expanded");return he(),re(),Y(),Q("onCreate",[N]),r.showOnCreate&&Ce(),O.addEventListener("mouseenter",function(){N.props.interactive&&N.state.isVisible&&N.clearDelayTimeouts()}),O.addEventListener("mouseleave",function(){N.props.interactive&&N.props.trigger.indexOf("mouseenter")>=0&&q().addEventListener("mousemove",y)}),N;function B(){var ve=N.props.touch;return Array.isArray(ve)?ve:[ve,0]}function $(){return B()[0]==="hold"}function Z(){var ve;return!!((ve=N.props.render)!=null&&ve.$$tippy)}function I(){return S||t}function q(){var ve=I().parentNode;return ve?sae(ve):document}function U(){return Xk(O)}function W(ve){return N.state.isMounted&&!N.state.isVisible||xu.isTouch||c&&c.type==="focus"?0:PS(N.props.delay,ve?0:1,Cl.delay)}function Y(ve){ve===void 0&&(ve=!1),O.style.pointerEvents=N.props.interactive&&!ve?"":"none",O.style.zIndex=""+N.props.zIndex}function Q(ve,_e,Te){if(Te===void 0&&(Te=!0),D.forEach(function(Xe){Xe[ve]&&Xe[ve].apply(Xe,_e)}),Te){var Le;(Le=N.props)[ve].apply(Le,_e)}}function ne(){var ve=N.props.aria;if(ve.content){var _e="aria-"+ve.content,Te=O.id,Le=Op(N.props.triggerTarget||t);Le.forEach(function(Xe){var He=Xe.getAttribute(_e);if(N.state.isVisible)Xe.setAttribute(_e,He?He+" "+Te:Te);else{var dt=He&&He.replace(Te,"").trim();dt?Xe.setAttribute(_e,dt):Xe.removeAttribute(_e)}})}}function re(){if(!(F||!N.props.aria.expanded)){var ve=Op(N.props.triggerTarget||t);ve.forEach(function(_e){N.props.interactive?_e.setAttribute("aria-expanded",N.state.isVisible&&_e===I()?"true":"false"):_e.removeAttribute("aria-expanded")})}}function H(){q().removeEventListener("mousemove",y),Fy=Fy.filter(function(ve){return ve!==y})}function te(ve){if(!(xu.isTouch&&(l||ve.type==="mousedown"))){var _e=ve.composedPath&&ve.composedPath()[0]||ve.target;if(!(N.props.interactive&&bM(O,_e))){if(Op(N.props.triggerTarget||t).some(function(Te){return bM(Te,_e)})){if(xu.isTouch||N.state.isVisible&&N.props.trigger.indexOf("click")>=0)return}else Q("onClickOutside",[N,ve]);N.props.hideOnClick===!0&&(N.clearDelayTimeouts(),N.hide(),o=!0,setTimeout(function(){o=!1}),N.state.isMounted||ye())}}}function ie(){l=!0}function de(){l=!1}function ge(){var ve=q();ve.addEventListener("mousedown",te,!0),ve.addEventListener("touchend",te,Qf),ve.addEventListener("touchstart",de,Qf),ve.addEventListener("touchmove",ie,Qf)}function ye(){var ve=q();ve.removeEventListener("mousedown",te,!0),ve.removeEventListener("touchend",te,Qf),ve.removeEventListener("touchstart",de,Qf),ve.removeEventListener("touchmove",ie,Qf)}function ae(ve,_e){le(ve,function(){!N.state.isVisible&&O.parentNode&&O.parentNode.contains(O)&&_e()})}function pe(ve,_e){le(ve,_e)}function le(ve,_e){var Te=U().box;function Le(Xe){Xe.target===Te&&(AS(Te,"remove",Le),_e())}if(ve===0)return _e();AS(Te,"remove",f),AS(Te,"add",Le),f=Le}function me(ve,_e,Te){Te===void 0&&(Te=!1);var Le=Op(N.props.triggerTarget||t);Le.forEach(function(Xe){Xe.addEventListener(ve,_e,Te),v.push({node:Xe,eventType:ve,handler:_e,options:Te})})}function he(){$()&&(me("touchstart",we,{passive:!0}),me("touchend",qe,{passive:!0})),Jie(N.props.trigger).forEach(function(ve){if(ve!=="manual")switch(me(ve,we),ve){case"mouseenter":me("mouseleave",qe);break;case"focus":me(fae?"focusout":"blur",wt);break;case"focusin":me("focusout",wt);break}})}function xe(){v.forEach(function(ve){var _e=ve.node,Te=ve.eventType,Le=ve.handler,Xe=ve.options;_e.removeEventListener(Te,Le,Xe)}),v=[]}function we(ve){var _e,Te=!1;if(!(!N.state.isEnabled||et(ve)||o)){var Le=((_e=c)==null?void 0:_e.type)==="focus";c=ve,S=ve.currentTarget,re(),!N.state.isVisible&&nae(ve)&&Fy.forEach(function(Xe){return Xe(ve)}),ve.type==="click"&&(N.props.trigger.indexOf("mouseenter")<0||s)&&N.props.hideOnClick!==!1&&N.state.isVisible?Te=!0:Ce(ve),ve.type==="click"&&(s=!Te),Te&&!Le&&Fe(ve)}}function Ge(ve){var _e=ve.target,Te=I().contains(_e)||O.contains(_e);if(!(ve.type==="mousemove"&&Te)){var Le=nt().concat(O).map(function(Xe){var He,dt=Xe._tippy,ft=(He=dt.popperInstance)==null?void 0:He.state;return ft?{popperRect:Xe.getBoundingClientRect(),popperState:ft,props:r}:null}).filter(Boolean);oae(Le,ve)&&(H(),Fe(ve))}}function qe(ve){var _e=et(ve)||N.props.trigger.indexOf("click")>=0&&s;if(!_e){if(N.props.interactive){N.hideWithInteractivity(ve);return}Fe(ve)}}function wt(ve){N.props.trigger.indexOf("focusin")<0&&ve.target!==I()||N.props.interactive&&ve.relatedTarget&&O.contains(ve.relatedTarget)||Fe(ve)}function et(ve){return xu.isTouch?$()!==ve.type.indexOf("touch")>=0:!1}function at(){je();var ve=N.props,_e=ve.popperOptions,Te=ve.placement,Le=ve.offset,Xe=ve.getReferenceClientRect,He=ve.moveTransition,dt=Z()?Xk(O).arrow:null,ft=Xe?{getBoundingClientRect:Xe,contextElement:Xe.contextElement||I()}:t,Pt={name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(kt){var Zt=kt.state;if(Z()){var er=U(),Ar=er.box;["placement","reference-hidden","escaped"].forEach(function(xr){xr==="placement"?Ar.setAttribute("data-placement",Zt.placement):Zt.attributes.popper["data-popper-"+xr]?Ar.setAttribute("data-"+xr,""):Ar.removeAttribute("data-"+xr)}),Zt.attributes.popper={}}}},qt=[{name:"offset",options:{offset:Le}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!He}},Pt];Z()&&dt&&qt.push({name:"arrow",options:{element:dt,padding:3}}),qt.push.apply(qt,_e?.modifiers||[]),N.popperInstance=Yie(ft,O,Object.assign({},_e,{placement:Te,onFirstUpdate:p,modifiers:qt}))}function je(){N.popperInstance&&(N.popperInstance.destroy(),N.popperInstance=null)}function Re(){var ve=N.props.appendTo,_e,Te=I();N.props.interactive&&ve===XD||ve==="parent"?_e=Te.parentNode:_e=QD(ve,[Te]),_e.contains(O)||_e.appendChild(O),N.state.isMounted=!0,at()}function nt(){return x1(O.querySelectorAll("[data-tippy-root]"))}function Ce(ve){N.clearDelayTimeouts(),ve&&Q("onTrigger",[N,ve]),ge();var _e=W(!0),Te=B(),Le=Te[0],Xe=Te[1];xu.isTouch&&Le==="hold"&&Xe&&(_e=Xe),_e?n=setTimeout(function(){N.show()},_e):N.show()}function Fe(ve){if(N.clearDelayTimeouts(),Q("onUntrigger",[N,ve]),!N.state.isVisible){ye();return}if(!(N.props.trigger.indexOf("mouseenter")>=0&&N.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(ve.type)>=0&&s)){var _e=W(!1);_e?i=setTimeout(function(){N.state.isVisible&&N.hide()},_e):a=requestAnimationFrame(function(){N.hide()})}}function Ke(){N.state.isEnabled=!0}function pt(){N.hide(),N.state.isEnabled=!1}function vt(){clearTimeout(n),clearTimeout(i),cancelAnimationFrame(a)}function At(ve){if(!N.state.isDestroyed){Q("onBeforeUpdate",[N,ve]),xe();var _e=N.props,Te=SM(t,Object.assign({},_e,yM(ve),{ignoreAttributes:!0}));N.props=Te,he(),_e.interactiveDebounce!==Te.interactiveDebounce&&(H(),y=gM(Ge,Te.interactiveDebounce)),_e.triggerTarget&&!Te.triggerTarget?Op(_e.triggerTarget).forEach(function(Le){Le.removeAttribute("aria-expanded")}):Te.triggerTarget&&t.removeAttribute("aria-expanded"),re(),Y(),j&&j(_e,Te),N.popperInstance&&(at(),nt().forEach(function(Le){requestAnimationFrame(Le._tippy.popperInstance.forceUpdate)})),Q("onAfterUpdate",[N,ve])}}function Ut(ve){N.setProps({content:ve})}function nr(){var ve=N.state.isVisible,_e=N.state.isDestroyed,Te=!N.state.isEnabled,Le=xu.isTouch&&!N.props.touch,Xe=PS(N.props.duration,0,Cl.duration);if(!(ve||_e||Te||Le)&&!I().hasAttribute("disabled")&&(Q("onShow",[N],!1),N.props.onShow(N)!==!1)){if(N.state.isVisible=!0,Z()&&(O.style.visibility="visible"),Y(),ge(),N.state.isMounted||(O.style.transition="none"),Z()){var He=U(),dt=He.box,ft=He.content;MS([dt,ft],0)}p=function(){var qt;if(!(!N.state.isVisible||u)){if(u=!0,O.offsetHeight,O.style.transition=N.props.moveTransition,Z()&&N.props.animation){var $t=U(),kt=$t.box,Zt=$t.content;MS([kt,Zt],Xe),xM([kt,Zt],"visible")}ne(),re(),vM(LS,N),(qt=N.popperInstance)==null||qt.forceUpdate(),Q("onMount",[N]),N.props.animation&&Z()&&pe(Xe,function(){N.state.isShown=!0,Q("onShown",[N])})}},Re()}}function Ct(){var ve=!N.state.isVisible,_e=N.state.isDestroyed,Te=!N.state.isEnabled,Le=PS(N.props.duration,1,Cl.duration);if(!(ve||_e||Te)&&(Q("onHide",[N],!1),N.props.onHide(N)!==!1)){if(N.state.isVisible=!1,N.state.isShown=!1,u=!1,s=!1,Z()&&(O.style.visibility="hidden"),H(),ye(),Y(!0),Z()){var Xe=U(),He=Xe.box,dt=Xe.content;N.props.animation&&(MS([He,dt],Le),xM([He,dt],"hidden"))}ne(),re(),N.props.animation?Z()&&ae(Le,N.unmount):N.unmount()}}function ct(ve){q().addEventListener("mousemove",y),vM(Fy,y),y(ve)}function We(){N.state.isVisible&&N.hide(),N.state.isMounted&&(je(),nt().forEach(function(ve){ve._tippy.unmount()}),O.parentNode&&O.parentNode.removeChild(O),LS=LS.filter(function(ve){return ve!==N}),N.state.isMounted=!1,Q("onHidden",[N]))}function ce(){N.state.isDestroyed||(N.clearDelayTimeouts(),N.unmount(),xe(),delete t._tippy,N.state.isDestroyed=!0,Q("onDestroy",[N]))}}function w0(t,e){e===void 0&&(e={});var r=Cl.plugins.concat(e.plugins||[]);cae();var n=Object.assign({},e,{plugins:r}),i=aae(t),a=i.reduce(function(s,o){var l=o&&bae(o,n);return l&&s.push(l),s},[]);return cb(t)?a[0]:a}w0.defaultProps=Cl;w0.setDefaultProps=gae;w0.currentInput=xu;Object.assign({},zD,{effect:function(e){var r=e.state,n={popper:{position:r.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(r.elements.popper.style,n.popper),r.styles=n,r.elements.arrow&&Object.assign(r.elements.arrow.style,n.arrow)}});w0.setDefaultProps({render:t8});const wae=se.forwardRef((t,e)=>{const[r,n]=se.useState(0),i=l=>{const u=t.items[l];u&&t.command({id:u.id,label:u.label})},a=()=>{n((r+t.items.length-1)%t.items.length)},s=()=>{n((r+1)%t.items.length)},o=()=>{i(r)};return se.useEffect(()=>n(0),[t.items]),se.useImperativeHandle(e,()=>({onKeyDown:({event:l})=>l.key==="ArrowUp"?(a(),!0):l.key==="ArrowDown"?(s(),!0):l.key==="Enter"?(o(),!0):!1})),m.jsx("div",{className:"items bg-white border border-slate-200 rounded-xl shadow-2xl overflow-hidden min-w-[200px] p-2 animate-in zoom-in-95 duration-200",children:t.items.length?t.items.map((l,u)=>m.jsxs("button",{className:`flex w-full items-center text-xs px-4 py-2.5 rounded-lg outline-none text-left transition-all ${u===r?"bg-primary text-white shadow-lg":"text-slate-700 hover:bg-slate-50"}`,onClick:()=>i(u),children:[m.jsx("span",{className:"material-symbols-outlined text-[14px] mr-2 opacity-50",children:"auto_stories"}),m.jsx("span",{className:"font-serif font-bold",children:l.label})]},u)):m.jsx("div",{className:"item text-sm px-2 py-1.5 text-muted-foreground",children:"No result"})})}),Sae={items:async({query:t})=>{try{return(await Qe.get("/world-bible/entities")).filter(r=>r.nombre.toLowerCase().startsWith(t.toLowerCase())).slice(0,5).map(r=>({id:r.id,label:r.nombre}))}catch(e){return console.error(e),[]}},render:()=>{let t,e;return{onStart:r=>{t=new rre(wae,{props:r,editor:r.editor}),r.clientRect&&(e=w0("body",{getReferenceClientRect:r.clientRect,appendTo:()=>document.body,content:t.element,showOnCreate:!0,interactive:!0,trigger:"manual",placement:"bottom-start"}))},onUpdate(r){t.updateProps(r),r.clientRect&&e[0].setProps({getReferenceClientRect:r.clientRect})},onKeyDown(r){return r.event.key==="Escape"?(e[0].hide(),!0):t.ref?.onKeyDown(r)},onExit(){e[0].destroy(),t.destroy()}}}},kae=({content:t,onUpdate:e,editable:r=!0,paperMode:n=!1})=>{const[i,a]=sr.useState({font:"Cormorant Garamond",fontSize:18});sr.useEffect(()=>{const o=localStorage.getItem("app_settings");o&&a(JSON.parse(o))},[]);const s=Zte({extensions:[Fne,Bne.configure({placeholder:"Escribe tu historia aqu... Usa @ para mencionar entidades."}),Wne.configure({HTMLAttributes:{class:"mention"},suggestion:Sae})],content:t,editable:r,onUpdate:({editor:o})=>{e(o.getHTML())},editorProps:{attributes:{class:`prose ${n?"prose-slate":"prose-invert"} max-w-none focus:outline-none min-h-[300px] p-8 ${n?"text-slate-900":"text-foreground/90"} leading-relaxed text-lg transition-all`,style:`font-family: "${i.font}", serif; font-size: ${i.fontSize}px;`}}});return se.useEffect(()=>{s&&t!==s.getHTML()&&s.commands.setContent(t)},[t,s]),s?m.jsx("div",{className:`zen-editor-container w-full h-full overflow-y-auto no-scrollbar ${n?"bg-transparent border-none shadow-none":"bg-card/20 rounded-lg border border-border/50"}`,children:m.jsx(Gte,{editor:s,className:"h-full"})}):null},_ae=()=>{const{notebookId:t}=Vi(),e=za(),{setRightPanelMode:r,setRightOpen:n,setRightPanelTitle:i}=Ll(),{t:a}=Sc(),[s,o]=se.useState(null),[l,u]=se.useState([]),[c,f]=se.useState(0),[p,v]=se.useState(!1),[y,S]=se.useState(!0),w=se.useRef(null),T=se.useRef(l),_=se.useRef(c),C=se.useRef(!0);se.useEffect(()=>{T.current=l},[l]),se.useEffect(()=>{_.current=c},[c]);const[N,A]=se.useState(null),[O,j]=se.useState("index");se.useEffect(()=>{r("CUSTOM"),n(!0),i(a("writing.tools")),t&&D(t)},[t]),se.useEffect(()=>{const W=setInterval(()=>{const Y=document.getElementById("architect-right-panel-portal");Y&&(A(Y),clearInterval(W))},100);return()=>clearInterval(W)},[]),se.useEffect(()=>{C.current=!0;const W=Y=>{w.current&&(Y.preventDefault(),Y.returnValue="")};return window.addEventListener("beforeunload",W),()=>{if(C.current=!1,window.removeEventListener("beforeunload",W),w.current){clearTimeout(w.current);const Y=T.current[_.current];Y&&(console.log("Saving on unmount (keepalive):",Y.id),Qe.request(`/escritura/hoja/${Y.id}`,{method:"PUT",body:JSON.stringify({contenido:Y.contenido}),keepalive:!0}).catch(Q=>console.error("Error preventing data loss:",Q)))}}},[]);const D=async W=>{try{S(!0);const Y=await Qe.get(`/escritura/cuaderno/${W}`);o(Y);const Q=await Qe.get(`/escritura/cuaderno/${W}/hojas`);if(Q&&Q.length>0)u(Q),f(0);else{const ne=await Qe.post(`/escritura/cuaderno/${W}/hoja`,{});u([ne]),f(0)}}catch(Y){console.error("Error loading notebook/pages:",Y),e(-1)}finally{S(!1)}},F=W=>{if(!l[c])return;const Y=[...l];Y[c].contenido=W,u(Y),w.current&&clearTimeout(w.current),w.current=setTimeout(()=>{B(Y[c])},800)},B=async W=>{C.current&&v(!0);try{await Qe.put(`/escritura/hoja/${W.id}`,{contenido:W.contenido})}catch(Y){console.error("Error saving page:",Y)}finally{C.current&&v(!1)}},$=async()=>{if(s)try{const W=await Qe.post(`/escritura/cuaderno/${s.id}/hoja`,{});u([...l,W]),f(l.length)}catch(W){console.error("Error creating page:",W)}},Z=W=>{f(W)},I=async(W,Y,Q)=>{if(W.stopPropagation(),l.length<=1){alert(a("writing.one_page_error"));return}if(window.confirm(a("writing.delete_page_confirm")))try{await Qe.delete(`/escritura/hoja/${Y}`);const ne=l.filter(re=>re.id!==Y);u(ne),c===Q?f(Math.max(0,Q-1)):c>Q&&f(c-1)}catch(ne){console.error("Error deleting page:",ne)}},q=()=>m.jsxs("div",{className:"flex flex-col h-full bg-surface-dark/95",children:[m.jsxs("div",{className:"p-4 border-b border-white/5 flex items-center justify-between bg-black/40",children:[m.jsxs("button",{onClick:()=>e(`/${Vi().username}/${Vi().projectName}/writing`),className:"flex items-center gap-2 text-slate-400 hover:text-white transition-colors",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"arrow_back"}),m.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest",children:a("nav.writing")})]}),m.jsx("div",{className:`w-2 h-2 rounded-full ${p?"bg-amber-500 animate-pulse":"bg-emerald-500/50"}`,title:a(p?"common.saving":"common.saved")})]}),m.jsxs("div",{className:"flex p-2 gap-2 border-b border-white/5 bg-black/20",children:[m.jsx("button",{onClick:()=>j("index"),className:`flex-1 py-2 rounded-xl text-[10px] font-black uppercase tracking-widest transition-all ${O==="index"?"bg-primary text-white shadow-lg":"text-slate-500 hover:text-white"}`,children:a("writing.index")}),m.jsx("button",{onClick:()=>j("format"),className:`flex-1 py-2 rounded-xl text-[10px] font-black uppercase tracking-widest transition-all ${O==="format"?"bg-primary text-white shadow-lg":"text-slate-500 hover:text-white"}`,children:a("writing.format")})]}),m.jsx("div",{className:"flex-1 overflow-hidden",children:O==="index"?m.jsxs("div",{className:"flex flex-col h-full",children:[m.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-2 custom-scrollbar",children:l.map((W,Y)=>m.jsxs("div",{className:"group relative",children:[m.jsxs("button",{onClick:()=>Z(Y),className:`w-full text-left p-4 rounded-2xl border transition-all ${Y===c?"bg-primary/10 border-primary/30 text-primary":"bg-white/5 border-transparent hover:bg-white/10 text-slate-400"}`,children:[m.jsxs("div",{className:"flex justify-between items-center mb-1",children:[m.jsxs("span",{className:"font-serif font-bold text-sm truncate",children:[a("writing.page")," ",Y+1]}),Y===c&&m.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-primary shrink-0 ml-2"})]}),m.jsx("p",{className:"text-[10px] line-clamp-2 opacity-50 font-mono break-words leading-relaxed",children:W.contenido?.replace(/<[^>]+>/g,"").substring(0,40)||a("writing.empty")})]}),m.jsx("button",{onClick:Q=>I(Q,W.id,Y),className:"absolute top-2 right-2 p-1.5 rounded-lg text-slate-600 hover:text-red-400 hover:bg-red-400/10 transition-all opacity-0 group-hover:opacity-100",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})})]},W.id))}),m.jsx("div",{className:"p-4 bg-black/20 border-t border-white/5",children:m.jsxs("button",{onClick:$,className:"w-full py-3 bg-primary text-white rounded-2xl text-[10px] font-black uppercase tracking-widest flex items-center justify-center gap-2 transition-all hover:scale-[1.02] shadow-xl shadow-primary/20",children:[m.jsx("span",{className:"material-symbols-outlined text-base",children:"add"}),m.jsx("span",{children:a("writing.new_page")})]})})]}):m.jsx("div",{className:"p-6 space-y-8 animate-in fade-in slide-in-from-right-4",children:m.jsxs("div",{className:"space-y-4",children:[m.jsxs("h3",{className:"text-[10px] font-black uppercase tracking-widest text-slate-500 flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"format_size"})," ",a("writing.typography")]}),m.jsx("div",{className:"grid grid-cols-1 gap-2",children:m.jsx("p",{className:"text-[9px] text-slate-600 uppercase font-bold italic",children:a("writing.typography_desc")})})]})})})]}),U=l[c];return y?m.jsx("div",{className:"flex-1 flex items-center justify-center bg-background-dark",children:m.jsx("div",{className:"animate-pulse text-slate-500 font-serif text-2xl italic tracking-widest",children:a("writing.opening_chronicle")})}):m.jsxs("div",{className:"flex-1 flex w-full h-full bg-background-dark relative overflow-hidden font-sans",children:[N&&Al.createPortal(q(),N),m.jsx("div",{className:"flex-1 flex flex-col relative z-10 overflow-hidden",children:m.jsx("main",{className:"flex-1 overflow-y-auto custom-scrollbar flex justify-center bg-transparent relative no-scrollbar",children:U&&m.jsx("div",{className:"w-full min-h-full flex flex-col animate-in slide-in-from-bottom-8 duration-700",children:m.jsxs("div",{className:"flex-1 bg-white overflow-hidden flex flex-col transition-all duration-500 group",children:[m.jsx("div",{className:"h-24 flex items-end px-16 pb-4 border-b border-slate-50",children:m.jsx("input",{type:"text",className:"w-full bg-transparent text-4xl font-serif font-black text-slate-800 placeholder:text-slate-100 border-none outline-none",defaultValue:`${a("writing.chapter")} ${c+1}`,placeholder:a("writing.title_placeholder")})}),m.jsx("div",{className:"flex-1 px-16 py-12 text-slate-900",children:m.jsx(kae,{content:U.contenido,onUpdate:F,paperMode:!0})}),m.jsxs("footer",{className:"h-16 border-t border-slate-100 flex items-center justify-between px-16 text-[10px] font-mono text-slate-400 select-none",children:[m.jsxs("span",{children:[a("writing.page").toUpperCase()," ",c+1," ",a("writing.of")," ",l.length]}),m.jsx("span",{className:"opacity-0 group-hover:opacity-100 transition-opacity uppercase font-black tracking-widest",children:s?.titulo||a("common.no_results")})]})]})})})})]})},Cae=()=>{const{username:t,projectName:e}=Vi(),r=za(),{t:n}=Sc(),{setRightPanelMode:i,setRightOpen:a,setRightPanelTitle:s}=Ll(),[o,l]=se.useState([]),[u,c]=se.useState(!0),[f,p]=se.useState(!1),[v,y]=se.useState("");se.useEffect(()=>{i("NOTES"),a(!1),s(n("writing.library")),S()},[]);const S=async()=>{try{c(!0);const _=await Qe.get("/escritura/cuadernos");l(_||[])}catch(_){console.error("Error loading notebooks:",_)}finally{c(!1)}},w=async _=>{_.preventDefault();try{const C=await Qe.post("/escritura/cuaderno",{titulo:v||n("writing.new_notebook")});l([...o,C]),p(!1),y(""),r(`/${t}/${e}/writing/${C.id}`)}catch(C){console.error("Error creating notebook:",C)}},T=async(_,C)=>{if(_.stopPropagation(),!!window.confirm(n("writing.delete_confirm")))try{await Qe.delete(`/escritura/cuaderno/${C}`),l(o.filter(N=>N.id!==C))}catch(N){console.error("Error deleting notebook:",N)}};return u?m.jsx("div",{className:"flex-1 flex items-center justify-center bg-background-dark",children:m.jsx("div",{className:"animate-spin text-primary material-symbols-outlined text-4xl",children:"sync"})}):m.jsxs("div",{className:"flex-1 flex flex-col bg-background-dark overflow-y-auto no-scrollbar p-12",children:[m.jsxs("header",{className:"mb-12 flex justify-between items-end",children:[m.jsxs("div",{children:[m.jsx("h1",{className:"text-4xl font-serif font-bold text-white mb-2",children:n("writing.library")}),m.jsx("p",{className:"text-slate-500 uppercase text-[10px] font-black tracking-[0.2em]",children:n("writing.library_desc")})]}),m.jsx("button",{onClick:()=>p(!0),className:"group relative px-6 py-3 bg-primary/10 hover:bg-primary/20 border border-primary/30 rounded-2xl transition-all overflow-hidden",children:m.jsxs("div",{className:"flex items-center gap-2 text-primary",children:[m.jsx("span",{className:"material-symbols-outlined text-sm transition-transform group-hover:rotate-90",children:"add"}),m.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest",children:n("writing.new_notebook")})]})})]}),m.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:o.map(_=>m.jsxs("div",{onClick:()=>r(`/${t}/${e}/writing/${_.id}`),className:"group relative h-64 bg-surface-dark border border-white/5 rounded-3xl p-6 cursor-pointer hover:border-primary/50 hover:bg-white/[0.02] transition-all hover:-translate-y-2 flex flex-col justify-between overflow-hidden shadow-2xl",children:[m.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-1.5 bg-primary/40 group-hover:bg-primary transition-colors"}),m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{className:"flex justify-between items-start",children:[m.jsx("div",{className:"size-10 rounded-xl bg-primary/10 flex items-center justify-center text-primary group-hover:scale-110 transition-transform",children:m.jsx("span",{className:"material-symbols-outlined",children:"folder_open"})}),m.jsx("button",{onClick:C=>T(C,_.id),className:"p-1.5 rounded-lg text-slate-600 hover:text-red-400 hover:bg-red-400/10 transition-all opacity-0 group-hover:opacity-100",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})})]}),m.jsxs("div",{children:[m.jsx("h3",{className:"text-xl font-serif font-bold text-slate-100 group-hover:text-primary transition-colors line-clamp-2",children:_.titulo||n("common.no_results")}),m.jsxs("p",{className:"text-[10px] text-slate-500 font-mono mt-1",children:["ID: #",_.id]})]})]}),m.jsxs("div",{className:"flex items-center gap-2 pt-4 border-t border-white/5 opacity-50 group-hover:opacity-100 transition-opacity",children:[m.jsx("span",{className:"material-symbols-outlined text-sm text-primary",children:"auto_stories"}),m.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest text-slate-400",children:n("writing.open_archivador")})]})]},_.id))}),f&&m.jsx("div",{className:"fixed inset-0 z-[100] bg-black/80 backdrop-blur-sm flex items-center justify-center p-4",children:m.jsxs("div",{className:"bg-surface-dark border border-white/10 rounded-[2rem] p-10 w-full max-w-lg shadow-2xl animate-in zoom-in-95 duration-300",children:[m.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[m.jsx("div",{className:"size-12 rounded-2xl bg-primary flex items-center justify-center text-white shadow-xl shadow-primary/30",children:m.jsx("span",{className:"material-symbols-outlined",children:"create_new_folder"})}),m.jsxs("div",{children:[m.jsx("h2",{className:"text-2xl font-serif font-bold text-white",children:"New Archivador"}),m.jsx("p",{className:"text-[10px] text-slate-500 uppercase font-black tracking-widest",children:"Library Expansion"})]})]}),m.jsxs("form",{onSubmit:w,className:"space-y-6",children:[m.jsxs("div",{className:"space-y-2",children:[m.jsx("label",{className:"text-[10px] uppercase font-black text-slate-500 tracking-[0.2em] ml-2",children:"Book Title"}),m.jsx("input",{autoFocus:!0,className:"w-full bg-white/5 border border-white/10 rounded-2xl px-6 py-4 text-white focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all placeholder:text-slate-700",placeholder:"The Chronicles of Void...",value:v,onChange:_=>y(_.target.value),required:!0})]}),m.jsxs("div",{className:"flex gap-4 pt-4",children:[m.jsx("button",{type:"button",onClick:()=>p(!1),className:"flex-1 py-4 text-slate-400 hover:text-white font-black uppercase text-[10px] tracking-widest transition-colors",children:"Cancel"}),m.jsx("button",{type:"submit",className:"flex-[2] py-4 bg-primary hover:bg-primary-dark text-white rounded-2xl font-black uppercase text-[10px] tracking-widest shadow-xl shadow-primary/20 hover:scale-[1.02] active:scale-95 transition-all",children:"Create and Open"})]})]})]})})]})};function Eae(){const{id:t}=Vi();za();const[e,r]=se.useState([]),[n,i]=se.useState(!0),[a,s]=se.useState(null);se.useEffect(()=>{o()},[t]);const o=async()=>{try{i(!0);const c=await Qe.get("/api/papelera/items");r(c),s(null)}catch(c){console.error("Error loading trash:",c),s("Failed to load trash items.")}finally{i(!1)}},l=async(c,f)=>{try{await Qe.post(`/api/papelera/restaurar/${c}/${f}`),o()}catch(p){console.error("Restoration failed",p)}},u=async(c,f)=>{if(window.confirm("Are you sure you want to PERMANENTLY delete this item? This cannot be undone."))try{await Qe.delete(`/api/papelera/eliminar/${c}/${f}`),o()}catch(p){console.error("Deletion failed",p)}};return n?m.jsx("div",{className:"text-white p-8",children:"Loading Trash Bin..."}):m.jsxs("div",{className:"flex flex-col h-full bg-[#09090b] text-white p-8 overflow-y-auto",children:[m.jsx("h1",{className:"text-3xl font-light mb-2 text-white/90",children:"Trash Bin"}),m.jsx("p",{className:"text-white/50 mb-8 font-light text-sm",children:"Items are automatically deleted after 30 days."}),a&&m.jsx("div",{className:"bg-red-500/10 border border-red-500/20 text-red-400 p-4 rounded mb-6",children:a}),e.length===0?m.jsxs("div",{className:"flex flex-col items-center justify-center py-20 opacity-50 border border-dashed border-white/10 rounded-xl",children:[m.jsx("span",{className:"material-symbols-outlined text-4xl mb-2",children:"delete_outline"}),m.jsx("p",{children:"Trash is empty"})]}):m.jsx("div",{className:"bg-zinc-900/50 rounded-xl border border-white/5 overflow-hidden",children:m.jsxs("table",{className:"w-full text-left border-collapse",children:[m.jsx("thead",{children:m.jsxs("tr",{className:"border-b border-white/5 text-xs text-white/40 uppercase tracking-wider",children:[m.jsx("th",{className:"p-4 font-normal",children:"Name"}),m.jsx("th",{className:"p-4 font-normal",children:"Type"}),m.jsx("th",{className:"p-4 font-normal",children:"Deleted Date"}),m.jsx("th",{className:"p-4 font-normal text-right",children:"Actions"})]})}),m.jsx("tbody",{className:"divide-y divide-white/5",children:e.map(c=>m.jsxs("tr",{className:"hover:bg-white/5 transition-colors",children:[m.jsx("td",{className:"p-4 text-white/80 font-medium",children:c.nombre||"Untitled"}),m.jsx("td",{className:"p-4 text-white/50 text-sm",children:c.tipo}),m.jsx("td",{className:"p-4 text-white/50 text-sm font-mono",children:c.deleted_date?new Date(c.deleted_date).toLocaleDateString():"-"}),m.jsxs("td",{className:"p-4 text-right space-x-2",children:[m.jsx("button",{onClick:()=>l(c.tipo,c.id),className:"px-3 py-1.5 text-xs bg-emerald-500/10 text-emerald-400 hover:bg-emerald-500/20 rounded-md transition-colors border border-emerald-500/20",children:"RESTORE"}),m.jsx("button",{onClick:()=>u(c.tipo,c.id),className:"px-3 py-1.5 text-xs bg-red-500/10 text-red-400 hover:bg-red-500/20 rounded-md transition-colors border border-red-500/20",children:"DELETE"})]})]},`${c.tipo}-${c.id}`))})]})})]})}const Tae=({attribute:t,value:e,onChange:r,onRemove:n,linkableEntities:i=[]})=>{const a=t.plantilla||t,s=()=>{switch(a.tipo){case"text":return m.jsx("textarea",{className:"w-full bg-transparent text-white text-sm font-medium focus:outline-none resize-none no-scrollbar h-auto min-h-[100px]",value:e||"",onChange:p=>r(p.target.value),placeholder:"..."});case"short_text":return m.jsx("input",{type:"text",className:"w-full bg-transparent text-white text-sm font-medium focus:outline-none",value:e||"",onChange:p=>r(p.target.value),placeholder:"..."});case"number":return m.jsx("input",{type:"number",className:"w-full bg-transparent text-white text-sm font-medium focus:outline-none",value:e||"",onChange:p=>r(p.target.value)});case"boolean":return m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsx("button",{onClick:()=>r(e==="true"?"false":"true"),className:`size-6 rounded-lg border flex items-center justify-center transition-all ${e==="true"?"bg-primary border-primary text-white":"border-glass-border text-transparent hover:border-primary/50"}`,children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"check"})}),m.jsx("span",{className:"text-xs text-text-muted",children:e==="true"?"Enabled":"Disabled"})]});case"select":let o=[];try{o=(typeof a.metadata=="string"?JSON.parse(a.metadata||"{}"):a.metadata||{}).options||[]}catch{}return m.jsxs("div",{className:"relative",children:[m.jsxs("select",{className:"w-full bg-black/30 border border-white/5 rounded-xl px-4 py-2.5 text-sm text-white focus:outline-none focus:border-primary/50 appearance-none cursor-pointer",value:e||"",onChange:p=>r(p.target.value),children:[m.jsx("option",{value:"",children:"Select an option..."}),o.map((p,v)=>m.jsx("option",{value:p,className:"bg-surface-dark text-white p-2",children:p},v))]}),m.jsx("div",{className:"absolute right-4 top-1/2 -translate-y-1/2 pointer-events-none text-white/50",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"unfold_more"})})]});case"multi_select":let l=[];try{l=(typeof a.metadata=="string"?JSON.parse(a.metadata||"{}"):a.metadata||{}).options||[]}catch{}let u=[];try{u=e?JSON.parse(e):[],Array.isArray(u)||(u=[])}catch(p){console.error("Error parsing select values",p)}const c=p=>{const v=u.includes(p)?u.filter(y=>y!==p):[...u,p];r(JSON.stringify(v))};return m.jsxs("div",{className:"bg-black/20 border border-white/5 rounded-xl p-2 space-y-1 max-h-40 overflow-y-auto custom-scrollbar",children:[l.map((p,v)=>m.jsxs("label",{onClick:y=>{y.preventDefault(),c(p)},className:"flex items-center gap-3 p-2 hover:bg-white/5 rounded-lg cursor-pointer group transition-colors",children:[m.jsx("div",{className:`size-4 rounded border flex items-center justify-center transition-all ${u.includes(p)?"bg-primary border-primary":"border-white/10 group-hover:border-white/30"}`,children:u.includes(p)&&m.jsx("span",{className:"material-symbols-outlined text-[10px] text-white",children:"check"})}),m.jsx("span",{className:`text-xs font-medium ${u.includes(p)?"text-white":"text-slate-400 group-hover:text-slate-200"}`,children:p})]},v)),l.length===0&&m.jsx("div",{className:"text-xs text-slate-500 p-2 italic",children:"No options defined."})]});case"date":return m.jsx("input",{type:"date",className:"w-full bg-transparent text-white text-sm font-medium focus:outline-none [color-scheme:dark]",value:e||"",onChange:p=>r(p.target.value)});case"entity_link":return m.jsxs("div",{className:"relative",children:[m.jsxs("select",{className:"w-full bg-black/30 border border-white/5 rounded-xl px-4 py-2.5 text-sm text-white focus:outline-none focus:border-primary/50 appearance-none cursor-pointer",value:e||"",onChange:p=>r(p.target.value),children:[m.jsx("option",{value:"",children:"Select an Entity Link..."}),i.map(p=>m.jsx("option",{value:p.id,className:"bg-surface-dark text-white p-2",children:p.nombre},p.id))]}),m.jsx("div",{className:"absolute right-4 top-1/2 -translate-y-1/2 pointer-events-none text-white/50",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"link"})})]});case"image":return m.jsxs("div",{className:"space-y-2",children:[m.jsx("div",{className:"flex gap-2",children:m.jsx("input",{type:"text",className:"flex-1 bg-black/30 border border-white/5 rounded-xl px-4 py-2 text-xs text-text-muted focus:text-white focus:outline-none",placeholder:"Image URL...",value:e||"",onChange:p=>r(p.target.value)})}),e&&m.jsx("div",{className:"w-full aspect-video rounded-xl bg-black/40 border border-white/5 overflow-hidden relative group",children:m.jsx("img",{src:e,alt:"Preview",className:"w-full h-full object-cover opacity-80 group-hover:opacity-100 transition-opacity"})}),!e&&m.jsx("div",{className:"w-full h-20 rounded-xl bg-white/5 border border-dashed border-white/10 flex items-center justify-center text-text-muted/30",children:m.jsx("span",{className:"material-symbols-outlined",children:"image"})})]});case"table":const f=e||"[]";return m.jsxs("div",{className:"space-y-2",children:[m.jsx("textarea",{className:"w-full h-32 bg-black/30 border border-white/5 rounded-xl p-3 text-xs font-mono text-white/70 focus:outline-none focus:border-primary/50",value:f,onChange:p=>r(p.target.value),placeholder:'[{"Item": "Sword", "Qty": 1}, ...]'}),m.jsxs("div",{className:"text-[10px] text-text-muted flex justify-between",children:[m.jsx("span",{children:"JSON Format supported"}),m.jsx("span",{className:"material-symbols-outlined text-xs",children:"data_array"})]})]});default:return m.jsxs("div",{className:"text-sm font-medium text-white/70 italic p-2 rounded-lg bg-white/5 border border-white/5",children:[m.jsx("span",{className:"text-[10px] uppercase font-bold text-slate-500 mr-2",children:a.tipo}),e]})}};return m.jsxs("div",{className:"p-4 border border-white/5 rounded-2xl bg-surface-dark/50 backdrop-blur-sm relative overflow-hidden h-full flex flex-col group hover:border-primary/20 transition-all",children:[m.jsxs("label",{className:"text-[10px] font-black uppercase tracking-widest text-text-muted mb-3 flex items-center justify-between gap-2",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-xs opacity-50",children:"label"}),a.nombre]}),n&&m.jsx("button",{onClick:o=>{o.preventDefault(),n()},className:"text-white/20 hover:text-red-400 transition-colors",title:"Remove Attribute",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"close"})})]}),m.jsx("div",{className:"flex-1 nodrag",children:s()}),m.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-primary/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none"})]})},Nae=[{value:"Individual",label:"Personaje"},{value:"Group",label:"Grupo/Faccin"},{value:"Location",label:"Lugar"},{value:"Item",label:"Objeto"},{value:"Event",label:"Evento"},{value:"Timeline",label:"Lnea de Tiempo"},{value:"Map",label:"Mapa"},{value:"Structure",label:"Construccin"},{value:"Creature",label:"Criatura"},{value:"Plant",label:"Flora"}],Pae=({entityId:t,entityType:e})=>{console.log(">>> RELATIONSHIP MANAGER V2 LOADED");const[r,n]=se.useState([]),[i,a]=se.useState(!1),[s,o]=se.useState(!1),[l,u]=se.useState("Individual"),[c,f]=se.useState([]),[p,v]=se.useState(""),[y,S]=se.useState(""),[w,T]=se.useState(""),[_,C]=se.useState(!1);se.useEffect(()=>{t&&N()},[t,e]),se.useEffect(()=>{s&&l&&A(l)},[s,l]);const N=async()=>{a(!0);try{const B=(await Qe.get("/bd/relacion")).filter(Z=>Z.nodoOrigenId===parseInt(t)&&(Z.tipoOrigen===e||Z.tipoOrigen==="GenericEntity")||Z.nodoDestinoId===parseInt(t)&&(Z.tipoDestino===e||Z.tipoDestino==="GenericEntity")),$=await Promise.all(B.map(async Z=>{const I=Z.nodoOrigenId===parseInt(t),q=I?Z.nodoDestinoId:Z.nodoOrigenId,U=await Qe.get(`/world-bible/entities/${q}`);if(!U)throw new Error(`Entity ${q} not found`);return{...Z,otherName:U.nombre,otherType:U.categoria||"Entity",isOutgoing:I}}));n($)}catch(F){console.error("Failed to load relationships",F)}finally{a(!1)}},A=async F=>{C(!0);try{const $=(await Qe.get("/world-bible/entities")).filter(Z=>(Z.categoria||"Generic").toLowerCase()===F.toLowerCase()||Z.tipoEspecial&&Z.tipoEspecial.toLowerCase()===F.toLowerCase());f($||[])}catch(B){console.error("Failed to fetch targets",B),f([])}finally{C(!1)}},O=async()=>{if(!(!p||!y))try{const F={nodoOrigenId:parseInt(t),tipoOrigen:e,nodoDestinoId:parseInt(p),tipoDestino:"GenericEntity",tipoRelacion:y,descripcion:w,metadata:JSON.stringify({originalCategory:l}),tipoEntidad:"relacion"};await Qe.put("/bd/insertar",F),o(!1),D(),N()}catch(F){console.error("Failed to save relationship",F),alert("Error saving relationship")}},j=async F=>{if(confirm("Are you sure?"))try{await Qe.delete(`/bd/relacion/${F}`),N()}catch(B){console.error("Failed to delete",B)}},D=()=>{u("Individual"),v(""),S(""),T("")};return m.jsxs("div",{className:"p-6 space-y-6",children:[m.jsxs("header",{className:"flex justify-between items-center",children:[m.jsx("h3",{className:"text-lg font-bold text-white uppercase tracking-widest",children:"Relationships"}),m.jsx(mn,{variant:"secondary",icon:"add_link",onClick:()=>o(!s),children:s?"Cancel":"Connect"})]}),s&&m.jsxs("div",{className:"p-4 rounded-2xl bg-white/5 border border-white/10 space-y-4 animate-in fade-in slide-in-from-top-4",children:[m.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[m.jsxs("div",{className:"space-y-1",children:[m.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-slate-500",children:"Target Type"}),m.jsx("select",{className:"w-full bg-black/40 border border-white/10 rounded-xl p-2 text-sm text-white outline-none focus:border-primary",value:l,onChange:F=>u(F.target.value),children:Nae.map(F=>m.jsx("option",{value:F.value,children:F.label},F.value))})]}),m.jsxs("div",{className:"space-y-1",children:[m.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-slate-500",children:"Target Entity"}),m.jsxs("select",{className:"w-full bg-black/40 border border-white/10 rounded-xl p-2 text-sm text-white outline-none focus:border-primary",value:p,onChange:F=>v(F.target.value),disabled:_,children:[m.jsx("option",{value:"",children:"Select Target..."}),c.map(F=>m.jsx("option",{value:F.id,children:F.nombre},F.id))]})]})]}),m.jsxs("div",{className:"space-y-1",children:[m.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-slate-500",children:"Relationship Type"}),m.jsx("input",{type:"text",placeholder:"e.g. Father of, Located in, Enemy of...",className:"w-full bg-black/40 border border-white/10 rounded-xl p-2 text-sm text-white outline-none focus:border-primary",value:y,onChange:F=>S(F.target.value)})]}),m.jsxs("div",{className:"space-y-1",children:[m.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-slate-500",children:"Description (The Why)"}),m.jsx("textarea",{placeholder:"Explain the nature of this connection...",className:"w-full bg-black/40 border border-white/10 rounded-xl p-2 text-sm text-white outline-none focus:border-primary h-20 resize-none",value:w,onChange:F=>T(F.target.value)})]}),m.jsx("div",{className:"flex justify-end pt-2",children:m.jsx(mn,{variant:"primary",icon:"save",onClick:O,disabled:!p||!y,children:"Save Connection"})})]}),m.jsx("div",{className:"space-y-3",children:i?m.jsx("div",{className:"text-center text-slate-500 py-8",children:"Scanning connections..."}):r.length===0?m.jsx("div",{className:"text-center text-slate-500 py-8 italic border border-dashed border-white/10 rounded-2xl",children:"No connections established"}):r.map((F,B)=>m.jsxs("div",{className:"group relative p-4 rounded-2xl bg-surface-dark border border-white/5 hover:border-primary/50 transition-all flex items-start gap-4",children:[m.jsx("div",{className:"mt-1",children:m.jsx("span",{className:"material-symbols-outlined text-slate-500",children:F.isOutgoing?"arrow_outward":"arrow_inward"})}),m.jsxs("div",{className:"flex-1",children:[m.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[m.jsx("span",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider",children:F.isOutgoing?"To:":"From:"}),m.jsx("span",{className:"text-sm font-bold text-white",children:F.otherName}),m.jsx("span",{className:"text-[9px] px-1.5 py-0.5 rounded bg-white/10 text-slate-400 font-bold uppercase tracking-wider",children:F.otherType})]}),m.jsx("div",{className:"text-primary text-xs font-black uppercase tracking-widest mb-2",children:F.tipoRelacion}),F.descripcion&&m.jsxs("p",{className:"text-xs text-slate-400 leading-relaxed bg-black/20 p-2 rounded-lg border border-white/5",children:['"',F.descripcion,'"']})]}),m.jsx("button",{onClick:()=>j(F.id),className:"opacity-0 group-hover:opacity-100 p-2 text-slate-600 hover:text-red-400 transition-all",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})})]},F.id||B))})]})},$g=({mode:t})=>{const{username:e,projectName:r,entitySlug:n,folderSlug:i,type:a}=Vi(),s=za(),o=t==="creation",{setRightOpen:l,setAvailableTemplates:u,setRightPanelMode:c,setAddAttributeHandler:f,setEntityTabs:p,activeEntityTab:v,setActiveEntityTab:y}=Ll(),[S,w]=se.useState({nombre:"",tipo:"entidadindividual",descripcion:"",color:"#6366f1",apariencia:"",notas:"",iconUrl:null,tipoEspecial:a||null,carpeta:null,categoria:"Individual"}),[T,_]=se.useState([]),[C,N]=se.useState(!0),[A,O]=se.useState(!1),[j,D]=se.useState([]),[F,B]=se.useState([]),[$,Z]=se.useState(!1);se.useEffect(()=>(l(!0),c("ENTITY"),p(["identity","narrative","attributes"]),y("identity"),()=>{c("NOTES"),p([])}),[]),se.useEffect(()=>{o?q():U()},[n,i,o]);const I=H=>{u(H),B(H),f(te=>{const ie=H.find(de=>de.id===te);ie&&_(de=>[...de,{id:`temp-${ie.id}-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,attribute:ie,value:ie.valorDefecto||"",isTemp:!0}])})},q=async()=>{N(!0);try{const H=await Qe.get(`/world-bible/folders/${i}`),te=await Qe.get(`/world-bible/folders/${i}/templates`);I(te),w(de=>({...de,nombre:`Nuevo ${a==="map"?"Mapa":a==="timeline"?"Cronograma":"Ente"}`,carpeta:H,tipoEspecial:a||"entidadindividual",tipo:a||"entidadindividual"}));const ie=te.filter(de=>de.esObligatorio).map(de=>({id:`temp-${de.id}-${Math.random().toString(36).substr(2,9)}`,attribute:de,value:de.valorDefecto||"",isTemp:!0}));_(ie)}catch(H){console.error("Error creating draft:",H)}finally{N(!1)}},U=async()=>{N(!0);try{const H=await Qe.get(`/world-bible/entities/${n}`);if(w({...H,apariencia:H.apariencia||"",notas:H.notas||"",iconUrl:H.iconUrl||null,tags:H.tags||"",tipo:H.tipoEspecial||getHierarchyType(H.tipo).id,color:H.color||"#6366f1",categoria:H.categoria||"Individual",attributes:H.attributes||{}}),H.carpeta?.id){const ie=await Qe.get(`/world-bible/folders/${H.carpeta.id}/templates`);I(ie)}const te=(H.valores||[]).filter(ie=>ie.plantilla).map(ie=>({id:ie.id.toString(),attribute:ie.plantilla,value:ie.valor,isTemp:!1}));_(te)}catch(H){console.error("Error loading entity:",H)}finally{N(!1)}},W=(H,te)=>{w(ie=>({...ie,[H]:te}))},Y=H=>{const te=H.target.files[0];if(te){const ie=new FileReader;ie.onloadend=()=>{W("iconUrl",ie.result)},ie.readAsDataURL(te)}},Q=(H,te)=>{_(ie=>ie.map(de=>de.id===H?{...de,value:te}:de))},ne=H=>{H.toString().startsWith("temp-")||D(te=>[...te,H]),_(te=>te.filter(ie=>ie.id!==H))},re=async(H=!0)=>{O(!0);try{const te={nombre:S.nombre,descripcion:S.descripcion,tags:S.tags,apariencia:S.apariencia,notas:S.notas,iconUrl:S.iconUrl,tipoEspecial:S.tipoEspecial||"entidadindividual",color:S.color,categoria:S.categoria,attributes:S.attributes};let ie=S.id;if(o){if(!S.carpeta&&!i){alert("Error: Missing context (no folder). Redirecting."),s(`/${e}/${r}/bible`);return}if(te.carpetaId=S.carpeta?.id,!te.carpetaId&&i)try{const le=await Qe.get(`/world-bible/folders/${i}`);te.carpetaId=le.id}catch(le){console.error("Could not resolve folder",le)}const ae=await Qe.post("/world-bible/entities",te);ie=ae.id;const pe=[...T];for(let le=0;le<pe.length;le++){const me=pe[le];if(me.isTemp)try{const he=await Qe.post(`/world-bible/entities/${ae.id}/attributes`,{plantillaId:me.attribute.id});await Qe.patch(`/world-bible/entities/${ae.id}/values`,[{valorId:he.id,nuevoValor:me.value}]),pe[le]={...me,id:he.id.toString(),isTemp:!1}}catch(he){console.error("Attr save failed",he)}}if(_(pe),O(!1),H){const le=ae.carpeta?ae.carpeta.slug||ae.carpeta.id:i;s(`/${e}/${r}/bible/folder/${le}`)}else{const le=ae.carpeta?ae.carpeta.slug||ae.carpeta.id:i;s(`/${e}/${r}/bible/folder/${le}/entity/${ae.slug||ae.id}`,{replace:!0})}return}await Qe.put(`/world-bible/entities/${ie}`,{nombre:te.nombre,color:te.color,iconUrl:te.iconUrl}),await Qe.patch(`/world-bible/entities/${ie}/details`,{descripcion:te.descripcion,tags:te.tags,apariencia:te.apariencia,notas:te.notas,iconUrl:te.iconUrl,attributes:te.attributes}),j.length>0&&(await Promise.all(j.map(ae=>Qe.delete(`/world-bible/values/${ae}`))),D([]));const de=T.filter(ae=>!ae.isTemp).map(ae=>({valorId:parseInt(ae.id),nuevoValor:ae.value}));de.length>0&&await Qe.patch(`/world-bible/entities/${ie}/values`,de);let ge=!1;const ye=[...T];for(let ae=0;ae<ye.length;ae++){const pe=ye[ae];if(pe.isTemp)try{const le=await Qe.post(`/world-bible/entities/${ie}/attributes`,{plantillaId:pe.attribute.id});await Qe.patch(`/world-bible/entities/${ie}/values`,[{valorId:le.id,nuevoValor:pe.value}]),ye[ae]={...pe,id:le.id.toString(),isTemp:!1},ge=!0}catch(le){console.error("Error saving field:",pe,le)}}if(ge&&_(ye),O(!1),H){const pe=i||(S.carpeta?S.carpeta.slug||S.carpeta.id:"root")||"root";s(`/${e}/${r}/bible/folder/${pe}`)}}catch(te){console.error("Save error",te),O(!1)}};return C?m.jsx("div",{className:"p-20 text-center animate-pulse",children:"Loading Builder..."}):m.jsx("div",{className:"flex h-full w-full bg-background-dark overflow-hidden",children:m.jsxs("div",{className:"flex-1 flex flex-col min-w-0 overflow-y-auto custom-scrollbar relative",children:[m.jsxs("div",{className:"border-b border-white/5 p-4 flex justify-between items-center bg-background-dark/80 backdrop-blur sticky top-0 z-30",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx(ox,{url:S.iconUrl,name:S.nombre,className:"size-10 rounded-lg border border-white/10"}),m.jsxs("div",{children:[m.jsx("h1",{className:"text-lg font-bold text-white leading-tight",children:S.nombre||"Sin Nombre"}),m.jsx("span",{className:"text-[10px] uppercase font-black tracking-widest text-slate-500",children:o?"Creando Nueva Entidad":"Editando Entidad"})]})]}),m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsx("button",{onClick:()=>s(`/${e}/${r}/bible/folder/${i}`),className:"px-4 py-2 rounded-xl text-slate-400 hover:text-white hover:bg-white/5 text-xs font-bold uppercase tracking-widest transition-all",children:"Cancelar"}),m.jsxs("div",{className:"flex bg-white/5 rounded-xl p-1 gap-1 border border-white/10",children:[m.jsxs("button",{onClick:()=>re(!0),disabled:A,className:"h-9 px-4 rounded-lg bg-primary hover:bg-primary-light text-white text-[10px] font-black uppercase tracking-widest transition-all flex items-center gap-2 disabled:opacity-50",children:[A?m.jsx("span",{className:"material-symbols-outlined animate-spin text-sm",children:"refresh"}):m.jsx("span",{className:"material-symbols-outlined text-sm",children:"save"}),"Guardar"]}),m.jsx("div",{className:"w-px bg-white/10 my-1"}),m.jsx("button",{onClick:()=>re(!1),disabled:A,className:"h-9 px-3 rounded-lg bg-transparent hover:bg-white/10 text-white transition-all flex items-center justify-center disabled:opacity-50",title:"Guardar y Seguir Editando",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"edit_document"})})]})]})]}),m.jsxs("div",{className:"p-8 pb-32 max-w-5xl mx-auto w-full",children:[v==="identity"&&m.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[m.jsxs(un,{className:`p-6 space-y-6 ${S.tipoEspecial==="map"?"lg:col-span-2":""}`,children:[m.jsxs("h3",{className:"text-xs font-black uppercase tracking-widest text-primary flex items-center gap-2 mb-6",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"badge"})," Identity"]}),m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{children:[m.jsx("label",{className:"text-[10px] uppercase font-bold text-slate-500 mb-1 block",children:"Full Name"}),m.jsx("input",{value:S.nombre,onChange:H=>W("nombre",H.target.value),className:"w-full bg-black/30 border border-white/10 rounded-xl p-3 text-sm text-white focus:border-primary/50 outline-none transition-colors",placeholder:"E.g. King Alaric"})]}),m.jsxs("div",{children:[m.jsx("label",{className:"text-[10px] uppercase font-bold text-slate-500 mb-1 block",children:"Entity Type / Category"}),m.jsxs("select",{value:S.categoria||"Individual",onChange:H=>W("categoria",H.target.value),className:"w-full bg-black/30 border border-white/10 rounded-xl p-3 text-sm text-white focus:border-primary/50 outline-none transition-colors appearance-none",children:[m.jsx("option",{value:"Individual",children:"Individual (Character/Person)"}),m.jsx("option",{value:"Group",children:"Group / Faction"}),m.jsx("option",{value:"Location",children:"Location"}),m.jsx("option",{value:"Event",children:"Event"}),m.jsx("option",{value:"Object",children:"Object / Item"}),m.jsx("option",{value:"Concept",children:"Concept / Magic"})]})]}),m.jsxs("div",{children:[m.jsx("label",{className:"text-[10px] uppercase font-bold text-slate-500 mb-1 block",children:"Tags (comma separated)"}),m.jsx("input",{value:S.tags,onChange:H=>W("tags",H.target.value),className:"w-full bg-black/30 border border-white/10 rounded-xl p-3 text-sm text-slate-300 focus:border-primary/50 outline-none transition-colors",placeholder:"Warrior, Leader, Human..."})]}),m.jsxs("div",{children:[m.jsx("label",{className:"text-[10px] uppercase font-bold text-slate-500 mb-1 block",children:"Icon / Portrait"}),m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx(ox,{url:S.iconUrl,name:S.nombre,size:"lg",className:"rounded-xl"}),m.jsxs("label",{className:"cursor-pointer px-4 py-2 bg-white/5 hover:bg-white/10 rounded-lg border border-white/10 text-xs font-bold text-slate-300 transition-colors",children:["Upload Image",m.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:Y})]}),S.iconUrl&&m.jsx("button",{onClick:()=>W("iconUrl",""),className:"p-2 hover:text-red-400 transition-colors",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})})]})]})]})]}),S.tipoEspecial!=="map"&&m.jsxs(un,{className:"p-6 space-y-6",children:[m.jsxs("div",{className:"flex justify-between items-center mb-6",children:[m.jsxs("h3",{className:"text-xs font-black uppercase tracking-widest text-primary flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"palette"})," Appearance"]}),m.jsx("div",{className:"flex gap-2",children:m.jsxs("label",{className:"cursor-pointer text-[10px] font-bold uppercase tracking-wider text-slate-500 hover:text-white transition-colors flex items-center gap-1",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"add_photo_alternate"}),"Insert Image",m.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:H=>{const te=H.target.files[0];if(te){const ie=new FileReader;ie.onloadend=()=>{const de=`

![${te.name}](${ie.result})
`;W("apariencia",(S.apariencia||"")+de)},ie.readAsDataURL(te)}}})]})})]}),m.jsx("textarea",{value:S.apariencia,onChange:H=>W("apariencia",H.target.value),className:"w-full h-80 bg-black/30 border border-white/10 rounded-xl p-4 text-sm text-slate-300 leading-relaxed focus:border-primary/50 outline-none transition-colors custom-scrollbar font-mono",placeholder:"Describe their physical appearance, clothing, distinct marks... (Markdown Supported)"})]}),S.tipoEspecial==="map"&&m.jsxs(un,{className:"p-6 lg:col-span-2 space-y-6",children:[m.jsxs("h3",{className:"text-xs font-black uppercase tracking-widest text-primary flex items-center gap-2 mb-6",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"map"})," Cartography"]}),m.jsx("div",{onClick:()=>{Z(!0)},className:"w-full aspect-[21/9] bg-black/30 border border-white/10 rounded-xl overflow-hidden cursor-pointer group relative",children:(()=>{let H=S.attributes?.snapshotUrl||S.attributes?.bgImage||S.iconUrl;if(!H)try{const te=JSON.parse(S.descripcion||"{}");te.snapshotUrl&&(H=te.snapshotUrl)}catch{}return H?m.jsxs(m.Fragment,{children:[m.jsx("img",{src:H,alt:"Map Preview",className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"}),m.jsx("div",{className:"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center",children:m.jsx("span",{className:"material-symbols-outlined text-white text-3xl",children:"zoom_in"})})]}):m.jsx("div",{className:"w-full h-full flex items-center justify-center text-slate-500 text-xs italic",children:"No map preview available"})})()}),m.jsx("div",{className:"flex justify-end",children:m.jsx(mn,{variant:"secondary",size:"sm",icon:"edit",onClick:()=>window.open(`/${e}/${r}/map-editor/edit/${S.id}`,"_self"),children:"Open Editor"})})]}),S.tipoEspecial!=="map"&&m.jsxs(un,{className:"p-6 lg:col-span-2",children:[m.jsxs("h3",{className:"text-xs font-black uppercase tracking-widest text-primary flex items-center gap-2 mb-6",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"sticky_note_2"})," Quick Notes"]}),m.jsx("textarea",{className:"w-full h-40 bg-black/30 border border-white/10 rounded-xl p-4 text-sm text-slate-300 leading-relaxed resize-none focus:border-primary/50 outline-none transition-colors custom-scrollbar font-mono placeholder:text-slate-600",placeholder:"Quick notes about this entity...",value:S.notas||"",onChange:H=>W("notas",H.target.value)})]})]}),v==="narrative"&&m.jsxs("div",{className:"animate-in fade-in duration-500 space-y-8",children:[m.jsxs(un,{className:"min-h-[40vh] flex flex-col p-8",children:[m.jsxs("div",{className:"flex items-center justify-between mb-6",children:[m.jsxs("h3",{className:"text-xs font-black uppercase tracking-widest text-primary flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"history_edu"})," Biography"]}),m.jsx("span",{className:"text-[10px] text-slate-500 bg-white/5 px-2 py-1 rounded",children:"Markdown Supported"})]}),m.jsx("textarea",{className:"flex-1 w-full bg-transparent border-none outline-none text-slate-300 leading-relaxed resize-none focus:ring-0 placeholder:text-slate-600 custom-scrollbar text-base min-h-[300px]",placeholder:"Write the origin story...",value:S.descripcion||"",onChange:H=>W("descripcion",H.target.value)})]}),m.jsxs(un,{className:"min-h-[40vh]",children:[m.jsxs("h3",{className:"text-xs font-black uppercase tracking-widest text-primary p-6 pb-0 flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"hub"})," Relationships"]}),o?m.jsxs("div",{className:"p-12 text-center text-slate-500",children:[m.jsx("span",{className:"material-symbols-outlined text-4xl mb-4",children:"save_as"}),m.jsx("p",{className:"text-sm font-bold",children:"Please save the entity first to manage relationships."})]}):m.jsx(Pae,{entityId:S.id,entityType:S.tipo||"entidadindividual"})]})]}),v==="attributes"&&m.jsxs("div",{className:`animate-in fade-in duration-500 space-y-6 min-h-[50vh] transition-colors rounded-2xl p-4 ${window.isDraggingOver?"bg-primary/10 border-2 border-dashed border-primary":""}`,onDragOver:H=>{H.preventDefault(),H.dataTransfer.dropEffect="copy",H.currentTarget.classList.add("bg-primary/10","border-primary","border-dashed","border-2")},onDragLeave:H=>{H.preventDefault(),H.currentTarget.classList.remove("bg-primary/10","border-primary","border-dashed","border-2")},onDrop:H=>{if(H.preventDefault(),H.currentTarget.classList.remove("bg-primary/10","border-primary","border-dashed","border-2"),H.dataTransfer.getData("application/reactflow/type")!=="attribute")return;let ie=null;try{const de=H.dataTransfer.getData("templateData");if(de)ie=JSON.parse(de);else{const ge=parseInt(H.dataTransfer.getData("templateId"));ie=F.find(ye=>ye.id===ge)}}catch(de){console.error("Drop error",de)}ie&&_(de=>[...de,{id:`temp-${ie.id}-${Date.now()}`,attribute:ie,value:ie.valorDefecto||"",isTemp:!0}])},children:[m.jsxs("h3",{className:"text-xs font-black uppercase tracking-widest text-primary border-b border-white/5 pb-4 flex items-center justify-between",children:[m.jsx("span",{children:"Atributos especiales"}),m.jsx("span",{className:"text-[10px] text-slate-500 font-normal normal-case opacity-50 hidden md:block",children:"Arraste atributos desde el panel derecho"})]}),m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 p-4 border-2 border-dashed border-white/5 rounded-2xl hover:border-primary/20 transition-colors bg-white/[0.01]",children:[T.length===0&&m.jsxs("div",{className:"col-span-full py-12 text-center text-slate-500 text-sm pointer-events-none",children:[m.jsx("span",{className:"material-symbols-outlined text-4xl mb-2 opacity-50",children:"drag_indicator"}),m.jsx("p",{children:"Arrastra plantillas aqu para aadir atributos"})]}),T.filter(H=>H.attribute).map(H=>m.jsx(Tae,{attribute:H.attribute,value:H.value,onChange:te=>Q(H.id,te),onRemove:()=>ne(H.id)},H.id))]})]})]}),$&&S.iconUrl&&m.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/90 backdrop-blur-sm animate-in fade-in duration-300",onClick:()=>Z(!1),children:m.jsxs("div",{className:"relative max-w-[90vw] max-h-[90vh] p-2",children:[m.jsx("button",{onClick:()=>Z(!1),className:"absolute -top-12 right-0 p-2 text-white hover:text-primary transition-colors",children:m.jsx("span",{className:"material-symbols-outlined text-3xl",children:"close"})}),m.jsx("img",{src:S.iconUrl,alt:S.nombre,className:"max-w-full max-h-[85vh] object-contain rounded-lg shadow-2xl border border-white/10",onClick:H=>H.stopPropagation()})]})})]})})},Mae=t=>{switch(t?.toLowerCase()){case"text":return"notes";case"short_text":return"short_text";case"number":return"pin";case"date":return"calendar_today";case"select":return"list";case"boolean":return"check_box";case"map":return"map";case"timeline":return"timeline";case"character":case"entidadindividual":return"person";case"location":case"zona":case"construccion":return"location_on";case"culture":case"entidadcolectiva":return"groups";case"universe":case"galaxy":case"system":case"planet":return"public";case"entity_link":return"link";default:return"description"}},Qk=({item:t,type:e,linkTo:r,onContextMenu:n,onDelete:i})=>{const a=e==="folder";return m.jsxs(gh,{to:r,onContextMenu:n,className:"group relative flex flex-col p-4 rounded-3xl bg-surface-dark border border-glass-border hover:border-primary/50 hover:bg-white/5 transition-all duration-300 backdrop-blur-sm overflow-hidden",children:[t.iconUrl&&m.jsxs(m.Fragment,{children:[m.jsx("div",{className:"absolute inset-0 z-0",children:m.jsx("img",{src:t.iconUrl,alt:"",className:"w-full h-full object-cover opacity-60 group-hover:scale-105 transition-transform duration-700"})}),m.jsx("div",{className:"absolute inset-0 z-0 bg-gradient-to-t from-[#0a0a0c] via-[#0a0a0c]/80 to-transparent"})]}),m.jsxs("div",{className:"relative z-10 flex items-start justify-between mb-4",children:[m.jsx("div",{className:`
                    size-12 rounded-2xl flex items-center justify-center text-xl transition-transform group-hover:scale-110 
                    ${a?"bg-primary/20 text-primary":"bg-white/5 text-text-muted group-hover:text-white backdrop-blur-md border border-white/5"}
                `,children:m.jsx("span",{className:"material-symbols-outlined",children:a?"folder":Mae(t.tipoEspecial)})}),a&&m.jsx("div",{className:"px-2 py-1 rounded-lg bg-surface-light/50 border border-glass-border text-[10px] font-black text-white shadow-sm backdrop-blur-md",children:t.itemCount||0})]}),m.jsxs("div",{className:"relative z-10 mt-auto",children:[m.jsx("h3",{className:"text-sm font-bold text-white truncate group-hover:text-primary transition-colors drop-shadow-md",children:t.nombre}),m.jsx("p",{className:"text-[10px] font-bold uppercase tracking-widest text-text-muted mt-1 opacity-70 group-hover:opacity-100 transition-opacity",children:a?"Folder":t.tipoEspecial||"Entity"})]}),m.jsxs("div",{className:"absolute top-4 right-4 z-20 flex items-center gap-2 opacity-0 group-hover:opacity-100 transition-opacity duration-300",children:[i&&m.jsx("button",{onClick:s=>{s.preventDefault(),s.stopPropagation(),i(t)},className:"p-1.5 rounded-lg bg-red-500/10 hover:bg-red-500 text-red-500 hover:text-white transition-all border border-red-500/20 shadow-lg shadow-red-500/5 group/del backdrop-blur-md",children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})}),m.jsx("span",{className:"material-symbols-outlined text-primary text-sm transform group-hover:translate-x-1 transition-transform drop-shadow-md",children:"arrow_forward"})]})]})},Aae=({path:t,currentFolder:e})=>{const{username:r,projectName:n}=Vi(),i=`/${r}/${n}/bible`;return!t&&!e?null:m.jsxs("nav",{className:"flex items-center gap-2 text-[10px] uppercase font-bold tracking-wider text-slate-500 mb-4 overflow-x-auto no-scrollbar whitespace-nowrap",children:[m.jsxs(gh,{to:i,className:"hover:text-primary transition-colors flex items-center gap-1",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"home"}),"Bible"]}),t&&t.map((a,s)=>m.jsxs(sr.Fragment,{children:[m.jsx("span",{className:"text-slate-700",children:"/"}),m.jsx(gh,{to:`${i}/folder/${a.slug||a.id}`,className:"hover:text-primary transition-colors",children:a.nombre})]},a.id)),e&&m.jsxs(m.Fragment,{children:[m.jsx("span",{className:"text-slate-700",children:"/"}),m.jsx("span",{className:"text-white bg-white/5 px-2 py-0.5 rounded",children:e.nombre})]})]})},Lae=({entities:t=[],onAddEvent:e})=>{const r=[...t].sort((n,i)=>n.id-i.id);return m.jsx("div",{className:"w-full max-w-3xl mx-auto p-4 animate-slide-up",children:m.jsxs("div",{className:"relative border-l-2 border-white/10 ml-6 space-y-12 py-8",children:[r.length===0&&m.jsx("div",{className:"pl-12 opacity-50",children:m.jsx("p",{className:"text-white text-sm",children:"No events recorded in this timeline yet."})}),r.map((n,i)=>m.jsxs("div",{className:"relative pl-12 group",children:[m.jsx("div",{className:"absolute left-[-9px] top-0 size-4 rounded-full bg-background-dark border-2 border-primary group-hover:scale-125 group-hover:bg-primary transition-all shadow-[0_0_10px_rgba(99,102,241,0.3)]"}),m.jsxs(un,{className:"p-6 border-white/5 hover:border-primary/30 transition-all hover:-translate-y-1 cursor-pointer",children:[m.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:n.nombre}),m.jsx("p",{className:"text-sm text-text-muted leading-relaxed line-clamp-3",children:n.descripcion||"No description provided."})]})]},n.id)),m.jsxs("div",{onClick:e,className:"relative pl-12 group cursor-pointer opacity-50 hover:opacity-100 transition-opacity",children:[m.jsx("div",{className:"absolute left-[-9px] top-2 size-4 rounded-full bg-background-dark border-2 border-dashed border-white/30"}),m.jsxs("div",{className:"p-4 border-2 border-dashed border-white/10 rounded-2xl flex items-center justify-center text-text-muted hover:border-primary/50 hover:text-white transition-all",children:[m.jsx("span",{className:"material-symbols-outlined mr-2",children:"add_circle"}),m.jsx("span",{className:"text-xs font-black uppercase tracking-widest",children:"Add Historical Event"})]})]})]})})},uh={UNIVERSE:{id:"UNIVERSE",label:"Universo / Multiverso",description:"Contenedor supremo de realidades.",icon:"public",color:"text-purple-400",bgColor:"bg-purple-900/20"},GALAXY:{id:"GALAXY",label:"Galaxia",description:"Agrupacin masiva de sistemas estelares.",icon:"auto_awesome",color:"text-indigo-400",bgColor:"bg-indigo-900/20"},SYSTEM:{id:"SYSTEM",label:"Sistema Solar",description:"Estrella central y sus cuerpos orbitales.",icon:"wb_sunny",color:"text-yellow-400",bgColor:"bg-yellow-900/20"},PLANET:{id:"PLANET",label:"Planeta / Mundo",description:"Cuerpo celeste o plano de existencia principal.",icon:"public",color:"text-emerald-400",bgColor:"bg-emerald-900/20"},GEOGRAPHY:{id:"GEOGRAPHY",label:"Geografa",icon:"map",color:"text-green-300"},ENTITIES:{id:"ENTITIES",label:"Entidades",icon:"groups",color:"text-blue-300"},MAGIC:{id:"MAGIC",label:"Magia",icon:"auto_fix_high",color:"text-pink-300"},TIMELINE:{id:"TIMELINE",label:"Cronologa",icon:"history",color:"text-orange-300"},FACTIONS:{id:"FACTIONS",label:"Facciones",icon:"security",color:"text-red-300"},ITEMS:{id:"ITEMS",label:"Objetos",icon:"inventory_2",color:"text-gray-300"},FOLDER:{id:"FOLDER",label:"Carpeta",icon:"folder",color:"text-gray-400"}},Jk=t=>uh[t]||uh.FOLDER,Rae=()=>{const{username:t,projectName:e,folderSlug:r}=Vi(),n=za(),{handleCreateEntity:i,handleDeleteEntity:a,handleCreateSimpleFolder:s,folderSearchTerm:o,folderFilterType:l}=Ll(),[u,c]=se.useState([]),[f,p]=se.useState(null),[v,y]=se.useState([]),[S,w]=se.useState(!0),[T,_]=se.useState(!1),C=u.filter(j=>{const D=j.nombre.toLowerCase().includes(o||""),F=l==="ALL"||l==="MAP"&&j.tipoEspecial==="map"||l==="TIMELINE"&&j.tipoEspecial==="timeline"||l==="ENTITY"&&(!j.tipoEspecial||j.tipoEspecial==="entidadindividual");return D&&F});se.useEffect(()=>{const j=D=>{const{folderId:F,removeId:B,type:$,item:Z,expand:I}=D.detail||{};F===(f?.id||r)&&(B?c(q=>q.filter(U=>U.id!==B)):Z&&Z.slug&&Z.slug!==r?n(`/${t}/${e}/bible/folder/${Z.slug}`,{replace:!0}):N())};return window.addEventListener("folder-update",j),()=>window.removeEventListener("folder-update",j)},[r,f?.id]),se.useEffect(()=>{N()},[r]);const N=async()=>{w(!0);try{const[j,D]=await Promise.all([Qe.get(`/world-bible/folders/${r}/entities`),Qe.get(`/world-bible/folders/${r}`)]);c(j),D.folder?(p(D.folder),y(D.path||[])):(p(D||{name:"Folder"}),y([]))}catch(j){console.error("Error loading folder content:",j),p(null),y([])}finally{w(!1)}};if(S)return m.jsx("div",{className:"p-20 text-center animate-pulse text-text-muted",children:"Loading sector..."});if(!f)return m.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-20 text-text-muted",children:[m.jsx("span",{className:"material-symbols-outlined text-6xl mb-4 opacity-20",children:"folder_off"}),m.jsx("h2",{className:"text-xl font-bold opacity-50",children:"Folder Not Found"}),m.jsx("p",{className:"text-sm opacity-30 mt-2",children:"The sector you are looking for does not exist or has been moved."}),m.jsx(gh,{to:`/${t}/${e}/bible`,className:"mt-6 px-6 py-2 bg-white/5 hover:bg-white/10 rounded-full text-xs font-bold transition-colors",children:"Return to Root"})]});const A=f&&f.tipo&&(["UNIVERSE","GALAXY","SYSTEM","PLANET"].includes(f.tipo)||f.tipo==="MAGIC"),O=f?Jk(f.tipo):uh.FOLDER;return A?m.jsxs("div",{className:"flex-1 overflow-y-auto bg-[#0a0a0c] text-white w-full h-full relative",children:[m.jsxs("div",{className:`w-full min-h-[300px] ${O.bgColor} relative flex items-end p-10 border-b border-white/5`,children:[m.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-[#0a0a0c] to-transparent opacity-80 pointer-events-none"}),m.jsx("div",{className:"absolute top-6 left-10 z-20",children:m.jsx(Aae,{path:v,currentFolder:f})}),m.jsxs("div",{className:"relative z-10 flex gap-8 items-end w-full max-w-7xl mx-auto",children:[m.jsx("div",{className:`w-32 h-32 rounded-3xl ${O.bgColor} border border-white/10 flex items-center justify-center shadow-2xl`,children:m.jsx("span",{className:`material-symbols-outlined text-6xl ${O.color}`,children:O.icon})}),m.jsxs("div",{className:"flex-1 mb-2",children:[m.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[m.jsx("div",{className:`px-3 py-1 rounded-full text-[10px] font-black uppercase tracking-widest border border-white/10 ${O.bgColor} ${O.color}`,children:O.label}),m.jsxs("span",{className:"text-white/30 text-xs font-mono tracking-widest uppercase",children:["ID: ",f.id]})]}),m.jsx("h1",{className:"text-6xl font-black tracking-tighter text-white mb-2",children:f.nombre}),m.jsx("p",{className:"text-lg text-white/50 max-w-2xl font-light leading-relaxed",children:f.descripcion||"Sin descripcin definida para este sector cosmolgico."})]}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsxs("button",{onClick:()=>n(`/${t}/${e}/bible/folder/${r}/entity/new/entidadindividual`),className:"px-4 py-2 bg-primary/20 hover:bg-primary/30 text-primary rounded-xl text-[10px] font-black uppercase tracking-widest flex items-center gap-2 transition-all",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"person_add"})," Nueva Entidad"]}),m.jsxs("button",{onClick:()=>n(`/${t}/${e}/map-editor/create/${r}`,{state:{folderId:f?.id}}),className:"px-4 py-2 bg-white/5 hover:bg-white/10 text-white rounded-xl text-[10px] font-black uppercase tracking-widest flex items-center gap-2 transition-all border border-glass-border",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"map"})," Mapa"]})]})]})]}),m.jsxs("div",{className:"max-w-7xl mx-auto p-10 grid grid-cols-1 lg:grid-cols-3 gap-8",children:[m.jsxs("div",{className:"space-y-6",children:[m.jsxs("div",{className:"bg-[#13141f] border border-white/5 rounded-2xl p-6",children:[m.jsx("h3",{className:"text-xs font-bold text-white/40 uppercase tracking-widest mb-4",children:"Estadsticas"}),m.jsx("div",{className:"grid grid-cols-2 gap-4",children:m.jsxs("div",{children:[m.jsx("div",{className:"text-2xl font-black text-white",children:u.length}),m.jsx("div",{className:"text-[10px] text-white/40 uppercase",children:"Entidades"})]})})]}),m.jsxs("div",{className:"bg-[#13141f] border border-white/5 rounded-2xl p-6 h-64 flex flex-col",children:[m.jsx("h3",{className:"text-xs font-bold text-white/40 uppercase tracking-widest mb-4",children:"Notas Rpidas"}),m.jsx("textarea",{className:"flex-1 bg-transparent resize-none outline-none text-sm text-white/70 placeholder-white/20",placeholder:"Escribir notas de la zona..."})]})]}),m.jsxs("div",{className:"lg:col-span-2",children:[m.jsx("h3",{className:"text-xs font-bold text-white/40 uppercase tracking-widest mb-4",children:"Contenido Interno"}),u.length===0&&m.jsxs("div",{className:"p-12 border border-dashed border-white/10 rounded-2xl text-center",children:[m.jsx("span",{className:"material-symbols-outlined text-4xl text-white/20 mb-2",children:"folder_open"}),m.jsx("p",{className:"text-white/30 text-sm",children:"Este sector est vaco."})]}),m.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:u.map(j=>m.jsx(Qk,{item:j,type:"entity",linkTo:`/${t}/${e}/bible/folder/${f.slug||r}/entity/${j.slug||j.id}`,onDelete:()=>a(j.id,f?.id||r)},j.id))})]})]})]}):m.jsxs("div",{className:"flex-1 p-8 max-w-[1600px] mx-auto w-full h-full overflow-y-auto",children:[m.jsxs("header",{className:"mb-8 flex items-end justify-between",children:[m.jsxs("div",{children:[m.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[m.jsxs(gh,{to:`/${t}/${e}/bible`,className:"text-xs font-bold text-text-muted hover:text-primary transition-colors flex items-center gap-1",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"arrow_back"})," Root"]}),f&&m.jsx("span",{className:`px-2 py-0.5 rounded text-[10px] bg-white/5 border border-white/10 ${O.color}`,children:O.label})]}),m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsx("span",{className:`material-symbols-outlined text-3xl ${O.color}`,children:O.icon}),m.jsx("h1",{className:"text-4xl font-black text-white tracking-tighter",children:f?.nombre||"Unnamed Folder"})]}),m.jsx("p",{className:"text-white/50 text-sm mt-2 max-w-xl",children:f?.descripcion})]}),m.jsxs("div",{className:"flex items-center gap-3 relative",children:[m.jsxs("button",{onClick:()=>_(!T),className:"h-10 px-6 rounded-xl bg-primary hover:bg-primary-light transition flex items-center gap-2 text-xs font-bold text-white shadow-lg shadow-primary/20",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"add"}),m.jsx("span",{children:"Aadir Elemento"})]}),T&&m.jsxs("div",{className:"absolute top-full right-0 mt-2 w-56 bg-surface-dark border border-glass-border rounded-2xl shadow-2xl py-2 z-50 animate-in fade-in slide-in-from-top-2",children:[m.jsxs("button",{onClick:()=>{n(`/${t}/${e}/bible/folder/${r}/entity/new/entidadindividual`),_(!1)},className:"w-full px-4 py-2.5 hover:bg-white/5 text-left text-xs font-bold flex items-center gap-3 text-white/70 hover:text-white",children:[m.jsx("span",{className:"material-symbols-outlined text-sm text-primary",children:"person"})," Personaje"]}),m.jsxs("button",{onClick:()=>{n(`/${t}/${e}/bible/folder/${r}/entity/new/entidadcolectiva`),_(!1)},className:"w-full px-4 py-2.5 hover:bg-white/5 text-left text-xs font-bold flex items-center gap-3 text-white/70 hover:text-white",children:[m.jsx("span",{className:"material-symbols-outlined text-sm text-blue-400",children:"groups"})," Cultura / Grupo"]}),m.jsxs("button",{onClick:()=>{n(`/${t}/${e}/bible/folder/${r}/entity/new/zona`),_(!1)},className:"w-full px-4 py-2.5 hover:bg-white/5 text-left text-xs font-bold flex items-center gap-3 text-white/70 hover:text-white",children:[m.jsx("span",{className:"material-symbols-outlined text-sm text-green-400",children:"location_on"})," Lugar / Geografa"]}),m.jsxs("button",{onClick:()=>{n(`/${t}/${e}/bible/folder/${r}/entity/new/interaccion`),_(!1)},className:"w-full px-4 py-2.5 hover:bg-white/5 text-left text-xs font-bold flex items-center gap-3 text-white/70 hover:text-white",children:[m.jsx("span",{className:"material-symbols-outlined text-sm text-amber-400",children:"history_edu"})," Lore / Interaccin"]}),m.jsxs("button",{onClick:()=>{n(`/${t}/${e}/bible/folder/${r}/entity/new/efectos`),_(!1)},className:"w-full px-4 py-2.5 hover:bg-white/5 text-left text-xs font-bold flex items-center gap-3 text-white/70 hover:text-white",children:[m.jsx("span",{className:"material-symbols-outlined text-sm text-purple-400",children:"magic_button"})," Objeto / Efecto"]}),m.jsx("div",{className:"h-px bg-white/5 my-1"}),m.jsxs("button",{onClick:()=>{n(`/${t}/${e}/map-editor/create/${r}`,{state:{folderId:f?.id}}),_(!1)},className:"w-full px-4 py-2.5 hover:bg-white/5 text-left text-xs font-bold flex items-center gap-3 text-white/70 hover:text-white",children:[m.jsx("span",{className:"material-symbols-outlined text-sm text-red-400",children:"map"})," Nuevo Mapa"]}),m.jsxs("button",{onClick:()=>{s(f,"TIMELINE"),_(!1)},className:"w-full px-4 py-2.5 hover:bg-white/5 text-left text-xs font-bold flex items-center gap-3 text-white/70 hover:text-white",children:[m.jsx("span",{className:"material-symbols-outlined text-sm text-cyan-400",children:"timeline"})," Timeline"]})]})]})]}),f?.tipo==="TIMELINE"?m.jsx(Lae,{entities:C,folderId:r,onAddEvent:()=>n(`/${t}/${e}/bible/folder/${r}/entity/new/evento`)}):m.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4",children:C.map(j=>{const D=j.tipoEspecial==="map"||j.tipoEspecial==="timeline"?j.tipoEspecial:"entity";return m.jsx(Qk,{item:j,type:"entity",linkTo:`/${t}/${e}/bible/folder/${f?.slug||r}/${D}/${j.slug||j.id}`,onDelete:()=>a(j.id,f?.id||r)},j.id)})}),u.length===0&&m.jsx("div",{className:"p-20 text-center border-2 border-dashed border-glass-border rounded-[3rem] opacity-30 mt-8",children:m.jsx("p",{className:"text-text-muted font-bold uppercase tracking-widest",children:"Empty Folder"})})]})},Oae=t=>{switch(t?.toLowerCase()){case"text":return"notes";case"short_text":return"short_text";case"number":return"pin";case"date":return"calendar_today";case"select":return"list";case"boolean":return"check_box";case"map":return"map";case"timeline":return"timeline";case"character":case"entidadindividual":return"person";case"location":case"zona":case"construccion":return"location_on";case"culture":case"entidadcolectiva":return"groups";case"universe":case"galaxy":case"system":case"planet":return"public";case"entity_link":return"link";default:return"description"}},Dae=(t,e,r,n)=>{const i=r.slug||r.id;return`/${t}/${e}/bible/folder/${n||"root"}/entity/${i}`},r8=({folder:t,onCreateSubfolder:e,onRename:r,onDeleteFolder:n,onDeleteEntity:i,onCreateTemplate:a,onMoveEntity:s,onCreateEntity:o,onConfirmCreate:l,className:u})=>{const{username:c,projectName:f}=Vi(),p=za(),[v,y]=se.useState(!1),[S,w]=se.useState({folders:[],entities:[]}),[T,_]=se.useState(!1),[C,N]=se.useState(null),[A,O]=se.useState(t.nombre),[j,D]=se.useState(!1),[F,B]=se.useState(null);se.useEffect(()=>{O(t.nombre)},[t.nombre]),se.useEffect(()=>{const H=te=>{const{folderId:ie,optimisticType:de,confirmedType:ge,removeId:ye,item:ae,oldId:pe,expand:le,type:me}=te.detail||{};if(ie===t.id){if(le&&(y(!0),T||$()),T)if(de){const he=de==="folder"?"folders":"entities";w(xe=>({...xe,[he]:[...xe[he].filter(we=>we.id!==ae.id),ae]}))}else if(ge){const he=ge==="folder"?"folders":"entities";w(xe=>({...xe,[he]:xe[he].map(we=>we.id===pe?ae:we)}))}else if(ye){const he=me==="folder"?"folders":"entities";w(xe=>({...xe,[he]:xe[he].filter(we=>we.id!==ye)}))}else!de&&!ge&&!ye&&$()}else te.detail?.targetFolderId===t.id&&te.detail?.type==="move-in"?T&&$():te.detail?.sourceFolderId===t.id&&te.detail?.type==="move-out"&&T&&w(he=>({...he,entities:he.entities.filter(xe=>xe.id!==xe.detail.entityId)}))};return window.addEventListener("folder-update",H),()=>window.removeEventListener("folder-update",H)},[t.id,T]);const $=async()=>{try{console.log("Loading content for folder:",t.id,"Slug:",t.slug);const[H,te]=await Promise.all([Qe.get(`/world-bible/folders/${t.id}/subfolders`),Qe.get(`/world-bible/folders/${t.id}/entities`)]);w({folders:H,entities:te}),_(!0)}catch(H){console.error("Error reloading folder content:",H),H.message&&H.message.includes("404")&&console.error(`404 for folder ${t.id} (${t.nombre})`)}},Z=H=>{H.stopPropagation(),y(!v),!T&&!v&&$()},I=()=>p(`/${c}/${f}/bible/folder/${t.slug||t.id}`),q=(H,te,ie,de)=>{H.preventDefault(),H.stopPropagation(),N({x:H.clientX,y:H.clientY,type:te,id:ie,name:de})},U=()=>N(null);se.useEffect(()=>{if(C)return window.addEventListener("click",U),()=>window.removeEventListener("click",U)},[C]);const W=H=>{if(H.key==="Enter"){H.preventDefault();const te=H.target.value.trim();te?l(t.id,te,"folder",t.parentId,t.tipoEspecial):t.isNew&&i(t.id,t.parentId)}};if(t.isNew)return m.jsx("div",{className:"px-3 py-1 animate-in fade-in zoom-in-95 duration-200",children:m.jsx("input",{autoFocus:!0,type:"text",className:"w-full bg-surface-light border border-primary/50 rounded px-2 py-1 text-xs text-white outline-none",placeholder:"Folder Name...",onKeyDown:W,onBlur:H=>{const te=H.target.value.trim();te?l(t.id,te,"folder",t.parentId):i(t.id,t.parentId)}})});const Y=({item:H,type:te})=>m.jsx("div",{className:"px-3 py-1 animate-in fade-in zoom-in-95 duration-200",children:m.jsx("input",{autoFocus:!0,type:"text",defaultValue:H.nombre||"",className:"w-full bg-surface-light border border-primary/50 rounded px-2 py-1 text-xs text-white outline-none",placeholder:"Name...",onKeyDown:ie=>{if(ie.key==="Enter"){ie.preventDefault();const de=ie.target.value.trim();de?l(H.id,de,te,t.id,H.tipoEspecial):H.isNew&&i(H.id,t.id),B(null)}else ie.key==="Escape"&&(B(null),H.isNew&&i(H.id,t.id))},onBlur:ie=>{const de=ie.target.value.trim();de?l(H.id,de,te,t.id,H.tipoEspecial):H.isNew&&i(H.id,t.id),B(null)}})}),Q=H=>{H.preventDefault(),H.stopPropagation(),H.currentTarget.classList.add("bg-primary/20")},ne=H=>{H.preventDefault(),H.stopPropagation(),H.currentTarget.classList.remove("bg-primary/20")},re=H=>{H.preventDefault(),H.stopPropagation(),H.currentTarget.classList.remove("bg-primary/20");const te=H.dataTransfer.getData("entityId"),ie=H.dataTransfer.getData("sourceFolderId");te&&ie&&ie!==String(t.id)&&s(te,t.id,ie)};return m.jsxs("div",{className:`space-y-1 select-none ${u||""}`,children:[m.jsxs("div",{className:"flex items-center gap-3 px-3 py-2 rounded-xl text-xs font-bold text-text-muted hover:text-white hover:bg-white/5 cursor-pointer transition-all group relative",onClick:I,onContextMenu:H=>q(H,"folder",t.id,t.nombre),onDragOver:Q,onDragLeave:ne,onDrop:re,children:[m.jsx("span",{onClick:Z,className:`material-symbols-outlined text-lg transition-transform hover:text-primary ${v?"rotate-90 text-primary":"opacity-50"}`,children:"chevron_right"}),m.jsx("span",{className:`material-symbols-outlined text-lg ${Jk(t.tipo).color}`,children:Jk(t.tipo).icon}),j?m.jsx("input",{autoFocus:!0,className:"bg-surface-light border border-primary/50 rounded px-2 py-0.5 text-xs text-white outline-none flex-1 min-w-0",defaultValue:A,onKeyDown:async H=>{if(H.key==="Enter"){H.preventDefault(),H.stopPropagation();const te=H.target.value.trim();if(te&&te!==A)try{await r(t.id,te),O(te)}catch(ie){console.error("Rename failed",ie)}D(!1)}else H.key==="Escape"&&(H.preventDefault(),H.stopPropagation(),D(!1))},onBlur:()=>D(!1),onClick:H=>H.stopPropagation()}):m.jsx("span",{className:"truncate flex-1",children:A})]}),C&&m.jsxs("div",{className:"fixed bg-surface-dark border border-glass-border shadow-2xl rounded-xl py-2 z-50 w-48 text-xs font-medium flex flex-col",style:{top:C.y,left:C.x},onClick:H=>H.stopPropagation(),children:[m.jsx("div",{className:"px-4 py-2 border-b border-white/5 font-bold text-text-muted truncate",children:C.name}),C.type==="folder"?m.jsxs(m.Fragment,{children:[m.jsxs("button",{className:"px-4 py-2 hover:bg-white/5 text-left flex items-center gap-2",onClick:()=>{o(t.id,"entidadindividual"),U()},children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"person"})," Add Character"]}),m.jsxs("button",{className:"px-4 py-2 hover:bg-white/5 text-left flex items-center gap-2",onClick:()=>{p(`/${c}/${f}/map-editor/create/${t.id}`),U()},children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"map"})," Add Map"]}),m.jsx("div",{className:"h-px bg-white/5 my-1"}),m.jsxs("button",{className:"px-4 py-2 hover:bg-white/5 text-left flex items-center gap-2",onClick:()=>{D(!0),U()},children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"edit"})," Rename Folder"]}),m.jsxs("button",{className:"px-4 py-2 hover:bg-red-500/10 text-red-400 text-left flex items-center gap-2",onClick:()=>{n(t.id,t.parentId),U()},children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})," Delete Folder"]})]}):m.jsxs(m.Fragment,{children:[m.jsxs("button",{className:"px-4 py-2 hover:bg-white/5 text-left flex items-center gap-2 cursor-pointer",onClick:()=>{B(C.id),U()},children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"edit"})," Rename"]}),m.jsxs("button",{className:"px-4 py-2 hover:bg-white/5 text-left flex items-center gap-2 cursor-pointer",onClick:async()=>{try{await Qe.entityService.toggleFavorite(C.id),window.dispatchEvent(new CustomEvent("favorites-update")),window.dispatchEvent(new CustomEvent("folder-update",{detail:{folderId:t.id}}))}catch(H){console.error(H)}U()},children:[m.jsx("span",{className:"material-symbols-outlined text-sm text-yellow-500",children:"star"})," Toggle Favorite"]}),m.jsxs("button",{className:"px-4 py-2 hover:bg-red-500/10 text-red-400 text-left flex items-center gap-2",onClick:()=>{i(C.id,t.id),U()},children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})," Delete Entity"]})]})]}),v&&m.jsxs("div",{className:"ml-6 pl-4 border-l border-glass-border space-y-1 animate-slide-in",children:[S.folders.map(H=>m.jsx(r8,{folder:H,onCreateSubfolder:e,onRename:r,onDeleteFolder:n,onDeleteEntity:i,onCreateTemplate:a,onMoveEntity:s,onCreateEntity:o,onConfirmCreate:l},H.id)),S.entities.map(H=>H.isNew||H.id===F?m.jsx(Y,{item:H,type:"entity"},H.id):m.jsxs(gh,{to:Dae(c,f,H,t.slug||t.id),onContextMenu:te=>q(te,"entity",H.id,H.nombre),className:`flex items-center gap-3 px-3 py-2 rounded-xl text-[11px] font-medium text-text-muted hover:text-white hover:bg-primary/10 transition-all group cursor-grab active:cursor-grabbing ${H.pending?"opacity-50 pointer-events-none":""}`,draggable:!H.pending,onDragStart:te=>{te.dataTransfer.setData("entityId",H.id),te.dataTransfer.setData("sourceFolderId",t.id)},children:[m.jsx("span",{className:"material-symbols-outlined text-sm opacity-70 group-hover:text-primary transition-colors",children:Oae(H.tipoEspecial)}),m.jsx("span",{className:"truncate flex-1",children:H.nombre}),H.favorite&&m.jsx("span",{className:"material-symbols-outlined text-[10px] text-yellow-500",title:"Favorito",children:"star"})]},H.id)),T&&S.folders.length===0&&S.entities.length===0&&m.jsx("div",{className:"px-3 py-2 text-[10px] text-text-muted/30 uppercase font-black italic tracking-tighter",children:"Empty Sector"})]})]})},Iae=({isOpen:t,onClose:e,onCreate:r,parentFolder:n})=>{const[i,a]=se.useState({nombre:"",descripcion:"",tipo:"FOLDER",canvasType:"BLANK"});if(!t)return null;const s=()=>{r(i),e(),a({nombre:"",descripcion:"",tipo:"FOLDER",canvasType:"BLANK"})},o=[uh.UNIVERSE,uh.GALAXY,uh.SYSTEM,uh.PLANET];return m.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm",children:m.jsxs("div",{className:"bg-[#1a1b26] w-full max-w-4xl rounded-2xl shadow-2xl border border-white/10 overflow-hidden flex flex-col max-h-[90vh]",children:[m.jsxs("div",{className:"p-6 border-b border-white/5 flex justify-between items-center bg-[#1f202e]",children:[m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsx("div",{className:"w-8 h-8 rounded-full bg-indigo-500/20 flex items-center justify-center text-indigo-400",children:m.jsx("span",{className:"material-icons text-sm",children:"add"})}),m.jsx("h2",{className:"text-xl font-semibold text-white",children:n?"Crear Nuevo Espacio":"Crear Nuevo Mapa"})]}),m.jsx("button",{onClick:e,className:"text-gray-400 hover:text-white transition",children:m.jsx("span",{className:"material-icons",children:"close"})})]}),m.jsx("div",{className:"p-8 overflow-y-auto flex-1",children:m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[m.jsxs("div",{className:"space-y-6",children:[m.jsx("h3",{className:"text-sm font-black uppercase tracking-widest text-indigo-400",children:"Identidad"}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-[10px] font-black text-white/30 uppercase mb-2",children:"Nombre del Espacio"}),m.jsx("input",{autoFocus:!0,type:"text",value:i.nombre,onChange:l=>a({...i,nombre:l.target.value}),className:"w-full bg-black/40 border border-white/5 rounded-2xl px-5 py-4 text-white focus:outline-none focus:border-indigo-500/50 transition-all shadow-inner",placeholder:"ej. Sistema Solar"})]}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-[10px] font-black text-white/30 uppercase mb-2",children:"Descripcin"}),m.jsx("textarea",{value:i.descripcion,onChange:l=>a({...i,descripcion:l.target.value}),className:"w-full h-32 bg-black/40 border border-white/5 rounded-2xl px-5 py-4 text-white focus:outline-none focus:border-indigo-500/50 resize-none transition-all",placeholder:"Detalles sobre este nivel jerrquico..."})]})]}),m.jsxs("div",{className:"space-y-6",children:[m.jsx("h3",{className:"text-sm font-black uppercase tracking-widest text-indigo-400",children:"Configuracin"}),m.jsxs("div",{className:"space-y-3",children:[m.jsx("label",{className:"block text-[10px] font-black text-white/30 uppercase mb-1",children:"Tipo de Jerarqua"}),m.jsx("div",{className:"grid grid-cols-2 gap-2",children:o.concat([{id:"FOLDER",label:"Carpeta",icon:"folder",color:"text-white/50"}]).map(l=>m.jsxs("div",{onClick:()=>a({...i,tipo:l.id}),className:`flex items-center gap-3 p-3 rounded-xl border cursor-pointer transition-all ${i.tipo===l.id?"bg-indigo-500/10 border-indigo-500/50":"bg-white/5 border-white/5 hover:bg-white/10"}`,children:[m.jsx("span",{className:`material-icons text-lg ${l.color||""}`,children:l.icon}),m.jsx("span",{className:"text-xs font-bold text-white/80",children:l.label})]},l.id||"FOLDER"))})]}),m.jsx("div",{className:"p-4 rounded-2xl bg-indigo-500/5 border border-indigo-500/10",children:m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("div",{className:"w-10 h-10 rounded-full bg-indigo-500/20 flex items-center justify-center text-indigo-400",children:m.jsx("span",{className:"material-icons",children:"info"})}),m.jsxs("div",{children:[m.jsx("p",{className:"text-[10px] uppercase font-black text-indigo-300",children:"Ubicacin Actual"}),m.jsx("p",{className:"text-xs text-indigo-100/50",children:n?n.nombre:"Raz del Mundo"})]})]})})]})]})}),m.jsxs("div",{className:"p-6 border-t border-white/5 flex justify-end gap-3 bg-[#1f202e]",children:[m.jsx("button",{onClick:e,className:"px-6 py-3 rounded-xl text-xs font-black uppercase tracking-widest text-text-muted hover:text-white transition",children:"Cancelar"}),m.jsx("button",{onClick:s,disabled:!i.nombre,className:"px-8 py-3 rounded-xl bg-indigo-600 hover:bg-indigo-500 text-white text-xs font-black uppercase tracking-widest shadow-lg shadow-indigo-500/20 transition-all disabled:opacity-30 disabled:pointer-events-none",children:"Confirmar y Crear"})]})]})})},jae=()=>{const{username:t,projectName:e}=Vi(),r=za(),{handleCreateEntity:n,...i}=Ll()||{},{t:a}=Sc(),[s,o]=se.useState([]),[l,u]=se.useState([]),[c,f]=se.useState(!1),[p,v]=se.useState(!1),[y,S]=se.useState(null),[w,T]=se.useState(!1),[_,C]=se.useState(null),N=`/${t}/${e}/bible`;se.useEffect(()=>{A(),O();const W=()=>O();return window.addEventListener("favorites-update",W),()=>window.removeEventListener("favorites-update",W)},[e]);const A=async()=>{try{const W=await Qe.get("/world-bible/folders");o(W)}catch(W){console.error("Error loading folders:",W)}},O=async()=>{try{const W=await Qe.get("/world-bible/favorites");u(W)}catch(W){console.error("Error loading favorites:",W)}},j=(W=null)=>{S(W),v(!0),f(!1)},D=async(W=null,Y="FOLDER")=>{try{const Q=W?typeof W=="object"?W.id:W:null,ne=await Qe.post("/world-bible/folders",{nombre:a(Y==="TIMELINE"?"bible.new_timeline":"bible.new_folder"),padreId:Q,tipo:Y});if(Q===null){const re=await Qe.get("/world-bible/folders");o(re),window.dispatchEvent(new CustomEvent("folder-update",{detail:{folderId:null}}))}else window.dispatchEvent(new CustomEvent("folder-update",{detail:{folderId:Q,optimisticType:"folder",item:ne,expand:!0}}))}catch(Q){console.error("Error creating simple folder:",Q)}},F=async W=>{try{const Y=y?y.id:null,Q=await Qe.post("/world-bible/folders",{nombre:W.nombre,descripcion:W.descripcion,padreId:Y,tipo:W.tipo});if(Y===null){const ne=await Qe.get("/world-bible/folders");o(ne),window.dispatchEvent(new CustomEvent("folder-update",{detail:{folderId:null}}))}else Q.id||console.error("CRITICAL: Created folder has no ID!",Q),window.dispatchEvent(new CustomEvent("folder-update",{detail:{folderId:Y,optimisticType:"folder",item:Q,expand:!0}}))}catch(Y){console.error(Y),alert("Error creating folder/zone.")}},B=async(W,Y="entidadindividual")=>{const Q=typeof W=="object"?W.slug||W.id:W;r(`${N}/folder/${Q}/entity/new/${Y}`)},$=async(W,Y)=>{try{await Qe.put(`/world-bible/folders/${W}`,{nombre:Y}),o(Q=>Q.map(ne=>ne.id===W?{...ne,nombre:Y}:ne))}catch(Q){throw Q}},Z=(W,Y=null)=>{C({id:W,parentId:Y,type:"folder"}),T(!0)},I=async()=>{if(!_)return;const{id:W,parentId:Y,type:Q,folderId:ne}=_;try{Q==="folder"?(await Qe.delete(`/world-bible/folders/${W}`),Y===null&&o(re=>re.filter(H=>H.id!==W)),window.dispatchEvent(new CustomEvent("folder-update",{detail:{folderId:Y,removeId:W,type:"folder"}}))):Q==="entity"&&(await Qe.delete(`/world-bible/entities/${W}`),window.dispatchEvent(new CustomEvent("folder-update",{detail:{folderId:ne,removeId:W,type:"entity"}})))}catch(re){console.error("Deletion failed:",re),alert("Error trying to delete item.")}finally{C(null)}},q=(W,Y)=>{C({id:W,folderId:Y,type:"entity"}),T(!0)},U=async(W,Y,Q,ne,re)=>{try{if(Q==="folder")typeof W=="number"&&!W.toString().startsWith("temp")&&(await Qe.put(`/world-bible/folders/${W}`,{nombre:Y}),window.dispatchEvent(new CustomEvent("folder-update",{detail:{folderId:ne,confirmedType:"folder",oldId:W,item:{id:W,nombre:Y,parentId:ne,tipo:re,uiKey:Date.now()}}})),ne||o(H=>H.map(te=>te.id===W?{...te,nombre:Y}:te)));else if(Q==="entity")if(typeof W=="string"&&W.startsWith("new-")){const H=await Qe.post("/world-bible/entities",{nombre:Y,carpetaId:ne,tipoEspecial:re||"entidadindividual"});window.dispatchEvent(new CustomEvent("folder-update",{detail:{folderId:ne,confirmedType:"entity",oldId:W,item:H}}))}else await Qe.put(`/world-bible/entities/${W}`,{nombre:Y}),window.dispatchEvent(new CustomEvent("folder-update",{detail:{folderId:ne,confirmedType:"entity",oldId:W,item:{id:W,nombre:Y,carpeta:{id:ne},tipoEspecial:re,slug:W}}})),window.dispatchEvent(new CustomEvent("folder-update",{detail:{folderId:ne}}))}catch(H){console.error("Creation/Rename failed",H),Q==="folder"&&Z(W,ne)}};return m.jsxs("div",{className:"flex h-full w-full bg-background-dark max-w-[1920px] mx-auto",children:[m.jsxs("aside",{className:"w-80 flex-none flex flex-col border-r border-glass-border bg-surface-dark/50 z-10",children:[m.jsx("div",{className:"p-4 border-b border-glass-border",children:m.jsxs("div",{className:"relative group mb-3",children:[m.jsx("span",{className:"material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-text-muted text-sm group-focus-within:text-primary transition-colors",children:"search"}),m.jsx("input",{type:"text",placeholder:a("bible.search_entity"),className:"w-full bg-surface-light/50 border border-glass-border rounded-xl py-2 pl-9 pr-3 text-xs focus:border-primary/50 outline-none transition-all text-white placeholder:text-text-muted/50"})]})}),m.jsxs("div",{className:"px-2 pt-2",children:[m.jsx("div",{className:"flex items-center justify-between px-2 mb-1",children:m.jsx("h2",{className:"text-[10px] font-black uppercase tracking-widest text-text-muted",children:a("bible.favorites")})}),l.length>0?m.jsx("div",{className:"space-y-0.5",children:l.map(W=>m.jsxs("div",{onClick:()=>r(`${N}/folder/${W.carpeta.slug||W.carpeta.id}/entity/${W.slug||W.id}`),className:"flex items-center gap-3 px-3 py-1.5 rounded-lg text-[11px] font-medium text-text-muted hover:text-white hover:bg-white/5 cursor-pointer transition-all group",children:[m.jsx("span",{className:"material-symbols-outlined text-sm text-yellow-500/70 group-hover:text-yellow-400",children:"star"}),m.jsx("span",{className:"truncate",children:W.nombre})]},W.id))}):m.jsx("div",{className:"px-4 py-2 text-[10px] text-text-muted/30 italic",children:a("bible.no_favorites")}),m.jsx("div",{className:"h-px bg-glass-border my-2 opacity-50"})]}),m.jsx("div",{className:"p-4 border-b border-glass-border pt-0",children:m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsx("h2",{className:"text-[10px] font-black uppercase tracking-widest text-text-muted",children:a("bible.explorer")}),m.jsx("div",{className:"relative",children:m.jsx("button",{className:"transition-colors hover:text-white text-primary",onClick:()=>D(null),title:a("bible.new_folder"),children:m.jsx("span",{className:"material-symbols-outlined text-sm",children:"create_new_folder"})})})]})}),m.jsx("div",{className:"flex-1 overflow-y-auto no-scrollbar p-2 space-y-0.5",children:s.length===0?m.jsxs("div",{className:"p-8 text-center opacity-30",children:[m.jsx("span",{className:"material-symbols-outlined text-3xl mb-2",children:"folder_off"}),m.jsx("p",{className:"text-[10px] uppercase font-bold",children:a("bible.empty_archive")})]}):s.map(W=>m.jsx(r8,{folder:W,onCreateSubfolder:()=>{},onRename:$,onDeleteFolder:Z,onDeleteEntity:Z,onCreateTemplate:()=>{},onMoveEntity:(Y,Q,ne)=>console.log("move",Y,Q,ne),onCreateEntity:B,onConfirmCreate:U},W.uiKey||W.id))})]}),m.jsx("main",{className:"flex-1 overflow-hidden relative bg-gradient-to-br from-background-dark to-surface-dark/20",children:m.jsx(r_,{context:{...i,folders:s,handleCreateEntity:B,handleOpenCreateModal:j,handleDeleteFolder:Z,handleDeleteEntity:q,handleCreateSimpleFolder:D}})}),m.jsx(Iae,{isOpen:p,onClose:()=>v(!1),onCreate:F,parentFolder:y}),m.jsx(Xv,{isOpen:w,onClose:()=>T(!1),onConfirm:I,title:_?.type==="folder"?a("bible.delete_folder"):a("bible.delete_entity"),message:_?.type==="folder"?a("bible.delete_folder_msg"):a("bible.delete_entity_msg"),confirmText:a("common.confirm_delete")})]})},Fae=()=>{const{username:t,projectName:e}=Vi();za();const{handleOpenCreateModal:r,handleDeleteFolder:n,handleCreateSimpleFolder:i,handleRenameFolder:a,folders:s=[]}=Ll(),{t:o}=Sc(),[l,u]=se.useState(null),[c,f]=se.useState(null),[p,v]=se.useState(""),y=(T,_)=>{T.preventDefault(),T.stopPropagation(),u({x:T.clientX,y:T.clientY,folder:_})},S=()=>u(null);se.useEffect(()=>{if(l){const T=()=>S();return window.addEventListener("click",T),()=>window.removeEventListener("click",T)}},[l]);const w=async(T,_)=>{_.trim()&&a&&await a(T,_.trim()),f(null),v("")};return s===void 0?m.jsx("div",{className:"p-20 text-center animate-pulse text-text-muted",children:o("common.loading")}):m.jsxs("div",{className:"flex-1 p-8 max-w-[1600px] mx-auto w-full h-full overflow-y-auto",children:[m.jsxs("header",{className:"mb-8 flex items-end justify-between",children:[m.jsxs("div",{children:[m.jsxs("div",{className:"flex items-center gap-3 text-xs font-black uppercase tracking-widest text-primary italic mb-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"auto_stories"}),o("nav.bible")]}),m.jsx("h1",{className:"text-4xl font-black text-white tracking-tighter",children:o("bible.root_index")}),m.jsx("p",{className:"text-text-muted mt-2 max-w-lg text-sm",children:o("bible.central_archive")})]}),m.jsx("div",{className:"flex items-center gap-2",children:m.jsxs("button",{onClick:()=>i(null,"FOLDER"),className:"px-6 py-2 bg-primary hover:bg-primary-light text-white rounded-xl text-xs font-bold flex items-center gap-2 transition-all shadow-lg shadow-primary/20",children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"create_new_folder"})," ",o("bible.new_folder")]})})]}),m.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4",children:s.map(T=>c===T.id?m.jsx("div",{className:"p-4 rounded-3xl bg-surface-dark border border-primary/50",children:m.jsx("input",{autoFocus:!0,type:"text",value:p,onChange:_=>v(_.target.value),onKeyDown:_=>{_.key==="Enter"&&w(T.id,p),_.key==="Escape"&&(f(null),v(""))},onBlur:()=>w(T.id,p),className:"w-full bg-black/30 border border-white/10 rounded-xl p-3 text-sm text-white focus:border-primary/50 outline-none",placeholder:o("common.rename")})},T.id):m.jsx(Qk,{item:T,type:"folder",linkTo:`/${t}/${e}/bible/folder/${T.slug||T.id}`,onDelete:()=>n(T.id),onContextMenu:_=>y(_,T)},T.id))}),s.length===0&&m.jsxs("div",{className:"p-20 text-center border-2 border-dashed border-glass-border rounded-[3rem] opacity-30 mt-8",children:[m.jsx("span",{className:"material-symbols-outlined text-6xl mb-4 text-text-muted",children:"library_books"}),m.jsx("h3",{className:"text-xl font-bold text-white uppercase tracking-widest",children:o("bible.empty_archive")}),m.jsx("p",{className:"text-text-muted mt-2",children:o("bible.empty_archive_desc")})]}),l&&m.jsxs("div",{className:"fixed bg-surface-dark border border-glass-border shadow-2xl rounded-xl py-2 z-50 w-52 text-xs font-medium flex flex-col animate-in fade-in zoom-in-95 duration-150",style:{top:l.y,left:l.x},onClick:T=>T.stopPropagation(),children:[m.jsxs("div",{className:"px-4 py-2 border-b border-white/5 font-bold text-text-muted truncate flex items-center gap-2",children:[m.jsx("span",{className:"material-symbols-outlined text-sm text-primary",children:"folder"}),l.folder.nombre]}),m.jsxs("button",{className:"px-4 py-2.5 hover:bg-white/5 text-left flex items-center gap-3 text-white/80 hover:text-white transition-colors",onClick:()=>{f(l.folder.id),v(l.folder.nombre),S()},children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"edit"})," ",o("common.rename")]}),m.jsxs("button",{className:"px-4 py-2.5 hover:bg-red-500/10 text-red-400 text-left flex items-center gap-3 transition-colors",onClick:()=>{n(l.folder.id),S()},children:[m.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})," ",o("bible.delete_folder")]})]})]})};function Bae(){const[t,e]=se.useState("deep_space"),[r,n]=se.useState(null);return se.useEffect(()=>{const i=localStorage.getItem("app_settings");if(i){const o=JSON.parse(i);o.theme&&e(o.theme)}const a=localStorage.getItem("user");a&&a!=="undefined"&&n(JSON.parse(a));const s=()=>{const o=localStorage.getItem("app_settings");if(o){const u=JSON.parse(o);u.theme&&e(u.theme)}const l=localStorage.getItem("user");l&&l!=="undefined"&&n(JSON.parse(l))};return window.addEventListener("storage_update",s),()=>window.removeEventListener("storage_update",s)},[]),se.useEffect(()=>{document.body.classList.forEach(i=>{i.startsWith("theme-")&&document.body.classList.remove(i)}),document.body.classList.add(`theme-${t}`)},[t]),m.jsx(Kj,{children:m.jsx("div",{className:`app-container theme-${t} h-screen w-screen overflow-hidden`,children:m.jsx(DI,{children:m.jsxs(TI,{children:[m.jsx(zn,{path:"/",element:m.jsx(Ej,{})}),m.jsxs(zn,{element:m.jsx(xj,{}),children:[m.jsx(zn,{path:"/settings",element:m.jsx(Yj,{})}),m.jsxs(zn,{path:"/:username/:projectName",element:m.jsx(Qj,{}),children:[m.jsx(zn,{index:!0,element:m.jsx(Zj,{})}),m.jsx(zn,{path:"writing",element:m.jsx(Cae,{})}),m.jsx(zn,{path:"writing/:notebookId",element:m.jsx(_ae,{})}),m.jsx(zn,{path:"entities/:type/:entityId",element:m.jsx(ZG,{})}),m.jsx(zn,{path:"map-editor/create/:folderId",element:m.jsx(ok,{mode:"create"})}),m.jsx(zn,{path:"map-editor/edit/:entityId",element:m.jsx(ok,{mode:"edit"})}),m.jsxs(zn,{path:"bible",element:m.jsx(jae,{}),children:[m.jsx(zn,{index:!0,element:m.jsx(Fae,{})}),m.jsx(zn,{path:"folder/:folderSlug/entity/new/:type",element:m.jsx($g,{mode:"creation"})}),m.jsx(zn,{path:"folder/:folderSlug",element:m.jsx(Rae,{})}),m.jsx(zn,{path:"entity/:entitySlug",element:m.jsx($g,{})}),m.jsx(zn,{path:"folder/:folderSlug/entity/:entitySlug",element:m.jsx($g,{})}),m.jsx(zn,{path:"folder/:folderSlug/map/:entitySlug",element:m.jsx($g,{})}),m.jsx(zn,{path:"folder/:folderSlug/timeline/:entitySlug",element:m.jsx($g,{})})]}),m.jsx(zn,{path:"map",element:m.jsx(yW,{})}),m.jsx(zn,{path:"timeline",element:m.jsx(YG,{})}),m.jsx(zn,{path:"languages",element:m.jsx(GZ,{})}),m.jsx(zn,{path:"trash",element:m.jsx(Eae,{})}),m.jsx(zn,{path:"graph",element:m.jsx(HG,{})})]})]})]})})})})}const GC=(t,e,r,n="")=>{fetch("/api/logs/error",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({source:t,message:e,stack:r,componentStack:n})}).catch(i=>console.error("Failed to send error log:",i))};window.onerror=(t,e,r,n,i)=>{GC("Global Window Error",t,i?i.stack:`${e}:${r}:${n}`)};window.onunhandledrejection=t=>{GC("Unhandled Promise Rejection",t.reason?t.reason.message:"Unknown reason",t.reason?t.reason.stack:"")};class zae extends sr.Component{constructor(e){super(e),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(e){return{hasError:!0}}componentDidCatch(e,r){this.setState({error:e,errorInfo:r}),console.error("Uncaught Error:",e,r),GC("React ErrorBoundary",e.message,e.stack,r.componentStack)}render(){return this.state.hasError?m.jsxs("div",{style:{padding:20,background:"#222",color:"red",height:"100vh"},children:[m.jsx("h1",{children:"Something went wrong."}),m.jsxs("details",{style:{whiteSpace:"pre-wrap"},children:[this.state.error&&this.state.error.toString(),m.jsx("br",{}),this.state.errorInfo&&this.state.errorInfo.componentStack]})]}):this.props.children}}const CM=document.getElementById("root");CM?D8.createRoot(CM).render(m.jsx(sr.StrictMode,{children:m.jsx(zae,{children:m.jsx(Bae,{})})})):console.error("React root element not found (looked for #root)")});export default Uae();
